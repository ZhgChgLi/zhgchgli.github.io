---
author: ZhgChgLi
categories:
- ZRealm Robotic Process Automation
date: 2024-10-20T08:19:52.764+0000
description: ä½¿ç”¨ Google Apps Script å®Œæˆ RPAï¼Œè‡ªè¡Œä¸²æ¥ GA4 + Telegram Bot æ•¸æ“šé€šçŸ¥æ©Ÿå™¨äºº
image:
  path: /assets/1e85b8df2348/1*La0AKKSrGNP9EZUV-vrONQ.jpeg
last_modified_at: 2024-10-20T08:19:52.764+0000
render_with_liquid: false
tags:
- automation
- google-apps-script
- telegram
- google-analytics
- rpa-solutions
title: ç°¡å–® 3 æ­¥é©Ÿâ€Šâ€”â€Šæ‰“é€ å…è²» GA4 è‡ªå‹•æ•¸æ“šé€šçŸ¥æ©Ÿå™¨äºº
---

### ç°¡å–® 3 æ­¥é©Ÿ â€” æ‰“é€ å…è²» GA4 è‡ªå‹•æ•¸æ“šé€šçŸ¥æ©Ÿå™¨äºº

ä½¿ç”¨ Google Apps Script å®Œæˆ RPAï¼Œè‡ªè¡Œä¸²æ¥ GA4 \+ Telegram Bot æ•¸æ“šé€šçŸ¥æ©Ÿå™¨äºº



![Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/1e85b8df2348/1*La0AKKSrGNP9EZUV-vrONQ.jpeg)

Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}
### å‰è¨€

å¤§ç´„å¾ 2020 å¹´é–‹å§‹å°±è‡ªå·±åœ¨æ‘¸ç´¢ä½¿ç”¨æ‰‹é‚Šå·¥å…·å¯¦ç¾ RPAï¼Œå¾ä¸€é–‹å§‹åªæ˜¯ç‚ºäº†è‡ªå‹•åŒ–å€‹äººä¾‹è¡Œä»»å‹™ï¼Œåˆ°å¾Œä¾†å·¥ä½œä¹ŸåŠ å…¥äº†è¦æ¨¡æ›´å¤§å‹çš„çµ„ç¹”ï¼Œæ™‚å¸¸æœƒé‡åˆ°è·¨åœ˜éšŠæˆ–ä»°è³´äººèˆ‡äººçš„ä»»å‹™ã€ç”šè‡³æ˜¯é‡è¤‡æ€§ä»»å‹™ï¼Œæ‰ç™¼ç¾ RPA è‡ªå‹•åŒ–çš„æ•ˆç›Šæ‰€åœ¨ã€‚

èˆ‰ä¾‹ä¾†èªªï¼šæŸå€‹é‡è¤‡ä»»å‹™æ¯å€‹æœˆæœƒç™¼ç”Ÿ 10 æ¬¡ï¼Œæ¯æ¬¡éœ€èŠ±è²» 30 åˆ†é˜è™•ç†ï¼Œæœ‰ 60 äººæœƒé‡åˆ°ï¼Œæ¯å¹´åœ˜éšŠç­‰æ–¼æ¶ˆè€— 3,600 å°æ™‚åœ¨é€™ä¸Šé¢ï¼Œå¦‚æœèƒ½æŠ•è³‡ 100 å°æ™‚é–‹ç™¼æˆè‡ªå‹•åŒ–ï¼Œå¾ŒçºŒè§£æ”¾å‡ºä¾†çš„æ™‚é–“ï¼Œå°±èƒ½æŠ•å…¥åœ¨æ›´æœ‰åƒ¹å€¼çš„å·¥ä½œä¸Šï¼›å¯¦éš›ç­‰æ–¼ 3,600 æµªè²»çš„å·¥æ™‚ï¼‹3,600 æ›´å€¼å¾—æŠ•è³‡çš„ç”¢å‡ºã€‚
#### **è©³ç´°å¯åƒè€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š**
- [2021 Pinkoi Tech Career Talk â€” é«˜æ•ˆç‡å·¥ç¨‹åœ˜éšŠå¤§è§£å¯†](../11f6c8568154/)
- [ä½¿ç”¨ Google Apps Script å¯¦ç¾æ¯æ—¥æ•¸æ“šå ±è¡¨ RPA è‡ªå‹•åŒ–](../f6713ba3fee3/)

#### å…¶ä»–åšéçš„ RPAï¼š
- \[GMail to Slack\] [é‹ç”¨ Google Apps Script è½‰ç™¼ Gmail ä¿¡ä»¶åˆ° Slack](../d414bdbdb8c9/)
- \[Google Form x Google Sheet xSlack\] [Slack æ‰“é€ å…¨è‡ªå‹• WFH å“¡å·¥å¥åº·ç‹€æ³å›å ±ç³»çµ±](https://medium.com/zrealm-robotic-process-automation/slack-%E6%89%93%E9%80%A0%E5%85%A8%E8%87%AA%E5%8B%95-wfh-%E5%93%A1%E5%B7%A5%E5%81%A5%E5%BA%B7%E7%8B%80%E6%B3%81%E5%9B%9E%E5%A0%B1%E7%B3%BB%E7%B5%B1-d61062833c1a?source=collection_home---6------9-----------------------){:target="_blank"}
- \[Big Query x Slack \] [Crashlytics \+ Big Query æ‰“é€ æ›´å³æ™‚ä¾¿åˆ©çš„ Crash è¿½è¹¤å·¥å…·](https://medium.com/zrealm-robotic-process-automation/crashlytics-big-query-%E6%89%93%E9%80%A0%E6%9B%B4%E5%8D%B3%E6%99%82%E4%BE%BF%E5%88%A9%E7%9A%84-crash-%E8%BF%BD%E8%B9%A4%E5%B7%A5%E5%85%B7-e77b80cc6f89?source=collection_home---6------7-----------------------){:target="_blank"}
- \[Google Analytics x Slack\] [Crashlytics \+ Google Analytics è‡ªå‹•æŸ¥è©¢ App Crash\-Free Users Rate](https://medium.com/zrealm-robotic-process-automation/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72?source=collection_home---6------6-----------------------){:target="_blank"}
- \[Github Webhook x Line Notify\] [ä½¿ç”¨ Google Apps Script ä¸‰æ­¥é©Ÿå…è²»å»ºç«‹ Github Repo Star Notifier](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697?source=collection_home---6------5-----------------------){:target="_blank"}
- \[Slack x OpenAI \(ChatGTP\) \] [Slack & ChatGPT Integration](https://medium.com/zrealm-robotic-process-automation/slack-chatgpt-integration-bd94cc88f9c9?source=collection_home---6------4-----------------------){:target="_blank"}
- \[Google Analytics x Google Sheet\] [ä½¿ç”¨ Google Apps Script å¯¦ç¾æ¯æ—¥æ•¸æ“šå ±è¡¨ RPA è‡ªå‹•åŒ–](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"}
- \[iOS Shortcut x Line x Reminders\] [iOS æ·å¾‘è‡ªå‹•åŒ–æ‡‰ç”¨å ´æ™¯ â€” è‡ªå‹•è½‰ç™¼ç°¡è¨Šèˆ‡è‡ªå‹•å»ºç«‹æé†’å¾…è¾¦äº‹é …](https://medium.com/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96%E6%87%89%E7%94%A8%E5%A0%B4%E6%99%AF-%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E8%87%AA%E5%8B%95%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85-309d0302877b?source=collection_home---6------2-----------------------){:target="_blank"}
- \[Apple Store API x Google Play Console API x Github Action\] [Github Action x ZReviewTender å…è²»å¿«é€Ÿéƒ¨ç½²ä½ çš„ App å•†åŸè©•åƒ¹ç›£æ§æ©Ÿå™¨äºº](https://medium.com/zrealm-robotic-process-automation/quick-start-github-action-x-zreviewtender-%E5%85%8D%E8%B2%BB%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E4%BD%A0%E7%9A%84-app-%E5%95%86%E5%9F%8E%E8%A9%95%E5%83%B9%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-0095528cf875?source=collection_home---6------1-----------------------){:target="_blank"}
- \[Telegram Bot\] [10 åˆ†é˜å¿«é€Ÿç§»è½‰ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"}
- \[Medium to Jekyllrb\] [ç„¡ç—›è½‰ç§» Medium åˆ°è‡ªæ¶ç¶²ç«™](../a0c08d579ab1/)


å¾å¾Œå°æ•¸æ“šçœ‹ä¹‹å‰è »å¤šæ–‡ç« æœ‰è¢« ChatGPT æˆ–å„ç¨® GenAI æœå‹™æ”¶éŒ„ï¼Œé–“æ¥çš„å¹«åŠ©äº†è¨±å¤šéå·¥ç¨‹èƒŒæ™¯ä½†ä¹Ÿæƒ³å˜—è©¦ä½¿ç”¨ RPA è§£æ±ºå•é¡Œçš„æœ‹å‹ï¼Œå› æ­¤æˆ‘ä»æœƒæŒçºŒåˆ†äº«è‡ªå·±ç”Ÿæ´»æˆ–å·¥ä½œä¸Šé‡åˆ°çš„ RPA å ´æ™¯è·Ÿæˆ‘çš„è§£æ±ºæ–¹æ¡ˆèˆ‡å¤§å®¶åˆ†äº« â€” [ZRealm Robotic Process Automation](../d414bdbdb8c9/) ã€‚
#### å·¥å•†æ™‚é–“

å¦‚æœæ‚¨èˆ‡æ‚¨çš„åœ˜éšŠæœ‰è‡ªå‹•åŒ–å·¥å…·ã€æµç¨‹ä¸²æ¥éœ€æ±‚ï¼Œä¸è«–æ˜¯ Slack App é–‹ç™¼ã€Notionã€Asanaã€Google Sheetã€Google Formã€GA æ•¸æ“šï¼Œå„ç¨®ä¸²æ¥éœ€æ±‚ï¼Œæ­¡è¿èˆ‡æˆ‘ [**è¯çµ¡é–‹ç™¼**](https://zhgchg.li/contact/){:target="_blank"} ã€‚
### æœ¬ç¯‡ Google Analytics 4 x Telegram Bot

é€™æ¬¡è¦ä»‹ç´¹çš„ä¸²æ¥å ´æ™¯æ˜¯æ¥çºŒä¸Šä¸€ç¯‡ã€Œ [10 åˆ†é˜å¿«é€Ÿç§»è½‰ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€æ™‚æƒ³åˆ°æˆ‘çš„ Medium å‚™ä»½ç«™ã€Œ [zhgchg\.li](https://zhgchg.li/){:target="_blank"} ã€ä¸€ç›´éƒ½æ²’æœ‰é—œæ³¨ä»–çš„ GA4 ç¶²ç«™æ•¸æ“šï¼Œæƒ³èªªå¥½åƒå¯ä»¥å¤šåšä¸€å€‹é€šçŸ¥æ©Ÿå™¨äººï¼Œæ¯æ—¥å‚³é€éå» 7 å¤©çš„ç¶²ç«™æ•¸æ“šåˆ°æŒ‡å®šçš„ Telegram Channel è®“æˆ‘çŸ¥é“ã€‚

æœ¬ç¯‡åªæ˜¯å°å“ï¼Œå¦‚æœè¦åšå®Œæ•´çš„è‡ªå‹•åŒ–æ•¸æ“šå ±è¡¨è«‹åƒè€ƒä¹‹å‰çš„æ–‡ç« ã€Œ [ä½¿ç”¨ Google Apps Script å¯¦ç¾æ¯æ—¥æ•¸æ“šå ±è¡¨ RPA è‡ªå‹•åŒ–](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"} ã€å¦å¤–ä¹‹å‰ä¹Ÿæ›¾ä¸²é GA4 æ’ˆå– App Crash\-free rate å¯åƒè€ƒæ­¤ç¯‡æ–‡ç« ã€Œ [Crashlytics \+ Google Analytics è‡ªå‹•æŸ¥è©¢ App Crash\-Free Users Rate](https://medium.com/zrealm-robotic-process-automation/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72?source=collection_home---6------6-----------------------){:target="_blank"} ã€ã€‚
- Google Apps Script å…è²»é™åˆ¶ã€è©³ç´°ä½¿ç”¨ã€éƒ¨ç½²ã€åŠŸèƒ½ä»‹ç´¹æœ¬ç¯‡ä¸æœƒå†å¤šä»‹ç´¹ï¼Œè«‹åƒè€ƒ [ä¹‹å‰æ–‡ç« ](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"} ã€‚
- Telegram Bot å‰µå»ºã€ä½¿ç”¨æœ¬ç¯‡ä¹Ÿä¸æœƒå†å¤šä»‹ç´¹ï¼ŒåŒæ¨£è«‹åƒè€ƒ [ä¹‹å‰æ–‡ç« ](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€‚

#### æˆæœ


![](/assets/1e85b8df2348/1*J7QdgrJRNzVFQJfW5UBBFA.png)


å…ˆä¸Šæœ€çµ‚æ•ˆæœï¼ŒGoogle Apps Script æ¯æ—¥ä¸‹åˆ 12â€“13 é»ä¹‹é–“æœƒè‡ªå‹•å»æ’ˆå–æˆ‘æƒ³è¦çš„ Google Analytics 4 ç¶²ç«™æ•¸æ“šä¸¦çµ„åˆæˆè¨Šæ¯é€é Telegram Bot å‚³é€åˆ°æˆ‘çš„ Telegram Channelï¼Œæˆ‘å¯ä»¥å¿«é€Ÿæª¢é–±è¿‘ 7 å¤©ç¶²ç«™æ•¸æ“šã€‚

**æˆ‘æƒ³è¦è§€æ¸¬çš„æ•¸æ“šæ˜¯ï¼š**
- è¿‘ 7 å¤© `7daysAgo ~ today` ç¸½ç€è¦½æ•¸ `screenPageViews`
- æ´»èºä½¿ç”¨è€…æ•¸ `active7DayUsers`
- æ–°ä½¿ç”¨è€…æ•¸ `newUsers`
- Top 10 ç€è¦½é é¢ `screenPageViews` / `pageTitle`
- æ–°ä½¿ç”¨è€…æœ€åˆä¾†æºåª’ä»‹ `newUsers` / `firstUserSourceMedium`



> _å¯¦éš›å¯ä¾ç…§ä½ è‡ªå·±çš„éœ€æ±‚ä½¿ç”¨ [GA Dev Tools](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} ç”¢ç”Ÿèª¿æ•´ã€‚_ 




### Step 1\. ä½¿ç”¨ [GA4 Query Explorer å®˜æ–¹å·¥å…·](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} ç”¢ç”Ÿæ•¸æ“šå ±è¡¨æŸ¥è©¢åƒæ•¸

é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨ [GA4 Query Explorer](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} å®˜æ–¹æä¾›çš„å·¥å…·ç”¢ç”Ÿæˆ‘å€‘éœ€è¦çš„æŸ¥è©¢æ•¸æ“šå ±è¡¨åƒæ•¸ï¼š


![](/assets/1e85b8df2348/1*4b1S9nYSmO7OmGgDPllxeQ.png)

1. Select Property: è¨˜ä¸‹ä½ çš„ `property ç·¨è™Ÿ` 
**property ç·¨è™Ÿç¨å¾Œæ’°å¯« Google Apps Script æœƒä½¿ç”¨ã€‚**
2. start date, end date: å ±è¡¨é–‹å§‹ï½çµæŸçš„æ—¥æœŸç¯„åœï¼Œå¯ä½¿ç”¨ `YYYY-MM-DD` æˆ– `yesterday` , `today` , `NdaysAgo` é­”è¡“è®Šæ•¸ã€‚
3. metrics: é¸æ“‡ä½ æƒ³è¦æŸ¥è©¢çš„æŒ‡æ¨™
4. dimensions: é¸æ“‡ä½ æƒ³è¦æŸ¥è©¢çš„ç¶­åº¦
5. metric aggregations: æ•¸æ“šåˆä½µè¨ˆç®—è¦å‰‡


é€™é‚Šä»¥æˆ‘çš„å ´æ™¯ç‚ºä¾‹ï¼š
1. property ç·¨è™Ÿ: `318495208`
2. start\_date: `7daysAgo`
3. end\_date: `yesterday` 
å›  GA æ•¸æ“šå ±è¡¨æœƒå»¶é²ï¼ŒæŸ¥è©¢å‰ä¸€å¤©ï½ä¸ƒå¤©æœ€æº–ç¢ºã€‚
4. metric aggregations: `total`


**å…¶ä»– filter, limit å¯ä¾ç…§è‡ªå·±éœ€æ±‚è¨­å®šï¼š**


![](/assets/1e85b8df2348/1*g2psNn3gMZWs4OFRx7phWQ.png)


filter æˆ‘ç”¨ä¸åˆ°ç•™ç©ºï¼›limit æˆ‘è¼¸å…¥ 10ï¼Œå› ç‚ºæˆ‘åªæƒ³çŸ¥é“ Top 10ã€‚
#### **é»æ“Šã€ŒMAKE REQUESTã€ç”¢ç”Ÿå°æ‡‰çš„æ•¸æ“šå ±è¡¨æŸ¥è©¢åƒæ•¸åŠçµæœï¼š**


![](/assets/1e85b8df2348/1*Rj1kMTyZiEYGvAztEEngIQ.png)

#### **è¨˜ä¸‹ä»¥ä¸‹è«‹æ±‚åƒæ•¸ï¼Œç¨å¾Œæ’°å¯« Google Apps Script æœƒä½¿ç”¨ï¼š**
```json
{
  "dimensions": [
    {
      "name": "pageTitle"
    }
  ],
  "metrics": [
    {
      "name": "screenPageViews"
    }
  ],
  "dateRanges": [
    {
      "startDate": "7daysAgo",
      "endDate": "yesterday"
    }
  ],
  "limit": "10",
  "metricAggregations": [
    "TOTAL"
  ]
}
```
#### **çµæœï¼š**


![](/assets/1e85b8df2348/1*ivAXeRTVB8Y7zbP-Gq2I2A.png)



![](/assets/1e85b8df2348/1*FFThyuptIYrGsfddHcjupQ.jpeg)

- èˆ‡ GA ä¸Šçš„æ•¸æ“šæ¯”è¼ƒæ˜¯å¦æ­£ç¢ºï¼Œæ­£ç¢ºç›¸ç¬¦ âœ…âœ…âœ…

### Step 2\. å»ºç«‹ Google Apps Script & ä½¿ç”¨ Google Analytics Data API æŸ¥è©¢è³‡æ–™
- å‰å¾€ [https://script\.google\.com/home](https://script.google.com/home){:target="_blank"}
- å»ºç«‹æ–°å°ˆæ¡ˆï¼Œå‘½åå°ˆæ¡ˆåç¨±
- é»æ“Šã€Œæœå‹™ã€\-&gt;ã€Œ\+ã€æ–°å¢æœå‹™
- é¸æ“‡ã€ŒGoogle Analytics Data APIã€
- é»æ“Šã€Œæ–°å¢ã€



![](/assets/1e85b8df2348/1*gcMDDQTXd-Gos5AdGUXIOw.png)


**è²¼ä¸Š Google Analytics Data API æŸ¥è©¢ç¨‹å¼ç¢¼ä¸¦çµ„åˆï¼š**

å°‡å‰é¢æ­¥é©Ÿç”¢ç”Ÿçš„å ±è¡¨æŸ¥è©¢æ•¸æ“šåƒæ•¸ï¼š
```json
{
  "dimensions": [
    {
      "name": "pageTitle"
    }
  ],
  "metrics": [
    {
      "name": "screenPageViews"
    }
  ],
  "dateRanges": [
    {
      "startDate": "7daysAgo",
      "endDate": "yesterday"
    }
  ],
  "limit": "10",
  "metricAggregations": [
    "TOTAL"
  ]
}
```

**è½‰æ›æˆç¨‹å¼ï¼š**
```javascript
function execute() {
  Logger.log(JSON.stringify(fetchScreenPageViews("318495208")));
}

// æ‹†æˆç¨ç«‹æ–¹æ³•ï¼Œæ–¹ä¾¿æ—¥å¾Œé‡è¤‡ä½¿ç”¨...
// é è¨­ startDate=7daysAgo, endDate=yesterday
// å…¶ä»–ç”¨æ³•ï¼š
// e.g. fetchScreenPageViews("1111". "3daysAgo", "yesterday")
// e.g. fetchScreenPageViews("2222". "yesterday", "today")
function fetchScreenPageViews(propertyId, startDate = "7daysAgo", endDate = "yesterday") {
  const screenPageViewsMetric = AnalyticsData.newMetric();
  screenPageViewsMetric.name = "screenPageViews";

  const dateRange = AnalyticsData.newDateRange();
  dateRange.startDate = startDate;
  dateRange.endDate = endDate;

  const pageTitleDimension = AnalyticsData.newDimension();
  pageTitleDimension.name = "pageTitle";

  const request = AnalyticsData.newRunReportRequest();
  request.dimensions = [pageTitleDimension];
  request.metrics = [screenPageViewsMetric];
  request.dateRanges = dateRange;

  request.limit = 10;
  request.metricAggregations = "TOTAL";

  return AnalyticsData.Properties.runReport(request, "properties/" + propertyId);
}
```

ç¨‹å¼ç¢¼è§£æï¼š
```javascript
// metric æŒ‡æ¨™ï¼Œå¯ä»¥æ˜¯å¤šå€‹ï¼Œè«‹åˆ†é–‹å®£å‘Š...
const screenPageViewsMetric = AnalyticsData.newMetric();
screenPageViewsMetric.name = "screenPageViews";

// ä¾‹å¦‚å¦ä¸€å€‹ active1DayUsersï¼š
const active1DayUsersMetric = AnalyticsData.newMetric();
active1DayUsersMetric.name = "active1DayUsers";

// å®£å‘Šæ—¥æœŸç¯„åœ
const dateRange = AnalyticsData.newDateRange();
dateRange.startDate = startDate;
dateRange.endDate = endDate;

// dimension ç¶­åº¦ï¼Œå¯ä»¥æ˜¯å¤šå€‹ï¼Œè«‹åˆ†é–‹å®£å‘Š...
const pageTitleDimension = AnalyticsData.newDimension();
pageTitleDimension.name = "pageTitle";

// ä¾‹å¦‚å¦ä¸€å€‹ dimensionï¼š
const firstUserSourceMediumDimension = AnalyticsData.newDimension();
firstUserSourceMediumDimension.name = "firstUserSourceMedium";

//

// ç”¢ç”Ÿ Request ç‰©ä»¶
const request = AnalyticsData.newRunReportRequest();
request.metrics = [active1DayUsersMetric, active1DayUsersMetric]; // å¤šå€‹å°±éƒ½å¸¶å…¥...
request.dimensions = [pageTitleDimension, firstUserSourceMediumDimension]; // å¤šå€‹å°±éƒ½å¸¶å…¥...

request.dateRanges = dateRange;

// åªéœ€è¦å‰ 10 ç­†è³‡æ–™ (Top 10)
request.limit = 10;

// è¨­å®šæ•¸æ“šåˆä½µè¨ˆç®—é‚è¼¯ï¼šTotal (SUM)
request.metricAggregations = "TOTAL";

// ç”¢ç”ŸæŸ¥è©¢çµæœ
return AnalyticsData.Properties.runReport(request, "properties/" + propertyId).rows;
```

**ç¬¬ä¸€æ¬¡åŸ·è¡Œï¼Œæœƒéœ€è¦æˆæ¬Š\(æ—¥å¾Œè‹¥ç¨‹å¼ç¢¼æœ‰æ–°å¢éœ€è¦çš„æ¬Šé™ä¹Ÿæœƒè¦é‡æ–°èªè­‰ä¸€æ¬¡\)ï¼š**


> _å¯¦éš›ä¸Šå°±æ˜¯æˆæ¬Š Google Apps Script æ—¥å¾Œä½¿ç”¨ä½ çš„å¸³è™Ÿèº«ä»½åŸ·è¡Œé€™äº›ç¨‹å¼ï¼Œæ‰€ä»¥éœ€è¦ç¢ºä¿ä½ é¸æ“‡çš„å¸³è™Ÿèº«ä»½æœ‰å°æ‡‰çš„ GA å ±è¡¨å­˜å–æ¬Šé™ã€‚_ 






![](/assets/1e85b8df2348/1*_z-P8a4PZCozhtgssH82lA.png)

- æ’°å¯«å¥½ç¨‹å¼ç¢¼å¾Œï¼Œé»æ“Šã€ŒåµéŒ¯ã€\-&gt; é»æ“Šã€Œå¯©æŸ¥æ¬Šé™ã€



![](/assets/1e85b8df2348/1*ehox-4AjKv3Ddf1jJ_VmTQ.png)

- é¸æ“‡è¦åŸ·è¡Œçš„èº«ä»½å¸³æˆ¶ï¼Œé€šå¸¸ç­‰æ–¼ç•¶å‰ Google Apps Script å¸³æˆ¶



![](/assets/1e85b8df2348/1*onR-n1sI4-G9KhD_fhef3Q.png)

- é¸æ“‡ã€Œé€²éšã€å±•é–‹ \-&gt; é»æ“Šã€Œå‰å¾€ XXXã€
é€™æ˜¯æˆ‘å€‘è‡ªå·±å¯«çµ¦è‡ªå·±ç”¨çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä¸éœ€ç¶“é Google é©—è­‰ã€‚



![](/assets/1e85b8df2348/1*73fQnaB__qKhO7NndQ0GyQ.png)

- é»æ“Šã€Œå…è¨±ã€


**å…è¨±ä¹‹å¾Œå†é»ã€ŒåµéŒ¯ã€æˆ–ã€ŒåŸ·è¡Œã€å°±èƒ½åŸ·è¡Œç¨‹å¼ï¼š**


![](/assets/1e85b8df2348/1*DbcQnfp8xdJCFnrDc778tw.png)


é€™é‚Šæˆ‘å€‘å…ˆä½¿ç”¨ `Logger.log(JSON.stringify())` å–å¾—è¼¸å‡ºçµæœï¼š
```json
{
  "kind": "analyticsData#runReport",
  "dimensionHeaders": [
    {
      "name": "pageTitle"
    }
  ],
  "rowCount": 71,
  "metadata": {
    "currencyCode": "TWD",
    "timeZone": "Asia/Taipei"
  },
  "rows": [
    {
      "dimensionValues": [
        {
          "value": "ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "166"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "109"
        }
      ],
      "dimensionValues": [
        {
          "value": "Apple Watch åŸå» ä¸é½é‹¼ç±³è˜­éŒ¶å¸¶é–‹ç®± | ZhgChgLi"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS â‰¥ 13.1 ä½¿ç”¨ã€Œæ·å¾‘ã€è‡ªå‹•åŒ–åŠŸèƒ½æ­é…ç±³å®¶æ™ºæ…§å®¶å±… | ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "101"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "Medium Partner Program çµ‚æ–¼å°å…¨çƒ(åŒ…å«å°ç£)å¯«ä½œè€…é–‹æ”¾å•¦ï¼ | ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "85"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "77"
        }
      ],
      "dimensionValues": [
        {
          "value": "iOS æ·å¾‘è‡ªå‹•åŒ–æ‡‰ç”¨å ´æ™¯ â€” è‡ªå‹•è½‰ç™¼ç°¡è¨Šèˆ‡è‡ªå‹•å»ºç«‹æé†’å¾…è¾¦äº‹é … | ZhgChgLi"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "51"
        }
      ],
      "dimensionValues": [
        {
          "value": "éŠè¨˜ 9/11 åå¤å±‹ä¸€æ—¥å¿«é–ƒè‡ªç”±è¡Œ | ZhgChgLi"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "42"
        }
      ],
      "dimensionValues": [
        {
          "value": "iOS éš±ç§èˆ‡ä¾¿åˆ©çš„å‰ä¸–ä»Šç”Ÿ | ZhgChgLi"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session | ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "34"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS â‰¥ 18 NSAttributedString attributes Range åˆä½µçš„ä¸€å€‹è¡Œç‚ºæ”¹è®Š | ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "30"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "30"
        }
      ],
      "dimensionValues": [
        {
          "value": "æ‰‹å·¥æ‰“é€  HTML è§£æå™¨çš„é‚£äº›äº‹ | ZhgChgLi"
        }
      ]
    }
  ],
  "metricHeaders": [
    {
      "type": "TYPE_INTEGER",
      "name": "screenPageViews"
    }
  ],
  "totals": [
    {
      "dimensionValues": [
        {
          "value": "RESERVED_TOTAL"
        }
      ],
      "metricValues": [
        {
          "value": "1229"
        }
      ]
    }
  ]
}
```
- **Google Apps Script è«‹æ±‚ GA æ•¸æ“šæˆåŠŸï¼ğŸ‰ğŸ‰ğŸ‰**

### Step 3\. çµ„åˆèµ·ä¾†ï¼Google Apps Script \+ GA4 \+ Telegram Bot

ä¾ç…§ä¸Šç¯‡æ–‡ç« ã€Œ [10 åˆ†é˜å¿«é€Ÿç§»è½‰ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€å»ºç«‹ä½ çš„ Telegram Bot å–å¾— `Bot Token` & æƒ³è¦å‚³é€åˆ°çš„ `Channel Chat ID` ã€‚
```javascript
const telegramToken = "XXXX" // å¸¶å…¥ä½ çš„ Telegram Bot Token
//

function execute() {
  const screenPageViewsReport = fetchScreenPageViews("318495208");
  
  //
  const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value);
  var message = "ç¸½ç€è¦½æ•¸ï¼š"+total.toLocaleString()+"\n";

  screenPageViewsReport.rows.forEach(function(element, index) {
    const pageTitle = element.dimensionValues[0].value;
    const value = parseInt(element.metricValues[0].value);

    message += "[Top "+(index + 1)+"] "+pageTitle+": "+value.toLocaleString()+"\n";
  });

  sendNotifyMessage(message, -xxxx); // å¸¶å…¥ä½ çš„ Channel Chat ID
}


// ç™¼é€è¨Šæ¯åˆ° Telegram æŒ‡å®š Channel Chat ID
function sendNotifyMessage(message, chatId) {
  var url = "https://api.telegram.org/bot"+telegramToken+"/sendMessage";
  
  const payload = {
    "chat_id": chatId,
    "text": message,
    "disable_web_page_preview": true
  } 
  const options = {
    'method': 'post',
    'contentType': 'application/json',
    'muteHttpExceptions': true,
    'payload': JSON.stringify(payload)
  };

  const response = UrlFetchApp.fetch(url, options);
  const data = JSON.parse(response.getContentText());

  if (data["ok"] == undefined || data["ok"] != true) {
    if (data["error_code"] != undefined && data["error_code"] == 429) {
      Utilities.sleep(1000);
      sendNotifyMessage(message, chatId);
    }
  }
}

function fetchScreenPageViews(propertyId, startDate = "7daysAgo", endDate = "yesterday") {
  const screenPageViewsMetric = AnalyticsData.newMetric();
  screenPageViewsMetric.name = "screenPageViews";

  const dateRange = AnalyticsData.newDateRange();
  dateRange.startDate = startDate;
  dateRange.endDate = endDate;

  const pageTitleDimension = AnalyticsData.newDimension();
  pageTitleDimension.name = "pageTitle";

  const request = AnalyticsData.newRunReportRequest();
  request.dimensions = [pageTitleDimension];
  request.metrics = [screenPageViewsMetric];
  request.dateRanges = dateRange;

  request.limit = 10;
  request.metricAggregations = "TOTAL";

  return AnalyticsData.Properties.runReport(request, "properties/" + propertyId);
}
```

ç¨‹å¼ç¢¼è§£æï¼š
```javascript
//...
  // ä¾ç…§å ±è¡¨å›å‚³çš„ json æ‰¾åˆ° total ä½ç½®ï¼ŒparseInt å°‡å­—ä¸²è½‰æˆ INT æ•¸å­—æ ¼å¼
  // .toLocaleString() -> æ ¼å¼åŒ–æ•¸å­—ï¼Œ123456 -> 123,456
  const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value);
  var message = "ç¸½ç€è¦½æ•¸ï¼š"+total.toLocaleString()+"\n";

  // ä¾ç…§å ±è¡¨å›å‚³çš„ json éæ­·è³‡æ–™ï¼Œçµ„åˆæˆè¨Šæ¯
  screenPageViewsReport.rows.forEach(function(element, index) {
    const pageTitle = element.dimensionValues[0].value;
    const value = parseInt(element.metricValues[0].value);

    message += "[Top "+(index + 1)+"] "+pageTitle+": "+value.toLocaleString()+"\n";
  });
//...
```
#### **åŸ·è¡Œï¼šé»æ“Šä¸Šæ–¹ã€ŒåŸ·è¡Œã€æˆ–ã€ŒåµéŒ¯ã€ä¸¦ç¢ºå®šæ–¹æ³•åç¨±æ˜¯é¸æ“‡ã€Œ `execute` ã€ï¼š**


![](/assets/1e85b8df2348/1*R7uVMGODJR2Z_GAYnyMYXA.png)



![](/assets/1e85b8df2348/1*Pl2v19Ed8COUwCc1deTYFw.png)

- **æˆåŠŸï¼ğŸ‰ğŸ‰ğŸ‰**

#### è¨­å®šæ’ç¨‹å®šæ™‚è‡ªå‹•åŸ·è¡Œ

æœ€å¾Œä¸€æ­¥æ˜¯æˆ‘å€‘å¸Œæœ›å ±è¡¨æ©Ÿå™¨äººèƒ½å®šæ™‚è‡ªå‹•åŸ·è¡Œï¼Œå¾å·¦å´é¸å–®å‰å¾€ã€Œè§¸ç™¼æ¢ä»¶ã€ï¼š


![](/assets/1e85b8df2348/1*SY1YKLwTvDtP1hQTRqj50w.png)

- é¸æ“‡å³ä¸‹è§’ã€Œæ–°å¢è§¸ç™¼æ¢ä»¶ã€æŒ‰éˆ•



![](/assets/1e85b8df2348/1*wYOwwQBTEtns8nN_7bmvNQ.png)

1. é¸æ“‡é”è¦åŸ·è¡Œçš„åŠŸèƒ½ï¼šé¸æ“‡ ã€Œ `execute` ã€æ–¹æ³•åç¨±
2. é¸æ“‡åŸ·è¡Œçš„éƒ¨ç½²ä½œæ¥­ï¼šé¸æ“‡ã€Œ `ä¸Šç«¯` ã€
3. é¸å–æ´»å‹•ä¾†æºï¼šé¸æ“‡ã€Œ `æ™‚é–“é©…å‹•` ã€
4. é¸å–æ™‚é–“å‹è§¸ç™¼æ¢ä»¶é¡å‹ï¼šé¸æ“‡ä½ æƒ³è¦çš„è§¸ç™¼é »ç‡
5. é¸å–æ™‚æ®µï¼šé¸æ“‡ä½ æƒ³è¦æ¯æ—¥è‡ªå‹•è§¸ç™¼çš„æ™‚é–“
6. å¦‚æœåŸ·è¡Œå¤±æ•—â€¦é€šçŸ¥ä¿¡ä»¶çš„é »ç‡è¨­å®š
7. å„²å­˜



> **_å®Œæˆï¼é€™æ¨£æ™‚é–“åˆ°å°±æœƒè‡ªå‹•åŸ·è¡Œå›‰ã€‚_** ğŸ‰ğŸ‰ğŸ‰ 




### å»¶ä¼¸ä½œæ¥­

å…¶ä»–æ•¸æ“šå¦‚ æ–°ä½¿ç”¨è€…æ•¸ã€ä¾†æºåª’ä»‹ç­‰ï¼ŒåŒæ¨£ä½¿ç”¨å‰é¢ç¨‹å¼ç¢¼å°±èƒ½é”æˆï¼Œé€™é‚Šå°±ä¸åœ¨é‡è¤‡è´…è¿°ï¼Œå°±ç•¶æˆçµ¦å¤§å®¶çš„å›å®¶ä½œæ¥­å›‰ã€‚


æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-robotic-process-automation/%E7%B0%A1%E5%96%AE-3-%E6%AD%A5%E9%A9%9F-%E6%89%93%E9%80%A0%E5%85%8D%E8%B2%BB-ga4-%E8%87%AA%E5%8B%95%E6%95%B8%E6%93%9A%E9%80%9A%E7%9F%A5%E6%A9%9F%E5%99%A8%E4%BA%BA-1e85b8df2348){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._