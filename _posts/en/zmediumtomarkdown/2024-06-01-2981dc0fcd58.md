---
title: "Exploring iOS NSAttributedString Using NSTextList or NSTextTab for List Indentation"
author: "ZhgChgLi"
date: 2024-06-01T14:43:49.946+0000
last_modified_at: 2024-06-01T14:51:40.473+0000
categories: ["ZRealm Dev."]
tags: ["ios-app-development","nsattributedstring","swift","layout","uikit"]
description: "Implementing HTML List OL/UL/LI-like list indentation functionality using NSTextList or NSTextTab in iOS Swift with NSAttributedString"
image:
  path: /assets/2981dc0fcd58/1*ApxgKEaFKG0B4GNgtRBNJQ.png
render_with_liquid: false
---

### \[iOS\] Exploring NSAttributedString Using NSTextList or NSTextTab for List Indentation

Implementing HTML List OL/UL/LI-like list indentation functionality using NSTextList or NSTextTab in iOS Swift with NSAttributedString

#### Technical Background

Previously, while developing my open-source project “[ZMarkupParser](https://github.com/ZhgChgLi/ZMarkupParser){:target="_blank"},” a library for converting HTML strings into NSAttributedString objects, I needed to research and implement various HTML components using only NSAttributedString. It was during this time that I encountered the `.paragraphStyle: NSParagraphStyle` attributes of `textLists: [NSTextList]` and `tabStops: [NSTextTab]`, which are two very obscure properties with scarce online resources.

[![](https://repository-images.githubusercontent.com/602927147/57ce75c1-8548-449c-b44a-f4b0451ed5ea)](https://github.com/ZhgChgLi/ZMarkupParser){:target="_blank"}

When I initially implemented the HTML list indentation conversion, I found examples showing that these two properties could be used to achieve this. Let's first take a look at the nested tag structure of the HTML list indentation:
```xml
<ul>
    <li>ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.</li>
    <li>ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.</li>
    <li>
        ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.
        <ol>
            <li>ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.</li>
            <li>ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.</li>
            <li>ZMarkupParser is a pure-Swift library that helps you convert HTML strings into NSAttributedString with customized styles and tags.</li>
        </ol>
    </li>
</ul>
```


Display effect in the browser:


![](/assets/2981dc0fcd58/1*ApxgKEaFKG0B4GNgtRBNJQ.png)


As shown in the above image, the list supports a multi-level nested structure and requires indentation according to the hierarchy.

At that time, there were many other HTML tag conversion tasks that needed to be implemented, and the workload was substantial; I quickly tried to use NSTextList or NSTextTab to create list indentation without delving deeply into it; however, the results were not as expected—too much spacing, misalignment, multi-line issues, unclear nested structure, and inability to control spacing. After a brief attempt without finding a solution, I gave up and temporarily formatted it in a rudimentary way:


![](/assets/2981dc0fcd58/1*TO0Z6GhVqZLPXgJqkZK0ig.png)


The effect in the above image is poor because I manually formatted it using spaces and the symbol `－`, **with no indentation effect**. The only advantage was that the spacing was made up of space characters, allowing me to control the size.

This matter ended up unresolved, and it had been open source for over a year without any specific changes; until recently, I received several [Issues](https://github.com/ZhgChgLi/ZMarkupParser/issues){:target="_blank"} requesting improvements to the List conversion, and a developer provided a [solution PR](https://github.com/ZhgChgLi/ZMarkupParser/pull/60){:target="_blank"}. Referring to the usage of `NSParagraphStyle` in that PR inspired me again; studying NSTextList or NSTextTab offers a chance to perfectly implement the indentation list feature!
#### Final Result

As usual, here is the final result image.


![](/assets/2981dc0fcd58/1*OdIqci0oQ5leHuPpNyZm1g.png)

- Now, it can perfectly convert HTML List Items into NSAttributedString objects in **[ZMarkupParser](https://github.com/ZhgChgLi/ZMarkupParser){:target="_blank"} ~&gt; `v1.9.4`** and above versions.
- Supports line breaks while maintaining indentation
- Supports custom indentation spacing size
- Supports nested structure indentation
- Supports different List Item Style list styles, such as Bullet, Disc, Decimal… and even custom symbols



> The main text begins below. 




### Exploring the Implementation of List Indentation Methods with NSTextList or NSTextTab

It is "or," not "and"; `NSTextList` and `NSTextTab` do not work together; each property can individually achieve list indentation functionality.
#### Method (1) Exploring List Indentation Implementation Using NSTextList
```swift
let listLevel1ParagraphStyle = NSMutableParagraphStyle()
listLevel1ParagraphStyle.textLists = [textListLevel1]
        
let listLevel2ParagraphStyle = NSMutableParagraphStyle()
listLevel2ParagraphStyle.textLists = [textListLevel1, textListLevel2]
        
let attributedString = NSMutableAttributedString()
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 1))\tList Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 2))\tList Level 1 - 2\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 3))\tList Level 1 - 3\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel2.marker(forItemNumber: 1))\tList Level 2 - 1\n", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel2.marker(forItemNumber: 2))\tList Level 2 - 2 StringStringStringStringStringStringStringStringStringStringStringString\n", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 4))\tList Level 1 - 4\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))        

textView.attributedText = attributedString
```

**Display Effect:**


![](/assets/2981dc0fcd58/1*V-Oj4Ja_Qz_34EwjV9b5Bg.png)


The public API provided by `NSTextList` is quite limited, and the parameters that can be controlled are as follows:
```swift
// Item display style
var markerFormat: NSTextList.MarkerFormat { get }

// Starting number for ordered items
var startingItemNumber: Int

// Whether it is an ordered numeric item (available only on iOS >= 16, this API is surprisingly updated)
@available(iOS 16.0, *)
open var isOrdered: Bool { get }

// Returns the marker string for the item, itemNumber is the item number, can be omitted for unordered numeric items
open func marker(forItemNumber itemNumber: Int) -> String
```

**NSTextList.MarkerFormat Style Reference:**


![](/assets/2981dc0fcd58/1*NvUIidigj-MWzTudBLhHzA.png)

- To enhance recognition, displayed at item list position 8.


**Usage:**
```swift
// Define a NSMutableParagraphStyle
let listLevel1ParagraphStyle = NSMutableParagraphStyle()
// Define List Item style, starting position of items
let textListLevel1 = NSTextList(markerFormat: .decimal, startingItemNumber: 1)
// Assign NSTextList to textLists Array
listLevel1ParagraphStyle.textLists = [textListLevel1]
//
NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 1))\Item One\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle])

// Add nested sub-items:
// Define sub-item List Item style, starting position of items
let textListLevel2 = NSTextList(markerFormat: .circle, startingItemNumber: 1)
// Define sub-item NSMutableParagraphStyle
let listLevel2ParagraphStyle = NSMutableParagraphStyle()
// Assign parent and child NSTextList to textLists Array
listLevel1ParagraphStyle.textLists = [textListLevel1, textListLevel2]

NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 1))\Item One Subitem\n", attributes: [.paragraphStyle: listLevel2ParagraphStyle])

// For sub-items of nested sub-items...
Continue to append NSTextList to the textLists array as needed
```
- Use `\n` to separate each list item
- Use `\tMarker\t`, so that when `attributedString.string` accesses the plain text string, it can also obtain the list result.
- `\tMarker\t` will not be displayed, so any processing done after the marker will not be visible (e.g., adding `.` will not affect the display)


**Usage Issues:**
- Cannot control the left and right spacing of the markers
- Cannot customize the markers; numeric items cannot have `.` -> `1.`
- It has been observed that if the parent item list is unordered (e.g., `.circle`), and the sub-item is an ordered numeric item (e.g., `.decimal`), the `startingItemNumber` setting for the sub-item will be ineffective


What `NSTextList` can do is as described above; in practical product development applications, it is not very user-friendly; the spacing is too wide, and the lack of `.` for numeric items greatly reduces usability. The only method found online is [changing spacing through TextKit NSTextStorage](https://stackoverflow.com/questions/66714650/nstextlist-formatting){:target="_blank"}, which I find too hard-coded and have abandoned; the only advantage is that it allows for easy addition of nested indented sub-item lists through the Append textLists array without needing to calculate complex layout issues.
#### Method (2) Exploring List Indentation Implementation Using NSTextTab


NSTextTab allows us to set the **position** of the `\t` Tab, with a default interval of `28`.

We achieve a list-like effect by configuring `NSMutableParagraphStyle`'s `tabStops` + `headIndent` + `defaultTabInterval`.

![](/assets/2981dc0fcd58/1*bQve8_xkPyT68Q9krtIbsw.jpeg)

```swift
let textListLevel1 = NSTextList(markerFormat: .decimal, startingItemNumber: 1)
let textListLevel2 = NSTextList(markerFormat: .circle, startingItemNumber: 1)
        
let listLevel1ParagraphStyle = NSMutableParagraphStyle()
listLevel1ParagraphStyle.defaultTabInterval = 28
listLevel1ParagraphStyle.headIndent = 29
listLevel1ParagraphStyle.tabStops = [
  NSTextTab(textAlignment: .left, location: 8), // Corresponding settings as shown in the image (1) Location
  NSTextTab(textAlignment: .left, location: 29), // Corresponding settings as shown in the image (2) Location
]
        
let listLevel2ParagraphStyle = NSMutableParagraphStyle()
listLevel2ParagraphStyle.defaultTabInterval = 28
listLevel2ParagraphStyle.headIndent = 44
listLevel2ParagraphStyle.tabStops = [
    NSTextTab(textAlignment: .left, location: 29), // Corresponding settings as shown in the image (3) Location
    NSTextTab(textAlignment: .left, location: 44), // Corresponding settings as shown in the image (4) Location
]
        
let attributedString = NSMutableAttributedString()
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 1)).\tList Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 2)).\tList Level 1 - 2\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 3)).\tList Level 1 - 3\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel2.marker(forItemNumber: 1))\tList Level 2 - 1\n", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel2.marker(forItemNumber: 2))\tList Level 2 - 2 StringStringStringStringStringStringStringStringStringStringStringString\n", attributes: [.paragraphStyle: listLevel2ParagraphStyle]))
attributedString.append(NSAttributedString(string: "\t\(textListLevel1.marker(forItemNumber: 4)).\tList Level 1 - 4\n", attributes: [.paragraphStyle: listLevel1ParagraphStyle]))

textView.attributedText = attributedString
```
- The `tabStops` array corresponds to each `\t` symbol in the text. `NSTextTab` can set the alignment direction and location \( **Note that this is not setting the width, but the position in the text!** \)
- `headIndent` sets the distance from the starting point for the second line, usually set to the location of the second `\t`, so that line breaks can align with the bullet points.
- `defaultTabInterval` sets the default interval for `\t`. If there are other `\t` in the text, they will be spaced according to this setting.
- The `location:` needs to be calculated since NSTextTab specifies direction and position; you must calculate the width of the bullet point \( the number of digits also affects \) + spacing + the indentation of the parent item to achieve the effect shown in the image above.
- Bullet points can be fully customized.
- If the `location` is incorrect or cannot be met, a direct line break will occur.

The above example simplifies the calculation process for understanding how `NSTextTab` formatting works by directly providing the answer. For practical scenarios, you can refer to the complete code below:
```php
let attributedStringFont = UIFont.systemFont(ofSize: UIFont.systemFontSize)
let iterator = ListItemIterator(font: attributedStringFont)
        
//
let listItem = ListItem(type: .decimal, text: "", subItems: [
  ListItem(type: .circle, text: "List Level 1 - 1 StringStringStringStringStringStringStringStringStringStringStringString", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 2", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 3", subItems: [
    ListItem(type: .circle, text: "List Level 2 - 1", subItems: []),
    ListItem(type: .circle, text: "List Level 2 - 2 fafasffsafasfsafasas\tfasfasfasfasfasfasfasfsafsaf", subItems: [])
  ]),
  ListItem(type: .circle, text: "List Level 1 - 4", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 5", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 6", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 7", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 8", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 9", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 10", subItems: []),
  ListItem(type: .circle, text: "List Level 1 - 11", subItems: [])
])
let listItemIndent = ListItemIterator.ListItemIndent(preIndent: 8, sufIndent: 8)
textView.attributedText = iterator.start(item: listItem, type: .decimal, indent: listItemIndent)



//
private extension UIFont {
    func widthOf(string: String) -> CGFloat {
        return (string as NSString).size(withAttributes: [.font: self]).width
    }
}

private struct ListItemIterator {
    let font: UIFont
    
    struct ListItemIndent {
        let preIndent: CGFloat
        let sufIndent: CGFloat
    }
    
    func start(item: ListItem, type: NSTextList.MarkerFormat, indent: ListItemIndent) -> NSAttributedString {
        let textList = NSTextList(markerFormat: type, startingItemNumber: 1)
        return item.subItems.enumerated().reduce(NSMutableAttributedString()) { partialResult, listItem in
            partialResult.append(self.iterator(parentTextList: textList, parentIndent: indent.preIndent, sufIndent: indent.sufIndent, item: listItem.element, itemNumber: listItem.offset + 1))
            return partialResult
        }
    }
    
    private func iterator(parentTextList: NSTextList, parentIndent: CGFloat, sufIndent: CGFloat, item: ListItem, itemNumber:Int) -> NSAttributedString {
        let paragraphStyle = NSMutableParagraphStyle()
        
        
        // e.g. 1.
        var itemSymbol = parentTextList.marker(forItemNumber: itemNumber)
        switch parentTextList.markerFormat {
        case .decimal, .uppercaseAlpha, .uppercaseLatin, .uppercaseRoman, .uppercaseHexadecimal, .lowercaseAlpha, .lowercaseLatin, .lowercaseRoman, .lowercaseHexadecimal:
            itemSymbol += "."
        default:
            break
        }
        
        // width of "1."
        let itemSymbolIndent: CGFloat = ceil(font.widthOf(string: itemSymbol))
        
        let tabStops: [NSTextTab] = [
            .init(textAlignment: .left, location: parentIndent),
            .init(textAlignment: .left, location: parentIndent + itemSymbolIndent + sufIndent)
        ]

        let thisIndent = parentIndent + itemSymbolIndent + sufIndent
        paragraphStyle.headIndent = thisIndent
        paragraphStyle.tabStops = tabStops
        paragraphStyle.defaultTabInterval = 28
        
        let thisTextList = NSTextList(markerFormat: item.type, startingItemNumber: 1)
        //
        return item.subItems.enumerated().reduce(NSMutableAttributedString(string: "\t\(itemSymbol)\t\(item.text)\n", attributes: [.paragraphStyle: paragraphStyle, .font: font])) { partialResult, listItem in
            partialResult.append(self.iterator(parentTextList: thisTextList, parentIndent: thisIndent, sufIndent: sufIndent, item: listItem.element, itemNumber: listItem.offset + 1))
            return partialResult
        }
    }
}

private struct ListItem {
    var type: NSTextList.MarkerFormat
    var text: String
    var subItems: [ListItem]
}
```

```markdown
![](/assets/2981dc0fcd58/1*SdR5-L96sXAyxY4rKtLJBw.png)

- We declare a simple `ListItem` object that encapsulates sublist items, calculating the spacing and content of the item list through recursive combination.
- `NSTextList` only uses the `marker` method to generate list symbols, but it can also be implemented manually without using it.
- To widen the width before and after the item symbol, you can directly achieve this by setting `preIndent` and `sufIndent`.
- Since position calculation is required, `Font` must be used to calculate the width, so the text needs to be set with `.font` to ensure accurate calculations.

### Completion

Initially, I hoped to achieve this directly using NSTextList, but the results and customization level were quite poor; in the end, I had to rely on the rudimentary NSTextTab to control the `\t` position to combine item symbols, which is a bit cumbersome, but the effect perfectly meets the requirements!

> The goal has been achieved, but I still do not fully grasp the knowledge of `NSTextTab` (for example: different directions? Relative positions of Location?); there is really too little official documentation and online resources, so I will study it again when I have the chance.

#### **Download the complete example of this article**

[![](https://opengraph.githubassets.com/d6433a2f9258f56ab38337c4e2b74d6b1ff7aaaa048a4152e8362cb10fe3aa65/zhgchgli0718/NSAttributedString-NSTextList-NSTextTab-Example)](https://github.com/zhgchgli0718/NSAttributedString-NSTextList-NSTextTab-Example){:target="_blank"}

#### Business Promotion

[![](https://repository-images.githubusercontent.com/602927147/57ce75c1-8548-449c-b44a-f4b0451ed5ea)](https://github.com/ZhgChgLi/ZMarkupParser){:target="_blank"}

A small tool that helps you convert HTML Strings into NSAttributedStrings, supporting custom style specifications and custom tag functions.
#### References
- [ObjC String Rendering](https://www.objc.io/issues/9-strings/string-rendering/){:target="_blank"} / [ObjC China — String Rendering](https://store.objccn.io/issue-9-5/){:target="_blank"} 
This article provides a complete application example of NSAttributedString, including the implementation of lists and tables.

If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

_[Post](https://medium.com/zrealm-ios-dev/ios-nsattributedstring-%E6%8E%A2%E7%A9%B6%E4%BD%BF%E7%94%A8-nstextlist-%E6%88%96-nstexttab-%E5%AF%A6%E7%8F%BE%E5%88%97%E8%A1%A8%E7%B8%AE%E6%8E%92-2981dc0fcd58){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
```
