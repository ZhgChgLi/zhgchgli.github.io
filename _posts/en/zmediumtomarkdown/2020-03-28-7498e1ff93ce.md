---
title: "My First Experience with iOS Reverse Engineering"
author: "ZhgChgLi"
date: 2020-03-28T10:24:40.872+0000
last_modified_at: 2023-08-05T17:02:37.650+0000
categories: ["ZRealm Dev."]
tags: ["ios","ios-app-development","hacking","jailbreak","security"]
description: "An exploration process from jailbreaking, extracting iPA files, to UI analysis injection and decompilation"
image:
  path: /assets/7498e1ff93ce/1*6MhDQU2llMbYPb2j5GqxZg.jpeg
render_with_liquid: false
---

### My First Experience with iOS Reverse Engineering

An exploration process from jailbreaking, extracting iPA files, to UI analysis injection and decompilation.

### About Security

The only thing I have done related to security is [**&lt;&lt; Sniffing Transmission Data with Man-in-the-Middle Attack &gt;&gt;**](../46410aaada00/); additionally, following this article, let's assume we encode and encrypt data before transmission and decrypt it within the app upon receipt to prevent man-in-the-middle sniffing; is it still possible for data to be stolen?

> The answer is yes! Even if it hasn't been tested; there is no system that cannot be broken, only a matter of time and cost. When the time and effort spent on cracking exceed the results, it can be considered secure!

#### How?

If we've come this far, how else can we break it? This is the topic I want to document — **"Reverse Engineering"**, cracking open your app to study how you perform encryption and decryption; I have always been somewhat clueless about this field, having only attended two major presentations at iPlayground 2019, where I got a rough idea of the principles and how to implement them. Recently, I had the opportunity to play around with it and share with everyone!

### What Can You Do with Reverse Engineering?
- View the layout and structure of the app's UI
- Access the app's resource directory \.assets/\.plist/icon…
- Modify app functions and repackage it (EX: remove ads)
- Decompile to infer the original code content and obtain business logic information
- Dump \.h header files / keychain contents

### Implementation Environment

**macOS Version:** 10\.15\.3 Catalina  
**iOS Version:** iPhone 6 \(iOS 12\.4\.4 / jailbroken\) **\*Required**  
**Cydia:** Open SSH  
#### Jailbreaking

Any version of iOS or iPhone can be used, as long as it is a device that can be jailbroken. It is recommended to use an older phone or a development device to avoid unnecessary risks; you can refer to [Mr. Mad's Jailbreak Tutorial](https://mrmad.com.tw/category/jb/jailbreak){:target="_blank"} based on your phone and iOS version. If necessary, you may need to [downgrade iOS](https://mrmad.com.tw/new-ios-downgrade-old-ios){:target="_blank"} ( [Check Certification Status](https://mrmad.com.tw/ios-firmware){:target="_blank"} ) before jailbreaking.

I used my old iPhone 6 for testing, which had originally been upgraded to iOS 12\.4\.5, but I found that jailbreaking 12\.4\.5 was unsuccessful. Fortunately, I downgraded back to 12\.4\.4 and successfully jailbroke it using [checkra1n](https://checkra.in/){:target="_blank"}!

The steps are few and not difficult; it just requires some waiting time!

**Here’s a silly mistake I made:** After downloading the old IPSW file, I connected the phone to my Mac and directly used Finder (since macOS 10\.5, iTunes is no longer available) to select the phone under Locations. Once the phone information screen appeared, **hold the "Option" key and then click "Restore iPhone"** to bring up the IPSW file selection window, where you can choose the old IPSW file you just downloaded to complete the downgrade.

![](/assets/7498e1ff93ce/1*jlxQNpYPXJ2yrNoYM_Sgwg.png)

> I originally foolishly clicked Restore iPhone directly... which would just waste time by reinstalling the latest version again...

### Using Lookin Tool to View Others' APP UI Layout

Let's start with something interesting as an appetizer, using tools along with a jailbroken phone to see how others' apps are laid out.

Viewing tools: One is the well-known [Reveal](https://revealapp.com/){:target="_blank"} (more complete features, costs about $60 USD / trial available), and the other is the free open-source tool [lookin](https://lookin.work/){:target="_blank"} developed by Tencent's QMUI Team; here, I will use lookin as a demonstration, as Reveal is quite similar.

> _If you don't have a jailbroken phone, that's okay. This tool is mainly for use in development projects to view Debug layouts (replacing Xcode's basic inspector). **It can also be used in regular development!**_

> _**You only need a jailbroken phone to view other people's apps.**_

#### If you want to view your own project…

You can choose to install via [CocoaPods](https://lookin.work/faq/integration-cocoapods/){:target="_blank"}, [insert breakpoints](https://lookin.work/faq/integration-breakpoint/){:target="_blank"} (only supports simulators), [manually import Frameworks into the project](https://lookin.work/faq/integration-sourcecode/){:target="_blank"}, or [set up manually](https://lookin.work/faq/integration-manual/){:target="_blank"}—four methods.

After building and running the project, you can **select the APP screen on the Lookin tool** \-&gt; **view the layout structure**.

![](/assets/7498e1ff93ce/1*DZJ7-gFs8hf9Dxl5FAjHIQ.png)

#### If you want to view someone else's APP…

![](/assets/7498e1ff93ce/1*jJ_1bIAPxmqHzu8dAtyYSw.jpeg)

**Step 1.** Open “ **Cydia** ” on the jailbroken phone \-&gt; search for “ **LookinLoader** ” \-&gt; “ **Install** ” \-&gt; return to the phone “ **Settings** ” \-&gt; “ **Lookin** ” \-&gt; “ **Enabled Applications** ” \-&gt; **enable the APP you want to view**.

**Step 2.** Use a cable to **connect the phone to the Mac** \-&gt; **open the APP you want to view** \-&gt; return to the computer, **select the APP screen on the Lookin tool** \-&gt; you can **view the layout structure**.

#### Lookin View Layout Structure

![Facebook Login Screen Layout Structure](/assets/7498e1ff93ce/1*qqLRdYwVBbLXj1Rn3iEMEw.png)

Facebook login screen layout structure

You can view the View Hierarchy in the left sidebar and dynamically modify the selected objects in the right sidebar.

![Originally "Create New Account" changed to "Hahaha"](/assets/7498e1ff93ce/1*72YKbJleXjvirZzdvIRSIw.jpeg)

Originally "Create New Account" changed to "Hahaha"

Modifications to objects will also be displayed in real-time on the mobile APP, as shown above.

Just like the "F12" developer tools in web pages, all modifications only affect the View and will not impact the actual data; it is mainly used for Debugging, but can also be used to change values, take screenshots, and then trick friends XD.

#### Use [Reveal](https://revealapp.com/){:target="_blank"} tool to view APP UI layout structure

![](/assets/7498e1ff93ce/1*vkzR6_y3Y4qCgoVM150Ozg.png)

Although Reveal requires payment to use, I personally prefer Reveal; it provides more detailed information in the structure display, and the information fields on the right are almost equivalent to the XCode development environment, allowing for real-time adjustments. Additionally, it will prompt Constraint Errors, which is very helpful for UI layout corrections!

**These two tools are very helpful in daily development of your own APP!**

> _After understanding the process environment and interesting parts, let's get to the main topic!_

> \*The following requires a jailbroken phone.

### Extract APP .ipa file & Decrypt

All apps installed from the App Store have their .ipa files protected by [FairPlay DRM](https://zh.wikipedia.org/wiki/Ipa%E6%96%87%E4%BB%B6){:target="_blank"}, commonly known as shell protection. Conversely, removing the protection is called "decrypting." Therefore, simply extracting the .ipa from the App Store is meaningless and cannot be used.

_\*Another tool, APP Configurator 2, can only extract protected files, which is pointless to elaborate on. Friends interested in using this tool can [click here](https://blog.csdn.net/aa464971/article/details/87955711){:target="_blank"} for the tutorial._

#### Use tools + jailbroken phone to extract the original .ipa file after decryption:


Regarding the tools, I initially used [Clutch](https://github.com/KJCracks/Clutch/releases){:target="_blank"}, but no matter how I tried, it showed FAILED. After checking the project's issues, I found that many people had the same situation; it seems that this tool can no longer be used on iOS ≥ 12. Additionally, there is an older tool called [dumpdecrypted](https://juejin.im/post/5d31e948f265da1bd2612788){:target="_blank"}, but I haven't researched it.

Here, I used the Python tool [frida-ios-dump](https://github.com/AloneMonkey/frida-ios-dump){:target="_blank"} for dynamic dumping, which is very convenient to use!

**First, let's prepare the environment on Mac:**
1. Mac comes with Python 2.7 by default, and this tool supports Python 2.X/3.X, so there's no need to install Python separately; however, I used Python 3.X for the operation. If you encounter issues with Python 2.X, you might want to try [installing and using Python 3](https://stringpiggy.hpd.io/mac-osx-python3-multiple-pyenv-install/){:target="_blank"}!
2. Install [pip](https://pip.pypa.io/en/stable/installing/){:target="_blank"} (the package manager for Python).
3. Use pip to install [frida](https://frida.re/){:target="_blank"}:
`sudo pip install frida --upgrade --ignore-installed six` \(python 2.X\)  
`sudo pip3 install frida --upgrade --ignore-installed six` \(python 3.X\)
4. In the Terminal, type `frida-ps`. If there are no error messages, it means the installation was successful!
5. Clone the [AloneMonkey/frida-ios-dump](https://github.com/AloneMonkey/frida-ios-dump){:target="_blank"} project.
6. Enter the project and open the dump.py file with a text editor.
7. Check if the SSH connection settings are correct (the default settings do not need to be changed):  
User = ‘root’  
Password = ‘alpine’  
Host = ‘localhost’  
Port = 2222  

**Environment on the jailbroken phone:**
1. Install Open SSH: Cydia → Search → Open SSH → Install.
2. Add the Frida source: Cydia → Sources → Tap "Edit" in the top right → Tap "Add" in the top left → [https://build\.frida\.re](https://build.frida.re/){:target="_blank"}.
3. Install Frida: Cydia → Search → Frida → Install the corresponding tool based on your phone's processor version (EX: I have an iPhone 6 A11, so I installed `Frida for pre-A12 devices`).

**Once the environment is set up, let's get to work:**

1. Connect the phone to the computer using USB.
2. Open a Terminal on Mac and type `iproxy 2222 22` to start the server.
3. Ensure that the phone and computer are on the same network (EX: connected to the same WiFi).
4. Open another Terminal and type `ssh root@127\.0\.0\.1`, then enter the SSH password (the default is `alpine`).

![](/assets/7498e1ff93ce/1*3X-Wgh0XuNwslF4nSYAGlA.png)

5. Open another Terminal to execute the dumping command, and `cd` to the cloned `/frida-ios-dump` directory.

Type `dump.py -l` to list the apps installed/running on the phone.

![](/assets/7498e1ff93ce/1*FSr_QMRFqMRv9OHjhDDIKQ.png)

6. Find the name or Bundle ID of the app you want to dump, and type:

`dump.py APP_NAME_OR_BUNDLE_ID -o OUTPUT_PATH/OUTPUT_FILENAME.ipa`

Make sure to specify the **output path/filename**, as the default output path will be `/opt/dump/frida-ios-dump/`. Since I don't want to move it to `/opt/dump`, I need to specify the output path to avoid permission errors.

```markdown
7. After a successful output, you can obtain the compiled \.ipa file!

![](/assets/7498e1ff93ce/1*T49RwSRIcgO26pihxEu3BQ.png)

- The phone must be unlocked to use the tool.
- If there are connection errors, such as reset by peer, you can try unplugging and replugging the USB connection or restarting iproxy.

7. Rename the \.ipa file directly to a \.zip file, then right-click to extract the archive.

You will see `/Payload/APP Name.app`
### With the original APP file, we can…
#### 1. Extract the APP's resource directory

Right-click on APP Name\.app → "Show Package Contents" to see the APP's resource directory.

![](/assets/7498e1ff93ce/1*YtQO1injuB8eH2wXQJ2ktw.png)

#### 2. Use class-dump to extract APP \.h header file information

Use the class-dump tool to export the entire APP (including Framework) \.h header file information (only for Objective-C; it will not work for Swift projects).

[_nygard/class-dump_](https://github.com/nygard/class-dump){:target="_blank"} _I tried using this tool but kept failing; in the end, I successfully used the class-dump tool modified by [AloneMonkey](https://github.com/AloneMonkey){:target="_blank"} / [MonkeyDev](https://github.com/AloneMonkey/MonkeyDev){:target="_blank"}._
- Download the [MonkeyDev/bin/class-dump](https://github.com/AloneMonkey/MonkeyDev/blob/master/bin/class-dump){:target="_blank"} tool directly from here.
- Open Terminal and use:
`./class-dump -H APP path/APP Name.app -o export target path`

![](/assets/7498e1ff93ce/1*crdnoYeF6fnSqm79wZNFiw.png)

After a successful dump, you will obtain the entire APP's \.h information.
#### 4. Finally, the most challenging part — Decompilation

You can use [IDA](https://www.hex-rays.com/products/ida/support/links.shtml){:target="_blank"} and [Hopper](https://www.hopperapp.com/){:target="_blank"} decompilation tools for analysis. Both are paid tools, and [Hopper](https://www.hopperapp.com/){:target="_blank"} offers a free trial (30 minutes each time).

We can drag the obtained APP Name\.app file directly into Hopper to start the analysis.

![](/assets/7498e1ff93ce/1*8LrtLlE2adXLZi5-MDQ20A.png)

However, I stopped here because from this point on, you need to study machine code and deduce methods based on class-dump results, etc.; it requires very deep skills!

After breaking through decompilation, you can modify the operation and repackage it into a new APP.

![Image from One Piece](/assets/7498e1ff93ce/1*6MhDQU2llMbYPb2j5GqxZg.jpeg)

Image from One Piece
### Other Tools for Reverse Engineering

**1. [Use MITM Proxy free tool to sniff API network request information](../46410aaada00/)**

![](/assets/7498e1ff93ce/1*qSYBzTz0nW0LoJ4HkiDPfA.png)

> [&gt;&gt; The APP uses HTTPS transmission, but the data was still stolen.](../46410aaada00/)

**2. Cycript (with jailbroken phone) dynamic analysis/injection tool:**
- Open "Cydia" on the jailbroken phone → Search for "Cycript" → "Install"
- Open a Terminal on the computer and use Open SSH to connect to the phone, `ssh root@phone IP` (default is `alpine`)
- Open the target APP (keep the APP in the foreground)
- In the Terminal, enter `ps -e | grep APP Bundle ID` to find the running APP Process ID
- Use `cycript -p Process ID` to inject the tool into the running APP
```

You can use Objective-C/Javascript for debugging control.

![](/assets/7498e1ff93ce/1*6JRXWaSGNIvqUpKE_tbB1A.png)

**For Example:**
```
cy# alert = [[UIAlertView alloc] initWithTitle:@"HIHI" message:@"ZhgChg.li" delegate:nil cancelButtonTitle:@"Cancel" otherButtonTitles:nl]
cy# [alert show]
```

![Injecting a UIAlertViewController…](/assets/7498e1ff93ce/1*SFB5gBgYGGcAb93VioIUrA.png)

Injecting a UIAlertViewController…
- **chose\( \)** : Get target
- **UIApp\.keyWindow\.recursiveDescription\( \) \.toString\( \)** : Display view hierarchy structure information
- **new Instance\(memory location\):** Get object
- **exit\(0\)** : Exit

For detailed operations, please refer to [this article](https://sevencho.github.io/archives/c12f47b1.html){:target="_blank"}.

**3\. [Lookin](https://lookin.work/){:target="_blank"} / [Reveal](https://revealapp.com/){:target="_blank"} UI layout tools**

As mentioned earlier, I recommend it again; it is very useful in daily development of your own projects, and I suggest purchasing and using Reveal.

**4\. [MonkeyDev integration tool](http://huni.me/2018/08/12/MonkeyDev/){:target="_blank"} allows dynamic injection to modify the APP and repackage it into a new APP.**

**5\. [ptoomey3](https://github.com/ptoomey3){:target="_blank"} / [Keychain-Dumper](https://github.com/ptoomey3/Keychain-Dumper){:target="_blank"} to export KeyChain contents.**

For detailed operations, please refer to [this article](https://sevencho.github.io/archives/65ed9c65.html){:target="_blank"}, but I haven't had success; it seems to have failed after iOS ≥ 12 according to project issues.

### Summary

This field is a huge pit that requires a lot of technical knowledge to master; this article only provides a superficial "experience" of what reverse engineering feels like, and I apologize for any shortcomings! **For academic research only, do not engage in malicious activities**; I personally find the entire process and tools quite interesting, and it gives me a better understanding of APP security!

If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

_[Post](https://medium.com/zrealm-ios-dev/ios-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%88%9D%E9%AB%94%E9%A9%97-7498e1ff93ce){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
