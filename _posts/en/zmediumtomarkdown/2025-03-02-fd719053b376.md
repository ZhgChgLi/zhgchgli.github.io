---
title: "Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution"
author: "ZhgChgLi"
date: 2025-03-02T12:21:31.452+0000
last_modified_at: 2025-03-09T07:59:17.952+0000
categories: ["ZRealm Dev."]
tags: ["ios-app-development","xcode","swift","tuist","xcodegen"]
description: "The occupational hazards of Apple developers using virtual directories in Xcode early on, leading to a chaotic directory structure that is difficult to integrate with modern tools like XcodeGen and Tuist."
image:
  path: /assets/fd719053b376/1*fYk27y-BjMBjBFnwDfhxlw.jpeg
render_with_liquid: false
---

### Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution

The occupational hazards of Apple developers using virtual directories in Xcode early on have led to a chaotic directory structure that is difficult to integrate with modern tools like XcodeGen and Tuist.

![Photo by [Saad Salim](https://unsplash.com/@saadx?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/fd719053b376/1*fYk27y-BjMBjBFnwDfhxlw.jpeg)

Photo by [Saad Salim](https://unsplash.com/@saadx?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}
#### English version of this post:
#### [Exploring the Long\-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution](../fd719053b376/)
### Background

As team sizes and projects grow, the size of XCode project files (\ .xcodeproj\) gradually increases, potentially reaching hundreds of thousands or even millions of lines depending on project complexity. With multiple developers working in parallel, conflicts are inevitable; **once conflicts arise in the XcodeProj file, they are as difficult to resolve as conflicts in Storyboard / \.xib files**. Since these are purely descriptive files, it‚Äôs easy to accidentally remove files added by others or to have references to files that have been removed reappear during conflict resolution.

Another issue is that as modularization progresses, the process of creating and managing modules within the XCode project file (\ .xcodeproj\) is very unfriendly. Changes to modules can only be viewed through the Diff of the XCode project file, which is not conducive to the team's move towards modularization.

> _If the goal is simply to prevent conflicts, you can easily implement [File Sorting](https://github.com/chiahsien/sort-Xcode-project-file){:target="_blank"} in a pre-commit hook. There are many existing scripts available on GitHub that you can refer to for setup._ 

#### [XCFolder](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

[![](https://repository-images.githubusercontent.com/941421589/27855f06-b938-4458-a20f-3e317b4283b7)](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

> **_To make a long story short_**, I developed a tool that can help you convert the early virtual directories in XCode into actual directories based on the directory structure within XCode. 

![](/assets/fd719053b376/1*eFNN12WDaAk6mr49OzmC_g.jpeg)

> _Scroll down to continue the story‚Ä¶_ 

#### Modernizing Xcode Project File Management

The thinking here is similar to how we discourage the use of Storyboard or \.xib files during collaborative development; **we need a well-maintained, iterative, and code-reviewable interface to manage the "XCode project file"**. Currently, there are two mainstream free tools available:
- [XCodeGen](https://github.com/yonaskolb/XcodeGen){:target="_blank"}: An established tool that uses YAML to define the contents of the XCode project, which is then converted into an XCode project file (\ .xcodeproj\). It has a lower barrier to entry and learning cost due to its direct use of YAML for structure definition, but it is weaker in modularization and dependency management features, and has limited dynamic configuration capabilities.
- [Tuist](https://github.com/tuist/tuist){:target="_blank"}: A newer tool that uses Swift DSL to define the contents of the XCode project, which is then converted into an XCode project file (\ .xcodeproj\). It is more stable and versatile, with built-in modularization and dependency management features, but has a higher learning and implementation threshold.

**Regardless of which tool we choose, our core workflow will become:**
1. **Create an XCode project configuration file (XCodeGen `project.yaml` or Tuist `Project.swift`)**
2. Integrate XCodeGen or Tuist into the developer and CI/CD server environments
3. **Use XCodeGen or Tuist to generate the `.xcodeproj` XCode project file from the configuration file**
4. Add the `/*.xcodeproj` directory files to `.gitignore`
5. Adjust the developer workflow so that when switching branches, the developer needs to run XCodeGen or Tuist to generate the `.xcodeproj` XCode project file from the configuration file
6. Adjust the CI/CD process to run XCodeGen or Tuist to generate the `.xcodeproj` XCode project file from the configuration file
7. Done

The `.xcodeproj` XCode project file is generated by XCodeGen or Tuist based on the YAML or Swift DSL configuration file. The same configuration file and tool version will produce the same result; therefore, we no longer need to commit the `.xcodeproj` XCode project file to Git, ensuring that there will be no more conflicts with the `.xcodeproj` files in the future. Changes in project builds and modifications to modules will be made in the defined configuration file, allowing for easy iteration and code review since it is written in YAML or Swift.

**Tuist Swift Example:** `Project.swift`
```php
import ProjectDescription

let project = Project(
    name: "MyApp",
    targets: [
        Target(
            name: "MyApp",
            platform: .iOS,
            product: .app,
            bundleId: "com.example.myapp",
            deploymentTarget: .iOS(targetVersion: "15.0", devices: [.iphone, .ipad]),
            infoPlist: .default,
            sources: ["Sources/**"],
            resources: ["Resources/**"],
            dependencies: []
        ),
        Target(
            name: "MyAppTests",
            platform: .iOS,
            product: .unitTests,
            bundleId: "com.example.myapp.tests",
            deploymentTarget: .iOS(targetVersion: "15.0", devices: [.iphone, .ipad]),
            infoPlist: .default,
            sources: ["Tests/**"],
            dependencies: [.target(name: "MyApp")]
        )
    ]
)
```

**XCodeGen YAML Example:** `project.yaml`
```yaml
name: MyApp
options:
  bundleIdPrefix: com.example
  deploymentTarget:
    iOS: '15.0'

targets:
  MyApp:
    type: application
    platform: iOS
    sources: [Sources]
    resources: [Resources]
    info:
      path: Info.plist
      properties:
        UILaunchScreen: {}
    dependencies:
      - framework: Vendor/SomeFramework.framework
      - sdk: UIKit.framework
      - package: Alamofire

  MyAppTests:
    type: bundle.unit-test
    platform: iOS
    sources: [Tests]
    dependencies:
      - target: MyApp
```
#### File Directory Structure

XCodeGen or Tuist will generate the directory structure of the XCode project file (\ .xcodeproj\) based on the actual directory and location of the files; **the actual directory will be the directory of the XCode project files**.

![](/assets/fd719053b376/1*rYgdRpEDwRiZoMLzM0WpSQ.png)

Thus, the actual directory location of the files is very important, as we will directly use it as the directory for the XCode project files.

In modern XCode / XCode projects, it is quite common for these two directory locations to be the same, but this is the issue that this article aims to explore.
### Early Use of Virtual Directories in Xcode

In earlier versions of XCode, right-clicking on the file directory and selecting "New Group" would not create an actual directory; files would be placed in the project root directory and referenced in the `.xcodeproj` XCode project file. Therefore, the directory was only visible in the XCode project file and did not actually exist.

![](/assets/fd719053b376/1*LPuedcbhL4OUJuLcO0xSPw.png)

As time has passed, Apple has gradually phased out this strange design in XCode. Later versions of XCode added the option "New Group with Folder," which would create an actual directory by default. To avoid creating a directory, one would have to select "New Group without Folder." Now, **in the current version (XCode 16), there is only "New Group" plus automatic generation of the XCode project file directory based on actual directories**.
#### Problems with Virtual Directories
- **Cannot use XCodeGen or Tuist, as both require actual directory locations to generate the XCode project file (\ .xcodeproj\).**
- Difficulties with code review: The directory structure is not visible in the Git Web GUI, and all files appear flattened.
- Challenges with DevOps and third-party tool integration: For example, Sentry and GitHub can issue alerts or auto-assign based on directory structure; without directories, files cannot be configured.
- The project directory structure becomes extremely complex, with a plethora of files flattened in the root directory.

> _For a long-standing project that did not recognize the issues with virtual directories early on, there are over 3,000 virtual directory files. If one were to manually map and move them, they might as well quit and sell pastries afterward; this truly qualifies as an [**Apple Developer Occupational Hazard**](https://x.com/1star_therapist){:target="_blank"} **üòî**._ 

### Converting Xcode Project Virtual Directories to Actual Directories

For all the reasons mentioned above, we urgently need to convert the virtual directories in the XCode project to actual directories; otherwise, the subsequent modernization of the project and more efficient development processes cannot proceed.
#### ‚ùå Xcode 16 "Convert to folder" Option

![XCode 16](/assets/fd719053b376/1*FlhWWH5Qz4aLfB4hYVUgNA.png)

When XCode 16 was first released, I noticed this new menu option. My initial expectation was that it could automatically convert virtual directory files into actual directories.

However, this was not the case. It requires you to first create the directories and place the files in the corresponding actual locations. Clicking "Convert to folder" will change the XCode project directory settings to " `PBXFileSystemSynchronizedRootGroup`." To be honest, **this is not useful for conversion; it is more about upgrading to a new directory setting method after conversion.**

If the directories are not created and the files are not placed correctly, clicking "Convert to folder" will result in the following error:
```
Missing Associated Folder
Each group must have an associated folder. The following groups are not associated with a folder:
‚Ä¢ xxxx
Use the file inspector to associate a folder with each group, or delete the groups after moving their content to another group.
```
#### ü´• Open Source Projects [venmo](https://github.com/venmo){:target="_blank"} / [synx](https://github.com/venmo/synx){:target="_blank"}

[![](https://opengraph.githubassets.com/21a6a82c910b246448d4f8c4a75a2213626f31d9743d5600022620f8f2318f18/venmo/synx)](https://github.com/venmo/synx){:target="_blank"}

After searching on GitHub for a long time, I only found this open-source tool written in Ruby for converting virtual directories to actual directories. It did work when I ran it, but due to its age (it hasn't been updated in about 10 years), many files still needed to be manually mapped and moved, making it impossible to convert completely, so I abandoned it.

> _However, I am still grateful for the inspiration from this open-source project, which led me to consider developing my own conversion tool._ 

#### ‚úÖ My Open Source Project [ZhgChgLi](https://github.com/ZhgChgLi){:target="_blank"} / [XCFolder](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

[![](https://repository-images.githubusercontent.com/941421589/27855f06-b938-4458-a20f-3e317b4283b7)](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

This is a command-line tool developed purely in Swift, based on [XcodeProj](https://github.com/tuist/XcodeProj){:target="_blank"} to parse the `.xcodeproj` XCode project file, read all files to obtain their respective directories, parse the directories, convert virtual directories into actual directories, move the files to the correct locations, and finally adjust the directory settings in the `.xcodeproj` XCode project file to complete the conversion.

![](/assets/fd719053b376/1*eFNN12WDaAk6mr49OzmC_g.jpeg)

**Usage**
```bash
git clone https://github.com/ZhgChgLi/XCFolder.git
cd ./XCFolder
swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml
```

**For Example:**
```objectivec
swift run XCFolder ./TestProject/DCDeviceTest.xcodeproj ./Configuration.yaml
```

**CI/CD Mode (Non-Interactive Mode):**
```swift
swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml --is-non-interactive-mode
```

The `Configuration.yaml` can be set with desired execution parameters:
```shell
# Directories to ignore, will not be parsed or converted
ignorePaths:
- "Pods"
- "Frameworks"
- "Products"

# File types to ignore, will not be converted or moved
ignoreFileTypes:
- "wrapper.framework" # Frameworks
- "wrapper.pb-project" # Xcode project files
#- "wrapper.application" # Applications
#- "wrapper.cfbundle" # Bundles
#- "wrapper.plug-in" # Plug-ins
#- "wrapper.xpc-service" # XPC services
#- "wrapper.xctest" # XCTest bundles
#- "wrapper.app-extension" # App extensions

# Only create directories and move files, do not adjust the .xcodeproj XCode project file directory settings
moveFileOnly: false

# Prefer using git mv command to move files
gitMove: true
```

‚ö†Ô∏è **Before running, please note:**
- Ensure that Git has no uncommitted changes, as the script may corrupt your project directory if there are errors (the script will check for uncommitted changes and throw an error `‚ùå Error: There are uncommitted changes in the repository`).
- By default, it will prioritize using the `git mv` command to move files to ensure complete git file log records; if the move fails or if it is not a Git project, it will use FileSystem Move to move the files.

**Just wait for the execution to complete:**

![](/assets/fd719053b376/1*IL_-Ht1SH5ZCYogZHXULbQ.png)

![](/assets/fd719053b376/1*8JNbDbR7pvZLhcoQLU_B6A.png)

‚ö†Ô∏è **After execution, please note:**
- Check if there are any missing (red) files in the project directory. If there are few, you can manually correct them; if there are many, please verify that the `ignorePaths` and `ignoreFileTypes` settings in `Configuration.yaml` are correct, or [**create an Issue**](https://github.com/ZhgChgLi/XCFolder/issues){:target="_blank"} to let me know.
- Check the relevant paths in Build Settings, e.g., `LIBRARY_SEARCH_PATHS`, to see if manual adjustments are needed.
- It is recommended to Clean & Build to check.
- **If you don't want to deal with the current `.xcodeproj` XCode project file, you can also start using XCodeGen or Tuist directly to regenerate the directory files.**

**Modifying the Script:**

You can directly click `./Package.swift` to open the project and adjust the script content.
#### Other Development Notes
- Thanks to [XcodeProj](https://github.com/tuist/XcodeProj){:target="_blank"}, we can easily access the contents of the `.xcodeproj` **XCode project file** using Swift objects.
- The development follows a Clean Architecture structure.
- If a PBXGroup setting has no path and only a name, it is a virtual directory; otherwise, it is an actual directory.
- The new directory setting `PBXFileSystemSynchronizedRootGroup` in XCode 16 only requires declaring the main directory, and it will automatically parse from the actual directory without needing to declare every directory and file in the `.xcodeproj` XCode project file.
- Developing command-line tools using SPM (Package.swift) is really convenient!

If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.


_[Post](https://medium.com/zrealm-ios-dev/xcode-%E8%99%9B%E6%93%AC%E7%9B%AE%E9%8C%84%E8%90%AC%E5%B9%B4%E5%95%8F%E9%A1%8C%E6%8E%A2%E7%A9%B6%E8%88%87%E6%88%91%E7%9A%84%E9%96%8B%E6%BA%90%E5%B7%A5%E5%85%B7%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88-fd719053b376){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._