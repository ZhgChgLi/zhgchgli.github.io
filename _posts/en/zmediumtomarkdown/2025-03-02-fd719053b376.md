---
title: "Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution"
author: "ZhgChgLi"
date: 2025-03-02T12:21:31.452+0000
last_modified_at: 2025-03-05T00:25:41.462+0000
categories: ["ZRealm Dev."]
tags: ["ios-app-development","xcode","swift","tuist","xcodegen"]
description: "The occupational hazards of Apple developers using virtual directories in Xcode early on, leading to a chaotic directory structure that is difficult to integrate with modern tools like XcodeGen and Tuist."
image:
  path: /assets/fd719053b376/1*fYk27y-BjMBjBFnwDfhxlw.jpeg
render_with_liquid: false
---

### Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution

The occupational hazards of Apple developers using virtual directories in Xcode early on, leading to a chaotic directory structure that is difficult to integrate with modern tools like XcodeGen and Tuist.



![Photo by [Saad Salim](https://unsplash.com/@saadx?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/fd719053b376/1*fYk27y-BjMBjBFnwDfhxlw.jpeg)

Photo by [Saad Salim](https://unsplash.com/@saadx?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}
#### English version of this post
#### [Exploring the Long\-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution](https://zhgchg.li/posts/fd719053b376_en/){:target="_blank"}
### Background

As the team size and project scale grow, the size of the XCode project file \( \.xcodeproj\) gradually increases, potentially reaching hundreds of thousands or even millions of lines depending on the complexity of the project. Coupled with multiple developers working in parallel, conflicts are inevitable; **once conflicts arise in the XcodeProj file, they are as difficult to resolve as conflicts in Storyboard / \.xib files**. Since these are purely descriptive files, it is easy to accidentally remove files added by others or have references to files removed by others reappear during conflict resolution.

Another issue is that as modularization progresses, the process of creating and managing modules within the XCode project file \( \.xcodeproj\) is very unfriendly. Changes to modules can only be viewed through the Diff of the XCode project file, which is not conducive to the team's move towards modularization.


> _If the goal is simply to prevent conflicts, you can easily implement [File Sorting](https://github.com/chiahsien/sort-Xcode-project-file){:target="_blank"} in pre-commit. There are many existing scripts available on GitHub that you can refer to for setup._ 




#### [XCFolder](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}


[![](https://repository-images.githubusercontent.com/941421589/27855f06-b938-4458-a20f-3e317b4283b7)](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}



> **_To make a long story short_**, _I developed a tool that can help you convert the early virtual directories of XCode into physical directories according to the directory structure in XCode._ 






![](/assets/fd719053b376/1*eFNN12WDaAk6mr49OzmC_g.jpeg)



> _Scroll down to continue the story‚Ä¶_ 




#### Modernizing Xcode Project File Management

The specific thinking is similar to how we discourage the use of Storyboard or \.xib in multi-developer environments; **we need a well-maintained, iterative, and code-reviewable interface to manage the "XCode project file"**. Currently, there are two mainstream free tools available in the market:
- [XCodeGen](https://github.com/yonaskolb/XcodeGen){:target="_blank"}: An established tool that uses YAML to define the contents of the XCode project, which is then converted into an XCode project file \( \.xcodeproj\). It directly uses YAML to define the structure, making it relatively easy to adopt and learn, but it has weaker modularization and dependency management features, and limited dynamic YAML configuration.
- [Tuist](https://github.com/tuist/tuist){:target="_blank"}: A newer tool that uses Swift DSL to define the contents of the XCode project, which is then converted into an XCode project file \( \.xcodeproj\). It is more stable and versatile, with built-in modularization and dependency management features, but has a higher learning and adoption threshold.

**Regardless of the framework, our core workflow will be:**
1. **Create an XCode project configuration file \(XCodeGen `project.yaml` or Tuist `Project.swift`\)**
2. Add XCodeGen or Tuist to the developer and CI/CD server environment
3. **Use XCodeGen or Tuist to generate the `.xcodeproj` XCode project file from the configuration file**
4. Add `/*.xcodeproj` directory files to `.gitignore`
5. Adjust the developer workflow, requiring XCodeGen or Tuist to generate the `.xcodeproj` XCode project file when switching branches
6. Adjust the CI/CD workflow, requiring XCodeGen or Tuist to generate the `.xcodeproj` XCode project file
7. Complete

The `.xcodeproj` XCode project file is generated by XCodeGen or Tuist based on the YAML or Swift DSL configuration file. The same configuration file and tool version will produce the same result; therefore, we do not need to upload the `.xcodeproj` XCode project file to Git, ensuring that there will be no future conflicts with `.xcodeproj` files. Changes in project builds and modifications to modules will be adjusted in the defined configuration file, and since it is written in YAML or Swift, we can easily iterate and conduct code reviews.

**Tuist Swift Example:** `Project.swift`
```php
import ProjectDescription

let project = Project(
    name: "MyApp",
    targets: [
        Target(
            name: "MyApp",
            platform: .iOS,
            product: .app,
            bundleId: "com.example.myapp",
            deploymentTarget: .iOS(targetVersion: "15.0", devices: [.iphone, .ipad]),
            infoPlist: .default,
            sources: ["Sources/**"],
            resources: ["Resources/**"],
            dependencies: []
        ),
        Target(
            name: "MyAppTests",
            platform: .iOS,
            product: .unitTests,
            bundleId: "com.example.myapp.tests",
            deploymentTarget: .iOS(targetVersion: "15.0", devices: [.iphone, .ipad]),
            infoPlist: .default,
            sources: ["Tests/**"],
            dependencies: [.target(name: "MyApp")]
        )
    ]
)
```

**XCodeGen YAML Example:** `project.yaml`
```yaml
name: MyApp
options:
  bundleIdPrefix: com.example
  deploymentTarget:
    iOS: '15.0'

targets:
  MyApp:
    type: application
    platform: iOS
    sources: [Sources]
    resources: [Resources]
    info:
      path: Info.plist
      properties:
        UILaunchScreen: {}
    dependencies:
      - framework: Vendor/SomeFramework.framework
      - sdk: UIKit.framework
      - package: Alamofire

  MyAppTests:
    type: bundle.unit-test
    platform: iOS
    sources: [Tests]
    dependencies:
      - target: MyApp
```
#### File Directory Structure


XCodeGen or Tuist generates the directory structure of the XCode project file \( \.xcodeproj\) based on the actual directory and location of the files, **where the actual directory is the directory of the XCode project file**.

![](/assets/fd719053b376/1*rYgdRpEDwRiZoMLzM0WpSQ.png)

Therefore, the actual directory location of the files is very important, as we will directly use it as the directory for the XCode project file.

In modern XCode / XCode projects, it is quite common for these two directories to be in the same location, but this topic is what this article aims to explore.
### Early Xcode Used Virtual Directories

In early versions of XCode, right-clicking on the file directory and selecting "New Group" would not create an actual directory; the files would be placed in the project root directory and referenced in the `.xcodeproj` XCode project file. Thus, the directory was only visible in the XCode project file and did not actually exist.

![](/assets/fd719053b376/1*LPuedcbhL4OUJuLcO0xSPw.png)

As time evolved, Apple gradually phased out this peculiar design in XCode. Later versions of XCode introduced "New Group with Folder," which by default would create a physical directory. To avoid creating one, you would need to select "New Group without Folder." **Now \(XCode 16\), it only has "New Group" + automatically generates the XCode project file directory based on the actual directory.**
#### Issues with Virtual Directories
- **Cannot use XCodeGen or Tuist, as both require a physical directory location to generate the XCode project file \( \.xcodeproj\).**
- Code Review difficulties: The directory structure is not visible on the Git Web GUI, and all files are flattened.
- DevOps and third-party tool integration difficulties: For example, Sentry and GitHub can issue alerts or Auto-Assigners based on the directory, but without directories, only files cannot be configured.
- The project directory structure is extremely complex, with a large number of files flattened in the root directory.

> _For a project that is quite old and did not realize the issue of virtual directories early on, there are over 3,000 virtual directory files. If one were to manually move them, they might as well resign and sell rice cakes afterward; this can truly be termed as a "[**Apple Developer Occupational Hazard**](https://x.com/1star_therapist){:target="_blank"} **üòî**."_

### Converting Xcode Project Virtual Directories to Physical Directories

For the reasons mentioned above, we urgently need to convert the virtual directories of the XCode project into physical directories; otherwise, subsequent project modernization and more efficient development processes cannot be advanced.
#### ‚ùå Xcode 16 "Convert to folder" Option

![XCode 16](/assets/fd719053b376/1*FlhWWH5Qz4aLfB4hYVUgNA.png)

XCode 16

When XCode 16 was first released last year, I noticed this new option in the menu. The initial expectation was that it could automatically convert virtual directory files into physical directories.

However, this is not the case; it requires you to first create the directories and place the files in the corresponding physical locations. After clicking "Convert to folder," it will change to the new XCode Project directory setting method " `PBXFileSystemSynchronizedRootGroup`." To be honest, **this is not useful for conversion; it is more about upgrading to a new directory setting method after conversion.**

If the directories are not created and the files are not placed correctly, clicking "Convert to folder" will result in the following error:
```
Missing Associated Folder
Each group must have an associated folder. The following groups are not associated with a folder:
‚Ä¢ xxxx
Use the file inspector to associate a folder with each group, or delete the groups after moving their content to another group.
```
#### ü´• Open Source Projects [venmo](https://github.com/venmo){:target="_blank"} / [synx](https://github.com/venmo/synx){:target="_blank"}

[![](https://opengraph.githubassets.com/f44d83e1bade6cc953f32a80fc61a9a21345124013c2473f111a35b78a332604/venmo/synx)](https://github.com/venmo/synx){:target="_blank"}

```markdown
After searching on GitHub for a long time, I only found this open-source tool written in Ruby for converting virtual directories to physical ones. It works effectively when run, but due to being outdated (approximately 10 years without updates), many files still need to be manually mapped and moved, making complete conversion impossible. Therefore, I gave up.

> _However, I am still very grateful for the inspiration from this open-source project, which led me to think about developing my own conversion tool._

#### ‚úÖ My Open Source Projects [ZhgChgLi](https://github.com/ZhgChgLi){:target="_blank"} / [XCFolder](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

[![](https://repository-images.githubusercontent.com/941421589/27855f06-b938-4458-a20f-3e317b4283b7)](https://github.com/ZhgChgLi/XCFolder){:target="_blank"}

Developed using pure Swift, this Command Line Tool is based on [XcodeProj](https://github.com/tuist/XcodeProj){:target="_blank"} to parse `.xcodeproj` Xcode project files, read all files to obtain their directories, parse the directories to convert virtual directories into physical ones, move the files to the correct locations, and finally adjust the directory settings in the `.xcodeproj` Xcode project file to complete the conversion.

![](/assets/fd719053b376/1*eFNN12WDaAk6mr49OzmC_g.jpeg)

**Usage**
```bash
git clone https://github.com/ZhgChgLi/XCFolder.git
cd ./XCFolder
swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml
```

**For Example:**
```objectivec
swift run XCFolder ./TestProject/DCDeviceTest.xcodeproj ./Configuration.yaml
```

**CI/CD Mode \(** `Non Interactive Mode` **\)Ôºö**
```swift
swift run XCFolder YOUR_XCODEPROJ_FILE.xcodeproj ./Configuration.yaml --is-non-interactive-mode
```

`Configuration.yaml` can set the desired execution parameters:
```shell
# Directories to ignore, will not be parsed or converted
ignorePaths:
- "Pods"
- "Frameworks"
- "Products"

# File types to ignore, will not be converted or moved
ignoreFileTypes:
- "wrapper.framework" # Frameworks
- "wrapper.pb-project" # Xcode project files
#- "wrapper.application" # Applications
#- "wrapper.cfbundle" # Bundles
#- "wrapper.plug-in" # Plug-ins
#- "wrapper.xpc-service" # XPC services
#- "wrapper.xctest" # XCTest bundles
#- "wrapper.app-extension" # App extensions

# Only create directories and move files, do not adjust .xcodeproj XCode project file directory settings
moveFileOnly: false

# Prefer using git mv command to move files
gitMove: true
```

‚ö†Ô∏è **Please note before execution:**
- Ensure that Git has no uncommitted changes, as the script may corrupt your project directory if there are errors.
(The script will check, and if there are uncommitted changes, it will throw an error `‚ùå Error: There are uncommitted changes in the repository`.)
- By default, it prefers to use the `git mv` command to move files to ensure complete git file log records. If the move fails or if it is not a Git project, it will use FileSystem Move to move the files.

**Just wait for the execution to complete:**

![](/assets/fd719053b376/1*IL_-Ht1SH5ZCYogZHXULbQ.png)

![](/assets/fd719053b376/1*8JNbDbR7pvZLhcoQLU_B6A.png)
```

‚ö†Ô∏è **Please note after execution:**
- Please check if there are any missing (red) files in the project directory. If there are few, you can manually fix them. If there are many, please confirm whether the settings for `ignorePaths` and `ignoreFileTypes` in Configuration.yaml are correct, or [**create an Issue**](https://github.com/ZhgChgLi/XCFolder/issues){:target="_blank"} to let me know.
- Check the relevant paths in Build Settings, e.g., whether `LIBRARY_SEARCH_PATHS` needs to be manually changed.
- It is recommended to Clean & Build to see the results.
- **If you don't want to deal with the current `.xcodeproj` XCode project file, you can also directly start using XCodeGen or Tuist to regenerate the directory files.**

**Modify Script:**

You can directly click `./Package.swift` to open the project and adjust the script content.
#### Other Development Notes
- Thanks to [XcodeProj](https://github.com/tuist/XcodeProj){:target="_blank"}, we can easily access the contents of the `.xcodeproj` **XCode project file** using Swift objects.
- Developed using the Clean Architecture structure.
- If there is no path in the PBXGroup settings and only a name, it is a virtual directory; otherwise, it is a physical directory.
- The new directory setting in XCode 16, `PBXFileSystemSynchronizedRootGroup`, only requires declaring the main directory, and it will automatically resolve from the physical directory without needing to declare every directory and file in the `.xcodeproj` XCode project file.
- Developing command line tools directly using SPM (Package.swift) is really convenient!

If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

_[Post](https://medium.com/zrealm-ios-dev/xcode-%E8%99%9B%E6%93%AC%E7%9B%AE%E9%8C%84%E8%90%AC%E5%B9%B4%E5%95%8F%E9%A1%8C%E6%8E%A2%E7%A9%B6%E8%88%87%E6%88%91%E7%9A%84%E9%96%8B%E6%BA%90%E5%B7%A5%E5%85%B7%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88-fd719053b376){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
