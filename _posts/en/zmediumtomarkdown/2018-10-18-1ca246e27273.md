---
title: "Enhancing User Experience: Add 3D TOUCH Functionality to Your iOS APP Now (Swift)"
author: "ZhgChgLi"
date: 2018-10-18T14:36:57.668+0000
last_modified_at: 2024-04-13T07:19:09.923+0000
categories: ["ZRealm Dev."]
tags: ["ios","swift","3d-touch","iphone","ios-app-development"]
description: "iOS 3D TOUCH Applications"
image:
  path: /assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png
render_with_liquid: false
---

### \[Deprecated\] Enhancing User Experience: Add 3D TOUCH Functionality to Your iOS APP Now (Swift)

iOS 3D TOUCH Applications

### \[Deprecated\] 2020/06/14


> **_The 3D Touch feature has been removed in iPhone 11 and later models; it has been replaced with Haptic Touch, which is implemented differently._** 





Recently, during some downtime in project development, I explored many interesting features of iOS: [CoreML](../793bf2cdda0f/) „ÄÅ [Vision](../9a9aa892f9a9/) „ÄÅ [Notification Service Extension](../cb6eba52a342/) „ÄÅNotification Content Extension„ÄÅToday Extension„ÄÅCore Spotlight„ÄÅShare Extension„ÄÅSiriKit (some have been organized into articles, while others are forthcomingü§£)

Among them is today's star: **3D Touch functionality**

This feature, which has been supported since **iOS 9/iPhone 7**, only became apparent to me after I switched from iPhone 6 to iPhone 8!
#### 3D Touch can implement two items in the APP, as follows:


![1\. Preview ViewController Preview Function ‚Äî [Marriage App](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/1ca246e27273/1*Nl6uz_dA2h13g7PtqSi6aw.gif)

1\. Preview ViewController Preview Function ‚Äî [Marriage App](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}


![2\. 3D Touch Shortcut APP Shortcut Activation Function](/assets/1ca246e27273/1*VcIEwZxiW26eVqCk4kUEZw.gif)

2\. 3D Touch Shortcut APP Shortcut Activation Function

The first item is the most widely used and effective (Facebook: preview of news feed content, Line: sneak peek at messages), while the second item, APP shortcut activation, currently shows data indicating it is rarely used, so I will discuss it last.
### 1\. Preview ViewController Preview Function:

The functionality is demonstrated in the above image 1, where the ViewController preview function supports
- Background blurring when 3D Touch is pressed
- A preview window of the ViewController pops up when 3D Touch is pressed
- A preview window of the ViewController pops up when 3D Touch is pressed, and swiping up allows adding options to the menu below
- Releasing the 3D Touch returns to the window
- After pressing 3D Touch, applying more pressure enters the target ViewController


Here, I will separately list the implementation code for **A: List Window** and **B: Target Window**:

Since there is no way to determine whether we are in preview mode or actually entering this window in B, we will first create a Protocol to pass values for judgment.
```swift
protocol UIViewControllerPreviewable {
    var is3DTouchPreview:Bool {get set}
}
```

Here is the translated text:

This way, we can make the following judgments in B:
```swift
class BViewController:UIViewController, UIViewControllerPreviewable {
     var is3DTouchPreview:Bool = false
     override func viewDidLoad() {
     super.viewDidLoad()
     if is3DTouchPreview {
       // When it is a preview window... for example: switch to full screen, hide the toolbar
     } else {
       // Display normally in full mode
   } 
}
```

A: List window, which can be a UITableView or UICollectionView:
```swift
class AViewController:UIViewController {
    // Register views that can use 3D Touch
    override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) {
        super.traitCollectionDidChange(previousTraitCollection)
        if traitCollection.forceTouchCapability == .available {
            // TableView:
            registerForPreviewing(with: self, sourceView: self.TableView)
            // CollectionView:
            registerForPreviewing(with: self, sourceView: self.CollectionView)
        }
    }   
}
extension AViewController: UIViewControllerPreviewingDelegate {
    // Actions to take after releasing 3D Touch
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController) {
        
        // Now we are directly jumping to the page, so cancel the preview mode parameter of the ViewController:
        if var viewControllerToCommit = viewControllerToCommit as? UIViewControllerPreviewable {
            viewControllerToCommit.is3DTouchPreview = false
        }
        self.navigationController?.pushViewController(viewControllerToCommit, animated: true)
    }
    
    // Control the position of the 3D Touch cell, the ViewController to be displayed
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -> UIViewController? {
        
        // Get the indexPath/cell instance at the current point
        // TableView:
        guard let indexPath = TableView.indexPathForRow(at: location),let cell = TableView.cellForRow(at: indexPath) else { return nil }
        // CollectionView:
        guard let indexPath = CollectionView.indexPathForItem(at: location),let cell = CollectionView.cellForItem(at: indexPath) else { return nil }
      
        // The ViewController to be displayed
        let targetViewController = UIStoryboard(name: "StoryboardName", bundle: nil).instantiateViewController(withIdentifier: "ViewControllerIdentifier")
        
        // Retain the area when the background is blurred (usually the click position), see Figure 1
        previewingContext.sourceRect = cell.frame
        
        // The size of the 3D Touch window, default is adaptive, no need to change
        // To modify, use: targetViewController.preferredContentSize = CGSize(width: 0.0, height: 0.0)
        
        // Inform the previewing ViewController that it is currently in preview mode:
        if var targetViewController = targetViewController as? UIViewControllerPreviewable {
            targetViewController.is3DTouchPreview = true
        }
        
        // Returning nil has no effect
        return nil
    }
}
```

> **Please note! The registration for the 3D Touch View should be placed within traitCollectionDidChange instead of "viewDidLoad" \( [refer to this article](https://stackoverflow.com/questions/30007701/view-traitcollection-horizontalsizeclass-returning-undefined-0-in-viewdidload){:target="_blank"} \)** 

> I encountered many pitfalls regarding where to place this. Some online resources suggest viewDidLoad, while others suggest placing it in cellForItem, but both of these locations can occasionally lead to failures or partial failures of some cells. 

![Figure 1 Background Blur Retention Area Schematic](/assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png)

Figure 1 Background Blur Retention Area Schematic

If you need to add an options menu below after scrolling up, please add it in **B**. It is B, it is B, it is B!

![](/assets/1ca246e27273/1*L7VwD_lyG86eXzTzgIuELQ.png)

```swift
override var previewActionItems: [UIPreviewActionItem] {
  let profileAction = UIPreviewAction(title: "View Merchant Information", style: .default) { (action, viewController) -> Void in
    // Actions after clicking
  }
  return [profileAction]
}
```

Returning an empty array indicates that this feature is not used.

**Done!**
### 2\. APP Shortcut Activation
#### Step One

Add the UIApplicationShortcutItems parameter in info.plist, of type Array

And add menu items (Dictionary) within it, with the following Key-Value settings:
- \[Required\] UIApplicationShortcutItemType: Identifier string, used for judgment in AppDelegate
- \[Required\] UIApplicationShortcutItemTitle: Option title
- UIApplicationShortcutItemSubtitle: Option subtitle

![](/assets/1ca246e27273/1*PlbW5bVYGkN2olZC9WAvHw.png)

- UIApplicationShortcutItemIconType: Use system icons

![Referenced from [this article](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}](/assets/1ca246e27273/1*S3dbMWNnTvhdt-NlxAQ2Tw.png)

Referenced from [this article](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}
- UIApplicationShortcutItemIconFile: Use custom icons (size: 35x35, monochrome), choose between this and UIApplicationShortcutItemIconType
- UIApplicationShortcutItemUserInfo: More additional information EX: \[id:1\]

![My settings are as shown in the image](/assets/1ca246e27273/1*cIIVrNDdziBVJn4z_QsLJg.png)

My settings are as shown in the image
#### Step Two

Add a handling function in AppDelegate
```swift
func application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -> Void) {
    var info = shortcutItem.userInfo
  
    switch shortcutItem.type {
    case "searchShop":
      //
    case "topicList":
      //
    case "likeWorksPic":
      //
    case "marrybarList":
      //
    default:
        break
    }
    completionHandler(true)
}
```

**Done!**
### Conclusion

Adding 3D Touch functionality to the app is not difficult, and it will feel very considerate to users ‚ù§; it can enhance the user experience when paired with design operations. However, currently, there are only the two functions mentioned above, and since iPhone models below 6s/iPad/iPhone XR do not support 3D Touch, the actual functionalities that can be implemented are even fewer, focusing mainly on assistance and enhancing the experience.
#### p.s.

![If you test closely enough, you will notice the above effect. When scrolling in the CollectionView, some images have already scrolled out of the screen, and pressing at this moment will result in the above situation üòÖ](/assets/1ca246e27273/1*LBgSqm8CTdBPycGnuYNMkA.png)

If you test closely enough, you will notice the above effect. When scrolling in the CollectionView, some images have already scrolled out of the screen, and pressing at this moment will result in the above situation üòÖ

If you have any questions or suggestions, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

_[Post](https://medium.com/zrealm-ios-dev/%E6%8F%90%E5%8D%87%E4%BD%BF%E7%94%A8%E8%80%85%E9%AB%94%E9%A9%97-%E7%8F%BE%E5%9C%A8%E5%B0%B1%E7%82%BA%E6%82%A8%E7%9A%84-ios-app-%E5%8A%A0%E4%B8%8A-3d-touch-%E5%8A%9F%E8%83%BD-swift-1ca246e27273){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
