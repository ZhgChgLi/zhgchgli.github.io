---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2018-10-18T14:36:57.668+0000
description: iOS developers facing engagement challenges can integrate 3D Touch using
  Swift to enable quick actions and previews, enhancing user experience and app responsiveness
  effectively.
image:
  path: /assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png
last_modified_at: 2024-04-13T07:19:09.923+0000
render_with_liquid: false
tags:
- english
- iOS
- Swift
- 3D Touch
- iPhone
- iOS App Development
title: Boost iOS App UXÔΩúImplement 3D Touch with Swift for Instant Interaction
---

### [Deprecated] Enhance User Experience by Adding 3D TOUCH to Your iOS APP Now (Swift)

iOS 3D TOUCH Applications

### [Deprecated] 2020/06/14

> ***iPhone 11 and later models have removed the 3D Touch feature; it has been replaced by Haptic Touch, which works differently.***

Recently, during some downtime in project development, I explored many interesting iOS features: [CoreML](../793bf2cdda0f/), [Vision](../9a9aa892f9a9/), [Notification Service Extension](../cb6eba52a342/), Notification Content Extension, Today Extension, Core Spotlight, Share Extension, SiriKit (some have been organized into articles, more to come ü§£)

Among them is today's highlight: **3D Touch feature**

This feature, supported since **iOS 9/iPhone 7**, only became truly useful to me after I upgraded from an iPhone 6 to an iPhone 8!

#### 3D Touch can implement two features in the APP, as follows:

![1. Preview ViewController Preview Feature ‚Äî [Wedding App](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/1ca246e27273/1*Nl6uz_dA2h13g7PtqSi6aw.gif)

1. Preview ViewController Preview Feature ‚Äî [ÁµêÂ©öÂêßAPP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}

![2. 3D Touch Shortcut APP Launch Feature](/assets/1ca246e27273/1*VcIEwZxiW26eVqCk4kUEZw.gif)

2. 3D Touch Shortcut APP Launch Feature

The first item is the most widely used and effective (Facebook: News Feed content preview, Line: message sneak peek). The second item, app shortcut launch, currently shows low usage based on data, so it is discussed last.

### 1. Preview ViewController Preview Feature:

The feature demonstration is shown in Figure 1 above. The ViewController preview function is supported.

- 3D Touch Press: Background Blur Effect

- 3D Touch Press and Hold to Pop Up ViewController Preview Window

- 3D Touch press triggers a ViewController preview window, swiping up reveals an options menu below.

- 3D Touch Press and Release to Return to Window

- 3D Touch: Press Harder to Enter the Target ViewController

Here, the code to be implemented is listed separately for **A: List Window** and **B: Target Window**:

Since there is no way to determine whether the current state is preview or actual entry into this window in B, we first create a Protocol to pass values for judgment.

```swift
protocol UIViewControllerPreviewable {
    var is3DTouchPreview: Bool { get set }
}
```

This way, we can make the following judgment in B:

```swift
class BViewController:UIViewController, UIViewControllerPreviewable {
     var is3DTouchPreview:Bool = false
     override func viewDidLoad() {
     super.viewDidLoad()
     if is3DTouchPreview {
       // If this is a preview window... for example: go full screen, hide toolbar
     } else {
       // Display normally in full mode
   } 
}
```

A: List view, which can be a UITableView or UICollectionView:

```swift
class AViewController:UIViewController {
    // Register views that support 3D Touch
    override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) {
        super.traitCollectionDidChange(previousTraitCollection)
        if traitCollection.forceTouchCapability == .available {
            //TableView:
            registerForPreviewing(with: self, sourceView: self.TableView)
            //CollectionView:
            registerForPreviewing(with: self, sourceView: self.CollectionView)
        }
    }   
}
extension AViewController: UIViewControllerPreviewingDelegate {
    // Action after 3D Touch is released
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController) {
        
        // Now directly push the page, so disable preview mode on the ViewController:
        if var viewControllerToCommit = viewControllerToCommit as? UIViewControllerPreviewable {
            viewControllerToCommit.is3DTouchPreview = false
        }
        self.navigationController?.pushViewController(viewControllerToCommit, animated: true)
    }
    
    // Control the 3D Touch cell location and the ViewController to show
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -> UIViewController? {
        
        // Get current indexPath/cell at the touch point
        //TableView:
        guard let indexPath = TableView.indexPathForRow(at: location),let cell = TableView.cellForRow(at: indexPath) else { return nil }
        //CollectionView:
        guard let indexPath = CollectionView.indexPathForItem(at: location),let cell = CollectionView.cellForItem(at: indexPath) else { return nil }
      
        // ViewController to display
        let targetViewController = UIStoryboard(name: "StoryboardName", bundle: nil).instantiateViewController(withIdentifier: "ViewControllerIdentifier")
        
        // Area to keep clear during background blur (usually the touch area), see image 1
        previewingContext.sourceRect = cell.frame
        
        // 3D Touch window size, default is adaptive and usually no change needed
        // To modify, use: targetViewController.preferredContentSize = CGSize(width: 0.0, height: 0.0)
        
        // Inform the preview ViewController that it is in preview mode:
        if var targetViewController = targetViewController as? UIViewControllerPreviewable {
            targetViewController.is3DTouchPreview = true
        }
        
        // Return nil to disable any action
        return nil
    }
}
```

> **Note! The registration for the 3D Touch enabled View must be placed inside traitCollectionDidChange, not in ‚ÄúviewDidLoad‚Äù ( [please refer to this article](https://stackoverflow.com/questions/30007701/view-traitcollection-horizontalsizeclass-returning-undefined-0-in-viewdidload){:target="_blank"} )**

> Regarding where to add it, I encountered many pitfalls. Some online sources suggest placing it in viewDidLoad, while others recommend cellForItem, but both locations sometimes cause occasional failures or partial cell failures.

![Figure 1 Background Blur Retention Area Diagram](/assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png)

Figure 1 Background Blur Retention Area Diagram

If you need to add an options menu at the bottom after scrolling up, please add it inside **B**. It‚Äôs B, it‚Äôs B, it‚Äôs B!

![](/assets/1ca246e27273/1*L7VwD_lyG86eXzTzgIuELQ.png)

```swift
override var previewActionItems: [UIPreviewActionItem] {
  let profileAction = UIPreviewAction(title: "View Business Info", style: .default) { (action, viewController) -> Void in
    // Action after tapping
  }
  return [profileAction]
}
```

Return an empty array to indicate that this feature is not used.

**Done!**

### 2. APP Shortcut Launch

#### Step One

Add the UIApplicationShortcutItems key in info.plist, type Array

Add a menu item (Dictionary), with the Key-Value pairs set as follows:

- [Required] UIApplicationShortcutItemType: Identifier string used for decision-making in AppDelegate

- [Required] UIApplicationShortcutItemTitle: Option Title

- UIApplicationShortcutItemSubtitle: Option subtitle

![](/assets/1ca246e27273/1*PlbW5bVYGkN2olZC9WAvHw.png)

- UIApplicationShortcutItemIconType : Use system icons

![Reference from [this article](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}](/assets/1ca246e27273/1*S3dbMWNnTvhdt-NlxAQ2Tw.png)

Reference from [this article](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}

- UIApplicationShortcutItemIconFile: Use a custom icon (size: 35x35, monochrome), choose either this or UIApplicationShortcutItemIconType

- UIApplicationShortcutItemUserInfo: Additional information EX: [id:1]

![My settings as shown above](/assets/1ca246e27273/1*cIIVrNDdziBVJn4z_QsLJg.png)

My settings are as shown in the above image.

#### Step Two

Add a handling function in AppDelegate

```swift
func application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -> Void) {
    var info = shortcutItem.userInfo
  
    switch shortcutItem.type {
    case "searchShop":
      // Handle search shop action
    case "topicList":
      // Handle topic list action
    case "likeWorksPic":
      // Handle like works picture action
    case "marrybarList":
      // Handle marry bar list action
    default:
        break
    }
    completionHandler(true)
}
```

**Done!**

### Conclusion

Adding 3D Touch functionality in an app is not difficult and users will find it thoughtful ‚ù§; it can be combined with design operations to enhance user experience. However, currently only the two functions mentioned above can be implemented, and since iPhone 6s and below, iPad, and iPhone XR do not support 3D Touch, the actual usable features are even fewer, mainly serving as an aid to enhance experience.

#### p.s.

![If you test carefully, you'll notice the effect above: when scrolling the CollectionView, part of the image has already slid out of the screen, and pressing it then causes the situation shown above üòÖ](/assets/1ca246e27273/1*LBgSqm8CTdBPycGnuYNMkA.png)

If you test carefully, you'll notice the above effect occurs when some images in the CollectionView have already scrolled out of view and you press on them. üòÖ

If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

*[Post](https://medium.com/zrealm-ios-dev/%E6%8F%90%E5%8D%87%E4%BD%BF%E7%94%A8%E8%80%85%E9%AB%94%E9%A9%97-%E7%8F%BE%E5%9C%A8%E5%B0%B1%E7%82%BA%E6%82%A8%E7%9A%84-ios-app-%E5%8A%A0%E4%B8%8A-3d-touch-%E5%8A%9F%E8%83%BD-swift-1ca246e27273){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*