---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2021-02-22T13:27:06.542+0000
description: Discover how multiple merged vulnerabilities create critical website
  security risks and learn effective strategies to identify and mitigate these threats,
  enhancing your site's defense against attacks.
image:
  path: /assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg
last_modified_at: 2023-08-05T16:45:45.410+0000
render_with_liquid: false
tags:
- english
- iOS App Development
- Hacker
- Web Security
- Website Security Test
- Capture The Flag
title: Website Security Flaws Exposedï½œHow Combined Vulnerabilities Compromise Protection
---

### Revealing a Clever Website Vulnerability Discovered Years Ago

Website Security Issues Caused by Multiple Combined Vulnerabilities

![Photo by [Tarik Haiga](https://unsplash.com/@tar1k?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/142244e5f07a/1*EQPani1J-PTO-ccp588gBg.jpeg)

Photo by [Tarik Haiga](https://unsplash.com/@tar1k?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}

### Introduction

A few years ago, while still supporting web development, I was assigned to organize a CTF competition for the company's internal engineering team. Initially, the plan was to divide teams based on company products for offense and defense challenges. However, as the organizer, I first conducted penetration tests on the companyâ€™s products to assess the security level. I wanted to see how many vulnerabilities I could find to ensure the event would run smoothly.

> *However, due to limited competition time and significant differences in engineering fields, the final questions focused on common engineering fundamentals and interesting topics. Interested readers can refer to my previous article "[**How to Create a Fun Engineering CTF Competition**](../729d7b6817a4/)," which contains many creative challenges!*

### Found Vulnerabilities

A total of four vulnerabilities were found across three products. In addition to the issues discussed in this article, I also discovered the following three common website vulnerabilities:

1. **Never Trust The Client!**  
   The problem is basic: the frontend sends the ID directly to the backend, and the backend accepts it without verification. This should be changed to validate a Token instead.

2. **Password Reset Design Flaw**  
   I actually forgot the details, only remember there was a programming flaw; it allowed bypassing email verification during the password reset process.

3. **XSS Issue**

4. **Vulnerabilities Introduced in This Article**

All searches are conducted as black-box testing. The only product in which I found XSS issues is one I participated in developing; for the others, I neither participated nor have seen the code.

### Current Vulnerability Status

As a white-hat hacker, all identified issues were reported to the engineering team and fixed immediately; now, two years have passed, and it's time to disclose them. However, out of respect for my former company, this article will not mention which product had the vulnerability. Please just refer to the discovery process and causes of this vulnerability!

### Consequences of the Vulnerability

This vulnerability allows attackers to change the target user's password at will and log in to the target account with the new password, stealing personal information and conducting illegal activities.

### Main Cause of the Vulnerability

As stated in the title, this vulnerability is triggered by a combination of multiple factors, including the following:

- Account login does not support two-factor authentication or device binding

- Reset password verification uses serial number

- Website data encryption feature has a decryption vulnerability

- Abuse of encryption and decryption functions

- Token validation design error

- Backend does not re-verify field correctness

- User email addresses on the platform are public information

### How to Reproduce the Vulnerability

![](/assets/142244e5f07a/1*ILb0VdnkAvgH5aW7qos_lg.png)

Since user email addresses are public information on the platform, we first browse the target account on the platform; after identifying the email, we proceed to the password reset page.

- First, enter your email to reset your password.

- Enter the email of the account you want to hack, then proceed with the password reset process as usual.

Both operations will send a password reset verification email.

![](/assets/142244e5f07a/1*sPNp2NfoykG8-m3vWociQQ.png)

Go to your inbox and find the password reset verification email sent to you.

**Change the password link to the following URL format:**

```
https://zhgchg.li/resetPassword.php?auth=PvrrbQWBGDQ3LeSBByd
```

`PvrrbQWBGDQ3LeSBByd` is the verification token for this password reset operation.

But when I observed the captcha image on the website, I found that the captcha image link format is also similar:

```
https://zhgchg.li/captchaImage.php?auth=6EqfSZLqDc
```

![](/assets/142244e5f07a/1*nfAhh3QasOLCDxdxH5jEQg.png)

`6EqfSZLqDc` displays `5136`.

What if we put our password reset token in? Who cares! **Let's try it!**

![](/assets/142244e5f07a/1*9BccKKQMxdqgtqlad13Ghg.png)

> Bingo!

But the captcha image is too small to get complete information.

**Let's continue to find usable pointsâ€¦**

The website, to prevent crawler interference, displays users' public email addresses as **images**, keyword: **images! images! images!**

Open it right away and take a look:

![Profile Page](/assets/142244e5f07a/1*VLoCTluycBbW70QplV50Lw.png)

Personal Profile Page

![Part of the webpage source code](/assets/142244e5f07a/1*cb0Rpz_Zuto5e6WTPsA_Tw.png)

Webpage Source Code Section

We also obtained similar URL format results:

```
https://zhgchg.li/mailImage.php?mail=V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt
```

`V3sDblZgDGdUOOBlBjpRblMTDGwMbwFmUT10bFN6DDlVbAVt` displays `zhgchgli@gmail.com`

**Just ignore it! Fill it up!**

![](/assets/142244e5f07a/1*mQVMT-D8avyeYSYp5VBU8w.png)

> Bingo!ðŸ¥³ðŸ¥³ðŸ¥³

> `PvrrbQWBGDQ3LeSBByd` *= `2395656`*

#### **After reverse engineering the password reset token, it was found to be numeric**

I thought it might be a serial number...

So I entered the email again to request a password reset, extracted the Token from the new email, and got `2395657` â€¦ what the fxckâ€¦ it really is.

Once you know it's a sequential process, handling it becomes easier. That's why the initial step is to request a password reset email for your own account first, then request it for the target account; this is because you can already predict the ID for the next password reset request.

> ***Next, you just need to find a way to convert `2395657` back into a Token!***

#### What a coincidence, I found another issue

> ***The website only validates the email format on the frontend during data editing; the backend does not re-validate the format for correctnessâ€¦***

After bypassing the front-end validation, change the email to the next target.

![](/assets/142244e5f07a/1*tdqRy5N0k8WS85l8u8CbKw.png)

![](/assets/142244e5f07a/1*PRTZJZuv7DG11CoUn5OHQg.png)

> Fire in the hole!

**We get:**

```
https://zhgchg.li/mailImage.php?mail=UTVRZwZuDjMNPLZhBGI
```

**At this point, reset the password token and return to the password reset page:**

![](/assets/142244e5f07a/1*1kZp5LQ1yT6m7IBJLoYj9Q.png)

> Successful intrusion! Bypassed verification to reset someone else's password!

Finally, because there was no two-factor authentication or device binding feature, once the password was overwritten, the account could be accessed and impersonated directly.

### The Cause

Reorganize the entire process.

- At the beginning, we needed to reset the password but found that the reset password token was actually a serial number, not a truly unique identifier token.

- The website abuses encryption and decryption functions without distinguishing their uses; almost the entire site uses the same set.

- The website has an online encryption and decryption portal (equivalent to key compromise).

- Backend does not re-verify user input

- No two-factor authentication or device binding features

#### Fix Method

- The fundamental point is that the password reset token should be a randomly generated unique identifier token.

- For website encryption and decryption, different keys should be used based on the function.

- Prevent external parties from arbitrarily manipulating data encryption and decryption.

- The backend should validate user input.

- Enable two-factor authentication and device binding for added security just in case.

### Summary

The entire process of discovering the vulnerability surprised me because many were basic design issues. Although the features seemed functional and the small flaws appeared relatively safe on their own, combining multiple holes created a major vulnerability. Developers really need to be careful and cautious.

### Further Reading

- [How to Create an Engaging Engineering CTF Competition](../729d7b6817a4/)

- [The app uses HTTPS for transmission, but data was still stolen](../46410aaada00/)

- [Security Issues of SMS Verification Code Strength in Password Recovery](../99a6cef90190/)

If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

*[Post](https://medium.com/zrealm-ios-dev/%E6%8F%AD%E9%9C%B2%E4%B8%80%E5%80%8B%E5%B9%BE%E5%B9%B4%E5%89%8D%E7%99%BC%E7%8F%BE%E7%9A%84%E5%B7%A7%E5%A6%99%E7%B6%B2%E7%AB%99%E6%BC%8F%E6%B4%9E-142244e5f07a){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*