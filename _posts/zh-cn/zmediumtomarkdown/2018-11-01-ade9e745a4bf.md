---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2018-11-01T15:35:02.255+0000
description: UserNotifications Provisional Authorization 临时权限、iOS 12 静音通知介绍
image:
  path: /assets/ade9e745a4bf/1*NX0r7q5ikfoJnxWq_eGRWQ.jpeg
last_modified_at: 2025-03-06T02:54:46.214+0000
render_with_liquid: false
tags:
- ios
- swift
- push-notification
- ios-app-development
- ios12
title: 什么？iOS 12 不需使用者授权就能收到推播通知(Swift)
---

### 什么？iOS 12 不需使用者授权就能传送推播通知(Swift) — (2019–02–06 更新)



UserNotifications Provisional Authorization 临时权限、iOS 12 静音通知介绍



### MurMur……



前阵子在改善APP推播通知允许及点击率过低问题，做了些优化调整；最初版的时候体验非常差，APP 安装完一启动就直接跳「APP想要传送通知」的询问视窗；想当然而关闭率非常高，根据前一篇使用 [Notification Service Extension](../cb6eba52a342/) 统计通知实际显示数，推测按允许推播的使用者只有大约10%．



目前调整新安装引导流程、配合介面优化将询问通知视窗的跳出时机调整如下：



![[结婚吧APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/ade9e745a4bf/1*Yehjud9-RMPTENiVQz4Ryg.gif)



[结婚吧APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}



如果使用者还在犹豫或想使用看看再决定要不要接收通知，可按右上角「略过」，避免一开始因对APP还不熟悉而按下「不允许」造成之后也无法再询问一去不复返的结果。



### 进入正题



在做上面这个优化项目时发现 UserNotifications iOS 12 中新增一项 .provisional 权限，翻成白话就是临时的通知权限， **不用跳询问通知视窗取得允许通知权限就能对使用者发送推播通知(静音通知)** ，实际效果跟限制我们接著看下去。



#### 如何要求临时通知权限?



```swift
if #available(iOS 12.0, *) {
    let center = UNUserNotificationCenter.current()
    let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound, .provisional]
    // 可以只要求临时权限.provisional，或是顺便先要求所有要用的权限ＸＤ
    // 都不会触发显示询问通知视窗
    
    center.requestAuthorization(options: permissiones) { (granted, error) in
        print(granted)
    }
}
```



我们将以上程式加入 AppDelegate didFinishLaunchingWithOptions 然后开启APP，就会发现没有跳出询问通知视窗；这时我们去 **设定** 查看 **APP通知设定**



![(图一) 取得静音通知权限](/assets/ade9e745a4bf/1*MvsncOUpTTh-ZTlJAUm8fA.jpeg)



(图一) 取得静音通知权限



我们就这样默默地取得了静音通知权限🏆



在程式判断当前推播通知权限的部分新增 authorizationStatus .provisional 项目 (仅iOS 12之后)：



```swift
if #available(iOS 10.0, *) {
    UNUserNotificationCenter.current().getNotificationSettings { (settings) in
        if settings.authorizationStatus == .authorized {
            //允许
        } else if settings.authorizationStatus == .denied {
            //不允许
        } else if settings.authorizationStatus == .notDetermined {
            //没问过
        } else if #available(iOS 12.0, *) {
            if settings.authorizationStatus == .provisional {
                //目前是临时权限
            }
        }
    }
}
```



> **请注意！** 如果你有针对当前通知权限状态做判断， `settings.authorizationStatus == .notDetermined` 跟 `settings.authorizationStatus == .provisional`



> 都是可以再跳出通知询问视窗问使用者允不允许接收通知的



#### 静音通知能干嘛？推播如何显示？



先来张图整理一下静音通知会显示的时机：



![](/assets/ade9e745a4bf/1*BZYhskEdvVLNsFvJV-SWkw.jpeg)



可以看到如果是静音推播通知，APP在背景状态下收到通知时 **不会跳出横幅、不会有声音提示、不能标记、不会出现在锁定画面，只会出现在手机解锁状态下下拉的通知中心之中** ：



![](/assets/ade9e745a4bf/1*Nq6PQhG06BOrX_05i0Jb0g.jpeg)



可以看到您的发送的推播通知，并且会自动聚合成一个分类



**点击展开后使用者可选择：**



![此展开的询问视窗只会出现在「临时权限」时静音推播之下](/assets/ade9e745a4bf/1*NX0r7q5ikfoJnxWq_eGRWQ.jpeg)



此展开的询问视窗只会出现在「临时权限」时静音推播之下



1. 要「继续」接收推播 — 「传送重要通知」： **通知权限就全开了！通知权限就全开了！通知权限就全开了！** 真的很重要所以讲三次，这时候前面程式码要求权限那段一并要求所有权限的效果就相当显著了。
   或维持接收静音通知


2. 「关闭」 — 「关闭所有通知」点击后完全关闭推播通知（含静音通知）。



#### 附注：要怎么手动把现有的APP调成静音通知？



静音通知是iOS 12对通知优化推出的新设定与临时权限无关，只不过是程式那端拿到临时权限就能发静音通知；针对APP的通知要设成静音也很简单，方法之一就是去「设定」-「通知」- 找到APP 将其所有权限都关闭只留「通知中心」(如图ㄧ)即是静音通知．
或是收到APP通知时重压/长压展开后，点击右上角「…」选择传送静音通知亦同：



![](/assets/ade9e745a4bf/1*Lfx_esnpxLQ7GXVoLT710A.gif)



#### 有了临时权限在之后触发跳出询问通知视窗时：



要求通知权限的部分拿掉 .provisional 就能依然正常询问使用者要不要允许接收通知：



```swift
if #available(iOS 10.0, *) {
    let center = UNUserNotificationCenter.current()
    let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound]
    center.requestAuthorization(options: permissiones) { (granted, error) in
        print(granted)
    }
}
```



![](/assets/ade9e745a4bf/1*Bu6H1GZPWUoAd1oSfdYi5w.jpeg)



按「允许」取得所有通知权限、按「不允许」关闭所有通知权限(含本来取得的静音通知权限)



#### 整体流程如下：



![](/assets/ade9e745a4bf/1*--o4wB9gSZ3y661GiZfEEg.jpeg)



#### 总结：



iOS 12的这项通知贴心优化，让使用者跟开发者之间对通知功能更容易达搭起互动的桥梁，能尽量避免一去不复返关闭通知的状况。



对使用者来说，往往跳询问通知视窗时不知该按下允许还是拒绝因为我们不知道开发者会传什么样的通知给我们，可能是广告亦可能是重要消息，未知的事物是可怕的，所以大部分的人都会先保守按下拒绝。



对开发者来说，我们精心准备了许多项目包含重要消息要推送给使用者知道，但就因上述问题而被使用者屏蔽，我们花费心思设计的文案就这样白费了！



此功能可让开发者把握使用者刚安装APP时的机会，设计好推播流程、内容，对使用者优先推送感兴趣项目，增加使用者对此APP通知的认识度，并追踪推播点击率，在适当的时机再触发询问使用者要不要接收通知。



虽然能曝光的地方只有 **通知中心** 但有曝光有机会；换个角度想，我们是使用者的话，没按允许通知，APP如果能传一堆有横幅+有声音+还出现在解锁画面的通知给我，应该会觉得非常干扰恼人(隔壁阵营就是XD)，苹果这个做法则是在使用者与开发者之间取得了平衡。



目前的问题大概就是….iOS 12的用户还太少🤐



#### 延伸阅读



- [从 iOS 9 到 iOS 12 推播通知权限状态处理(Swift)](../fd7f92d52baa/)


- [iOS Deferred Deep Link 延迟深度连结实作(Swift)](../b08ef940c196/)


- [iOS+MacOS 使用mitmproxy 进行中间人嗅探](../46410aaada00/)


- [iOS 15 / MacOS Monterey Safari 将能隐藏真实 IP](https://medium.com/zrealm-ios-dev/ios-15-macos-monterey-safari-%E5%B0%87%E8%83%BD%E9%9A%B1%E8%97%8F%E7%9C%9F%E5%AF%A6-ip-755a8b6acc35){:target="_blank"}



有任何问题及指教欢迎 [与我联络](https://www.zhgchg.li/contact){:target="_blank"} 。



*[Post](https://medium.com/zrealm-ios-dev/%E4%BB%80%E9%BA%BC-ios-12-%E4%B8%8D%E9%9C%80%E4%BD%BF%E7%94%A8%E8%80%85%E6%8E%88%E6%AC%8A%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5-swift-ade9e745a4bf){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*