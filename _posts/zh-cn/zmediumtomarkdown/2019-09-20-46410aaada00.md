---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2019-09-20T10:01:01.345+0000
description: iOS+MacOS ä½¿ç”¨ mitmproxy è¿›è¡Œä¸­é—´äººæ”»å‡»(Man-in-the-middle attack) å—…æ¢APIä¼ è¾“èµ„æ–™
image:
  path: /assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png
last_modified_at: 2024-04-13T07:56:08.893+0000
render_with_liquid: false
tags:
- mitmproxy
- man-in-the-middle
- ios
- ios-app-development
- hacking
title: APPæœ‰ç”¨HTTPSä¼ è¾“ï¼Œä½†èµ„æ–™è¿˜æ˜¯è¢«å·äº†ã€‚
---

### APPæœ‰ç”¨HTTPSä¼ è¾“ï¼Œä½†èµ„æ–™è¿˜æ˜¯è¢«å·äº†ã€‚



iOS+MacOS ä½¿ç”¨ mitmproxy è¿›è¡Œä¸­é—´äººæ”»å‡»(Man-in-the-middle attack) å—…æ¢APIä¼ è¾“èµ„æ–™æ•™å­¦åŠå¦‚ä½•é˜²èŒƒï¼Ÿ



### å‰è¨€



å‰é˜µå­åˆšåœ¨å…¬å¸åŠå®Œä¸€åœºå†…éƒ¨çš„ [CTFç«èµ›](../729d7b6817a4/) ï¼Œåœ¨å‘æƒ³é¢˜ç›®æ—¶å›æƒ³èµ·å¤§å­¦æ—¶å€™è¿˜åœ¨åšåç«¯(PHP)æ—¶ç»æ‰‹çš„ä¸“æ¡ˆï¼Œä¸€ä¸ªé›†ç‚¹çš„APPï¼Œå¤§æ¦‚å°±æ˜¯æœ‰ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œç„¶åè§¦å‘æ¡ä»¶å®Œæˆå°±Call APIè·å¾—ç‚¹æ•°ï¼›è€æ¿è®¤ä¸ºCall APIæœ‰ç»è¿‡HTTPSåŠ å¯†ä¼ è¾“èµ„æ–™å°±å¾ˆå®‰å…¨äº† â€” ç›´åˆ°æˆ‘å‘ä»–å±•ç¤ºä¸­é—´äººæ”»å‡»ï¼Œç›´æ¥å—…æ¢ä¼ è¾“èµ„æ–™ï¼Œä¼ªé€ APIå‘¼å«è·å¾—ç‚¹æ•°â€¦.



å†åŠ ä¸Šæœ€è¿‘å‡ å¹´å¤§æ•°æ®å´›èµ·ï¼Œç½‘è·¯çˆ¬è™«æ»¡å¤©é£ï¼›çˆ¬è™«æ”»é˜²æˆ˜æ—¥æ¸ç™½çƒ­åŒ–ï¼Œ [çˆ¬å–ä¸é˜²çˆ¬ä¹‹é—´èŠ±æ‹›ç™¾å‡º](https://coolcao.com/2018/06/09/tips-of-anti-spider-in-fe/){:target="_blank"} ï¼Œåªèƒ½è¯´é“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆå•Šï¼



çˆ¬è™«çš„å¦ä¸€æ¡ä¸‹æ‰‹å¯¹è±¡å°±æ˜¯APPçš„APIï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•é˜²èŒƒå‡ ä¹ç­‰äºé—¨æˆ·å¤§å¼€ï¼›ä¸ä½†å¥½æ“ä½œè€Œä¸”æ ¼å¼ä¹Ÿå¹²å‡€ï¼Œæ›´ä¸å®¹æ˜“è¢«è¯†åˆ«é˜»æŒ¡ï¼›æ‰€ä»¥å¦‚æœç½‘é¡µç«¯å·²ç»è´¹å°½å…¨åŠ›é˜»æŒ¡ï¼Œèµ„æ–™è¿˜æ˜¯ä¸æ®µè¢«çˆ¬ï¼Œä¸å¦¨æ£€æŸ¥ä¸€ä¸‹APPçš„APIæœ‰æ— æ¼æ´ã€‚



å› ä¸ºè¿™ä¸ªè®®é¢˜æˆ‘ä¸çŸ¥é“è¯¥å¦‚ä½•å‡ºåœ¨ CTFæ¯”èµ›ä¸­ ï¼Œæ‰€ä»¥å°±å•æ‹‰å‡ºä¸€ç¯‡æ–‡ç« ä½œä¸ºçºªå½• ï¼›æœ¬ç¯‡åªæ˜¯ç²—æµ…ç»™ä¸ªæ¦‚å¿µ â€” [HTTPSèƒ½é€è¿‡å‡­è¯æ›¿æ¢è¿›è¡Œä¼ è¾“å†…å®¹è§£å¯†](http://www.aqee.net/post/man-in-the-middle-attack.html){:target="_blank"} ã€å¦‚ä½•åŠ å¼ºå®‰å…¨æ€§é˜²æ­¢ï¼›å®é™…ç½‘è·¯ç†è®ºä¸æ˜¯æˆ‘çš„å¼ºé¡¹ä¹Ÿéƒ½è¿˜ç»™è€å¸ˆäº†ï¼Œå¦‚æœå·²ç»æœ‰è¿™æ–¹é¢æ¦‚å¿µçš„æœ‹å‹å°±ä¸ç”¨èŠ±æ—¶é—´çœ‹è¿™ç¯‡ï¼Œæˆ–æ‹‰åˆ°åº•çœ‹APPè¯¥å¦‚æœä¿æŠ¤ï¼



### å®é™…æ“ä½œ



ç¯å¢ƒ: MacOS + iOS



> *Android ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä¸‹è½½ [Packet Capture](https://play.google.com/store/apps/details?id=app.greyshirts.sslcapture&hl=en){:target="_blank"} (å…è´¹)ã€iOS ç”¨æˆ·å¯ä½¿ç”¨ [Surge 4](https://apps.apple.com/us/app/surge-3/id1442620678){:target="_blank"} è¿™å¥—è½¯ä½“( **ä»˜è´¹)** è§£é”ä¸­é—´äººæ”»å‡»åŠŸèƒ½ã€MacOSä¹Ÿå¯ä»¥ä½¿ç”¨å¦ä¸€å¥—ä»˜è´¹è½¯ä½“Charlesã€‚*



> *æœ¬æ–‡ç« ä¸»è¦è®²è§£iOSä½¿ç”¨ **å…è´¹** çš„ mitmproxy è¿›è¡Œæ“ä½œï¼Œå¦‚æœæ‚¨æœ‰ä¸Šè¿°çš„ç¯å¢ƒå°±ä¸ç”¨è¿™ä¹ˆéº»çƒ¦å•¦ï¼Œç›´æ¥APPæ‰“å¼€åœ¨æ‰‹æœºä¸ŠæŒ‚è½½VPNæ›¿æ¢æ‰å‡­è¯å°±èƒ½è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼(ã„§æ ·è¯·ç›´æ¥ä¸‹æ‹‰åˆ°åº•çœ‹è¯¥å¦‚ä½•ä¿æŠ¤ï¼)*



**[2021/02/25 æ›´æ–°]ï¼š** Mac æœ‰æ–°çš„å…è´¹å›¾å½¢åŒ–ä»‹é¢ç¨‹å¼ ( [Proxyman](https://proxyman.io/){:target="_blank"} ) å¯ä»¥ç”¨ï¼Œå¯æ­é… [å‚è€ƒæ­¤ç¯‡æ–‡ç« ](../70a1409b149a/) çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚



#### å®‰è£… [mitmproxy](https://mitmproxy.org){:target="_blank"}



**ç›´æ¥ä½¿ç”¨ brew å®‰è£…** ï¼š



```bash
brew install mitmproxy
```



**å®‰è£…å®Œæˆ!**



*p.s å¦‚æœä½ å‡ºç° brew: command not found è¯·å…ˆå®‰è£… [brew](https://brew.sh/index_zh-tw){:target="_blank"} å¥—ä»¶ç®¡ç†å·¥å…·* ï¼š



```bash
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```



#### mitmproxy ä½¿ç”¨



å®‰è£…å®Œæˆåï¼Œåœ¨ Terminal è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å¯ç”¨ï¼š



```bash
mitmproxy
```



![å¯åŠ¨æˆåŠŸ](/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png)



å¯åŠ¨æˆåŠŸ



#### è®©æ‰‹æœºè·ŸMacåœ¨åŒä¸ªåŒºåŸŸç½‘è·¯å†…&å–å¾—Macçš„IPä½å€



æ–¹æ³•(1) Mac è¿æ¥ WiFiã€æ‰‹æœºä¹Ÿä½¿ç”¨åŒä¸ª WiFi
**Macçš„IPä½å€ =** ã€Œç³»ç»Ÿåå¥½è®¾å®šã€-&gt;ã€Œç½‘è·¯ã€-&gt;ã€ŒWi-Fiã€-&gt;ã€ŒIP Addressã€



æ–¹æ³•(2) Mac ä½¿ç”¨æœ‰çº¿ç½‘è·¯ï¼Œå¼€å¯ç½‘è·¯åˆ†äº«ï¼›æ‰‹æœºè¿ä¸Šè¯¥çƒ­ç‚¹ç½‘è·¯:



![ã€Œç³»ç»Ÿåå¥½è®¾å®šã€-&gt; ã€Œå…±äº«ã€-&gt;é€‰æ‹©ã€Œä¹™å¤ªç½‘è·¯ã€-&gt;ã€ŒWi-Fiã€æ‰“å‹¾-&gt; ã€ŒInternet å…±äº«ã€å¯ç”¨](/assets/46410aaada00/1*R9fthpHlrWzTh4R3fEwO5Q.gif)



ã€Œç³»ç»Ÿåå¥½è®¾å®šã€-&gt; ã€Œå…±äº«ã€-&gt;é€‰æ‹©ã€Œä¹™å¤ªç½‘è·¯ã€-&gt;ã€ŒWi-Fiã€æ‰“å‹¾-&gt; ã€ŒInternet å…±äº«ã€å¯ç”¨



**Macçš„IPä½å€ = 192.168.2.1** ï¼ˆï¸ï¸æ³¨æ„âš ï¸ ä¸æ˜¯ä¹™å¤ªç½‘è·¯ç½‘è·¯çš„IPï¼Œæ˜¯Macç”¨åšç½‘è·¯åˆ†äº«åŸºåœ°å°çš„IP)



#### æ‰‹æœºç½‘è·¯è®¾ç½®WiFi â€” Proxyä¼ºæœå™¨èµ„è®¯



![ã€Œè®¾å®šã€-&gt; ã€ŒWiFiã€-&gt; ã€ŒHTTP ä»£ç†ä¼ºæœå™¨ã€-&gt; ã€Œæ‰‹åŠ¨ã€-&gt; ã€Œä¼ºæœå™¨è¾“å…¥ **Macçš„IPä½å€** ã€-&gt; ã€Œè¿æ¥åŸ è¾“å…¥ **8080** ã€-&gt; ã€Œå‚¨å­˜ã€](/assets/46410aaada00/1*ziIFrGQaMr2kYrQHwLYNJg.jpeg)



ã€Œè®¾å®šã€-&gt; ã€ŒWiFiã€-&gt; ã€ŒHTTP ä»£ç†ä¼ºæœå™¨ã€-&gt; ã€Œæ‰‹åŠ¨ã€-&gt; ã€Œä¼ºæœå™¨è¾“å…¥ **Macçš„IPä½å€** ã€-&gt; ã€Œè¿æ¥åŸ è¾“å…¥ **8080** ã€-&gt; ã€Œå‚¨å­˜ã€



> *è¿™æ—¶ç½‘é¡µæ‰“ä¸å¼€ã€å‡ºç°å‡­è¯é”™è¯¯æ˜¯æ­£å¸¸çš„ï¼›æˆ‘ä»¬ç»§ç»­å¾€ä¸‹åšâ€¦*



#### å®‰è£… mitmproxy è‡ªè®¢ https å‡­è¯



å¦‚åŒä¸Šè¿°æ‰€è¯´ï¼Œä¸­é—´äººæ”»å‡»çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨é€šè®¯ä¹‹ä¸­ä½¿ç”¨è‡ªå·±çš„å‡­è¯åšæŠ½æ¢åŠ è§£å¯†èµ„æ–™ï¼›æ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦åœ¨æ‰‹æœºä¸Šå®‰è£…è¿™ä¸ªè‡ªè®¢çš„å‡­è¯ã€‚



**1.ç”¨æ‰‹æœºsafariæ‰“å¼€ <http://mitm.it>{:target="_blank"}**



![å‡ºç°å·¦è¾¹-&gt;Proxyè®¾å®šâœ…/ å‡ºç°å³è¾¹ä»£è¡¨ Proxyè®¾å®šæœ‰è¯¯ğŸš«](/assets/46410aaada00/1*BuvCYx9WRzG0ECO3H_BS0A.jpeg)



å‡ºç°å·¦è¾¹-&gt;Proxyè®¾å®šâœ…/ å‡ºç°å³è¾¹ä»£è¡¨ Proxyè®¾å®šæœ‰è¯¯ğŸš«



![ã€ŒAppleã€-&gt;ã€Œå®‰è£…æè¿°æ¡£ã€-&gt;ã€Œå®‰è£…ã€](/assets/46410aaada00/1*qKDHxi9HxUP41oDJahBfBA.jpeg)



ã€ŒAppleã€-&gt;ã€Œå®‰è£…æè¿°æ¡£ã€-&gt;ã€Œå®‰è£…ã€



> *âš ï¸åˆ°è¿™é‡Œè¿˜æ²¡ç»“æŸï¼Œæˆ‘ä»¬è¿˜è¦å»å…³äºé‡Œå¯ç”¨æè¿°æ¡£*



![ã€Œä¸€èˆ¬ã€-&gt;ã€Œå…³äºã€-&gt;ã€Œå‡­è¯ä¿¡ä»»è®¾å®šã€-&gt;ã€Œmitmproxyã€å¯ç”¨](/assets/46410aaada00/1*mOijblpQepazFPIwob4r8Q.jpeg)



ã€Œä¸€èˆ¬ã€-&gt;ã€Œå…³äºã€-&gt;ã€Œå‡­è¯ä¿¡ä»»è®¾å®šã€-&gt;ã€Œmitmproxyã€å¯ç”¨



**å®Œæˆï¼è¿™æ—¶æˆ‘ä»¬å†å›å»æµè§ˆå™¨å°±èƒ½æ­£å¸¸æµè§ˆç½‘é¡µäº†ã€‚**



#### å›åˆ°Mac ä¸Šæ“ä½œ mitmproxy



![å¯ä»¥åœ¨mitmproxy Terminalä¸Šçœ‹åˆ°åˆšæ‰‹æœºçš„èµ„æ–™ä¼ è¾“çºªå½•](/assets/46410aaada00/1*kiEPaTm5bhnFLBfQngQPgA.png)



å¯ä»¥åœ¨mitmproxy Terminalä¸Šçœ‹åˆ°åˆšæ‰‹æœºçš„èµ„æ–™ä¼ è¾“çºªå½•



![æ‰¾åˆ°æƒ³å—…æ¢çš„çºªå½•è¿›å…¥æŸ¥çœ‹Request(é€å‡ºå“ªäº›å‚æ•°)/Response(å›ä¼ äº†ä»€ä¹ˆå†…å®¹)](/assets/46410aaada00/1*5I6l9cO3LeXfcwGLpWGKPQ.gif)



æ‰¾åˆ°æƒ³å—…æ¢çš„çºªå½•è¿›å…¥æŸ¥çœ‹Request(é€å‡ºå“ªäº›å‚æ•°)/Response(å›ä¼ äº†ä»€ä¹ˆå†…å®¹)



#### å¸¸ç”¨æ“ä½œæŒ‰é”®é›†ï¼š



```plaintext
ã€Œ ? ã€= æŸ¥çœ‹æŒ‰é”®æ“ä½œé›†æ–‡æ¡£
ã€Œ k ã€/ã€Œâ¬†ã€= ä¸Š 
ã€Œ j ã€/ã€Œâ¬‡ã€= ä¸‹ 
ã€Œ h ã€/ã€Œâ¬…ã€= å·¦ 
ã€Œ l ã€/ã€Œâ¡ï¸ã€ï¸= å³ 
ã€Œ space ã€= ä¸‹ä¸€é¡µ
ã€Œ enter ã€= è¿›å…¥æŸ¥çœ‹è¯¦æƒ…
ã€Œ q ã€= è¿”å›ä¸Šä¸€é¡µ/é€€å‡º
ã€Œ b ã€= æ±‡å‡ºresponse bodyåˆ°æŒ‡å®špathæ–‡å­—æ¡£ 
ã€Œ f ã€= ç­›é€‰çºªå½•æ¡ä»¶
ã€Œ z ã€= æ¸…é™¤æ‰€æœ‰çºªå½•
ã€Œ e ã€= ç¼–è¾‘Request(cookieã€headersã€params...)
ã€Œ r ã€= é‡æ–°å‘é€Request
```



#### ä¸ä¹ æƒ¯CLI? æ²¡å…³ç³»ï¼Œå¯ä»¥æ”¹ç”¨ Web GUI !



é™¤äº† mitmproxy å¯ç”¨æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ä¸‹ï¼š



```bash
mitmweb
```



å°±èƒ½ä½¿ç”¨æ–°çš„ Web GUI è¿›è¡Œæ“ä½œè§‚å¯Ÿ



![mitmweb](/assets/46410aaada00/1*Stbf8gUk8iXwNkozOKyOjA.png)



mitmweb



#### é‡å¤´æˆï¼Œå—…æ¢APPèµ„æ–™ï¼š



ä¸Šè¿°ç¯å¢ƒéƒ½å»ºç½®å®Œæˆä¹Ÿç†Ÿæ‚‰ä¹‹åï¼Œå°±å¯ä»¥è¿›å…¥æˆ‘ä»¬çš„é‡å¤´æˆï¼›å—…æ¢APP APIçš„èµ„æ–™ä¼ è¾“å†…å®¹ï¼



> *è¿™è¾¹ä»¥æŸæˆ¿å±‹APPä½œä¸ºèŒƒä¾‹ï¼Œæ— æ¶æ„çº¯å­¦æœ¯äº¤æµä½¿ç”¨!*



> *æˆ‘ä»¬æƒ³çŸ¥é“ç‰©ä»¶åˆ—è¡¨çš„APIæ˜¯å¦‚ä½•è¯·æ±‚å’Œå›ä¼ ä»€ä¹ˆå†…å®¹!*



![é¦–å…ˆå…ˆæŒ‰ã€Œzã€æ¸…é™¤æ‰€æœ‰çºªå½•(é¿å…æä¹±)](/assets/46410aaada00/1*HKppSomeMK5U3Z0kbaRvkQ.png)



é¦–å…ˆå…ˆæŒ‰ã€Œzã€æ¸…é™¤æ‰€æœ‰çºªå½•(é¿å…æä¹±)



![å¼€å¯ç›®æ ‡ APP](/assets/46410aaada00/1*mpNLXzUwb7-jiikrHkoTcA.png)



å¼€å¯ç›®æ ‡ APP



å¼€å¯ç›®æ ‡ APP å°è¯•ã€Œä¸‹æ‹‰é‡æ•´ã€æˆ–è§¦å‘ã€Œè½½å…¥ä¸‹ä¸€é¡µã€çš„åŠ¨ä½œã€‚



> ***ğŸ›‘è‹¥ä½ çš„ç›®æ ‡APPæ‰“ä¸å¼€ã€è¿ä¸ä¸Šï¼›é‚£æŠ±æ­‰äº†ï¼Œä»£è¡¨APPæœ‰åšé˜²èŒƒæ— æ³•ç”¨è¿™æ‹›å—…æ¢ï¼Œè¯·ç›´æ¥ä¸‹æ‹‰åˆ°å¦‚ä½•ä¿æŠ¤çš„ç« èŠ‚ğŸ›‘***



![mitmproxy çºªå½•](/assets/46410aaada00/1*KOkJugn95bcUCPl-dZEaRA.png)



mitmproxy çºªå½•



å›åˆ° mitmproxy æŸ¥çœ‹çºªå½•ï¼Œå‘æŒ¥ä¾¦æ¢çš„ç²¾ç¥çŒœæµ‹å“ªä¸ªAPIè¯·æ±‚çºªå½•æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¹¶è¿›å…¥æŸ¥çœ‹è¯¦ç»†ï¼



![Request](/assets/46410aaada00/1*n6mUgej-2_U8PRUbQo_j1g.png)



Request



Request éƒ¨åˆ†å¯ä»¥çœ‹åˆ° è¯·æ±‚ä¼ é€’äº†å“ªäº›å‚æ•°



æ­é…ã€Œeã€ç¼–è¾‘ä¸ã€Œrã€é‡æ–°å‘é€ï¼Œå¹¶è§‚å¯Ÿ Response å°±å¯ä»¥çŒœåˆ°æ¯ä¸ªå‚æ•°çš„ç”¨é€”å•°ï¼



![Response](/assets/46410aaada00/1*zxdLiXMP-KapoEYou_TlZg.png)



Response



Response ä¹Ÿèƒ½ç›´æ¥è·å¾—åŸå§‹å›ä¼ å†…å®¹ã€‚



> ***ğŸ›‘è‹¥Responseå†…å®¹æ˜¯ä¸€å †ç¼–ç ï¼›é‚£ä¹ŸæŠ±æ­‰äº†ï¼Œä»£è¡¨APPå¯èƒ½æœ‰è‡ªå·±å†åšä¸€æ¬¡åŠ è§£å¯†æ— æ³•ç”¨è¿™æ‹›å—…æ¢ï¼Œè¯·ç›´æ¥ä¸‹æ‹‰åˆ°å¦‚ä½•ä¿æŠ¤çš„ç« èŠ‚ğŸ›‘***



å¾ˆéš¾é˜…è¯»ï¼Ÿä¸­æ–‡ä¹±ç ï¼Ÿæ²¡å…³ç³»ï¼Œè¿™è¾¹å¯ä»¥ç”¨ã€Œbã€æ±‡å‡ºæˆæ–‡å­—æ¡£åˆ°æ¡Œé¢ï¼Œå†å°†å†…å®¹å¤åˆ¶åˆ° [Json Editor Online](https://jsoneditoronline.org/){:target="_blank"} è§£æå³å¯!



![](/assets/46410aaada00/1*7qOTLAIQHH6V782OnvFVFQ.png)



> ****æˆ–æ˜¯ç›´æ¥ä½¿ç”¨ mitmweb ä½¿ç”¨ web gui ç›´æ¥æµè§ˆã€æ“ä½œ***



![mitmweb](/assets/46410aaada00/1*ujOlDBdjp8tECeAwRzWRPw.png)



mitmweb



ç»è¿‡å—…æ¢ã€è§‚å¯Ÿã€è¿‡æ»¤ã€æµ‹è¯•ä¹‹åå°±èƒ½çŸ¥é“APP APIçš„è¿ä½œæ–¹å¼ï¼Œå€Ÿæ­¤å°±èƒ½åˆ©ç”¨ï¼Œç”¨çˆ¬è™«çˆ¬å–èµ„æ–™ã€‚



> **æœé›†å®Œæ‰€éœ€èµ„è®¯è®°å¾—å…³é—­mitmproxyã€æ‰‹æœºç½‘è·¯Proxyä»£ç†ä¼ºæœå™¨æ”¹å›è‡ªåŠ¨ï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ç½‘è·¯ã€‚*



### APP è¯¥å¦‚ä½•è‡ªä¿ï¼Ÿ



è‹¥æŒ‚ä¸Š mitmproxy ä¹‹åå‘ç°APPä¸èƒ½ç”¨ã€å›ä¼ å†…å®¹æ˜¯ç¼–ç ï¼Œä»£è¡¨APPæœ‰åšä¿æŠ¤ã€‚



**åšæ³•(1):**



å¤§ç•¥æ˜¯å°†å‡­è¯èµ„è®¯æ”¾ä¸€ä»½åˆ°APPä¸­ï¼Œè‹¥å½“å‰HTTPSä½¿ç”¨çš„å‡­è¯ä¸APPä¸­çš„èµ„è®¯ä¸ç¬¦åˆ™æ‹’ç»è®¿é—®ï¼Œè¯¦ç»†å¯ä»¥ [çœ‹æ­¤](https://www.anquanke.com/post/id/147090){:target="_blank"} æˆ–æ‰¾ [SSL Pinning](https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc){:target="_blank"} ç›¸å…³èµ„æºã€‚ç¼ºç‚¹å¯èƒ½å°±æ˜¯è¦æ³¨æ„å‡­è¯æœ‰æ•ˆæœŸçš„é—®é¢˜å§ï¼



![<https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc>{:target="_blank"}](/assets/46410aaada00/1*31rODDIlYPidTP3L8W_C7A.jpeg)



<https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc>{:target="_blank"}



**ä½œæ³•(2):**



APPç«¯åœ¨èµ„æ–™è¦ä¼ è¾“å‰å…ˆè¿›è¡Œç¼–ç åŠ å¯†ï¼ŒAPIåç«¯æ”¶åˆ°åè§£å¯†å–å¾—åŸå§‹è¯·æ±‚å†…å®¹ï¼›APIå›ä¼ å†…å®¹ä¸€æ ·å…ˆè¿›è¡Œç¼–ç åŠ å¯†ï¼ŒAPPç«¯æ”¶åˆ°èµ„æ–™åè§£å¯†å–å¾—å›ä¼ å†…å®¹ï¼›æ­¥éª¤å¾ˆçƒ¦çä¹Ÿè€—æ•ˆèƒ½ï¼Œä½†çš„ç¡®æ˜¯ä¸ªæ–¹æ³•ï¼›æ®æˆ‘æ‰€çŸ¥å¥½åƒæŸæ•°å­—é“¶è¡Œå°±æ˜¯ç”¨è¿™æ‹›è¿›è¡Œä¿æŠ¤!



#### ä¸è¿‡â€¦.



ä½œæ³•1ï¼Œä¾ç„¶æœ‰ç ´è§£æ–¹æ³•ï¼š [å¦‚ä½•åœ¨iOS 12ä¸Šç»•è¿‡SSL Pinning](https://www.anquanke.com/post/id/179514){:target="_blank"}



ä½œæ³•2ï¼Œé€è¿‡åç¼–è¯‘å·¥ç¨‹ä¹Ÿèƒ½è·å¾—ç¼–ç åŠ å¯†ç”¨çš„å¯†é’¥



**âš ï¸æ²¡æœ‰100%çš„å®‰å…¨âš ï¸**



`æˆ–æ˜¯å¹²è„†æŒ–ä¸ªæ´è®©å®ƒçˆ¬ï¼Œè¾¹æœé›†å„ç§è¯æ®ï¼Œå†ç”¨æ³•åŠ¡è§£å†³ï¼ˆï¼Ÿ`



#### è¿˜æ˜¯é‚£å¥è¯ï¼š



> ã€Œ NEVER TRUST THE CLIENTã€



### mitmproxy çš„æ›´å¤šç©æ³•ï¼š



**1.ä½¿ç”¨mitmdump**



é™¤ `mitmproxy` ã€ `mitmweb` ï¼Œ `mitmdump` å¯ç›´æ¥å°†æ‰€æœ‰çºªå½•æ±‡å‡ºåˆ°æ–‡å­—æ¡£ä¸­



```bash
mitmdump -w /log.txt
```



å¹¶ä¸”èƒ½ä½¿ç”¨ **ç©æ³•(2)** pythonç¨‹å¼ï¼Œè®¾å®šã€ç­›é€‰æµé‡:



```bash
mitmdump -ns examples/filter.py -r /log.txt -w /result.txt
```



**2.æ­é…pythonç¨‹å¼åšè¯·æ±‚å‚æ•°è®¾å®šã€è®¿é—®æ§åˆ¶ã€è½¬å€ï¼š**



```python
from mitmproxy import http

def request(flow: http.HTTPFlow) -> None:
    # pretty_host takes the "Host" header of the request into account,
    # which is useful in transparent mode where we usually only have the IP
    # otherwise.
    
    # è¯·æ±‚å‚æ•°è®¾å®š Example:
    flow.request.headers['User-Agent'] = 'MitmProxy'
    
    if flow.request.pretty_host == "123.com.tw":
        flow.request.host = "456.com.tw"
    # å°†123.com.twçš„è®¿é—®å…¨å¯¼åˆ°456.com.tw
```



è½¬å€èŒƒä¾‹



å¯ç”¨mitmproxyæ—¶åŠ ä¸Šå‚æ•°ï¼š



```
mitmproxy -s /redirect.py
or
mitmweb -s /redirect.py
or
mitmdump -s /redirect.py
```



### è¡¥ä¸ªå‘



åœ¨ä½¿ç”¨ mitmproxy è§‚å¯Ÿä½¿ç”¨ HTTP 1.1 åŠ Accept-Ranges: bytesã€ Content-Range é•¿è¿æ¥ç‰‡æ®µæŒç»­æ‹¿å–èµ„æºçš„è¯·æ±‚æ—¶ï¼Œä¼šç­‰åˆ° response å…¨éƒ¨å›æ¥æ‰ä¼šæ˜¾ç¤ºï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºåˆ†æ®µã€ä½¿ç”¨æŒä¹…è¿æ¥æ¥ç»­ä¸‹è½½ï¼



[è¸©å‘åœ¨è¿™](../ee47f8f1e2d2/) ã€‚



### å»¶ä¼¸é˜…è¯»



- [ä»¥ç­¾åˆ°å¥–åŠ± APP ä¸ºä¾‹ï¼Œæ‰“é€ æ¯æ—¥è‡ªåŠ¨ç­¾åˆ°è„šæœ¬](../70a1409b149a/)


- [å¦‚ä½•æ‰“é€ ä¸€åœºæœ‰è¶£çš„å·¥ç¨‹CTFç«èµ›](../729d7b6817a4/)


- [æ­éœ²ä¸€ä¸ªå‡ å¹´å‰å‘ç°çš„å·§å¦™ç½‘ç«™æ¼æ´](../142244e5f07a/)


- [iOS 15 / MacOS Monterey Safari å°†èƒ½éšè—çœŸå® IP](https://medium.com/zrealm-ios-dev/ios-15-macos-monterey-safari-%E5%B0%87%E8%83%BD%E9%9A%B1%E8%97%8F%E7%9C%9F%E5%AF%A6-ip-755a8b6acc35){:target="_blank"}



### åè®°



å› ä¸ºæˆ‘æ²¡æœ‰ç½‘åŸŸæƒé™æ— æ³•å–å¾—sslå‡­è¯èµ„è®¯ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•å®ä½œï¼›çœ‹ç¨‹å¼ç æ„Ÿè§‰å¹¶ä¸å›°éš¾ï¼Œè™½ç„¶æ²¡æœ‰100%å®‰å…¨çš„æ–¹æ³•ï¼Œä½†å¤šä¸€é“é˜²æŠ¤è‡³å°‘èƒ½æ›´å®‰å…¨ä¸€äº›ï¼Œå†ç»§ç»­æ”»éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ç ”ç©¶ï¼Œåº”è¯¥èƒ½åŠé€€90%çš„çˆ¬è™«äº†ï¼



è¿™ç¯‡æ–‡ç« å¯èƒ½æœ‰ç‚¹å«é‡‘é‡å¤ªä½ï¼Œmediumè’åºŸäº†ä¸€é˜µå­(è·‘å»ç©å•çœ¼)ï¼Œä¸»è¦ä¸ºæœ¬å‘¨å…­æ—¥(2019/09/21â€“2019/09/22)çš„ [iPlayground 2019](https://iplayground.io/2019/){:target="_blank"} æå‰çƒ­çƒ­å†™æ–‡æ‰‹æ„Ÿï¼›æœŸå¾…ä»Šå¹´çš„è®®ç¨‹ğŸ¤©ï¼Œå¸Œæœ›å›æ¥åèƒ½å¸æ”¶äº§å‡ºæ›´å¤šç²¾å“æ–‡ç« ï¼



> ***[2019/02/22 æ›´æ–°æ–‡ç« ] [iPlayground 2019 æ˜¯æ€ä¹ˆæ ·çš„ä½“éªŒï¼Ÿ](../4079036c85c2/)***



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/app%E6%9C%89%E7%94%A8https%E5%82%B3%E8%BC%B8-%E4%BD%86%E8%B3%87%E6%96%99%E9%82%84%E6%98%AF%E8%A2%AB%E5%81%B7%E4%BA%86-46410aaada00){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*