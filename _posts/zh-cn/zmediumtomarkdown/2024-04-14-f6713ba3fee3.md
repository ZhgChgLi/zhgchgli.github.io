---
author: ZhgChgLi
categories:
- ZRealm Robotic Process Automation
date: 2024-04-14T15:16:45.469+0000
description: ä½¿ç”¨ Google Apps Script è¿›è¡Œ Google Workspace ç›¸å…³æœåŠ¡ä¹‹ Robotic Process Automation
  è‡ªåŠ¨åŒ–
image:
  path: /assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg
last_modified_at: 2024-10-20T06:06:10.632+0000
render_with_liquid: false
tags:
- ios-app-development
- roboticprocessautomation
- rpa-solutions
- google-apps-script
- google-sheets
title: ä½¿ç”¨ Google Apps Script å®ç°æ¯æ—¥æ•°æ®æŠ¥è¡¨ RPA è‡ªåŠ¨åŒ–
---

### ä½¿ç”¨ Google Apps Script å®ç°æ¯æ—¥æ•°æ®æŠ¥è¡¨ RPA è‡ªåŠ¨åŒ–



ä½¿ç”¨ Google Apps Script è¿›è¡Œ Google Workspace ç›¸å…³æœåŠ¡ä¹‹ Robotic Process Automation è‡ªåŠ¨åŒ–



![Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.jpeg)



Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}



### Robotic Process Automation



RPA (Robotic Process Automation) ä¸­æ–‡ç¿»è¯‘ä¸ºã€Œæµç¨‹è‡ªåŠ¨åŒ–æœºå™¨äººã€å›é¡¾äººç±»å‘å±•å†å²ï¼Œä»å¾’æ‰‹é‡‡é›†åˆ°çŸ³å™¨æ—¶ä»£å†åˆ°å†œè€•æ–‡æ˜ï¼Œä»ä¸Šä¸ªä¸–çºªçš„å·¥ä¸šé©å‘½å¼€å§‹åˆ°è¿‘ 20 å¹´çš„èµ„è®¯å´›èµ·ï¼Œäººç±»çš„å·¥ä½œæ•ˆç‡ä¸äº§èƒ½æœ‰äº†æŒ‡æ•°çº§çš„é£è·ƒæˆé•¿ï¼›è¿™ä¸€è·¯ä¸Šæ— å¤„ä¸åœ¨ RPA åº”ç”¨çš„èº«å½±ï¼Œå†œè€•æ—¶æœŸçš„æ°´è½¦(è‡ªåŠ¨åŒ–è„±è°·å·¥ä½œ)ã€å·¥ä¸šé©å‘½çš„çººç»‡æœº(è‡ªåŠ¨åŒ–çººç»‡å·¥ä½œ)ã€å·¥å‚æœºæ¢°æ‰‹è‡‚(è‡ªåŠ¨åŒ–ç»„è£…å·¥ä½œ)ï¼Œæœ€åæ˜¯æœ¬ç¯‡è¦ä»‹ç»çš„ï¼Œè‡ªåŠ¨åŒ–èµ„è®¯ç›¸å…³å·¥ä½œï¼Œä¾‹å¦‚ï¼šè‡ªåŠ¨æŸ¥è¯¢æŠ¥è¡¨ã€è‡ªåŠ¨é€šçŸ¥â€¦ç­‰ç­‰å·¥ä½œã€‚



è¯´æ¥æƒ­æ„§ï¼Œæˆ‘ä¹Ÿæ˜¯æœ€è¿‘æ‰çŸ¥é“è¿™ä¸ªåè¯ï¼Œæ‰“ä»ä»ç¬¬ä¸€ä»½å·¥ä½œå¼€å§‹ (7 å¹´å‰)ï¼Œå°±ä¸€ç›´æœ‰åœ¨åš RPA çš„äº‹ï¼Œè¯¸å¦‚æ’°å†™çˆ¬è™«ç»Ÿè®¡æ•°æ®ã€è‡ªåŠ¨åŒ– CI/CD æµç¨‹ã€è‡ªåŠ¨åŒ–æŸ¥è¯¢æ•°æ®ã€è‡ªåŠ¨åŒ–ç¨³å®šæ€§æ•°æ®å‘Šè­¦ã€è‡ªåŠ¨åŒ–æ¯æ—¥ä¾‹è¡Œæ“ä½œâ€¦ç­‰ç­‰ï¼›ä¸è¿‡ä»¥å¾€æˆ‘éƒ½ä»¥ã€Œè‡ªåŠ¨åŒ–ã€ä¸‰ä¸ªå­—ä½œä¸ºä»£ç§°ï¼Œæ˜¯æ—¶å€™ç»™ä»–ä¸€ä¸ªæ­£åäº† â€” RPA (Robotic Process Automation)ã€‚



**ä¹‹å‰æ‰€åšçš„ RPA æ›´å¤šåªå…³æ³¨åœ¨ã€ŒåŠ¨æ‰‹å†™ç¨‹å¼å®ç°è‡ªåŠ¨åŒ–å·¥ä½œè§£å†³å•ä¸€é—®é¢˜ã€ä¸Š** ï¼Œå°‘äº†å‰æœŸçš„å®Œæ•´è¯„ä¼°ä¸åˆ†æã€No/Low Code å·¥å…·ä½¿ç”¨ã€æ³•è§„ã€è¿è¡Œç›‘æ§ã€å®é™…æ•°æ®ç»Ÿè®¡ã€æŒç»­æ”¹è¿›ã€ä¼ä¸šæ–‡åŒ–æ¨å¹¿â€¦ç­‰ç­‰ï¼Œè¿™éƒ½æ˜¯å®Œæ•´çš„ RPA éœ€è¦åšçš„äº‹ï¼›ä¸è¿‡å¦‚åŒå‰é¢æ‰€è¯´ï¼Œæˆ‘ä¹Ÿæ˜¯æœ€è¿‘æ‰çŸ¥é“è¿™ä¸ªä¸“ä¸šé¢†åŸŸï¼Œå°±å®¹æˆ‘è¿˜æ˜¯å…ˆä»¥å®ä½œæ–¹é¢æ°´ä¸€ç¯‡æ–‡ç« å§ï¼



æä¾› RPA æœåŠ¡çš„å¹³å°æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ Automation Anywhere,UiPath, Microsoft Power Automate, Blue Prism æˆ–æ˜¯ Zapier, IFTTT, Automate.io â€¦
è¦ä¾ç…§å®é™…æƒ³è§£å†³çš„é—®é¢˜ä¸å¹³å°æŒ‘é€‰é€‚åˆçš„æœåŠ¡ã€‚



æ¨èä¸€å¥—å…è´¹å¼€æºåŸºäºæµè§ˆå™¨çš„ RPA Tool: [Automa](https://chromewebstore.google.com/detail/automa/infppggnoaenmfagbfknfkancpbljcca){:target="_blank"} ã€‚



> ***å¦å¤–å¹¿ä¹‰æ¥è¯´ï¼Œå°†äººä¸äººæˆ–äººä¸äº‹çš„ä¸»åŠ¨ä¾èµ–è½¬åŒ–æˆäººå¯¹å¹³å°ã€äº‹å¯¹å¹³å°çš„ä¾èµ–ä¹Ÿæ˜¯ä¸€ç§ RPAã€‚***



> ***ä¾‹å¦‚ï¼šç»Ÿä¸€ä½¿ç”¨ Asana/Jiraâ€¦ç­‰ä¸“æ¡ˆç®¡ç†å·¥å…·ç»Ÿä¸€ç®¡ç†å·¥ä½œäº‹é¡¹ã€‚***



> ***åŸºäºä¸»åŠ¨è½¬è¢«åŠ¨çš„ç†å¿µï¼ŒåŸæœ¬éœ€è¦äººå·¥ä¸Šå»æ£€æŸ¥æœ‰æ— æ–°é€šçŸ¥çš„æœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ª RPAï¼Œå½“æœ‰æ–°å˜åŠ¨æ—¶è‡ªåŠ¨é€šçŸ¥æˆ‘ä»¬ã€‚***



> ***ä¾‹å¦‚ï¼šä¹‹å‰å®ç°è¿‡çš„ [Gmail to Slack](../d414bdbdb8c9/) å°†ç‰¹å®šé€šçŸ¥ä¿¡ä»¶è½¬å‘åˆ°å·¥ä½œç¾¤ç»„ã€‚***



#### Robotic Process Automation çš„æ•ˆç›Šè¯„ä¼°



ä¹‹å‰åœ¨ã€Œ [**2021 Pinkoi Tech Career Talk â€” é«˜æ•ˆç‡å·¥ç¨‹å›¢é˜Ÿå¤§è§£å¯†**](../11f6c8568154/) ã€åˆ†äº«è¿‡ç§¯å°‘æˆå¤šåŠå¿ƒæµä¸­æ–­çš„æˆæœ¬é—®é¢˜ï¼›å‡è®¾ä¸€ä»¶ä¾‹è¡Œé‡å¤æ€§çš„å·¥ä½œï¼Œæ¯æ¬¡éœ€è¦èŠ±è´¹ 15 åˆ†é’Ÿè§£å†³ï¼Œæ¯å‘¨ä¼šå‘ç”Ÿ 10 æ¬¡ï¼Œä¸€å¹´ä¸‹æ¥å°±æµªè´¹å°†è¿‘ 130 å°æ—¶ï¼›å¦‚æœå†ç®—ä¸Šã€Œå¿ƒæµåˆ‡æ¢ã€æˆæœ¬ï¼Œæœ€ç»ˆå¯èƒ½æµªè´¹è¿‘ 200 å°æ—¶ä¸€å¹´ã€‚



![[**2021 Pinkoi Tech Career Talk â€” é«˜æ•ˆç‡å·¥ç¨‹å›¢é˜Ÿå¤§è§£å¯†**](../11f6c8568154/)](/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.png)



[**2021 Pinkoi Tech Career Talk â€” é«˜æ•ˆç‡å·¥ç¨‹å›¢é˜Ÿå¤§è§£å¯†**](../11f6c8568154/)



> å¿ƒæµåˆ‡æ¢çš„æ„æ€æ˜¯ï¼Œå½“æˆ‘ä»¬ä¸“æ³¨åœ¨é‡è¦çš„äº‹æƒ…ä¸Šåšå¾—æ­£ High! æ—¶ï¼Œéœ€è¦æš‚åœå»å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œå¤„ç†å®Œæ¯•å†å›æ¥é‡æ–°è¿›å…¥çŠ¶æ€æ‰€è€—è´¹çš„æ—¶é—´ã€‚



å¼€å‘ RPA çš„æ•ˆç›Šè¯„ä¼°å¯å‚è€ƒä¸‹å›¾ï¼Œåªè¦å¼€å‘æ‰€éœ€æ—¶é—´è·Ÿé‡åˆ°çš„é¢‘ç‡å¤§äºæ‰€æµªè´¹çš„æ—¶é—´ï¼Œå°±å€¼å¾—æŠ•å…¥èµ„æºå®ç°ï¼š



![<https://twitter.com/swyx/status/1196401158744502272>{:target="_blank"}](/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.png)



<https://twitter.com/swyx/status/1196401158744502272>{:target="_blank"}



- X è½´ï¼šä»»åŠ¡å‘ç”Ÿé¢‘ç‡ ex: 50/Day (50æ¬¡ä¸€å¤©)


- Y è½´ï¼šä»»åŠ¡æ¯æ¬¡éœ€èŠ±è´¹å¤šå°‘äººåŠ›æ—¶é—´æ‰èƒ½å®Œæˆ


- è€—è´¹æ—¶é—´ Range æŠ“ 5 å¹´æ¥ç®—ï¼Œè¡¨æ ¼ä¸­é—´è¡¨ç¤º 5 å¹´ä¸‹æ¥æµªè´¹çš„æ—¶é—´äººåŠ›æˆæœ¬


- ç™½è‰²ä¸ºå¯èƒ½æŠ•å…¥åšè‡ªåŠ¨åŒ–çš„æ—¶é—´æˆæœ¬å¤§äºèƒ½å¾—åˆ°çš„æ•ˆç›Šï¼Œä¸å€¼å¾—æ”¹å–„


- ç»¿è‰²è¡¨ç¤ºå€¼å¾—è‡ªåŠ¨åŒ–çš„é¡¹ç›®


- çº¢è‰²ä¸ºå¼ºçƒˆå»ºè®®è½¬ä¸ºè‡ªåŠ¨åŒ–



> ***é™¤äº†èŠ‚çœæ—¶é—´ä¹‹å¤–ï¼Œè‡ªåŠ¨çš„åˆ¶å¼åŒ–æµç¨‹ä¹Ÿèƒ½å‡å°‘äººå·¥å‡ºé”™æœºç‡ï¼Œæå‡ç¨³å®šæ€§ã€‚***



#### Robotic Process Automation è·Ÿ AI çš„å…³ç³»



éšè‘— AI å…´èµ·ï¼ŒRPA ä¹Ÿç»å¸¸è¢«æåŠï¼›ä½†æˆ‘è§‰å¾— RPA ä¸ AI å¹¶æ— ç›´æ¥å…³ç³»ï¼Œ **æ²¡æœ‰ AI çš„å¹´ä»£æ—©å°±æœ‰ RPAï¼Œä¼ä¸šå¯¼å…¥ AI çš„å¸®åŠ©å¯èƒ½è¿˜æ²¡æœ‰å®Œå–„ RPA çš„æ•ˆç›Šæ¥å¾—é«˜ï¼ŒRPA æ›´å¤šçš„è¿˜æ˜¯ä¼ä¸šæ–‡åŒ–ã€å·¥ä½œä¹ æƒ¯çš„é—®é¢˜** ï¼›ä¸è¿‡ä¸å¯å¦è®¤ AI ç¡®å®èƒ½å¸®åŠ© RPA è¿ˆå‘ä¸‹ä¸€ä¸ªå±‚æ¬¡ï¼Œä¾‹å¦‚ä»¥å¾€ RPA åªèƒ½åšç¡®åˆ‡ã€ä¾‹è¡Œçš„å·¥ä½œï¼Œæœ‰äº† AI å°±èƒ½åšä¸€äº›æ¨¡ç³Šçš„ã€è¾ƒåŠ¨æ€çš„ã€æ™ºèƒ½åˆ¤æ–­çš„å·¥ä½œã€‚



### Robotic Process Automation at Google Workspace



Google Workspace (æ—§ç§° G Suite)ï¼Œæ˜¯æˆ‘ä»¬æ—¥å¸¸åŠå…¬åä½œçš„å¥½ä¼™ä¼´ï¼Œä¿¡ç®±ä½¿ç”¨ Gmail æ‰˜ç®¡ã€æ–‡ä»¶æ”¾åœ¨ Google Docã€æŠ¥è¡¨ä½¿ç”¨ Google Sheetã€è¡¨å•ä½¿ç”¨ Google Formâ€¦ç­‰ç­‰ï¼Œè¿™äº›æœåŠ¡ä¹‹é—´çš„ä¸²æ¥æˆ–æ˜¯ä¸å†…å¤–éƒ¨ç³»ç»Ÿçš„æ²Ÿé€šï¼Œéƒ½éœ€è¦æˆ‘ä»¬å®ç° RPA æ¥å®Œæˆã€‚



ä½† Google å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„ RPA æœåŠ¡ï¼Œå¯ä»¥é€è¿‡ä»¥ä¸‹å‡ ä¸ªæœåŠ¡è¾¾æˆï¼š



- No Codeï¼š [App Sheet](https://cloud.google.com/appsheet#pricing){:target="_blank"} (ä»˜è´¹æœåŠ¡)ï¼Œè®©éå¼€å‘äººå‘˜ç›´æ¥é€è¿‡ GUI æ­å»ºæœåŠ¡ä¸²æ¥è‡ªåŠ¨åŒ–ã€‚


- Low Codeï¼š [Google Apps Script](https://www.google.com/script/start/){:target="_blank"} (å…è´¹æœåŠ¡)ï¼Œç®€å•æ’°å†™ç¨‹å¼å°±èƒ½å¿«é€Ÿç›´æ¥çš„æ¡¥æ¥ Google æœåŠ¡ã€å¤–éƒ¨/å†…éƒ¨ç³»ç»Ÿã€‚


- Function as a Serviceï¼š [Cloud Functions](https://cloud.google.com/functions?hl=zh_tw){:target="_blank"} (ä»˜è´¹æœåŠ¡ï¼Œæä¾›å…è´¹é¢åº¦)ï¼Œæ’°å†™å®Œæ•´ç¨‹å¼ç ã€æœåŠ¡ï¼Œé€è¿‡ Google Cloud éƒ¨ç½²ç›´æ¥æ‰§è¡Œã€‚



No Code å¹³å° [App Sheet](https://cloud.google.com/appsheet#pricing){:target="_blank"} æˆ‘æ²¡æ¥è§¦è¿‡ï¼Œ [Cloud Functions](https://cloud.google.com/functions?hl=zh_tw){:target="_blank"} ä¸ [Google Apps Script](https://www.google.com/script/start/){:target="_blank"} ç®—è›®æœ‰ç»éªŒçš„ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¸ªäººä¹‹å‰çš„ä½¿ç”¨ä¸é€‰æ‹©ç»éªŒåˆ†äº«ï¼š



#### Cloud Functions



- éœ€éƒ¨ç½²æ‰§è¡Œ


- æ”¯æ´ä½¿ç”¨å¤šç§ç¨‹å¼è¯­è¨€æ’°å†™ï¼šNode.js, Python, Java, Go, PHP, Rubyâ€¦


- æ”¯æ´ç¬¬ä¸‰æ–¹å¥—ä»¶ä¾èµ–ç®¡ç†ã€å®‰è£…å¹¶ä½¿ç”¨


- æ”¯æ´å®Œæ•´èº«ä»½éªŒè¯æœºåˆ¶


- æœ€å¤šæ‰§è¡Œæ—¶é—´ä¸Šé™ï¼š 60 åˆ†é’Ÿ


- ç”¨å¤šå°‘ç®—å¤šå°‘ï¼šä¾ç…§æ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ã€ä¸åŒå¤„ç†å™¨ã€ä½¿ç”¨çš„è®°å¿†ä½“æ”¶è´¹


- å—é™å†·å¯åŠ¨é—®é¢˜(å¤ªä¹…æ²¡å‘¼å«ï¼Œå†æ¬¡å‘¼å«ï¼Œç¬¬ä¸€æ¬¡ä¼šéœ€è¦è¾ƒé•¿å“åº”æ—¶é—´)


- æ— æ³•ç›´æ¥ä¸²æ¥ Google æœåŠ¡ï¼Œéœ€è¦èµ° Auth/API éªŒè¯


- **å…è´¹æ–¹æ¡ˆå¦‚ä¸‹**
  Cloud Functions é’ˆå¯¹è¿ç®—æ—¶é—´èµ„æºæä¾›æ°¸ä¹…å…è´¹æ–¹æ¡ˆï¼Œå½“ä¸­åŒ…æ‹¬ GB/ç§’å’Œ GHz/ç§’çš„åˆ†é…æ–¹å¼ã€‚é™¤äº† 200 ä¸‡æ¬¡å«ç”¨ä»¥å¤–ï¼Œè¿™ä¸ªå…è´¹æ–¹æ¡ˆä¹Ÿæä¾› 400,000 GB/ç§’å’Œ 200,000 GHz/ç§’çš„è¿ç®—æ—¶é—´ï¼Œä»¥åŠæ¯æœˆ 5 GB çš„ç½‘é™…ç½‘è·¯èµ„æ–™ä¼ è¾“é‡ã€‚å…è´¹æ–¹æ¡ˆçš„ä½¿ç”¨é¢åº¦ï¼Œæ˜¯ä»¥ä¸Šè¿°çº§åˆ« 1 ä»·æ ¼çš„åŒç­‰ç¾å…ƒé‡‘é¢è®¡ç®—ã€‚æ— è®ºæ‰§è¡Œå‡½å¼çš„åŒºåŸŸé‡‡ç”¨çš„æ˜¯çº§åˆ« 1 å’Œ/æˆ–çº§åˆ« 2 ä»·æ ¼ï¼Œç³»ç»Ÿéƒ½ä¼šåˆ†é…åŒç­‰ç¾å…ƒé‡‘é¢ç»™æ‚¨ã€‚ä¸è¿‡åœ¨æ‰£é™¤å…è´¹æ–¹æ¡ˆçš„é¢åº¦æ—¶ï¼Œç³»ç»Ÿå°†ä»¥å‡½å¼æ‰§è¡ŒåŒºåŸŸçš„çº§åˆ« (çº§åˆ« 1 æˆ–çº§åˆ« 2) ä¸ºå‡†ã€‚
  è¯·æ³¨æ„ï¼Œå³ä¾¿æ‚¨é‡‡ç”¨çš„æ˜¯å…è´¹æ–¹æ¡ˆï¼Œä¹Ÿå¿…é¡»æ‹¥æœ‰æœ‰æ•ˆçš„å¸å•å¸æˆ·ã€‚



æ€»ç»“æ¥è¯´ï¼ŒCloud Functions å¯ä»¥æä¾›è¾ƒå®Œæ•´ä¸å¤æ‚çš„ RPA ä¸²æ¥åŠŸèƒ½æˆ–æ˜¯æœ‰è¾ƒå¤šçš„å¤–éƒ¨ API ä¸²æ¥éœ€æ±‚æ—¶æ¯”è¾ƒå»ºè®®ä½¿ç”¨ Cloud Functionsã€‚



ä¹‹å‰ä½¿ç”¨è¿‡ Cloud Functions çš„æ¡ˆä¾‹æœ‰ï¼š



- [Slack ChatGPT å¯¹è¯æœºå™¨äºº]ï¼š [Slack & ChatGPT Integration](../bd94cc88f9c9/)


- [è‡ªåŠ¨ç­¾åˆ°æœºå™¨äºº]ï¼š [ä½¿ç”¨ Python+Google Cloud Platform+Line Bot è‡ªåŠ¨æ‰§è¡Œä¾‹è¡Œçäº‹](../70a1409b149a/)



éƒ½æ˜¯ä¸é Google Workspace æœåŠ¡æ•´åˆä¸”é¡»æ¡¥æ¥å…¶ä»–å¤–éƒ¨æœåŠ¡æ—¶æˆ‘ä¼šä½¿ç”¨ã€‚



#### Google Apps Script



- æ–¹ä¾¿ç®€å•å¿«é€Ÿ


- å®Œå…¨å…è´¹


- ä¸²æ¥æœåŠ¡æ— éœ€ç¹çå¤æ‚çš„ Auth èº«ä»½éªŒè¯
  (Google Apps Script æ˜¯ç›´æ¥ä½¿ç”¨å½“å‰æ‰§è¡Œçš„å¸å·åšä¸ºæ‰§è¡Œèº«ä»½)


- å†…å»ºæ’ç¨‹ã€è¡Œäº‹å†è§¦å‘å™¨åŠŸèƒ½


- ä½¿ç”¨ Google ç½‘è·¯æ‰§è¡Œç½‘è·¯è¯·æ±‚


- åªèƒ½ä½¿ç”¨ Google Apps Script (åŸºäº JavaScript) çš„è¯­è¨€å¼€å‘


- ä¸æ”¯æ´å¥—ä»¶ç®¡ç†å·¥å…·ã€æ— ç‰ˆæ§åŠŸèƒ½


- **åŸºäºå®‰å…¨é—®é¢˜ï¼Œ [æ— æ³•å®¢åˆ¶åŒ– Request User-Agent èµ„è®¯](https://issuetracker.google.com/issues/36758197){:target="_blank"}**


- **æ‰§è¡Œæ—¶é—´ä¸Šé™ï¼Œè„šæœ¬å¿…é¡»åœ¨ 6 åˆ†é’Ÿå†…å®Œæˆå·¥ä½œï¼Œå¦åˆ™ä¼šè¢«ç»ˆæ­¢ã€‚**


- å…¶ä»–é™åˆ¶ä¸é…é¢è¯·å‚è€ƒå®˜æ–¹çš„ [GAS èµ„è®¯](https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw){:target="_blank"} ï¼š



![](/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.png)



![](/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.png)



ä¹‹å‰ä½¿ç”¨è¿‡ Google Apps Script çš„æ¡ˆä¾‹æœ‰ï¼š



- [ä¸²æ¥ Slack x Google Form x Google Sheet]ï¼š [Slack æ‰“é€ å…¨è‡ªåŠ¨ WFH å‘˜å·¥å¥åº·çŠ¶å†µå›æŠ¥ç³»ç»Ÿ](../d61062833c1a/)


- [ä¸²æ¥ Slack x Gmail]ï¼š [è¿ç”¨ Google Apps Script è½¬å‘ Gmail ä¿¡ä»¶åˆ° Slack](../d414bdbdb8c9/)


- [ä¸²æ¥ Google Analytics x Slack]ï¼š [Crashlytics + Google Analytics è‡ªåŠ¨æŸ¥è¯¢ App Crash-Free Users Rate](../793cb8f89b72/)


- [ä¸²æ¥ Firebase Crashlytics x Big Query x Slack]ï¼š [Crashlytics + Big Query æ‰“é€ æ›´å³æ—¶ä¾¿åˆ©çš„ Crash è¿½è¸ªå·¥å…·](../e77b80cc6f89/)


- [ä¸²æ¥ Github x LineBot]ï¼š [ä½¿ç”¨ Google Apps Script ä¸‰æ­¥éª¤å…è´¹å»ºç«‹ Github Repo Star Notifier](../382218e15697/)



å—é™äºæ‰§è¡Œæ—¶é—´ä¸ API Request å®¢åˆ¶åŒ–é™åˆ¶ï¼Œåªæœ‰ç®€å•å¿«é€Ÿçš„æœåŠ¡æˆ‘ä¼šä½¿ç”¨ Google Apps Script è¾¾æˆï¼›æˆ–æ˜¯éœ€è¦ä¸ Google æœåŠ¡ä¸²æ¥çš„éœ€æ±‚ï¼Œæˆ‘ä¼šä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ Google Apps Script (å› ä¸ºç”¨ Cloud Functions è¦å¤šå®ç°å®Œæ•´çš„ Google æœåŠ¡èº«ä»½éªŒè¯æµç¨‹)ã€‚



### Robotic Process Automation with Google Apps Script â€” å·¥ä½œæ—¥æŠ¥è¡¨ (Google Sheet x Google Analytics)



ç»ˆäºæ¥åˆ°æœ¬ç¯‡çš„ä¸»é¢˜ï¼Œä½¿ç”¨ Google Apps Script å®ç° Google æœåŠ¡ RPA è‡ªåŠ¨åŒ–ã€‚



#### èƒŒæ™¯



äº§å“å›¢é˜Ÿéœ€è¦æ¯æ—¥æŸ¥è¯¢ Google Analytics æ•°æ®å¹¶å¡«å†™åˆ° Google Sheet æ•°æ®æŠ¥è¡¨ä¸Šï¼Œå…±å›¢é˜Ÿåˆ†æè¶‹åŠ¿ä½¿ç”¨ï¼›å¹¶å°†æ¯æ—¥æ•°æ®å†…å®¹å‘å¸ƒåˆ° Dashboard è¤å¹•ä¸Šï¼Œè®©æ‰€æœ‰æˆå‘˜æŒæ¡ç›®å‰çŠ¶å†µã€‚



åŒäº‹æ¯æ—¥ä¸€åˆ°å…¬å¸å°±è¦èŠ±å¤§çº¦ 30 åˆ†é’Ÿå·¦å³å®Œæˆæ­¤ä»»åŠ¡ï¼›å¦‚æœæœ‰å…¶ä»–äº‹è¦å¤„ç†å°±éœ€è¦ç­‰åˆ°è¿™ä»¶ä¾‹è¡Œå·¥ä½œå®Œæˆæ‰ä¼šå¼€å§‹æˆ–ä¼šå»¶åå‘å¸ƒæ¯æ—¥æ•°æ®è®¯æ¯ã€‚



**ç®€å•ä¼°è®¡ä¸€ä¸‹ RPA æ•ˆç›Šï¼š**



- æ¯å¹´æ¶ˆè€—æ”¯å‡ºï¼š
  1 äºº x 30 mins x 365 å¤©(å‡æ—¥æ•°æ®ä¹Ÿè¦è¡¥) **= 182 hours**


- å»ºç«‹è‡ªåŠ¨åŒ–æˆæœ¬ï¼š
  ä»¥æ­¤æ¡ˆä¾‹æ¥è¯´ï¼Œçº¦éœ€è€—è´¹ 1 äºº x 5å¤© **= 40 hours**



> å› æ­¤æˆ‘ä»¬åªéœ€è¦æŠ•å…¥ä¸€å‘¨å¼€å‘æ—¶é—´ï¼Œå°±èƒ½é•¿è¿œè§£å†³è´Ÿè´£æŸ¥æ•°æ®åŒäº‹çš„å·¥ä½œæ¶ˆè€—ï¼Œä»–å°±å¯ä»¥æŠŠç²¾åŠ›æ”¾åœ¨æ›´é‡è¦çš„äº‹æƒ…ä¸Šã€‚



#### ç›®æ ‡



æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ Google Apps Script å»ºç«‹ä¸€ä¸ª RPA è‡ªåŠ¨ä» Google Analytics ä¸å†…éƒ¨ç³»ç»ŸæŠ¥è¡¨ API æå–æ¯æ—¥æ•°æ®å¹¶å¡«å…¥ Google Sheetï¼Œä¸æ­å»ºä¸€ä¸ª Web UI Dashboardã€‚



#### æœ€ç»ˆæ•ˆæœ



![](/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.png)



- Google Sheet:
  <https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing>{:target="_blank"}



![](/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png)



- Web GUI URL:
  <https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec>{:target="_blank"}



> ***æ•°æ®ä¸ºå‡æ•°æ®ï¼Œçº¯ Demo ä½¿ç”¨ï¼›ä» 2024/04/13 å¼€å§‹ä¼šç‰¹åˆ«ä½æˆ–éƒ½ä¿æŒåœ¨ 0ï¼Œå› ä¸ºæˆ‘çš„ zhgchg.li GA çœŸçš„æ˜¯ã€Œ0ã€æµé‡ Q_Qã€‚***



#### éœ€å®Œæˆçš„ä»»åŠ¡



1. å»ºç«‹ Google Apps Scriptã€ç†Ÿæ‚‰ç¼–è¾‘å™¨


2. å–å¾—/å»ºç«‹å¯¹åº”æ—¥æœŸçš„ Sheet


3. ä¸²æ¥ Google Analytics æå–æ•°æ®


4. å¡«å……èµ„æ–™


5. è®¾å®šæ’ç¨‹ï¼Œæ¯æ—¥è‡ªåŠ¨æ‰§è¡Œ



#### å£°æ˜



å› æ–‡ç« è¯´æ˜éœ€æ±‚ï¼Œä»¥ä¸‹ç¨‹å¼ç ä¼šå°½å¯èƒ½å°‘ä¸€ç‚¹æŠ½è±¡ï¼Œå¢åŠ è¯´æ˜æ€§ï¼Œæ‚¨å¯ä¾ç…§è‡ªå·±å®é™…çš„éœ€æ±‚è¿›è¡Œæ”¹å†™ã€‚



> ***æ–‡æœ«æœ‰é™„ä¸Šå®Œæ•´å…¬å¼€çš„ Google Sheet & Google Apps Scriptï¼Œå¦‚æœä½ æ‡’å¾—ä¸€æ­¥ä¸€æ­¥èµ°ï¼Œå¯ä»¥ç›´æ¥ä»æ–‡æœ«é™„çš„èŒƒæœ¬å»ä¿®æ”¹ã€‚***



#### Step 1. å»ºç«‹ Google Apps Script



![](/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.png)



åªéœ€åœ¨æˆ‘ä»¬è¦å¯¼å…¥è‡ªåŠ¨åŒ–çš„æŠ¥è¡¨ä¸Šé€‰æ‹©ã€Œæ‰©å……åŠŸèƒ½ã€-&gt;ã€ŒApps Scriptã€å°±èƒ½è‡ªåŠ¨å»ºç«‹ä¸ Google Sheet æŠ¥è¡¨è¿ç»“çš„ Google Apps Scriptã€‚



å¦å¤–ä¹Ÿå¯ä»¥ç›´æ¥ä» Google Apps Script é¦–é¡µå»ºç«‹ [Google Apps Script](https://www.google.com/script/start/){:target="_blank"} ï¼Œä¸è¿‡è¿™æ ·å°±ä¸ä¼šä¸ Google Sheet äº§ç”Ÿè¿ç»“ã€‚



> **å¹¶ééœ€è¦è¿ç»“æ‰èƒ½æ“ä½œå¯¹åº” Google Sheet** ï¼Œä¸¤ç§å»ºç«‹æ–¹å¼éƒ½å¯ä»¥ï¼Œå·®åˆ«åœ¨äº Script çš„æ‰€æœ‰æƒå½’äºè°ï¼Œå¦‚æœæ˜¯è¿ç»“æŠ¥è¡¨çš„å°±æ˜¯å½’æŠ¥è¡¨æ‹¥æœ‰è€…ï¼Œå¦‚æœæ˜¯è‡ªå·±å»ºç«‹çš„å°±æ˜¯å½’å»ºç«‹è‘—ï¼›æ‹¥æœ‰è€…ä¼šå…³ç³»åˆ°å‡è®¾è¯¥å¸å·å› ç¦»èŒåœç”¨ï¼Œè„šæœ¬æ˜¯å¦ä¼šå¤±æ•ˆè¢«åˆ é™¤ã€‚



![](/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.png)



è„šæœ¬å»ºç«‹åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»ä¸Šæ–¹ Rename æˆ‘ä»¬çš„è„šæœ¬ä¸“æ¡ˆåç§°ã€‚



#### Google Apps Script åŸºç¡€çŸ¥è¯†



å†åˆ°ä¸‹ä¸€æ­¥æ’°å†™ç¨‹å¼ä¹‹å‰ï¼Œå…ˆè¡¥å……ä¸€äº› Google Apps Script çš„åŸºç¡€çŸ¥è¯†ã€‚



**å…³äºç¼–è¾‘å™¨**



é¢„è®¾å¼•å…¥ Google æœåŠ¡çš„ SDK (ä¸éœ€ç‰¹åˆ«å¼•å…¥å³å¯å‘¼å«ä½¿ç”¨)ï¼š



- CalendarApp è¡Œäº‹å†


- DocumentApp Google Drive


- FormApp Google Form


- SpreadsheetApp Google Sheet


- GmailApp Gmail


- [å…¶ä»–â€¦](https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle){:target="_blank"}



![](/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.png)



1. æ¡£æ¡ˆï¼š
   å¯æ–°å¢å¤šä¸ª .gs æ¡£æ¡ˆå­˜æ”¾ä¸åŒç‰©ä»¶ç¨‹å¼ç ï¼Œæ–¹ä¾¿æ•´ç†ï¼›æ‰€æœ‰æ¡£æ¡ˆéƒ½ä¼šåœ¨åŒä¸ª Namespaceã€ç”Ÿå‘½å‘¨æœŸä¸‹æ‰§è¡Œï¼Œå› æ­¤è¦æ³¨æ„ç‰©ä»¶åç§°ã€å˜æ•°åç§°å¦‚æœé‡å¤å¯èƒ½ä¼šäº’ç›¸è¦†ç›–ã€‚
   é™¤ .gs æŒ‡ä»¤ç  æ¡£æ¡ˆå¤–ï¼Œä¹Ÿèƒ½æ–°å¢ .html HTML Template æ¡£æ¡ˆï¼Œç”¨äºæ¸²æŸ“ Web UIã€‚(åé¢ä¼šå†ä»‹ç»)


2. èµ„æ–™åº“ï¼š
   åˆ«äººæ’°å†™å¥½çš„èµ„æ–™åº“ (a.k.a Lib) æˆ‘ä»¬å¯ä»¥é€è¿‡ä»–çš„ Script ID å¼•å…¥ä½¿ç”¨ï¼Œå½“ç„¶æˆ‘ä»¬æ’°å†™å¥½çš„ç¨‹å¼ä¹Ÿèƒ½éƒ¨ç½²æˆèµ„æ–™åº“ç»™åˆ«äººç”¨ã€‚
   å¦å¤–ä¹Ÿæœ‰ä¸€äº›å¤§ç¥å¸®å¿™å°è£…çš„å·¥å…·å¯ä»¥ç”¨ï¼Œç¼ºç‚¹æ˜¯åªèƒ½ä» Google æœå¯» Script IDï¼Œå®˜æ–¹å¹¶æ²¡æœ‰æ­£å¼çš„èµ„æ–™åº“åˆ—è¡¨å…±æŸ¥è¯¢ä½¿ç”¨ã€‚
   e.g. HTML Parser Tool Cheer.io Script ID: `1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0`


3. æœåŠ¡ï¼š
   Google æœåŠ¡çš„ SDKï¼Œé¢„è®¾æ²¡æœ‰å¼•å…¥çš„æœåŠ¡å¯ä»¥å†æ­¤è¿½åŠ å¼•å…¥ä½¿ç”¨ã€‚
   e.g. Google Analytics Data


4. è¿˜åŸã€ä¸‹ä¸€æ­¥æ“ä½œ


5. å‚¨å­˜ æˆ– Control + s


6. æ‰§è¡Œ æˆ– Control + r
   é‡åˆ°é”™è¯¯ç›´æ¥åœ¨ Console æç¤ºå¹¶ç»ˆæ­¢è„šæœ¬


7. ä¾¦é”™
   æœ‰ä¸‹ Break point (10) çš„åœ°æ–¹æ‰§è¡Œåˆ°ä¼šæš‚åœä¸­æ–­å¹¶è·³å‡ºå³ä¾§ Debug Viewï¼Œå¯æŒ‰ç»§ç»­æ‰§è¡Œ
   é‡åˆ°é”™è¯¯ä¼šæš‚åœä¸­æ–­å¹¶è·³å‡ºå³ä¾§ Debug View


8. ä¾¦é”™ã€æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•(Function Name)
   ä»…èƒ½é€‰æ‹©å½“å‰é€‰æ‹©çš„æ¡£æ¡ˆæ‰€æ‹¥æœ‰çš„æ–¹æ³•ã€‚


9. æŸ¥çœ‹ç¼–è¾‘å™¨æ‰§è¡Œçºªå½•



> *å¦å¤–è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯æ’ç‰ˆï¼Œæœ‰çš„æµè§ˆå™¨æŒ‰ä¸‹ã€ŒControl + [ã€è¿›è¡Œç¼©æ’æ—¶ä¼šè§¦å‘è¿”å›ä¸Šä¸€é¡µï¼Œè¿™ç‚¹è¦æ³¨æ„ï¼*



[**Google Apps Script GitHub Assistant Chrome Extension ç‰ˆæ§å¤–æŒ‚**](https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo){:target="_blank"}



- å»ºè®®å®‰è£…æ­¤ Extension è®© Google Apps Script ä¸ git ä¸²æ¥ï¼Œä½¿å…¶æœ‰ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œé˜²æ­¢å¿ƒè¡€ä¸å°å¿ƒæ”¹åã€‚



![](/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.png)



![](/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.png)



![](/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.png)



- å¦‚æœé‡åˆ° Push/Pull Error æˆ–ç‚¹äº†æ²¡ååº”ï¼Œè¯·å…ˆæŒ‰ç…§ä¸Šé¢æ­¥éª¤ã€Œé€‰é¡¹ã€-&gt; è¿æ¥ Github or é‡æ–°éªŒè¯ä¸€æ¬¡ Google æˆæƒï¼Œå³å¯ã€‚



**Logger Message**



å¯ä½¿ç”¨ä»¥ä¸‹ Script æ­é… Debug å°±èƒ½åœ¨åº•ä¸‹ Console Print å‡º Debug Logã€‚



```javascript
Logger.log("Hi")
```



**æ‰§è¡Œçºªå½•ã€é”™è¯¯èµ„è®¯**



å¦‚æœåœ¨ç¼–è¾‘å™¨ä¸Šæ‰§è¡Œæ—¶çš„ Log æˆ–æŠ¥é”™ä¼šç›´æ¥æ˜¾ç¤ºï¼Œå¦‚æœè¦æŸ¥è®¯æ‰§è¡Œçºªå½•æˆ–è‡ªåŠ¨æ‰§è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯ï¼Œå¯åˆ°ã€Œæ‰§è¡Œé¡¹ç›®ã€é¡µç­¾æŸ¥çœ‹ã€‚



![](/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png)



**è‡ªåŠ¨è§¦å‘**



![](/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.png)



![](/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.png)



ã€Œè§¦å‘æ¡ä»¶ã€é¡µç­¾å¯è®¾å®šè„šæœ¬ä¸­çš„æ–¹æ³•è¯¥å¦‚ä½•è‡ªåŠ¨è§¦å‘æ‰§è¡Œï¼Œå¯ä»¥è®¾å®šçš„è‡ªåŠ¨è§¦å‘æ¡ä»¶æœ‰ï¼š



- å½“ Google Sheetï¼šå¼€å¯æ—¶ã€ç¼–è¾‘æ—¶ã€å†…å®¹å˜æ›´æ—¶ã€æäº¤è¡¨å•æ—¶ æ‰§è¡Œ


- æ’ç¨‹å‘¨æœŸè§¦å‘ï¼šæ¯ X åˆ†é’Ÿã€X å°æ—¶ã€X æ—¥ã€X å‘¨ã€X æœˆ æ‰§è¡Œä¸€æ¬¡


- ç‰¹å®šæ—¥æœŸè§¦å‘ï¼šYYYY-MM-DD HH:MM æ—¶æ‰§è¡Œ


- å½“ è¡Œäº‹å†ï¼šæ›´æ–°æ—¶ æ‰§è¡Œ



é”™è¯¯é€šçŸ¥è®¾å®šï¼Œå¯è®¾å®šå½“è„šæœ¬æ‰§è¡Œå‡ºé”™æ—¶å¦‚ä½•é€šçŸ¥ä½ ã€‚



**æˆäºˆæ‰§è¡Œæƒé™èº«ä»½**



> ***é¦–æ¬¡æ‰§è¡Œ/éƒ¨ç½²æˆ–æ–°å¢å¼•å…¥çš„æœåŠ¡ã€èµ„æºï¼Œéƒ½éœ€è¦é‡æ–°è·‘ä¸€æ¬¡èº«ä»½æˆæƒï¼Œæˆæƒå®Œä¹‹åçš„æ‰§è¡Œéƒ½ä¼šç”¨ä½ æˆæƒçš„èº«ä»½æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿè¦ç¡®ä¿ä½ æˆæƒ(é€šå¸¸æ˜¯å½“å‰)çš„å¸å·æœ‰è¯¥èµ„æºã€æœåŠ¡çš„æƒé™ã€‚(e.g. ä¾‹å¦‚è¦æœ‰è¯¥ Google Sheet æƒé™)ã€‚***



è·³å‡ºå¸å·é€‰æ‹© Pop-up åé€‰æ‹©æˆæƒæ‰§è¡Œçš„å¸å·(é€šå¸¸æ˜¯é€‰å½“å‰ Google Apps Script å¸å·)ï¼š



![](/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.png)



å‡ºç°ã€ŒGoogle hasnâ€™t verified this appã€å› ä¸ºæˆ‘ä»¬è¦å¼€å‘çš„ App æ˜¯ç»™è‡ªå·±ç”¨çš„ï¼Œä¸éœ€ç»è¿‡ Google éªŒè¯ã€‚



ç›´æ¥ç‚¹å‡»ã€ŒAdvancedã€-&gt;ã€ŒGo to XXX (unsafe)ã€-&gt;ã€ŒAllowã€å³å¯ï¼š



![](/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.png)



![](/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.png)



![](/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.png)



å®Œæˆæˆæƒåå°±èƒ½æˆåŠŸæ‰§è¡Œè„šæœ¬ï¼Œå¦‚æœæ²¡æœ‰æ”¹åŠ¨èµ„æºä¸éœ€è¦å†é‡æ–°æˆæƒã€‚



#### 2. å–å¾—/å»ºç«‹å¯¹åº”æ—¥æœŸçš„ Sheet



äº†è§£å®ŒåŸºç¡€çŸ¥è¯†åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ’°å†™ç¬¬ä¸€ä¸ªåŠŸèƒ½çš„ç¨‹å¼äº†ã€‚



æˆ‘ä»¬å»ºç«‹ä»¥ä¸‹å¤šä¸ªæ¡£æ¡ˆæ–¹ä¾¿æˆ‘ä»¬å­˜æ”¾ä¸åŒç‰©ä»¶



`DailyReportStyle.gs` æ ä½æ ·å¼ç‰©ä»¶ï¼š



```javascript
class HeaderStyle {
  constructor() {
    this.color = "#ffffff";
    this.backgroundColor = "#e3284b";
    this.bold = false;
    this.size = 12;
    this.horizontalAlignment = "center";
    this.verticalAlignment = "middle";
  }
}

class ContentStyle {
  constructor() {
    this.color = "#000000";
    this.backgroundColor = "#ffffff";
    this.bold = false;
    this.size = 12;
    this.horizontalAlignment = "center";
    this.verticalAlignment = "middle";
  }
}

class HeaderDateStyle {
  constructor() {
    this.color = "#ffffff";
    this.backgroundColor = "#001a40";
    this.bold = true;
    this.size = 12;
    this.horizontalAlignment = "center";
    this.verticalAlignment = "middle";
  }
}
```



`DailyReportField.gs` æ ä½èµ„æ–™ç‰©ä»¶ï¼š



```javascript
class DailyReportField {
  constructor(name, headerStyle, contentStyle, format = null, value = null) {
    this.name = name;
    this.headerStyle = headerStyle;
    this.contentStyle = contentStyle;
    this.format = format;
    this.value = value;
  }
}
```



`DailyReport.gs` æŠ¥è¡¨ä¸»ç¨‹å¼é€»è¾‘ï¼š



```javascript
class DailyReport {
  constructor(sheetID, date) {
    this.separateSheet = SpreadsheetApp.openById(sheetID);
    this.date = date;

    this.sheetFields = [
      new DailyReportField("æ—¥æœŸ", new HeaderDateStyle(), new HeaderDateStyle()),
      new DailyReportField("æ˜ŸæœŸ", new HeaderDateStyle(), new HeaderDateStyle()),
      new DailyReportField("æ—¥æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&5)'), // =4(PC æµé‡) + 5(Mobile æµé‡)
      new DailyReportField("PC æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0"),
      new DailyReportField("Mobile æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0"),
      new DailyReportField("æ³¨å†Œæ•°", new HeaderStyle(), new ContentStyle(), "#,##0")
    ]

    // æ—¥æµé‡å…¬å¼åˆ†è§£è¯´æ˜ï¼š
    // 1. COLUMN() å‡½æ•°ä¼šå›ä¼ ç›®å‰å•å…ƒæ ¼çš„åˆ—å·ç ã€‚
    // 2. ADDRESS(1, COLUMN(), 4) ä¼šä»¥ç»™å®šçš„è¡Œæ•°ï¼ˆ`COLUMN()` çš„ç»“æœï¼‰å’Œå›ºå®šçš„åˆ—æ•°ï¼ˆ1ï¼‰æ¥ç”Ÿæˆä¸€ä¸ªç»å¯¹å¼•ç”¨çš„åœ°å€ã€‚å…¶ä¸­ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° 4 è¡¨ç¤ºä¸å¸¦ä»»ä½•ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰çš„ç›¸å¯¹åœ°å€ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ åœ¨ç¬¬ä¸‰åˆ—çš„ä»»ä½•å•å…ƒæ ¼ä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šå›ä¼  "C1"ã€‚
    // 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") ä¼šå°† ADDRESS å‡½æ•°äº§ç”Ÿçš„åœ°å€ä¸­çš„æ•°å­— 1 ç§»é™¤ï¼Œå› æ­¤åªä¿ç•™äº†åˆ—çš„è‹±æ–‡å­—æ¯ï¼Œæ¯”å¦‚ï¼š"C"ã€‚
    // 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") & 4) è¿™è¾¹ & 4 å…¶å®åº”è¯¥æ˜¯ &4ã€‚`SUBSTITUTE` å‡½æ•°çš„ç»“æœä¼šå’Œæ•°å­— 4 è¿æ¥ï¼Œå½¢æˆ "C4" è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œç„¶å INDIRECT å‡½æ•°ä¼šå°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆå¯¹åº”çš„å•å…ƒæ ¼å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨åˆ— C ä¸­çš„ä»»ä½•å•å…ƒæ ¼ä½¿ç”¨æ­¤å…¬å¼ï¼Œå®ƒä¼šå¼•ç”¨ C4ã€‚
    // 5. ç±»ä¼¼åœ°ï¼Œ`INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") & 5)` ä¼šå¼•ç”¨ç›¸åŒåˆ—çš„ç¬¬äº”è¡Œçš„å•å…ƒæ ¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ åœ¨åˆ— C ä¸­çš„ä»»ä½•å•å…ƒæ ¼ä½¿ç”¨æ­¤å…¬å¼ï¼Œå®ƒä¼šå¼•ç”¨ C5ã€‚
    // 6. æœ€åï¼Œè¿™ä¸¤ä¸ª INDIRECT å‡½æ•°å¼•ç”¨çš„å•å…ƒæ ¼å€¼ç›¸åŠ ã€‚
  }

  execute() {
    const sheet = this.getSheet();

  }

  // å–å¾—ç»™å®šæ—¥æœŸçš„ç›®æ ‡ Sheet
  getSheet() {
    // ä»¥æœˆæ¥åŒºåˆ† Sheetï¼Œæ‰¾åˆ°å½“æœˆ Sheet
    var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName());
    if (thisMonthSheet == null) {
      // æ— åˆ™å»ºç«‹æ–°çš„æœˆ Sheet
      thisMonthSheet = this.makeMonthSheet();
    }

    return thisMonthSheet;
  }

  // æœˆ Sheet å‘½åè§„åˆ™
  getSheetName() {
    return Utilities.formatDate(this.date, "GMT+8", "yyyy-MM");
  }

  // å»ºç«‹æ–°çš„æœˆ Sheet
  makeMonthSheet() {
    // æ–°å¢å½“æœˆ Sheetï¼Œç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªä½å­
    var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0});
    thisMonthSheet.activate();
    this.separateSheet.moveActiveSheet(1);

    // æ–°å¢ç¬¬ä¸€æ ï¼Œæ ä½åç§°ã€è®¾å®š Pinnedã€å®½åº¦ 200
    thisMonthSheet.insertColumnsBefore(1, 1);
    thisMonthSheet.setFrozenColumns(1);
    thisMonthSheet.setColumnWidths(1, 1, 200);

    // å¡«å……æ ä½åç§°
    for(const currentRow in this.sheetFields) {
      const sheetField = this.sheetFields[currentRow];
      const text = sheetField.name;
      const style = sheetField.headerStyle;
      
      const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1);
      this.setContent(range, text, style);
      range.setHorizontalAlignment("left");
    }

    // è®¾å®šæ é«˜
    thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30);

    // è®¾å®š Pinned ç¬¬ä¸€ã€äºŒåˆ—(æ—¥æœŸã€æ˜ŸæœŸ)
    thisMonthSheet.setFrozenRows(2);

    // æ–°å¢æ€»è®¡æ ä½
    thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // æ–°å¢ä¸€æ åœ¨æœ€åä¸€æ 
    const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1;

    // å¡«å……æ€»è®¡æ ä½
    for(const currentRow in this.sheetFields) {
      const sheetField = this.sheetFields[currentRow];
      const summaryRowIndex = parseInt(currentRow) + 1;

      const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex);
      const style = sheetField.contentStyle;

      if (summaryRowIndex == 1) {
        // æ—¥æœŸ...
        this.setContent(range, "æ€»è®¡", style);
      } else if (summaryRowIndex == 2) {
        // æ˜ŸæœŸ...merge...
        const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1);
        this.setContent(mergeRange, "æ€»è®¡", style);
        mergeRange.merge();
      } else {
        this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") & '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") & '+summaryRowIndex+')), 0)', style);

        // 1. IFERROR(value, [value_if_error]) å‡½æ•°ç”¨äºåˆ¤æ–­å…¬å¼ä¸­æ˜¯å¦å­˜åœ¨é”™è¯¯ï¼Œå¹¶åœ¨æœ‰é”™è¯¯æ—¶è¿”å›æŒ‡å®šçš„å€¼ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`value` æ˜¯éœ€è¦è®¡ç®—çš„è¡¨è¾¾å¼æˆ–å‡½æ•°ï¼Œ`value_if_error` æ˜¯å½“ value å‘ç”Ÿé”™è¯¯æ—¶è¿”å›çš„å€¼ã€‚åœ¨è¿™ä¸ªæƒ…å¢ƒä¸‹ï¼Œå¦‚æœ SUM å‡½æ•°ä¸­çš„è®¡ç®—å‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å› 0ã€‚
        // 2. SUM(range) å‡½æ•°ç”¨äºè®¡ç®—èŒƒå›´å†…æ‰€æœ‰æ•°å­—çš„æ€»å’Œã€‚
        // 3. INDIRECT(ref_text, [is_A1_notation]) å‡½æ•°å°†æ–‡å­—å­—ä¸²è½¬æ¢æˆå•å…ƒæ ¼å¼•ç”¨ã€‚è¿™é‡Œä½¿ç”¨ INDIRECT å‡½æ•°æ˜¯ä¸ºäº†åŠ¨æ€ç”Ÿæˆæ‰€éœ€çš„å‚ç…§èŒƒå›´ã€‚
        // 4. SUBSTITUTE(text, old_text, new_text, [instance_num]) å‡½æ•°åœ¨æ–‡å­—å­—ä¸²ä¸­æ›¿æ¢æŒ‡å®šçš„æ–‡å­—ã€‚è¿™é‡Œä½¿ç”¨ SUBSTITUTE æ˜¯ä¸ºäº†å°† ADDRESS å‡½æ•°å›ä¼ çš„åœ°å€ä¸­çš„ "1" æ›¿æ¢æˆå…¶ä»–å†…å®¹ã€‚
        // 5. ADDRESS(row, column, [abs_num], [a1], [sheet]) å‡½æ•°æ ¹æ®ç»™å®šçš„è¡Œåˆ—å·ç å›ä¼ å¯¹åº”çš„å•å…ƒæ ¼åœ°å€ã€‚åœ¨è¿™é‡Œï¼ŒADDRESS(1, 1, 4) ç”Ÿæˆäº†ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„å•å…ƒæ ¼åœ°å€ï¼Œä½†æ˜¯ç”±äº abs_num æ˜¯ 4ï¼Œæ‰€ä»¥åœ°å€ä¸åŒ…å«å·¥ä½œè¡¨åç§°å’Œå›ºå®šç¬¦å· $ã€‚ç±»ä¼¼åœ°ï¼Œ`ADDRESS(1, COLUMN() - 1, 4)` äº§ç”Ÿäº†ä»ç¬¬ä¸€è¡Œåˆ°å½“å‰åˆ—å‰ä¸€åˆ—çš„å•å…ƒæ ¼åœ°å€ã€‚
        // 6. COLUMN() å‡½æ•°å›ä¼ å½“å‰å•å…ƒæ ¼çš„åˆ—å·ã€‚
        // 7. summaryRowIndex = æ‰€åœ¨åˆ—     

      }
    }

    return thisMonthSheet;
  }

  setContent(range, text, style) {
    if (String(text) != "") {
      range.setValue(text);
    }

    range.setBackgroundColor(style.backgroundColor);
    range.setFontColor(style.color);

    if (style.bold) {
      range.setFontWeight("bold");
    }

    range.setHorizontalAlignment(style.horizontalAlignment);
    range.setVerticalAlignment(style.verticalAlignment);
    range.setFontSize(style.size);
    range.setBorder(true, true, true, true, true, true, "black", SpreadsheetApp.BorderStyle.SOLID);
  }
}
```



`Main.gs` åšä¸ºä¸»ç¨‹å¼å…¥å£ï¼š



```javascript
const targetGoogleSheetID = "1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE"
// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641

function debug() {
  var report = new DailyReport(targetGoogleSheetID, new Date());
  report.execute();
}
```



![](/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.png)



å®Œæˆåæˆ‘ä»¬å›åˆ°ã€Œ `Main.gs` ã€é€‰æ‹©ã€Œdebugã€å¹¶æŒ‰ä¸‹ä¾¦é”™ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ã€æœ‰æ— å‡ºé”™ã€‚



![](/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.png)



æ‰§è¡Œæ­£ç¡®å›åˆ°æŠ¥è¡¨ä¼šå‡ºç°å½“å‰æ–°æœˆä»½ï¼Œå¹¶å¸¦å…¥é¢„è®¾æ ä½ä¸æ€»è®¡æ ä½ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸ä¼šæœ‰ååº”ã€‚



#### 3. ä¸²æ¥ Google Analytics æå–æ•°æ®



é¦–å…ˆéœ€è¦æ–°å¢ã€ŒAnalyticsDataã€æœåŠ¡ï¼š



![](/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.png)



ä½¿ç”¨ GA4 Debug Tool æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼š



- <https://ga-dev-tools.google/ga4/query-explorer/>{:target="_blank"}


- å¯è¾¹æ¯”ç…§ GA 4 åå°ç­›é€‰æ¡ä»¶æ„å»º


- **æœ¬æ–‡ä»¥æŸ¥è¯¢ Sessions æ•°ä¸ºä¾‹ï¼ŒåŒºåˆ†è£…ç½® Grouping**



ç™»å…¥æˆæƒåé€‰æ‹©ç›®æ ‡èµ„æºï¼š



![](/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.png)



è®°ä¸‹ property åº•ä¸‹æ˜¾ç¤ºçš„æ•°å­—ï¼Œå³ä¸ºä½ è¦æŸ¥è¯¢çš„èµ„æº GA Property IDã€‚



è®¾å®šæŸ¥è¯¢å‚æ•°ã€Filter æ¡ä»¶ï¼š



![](/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.png)



æŒ‰ä¸‹ã€ŒMake Reqeustã€å–å¾— Response ç»“æœï¼š



![](/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.png)



å¯åŒæ­¥æ¯”è¾ƒ GA 4 åå°åŒæ ·æ¡ä»¶çš„æ•°æ®æ˜¯å¦ç›¸åŒï¼Œå¦‚æœè½å·®å¤ªå¤§å¯èƒ½æ˜¯æœ‰ Filter æ¡ä»¶æ²¡æœ‰åŠ åˆ°ï¼Œè¦å†æ£€æŸ¥ä¸€ä¸‹ã€‚



#### å°è®°



é™„ä¸Šä¸€ä¸ªè¡Œé”€åŒäº‹å‘ç°çš„å°å‘ï¼ŒGA æœ‰äº›æ•°æ®ä¼šæœ‰å»¶è¿Ÿé—®é¢˜ï¼Œå¯èƒ½ä»Šå¤©æŸ¥çš„è·Ÿæ˜¨å¤©æŸ¥çš„æ•°å­—ä¼šä¸ä¸€æ ·(ä¾‹å¦‚è·³å‡ºç‡)ï¼Œå› æ­¤æœ€å¥½èƒ½å°†èµ„æ–™å›æº¯å‡ å¤©æ‰èƒ½å´ä¿å€¼æ˜¯æœ€ç»ˆçš„æ•°å­—ã€‚



> *GA Debug Tool æ²¡é—®é¢˜ä¹‹åæˆ‘ä»¬å°±èƒ½å°†å®ƒè½¬æ¢ä¸º Google Apps Scriptã€‚*



æ–°å¢ä¸€ä¸ª `GAData.gs` æ¡£æ¡ˆï¼š



```javascript
// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined
// GA Debug Toole: https://ga-dev-tools.web.app/ga4/query-explorer/

class GAData {
  constructor(date) {
    this.date = date;

    const traffic = this.fetchGADailyUsage();
    this.pc_traffic = traffic["desktop"];
    this.mobile_traffic = traffic["mobile"];
  }

  fetchGADailyUsage() {
    const dimensionPlatform = AnalyticsData.newDimension();
    dimensionPlatform.name = "deviceCategory";

    const metric = AnalyticsData.newMetric();
    metric.name = "sessions";

    const dateRange = AnalyticsData.newDateRange();
    // é¢„è®¾æŸ¥è¯¢ç»™å®šæ—¥èŒƒå›´å†…èµ„æ–™ e.g. 2024-01-01 ~ 2024-01-01
    dateRange.startDate = this.getDateString();
    dateRange.endDate = this.getDateString();

    // Filter Example:
    // const filterExpression = AnalyticsData.newFilterExpression();
    // const filter = AnalyticsData.newFilter();
    // filter.fieldName = "landingPagePlusQueryString";
    // const stringFilter = AnalyticsData.newStringFilter()
    // stringFilter.value = "/life\\|/article\\|/chat\\|/house\\|/event/230502\\|/event/230310";
    // stringFilter.matchType = "PARTIAL_REGEXP";
    // filter.stringFilter = stringFilter;
    // filterExpression.filter = filter;

    const request = AnalyticsData.newRunReportRequest();
    request.dimensions = [dimensionPlatform];
    request.metrics = [metric];
    request.dateRanges = dateRange;

    // Filter Example:
    // const filterExpression = AnalyticsData.newFilterExpression();
    // filterExpression.expression = filterExpression;
    // request.dimensionFilter = filterExpression;
    // or Not
    // const notFilterExpression = AnalyticsData.newFilterExpression();
    // notFilterExpression.notExpression = filterExpression;
    // request.dimensionFilter = notFilterExpression;

    const report = AnalyticsData.Properties.runReport(request, "properties/" + gaPropertyId).rows;
    // æ— èµ„æ–™
    if (report == undefined) {
      return {"desktop": 0, "mobile": 0};
    }

    // [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}]

    var result = {};
    report.forEach(function(element) {
      result[element.dimensionValues[0].value] = element.metricValues[0].value;
    });

    return result;
  }

  getDateString() {
    return Utilities.formatDate(this.date, "GMT+8", "yyyy-MM-dd");
  }
}
```



`Main.gs` æ–°å¢æµ‹è¯•å†…å®¹ï¼š



```javascript
const targetGoogleSheetID = "1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE";
// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641

const gaPropertyId = "318495208";

function debug() {
  var report = new DailyReport(targetGoogleSheetID, new Date());
  report.execute();
  //
  var gaData = new GAData(new Date());
  Logger.log(gaData);
}
```



æŒ‰ä¸‹æ‰§è¡Œæˆ–ä¾¦é”™å–å¾—ç¨‹å¼æå–ç»“æœï¼š



![](/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.png)



OK! æ¯”å¯¹ç›¸ç¬¦ã€‚



![](/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.png)



æ­¤æ­¥éª¤å®Œæˆæ—¶ï¼Œç›®å½•æ¡£æ¡ˆç»“æ„å¦‚ä¸Šå›¾ã€‚



#### 4. å¡«å……èµ„æ–™



å»ºå¥½ Sheetã€æŸ¥å¥½èµ„æ–™åï¼Œå†æ¥å°±æ˜¯å¡«å……èµ„æ–™åˆ°æ ä½ä¸­ã€‚



è°ƒæ•´ `DailyReport.gs` å¢åŠ  by æ—¥æœŸæ–°å¢æ ä½ï¼†å¡«å……èµ„æ–™çš„é€»è¾‘ï¼š



```javascript
class DailyReport {
  constructor(sheetID, date, gaData, inHouseReportData) {
    this.separateSheet = SpreadsheetApp.openById(sheetID);
    this.date = date;

    const dateString = Utilities.formatDate(date, "GMT+8", "yyyy/MM/dd");
    const weekString = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"][date.getDay()]; // å–å¾—æ˜ŸæœŸï¼Œæ˜ŸæœŸæ—¥ä¸º0ï¼Œæ˜ŸæœŸä¸€ä¸º1ï¼Œä»¥æ­¤ç±»

    this.sheetFields = [
      new DailyReportField("æ—¥æœŸ", new HeaderDateStyle(), new HeaderDateStyle(), null, dateString),
      new DailyReportField("æ˜ŸæœŸ", new HeaderDateStyle(), new HeaderDateStyle(), null, weekString),
      new DailyReportField("æ—¥æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0", '=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&5)'), // =4(PC æµé‡) + 5(Mobile æµé‡)
      new DailyReportField("PC æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0", gaData.pc_traffic),
      new DailyReportField("Mobile æµé‡", new HeaderStyle(), new ContentStyle(), "#,##0", gaData.mobile_traffic),
      new DailyReportField("æ³¨å†Œæ•°", new HeaderStyle(), new ContentStyle(), "#,##0", inHouseReportData.registers)
    ]
  }

  execute() {
    const sheet = this.getSheet();
    const dateColumnIndex = this.makeOrGetDateColumn(sheet); // å–å¾—å·²å­˜åœ¨çš„æ›´æ–°æˆ–å»ºç«‹æ–°çš„æ ä½

    // å¡«å……æ ä½å†…å®¹
    for(const currentRow in this.sheetFields) {
      const sheetField = this.sheetFields[currentRow];
      const rowIndex = parseInt(currentRow) + 1;

      if (rowIndex != null) {
        const range = sheet.getRange(rowIndex, dateColumnIndex);
        const text = sheetField.value;
        const style = sheetField.contentStyle;
        this.setContent(range, text, style);
        this.setFormat(range, sheetField.format);          
      }
    }
  }

  // å–å¾—ç»™å®šæ—¥æœŸçš„ç›®æ ‡ Sheet
  getSheet() {
    // ä»¥æœˆæ¥åŒºåˆ† Sheetï¼Œæ‰¾åˆ°å½“æœˆ Sheet
    var thisMonthSheet = this.separateSheet.getSheetByName(this.getSheetName());
    if (thisMonthSheet == null) {
      // æ— åˆ™å»ºç«‹æ–°çš„æœˆ Sheet
      thisMonthSheet = this.makeMonthSheet();
    }

    return thisMonthSheet;
  }

  // æœˆ Sheet å‘½å
  getSheetName() {
    return Utilities.formatDate(this.date, "GMT+8", "yyyy-MM");
  }

  // å»ºç«‹æ–°çš„æœˆ Sheet
  makeMonthSheet() {
    // æ–°å¢å½“æœˆ Sheetï¼Œç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªä½å­
    var thisMonthSheet = this.separateSheet.insertSheet(this.getSheetName(), {index: 0});
    thisMonthSheet.activate();
    this.separateSheet.moveActiveSheet(1);

    // æ–°å¢ç¬¬ä¸€æ ï¼Œæ ä½åç§°ã€è®¾å®š Pinnedã€å®½åº¦ 200
    thisMonthSheet.insertColumnsBefore(1, 1);
    thisMonthSheet.setFrozenColumns(1);
    thisMonthSheet.setColumnWidths(1, 1, 200);

    // å¡«å……æ ä½åç§°
    for(const currentRow in this.sheetFields) {
      const sheetField = this.sheetFields[currentRow];
      const text = sheetField.name;
      const style = sheetField.headerStyle;
      
      const range = thisMonthSheet.getRange(parseInt(currentRow) + 1, 1);
      this.setContent(range, text, style);
      range.setHorizontalAlignment("left");
    }

    // è®¾å®šæ é«˜
    thisMonthSheet.setRowHeights(1, Object.keys(this.sheetFields).length, 30);

    // è®¾å®š Pinned ç¬¬ä¸€ã€äºŒåˆ—(æ—¥æœŸã€æ˜ŸæœŸ)
    thisMonthSheet.setFrozenRows(2);

    // æ–°å¢æ€»è®¡æ ä½
    thisMonthSheet.insertColumnsAfter(thisMonthSheet.getLastColumn(), 1); // æ–°å¢ä¸€æ åœ¨æœ€åä¸€æ 
    const summaryColumnIndex = thisMonthSheet.getLastColumn() + 1;

    // å¡«å……æ€»è®¡æ ä½
    for(const currentRow in this.sheetFields) {
      const sheetField = this.sheetFields[currentRow];
      const summaryRowIndex = parseInt(currentRow) + 1;

      const range = thisMonthSheet.getRange(summaryRowIndex, summaryColumnIndex);
      const style = sheetField.contentStyle;

      if (summaryRowIndex == 1) {
        // æ—¥æœŸ...
        this.setContent(range, "æ€»è®¡", style);
      } else if (summaryRowIndex == 2) {
        // æ˜ŸæœŸ...merge...
        const mergeRange = thisMonthSheet.getRange(1, summaryColumnIndex, summaryRowIndex, 1);
        this.setContent(mergeRange, "æ€»è®¡", style);
        mergeRange.merge();
      } else {
        this.setContent(range, '=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") & '+summaryRowIndex+'):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") & '+summaryRowIndex+')), 0)', style);
      }
    }

    return thisMonthSheet;
  }

  // å»ºç«‹æˆ–å–å¾—æ—¥æœŸçš„æ ä½
  // ä»æœ€è¿‘ä¸€æ—¥å¾€ååŠ ä¸€æ ä½
  makeOrGetDateColumn(sheet) {
    const firstRowColumnsRange = sheet.getRange(1, 1, 1, sheet.getLastColumn()); // å–å¾—ç¬¬ä¸€åˆ—(æ—¥æœŸ)èµ„æ–™èŒƒå›´
    const firstRowColumns = firstRowColumnsRange.getValues()[0]; // å–å¾—èµ„æ–™èŒƒå›´çš„å€¼ 0 = ç¬¬ä¸€åˆ—
    
    var columnIndex = firstRowColumns.findIndex((date) => (date instanceof Date && Utilities.formatDate(date, "GMT+8", "yyyy/MM/dd") == Utilities.formatDate(this.date, "GMT+8", "yyyy/MM/dd"))); // æ‰¾åˆ°å¯¹åº”æ—¥æœŸçš„æ ä½ Index

    if (columnIndex < 0) {
      // Not Foundï¼Œæ‰¾åˆ°å‰ä¸€æ—¥çš„ä½å­
      var preDate = new Date(this.date);
      preDate.setDate(preDate.getDate() - 1);

      while(preDate.getMonth() == this.date.getMonth()) {
        columnIndex = firstRowColumns.findIndex((date) => (date instanceof Date && Utilities.formatDate(date, "GMT+8", "yyyy/MM/dd") == Utilities.formatDate(preDate, "GMT+8", "yyyy/MM/dd")));
        if (columnIndex >= 0) {
          break;
        }

        preDate.setDate(preDate.getDate() - 1);
      }

      if (columnIndex >= 0) {
        columnIndex += 1;
        sheet.insertColumnsAfter(columnIndex, 1); // åœ¨å‰ä¸€æ—¥æ ä½åæ–°å¢ä¸€æ 
        columnIndex += 1;
      }
    } else {
      columnIndex += 1;
    }

    if (columnIndex < 0) {
        sheet.insertColumnsAfter(1, 1); // é»˜è®¤ï¼Œç›´æ¥æ–°å¢ä¸€æ åœ¨ç¬¬ä¸€æ åé¢
        columnIndex = 2;
    } 

    // è®¾å®šæ ä½å®½åº¦
    sheet.setColumnWidths(columnIndex , 1, 100);

    return columnIndex
  }

  // è®¾å®šæ ä½ Format æ ·å¼
  setFormat(range, format) {
    if (format != null) {
      range.setNumberFormat(format);
    }
  }

  // å¡«å……å†…å®¹åˆ°æ ä½
  setContent(range, text, style) {
    if (String(text) != "") {
      range.setValue(text);
    }

    range.setBackgroundColor(style.backgroundColor);
    range.setFontColor(style.color);

    if (style.bold) {
      range.setFontWeight("bold");
    }

    range.setHorizontalAlignment(style.horizontalAlignment);
    range.setVerticalAlignment(style.verticalAlignment);
    range.setFontSize(style.size);
    range.setBorder(true, true, true, true, true, true, "black", SpreadsheetApp.BorderStyle.SOLID);
  }
}
```



è°ƒæ•´ `Main.gs` å¢åŠ èµ„æ–™ä¸²æ¥å¹¶åœ¨æ„å»ºé˜¶æ®µèµ‹å€¼ï¼š



```javascript
const targetGoogleSheetID = "1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE";
// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641

const gaPropertyId = "318495208";

function debug() {
  const date = new Date();
  const gaData = new GAData(date);
  const inHouseReportData = fetchInHouseReportData(date);
  
  const report = new DailyReport(targetGoogleSheetID, date, gaData, inHouseReportData);
  report.execute();
  
}

// æ¨¡æ‹Ÿéƒ¨åˆ†æ•°æ®èµ„æ–™å¯èƒ½æ˜¯æ‰“å…¶ä»–å¹³å° API å–å¾—çš„ã€‚
function fetchInHouseReportData(date) {
  // EXMAPLE REQUEST:
  // var options = {
  //   'method' : 'get',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   }
  // };
  // OR
  // var options = {
  //   'method' : 'post',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   },
  //   'payload' : data
  // };

  // var res = UrlFetchApp.fetch(url, options);
  // const result = JSON.parse(res.getContentText());

  // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.
  
  return {"registers": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180
}
```



å®Œæˆåæˆ‘ä»¬å›åˆ°ã€Œ `Main.gs` ã€é€‰æ‹©ã€Œdebugã€å¹¶æŒ‰ä¸‹ä¾¦é”™ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ã€æœ‰æ— å‡ºé”™ã€‚



![](/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.png)



å›åˆ° Google Sheet! æˆåŠŸ! æˆ‘ä»¬æˆåŠŸçš„è‡ªåŠ¨æ–°å¢äº†è¯¥æ—¥æœŸçš„èµ„æ–™ã€‚



#### 5. è®¾å®šæ’ç¨‹ï¼Œæ¯æ—¥è‡ªåŠ¨æ‰§è¡Œ



è„šæœ¬å®Œæˆåï¼Œå†æ¥åªè¦è®¾å®šè‡ªåŠ¨è§¦å‘æ¡ä»¶ï¼Œå°±èƒ½æ¯æ—¥è‡ªåŠ¨å®Œæˆå•°ã€‚



è°ƒæ•´ `Main.gs` æ–°å¢ `cronjob()` function:



```javascript
const targetGoogleSheetID = "1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE";
// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641

const gaPropertyId = "318495208";

function debug() {
  cronjob();
}

// ç…§ç°å®çŠ¶å†µæ¥è¯´ï¼Œé€šå¸¸æ˜¯ä»Šæ—¥æŸ¥æ˜¨æ—¥æ•°æ®ï¼Œæ‰æ˜¯å®Œæ•´çš„èµ„æ–™
function cronjob() {
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);

  const gaData = new GAData(yesterday);
  const inHouseReportData = fetchInHouseReportData(yesterday);
  
  const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData);
  report.execute();
}

// æ¨¡æ‹Ÿéƒ¨åˆ†æ•°æ®èµ„æ–™å¯èƒ½æ˜¯æ‰“å…¶ä»–å¹³å° API å–å¾—çš„ã€‚
function fetchInHouseReportData(date) {
  // EXMAPLE REQUEST:
  // var options = {
  //   'method' : 'get',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   }
  // };
  // OR
  // var options = {
  //   'method' : 'post',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   },
  //   'payload' : data
  // };

  // var res = UrlFetchApp.fetch(url, options);
  // const result = JSON.parse(res.getContentText());

  // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.
  
  return {"registers": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180
}
```



åœ¨ç¼–è¾‘å™¨ä¸Šåˆ‡æ¢åˆ°ã€Œè§¦å‘æ¡ä»¶ã€é¡µç­¾ï¼Œé€‰æ‹©å³ä¸‹è§’ã€Œæ–°å¢è§¦å‘æ¡ä»¶ã€ï¼š



![](/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.png)



- é€‰æ‹©æ‚¨è¦æ‰§è¡Œçš„åŠŸèƒ½ï¼šåˆšæ–°å¢çš„ `Main.gs` Function `cronjob`


- é€‰æ‹©åº”æ‰§è¡Œçš„éƒ¨ç½²ä½œä¸šï¼šä¸Šç«¯ (Head, æ„ä¸ºæœ€æ–°ç‰ˆ)


- é€‰å–æ´»åŠ¨æ¥æºï¼šæ—¶é—´é©±åŠ¨


- é€‰å–æ—¶é—´å‹è§¦å‘æ¡ä»¶ç±»å‹ï¼šæ—¥è®¡æ—¶å™¨


- é€‰å–æ—¶æ®µï¼šAM 4:00 â€” AM 5:00 (GMT+08:00)
  é€šå¸¸åœ¨ AM 4:00 ä¸€åˆ°å°±ä¼šæ‰§è¡Œã€‚


- é”™è¯¯é€šçŸ¥è®¾å®šï¼šå½“è„šæœ¬å‘ç”Ÿé”™è¯¯æ—¶æ˜¯è¦é©¬ä¸Šé€šçŸ¥ï¼Œè¿˜æ˜¯æ¯æ—¥æ±‡æ•´ä¸€æ¬¡



**å‚¨å­˜è®¾å®šï¼Œå®Œæˆã€‚**



ä¹‹åå¯ä»¥å»ã€Œæ‰§è¡Œé¡¹ç›®ã€é¡µç­¾æŸ¥çœ‹æ‰§è¡Œçºªå½•ç»“æœï¼š



![](/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.png)



> ***è‡³æ­¤æˆ‘ä»¬å·²å®Œæˆè‡ªåŠ¨åŒ–æŸ¥è¯¢ã€æ–°å¢èµ„æ–™ã€å¡«å…¥èµ„æ–™çš„æŠ¥è¡¨ RPA åŠŸèƒ½ï¼ğŸ‰ğŸ‰ğŸ‰***



#### æ­å»º Web GUI Dashboard



å†æ¥æœ‰ä¸ªæ¬¡è¦éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªç®€å•çš„ Web å‘ˆç°æ¯æ—¥æ•°æ®ï¼ˆç±»ä¼¼æˆ˜æƒ…ä¸­å¿ƒçš„æ¦‚å¿µï¼‰ä¼šåœ¨å›¢é˜ŸèƒŒåå¢™ä¸Šå¤§è¤å¹•ä¸Šç›´æ¥æ˜¾ç¤ºã€‚



**æ•ˆæœå¦‚ä¸‹å›¾ï¼š**



![](/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png)



**æ–°å¢ `Web_DailyReport.gs` æ’°å†™è¯»å– Google Sheet å¹¶å°†æ ä½ã€æ ·å¼è½¬æ¢ä¸º HTML æ ¼å¼å‘ˆç°ï¼š**



```javascript
class WebDailyReport {
  constructor(sheetID, dayCount) {
    this.separateSheet = SpreadsheetApp.openById(sheetID);
    this.dayCount = dayCount;
    this.sheetRows = [
      "æ—¥æœŸ",
      "æ˜ŸæœŸ",
      "æ—¥æµé‡",
      "PC æµé‡",
      "Mobile æµé‡",
      "æ³¨å†Œæ•°"
    ];
  }

  allData(startDate) {
    var sheetRowsIndexs = {};
    var count = this.dayCount;
    var result = [];
    while (count >= 0) {
      const preDate = new Date(startDate);
      preDate.setDate(preDate.getDate() - (this.dayCount - count));
      const sheetName = Utilities.formatDate(preDate, "GMT+8", "yyyy-MM");
      const targetSheet = this.separateSheet.getSheetByName(sheetName);
      if (targetSheet != null) {
        const firstRowColumnsRange = targetSheet.getRange(1, 1, 1, targetSheet.getLastColumn()); // å–å¾—ç¬¬ä¸€åˆ—(æ—¥æœŸ)èµ„æ–™èŒƒå›´
        const firstRowColumns = firstRowColumnsRange.getValues()[0]; // å–å¾—èµ„æ–™èŒƒå›´çš„å€¼ 0 = ç¬¬ä¸€åˆ—
        var columnIndex = firstRowColumns.findIndex((date) => (date instanceof Date && Utilities.formatDate(date, "GMT+8", "yyyy/MM/dd") == Utilities.formatDate(preDate, "GMT+8", "yyyy/MM/dd"))); // æ‰¾åˆ°å¯¹åº”æ—¥æœŸçš„æ ä½ Index
        
        if (columnIndex >= 0) {
          columnIndex = parseInt(columnIndex) + 1;
          if (sheetRowsIndexs[sheetName] == undefined \\|\\| sheetRowsIndexs[sheetName] == null) {
            sheetRowsIndexs[sheetName] = this.sheetRows.map((sheetRow) => this.getFieldRow(targetSheet, sheetRow));
          }

          if (result.length == 0) {
            // æ–°å¢ç¬¬ä¸€æ 
            const ranges = sheetRowsIndexs[sheetName].map((rowIndex) => (rowIndex != null) ? (targetSheet.getRange(rowIndex, 1)) : (null));
            result.push(this.makeValues(ranges));
          }

          const ranges = sheetRowsIndexs[sheetName].map((rowIndex) => (rowIndex != null) ? (targetSheet.getRange(rowIndex, columnIndex)) : (null));
          result.push(this.makeValues(ranges));
        }
      }

      count -= 1;
    }

    var transformResult = {};
    for (const columnIndex in result) {
      for (const rowIndex in result[columnIndex]) {
        if (transformResult[rowIndex] == undefined) {
          transformResult[rowIndex] = [];
        }

        if (columnIndex == 0) {
          transformResult[rowIndex].unshift(result[columnIndex][rowIndex]);
        } else {
          transformResult[rowIndex].splice(1, 0, result[columnIndex][rowIndex]);
        }
        
      }
    }

    return transformResult;
  }

  // è½¬æ¢ æ ä½å±æ€§ å€¼æˆ æ˜¾ç¤ºç”¨ç‰©ä»¶
  makeValues(ranges) {
    const data = ranges.map((range) => (range != null) ? (range.getDisplayValues()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const backgroundColors = ranges.map((range) => (range != null) ? (range.getBackgrounds()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const colors = ranges.map((range) => (range != null) ? (range.getFontColorObjects()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const sizes = ranges.map((range) => (range != null) ? (range.getFontSizes()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const bolds = ranges.map((range) => (range != null) ? (range.getFontWeights()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const horizontalAlignments = ranges.map((range) => (range != null) ? (range.getHorizontalAlignments()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));
    const verticalAlignments = ranges.map((range) => (range != null) ? (range.getVerticalAlignments()) : (null)).map((values) => (values != null) ? (values[0][0]) : (null));

    var result = [];
    for(const index in data) {
        const row = data[index];
        result.push({
          "value": row,
          "backgroundColor": backgroundColors[index],
          "color": this.colorStripper(colors[index]?.asRgbColor()?.asHexString()),
          "size": sizes[index],
          "bold": bolds[index],
          "horizontalAlignment": this.alignConventer(horizontalAlignments[index]),
          "verticalAlignment": verticalAlignments[index]
        });
    }

    return result;
  }

  colorStripper(colorString) {
    if (colorString == undefined \\|\\| colorString == null) {
      return null
    }

    if (colorString.length == 9) {
      return "#"+colorString.substring(3, 9);
    } else {
      return colorString;
    }
  }

  alignConventer(horizontalAlignment) {
    if (horizontalAlignment == undefined \\|\\| horizontalAlignment == null) {
      return null
    }

    return horizontalAlignment.replace('general-', '')
  }

  getFieldRow(sheet, name) {
    const firstColumnRowsRange = sheet.getRange(1, 1, sheet.getLastRow(), 1); // å–å¾—ç¬¬ä¸€æ (æ ä½)èµ„æ–™èŒƒå›´
    const firstColumnRows = firstColumnRowsRange.getValues(); // å–å¾—èµ„æ–™èŒƒå›´çš„å€¼
    const foundIndex = firstColumnRows.findIndex((firstColumnRow) => firstColumnRow[0] == name);

    if (foundIndex < 0) {
      return null;
    } else {
      return foundIndex + 1;
    }
  }
}
```



`Main.gs` **å¢åŠ  Web è¯·æ±‚ Handleï¼š**



```javascript
const targetGoogleSheetID = "1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE";
// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641

const gaPropertyId = "318495208";

function debug() {
  cronjob();
}

function cronjob() {
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);

  const gaData = new GAData(yesterday);
  const inHouseReportData = fetchInHouseReportData(yesterday);
  
  const report = new DailyReport(targetGoogleSheetID, yesterday, gaData, inHouseReportData);
  report.execute();
}

function doGet(e) {
  return HtmlService.createTemplateFromFile('Web_DailyReport_ Scaffolding').evaluate();
}

function getDailyReportBody() {
  const html = HtmlService.createTemplateFromFile('Web_DailyReport_Body').evaluate().getContent();
  return html;
}

// FOR POST
// function doPost(e) {
//  ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw
// }


// æ¨¡æ‹Ÿéƒ¨åˆ†æ•°æ®èµ„æ–™å¯èƒ½æ˜¯æ‰“å…¶ä»–å¹³å° API å–å¾—çš„ã€‚
function fetchInHouseReportData(date) {
  // EXMAPLE REQUEST:
  // var options = {
  //   'method' : 'get',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   }
  // };
  // OR
  // var options = {
  //   'method' : 'post',
  //   'headers': {
  //       'Authorization':  'Bearer XXX'
  //   },
  //   'payload' : data
  // };

  // var res = UrlFetchApp.fetch(url, options);
  // const result = JSON.parse(res.getContentText());

  // REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.
  
  return {"registers": Math.floor(Math.random() * (180 - 30 + 1)) + 30} // MOCK DATA random 30~180
}
```



**æ–°å¢ `Web_DailyReport_ Scaffolding.html` Web Dashboard æ¡†æ¶ï¼Œç”±äºæˆ‘ä»¬çš„æˆ˜æƒ…å®¤è¤å¹•è¦åšåˆ°è‡ªåŠ¨æ›´æ–°å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å»ºç«‹ä¸€ä¸ª Web éª¨æ¶ï¼Œåœ¨å…¶ä¸­å®šæ—¶ç”¨ Ajax å»æå– HTML å†…å®¹ï¼š**



```xml
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <script>
      function onSuccess(html) {
        if (html != null) {
          var div = document.getElementById('result');
          div.innerHTML = html;
        }
     }
     setInterval(()=>{
       google.script.run.withSuccessHandler(onSuccess).getDailyReportBody()
     }, 1000 * 60 * 60 * 1);
     google.script.run.withSuccessHandler(onSuccess).getDailyReportBody();
    </script>
  </head>
  <body>
    <div id="result">Loading...</div>
  </body>
</html>
```



**æ–°å¢** `Web_DailyReport_Body.html` å®é™…æ¸²æŸ“èµ„æ–™æˆ HTML çš„åœ°æ–¹ï¼š



```xml
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
    }
    th, td {
        border: 1px solid #000000;
        padding: 8px;
        text-align: center;
        font-size: 36px;
    }
      </style>
  </head>
  <body>
      <h1 style="text-align:center">ZHGCHG.LI</h1>
      <table id="dataTable">
        <tbody>
          <?
          // æ˜¾ç¤ºè¿‘ 7 å¤©æ•°æ®
          const dashboard = new WebDailyReport(targetGoogleSheetID, 7);
          // ä»æ˜¨å¤©å¼€å§‹
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const data = dashboard.allData(yesterday);
          for(const rowIndex in data) {
            const row = data[rowIndex];
            ?>
            <tr>
              <?
              for(const columnIndex in row) {
                const column = row[columnIndex];
                ?>
                <td style="background-color: <?=column["backgroundColor"]?>; color: <?=column["color"]?>; text-align: <?=column["horizontalAlignment"]?>;">
                  <?=column["value"]?>
                </td>
                <?
              }
              ?>
            </tr>
            <?
          }
          ?>
        </tbody>
      </table>
      <script>
  </body>
</html>
```



> ***è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯ä»æ˜¨å¤©å¼€å§‹å¾€åæ 7 å¤©çš„æ•°æ®åšæ¯”å¯¹ï¼Œä¸ä¼šæ˜¾ç¤ºä»Šå¤©çš„æ•°æ®ã€‚***



å®Œæˆä»¥ä¸Šæ­¥éª¤åçš„ä¸“æ¡ˆæ¡£æ¡ˆç›®å½•å¦‚ä¸‹ï¼š



![](/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.png)



**æµ‹è¯•éƒ¨ç½²ï¼š**



ç‚¹å‡»ä¸“æ¡ˆå³ä¸Šè§’ã€Œéƒ¨ç½²ã€-&gt;ã€Œæµ‹è¯•éƒ¨ç½²ä½œä¸šã€



![](/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.png)



![](/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.png)



![](/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.png)



- éƒ¨ç½²å®Œæˆç‚¹å‡»ç½‘å€å³å¯æŸ¥çœ‹æµ‹è¯•ç»“æœã€‚


- **è¯·æ³¨æ„æ­¤ç½‘å€ä»…å…±ä¸€æ¬¡æ€§æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚æœç¨‹å¼ç æœ‰è°ƒæ•´è¦å†é‡æ–°ç‚¹ä¸€æ¬¡æµ‹è¯•éƒ¨ç½²ä½œä¸šã€‚**



å¡åœ¨ Loadingâ€¦ å†…å®¹æ²¡å‡ºæ¥æˆ–å‡ºç°ä¼ºæœå™¨é”™è¯¯ï¼Œå¯ä»¥å›åˆ°ç¼–è¾‘å™¨çš„ã€Œæ‰§è¡Œé¡¹ç›®ã€é¡µç­¾æŸ¥çœ‹é”™è¯¯è®¯æ¯ï¼š



![](/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.png)



**å®Œæˆæ­£å¼éƒ¨ç½²ï¼š**



å¦‚æœæµ‹è¯•æ²¡é—®é¢˜å°±å¯ä»¥å®Œæˆæ­£å¼éƒ¨ç½²ï¼Œé‡Šå‡ºç½‘å€ã€‚



ç‚¹å‡»ä¸“æ¡ˆå³ä¸Šè§’ã€Œéƒ¨ç½²ã€-&gt;ã€Œæ–°å¢éƒ¨ç½²ä½œä¸šã€-&gt; å·¦ä¸Šè§’ã€Œé€‰å–ç±»å‹ã€-&gt;ã€Œç½‘é¡µåº”ç”¨ç¨‹å¼ã€ï¼š



![](/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png)



![](/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png)



![](/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png)



- æ‰§è¡Œèº«ä»½ï¼šé¢„è®¾ä¸ºå½“å‰å¸å·(åŒ Google Apps Script ä½¿ç”¨è€…)


- è°å¯ä»¥å­˜å–ï¼šè®¾ä¸ºæ‰€æœ‰äººåªè¦çŸ¥é“ç½‘å€çš„äººéƒ½èƒ½å­˜å–ã€ä¹Ÿå¯è®¾ä¸ºä»…ç»„ç»‡å¯å­˜å–ï¼Œä¼šå…ˆè¦æ±‚ Google ç™»å…¥æ‰èƒ½å­˜å–ã€‚


- éƒ¨ç½²å®Œæˆï¼Œå–å¾—ç½‘å€ã€‚



**ç¨‹å¼ç æœ‰æ›´åŠ¨éœ€é‡æ–°éƒ¨ç½²æ‰ä¼šç”Ÿæ•ˆï¼š**



è¯·æ³¨æ„å½“ç¨‹å¼ç æœ‰å˜åŠ¨æ—¶ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²(ç½‘å€ä¸ä¼šå˜)ï¼Œæ›´åŠ¨æ‰ä¼šç”Ÿæ•ˆï¼Œå¦åˆ™ä¼šä¸€ç›´æ˜¯æ—§çš„ã€‚



ç‚¹å‡»ä¸“æ¡ˆå³ä¸Šè§’ã€Œéƒ¨ç½²ã€-&gt;ã€Œç®¡ç†éƒ¨ç½²ä½œä¸šã€ï¼š



![](/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.png)



![](/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.png)



![](/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.png)



ç‚¹å‡»å³ä¸Šè§’ã€Œç¬”ğŸ–Šï¸ ICONã€-&gt; ã€Œç‰ˆæœ¬ã€ -&gt;ã€Œå»ºç«‹æ–°ç‰ˆæœ¬ã€-&gt;ã€Œéƒ¨ç½²ã€ã€‚



éƒ¨ç½²å®Œæˆåç‚¹å‡»ç½‘å€ï¼Œæˆ–å›åˆ°åŸç½‘å€é‡æ–°æ•´ç†å³å¯çœ‹åˆ°æ–°çš„æ›´åŠ¨ç»“æœã€‚



#### ğŸ‰ğŸ‰å®Œæˆï¼è‡³æ­¤æˆ‘ä»¬æ‰€æœ‰çš„ RPA éœ€æ±‚çš†å·²å®Œæˆã€‚ğŸ‰ğŸ‰



æœ€ç»ˆæˆæœï¼š



![(æ”¹ç¨‹å¼å›è¡¥æœ¬æœˆæ•°æ®ï¼Œå¦åˆ™å…¨æ–°èµ„æ–™ä¸‹åªæœ‰æ˜¨æ—¥ä¸€ç¬”)](/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.png)



(æ”¹ç¨‹å¼å›è¡¥æœ¬æœˆæ•°æ®ï¼Œå¦åˆ™å…¨æ–°èµ„æ–™ä¸‹åªæœ‰æ˜¨æ—¥ä¸€ç¬”)



> <https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec>{:target="_blank"}



### å®Œæ•´ Google Sheet Demoï¼š



- Google Sheet:
  <https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing>{:target="_blank"}


- Web GUI URL:
  <https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec>{:target="_blank"}


- **Google Apps Script:**
  <https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit>{:target="_blank"}



### æœ€åé™„ä¸Šå…¶ä»–æ—¥å¸¸ç”Ÿæ´»åº”ç”¨ï¼š



#### Robotic Process Automation with Google Apps Script â€” Github Repo Star Notifier to Line



[![](https://miro.medium.com/v2/resize:fit:1200/1*fUtW942huwnSbPF-ar4OCQ.png)](https://medium.com/zrealm-ios-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697){:target="_blank"}



#### Robotic Process Automation with Google Apps Script â€” Notion Database to Calendar



ä¹‹å‰ç®€æ˜“å®ç°çš„ Notion to Calendar åŠŸèƒ½ã€‚



> *å®ç°æ–¹å¼æ˜¯ï¼Œæˆ‘å»ä¸²æ¥ Notion API æå– Database èµ„æ–™å¹¶å¥—ç”¨äº§å‡º ICS æ ¼å¼ç½‘é¡µï¼Œéƒ¨ç½²æˆå…¬å¼€çš„ç½‘é¡µï¼›å°†æ­¤ç½‘å€æ–°å¢åˆ° Apple Calendar å³å¯ã€‚*



`Main.gs` :



```javascript
// Constant variables
const notionToken = "XXXXX";
const safeToken = "XXXXX";

function doGet(e) {
  const ics = HtmlService.createTemplateFromFile('ics');

  if (e.parameter.token != safeToken) {
    return ContentService.createTextOutput("Access Denied!");
  }

  ics.events = getQuickNote();
  
  return ContentService.createTextOutput(ics.evaluate().getContent()).setMimeType(ContentService.MimeType.ICAL);
}

function debug() {
  const ics = HtmlService.createTemplateFromFile('ics');
  ics.events = getQuickNote();
  Logger.log(ics.evaluate().getContent());
}

function getQuickNote() {
  // YOUR FILTER Condition:
  const payload = {
    "filter": {
      "and": [
        {
          "property": "Date",
            "date": {
            "is_not_empty": true
          }
        }
        ,
        {
          "property": "Name",
            "title": {
            "is_not_empty": true
          }
        }
      ]
    }
  };
  const result = getDatabase(YOUR_DATABASE_ID, payload);
  var events = [];
  for (const index in result.results) {
    const item = result.results[index]
    const properties = item.properties;

    const id = item['id'];
    const create = toICSDate(item["created_time"]);
    const edit = toICSDate(item["last_edited_time"]);
    const startDate = properties['Date']['date']['start'];
    const start = toICSDate(startDate);
    var endDate = properties['Date']?.['date']?.['end'];
    if (endDate == null) {
      endDate = startDate;
    }
    const end = toICSDate(endDate);
    const type = properties['Type']?.['multi_select']?.[0]?.['name'];

    const title = "["+type+"] "+properties?.['Name']?.['title']?.[0]?.['plain_text'];
    const description = item['url'];
    
    events.push(
      {
        "id":id,
        "create":create,
        "edit":edit,
        "start":start,
        "end":end,
        "title":title,
        "description":description
      }
    )
  }
  return events;
}
// TO UTC Date
function toICSDate(date) {
  const icsDate = new Date(date);
  icsDate.setHours(icsDate.getHours() - 8);
  return Utilities.formatDate(icsDate, "GMT+8", "yyyyMMdd'T'HHmmss'Z'");// 20240304T132300Z
}

// Notion
function getDatabase(id, payload) {
  const url = 'https://api.notion.com/v1/databases/'+id+'/query/';
  const options = {
    method: 'post',
    headers: {
      'Authorization': 'Bearer '+notionToken,
      'Content-Type': 'application/json',
      'Notion-Version': '2022-06-28'
    },
    payload: JSON.stringify(payload)
  }; 
  const result = UrlFetchApp.fetch(url, options);
  return JSON.parse(result.getContentText());
}
```



`ics.html` :



```plaintext
BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:NotionCalendar
X-WR-TIMEZONE:Asia/Taipei
BEGIN:VTIMEZONE
TZID:Asia/Taipei
X-LIC-LOCATION:Asia/Taipei
BEGIN:STANDARD
TZOFFSETFROM:+0800
TZOFFSETTO:+0800
TZNAME:CST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
<?
  for(const eventIndex in events) {
    const event = events[eventIndex];
    ?>
BEGIN:VEVENT
DTSTART:<?=event["start"]?>

DTEND:<?=event["end"]?>

DTSTAMP:<?=event["edit"]?>

UID:<?=event["id"]?>

CREATED:<?=event["create"]?>

LAST-MODIFIED:<?=event["edit"]?>

SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:<?=event["title"]?>

DESCRIPTION:<?=event["description"]?>

TRANSP:OPAQUE
END:VEVENT
<?
  }
?>
END:VCALENDAR
```



åŒå‰æ–‡ï¼Œéƒ¨ç½²æˆç½‘é¡µæœåŠ¡ï¼Œç‚¹å‡»ä¸“æ¡ˆå³ä¸Šè§’ã€Œéƒ¨ç½²ã€-&gt;ã€Œæ–°å¢éƒ¨ç½²ä½œä¸šã€-&gt; å·¦ä¸Šè§’ã€Œé€‰å–ç±»å‹ã€-&gt;ã€Œç½‘é¡µåº”ç”¨ç¨‹å¼ã€ï¼š



![](/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.png)



![](/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.png)



![](/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.png)



- è°å¯ä»¥å­˜å–è¦é€‰æ‰€æœ‰äººï¼Œå› ä¸ºæ— æ³•åœ¨åŠ  Calendar æ—¶è¿›è¡Œ Google ç™»å…¥éªŒè¯ã€‚



![](/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.png)



![](/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.png)



**å°†ç½‘å€æ–°å¢è‡³è¡Œäº‹å†è®¢é˜…ï¼Œå®Œæˆ** ğŸ‰ğŸ‰ğŸ‰ğŸ‰ **ï¼**



### å·¥å•†æ—¶é—´



å¦‚æœæ‚¨ä¸æ‚¨çš„å›¢é˜Ÿæœ‰è‡ªåŠ¨åŒ–å·¥å…·ã€æµç¨‹ä¸²æ¥éœ€æ±‚ï¼Œä¸è®ºæ˜¯ Slack App å¼€å‘ã€Notionã€Asanaã€Google Sheetã€Google Formã€GA æ•°æ®ï¼Œå„ç§ä¸²æ¥éœ€æ±‚ï¼Œæ¬¢è¿ä¸æˆ‘ [**è”ç»œå¼€å‘**](https://zhgchg.li/contact/){:target="_blank"} ã€‚



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*