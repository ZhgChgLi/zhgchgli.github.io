---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2024-05-14T16:20:45.012+0000
description: ä½¿ç”¨ mitmproxy + apple configurator è®© App æ°¸è¿œåœç•™åœ¨ä¸‹æ¶å‰çš„çŠ¶æ€
image:
  path: /assets/b04f4fba3cf2/1*8RN-xVJROfLwtovgkvHDwA.jpeg
last_modified_at: 2024-05-14T16:20:45.012+0000
render_with_liquid: false
tags:
- simplified-chinese
- ios-app-development
- man-in-the-middle-attack
- mitmproxy
- python
- app-development
title: App äº§å“è¿›å…¥ç»ˆç‚¹ç«™ï¼Œèƒ½åšä»€ä¹ˆäº‹ç¼…æ€€ï¼Ÿ
---

### App äº§å“è¿›å…¥ç»ˆç‚¹ç«™ï¼Œèƒ½åšä»€ä¹ˆäº‹ç¼…æ€€ï¼Ÿ



ä½¿ç”¨ mitmproxy + apple configurator è®© App æ°¸è¿œåœç•™åœ¨ä¸‹æ¶å‰çš„çŠ¶æ€



### å‰è¨€



![å’’æœ¯å›æˆ˜](/assets/b04f4fba3cf2/1*8RN-xVJROfLwtovgkvHDwA.jpeg)



å’’æœ¯å›æˆ˜



å·¥ä½œæ—¶é—´ä¹…ã€ç»æ‰‹è¿‡çš„äº§å“å¤šï¼Œä¹Ÿå¼€å§‹é‡åˆ°æœ‰æ›¾ç»å‚ä¸è¿‡çš„äº§å“è¦è¿›å…¥ç»ˆç‚¹ç«™(ä¸‹æ¶)ï¼›ä»é›¶åˆ°æœ‰å¼€å‘ä¸€ä¸ªäº§å“å¦‚åŒå­•è‚²ä¸€ä¸ªæ–°ç”Ÿå‘½ï¼Œå›¢é˜Ÿä¸€èµ·åŠªåŠ›äº† 3â€“4 ä¸ªæœˆå°†å­©å­ç”Ÿä¸‹æ¥ï¼›è™½ç„¶åæœŸå·²äº¤ç”±å…¶ä»–ä¿æ¯(å·¥ç¨‹å¸ˆ)ç»§ç»­åŸ¹å…»ï¼Œæœ€è¿‘å¬åˆ°å®ƒå³å°†è¿›å…¥äº§å“ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹è¿˜æ˜¯æœ‰äº›è®¸é—æ†¾ã€‚



> ***äººç”Ÿä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬æ°¸è¿œéƒ½ä¸çŸ¥é“æ˜å¤©æ˜¯å¤ªé˜³å…ˆå‡èµ·è¿˜æ˜¯æ„å¤–å…ˆæ¥ä¸´ï¼›å”¯ä¸€èƒ½åšçš„å°±æ˜¯çæƒœå½“ä¸‹ï¼ŒæŠŠäº‹æƒ…åšå¥½ã€‚***



#### ç¼…æ€€



å‡¡èµ°è¿‡å¿…ç•™ä¸‹ç—•è¿¹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½åœ¨äº§å“è¿›å…¥ç»ˆç‚¹ç«™ä¹‹å‰åšäº›ä»€ä¹ˆï¼Œè®©å¤§å®¶è¿˜æœ‰æœºä¼šå›å¿†ä¹Ÿè®©å®ƒè‡³å°‘ç•™ä¸‹å­˜åœ¨è¿‡çš„è¯æ˜ï¼›ä»¥ä¸‹æ–¹å¼éƒ½éœ€è¦ App è¿˜åœ¨çº¿ä¸Šï¼Œå¦‚æœå·²ç»ä¸‹æ¶å°±çœŸçš„åªå‰©å›å¿†äº†ã€‚



### éæŠ€æœ¯æ–¹å¼ â€” å½•å½±



é™¤äº†ç›´æ¥ç”¨ [iPhone å†…å»ºçš„è¤å¹•å½•å½±åŠŸèƒ½](https://support.apple.com/zh-tw/102653){:target="_blank"} ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ QuickTime Player å°†æ‰‹æœºæ¥ä¸Š Mac ä½¿ç”¨ç”µè„‘è¿›è¡Œå½•å½±ã€æ±‡å‡ºå½±ç‰‡ã€‚



1. åœ¨ Mac ä¸Šæ‰“å¼€ QuickTime Player App



![](/assets/b04f4fba3cf2/1*UVkfiLbcYU8YuZEPdbJaOg.png)



2. å·¦ä¸Šè§’å·¥å…·åˆ—é€‰æ‹©ã€Œæ¡£æ¡ˆã€-&gt;ã€Œæ–°å¢å½±ç‰‡å½•åˆ¶ã€



![](/assets/b04f4fba3cf2/1*VcRN0FExy-CA7sExHtMT6w.png)



3. è·³å‡ºå½•å½±ä»‹é¢åç‚¹å‡» ğŸ”´ æ—çš„ã€Œvã€ï¼Œè¤å¹•ä¸æ‰¬å£°å™¨é€‰æ‹©æ‚¨æ¥ä¸Šçš„æ‰‹æœº



![](/assets/b04f4fba3cf2/1*SN0XL8Zt0UlBizXiIqZiyA.png)



4. æ­¤æ—¶å½•å½±ä»‹é¢å°±ä¼šå‡ºç°æ‰‹æœºç”»é¢



![](/assets/b04f4fba3cf2/1*MSuecaACmg3ZNMnGpDkRFQ.png)



ç‚¹å‡»ã€ŒğŸ”´ã€å¼€å§‹å½•å½±ï¼Œå›åˆ°æ‰‹æœºä¸Šæ“ä½œè¦å½•å½±çš„å†…å®¹ã€‚



![](/assets/b04f4fba3cf2/1*bxL9Dq1IWgbrlSfKO6skLQ.png)



å½•å½±ä¸­ä¼šæ˜¾ç¤ºå½“å‰å½±ç‰‡å¤§å°ï¼Œæ¬²ç»“æŸå½•å½±å†æŒ‰ä¸€æ¬¡ã€ŒğŸ”´ã€å³å¯åœæ­¢ã€‚



![](/assets/b04f4fba3cf2/1*VxWQNHF_PX5CZAkjJEXPbQ.png)



å¯ä»¥é€è¿‡ QuickTime Player å·¥å…·åˆ—ç®€å•çš„è£å‰ªå½±ç‰‡ï¼Œæœ€åæŒ‰ä¸‹ã€ŒCommandã€+ã€Œsã€æ±‡å‡ºå‚¨å­˜å½±ç‰‡åˆ°æŒ‡å®šä½ç½®ï¼Œå³å®Œæˆå½•å½±ç•™å¿µã€‚



å½±ç‰‡ç•™å¿µçš„å¥½å¤„æ˜¯æœªæ¥å›å¿†æ¯”å›¾ç‰‡æ›´å®¹æ˜“ä¸²è¿èµ·æ¥ï¼Œå½•çš„è¶Šæ·±å°±çºªå½•çš„è¶Šä»”ç»†ï¼Œè‹¥è¦å°†æ›´åˆ«ç”»é¢è½¬æˆå›¾ç‰‡ä¹Ÿå¯ä»¥ç›´æ¥æˆªå›¾ï¼Œå¾ˆæ–¹ä¾¿ã€‚



### æŠ€æœ¯æ–¹å¼



App æŠ€æœ¯å¤‡ä»½å¯åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼›ã€Œéª¨ã€App æœ¬èº«å…¶å®åªæ˜¯ä¸ªéª¨æ¶ã€ã€Œè‚‰ã€ç”± API Response Data ç»„æˆæ‰æ˜¯ App å†…å®¹èµ„æ–™çš„æ ¸å¿ƒã€‚



- éª¨ä¼šéšè‘— App ä» App Store å•†åŸä¸‹æ¶è€Œæ¶ˆå¤±ã€‚


- è‚‰ä¼šéšè‘— API ä¸»æœºã€ä¼ºæœå™¨å…³é—­è€Œæ¶ˆå¤±ã€‚



å› æ­¤æˆ‘ä»¬ä¹Ÿåˆ†æˆå¤‡ä»½éª¨è·Ÿè‚‰ä¸¤ä¸ªæŠ€æœ¯æ–¹å¼ã€‚



#### å£°æ˜



> *æœ¬æ–‡ä»…ä¸ºæŠ€æœ¯ç ”ç©¶åˆ†äº«ï¼Œä¸é¼“åŠ±åˆ©ç”¨ä»»ä½•æŠ€æœ¯è¿›è¡Œéæ³•ã€ä¾µæƒè¡Œä¸ºã€‚*



#### [éª¨] å¤‡ä»½ .ipa App å®‰è£…æ¡£



App åœ¨å•†åŸä¸‹æ¶åå·²ä¸‹è½½ App çš„æ‰‹æœºåªè¦ä¸ä¸»åŠ¨åˆ é™¤ Appï¼Œå°±ä¼šä¸€ç›´å­˜åœ¨åœ¨è¯¥æ‰‹æœºä¸Šï¼Œæ¢æ‰‹æœºç”¨è½¬ç§»çš„æ–¹å¼ä¹Ÿä¼šä¸€å¹¶è½¬ç§»è¿‡å»ã€‚



ä½†å¦‚æœæˆ‘ä»¬ä¸å°å¿ƒåˆ é™¤è¯¥ App æˆ–æ˜¯æ¢æ‰‹æœºæ²¡è½¬ç§»ï¼Œé‚£å°±çœŸçš„æ°¸è¿œè·Ÿä»–è¯´å†è§äº†ï¼›æ­¤æ—¶å¦‚æœæœ‰æ‰‹åŠ¨å¤‡ä»½å•†åŸçš„ .ipa æ¡£æ¡ˆå°±èƒ½å†æ¬¡ç»­å‘½ã€‚



å¾ˆä¹…ä»¥å‰ [é€†å‘å·¥ç¨‹çš„æ–‡ç« ](../7498e1ff93ce/) æœ‰æåˆ°è¿‡ï¼Œä½†è¿™æ¬¡åªéœ€å•çº¯å¤‡ä»½ .ipa æ¡£æ¡ˆä¸éœ€æ•²å£³ï¼Œå…¨éƒ¨éƒ½æ˜¯ä½¿ç”¨ Apple å®˜æ–¹æä¾›çš„å·¥å…·å®Œæˆã€‚



**1.å®‰è£… [Apple Configurator 2](https://apps.apple.com/tw/app/apple-configurator/id1037126344?mt=12){:target="_blank"}**



![](/assets/b04f4fba3cf2/1*_RzuFIVGV9T_-xJ53H8fGA.png)



é¦–å…ˆå» Mac App Store ä¸‹è½½å®‰è£…ã€Œ [Apple Configurator 2](https://apps.apple.com/tw/app/apple-configurator/id1037126344?mt=12){:target="_blank"} ã€



**2. å°† iPhone æ¥ä¸Š Mac å¹¶ç‚¹å‡»ä¿¡ä»»ç”µè„‘**



![](/assets/b04f4fba3cf2/1*EiSQmOkDCW73kYhJWbTipQ.png)



æ¥ä¸ŠæˆåŠŸåå°±ä¼šå‡ºç° iPhone çš„ä¸»ç”»é¢ã€‚



**3. ç¡®è®¤ä½ çš„æ‰‹æœºå·²å®‰è£…æ¬²å¤‡ä»½ .ipa æ¡£æ¡ˆçš„ App**



![](/assets/b04f4fba3cf2/1*QD9M4uM9eyKSixzu8AdKbw.png)



æˆ‘ä»¬éœ€è¦åœ¨ Apple Configurator 2 å¡å‡ºå–ä»£ç”»é¢ï¼Œæ‰èƒ½å–å¾—ä¸‹è½½åˆ°æš‚å­˜ä¸­çš„ .ipa æ¡£æ¡ˆï¼Œå› æ­¤æˆ‘ä»¬è¦å…ˆç¡®ä¿æ‰‹æœºä¸Šæœ‰å®‰è£…ç›®æ ‡ Appã€‚



**4. å›åˆ° Mac ä¸Šçš„ Apple Configurator 2**



ç‚¹ä¸¤ä¸‹ä¸Šé¢æ˜¾ç¤ºçš„ iPhone ä¸»ç”»é¢è¿›å…¥èµ„è®¯é¡µã€‚



![](/assets/b04f4fba3cf2/1*X_y5uGhRRIq7VQuW4PkYBg.png)



åˆ‡æ¢åˆ°ã€ŒAppã€-&gt; å³ä¸Šè§’ã€Œ+ åŠ å…¥ã€-&gt;ã€ŒAppã€



å®Œæˆ App Store å¸å·ç™»å…¥åå¯ä»¥å–å¾—æ‚¨æ›¾ç»è´­ä¹°è¿‡çš„ App åˆ—è¡¨ã€‚



![](/assets/b04f4fba3cf2/1*uAyjPD75-MGokHCbDoC_4g.png)



æœå¯»æ‰¾åˆ°æ¬²å¤‡ä»½çš„ç›®æ ‡ Appï¼Œé€‰æ‹©åç‚¹ã€ŒåŠ å…¥ã€ã€‚



![](/assets/b04f4fba3cf2/1*T-v1CNrmc7T4MpeyAX0c7A.png)



æ­¤æ—¶ä¼šå‡ºç°ç­‰å¾…è§†çª—ï¼Œæ­£åœ¨ XXX ä¸ŠåŠ å…¥ Appã€æ­£åœ¨ä¸‹è½½ã€ŒXXXã€ã€‚



**5. æå– .ipa æ¡£æ¡ˆ**



> ***æ”¾è‘—ç­‰ä»–ä¸‹è½½å®Œæˆåï¼Œä¼šè·³å‡ºè¯¢é—®æ˜¯å¦è¦å–ä»£ç°æœ‰å·²å®‰è£… App è§†çª—ã€‚***



![](/assets/b04f4fba3cf2/1*9f54be4lixn4ezKhwRJrtg.png)



> ***æ­¤æ—¶ä¸è¦æŒ‰ä»»ä½•åŠ¨ä½œã€‚æ­¤æ—¶ä¸è¦æŒ‰ä»»ä½•åŠ¨ä½œã€‚æ­¤æ—¶ä¸è¦æŒ‰ä»»ä½•åŠ¨ä½œã€‚***



æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ª Finderï¼š



å·¦ä¸Šè§’å·¥å…·åˆ—é€‰æ‹©ã€Œå‰å¾€ã€-&gt; ã€Œå‰å¾€æ¡£æ¡ˆå¤¹ã€



![](/assets/b04f4fba3cf2/1*JgXWca5hKROuoOgLThkQnw.png)



è´´ä¸Šä»¥ä¸‹è·¯å¾„ï¼š



```bash
~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps
```



å°±å¯ä»¥æ‰¾åˆ°ä¸‹è½½ä¸‹æ¥æ­£å‡†å¤‡è¦å®‰è£…çš„ç›®æ ‡ App .ipa æ¡£æ¡ˆï¼š



![](/assets/b04f4fba3cf2/1*zV5yWozKqXtwekI33NWwVg.png)



å°†å…¶å¤åˆ¶å‡ºæ¥å³å¯å®Œæˆ App .ipa æ¡£æ¡ˆå¤‡ä»½ã€‚



å®Œæˆæ¡£æ¡ˆå¤åˆ¶åå†å›å» Apple Configurator 2 ç‚¹å‡»åœæ­¢ï¼Œç»ˆæ­¢æ“ä½œã€‚



#### [éª¨] è¿˜åŸ .ipa App å®‰è£…æ¡£



ä¸€æ ·æ˜¯å°†æ¬²è¿˜åŸ App çš„æ‰‹æœºæ¥ä¸Š Mac å¹¶æ‰“å¼€ Apple Configurator 2ï¼Œè¿›å…¥ App åŠ å…¥ä»‹é¢ã€‚



![](/assets/b04f4fba3cf2/1*6miYYw5QL6iqLQqrtHOi2A.png)



è¿˜åŸçš„è¯è¦é€‰æ‹©å·¦ä¸‹è§’ã€Œä»æˆ‘çš„ Mac é€‰æ‹©â€¦ã€



![](/assets/b04f4fba3cf2/1*7a_25rE2eDpMFZqBC3sP6g.png)



é€‰æ‹©å¤‡ä»½çš„ App .ipa æ¡£æ¡ˆï¼ŒæŒ‰ã€ŒåŠ å…¥ã€ã€‚



![](/assets/b04f4fba3cf2/1*AcGEAuowmvvGRb-E22wu2g.png)



ç­‰å¾…ä¼ é€ã€å®‰è£…å®Œæˆï¼Œå›åˆ°æ‰‹æœºä¸Šå°±èƒ½é‡æ–°æ‰“å¼€ Appï¼Œå¤æ´»æˆåŠŸï¼



#### [è‚‰] å¤‡ä»½æœ€åçš„ API Response Data



è¿™è¾¹ä¼šè¿ç”¨åˆ°ä¹‹å‰åœ¨ [**App End-to-End Testing Local Snapshot API Mock Server**](../5a5c4b25a83d/) **æ–‡ç« (ç»†èŠ‚åŸç†å¯å‚è€ƒ)** ä¸­æ‰€ä½¿ç”¨åˆ°çš„æ–¹å¼è·Ÿå½“æ—¶å¼„çš„å¼€æºä¸“æ¡ˆï¼š



[![](https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4)](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"}



åŒä¹‹å‰ç”¨å½•åˆ¶ API Request & Response æ¥è·‘ E2E Testing çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥çºªå½• App ä¸‹æ¶ã€åœæœºå‰æœ€åçš„ API Request & Response Dataã€‚



**1. å®‰è£… [mitmproxy](https://mitmproxy.org/){:target="_blank"}**



```typescript
brew install mitmproxy
```



mitmproxy æ˜¯ä¸€å¥—å¼€æºçš„ä¸­é—´äººæ”»å‡»ï¼Œç½‘è·¯è¯·æ±‚å—…æ¢å·¥å…·ã€‚



å¦‚æœä½ ä¸ç†Ÿæ‚‰ Mitmproxy ä¸­é—´äººæ”»å‡»çš„å·¥ä½œåŸç†å¯å…ˆå‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼šã€Œ [APPæœ‰ç”¨HTTPSä¼ è¾“ï¼Œä½†èµ„æ–™è¿˜æ˜¯è¢«å·äº†ã€‚](../46410aaada00/) ã€æˆ– [Mimproxy å®˜æ–¹æ–‡ä»¶](https://docs.mitmproxy.org/stable/overview-getting-started/){:target="_blank"} ã€‚



å¦‚æœæ˜¯ç”¨åœ¨çº¯ç½‘è·¯è¯·æ±‚å—…æ¢ï¼Œç”¨ä¸ä¹ æƒ¯ mimproxy ä»‹é¢ä¹Ÿå¯ä»¥æ”¹ç”¨ã€Œ [Proxyman](https://proxyman.io/){:target="_blank"} ã€å¯å‚è€ƒä¹‹å‰ [å¦ä¸€ç¯‡æ–‡ç« ](../70a1409b149a/) çš„ç”¨æ³•ã€‚



**2. å®Œæˆ mitmproxy å‡­è¯è®¾å®š**



> *é’ˆå¯¹ HTTPS åŠ å¯†è¿çº¿æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ ¹å‡­è¯æŠ½æ¢è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡ä½¿ç”¨é¡»å…ˆå®Œæˆæ‰‹æœºç«¯æ ¹å‡­è¯ä¸‹è½½ä¸å¯ç”¨ã€‚*



> **å¦‚æœæ‚¨çš„ App & API Server æœ‰å®ä½œ SSL Pinning ä¹Ÿéœ€è¦å°† Pinning å‡­è¯åŠ å…¥åˆ° mitmproxyã€‚*



- é¦–å…ˆç¡®ä¿ iPhone æ‰‹æœºä¸ Mac ç”µè„‘æ˜¯è¿æ¥åœ¨ç›¸åŒçš„ç½‘è·¯ç¯å¢ƒ


- è‹¥æ—  WiFi ç”µè„‘è¿æ¥å®ä½“ç½‘è·¯ï¼Œä¹Ÿå¯ä»¥ [æ‰“å¼€ Mac çš„ WiFi åˆ†äº«åŠŸèƒ½](https://applealmond.com/posts/92291){:target="_blank"} è®©æ‰‹æœºè¿åˆ° Mac çš„ç½‘è·¯



åœ¨ Terminal å¯åŠ¨ `mitmproxy` or `mitmweb` (Web GUI ç‰ˆ)ã€‚



```typescript
mitmproxy
```



![](/assets/b04f4fba3cf2/1*xruNW5ZUPNuxVJvKOyPQTA.png)



çœ‹åˆ°è¿™ç”»é¢ä»£è¡¨ mitmproxy æœåŠ¡å·²å¯åŠ¨ï¼Œç›®å‰æ²¡æœ‰æµé‡è¿›æ¥æ‰€ä»¥æ˜¯ç©ºçš„ï¼ŒæŒ‚åœ¨è¿™ä¸ªç”»é¢ä¸è¦å…³é—­ Terminalã€‚



- åˆ° Mac ç½‘è·¯è®¾å®šæŸ¥çœ‹ Mac çš„ IP ä½å€



å›åˆ°æ‰‹æœº WiFi è®¾å®šç‚¹å‡»ã€Œiã€è¿›å…¥è¯¦ç»†è®¾å®šï¼Œæ‰¾åˆ°æœ€ä¸‹æ–¹ã€Œè®¾å®šä»£ç†ä¼ºæœå™¨ã€ï¼š



![](/assets/b04f4fba3cf2/1*zXVilpUXnXakpWib007BPA.png)



![](/assets/b04f4fba3cf2/1*QV6reSNc0AJg7sQa2qiCjQ.png)



- ä¼ºæœå™¨è¾“å…¥ Mac ç”µè„‘çš„ IP ä½å€


- è¿æ¥åŸ è¾“å…¥ 8080


- å‚¨å­˜



**åœ¨æ‰‹æœºä¸Šæ‰“å¼€ Safari è¾“å…¥ï¼š <http://mitm.it/>{:target="_blank"}**



å¦‚æœå‡ºç°ï¼š



```kotlin
If you can see this, traffic is not passing through mitmproxy.
```



ä»£è¡¨æ‰‹æœºçš„ç½‘è·¯ä»£ç†ä¼ºæœå™¨æ²¡æœ‰è®¾å®šæˆåŠŸæˆ–æ˜¯ Mac ä¸Šæ²¡å¯åŠ¨ `mitmproxy` ã€‚



æ­£å¸¸æƒ…å†µä¼šå‡ºç°ï¼š



![](/assets/b04f4fba3cf2/1*Ks5IHpi2AoPj4wXu5ZH9VA.png)



> *æ­¤æ—¶åªæœ‰ HTTP æµé‡èƒ½è¢«å—…æ¢ï¼ŒHTTPS æµé‡ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹è®¾å®šã€‚*



ä»£è¡¨è¿æ¥æˆåŠŸï¼Œæˆ‘ä»¬æ‰¾åˆ° iOS åŒºå—ç‚¹å‡»ã€ŒGet mimproxy-ca-cert.pemã€



![](/assets/b04f4fba3cf2/1*HvIg0jtUQ5ops519YUA52A.png)



![](/assets/b04f4fba3cf2/1*tU3gi3PBvrbUc-tqKjUD9w.png)



- ç‚¹å‡»ã€Œå…è®¸ã€



ä¸‹è½½å®Œæˆåè¿›å…¥åˆ°æ‰‹æœºçš„è®¾å®šï¼Œä¼šå‡ºç°ã€Œå·²ä¸‹è½½æè¿°æ¡£ã€ç‚¹å‡»è¿›å…¥ã€‚



![](/assets/b04f4fba3cf2/1*JzX7U1jCtda915mGz5CPjw.png)



![](/assets/b04f4fba3cf2/1*mWmVPZ-au302NGHXgCxAow.png)



![](/assets/b04f4fba3cf2/1*SMnr82MEIo4YaYOvTpILeQ.png)



- ç‚¹å‡»è¿›å…¥ï¼Œå³ä¸Šè§’ã€Œå®‰è£…ã€ï¼Œè¾“å…¥æ‰‹æœºå¯†ç å®Œæˆå®‰è£…ã€‚



å›åˆ°è®¾å®š -&gt; ã€Œä¸€èˆ¬ã€-&gt;ã€Œå…³äºæœ¬æœºã€-&gt; æœ€ä¸‹æ–¹ã€Œå‡­è¯ä¿¡ä»»è®¾å®šã€-&gt; å¯ç”¨ã€Œmitmproxyã€ã€‚



![](/assets/b04f4fba3cf2/1*UOcYlpOolfWithLb517__g.png)



![](/assets/b04f4fba3cf2/1*LAoe10TplFdfWXEHMRAvWw.png)



- ã€Œç»§ç»­ã€å®Œæˆå¯ç”¨ã€‚



è‡³æ­¤æˆ‘ä»¬å°±å®Œæˆä¸­é—´äººæ”»å‡»æ‰€æœ‰çš„å‰ç½®å‡†å¤‡å·¥ä½œã€‚



> *è¦è®°å¾—å½“å‰ä½ æ‰‹æœºæ‰€æœ‰çš„æµé‡éƒ½ä¼šç»è¿‡ä»£ç†ä»ä½ çš„ Mac ç”µè„‘å‡ºå»ï¼Œ **æ“ä½œå®Œæ¯•è®°å¾—å›åˆ°æ‰‹æœºä¸Šçš„ç½‘è·¯è®¾å®šæŠŠä»£ç†ä¼ºæœå™¨è®¾å®šå…³æ‰** ï¼Œå¦åˆ™æ‰‹æœºç½‘è·¯ WiFi ä¼šå…¨éƒ¨è¿ä¸ä¸Šå¯¹å¤–ç½‘è·¯ã€‚*



å›åˆ° Terminal mitmproxyï¼Œä¸€è¾¹æ“åšæ‰‹æœºä¸Šçš„ App å°±èƒ½çœ‹åˆ°æ‰€æœ‰è¢«æ•æ‰çš„ API è¯·æ±‚çºªå½•ã€‚



![](/assets/b04f4fba3cf2/1*-aRzC2HWRCvGok-L9jbjHA.png)



æ¯ä¸ªè¯·æ±‚éƒ½èƒ½è¿›å…¥æŸ¥çœ‹è¯¦ç»† Request & Response å†…å®¹ï¼š



![](/assets/b04f4fba3cf2/1*IyO00OEpAadapGKNtOV_Mg.png)



ä»¥ä¸Šæ˜¯ mitmproxy åŸºç¡€è®¾å®šä¸å®é™…å·¥ä½œã€‚



**3. å—…æ¢ã€äº†è§£ API æ¶æ„**



å†æ¥å°±è¦é€è¿‡ mitmproxy çš„ `mitmdump` æœåŠ¡ç»“åˆæˆ‘ä¹‹å‰å¼€å‘çš„ [**mitmproxy-rodo**](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} [addons](https://docs.mitmproxy.org/stable/addons-overview/){:target="_blank"} å½•åˆ¶è¯·æ±‚å’Œå›æ”¾è¯·æ±‚ã€‚



> [*æˆ‘çš„å®ç°åŸç†*](../5a5c4b25a83d/) *æ˜¯å°† Request è¯·æ±‚å‚æ•°è®¡ç®—æˆ Hash å€¼ï¼Œåœ¨å›æ”¾æ—¶å†æ¬¡å°†è¯·æ±‚æ‹¿å»è®¡ç®— Hash å¦‚æœåœ¨æœ¬åœ°æœ‰æ‰¾åˆ°ç›¸åŒ Hash å€¼çš„å¤‡ä»½ Response åˆ™è¿”å›ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒ Hash å€¼çš„è¯·æ±‚ä¼šæŒ‰ç…§é¡ºåºå‚¨å­˜ï¼†å›æ”¾ã€‚*



æˆ‘ä»¬å¯ä»¥å…ˆé€è¿‡ä»¥ä¸Šæ–¹æ³•å—…æ¢ App çš„ API (æˆ–ä½¿ç”¨ [Proxyman](https://proxyman.io/){:target="_blank"} )ï¼Œè§‚å¯Ÿæœ‰å“ªäº›æ ä½è·Ÿå“ªäº›æ ä½å¯èƒ½ä¼šå½±å“ Hash Mappingï¼Œå¯ä»¥å°†å…¶è®°å½•ä¸‹æ¥ï¼Œåœ¨åç»­è®¾å®šæ’é™¤ï¼Œ **ä¾‹å¦‚æœ‰çš„ API å›ºå®šä¼šå¸¦ `?ts` è¿™å‚æ•°ä¸å½±å“å›ä¼ å†…å®¹ï¼Œä½†ä¼šå½±å“ Hash å€¼è®¡ç®—å¯¼è‡´æ— æ³•æ‰¾åˆ°æœ¬åœ°çš„å¤‡ä»½ï¼Œæˆ‘ä»¬å°±éœ€è¦æŒ‘å‡ºæ¥åœ¨åé¢çš„è®¾å®šä¸­æ’é™¤æ‰** ã€‚



**4.è®¾å®š [mitmproxy-rodo](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} :**



ä½¿ç”¨æˆ‘å†™å¥½çš„å½•åˆ¶ã€å›æ”¾å¼€æº Scriptã€‚



> ***ç»†èŠ‚å‚æ•°è®¾å®šè¯·å‚è€ƒè¯¥å¼€æºä¸“æ¡ˆçš„è¯´æ˜ã€‚***



```bash
git clone git@github.com:ZhgChgLi/mitmproxy-rodo.git
cd mitmproxy-rodo
```



å°†ä¸Šä¸€æ­¥éª¤ 3. æŒ‘å‡ºæ¥çš„å‚æ•°å¡«å…¥åˆ° config.json è®¾å®šæ¡£æ¡ˆä¸­ï¼š



```json
{
  "ignored": {
    "*": {
      "*": {
        "*": {
          "iterable": false,
          "enables": [
            "query",
            "formData"
          ],
          "rules": {
            "query": {
              "parameters": [
                "ts",
                "connect_id",
                "device_id",
                "device_name",
              ]
            },
            "formData": {
              "parameters": [
                "aidck",
                "device_id",
                "ver_name",
              ]
            }
          }
        }
      }
    }
  }
}
```



ä»¥ä¸Šå‚æ•°åœ¨è®¡ç®— Hash å€¼æ—¶éƒ½ä¼šè¢«æ’é™¤ï¼Œä¹Ÿèƒ½é’ˆå¯¹ä¸ªåˆ« Endpoint è·¯å¾„è®¾å®šç‰¹å®šæ’é™¤è§„åˆ™ã€‚



**5. å¯ç”¨å½•åˆ¶ï¼Œåœ¨ Terminal ä¸‹æ”¹æ‰§è¡Œï¼š**



```bash
mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json --set record=true "~d zhgchg.li"
```



- ç»“å°¾çš„ `"~d zhgchg.li"` æ„æ€æ˜¯åªæˆªå– * .zhgchg.li çš„æµé‡ã€‚


- `dumper_folder` : è¾“å‡ºç›®çš„ç›®å½•åç§°



**6. å›åˆ°æ‰‹æœºä¸Šæ“ä½œç›®æ ‡ App æ‰§è¡Œæ¬²å½•åˆ¶çš„æµç¨‹è·¯å¾„**



- å»ºè®®é‡å¯ã€é‡å®‰è£… App ç”¨æœ€å¹²å‡€çš„æ–¹å¼å¼€å§‹æ“ä½œ


- å»ºè®®å¯ä»¥æ­é…å½•å½±ï¼Œä»¥åˆ©è®°å¾—å¤ç°æ­¥éª¤



![](/assets/b04f4fba3cf2/1*SeivG1XaRcd5uq2uMkyrSA.png)



è¾¹æ“ä½œçš„åŒæ—¶ï¼Œå°±èƒ½çœ‹åˆ°è¾“å‡ºç›®å½•ä¼šæœ‰å¾ˆå¤šæ’·å–ä¸‹æ¥çš„ API Response Dataï¼Œä¼šç…§è‘— Domain -&gt; API è·¯å¾„ -&gt; HTTP æ–¹æ³• -&gt; Hash å€¼ -&gt; Header-X / Content-X å­˜æ”¾(è‹¥ç›¸åŒ Hash è¯·æ±‚ä¸¤æ¬¡ï¼Œä¼šæŒ‰ç…§é¡ºåºå‚¨å­˜ä¸‹æ¥)ã€‚



- é‡æ–°å½•åˆ¶å¯ä»¥ç›´æ¥åˆ å‡ºè¾“å‡ºç›®å½•ï¼Œè®©ä»–é‡æ–°æ’·å–ã€‚


- **å¦‚æœå›ä¼ çš„èµ„æ–™åŒ…å«ä¸ªèµ„ï¼Œè¯·è®°å¾—è°ƒæ•´æ’·å–å†…å®¹å»è¯†åˆ«åŒ–ã€‚**



#### [è‚‰] å›æ”¾æ’·å–åˆ°çš„ API Response Data



å½•åˆ¶å®Œæ¯•åè¯·åŠ¡å¿…è¦å°è¯•å›æ”¾ä¸€æ¬¡ï¼Œæµ‹è¯•èµ„æ–™æ˜¯å¦æ­£å¸¸ï¼Œè‹¥ Hash Hit å¾ˆä½(å›æ”¾æ—¶å‡ ä¹éƒ½æ²¡æ‰¾åˆ°å¯¹åº”çš„ Response)ï¼Œå¯ä»¥é‡å¤å—…æ¢æ­¥éª¤æ‰¾åˆ°é‚£ä¸ªæ¯æ¬¡æ‰§è¡Œ App éƒ½ä¸ç¡®å®šå½±å“ Hash å€¼çš„å˜æ•°å¹¶å°†å…¶æ’é™¤ã€‚



**æ‰§è¡Œå›æ”¾ï¼š**



```bash
mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json
```



- `dumper_folder` : è¾“å‡ºç›®çš„ç›®å½•åç§°


- é¢„è®¾æœ¬åœ°æ²¡æœ‰ Hash Mapping åˆ°çš„ Response Data ä¼šç›´æ¥å›ä¼  404 è®© App ç©ºç™½ï¼Œè¿™æ ·æ‰èƒ½çŸ¥é“æ’·å–çš„èµ„æ–™æœ‰æ²¡æœ‰æ•ˆã€‚



![](/assets/b04f4fba3cf2/1*0Cjy_5RZRq3tvE1Pc0lQ9A.png)



![](/assets/b04f4fba3cf2/1*JKorlo3EBeSWXhB9Exw4ZA.png)



- å½•åˆ¶æ’·å–æ—¶æœ‰ç»è¿‡è¿‡çš„è·¯å¾„é¡µé¢ï¼Œå›æ”¾æ—¶èƒ½é‡æ–°æ˜¾ç¤ºï¼šOK!


- å½•åˆ¶æ’·å–æ—¶æ²¡ç»è¿‡è¿‡çš„è·¯å¾„é¡µé¢ï¼Œå›æ”¾æ—¶æ˜¾ç¤ºç½‘è·¯é”™è¯¯ï¼šOK!



### ç¼…æ€€



è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªè¡Œé€è¿‡è¿˜åŸéª¨ä¸æœ€åçš„è‚‰ï¼Œæ¥å¤ç°å½“å¹´ App èµ°è¿›ç»ˆç‚¹ç«™å‰çš„æœ€åæ—¶å…‰ï¼Œä»¥æ­¤ç¼…æ€€é‚£ä¸ªå¤§å®¶ä¸€èµ·åŒå¿ƒååŠ›ç”Ÿäº§å‡ºæ¥çš„æ—¶å…‰ã€‚



ä»¥æ­¤ç¯‡æ–‡ç« çºªå¿µç¬¬ä¸€ä»½å·¥ä½œçš„å›¢é˜Ÿä¸å½“å¹´ä»ç½‘é¡µåç«¯å¼€å‘è¾¹åšè¾¹å­¦è½¬èŒ iOS App å¼€å‘ï¼Œç‹¬ç«‹ä»æ— åˆ°æœ‰åœ¨ 3â€“4 ä¸ªæœˆçš„çŸ­æš‚æ—¶é—´ï¼Œä¸ Androidã€è®¾è®¡ã€PM ä¸»ç®¡ã€åç«¯åŒäº‹ä¸€åŒé¡ºåˆ©ç”Ÿäº§å‡ºçš„äº§å“ï¼Œè™½ç„¶å®ƒå³å°†è¿›å…¥ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹ç«™ï¼Œä½†æˆ‘æ°¸è¿œéƒ½ä¼šè®°å¾—å½“å¹´çš„é…¸ç”œè‹¦è¾£ä¸ç¬¬ä¸€æ¬¡çœ‹åˆ°ä»–ä¸Šçº¿ã€æœ‰äººä½¿ç”¨çš„é‚£ä¸ªæ„ŸåŠ¨ã€‚



> ã€Œè°¢è°¢ã€



#### æ¬¢è¿ååŠ©è´¡çŒ®



å¦‚æœä½ ä¹Ÿæœ‰ç›¸åŒçš„é—æ†¾ï¼Œå¸Œæœ›æœ¬ç¯‡æ–‡ç« ä¹Ÿèƒ½å¸®åŠ©åˆ°ä½ ï¼Œå› ä¸º [mitmproxy-rodo](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} å½“åˆåªæ˜¯ POC æ¦‚å¿µéªŒè¯ä¸‹å¼€å‘å‡ºçš„å·¥å…·ï¼Œæ¬¢è¿ååŠ©è´¡çŒ®ã€æå‡ºé‡åˆ°çš„ Bug æˆ–å¼€ PR ä¿®æ”¹ Bugã€‚



[![](https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4)](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main?source=post_page-----5a5c4b25a83d--------------------------------){:target="_blank"}



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/app-%E7%94%A2%E5%93%81%E9%80%B2%E5%85%A5%E7%B5%82%E9%BB%9E%E7%AB%99-%E8%83%BD%E5%81%9A%E4%BB%80%E9%BA%BC%E4%BA%8B%E7%B7%AC%E6%87%B7-b04f4fba3cf2){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*