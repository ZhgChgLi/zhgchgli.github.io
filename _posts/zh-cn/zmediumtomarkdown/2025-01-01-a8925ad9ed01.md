---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2025-01-01T14:02:32.433+0000
description: 自行封装扩充方法，使其有 Namespace 的功能
image:
  path: /assets/a8925ad9ed01/1*kJFHiAuTZ8TP-4aTa_daqA.png
last_modified_at: 2025-01-01T14:02:32.433+0000
render_with_liquid: false
tags:
- ios-app-development
- swift
- wrapper
- app-modularization
- ios
title: Swift 一个优雅的原生类型扩展方式
---

### [Swift] 一个优雅的 **原生类型扩展方式**



自行封装扩充方法，使其有 Namespace 的功能



![<https://www.swift.org/>{:target="_blank"}](/assets/a8925ad9ed01/1*kJFHiAuTZ8TP-4aTa_daqA.png)



<https://www.swift.org/>{:target="_blank"}



> *做法实际出处不详，是从厉害同事的 Code 上学到的。*



### 原生类型扩展



在日常的 iOS/Swift 开发中，我们常常需要对原生 API 进行扩充、撰写自己的 Helper。



**以下以扩充 UIColor 为例，我们希望扩充 UIColor 使其能转换成 HEX Color String：**



```swift
extension UIColor {
    /// Convert a UIColor to a hex string representation.
    /// - Returns: A hex string (e.g., "#RRGGBB" or "#RRGGBBAA").
    func toHexString(includeAlpha: Bool = false) -> String? {
        var red: CGFloat = 0
        var green: CGFloat = 0
        var blue: CGFloat = 0
        var alpha: CGFloat = 0

        guard self.getRed(&red, green: &green, blue: &blue, alpha: &alpha) else {
            return nil // Color could not be represented in RGB space
        }

        if includeAlpha {
            return String(format: "#%02X%02X%02X%02X",
                          Int(red * 255),
                          Int(green * 255),
                          Int(blue * 255),
                          Int(alpha * 255))
        } else {
            return String(format: "#%02X%02X%02X",
                          Int(red * 255),
                          Int(green * 255),
                          Int(blue * 255))
        }
    }
}
```



直接对 UIColor 进行扩充 (Extension) 后的存取方式如下：



```swift
let color = UIColor.blue
color.toHexString() // #0000ff
```



#### 问题



当我们自定义的扩充方式越来越多会让存取介面开始变得混乱，例如：



```swift
let color = UIColor.blue
color.getRed(...)
color.getWhite(...)
color.getHue(...)
color.getCMYK() // 自行扩充的方法
color.toHexString() // 自行扩充的方法
color.withAlphaComponent(...)
color.setFill(...)
color.setToBlue() // 自行扩充的方法

// A Module
public extension UIColor {
  func getCMYK() {
    // ...
  }
}

// B Module
// Invalid redeclaration of 'getCMYK()'
public extension UIColor {
  func getCMYK() {
    // ...
  }
}
```



我们自行扩充的方法跟原生提供的方法全部混合在一起，难以区分；另外专案规模越大、引用的套件越多也有可能遇到 Extension 命名冲突，例如两个套件都对 UIColor Extension 也都叫 `getCMYK()` 就会有问题。



### 自订扩展 Namespace 容器



我们可以运用 Swift Protocol, Computed Property 与 泛型的特型来自行封装扩充方法，使其有 Namespace 的功能。



```swift
// 宣告一个泛型容器 ExtensionContainer<Base>：
public struct ExtensionContainer<Base> {
    public let base: Base
    public init(_ base: Base) {
        self.base = base
    }
}

// 定义 for AnyObject, Class(Reference) Type 实现的接口：
// 例如 Foundation 中的 NSXXX 类别
public protocol ExtensionCompatibleObject: AnyObject {}
// 定义 for Struct(Value) Type 实现的接口：
public protocol ExtensionCompatible {}

// 自订义 Namespace Computed Property：
public extension ExtensionCompatibleObject {
    var zhg: ExtensionContainer<Self> {
        return ExtensionContainer(self)
    }
}

public extension ExtensionCompatible {
    var zhg: ExtensionContainer<Self> {
        return ExtensionContainer(self)
    }
}
```



#### 扩展原生类型



```swift
extension UIColor: ExtensionCompatibleObject {}

extension ExtensionContainer where Base: UIColor {
    /// Convert a UIColor to a hex string representation.
    /// - Returns: A hex string (e.g., "#RRGGBB" or "#RRGGBBAA").
    func toHexString(includeAlpha: Bool = false) -> String? {
        var red: CGFloat = 0
        var green: CGFloat = 0
        var blue: CGFloat = 0
        var alpha: CGFloat = 0

        guard self.base.getRed(&red, green: &green, blue: &blue, alpha: &alpha) else {
            return nil // Color could not be represented in RGB space
        }

        if includeAlpha {
            return String(format: "#%02X%02X%02X%02X",
                          Int(red * 255),
                          Int(green * 255),
                          Int(blue * 255),
                          Int(alpha * 255))
        } else {
            return String(format: "#%02X%02X%02X",
                          Int(red * 255),
                          Int(green * 255),
                          Int(blue * 255))
        }
    }
}
```



#### 使用



```swift
let color = UIColor.blue
color.zhg.toHexString() // #0000ff
```



#### 范例 2. URL .queryItems 扩充



```
extension URL: ExtensionCompatible {}

extension ExtensionContainer where Base == URL {
    
    var queryParameters: [String: String]? {
        URLComponents(url: base, resolvingAgainstBaseURL: true)?
            .queryItems?
            .reduce(into: [String: String]()) { $0[$1.name] = $1.value }
    }
}
```



### 结合 [Builder Pattern](https://refactoring.guru/design-patterns/builder){:target="_blank"}



另外我们也可以将此封装方式结合 Builder Pattern 操作：



```swift
final class URLBuilder {
    private var components: URLComponents

    init(base: URL) {
        self.components = URLComponents(url: base, resolvingAgainstBaseURL: true)!
    }

    func setQueryParameters(_ parameters: [String: String]) -> URLBuilder {
        components.queryItems = parameters.map { .init(name: $0.key, value: $0.value) }
        return self
    }

    func setScheme(_ scheme: String) -> URLBuilder {
        components.scheme = scheme
        return self
    }

    func build() -> URL? {
        return components.url
    }
}

extension URL: ExtensionCompatible {}

extension ExtensionContainer where Base == URL {
    func builder() -> URLBuilder {
        return URLBuilder(base: base)
    }
}

let url = URL(string: "https://zhgchg.li")!.zhg.builder().setQueryParameters(["a": "b", "c": "d"]).setScheme("ssh").build()
// ssh://zhgchg.li?a=b&c=d
```



有任何问题及指教欢迎 [与我联络](https://www.zhgchg.li/contact){:target="_blank"} 。



*[Post](https://medium.com/zrealm-ios-dev/swift-%E4%B8%80%E5%80%8B%E5%84%AA%E9%9B%85%E7%9A%84%E5%8E%9F%E7%94%9F%E9%A1%9E%E5%9E%8B%E6%93%B4%E5%B1%95%E6%96%B9%E5%BC%8F-a8925ad9ed01){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*