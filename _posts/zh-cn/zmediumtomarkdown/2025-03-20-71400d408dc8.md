---
author: ZhgChgLi
categories:
- ZRealm Robotic Process Automation
date: 2025-03-20T14:12:48.523+0000
description: 以 Google Apps Script x Firebase App Distribution API 串接为例
image:
  path: /assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png
last_modified_at: 2025-07-10T13:00:24.208+0000
render_with_liquid: false
tags:
- ios-app-development
- firebase-app-distribution
- google-apps-script
- google-api
- google-cloud-platform
title: Google Apps Script x Google APIs 快速串接整合方式
---

### Google Apps Script x Google APIs 快速串接整合方式



以 Google Apps Script x Firebase App Distribution API 串接为例



### 背景



之前写了之前写了好几篇关于使用 Google Apps Script 的文章，其中「 [使用 Google Apps Script 实现每日数据报表 RPA 自动化](../f6713ba3fee3/) 」、「 [简单 3 步骤 — 打造免费 GA4 自动数据通知机器人](../1e85b8df2348/) 」介绍了如何使用 Google Apps Script 串接 Google Analytics 和 Google Sheet, Web App, Slack, Telegram… 快速建置可视化数据中台及通知服务；另外上个月发的文章「 [使用 Google Apps Script Web App 表单串接 Github Action CI/CD 工作](../4cb4437818f2/) 」则是直接使用 Google Apps Script Web App 串接 Github API 作为 CI/CD GUI 表单服务；以上要马是直接使用 Google Apps Script 内建的服务进行串接或是直接串接外部服务 (Slack, Github…) 都没碰到需要串接 Google APIs 的场景。



> *这次在优化 CI/CD GUI 表单时希望打包内测版后能在 Web App 上直接显示 Firebase Distribution 下载连结，这块就只能串接 Google APIs 才能达成。*



#### Google Apps Script x [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"}



![](/assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png)



如上图，与以往串接 Google Analytics 有内建服务「AnalyticsData」不同，Firebase App Distribution 并没有提供内建串接服务，所以要用进阶方式进行串接。



> *本来以为要自行使用 Service Account 完成 Access Token 产生、交换（有点麻烦，可参考我之前的 [评价机器人开源专案](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"} ）， **但其实不用这么麻烦。***



### Google Apps Script x Google APIs 进阶服务串接



#### 串接设定



**参考 [官方文件描述](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#requirements){:target="_blank"} ，我们需要照以下步骤进行进阶设定：**



1. 您必须在指令码专案中 [启用进阶服务](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#enable_advanced_services){:target="_blank"} 。


2. 您必须确认在指令码使用的 [Cloud Platform (GCP) 专案](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw){:target="_blank"} 中，已启用对应进阶服务的 API。


3. 如果指令码专案使用的是 2019 年 4 月 8 日当天或之后建立的 [预设 GCP 专案](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#default_cloud_platform_projects){:target="_blank"} ，您启用进阶服务并储存指令码专案后，API 就会自动启用。如果您尚未同意，系统可能也会要求您同意《 [Google Cloud](https://cloud.google.com/terms/?hl=zh-tw){:target="_blank"} 》和《 [Google API](https://developers.google.com/terms?hl=zh-tw){:target="_blank"} 》服务条款。


4. 如果指令码专案使用 [标准 GCP 专案](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#standard_cloud_platform_projects){:target="_blank"} 或较旧的预设 GCP 专案，您必须手动在 GCP 专案中 [启用进阶服务的对应 API](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#enabling_an_api_in_a_standard_gcp_project){:target="_blank"} 。您必须具备 GCP 专案的编辑权限，才能进行这项变更。



#### 1. 专案设定 —设定关联的 Google Cloud Platform (GCP) 专案



Google Apps Script x Google APIs 进阶服务串接会需要你建立 GCP 专案并关联到 Google Apps Script，Google APIs 使用权限是依照 GCP 设定。



因此你需要建立一个 GCP 专案(同 Firebase GCP 专案亦可)，记下资讯主页的「 `专案编号` 」并确定这个 GCP 专案有启用你想使用的 Google APIs 及当前登入帐号或欲使用的帐号是有该 GCP 专案、Google APIs 权限。



![](/assets/71400d408dc8/1*-BlhyGAEtkcDRrZ86H2BHg.png)



![](/assets/71400d408dc8/1*fycqt1HNNO9qiu6RZ-WMlw.png)



> ***本文以「 [Firebase App Distribution API](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} 」为例。***



![](/assets/71400d408dc8/1*T13M_lq7z-ui0_cLZtuHXg.png)



将 `专案编号` 输入到 Goolge Apps Script 专案设定下方的 Google Cloud Platform 专案编号中，当前登入帐号有该 GCP 专案权限就能自动绑定设定成功。



#### 2. 专案设定 — 启用 在编辑器中显示「appsscript.json」资讯清单档案



![](/assets/71400d408dc8/1*YnhdxRSyr_CYB2CFnO_31Q.png)



启用后回到编辑器，档案列表就会出现「 `appsscript.json` 」设定档：



![](/assets/71400d408dc8/1*r8bheyYWj-TX7vFIum2GIQ.png)



确保 oauthScopes 中包含以下两个描述设定：



```json
  "oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```



如果没有请手动贴上储存。



#### 3.撰写串接程式码



设定好 GCP 专案之后我们就能开始撰写串接程式码，直接参考想串接的 Google APIs 官方文件， [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} ：



![](/assets/71400d408dc8/1*N0Zg4TEZQwTTLGCsaTdx8A.png)



```javascript
const project = "projects/[Firebase Project ID]/apps/[Firebase APP ID]"; // 请换成你的 Project ID & App ID

function debug() {
  const releases = firebaseDistribution("");

  releases.forEach(function(release) {
    // Release Object: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases?hl=zh-tw#Release
    Logger.log(`${release.name} Download URL: ${release.testingUri}`);
  });
}

function firebaseDistribution(releaseNote) {
  const url = "https://firebaseappdistribution.googleapis.com/v1/"+project+"/releases?filter=releaseNotes.text%3D*"+releaseNote+"*";
  // Filter: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases/list?hl=zh-tw
  const headers = {
    "Content-Type": "application/json; charset=UTF-8",
    "Authorization": "Bearer " + ScriptApp.getOAuthToken(), // 直接使用当前帐号换取权杖
  };
  
  const options = {
    "method": "get",
    "headers": headers
  };
  const data = UrlFetchApp.fetch(url, options);
  const result = JSON.parse(data.getContentText()).releases;
  
  if (result == undefined) {
    return [];
  }

  return result;
}
```



`[Firebase Project ID]` **与 `[Firebase APP ID]` 可在 Firebase 专案设定中取得：**



![](/assets/71400d408dc8/1*oql_FnmO7_ct8S3cOhP8lg.png)



贴上程式码后，第一次执行需要完成权限授权。



![](/assets/71400d408dc8/1*sW3ZjQA3dKS8HhAOCDsmBA.png)



![](/assets/71400d408dc8/0*p-Zl0cob4mPrsNO6.png)



- 点击「审查权限」


- 选择要执行的身份帐户，通常等于当前 Google Apps Script 帐户



![](/assets/71400d408dc8/0*m7enb51ZiNlWYeoT.png)



![](/assets/71400d408dc8/0*SN-0owiePlKXIxLk.png)



- 选择「进阶」展开 -&gt; 点击「前往 XXX」
  这是我们自己写给自己用的应用程式，不需经过 Google 验证。


- 点击「允许」



> *以上画面不一定会出现，没有可忽略。*



**允许之后再点「侦错」或「执行」就能执行程式：**



如果出现错误：



```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 403. Truncated server response: {
  "error": {
    "code": 403,
    "message": "Request had insufficient authentication scopes.",
    "status": "PERMISSION_DENIED",
    "details":... (use muteHttpExceptions option to examine full response)
...
```



或



```
Exception: Specified permissions are not sufficient to call UrlFetchApp.fetch. Required permissions: https://www.googleapis.com/auth/script.external_request
```



请确认 `appsscript.json` 的 oauthScopes 中包含以下两个描述设定(参考步骤 2)：



```json
"oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```



如果出现错误：



```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 401. Truncated server response: {
  "error": {
    "code": 401,
    "message": "Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or othe... (use muteHttpExceptions option to examine full response)
```



代表尚未设定绑定的 GCP 专案 (参考步骤 1. ) 或是该 GCP 专案尚未启用欲使用的 Google APIs 或是当前帐号无该 GCP / Google APIs 使用权限或无该 Firebase App 权限，请检查设定。



如果出现错误：



```
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 404. Truncated server response:
```



或



```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 400. Truncated server response: {
  "error": {
    "code": 400,
    "message": "Request contains an invalid argument.",
    "status": "INVALID_ARGUMENT"
  }
}
```



请确认 Google APIs 请求路径是否正确。



#### 串接成功🎉🎉🎉



![](/assets/71400d408dc8/1*9OyoPtblFnGGIBRvlGw10Q.png)



可以看到短短不到 10 行程式码就能无痛串接 Google APIs，真的非常方；有兴趣的朋友可以看一下相较之下， [自己实作](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"} Google APIs 串接时身份验证权杖交换的程式步骤，非常繁琐。



#### 下一步：



搭配之前的文章「 [使用 Google Apps Script Web App 表单串接 Github Action CI/CD 工作](../4cb4437818f2/) 」串上 CI/CD 工作项目，将 Firebase App Distribution 下载连结也呈现在 Web App 上方便同仁直接在上面下载。



![Demo Result](/assets/71400d408dc8/1*nK3H3e3KgHEg8qz-KZ9ZGA.png)



Demo Result



> *其他 Google APIs 也能以此类推串接。*



### 2025/07 Update:



此功能已整合到实际打包工具使用，可参考最新文章案例：「 [**CI/CD 实战指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免费易用的打包工具平台**](../4273e57e7148/) 」



有任何问题及指教欢迎 [与我联络](https://www.zhgchg.li/contact){:target="_blank"} 。



*[Post](https://medium.com/zrealm-robotic-process-automation/google-apps-script-x-google-apis-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F-71400d408dc8){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*