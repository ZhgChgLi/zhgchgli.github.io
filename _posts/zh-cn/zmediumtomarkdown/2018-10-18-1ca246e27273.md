---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2018-10-18T14:36:57.668+0000
description: iOS 3D TOUCH åº”ç”¨
image:
  path: /assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png
last_modified_at: 2024-04-13T07:19:09.923+0000
render_with_liquid: false
tags:
- simplified-chinese
- ios
- swift
- 3d-touch
- iphone
- ios-app-development
title: æå‡ä½¿ç”¨è€…ä½“éªŒï¼Œç°åœ¨å°±ä¸ºæ‚¨çš„ iOS APP åŠ ä¸Š 3D TOUCH åŠŸèƒ½(Swift)
---

### [Deprecated]æå‡ä½¿ç”¨è€…ä½“éªŒï¼Œç°åœ¨å°±ä¸ºæ‚¨çš„ iOS APP åŠ ä¸Š 3D TOUCH åŠŸèƒ½(Swift)



iOS 3D TOUCH åº”ç”¨



### [Deprecated] 2020/06/14



> ***iPhone 11 ä»¥ä¸Šç‰ˆæœ¬å·²å–æ¶ˆ 3D Touch åŠŸèƒ½ï¼›æ”¹ç”¨ Haptic Touch å–ä»£ï¼Œå®ä½œæ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒã€‚***



å‰é˜µå­åœ¨ä¸“æ¡ˆå¼€å‘é—²æš‡ä¹‹æ—¶ï¼Œæ¢ç´¢äº†è®¸å¤š iOS çš„æœ‰è¶£åŠŸèƒ½ï¼š [CoreML](../793bf2cdda0f/) ã€ [Vision](../9a9aa892f9a9/) ã€ [Notification Service Extension](../cb6eba52a342/) ã€Notification Content Extensionã€Today Extensionã€Core Spotlightã€Share Extensionã€SiriKit (éƒ¨åˆ†å·²æ•´ç†æˆæ–‡ç« ã€å…¶ä»–é¡¹ç›®æ•¬è¯·æœŸå¾…ğŸ¤£)



å…¶ä¸­è¿˜æœ‰ä»Šæ—¥çš„ä¸»è§’ï¼š **3D TouchåŠŸèƒ½**



è¿™ä¸ªæ—©åœ¨ **iOS 9/iPhone 7ä¹‹å** å°±å¼€å§‹æ”¯æ´çš„åŠŸèƒ½ï¼Œç›´åˆ°æˆ‘è‡ªå·±ä»iPhone 6æ¢åˆ°iPhone 8 åæ‰ä½“ä¼šåˆ°å®ƒçš„å¥½ç”¨ä¹‹å¤„ï¼



#### 3D Touchèƒ½åœ¨APPä¸­å®åšä¸¤ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š



![1. Preview ViewController é¢„è§ˆåŠŸèƒ½ â€” [ç»“å©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/1ca246e27273/1*Nl6uz_dA2h13g7PtqSi6aw.gif)



1. Preview ViewController é¢„è§ˆåŠŸèƒ½ â€” [ç»“å©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}



![2. 3D Touch Shortcut APP æ·å¾„å¯åŠ¨åŠŸèƒ½](/assets/1ca246e27273/1*VcIEwZxiW26eVqCk4kUEZw.gif)



2. 3D Touch Shortcut APP æ·å¾„å¯åŠ¨åŠŸèƒ½



å…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯åº”ç”¨æœ€å¹¿ä¸”æ•ˆæœæœ€å¥½çš„ (Facebook:åŠ¨æ€æ¶ˆæ¯å†…å®¹é¢„è§ˆã€Line:å·çœ‹è®¯æ¯)ï¼Œç¬¬äºŒé¡¹ APP æ·å¾„å¯åŠ¨ ç›®å‰çœ‹æ•°æ®æ˜¯é²œå°‘äººä½¿ç”¨æ‰€ä»¥æ”¾æœ€ååœ¨è®²ã€‚



### 1. Preview ViewController é¢„è§ˆåŠŸèƒ½ï¼š



åŠŸèƒ½å±•ç¤ºå¦‚ä¸Šå›¾1æ‰€ç¤ºï¼ŒViewController é¢„è§ˆåŠŸèƒ½æ”¯æ´



- 3D Touché‡å‹æ—¶èƒŒæ™¯è™šåŒ–


- 3D Touché‡å‹ä½æ—¶è·³å‡ºViewControlleré¢„è§ˆè§†çª—


- 3D Touché‡å‹ä½æ—¶è·³å‡ºViewControlleré¢„è§ˆè§†çª—ï¼Œå¾€ä¸Šæ»‘å¯åœ¨ä¸‹æ–¹åŠ å…¥é€‰é¡¹é€‰å•


- 3D Touché‡å‹æ”¾å¼€è¿”å›è§†çª—


- 3D Touché‡å‹åå†ç”¨åŠ›è¿›å…¥ç›®æ ‡ViewController



è¿™é‡Œå°†åˆ† **A:åˆ—è¡¨è§†çª—** ã€ **B:ç›®æ ‡è§†çª—** ä¸ªåˆ«åˆ—å‡ºè¦å®ä½œçš„ç¨‹å¼ç ï¼š



ç”±äºåœ¨ Bä¸­ æ²¡æœ‰æ–¹å¼èƒ½åˆ¤æ–­å½“å‰æ˜¯é¢„è§ˆè¿˜æ˜¯çœŸçš„è¿›å…¥æ­¤è§†çª—ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªProtocolä¼ é€’å€¼ï¼Œç”¨æ¥åˆ¤æ–­



```swift
protocol UIViewControllerPreviewable {
    var is3DTouchPreview:Bool {get set}
}
```



è¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ Bä¸­ åšä»¥ä¸‹åˆ¤æ–­ï¼š



```swift
class BViewController:UIViewController, UIViewControllerPreviewable {
     var is3DTouchPreview:Bool = false
     override func viewDidLoad() {
     super.viewDidLoad()
     if is3DTouchPreview {
       //è‹¥ä¸ºé¢„è§ˆè§†çª—æ—¶...ä¾‹å¦‚ï¼šå˜å…¨è¤å¹•ã€éšè—å·¥å…·åˆ—
     } else {
       //å®Œæ•´æ¨¡å¼æ—¶ç…§æ­£å¸¸æ˜¾ç¤º
   } 
}
```



A:åˆ—è¡¨è§†çª—ï¼Œå¯ä»¥æ˜¯ UITableView æˆ– UICollectionViewï¼š



```swift
class AViewController:UIViewController {
    //æ³¨å†Œèƒ½3D Touch çš„ View
    override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) {
        super.traitCollectionDidChange(previousTraitCollection)
        if traitCollection.forceTouchCapability == .available {
            //TableView:
            registerForPreviewing(with: self, sourceView: self.TableView)
            //CollectionView:
            registerForPreviewing(with: self, sourceView: self.CollectionView)
        }
    }   
}
extension AViewController: UIViewControllerPreviewingDelegate {
    //3D Touchæ”¾å¼€åï¼Œè¦åšçš„å¤„ç†
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController) {
        
        //ç°åœ¨è¦ç›´æ¥è·³è½¬çš„è¯¥é¡µé¢äº†ï¼Œæ‰€ä»¥å°†ViewControllerçš„é¢„è§ˆæ¨¡å¼å‚æ•°å–æ¶ˆï¼š
        if var viewControllerToCommit = viewControllerToCommit as? UIViewControllerPreviewable {
            viewControllerToCommit.is3DTouchPreview = false
        }
        self.navigationController?.pushViewController(viewControllerToCommit, animated: true)
    }
    
    //æ§åˆ¶3D Touchçš„Cellä½ç½®ï¼Œæ¬²æ˜¾ç¤ºçš„ViewController
    func previewingContext(_ previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -> UIViewController? {
        
        //å–å¾—å½“å‰ç‚¹çš„indexPath/cellå®ä½“
        //TableView:
        guard let indexPath = TableView.indexPathForRow(at: location),let cell = TableView.cellForRow(at: indexPath) else { return nil }
        //CollectionView:
        guard let indexPath = CollectionView.indexPathForItem(at: location),let cell = CollectionView.cellForItem(at: indexPath) else { return nil }
      
        //æ¬²æ˜¾ç¤ºçš„ViewController
        let targetViewController = UIStoryboard(name: "StoryboardName", bundle: nil).instantiateViewController(withIdentifier: "ViewControllerIdentifier")
        
        //èƒŒæ™¯è™šåŒ–æ—¶ä¿ç•™åŒºåŸŸ(ä¸€èˆ¬ä¸ºç‚¹å‡»ä½ç½®)ï¼Œé™„å›¾1
        previewingContext.sourceRect = cell.frame
        
        //3D Touchè§†çª—å¤§å°ï¼Œé¢„è®¾ä¸ºè‡ªé€‚åº”ï¼Œä¸éœ€æ›´æ”¹
        //è¦ä¿®æ”¹è¯·ç”¨ï¼štargetViewController.preferredContentSize = CGSize(width: 0.0, height: 0.0)
        
        //å‘ŠçŸ¥é¢„è§ˆçš„ViewControllerç›®å‰ä¸ºé¢„è§ˆæ¨¡å¼ï¼š
        if var targetViewController = targetViewController as? UIViewControllerPreviewable {
            targetViewController.is3DTouchPreview = true
        }
        
        //å›ä¼ nilåˆ™æ— ä»»ä½•ä½œç”¨
        return nil
    }
}
```



> **è¯·æ³¨æ„ï¼å…¶ä¸­çš„æ³¨å†Œèƒ½3D Touch çš„ View è¿™å—è¦æ”¾åœ¨ traitCollectionDidChange ä¹‹ä¸­è€Œé â€œviewDidLoadâ€ ( [è¯·å‚è€ƒæ­¤ç¯‡å†…å®¹](https://stackoverflow.com/questions/30007701/view-traitcollection-horizontalsizeclass-returning-undefined-0-in-viewdidload){:target="_blank"} )**



> å…³äºè¦åŠ æ”¾åœ¨å“ªé‡Œè¿™å—æˆ‘è¸©äº†è®¸å¤šé›·ï¼Œç½‘è·¯æœ‰äº›èµ„æ–™å†™viewDidLoadã€æœ‰çš„å†™åœ¨cellforItemä¸­ï¼Œä½†è¿™ä¸¤ä¸ªåœ°æ–¹éƒ½ä¼šå‡ºç°å¶å°”å¤±æ•ˆæˆ–éƒ¨åˆ†cellå¤±æ•ˆçš„é—®é¢˜ã€‚



![é™„å›¾1 èƒŒæ™¯è™šåŒ–ä¿ç•™åŒºç¤ºæ„å›¾](/assets/1ca246e27273/1*AAFevro2x7s9J6yRshAGtg.png)



é™„å›¾1 èƒŒæ™¯è™šåŒ–ä¿ç•™åŒºç¤ºæ„å›¾



å¦‚æœæ‚¨éœ€è¦ä¸Šæ»‘ååœ¨ä¸‹æ–¹åŠ å…¥é€‰é¡¹é€‰å•è¯·åœ¨ **B** ä¹‹ä¸­åŠ å…¥ï¼Œæ˜¯B æ˜¯B æ˜¯Bå“¦ï¼



![](/assets/1ca246e27273/1*L7VwD_lyG86eXzTzgIuELQ.png)



```swift
override var previewActionItems: [UIPreviewActionItem] {
  let profileAction = UIPreviewAction(title: "æŸ¥çœ‹å•†å®¶èµ„è®¯", style: .default) { (action, viewController) -> Void in
    //ç‚¹å‡»åçš„æ“ä½œ
  }
  return [profileAction]
}
```



å›ä¼ ç©ºé˜µåˆ—è¡¨ç¤ºä¸ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚



**å®Œæˆï¼**



### 2. APP æ·å¾„å¯åŠ¨



#### ç¬¬ä¸€æ­¥



åœ¨ info.plist ä¸­åŠ å…¥ UIApplicationShortcutItems å‚æ•°ï¼Œç±»å‹ Array



å¹¶åœ¨å…¶ä¸­æ–°å¢é€‰å•é¡¹ç›®(Dictionary)ï¼Œå…¶ä¸­Key-Valueçš„è®¾å®šå¯¹åº”å¦‚ä¸‹ï¼š



- [å¿…å¡«] UIApplicationShortcutItemType : è¯†åˆ«å­—ä¸²ï¼Œåœ¨AppDelegateä¸­åšåˆ¤æ–­ä½¿ç”¨


- [å¿…å¡«] UIApplicationShortcutItemTitle : é€‰é¡¹æ ‡é¢˜


- UIApplicationShortcutItemSubtitle : é€‰é¡¹å­æ ‡é¢˜



![](/assets/1ca246e27273/1*PlbW5bVYGkN2olZC9WAvHw.png)



- UIApplicationShortcutItemIconType : ä½¿ç”¨ç³»ç»Ÿå›¾æ ‡



![å‚è€ƒè‡ª [æ­¤ç¯‡æ–‡ç« ](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}](/assets/1ca246e27273/1*S3dbMWNnTvhdt-NlxAQ2Tw.png)



å‚è€ƒè‡ª [æ­¤ç¯‡æ–‡ç« ](https://qiita.com/kusumotoa/items/f33c89f150cd0937d003){:target="_blank"}



- UIApplicationShortcutItemIconFile : ä½¿ç”¨è‡ªå®šä¹‰å›¾æ ‡(size:35x35,å•è‰²)ï¼Œä¸UIApplicationShortcutItemIconTypeæ‹©ã„§ä½¿ç”¨


- UIApplicationShortcutItemUserInfo : æ›´å¤šé™„åŠ èµ„è®¯EX: [id:1]



![æˆ‘çš„è®¾å®šå¦‚ä¸Šå›¾](/assets/1ca246e27273/1*cIIVrNDdziBVJn4z_QsLJg.png)



æˆ‘çš„è®¾å®šå¦‚ä¸Šå›¾



#### ç¬¬äºŒæ­¥



åœ¨AppDelegateä¸­æ–°å¢å¤„ç†çš„ Function



```swift
func application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -> Void) {
    var info = shortcutItem.userInfo
  
    switch shortcutItem.type {
    case "searchShop":
      //
    case "topicList":
      //
    case "likeWorksPic":
      //
    case "marrybarList":
      //
    default:
        break
    }
    completionHandler(true)
}
```



**å®Œæˆï¼**



### ç»“è¯­



åœ¨APPä¸­åŠ å…¥ 3D Touchçš„åŠŸèƒ½å¹¶ä¸éš¾ï¼Œå¯¹ä½¿ç”¨è€…æ¥è¯´ä¹Ÿä¼šè§‰å¾—å¾ˆè´´å¿ƒâ¤ï¼›å¯ä»¥æ­é…è®¾è®¡æ“ä½œå¢åŠ ä½¿ç”¨è€…ä½“éªŒï¼›ä½†ç›®å‰å°±åªæœ‰ä¸Šè¿°ä¸¤ä¸ªåŠŸèƒ½å¯åšåœ¨åŠ ä¸ŠiPhone 6sä»¥ä¸‹/iPad/iPhone XRéƒ½ä¸æ”¯æ´3D Touchæ‰€ä»¥å®é™…èƒ½åšçš„åŠŸèƒ½åˆæ›´å°‘äº†ï¼Œåªèƒ½ä»¥è¾…åŠ©ã€å¢åŠ ä½“éªŒä¸ºä¸»ã€‚



#### p.s.



![å¦‚æœä½ æµ‹çš„å¤Ÿç»†ä¼šå‘ç°ä»¥ä¸Šæ•ˆæœï¼Œåœ¨CollectionViewæ»‘åŠ¨ä¸­å›¾æœ‰éƒ¨åˆ†å·²ç»æ»‘å‡ºç”»é¢è¿™æ—¶æŒ‰å‹å°±ä¼šå‡ºç°ä»¥ä¸Šæƒ…å†µğŸ˜…](/assets/1ca246e27273/1*LBgSqm8CTdBPycGnuYNMkA.png)



å¦‚æœä½ æµ‹çš„å¤Ÿç»†ä¼šå‘ç°ä»¥ä¸Šæ•ˆæœï¼Œåœ¨CollectionViewæ»‘åŠ¨ä¸­å›¾æœ‰éƒ¨åˆ†å·²ç»æ»‘å‡ºç”»é¢è¿™æ—¶æŒ‰å‹å°±ä¼šå‡ºç°ä»¥ä¸Šæƒ…å†µğŸ˜…



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/%E6%8F%90%E5%8D%87%E4%BD%BF%E7%94%A8%E8%80%85%E9%AB%94%E9%A9%97-%E7%8F%BE%E5%9C%A8%E5%B0%B1%E7%82%BA%E6%82%A8%E7%9A%84-ios-app-%E5%8A%A0%E4%B8%8A-3d-touch-%E5%8A%9F%E8%83%BD-swift-1ca246e27273){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*