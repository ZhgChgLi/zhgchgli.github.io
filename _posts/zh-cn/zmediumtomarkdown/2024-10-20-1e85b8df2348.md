---
author: ZhgChgLi
categories:
- ZRealm Robotic Process Automation
date: 2024-10-20T08:19:52.764+0000
description: ä½¿ç”¨ Google Apps Script å®Œæˆ RPAï¼Œè‡ªè¡Œä¸²æ¥ GA4 + Telegram Bot æ•°æ®é€šçŸ¥æœºå™¨äºº
image:
  path: /assets/1e85b8df2348/1*La0AKKSrGNP9EZUV-vrONQ.jpeg
last_modified_at: 2024-10-20T08:19:52.764+0000
render_with_liquid: false
tags:
- automation
- google-apps-script
- telegram
- google-analytics
- rpa-solutions
title: ç®€å• 3 æ­¥éª¤â€Šâ€”â€Šæ‰“é€ å…è´¹ GA4 è‡ªåŠ¨æ•°æ®é€šçŸ¥æœºå™¨äºº
---

### ç®€å• 3 æ­¥éª¤ â€” æ‰“é€ å…è´¹ GA4 è‡ªåŠ¨æ•°æ®é€šçŸ¥æœºå™¨äºº



ä½¿ç”¨ Google Apps Script å®Œæˆ RPAï¼Œè‡ªè¡Œä¸²æ¥ GA4 + Telegram Bot æ•°æ®é€šçŸ¥æœºå™¨äºº



![Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/1e85b8df2348/1*La0AKKSrGNP9EZUV-vrONQ.jpeg)



Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}



### å‰è¨€



å¤§çº¦ä» 2020 å¹´å¼€å§‹å°±è‡ªå·±åœ¨æ‘¸ç´¢ä½¿ç”¨æ‰‹è¾¹å·¥å…·å®ç° RPAï¼Œä»ä¸€å¼€å§‹åªæ˜¯ä¸ºäº†è‡ªåŠ¨åŒ–ä¸ªäººä¾‹è¡Œä»»åŠ¡ï¼Œåˆ°åæ¥å·¥ä½œä¹ŸåŠ å…¥äº†è§„æ¨¡æ›´å¤§å‹çš„ç»„ç»‡ï¼Œæ—¶å¸¸ä¼šé‡åˆ°è·¨å›¢é˜Ÿæˆ–ä»°èµ–äººä¸äººçš„ä»»åŠ¡ã€ç”šè‡³æ˜¯é‡å¤æ€§ä»»åŠ¡ï¼Œæ‰å‘ç° RPA è‡ªåŠ¨åŒ–çš„æ•ˆç›Šæ‰€åœ¨ã€‚



ä¸¾ä¾‹æ¥è¯´ï¼šæŸä¸ªé‡å¤ä»»åŠ¡æ¯ä¸ªæœˆä¼šå‘ç”Ÿ 10 æ¬¡ï¼Œæ¯æ¬¡éœ€èŠ±è´¹ 30 åˆ†é’Ÿå¤„ç†ï¼Œæœ‰ 60 äººä¼šé‡åˆ°ï¼Œæ¯å¹´å›¢é˜Ÿç­‰äºæ¶ˆè€— 3,600 å°æ—¶åœ¨è¿™ä¸Šé¢ï¼Œå¦‚æœèƒ½æŠ•èµ„ 100 å°æ—¶å¼€å‘æˆè‡ªåŠ¨åŒ–ï¼Œåç»­è§£æ”¾å‡ºæ¥çš„æ—¶é—´ï¼Œå°±èƒ½æŠ•å…¥åœ¨æ›´æœ‰ä»·å€¼çš„å·¥ä½œä¸Šï¼›å®é™…ç­‰äº 3,600 æµªè´¹çš„å·¥æ—¶ï¼‹3,600 æ›´å€¼å¾—æŠ•èµ„çš„äº§å‡ºã€‚



#### **è¯¦ç»†å¯å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š**



- [2021 Pinkoi Tech Career Talk â€” é«˜æ•ˆç‡å·¥ç¨‹å›¢é˜Ÿå¤§è§£å¯†](../11f6c8568154/)


- [ä½¿ç”¨ Google Apps Script å®ç°æ¯æ—¥æ•°æ®æŠ¥è¡¨ RPA è‡ªåŠ¨åŒ–](../f6713ba3fee3/)



#### å…¶ä»–åšè¿‡çš„ RPAï¼š



- [GMail to Slack] [è¿ç”¨ Google Apps Script è½¬å‘ Gmail ä¿¡ä»¶åˆ° Slack](../d414bdbdb8c9/)


- [Google Form x Google Sheet xSlack] [Slack æ‰“é€ å…¨è‡ªåŠ¨ WFH å‘˜å·¥å¥åº·çŠ¶å†µå›æŠ¥ç³»ç»Ÿ](https://medium.com/zrealm-robotic-process-automation/slack-%E6%89%93%E9%80%A0%E5%85%A8%E8%87%AA%E5%8B%95-wfh-%E5%93%A1%E5%B7%A5%E5%81%A5%E5%BA%B7%E7%8B%80%E6%B3%81%E5%9B%9E%E5%A0%B1%E7%B3%BB%E7%B5%B1-d61062833c1a?source=collection_home---6------9-----------------------){:target="_blank"}


- [Big Query x Slack ] [Crashlytics + Big Query æ‰“é€ æ›´å³æ—¶ä¾¿åˆ©çš„ Crash è¿½è¸ªå·¥å…·](https://medium.com/zrealm-robotic-process-automation/crashlytics-big-query-%E6%89%93%E9%80%A0%E6%9B%B4%E5%8D%B3%E6%99%82%E4%BE%BF%E5%88%A9%E7%9A%84-crash-%E8%BF%BD%E8%B9%A4%E5%B7%A5%E5%85%B7-e77b80cc6f89?source=collection_home---6------7-----------------------){:target="_blank"}


- [Google Analytics x Slack] [Crashlytics + Google Analytics è‡ªåŠ¨æŸ¥è¯¢ App Crash-Free Users Rate](https://medium.com/zrealm-robotic-process-automation/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72?source=collection_home---6------6-----------------------){:target="_blank"}


- [Github Webhook x Line Notify] [ä½¿ç”¨ Google Apps Script ä¸‰æ­¥éª¤å…è´¹å»ºç«‹ Github Repo Star Notifier](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697?source=collection_home---6------5-----------------------){:target="_blank"}


- [Slack x OpenAI (ChatGTP) ] [Slack & ChatGPT Integration](https://medium.com/zrealm-robotic-process-automation/slack-chatgpt-integration-bd94cc88f9c9?source=collection_home---6------4-----------------------){:target="_blank"}


- [Google Analytics x Google Sheet] [ä½¿ç”¨ Google Apps Script å®ç°æ¯æ—¥æ•°æ®æŠ¥è¡¨ RPA è‡ªåŠ¨åŒ–](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"}


- [iOS Shortcut x Line x Reminders] [iOS æ·å¾„è‡ªåŠ¨åŒ–åº”ç”¨åœºæ™¯ â€” è‡ªåŠ¨è½¬å‘ç®€è®¯ä¸è‡ªåŠ¨å»ºç«‹æé†’å¾…åŠäº‹é¡¹](https://medium.com/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96%E6%87%89%E7%94%A8%E5%A0%B4%E6%99%AF-%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E8%87%AA%E5%8B%95%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85-309d0302877b?source=collection_home---6------2-----------------------){:target="_blank"}


- [Apple Store API x Google Play Console API x Github Action] [Github Action x ZReviewTender å…è´¹å¿«é€Ÿéƒ¨ç½²ä½ çš„ App å•†åŸè¯„ä»·ç›‘æ§æœºå™¨äºº](https://medium.com/zrealm-robotic-process-automation/quick-start-github-action-x-zreviewtender-%E5%85%8D%E8%B2%BB%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E4%BD%A0%E7%9A%84-app-%E5%95%86%E5%9F%8E%E8%A9%95%E5%83%B9%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-0095528cf875?source=collection_home---6------1-----------------------){:target="_blank"}


- [Telegram Bot] [10 åˆ†é’Ÿå¿«é€Ÿç§»è½¬ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"}


- [Medium to Jekyllrb] [æ— ç—›è½¬ç§» Medium åˆ°è‡ªæ¶ç½‘ç«™](../a0c08d579ab1/)



ä»åå°æ•°æ®çœ‹ä¹‹å‰è›®å¤šæ–‡ç« æœ‰è¢« ChatGPT æˆ–å„ç§ GenAI æœåŠ¡æ”¶å½•ï¼Œé—´æ¥çš„å¸®åŠ©äº†è®¸å¤šéå·¥ç¨‹èƒŒæ™¯ä½†ä¹Ÿæƒ³å°è¯•ä½¿ç”¨ RPA è§£å†³é—®é¢˜çš„æœ‹å‹ï¼Œå› æ­¤æˆ‘ä»ä¼šæŒç»­åˆ†äº«è‡ªå·±ç”Ÿæ´»æˆ–å·¥ä½œä¸Šé‡åˆ°çš„ RPA åœºæ™¯è·Ÿæˆ‘çš„è§£å†³æ–¹æ¡ˆä¸å¤§å®¶åˆ†äº« â€” [ZRealm Robotic Process Automation](../d414bdbdb8c9/) ã€‚



#### å·¥å•†æ—¶é—´



å¦‚æœæ‚¨ä¸æ‚¨çš„å›¢é˜Ÿæœ‰è‡ªåŠ¨åŒ–å·¥å…·ã€æµç¨‹ä¸²æ¥éœ€æ±‚ï¼Œä¸è®ºæ˜¯ Slack App å¼€å‘ã€Notionã€Asanaã€Google Sheetã€Google Formã€GA æ•°æ®ï¼Œå„ç§ä¸²æ¥éœ€æ±‚ï¼Œæ¬¢è¿ä¸æˆ‘ [**è”ç»œå¼€å‘**](https://zhgchg.li/contact/){:target="_blank"} ã€‚



### æœ¬ç¯‡ Google Analytics 4 x Telegram Bot



è¿™æ¬¡è¦ä»‹ç»çš„ä¸²æ¥åœºæ™¯æ˜¯æ¥ç»­ä¸Šä¸€ç¯‡ã€Œ [10 åˆ†é’Ÿå¿«é€Ÿç§»è½¬ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€æ—¶æƒ³åˆ°æˆ‘çš„ Medium å¤‡ä»½ç«™ã€Œ [zhgchg.li](https://zhgchg.li/){:target="_blank"} ã€ä¸€ç›´éƒ½æ²¡æœ‰å…³æ³¨ä»–çš„ GA4 ç½‘ç«™æ•°æ®ï¼Œæƒ³è¯´å¥½åƒå¯ä»¥å¤šåšä¸€ä¸ªé€šçŸ¥æœºå™¨äººï¼Œæ¯æ—¥ä¼ é€è¿‡å» 7 å¤©çš„ç½‘ç«™æ•°æ®åˆ°æŒ‡å®šçš„ Telegram Channel è®©æˆ‘çŸ¥é“ã€‚



æœ¬ç¯‡åªæ˜¯å°å“ï¼Œå¦‚æœè¦åšå®Œæ•´çš„è‡ªåŠ¨åŒ–æ•°æ®æŠ¥è¡¨è¯·å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€Œ [ä½¿ç”¨ Google Apps Script å®ç°æ¯æ—¥æ•°æ®æŠ¥è¡¨ RPA è‡ªåŠ¨åŒ–](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"} ã€å¦å¤–ä¹‹å‰ä¹Ÿæ›¾ä¸²è¿‡ GA4 æå– App Crash-free rate å¯å‚è€ƒæ­¤ç¯‡æ–‡ç« ã€Œ [Crashlytics + Google Analytics è‡ªåŠ¨æŸ¥è¯¢ App Crash-Free Users Rate](https://medium.com/zrealm-robotic-process-automation/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72?source=collection_home---6------6-----------------------){:target="_blank"} ã€ã€‚



- Google Apps Script å…è´¹é™åˆ¶ã€è¯¦ç»†ä½¿ç”¨ã€éƒ¨ç½²ã€åŠŸèƒ½ä»‹ç»æœ¬ç¯‡ä¸ä¼šå†å¤šä»‹ç»ï¼Œè¯·å‚è€ƒ [ä¹‹å‰æ–‡ç« ](https://medium.com/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE-google-%E6%9C%8D%E5%8B%99-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3?source=collection_home---6------3-----------------------){:target="_blank"} ã€‚


- Telegram Bot åˆ›å»ºã€ä½¿ç”¨æœ¬ç¯‡ä¹Ÿä¸ä¼šå†å¤šä»‹ç»ï¼ŒåŒæ ·è¯·å‚è€ƒ [ä¹‹å‰æ–‡ç« ](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€‚



#### æˆæœ



![](/assets/1e85b8df2348/1*J7QdgrJRNzVFQJfW5UBBFA.png)



å…ˆä¸Šæœ€ç»ˆæ•ˆæœï¼ŒGoogle Apps Script æ¯æ—¥ä¸‹åˆ 12â€“13 ç‚¹ä¹‹é—´ä¼šè‡ªåŠ¨å»æå–æˆ‘æƒ³è¦çš„ Google Analytics 4 ç½‘ç«™æ•°æ®å¹¶ç»„åˆæˆè®¯æ¯é€è¿‡ Telegram Bot ä¼ é€åˆ°æˆ‘çš„ Telegram Channelï¼Œæˆ‘å¯ä»¥å¿«é€Ÿæ£€é˜…è¿‘ 7 å¤©ç½‘ç«™æ•°æ®ã€‚



**æˆ‘æƒ³è¦è§‚æµ‹çš„æ•°æ®æ˜¯ï¼š**



- è¿‘ 7 å¤© `7daysAgo ~ today` æ€»æµè§ˆæ•° `screenPageViews`


- æ´»è·ƒä½¿ç”¨è€…æ•° `active7DayUsers`


- æ–°ä½¿ç”¨è€…æ•° `newUsers`


- Top 10 æµè§ˆé¡µé¢ `screenPageViews` / `pageTitle`


- æ–°ä½¿ç”¨è€…æœ€åˆæ¥æºåª’ä»‹ `newUsers` / `firstUserSourceMedium`



> *å®é™…å¯ä¾ç…§ä½ è‡ªå·±çš„éœ€æ±‚ä½¿ç”¨ [GA Dev Tools](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} äº§ç”Ÿè°ƒæ•´ã€‚*



### Step 1. ä½¿ç”¨ [GA4 Query Explorer å®˜æ–¹å·¥å…·](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} äº§ç”Ÿæ•°æ®æŠ¥è¡¨æŸ¥è¯¢å‚æ•°



é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ [GA4 Query Explorer](https://ga-dev-tools.google/ga4/query-explorer/){:target="_blank"} å®˜æ–¹æä¾›çš„å·¥å…·äº§ç”Ÿæˆ‘ä»¬éœ€è¦çš„æŸ¥è¯¢æ•°æ®æŠ¥è¡¨å‚æ•°ï¼š



![](/assets/1e85b8df2348/1*4b1S9nYSmO7OmGgDPllxeQ.png)



1. Select Property: è®°ä¸‹ä½ çš„ `property ç¼–å·`
   **property ç¼–å·ç¨åæ’°å†™ Google Apps Script ä¼šä½¿ç”¨ã€‚**


2. start date, end date: æŠ¥è¡¨å¼€å§‹ï½ç»“æŸçš„æ—¥æœŸèŒƒå›´ï¼Œå¯ä½¿ç”¨ `YYYY-MM-DD` æˆ– `yesterday` , `today` , `NdaysAgo` é­”æœ¯å˜æ•°ã€‚


3. metrics: é€‰æ‹©ä½ æƒ³è¦æŸ¥è¯¢çš„æŒ‡æ ‡


4. dimensions: é€‰æ‹©ä½ æƒ³è¦æŸ¥è¯¢çš„ç»´åº¦


5. metric aggregations: æ•°æ®åˆå¹¶è®¡ç®—è§„åˆ™



è¿™è¾¹ä»¥æˆ‘çš„åœºæ™¯ä¸ºä¾‹ï¼š



1. property ç¼–å·: `318495208`


2. start_date: `7daysAgo`


3. end_date: `yesterday`
   å›  GA æ•°æ®æŠ¥è¡¨ä¼šå»¶è¿Ÿï¼ŒæŸ¥è¯¢å‰ä¸€å¤©ï½ä¸ƒå¤©æœ€å‡†ç¡®ã€‚


4. metric aggregations: `total`



**å…¶ä»– filter, limit å¯ä¾ç…§è‡ªå·±éœ€æ±‚è®¾å®šï¼š**



![](/assets/1e85b8df2348/1*g2psNn3gMZWs4OFRx7phWQ.png)



filter æˆ‘ç”¨ä¸åˆ°ç•™ç©ºï¼›limit æˆ‘è¾“å…¥ 10ï¼Œå› ä¸ºæˆ‘åªæƒ³çŸ¥é“ Top 10ã€‚



#### **ç‚¹å‡»ã€ŒMAKE REQUESTã€äº§ç”Ÿå¯¹åº”çš„æ•°æ®æŠ¥è¡¨æŸ¥è¯¢å‚æ•°åŠç»“æœï¼š**



![](/assets/1e85b8df2348/1*Rj1kMTyZiEYGvAztEEngIQ.png)



#### **è®°ä¸‹ä»¥ä¸‹è¯·æ±‚å‚æ•°ï¼Œç¨åæ’°å†™ Google Apps Script ä¼šä½¿ç”¨ï¼š**



```json
{
  "dimensions": [
    {
      "name": "pageTitle"
    }
  ],
  "metrics": [
    {
      "name": "screenPageViews"
    }
  ],
  "dateRanges": [
    {
      "startDate": "7daysAgo",
      "endDate": "yesterday"
    }
  ],
  "limit": "10",
  "metricAggregations": [
    "TOTAL"
  ]
}
```



#### **ç»“æœï¼š**



![](/assets/1e85b8df2348/1*ivAXeRTVB8Y7zbP-Gq2I2A.png)



![](/assets/1e85b8df2348/1*FFThyuptIYrGsfddHcjupQ.jpeg)



- ä¸ GA ä¸Šçš„æ•°æ®æ¯”è¾ƒæ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®ç›¸ç¬¦ âœ…âœ…âœ…



### Step 2. å»ºç«‹ Google Apps Script & ä½¿ç”¨ Google Analytics Data API æŸ¥è¯¢èµ„æ–™



- å‰å¾€ <https://script.google.com/home>{:target="_blank"}


- å»ºç«‹æ–°ä¸“æ¡ˆï¼Œå‘½åä¸“æ¡ˆåç§°


- ç‚¹å‡»ã€ŒæœåŠ¡ã€-&gt;ã€Œ+ã€æ–°å¢æœåŠ¡


- é€‰æ‹©ã€ŒGoogle Analytics Data APIã€


- ç‚¹å‡»ã€Œæ–°å¢ã€



![](/assets/1e85b8df2348/1*gcMDDQTXd-Gos5AdGUXIOw.png)



**è´´ä¸Š Google Analytics Data API æŸ¥è¯¢ç¨‹å¼ç å¹¶ç»„åˆï¼š**



å°†å‰é¢æ­¥éª¤äº§ç”Ÿçš„æŠ¥è¡¨æŸ¥è¯¢æ•°æ®å‚æ•°ï¼š



```json
{
  "dimensions": [
    {
      "name": "pageTitle"
    }
  ],
  "metrics": [
    {
      "name": "screenPageViews"
    }
  ],
  "dateRanges": [
    {
      "startDate": "7daysAgo",
      "endDate": "yesterday"
    }
  ],
  "limit": "10",
  "metricAggregations": [
    "TOTAL"
  ]
}
```



**è½¬æ¢æˆç¨‹å¼ï¼š**



```javascript
function execute() {
  Logger.log(JSON.stringify(fetchScreenPageViews("318495208")));
}

// æ‹†æˆç‹¬ç«‹æ–¹æ³•ï¼Œæ–¹ä¾¿æ—¥åé‡å¤ä½¿ç”¨...
// é¢„è®¾ startDate=7daysAgo, endDate=yesterday
// å…¶ä»–ç”¨æ³•ï¼š
// e.g. fetchScreenPageViews("1111". "3daysAgo", "yesterday")
// e.g. fetchScreenPageViews("2222". "yesterday", "today")
function fetchScreenPageViews(propertyId, startDate = "7daysAgo", endDate = "yesterday") {
  const screenPageViewsMetric = AnalyticsData.newMetric();
  screenPageViewsMetric.name = "screenPageViews";

  const dateRange = AnalyticsData.newDateRange();
  dateRange.startDate = startDate;
  dateRange.endDate = endDate;

  const pageTitleDimension = AnalyticsData.newDimension();
  pageTitleDimension.name = "pageTitle";

  const request = AnalyticsData.newRunReportRequest();
  request.dimensions = [pageTitleDimension];
  request.metrics = [screenPageViewsMetric];
  request.dateRanges = dateRange;

  request.limit = 10;
  request.metricAggregations = "TOTAL";

  return AnalyticsData.Properties.runReport(request, "properties/" + propertyId);
}
```



ç¨‹å¼ç è§£æï¼š



```javascript
// metric æŒ‡æ ‡ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œè¯·åˆ†å¼€å®£å‘Š...
const screenPageViewsMetric = AnalyticsData.newMetric();
screenPageViewsMetric.name = "screenPageViews";

// ä¾‹å¦‚å¦ä¸€ä¸ª active1DayUsersï¼š
const active1DayUsersMetric = AnalyticsData.newMetric();
active1DayUsersMetric.name = "active1DayUsers";

// å®£å‘Šæ—¥æœŸèŒƒå›´
const dateRange = AnalyticsData.newDateRange();
dateRange.startDate = startDate;
dateRange.endDate = endDate;

// dimension ç»´åº¦ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œè¯·åˆ†å¼€å®£å‘Š...
const pageTitleDimension = AnalyticsData.newDimension();
pageTitleDimension.name = "pageTitle";

// ä¾‹å¦‚å¦ä¸€ä¸ª dimensionï¼š
const firstUserSourceMediumDimension = AnalyticsData.newDimension();
firstUserSourceMediumDimension.name = "firstUserSourceMedium";

//

// äº§ç”Ÿ Request ç‰©ä»¶
const request = AnalyticsData.newRunReportRequest();
request.metrics = [active1DayUsersMetric, active1DayUsersMetric]; // å¤šä¸ªå°±éƒ½å¸¦å…¥...
request.dimensions = [pageTitleDimension, firstUserSourceMediumDimension]; // å¤šä¸ªå°±éƒ½å¸¦å…¥...

request.dateRanges = dateRange;

// åªéœ€è¦å‰ 10 ç¬”èµ„æ–™ (Top 10)
request.limit = 10;

// è®¾å®šæ•°æ®åˆå¹¶è®¡ç®—é€»è¾‘ï¼šTotal (SUM)
request.metricAggregations = "TOTAL";

// äº§ç”ŸæŸ¥è¯¢ç»“æœ
return AnalyticsData.Properties.runReport(request, "properties/" + propertyId).rows;
```



**ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¼šéœ€è¦æˆæƒ(æ—¥åè‹¥ç¨‹å¼ç æœ‰æ–°å¢éœ€è¦çš„æƒé™ä¹Ÿä¼šè¦é‡æ–°è®¤è¯ä¸€æ¬¡)ï¼š**



> *å®é™…ä¸Šå°±æ˜¯æˆæƒ Google Apps Script æ—¥åä½¿ç”¨ä½ çš„å¸å·èº«ä»½æ‰§è¡Œè¿™äº›ç¨‹å¼ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿ä½ é€‰æ‹©çš„å¸å·èº«ä»½æœ‰å¯¹åº”çš„ GA æŠ¥è¡¨å­˜å–æƒé™ã€‚*



![](/assets/1e85b8df2348/1*_z-P8a4PZCozhtgssH82lA.png)



- æ’°å†™å¥½ç¨‹å¼ç åï¼Œç‚¹å‡»ã€Œä¾¦é”™ã€-&gt; ç‚¹å‡»ã€Œå®¡æŸ¥æƒé™ã€



![](/assets/1e85b8df2348/1*ehox-4AjKv3Ddf1jJ_VmTQ.png)



- é€‰æ‹©è¦æ‰§è¡Œçš„èº«ä»½å¸æˆ·ï¼Œé€šå¸¸ç­‰äºå½“å‰ Google Apps Script å¸æˆ·



![](/assets/1e85b8df2348/1*onR-n1sI4-G9KhD_fhef3Q.png)



- é€‰æ‹©ã€Œè¿›é˜¶ã€å±•å¼€ -&gt; ç‚¹å‡»ã€Œå‰å¾€ XXXã€
  è¿™æ˜¯æˆ‘ä»¬è‡ªå·±å†™ç»™è‡ªå·±ç”¨çš„åº”ç”¨ç¨‹å¼ï¼Œä¸éœ€ç»è¿‡ Google éªŒè¯ã€‚



![](/assets/1e85b8df2348/1*73fQnaB__qKhO7NndQ0GyQ.png)



- ç‚¹å‡»ã€Œå…è®¸ã€



**å…è®¸ä¹‹åå†ç‚¹ã€Œä¾¦é”™ã€æˆ–ã€Œæ‰§è¡Œã€å°±èƒ½æ‰§è¡Œç¨‹å¼ï¼š**



![](/assets/1e85b8df2348/1*DbcQnfp8xdJCFnrDc778tw.png)



è¿™è¾¹æˆ‘ä»¬å…ˆä½¿ç”¨ `Logger.log(JSON.stringify())` å–å¾—è¾“å‡ºç»“æœï¼š



```json
{
  "kind": "analyticsData#runReport",
  "dimensionHeaders": [
    {
      "name": "pageTitle"
    }
  ],
  "rowCount": 71,
  "metadata": {
    "currencyCode": "TWD",
    "timeZone": "Asia/Taipei"
  },
  "rows": [
    {
      "dimensionValues": [
        {
          "value": "ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "166"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "109"
        }
      ],
      "dimensionValues": [
        {
          "value": "Apple Watch åŸå‚ä¸é”ˆé’¢ç±³å…°è¡¨å¸¦å¼€ç®± \\| ZhgChgLi"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS â‰¥ 13.1 ä½¿ç”¨ã€Œæ·å¾„ã€è‡ªåŠ¨åŒ–åŠŸèƒ½æ­é…ç±³å®¶æ™ºæ…§å®¶å±… \\| ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "101"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "Medium Partner Program ç»ˆäºå¯¹å…¨çƒ(åŒ…å«å°æ¹¾)å†™ä½œè€…å¼€æ”¾å•¦ï¼ \\| ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "85"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "77"
        }
      ],
      "dimensionValues": [
        {
          "value": "iOS æ·å¾„è‡ªåŠ¨åŒ–åº”ç”¨åœºæ™¯ â€” è‡ªåŠ¨è½¬å‘ç®€è®¯ä¸è‡ªåŠ¨å»ºç«‹æé†’å¾…åŠäº‹é¡¹ \\| ZhgChgLi"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "51"
        }
      ],
      "dimensionValues": [
        {
          "value": "æ¸¸è®° 9/11 åå¤å±‹ä¸€æ—¥å¿«é—ªè‡ªç”±è¡Œ \\| ZhgChgLi"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "42"
        }
      ],
      "dimensionValues": [
        {
          "value": "iOS éšç§ä¸ä¾¿åˆ©çš„å‰ä¸–ä»Šç”Ÿ \\| ZhgChgLi"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session \\| ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "34"
        }
      ]
    },
    {
      "dimensionValues": [
        {
          "value": "iOS â‰¥ 18 NSAttributedString attributes Range åˆå¹¶çš„ä¸€ä¸ªè¡Œä¸ºæ”¹å˜ \\| ZhgChgLi"
        }
      ],
      "metricValues": [
        {
          "value": "30"
        }
      ]
    },
    {
      "metricValues": [
        {
          "value": "30"
        }
      ],
      "dimensionValues": [
        {
          "value": "æ‰‹å·¥æ‰“é€  HTML è§£æå™¨çš„é‚£äº›äº‹ \\| ZhgChgLi"
        }
      ]
    }
  ],
  "metricHeaders": [
    {
      "type": "TYPE_INTEGER",
      "name": "screenPageViews"
    }
  ],
  "totals": [
    {
      "dimensionValues": [
        {
          "value": "RESERVED_TOTAL"
        }
      ],
      "metricValues": [
        {
          "value": "1229"
        }
      ]
    }
  ]
}
```



- **Google Apps Script è¯·æ±‚ GA æ•°æ®æˆåŠŸï¼ğŸ‰ğŸ‰ğŸ‰**



### Step 3. ç»„åˆèµ·æ¥ï¼Google Apps Script + GA4 + Telegram Bot



ä¾ç…§ä¸Šç¯‡æ–‡ç« ã€Œ [10 åˆ†é’Ÿå¿«é€Ÿç§»è½¬ Line Notify åˆ° Telegram Bot é€šçŸ¥](https://medium.com/zrealm-robotic-process-automation/10-%E5%88%86%E9%90%98%E5%BF%AB%E9%80%9F%E7%A7%BB%E8%BD%89-line-notify-%E5%88%B0-telegram-bot-%E9%80%9A%E7%9F%A5-6922e90ba90c?source=collection_home---6------0-----------------------){:target="_blank"} ã€å»ºç«‹ä½ çš„ Telegram Bot å–å¾— `Bot Token` & æƒ³è¦ä¼ é€åˆ°çš„ `Channel Chat ID` ã€‚



```javascript
const telegramToken = "XXXX" // å¸¦å…¥ä½ çš„ Telegram Bot Token
//

function execute() {
  const screenPageViewsReport = fetchScreenPageViews("318495208");
  
  //
  const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value);
  var message = "æ€»æµè§ˆæ•°ï¼š"+total.toLocaleString()+"\n";

  screenPageViewsReport.rows.forEach(function(element, index) {
    const pageTitle = element.dimensionValues[0].value;
    const value = parseInt(element.metricValues[0].value);

    message += "[Top "+(index + 1)+"] "+pageTitle+": "+value.toLocaleString()+"\n";
  });

  sendNotifyMessage(message, -xxxx); // å¸¦å…¥ä½ çš„ Channel Chat ID
}


// å‘é€è®¯æ¯åˆ° Telegram æŒ‡å®š Channel Chat ID
function sendNotifyMessage(message, chatId) {
  var url = "https://api.telegram.org/bot"+telegramToken+"/sendMessage";
  
  const payload = {
    "chat_id": chatId,
    "text": message,
    "disable_web_page_preview": true
  } 
  const options = {
    'method': 'post',
    'contentType': 'application/json',
    'muteHttpExceptions': true,
    'payload': JSON.stringify(payload)
  };

  const response = UrlFetchApp.fetch(url, options);
  const data = JSON.parse(response.getContentText());

  if (data["ok"] == undefined \\|\\| data["ok"] != true) {
    if (data["error_code"] != undefined && data["error_code"] == 429) {
      Utilities.sleep(1000);
      sendNotifyMessage(message, chatId);
    }
  }
}

function fetchScreenPageViews(propertyId, startDate = "7daysAgo", endDate = "yesterday") {
  const screenPageViewsMetric = AnalyticsData.newMetric();
  screenPageViewsMetric.name = "screenPageViews";

  const dateRange = AnalyticsData.newDateRange();
  dateRange.startDate = startDate;
  dateRange.endDate = endDate;

  const pageTitleDimension = AnalyticsData.newDimension();
  pageTitleDimension.name = "pageTitle";

  const request = AnalyticsData.newRunReportRequest();
  request.dimensions = [pageTitleDimension];
  request.metrics = [screenPageViewsMetric];
  request.dateRanges = dateRange;

  request.limit = 10;
  request.metricAggregations = "TOTAL";

  return AnalyticsData.Properties.runReport(request, "properties/" + propertyId);
}
```



ç¨‹å¼ç è§£æï¼š



```javascript
//...
  // ä¾ç…§æŠ¥è¡¨å›ä¼ çš„ json æ‰¾åˆ° total ä½ç½®ï¼ŒparseInt å°†å­—ä¸²è½¬æˆ INT æ•°å­—æ ¼å¼
  // .toLocaleString() -> æ ¼å¼åŒ–æ•°å­—ï¼Œ123456 -> 123,456
  const total = parseInt(screenPageViewsReport.totals[0].metricValues[0].value);
  var message = "æ€»æµè§ˆæ•°ï¼š"+total.toLocaleString()+"\n";

  // ä¾ç…§æŠ¥è¡¨å›ä¼ çš„ json éå†èµ„æ–™ï¼Œç»„åˆæˆè®¯æ¯
  screenPageViewsReport.rows.forEach(function(element, index) {
    const pageTitle = element.dimensionValues[0].value;
    const value = parseInt(element.metricValues[0].value);

    message += "[Top "+(index + 1)+"] "+pageTitle+": "+value.toLocaleString()+"\n";
  });
//...
```



#### **æ‰§è¡Œï¼šç‚¹å‡»ä¸Šæ–¹ã€Œæ‰§è¡Œã€æˆ–ã€Œä¾¦é”™ã€å¹¶ç¡®å®šæ–¹æ³•åç§°æ˜¯é€‰æ‹©ã€Œ `execute` ã€ï¼š**



![](/assets/1e85b8df2348/1*R7uVMGODJR2Z_GAYnyMYXA.png)



![](/assets/1e85b8df2348/1*Pl2v19Ed8COUwCc1deTYFw.png)



- **æˆåŠŸï¼ğŸ‰ğŸ‰ğŸ‰**



#### è®¾å®šæ’ç¨‹å®šæ—¶è‡ªåŠ¨æ‰§è¡Œ



æœ€åä¸€æ­¥æ˜¯æˆ‘ä»¬å¸Œæœ›æŠ¥è¡¨æœºå™¨äººèƒ½å®šæ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä»å·¦ä¾§é€‰å•å‰å¾€ã€Œè§¦å‘æ¡ä»¶ã€ï¼š



![](/assets/1e85b8df2348/1*SY1YKLwTvDtP1hQTRqj50w.png)



- é€‰æ‹©å³ä¸‹è§’ã€Œæ–°å¢è§¦å‘æ¡ä»¶ã€æŒ‰é’®



![](/assets/1e85b8df2348/1*wYOwwQBTEtns8nN_7bmvNQ.png)



1. é€‰æ‹©é•¡è¦æ‰§è¡Œçš„åŠŸèƒ½ï¼šé€‰æ‹© ã€Œ `execute` ã€æ–¹æ³•åç§°


2. é€‰æ‹©æ‰§è¡Œçš„éƒ¨ç½²ä½œä¸šï¼šé€‰æ‹©ã€Œ `ä¸Šç«¯` ã€


3. é€‰å–æ´»åŠ¨æ¥æºï¼šé€‰æ‹©ã€Œ `æ—¶é—´é©±åŠ¨` ã€


4. é€‰å–æ—¶é—´å‹è§¦å‘æ¡ä»¶ç±»å‹ï¼šé€‰æ‹©ä½ æƒ³è¦çš„è§¦å‘é¢‘ç‡


5. é€‰å–æ—¶æ®µï¼šé€‰æ‹©ä½ æƒ³è¦æ¯æ—¥è‡ªåŠ¨è§¦å‘çš„æ—¶é—´


6. å¦‚æœæ‰§è¡Œå¤±è´¥â€¦é€šçŸ¥ä¿¡ä»¶çš„é¢‘ç‡è®¾å®š


7. å‚¨å­˜



> ***å®Œæˆï¼è¿™æ ·æ—¶é—´åˆ°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œå•°ã€‚*** ğŸ‰ğŸ‰ğŸ‰



### å»¶ä¼¸ä½œä¸š



å…¶ä»–æ•°æ®å¦‚ æ–°ä½¿ç”¨è€…æ•°ã€æ¥æºåª’ä»‹ç­‰ï¼ŒåŒæ ·ä½¿ç”¨å‰é¢ç¨‹å¼ç å°±èƒ½è¾¾æˆï¼Œè¿™è¾¹å°±ä¸åœ¨é‡å¤èµ˜è¿°ï¼Œå°±å½“æˆç»™å¤§å®¶çš„å›å®¶ä½œä¸šå•°ã€‚



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-robotic-process-automation/%E7%B0%A1%E5%96%AE-3-%E6%AD%A5%E9%A9%9F-%E6%89%93%E9%80%A0%E5%85%8D%E8%B2%BB-ga4-%E8%87%AA%E5%8B%95%E6%95%B8%E6%93%9A%E9%80%9A%E7%9F%A5%E6%A9%9F%E5%99%A8%E4%BA%BA-1e85b8df2348){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*