---
title: ä»€éº¼ï¼ŸiOS 12 ä¸éœ€ä½¿ç”¨è€…æˆæ¬Šå°±èƒ½æ”¶åˆ°æ¨æ’­é€šçŸ¥(Swift)
author: ZhgChgLi
date: 2018-11-01T15:35:02.255+0000
last_modified_at: 2022-06-11T06:22:42.813+0000
categories: ZRealm Dev.
tags: [ios,swift,push-notification,ios-app-development,ios12]
description: UserNotifications Provisional Authorization è‡¨æ™‚æ¬Šé™ã€iOS 12 éœéŸ³é€šçŸ¥ä»‹ç´¹
image:
  path: /assets/ade9e745a4bf/1*NX0r7q5ikfoJnxWq_eGRWQ.jpeg
render_with_liquid: false
---

### ä»€éº¼ï¼ŸiOS 12 ä¸éœ€ä½¿ç”¨è€…æˆæ¬Šå°±èƒ½å‚³é€æ¨æ’­é€šçŸ¥\(Swift\) â€” \(2019â€“02â€“06 æ›´æ–°\)

UserNotifications Provisional Authorization è‡¨æ™‚æ¬Šé™ã€iOS 12 éœéŸ³é€šçŸ¥ä»‹ç´¹
### MurMurâ€¦â€¦

å‰é™£å­åœ¨æ”¹å–„APPæ¨æ’­é€šçŸ¥å…è¨±åŠé»æ“Šç‡éä½å•é¡Œï¼Œåšäº†äº›å„ªåŒ–èª¿æ•´ï¼›æœ€åˆç‰ˆçš„æ™‚å€™é«”é©—éå¸¸å·®ï¼ŒAPP å®‰è£å®Œä¸€å•Ÿå‹•å°±ç›´æ¥è·³ã€ŒAPPæƒ³è¦å‚³é€é€šçŸ¥ã€çš„è©¢å•è¦–çª—ï¼›æƒ³ç•¶ç„¶è€Œé—œé–‰ç‡éå¸¸é«˜ï¼Œæ ¹æ“šå‰ä¸€ç¯‡ä½¿ç”¨ [Notification Service Extension](../cb6eba52a342/) çµ±è¨ˆé€šçŸ¥å¯¦éš›é¡¯ç¤ºæ•¸ï¼Œæ¨æ¸¬æŒ‰å…è¨±æ¨æ’­çš„ä½¿ç”¨è€…åªæœ‰å¤§ç´„10%ï¼

ç›®å‰èª¿æ•´æ–°å®‰è£å¼•å°æµç¨‹ã€é…åˆä»‹é¢å„ªåŒ–å°‡è©¢å•é€šçŸ¥è¦–çª—çš„è·³å‡ºæ™‚æ©Ÿèª¿æ•´å¦‚ä¸‹ï¼š


![[çµå©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/ade9e745a4bf/1*Yehjud9-RMPTENiVQz4Ryg.gif)

[çµå©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}

å¦‚æœä½¿ç”¨è€…é‚„åœ¨çŒ¶è±«æˆ–æƒ³ä½¿ç”¨çœ‹çœ‹å†æ±ºå®šè¦ä¸è¦æ¥æ”¶é€šçŸ¥ï¼Œå¯æŒ‰å³ä¸Šè§’ã€Œç•¥éã€ï¼Œé¿å…ä¸€é–‹å§‹å› å°APPé‚„ä¸ç†Ÿæ‚‰è€ŒæŒ‰ä¸‹ã€Œä¸å…è¨±ã€é€ æˆä¹‹å¾Œä¹Ÿç„¡æ³•å†è©¢å•ä¸€å»ä¸å¾©è¿”çš„çµæœã€‚
### é€²å…¥æ­£é¡Œ

åœ¨åšä¸Šé¢é€™å€‹å„ªåŒ–é …ç›®æ™‚ç™¼ç¾ UserNotifications iOS 12 ä¸­æ–°å¢ä¸€é … \.provisional æ¬Šé™ï¼Œç¿»æˆç™½è©±å°±æ˜¯è‡¨æ™‚çš„é€šçŸ¥æ¬Šé™ï¼Œ **ä¸ç”¨è·³è©¢å•é€šçŸ¥è¦–çª—å–å¾—å…è¨±é€šçŸ¥æ¬Šé™å°±èƒ½å°ä½¿ç”¨è€…ç™¼é€æ¨æ’­é€šçŸ¥\(éœéŸ³é€šçŸ¥\)** ï¼Œå¯¦éš›æ•ˆæœè·Ÿé™åˆ¶æˆ‘å€‘æ¥è‘—çœ‹ä¸‹å»ã€‚
#### å¦‚ä½•è¦æ±‚è‡¨æ™‚é€šçŸ¥æ¬Šé™?
```swift
if #available(iOS 12.0, *) {
    let center = UNUserNotificationCenter.current()
    let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound, .provisional]
    // å¯ä»¥åªè¦æ±‚è‡¨æ™‚æ¬Šé™.provisionalï¼Œæˆ–æ˜¯é †ä¾¿å…ˆè¦æ±‚æ‰€æœ‰è¦ç”¨çš„æ¬Šé™ï¼¸ï¼¤
    // éƒ½ä¸æœƒè§¸ç™¼é¡¯ç¤ºè©¢å•é€šçŸ¥è¦–çª—
    
    center.requestAuthorization(options: permissiones) { (granted, error) in
        print(granted)
    }
}
```

æˆ‘å€‘å°‡ä»¥ä¸Šç¨‹å¼åŠ å…¥ AppDelegate didFinishLaunchingWithOptions ç„¶å¾Œé–‹å•ŸAPPï¼Œå°±æœƒç™¼ç¾æ²’æœ‰è·³å‡ºè©¢å•é€šçŸ¥è¦–çª—ï¼›é€™æ™‚æˆ‘å€‘å» **è¨­å®š** æŸ¥çœ‹ **APPé€šçŸ¥è¨­å®š**


![\(åœ–ä¸€\) å–å¾—éœéŸ³é€šçŸ¥æ¬Šé™](/assets/ade9e745a4bf/1*MvsncOUpTTh-ZTlJAUm8fA.jpeg)

\(åœ–ä¸€\) å–å¾—éœéŸ³é€šçŸ¥æ¬Šé™

æˆ‘å€‘å°±é€™æ¨£é»˜é»˜åœ°å–å¾—äº†éœéŸ³é€šçŸ¥æ¬Šé™ğŸ†

åœ¨ç¨‹å¼åˆ¤æ–·ç•¶å‰æ¨æ’­é€šçŸ¥æ¬Šé™çš„éƒ¨åˆ†æ–°å¢ authorizationStatus \.provisional é …ç›® \(åƒ…iOS 12ä¹‹å¾Œ\)ï¼š
```swift
if #available(iOS 10.0, *) {
    UNUserNotificationCenter.current().getNotificationSettings { (settings) in
        if settings.authorizationStatus == .authorized {
            //å…è¨±
        } else if settings.authorizationStatus == .denied {
            //ä¸å…è¨±
        } else if settings.authorizationStatus == .notDetermined {
            //æ²’å•é
        } else if #available(iOS 12.0, *) {
            if settings.authorizationStatus == .provisional {
                //ç›®å‰æ˜¯è‡¨æ™‚æ¬Šé™
            }
        }
    }
}
```


> **è«‹æ³¨æ„ï¼** å¦‚æœä½ æœ‰é‡å°ç•¶å‰é€šçŸ¥æ¬Šé™ç‹€æ…‹åšåˆ¤æ–·ï¼Œsettings\.authorizationStatus == \.notDetermined è·Ÿ settings\.authorizationStatus == \.provisional
 

> éƒ½æ˜¯å¯ä»¥å†è·³å‡ºé€šçŸ¥è©¢å•è¦–çª—å•ä½¿ç”¨è€…å…ä¸å…è¨±æ¥æ”¶é€šçŸ¥çš„ 




#### éœéŸ³é€šçŸ¥èƒ½å¹¹å˜›ï¼Ÿæ¨æ’­å¦‚ä½•é¡¯ç¤ºï¼Ÿ

å…ˆä¾†å¼µåœ–æ•´ç†ä¸€ä¸‹éœéŸ³é€šçŸ¥æœƒé¡¯ç¤ºçš„æ™‚æ©Ÿï¼š


![](/assets/ade9e745a4bf/1*BZYhskEdvVLNsFvJV-SWkw.jpeg)


å¯ä»¥çœ‹åˆ°å¦‚æœæ˜¯éœéŸ³æ¨æ’­é€šçŸ¥ï¼ŒAPPåœ¨èƒŒæ™¯ç‹€æ…‹ä¸‹æ”¶åˆ°é€šçŸ¥æ™‚ **ä¸æœƒè·³å‡ºæ©«å¹…ã€ä¸æœƒæœ‰è²éŸ³æç¤ºã€ä¸èƒ½æ¨™è¨˜ã€ä¸æœƒå‡ºç¾åœ¨é–å®šç•«é¢ï¼Œåªæœƒå‡ºç¾åœ¨æ‰‹æ©Ÿè§£é–ç‹€æ…‹ä¸‹ä¸‹æ‹‰çš„é€šçŸ¥ä¸­å¿ƒä¹‹ä¸­** ï¼š


![](/assets/ade9e745a4bf/1*Nq6PQhG06BOrX_05i0Jb0g.jpeg)


å¯ä»¥çœ‹åˆ°æ‚¨çš„ç™¼é€çš„æ¨æ’­é€šçŸ¥ï¼Œä¸¦ä¸”æœƒè‡ªå‹•èšåˆæˆä¸€å€‹åˆ†é¡

**é»æ“Šå±•é–‹å¾Œä½¿ç”¨è€…å¯é¸æ“‡ï¼š**


![æ­¤å±•é–‹çš„è©¢å•è¦–çª—åªæœƒå‡ºç¾åœ¨ã€Œè‡¨æ™‚æ¬Šé™ã€æ™‚éœéŸ³æ¨æ’­ä¹‹ä¸‹](/assets/ade9e745a4bf/1*NX0r7q5ikfoJnxWq_eGRWQ.jpeg)

æ­¤å±•é–‹çš„è©¢å•è¦–çª—åªæœƒå‡ºç¾åœ¨ã€Œè‡¨æ™‚æ¬Šé™ã€æ™‚éœéŸ³æ¨æ’­ä¹‹ä¸‹
1. è¦ã€Œç¹¼çºŒã€æ¥æ”¶æ¨æ’­ â€” ã€Œå‚³é€é‡è¦é€šçŸ¥ã€ï¼š **é€šçŸ¥æ¬Šé™å°±å…¨é–‹äº†ï¼é€šçŸ¥æ¬Šé™å°±å…¨é–‹äº†ï¼é€šçŸ¥æ¬Šé™å°±å…¨é–‹äº†ï¼** çœŸçš„å¾ˆé‡è¦æ‰€ä»¥è¬›ä¸‰æ¬¡ï¼Œé€™æ™‚å€™å‰é¢ç¨‹å¼ç¢¼è¦æ±‚æ¬Šé™é‚£æ®µä¸€ä½µè¦æ±‚æ‰€æœ‰æ¬Šé™çš„æ•ˆæœå°±ç›¸ç•¶é¡¯è‘—äº†ã€‚
æˆ–ç¶­æŒæ¥æ”¶éœéŸ³é€šçŸ¥
2. ã€Œé—œé–‰ã€ â€” ã€Œé—œé–‰æ‰€æœ‰é€šçŸ¥ã€é»æ“Šå¾Œå®Œå…¨é—œé–‰æ¨æ’­é€šçŸ¥ï¼ˆå«éœéŸ³é€šçŸ¥ï¼‰ã€‚

#### é™„è¨»ï¼šè¦æ€éº¼æ‰‹å‹•æŠŠç¾æœ‰çš„APPèª¿æˆéœéŸ³é€šçŸ¥ï¼Ÿ

éœéŸ³é€šçŸ¥æ˜¯iOS 12å°é€šçŸ¥å„ªåŒ–æ¨å‡ºçš„æ–°è¨­å®šèˆ‡è‡¨æ™‚æ¬Šé™ç„¡é—œï¼Œåªä¸éæ˜¯ç¨‹å¼é‚£ç«¯æ‹¿åˆ°è‡¨æ™‚æ¬Šé™å°±èƒ½ç™¼éœéŸ³é€šçŸ¥ï¼›é‡å°APPçš„é€šçŸ¥è¦è¨­æˆéœéŸ³ä¹Ÿå¾ˆç°¡å–®ï¼Œæ–¹æ³•ä¹‹ä¸€å°±æ˜¯å»ã€Œè¨­å®šã€\-ã€Œé€šçŸ¥ã€\- æ‰¾åˆ°APP å°‡å…¶æ‰€æœ‰æ¬Šé™éƒ½é—œé–‰åªç•™ã€Œé€šçŸ¥ä¸­å¿ƒã€\(å¦‚åœ–ã„§\)å³æ˜¯éœéŸ³é€šçŸ¥ï¼
æˆ–æ˜¯æ”¶åˆ°APPé€šçŸ¥æ™‚é‡å£“/é•·å£“å±•é–‹å¾Œï¼Œé»æ“Šå³ä¸Šè§’ã€Œâ€¦ã€é¸æ“‡å‚³é€éœéŸ³é€šçŸ¥äº¦åŒï¼š


![](/assets/ade9e745a4bf/1*Lfx_esnpxLQ7GXVoLT710A.gif)

#### æœ‰äº†è‡¨æ™‚æ¬Šé™åœ¨ä¹‹å¾Œè§¸ç™¼è·³å‡ºè©¢å•é€šçŸ¥è¦–çª—æ™‚ï¼š

è¦æ±‚é€šçŸ¥æ¬Šé™çš„éƒ¨åˆ†æ‹¿æ‰ \.provisional å°±èƒ½ä¾ç„¶æ­£å¸¸è©¢å•ä½¿ç”¨è€…è¦ä¸è¦å…è¨±æ¥æ”¶é€šçŸ¥ï¼š
```swift
if #available(iOS 10.0, *) {
    let center = UNUserNotificationCenter.current()
    let permissiones:UNAuthorizationOptions = [.badge, .alert, .sound]
    center.requestAuthorization(options: permissiones) { (granted, error) in
        print(granted)
    }
}
```


![](/assets/ade9e745a4bf/1*Bu6H1GZPWUoAd1oSfdYi5w.jpeg)


æŒ‰ã€Œå…è¨±ã€å–å¾—æ‰€æœ‰é€šçŸ¥æ¬Šé™ã€æŒ‰ã€Œä¸å…è¨±ã€é—œé–‰æ‰€æœ‰é€šçŸ¥æ¬Šé™\(å«æœ¬ä¾†å–å¾—çš„éœéŸ³é€šçŸ¥æ¬Šé™\)
#### æ•´é«”æµç¨‹å¦‚ä¸‹ï¼š


![](/assets/ade9e745a4bf/1*--o4wB9gSZ3y661GiZfEEg.jpeg)

#### ç¸½çµï¼š

iOS 12çš„é€™é …é€šçŸ¥è²¼å¿ƒå„ªåŒ–ï¼Œè®“ä½¿ç”¨è€…è·Ÿé–‹ç™¼è€…ä¹‹é–“å°é€šçŸ¥åŠŸèƒ½æ›´å®¹æ˜“é”æ­èµ·äº’å‹•çš„æ©‹æ¨‘ï¼Œèƒ½ç›¡é‡é¿å…ä¸€å»ä¸å¾©è¿”é—œé–‰é€šçŸ¥çš„ç‹€æ³ã€‚

å°ä½¿ç”¨è€…ä¾†èªªï¼Œå¾€å¾€è·³è©¢å•é€šçŸ¥è¦–çª—æ™‚ä¸çŸ¥è©²æŒ‰ä¸‹å…è¨±é‚„æ˜¯æ‹’çµ•å› ç‚ºæˆ‘å€‘ä¸çŸ¥é“é–‹ç™¼è€…æœƒå‚³ä»€éº¼æ¨£çš„é€šçŸ¥çµ¦æˆ‘å€‘ï¼Œå¯èƒ½æ˜¯å»£å‘Šäº¦å¯èƒ½æ˜¯é‡è¦æ¶ˆæ¯ï¼ŒæœªçŸ¥çš„äº‹ç‰©æ˜¯å¯æ€•çš„ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„äººéƒ½æœƒå…ˆä¿å®ˆæŒ‰ä¸‹æ‹’çµ•ã€‚

å°é–‹ç™¼è€…ä¾†èªªï¼Œæˆ‘å€‘ç²¾å¿ƒæº–å‚™äº†è¨±å¤šé …ç›®åŒ…å«é‡è¦æ¶ˆæ¯è¦æ¨é€çµ¦ä½¿ç”¨è€…çŸ¥é“ï¼Œä½†å°±å› ä¸Šè¿°å•é¡Œè€Œè¢«ä½¿ç”¨è€…å±è”½ï¼Œæˆ‘å€‘èŠ±è²»å¿ƒæ€è¨­è¨ˆçš„æ–‡æ¡ˆå°±é€™æ¨£ç™½è²»äº†ï¼

æ­¤åŠŸèƒ½å¯è®“é–‹ç™¼è€…æŠŠæ¡ä½¿ç”¨è€…å‰›å®‰è£APPæ™‚çš„æ©Ÿæœƒï¼Œè¨­è¨ˆå¥½æ¨æ’­æµç¨‹ã€å…§å®¹ï¼Œå°ä½¿ç”¨è€…å„ªå…ˆæ¨é€æ„Ÿèˆˆè¶£é …ç›®ï¼Œå¢åŠ ä½¿ç”¨è€…å°æ­¤APPé€šçŸ¥çš„èªè­˜åº¦ï¼Œä¸¦è¿½è¹¤æ¨æ’­é»æ“Šç‡ï¼Œåœ¨é©ç•¶çš„æ™‚æ©Ÿå†è§¸ç™¼è©¢å•ä½¿ç”¨è€…è¦ä¸è¦æ¥æ”¶é€šçŸ¥ã€‚

é›–ç„¶èƒ½æ›å…‰çš„åœ°æ–¹åªæœ‰ **é€šçŸ¥ä¸­å¿ƒ** ä½†æœ‰æ›å…‰æœ‰æ©Ÿæœƒï¼›æ›å€‹è§’åº¦æƒ³ï¼Œæˆ‘å€‘æ˜¯ä½¿ç”¨è€…çš„è©±ï¼Œæ²’æŒ‰å…è¨±é€šçŸ¥ï¼ŒAPPå¦‚æœèƒ½å‚³ä¸€å †æœ‰æ©«å¹…\+æœ‰è²éŸ³\+é‚„å‡ºç¾åœ¨è§£é–ç•«é¢çš„é€šçŸ¥çµ¦æˆ‘ï¼Œæ‡‰è©²æœƒè¦ºå¾—éå¸¸å¹²æ“¾æƒ±äºº\(éš”å£é™£ç‡Ÿå°±æ˜¯XD\)ï¼Œè˜‹æœé€™å€‹åšæ³•å‰‡æ˜¯åœ¨ä½¿ç”¨è€…èˆ‡é–‹ç™¼è€…ä¹‹é–“å–å¾—äº†å¹³è¡¡ã€‚

ç›®å‰çš„å•é¡Œå¤§æ¦‚å°±æ˜¯â€¦\.iOS 12çš„ç”¨æˆ¶é‚„å¤ªå°‘ğŸ¤
### 2019â€“02â€“06 æ›´æ–°å¯¦éš›æ‡‰ç”¨ï¼š


> å¯¦éš›æ‡‰ç”¨æˆ‘å·²ã€Œå–æ¶ˆã€å¯¦ä½œæ­¤åŠŸèƒ½ 




**ç‚ºä»€éº¼ï¼Ÿ**

å› ç‚ºç™¼ç¾åœ¨ä»¥ä¸‹æƒ…æ³ä½¿ç”¨è€…æœƒè¢«å‹•é€²å…¥éœéŸ³æ¨æ’­æ¨¡å¼ï¼Œè¦è‡ªè¡Œæ‰‹å‹•æŠŠæ‰€æœ‰æ¨æ’­æ¬Šé™\(æ©«å¹…ã€è²éŸ³ã€æ¨™è¨˜\)æ‰“é–‹


![](/assets/ade9e745a4bf/1*ZtizO946Z5-EukrCWuCjXg.png)


æœ‰é»å°·å°¬ï¼Œä¹Ÿå°±æ˜¯èªªä½¿ç”¨è€…å¦‚æœå†è©¢å•é€šçŸ¥æ¬Šé™æ™‚æŒ‰å¦ï¼Œåˆ°è¨­å®šå†æ‰“é–‹ï¼Œé‚£å€‹æ‰“é–‹çš„æœƒåªæœ‰éœéŸ³é€šçŸ¥æ¬Šé™ï¼›è¦å†è«‹ä½¿ç”¨è€…æŠŠä¸‹æ–¹æ©«å¹…ã€è²éŸ³ã€æ¨™è¨˜éƒ½æ‰“é–‹æœ‰é»å›°é›£ï¼Œæ‰€ä»¥æš«æ™‚å°±å…ˆå–æ¶ˆä¸ä½¿ç”¨äº†ã€‚
#### å»¶ä¼¸é–±è®€
- [å¾ iOS 9 åˆ° iOS 12 æ¨æ’­é€šçŸ¥æ¬Šé™ç‹€æ…‹è™•ç†\(Swift\)](../fd7f92d52baa/)
- [iOS Deferred Deep Link å»¶é²æ·±åº¦é€£çµå¯¦ä½œ\(Swift\)](../b08ef940c196/)
- [iOS\+MacOS ä½¿ç”¨mitmproxy é€²è¡Œä¸­é–“äººå—…æ¢](../46410aaada00/)
- [iOS 15 / MacOS Monterey Safari å°‡èƒ½éš±è—çœŸå¯¦ IP](https://medium.com/zrealm-ios-dev/ios-15-macos-monterey-safari-%E5%B0%87%E8%83%BD%E9%9A%B1%E8%97%8F%E7%9C%9F%E5%AF%A6-ip-755a8b6acc35){:target="_blank"}



[![Like Z Realm's work](https://button.like.co/images/og/likebutton.png "Like Z Realm's work")](https://button.like.co/in/like/zhgchgli){:target="_blank"}


æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-ios-dev/%E4%BB%80%E9%BA%BC-ios-12-%E4%B8%8D%E9%9C%80%E4%BD%BF%E7%94%A8%E8%80%85%E6%8E%88%E6%AC%8A%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5-swift-ade9e745a4bf){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
