---
title: "App ç”¢å“é€²å…¥çµ‚é»ç«™ï¼Œèƒ½åšä»€éº¼äº‹ç·¬æ‡·ï¼Ÿ"
author: "ZhgChgLi"
date: 2024-05-15T00:20:45.012+0800
last_modified_at: 2024-05-15T00:20:45.012+0800
categories: "ZRealm Dev."
tags: ["ios-app-development","man-in-the-middle-attack","mitmproxy","python","app-development"]
description: "ä½¿ç”¨ mitmproxy + apple configurator è®“ App æ°¸é åœç•™åœ¨ä¸‹æ¶å‰çš„ç‹€æ…‹"
image:
  path: /assets/b04f4fba3cf2/1*8RN-xVJROfLwtovgkvHDwA.jpeg
render_with_liquid: false
---

### App ç”¢å“é€²å…¥çµ‚é»ç«™ï¼Œèƒ½åšä»€éº¼äº‹ç·¬æ‡·ï¼Ÿ

ä½¿ç”¨ mitmproxy \+ apple configurator è®“ App æ°¸é åœç•™åœ¨ä¸‹æ¶å‰çš„ç‹€æ…‹

### å‰è¨€


![å’’è¡“è¿´æˆ°](/assets/b04f4fba3cf2/1*8RN-xVJROfLwtovgkvHDwA.jpeg)

å’’è¡“è¿´æˆ°

å·¥ä½œæ™‚é–“ä¹…ã€ç¶“æ‰‹éçš„ç”¢å“å¤šï¼Œä¹Ÿé–‹å§‹é‡åˆ°æœ‰æ›¾ç¶“åƒèˆ‡éçš„ç”¢å“è¦é€²å…¥çµ‚é»ç«™\(ä¸‹æ¶\)ï¼›å¾é›¶åˆ°æœ‰é–‹ç™¼ä¸€å€‹ç”¢å“å¦‚åŒå­•è‚²ä¸€å€‹æ–°ç”Ÿå‘½ï¼Œåœ˜éšŠä¸€èµ·åŠªåŠ›äº† 3â€“4 å€‹æœˆå°‡å­©å­ç”Ÿä¸‹ä¾†ï¼›é›–ç„¶å¾ŒæœŸå·²äº¤ç”±å…¶ä»–ä¿æ¯\(å·¥ç¨‹å¸«\)ç¹¼çºŒåŸ¹é¤Šï¼Œæœ€è¿‘è½åˆ°å®ƒå³å°‡é€²å…¥ç”¢å“ç”Ÿå‘½é€±æœŸçš„çµ‚é»é‚„æ˜¯æœ‰äº›è¨±éºæ†¾ã€‚


> **_äººç”Ÿä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘å€‘æ°¸é éƒ½ä¸çŸ¥é“æ˜å¤©æ˜¯å¤ªé™½å…ˆå‡èµ·é‚„æ˜¯æ„å¤–å…ˆä¾†è‡¨ï¼›å”¯ä¸€èƒ½åšçš„å°±æ˜¯çæƒœç•¶ä¸‹ï¼ŒæŠŠäº‹æƒ…åšå¥½ã€‚_** 




#### ç·¬æ‡·

å‡¡èµ°éå¿…ç•™ä¸‹ç—•è·¡ï¼Œæˆ‘å€‘å¸Œæœ›èƒ½åœ¨ç”¢å“é€²å…¥çµ‚é»ç«™ä¹‹å‰åšäº›ä»€éº¼ï¼Œè®“å¤§å®¶é‚„æœ‰æ©Ÿæœƒå›æ†¶ä¹Ÿè®“å®ƒè‡³å°‘ç•™ä¸‹å­˜åœ¨éçš„è­‰æ˜ï¼›ä»¥ä¸‹æ–¹å¼éƒ½éœ€è¦ App é‚„åœ¨ç·šä¸Šï¼Œå¦‚æœå·²ç¶“ä¸‹æ¶å°±çœŸçš„åªå‰©å›æ†¶äº†ã€‚
### éæŠ€è¡“æ–¹å¼ â€” éŒ„å½±

é™¤äº†ç›´æ¥ç”¨ [iPhone å…§å»ºçš„è¢å¹•éŒ„å½±åŠŸèƒ½](https://support.apple.com/zh-tw/102653){:target="_blank"} ä¹‹å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ QuickTime Player å°‡æ‰‹æ©Ÿæ¥ä¸Š Mac ä½¿ç”¨é›»è…¦é€²è¡ŒéŒ„å½±ã€åŒ¯å‡ºå½±ç‰‡ã€‚
1. åœ¨ Mac ä¸Šæ‰“é–‹ QuickTime Player App



![](/assets/b04f4fba3cf2/1*UVkfiLbcYU8YuZEPdbJaOg.png)


2\. å·¦ä¸Šè§’å·¥å…·åˆ—é¸æ“‡ã€Œæª”æ¡ˆã€\-&gt;ã€Œæ–°å¢å½±ç‰‡éŒ„è£½ã€


![](/assets/b04f4fba3cf2/1*VcRN0FExy-CA7sExHtMT6w.png)


3\. è·³å‡ºéŒ„å½±ä»‹é¢å¾Œé»æ“Š ğŸ”´ æ—çš„ã€Œvã€ï¼Œè¢å¹•èˆ‡æšè²å™¨é¸æ“‡æ‚¨æ¥ä¸Šçš„æ‰‹æ©Ÿ


![](/assets/b04f4fba3cf2/1*SN0XL8Zt0UlBizXiIqZiyA.png)


4\. æ­¤æ™‚éŒ„å½±ä»‹é¢å°±æœƒå‡ºç¾æ‰‹æ©Ÿç•«é¢


![](/assets/b04f4fba3cf2/1*MSuecaACmg3ZNMnGpDkRFQ.png)


é»æ“Šã€ŒğŸ”´ã€é–‹å§‹éŒ„å½±ï¼Œå›åˆ°æ‰‹æ©Ÿä¸Šæ“ä½œè¦éŒ„å½±çš„å…§å®¹ã€‚


![](/assets/b04f4fba3cf2/1*bxL9Dq1IWgbrlSfKO6skLQ.png)


éŒ„å½±ä¸­æœƒé¡¯ç¤ºç•¶å‰å½±ç‰‡å¤§å°ï¼Œæ¬²çµæŸéŒ„å½±å†æŒ‰ä¸€æ¬¡ã€ŒğŸ”´ã€å³å¯åœæ­¢ã€‚


![](/assets/b04f4fba3cf2/1*VxWQNHF_PX5CZAkjJEXPbQ.png)


å¯ä»¥é€é QuickTime Player å·¥å…·åˆ—ç°¡å–®çš„è£å‰ªå½±ç‰‡ï¼Œæœ€å¾ŒæŒ‰ä¸‹ã€ŒCommandã€\+ã€Œsã€åŒ¯å‡ºå„²å­˜å½±ç‰‡åˆ°æŒ‡å®šä½ç½®ï¼Œå³å®ŒæˆéŒ„å½±ç•™å¿µã€‚

å½±ç‰‡ç•™å¿µçš„å¥½è™•æ˜¯æœªä¾†å›æ†¶æ¯”åœ–ç‰‡æ›´å®¹æ˜“ä¸²é€£èµ·ä¾†ï¼ŒéŒ„çš„è¶Šæ·±å°±ç´€éŒ„çš„è¶Šä»”ç´°ï¼Œè‹¥è¦å°‡æ›´åˆ¥ç•«é¢è½‰æˆåœ–ç‰‡ä¹Ÿå¯ä»¥ç›´æ¥æˆªåœ–ï¼Œå¾ˆæ–¹ä¾¿ã€‚
### æŠ€è¡“æ–¹å¼

App æŠ€è¡“å‚™ä»½å¯åˆ†ç‚ºå…©å€‹æ–¹å‘ï¼›ã€Œéª¨ã€App æœ¬èº«å…¶å¯¦åªæ˜¯å€‹éª¨æ¶ã€ã€Œè‚‰ã€ç”± API Response Data çµ„æˆæ‰æ˜¯ App å…§å®¹è³‡æ–™çš„æ ¸å¿ƒã€‚
- éª¨æœƒéš¨è‘— App å¾ App Store å•†åŸä¸‹æ¶è€Œæ¶ˆå¤±ã€‚
- è‚‰æœƒéš¨è‘— API ä¸»æ©Ÿã€ä¼ºæœå™¨é—œé–‰è€Œæ¶ˆå¤±ã€‚


å› æ­¤æˆ‘å€‘ä¹Ÿåˆ†æˆå‚™ä»½éª¨è·Ÿè‚‰å…©å€‹æŠ€è¡“æ–¹å¼ã€‚
#### è²æ˜


> _æœ¬æ–‡åƒ…ç‚ºæŠ€è¡“ç ”ç©¶åˆ†äº«ï¼Œä¸é¼“å‹µåˆ©ç”¨ä»»ä½•æŠ€è¡“é€²è¡Œéæ³•ã€ä¾µæ¬Šè¡Œç‚ºã€‚_ 




#### \[éª¨\] å‚™ä»½ \.ipa App å®‰è£æª”

App åœ¨å•†åŸä¸‹æ¶å¾Œå·²ä¸‹è¼‰ App çš„æ‰‹æ©Ÿåªè¦ä¸ä¸»å‹•åˆªé™¤ Appï¼Œå°±æœƒä¸€ç›´å­˜åœ¨åœ¨è©²æ‰‹æ©Ÿä¸Šï¼Œæ›æ‰‹æ©Ÿç”¨è½‰ç§»çš„æ–¹å¼ä¹Ÿæœƒä¸€ä½µè½‰ç§»éå»ã€‚

ä½†å¦‚æœæˆ‘å€‘ä¸å°å¿ƒåˆªé™¤è©² App æˆ–æ˜¯æ›æ‰‹æ©Ÿæ²’è½‰ç§»ï¼Œé‚£å°±çœŸçš„æ°¸é è·Ÿä»–èªªå†è¦‹äº†ï¼›æ­¤æ™‚å¦‚æœæœ‰æ‰‹å‹•å‚™ä»½å•†åŸçš„ \.ipa æª”æ¡ˆå°±èƒ½å†æ¬¡çºŒå‘½ã€‚

å¾ˆä¹…ä»¥å‰ [é€†å‘å·¥ç¨‹çš„æ–‡ç« ](../7498e1ff93ce/) æœ‰æåˆ°éï¼Œä½†é€™æ¬¡åªéœ€å–®ç´”å‚™ä»½ \.ipa æª”æ¡ˆä¸éœ€æ•²æ®¼ï¼Œå…¨éƒ¨éƒ½æ˜¯ä½¿ç”¨ Apple å®˜æ–¹æä¾›çš„å·¥å…·å®Œæˆã€‚

**1\.å®‰è£ [Apple Configurator 2](https://apps.apple.com/tw/app/apple-configurator/id1037126344?mt=12){:target="_blank"}**


![](/assets/b04f4fba3cf2/1*_RzuFIVGV9T_-xJ53H8fGA.png)


é¦–å…ˆå» Mac App Store ä¸‹è¼‰å®‰è£ã€Œ [Apple Configurator 2](https://apps.apple.com/tw/app/apple-configurator/id1037126344?mt=12){:target="_blank"} ã€

**2\. å°‡ iPhone æ¥ä¸Š Mac ä¸¦é»æ“Šä¿¡ä»»é›»è…¦**


![](/assets/b04f4fba3cf2/1*EiSQmOkDCW73kYhJWbTipQ.png)


æ¥ä¸ŠæˆåŠŸå¾Œå°±æœƒå‡ºç¾ iPhone çš„ä¸»ç•«é¢ã€‚

**3\. ç¢ºèªä½ çš„æ‰‹æ©Ÿå·²å®‰è£æ¬²å‚™ä»½ \.ipa æª”æ¡ˆçš„ App**


![](/assets/b04f4fba3cf2/1*QD9M4uM9eyKSixzu8AdKbw.png)


æˆ‘å€‘éœ€è¦åœ¨ Apple Configurator 2 å¡å‡ºå–ä»£ç•«é¢ï¼Œæ‰èƒ½å–å¾—ä¸‹è¼‰åˆ°æš«å­˜ä¸­çš„ \.ipa æª”æ¡ˆï¼Œå› æ­¤æˆ‘å€‘è¦å…ˆç¢ºä¿æ‰‹æ©Ÿä¸Šæœ‰å®‰è£ç›®æ¨™ Appã€‚

**4\. å›åˆ° Mac ä¸Šçš„ Apple Configurator 2**

é»å…©ä¸‹ä¸Šé¢é¡¯ç¤ºçš„ iPhone ä¸»ç•«é¢é€²å…¥è³‡è¨Šé ã€‚


![](/assets/b04f4fba3cf2/1*X_y5uGhRRIq7VQuW4PkYBg.png)


åˆ‡æ›åˆ°ã€ŒAppã€\-&gt; å³ä¸Šè§’ã€Œ\+ åŠ å…¥ã€\-&gt;ã€ŒAppã€

å®Œæˆ App Store å¸³è™Ÿç™»å…¥å¾Œå¯ä»¥å–å¾—æ‚¨æ›¾ç¶“è³¼è²·éçš„ App åˆ—è¡¨ã€‚


![](/assets/b04f4fba3cf2/1*uAyjPD75-MGokHCbDoC_4g.png)


æœå°‹æ‰¾åˆ°æ¬²å‚™ä»½çš„ç›®æ¨™ Appï¼Œé¸æ“‡å¾Œé»ã€ŒåŠ å…¥ã€ã€‚


![](/assets/b04f4fba3cf2/1*T-v1CNrmc7T4MpeyAX0c7A.png)


æ­¤æ™‚æœƒå‡ºç¾ç­‰å¾…è¦–çª—ï¼Œæ­£åœ¨ XXX ä¸ŠåŠ å…¥ Appã€æ­£åœ¨ä¸‹è¼‰ã€ŒXXXã€ã€‚

**5\. æå– \.ipa æª”æ¡ˆ**


> **_æ”¾è‘—ç­‰ä»–ä¸‹è¼‰å®Œæˆå¾Œï¼Œæœƒè·³å‡ºè©¢å•æ˜¯å¦è¦å–ä»£ç¾æœ‰å·²å®‰è£ App è¦–çª—ã€‚_** 






![](/assets/b04f4fba3cf2/1*9f54be4lixn4ezKhwRJrtg.png)



> **_æ­¤æ™‚ä¸è¦æŒ‰ä»»ä½•å‹•ä½œã€‚æ­¤æ™‚ä¸è¦æŒ‰ä»»ä½•å‹•ä½œã€‚æ­¤æ™‚ä¸è¦æŒ‰ä»»ä½•å‹•ä½œã€‚_** 





æˆ‘å€‘æ‰“é–‹ä¸€å€‹ Finderï¼š

å·¦ä¸Šè§’å·¥å…·åˆ—é¸æ“‡ã€Œå‰å¾€ã€\-&gt; ã€Œå‰å¾€æª”æ¡ˆå¤¾ã€


![](/assets/b04f4fba3cf2/1*JgXWca5hKROuoOgLThkQnw.png)


è²¼ä¸Šä»¥ä¸‹è·¯å¾‘ï¼š
```bash
~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps
```

å°±å¯ä»¥æ‰¾åˆ°ä¸‹è¼‰ä¸‹ä¾†æ­£æº–å‚™è¦å®‰è£çš„ç›®æ¨™ App \.ipa æª”æ¡ˆï¼š


![](/assets/b04f4fba3cf2/1*zV5yWozKqXtwekI33NWwVg.png)


å°‡å…¶è¤‡è£½å‡ºä¾†å³å¯å®Œæˆ App \.ipa æª”æ¡ˆå‚™ä»½ã€‚

å®Œæˆæª”æ¡ˆè¤‡è£½å¾Œå†å›å» Apple Configurator 2 é»æ“Šåœæ­¢ï¼Œçµ‚æ­¢æ“ä½œã€‚
#### \[éª¨\] é‚„åŸ \.ipa App å®‰è£æª”

ä¸€æ¨£æ˜¯å°‡æ¬²é‚„åŸ App çš„æ‰‹æ©Ÿæ¥ä¸Š Mac ä¸¦æ‰“é–‹ Apple Configurator 2ï¼Œé€²å…¥ App åŠ å…¥ä»‹é¢ã€‚


![](/assets/b04f4fba3cf2/1*6miYYw5QL6iqLQqrtHOi2A.png)


é‚„åŸçš„è©±è¦é¸æ“‡å·¦ä¸‹è§’ã€Œå¾æˆ‘çš„ Mac é¸æ“‡â€¦ã€


![](/assets/b04f4fba3cf2/1*7a_25rE2eDpMFZqBC3sP6g.png)


é¸æ“‡å‚™ä»½çš„ App \.ipa æª”æ¡ˆï¼ŒæŒ‰ã€ŒåŠ å…¥ã€ã€‚


![](/assets/b04f4fba3cf2/1*AcGEAuowmvvGRb-E22wu2g.png)


ç­‰å¾…å‚³é€ã€å®‰è£å®Œæˆï¼Œå›åˆ°æ‰‹æ©Ÿä¸Šå°±èƒ½é‡æ–°æ‰“é–‹ Appï¼Œå¾©æ´»æˆåŠŸï¼
#### \[è‚‰\] å‚™ä»½æœ€å¾Œçš„ API Response Data

é€™é‚Šæœƒé‹ç”¨åˆ°ä¹‹å‰åœ¨ [**App End\-to\-End Testing Local Snapshot API Mock Server**](../5a5c4b25a83d/) **æ–‡ç« \(ç´°ç¯€åŸç†å¯åƒè€ƒ\)** ä¸­æ‰€ä½¿ç”¨åˆ°çš„æ–¹å¼è·Ÿç•¶æ™‚å¼„çš„é–‹æºå°ˆæ¡ˆï¼š


[![](https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4)](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"}


åŒä¹‹å‰ç”¨éŒ„è£½ API Request & Response ä¾†è·‘ E2E Testing çš„æŠ€è¡“ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨å®ƒä¾†ç´€éŒ„ App ä¸‹æ¶ã€åœæ©Ÿå‰æœ€å¾Œçš„ API Request & Response Dataã€‚

**1\. å®‰è£ [mitmproxy](https://mitmproxy.org/){:target="_blank"}**
```typescript
brew install mitmproxy
```

mitmproxy æ˜¯ä¸€å¥—é–‹æºçš„ä¸­é–“äººæ”»æ“Šï¼Œç¶²è·¯è«‹æ±‚å—…æ¢å·¥å…·ã€‚

å¦‚æœä½ ä¸ç†Ÿæ‚‰ Mitmproxy ä¸­é–“äººæ”»æ“Šçš„å·¥ä½œåŸç†å¯å…ˆåƒè€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼šã€Œ [APPæœ‰ç”¨HTTPSå‚³è¼¸ï¼Œä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†ã€‚](../46410aaada00/) ã€æˆ– [Mimproxy å®˜æ–¹æ–‡ä»¶](https://docs.mitmproxy.org/stable/overview-getting-started/){:target="_blank"} ã€‚

å¦‚æœæ˜¯ç”¨åœ¨ç´”ç¶²è·¯è«‹æ±‚å—…æ¢ï¼Œç”¨ä¸ç¿’æ…£ mimproxy ä»‹é¢ä¹Ÿå¯ä»¥æ”¹ç”¨ã€Œ [Proxyman](https://proxyman.io/){:target="_blank"} ã€å¯åƒè€ƒä¹‹å‰ [å¦ä¸€ç¯‡æ–‡ç« ](../70a1409b149a/) çš„ç”¨æ³•ã€‚

**2\. å®Œæˆ mitmproxy æ†‘è­‰è¨­å®š**


> _é‡å° HTTPS åŠ å¯†é€£ç·šæˆ‘å€‘éœ€è¦ä½¿ç”¨æ ¹æ†‘è­‰æŠ½æ›é€²è¡Œä¸­é–“äººæ”»æ“Šï¼Œå› æ­¤ç¬¬ä¸€æ¬¡ä½¿ç”¨é ˆå…ˆå®Œæˆæ‰‹æ©Ÿç«¯æ ¹æ†‘è­‰ä¸‹è¼‰èˆ‡å•Ÿç”¨ã€‚_ 





> _\*å¦‚æœæ‚¨çš„ App & API Server æœ‰å¯¦ä½œ SSL Pinning ä¹Ÿéœ€è¦å°‡ Pinning æ†‘è­‰åŠ å…¥åˆ° mitmproxyã€‚_ 




- é¦–å…ˆç¢ºä¿ iPhone æ‰‹æ©Ÿèˆ‡ Mac é›»è…¦æ˜¯é€£æ¥åœ¨ç›¸åŒçš„ç¶²è·¯ç’°å¢ƒ
- è‹¥ç„¡ WiFi é›»è…¦é€£æ¥å¯¦é«”ç¶²è·¯ï¼Œä¹Ÿå¯ä»¥ [æ‰“é–‹ Mac çš„ WiFi åˆ†äº«åŠŸèƒ½](https://applealmond.com/posts/92291){:target="_blank"} è®“æ‰‹æ©Ÿé€£åˆ° Mac çš„ç¶²è·¯


åœ¨ Terminal å•Ÿå‹• `mitmproxy` or `mitmweb` \(Web GUI ç‰ˆ\)ã€‚
```typescript
mitmproxy
```


![](/assets/b04f4fba3cf2/1*xruNW5ZUPNuxVJvKOyPQTA.png)


çœ‹åˆ°é€™ç•«é¢ä»£è¡¨ mitmproxy æœå‹™å·²å•Ÿå‹•ï¼Œç›®å‰æ²’æœ‰æµé‡é€²ä¾†æ‰€ä»¥æ˜¯ç©ºçš„ï¼Œæ›åœ¨é€™å€‹ç•«é¢ä¸è¦é—œé–‰ Terminalã€‚
- åˆ° Mac ç¶²è·¯è¨­å®šæŸ¥çœ‹ Mac çš„ IP ä½å€


å›åˆ°æ‰‹æ©Ÿ WiFi è¨­å®šé»æ“Šã€Œiã€é€²å…¥è©³ç´°è¨­å®šï¼Œæ‰¾åˆ°æœ€ä¸‹æ–¹ã€Œè¨­å®šä»£ç†ä¼ºæœå™¨ã€ï¼š


![](/assets/b04f4fba3cf2/1*zXVilpUXnXakpWib007BPA.png)



![](/assets/b04f4fba3cf2/1*QV6reSNc0AJg7sQa2qiCjQ.png)

- ä¼ºæœå™¨è¼¸å…¥ Mac é›»è…¦çš„ IP ä½å€
- é€£æ¥åŸ è¼¸å…¥ 8080
- å„²å­˜


**åœ¨æ‰‹æ©Ÿä¸Šæ‰“é–‹ Safari è¼¸å…¥ï¼š [http://mitm\.it/](http://mitm.it/){:target="_blank"}**

å¦‚æœå‡ºç¾ï¼š
```kotlin
If you can see this, traffic is not passing through mitmproxy.
```

ä»£è¡¨æ‰‹æ©Ÿçš„ç¶²è·¯ä»£ç†ä¼ºæœå™¨æ²’æœ‰è¨­å®šæˆåŠŸæˆ–æ˜¯ Mac ä¸Šæ²’å•Ÿå‹• `mitmproxy` ã€‚

æ­£å¸¸æƒ…æ³æœƒå‡ºç¾ï¼š


![](/assets/b04f4fba3cf2/1*Ks5IHpi2AoPj4wXu5ZH9VA.png)



> _æ­¤æ™‚åªæœ‰ HTTP æµé‡èƒ½è¢«å—…æ¢ï¼ŒHTTPS æµé‡æœƒå ±éŒ¯ï¼Œæˆ‘å€‘ç¹¼çºŒå¾€ä¸‹è¨­å®šã€‚_ 





ä»£è¡¨é€£æ¥æˆåŠŸï¼Œæˆ‘å€‘æ‰¾åˆ° iOS å€å¡Šé»æ“Šã€ŒGet mimproxy\-ca\-cert\.pemã€


![](/assets/b04f4fba3cf2/1*HvIg0jtUQ5ops519YUA52A.png)



![](/assets/b04f4fba3cf2/1*tU3gi3PBvrbUc-tqKjUD9w.png)

- é»æ“Šã€Œå…è¨±ã€


ä¸‹è¼‰å®Œæˆå¾Œé€²å…¥åˆ°æ‰‹æ©Ÿçš„è¨­å®šï¼Œæœƒå‡ºç¾ã€Œå·²ä¸‹è¼‰æè¿°æª”ã€é»æ“Šé€²å…¥ã€‚


![](/assets/b04f4fba3cf2/1*JzX7U1jCtda915mGz5CPjw.png)



![](/assets/b04f4fba3cf2/1*mWmVPZ-au302NGHXgCxAow.png)



![](/assets/b04f4fba3cf2/1*SMnr82MEIo4YaYOvTpILeQ.png)

- é»æ“Šé€²å…¥ï¼Œå³ä¸Šè§’ã€Œå®‰è£ã€ï¼Œè¼¸å…¥æ‰‹æ©Ÿå¯†ç¢¼å®Œæˆå®‰è£ã€‚


å›åˆ°è¨­å®š \-&gt; ã€Œä¸€èˆ¬ã€\-&gt;ã€Œé—œæ–¼æœ¬æ©Ÿã€\-&gt; æœ€ä¸‹æ–¹ã€Œæ†‘è­‰ä¿¡ä»»è¨­å®šã€\-&gt; å•Ÿç”¨ã€Œmitmproxyã€ã€‚


![](/assets/b04f4fba3cf2/1*UOcYlpOolfWithLb517__g.png)



![](/assets/b04f4fba3cf2/1*LAoe10TplFdfWXEHMRAvWw.png)

- ã€Œç¹¼çºŒã€å®Œæˆå•Ÿç”¨ã€‚


è‡³æ­¤æˆ‘å€‘å°±å®Œæˆä¸­é–“äººæ”»æ“Šæ‰€æœ‰çš„å‰ç½®æº–å‚™å·¥ä½œã€‚


> _è¦è¨˜å¾—ç•¶å‰ä½ æ‰‹æ©Ÿæ‰€æœ‰çš„æµé‡éƒ½æœƒç¶“éä»£ç†å¾ä½ çš„ Mac é›»è…¦å‡ºå»ï¼Œ **æ“ä½œå®Œç•¢è¨˜å¾—å›åˆ°æ‰‹æ©Ÿä¸Šçš„ç¶²è·¯è¨­å®šæŠŠä»£ç†ä¼ºæœå™¨è¨­å®šé—œæ‰** ï¼Œå¦å‰‡æ‰‹æ©Ÿç¶²è·¯ WiFi æœƒå…¨éƒ¨é€£ä¸ä¸Šå°å¤–ç¶²è·¯ã€‚_ 





å›åˆ° Terminal mitmproxyï¼Œä¸€é‚Šæ“åšæ‰‹æ©Ÿä¸Šçš„ App å°±èƒ½çœ‹åˆ°æ‰€æœ‰è¢«æ•æ‰çš„ API è«‹æ±‚ç´€éŒ„ã€‚


![](/assets/b04f4fba3cf2/1*-aRzC2HWRCvGok-L9jbjHA.png)


æ¯å€‹è«‹æ±‚éƒ½èƒ½é€²å…¥æŸ¥çœ‹è©³ç´° Request & Response å…§å®¹ï¼š


![](/assets/b04f4fba3cf2/1*IyO00OEpAadapGKNtOV_Mg.png)


ä»¥ä¸Šæ˜¯ mitmproxy åŸºç¤è¨­å®šèˆ‡å¯¦éš›å·¥ä½œã€‚

**3\. å—…æ¢ã€äº†è§£ API æ¶æ§‹**

å†ä¾†å°±è¦é€é mitmproxy çš„ `mitmdump` æœå‹™çµåˆæˆ‘ä¹‹å‰é–‹ç™¼çš„ [**mitmproxy\-rodo**](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} [addons](https://docs.mitmproxy.org/stable/addons-overview/){:target="_blank"} éŒ„è£½è«‹æ±‚å’Œå›æ”¾è«‹æ±‚ã€‚


> [_æˆ‘çš„å¯¦ç¾åŸç†_](../5a5c4b25a83d/) _æ˜¯å°‡ Request è«‹æ±‚åƒæ•¸è¨ˆç®—æˆ Hash å€¼ï¼Œåœ¨å›æ”¾æ™‚å†æ¬¡å°‡è«‹æ±‚æ‹¿å»è¨ˆç®— Hash å¦‚æœåœ¨æœ¬åœ°æœ‰æ‰¾åˆ°ç›¸åŒ Hash å€¼çš„å‚™ä»½ Response å‰‡è¿”å›ï¼Œå¦‚æœæœ‰å¤šå€‹ç›¸åŒ Hash å€¼çš„è«‹æ±‚æœƒæŒ‰ç…§é †åºå„²å­˜ï¼†å›æ”¾ã€‚_ 





æˆ‘å€‘å¯ä»¥å…ˆé€éä»¥ä¸Šæ–¹æ³•å—…æ¢ App çš„ API \(æˆ–ä½¿ç”¨ [Proxyman](https://proxyman.io/){:target="_blank"} \)ï¼Œè§€å¯Ÿæœ‰å“ªäº›æ¬„ä½è·Ÿå“ªäº›æ¬„ä½å¯èƒ½æœƒå½±éŸ¿ Hash Mappingï¼Œå¯ä»¥å°‡å…¶è¨˜éŒ„ä¸‹ä¾†ï¼Œåœ¨å¾ŒçºŒè¨­å®šæ’é™¤ï¼Œ **ä¾‹å¦‚æœ‰çš„ API å›ºå®šæœƒå¸¶ `?ts` é€™åƒæ•¸ä¸å½±éŸ¿å›å‚³å…§å®¹ï¼Œä½†æœƒå½±éŸ¿ Hash å€¼è¨ˆç®—å°è‡´ç„¡æ³•æ‰¾åˆ°æœ¬åœ°çš„å‚™ä»½ï¼Œæˆ‘å€‘å°±éœ€è¦æŒ‘å‡ºä¾†åœ¨å¾Œé¢çš„è¨­å®šä¸­æ’é™¤æ‰** ã€‚

**4\.è¨­å®š [mitmproxy\-rodo](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} :**

ä½¿ç”¨æˆ‘å¯«å¥½çš„éŒ„è£½ã€å›æ”¾é–‹æº Scriptã€‚


> **_ç´°ç¯€åƒæ•¸è¨­å®šè«‹åƒè€ƒè©²é–‹æºå°ˆæ¡ˆçš„èªªæ˜ã€‚_** 




```bash
git clone git@github.com:ZhgChgLi/mitmproxy-rodo.git
cd mitmproxy-rodo
```

å°‡ä¸Šä¸€æ­¥é©Ÿ 3\. æŒ‘å‡ºä¾†çš„åƒæ•¸å¡«å…¥åˆ° config\.json è¨­å®šæª”æ¡ˆä¸­ï¼š
```json
{
  "ignored": {
    "*": {
      "*": {
        "*": {
          "iterable": false,
          "enables": [
            "query",
            "formData"
          ],
          "rules": {
            "query": {
              "parameters": [
                "ts",
                "connect_id",
                "device_id",
                "device_name",
              ]
            },
            "formData": {
              "parameters": [
                "aidck",
                "device_id",
                "ver_name",
              ]
            }
          }
        }
      }
    }
  }
}
```

ä»¥ä¸Šåƒæ•¸åœ¨è¨ˆç®— Hash å€¼æ™‚éƒ½æœƒè¢«æ’é™¤ï¼Œä¹Ÿèƒ½é‡å°å€‹åˆ¥ Endpoint è·¯å¾‘è¨­å®šç‰¹å®šæ’é™¤è¦å‰‡ã€‚

**5\. å•Ÿç”¨éŒ„è£½ï¼Œåœ¨ Terminal ä¸‹æ”¹åŸ·è¡Œï¼š**
```bash
mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json --set record=true "~d zhgchg.li"
```
- çµå°¾çš„ `"~d zhgchg.li"` æ„æ€æ˜¯åªæˆªå– \* \.zhgchg\.li çš„æµé‡ã€‚
- `dumper_folder` : è¼¸å‡ºç›®çš„ç›®éŒ„åç¨±


**6\. å›åˆ°æ‰‹æ©Ÿä¸Šæ“ä½œç›®æ¨™ App åŸ·è¡Œæ¬²éŒ„è£½çš„æµç¨‹è·¯å¾‘**
- å»ºè­°é‡å•Ÿã€é‡å®‰è£ App ç”¨æœ€ä¹¾æ·¨çš„æ–¹å¼é–‹å§‹æ“ä½œ
- å»ºè­°å¯ä»¥æ­é…éŒ„å½±ï¼Œä»¥åˆ©è¨˜å¾—å¾©ç¾æ­¥é©Ÿ



![](/assets/b04f4fba3cf2/1*SeivG1XaRcd5uq2uMkyrSA.png)


é‚Šæ“ä½œçš„åŒæ™‚ï¼Œå°±èƒ½çœ‹åˆ°è¼¸å‡ºç›®éŒ„æœƒæœ‰å¾ˆå¤šæ“·å–ä¸‹ä¾†çš„ API Response Dataï¼Œæœƒç…§è‘— Domain \-&gt; API è·¯å¾‘ \-&gt; HTTP æ–¹æ³• \-&gt; Hash å€¼ \-&gt; Header\-X / Content\-X å­˜æ”¾\(è‹¥ç›¸åŒ Hash è«‹æ±‚å…©æ¬¡ï¼ŒæœƒæŒ‰ç…§é †åºå„²å­˜ä¸‹ä¾†\)ã€‚
- é‡æ–°éŒ„è£½å¯ä»¥ç›´æ¥åˆªå‡ºè¼¸å‡ºç›®éŒ„ï¼Œè®“ä»–é‡æ–°æ“·å–ã€‚
- **å¦‚æœå›å‚³çš„è³‡æ–™åŒ…å«å€‹è³‡ï¼Œè«‹è¨˜å¾—èª¿æ•´æ“·å–å…§å®¹å»è­˜åˆ¥åŒ–ã€‚**

#### \[è‚‰\] å›æ”¾æ“·å–åˆ°çš„ API Response Data

éŒ„è£½å®Œç•¢å¾Œè«‹å‹™å¿…è¦å˜—è©¦å›æ”¾ä¸€æ¬¡ï¼Œæ¸¬è©¦è³‡æ–™æ˜¯å¦æ­£å¸¸ï¼Œè‹¥ Hash Hit å¾ˆä½\(å›æ”¾æ™‚å¹¾ä¹éƒ½æ²’æ‰¾åˆ°å°æ‡‰çš„ Response\)ï¼Œå¯ä»¥é‡è¤‡å—…æ¢æ­¥é©Ÿæ‰¾åˆ°é‚£å€‹æ¯æ¬¡åŸ·è¡Œ App éƒ½ä¸ç¢ºå®šå½±éŸ¿ Hash å€¼çš„è®Šæ•¸ä¸¦å°‡å…¶æ’é™¤ã€‚

**åŸ·è¡Œå›æ”¾ï¼š**
```bash
mitmdump -s rodo.py --set dumper_folder=zhgchgli --set config_file=config.json
```
- `dumper_folder` : è¼¸å‡ºç›®çš„ç›®éŒ„åç¨±
- é è¨­æœ¬åœ°æ²’æœ‰ Hash Mapping åˆ°çš„ Response Data æœƒç›´æ¥å›å‚³ 404 è®“ App ç©ºç™½ï¼Œé€™æ¨£æ‰èƒ½çŸ¥é“æ“·å–çš„è³‡æ–™æœ‰æ²’æœ‰æ•ˆã€‚



![](/assets/b04f4fba3cf2/1*0Cjy_5RZRq3tvE1Pc0lQ9A.png)



![](/assets/b04f4fba3cf2/1*JKorlo3EBeSWXhB9Exw4ZA.png)

- éŒ„è£½æ“·å–æ™‚æœ‰ç¶“ééçš„è·¯å¾‘é é¢ï¼Œå›æ”¾æ™‚èƒ½é‡æ–°é¡¯ç¤ºï¼šOK\!
- éŒ„è£½æ“·å–æ™‚æ²’ç¶“ééçš„è·¯å¾‘é é¢ï¼Œå›æ”¾æ™‚é¡¯ç¤ºç¶²è·¯éŒ¯èª¤ï¼šOK\!

### ç·¬æ‡·

è‡³æ­¤ï¼Œæˆ‘å€‘å·²ç¶“å¯ä»¥è‡ªè¡Œé€éé‚„åŸéª¨èˆ‡æœ€å¾Œçš„è‚‰ï¼Œä¾†å¾©ç¾ç•¶å¹´ App èµ°é€²çµ‚é»ç«™å‰çš„æœ€å¾Œæ™‚å…‰ï¼Œä»¥æ­¤ç·¬æ‡·é‚£å€‹å¤§å®¶ä¸€èµ·åŒå¿ƒå”åŠ›ç”Ÿç”¢å‡ºä¾†çš„æ™‚å…‰ã€‚

ä»¥æ­¤ç¯‡æ–‡ç« ç´€å¿µç¬¬ä¸€ä»½å·¥ä½œçš„åœ˜éšŠèˆ‡ç•¶å¹´å¾ç¶²é å¾Œç«¯é–‹ç™¼é‚Šåšé‚Šå­¸è½‰è· iOS App é–‹ç™¼ï¼Œç¨ç«‹å¾ç„¡åˆ°æœ‰åœ¨ 3â€“4 å€‹æœˆçš„çŸ­æš«æ™‚é–“ï¼Œèˆ‡ Androidã€è¨­è¨ˆã€PM ä¸»ç®¡ã€å¾Œç«¯åŒäº‹ä¸€åŒé †åˆ©ç”Ÿç”¢å‡ºçš„ç”¢å“ï¼Œé›–ç„¶å®ƒå³å°‡é€²å…¥ç”Ÿå‘½é€±æœŸçš„çµ‚é»ç«™ï¼Œä½†æˆ‘æ°¸é éƒ½æœƒè¨˜å¾—ç•¶å¹´çš„é…¸ç”œè‹¦è¾£èˆ‡ç¬¬ä¸€æ¬¡çœ‹åˆ°ä»–ä¸Šç·šã€æœ‰äººä½¿ç”¨çš„é‚£å€‹æ„Ÿå‹•ã€‚


> ã€Œè¬è¬ã€ 



#### æ­¡è¿å”åŠ©è²¢ç»

å¦‚æœä½ ä¹Ÿæœ‰ç›¸åŒçš„éºæ†¾ï¼Œå¸Œæœ›æœ¬ç¯‡æ–‡ç« ä¹Ÿèƒ½å¹«åŠ©åˆ°ä½ ï¼Œå› ç‚º [mitmproxy\-rodo](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main){:target="_blank"} ç•¶åˆåªæ˜¯ POC æ¦‚å¿µé©—è­‰ä¸‹é–‹ç™¼å‡ºçš„å·¥å…·ï¼Œæ­¡è¿å”åŠ©è²¢ç»ã€æå‡ºé‡åˆ°çš„ Bug æˆ–é–‹ PR ä¿®æ”¹ Bugã€‚


[![](https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4)](https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main?source=post_page-----5a5c4b25a83d--------------------------------){:target="_blank"}



æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-ios-dev/app-%E7%94%A2%E5%93%81%E9%80%B2%E5%85%A5%E7%B5%82%E9%BB%9E%E7%AB%99-%E8%83%BD%E5%81%9A%E4%BB%80%E9%BA%BC%E4%BA%8B%E7%B7%AC%E6%87%B7-b04f4fba3cf2){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
