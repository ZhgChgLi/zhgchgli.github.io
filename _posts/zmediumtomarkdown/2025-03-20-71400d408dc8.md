---
title: "Google Apps Script x Google APIs å¿«é€Ÿä¸²æ¥æ•´åˆæ–¹å¼"
author: "ZhgChgLi"
date: 2025-03-20T14:12:48.523+0000
last_modified_at: 2025-03-20T14:12:48.523+0000
categories: ["ZRealm Robotic Process Automation"]
tags: ["ios-app-development","firebase-app-distribution","google-apps-script","google-api","google-cloud-platform"]
description: "ä»¥ Google Apps Script x Firebase App Distribution API ä¸²æ¥ç‚ºä¾‹"
image:
  path: /assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png
render_with_liquid: false
---

### Google Apps Script x Google APIs å¿«é€Ÿä¸²æ¥æ•´åˆæ–¹å¼

ä»¥ Google Apps Script x Firebase App Distribution API ä¸²æ¥ç‚ºä¾‹

### èƒŒæ™¯

ä¹‹å‰å¯«äº†ä¹‹å‰å¯«äº†å¥½å¹¾ç¯‡é—œæ–¼ä½¿ç”¨ Google Apps Script çš„æ–‡ç« ï¼Œå…¶ä¸­ã€Œ [ä½¿ç”¨ Google Apps Script å¯¦ç¾æ¯æ—¥æ•¸æ“šå ±è¡¨ RPA è‡ªå‹•åŒ–](../f6713ba3fee3/) ã€ã€ã€Œ [ç°¡å–® 3 æ­¥é©Ÿ â€” æ‰“é€ å…è²» GA4 è‡ªå‹•æ•¸æ“šé€šçŸ¥æ©Ÿå™¨äºº](../1e85b8df2348/) ã€ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ Google Apps Script ä¸²æ¥ Google Analytics å’Œ Google Sheet, Web App, Slack, Telegramâ€¦ å¿«é€Ÿå»ºç½®å¯è¦–åŒ–æ•¸æ“šä¸­å°åŠé€šçŸ¥æœå‹™ï¼›å¦å¤–ä¸Šå€‹æœˆç™¼çš„æ–‡ç« ã€Œ [ä½¿ç”¨ Google Apps Script Web App è¡¨å–®ä¸²æ¥ Github Action CI/CD å·¥ä½œ](../4cb4437818f2/) ã€å‰‡æ˜¯ç›´æ¥ä½¿ç”¨ Google Apps Script Web App ä¸²æ¥ Github API ä½œç‚º CI/CD GUI è¡¨å–®æœå‹™ï¼›ä»¥ä¸Šè¦é¦¬æ˜¯ç›´æ¥ä½¿ç”¨ Google Apps Script å…§å»ºçš„æœå‹™é€²è¡Œä¸²æ¥æˆ–æ˜¯ç›´æ¥ä¸²æ¥å¤–éƒ¨æœå‹™ \(Slack, Githubâ€¦\) éƒ½æ²’ç¢°åˆ°éœ€è¦ä¸²æ¥ Google APIs çš„å ´æ™¯ã€‚


> _é€™æ¬¡åœ¨å„ªåŒ– CI/CD GUI è¡¨å–®æ™‚å¸Œæœ›æ‰“åŒ…å…§æ¸¬ç‰ˆå¾Œèƒ½åœ¨ Web App ä¸Šç›´æ¥é¡¯ç¤º Firebase Distribution ä¸‹è¼‰é€£çµï¼Œé€™å¡Šå°±åªèƒ½ä¸²æ¥ Google APIs æ‰èƒ½é”æˆã€‚_ 




#### Google Apps Script x [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"}


![](/assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png)


å¦‚ä¸Šåœ–ï¼Œèˆ‡ä»¥å¾€ä¸²æ¥ Google Analytics æœ‰å…§å»ºæœå‹™ã€ŒAnalyticsDataã€ä¸åŒï¼ŒFirebase App Distribution ä¸¦æ²’æœ‰æä¾›å…§å»ºä¸²æ¥æœå‹™ï¼Œæ‰€ä»¥è¦ç”¨é€²éšæ–¹å¼é€²è¡Œä¸²æ¥ã€‚


> _æœ¬ä¾†ä»¥ç‚ºè¦è‡ªè¡Œä½¿ç”¨ Service Account å®Œæˆ Access Token ç”¢ç”Ÿã€äº¤æ›ï¼ˆæœ‰é»éº»ç…©ï¼Œå¯åƒè€ƒæˆ‘ä¹‹å‰çš„ [è©•åƒ¹æ©Ÿå™¨äººé–‹æºå°ˆæ¡ˆ](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"} ï¼‰ï¼Œ **ä½†å…¶å¯¦ä¸ç”¨é€™éº¼éº»ç…©ã€‚**_ 




### Google Apps Script x Google APIs é€²éšæœå‹™ä¸²æ¥
#### ä¸²æ¥è¨­å®š

**åƒè€ƒ [å®˜æ–¹æ–‡ä»¶æè¿°](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#requirements){:target="_blank"} ï¼Œæˆ‘å€‘éœ€è¦ç…§ä»¥ä¸‹æ­¥é©Ÿé€²è¡Œé€²éšè¨­å®šï¼š**
1. æ‚¨å¿…é ˆåœ¨æŒ‡ä»¤ç¢¼å°ˆæ¡ˆä¸­ [å•Ÿç”¨é€²éšæœå‹™](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#enable_advanced_services){:target="_blank"} ã€‚
2. æ‚¨å¿…é ˆç¢ºèªåœ¨æŒ‡ä»¤ç¢¼ä½¿ç”¨çš„ [Cloud Platform \(GCP\) å°ˆæ¡ˆ](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw){:target="_blank"} ä¸­ï¼Œå·²å•Ÿç”¨å°æ‡‰é€²éšæœå‹™çš„ APIã€‚
3. å¦‚æœæŒ‡ä»¤ç¢¼å°ˆæ¡ˆä½¿ç”¨çš„æ˜¯ 2019 å¹´ 4 æœˆ 8 æ—¥ç•¶å¤©æˆ–ä¹‹å¾Œå»ºç«‹çš„ [é è¨­ GCP å°ˆæ¡ˆ](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#default_cloud_platform_projects){:target="_blank"} ï¼Œæ‚¨å•Ÿç”¨é€²éšæœå‹™ä¸¦å„²å­˜æŒ‡ä»¤ç¢¼å°ˆæ¡ˆå¾Œï¼ŒAPI å°±æœƒè‡ªå‹•å•Ÿç”¨ã€‚å¦‚æœæ‚¨å°šæœªåŒæ„ï¼Œç³»çµ±å¯èƒ½ä¹Ÿæœƒè¦æ±‚æ‚¨åŒæ„ã€Š [Google Cloud](https://cloud.google.com/terms/?hl=zh-tw){:target="_blank"} ã€‹å’Œã€Š [Google API](https://developers.google.com/terms?hl=zh-tw){:target="_blank"} ã€‹æœå‹™æ¢æ¬¾ã€‚
4. å¦‚æœæŒ‡ä»¤ç¢¼å°ˆæ¡ˆä½¿ç”¨ [æ¨™æº– GCP å°ˆæ¡ˆ](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#standard_cloud_platform_projects){:target="_blank"} æˆ–è¼ƒèˆŠçš„é è¨­ GCP å°ˆæ¡ˆï¼Œæ‚¨å¿…é ˆæ‰‹å‹•åœ¨ GCP å°ˆæ¡ˆä¸­ [å•Ÿç”¨é€²éšæœå‹™çš„å°æ‡‰ API](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#enabling_an_api_in_a_standard_gcp_project){:target="_blank"} ã€‚æ‚¨å¿…é ˆå…·å‚™ GCP å°ˆæ¡ˆçš„ç·¨è¼¯æ¬Šé™ï¼Œæ‰èƒ½é€²è¡Œé€™é …è®Šæ›´ã€‚

#### 1\. å°ˆæ¡ˆè¨­å®š â€”è¨­å®šé—œè¯çš„ Google Cloud Platform \(GCP\) å°ˆæ¡ˆ

Google Apps Script x Google APIs é€²éšæœå‹™ä¸²æ¥æœƒéœ€è¦ä½ å»ºç«‹ GCP å°ˆæ¡ˆä¸¦é—œè¯åˆ° Google Apps Scriptï¼ŒGoogle APIs ä½¿ç”¨æ¬Šé™æ˜¯ä¾ç…§ GCP è¨­å®šã€‚

å› æ­¤ä½ éœ€è¦å»ºç«‹ä¸€å€‹ GCP å°ˆæ¡ˆ\(åŒ Firebase GCP å°ˆæ¡ˆäº¦å¯\)ï¼Œè¨˜ä¸‹è³‡è¨Šä¸»é çš„ã€Œ `å°ˆæ¡ˆç·¨è™Ÿ` ã€ä¸¦ç¢ºå®šé€™å€‹ GCP å°ˆæ¡ˆæœ‰å•Ÿç”¨ä½ æƒ³ä½¿ç”¨çš„ Google APIs åŠç•¶å‰ç™»å…¥å¸³è™Ÿæˆ–æ¬²ä½¿ç”¨çš„å¸³è™Ÿæ˜¯æœ‰è©² GCP å°ˆæ¡ˆã€Google APIs æ¬Šé™ã€‚


![](/assets/71400d408dc8/1*-BlhyGAEtkcDRrZ86H2BHg.png)



![](/assets/71400d408dc8/1*fycqt1HNNO9qiu6RZ-WMlw.png)



> **_æœ¬æ–‡ä»¥ã€Œ [Firebase App Distribution API](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} ã€ç‚ºä¾‹ã€‚_** 






![](/assets/71400d408dc8/1*T13M_lq7z-ui0_cLZtuHXg.png)


å°‡ `å°ˆæ¡ˆç·¨è™Ÿ` è¼¸å…¥åˆ° Goolge Apps Script å°ˆæ¡ˆè¨­å®šä¸‹æ–¹çš„ Google Cloud Platform å°ˆæ¡ˆç·¨è™Ÿä¸­ï¼Œç•¶å‰ç™»å…¥å¸³è™Ÿæœ‰è©² GCP å°ˆæ¡ˆæ¬Šé™å°±èƒ½è‡ªå‹•ç¶å®šè¨­å®šæˆåŠŸã€‚
#### 2\. å°ˆæ¡ˆè¨­å®š â€” å•Ÿç”¨ åœ¨ç·¨è¼¯å™¨ä¸­é¡¯ç¤ºã€Œappsscript\.jsonã€è³‡è¨Šæ¸…å–®æª”æ¡ˆ


![](/assets/71400d408dc8/1*YnhdxRSyr_CYB2CFnO_31Q.png)


å•Ÿç”¨å¾Œå›åˆ°ç·¨è¼¯å™¨ï¼Œæª”æ¡ˆåˆ—è¡¨å°±æœƒå‡ºç¾ã€Œ `appsscript.json` ã€è¨­å®šæª”ï¼š


![](/assets/71400d408dc8/1*r8bheyYWj-TX7vFIum2GIQ.png)


ç¢ºä¿ oauthScopes ä¸­åŒ…å«ä»¥ä¸‹å…©å€‹æè¿°è¨­å®šï¼š
```json
  "oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```

å¦‚æœæ²’æœ‰è«‹æ‰‹å‹•è²¼ä¸Šå„²å­˜ã€‚
#### 3\.æ’°å¯«ä¸²æ¥ç¨‹å¼ç¢¼

è¨­å®šå¥½ GCP å°ˆæ¡ˆä¹‹å¾Œæˆ‘å€‘å°±èƒ½é–‹å§‹æ’°å¯«ä¸²æ¥ç¨‹å¼ç¢¼ï¼Œç›´æ¥åƒè€ƒæƒ³ä¸²æ¥çš„ Google APIs å®˜æ–¹æ–‡ä»¶ï¼Œ [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} ï¼š


![](/assets/71400d408dc8/1*N0Zg4TEZQwTTLGCsaTdx8A.png)

```javascript
const project = "projects/[Firebase Project ID]/apps/[Firebase APP ID]"; // è«‹æ›æˆä½ çš„ Project ID & App ID

function debug() {
  const releases = firebaseDistribution("");

  releases.forEach(function(release) {
    // Release Object: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases?hl=zh-tw#Release
    Logger.log(`${release.name} Download URL: ${release.testingUri}`);
  });
}

function firebaseDistribution(releaseNote) {
  const url = "https://firebaseappdistribution.googleapis.com/v1/"+project+"/releases?filter=releaseNotes.text%3D*"+releaseNote+"*";
  // Filter: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases/list?hl=zh-tw
  const headers = {
    "Content-Type": "application/json; charset=UTF-8",
    "Authorization": "Bearer " + ScriptApp.getOAuthToken(), // ç›´æ¥ä½¿ç”¨ç•¶å‰å¸³è™Ÿæ›å–æ¬Šæ–
  };
  
  const options = {
    "method": "get",
    "headers": headers
  };
  const data = UrlFetchApp.fetch(url, options);
  const result = JSON.parse(data.getContentText()).releases;
  
  if (result == undefined) {
    return [];
  }

  return result;
}
```

`[Firebase Project ID]` **èˆ‡ `[Firebase APP ID]` å¯åœ¨ Firebase å°ˆæ¡ˆè¨­å®šä¸­å–å¾—ï¼š**


![](/assets/71400d408dc8/1*oql_FnmO7_ct8S3cOhP8lg.png)


è²¼ä¸Šç¨‹å¼ç¢¼å¾Œï¼Œç¬¬ä¸€æ¬¡åŸ·è¡Œéœ€è¦å®Œæˆæ¬Šé™æˆæ¬Šã€‚


![](/assets/71400d408dc8/1*sW3ZjQA3dKS8HhAOCDsmBA.png)



![](/assets/71400d408dc8/0*p-Zl0cob4mPrsNO6.png)

- é»æ“Šã€Œå¯©æŸ¥æ¬Šé™ã€
- é¸æ“‡è¦åŸ·è¡Œçš„èº«ä»½å¸³æˆ¶ï¼Œé€šå¸¸ç­‰æ–¼ç•¶å‰ Google Apps Script å¸³æˆ¶



![](/assets/71400d408dc8/0*m7enb51ZiNlWYeoT.png)



![](/assets/71400d408dc8/0*SN-0owiePlKXIxLk.png)

- é¸æ“‡ã€Œé€²éšã€å±•é–‹ \-&gt; é»æ“Šã€Œå‰å¾€ XXXã€
é€™æ˜¯æˆ‘å€‘è‡ªå·±å¯«çµ¦è‡ªå·±ç”¨çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä¸éœ€ç¶“é Google é©—è­‰ã€‚
- é»æ“Šã€Œå…è¨±ã€



> _ä»¥ä¸Šç•«é¢ä¸ä¸€å®šæœƒå‡ºç¾ï¼Œæ²’æœ‰å¯å¿½ç•¥ã€‚_ 





**å…è¨±ä¹‹å¾Œå†é»ã€ŒåµéŒ¯ã€æˆ–ã€ŒåŸ·è¡Œã€å°±èƒ½åŸ·è¡Œç¨‹å¼ï¼š**

å¦‚æœå‡ºç¾éŒ¯èª¤ï¼š
```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 403. Truncated server response: {
  "error": {
    "code": 403,
    "message": "Request had insufficient authentication scopes.",
    "status": "PERMISSION_DENIED",
    "details":... (use muteHttpExceptions option to examine full response)
...
```

æˆ–
```
Exception: Specified permissions are not sufficient to call UrlFetchApp.fetch. Required permissions: https://www.googleapis.com/auth/script.external_request
```

è«‹ç¢ºèª `appsscript.json` çš„ oauthScopes ä¸­åŒ…å«ä»¥ä¸‹å…©å€‹æè¿°è¨­å®š\(åƒè€ƒæ­¥é©Ÿ 2\)ï¼š
```json
"oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```

å¦‚æœå‡ºç¾éŒ¯èª¤ï¼š
```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 401. Truncated server response: {
  "error": {
    "code": 401,
    "message": "Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or othe... (use muteHttpExceptions option to examine full response)
```

ä»£è¡¨å°šæœªè¨­å®šç¶å®šçš„ GCP å°ˆæ¡ˆ \(åƒè€ƒæ­¥é©Ÿ 1\. \) æˆ–æ˜¯è©² GCP å°ˆæ¡ˆå°šæœªå•Ÿç”¨æ¬²ä½¿ç”¨çš„ Google APIs æˆ–æ˜¯ç•¶å‰å¸³è™Ÿç„¡è©² GCP / Google APIs ä½¿ç”¨æ¬Šé™æˆ–ç„¡è©² Firebase App æ¬Šé™ï¼Œè«‹æª¢æŸ¥è¨­å®šã€‚

å¦‚æœå‡ºç¾éŒ¯èª¤ï¼š
```
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 404. Truncated server response:
```

æˆ–
```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 400. Truncated server response: {
  "error": {
    "code": 400,
    "message": "Request contains an invalid argument.",
    "status": "INVALID_ARGUMENT"
  }
}
```

è«‹ç¢ºèª Google APIs è«‹æ±‚è·¯å¾‘æ˜¯å¦æ­£ç¢ºã€‚
#### ä¸²æ¥æˆåŠŸğŸ‰ğŸ‰ğŸ‰


![](/assets/71400d408dc8/1*9OyoPtblFnGGIBRvlGw10Q.png)


å¯ä»¥çœ‹åˆ°çŸ­çŸ­ä¸åˆ° 10 è¡Œç¨‹å¼ç¢¼å°±èƒ½ç„¡ç—›ä¸²æ¥ Google APIsï¼ŒçœŸçš„éå¸¸æ–¹ï¼›æœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸€ä¸‹ç›¸è¼ƒä¹‹ä¸‹ï¼Œ [è‡ªå·±å¯¦ä½œ](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"} Google APIs ä¸²æ¥æ™‚èº«ä»½é©—è­‰æ¬Šæ–äº¤æ›çš„ç¨‹å¼æ­¥é©Ÿï¼Œéå¸¸ç¹ç‘£ã€‚
#### ä¸‹ä¸€æ­¥ï¼š

æ­é…ä¹‹å‰çš„æ–‡ç« ã€Œ [ä½¿ç”¨ Google Apps Script Web App è¡¨å–®ä¸²æ¥ Github Action CI/CD å·¥ä½œ](../4cb4437818f2/) ã€ä¸²ä¸Š CI/CD å·¥ä½œé …ç›®ï¼Œå°‡ Firebase App Distribution ä¸‹è¼‰é€£çµä¹Ÿå‘ˆç¾åœ¨ Web App ä¸Šæ–¹ä¾¿åŒä»ç›´æ¥åœ¨ä¸Šé¢ä¸‹è¼‰ã€‚


![Demo Result](/assets/71400d408dc8/1*nK3H3e3KgHEg8qz-KZ9ZGA.png)

Demo Result


> _å…¶ä»– Google APIs ä¹Ÿèƒ½ä»¥æ­¤é¡æ¨ä¸²æ¥ã€‚_ 






æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-robotic-process-automation/google-apps-script-x-google-apis-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F-71400d408dc8){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
