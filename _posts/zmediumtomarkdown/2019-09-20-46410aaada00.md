---
title: APPæœ‰ç”¨HTTPSå‚³è¼¸ï¼Œä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†ã€‚
author: ZhgChgLi
date: 2019-09-20T10:01:01.345+0000
last_modified_at: 2021-08-07T12:34:43.834+0000
categories: ZRealm Dev.
tags: [mitmproxy,man-in-the-middle,ios,ios-app-development,hacking]
description: iOS+MacOS ä½¿ç”¨ mitmproxy é€²è¡Œä¸­é–“äººæ”»æ“Š(Man-in-the-middle attack) å—…æ¢APIå‚³è¼¸è³‡æ–™
image:
  path: /assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png
render_with_liquid: false
---

### APPæœ‰ç”¨HTTPSå‚³è¼¸ï¼Œä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†ã€‚

iOS\+MacOS ä½¿ç”¨ mitmproxy é€²è¡Œä¸­é–“äººæ”»æ“Š\(Man\-in\-the\-middle attack\) å—…æ¢APIå‚³è¼¸è³‡æ–™æ•™å­¸åŠå¦‚ä½•é˜²ç¯„ï¼Ÿ
### å‰è¨€

å‰é™£å­å‰›åœ¨å…¬å¸è¾¦å®Œä¸€å ´å…§éƒ¨çš„ [CTFç«¶è³½](../729d7b6817a4/) ï¼Œåœ¨ç™¼æƒ³é¡Œç›®æ™‚å›æƒ³èµ·å¤§å­¸æ™‚å€™é‚„åœ¨åšå¾Œç«¯\(PHP\)æ™‚ç¶“æ‰‹çš„å°ˆæ¡ˆï¼Œä¸€å€‹é›†é»çš„APPï¼Œå¤§æ¦‚å°±æ˜¯æœ‰å€‹ä»»å‹™åˆ—è¡¨ï¼Œç„¶å¾Œè§¸ç™¼æ¢ä»¶å®Œæˆå°±Call APIç²å¾—é»æ•¸ï¼›è€é—†èªç‚ºCall APIæœ‰ç¶“éHTTPSåŠ å¯†å‚³è¼¸è³‡æ–™å°±å¾ˆå®‰å…¨äº† â€” ç›´åˆ°æˆ‘å‘ä»–å±•ç¤ºä¸­é–“äººæ”»æ“Šï¼Œç›´æ¥å—…æ¢å‚³è¼¸è³‡æ–™ï¼Œå½é€ APIå‘¼å«ç²å¾—é»æ•¸â€¦\.

å†åŠ ä¸Šæœ€è¿‘å¹¾å¹´å¤§æ•¸æ“šå´›èµ·ï¼Œç¶²è·¯çˆ¬èŸ²æ»¿å¤©é£›ï¼›çˆ¬èŸ²æ”»é˜²æˆ°æ—¥æ¼¸ç™½ç†±åŒ–ï¼Œ [çˆ¬å–èˆ‡é˜²çˆ¬ä¹‹é–“èŠ±æ‹›ç™¾å‡º](https://coolcao.com/2018/06/09/tips-of-anti-spider-in-fe/){:target="_blank"} ï¼Œåªèƒ½èªªé“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆå•Šï¼

çˆ¬èŸ²çš„å¦ä¸€æ¢ä¸‹æ‰‹å°è±¡å°±æ˜¯APPçš„APIï¼Œå¦‚æœæ²’æœ‰ä»»ä½•é˜²ç¯„å¹¾ä¹ç­‰æ–¼é–€æˆ¶å¤§é–‹ï¼›ä¸ä½†å¥½æ“ä½œè€Œä¸”æ ¼å¼ä¹Ÿä¹¾æ·¨ï¼Œæ›´ä¸å®¹æ˜“è¢«è­˜åˆ¥é˜»æ“‹ï¼›æ‰€ä»¥å¦‚æœç¶²é ç«¯å·²ç¶“è²»ç›¡å…¨åŠ›é˜»æ“‹ï¼Œè³‡æ–™é‚„æ˜¯ä¸æ®µè¢«çˆ¬ï¼Œä¸å¦¨æª¢æŸ¥ä¸€ä¸‹APPçš„APIæœ‰ç„¡æ¼æ´ã€‚

å› ç‚ºé€™å€‹è­°é¡Œæˆ‘ä¸çŸ¥é“è©²å¦‚ä½•å‡ºåœ¨ CTFæ¯”è³½ä¸­ ï¼Œæ‰€ä»¥å°±å–®æ‹‰å‡ºä¸€ç¯‡æ–‡ç« ä½œç‚ºç´€éŒ„ ï¼›æœ¬ç¯‡åªæ˜¯ç²—æ·ºçµ¦å€‹æ¦‚å¿µ â€” [HTTPSèƒ½é€éæ†‘è­‰æ›¿æ›é€²è¡Œå‚³è¼¸å…§å®¹è§£å¯†](http://www.aqee.net/post/man-in-the-middle-attack.html){:target="_blank"} ã€å¦‚ä½•åŠ å¼·å®‰å…¨æ€§é˜²æ­¢ï¼›å¯¦éš›ç¶²è·¯ç†è«–ä¸æ˜¯æˆ‘çš„å¼·é …ä¹Ÿéƒ½é‚„çµ¦è€å¸«äº†ï¼Œå¦‚æœå·²ç¶“æœ‰é€™æ–¹é¢æ¦‚å¿µçš„æœ‹å‹å°±ä¸ç”¨èŠ±æ™‚é–“çœ‹é€™ç¯‡ï¼Œæˆ–æ‹‰åˆ°åº•çœ‹APPè©²å¦‚æœä¿è­·ï¼
### å¯¦éš›æ“ä½œ

ç’°å¢ƒ: MacOS \+ iOS


> _Android ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä¸‹è¼‰ [Packet Capture](https://play.google.com/store/apps/details?id=app.greyshirts.sslcapture&hl=en){:target="_blank"} \(å…è²»\)ã€iOS ç”¨æˆ¶å¯ä½¿ç”¨ [Surge 4](https://apps.apple.com/us/app/surge-3/id1442620678){:target="_blank"} é€™å¥—è»Ÿé«”\( **ä»˜è²»\)** è§£é–ä¸­é–“äººæ”»æ“ŠåŠŸèƒ½ã€MacOSä¹Ÿå¯ä»¥ä½¿ç”¨å¦ä¸€å¥—ä»˜è²»è»Ÿé«”Charlesã€‚_ 
 

> _æœ¬æ–‡ç« ä¸»è¦è¬›è§£iOSä½¿ç”¨ **å…è²»** çš„ mitmproxy é€²è¡Œæ“ä½œï¼Œå¦‚æœæ‚¨æœ‰ä¸Šè¿°çš„ç’°å¢ƒå°±ä¸ç”¨é€™éº¼éº»ç…©å•¦ï¼Œç›´æ¥APPæ‰“é–‹åœ¨æ‰‹æ©Ÿä¸Šæ›è¼‰VPNæ›¿æ›æ‰æ†‘è­‰å°±èƒ½é€²è¡Œä¸­é–“äººæ”»æ“Šï¼\(ã„§æ¨£è«‹ç›´æ¥ä¸‹æ‹‰åˆ°åº•çœ‹è©²å¦‚ä½•ä¿è­·ï¼\)_ 





**\[2021/02/25 æ›´æ–°\]ï¼š** Mac æœ‰æ–°çš„å…è²»åœ–å½¢åŒ–ä»‹é¢ç¨‹å¼ \( [Proxyman](https://proxyman.io/){:target="_blank"} \) å¯ä»¥ç”¨ï¼Œå¯æ­é… [åƒè€ƒæ­¤ç¯‡æ–‡ç« ](../70a1409b149a/) çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚
#### å®‰è£ [mitmproxy](https://mitmproxy.org){:target="_blank"}

**ç›´æ¥ä½¿ç”¨ brew å®‰è£** ï¼š
```
brew install mitmproxy
```

**å®‰è£å®Œæˆ\!**

_p\.s å¦‚æœä½ å‡ºç¾ brew: command not found è«‹å…ˆå®‰è£ [brew](https://brew.sh/index_zh-tw){:target="_blank"} å¥—ä»¶ç®¡ç†å·¥å…·_ ï¼š
```
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```
#### mitmproxy ä½¿ç”¨

å®‰è£å®Œæˆå¾Œï¼Œåœ¨ Terminal è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å•Ÿç”¨ï¼š
```
mitmproxy
```


![å•Ÿå‹•æˆåŠŸ](/assets/46410aaada00/1*VTtl6EUMOTV4oRNUjRQHNg.png)

å•Ÿå‹•æˆåŠŸ
#### è®“æ‰‹æ©Ÿè·ŸMacåœ¨åŒå€‹å€åŸŸç¶²è·¯å…§&å–å¾—Macçš„IPä½å€

æ–¹æ³•\(1\) Mac é€£æ¥ WiFiã€æ‰‹æ©Ÿä¹Ÿä½¿ç”¨åŒå€‹ WiFi
**Macçš„IPä½å€ =** ã€Œç³»çµ±åå¥½è¨­å®šã€\->ã€Œç¶²è·¯ã€\->ã€ŒWi\-Fiã€\->ã€ŒIP Addressã€

æ–¹æ³•\(2\) Mac ä½¿ç”¨æœ‰ç·šç¶²è·¯ï¼Œé–‹å•Ÿç¶²è·¯åˆ†äº«ï¼›æ‰‹æ©Ÿé€£ä¸Šè©²ç†±é»ç¶²è·¯:


![ã€Œç³»çµ±åå¥½è¨­å®šã€\-> ã€Œå…±äº«ã€\->é¸æ“‡ã€Œä¹™å¤ªç¶²è·¯ã€\->ã€ŒWi\-Fiã€æ‰“å‹¾\-> ã€ŒInternet å…±äº«ã€å•Ÿç”¨](/assets/46410aaada00/1*R9fthpHlrWzTh4R3fEwO5Q.gif)

ã€Œç³»çµ±åå¥½è¨­å®šã€\-> ã€Œå…±äº«ã€\->é¸æ“‡ã€Œä¹™å¤ªç¶²è·¯ã€\->ã€ŒWi\-Fiã€æ‰“å‹¾\-> ã€ŒInternet å…±äº«ã€å•Ÿç”¨

**Macçš„IPä½å€ = 192\.168\.2\.1** ï¼ˆï¸ï¸æ³¨æ„âš ï¸ ä¸æ˜¯ä¹™å¤ªç¶²è·¯ç¶²è·¯çš„IPï¼Œæ˜¯Macç”¨åšç¶²è·¯åˆ†äº«åŸºåœ°å°çš„IP\)
#### æ‰‹æ©Ÿç¶²è·¯è¨­ç½®WiFi â€” Proxyä¼ºæœå™¨è³‡è¨Š


![ã€Œè¨­å®šã€\-> ã€ŒWiFiã€\-> ã€ŒHTTP ä»£ç†ä¼ºæœå™¨ã€\-> ã€Œæ‰‹å‹•ã€\-> ã€Œä¼ºæœå™¨è¼¸å…¥ **Macçš„IPä½å€** ã€\-> ã€Œé€£æ¥åŸ è¼¸å…¥ **8080** ã€\-> ã€Œå„²å­˜ã€](/assets/46410aaada00/1*ziIFrGQaMr2kYrQHwLYNJg.jpeg)

ã€Œè¨­å®šã€\-> ã€ŒWiFiã€\-> ã€ŒHTTP ä»£ç†ä¼ºæœå™¨ã€\-> ã€Œæ‰‹å‹•ã€\-> ã€Œä¼ºæœå™¨è¼¸å…¥ **Macçš„IPä½å€** ã€\-> ã€Œé€£æ¥åŸ è¼¸å…¥ **8080** ã€\-> ã€Œå„²å­˜ã€


> _é€™æ™‚ç¶²é æ‰“ä¸é–‹ã€å‡ºç¾æ†‘è­‰éŒ¯èª¤æ˜¯æ­£å¸¸çš„ï¼›æˆ‘å€‘ç¹¼çºŒå¾€ä¸‹åšâ€¦_ 




#### å®‰è£ mitmproxy è‡ªè¨‚ https æ†‘è­‰

å¦‚åŒä¸Šè¿°æ‰€èªªï¼Œä¸­é–“äººæ”»æ“Šçš„å¯¦ç¾æ–¹å¼å°±æ˜¯åœ¨é€šè¨Šä¹‹ä¸­ä½¿ç”¨è‡ªå·±çš„æ†‘è­‰åšæŠ½æ›åŠ è§£å¯†è³‡æ–™ï¼›æ‰€ä»¥æˆ‘å€‘ä¹Ÿè¦åœ¨æ‰‹æ©Ÿä¸Šå®‰è£é€™å€‹è‡ªè¨‚çš„æ†‘è­‰ã€‚

**1\.ç”¨æ‰‹æ©Ÿsafariæ‰“é–‹ [http://mitm\.it](http://mitm.it){:target="_blank"}**


![å‡ºç¾å·¦é‚Š\->Proxyè¨­å®šâœ…/ å‡ºç¾å³é‚Šä»£è¡¨ Proxyè¨­å®šæœ‰èª¤ğŸš«](/assets/46410aaada00/1*BuvCYx9WRzG0ECO3H_BS0A.jpeg)

å‡ºç¾å·¦é‚Š\->Proxyè¨­å®šâœ…/ å‡ºç¾å³é‚Šä»£è¡¨ Proxyè¨­å®šæœ‰èª¤ğŸš«


![ã€ŒAppleã€\->ã€Œå®‰è£æè¿°æª”ã€\->ã€Œå®‰è£ã€](/assets/46410aaada00/1*qKDHxi9HxUP41oDJahBfBA.jpeg)

ã€ŒAppleã€\->ã€Œå®‰è£æè¿°æª”ã€\->ã€Œå®‰è£ã€


> _âš ï¸åˆ°é€™è£¡é‚„æ²’çµæŸï¼Œæˆ‘å€‘é‚„è¦å»é—œæ–¼è£¡å•Ÿç”¨æè¿°æª”_ 






![ã€Œä¸€èˆ¬ã€\->ã€Œé—œæ–¼ã€\->ã€Œæ†‘è­‰ä¿¡ä»»è¨­å®šã€\->ã€Œmitmproxyã€å•Ÿç”¨](/assets/46410aaada00/1*mOijblpQepazFPIwob4r8Q.jpeg)

ã€Œä¸€èˆ¬ã€\->ã€Œé—œæ–¼ã€\->ã€Œæ†‘è­‰ä¿¡ä»»è¨­å®šã€\->ã€Œmitmproxyã€å•Ÿç”¨

**å®Œæˆï¼é€™æ™‚æˆ‘å€‘å†å›å»ç€è¦½å™¨å°±èƒ½æ­£å¸¸ç€è¦½ç¶²é äº†ã€‚**
#### å›åˆ°Mac ä¸Šæ“ä½œ mitmproxy


![å¯ä»¥åœ¨mitmproxy Terminalä¸Šçœ‹åˆ°å‰›æ‰‹æ©Ÿçš„è³‡æ–™å‚³è¼¸ç´€éŒ„](/assets/46410aaada00/1*kiEPaTm5bhnFLBfQngQPgA.png)

å¯ä»¥åœ¨mitmproxy Terminalä¸Šçœ‹åˆ°å‰›æ‰‹æ©Ÿçš„è³‡æ–™å‚³è¼¸ç´€éŒ„


![æ‰¾åˆ°æƒ³å—…æ¢çš„ç´€éŒ„é€²å…¥æŸ¥çœ‹Request\(é€å‡ºå“ªäº›åƒæ•¸\)/Response\(å›å‚³äº†ä»€éº¼å…§å®¹\)](/assets/46410aaada00/1*5I6l9cO3LeXfcwGLpWGKPQ.gif)

æ‰¾åˆ°æƒ³å—…æ¢çš„ç´€éŒ„é€²å…¥æŸ¥çœ‹Request\(é€å‡ºå“ªäº›åƒæ•¸\)/Response\(å›å‚³äº†ä»€éº¼å…§å®¹\)
#### å¸¸ç”¨æ“ä½œæŒ‰éµé›†ï¼š
```
ã€Œ ? ã€= æŸ¥çœ‹æŒ‰éµæ“ä½œé›†æ–‡æª”
ã€Œ k ã€/ã€Œâ¬†ã€= ä¸Š 
ã€Œ j ã€/ã€Œâ¬‡ã€= ä¸‹ 
ã€Œ h ã€/ã€Œâ¬…ã€= å·¦ 
ã€Œ l ã€/ã€Œâ¡ï¸ã€ï¸= å³ 
ã€Œ space ã€= ä¸‹ä¸€é 
ã€Œ enter ã€= é€²å…¥æŸ¥çœ‹è©³æƒ…
ã€Œ q ã€= è¿”å›ä¸Šä¸€é /é€€å‡º
ã€Œ b ã€= åŒ¯å‡ºresponse bodyåˆ°æŒ‡å®špathæ–‡å­—æª” 
ã€Œ f ã€= ç¯©é¸ç´€éŒ„æ¢ä»¶
ã€Œ z ã€= æ¸…é™¤æ‰€æœ‰ç´€éŒ„
ã€Œ e ã€= ç·¨è¼¯Request(cookieã€headersã€params...)
ã€Œ r ã€= é‡æ–°ç™¼é€Request
```
#### ä¸ç¿’æ…£CLI? æ²’é—œä¿‚ï¼Œå¯ä»¥æ”¹ç”¨ Web GUI \!

é™¤äº† mitmproxy å•Ÿç”¨æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘å€‘å¯ä»¥æ”¹ä¸‹ï¼š
```
mitmweb
```

å°±èƒ½ä½¿ç”¨æ–°çš„ Web GUI é€²è¡Œæ“ä½œè§€å¯Ÿ


![mitmweb](/assets/46410aaada00/1*Stbf8gUk8iXwNkozOKyOjA.png)

mitmweb
#### é‡é ­æˆ²ï¼Œå—…æ¢APPè³‡æ–™ï¼š

ä¸Šè¿°ç’°å¢ƒéƒ½å»ºç½®å®Œæˆä¹Ÿç†Ÿæ‚‰ä¹‹å¾Œï¼Œå°±å¯ä»¥é€²å…¥æˆ‘å€‘çš„é‡é ­æˆ²ï¼›å—…æ¢APP APIçš„è³‡æ–™å‚³è¼¸å…§å®¹ï¼


> _é€™é‚Šä»¥æŸæˆ¿å±‹APPä½œç‚ºç¯„ä¾‹ï¼Œç„¡æƒ¡æ„ç´”å­¸è¡“äº¤æµä½¿ç”¨\!_ 






> _æˆ‘å€‘æƒ³çŸ¥é“ç‰©ä»¶åˆ—è¡¨çš„APIæ˜¯å¦‚ä½•è«‹æ±‚å’Œå›å‚³ä»€éº¼å…§å®¹\!_ 





![é¦–å…ˆå…ˆæŒ‰ã€Œzã€æ¸…é™¤æ‰€æœ‰ç´€éŒ„\(é¿å…æäº‚\)](/assets/46410aaada00/1*HKppSomeMK5U3Z0kbaRvkQ.png)

é¦–å…ˆå…ˆæŒ‰ã€Œzã€æ¸…é™¤æ‰€æœ‰ç´€éŒ„\(é¿å…æäº‚\)


![é–‹å•Ÿç›®æ¨™ APP](/assets/46410aaada00/1*mpNLXzUwb7-jiikrHkoTcA.png)

é–‹å•Ÿç›®æ¨™ APP

é–‹å•Ÿç›®æ¨™ APP å˜—è©¦ã€Œä¸‹æ‹‰é‡æ•´ã€æˆ–è§¸ç™¼ã€Œè¼‰å…¥ä¸‹ä¸€é ã€çš„å‹•ä½œã€‚


> **_ğŸ›‘è‹¥ä½ çš„ç›®æ¨™APPæ‰“ä¸é–‹ã€é€£ä¸ä¸Šï¼›é‚£æŠ±æ­‰äº†ï¼Œä»£è¡¨APPæœ‰åšé˜²ç¯„ç„¡æ³•ç”¨é€™æ‹›å—…æ¢ï¼Œè«‹ç›´æ¥ä¸‹æ‹‰åˆ°å¦‚ä½•ä¿è­·çš„ç« ç¯€ğŸ›‘_** 






![mitmproxy ç´€éŒ„](/assets/46410aaada00/1*KOkJugn95bcUCPl-dZEaRA.png)

mitmproxy ç´€éŒ„

å›åˆ° mitmproxy æŸ¥çœ‹ç´€éŒ„ï¼Œç™¼æ®åµæ¢çš„ç²¾ç¥çŒœæ¸¬å“ªå€‹APIè«‹æ±‚ç´€éŒ„æ˜¯æˆ‘å€‘æƒ³è¦çš„ä¸¦é€²å…¥æŸ¥çœ‹è©³ç´°ï¼


![Request](/assets/46410aaada00/1*n6mUgej-2_U8PRUbQo_j1g.png)

Request

Request éƒ¨åˆ†å¯ä»¥çœ‹åˆ° è«‹æ±‚å‚³éäº†å“ªäº›åƒæ•¸

æ­é…ã€Œeã€ç·¨è¼¯èˆ‡ã€Œrã€é‡æ–°ç™¼é€ï¼Œä¸¦è§€å¯Ÿ Response å°±å¯ä»¥çŒœåˆ°æ¯å€‹åƒæ•¸çš„ç”¨é€”å›‰ï¼


![Response](/assets/46410aaada00/1*zxdLiXMP-KapoEYou_TlZg.png)

Response

Response ä¹Ÿèƒ½ç›´æ¥ç²å¾—åŸå§‹å›å‚³å…§å®¹ã€‚


> **_ğŸ›‘è‹¥Responseå…§å®¹æ˜¯ä¸€å †ç·¨ç¢¼ï¼›é‚£ä¹ŸæŠ±æ­‰äº†ï¼Œä»£è¡¨APPå¯èƒ½æœ‰è‡ªå·±å†åšä¸€æ¬¡åŠ è§£å¯†ç„¡æ³•ç”¨é€™æ‹›å—…æ¢ï¼Œè«‹ç›´æ¥ä¸‹æ‹‰åˆ°å¦‚ä½•ä¿è­·çš„ç« ç¯€ğŸ›‘_** 





å¾ˆé›£é–±è®€ï¼Ÿä¸­æ–‡äº‚ç¢¼ï¼Ÿæ²’é—œä¿‚ï¼Œé€™é‚Šå¯ä»¥ç”¨ã€Œbã€åŒ¯å‡ºæˆæ–‡å­—æª”åˆ°æ¡Œé¢ï¼Œå†å°‡å…§å®¹è¤‡è£½åˆ° [Json Editor Online](https://jsoneditoronline.org/){:target="_blank"} è§£æå³å¯\!


![](/assets/46410aaada00/1*7qOTLAIQHH6V782OnvFVFQ.png)



> **_\*æˆ–æ˜¯ç›´æ¥ä½¿ç”¨ mitmweb ä½¿ç”¨ web gui ç›´æ¥ç€è¦½ã€æ“ä½œ_** 






![mitmweb](/assets/46410aaada00/1*ujOlDBdjp8tECeAwRzWRPw.png)

mitmweb

ç¶“éå—…æ¢ã€è§€å¯Ÿã€éæ¿¾ã€æ¸¬è©¦ä¹‹å¾Œå°±èƒ½çŸ¥é“APP APIçš„é‹ä½œæ–¹å¼ï¼Œè—‰æ­¤å°±èƒ½åˆ©ç”¨ï¼Œç”¨çˆ¬èŸ²çˆ¬å–è³‡æ–™ã€‚


> _\*è’é›†å®Œæ‰€éœ€è³‡è¨Šè¨˜å¾—é—œé–‰mitmproxyã€æ‰‹æ©Ÿç¶²è·¯Proxyä»£ç†ä¼ºæœå™¨æ”¹å›è‡ªå‹•ï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ç¶²è·¯ã€‚_ 




### APP è©²å¦‚ä½•è‡ªä¿ï¼Ÿ

è‹¥æ›ä¸Š mitmproxy ä¹‹å¾Œç™¼ç¾APPä¸èƒ½ç”¨ã€å›å‚³å…§å®¹æ˜¯ç·¨ç¢¼ï¼Œä»£è¡¨APPæœ‰åšä¿è­·ã€‚

**åšæ³•\(1\):**

å¤§ç•¥æ˜¯å°‡æ†‘è­‰è³‡è¨Šæ”¾ä¸€ä»½åˆ°APPä¸­ï¼Œè‹¥ç•¶å‰HTTPSä½¿ç”¨çš„æ†‘è­‰èˆ‡APPä¸­çš„è³‡è¨Šä¸ç¬¦å‰‡æ‹’çµ•è¨ªå•ï¼Œè©³ç´°å¯ä»¥ [çœ‹æ­¤](https://www.anquanke.com/post/id/147090){:target="_blank"} æˆ–æ‰¾ [SSL Pinning](https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc){:target="_blank"} ç›¸é—œè³‡æºã€‚ç¼ºé»å¯èƒ½å°±æ˜¯è¦æ³¨æ„æ†‘è­‰æœ‰æ•ˆæœŸçš„å•é¡Œå§ï¼


![[https://medium\.com/@dzungnguyen\.hcm/ios\-ssl\-pinning\-bffd2ee9efc](https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc){:target="_blank"}](/assets/46410aaada00/1*31rODDIlYPidTP3L8W_C7A.jpeg)

[https://medium\.com/@dzungnguyen\.hcm/ios\-ssl\-pinning\-bffd2ee9efc](https://medium.com/@dzungnguyen.hcm/ios-ssl-pinning-bffd2ee9efc){:target="_blank"}

**ä½œæ³•\(2\):**

APPç«¯åœ¨è³‡æ–™è¦å‚³è¼¸å‰å…ˆé€²è¡Œç·¨ç¢¼åŠ å¯†ï¼ŒAPIå¾Œç«¯æ”¶åˆ°å¾Œè§£å¯†å–å¾—åŸå§‹è«‹æ±‚å…§å®¹ï¼›APIå›å‚³å…§å®¹ä¸€æ¨£å…ˆé€²è¡Œç·¨ç¢¼åŠ å¯†ï¼ŒAPPç«¯æ”¶åˆ°è³‡æ–™å¾Œè§£å¯†å–å¾—å›å‚³å…§å®¹ï¼›æ­¥é©Ÿå¾ˆç…©ç‘£ä¹Ÿè€—æ•ˆèƒ½ï¼Œä½†çš„ç¢ºæ˜¯å€‹æ–¹æ³•ï¼›æ“šæˆ‘æ‰€çŸ¥å¥½åƒæŸæ•¸å­—éŠ€è¡Œå°±æ˜¯ç”¨é€™æ‹›é€²è¡Œä¿è­·\!
#### ä¸éâ€¦\.

ä½œæ³•1ï¼Œä¾ç„¶æœ‰ç ´è§£æ–¹æ³•ï¼š [å¦‚ä½•åœ¨iOS 12ä¸Šç»•è¿‡SSL Pinning](https://www.anquanke.com/post/id/179514){:target="_blank"}

ä½œæ³•2ï¼Œé€éåç·¨è­¯å·¥ç¨‹ä¹Ÿèƒ½ç²å¾—ç·¨ç¢¼åŠ å¯†ç”¨çš„å¯†é‘°

**âš ï¸æ²’æœ‰100%çš„å®‰å…¨âš ï¸**

`æˆ–æ˜¯ä¹¾è„†æŒ–å€‹æ´è®“å®ƒçˆ¬ï¼Œé‚Šæœé›†å„ç¨®è­‰æ“šï¼Œå†ç”¨æ³•å‹™è§£æ±ºï¼ˆï¼Ÿ`
#### é‚„æ˜¯é‚£å¥è©±ï¼š


> ã€Œ NEVER TRUST THE CLIENTã€ 



### mitmproxy çš„æ›´å¤šç©æ³•ï¼š

**1\.ä½¿ç”¨mitmdump**

é™¤ `mitmproxy` ã€ `mitmweb` ï¼Œ `mitmdump` å¯ç›´æ¥å°‡æ‰€æœ‰ç´€éŒ„åŒ¯å‡ºåˆ°æ–‡å­—æª”ä¸­
```
mitmdump -w /log.txt
```

ä¸¦ä¸”èƒ½ä½¿ç”¨ **ç©æ³•\(2\)** pythonç¨‹å¼ï¼Œè¨­å®šã€ç¯©é¸æµé‡:
```
mitmdump -ns examples/filter.py -r /log.txt -w /result.txt
```

**2\.æ­é…pythonç¨‹å¼åšè«‹æ±‚åƒæ•¸è¨­å®šã€è¨ªå•æ§åˆ¶ã€è½‰å€ï¼š**
```python
from mitmproxy import http

def request(flow: http.HTTPFlow) -> None:
    # pretty_host takes the "Host" header of the request into account,
    # which is useful in transparent mode where we usually only have the IP
    # otherwise.
    
    # è«‹æ±‚åƒæ•¸è¨­å®š Example:
    flow.request.headers['User-Agent'] = 'MitmProxy'
    
    if flow.request.pretty_host == "123.com.tw":
        flow.request.host = "456.com.tw"
    # å°‡123.com.twçš„è¨ªå•å…¨å°åˆ°456.com.tw
```

å•Ÿç”¨mitmproxyæ™‚åŠ ä¸Šåƒæ•¸ï¼š
```
mitmproxy -s /redirect.py
or
mitmweb -s /redirect.py
or
mitmdump -s /redirect.py
```
### è£œå€‹å‘

åœ¨ä½¿ç”¨ mitmproxy è§€å¯Ÿä½¿ç”¨ HTTP 1\.1 åŠ Accept\-Ranges: bytesã€ Content\-Range é•·é€£æ¥ç‰‡æ®µæŒçºŒæ‹¿å–è³‡æºçš„è«‹æ±‚æ™‚ï¼Œæœƒç­‰åˆ° response å…¨éƒ¨å›ä¾†æ‰æœƒé¡¯ç¤ºï¼Œè€Œä¸æ˜¯é¡¯ç¤ºåˆ†æ®µã€ä½¿ç”¨æŒä¹…é€£æ¥æ¥çºŒä¸‹è¼‰ï¼

[è¸©å‘åœ¨é€™](../ee47f8f1e2d2/) ã€‚
### å»¶ä¼¸é–±è®€
- [ä»¥ç°½åˆ°çå‹µ APP ç‚ºä¾‹ï¼Œæ‰“é€ æ¯æ—¥è‡ªå‹•ç°½åˆ°è…³æœ¬](../70a1409b149a/)
- [å¦‚ä½•æ‰“é€ ä¸€å ´æœ‰è¶£çš„å·¥ç¨‹CTFç«¶è³½](../729d7b6817a4/)
- [æ­éœ²ä¸€å€‹å¹¾å¹´å‰ç™¼ç¾çš„å·§å¦™ç¶²ç«™æ¼æ´](../142244e5f07a/)
- [iOS 15 / MacOS Monterey Safari å°‡èƒ½éš±è—çœŸå¯¦ IP](https://medium.com/zrealm-ios-dev/ios-15-macos-monterey-safari-%E5%B0%87%E8%83%BD%E9%9A%B1%E8%97%8F%E7%9C%9F%E5%AF%A6-ip-755a8b6acc35){:target="_blank"}

### å¾Œè¨˜

å› ç‚ºæˆ‘æ²’æœ‰ç¶²åŸŸæ¬Šé™ç„¡æ³•å–å¾—sslæ†‘è­‰è³‡è¨Šï¼Œæ‰€ä»¥ä¹Ÿç„¡æ³•å¯¦ä½œï¼›çœ‹ç¨‹å¼ç¢¼æ„Ÿè¦ºä¸¦ä¸å›°é›£ï¼Œé›–ç„¶æ²’æœ‰100%å®‰å…¨çš„æ–¹æ³•ï¼Œä½†å¤šä¸€é“é˜²è­·è‡³å°‘èƒ½æ›´å®‰å…¨ä¸€äº›ï¼Œå†ç¹¼çºŒæ”»éœ€è¦èŠ±è²»å¾ˆå¤šæ™‚é–“ç ”ç©¶ï¼Œæ‡‰è©²èƒ½å‹¸é€€90%çš„çˆ¬èŸ²äº†ï¼

é€™ç¯‡æ–‡ç« å¯èƒ½æœ‰é»å«é‡‘é‡å¤ªä½ï¼Œmediumè’å»¢äº†ä¸€é™£å­\(è·‘å»ç©å–®çœ¼\)ï¼Œä¸»è¦ç‚ºæœ¬é€±å…­æ—¥\(2019/09/21â€“2019/09/22\)çš„ [iPlayground 2019](https://iplayground.io/2019/){:target="_blank"} æå‰ç†±ç†±å¯«æ–‡æ‰‹æ„Ÿï¼›æœŸå¾…ä»Šå¹´çš„è­°ç¨‹ğŸ¤©ï¼Œå¸Œæœ›å›ä¾†å¾Œèƒ½å¸æ”¶ç”¢å‡ºæ›´å¤šç²¾å“æ–‡ç« ï¼


> **_\[2019/02/22 æ›´æ–°æ–‡ç« \] [iPlayground 2019 æ˜¯æ€éº¼æ¨£çš„é«”é©—ï¼Ÿ](../4079036c85c2/)_** 






[![Like Z Realm's work](https://button.like.co/images/og/likebutton.png "Like Z Realm's work")](https://button.like.co/in/like/zhgchgli){:target="_blank"}


æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-ios-dev/app%E6%9C%89%E7%94%A8https%E5%82%B3%E8%BC%B8-%E4%BD%86%E8%B3%87%E6%96%99%E9%82%84%E6%98%AF%E8%A2%AB%E5%81%B7%E4%BA%86-46410aaada00){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
