---
title: iOS UUID çš„é‚£äº›äº‹ (Swift/iOS â‰¥ 6)
author: ZhgChgLi
date: 2018-10-25T22:26:20.002Z
categories: ZRealm Dev.
tags: [iplayground,swift,ios-app-development,uuid,idfv]
---

### iOS UUID çš„é‚£äº›äº‹ (Swift/iOS â‰¥ 6)

iPlayground 2018 å›ä¾† & UUIDé‚£äº›äº‹
### å‰è¨€ï¼š

ä¸Šé€±å…­ã€æ—¥è·‘å»åƒåŠ  [iPlayground](https://iplayground.io/) Apple è»Ÿé«”é–‹ç™¼è€…ç ”è¨æœƒï¼Œé€™å€‹æ´»å‹•è¨Šæ¯æ˜¯åŒäº‹PASSéä¾†çš„ï¼Œå»ä¹‹å‰æˆ‘ä¹Ÿä¸æ¸…æ¥šé€™å€‹æ´»å‹•ã€‚

![](/assets/a4bc3bce7513/1*gEmmuDOD92d2b2fLp4AKsw.jpeg)

å…©å¤©ä¸‹ä¾†ï¼Œæ•´é¡Œæ´»å‹•è·Ÿæ™‚ç¨‹å®‰æ’æµæš¢ï¼Œè­°ç¨‹å…§å®¹ï¼š
. è¶£å‘³çš„ï¼šè…³è¸è»Šã€å‡‹é›¶çš„Codeã€iOS/API æ¼”é€²å²ã€å¨åˆ©åœ¨å“ªè£¡(CoreML Vision)
. å¯¦ç”¨çš„ï¼šæ¸¬è©¦é¡ (XCUITestã€ä¾è³´æ³¨å…¥)ã€SpriteKit åšå‹•ç•«æ•ˆæœçš„æ›¿ä»£æ–¹æ¡ˆã€GraphQL
. çœŸåŠŸå¤«ï¼šæ·±å…¥æ‹†è§£Swiftã€iOS è¶Šç„/Tweaké–‹ç™¼ã€Redux


è…³è¸è»ŠProject å°è±¡æ·±åˆ»ï¼Œç”¨iPhoneæ‰‹æ©Ÿç•¶æ„Ÿæ¸¬å™¨æ„Ÿæ¸¬è…³è¸è»Šè¸æ¿è½‰å‹•ï¼Œç›´æ¥åœ¨å°ä¸Šé¨è…³è¸è»Šåˆ‡æ›æŠ•å½±ç‰‡(å‰è¼©ä¸»è¦ç›®æ¨™æ˜¯è¦åšé–‹æºç‰ˆzwiftï¼Œä¹Ÿåˆ†äº«äº†è¨±å¤šåœ°é›·ï¼Œä¾‹å¦‚Client/Severé€šä¿¡ã€å»¶é²å•é¡Œã€ç£å ´å¹²æ“¾)

å‡‹é›¶çš„Dirty Codeï¼›è½å¾—å¿ƒæœ‰æˆšæˆšï¼Œåœ¨å¿ƒè£¡æœƒå¿ƒä¸€ç¬‘ï¼›æŠ€è¡“å‚µå°±æ˜¯é€™æ¨£ä¸€ç›´ç´¯ç©ä¸‹ä¾†çš„ï¼Œé–‹ç™¼æ™‚ç¨‹è¶•ï¼Œæ‰€ä»¥ç”¨æ¶æ§‹æ€§è¼ƒå·®çš„å¿«é€Ÿåšæ³•ï¼Œå¾Œäººæ¥æ‰‹æ”¹ä¹Ÿæ²’æ™‚é–“é‡æ§‹ï¼Œå°±è¶Šç©è¶Šå¤šï¼›åˆ°æœ€å¾Œå¯èƒ½çœŸçš„åªæœ‰æ‰“æ‰é€™æ¢è·¯äº†

æ¸¬è©¦é¡(Design Patterns in XCUITest) [KKBOXçš„å‰è¼©](https://www.facebook.com/TestingWithKK/) ï¼Œå®Œå…¨æ²’è—ç§ç›´æ¥å…¬é–‹ä»–å€‘çš„ä½œæ³•åŠç¨‹å¼ç¯„ä¾‹ç´°ç¯€é‚„æœ‰é‡åˆ°çš„é›·ã€è§£æ±ºè¾¦æ³•ï¼Œé€™å ‚ä¹Ÿæ˜¯å°æˆ‘å€‘å·¥ä½œä¸Šæœ€æœ‰å¹«åŠ©çš„é …ç›®ï¼›æ¸¬è©¦é€™å¡Šæ˜¯æˆ‘ä¸€ç›´æƒ³åŠ å¼·çš„éƒ¨åˆ†ï¼Œå¯ä»¥å›å»å¥½å¥½ç ”ç©¶ç ”ç©¶

Lighting Talkçš„éƒ¨åˆ†åœ¨å°ä¸‹è½å¾—ä¹Ÿå¥½æƒ³ä¸Šå»åˆ†äº«ğŸ˜‚ ä¸‹æ¬¡è¦ææ—©åšå¥½æº–å‚™äº†!

æœƒå¾Œçš„offical partyï¼Œé…’æ°´é£Ÿç‰©å ´åœ°éƒ½å¾ˆæœ‰èª æ„ï¼Œè½å‰è¼©å€‘çš„çœŸå¿ƒè©±åéœ²ï¼Œå¾ˆè¼•é¬†æœ‰è¶£ä¹‹å¤–é‚„å¸æ”¶è¨±å¤šè·å ´è»Ÿå¯¦åŠ›ï¼

![å°å¤§å¾Œå°å’–å•¡](/assets/a4bc3bce7513/1*Xwk_96lVKcMKgeL7IOC70g.jpeg "å°å¤§å¾Œå°å’–å•¡")
å°å¤§å¾Œå°å’–å•¡

æˆ‘æ‰çŸ¥é“åŸä¾†é€™æ˜¯ç¬¬ä¸€å±†ï¼ŒçœŸçš„æœ‰æ¦®å¹¸èƒ½å¤ åƒåŠ ï¼Œæ‰€æœ‰å·¥ä½œäººå“¡è·Ÿè¬›è€…è¾›è‹¦äº†ï¼

å»åƒåŠ ç ”è¨æœƒçš„ç›®çš„ä¸å¤–ä¹å°±æ˜¯è¦ï¼š **å¢åŠ å»£åº¦** ï¼Œå¸æ”¶æ–°çŸ¥ã€äº†è§£ç”Ÿæ…‹ã€ç¢°ä¸€äº›å¹³å¸¸ä¸æœƒæ¥è§¸çš„é …ç›®è·Ÿ **å¢åŠ æ·±åº¦** ï¼Œå¦‚æœæ˜¯è‡ªå·±å·²ç¶“æ‘¸éçš„é …ç›®å°±æ˜¯å»è½è½çœ‹æœ‰æ²’æœ‰éºæ¼çš„åœ°æ–¹æˆ–æ˜¯é‚„æœ‰å…¶ä»–åšæ³•æ²’ç™¼ç¾ï¼

æŠ„äº†è¨±å¤šç­†è¨˜å¯ä»¥å›ä¾†æ…¢æ…¢ç ”ç©¶å›å‘³ã€‚
### UUIDçš„é‚£äº›äº‹

å› ç‚ºæˆ‘è½å®Œå›å»å¾Œé¦¬ä¸Šå¯¦éš›æ‡‰ç”¨åˆ°APPä¸Šï¼›é€™å ‚æ˜¯ç”±Zonbleå‰è¼©ä¸»è¬›ï¼Œæˆ‘è½åˆ°å¾iPhone OS 2å¯«åˆ°iOS 12æˆ‘å°±è·ªäº†ï¼›ç”±æ–¼å…¥è¡Œè¼ƒæ™šï¼Œæˆ‘æ˜¯å¾iOS 11/Swift 4 æ‰é–‹å§‹å¯«ï¼Œæ‰€ä»¥æ²’ç¢°åˆ°é‚£äº›å› ç‚ºè˜‹æœä¿®æ”¹APIçš„å‹•äº‚æ™‚æœŸã€‚

æƒ³æƒ³UUIDå¾å¯ä»¥å–å¾—åˆ°å°é–ä¹Ÿæ˜¯è »åˆç†çš„ï¼›å¦‚æœæ˜¯ç”¨åœ¨è‰¯å–„çš„åœ°æ–¹ï¼šè¾¨è­˜ä½¿ç”¨è€…è£ç½®ã€å»£å‘Šæˆ–ç¬¬ä¸‰æ–¹é‹ç”¨å”¯ä¸€æ€§å»åšå»£å‘Šæ“ä½œï¼›ä½†å¦‚æœæœ‰å» å•†æƒ³åšæƒ¡ï¼Œä¹Ÿå¯ä»¥é€éé€™å€‹æ©Ÿåˆ¶åæŸ¥ï¼ŒçŸ¥é“ä½ é€™éš»æ‰‹æ©Ÿçš„ä¸»äººæ˜¯æ€éº¼æ¨£çš„äººï¼Ÿ(ä¾‹å¦‚æœ‰è£æ—…éŠ+å°åŒ—ç­‰å…¬è»Šï¼‹BMW APP+å¬°å…’ç…§è­· å°±èƒ½æ¨æ¸¬ä½ å¾ˆå¸¸å‡ºåœ‹å®¶è£¡æœ‰å°å­©è€Œä¸”ä½åœ¨å°åŒ— ä¹‹é¡çš„è³‡è¨Š)å†åŠ ä¸Šä½ åœ¨APPä¸Šè¼¸å…¥çš„å€‹è³‡ï¼Œèƒ½æ‹¿å»åšä»€éº¼æ‡‰ç”¨ä¸æ•¢æƒ³åƒ

ä½†é€™å…¶ä¸­ä¹Ÿæ³¢åŠåˆ°å¾ˆå¤šæ­£ç•¶å®ˆæ³•çš„ç”¨æˆ¶ï¼Œåƒæ˜¯æœ¬ä¾†ç”¨UUIDç•¶ä½¿ç”¨è€…çš„è³‡æ–™è§£å¯†KEYæˆ–ç”¨UUIDç•¶è£ç½®åˆ¤æ–·éƒ½å—åˆ°å¾ˆå¤§çš„å½±éŸ¿ï¼›çœŸä½©æœé‚£å€‹æ™‚æœŸçš„å·¥ç¨‹å¸«å‰è¼©å€‘ï¼Œé€™äº›å½±éŸ¿è€é—†è·Ÿä½¿ç”¨è€…ä¸€å®šæœƒç‹‚ç½µï¼Œè¦æ€¥ä¸­ç”Ÿæ™ºæ‰¾å…¶ä»–æ›¿ä»£è¾¦æ³•ï¼
#### æ›¿ä»£æ–¹æ¡ˆï¼š

æœ¬ç¯‡æ–‡ç« ä»¥å–å¾—UUIDè¾¨è­˜è£ç½®å”¯ä¸€å€¼ç‚ºä¸»ï¼Œå¦‚æœæ˜¯è¦æ‰¾çŸ¥é“ä½¿ç”¨è€…è£äº†å“ªäº›APPçš„æ›¿ä»£æ–¹æ¡ˆå¯åƒè€ƒä»¥ä¸‹é—œéµå­—æœå°‹åšæ³•ï¼š [UIPasteboard pasteboardWithName: create: (é‹ç”¨å‰ªè²¼ç°¿åœ¨APPé–“å…±äº«)](https://link.medium.com/YTheNPnHH7) ã€canOpenURL: info.plist LSApplicationQueriesSchmes (é‹ç”¨canOpenURLæª¢æŸ¥APOæœ‰ç„¡å®‰è£ï¼Œè¦åœ¨info.pliståˆ—èˆ‰ï¼Œæœ€å¤š50ç­†)
. ç”¨MAC Addressç•¶UUIDï¼Œä½†å¾Œä¾†ä¹Ÿè¢«BANäº†
. [Finger Printing (Canvas/User-Agentâ€¦)](https://medium.com/@ravielakshmanan/web-browser-uniqueness-and-fingerprinting-7eac3c381805) ï¼šæ²’ç ”ç©¶ï¼Œä¸éé€™é …ç›®ä¸»è¦æ‹¿ä¾†è®“safariè·Ÿappèƒ½ç”¢ç”ŸåŒæ¨£çš„UUIDï¼Œ [Deferred Deep Linking](https://www.jianshu.com/p/fa48387d56ea) (å»¶é²æ·±åº¦é€£çµ)ç”¨
[AmIUnique?](https://amiunique.org/)
. [**ID** entifier **F** or **V** endor](https://www.jianshu.com/p/b810d7e007ad) (IDFV)ï¼šç›®å‰ä¸»æµçš„è§£æ±ºæ–¹æ¡ˆğŸ†
æ¦‚å¿µæ˜¯è˜‹æœæœƒæ ¹æ“šä½ çš„Bundle IDå‰è¼Ÿç‚ºä½¿ç”¨è€…ç”¢ç”ŸUUIDï¼Œç›¸åŒçš„Bundle IDå‰è¼Ÿæœƒç”¢ç”Ÿç›¸åŒçš„UUIDï¼Œä¾‹å¦‚:com.518.work/com.518.job åŒå€‹è£ç½®æœƒå¾—åˆ°ç›¸åŒçš„UUID
å¦‚åŒåŸæ–‡ID For Vendorï¼Œç›¸åŒçš„å‰è¼Ÿè˜‹æœèªç‚ºå³æ˜¯ç›¸åŒå» å•†çš„APPï¼Œæ‰€ä»¥å…±äº«UUIDæ˜¯å…è¨±çš„ã€‚

#### **ID** entifier **F** or **V** endor (IDFV)ï¼š
```
let DEVICE_UUID:String = UIDevice.current.identifierForVendor?.uuidString ?? UUID().uuidString
```

**å”¯éœ€æ³¨æ„ï¼šç•¶æ‰€æœ‰åŒVendorçš„APPéƒ½ç§»é™¤å¾Œå†é‡è£å°±æœƒç”¢ç”Ÿæ–°çš„UUID (** com.518.workè·Ÿcom.518.jobéƒ½è¢«åˆªé™¤ï¼Œå†è£å›com.518.worké€™æ™‚å°±æœƒç”¢ç”Ÿæ–°çš„UUID **)** 
**åŒç†å¦‚æœä½ åªæœ‰ä¸€å€‹APPï¼Œåˆªæ‰é‡è£å°±æœƒç”¢ç”Ÿæ–°çš„UUID**

å› ç‚ºé€™å€‹ç‰¹æ€§ï¼Œæˆ‘å€‘å…¬å¸çš„å…¶ä»–APPæ˜¯ä½¿ç”¨Key-Chainä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œè½äº†è¬›è€…å‰è¼©çš„æŒ‡é»ä¹Ÿé©—è­‰äº†é€™å€‹åšæ³•æ˜¯æ­£ç¢ºçš„ï¼

**æµç¨‹å¦‚ä¸‹ï¼š**

![Key-Chain UUIDæ¬„ä½æœ‰å€¼æ™‚å–å€¼ï¼Œç„¡å‰‡å–IDFAçš„UUIDå€¼ä¸¦å›å¯«](/assets/a4bc3bce7513/1*-8rufG1QW-J5tn6ZadT17A.jpeg "Key-Chain UUIDæ¬„ä½æœ‰å€¼æ™‚å–å€¼ï¼Œç„¡å‰‡å–IDFAçš„UUIDå€¼ä¸¦å›å¯«")
Key-Chain UUIDæ¬„ä½æœ‰å€¼æ™‚å–å€¼ï¼Œç„¡å‰‡å–IDFAçš„UUIDå€¼ä¸¦å›å¯«

Key-Chainå¯«å…¥æ–¹å¼ï¼š
```swift
if let data = DEVICE_UUID.data(using: .utf8) {
    let query = [
        kSecClass as String       : kSecClassGenericPassword as String,
        kSecAttrAccount as String : "DEVICE_UUID",
        kSecValueData as String   : data ] as [String : Any]
    
    SecItemDelete(query as CFDictionary)
    SecItemAdd(query as CFDictionary, nil)
}
```

Key-Chainè®€å–æ–¹å¼ï¼š
```swift
let query = [
    kSecClass as String       : kSecClassGenericPassword,
    kSecAttrAccount as String : "DEVICE_UUID",
    kSecReturnData as String  : kCFBooleanTrue,
    kSecMatchLimit as String  : kSecMatchLimitOne ] as [String : Any]

var dataTypeRef: AnyObject? = nil
let status: OSStatus = SecItemCopyMatching(query as CFDictionary, &dataTypeRef)
if status == noErr,let dataTypeRef = dataTypeRef as? Data,let uuid = String(data:dataTypeRef, encoding: .utf8) {
   //uuid
} 
```

å¦‚æœå«ŒKey-Chainæ“ä½œå¤ªç¹ç‘£å¯ä»¥è‡ªè¡Œå°è£æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶ã€‚
#### å®Œæ•´CODEï¼š
```swift
let DEVICE_UUID:String = {
    let query = [
        kSecClass as String       : kSecClassGenericPassword,
        kSecAttrAccount as String : "DEVICE_UUID",
        kSecReturnData as String  : kCFBooleanTrue,
        kSecMatchLimit as String  : kSecMatchLimitOne ] as [String : Any]
    
    var dataTypeRef: AnyObject? = nil
    let status: OSStatus = SecItemCopyMatching(query as CFDictionary, &dataTypeRef)
    if status == noErr,let dataTypeRef = dataTypeRef as? Data,let uuid = String(data:dataTypeRef, encoding: .utf8) {
        return uuid
    } else {
        let DEVICE_UUID:String = UIDevice.current.identifierForVendor?.uuidString ?? UUID().uuidString
        if let data = DEVICE_UUID.data(using: .utf8) {
            let query = [
                kSecClass as String       : kSecClassGenericPassword as String,
                kSecAttrAccount as String : "DEVICE_UUID",
                kSecValueData as String   : data ] as [String : Any]
        
            SecItemDelete(query as CFDictionary)
            SecItemAdd(query as CFDictionary, nil)
        }
        return DEVICE_UUID
    }
}()
```
[Like Z Realm's work](https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fbutton.like.co%2Fin%2Fembed%2Fzhgchgli%2Fbutton&display_name=LikeCoin&url=https%3A%2F%2Fbutton.like.co%2Fzhgchgli&image=https%3A%2F%2Fstorage.googleapis.com%2Flikecoin-foundation.appspot.com%2Flikecoin_store_user_zhgchgli_main%3FGoogleAccessId%3Dfirebase-adminsdk-eyzut%2540likecoin-foundation.iam.gserviceaccount.com%26Expires%3D2430432000%26Signature%3DgFRSNto%252BjjxXpRoYyuEMD5Ecm7mLK2uVo1vGz4NinmwLnAK0BGjcfKnItFpt%252BcYurx3wiwKTvrxvU019ruiCeNav7s7QUs5lgDDBc7c6zSVRbgcWhnJoKgReRkRu6Gd93WvGf%252BOdm4FPPgvpaJV9UE7h2MySR6%252B%252F4a%252B4kJCspzCTmLgIewm8W99pSbkX%252BQSlZ4t5Pw22SANS%252BlGl1nBCX48fGg%252Btg0vTghBGrAD2%252FMEXpGNJCdTPx8Gd9urOpqtwV4L1I2e2kYSC4YPDBD6pof1O6fKX%252BI8lGLEYiYP1sthjgf8Y4ZbgQr4Kt%252BRYIicx%252Bg6w3YWTg5zgHxAYhOINXw%253D%253D&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=like)

æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact) ã€‚



+-----------------------------------------------------------------------------------+

| **[View original post on Medium](https://medium.com/zrealm-ios-dev/ios-uuid-%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B-swift-ios-6-a4bc3bce7513) - Converted by [ZhgChgLi](https://zhgchg.li)/[ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown)** |

+-----------------------------------------------------------------------------------+
