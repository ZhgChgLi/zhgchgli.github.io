<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Implementing Daily Data Report RPA Automation with Google Apps Script" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Robotic Process Automation for Google Workspace services using Google Apps Script" /><meta property="og:description" content="Robotic Process Automation for Google Workspace services using Google Apps Script" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-14T23:16:45+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="twitter:title" content="Implementing Daily Data Report RPA Automation with Google Apps Script" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-10-20T14:06:10+08:00","datePublished":"2024-04-14T23:16:45+08:00","description":"Robotic Process Automation for Google Workspace services using Google Apps Script","headline":"Implementing Daily Data Report RPA Automation with Google Apps Script","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/"},"url":"https://zhgchg.li/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/"}</script><title>Implementing Daily Data Report RPA Automation with Google Apps Script | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan üáπüáº who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Implementing Daily Data Report RPA Automation with Google Apps Script</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Implementing Daily Data Report RPA Automation with Google Apps Script</h1><p class="post-desc fw-light mb-4">Robotic Process Automation for Google Workspace services using Google Apps Script</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1713107805" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 14, 2024 </time> </span> <span> Updated <time data-ts="1729404370" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 20, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link preview-img blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="8350 words" > <em>46 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Implementing Daily Data Report RPA Automation with Google Apps Script</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Implementing Daily Data Report RPA Automation with Google Apps Script</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><hr /><h3 id="‚ÑπÔ∏è‚ÑπÔ∏è‚ÑπÔ∏è-the-following-content-is-translated-by-openai"><span class="me-2">‚ÑπÔ∏è‚ÑπÔ∏è‚ÑπÔ∏è The following content is translated by OpenAI.</span><a href="#‚ÑπÔ∏è‚ÑπÔ∏è‚ÑπÔ∏è-the-following-content-is-translated-by-openai" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="click-here-to-view-the-original-chinese-version--ÈªûÊ≠§Êü•ÁúãÊú¨Êñá‰∏≠ÊñáÁâà"><span class="me-2"><a href="/posts/f6713ba3fee3/">Click here</a> to view the original Chinese version. | <a href="/posts/f6713ba3fee3/">ÈªûÊ≠§Êü•ÁúãÊú¨Êñá‰∏≠ÊñáÁâà</a></span><a href="#click-here-to-view-the-original-chinese-version--ÈªûÊ≠§Êü•ÁúãÊú¨Êñá‰∏≠ÊñáÁâà" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><hr /><h3 id="implementing-daily-data-report-rpa-automation-with-google-apps-script"><span class="me-2">Implementing Daily Data Report RPA Automation with Google Apps Script</span><a href="#implementing-daily-data-report-rpa-automation-with-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Robotic Process Automation (RPA) for Google Workspace services using Google Apps Script</p><p><a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Possessed Photography</a></p><h3 id="robotic-process-automation"><span class="me-2">Robotic Process Automation</span><a href="#robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>RPA (Robotic Process Automation) translates to ‚ÄúProcess Automation Robot‚Äù in Chinese. Looking back at human history, from manual gathering to the Stone Age, then to agricultural civilization, and from the industrial revolution of the last century to the rise of information technology in the past 20 years, human work efficiency and productivity have seen exponential growth. Throughout this journey, RPA applications have been ubiquitous: the waterwheel in the agricultural era (automating the threshing process), the textile machines of the industrial revolution (automating textile work), factory robotic arms (automating assembly tasks), and finally, the automation of information-related tasks, such as automatic report queries and notifications, which this article will introduce.</p><p>I must admit, I only recently learned this term. Since my first job seven years ago, I have been doing RPA-related tasks, such as writing web scrapers for data statistics, automating CI/CD processes, automating data queries, automating stability data alerts, and automating daily routine operations. However, I previously referred to it simply as ‚Äúautomation.‚Äù It‚Äôs time to give it a proper name ‚Äî RPA (Robotic Process Automation).</p><p><strong>Previously, my RPA efforts focused more on ‚Äúwriting code to automate tasks to solve individual problems,‚Äù</strong> lacking a comprehensive evaluation and analysis in the early stages, the use of No/Low Code tools, regulatory considerations, operational monitoring, actual data statistics, continuous improvement, and promoting corporate culture. All of these are essential for a complete RPA implementation. However, as mentioned earlier, I only recently became aware of this professional field, so let me start by sharing a practical article!</p><p>There are many platforms that provide RPA services, such as Automation Anywhere, UiPath, Microsoft Power Automate, Blue Prism, or Zapier, IFTTT, Automate.io‚Ä¶ You should choose the appropriate service based on the specific problem you want to solve.</p><p>I recommend a free, open-source, browser-based RPA tool: <a href="https://chromewebstore.google.com/detail/automa/infppggnoaenmfagbfknfkancpbljcca" target="_blank">Automa</a>.</p><blockquote><p><strong><em>Additionally, broadly speaking, transforming the active dependency between people or between people and tasks into a dependency on platforms is also a form of RPA.</em></strong></p></blockquote><blockquote><p><strong><em>For example: uniformly using project management tools like Asana/Jira to manage work tasks.</em></strong></p></blockquote><blockquote><p><strong><em>Based on the concept of transforming active to passive, we can implement an RPA that automatically notifies us when there are new changes, instead of manually checking for new notifications.</em></strong></p></blockquote><blockquote><p><strong><em>For instance: the previously implemented <a href="/posts/en/d414bdbdb8c9/">Gmail to Slack</a> that forwards specific notification emails to work groups.</em></strong></p></blockquote><h4 id="benefits-assessment-of-robotic-process-automation"><span class="me-2">Benefits Assessment of Robotic Process Automation</span><a href="#benefits-assessment-of-robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Previously, in the ‚Äú<a href="/posts/en/11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk ‚Äî Secrets of High-Efficiency Engineering Teams</strong></a>,‚Äù I shared the cost issues of incremental gains and flow interruptions. Suppose a repetitive task takes 15 minutes each time and occurs 10 times a week; over a year, that amounts to nearly 130 hours wasted. If we also consider the cost of ‚Äúswitching flow,‚Äù we might end up wasting nearly 200 hours a year.</p><p><a href="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" alt="[**2021 Pinkoi Tech Career Talk ‚Äî Secrets of High-Efficiency Engineering Teams**](/posts/en/11f6c8568154/)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTIiIGhlaWdodD0iNTA1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/posts/en/11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk ‚Äî Secrets of High-Efficiency Engineering Teams</strong></a></p><blockquote><p>The term ‚Äúflow switching‚Äù refers to the time spent when we are focused on important tasks and need to pause to handle other matters, then return to regain our focus.</p></blockquote><p>The benefits assessment for developing RPA can refer to the diagram below; as long as the time required for development and the frequency of occurrence exceed the wasted time, it is worth investing resources to implement:</p><p><a href="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" alt="[https://twitter.com/swyx/status/1196401158744502272](https://twitter.com/swyx/status/1196401158744502272){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjExMTciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://twitter.com/swyx/status/1196401158744502272" target="_blank">https://twitter.com/swyx/status/1196401158744502272</a></p><ul><li>X-axis: Task occurrence frequency, e.g., 50/Day (50 times a day)<li>Y-axis: The amount of human time required to complete each task<li>The time cost range is calculated over the past 5 years, with the middle of the table indicating the wasted time and labor costs over 5 years<li>White indicates that the potential time cost for automation is less than the benefits gained, making it not worth improving<li>Green indicates tasks worth automating<li>Red strongly suggests transitioning to automation</ul><blockquote><p><strong><em>In addition to saving time, automated standardized processes can also reduce the likelihood of human error and enhance stability.</em></strong></p></blockquote><h4 id="the-relationship-between-robotic-process-automation-and-ai"><span class="me-2">The Relationship Between Robotic Process Automation and AI</span><a href="#the-relationship-between-robotic-process-automation-and-ai" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>With the rise of AI, RPA is often mentioned; however, I believe there is no direct relationship between RPA and AI. <strong>RPA existed long before the era of AI, and the benefits of implementing AI may not surpass those of a well-established RPA. RPA is more about corporate culture and work habits.</strong> However, it is undeniable that AI can indeed help RPA reach the next level. For example, while RPA could only perform precise, routine tasks in the past, with AI, it can handle more ambiguous, dynamic, and intelligent decision-making tasks.</p><h3 id="robotic-process-automation-at-google-workspace"><span class="me-2">Robotic Process Automation at Google Workspace</span><a href="#robotic-process-automation-at-google-workspace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Google Workspace (formerly G Suite) is a great partner for our daily office collaboration. We use Gmail for email, Google Docs for documents, Google Sheets for reports, and Google Forms for forms‚Ä¶ The integration of these services or communication with internal and external systems requires us to implement RPA.</p><p>However, Google does not provide direct RPA services, but we can achieve this through the following services:</p><ul><li>No Code: <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> (paid service) allows non-developers to build service integrations through a GUI.<li>Low Code: <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> (free service) enables quick and direct bridging of Google services and external/internal systems with simple programming.<li>Function as a Service: <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> (paid service with free tier) allows you to write complete code and services, which can be deployed and executed directly through Google Cloud.</ul><p>I have not worked with the No Code platform <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a>, but I have considerable experience with <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> and <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a>. Below are some personal experiences and insights from my previous usage:</p><h4 id="cloud-functions"><span class="me-2">Cloud Functions</span><a href="#cloud-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Requires deployment to execute<li>Supports multiple programming languages: Node.js, Python, Java, Go, PHP, Ruby‚Ä¶<li>Supports third-party package dependency management, installation, and usage<li>Supports a complete authentication mechanism<li>Maximum execution time limit: 60 minutes<li>Pay for what you use: charges based on the number of executions, execution time, different processors, and memory used<li>Subject to cold start issues (if not called for a long time, the first call will require a longer response time)<li>Cannot directly connect to Google services; requires Auth/API authentication<li><strong>Free tier details</strong>: Cloud Functions offers a permanent free tier for computing time resources, including GB/second and GHz/second allocations. In addition to 2 million calls, this free tier also provides 400,000 GB/seconds and 200,000 GHz/seconds of computing time, as well as 5 GB of internet data transfer per month. The usage quota for the free tier is calculated based on the equivalent dollar amount of the above level 1 pricing. Regardless of whether the execution function‚Äôs region uses level 1 or level 2 pricing, the system will allocate an equivalent dollar amount to you. However, when deducting the free tier quota, the system will follow the function execution region‚Äôs level (level 1 or level 2). Please note that even if you are using the free tier, you must have a valid billing account.</ul><p>In summary, Cloud Functions is recommended for more complete and complex RPA integration functions or when there are more external API integration needs.</p><p>Previous use cases for Cloud Functions include:</p><ul><li>[Slack ChatGPT Conversation Bot]: <a href="/posts/en/bd94cc88f9c9/">Slack &amp; ChatGPT Integration</a><li>[Automated Check-in Bot]: <a href="/posts/en/70a1409b149a/">Using Python + Google Cloud Platform + Line Bot to Automate Routine Tasks</a></ul><p>These are used when integrating with non-Google Workspace services and bridging other external services.</p><h4 id="google-apps-script"><span class="me-2">Google Apps Script</span><a href="#google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Convenient, simple, and quick<li>Completely free<li>No complicated Auth authentication required for service integration (Google Apps Script uses the currently executing account as the execution identity)<li>Built-in scheduling and calendar trigger functions<li>Uses Google network to execute web requests<li>Can only be developed using Google Apps Script (based on JavaScript)<li>Does not support package management tools, no version control features<li><strong>Due to security issues, <a href="https://issuetracker.google.com/issues/36758197" target="_blank">customizing Request User-Agent information is not allowed</a></strong><li><strong>Execution time limit: scripts must complete work within 6 minutes, or they will be terminated.</strong><li>For other limitations and quotas, please refer to the official <a href="https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw" target="_blank">GAS information</a>:</ul><p><a href="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzUiIGhlaWdodD0iMTA0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzAiIGhlaWdodD0iODMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Previous use cases for Google Apps Script include:</p><ul><li>[Integrating Slack x Google Form x Google Sheet]: <a href="/posts/en/d61062833c1a/">Creating a Fully Automated WFH Employee Health Status Reporting System</a><li>[Integrating Slack x Gmail]: <a href="/posts/en/d414bdbdb8c9/">Using Google Apps Script to Forward Gmail Emails to Slack</a><li>[Integrating Google Analytics x Slack]: <a href="/posts/en/793cb8f89b72/">Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate</a><li>[Integrating Firebase Crashlytics x Big Query x Slack]: <a href="/posts/en/e77b80cc6f89/">Crashlytics + Big Query for a More Immediate and Convenient Crash Tracking Tool</a><li>[Integrating Github x LineBot]: <a href="/posts/en/382218e15697/">Using Google Apps Script to Create a Free Github Repo Star Notifier in Three Steps</a></ul><p>Due to execution time and API request customization limitations, I only use Google Apps Script for simple and quick services; or when there is a need to integrate with Google services, I prefer to use Google Apps Script (because using Cloud Functions requires implementing the complete Google service authentication process).</p><h3 id="robotic-process-automation-with-google-apps-script--daily-work-report-google-sheet-x-google-analytics"><span class="me-2">Robotic Process Automation with Google Apps Script ‚Äî Daily Work Report (Google Sheet x Google Analytics)</span><a href="#robotic-process-automation-with-google-apps-script--daily-work-report-google-sheet-x-google-analytics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Finally, we arrive at the main topic of this article: using Google Apps Script to implement RPA automation for Google services.</p><h4 id="background"><span class="me-2">Background</span><a href="#background" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The product team needs to query Google Analytics data daily and fill it into a Google Sheet data report for team analysis of trends. They also need to publish the daily data content on a dashboard screen to keep all members informed of the current status.</p><p>Colleagues spend about 30 minutes each day upon arriving at the office to complete this task; if there are other matters to handle, they must wait until this routine work is finished before starting or may delay the publication of daily data messages.</p><p><strong>A simple estimate of RPA benefits:</strong></p><ul><li>Annual consumption: 1 person x 30 mins x 365 days (holiday data also needs to be filled) <strong>= 182 hours</strong><li>Automation setup cost: In this case, it would take about 1 person x 5 days <strong>= 40 hours</strong></ul><blockquote><p>Therefore, we only need to invest one week of development time to solve the work consumption of the colleague responsible for data checking in the long term, allowing them to focus on more important tasks.</p></blockquote><h4 id="goal"><span class="me-2">Goal</span><a href="#goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Our goal is to use Google Apps Script to create an RPA that automatically retrieves daily data from Google Analytics and internal system report APIs and fills it into Google Sheets, as well as to build a Web UI Dashboard.</p><h4 id="final-effect"><span class="me-2">Final Effect</span><a href="#final-effect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjMyMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a></ul><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQzNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></ul><blockquote><p><strong><em>The data is dummy data for demo purposes; starting from 2024/04/13, it will be particularly low or remain at 0, as my zhgchg.li GA truly has ‚Äú0‚Äù traffic Q_Q.</em></strong></p></blockquote><h4 id="tasks-to-complete"><span class="me-2">Tasks to Complete</span><a href="#tasks-to-complete" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Create Google Apps Script and familiarize yourself with the editor<li>Obtain/create the corresponding date‚Äôs Sheet<li>Connect to Google Analytics to retrieve data<li>Populate the data<li>Set up a schedule for daily automatic execution</ol><h4 id="declaration"><span class="me-2">Declaration</span><a href="#declaration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Due to the explanatory nature of the article, the following code will be kept as simple as possible to enhance clarity. You can modify it according to your actual needs.</p><blockquote><p><strong><em>At the end of the article, I have attached the complete public Google Sheet &amp; Google Apps Script. If you prefer not to go step by step, you can directly modify the template attached at the end of the article.</em></strong></p></blockquote><h4 id="step-1-create-google-apps-script"><span class="me-2">Step 1. Create Google Apps Script</span><a href="#step-1-create-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iMjU5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Simply select ‚ÄúExtensions‚Äù -&gt; ‚ÄúApps Script‚Äù on the report you want to automate, and it will automatically create a Google Apps Script linked to the Google Sheet report.</p><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre>Additionally, you can create a <span class="p">[</span><span class="nv">Google Apps Script</span><span class="p">](</span><span class="sx">https://www.google.com/script/start/</span><span class="p">)</span>{:target="_blank"} directly from the Google Apps Script homepage, but this will not link it to Google Sheets.
<span class="gt">
&gt; **You do not need a link to operate with the corresponding Google Sheet.** Both methods of creation are valid; the difference lies in the ownership of the script. If it is linked to a report, it belongs to the report owner. If created by yourself, it belongs to the creator. Ownership is important because if that account is deactivated due to leaving the company, the script may become invalid or be deleted.</span>

<span class="p">![](</span><span class="sx">/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+" }

After creating the script, we can rename our script project name from the top.
<span class="gu">#### Basic Knowledge of Google Apps Script</span>

Before moving on to writing the program, let's cover some basic knowledge of Google Apps Script.

<span class="gs">**About the Editor**</span>

By default, the SDKs for Google services are included (no special import is needed to call them):
<span class="p">-</span> CalendarApp Calendar
<span class="p">-</span> DocumentApp Google Drive
<span class="p">-</span> FormApp Google Form
<span class="p">-</span> SpreadsheetApp Google Sheet
<span class="p">-</span> GmailApp Gmail
<span class="p">-</span> <span class="p">[</span><span class="nv">Others‚Ä¶</span><span class="p">](</span><span class="sx">https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle</span><span class="p">)</span>{:target="_blank"}

<span class="p">![](</span><span class="sx">/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODkiIGhlaWdodD0iMzQzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+" }
<span class="p">
1.</span> <span class="gs">**File:**</span>
   You can add multiple <span class="sb">`.gs`</span> files to store different object codes for better organization. All files will run under the same Namespace and lifecycle, so be careful with object names and variable names, as duplicates may overwrite each other. In addition to <span class="sb">`.gs`</span> script files, you can also add <span class="sb">`.html`</span> HTML Template files for rendering Web UI. (More on this later)
<span class="p">   
2.</span> <span class="gs">**Library:**</span>
   You can use libraries written by others (a.k.a. Lib) by importing them through their Script ID. Of course, you can also deploy your own scripts as libraries for others to use. Additionally, there are some tools packaged by experts that can be used, but the downside is that you can only search for Script IDs through Google, as there is no official database list for querying.
   e.g. HTML Parser Tool Cheer.io Script ID: <span class="sb">`1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0`</span>
<span class="p">   
3.</span> <span class="gs">**Services:**</span>
   The SDKs for Google services that are not included by default can be added here for use.
   e.g. Google Analytics Data
<span class="p">   
4.</span> <span class="gs">**Undo, Next Action**</span>
<span class="p">5.</span> <span class="gs">**Save**</span> or Control + s
<span class="p">6.</span> <span class="gs">**Run**</span> or Control + r
   If an error occurs, it will directly prompt in the Console and terminate the script.
<span class="p">   
7.</span> <span class="gs">**Debugging**</span>
   Execution will pause at the Break point (10) and open the Debug View on the right side; you can press continue to execute.
   If an error occurs, it will pause and open the Debug View on the right side.
<span class="p">   
8.</span> <span class="gs">**Debugging, Target Method (Function Name)**</span>
   You can only select methods owned by the currently selected file.
<span class="p">   
9.</span> <span class="gs">**View Execution Logs in the Editor**</span>
<span class="gt">
&gt; _Another point to note is formatting; in some browsers, pressing "Control + [" for indentation may trigger a return to the previous page, so be cautious!_</span>

<span class="p">[</span><span class="nv">**Google Apps Script GitHub Assistant Chrome Extension Version Control Plugin**</span><span class="p">](</span><span class="sx">https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo</span><span class="p">)</span>{:target="_blank"}
<span class="p">-</span> It is recommended to install this Extension to connect Google Apps Script with git, enabling version control functionality to prevent accidental changes.

<span class="p">![](</span><span class="sx">/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIxIiBoZWlnaHQ9IjE5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==" }

<span class="p">![](</span><span class="sx">/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTkiIGhlaWdodD0iMjM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+" }

<span class="p">![](</span><span class="sx">/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTQiIGhlaWdodD0iNjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+" }
<span class="p">
-</span> If you encounter Push/Pull Errors or if it does not respond when clicked, please follow the steps above: "Options" -&gt; Connect to Github or re-verify Google authorization.

<span class="gs">**Logger Message**</span>

You can use the following Script in conjunction with Debug to print Debug Logs in the Console below.
<span class="p">```</span><span class="nl">javascript
</span><span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hi</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>Execution Logs, Error Information</strong></p><p>Logs or errors during execution in the editor will be displayed directly. If you want to check execution logs or errors that occurred during automatic execution, you can view them in the ‚ÄúExecution Items‚Äù tab.</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjQ5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Automatic Triggers</strong></p><p><a href="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzYiIGhlaWdodD0iMzEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzQiIGhlaWdodD0iNzc3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>In the ‚ÄúTrigger Conditions‚Äù tab, you can set how the methods in the script should be automatically triggered. The automatic trigger conditions you can set include:</p><ul><li>When Google Sheet: Opens, Edits, Content Changes, Submits Form<li>Scheduled triggers: Execute once every X minutes, X hours, X days, X weeks, X months<li>Specific date triggers: Execute at YYYY-MM-DD HH:MM<li>When Calendar: Updates</ul><p>Error notification settings allow you to configure how you will be notified when the script encounters an error.</p><p><strong>Grant Execution Permissions</strong></p><blockquote><p><strong><em>The first time you execute/deploy or add imported services and resources, you need to re-run the identity authorization. After authorization, all subsequent executions will use the identity you authorized, so ensure that the account you authorize (usually the current one) has access to the resource or service. (e.g. you need to have access to that Google Sheet).</em></strong></p></blockquote><p>After the account selection pop-up appears, choose the account to authorize execution (usually the current Google Apps Script account):</p><p><a href="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjQiIGhlaWdodD0iNTIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>If you see ‚ÄúGoogle hasn‚Äôt verified this app,‚Äù it is because the app we are developing is for personal use and does not need to go through Google verification.</p><p>Simply click ‚ÄúAdvanced‚Äù -&gt; ‚ÄúGo to XXX (unsafe)‚Äù -&gt; ‚ÄúAllow‚Äù:</p><p><a href="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMzMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTgiIGhlaWdodD0iNDU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjgiIGhlaWdodD0iNzIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Once authorization is complete, you can successfully execute the script. If there are no changes to the resources, you do not need to re-authorize.</p><h4 id="2-obtaincreate-the-corresponding-date-sheet"><span class="me-2">2. Obtain/Create the Corresponding Date Sheet</span><a href="#2-obtaincreate-the-corresponding-date-sheet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After understanding the basic knowledge, we can write the program for the first function.</p><p>We create the following multiple files to conveniently store different objects.</p><p><code class="language-plaintext highlighter-rouge">DailyReportStyle.gs</code> Field Style Object:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">HeaderStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#e3284b</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ContentStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#000000</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">HeaderDateStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#001a40</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReportField.gs</code> Field Data Object:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReportField</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">headerStyle</span><span class="p">,</span> <span class="nx">contentStyle</span><span class="p">,</span> <span class="nx">format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">headerStyle</span> <span class="o">=</span> <span class="nx">headerStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">contentStyle</span> <span class="o">=</span> <span class="nx">contentStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReport.gs</code> Main Report Logic:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Week</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC Traffic) + 5(Mobile Traffic)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Registration Count</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1">// Explanation of the daily traffic formula:</span>
    <span class="c1">// 1. The COLUMN() function returns the column number of the current cell.</span>
    <span class="c1">// 2. ADDRESS(1, COLUMN(), 4) generates an absolute reference address using the given row number (the result of `COLUMN()`) and a fixed column number (1). The third parameter 4 indicates a relative address without any dollar signs ($). For example, if you use this function in any cell of the third column, it will return "C1".</span>
    <span class="c1">// 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") removes the number 1 from the address generated by the ADDRESS function, leaving only the letter of the column, e.g., "C".</span>
    <span class="c1">// 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 4) here &amp; 4 should actually be &amp;4. The result of `SUBSTITUTE` will concatenate with the number 4, forming a string like "C4", and then the INDIRECT function will convert this string into the corresponding cell reference. So, if you use this formula in any cell of column C, it will reference C4.</span>
    <span class="c1">// 5. Similarly, `INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 5)` will reference the cell in the fifth row of the same column. For example, if you use this formula in any cell of column C, it will reference C5.</span>
    <span class="c1">// 6. Finally, the values of the two INDIRECT function-referenced cells are added together.</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>

  <span class="p">}</span>

  <span class="c1">// Get the target Sheet for the given date</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Distinguish Sheets by month, find the Sheet for the current month</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// If not, create a new monthly Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Monthly Sheet naming convention</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Create a new monthly Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Add the current month's Sheet and move it to the first position</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// Add the first column, set the column name, Pinned, width 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// Fill in the column names</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set row height</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// Set Pinned for the first two rows (Date, Week)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// Add a total column</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add a column at the last column</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Fill in the total column</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Date...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Week...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>

        <span class="c1">// 1. The IFERROR(value, [value_if_error]) function is used to determine if there is an error in the formula and returns a specified value if there is an error. It takes two parameters: `value` is the expression or function to be calculated, and `value_if_error` is the value returned when value encounters an error. In this context, if there is an error in the calculation of the SUM function, it returns 0.</span>
        <span class="c1">// 2. The SUM(range) function is used to calculate the total of all numbers in the range.</span>
        <span class="c1">// 3. The INDIRECT(ref_text, [is_A1_notation]) function converts a text string into a cell reference. Here, the INDIRECT function is used to dynamically generate the required reference range.</span>
        <span class="c1">// 4. The SUBSTITUTE(text, old_text, new_text, [instance_num]) function replaces specified text in a text string. Here, SUBSTITUTE is used to replace "1" in the address returned by the ADDRESS function with something else.</span>
        <span class="c1">// 5. The ADDRESS(row, column, [abs_num], [a1], [sheet]) function returns the corresponding cell address based on the given row and column numbers. Here, ADDRESS(1, 1, 4) generates the cell address for the first row and first column, but since abs_num is 4, the address does not include the sheet name and fixed symbol $. Similarly, `ADDRESS(1, COLUMN() - 1, 4)` generates the cell address from the first row to the previous column of the current column.</span>
        <span class="c1">// 6. The COLUMN() function returns the column number of the current cell.</span>
        <span class="c1">// 7. summaryRowIndex = the current row     </span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> as the main program entry:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTgwIiBoZWlnaHQ9IjM1MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>After completing, we return to <code class="language-plaintext highlighter-rouge">Main.gs</code>, select ‚Äúdebug,‚Äù and press debug to check if the execution result is correct and if there are any errors.</p><p><a href="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjMiIGhlaWdodD0iMjY0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>If executed correctly, the report will show the current new month with the default fields and total column. If it already exists, there will be no response.</p><h4 id="3-connect-to-google-analytics-to-retrieve-data"><span class="me-2">3. Connect to Google Analytics to Retrieve Data</span><a href="#3-connect-to-google-analytics-to-retrieve-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>First, you need to add the ‚ÄúAnalyticsData‚Äù service:</p><p><a href="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ5IiBoZWlnaHQ9Ijc1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Use the GA4 Debug Tool to construct query conditions:</p><ul><li><a href="https://ga-dev-tools.google/ga4/query-explorer/" target="_blank">https://ga-dev-tools.google/ga4/query-explorer/</a><li>You can build it while comparing with the filtering conditions in the GA 4 backend.<li><strong>This article uses querying the number of Sessions as an example, distinguishing device Grouping.</strong></ul><p>After logging in and authorizing, select the target resource:</p><p><a href="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjQiIGhlaWdodD0iMjUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Note the number displayed under the property, which is your GA Property ID for querying.</p><p>Set the query parameters and Filter conditions:</p><p><a href="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NTciIGhlaWdodD0iNDczIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre>
```markdown
Press "Make Request" to obtain the Response result:

![](/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp){: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDciIGhlaWdodD0iODg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+" }

You can synchronously compare the data from the GA 4 backend under the same conditions to see if they match. If there is a significant discrepancy, it may be due to a missing filter condition, so please check again.

#### Note

Here‚Äôs a small pitfall discovered by a marketing colleague: some data in GA may have a delay issue, meaning that the numbers you check today might differ from those checked yesterday (for example, the bounce rate). Therefore, it‚Äôs best to backtrack the data a few days to ensure that the final numbers are accurate.

&gt; _Once the GA Debug Tool shows no issues, we can convert it to Google Apps Script._

Add a new `GAData.gs` file:
```javascript
// Remember to add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined
// GA Debug Tool: https://ga-dev-tools.web.app/ga4/query-explorer/

class GAData {
  constructor(date) {
    this.date = date;

    const traffic = this.fetchGADailyUsage();
    this.pc_traffic = traffic["desktop"];
    this.mobile_traffic = traffic["mobile"];
  }

  fetchGADailyUsage() {
    const dimensionPlatform = AnalyticsData.newDimension();
    dimensionPlatform.name = "deviceCategory";

    const metric = AnalyticsData.newMetric();
    metric.name = "sessions";

    const dateRange = AnalyticsData.newDateRange();
    // Default query for data within the given date range e.g. 2024-01-01 ~ 2024-01-01
    dateRange.startDate = this.getDateString();
    dateRange.endDate = this.getDateString();

    // Filter Example:
    // const filterExpression = AnalyticsData.newFilterExpression();
    // const filter = AnalyticsData.newFilter();
    // filter.fieldName = "landingPagePlusQueryString";
    // const stringFilter = AnalyticsData.newStringFilter()
    // stringFilter.value = "/life|/article|/chat|/house|/event/230502|/event/230310";
    // stringFilter.matchType = "PARTIAL_REGEXP";
    // filter.stringFilter = stringFilter;
    // filterExpression.filter = filter;

    const request = AnalyticsData.newRunReportRequest();
    request.dimensions = [dimensionPlatform];
    request.metrics = [metric];
    request.dateRanges = dateRange;

    // Filter Example:
    // const filterExpression = AnalyticsData.newFilterExpression();
    // filterExpression.expression = filterExpression;
    // request.dimensionFilter = filterExpression;
    // or Not
    // const notFilterExpression = AnalyticsData.newFilterExpression();
    // notFilterExpression.notExpression = filterExpression;
    // request.dimensionFilter = notFilterExpression;

    const report = AnalyticsData.Properties.runReport(request, "properties/" + gaPropertyId).rows;
    // No data
    if (report == undefined) {
      return {"desktop": 0, "mobile": 0};
    }

    // [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}]

    var result = {};
    report.forEach(function(element) {
      result[element.dimensionValues[0].value] = element.metricValues[0].value;
    });

    return result;
  }

  getDateString() {
    return Utilities.formatDate(this.date, "GMT+8", "yyyy-MM-dd");
  }
}
</pre></table></code></div></div><p>Add test content to <code class="language-plaintext highlighter-rouge">Main.gs</code>:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">gaData</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Press run or debug to obtain the program‚Äôs fetching results:</p><p><a href="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDAiIGhlaWdodD0iMTU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>OK! The comparison matches.</p><p><a href="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMzgiIGhlaWdodD0iMzUxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>When this step is completed, the directory file structure is as shown in the image above.</p><h4 id="4-fill-in-data"><span class="me-2">4. Fill in Data</span><a href="#4-fill-in-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After creating the Sheet and checking the data, the next step is to fill in the data into the columns.</p><p>Adjust <code class="language-plaintext highlighter-rouge">DailyReport.gs</code> to add columns by date and the logic for filling in data:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">weekString</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">Sunday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Monday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Tuesday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Wednesday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Thursday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Friday</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Saturday</span><span class="dl">"</span><span class="p">][</span><span class="nx">date</span><span class="p">.</span><span class="nf">getDay</span><span class="p">()];</span> <span class="c1">// Get the day of the week, Sunday is 0, Monday is 1, and so on.</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">dateString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Day</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">weekString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC Traffic) + 5(Mobile Traffic)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">pc_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">mobile_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Registration Count</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">.</span><span class="nx">registers</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">dateColumnIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span> <span class="c1">// Get the existing update or create a new column</span>

    <span class="c1">// Fill in the column content</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">rowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">dateColumnIndex</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">format</span><span class="p">);</span>          
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Get the target Sheet for the given date</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Distinguish Sheets by month, find the current month's Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// If not, create a new monthly Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Naming the monthly Sheet</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Create a new monthly Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Add the current month's Sheet, move it to the first position</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// Add the first column, column name, set Pinned, width 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// Fill in the column names</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set row height</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// Set Pinned for the first two rows (Date, Day)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// Add a total column</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add a column at the last column</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Fill in the total column</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Date...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Day...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Total</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Create or get the date column</span>
  <span class="c1">// Add a column from the most recent day</span>
  <span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// Get the first row (date) data range</span>
    <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Get the values of the data range 0 = first row</span>
    
    <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// Find the corresponding date column Index</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Not Found, find the position of the previous day</span>
      <span class="kd">var</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

      <span class="k">while</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Add a column after the previous day's column</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Default, directly add a column after the first column</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="c1">// Set column width</span>
    <span class="nx">sheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="nx">columnIndex</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">columnIndex</span>
  <span class="p">}</span>

  <span class="c1">// Set column Format style</span>
  <span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">format</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setNumberFormat</span><span class="p">(</span><span class="nx">format</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Fill content into the column</span>
  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Adjust <code class="language-plaintext highlighter-rouge">Main.gs</code> to add data connection and assign values during the build phase:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  
<span class="p">}</span>

<span class="c1">// Simulated partial data that may be obtained from other platform APIs.</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After completion, we return to <code class="language-plaintext highlighter-rouge">Main.gs</code>, select ‚Äúdebug,‚Äù and press debug to check if the execution results are correct and if there are any errors.</p><p><a href="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjIiIGhlaWdodD0iMjQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Back to Google Sheet! Success! We have successfully auto-added the data for that date.</p><h4 id="5-set-up-scheduling-for-daily-automatic-execution"><span class="me-2">5. Set Up Scheduling for Daily Automatic Execution</span><a href="#5-set-up-scheduling-for-daily-automatic-execution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Once the script is complete, you just need to set the automatic trigger conditions to run it daily.</p><p>Adjust <code class="language-plaintext highlighter-rouge">Main.gs</code> to add the <code class="language-plaintext highlighter-rouge">cronjob()</code> function:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// In reality, it is usually the case that today's data checks yesterday's data for complete information</span>
<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Simulated partial data that may be obtained from other platform APIs.</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In the editor, switch to the ‚ÄúTriggers‚Äù tab and select ‚ÄúAdd Trigger‚Äù in the bottom right corner:</p><p><a href="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc4IiBoZWlnaHQ9Ijg4NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Choose the function you want to execute: the newly added <code class="language-plaintext highlighter-rouge">Main.gs</code> function <code class="language-plaintext highlighter-rouge">cronjob</code><li>Choose the deployment to execute: the top (Head, meaning the latest version)<li>Select the event source: time-driven<li>Select the time-based trigger type: daily timer<li>Select the time period: AM 4:00 ‚Äî AM 5:00 (GMT+08:00) Usually, it will execute right at 4:00 AM.<li>Error notification settings: whether to notify immediately when the script encounters an error or to summarize once daily.</ul><p><strong>Save the settings, and you‚Äôre done.</strong></p><p>You can later check the execution log results in the ‚ÄúExecution Items‚Äù tab:</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjQ5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><strong><em>Thus, we have completed the automation of querying, adding data, and filling in data for the report RPA function. üéâüéâüéâ</em></strong></p></blockquote><h4 id="build-a-web-gui-dashboard"><span class="me-2">Build a Web GUI Dashboard</span><a href="#build-a-web-gui-dashboard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Next, there is a secondary requirement: we need to create a simple web display of daily data (similar to a situation room concept) that will be directly shown on a large screen on the team‚Äôs back wall.</p><p><strong>The effect is as shown in the image below:</strong></p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQzNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Add <code class="language-plaintext highlighter-rouge">Web_DailyReport.gs</code> to write code that reads Google Sheets and converts columns and styles into HTML format for presentation:</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">WebDailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">dayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">=</span> <span class="nx">dayCount</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Day</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Daily Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">PC Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Mobile Traffic</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Registration Count</span><span class="dl">"</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="nf">allData</span><span class="p">(</span><span class="nx">startDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sheetRowsIndexs</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while </span><span class="p">(</span><span class="nx">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">-</span> <span class="nx">count</span><span class="p">));</span>
      <span class="kd">const</span> <span class="nx">sheetName</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">targetSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="nx">sheetName</span><span class="p">);</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">targetSheet</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// Get the first row (date) data range</span>
        <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Get the values of the data range 0 = first row</span>
        <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// Find the corresponding date column Index</span>
        
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">sheetRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">targetSheet</span><span class="p">,</span> <span class="nx">sheetRow</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Add the first column</span>
            <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
            <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">columnIndex</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
          <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">count</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">transformResult</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">columnIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">rowIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
</pre></table></code></div></div><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">unshift</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
<span class="p">}</span>

<span class="p">}</span>

<span class="k">return</span> <span class="nx">transformResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Convert field attribute values into display objects</span>
<span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getDisplayValues</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">backgroundColors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getBackgrounds</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">colors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontColorObjects</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">sizes</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontSizes</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">bolds</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontWeights</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">horizontalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getHorizontalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">verticalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getVerticalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>

  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
        <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="nx">row</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">backgroundColor</span><span class="dl">"</span><span class="p">:</span> <span class="nx">backgroundColors</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
        <span class="dl">"</span><span class="s2">color</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">index</span><span class="p">]?.</span><span class="nf">asRgbColor</span><span class="p">()?.</span><span class="nf">asHexString</span><span class="p">()),</span>
        <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="nx">sizes</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
        <span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">:</span> <span class="nx">bolds</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
        <span class="dl">"</span><span class="s2">horizontalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]),</span>
        <span class="dl">"</span><span class="s2">verticalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="nx">verticalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
      <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colorString</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">colorString</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="o">+</span><span class="nx">colorString</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">colorString</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignment</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">horizontalAlignment</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">general-</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">firstColumnRowsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastRow</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Get the data range of the first column</span>
  <span class="kd">const</span> <span class="nx">firstColumnRows</span> <span class="o">=</span> <span class="nx">firstColumnRowsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">();</span> <span class="c1">// Get the values of the data range</span>
  <span class="kd">const</span> <span class="nx">foundIndex</span> <span class="o">=</span> <span class="nx">firstColumnRows</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">firstColumnRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">firstColumnRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">name</span><span class="p">);</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">foundIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">foundIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> <strong>Add Web Request Handle:</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_ Scaffolding</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getDailyReportBody</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_Body</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FOR POST</span>
<span class="c1">// function doPost(e) {</span>
<span class="c1">//  ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw</span>
<span class="c1">// }</span>


<span class="c1">// Simulated partial data that may be obtained from other platform APIs.</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXAMPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Add <code class="language-plaintext highlighter-rouge">Web_DailyReport_ Scaffolding.html</code> Web Dashboard Framework, since our war room screen needs to automatically update content, we create a web skeleton that periodically fetches HTML content using Ajax:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      function onSuccess(html) {
        if (html != null) {
          var div = document.getElementById('result');
          div.innerHTML = html;
        }
     }
     setInterval(()=&gt;{
       google.script.run.withSuccessHandler(onSuccess).getDailyReportBody()
     }, 1000 * 60 * 60 * 1);
     google.script.run.withSuccessHandler(onSuccess).getDailyReportBody();
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;</span>Loading...<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>Add <code class="language-plaintext highlighter-rouge">Web_DailyReport_Body.html</code> where the actual data is rendered into HTML:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
    }
    th, td {
        border: 1px solid #000000;
        padding: 8px;
        text-align: center;
        font-size: 36px;
    }
      <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"text-align:center"</span><span class="nt">&gt;</span>ZHGCHG.LI<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"dataTable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
          <span class="err">&lt;</span>?
          // Display data for the last 7 days
          const dashboard = new WebDailyReport(targetGoogleSheetID, 7);
          // Start from yesterday
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const data = dashboard.allData(yesterday);
          for(const rowIndex in data) {
            const row = data[rowIndex];
            ?&gt;
            <span class="nt">&lt;tr&gt;</span>
              <span class="err">&lt;</span>?
              for(const columnIndex in row) {
                const column = row[columnIndex];
                ?&gt;
                <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: &lt;?=column["</span><span class="err">backgroundColor"]?</span><span class="nt">&gt;</span>; color: <span class="cp">&lt;?=column["color"]?&gt;</span>; text-align: <span class="cp">&lt;?=column["horizontalAlignment"]?&gt;</span>;"&gt;
                  <span class="cp">&lt;?=column["value"]?&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
                <span class="err">&lt;</span>?
              }
              ?&gt;
            <span class="nt">&lt;/tr&gt;</span>
            <span class="err">&lt;</span>?
          }
          ?&gt;
        <span class="nt">&lt;/tbody&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
      <span class="nt">&lt;script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><blockquote><p><strong><em>Please note that we are pulling data for the last 7 days starting from yesterday, and today‚Äôs data will not be displayed.</em></strong></p></blockquote><p>After completing the above steps, the project file directory is as follows:</p><p><a href="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjYiIGhlaWdodD0iNDM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>Test Deployment:</strong></p><p>Click on the ‚ÄúDeploy‚Äù button in the upper right corner of the project -&gt; ‚ÄúTest Deployment Task‚Äù</p><p><a href="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTEiIGhlaWdodD0iNTkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>After deployment is complete, click the URL to view the test results.<li><strong>Please note that this URL is for one-time testing only. If the code is adjusted, you need to click the test deployment task again.</strong></ul><p>If stuck on Loading‚Ä¶ or a server error occurs, you can return to the editor‚Äôs ‚ÄúExecution Items‚Äù tab to check the error messages:</p><p><a href="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjUzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Complete Formal Deployment:</strong></p><p>If the test is fine, you can complete the formal deployment and release the URL.</p><p>Click on the ‚ÄúDeploy‚Äù button in the upper right corner of the project -&gt; ‚ÄúAdd Deployment Task‚Äù -&gt; ‚ÄúSelect Type‚Äù in the upper left corner -&gt; ‚ÄúWeb Application‚Äù:</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Execution identity: Default is the current account (same as Google Apps Script user)<li>Who can access: Set to anyone with the URL can access, or set to only organization can access, which will require Google login to access.<li>After deployment, obtain the URL.</ul><p><strong>Code changes require redeployment to take effect:</strong></p><p>Please note that when the code changes, you need to redeploy (the URL will not change) for the changes to take effect; otherwise, it will always show the old version.</p><p>Click on the ‚ÄúDeploy‚Äù button in the upper right corner of the project -&gt; ‚ÄúManage Deployment Tasks‚Äù:</p><p><a href="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzUiIGhlaWdodD0iMjExIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTkiIGhlaWdodD0iNTg4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTQiIGhlaWdodD0iNTg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Click the pencil üñäÔ∏è ICON in the upper right corner -&gt; ‚ÄúVersion‚Äù -&gt; ‚ÄúCreate New Version‚Äù -&gt; ‚ÄúDeploy‚Äù.</p><p>After deployment is complete, click the URL, or return to the original URL and refresh to see the new changes.</p><h4 id="-done-all-our-rpa-requirements-have-been-completed-"><span class="me-2">üéâüéâ Done! All our RPA requirements have been completed. üéâüéâ</span><a href="#-done-all-our-rpa-requirements-have-been-completed-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Final result:</p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="(Modify the program to supplement this month's data; otherwise, there will only be one record for yesterday under new data)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQzNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>(Modify the program to supplement this month‚Äôs data; otherwise, there will only be one record for yesterday under new data)</p><blockquote><p><a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></p></blockquote><h3 id="complete-google-sheet-demo"><span class="me-2">Complete Google Sheet Demo:</span><a href="#complete-google-sheet-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a><li><strong>Google Apps Script:</strong> <a href="https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit" target="_blank">https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit</a></ul><h3 id="finally-here-are-other-daily-life-applications"><span class="me-2">Finally, here are other daily life applications:</span><a href="#finally-here-are-other-daily-life-applications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line"><span class="me-2">Robotic Process Automation with Google Apps Script ‚Äî Github Repo Star Notifier to Line</span><a href="#robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://medium.com/zrealm-ios-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697" target="_blank" class="img-link shimmer" ><img src="https://miro.medium.com/v2/resize:fit:1200/1*fUtW942huwnSbPF-ar4OCQ.png" alt="" loading="lazy"></a></p><h4 id="robotic-process-automation-with-google-apps-script--notion-database-to-calendar"><span class="me-2">Robotic Process Automation with Google Apps Script ‚Äî Notion Database to Calendar</span><a href="#robotic-process-automation-with-google-apps-script--notion-database-to-calendar" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Previously implemented a simple Notion to Calendar function.</p><blockquote><p><em>The implementation method is that I connect to the Notion API to fetch Database data and apply it to produce an ICS format webpage, which is then deployed as a public webpage; adding this URL to Apple Calendar will suffice.</em></p></blockquote><p><code class="language-plaintext highlighter-rouge">Main.gs</code> :</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre><span class="c1">// Constant variables</span>
<span class="kd">const</span> <span class="nx">notionToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">safeToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parameter</span><span class="p">.</span><span class="nx">token</span> <span class="o">!=</span> <span class="nx">safeToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access Denied!</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">()).</span><span class="nf">setMimeType</span><span class="p">(</span><span class="nx">ContentService</span><span class="p">.</span><span class="nx">MimeType</span><span class="p">.</span><span class="nx">ICAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getQuickNote</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// YOUR FILTER Condition:</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">,</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">YOUR_DATABASE_ID</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="kd">const</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">create</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">created_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">edit</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_edited_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">];</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">endDate</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">startDate</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">endDate</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">multi_select</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">];</span>

    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[</span><span class="dl">"</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="dl">"</span><span class="s2">] </span><span class="dl">"</span><span class="o">+</span><span class="nx">properties</span><span class="p">?.[</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="nx">events</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">create</span><span class="dl">"</span><span class="p">:</span><span class="nx">create</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">edit</span><span class="dl">"</span><span class="p">:</span><span class="nx">edit</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span><span class="nx">start</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">:</span><span class="nx">end</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="nx">description</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">events</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// TO UTC Date</span>
<span class="kd">function</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">icsDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="nx">icsDate</span><span class="p">.</span><span class="nf">setHours</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">.</span><span class="nf">getHours</span><span class="p">()</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyyMMdd'T'HHmmss'Z'</span><span class="dl">"</span><span class="p">);</span><span class="c1">// 20240304T132300Z</span>
<span class="p">}</span>

<span class="c1">// Notion</span>
<span class="kd">function</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.notion.com/v1/databases/</span><span class="dl">'</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="dl">'</span><span class="s1">/query/</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span><span class="o">+</span><span class="nx">notionToken</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Notion-Version</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2022-06-28</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
  <span class="p">};</span> 
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ics.html</code> :</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:NotionCalendar
X-WR-TIMEZONE:Asia/Taipei
BEGIN:VTIMEZONE
TZID:Asia/Taipei
X-LIC-LOCATION:Asia/Taipei
BEGIN:STANDARD
TZOFFSETFROM:+0800
TZOFFSETTO:+0800
TZNAME:CST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
&lt;?
  for(const eventIndex in events) {
    const event = events[eventIndex];
    ?&gt;
BEGIN:VEVENT
DTSTART:&lt;?=event["start"]?&gt;

DTEND:&lt;?=event["end"]?&gt;

DTSTAMP:&lt;?=event["edit"]?&gt;

UID:&lt;?=event["id"]?&gt;

CREATED:&lt;?=event["create"]?&gt;

LAST-MODIFIED:&lt;?=event["edit"]?&gt;

SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:&lt;?=event["title"]?&gt;

DESCRIPTION:&lt;?=event["description"]?&gt;

TRANSP:OPAQUE
END:VEVENT
&lt;?
  }
?&gt;
END:VCALENDAR
</pre></table></code></div></div><p>As before, deploy as a web service, click on the ‚ÄúDeploy‚Äù button in the upper right corner -&gt; ‚ÄúAdd Deployment Task‚Äù -&gt; ‚ÄúSelect Type‚Äù in the upper left corner -&gt; ‚ÄúWeb Application‚Äù:</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Who can access should be set to everyone, as Google login verification cannot be performed when adding to Calendar.</ul><p><a href="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTYiIGhlaWdodD0iMjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Add the URL to the calendar subscription, and it‚Äôs done</strong> üéâüéâüéâüéâ <strong>!</strong></p><h3 id="business-time"><span class="me-2">Business Time</span><a href="#business-time" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If you and your team have automation tools or process integration needs, whether it‚Äôs Slack App development, Notion, Asana, Google Sheet, Google Form, GA data, or various integration needs, feel free to <a href="https://zhgchg.li/contact/" target="_blank"><strong>contact me for development</strong></a>.</p><p>If you have any questions or suggestions, please <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><p>```</p><hr /><p>This article was first published on Medium ‚û°Ô∏è <a href="https://medium.com/p/f6713ba3fee3" target="_blank"><strong>Click Here</strong></a></p><p>Automatically converted and synchronized using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> and <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a>.</p><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2024-04-14-f6713ba3fee3.md" target="_blank">Improve this page on Github.</a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=üç∫&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 3,681 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-14 | 3,598 Views on <a href="https://medium.com/p/f6713ba3fee3" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-robotic-process-automation/">ZRealm Robotic Process Automation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/roboticprocessautomation/" class="post-tag no-text-decoration" >roboticprocessautomation</a> <a href="/tags/rpa-solutions/" class="post-tag no-text-decoration" >rpa-solutions</a> <a href="/tags/google-apps-script/" class="post-tag no-text-decoration" >google-apps-script</a> <a href="/tags/google-sheets/" class="post-tag no-text-decoration" >google-sheets</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implementing%20Daily%20Data%20Report%20RPA%20Automation%20with%20Google%20Apps%20Script%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fen%2Fimplementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implementing%20Daily%20Data%20Report%20RPA%20Automation%20with%20Google%20Apps%20Script%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fen%2Fimplementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fen%2Fimplementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/">Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/">ÈÅäË®ò 2025 ÈüìÂúãÈáúÂ±± 8 Â§© 7 Â§úËá™Áî±Ë°å</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/">ÈÅäË®ò 9/11 ÂêçÂè§Â±ã‰∏ÄÊó•Âø´ÈñÉËá™Áî±Ë°å</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/">ÈÅäË®ò 2023 ‰πùÂ∑û 10 Êó•Ëá™Áî±Ë°åÁç®ÊóÖ</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/">ÈÅäË®ò 2023 ‰∫¨Èò™Á•û 8 Êó•Ëá™Áî±Ë°å</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713107805" data-df="ll" > Apr 14, 2024 </time><h4 class="pt-0 my-2">‰ΩøÁî® Google Apps Script ÂØ¶ÁèæÊØèÊó•Êï∏ÊìöÂ†±Ë°® RPA Ëá™ÂãïÂåñ</h4><div class="text-muted"><p>‰ΩøÁî® Google Apps Script ÈÄ≤Ë°å Google Workspace Áõ∏ÈóúÊúçÂãô‰πã Robotic Process Automation Ëá™ÂãïÂåñ</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637506030" data-df="ll" > Nov 21, 2021 </time><h4 class="pt-0 my-2">Crashlytics + Google Analytics Ëá™ÂãïÊü•Ë©¢ App Crash-Free Users Rate</h4><div class="text-muted"><p>‰ΩøÁî® Google Apps Script ÈÄèÈÅé Google Analytics Êü•Ë©¢ Crashlytics Ëá™ÂãïÂ°´ÂÖ•Âà∞ Google Sheet</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/crashlytics-google-analytics-automatic-query-for-app-crash-free-users-rate-793cb8f89b72/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637506030" data-df="ll" > Nov 21, 2021 </time><h4 class="pt-0 my-2">Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate</h4><div class="text-muted"><p>Using Google Apps Script to automatically query Crashlytics data through Google Analytics and fill it into Google Sheets</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/slack-chatgpt-integration-bd94cc88f9c9/" class="btn btn-outline-primary" aria-label="Older" ><p>Slack & ChatGPT Integration</p></a> <a href="/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/" class="btn btn-outline-primary" aria-label="Newer" ><p>‰ΩøÁî® Google Apps Script ÂØ¶ÁèæÊØèÊó•Êï∏ÊìöÂ†±Ë°® RPA Ëá™ÂãïÂåñ</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> All Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-15 01:21:24 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
