<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="解決每日手動製作 Google Analytics 報表耗時問題，透過 Google Apps Script 實現 RPA 自動化，節省超過180小時工時並減少錯誤，快速建立自動更新 Google Sheet 與 Web Dashboard，提升團隊數據分析效率。" /><meta property="og:description" content="解決每日手動製作 Google Analytics 報表耗時問題，透過 Google Apps Script 實現 RPA 自動化，節省超過180小時工時並減少錯誤，快速建立自動更新 Google Sheet 與 Web Dashboard，提升團隊數據分析效率。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-14T23:16:45+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="twitter:title" content="Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-10-20T14:06:10+08:00","datePublished":"2024-04-14T23:16:45+08:00","description":"解決每日手動製作 Google Analytics 報表耗時問題，透過 Google Apps Script 實現 RPA 自動化，節省超過180小時工時並減少錯誤，快速建立自動更新 Google Sheet 與 Web Dashboard，提升團隊數據分析效率。","headline":"Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/"},"url":"https://zhgchg.li/posts/zrealm-robotic-process-automation/%E4%BD%BF%E7%94%A8-google-apps-script-%E5%AF%A6%E7%8F%BE%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8-rpa-%E8%87%AA%E5%8B%95%E5%8C%96-f6713ba3fee3/"}</script><title>Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略</h1><p class="post-desc fw-light mb-4">解決每日手動製作 Google Analytics 報表耗時問題，透過 Google Apps Script 實現 RPA 自動化，節省超過180小時工時並減少錯誤，快速建立自動更新 Google Sheet 與 Web Dashboard，提升團隊數據分析效率。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1713107805" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 14, 2024 </time> </span> <span> Updated <time data-ts="1729404370" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 20, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link preview-img blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="10713 words" > <em>59 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Google Apps Script 自動化報表｜2024 RPA 範例教學與實作攻略</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><p>For SEO purposes, <strong>all post titles and descriptions were rewritten by OpenAI</strong>, the original versions are shown below.<br /> <a href="/posts/en/f6713ba3fee3/"><strong>Click here</strong></a> to view the English version of this article, translated by OpenAI.</p><hr /><h3 id="使用-google-apps-script-實現每日數據報表-rpa-自動化"><span class="me-2">使用 Google Apps Script 實現每日數據報表 RPA 自動化</span><a href="#使用-google-apps-script-實現每日數據報表-rpa-自動化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>使用 Google Apps Script 進行 Google Workspace 相關服務之 Robotic Process Automation 自動化</p><p><a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Possessed Photography</a></p><h3 id="robotic-process-automation"><span class="me-2">Robotic Process Automation</span><a href="#robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>RPA (Robotic Process Automation) 中文翻譯為「流程自動化機器人」回顧人類發展歷史，從徒手採集到石器時代再到農耕文明，從上個世紀的工業革命開始到近 20 年的資訊崛起，人類的工作效率與產能有了指數級的飛躍成長；這一路上無處不在 RPA 應用的身影，農耕時期的水車(自動化脫穀工作)、工業革命的紡織機(自動化紡織工作)、工廠機械手臂(自動化組裝工作)，最後是本篇要介紹的，自動化資訊相關工作，例如：自動查詢報表、自動通知…等等工作。</p><p>說來慚愧，我也是最近才知道這個名詞，打從從第一份工作開始 (7 年前)，就一直有在做 RPA 的事，諸如撰寫爬蟲統計數據、自動化 CI/CD 流程、自動化查詢數據、自動化穩定性數據告警、自動化每日例行操作…等等；不過以往我都以「自動化」三個字作為代稱，是時候給他一個正名了 — RPA (Robotic Process Automation)。</p><p><strong>之前所做的 RPA 更多只關注在「動手寫程式實現自動化工作解決單一問題」上</strong> ，少了前期的完整評估與分析、No/Low Code 工具使用、法規、運行監控、實際數據統計、持續改進、企業文化推廣…等等，這都是完整的 RPA 需要做的事；不過如同前面所說，我也是最近才知道這個專業領域，就容我還是先以實作方面水一篇文章吧！</p><p>提供 RPA 服務的平台有很多，例如 Automation Anywhere,UiPath, Microsoft Power Automate, Blue Prism 或是 Zapier, IFTTT, Automate.io … 要依照實際想解決的問題與平台挑選適合的服務。</p><p>推薦一套免費開源基於瀏覽器的 RPA Tool: <a href="https://chromewebstore.google.com/detail/automa/infppggnoaenmfagbfknfkancpbljcca" target="_blank">Automa</a> 。</p><blockquote><p><strong><em>另外廣義來說，將人與人或人與事的主動依賴轉化成人對平台、事對平台的依賴也是一種 RPA。</em></strong></p></blockquote><blockquote><p><strong><em>例如：統一使用 Asana/Jira…等專案管理工具統一管理工作事項。</em></strong></p></blockquote><blockquote><p><strong><em>基於主動轉被動的理念，原本需要人工上去檢查有無新通知的服務，我們也可以實現一個 RPA，當有新變動時自動通知我們。</em></strong></p></blockquote><blockquote><p><strong><em>例如：之前實現過的 <a href="/posts/zrealm-dev/運用-google-apps-script-轉發-gmail-信件到-slack-d414bdbdb8c9/">Gmail to Slack</a> 將特定通知信件轉發到工作群組。</em></strong></p></blockquote><h4 id="robotic-process-automation-的效益評估"><span class="me-2">Robotic Process Automation 的效益評估</span><a href="#robotic-process-automation-的效益評估" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>之前在「 <a href="/posts/pinkoi-engineering/2021-pinkoi-tech-career-talk-高效率工程團隊大解密-11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密</strong></a> 」分享過積少成多及心流中斷的成本問題；假設一件例行重複性的工作，每次需要花費 15 分鐘解決，每週會發生 10 次，一年下來就浪費將近 130 小時；如果再算上「心流切換」成本，最終可能浪費近 200 小時一年。</p><p><a href="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" alt="[**2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密**](/posts/pinkoi-engineering/2021-pinkoi-tech-career-talk-高效率工程團隊大解密-11f6c8568154/)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTIiIGhlaWdodD0iNTA1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/posts/pinkoi-engineering/2021-pinkoi-tech-career-talk-高效率工程團隊大解密-11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — 高效率工程團隊大解密</strong></a></p><blockquote><p>心流切換的意思是，當我們專注在重要的事情上做得正 High! 時，需要暫停去處理其他事情，處理完畢再回來重新進入狀態所耗費的時間。</p></blockquote><p>開發 RPA 的效益評估可參考下圖，只要開發所需時間跟遇到的頻率大於所浪費的時間，就值得投入資源實現：</p><p><a href="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" alt="[https://twitter.com/swyx/status/1196401158744502272](https://twitter.com/swyx/status/1196401158744502272){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijk1NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://twitter.com/swyx/status/1196401158744502272" target="_blank">https://twitter.com/swyx/status/1196401158744502272</a></p><ul><li>X 軸：任務發生頻率 ex: 50/Day (50次一天)<li>Y 軸：任務每次需花費多少人力時間才能完成<li>耗費時間 Range 抓 5 年來算，表格中間表示 5 年下來浪費的時間人力成本<li>白色為可能投入做自動化的時間成本大於能得到的效益，不值得改善<li>綠色表示值得自動化的項目<li>紅色為強烈建議轉為自動化</ul><blockquote><p><strong><em>除了節省時間之外，自動的制式化流程也能減少人工出錯機率，提升穩定性。</em></strong></p></blockquote><h4 id="robotic-process-automation-跟-ai-的關係"><span class="me-2">Robotic Process Automation 跟 AI 的關係</span><a href="#robotic-process-automation-跟-ai-的關係" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>隨著 AI 興起，RPA 也經常被提及；但我覺得 RPA 與 AI 並無直接關係， <strong>沒有 AI 的年代早就有 RPA，企業導入 AI 的幫助可能還沒有完善 RPA 的效益來得高，RPA 更多的還是企業文化、工作習慣的問題</strong> ；不過不可否認 AI 確實能幫助 RPA 邁向下一個層次，例如以往 RPA 只能做確切、例行的工作，有了 AI 就能做一些模糊的、較動態的、智能判斷的工作。</p><h3 id="robotic-process-automation-at-google-workspace"><span class="me-2">Robotic Process Automation at Google Workspace</span><a href="#robotic-process-automation-at-google-workspace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Google Workspace (舊稱 G Suite)，是我們日常辦公協作的好夥伴，信箱使用 Gmail 託管、文件放在 Google Doc、報表使用 Google Sheet、表單使用 Google Form…等等，這些服務之間的串接或是與內外部系統的溝通，都需要我們實現 RPA 來完成。</p><p>但 Google 並沒有提供直接的 RPA 服務，可以透過以下幾個服務達成：</p><ul><li>No Code： <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> (付費服務)，讓非開發人員直接透過 GUI 搭建服務串接自動化。<li>Low Code： <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> (免費服務)，簡單撰寫程式就能快速直接的橋接 Google 服務、外部/內部系統。<li>Function as a Service： <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> (付費服務，提供免費額度)，撰寫完整程式碼、服務，透過 Google Cloud 部署直接執行。</ul><p>No Code 平台 <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> 我沒接觸過， <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> 與 <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> 算蠻有經驗的，以下是一些個人之前的使用與選擇經驗分享：</p><h4 id="cloud-functions"><span class="me-2">Cloud Functions</span><a href="#cloud-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>需部署執行<li>支援使用多種程式語言撰寫：Node.js, Python, Java, Go, PHP, Ruby…<li>支援第三方套件依賴管理、安裝並使用<li>支援完整身份驗證機制<li>最多執行時間上限： 60 分鐘<li>用多少算多少：依照次數、執行時間、不同處理器、使用的記憶體收費<li>受限冷啟動問題(太久沒呼叫，再次呼叫，第一次會需要較長響應時間)<li>無法直接串接 Google 服務，需要走 Auth/API 驗證<li><strong>免費方案如下</strong> Cloud Functions 針對運算時間資源提供永久免費方案，當中包括 GB/秒和 GHz/秒的分配方式。除了 200 萬次叫用以外，這個免費方案也提供 400,000 GB/秒和 200,000 GHz/秒的運算時間，以及每月 5 GB 的網際網路資料傳輸量。免費方案的使用額度，是以上述級別 1 價格的同等美元金額計算。無論執行函式的區域採用的是級別 1 和/或級別 2 價格，系統都會分配同等美元金額給您。不過在扣除免費方案的額度時，系統將以函式執行區域的級別 (級別 1 或級別 2) 為準。 請注意，即便您採用的是免費方案，也必須擁有有效的帳單帳戶。</ul><p>總結來說，Cloud Functions 可以提供較完整與複雜的 RPA 串接功能或是有較多的外部 API 串接需求時比較建議使用 Cloud Functions。</p><p>之前使用過 Cloud Functions 的案例有：</p><ul><li>[Slack ChatGPT 對話機器人]： <a href="/posts/zrealm-dev/slack-chatgpt-integration-bd94cc88f9c9/">Slack &amp; ChatGPT Integration</a><li>[自動簽到機器人]： <a href="/posts/zrealm-dev/使用-python-google-cloud-platform-line-bot-自動執行例行瑣事-70a1409b149a/">使用 Python+Google Cloud Platform+Line Bot 自動執行例行瑣事</a></ul><p>都是與非 Google Workspace 服務整合且須橋接其他外部服務時我會使用。</p><h4 id="google-apps-script"><span class="me-2">Google Apps Script</span><a href="#google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>方便簡單快速<li>完全免費<li>串接服務無需繁瑣複雜的 Auth 身份驗證 (Google Apps Script 是直接使用當前執行的帳號做為執行身份)<li>內建排程、行事曆觸發器功能<li>使用 Google 網路執行網路請求<li>只能使用 Google Apps Script (基於 JavaScript) 的語言開發<li>不支援套件管理工具、無版控功能<li><strong>基於安全問題， <a href="https://issuetracker.google.com/issues/36758197" target="_blank">無法客製化 Request User-Agent 資訊</a></strong><li><strong>執行時間上限，腳本必須在 6 分鐘內完成工作，否則會被終止。</strong><li>其他限制與配額請參考官方的 <a href="https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw" target="_blank">GAS 資訊</a> ：</ul><p><a href="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzUiIGhlaWdodD0iMTA0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzAiIGhlaWdodD0iODMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>之前使用過 Google Apps Script 的案例有：</p><ul><li>[串接 Slack x Google Form x Google Sheet]： <a href="/posts/zrealm-dev/slack-打造全自動-wfh-員工健康狀況回報系統-d61062833c1a/">Slack 打造全自動 WFH 員工健康狀況回報系統</a><li>[串接 Slack x Gmail]： <a href="/posts/zrealm-dev/運用-google-apps-script-轉發-gmail-信件到-slack-d414bdbdb8c9/">運用 Google Apps Script 轉發 Gmail 信件到 Slack</a><li>[串接 Google Analytics x Slack]： <a href="/posts/zrealm-dev/crashlytics-google-analytics-自動查詢-app-crash-free-users-rate-793cb8f89b72/">Crashlytics + Google Analytics 自動查詢 App Crash-Free Users Rate</a><li>[串接 Firebase Crashlytics x Big Query x Slack]： <a href="/posts/zrealm-dev/crashlytics-big-query-打造更即時便利的-crash-追蹤工具-e77b80cc6f89/">Crashlytics + Big Query 打造更即時便利的 Crash 追蹤工具</a><li>[串接 Github x LineBot]： <a href="/posts/zrealm-dev/使用-google-apps-script-三步驟免費建立-github-repo-star-notifier-382218e15697/">使用 Google Apps Script 三步驟免費建立 Github Repo Star Notifier</a></ul><p>受限於執行時間與 API Request 客製化限制，只有簡單快速的服務我會使用 Google Apps Script 達成；或是需要與 Google 服務串接的需求，我會優先選擇使用 Google Apps Script (因為用 Cloud Functions 要多實現完整的 Google 服務身份驗證流程)。</p><h3 id="robotic-process-automation-with-google-apps-script--工作日報表-google-sheet-x-google-analytics"><span class="me-2">Robotic Process Automation with Google Apps Script — 工作日報表 (Google Sheet x Google Analytics)</span><a href="#robotic-process-automation-with-google-apps-script--工作日報表-google-sheet-x-google-analytics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>終於來到本篇的主題，使用 Google Apps Script 實現 Google 服務 RPA 自動化。</p><h4 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>產品團隊需要每日查詢 Google Analytics 數據並填寫到 Google Sheet 數據報表上，共團隊分析趨勢使用；並將每日數據內容發佈到 Dashboard 螢幕上，讓所有成員掌握目前狀況。</p><p>同事每日一到公司就要花大約 30 分鐘左右完成此任務；如果有其他事要處理就需要等到這件例行工作完成才會開始或會延後發布每日數據訊息。</p><p><strong>簡單估計一下 RPA 效益：</strong></p><ul><li>每年消耗支出： 1 人 x 30 mins x 365 天(假日數據也要補) <strong>= 182 hours</strong><li>建立自動化成本： 以此案例來說，約需耗費 1 人 x 5天 <strong>= 40 hours</strong></ul><blockquote><p>因此我們只需要投入一週開發時間，就能長遠解決負責查數據同事的工作消耗，他就可以把精力放在更重要的事情上。</p></blockquote><h4 id="目標"><span class="me-2">目標</span><a href="#目標" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我們的目標是使用 Google Apps Script 建立一個 RPA 自動從 Google Analytics 與內部系統報表 API 撈取每日數據並填入 Google Sheet，與搭建一個 Web UI Dashboard。</p><h4 id="最終效果"><span class="me-2">最終效果</span><a href="#最終效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjMyMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a></ul><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></ul><blockquote><p><strong><em>數據為假數據，純 Demo 使用；從 2024/04/13 開始會特別低或都保持在 0，因為我的 zhgchg.li GA 真的是「0」流量 Q_Q。</em></strong></p></blockquote><h4 id="需完成的任務"><span class="me-2">需完成的任務</span><a href="#需完成的任務" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>建立 Google Apps Script、熟悉編輯器<li>取得/建立對應日期的 Sheet<li>串接 Google Analytics 撈取數據<li>填充資料<li>設定排程，每日自動執行</ol><h4 id="聲明"><span class="me-2">聲明</span><a href="#聲明" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>因文章說明需求，以下程式碼會盡可能少一點抽象，增加說明性，您可依照自己實際的需求進行改寫。</p><blockquote><p><strong><em>文末有附上完整公開的 Google Sheet &amp; Google Apps Script，如果你懶得一步一步走，可以直接從文末附的範本去修改。</em></strong></p></blockquote><h4 id="step-1-建立-google-apps-script"><span class="me-2">Step 1. 建立 Google Apps Script</span><a href="#step-1-建立-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iMjU5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>只需在我們要導入自動化的報表上選擇「擴充功能」-&gt;「Apps Script」就能自動建立與 Google Sheet 報表連結的 Google Apps Script。</p><p>另外也可以直接從 Google Apps Script 首頁建立 <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> ，不過這樣就不會與 Google Sheet 產生連結。</p><blockquote><p><strong>並非需要連結才能操作對應 Google Sheet</strong> ，兩種建立方式都可以，差別在於 Script 的所有權歸於誰，如果是連結報表的就是歸報表擁有者，如果是自己建立的就是歸建立著；擁有者會關係到假設該帳號因離職停用，腳本是否會失效被刪除。</p></blockquote><p><a href="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>腳本建立後，我們可以先從上方 Rename 我們的腳本專案名稱。</p><h4 id="google-apps-script-基礎知識"><span class="me-2">Google Apps Script 基礎知識</span><a href="#google-apps-script-基礎知識" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>再到下一步撰寫程式之前，先補充一些 Google Apps Script 的基礎知識。</p><p><strong>關於編輯器</strong></p><p>預設引入 Google 服務的 SDK (不需特別引入即可呼叫使用)：</p><ul><li>CalendarApp 行事曆<li>DocumentApp Google Drive<li>FormApp Google Form<li>SpreadsheetApp Google Sheet<li>GmailApp Gmail<li><a href="https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle" target="_blank">其他…</a></ul><p><a href="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODkiIGhlaWdodD0iMzQzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ol><li>檔案： 可新增多個 .gs 檔案存放不同物件程式碼，方便整理；所有檔案都會在同個 Namespace、生命週期下執行，因此要注意物件名稱、變數名稱如果重複可能會互相覆蓋。 除 .gs 指令碼 檔案外，也能新增 .html HTML Template 檔案，用於渲染 Web UI。(後面會再介紹)<li>資料庫： 別人撰寫好的資料庫 (a.k.a Lib) 我們可以透過他的 Script ID 引入使用，當然我們撰寫好的程式也能部署成資料庫給別人用。 另外也有一些大神幫忙封裝的工具可以用，缺點是只能從 Google 搜尋 Script ID，官方並沒有正式的資料庫列表共查詢使用。 e.g. HTML Parser Tool Cheer.io Script ID: <code class="language-plaintext highlighter-rouge">1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0</code><li>服務： Google 服務的 SDK，預設沒有引入的服務可以再此追加引入使用。 e.g. Google Analytics Data<li>還原、下一步操作<li>儲存 或 Control + s<li>執行 或 Control + r 遇到錯誤直接在 Console 提示並終止腳本<li>偵錯 有下 Break point (10) 的地方執行到會暫停中斷並跳出右側 Debug View，可按繼續執行 遇到錯誤會暫停中斷並跳出右側 Debug View<li>偵錯、執行的目標方法(Function Name) 僅能選擇當前選擇的檔案所擁有的方法。<li>查看編輯器執行紀錄</ol><blockquote><p><em>另外還有一點就是排版，有的瀏覽器按下「Control + [」進行縮排時會觸發返回上一頁，這點要注意！</em></p></blockquote><p><a href="https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo" target="_blank"><strong>Google Apps Script GitHub Assistant Chrome Extension 版控外掛</strong></a></p><ul><li>建議安裝此 Extension 讓 Google Apps Script 與 git 串接，使其有版本控制功能，防止心血不小心改壞。</ul><p><a href="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIxIiBoZWlnaHQ9IjE5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTkiIGhlaWdodD0iMjM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTQiIGhlaWdodD0iNjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>如果遇到 Push/Pull Error 或點了沒反應，請先按照上面步驟「選項」-&gt; 連接 Github or 重新驗證一次 Google 授權，即可。</ul><p><strong>Logger Message</strong></p><p>可使用以下 Script 搭配 Debug 就能在底下 Console Print 出 Debug Log。</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hi</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>執行紀錄、錯誤資訊</strong></p><p>如果在編輯器上執行時的 Log 或報錯會直接顯示，如果要查訊執行紀錄或自動執行時發生的錯誤，可到「執行項目」頁籤查看。</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjQ5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>自動觸發</strong></p><p><a href="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzYiIGhlaWdodD0iMzEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzQiIGhlaWdodD0iNzc3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>「觸發條件」頁籤可設定腳本中的方法該如何自動觸發執行，可以設定的自動觸發條件有：</p><ul><li>當 Google Sheet：開啟時、編輯時、內容變更時、提交表單時 執行<li>排程週期觸發：每 X 分鐘、X 小時、X 日、X 週、X 月 執行一次<li>特定日期觸發：YYYY-MM-DD HH:MM 時執行<li>當 行事曆：更新時 執行</ul><p>錯誤通知設定，可設定當腳本執行出錯時如何通知你。</p><p><strong>授予執行權限身份</strong></p><blockquote><p><strong><em>首次執行/部署或新增引入的服務、資源，都需要重新跑一次身份授權，授權完之後的執行都會用你授權的身份執行，所以也要確保你授權(通常是當前)的帳號有該資源、服務的權限。(e.g. 例如要有該 Google Sheet 權限)。</em></strong></p></blockquote><p>跳出帳號選擇 Pop-up 後選擇授權執行的帳號(通常是選當前 Google Apps Script 帳號)：</p><p><a href="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjQiIGhlaWdodD0iNTIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>出現「Google hasn’t verified this app」因為我們要開發的 App 是給自己用的，不需經過 Google 驗證。</p><p>直接點擊「Advanced」-&gt;「Go to XXX (unsafe)」-&gt;「Allow」即可：</p><p><a href="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMzMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTgiIGhlaWdodD0iNDU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjgiIGhlaWdodD0iNzIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>完成授權後就能成功執行腳本，如果沒有改動資源不需要再重新授權。</p><h4 id="2-取得建立對應日期的-sheet"><span class="me-2">2. 取得/建立對應日期的 Sheet</span><a href="#2-取得建立對應日期的-sheet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>了解完基礎知識後，我們就可以撰寫第一個功能的程式了。</p><p>我們建立以下多個檔案方便我們存放不同物件</p><p><code class="language-plaintext highlighter-rouge">DailyReportStyle.gs</code> 欄位樣式物件：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">HeaderStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#e3284b</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ContentStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#000000</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">HeaderDateStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#001a40</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReportField.gs</code> 欄位資料物件：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReportField</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">headerStyle</span><span class="p">,</span> <span class="nx">contentStyle</span><span class="p">,</span> <span class="nx">format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">headerStyle</span> <span class="o">=</span> <span class="nx">headerStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">contentStyle</span> <span class="o">=</span> <span class="nx">contentStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReport.gs</code> 報表主程式邏輯：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC 流量) + 5(Mobile 流量)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">註冊數</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1">// 日流量公式分解說明：</span>
    <span class="c1">// 1. COLUMN() 函數會回傳目前單元格的列號碼。</span>
    <span class="c1">// 2. ADDRESS(1, COLUMN(), 4) 會以給定的行數（`COLUMN()` 的結果）和固定的列數（1）來生成一個絕對引用的地址。其中，第三個參數 4 表示不帶任何美元符號（$）的相對地址。比如，如果你在第三列的任何單元格中使用這個函數，它會回傳 "C1"。</span>
    <span class="c1">// 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") 會將 ADDRESS 函數產生的地址中的數字 1 移除，因此只保留了列的英文字母，比如："C"。</span>
    <span class="c1">// 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 4) 這邊 &amp; 4 其實應該是 &amp;4。`SUBSTITUTE` 函數的結果會和數字 4 連接，形成 "C4" 這樣的字符串，然後 INDIRECT 函數會將這個字符串轉換成對應的單元格引用。所以，如果你在列 C 中的任何單元格使用此公式，它會引用 C4。</span>
    <span class="c1">// 5. 類似地，`INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 5)` 會引用相同列的第五行的單元格。比如，如果你在列 C 中的任何單元格使用此公式，它會引用 C5。</span>
    <span class="c1">// 6. 最後，這兩個 INDIRECT 函數引用的單元格值相加。</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>

  <span class="p">}</span>

  <span class="c1">// 取得給定日期的目標 Sheet</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 以月來區分 Sheet，找到當月 Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 無則建立新的月 Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 月 Sheet 命名規則</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 建立新的月 Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 新增當月 Sheet，移動到第一個位子</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// 新增第一欄，欄位名稱、設定 Pinned、寬度 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// 填充欄位名稱</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 設定欄高</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// 設定 Pinned 第一、二列(日期、星期)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// 新增總計欄位</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 新增一欄在最後一欄</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// 填充總計欄位</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 日期...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">總計</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 星期...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">總計</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>

        <span class="c1">// 1. IFERROR(value, [value_if_error]) 函數用於判斷公式中是否存在錯誤，並在有錯誤時返回指定的值。它接受兩個參數：`value` 是需要計算的表達式或函數，`value_if_error` 是當 value 發生錯誤時返回的值。在這個情境下，如果 SUM 函數中的計算發生錯誤，則返回 0。</span>
        <span class="c1">// 2. SUM(range) 函數用於計算範圍內所有數字的總和。</span>
        <span class="c1">// 3. INDIRECT(ref_text, [is_A1_notation]) 函數將文字字串轉換成單元格引用。這裡使用 INDIRECT 函數是為了動態生成所需的參照範圍。</span>
        <span class="c1">// 4. SUBSTITUTE(text, old_text, new_text, [instance_num]) 函數在文字字串中替換指定的文字。這裡使用 SUBSTITUTE 是為了將 ADDRESS 函數回傳的地址中的 "1" 替換成其他內容。</span>
        <span class="c1">// 5. ADDRESS(row, column, [abs_num], [a1], [sheet]) 函數根據給定的行列號碼回傳對應的單元格地址。在這裡，ADDRESS(1, 1, 4) 生成了第一行第一列的單元格地址，但是由於 abs_num 是 4，所以地址不包含工作表名稱和固定符號 $。類似地，`ADDRESS(1, COLUMN() - 1, 4)` 產生了從第一行到當前列前一列的單元格地址。</span>
        <span class="c1">// 6. COLUMN() 函數回傳當前單元格的列號。</span>
        <span class="c1">// 7. summaryRowIndex = 所在列     </span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> 做為主程式入口：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTgwIiBoZWlnaHQ9IjM1MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>完成後我們回到「 <code class="language-plaintext highlighter-rouge">Main.gs</code> 」選擇「debug」並按下偵錯，查看執行結果是否正確、有無出錯。</p><p><a href="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjMiIGhlaWdodD0iMjY0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>執行正確回到報表會出現當前新月份，並帶入預設欄位與總計欄位，如果已存在則不會有反應。</p><h4 id="3-串接-google-analytics-撈取數據"><span class="me-2">3. 串接 Google Analytics 撈取數據</span><a href="#3-串接-google-analytics-撈取數據" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先需要新增「AnalyticsData」服務：</p><p><a href="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ5IiBoZWlnaHQ9Ijc1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>使用 GA4 Debug Tool 構建查詢條件：</p><ul><li><a href="https://ga-dev-tools.google/ga4/query-explorer/" target="_blank">https://ga-dev-tools.google/ga4/query-explorer/</a><li>可邊比照 GA 4 後台篩選條件構建<li><strong>本文以查詢 Sessions 數為例，區分裝置 Grouping</strong></ul><p>登入授權後選擇目標資源：</p><p><a href="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjQiIGhlaWdodD0iMjUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>記下 property 底下顯示的數字，即為你要查詢的資源 GA Property ID。</p><p>設定查詢參數、Filter 條件：</p><p><a href="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NTciIGhlaWdodD0iNDczIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>按下「Make Reqeust」取得 Response 結果：</p><p><a href="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDciIGhlaWdodD0iODg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可同步比較 GA 4 後台同樣條件的數據是否相同，如果落差太大可能是有 Filter 條件沒有加到，要再檢查一下。</p><h4 id="小記"><span class="me-2">小記</span><a href="#小記" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>附上一個行銷同事發現的小坑，GA 有些數據會有延遲問題，可能今天查的跟昨天查的數字會不一樣(例如跳出率)，因此最好能將資料回溯幾天才能卻保值是最終的數字。</p><blockquote><p><em>GA Debug Tool 沒問題之後我們就能將它轉換為 Google Apps Script。</em></p></blockquote><p>新增一個 <code class="language-plaintext highlighter-rouge">GAData.gs</code> 檔案：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="c1">// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined</span>
<span class="c1">// GA Debug Toole: https://ga-dev-tools.web.app/ga4/query-explorer/</span>

<span class="kd">class</span> <span class="nc">GAData</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">traffic</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">fetchGADailyUsage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pc_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mobile_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nf">fetchGADailyUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">dimensionPlatform</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newDimension</span><span class="p">();</span>
    <span class="nx">dimensionPlatform</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">deviceCategory</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newMetric</span><span class="p">();</span>
    <span class="nx">metric</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">sessions</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateRange</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newDateRange</span><span class="p">();</span>
    <span class="c1">// 預設查詢給定日範圍內資料 e.g. 2024-01-01 ~ 2024-01-01</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">startDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getDateString</span><span class="p">();</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">endDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getDateString</span><span class="p">();</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// const filter = AnalyticsData.newFilter();</span>
    <span class="c1">// filter.fieldName = "landingPagePlusQueryString";</span>
    <span class="c1">// const stringFilter = AnalyticsData.newStringFilter()</span>
    <span class="c1">// stringFilter.value = "/life|/article|/chat|/house|/event/230502|/event/230310";</span>
    <span class="c1">// stringFilter.matchType = "PARTIAL_REGEXP";</span>
    <span class="c1">// filter.stringFilter = stringFilter;</span>
    <span class="c1">// filterExpression.filter = filter;</span>

    <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newRunReportRequest</span><span class="p">();</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="nx">dimensionPlatform</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="nx">metric</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dateRanges</span> <span class="o">=</span> <span class="nx">dateRange</span><span class="p">;</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// filterExpression.expression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = filterExpression;</span>
    <span class="c1">// or Not</span>
    <span class="c1">// const notFilterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// notFilterExpression.notExpression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = notFilterExpression;</span>

    <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nf">runReport</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="dl">"</span><span class="s2">properties/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">gaPropertyId</span><span class="p">).</span><span class="nx">rows</span><span class="p">;</span>
    <span class="c1">// 無資料</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">report</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}]</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">report</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">element</span><span class="p">.</span><span class="nx">dimensionValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">metricValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">getDateString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM-dd</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> 新增測試內容：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">gaData</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>按下執行或偵錯取得程式撈取結果：</p><p><a href="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDAiIGhlaWdodD0iMTU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>OK! 比對相符。</p><p><a href="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMzgiIGhlaWdodD0iMzUxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>此步驟完成時，目錄檔案結構如上圖。</p><h4 id="4-填充資料"><span class="me-2">4. 填充資料</span><a href="#4-填充資料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>建好 Sheet、查好資料後，再來就是填充資料到欄位中。</p><p>調整 <code class="language-plaintext highlighter-rouge">DailyReport.gs</code> 增加 by 日期新增欄位＆填充資料的邏輯：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">weekString</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">星期日</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">星期一</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期二</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期三</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期四</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期五</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期六</span><span class="dl">"</span><span class="p">][</span><span class="nx">date</span><span class="p">.</span><span class="nf">getDay</span><span class="p">()];</span> <span class="c1">// 取得星期，星期日為0，星期一為1，以此類</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">dateString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">weekString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC 流量) + 5(Mobile 流量)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">pc_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">mobile_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">註冊數</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">.</span><span class="nx">registers</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">dateColumnIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span> <span class="c1">// 取得已存在的更新或建立新的欄位</span>

    <span class="c1">// 填充欄位內容</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">rowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">dateColumnIndex</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">format</span><span class="p">);</span>          
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 取得給定日期的目標 Sheet</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 以月來區分 Sheet，找到當月 Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 無則建立新的月 Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 月 Sheet 命名</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 建立新的月 Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 新增當月 Sheet，移動到第一個位子</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// 新增第一欄，欄位名稱、設定 Pinned、寬度 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// 填充欄位名稱</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 設定欄高</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// 設定 Pinned 第一、二列(日期、星期)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// 新增總計欄位</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 新增一欄在最後一欄</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// 填充總計欄位</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 日期...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">總計</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 星期...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">總計</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 建立或取得日期的欄位</span>
  <span class="c1">// 從最近一日往後加一欄位</span>
  <span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// 取得第一列(日期)資料範圍</span>
    <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 取得資料範圍的值 0 = 第一列</span>
    
    <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// 找到對應日期的欄位 Index</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Not Found，找到前一日的位子</span>
      <span class="kd">var</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

      <span class="k">while</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 在前一日欄位後新增一欄</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 默認，直接新增一欄在第一欄後面</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="c1">// 設定欄位寬度</span>
    <span class="nx">sheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="nx">columnIndex</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">columnIndex</span>
  <span class="p">}</span>

  <span class="c1">// 設定欄位 Format 樣式</span>
  <span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">format</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setNumberFormat</span><span class="p">(</span><span class="nx">format</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 填充內容到欄位</span>
  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>調整 <code class="language-plaintext highlighter-rouge">Main.gs</code> 增加資料串接並在構建階段賦值：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  
<span class="p">}</span>

<span class="c1">// 模擬部分數據資料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>完成後我們回到「 <code class="language-plaintext highlighter-rouge">Main.gs</code> 」選擇「debug」並按下偵錯，查看執行結果是否正確、有無出錯。</p><p><a href="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjIiIGhlaWdodD0iMjQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>回到 Google Sheet! 成功! 我們成功的自動新增了該日期的資料。</p><h4 id="5-設定排程每日自動執行"><span class="me-2">5. 設定排程，每日自動執行</span><a href="#5-設定排程每日自動執行" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>腳本完成後，再來只要設定自動觸發條件，就能每日自動完成囉。</p><p>調整 <code class="language-plaintext highlighter-rouge">Main.gs</code> 新增 <code class="language-plaintext highlighter-rouge">cronjob()</code> function:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 照現實狀況來說，通常是今日查昨日數據，才是完整的資料</span>
<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 模擬部分數據資料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>在編輯器上切換到「觸發條件」頁籤，選擇右下角「新增觸發條件」：</p><p><a href="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc4IiBoZWlnaHQ9Ijg4NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>選擇您要執行的功能：剛新增的 <code class="language-plaintext highlighter-rouge">Main.gs</code> Function <code class="language-plaintext highlighter-rouge">cronjob</code><li>選擇應執行的部署作業：上端 (Head, 意為最新版)<li>選取活動來源：時間驅動<li>選取時間型觸發條件類型：日計時器<li>選取時段：AM 4:00 — AM 5:00 (GMT+08:00) 通常在 AM 4:00 一到就會執行。<li>錯誤通知設定：當腳本發生錯誤時是要馬上通知，還是每日彙整一次</ul><p><strong>儲存設定，完成。</strong></p><p>之後可以去「執行項目」頁籤查看執行紀錄結果：</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjQ5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><strong><em>至此我們已完成自動化查詢、新增資料、填入資料的報表 RPA 功能．🎉🎉🎉</em></strong></p></blockquote><h4 id="搭建-web-gui-dashboard"><span class="me-2">搭建 Web GUI Dashboard</span><a href="#搭建-web-gui-dashboard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>再來有個次要需求，我們需要建立一個簡單的 Web 呈現每日數據（類似戰情中心的概念）會在團隊背後牆上大螢幕上直接顯示。</p><p><strong>效果如下圖：</strong></p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>新增 <code class="language-plaintext highlighter-rouge">Web_DailyReport.gs</code> 撰寫讀取 Google Sheet 並將欄位、樣式轉換為 HTML 格式呈現：</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">WebDailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">dayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">=</span> <span class="nx">dayCount</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">註冊數</span><span class="dl">"</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="nf">allData</span><span class="p">(</span><span class="nx">startDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sheetRowsIndexs</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while </span><span class="p">(</span><span class="nx">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">-</span> <span class="nx">count</span><span class="p">));</span>
      <span class="kd">const</span> <span class="nx">sheetName</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">targetSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="nx">sheetName</span><span class="p">);</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">targetSheet</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// 取得第一列(日期)資料範圍</span>
        <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 取得資料範圍的值 0 = 第一列</span>
        <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// 找到對應日期的欄位 Index</span>
        
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">sheetRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">targetSheet</span><span class="p">,</span> <span class="nx">sheetRow</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 新增第一欄</span>
            <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
            <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">columnIndex</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
          <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">count</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">transformResult</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">columnIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">rowIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>

        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">unshift</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span>
        
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">transformResult</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 轉換 欄位屬性 值成 顯示用物件</span>
  <span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getDisplayValues</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">backgroundColors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getBackgrounds</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">colors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontColorObjects</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">sizes</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontSizes</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">bolds</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontWeights</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">horizontalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getHorizontalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">verticalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getVerticalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
          <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="nx">row</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">backgroundColor</span><span class="dl">"</span><span class="p">:</span> <span class="nx">backgroundColors</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">color</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">index</span><span class="p">]?.</span><span class="nf">asRgbColor</span><span class="p">()?.</span><span class="nf">asHexString</span><span class="p">()),</span>
          <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="nx">sizes</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">:</span> <span class="nx">bolds</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">horizontalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]),</span>
          <span class="dl">"</span><span class="s2">verticalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="nx">verticalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colorString</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">colorString</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="o">+</span><span class="nx">colorString</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">colorString</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignment</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">horizontalAlignment</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">general-</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstColumnRowsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastRow</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 取得第一欄(欄位)資料範圍</span>
    <span class="kd">const</span> <span class="nx">firstColumnRows</span> <span class="o">=</span> <span class="nx">firstColumnRowsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">();</span> <span class="c1">// 取得資料範圍的值</span>
    <span class="kd">const</span> <span class="nx">foundIndex</span> <span class="o">=</span> <span class="nx">firstColumnRows</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">firstColumnRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">firstColumnRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">name</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">foundIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">foundIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> <strong>增加 Web 請求 Handle：</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_ Scaffolding</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getDailyReportBody</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_Body</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FOR POST</span>
<span class="c1">// function doPost(e) {</span>
<span class="c1">//  ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw</span>
<span class="c1">// }</span>


<span class="c1">// 模擬部分數據資料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>新增 <code class="language-plaintext highlighter-rouge">Web_DailyReport_ Scaffolding.html</code> Web Dashboard 框架，由於我們的戰情室螢幕要做到自動更新內容，因此我們建立一個 Web 骨架，在其中定時用 Ajax 去撈取 HTML 內容：</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      function onSuccess(html) {
        if (html != null) {
          var div = document.getElementById('result');
          div.innerHTML = html;
        }
     }
     setInterval(()=&gt;{
       google.script.run.withSuccessHandler(onSuccess).getDailyReportBody()
     }, 1000 * 60 * 60 * 1);
     google.script.run.withSuccessHandler(onSuccess).getDailyReportBody();
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;</span>Loading...<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>新增</strong> <code class="language-plaintext highlighter-rouge">Web_DailyReport_Body.html</code> 實際渲染資料成 HTML 的地方：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
    }
    th, td {
        border: 1px solid #000000;
        padding: 8px;
        text-align: center;
        font-size: 36px;
    }
      <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"text-align:center"</span><span class="nt">&gt;</span>ZHGCHG.LI<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"dataTable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
          <span class="err">&lt;</span>?
          // 顯示近 7 天數據
          const dashboard = new WebDailyReport(targetGoogleSheetID, 7);
          // 從昨天開始
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const data = dashboard.allData(yesterday);
          for(const rowIndex in data) {
            const row = data[rowIndex];
            ?&gt;
            <span class="nt">&lt;tr&gt;</span>
              <span class="err">&lt;</span>?
              for(const columnIndex in row) {
                const column = row[columnIndex];
                ?&gt;
                <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: &lt;?=column["</span><span class="err">backgroundColor"]?</span><span class="nt">&gt;</span>; color: <span class="cp">&lt;?=column["color"]?&gt;</span>; text-align: <span class="cp">&lt;?=column["horizontalAlignment"]?&gt;</span>;"&gt;
                  <span class="cp">&lt;?=column["value"]?&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
                <span class="err">&lt;</span>?
              }
              ?&gt;
            <span class="nt">&lt;/tr&gt;</span>
            <span class="err">&lt;</span>?
          }
          ?&gt;
        <span class="nt">&lt;/tbody&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
      <span class="nt">&lt;script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><blockquote><p><strong><em>請注意，我們是從昨天開始往後撈 7 天的數據做比對，不會顯示今天的數據。</em></strong></p></blockquote><p>完成以上步驟後的專案檔案目錄如下：</p><p><a href="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjYiIGhlaWdodD0iNDM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>測試部署：</strong></p><p>點擊專案右上角「部署」-&gt;「測試部署作業」</p><p><a href="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTEiIGhlaWdodD0iNTkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzM5IiBoZWlnaHQ9IjQ5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>部署完成點擊網址即可查看測試結果。<li><strong>請注意此網址僅共一次性測試使用，如果程式碼有調整要再重新點一次測試部署作業。</strong></ul><p>卡在 Loading… 內容沒出來或出現伺服器錯誤，可以回到編輯器的「執行項目」頁籤查看錯誤訊息：</p><p><a href="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjUzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>完成正式部署：</strong></p><p>如果測試沒問題就可以完成正式部署，釋出網址。</p><p>點擊專案右上角「部署」-&gt;「新增部署作業」-&gt; 左上角「選取類型」-&gt;「網頁應用程式」：</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>執行身份：預設為當前帳號(同 Google Apps Script 使用者)<li>誰可以存取：設為所有人只要知道網址的人都能存取、也可設為僅組織可存取，會先要求 Google 登入才能存取。<li>部署完成，取得網址。</ul><p><strong>程式碼有更動需重新部署才會生效：</strong></p><p>請注意當程式碼有變動時，需要重新部署(網址不會變)，更動才會生效，否則會一直是舊的。</p><p>點擊專案右上角「部署」-&gt;「管理部署作業」：</p><p><a href="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzUiIGhlaWdodD0iMjExIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTkiIGhlaWdodD0iNTg4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTQiIGhlaWdodD0iNTg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>點擊右上角「筆🖊️ ICON」-&gt; 「版本」 -&gt;「建立新版本」-&gt;「部署」。</p><p>部署完成後點擊網址，或回到原網址重新整理即可看到新的更動結果。</p><h4 id="完成至此我們所有的-rpa-需求皆已完成"><span class="me-2">🎉🎉完成！至此我們所有的 RPA 需求皆已完成。🎉🎉</span><a href="#完成至此我們所有的-rpa-需求皆已完成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>最終成果：</p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="(改程式回補本月數據，否則全新資料下只有昨日一筆)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>(改程式回補本月數據，否則全新資料下只有昨日一筆)</p><blockquote><p><a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></p></blockquote><h3 id="完整-google-sheet-demo"><span class="me-2">完整 Google Sheet Demo：</span><a href="#完整-google-sheet-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a><li><strong>Google Apps Script:</strong> <a href="https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit" target="_blank">https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit</a></ul><h3 id="最後附上其他日常生活應用"><span class="me-2">最後附上其他日常生活應用：</span><a href="#最後附上其他日常生活應用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line"><span class="me-2">Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to Line</span><a href="#robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://medium.com/zrealm-ios-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697" target="_blank" class="img-link shimmer" ><img src="https://miro.medium.com/v2/resize:fit:1200/1*fUtW942huwnSbPF-ar4OCQ.png" alt="" loading="lazy"></a></p><h4 id="robotic-process-automation-with-google-apps-script--notion-database-to-calendar"><span class="me-2">Robotic Process Automation with Google Apps Script — Notion Database to Calendar</span><a href="#robotic-process-automation-with-google-apps-script--notion-database-to-calendar" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>之前簡易實現的 Notion to Calendar 功能。</p><blockquote><p><em>實現方式是，我去串接 Notion API 撈取 Database 資料並套用產出 ICS 格式網頁，部署成公開的網頁；將此網址新增到 Apple Calendar 即可。</em></p></blockquote><p><code class="language-plaintext highlighter-rouge">Main.gs</code> :</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre><span class="c1">// Constant variables</span>
<span class="kd">const</span> <span class="nx">notionToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">safeToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parameter</span><span class="p">.</span><span class="nx">token</span> <span class="o">!=</span> <span class="nx">safeToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access Denied!</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">()).</span><span class="nf">setMimeType</span><span class="p">(</span><span class="nx">ContentService</span><span class="p">.</span><span class="nx">MimeType</span><span class="p">.</span><span class="nx">ICAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getQuickNote</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// YOUR FILTER Condition:</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">,</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">YOUR_DATABASE_ID</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="kd">const</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">create</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">created_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">edit</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_edited_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">];</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">endDate</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">startDate</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">endDate</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">multi_select</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">];</span>

    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[</span><span class="dl">"</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="dl">"</span><span class="s2">] </span><span class="dl">"</span><span class="o">+</span><span class="nx">properties</span><span class="p">?.[</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="nx">events</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">create</span><span class="dl">"</span><span class="p">:</span><span class="nx">create</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">edit</span><span class="dl">"</span><span class="p">:</span><span class="nx">edit</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span><span class="nx">start</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">:</span><span class="nx">end</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="nx">description</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">events</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// TO UTC Date</span>
<span class="kd">function</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">icsDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="nx">icsDate</span><span class="p">.</span><span class="nf">setHours</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">.</span><span class="nf">getHours</span><span class="p">()</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyyMMdd'T'HHmmss'Z'</span><span class="dl">"</span><span class="p">);</span><span class="c1">// 20240304T132300Z</span>
<span class="p">}</span>

<span class="c1">// Notion</span>
<span class="kd">function</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.notion.com/v1/databases/</span><span class="dl">'</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="dl">'</span><span class="s1">/query/</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span><span class="o">+</span><span class="nx">notionToken</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Notion-Version</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2022-06-28</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
  <span class="p">};</span> 
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ics.html</code> :</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:NotionCalendar
X-WR-TIMEZONE:Asia/Taipei
BEGIN:VTIMEZONE
TZID:Asia/Taipei
X-LIC-LOCATION:Asia/Taipei
BEGIN:STANDARD
TZOFFSETFROM:+0800
TZOFFSETTO:+0800
TZNAME:CST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
&lt;?
  for(const eventIndex in events) {
    const event = events[eventIndex];
    ?&gt;
BEGIN:VEVENT
DTSTART:&lt;?=event["start"]?&gt;

DTEND:&lt;?=event["end"]?&gt;

DTSTAMP:&lt;?=event["edit"]?&gt;

UID:&lt;?=event["id"]?&gt;

CREATED:&lt;?=event["create"]?&gt;

LAST-MODIFIED:&lt;?=event["edit"]?&gt;

SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:&lt;?=event["title"]?&gt;

DESCRIPTION:&lt;?=event["description"]?&gt;

TRANSP:OPAQUE
END:VEVENT
&lt;?
  }
?&gt;
END:VCALENDAR
</pre></table></code></div></div><p>同前文，部署成網頁服務，點擊專案右上角「部署」-&gt;「新增部署作業」-&gt; 左上角「選取類型」-&gt;「網頁應用程式」：</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>誰可以存取要選所有人，因為無法在加 Calendar 時進行 Google 登入驗證。</ul><p><a href="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTYiIGhlaWdodD0iMjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>將網址新增至行事曆訂閱，完成</strong> 🎉🎉🎉🎉 <strong>！</strong></p><h3 id="工商時間"><span class="me-2">工商時間</span><a href="#工商時間" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果您與您的團隊有自動化工具、流程串接需求，不論是 Slack App 開發、Notion、Asana、Google Sheet、Google Form、GA 數據，各種串接需求，歡迎與我 <a href="https://zhgchg.li/contact/" target="_blank"><strong>聯絡開發</strong></a> 。</p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p>本文首次發表於 Medium ➡️ <a href="https://medium.com/p/f6713ba3fee3" target="_blank"><strong>前往查看</strong></a></p><p>由 <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> 與 <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> 提供自動轉換與同步技術。</p><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2024-04-14-f6713ba3fee3.md" target="_blank">Improve this page on Github.</a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 3,659 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-16 | 3,605 Views on <a href="https://medium.com/p/f6713ba3fee3" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-robotic-process-automation/">ZRealm Robotic Process Automation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/roboticprocessautomation/" class="post-tag no-text-decoration" >roboticprocessautomation</a> <a href="/tags/rpa-solutions/" class="post-tag no-text-decoration" >rpa-solutions</a> <a href="/tags/google-apps-script/" class="post-tag no-text-decoration" >google-apps-script</a> <a href="/tags/google-sheets/" class="post-tag no-text-decoration" >google-sheets</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Google%20Apps%20Script%20%E8%87%AA%E5%8B%95%E5%8C%96%E5%A0%B1%E8%A1%A8%EF%BD%9C2024%20RPA%20%E7%AF%84%E4%BE%8B%E6%95%99%E5%AD%B8%E8%88%87%E5%AF%A6%E4%BD%9C%E6%94%BB%E7%95%A5%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2F%25E4%25BD%25BF%25E7%2594%25A8-google-apps-script-%25E5%25AF%25A6%25E7%258F%25BE%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B8%25E6%2593%259A%25E5%25A0%25B1%25E8%25A1%25A8-rpa-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Google%20Apps%20Script%20%E8%87%AA%E5%8B%95%E5%8C%96%E5%A0%B1%E8%A1%A8%EF%BD%9C2024%20RPA%20%E7%AF%84%E4%BE%8B%E6%95%99%E5%AD%B8%E8%88%87%E5%AF%A6%E4%BD%9C%E6%94%BB%E7%95%A5%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2F%25E4%25BD%25BF%25E7%2594%25A8-google-apps-script-%25E5%25AF%25A6%25E7%258F%25BE%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B8%25E6%2593%259A%25E5%25A0%25B1%25E8%25A1%25A8-rpa-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2F%25E4%25BD%25BF%25E7%2594%25A8-google-apps-script-%25E5%25AF%25A6%25E7%258F%25BE%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B8%25E6%2593%259A%25E5%25A0%25B1%25E8%25A1%25A8-rpa-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/">遊記 2025 韓國釜山 8 天 7 夜自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/">Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/">遊記 9/11 名古屋一日快閃自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/">遊記 2023 九州 10 日自由行獨旅</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/">遊記 2023 京阪神 8 日自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713107805" data-df="ll" > Apr 14, 2024 </time><h4 class="pt-0 my-2">Implementing Daily Data Report RPA Automation with Google Apps Script</h4><div class="text-muted"><p>Robotic Process Automation for Google Workspace services using Google Apps Script</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637506030" data-df="ll" > Nov 21, 2021 </time><h4 class="pt-0 my-2">Crashlytics｜Google Analytics 自動查詢 App Crash-Free Users Rate 並同步 Google Sheet</h4><div class="text-muted"><p>針對 iOS/Android App 團隊，解決手動查詢 Crash-Free Users Rate 繁瑣問題，透過 Google Analytics Data API 及 Google Apps Script 自動擷取並更新數據至 Google Sheet，實現數據追蹤自動化，提升監控效率與準確度，助你專注優化 App 穩定性。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/crashlytics-google-analytics-automatic-query-for-app-crash-free-users-rate-793cb8f89b72/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637506030" data-df="ll" > Nov 21, 2021 </time><h4 class="pt-0 my-2">Crashlytics + Google Analytics Automatic Query for App Crash-Free Users Rate</h4><div class="text-muted"><p>Using Google Apps Script to automatically query Crashlytics data through Google Analytics and fill it into Google Sheets</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-robotic-process-automation/en/implementing-daily-data-report-rpa-automation-with-google-apps-script-f6713ba3fee3/" class="btn btn-outline-primary" aria-label="Older" ><p>Implementing Daily Data Report RPA Automation with Google Apps Script</p></a> <a href="/posts/zrealm-dev/app-%E7%94%A2%E5%93%81%E9%80%B2%E5%85%A5%E7%B5%82%E9%BB%9E%E7%AB%99-%E8%83%BD%E5%81%9A%E4%BB%80%E9%BA%BC%E4%BA%8B%E7%B7%AC%E6%87%B7-b04f4fba3cf2/" class="btn btn-outline-primary" aria-label="Newer" ><p>App 產品進入終點站，能做什麼事緬懷？</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-17 15:51:20 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
