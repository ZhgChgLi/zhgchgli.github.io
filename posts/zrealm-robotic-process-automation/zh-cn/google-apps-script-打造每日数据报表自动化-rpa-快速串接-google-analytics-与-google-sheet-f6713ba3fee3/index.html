<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="解决每日手动整理 Google Analytics 数据耗时问题，透过 Google Apps Script 自动撷取并填充报表，节省超过180小时人力，并搭建即时 Web Dashboard，提升数据掌握效率与准确度。" /><meta property="og:description" content="解决每日手动整理 Google Analytics 数据耗时问题，透过 Google Apps Script 自动撷取并填充报表，节省超过180小时人力，并搭建即时 Web Dashboard，提升数据掌握效率与准确度。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-14T23:16:45+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" /><meta property="twitter:title" content="Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-10-20T14:06:10+08:00","datePublished":"2024-04-14T23:16:45+08:00","description":"解决每日手动整理 Google Analytics 数据耗时问题，透过 Google Apps Script 自动撷取并填充报表，节省超过180小时人力，并搭建即时 Web Dashboard，提升数据掌握效率与准确度。","headline":"Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/"},"url":"https://zhgchg.li/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/"}</script><title>Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-robotic-process-automation/en/google-apps-script-automate-daily-data-reports-with-rpa-for-google-workspace-f6713ba3fee3/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-robotic-process-automation/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8%E8%87%AA%E5%8B%95%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E8%88%87-google-sheet-f6713ba3fee3/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet</h1><p class="post-desc fw-light mb-4">解决每日手动整理 Google Analytics 数据耗时问题，透过 Google Apps Script 自动撷取并填充报表，节省超过180小时人力，并搭建即时 Web Dashboard，提升数据掌握效率与准确度。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1713107805" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 14, 2024 </time> </span> <span> Updated <time data-ts="1729404370" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 20, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link preview-img blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="10721 words" > <em>59 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Google Apps Script｜打造每日数据报表自动化 RPA｜快速串接 Google Analytics 与 Google Sheet</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-robotic-process-automation/en/google-apps-script-automate-daily-data-reports-with-rpa-for-google-workspace-f6713ba3fee3/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-robotic-process-automation/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8%E8%87%AA%E5%8B%95%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E8%88%87-google-sheet-f6713ba3fee3/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目录</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li><a href="#使用-google-apps-script-实现每日数据报表-rpa-自动化">使用 Google Apps Script 实现每日数据报表 RPA 自动化</a></li><li class="has-children"><details><summary>Robotic Process Automation <a href="#robotic-process-automation">#</a></summary><ul><li><a href="#robotic-process-automation-的效益评估">Robotic Process Automation 的效益评估</a></li><li><a href="#robotic-process-automation-跟-ai-的关系">Robotic Process Automation 跟 AI 的关系</a></li></ul></details></li><li class="has-children"><details><summary>Robotic Process Automation at Google Workspace <a href="#robotic-process-automation-at-google-workspace">#</a></summary><ul><li><a href="#cloud-functions">Cloud Functions</a></li><li><a href="#google-apps-script">Google Apps Script</a></li></ul></details></li><li class="has-children"><details><summary>Robotic Process Automation with Google Apps Script — 工作日报表 (Google Sheet x Google Analytics) <a href="#robotic-process-automation-with-google-apps-script--工作日报表-google-sheet-x-google-analytics">#</a></summary><ul><li><a href="#背景">背景</a></li><li><a href="#目标">目标</a></li><li><a href="#最终效果">最终效果</a></li><li><a href="#需完成的任务">需完成的任务</a></li><li><a href="#声明">声明</a></li><li><a href="#step-1-建立-google-apps-script">Step 1. 建立 Google Apps Script</a></li><li><a href="#google-apps-script-基础知识">Google Apps Script 基础知识</a></li><li><a href="#2-取得建立对应日期的-sheet">2. 取得/建立对应日期的 Sheet</a></li><li><a href="#3-串接-google-analytics-捞取数据">3. 串接 Google Analytics 捞取数据</a></li><li><a href="#小记">小记</a></li><li><a href="#4-填充资料">4. 填充资料</a></li><li><a href="#5-设定排程每日自动执行">5. 设定排程，每日自动执行</a></li><li><a href="#搭建-web-gui-dashboard">搭建 Web GUI Dashboard</a></li><li><a href="#完成至此我们所有的-rpa-需求皆已完成">🎉🎉完成！至此我们所有的 RPA 需求皆已完成。🎉🎉</a></li></ul></details></li><li><a href="#完整-google-sheet-demo">完整 Google Sheet Demo</a></li><li class="has-children"><details><summary>最后附上其他日常生活应用 <a href="#最后附上其他日常生活应用">#</a></summary><ul><li><a href="#robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line">Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to Line</a></li><li><a href="#robotic-process-automation-with-google-apps-script--notion-database-to-calendar">Robotic Process Automation with Google Apps Script — Notion Database to Calendar</a></li></ul></details></li><li><a href="#工商时间">工商时间</a></li></ul></nav><hr /><h3 id="使用-google-apps-script-实现每日数据报表-rpa-自动化"><span class="me-2">使用 Google Apps Script 实现每日数据报表 RPA 自动化</span><a href="#使用-google-apps-script-实现每日数据报表-rpa-自动化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>使用 Google Apps Script 进行 Google Workspace 相关服务之 Robotic Process Automation 自动化</p><p><a href="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jZmdNWSYQUq6Ja9PKaawWw.webp" alt="Photo by [Possessed Photography](https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@possessedphotography?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Possessed Photography</a></p><h3 id="robotic-process-automation"><span class="me-2">Robotic Process Automation</span><a href="#robotic-process-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>RPA (Robotic Process Automation) 中文翻译为「流程自动化机器人」回顾人类发展历史，从徒手采集到石器时代再到农耕文明，从上个世纪的工业革命开始到近 20 年的资讯崛起，人类的工作效率与产能有了指数级的飞跃成长；这一路上无处不在 RPA 应用的身影，农耕时期的水车(自动化脱谷工作)、工业革命的纺织机(自动化纺织工作)、工厂机械手臂(自动化组装工作)，最后是本篇要介绍的，自动化资讯相关工作，例如：自动查询报表、自动通知…等等工作。</p><p>说来惭愧，我也是最近才知道这个名词，打从从第一份工作开始 (7 年前)，就一直有在做 RPA 的事，诸如撰写爬虫统计数据、自动化 CI/CD 流程、自动化查询数据、自动化稳定性数据告警、自动化每日例行操作…等等；不过以往我都以「自动化」三个字作为代称，是时候给他一个正名了 — RPA (Robotic Process Automation)。</p><p><strong>之前所做的 RPA 更多只关注在「动手写程式实现自动化工作解决单一问题」上</strong> ，少了前期的完整评估与分析、No/Low Code 工具使用、法规、运行监控、实际数据统计、持续改进、企业文化推广…等等，这都是完整的 RPA 需要做的事；不过如同前面所说，我也是最近才知道这个专业领域，就容我还是先以实作方面水一篇文章吧！</p><p>提供 RPA 服务的平台有很多，例如 Automation Anywhere,UiPath, Microsoft Power Automate, Blue Prism 或是 Zapier, IFTTT, Automate.io … 要依照实际想解决的问题与平台挑选适合的服务。</p><p>推荐一套免费开源基于浏览器的 RPA Tool: <a href="https://chromewebstore.google.com/detail/automa/infppggnoaenmfagbfknfkancpbljcca" target="_blank">Automa</a> 。</p><blockquote><p><strong><em>另外广义来说，将人与人或人与事的主动依赖转化成人对平台、事对平台的依赖也是一种 RPA。</em></strong></p></blockquote><blockquote><p><strong><em>例如：统一使用 Asana/Jira…等专案管理工具统一管理工作事项。</em></strong></p></blockquote><blockquote><p><strong><em>基于主动转被动的理念，原本需要人工上去检查有无新通知的服务，我们也可以实现一个 RPA，当有新变动时自动通知我们。</em></strong></p></blockquote><blockquote><p><strong><em>例如：之前实现过的 <a href="/posts/zrealm-dev/zh-cn/google-apps-script-%E6%95%99%E5%AD%A6-%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91-gmail-%E9%82%AE%E4%BB%B6%E5%88%B0-slack-channel-%E5%AE%A2%E5%88%B6%E5%8C%96%E9%80%9A%E7%9F%A5-d414bdbdb8c9/">Gmail to Slack</a> 将特定通知信件转发到工作群组。</em></strong></p></blockquote><h4 id="robotic-process-automation-的效益评估"><span class="me-2">Robotic Process Automation 的效益评估</span><a href="#robotic-process-automation-的效益评估" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>之前在「 <a href="/posts/pinkoi-engineering/zh-cn/%E9%AB%98%E6%95%88%E7%8E%87%E5%B7%A5%E7%A8%8B%E5%9B%A2%E9%98%9F%E5%A4%A7%E8%A7%A3%E5%AF%86-pinkoi-%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%E6%8F%90%E5%8D%87%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87-11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — 高效率工程团队大解密</strong></a> 」分享过积少成多及心流中断的成本问题；假设一件例行重复性的工作，每次需要花费 15 分钟解决，每周会发生 10 次，一年下来就浪费将近 130 小时；如果再算上「心流切换」成本，最终可能浪费近 200 小时一年。</p><p><a href="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*U6bzH6b5-PRxFBktvkOa2Q.webp" alt="[**2021 Pinkoi Tech Career Talk — 高效率工程团队大解密**](/posts/pinkoi-engineering/zh-cn/%E9%AB%98%E6%95%88%E7%8E%87%E5%B7%A5%E7%A8%8B%E5%9B%A2%E9%98%9F%E5%A4%A7%E8%A7%A3%E5%AF%86-pinkoi-%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%E6%8F%90%E5%8D%87%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87-11f6c8568154/)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTIiIGhlaWdodD0iNTA1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/posts/pinkoi-engineering/zh-cn/%E9%AB%98%E6%95%88%E7%8E%87%E5%B7%A5%E7%A8%8B%E5%9B%A2%E9%98%9F%E5%A4%A7%E8%A7%A3%E5%AF%86-pinkoi-%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%E6%8F%90%E5%8D%87%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87-11f6c8568154/"><strong>2021 Pinkoi Tech Career Talk — 高效率工程团队大解密</strong></a></p><blockquote><p>心流切换的意思是，当我们专注在重要的事情上做得正 High! 时，需要暂停去处理其他事情，处理完毕再回来重新进入状态所耗费的时间。</p></blockquote><p>开发 RPA 的效益评估可参考下图，只要开发所需时间跟遇到的频率大于所浪费的时间，就值得投入资源实现：</p><p><a href="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*B8Zs8QyRv4KxQZJEBi81lA.webp" alt="&lt;https://twitter.com/swyx/status/1196401158744502272&gt;{:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjExMTciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://twitter.com/swyx/status/1196401158744502272" target="_blank">https://twitter.com/swyx/status/1196401158744502272</a></p><ul><li><p>X 轴：任务发生频率 ex: 50/Day (50次一天)</p><li><p>Y 轴：任务每次需花费多少人力时间才能完成</p><li><p>耗费时间 Range 抓 5 年来算，表格中间表示 5 年下来浪费的时间人力成本</p><li><p>白色为可能投入做自动化的时间成本大于能得到的效益，不值得改善</p><li><p>绿色表示值得自动化的项目</p><li><p>红色为强烈建议转为自动化</p></ul><blockquote><p><strong><em>除了节省时间之外，自动的制式化流程也能减少人工出错机率，提升稳定性。</em></strong></p></blockquote><h4 id="robotic-process-automation-跟-ai-的关系"><span class="me-2">Robotic Process Automation 跟 AI 的关系</span><a href="#robotic-process-automation-跟-ai-的关系" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>随著 AI 兴起，RPA 也经常被提及；但我觉得 RPA 与 AI 并无直接关系， <strong>没有 AI 的年代早就有 RPA，企业导入 AI 的帮助可能还没有完善 RPA 的效益来得高，RPA 更多的还是企业文化、工作习惯的问题</strong> ；不过不可否认 AI 确实能帮助 RPA 迈向下一个层次，例如以往 RPA 只能做确切、例行的工作，有了 AI 就能做一些模糊的、较动态的、智能判断的工作。</p><h3 id="robotic-process-automation-at-google-workspace"><span class="me-2">Robotic Process Automation at Google Workspace</span><a href="#robotic-process-automation-at-google-workspace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Google Workspace (旧称 G Suite)，是我们日常办公协作的好伙伴，信箱使用 Gmail 托管、文件放在 Google Doc、报表使用 Google Sheet、表单使用 Google Form…等等，这些服务之间的串接或是与内外部系统的沟通，都需要我们实现 RPA 来完成。</p><p>但 Google 并没有提供直接的 RPA 服务，可以透过以下几个服务达成：</p><ul><li><p>No Code： <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> (付费服务)，让非开发人员直接透过 GUI 搭建服务串接自动化。</p><li><p>Low Code： <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> (免费服务)，简单撰写程式就能快速直接的桥接 Google 服务、外部/内部系统。</p><li><p>Function as a Service： <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> (付费服务，提供免费额度)，撰写完整程式码、服务，透过 Google Cloud 部署直接执行。</p></ul><p>No Code 平台 <a href="https://cloud.google.com/appsheet#pricing" target="_blank">App Sheet</a> 我没接触过， <a href="https://cloud.google.com/functions?hl=zh_tw" target="_blank">Cloud Functions</a> 与 <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> 算蛮有经验的，以下是一些个人之前的使用与选择经验分享：</p><h4 id="cloud-functions"><span class="me-2">Cloud Functions</span><a href="#cloud-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>需部署执行</p><li><p>支援使用多种程式语言撰写：Node.js, Python, Java, Go, PHP, Ruby…</p><li><p>支援第三方套件依赖管理、安装并使用</p><li><p>支援完整身份验证机制</p><li><p>最多执行时间上限： 60 分钟</p><li><p>用多少算多少：依照次数、执行时间、不同处理器、使用的记忆体收费</p><li><p>受限冷启动问题(太久没呼叫，再次呼叫，第一次会需要较长响应时间)</p><li><p>无法直接串接 Google 服务，需要走 Auth/API 验证</p><li><p><strong>免费方案如下</strong> Cloud Functions 针对运算时间资源提供永久免费方案，当中包括 GB/秒和 GHz/秒的分配方式。除了 200 万次叫用以外，这个免费方案也提供 400,000 GB/秒和 200,000 GHz/秒的运算时间，以及每月 5 GB 的网际网路资料传输量。免费方案的使用额度，是以上述级别 1 价格的同等美元金额计算。无论执行函式的区域采用的是级别 1 和/或级别 2 价格，系统都会分配同等美元金额给您。不过在扣除免费方案的额度时，系统将以函式执行区域的级别 (级别 1 或级别 2) 为准。 请注意，即便您采用的是免费方案，也必须拥有有效的帐单帐户。</p></ul><p>总结来说，Cloud Functions 可以提供较完整与复杂的 RPA 串接功能或是有较多的外部 API 串接需求时比较建议使用 Cloud Functions。</p><p>之前使用过 Cloud Functions 的案例有：</p><ul><li><p>[Slack ChatGPT 对话机器人]： <a href="/posts/zrealm-dev/zh-cn/slack-app-%E6%95%B4%E5%90%88-chatgpt-%E5%88%A9%E7%94%A8-openai-api-%E4%B8%8E-google-cloud-functions-%E8%87%AA%E5%BB%BA%E6%99%BA%E8%83%BD%E5%8A%A9%E7%90%86-bd94cc88f9c9/">Slack &amp; ChatGPT Integration</a></p><li><p>[自动签到机器人]： <a href="/posts/zrealm-dev/zh-cn/python-%E6%90%AD%E9%85%8D-google-cloud-platform-%E4%B8%8E-line-bot-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC%E4%B8%8E%E6%8E%92%E7%A8%8B-70a1409b149a/">使用 Python+Google Cloud Platform+Line Bot 自动执行例行琐事</a></p></ul><p>都是与非 Google Workspace 服务整合且须桥接其他外部服务时我会使用。</p><h4 id="google-apps-script"><span class="me-2">Google Apps Script</span><a href="#google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>方便简单快速</p><li><p>完全免费</p><li><p>串接服务无需繁琐复杂的 Auth 身份验证 (Google Apps Script 是直接使用当前执行的帐号做为执行身份)</p><li><p>内建排程、行事历触发器功能</p><li><p>使用 Google 网路执行网路请求</p><li><p>只能使用 Google Apps Script (基于 JavaScript) 的语言开发</p><li><p>不支援套件管理工具、无版控功能</p><li><p><strong>基于安全问题， <a href="https://issuetracker.google.com/issues/36758197" target="_blank">无法客制化 Request User-Agent 资讯</a></strong></p><li><p><strong>执行时间上限，脚本必须在 6 分钟内完成工作，否则会被终止。</strong></p><li><p>其他限制与配额请参考官方的 <a href="https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw" target="_blank">GAS 资讯</a> ：</p></ul><p><a href="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*mLuy6AHDRTkUU1dJZpUEBg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzUiIGhlaWdodD0iMTA0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*ulyNjWc-imCLKqS4EsorWg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzAiIGhlaWdodD0iODMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>之前使用过 Google Apps Script 的案例有：</p><ul><li><p>[串接 Slack x Google Form x Google Sheet]： <a href="/posts/zrealm-dev/zh-cn/slack-workflow-%E6%89%93%E9%80%A0%E5%85%A8%E8%87%AA%E5%8A%A8-wfh-%E5%91%98%E5%B7%A5%E5%81%A5%E5%BA%B7%E5%9B%9E%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E7%BB%93%E5%90%88-google-sheets-%E4%B8%8E-app-script-%E6%8F%90%E5%8D%87%E6%95%88%E7%8E%87-d61062833c1a/">Slack 打造全自动 WFH 员工健康状况回报系统</a></p><li><p>[串接 Slack x Gmail]： <a href="/posts/zrealm-dev/zh-cn/google-apps-script-%E6%95%99%E5%AD%A6-%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91-gmail-%E9%82%AE%E4%BB%B6%E5%88%B0-slack-channel-%E5%AE%A2%E5%88%B6%E5%8C%96%E9%80%9A%E7%9F%A5-d414bdbdb8c9/">运用 Google Apps Script 转发 Gmail 信件到 Slack</a></p><li><p>[串接 Google Analytics x Slack]： <a href="/posts/zrealm-dev/zh-cn/crashlytics%E4%B8%8Egoogle-analytics%E8%87%AA%E5%8A%A8%E6%9F%A5%E8%AF%A2app-crash-free-users-rate-google-apps-script%E6%95%B4%E5%90%88%E5%AE%9E%E4%BD%9C-793cb8f89b72/">Crashlytics + Google Analytics 自动查询 App Crash-Free Users Rate</a></p><li><p>[串接 Firebase Crashlytics x Big Query x Slack]： <a href="/posts/zrealm-dev/zh-cn/crashlytics-big-query-%E4%B8%B2%E6%8E%A5%E6%95%99%E5%AD%A6-%E8%87%AA%E5%8A%A8%E6%9F%A5%E8%AF%A2%E5%B9%B6%E8%BD%AC%E5%8F%91-ios-app-%E9%97%AA%E9%80%80%E6%8A%A5%E5%91%8A%E5%88%B0-slack-e77b80cc6f89/">Crashlytics + Big Query 打造更即时便利的 Crash 追踪工具</a></p><li><p>[串接 Github x LineBot]： <a href="/posts/zrealm-dev/zh-cn/google-apps-script-%E4%B8%89%E6%AD%A5%E9%AA%A4%E6%89%93%E9%80%A0%E5%85%8D%E8%B4%B9-github-repo-star-%E9%80%9A%E7%9F%A5%E5%99%A8-%E5%AE%9E%E6%97%B6%E8%8E%B7%E5%8F%96-star-%E5%8A%A8%E6%80%81-382218e15697/">使用 Google Apps Script 三步骤免费建立 Github Repo Star Notifier</a></p></ul><p>受限于执行时间与 API Request 客制化限制，只有简单快速的服务我会使用 Google Apps Script 达成；或是需要与 Google 服务串接的需求，我会优先选择使用 Google Apps Script (因为用 Cloud Functions 要多实现完整的 Google 服务身份验证流程)。</p><h3 id="robotic-process-automation-with-google-apps-script--工作日报表-google-sheet-x-google-analytics"><span class="me-2">Robotic Process Automation with Google Apps Script — 工作日报表 (Google Sheet x Google Analytics)</span><a href="#robotic-process-automation-with-google-apps-script--工作日报表-google-sheet-x-google-analytics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>终于来到本篇的主题，使用 Google Apps Script 实现 Google 服务 RPA 自动化。</p><h4 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>产品团队需要每日查询 Google Analytics 数据并填写到 Google Sheet 数据报表上，共团队分析趋势使用；并将每日数据内容发布到 Dashboard 萤幕上，让所有成员掌握目前状况。</p><p>同事每日一到公司就要花大约 30 分钟左右完成此任务；如果有其他事要处理就需要等到这件例行工作完成才会开始或会延后发布每日数据讯息。</p><p><strong>简单估计一下 RPA 效益：</strong></p><ul><li><p>每年消耗支出： 1 人 x 30 mins x 365 天(假日数据也要补) <strong>= 182 hours</strong></p><li><p>建立自动化成本： 以此案例来说，约需耗费 1 人 x 5天 <strong>= 40 hours</strong></p></ul><blockquote><p>因此我们只需要投入一周开发时间，就能长远解决负责查数据同事的工作消耗，他就可以把精力放在更重要的事情上。</p></blockquote><h4 id="目标"><span class="me-2">目标</span><a href="#目标" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们的目标是使用 Google Apps Script 建立一个 RPA 自动从 Google Analytics 与内部系统报表 API 捞取每日数据并填入 Google Sheet，与搭建一个 Web UI Dashboard。</p><h4 id="最终效果"><span class="me-2">最终效果</span><a href="#最终效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*6xAMrwENoxD0c7Hv1_RTTw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjMyMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a></ul><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></ul><blockquote><p><strong><em>数据为假数据，纯 Demo 使用；从 2024/04/13 开始会特别低或都保持在 0，因为我的 zhgchg.li GA 真的是「0」流量 Q_Q。</em></strong></p></blockquote><h4 id="需完成的任务"><span class="me-2">需完成的任务</span><a href="#需完成的任务" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><p>建立 Google Apps Script、熟悉编辑器</p><li><p>取得/建立对应日期的 Sheet</p><li><p>串接 Google Analytics 捞取数据</p><li><p>填充资料</p><li><p>设定排程，每日自动执行</p></ol><h4 id="声明"><span class="me-2">声明</span><a href="#声明" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>因文章说明需求，以下程式码会尽可能少一点抽象，增加说明性，您可依照自己实际的需求进行改写。</p><blockquote><p><strong><em>文末有附上完整公开的 Google Sheet &amp; Google Apps Script，如果你懒得一步一步走，可以直接从文末附的范本去修改。</em></strong></p></blockquote><h4 id="step-1-建立-google-apps-script"><span class="me-2">Step 1. 建立 Google Apps Script</span><a href="#step-1-建立-google-apps-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*-xYCGpKIBztRd4jvxFnrUg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iMjU5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>只需在我们要导入自动化的报表上选择「扩充功能」-&gt;「Apps Script」就能自动建立与 Google Sheet 报表连结的 Google Apps Script。</p><p>另外也可以直接从 Google Apps Script 首页建立 <a href="https://www.google.com/script/start/" target="_blank">Google Apps Script</a> ，不过这样就不会与 Google Sheet 产生连结。</p><blockquote><p><strong>并非需要连结才能操作对应 Google Sheet</strong> ，两种建立方式都可以，差别在于 Script 的所有权归于谁，如果是连结报表的就是归报表拥有者，如果是自己建立的就是归建立著；拥有者会关系到假设该帐号因离职停用，脚本是否会失效被删除。</p></blockquote><p><a href="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*vnCPiALLTi4CIcYbASQpOg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>脚本建立后，我们可以先从上方 Rename 我们的脚本专案名称。</p><h4 id="google-apps-script-基础知识"><span class="me-2">Google Apps Script 基础知识</span><a href="#google-apps-script-基础知识" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>再到下一步撰写程式之前，先补充一些 Google Apps Script 的基础知识。</p><p><strong>关于编辑器</strong></p><p>预设引入 Google 服务的 SDK (不需特别引入即可呼叫使用)：</p><ul><li><p>CalendarApp 行事历</p><li><p>DocumentApp Google Drive</p><li><p>FormApp Google Form</p><li><p>SpreadsheetApp Google Sheet</p><li><p>GmailApp Gmail</p><li><p><a href="https://developers.google.com/apps-script/reference/slides/border?hl=zh-tw#getdashstyle" target="_blank">其他…</a></p></ul><p><a href="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*PKO-daNhyquINvk-_LfgQQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODkiIGhlaWdodD0iMzQzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ol><li><p>档案： 可新增多个 .gs 档案存放不同物件程式码，方便整理；所有档案都会在同个 Namespace、生命周期下执行，因此要注意物件名称、变数名称如果重复可能会互相覆盖。 除 .gs 指令码 档案外，也能新增 .html HTML Template 档案，用于渲染 Web UI。(后面会再介绍)</p><li><p>资料库： 别人撰写好的资料库 (a.k.a Lib) 我们可以透过他的 Script ID 引入使用，当然我们撰写好的程式也能部署成资料库给别人用。 另外也有一些大神帮忙封装的工具可以用，缺点是只能从 Google 搜寻 Script ID，官方并没有正式的资料库列表共查询使用。 e.g. HTML Parser Tool Cheer.io Script ID: <code class="language-plaintext highlighter-rouge">1ReeQ6WO8kKNxoaA_O0XEQ589cIrRvEBA9qcWpNqdOP17i47u6N9M5Xh0</code></p><li><p>服务： Google 服务的 SDK，预设没有引入的服务可以再此追加引入使用。 e.g. Google Analytics Data</p><li><p>还原、下一步操作</p><li><p>储存 或 Control + s</p><li><p>执行 或 Control + r 遇到错误直接在 Console 提示并终止脚本</p><li><p>侦错 有下 Break point (10) 的地方执行到会暂停中断并跳出右侧 Debug View，可按继续执行 遇到错误会暂停中断并跳出右侧 Debug View</p><li><p>侦错、执行的目标方法(Function Name) 仅能选择当前选择的档案所拥有的方法。</p><li><p>查看编辑器执行纪录</p></ol><blockquote><p><em>另外还有一点就是排版，有的浏览器按下「Control + [」进行缩排时会触发返回上一页，这点要注意！</em></p></blockquote><p><a href="https://chromewebstore.google.com/detail/lfjcgcmkmjjlieihflfhjopckgpelofo" target="_blank"><strong>Google Apps Script GitHub Assistant Chrome Extension 版控外挂</strong></a></p><ul><li>建议安装此 Extension 让 Google Apps Script 与 git 串接，使其有版本控制功能，防止心血不小心改坏。</ul><p><a href="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*NIFgOdZ2EIv-FCfYOxCmsA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIxIiBoZWlnaHQ9IjE5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*JQyQCdn-FAtItaJ2qrLnng.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTkiIGhlaWdodD0iMjM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*TqsqHeccSt8-qN4Tav0kwg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTQiIGhlaWdodD0iNjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>如果遇到 Push/Pull Error 或点了没反应，请先按照上面步骤「选项」-&gt; 连接 Github or 重新验证一次 Google 授权，即可。</ul><p><strong>Logger Message</strong></p><p>可使用以下 Script 搭配 Debug 就能在底下 Console Print 出 Debug Log。</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hi</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>执行纪录、错误资讯</strong></p><p>如果在编辑器上执行时的 Log 或报错会直接显示，如果要查讯执行纪录或自动执行时发生的错误，可到「执行项目」页签查看。</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>自动触发</strong></p><p><a href="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0DfewvWMWZ_bEC7beOPmLQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzYiIGhlaWdodD0iMzEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*lh87YD-SL6VDf5pcLlB_WQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzQiIGhlaWdodD0iNzc3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>「触发条件」页签可设定脚本中的方法该如何自动触发执行，可以设定的自动触发条件有：</p><ul><li><p>当 Google Sheet：开启时、编辑时、内容变更时、提交表单时 执行</p><li><p>排程周期触发：每 X 分钟、X 小时、X 日、X 周、X 月 执行一次</p><li><p>特定日期触发：YYYY-MM-DD HH:MM 时执行</p><li><p>当 行事历：更新时 执行</p></ul><p>错误通知设定，可设定当脚本执行出错时如何通知你。</p><p><strong>授予执行权限身份</strong></p><blockquote><p><strong><em>首次执行/部署或新增引入的服务、资源，都需要重新跑一次身份授权，授权完之后的执行都会用你授权的身份执行，所以也要确保你授权(通常是当前)的帐号有该资源、服务的权限。(e.g. 例如要有该 Google Sheet 权限)。</em></strong></p></blockquote><p>跳出帐号选择 Pop-up 后选择授权执行的帐号(通常是选当前 Google Apps Script 帐号)：</p><p><a href="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*psr2krTcvVZxkxYp.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjQiIGhlaWdodD0iNTIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>出现「Google hasn’t verified this app」因为我们要开发的 App 是给自己用的，不需经过 Google 验证。</p><p>直接点击「Advanced」-&gt;「Go to XXX (unsafe)」-&gt;「Allow」即可：</p><p><a href="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*lP6NI_yUYntq7pIy.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMzMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*jIQHxmmy3ziOHXR7.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTgiIGhlaWdodD0iNDU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/0*F8SGw5p1RtWaIea5.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjgiIGhlaWdodD0iNzIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>完成授权后就能成功执行脚本，如果没有改动资源不需要再重新授权。</p><h4 id="2-取得建立对应日期的-sheet"><span class="me-2">2. 取得/建立对应日期的 Sheet</span><a href="#2-取得建立对应日期的-sheet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>了解完基础知识后，我们就可以撰写第一个功能的程式了。</p><p>我们建立以下多个档案方便我们存放不同物件</p><p><code class="language-plaintext highlighter-rouge">DailyReportStyle.gs</code> 栏位样式物件：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">HeaderStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#e3284b</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ContentStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#000000</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">HeaderDateStyle</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#ffffff</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">#001a40</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bold</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">horizontalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">verticalAlignment</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReportField.gs</code> 栏位资料物件：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReportField</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">headerStyle</span><span class="p">,</span> <span class="nx">contentStyle</span><span class="p">,</span> <span class="nx">format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">headerStyle</span> <span class="o">=</span> <span class="nx">headerStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">contentStyle</span> <span class="o">=</span> <span class="nx">contentStyle</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">DailyReport.gs</code> 报表主程式逻辑：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">()),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC 流量) + 5(Mobile 流量)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">注册数</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1">// 日流量公式分解说明：</span>
    <span class="c1">// 1. COLUMN() 函数会回传目前单元格的列号码。</span>
    <span class="c1">// 2. ADDRESS(1, COLUMN(), 4) 会以给定的行数（`COLUMN()` 的结果）和固定的列数（1）来生成一个绝对引用的地址。其中，第三个参数 4 表示不带任何美元符号（$）的相对地址。比如，如果你在第三列的任何单元格中使用这个函数，它会回传 "C1"。</span>
    <span class="c1">// 3. SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") 会将 ADDRESS 函数产生的地址中的数字 1 移除，因此只保留了列的英文字母，比如："C"。</span>
    <span class="c1">// 4. INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 4) 这边 &amp; 4 其实应该是 &amp;4。`SUBSTITUTE` 函数的结果会和数字 4 连接，形成 "C4" 这样的字符串，然后 INDIRECT 函数会将这个字符串转换成对应的单元格引用。所以，如果你在列 C 中的任何单元格使用此公式，它会引用 C4。</span>
    <span class="c1">// 5. 类似地，`INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN(), 4), "1", "") &amp; 5)` 会引用相同列的第五行的单元格。比如，如果你在列 C 中的任何单元格使用此公式，它会引用 C5。</span>
    <span class="c1">// 6. 最后，这两个 INDIRECT 函数引用的单元格值相加。</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>

  <span class="p">}</span>

  <span class="c1">// 取得给定日期的目标 Sheet</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 以月来区分 Sheet，找到当月 Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 无则建立新的月 Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 月 Sheet 命名规则</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 建立新的月 Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 新增当月 Sheet，移动到第一个位子</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// 新增第一栏，栏位名称、设定 Pinned、宽度 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// 填充栏位名称</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 设定栏高</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// 设定 Pinned 第一、二列(日期、星期)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// 新增总计栏位</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 新增一栏在最后一栏</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// 填充总计栏位</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 日期...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">总计</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 星期...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">总计</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>

        <span class="c1">// 1. IFERROR(value, [value_if_error]) 函数用于判断公式中是否存在错误，并在有错误时返回指定的值。它接受两个参数：`value` 是需要计算的表达式或函数，`value_if_error` 是当 value 发生错误时返回的值。在这个情境下，如果 SUM 函数中的计算发生错误，则返回 0。</span>
        <span class="c1">// 2. SUM(range) 函数用于计算范围内所有数字的总和。</span>
        <span class="c1">// 3. INDIRECT(ref_text, [is_A1_notation]) 函数将文字字串转换成单元格引用。这里使用 INDIRECT 函数是为了动态生成所需的参照范围。</span>
        <span class="c1">// 4. SUBSTITUTE(text, old_text, new_text, [instance_num]) 函数在文字字串中替换指定的文字。这里使用 SUBSTITUTE 是为了将 ADDRESS 函数回传的地址中的 "1" 替换成其他内容。</span>
        <span class="c1">// 5. ADDRESS(row, column, [abs_num], [a1], [sheet]) 函数根据给定的行列号码回传对应的单元格地址。在这里，ADDRESS(1, 1, 4) 生成了第一行第一列的单元格地址，但是由于 abs_num 是 4，所以地址不包含工作表名称和固定符号 $。类似地，`ADDRESS(1, COLUMN() - 1, 4)` 产生了从第一行到当前列前一列的单元格地址。</span>
        <span class="c1">// 6. COLUMN() 函数回传当前单元格的列号。</span>
        <span class="c1">// 7. summaryRowIndex = 所在列     </span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> 做为主程式入口：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*c3QsffDXeLBakupNbAClrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTgwIiBoZWlnaHQ9IjM1MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>完成后我们回到「 <code class="language-plaintext highlighter-rouge">Main.gs</code> 」选择「debug」并按下侦错，查看执行结果是否正确、有无出错。</p><p><a href="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*y8kdOIBp8tvbVmOBOpsVKA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjMiIGhlaWdodD0iMjY0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>执行正确回到报表会出现当前新月份，并带入预设栏位与总计栏位，如果已存在则不会有反应。</p><h4 id="3-串接-google-analytics-捞取数据"><span class="me-2">3. 串接 Google Analytics 捞取数据</span><a href="#3-串接-google-analytics-捞取数据" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先需要新增「AnalyticsData」服务：</p><p><a href="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*bXngqmgXbTVeQ9r7rjQAbQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ5IiBoZWlnaHQ9Ijc1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>使用 GA4 Debug Tool 构建查询条件：</p><ul><li><p><a href="https://ga-dev-tools.google/ga4/query-explorer/" target="_blank">https://ga-dev-tools.google/ga4/query-explorer/</a></p><li><p>可边比照 GA 4 后台筛选条件构建</p><li><p><strong>本文以查询 Sessions 数为例，区分装置 Grouping</strong></p></ul><p>登入授权后选择目标资源：</p><p><a href="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*M333knrSQqSxD1hCBcqU4A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjQiIGhlaWdodD0iMjUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>记下 property 底下显示的数字，即为你要查询的资源 GA Property ID。</p><p>设定查询参数、Filter 条件：</p><p><a href="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pZqC3U4WeTFGrq80TMWmRA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NTciIGhlaWdodD0iNDczIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>按下「Make Reqeust」取得 Response 结果：</p><p><a href="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*UArMZH6b0LPKj8_HTFrX9g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDciIGhlaWdodD0iODg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可同步比较 GA 4 后台同样条件的数据是否相同，如果落差太大可能是有 Filter 条件没有加到，要再检查一下。</p><h4 id="小记"><span class="me-2">小记</span><a href="#小记" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>附上一个行销同事发现的小坑，GA 有些数据会有延迟问题，可能今天查的跟昨天查的数字会不一样(例如跳出率)，因此最好能将资料回溯几天才能却保值是最终的数字。</p><blockquote><p><em>GA Debug Tool 没问题之后我们就能将它转换为 Google Apps Script。</em></p></blockquote><p>新增一个 <code class="language-plaintext highlighter-rouge">GAData.gs</code> 档案：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="c1">// Remeber add Google Analytics Data API to Services, or you'll see this error: ReferenceError: AnalyticsData is not defined</span>
<span class="c1">// GA Debug Toole: https://ga-dev-tools.web.app/ga4/query-explorer/</span>

<span class="kd">class</span> <span class="nc">GAData</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">traffic</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">fetchGADailyUsage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pc_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mobile_traffic</span> <span class="o">=</span> <span class="nx">traffic</span><span class="p">[</span><span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nf">fetchGADailyUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">dimensionPlatform</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newDimension</span><span class="p">();</span>
    <span class="nx">dimensionPlatform</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">deviceCategory</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newMetric</span><span class="p">();</span>
    <span class="nx">metric</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">sessions</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateRange</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newDateRange</span><span class="p">();</span>
    <span class="c1">// 预设查询给定日范围内资料 e.g. 2024-01-01 ~ 2024-01-01</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">startDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getDateString</span><span class="p">();</span>
    <span class="nx">dateRange</span><span class="p">.</span><span class="nx">endDate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getDateString</span><span class="p">();</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// const filter = AnalyticsData.newFilter();</span>
    <span class="c1">// filter.fieldName = "landingPagePlusQueryString";</span>
    <span class="c1">// const stringFilter = AnalyticsData.newStringFilter()</span>
    <span class="c1">// stringFilter.value = "/life\\|/article\\|/chat\\|/house\\|/event/230502\\|/event/230310";</span>
    <span class="c1">// stringFilter.matchType = "PARTIAL_REGEXP";</span>
    <span class="c1">// filter.stringFilter = stringFilter;</span>
    <span class="c1">// filterExpression.filter = filter;</span>

    <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nf">newRunReportRequest</span><span class="p">();</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="nx">dimensionPlatform</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="nx">metric</span><span class="p">];</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">dateRanges</span> <span class="o">=</span> <span class="nx">dateRange</span><span class="p">;</span>

    <span class="c1">// Filter Example:</span>
    <span class="c1">// const filterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// filterExpression.expression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = filterExpression;</span>
    <span class="c1">// or Not</span>
    <span class="c1">// const notFilterExpression = AnalyticsData.newFilterExpression();</span>
    <span class="c1">// notFilterExpression.notExpression = filterExpression;</span>
    <span class="c1">// request.dimensionFilter = notFilterExpression;</span>

    <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="nx">AnalyticsData</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nf">runReport</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="dl">"</span><span class="s2">properties/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">gaPropertyId</span><span class="p">).</span><span class="nx">rows</span><span class="p">;</span>
    <span class="c1">// 无资料</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">report</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">desktop</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// [{metricValues=[{value=4517}], dimensionValues=[{value=mobile}]}, {metricValues=[{value=3189}], dimensionValues=[{value=desktop}]}, {metricValues=[{value=63}], dimensionValues=[{value=tablet}]}]</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">report</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">element</span><span class="p">.</span><span class="nx">dimensionValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">metricValues</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">getDateString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM-dd</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> 新增测试内容：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="k">new</span> <span class="nc">Date</span><span class="p">());</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">gaData</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>按下执行或侦错取得程式捞取结果：</p><p><a href="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*jwkk0ZqsFN6QyjPLT_gmaw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDAiIGhlaWdodD0iMTU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>OK! 比对相符。</p><p><a href="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*fKO7pJzsyjdUWwhyJr3czg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMzgiIGhlaWdodD0iMzUxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>此步骤完成时，目录档案结构如上图。</p><h4 id="4-填充资料"><span class="me-2">4. 填充资料</span><a href="#4-填充资料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>建好 Sheet、查好资料后，再来就是填充资料到栏位中。</p><p>调整 <code class="language-plaintext highlighter-rouge">DailyReport.gs</code> 增加 by 日期新增栏位＆填充资料的逻辑：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">weekString</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">星期日</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">星期一</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期二</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期三</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期四</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期五</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">星期六</span><span class="dl">"</span><span class="p">][</span><span class="nx">date</span><span class="p">.</span><span class="nf">getDay</span><span class="p">()];</span> <span class="c1">// 取得星期，星期日为0，星期一为1，以此类</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">dateString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">HeaderDateStyle</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">weekString</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;4)+INDIRECT(SUBSTITUTE(ADDRESS(1,COLUMN(),4),"1","")&amp;5)</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// =4(PC 流量) + 5(Mobile 流量)</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">pc_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">.</span><span class="nx">mobile_traffic</span><span class="p">),</span>
      <span class="k">new</span> <span class="nc">DailyReportField</span><span class="p">(</span><span class="dl">"</span><span class="s2">注册数</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nc">HeaderStyle</span><span class="p">(),</span> <span class="k">new</span> <span class="nc">ContentStyle</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">#,##0</span><span class="dl">"</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">.</span><span class="nx">registers</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>

  <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getSheet</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">dateColumnIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span> <span class="c1">// 取得已存在的更新或建立新的栏位</span>

    <span class="c1">// 填充栏位内容</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">rowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">dateColumnIndex</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">format</span><span class="p">);</span>          
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 取得给定日期的目标 Sheet</span>
  <span class="nf">getSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 以月来区分 Sheet，找到当月 Sheet</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">thisMonthSheet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 无则建立新的月 Sheet</span>
      <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">makeMonthSheet</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 月 Sheet 命名</span>
  <span class="nf">getSheetName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 建立新的月 Sheet</span>
  <span class="nf">makeMonthSheet</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 新增当月 Sheet，移动到第一个位子</span>
    <span class="kd">var</span> <span class="nx">thisMonthSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">insertSheet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getSheetName</span><span class="p">(),</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">activate</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">moveActiveSheet</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// 新增第一栏，栏位名称、设定 Pinned、宽度 200</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsBefore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

    <span class="c1">// 填充栏位名称</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">headerStyle</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 设定栏高</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setRowHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

    <span class="c1">// 设定 Pinned 第一、二列(日期、星期)</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">setFrozenRows</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// 新增总计栏位</span>
    <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 新增一栏在最后一栏</span>
    <span class="kd">const</span> <span class="nx">summaryColumnIndex</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// 填充总计栏位</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">currentRow</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sheetField</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetFields</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">];</span>
      <span class="kd">const</span> <span class="nx">summaryRowIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">currentRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">sheetField</span><span class="p">.</span><span class="nx">contentStyle</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 日期...</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">"</span><span class="s2">总计</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">summaryRowIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 星期...merge...</span>
        <span class="kd">const</span> <span class="nx">mergeRange</span> <span class="o">=</span> <span class="nx">thisMonthSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">summaryColumnIndex</span><span class="p">,</span> <span class="nx">summaryRowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">mergeRange</span><span class="p">,</span> <span class="dl">"</span><span class="s2">总计</span><span class="dl">"</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="nx">mergeRange</span><span class="p">.</span><span class="nf">merge</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="dl">'</span><span class="s1">=IFERROR(SUM(INDIRECT(SUBSTITUTE(ADDRESS(1, 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">):INDIRECT(SUBSTITUTE(ADDRESS(1, COLUMN() - 1, 4), "1", "") &amp; </span><span class="dl">'</span><span class="o">+</span><span class="nx">summaryRowIndex</span><span class="o">+</span><span class="dl">'</span><span class="s1">)), 0)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">thisMonthSheet</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 建立或取得日期的栏位</span>
  <span class="c1">// 从最近一日往后加一栏位</span>
  <span class="nf">makeOrGetDateColumn</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// 取得第一列(日期)资料范围</span>
    <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 取得资料范围的值 0 = 第一列</span>
    
    <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// 找到对应日期的栏位 Index</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Not Found，找到前一日的位子</span>
      <span class="kd">var</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

      <span class="k">while</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 在前一日栏位后新增一栏</span>
        <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sheet</span><span class="p">.</span><span class="nf">insertColumnsAfter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 默认，直接新增一栏在第一栏后面</span>
        <span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="c1">// 设定栏位宽度</span>
    <span class="nx">sheet</span><span class="p">.</span><span class="nf">setColumnWidths</span><span class="p">(</span><span class="nx">columnIndex</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">columnIndex</span>
  <span class="p">}</span>

  <span class="c1">// 设定栏位 Format 样式</span>
  <span class="nf">setFormat</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">format</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setNumberFormat</span><span class="p">(</span><span class="nx">format</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 填充内容到栏位</span>
  <span class="nf">setContent</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nc">String</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setBackgroundColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontColor</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">bold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">.</span><span class="nf">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">range</span><span class="p">.</span><span class="nf">setHorizontalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">horizontalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">verticalAlignment</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setFontSize</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
    <span class="nx">range</span><span class="p">.</span><span class="nf">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span><span class="p">,</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">BorderStyle</span><span class="p">.</span><span class="nx">SOLID</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>调整 <code class="language-plaintext highlighter-rouge">Main.gs</code> 增加资料串接并在构建阶段赋值：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
  
<span class="p">}</span>

<span class="c1">// 模拟部分数据资料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>完成后我们回到「 <code class="language-plaintext highlighter-rouge">Main.gs</code> 」选择「debug」并按下侦错，查看执行结果是否正确、有无出错。</p><p><a href="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0h1-vgwjvuYBkQ0QTNeDRQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjIiIGhlaWdodD0iMjQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>回到 Google Sheet! 成功! 我们成功的自动新增了该日期的资料。</p><h4 id="5-设定排程每日自动执行"><span class="me-2">5. 设定排程，每日自动执行</span><a href="#5-设定排程每日自动执行" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>脚本完成后，再来只要设定自动触发条件，就能每日自动完成啰。</p><p>调整 <code class="language-plaintext highlighter-rouge">Main.gs</code> 新增 <code class="language-plaintext highlighter-rouge">cronjob()</code> function:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 照现实状况来说，通常是今日查昨日数据，才是完整的资料</span>
<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 模拟部分数据资料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p>在编辑器上切换到「触发条件」页签，选择右下角「新增触发条件」：</p><p><a href="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SPBAPOufdTwde3F2_zOvVA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc4IiBoZWlnaHQ9Ijg4NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><p>选择您要执行的功能：刚新增的 <code class="language-plaintext highlighter-rouge">Main.gs</code> Function <code class="language-plaintext highlighter-rouge">cronjob</code></p><li><p>选择应执行的部署作业：上端 (Head, 意为最新版)</p><li><p>选取活动来源：时间驱动</p><li><p>选取时间型触发条件类型：日计时器</p><li><p>选取时段：AM 4:00 — AM 5:00 (GMT+08:00) 通常在 AM 4:00 一到就会执行。</p><li><p>错误通知设定：当脚本发生错误时是要马上通知，还是每日汇整一次</p></ul><p><strong>储存设定，完成。</strong></p><p>之后可以去「执行项目」页签查看执行纪录结果：</p><p><a href="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pqn5ljYggb1lVWgYDSq6Sw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><strong><em>至此我们已完成自动化查询、新增资料、填入资料的报表 RPA 功能．🎉🎉🎉</em></strong></p></blockquote><h4 id="搭建-web-gui-dashboard"><span class="me-2">搭建 Web GUI Dashboard</span><a href="#搭建-web-gui-dashboard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>再来有个次要需求，我们需要建立一个简单的 Web 呈现每日数据（类似战情中心的概念）会在团队背后墙上大萤幕上直接显示。</p><p><strong>效果如下图：</strong></p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>新增 <code class="language-plaintext highlighter-rouge">Web_DailyReport.gs</code> 撰写读取 Google Sheet 并将栏位、样式转换为 HTML 格式呈现：</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">WebDailyReport</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">,</span> <span class="nx">dayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nf">openById</span><span class="p">(</span><span class="nx">sheetID</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">=</span> <span class="nx">dayCount</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">日期</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">星期</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">日流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">PC 流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Mobile 流量</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">注册数</span><span class="dl">"</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="nf">allData</span><span class="p">(</span><span class="nx">startDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sheetRowsIndexs</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while </span><span class="p">(</span><span class="nx">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">preDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
      <span class="nx">preDate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dayCount</span> <span class="o">-</span> <span class="nx">count</span><span class="p">));</span>
      <span class="kd">const</span> <span class="nx">sheetName</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy-MM</span><span class="dl">"</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">targetSheet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separateSheet</span><span class="p">.</span><span class="nf">getSheetByName</span><span class="p">(</span><span class="nx">sheetName</span><span class="p">);</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">targetSheet</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">firstRowColumnsRange</span> <span class="o">=</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getLastColumn</span><span class="p">());</span> <span class="c1">// 取得第一列(日期)资料范围</span>
        <span class="kd">const</span> <span class="nx">firstRowColumns</span> <span class="o">=</span> <span class="nx">firstRowColumnsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 取得资料范围的值 0 = 第一列</span>
        <span class="kd">var</span> <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nx">firstRowColumns</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">date</span> <span class="k">instanceof</span> <span class="nb">Date</span> <span class="o">&amp;&amp;</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">preDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyy/MM/dd</span><span class="dl">"</span><span class="p">)));</span> <span class="c1">// 找到对应日期的栏位 Index</span>
        
        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">columnIndex</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="err">\\</span><span class="o">|</span><span class="err">\\</span><span class="o">|</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sheetRows</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">sheetRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">targetSheet</span><span class="p">,</span> <span class="nx">sheetRow</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 新增第一栏</span>
            <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
            <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="kd">const</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">sheetRowsIndexs</span><span class="p">[</span><span class="nx">sheetName</span><span class="p">].</span><span class="nf">map</span><span class="p">((</span><span class="nx">rowIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">rowIndex</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">targetSheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">columnIndex</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
          <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">count</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">transformResult</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">columnIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">rowIndex</span> <span class="k">in</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>

        <span class="k">if </span><span class="p">(</span><span class="nx">columnIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">unshift</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">transformResult</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">].</span><span class="nf">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">result</span><span class="p">[</span><span class="nx">columnIndex</span><span class="p">][</span><span class="nx">rowIndex</span><span class="p">]);</span>
        <span class="p">}</span>
        
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">transformResult</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 转换 栏位属性 值成 显示用物件</span>
  <span class="nf">makeValues</span><span class="p">(</span><span class="nx">ranges</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getDisplayValues</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">backgroundColors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getBackgrounds</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">colors</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontColorObjects</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">sizes</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontSizes</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">bolds</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getFontWeights</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">horizontalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getHorizontalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">verticalAlignments</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">range</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">range</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nf">getVerticalAlignments</span><span class="p">())</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nf">map</span><span class="p">((</span><span class="nx">values</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="p">(</span><span class="kc">null</span><span class="p">));</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
          <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="nx">row</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">backgroundColor</span><span class="dl">"</span><span class="p">:</span> <span class="nx">backgroundColors</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">color</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">index</span><span class="p">]?.</span><span class="nf">asRgbColor</span><span class="p">()?.</span><span class="nf">asHexString</span><span class="p">()),</span>
          <span class="dl">"</span><span class="s2">size</span><span class="dl">"</span><span class="p">:</span> <span class="nx">sizes</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">:</span> <span class="nx">bolds</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
          <span class="dl">"</span><span class="s2">horizontalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]),</span>
          <span class="dl">"</span><span class="s2">verticalAlignment</span><span class="dl">"</span><span class="p">:</span> <span class="nx">verticalAlignments</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">colorStripper</span><span class="p">(</span><span class="nx">colorString</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="err">\\</span><span class="o">|</span><span class="err">\\</span><span class="o">|</span> <span class="nx">colorString</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">colorString</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="o">+</span><span class="nx">colorString</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">colorString</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">alignConventer</span><span class="p">(</span><span class="nx">horizontalAlignment</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="err">\\</span><span class="o">|</span><span class="err">\\</span><span class="o">|</span> <span class="nx">horizontalAlignment</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">horizontalAlignment</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">general-</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">getFieldRow</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">firstColumnRowsRange</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">.</span><span class="nf">getLastRow</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 取得第一栏(栏位)资料范围</span>
    <span class="kd">const</span> <span class="nx">firstColumnRows</span> <span class="o">=</span> <span class="nx">firstColumnRowsRange</span><span class="p">.</span><span class="nf">getValues</span><span class="p">();</span> <span class="c1">// 取得资料范围的值</span>
    <span class="kd">const</span> <span class="nx">foundIndex</span> <span class="o">=</span> <span class="nx">firstColumnRows</span><span class="p">.</span><span class="nf">findIndex</span><span class="p">((</span><span class="nx">firstColumnRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">firstColumnRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">name</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">foundIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">foundIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Main.gs</code> <strong>增加 Web 请求 Handle：</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">targetGoogleSheetID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit#gid=275710641</span>

<span class="kd">const</span> <span class="nx">gaPropertyId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">318495208</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">cronjob</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">cronjob</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">yesterday</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="nx">yesterday</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">gaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GAData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">inHouseReportData</span> <span class="o">=</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">yesterday</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DailyReport</span><span class="p">(</span><span class="nx">targetGoogleSheetID</span><span class="p">,</span> <span class="nx">yesterday</span><span class="p">,</span> <span class="nx">gaData</span><span class="p">,</span> <span class="nx">inHouseReportData</span><span class="p">);</span>
  <span class="nx">report</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_ Scaffolding</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getDailyReportBody</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web_DailyReport_Body</span><span class="dl">'</span><span class="p">).</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FOR POST</span>
<span class="c1">// function doPost(e) {</span>
<span class="c1">//  ref: https://developers.google.com/apps-script/guides/web?hl=zh-tw</span>
<span class="c1">// }</span>


<span class="c1">// 模拟部分数据资料可能是打其他平台 API 取得的。</span>
<span class="kd">function</span> <span class="nf">fetchInHouseReportData</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// EXMAPLE REQUEST:</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'get',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   }</span>
  <span class="c1">// };</span>
  <span class="c1">// OR</span>
  <span class="c1">// var options = {</span>
  <span class="c1">//   'method' : 'post',</span>
  <span class="c1">//   'headers': {</span>
  <span class="c1">//       'Authorization':  'Bearer XXX'</span>
  <span class="c1">//   },</span>
  <span class="c1">//   'payload' : data</span>
  <span class="c1">// };</span>

  <span class="c1">// var res = UrlFetchApp.fetch(url, options);</span>
  <span class="c1">// const result = JSON.parse(res.getContentText());</span>

  <span class="c1">// REMEMBER, DUE TO SECURITY REASON, We can't customize user-agent.</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">registers</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">30</span><span class="p">}</span> <span class="c1">// MOCK DATA random 30~180</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>新增 <code class="language-plaintext highlighter-rouge">Web_DailyReport_ Scaffolding.html</code> Web Dashboard 框架，由于我们的战情室萤幕要做到自动更新内容，因此我们建立一个 Web 骨架，在其中定时用 Ajax 去捞取 HTML 内容：</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      function onSuccess(html) {
        if (html != null) {
          var div = document.getElementById('result');
          div.innerHTML = html;
        }
     }
     setInterval(()=&gt;{
       google.script.run.withSuccessHandler(onSuccess).getDailyReportBody()
     }, 1000 * 60 * 60 * 1);
     google.script.run.withSuccessHandler(onSuccess).getDailyReportBody();
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;</span>Loading...<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>新增</strong> <code class="language-plaintext highlighter-rouge">Web_DailyReport_Body.html</code> 实际渲染资料成 HTML 的地方：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
    }
    th, td {
        border: 1px solid #000000;
        padding: 8px;
        text-align: center;
        font-size: 36px;
    }
      <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"text-align:center"</span><span class="nt">&gt;</span>ZHGCHG.LI<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"dataTable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
          <span class="err">&lt;</span>?
          // 显示近 7 天数据
          const dashboard = new WebDailyReport(targetGoogleSheetID, 7);
          // 从昨天开始
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const data = dashboard.allData(yesterday);
          for(const rowIndex in data) {
            const row = data[rowIndex];
            ?&gt;
            <span class="nt">&lt;tr&gt;</span>
              <span class="err">&lt;</span>?
              for(const columnIndex in row) {
                const column = row[columnIndex];
                ?&gt;
                <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: &lt;?=column["</span><span class="err">backgroundColor"]?</span><span class="nt">&gt;</span>; color: <span class="cp">&lt;?=column["color"]?&gt;</span>; text-align: <span class="cp">&lt;?=column["horizontalAlignment"]?&gt;</span>;"&gt;
                  <span class="cp">&lt;?=column["value"]?&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
                <span class="err">&lt;</span>?
              }
              ?&gt;
            <span class="nt">&lt;/tr&gt;</span>
            <span class="err">&lt;</span>?
          }
          ?&gt;
        <span class="nt">&lt;/tbody&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
      <span class="nt">&lt;script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><blockquote><p><strong><em>请注意，我们是从昨天开始往后捞 7 天的数据做比对，不会显示今天的数据。</em></strong></p></blockquote><p>完成以上步骤后的专案档案目录如下：</p><p><a href="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*G1ig9iHOyRckIf7gOMYd7Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjYiIGhlaWdodD0iNDM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>测试部署：</strong></p><p>点击专案右上角「部署」-&gt;「测试部署作业」</p><p><a href="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*0qsoN6CIATn9dU588pOrBw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*io3ugHFQfsEyCxIs0WTZ_w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTEiIGhlaWdodD0iNTkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*gIQHWeCPuuxHGZUyvBomNA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzM5IiBoZWlnaHQ9IjQ5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><p>部署完成点击网址即可查看测试结果。</p><li><p><strong>请注意此网址仅共一次性测试使用，如果程式码有调整要再重新点一次测试部署作业。</strong></p></ul><p>卡在 Loading… 内容没出来或出现伺服器错误，可以回到编辑器的「执行项目」页签查看错误讯息：</p><p><a href="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*XPmKwym8wmI3D2-cb2gs6w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjUzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>完成正式部署：</strong></p><p>如果测试没问题就可以完成正式部署，释出网址。</p><p>点击专案右上角「部署」-&gt;「新增部署作业」-&gt; 左上角「选取类型」-&gt;「网页应用程式」：</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>执行身份：预设为当前帐号(同 Google Apps Script 使用者)</p><li><p>谁可以存取：设为所有人只要知道网址的人都能存取、也可设为仅组织可存取，会先要求 Google 登入才能存取。</p><li><p>部署完成，取得网址。</p></ul><p><strong>程式码有更动需重新部署才会生效：</strong></p><p>请注意当程式码有变动时，需要重新部署(网址不会变)，更动才会生效，否则会一直是旧的。</p><p>点击专案右上角「部署」-&gt;「管理部署作业」：</p><p><a href="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*3y5A1ogNe9cpG_ObZt1_FA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzUiIGhlaWdodD0iMjExIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*qqQm-XAKgiGyYClX_Z0CaA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTkiIGhlaWdodD0iNTg4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*Ea_7NeyuRAfcHCGBvKAYhw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTQiIGhlaWdodD0iNTg2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>点击右上角「笔🖊️ ICON」-&gt; 「版本」 -&gt;「建立新版本」-&gt;「部署」。</p><p>部署完成后点击网址，或回到原网址重新整理即可看到新的更动结果。</p><h4 id="完成至此我们所有的-rpa-需求皆已完成"><span class="me-2">🎉🎉完成！至此我们所有的 RPA 需求皆已完成。🎉🎉</span><a href="#完成至此我们所有的-rpa-需求皆已完成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>最终成果：</p><p><a href="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*8SRT_wSe2aQGzcqpRt2Qjw.webp" alt="(改程式回补本月数据，否则全新资料下只有昨日一笔)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>(改程式回补本月数据，否则全新资料下只有昨日一笔)</p><blockquote><p><a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></p></blockquote><h3 id="完整-google-sheet-demo"><span class="me-2">完整 Google Sheet Demo：</span><a href="#完整-google-sheet-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing" target="_blank">https://docs.google.com/spreadsheets/d/1-9lZCpsu3E7eDmO-lMkXJXQ6Y6KK4SiyU6uBODcDcFE/edit?usp=sharing</a></p><li><p>Web GUI URL: <a href="https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec" target="_blank">https://script.google.com/macros/s/AKfycbz2Vk-ikU8DSXjpnLq9r6HNAn3zlNAosvDoItG0cxy0bmItRDSVyEzTdwsL2HyFUz99/exec</a></p><li><p><strong>Google Apps Script:</strong> <a href="https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit" target="_blank">https://script.google.com/home/projects/1vHgXPTV_q8MC75FVzAEtzD2JPVnPBpMfFXbjZR7SLMVjoEH1FcjKlo8l/edit</a></p></ul><h3 id="最后附上其他日常生活应用"><span class="me-2">最后附上其他日常生活应用：</span><a href="#最后附上其他日常生活应用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line"><span class="me-2">Robotic Process Automation with Google Apps Script — Github Repo Star Notifier to Line</span><a href="#robotic-process-automation-with-google-apps-script--github-repo-star-notifier-to-line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://medium.com/zrealm-ios-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697" target="_blank" class="img-link shimmer" ><img src="https://miro.medium.com/v2/resize:fit:1200/1*fUtW942huwnSbPF-ar4OCQ.png" alt="" loading="lazy"></a></p><h4 id="robotic-process-automation-with-google-apps-script--notion-database-to-calendar"><span class="me-2">Robotic Process Automation with Google Apps Script — Notion Database to Calendar</span><a href="#robotic-process-automation-with-google-apps-script--notion-database-to-calendar" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>之前简易实现的 Notion to Calendar 功能。</p><blockquote><p><em>实现方式是，我去串接 Notion API 捞取 Database 资料并套用产出 ICS 格式网页，部署成公开的网页；将此网址新增到 Apple Calendar 即可。</em></p></blockquote><p><code class="language-plaintext highlighter-rouge">Main.gs</code> :</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre><span class="c1">// Constant variables</span>
<span class="kd">const</span> <span class="nx">notionToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">safeToken</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">XXXXX</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parameter</span><span class="p">.</span><span class="nx">token</span> <span class="o">!=</span> <span class="nx">safeToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access Denied!</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="nx">ContentService</span><span class="p">.</span><span class="nf">createTextOutput</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">()).</span><span class="nf">setMimeType</span><span class="p">(</span><span class="nx">ContentService</span><span class="p">.</span><span class="nx">MimeType</span><span class="p">.</span><span class="nx">ICAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">debug</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ics</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">ics</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ics</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nf">getQuickNote</span><span class="p">();</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">ics</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">().</span><span class="nf">getContent</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getQuickNote</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// YOUR FILTER Condition:</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Date</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">,</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">property</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Name</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">is_not_empty</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">YOUR_DATABASE_ID</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="kd">const</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">create</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">created_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">edit</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_edited_time</span><span class="dl">"</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">];</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">endDate</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">startDate</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">endDate</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">properties</span><span class="p">[</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">multi_select</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">];</span>

    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">[</span><span class="dl">"</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="dl">"</span><span class="s2">] </span><span class="dl">"</span><span class="o">+</span><span class="nx">properties</span><span class="p">?.[</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">]?.[</span><span class="mi">0</span><span class="p">]?.[</span><span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="nx">events</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">create</span><span class="dl">"</span><span class="p">:</span><span class="nx">create</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">edit</span><span class="dl">"</span><span class="p">:</span><span class="nx">edit</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span><span class="nx">start</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">:</span><span class="nx">end</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="nx">description</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">events</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// TO UTC Date</span>
<span class="kd">function</span> <span class="nf">toICSDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">icsDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
  <span class="nx">icsDate</span><span class="p">.</span><span class="nf">setHours</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">.</span><span class="nf">getHours</span><span class="p">()</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">icsDate</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GMT+8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyyMMdd'T'HHmmss'Z'</span><span class="dl">"</span><span class="p">);</span><span class="c1">// 20240304T132300Z</span>
<span class="p">}</span>

<span class="c1">// Notion</span>
<span class="kd">function</span> <span class="nf">getDatabase</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.notion.com/v1/databases/</span><span class="dl">'</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="dl">'</span><span class="s1">/query/</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span><span class="o">+</span><span class="nx">notionToken</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Notion-Version</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2022-06-28</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
  <span class="p">};</span> 
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ics.html</code> :</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:NotionCalendar
X-WR-TIMEZONE:Asia/Taipei
BEGIN:VTIMEZONE
TZID:Asia/Taipei
X-LIC-LOCATION:Asia/Taipei
BEGIN:STANDARD
TZOFFSETFROM:+0800
TZOFFSETTO:+0800
TZNAME:CST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
&lt;?
  for(const eventIndex in events) {
    const event = events[eventIndex];
    ?&gt;
BEGIN:VEVENT
DTSTART:&lt;?=event["start"]?&gt;

DTEND:&lt;?=event["end"]?&gt;

DTSTAMP:&lt;?=event["edit"]?&gt;

UID:&lt;?=event["id"]?&gt;

CREATED:&lt;?=event["create"]?&gt;

LAST-MODIFIED:&lt;?=event["edit"]?&gt;

SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:&lt;?=event["title"]?&gt;

DESCRIPTION:&lt;?=event["description"]?&gt;

TRANSP:OPAQUE
END:VEVENT
&lt;?
  }
?&gt;
END:VCALENDAR
</pre></table></code></div></div><p>同前文，部署成网页服务，点击专案右上角「部署」-&gt;「新增部署作业」-&gt; 左上角「选取类型」-&gt;「网页应用程式」：</p><p><a href="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*SghEZm_MdxKO_lD8siKLJg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*pP1fRjkpKNBjZJ9Hnvy4XQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNTg1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*r0Tw8C30kGUn-YXfOssBtA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>谁可以存取要选所有人，因为无法在加 Calendar 时进行 Google 登入验证。</ul><p><a href="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*2HFKnh4QeQ4iTlEJRSNbYw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTYiIGhlaWdodD0iMjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" class="popup img-link blur"><img data-src="/assets/f6713ba3fee3/1*dVpsg748XbWwfomuT1VcWQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>将网址新增至行事历订阅，完成</strong> 🎉🎉🎉🎉 <strong>！</strong></p><h3 id="工商时间"><span class="me-2">工商时间</span><a href="#工商时间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果您与您的团队有自动化工具、流程串接需求，不论是 Slack App 开发、Notion、Asana、Google Sheet、Google Form、GA 数据，各种串接需求，欢迎与我 <a href="https://zhgchg.li/contact/" target="_blank"><strong>联络开发</strong></a> 。</p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/f6713ba3fee3" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2024-04-14-f6713ba3fee3.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-robotic-process-automation/">ZRealm Robotic Process Automation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/roboticprocessautomation/" class="post-tag no-text-decoration" >roboticprocessautomation</a> <a href="/tags/rpa-solutions/" class="post-tag no-text-decoration" >rpa-solutions</a> <a href="/tags/google-apps-script/" class="post-tag no-text-decoration" >google-apps-script</a> <a href="/tags/google-sheets/" class="post-tag no-text-decoration" >google-sheets</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Google%20Apps%20Script%EF%BD%9C%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96%20RPA%EF%BD%9C%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%20Google%20Analytics%20%E4%B8%8E%20Google%20Sheet%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fzh-cn%2Fgoogle-apps-script-%25E6%2589%2593%25E9%2580%25A0%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B0%25E6%258D%25AE%25E6%258A%25A5%25E8%25A1%25A8%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596-rpa-%25E5%25BF%25AB%25E9%2580%259F%25E4%25B8%25B2%25E6%258E%25A5-google-analytics-%25E4%25B8%258E-google-sheet-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Google%20Apps%20Script%EF%BD%9C%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96%20RPA%EF%BD%9C%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%20Google%20Analytics%20%E4%B8%8E%20Google%20Sheet%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fzh-cn%2Fgoogle-apps-script-%25E6%2589%2593%25E9%2580%25A0%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B0%25E6%258D%25AE%25E6%258A%25A5%25E8%25A1%25A8%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596-rpa-%25E5%25BF%25AB%25E9%2580%259F%25E4%25B8%25B2%25E6%258E%25A5-google-analytics-%25E4%25B8%258E-google-sheet-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-robotic-process-automation%2Fzh-cn%2Fgoogle-apps-script-%25E6%2589%2593%25E9%2580%25A0%25E6%25AF%258F%25E6%2597%25A5%25E6%2595%25B0%25E6%258D%25AE%25E6%258A%25A5%25E8%25A1%25A8%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596-rpa-%25E5%25BF%25AB%25E9%2580%259F%25E4%25B8%25B2%25E6%258E%25A5-google-analytics-%25E4%25B8%258E-google-sheet-f6713ba3fee3%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ci-cd-guide-integrate-google-apps-script-web-app-with-github-actions-for-free-packaging-platform-4273e57e7148/">CI/CD Guide｜Integrate Google Apps Script Web App with GitHub Actions for Free Packaging Platform</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9B%A2%E9%98%9F%E6%95%88%E7%8E%87-4273e57e7148/">CI/CD 实战指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免费易用的打包工具平台</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9C%98%E9%9A%8A%E6%95%88%E7%8E%87-4273e57e7148/">CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ci-cd-explained-boost-ios-app-development-stability-and-efficiency-tool-selection-guide-c008a9e8ceca/">CI/CD Explained: Boost iOS App Development Stability and Efficiency｜Tool Selection Guide</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%98%AF%E4%BB%80%E4%B9%88-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A8%B3%E5%AE%9A%E5%BC%80%E5%8F%91%E5%9B%A2%E9%98%9F%E7%9A%84%E5%85%B3%E9%94%AE%E6%B5%81%E7%A8%8B%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9-c008a9e8ceca/">CI/CD 实战指南（一）：CI/CD 是什么？如何透过 CI/CD 打造稳定高效的开发团队？工具选择？</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-robotic-process-automation/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8%E8%87%AA%E5%8B%95%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E8%88%87-google-sheet-f6713ba3fee3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713107805" data-df="ll" > Apr 14, 2024 </time><h4 class="pt-0 my-2">使用 Google Apps Script 實現每日數據報表 RPA 自動化</h4><div class="text-muted"><p>使用 Google Apps Script 進行 Google Workspace 相關服務之 Robotic Process Automation 自動化</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/crashlytics%E4%B8%8Egoogle-analytics%E8%87%AA%E5%8A%A8%E6%9F%A5%E8%AF%A2app-crash-free-users-rate-google-apps-script%E6%95%B4%E5%90%88%E5%AE%9E%E4%BD%9C-793cb8f89b72/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637506030" data-df="ll" > Nov 21, 2021 </time><h4 class="pt-0 my-2">Crashlytics与Google Analytics自动查询App Crash-Free Users Rate｜Google Apps Script整合实作</h4><div class="text-muted"><p>针对App开发团队，解决手动查询Crash-Free Users Rate繁琐问题，透过Google Analytics与Crashlytics搭配Google Apps Script，自动将数据填入Google Sheet，实现数据追踪自动化，提高效率并降低错误率。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-robotic-process-automation/en/google-apps-script-automate-daily-data-reports-with-rpa-for-google-workspace-f6713ba3fee3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713107805" data-df="ll" > Apr 14, 2024 </time><h4 class="pt-0 my-2">Google Apps Script｜Automate Daily Data Reports with RPA for Google Workspace</h4><div class="text-muted"><p>Boost your productivity by automating daily data reports in Google Workspace using Google Apps Script RPA. Eliminate manual tasks, reduce errors, and generate accurate reports effortlessly every day.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-robotic-process-automation/en/google-apps-script-automate-daily-data-reports-with-rpa-for-google-workspace-f6713ba3fee3/" class="btn btn-outline-primary" aria-label="Older" ><p>Google Apps Script｜Automate Daily Data Reports with RPA for Google Workspace</p></a> <a href="/posts/zrealm-robotic-process-automation/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B8%E6%93%9A%E5%A0%B1%E8%A1%A8%E8%87%AA%E5%8B%95%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E8%88%87-google-sheet-f6713ba3fee3/" class="btn btn-outline-primary" aria-label="Newer" ><p>使用 Google Apps Script 實現每日數據報表 RPA 自動化</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
