<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS 開發者面對 Vision framework 複雜圖像辨識需求，透過 WWDC 24 Swift Concurrency 新 API，掌握 31 種圖像辨識請求與身體手勢追蹤，提升辨識效率與安全性，實現高效圖像分析與即時應用。" /><meta property="og:description" content="iOS 開發者面對 Vision framework 複雜圖像辨識需求，透過 WWDC 24 Swift Concurrency 新 API，掌握 31 種圖像辨識請求與身體手勢追蹤，提升辨識效率與安全性，實現高效圖像分析與即時應用。" /><link rel="canonical" href="https://zhgchg.li/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" /><meta property="og:url" content="https://zhgchg.li/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-13T16:10:37+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" /><meta property="twitter:title" content="iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-08-14T20:07:49+08:00","datePublished":"2024-08-13T16:10:37+08:00","description":"iOS 開發者面對 Vision framework 複雜圖像辨識需求，透過 WWDC 24 Swift Concurrency 新 API，掌握 31 種圖像辨識請求與身體手勢追蹤，提升辨識效率與安全性，實現高效圖像分析與即時應用。","headline":"iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"},"url":"https://zhgchg.li/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"}</script><title>iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/"><link rel="alternate" hreflang="zh-Hans" href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><link rel="alternate" hreflang="zh-Hant" href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><link rel="alternate" hreflang="x-default" href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"如何利用 iOS 18 Vision framework 新 Swift API 來提升圖像辨識效能？","acceptedAnswer":{"@type":"Answer","text":"iOS 18 Vision framework 重新設計 API，採用 Swift Concurrency 與 async/await，讓圖像辨識操作更簡潔且執行更快，透過新方法如 perform() 取代舊的 VNImageRequestHandler，能有效提升效能與開發效率。"}},{"@type":"Question","name":"Vision framework 在 iOS 18 新增了哪些實用的圖像分析功能？","acceptedAnswer":{"@type":"Answer","text":"iOS 18 新增圖片美學評分（CalculateImageAestheticsScoresRequest）與身體＋手勢姿勢同時偵測（DetectHumanBodyPoseRequest 支援 detectsHands），方便篩選優質照片及實現更完整的動作捕捉應用。"}},{"@type":"Question","name":"如何在 Vision framework 中同時處理多個圖像辨識請求並即時取得結果？","acceptedAnswer":{"@type":"Answer","text":"iOS 18 提供 ImageRequestHandler 的 performAll() 方法，可同時執行多個請求並以串流方式接收結果，讓開發者能即時處理掃描到的條碼或文字，提升使用者體驗與反應速度。"}},{"@type":"Question","name":"使用 Swift Concurrency 優化 Vision framework 大量圖片處理時該注意什麼？","acceptedAnswer":{"@type":"Answer","text":"透過 TaskGroup 並行處理多張圖片可大幅提升效率，但因圖像辨識消耗記憶體與性能，建議限制最大並行任務數量（如最多 5 個），避免造成系統卡頓或記憶體溢位閃退。"}},{"@type":"Question","name":"Vision framework 與 VisionKit 有何不同，該如何選擇使用？","acceptedAnswer":{"@type":"Answer","text":"Vision framework 聚焦於圖像分析與辨識（如人臉、條碼、文字），而 VisionKit 專門用於文件掃描並生成 PDF，開發者應根據需求選擇 Vision 進行視覺內容分析，或 VisionKit 處理文件掃描任務。"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南</h1><p class="post-desc fw-light mb-4">iOS 開發者面對 Vision framework 複雜圖像辨識需求，透過 WWDC 24 Swift Concurrency 新 API，掌握 31 種圖像辨識請求與身體手勢追蹤，提升辨識效率與安全性，實現高效圖像分析與即時應用。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1723536637" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 13, 2024 </time> </span> <span> Updated <time data-ts="1723637269" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 14, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="6113 words" > <em>33 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS Vision framework｜WWDC 24 Swift Concurrency 與新 API 深度解析與實作指南</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目錄</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session <a href="#ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session">#</a></summary><ul><li><a href="#主題">主題</a></li></ul></details></li><li class="has-children"><details><summary>Vision framework <a href="#vision-framework">#</a></summary><ul><li><a href="#coreml">CoreML</a></li><li><a href="#ps">p.s.</a></li></ul></details></li><li><a href="#wwdc-2024--discover-swift-enhancements-in-the-vision-framework">WWDC 2024 — Discover Swift enhancements in the Vision framework</a></li><li class="has-children"><details><summary>Introduction — Vision framework Features <a href="#introduction--vision-framework-features">#</a></summary><ul><li><a href="#人臉辨識輪廓識別">人臉辨識、輪廓識別</a></li><li><a href="#圖像內容文字辨識">圖像內容文字辨識</a></li><li><a href="#動態動作捕捉">動態動作捕捉</a></li><li><a href="#whats-new-in-vision-ios-18-圖片評分功能-品質記憶點">What’s new in Vision? (iOS 18)— 圖片評分功能 (品質、記憶點)</a></li><li><a href="#whats-new-in-vision-ios-18--身體手勢姿勢同時偵測">What’s new in Vision? (iOS 18) — 身體＋手勢姿勢同時偵測</a></li></ul></details></li><li><a href="#new-vision-api">New Vision API</a></li><li><a href="#get-started-with-vision">Get started with Vision</a></li><li class="has-children"><details><summary>全部 31 種請求 Request <a href="#全部-31-種請求-request">#</a></summary><ul><li><a href="#classifyimagerequest">ClassifyImageRequest</a></li><li><a href="#recognizetextrequest">RecognizeTextRequest</a></li><li><a href="#detectbarcodesrequest">DetectBarcodesRequest</a></li><li><a href="#recognizeanimalsrequest">RecognizeAnimalsRequest</a></li><li><a href="#其他">其他</a></li><li><a href="#ios--18-update-highlight">iOS ≥ 18 Update Highlight</a></li></ul></details></li><li class="has-children"><details><summary>WWDC Example <a href="#wwdc-example">#</a></summary><ul><li><a href="#首先大多數的商品都有-barcode-可供掃描">首先大多數的商品都有 Barcode 可供掃描</a></li><li><a href="#部分商品無-barcode如散裝水果只有商品標籤">部分商品無 Barcode，如散裝水果只有商品標籤</a></li><li><a href="#ios--18-performall--方法">iOS ≥ 18 performAll( ) 方法</a></li></ul></details></li><li class="has-children"><details><summary>Optimize with Swift Concurrency <a href="#optimize-with-swift-concurrency">#</a></summary><ul><li><a href="#原始寫法">原始寫法</a></li><li><a href="#優化-1--taskgroup-concurrency">優化 (1) — TaskGroup Concurrency</a></li><li><a href="#優化-2--taskgroup-concurrency--限制並行數量">優化 (2) — TaskGroup Concurrency + 限制並行數量</a></li></ul></details></li><li><a href="#update-an-existing-vision-app">Update an existing Vision app</a></li><li><a href="#wrap-up">Wrap-up</a></li><li><a href="#thanks">Thanks!</a></li><li class="has-children"><details><summary>KKday 招募工商 <a href="#kkday-招募工商">#</a></summary><ul><li><a href="#參考資料">參考資料</a></li><li><a href="#discover-swift-enhancements-in-the-vision-framework">Discover Swift enhancements in the Vision framework</a></li></ul></details></li><li class="has-children"><details><summary>Chapters <a href="#chapters">#</a></summary><ul><li><a href="#vision-framework-apple-developer-documentation">Vision framework Apple Developer Documentation</a></li></ul></details></li></ul></nav><hr /><h3 id="ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session"><span class="me-2">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</span><a href="#ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision framework 功能回顧 &amp; iOS 18 新 Swift API 試玩</p><p><a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" alt="Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijg3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">BoliviaInteligente</a></p><h4 id="主題"><span class="me-2">主題</span><a href="#主題" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.webp" alt="跟 Vision Pro 的關係就跟熱狗跟狗的關係一樣，毫無關係。" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNTYwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>跟 Vision Pro 的關係就跟熱狗跟狗的關係一樣，毫無關係。</p><h3 id="vision-framework"><span class="me-2">Vision framework</span><a href="#vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision framework 是 Apple 整合機器學習的圖像辨識框架，讓開發者可以簡單快速地實現常見的圖像辨識功能；Vision framework 早在 iOS 11.0+ (2017/ iPhone 8) 就已推出，期間不斷地迭代優化，並完善與 Swift Concurrency 的特性整合提升執行效能，並且從 iOS 18.0 提供全新的 Swift Vision framework API 發揮 Swift Concurrency 最大效果。</p><p><strong>Vision framework 特色</strong></p><ul><li>內建眾多圖片辨識、動態追蹤方法 (iOS 18 為止一共 31 種)<li>On-Device 單純使用手機晶片運算，辨識過程不依賴雲端服務，快速又安全<li>API 簡單好操作<li>Apple 全平台均支援 iOS 11.0+, iPadOS 11.0+, Mac Catalyst 13.0+, macOS 10.13+, tvOS 11.0+, visionOS 1.0+<li>已發布多年 (2017~今) 且不斷更新<li>整合 Swift 語言特性提升運算效能</ul><blockquote><p><strong><em>6 年前曾經小玩過： <a href="/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/">Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)</a></em></strong></p></blockquote><blockquote><p><em>這次搭配 <a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">WWDC 24 Discover Swift enhancements in the Vision framework Session</a> 重新回顧並結合新的 Swfit 特性再玩一次。</em></p></blockquote><h4 id="coreml"><span class="me-2">CoreML</span><a href="#coreml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Apple 還有另外一個 Framework 叫 <a href="https://developer.apple.com/documentation/coreml" target="_blank">CoreML</a> ，也是基於 On-Device 晶片的機器學習框架；但他可以讓你自己訓練想辨識的物件、文件模型，並將模型放到 App 中直接使用，有興趣的朋友也可以玩看看。(e.g. <a href="/posts/zrealm-dev/ios-12-coreml-%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92%E6%96%87%E5%AD%97%E5%88%86%E9%A1%9E-%E8%87%AA%E8%A8%82%E6%A8%A1%E5%9E%8B%E8%A8%93%E7%B7%B4%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8-793bf2cdda0f/">即時文章分類</a> 、即時 <a href="https://apps.apple.com/tw/app/%E7%86%8A%E7%8C%AB%E5%90%83%E7%9F%AD%E4%BF%A1-%E5%9E%83%E5%9C%BE%E7%9F%AD%E4%BF%A1%E8%BF%87%E6%BB%A4/id1319191852" target="_blank">垃圾訊息檢測</a> …)</p><h4 id="ps"><span class="me-2">p.s.</span><a href="#ps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://developer.apple.com/documentation/vision/" target="_blank"><strong>Vision</strong></a> <strong>v.s. <a href="https://developer.apple.com/documentation/visionkit" target="_blank">VisionKit</a> ：</strong></p><blockquote><p><a href="https://developer.apple.com/documentation/vision/" target="_blank"><strong><em>Vision</em></strong></a> <em>：主要用於圖像分析任務，如臉部識別、條碼檢測、文本識別等。它提供了強大的 API 來處理和分析靜態圖像或視頻中的視覺內容。</em></p></blockquote><blockquote><p><a href="https://developer.apple.com/documentation/visionkit" target="_blank"><strong><em>VisionKit</em></strong></a> <em>：專門用於處理與文件掃描相關的任務。它提供了一個掃描儀視圖控制器，可以用來掃描文檔，並生成高質量的 PDF 或圖像。</em></p></blockquote><p>Vision framework 在 M1 機型上無法跑在模擬器，只能接實體手機測試；在模擬器環境執行會拋出 <code class="language-plaintext highlighter-rouge">Could not create Espresso context</code> Error，查 <a href="https://forums.developer.apple.com/forums/thread/675806" target="_blank">官方論壇討論，沒找到解答</a> 。</p><blockquote><p><em>因手邊沒有實體 iOS 18 裝置進行測試，所以本文中的所有執行結果都是使用舊的 (iOS 18 以前) 的寫法結果； <strong>如新寫法有出現錯誤再麻煩留言指教</strong> 。</em></p></blockquote><h3 id="wwdc-2024--discover-swift-enhancements-in-the-vision-framework"><span class="me-2">WWDC 2024 — Discover Swift enhancements in the Vision framework</span><a href="#wwdc-2024--discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.webp" alt="[Discover Swift enhancements in the Vision framework](https://developer.apple.com/videos/play/wwdc2024/10163/?time=45){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTEiIGhlaWdodD0iNDUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45" target="_blank">Discover Swift enhancements in the Vision framework</a></p><blockquote><p><em>本文是針對 WWDC 24 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45" target="_blank">Discover Swift enhancements in the Vision framework</a> Session 的分享筆記，跟一些自己實驗的心得。</em></p></blockquote><h3 id="introduction--vision-framework-features"><span class="me-2">Introduction — Vision framework Features</span><a href="#introduction--vision-framework-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="人臉辨識輪廓識別"><span class="me-2">人臉辨識、輪廓識別</span><a href="#人臉辨識輪廓識別" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjYiIGhlaWdodD0iNDgyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDciIGhlaWdodD0iNDQ4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="圖像內容文字辨識"><span class="me-2">圖像內容文字辨識</span><a href="#圖像內容文字辨識" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>截至 iOS 18 為止，支援 18 種語言。</p><p><a href="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTciIGhlaWdodD0iMzk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// 支援的語系列表</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="kt">RecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="n">supportedRecognitionLanguages</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">languageCode</span><span class="o">!</span><span class="se">)</span><span class="s">-</span><span class="se">\(</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">region</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span> <span class="p">??</span> <span class="nv">$0</span><span class="o">.</span><span class="n">script</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span><span class="o">!</span><span class="se">)</span><span class="s">"</span> <span class="p">})</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="k">try!</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="nf">supportedRecognitionLanguages</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 實際可用辨識語言以這為主。</span>
<span class="c1">// 實測 iOS 18 輸出以下結果：</span>
<span class="c1">// ["en-US", "fr-FR", "it-IT", "de-DE", "es-ES", "pt-BR", "zh-Hans", "zh-Hant", "yue-Hans", "yue-Hant", "ko-KR", "ja-JP", "ru-RU", "uk-UA", "th-TH", "vi-VT", "ar-SA", "ars-SA"]</span>
<span class="c1">// 未看到 WWDC 提到的 Swedish 語言，不確定是還沒推出還是跟裝置地區、語系有關聯</span>
</pre></table></code></div></div><h4 id="動態動作捕捉"><span class="me-2">動態動作捕捉</span><a href="#動態動作捕捉" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*6TfyCcszdD1NdId0bdM16Q.gif" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*6TfyCcszdD1NdId0bdM16Q.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTQiIGhlaWdodD0iNDEwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*8y_XXdH36uKpfP0p6BCJQA.gif" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8y_XXdH36uKpfP0p6BCJQA.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTgiIGhlaWdodD0iNDIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>可以實現人、物件動態捕捉<li>手勢補捉實現隔空簽名功能</ul><h4 id="whats-new-in-vision-ios-18-圖片評分功能-品質記憶點"><span class="me-2">What’s new in Vision? (iOS 18)— 圖片評分功能 (品質、記憶點)</span><a href="#whats-new-in-vision-ios-18-圖片評分功能-品質記憶點" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>可對輸入圖片得計算出分數，方便篩選出優質照片<li>分數計算方式包含多個維度，不只是畫質，還有光線、角度、拍攝主體、 <strong>是否有讓人感到的記憶點</strong> …等等</ul><p><a href="/assets/755509180ca8/1*XwjeaHcB6arxJhIR7cFsWg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*XwjeaHcB6arxJhIR7cFsWg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTIiIGhlaWdodD0iNDQ5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*YdhZlZBlTaIZd4nLxhBtaQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YdhZlZBlTaIZd4nLxhBtaQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDgiIGhlaWdodD0iNDUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*IhMDFdk6DWwTv1qIG0Gi0Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*IhMDFdk6DWwTv1qIG0Gi0Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDkiIGhlaWdodD0iNDQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>WWDC 中給了以上三張圖片做說明(相同畫質之下)，分別是：</p><ul><li>高分的圖片：取景、光線、有記憶點<li>低分的圖片：沒有主體、像是隨手或不小心拍的<li>素材的圖片：技術上拍的很好但是沒有記憶點，像是作為素材圖庫用的圖片</ul><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/calculateimageaestheticsscoresrequest" target="_blank">CalculateImageAestheticsScoresRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">CalculateImageAestheticsScoresRequest</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

<span class="c1">// 照片分數</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">overallScore</span><span class="p">)</span>

<span class="c1">// 是否被判定為素材圖片</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">isUtility</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="whats-new-in-vision-ios-18--身體手勢姿勢同時偵測"><span class="me-2">What’s new in Vision? (iOS 18) — 身體＋手勢姿勢同時偵測</span><a href="#whats-new-in-vision-ios-18--身體手勢姿勢同時偵測" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*A9320aRV-jdccgiXrmSrJw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*A9320aRV-jdccgiXrmSrJw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMzM0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>以往只能個別偵測人體 Pose 和 手部 Pose，這次更新可以讓開發者同時偵測身體 Pose + 手部 Pose，合成同一個請求跟結果，方便我們做更多應用功能開發。</p><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/detecthumanbodyposerequest" target="_blank">DetectHumanBodyPoseRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectHumanBodyPoseRequest</span><span class="p">()</span>
<span class="c1">// 一併偵測手部 Pose</span>
<span class="n">request</span><span class="o">.</span><span class="n">detectsHands</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">bodyPose</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">image</span><span class="p">)</span><span class="o">.</span> <span class="n">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

<span class="c1">// 身體 Pose Joints</span>
<span class="k">let</span> <span class="nv">bodyJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// 左手 Pose Joints</span>
<span class="k">let</span> <span class="nv">leftHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">leftHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// 右手 Pose Joints</span>
<span class="k">let</span> <span class="nv">rightHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">rightHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="new-vision-api"><span class="me-2">New Vision API</span><a href="#new-vision-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Apple 在這次的更新當中提供了新的 Swift Vision API 封裝給開發者使用，除了基本的包含原本的功能支援之外，主要針對加強 Swift 6 / Swift Concurrency 的特性，提供效能更優、寫起來更 Swift 的 API 操作方式。</p><h3 id="get-started-with-vision"><span class="me-2">Get started with Vision</span><a href="#get-started-with-vision" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*mv9g5jmqrS6YScxoGYJemQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*mv9g5jmqrS6YScxoGYJemQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDAiIGhlaWdodD0iNDE5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*iidNN7nKHoskh_tcjfuHKQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*iidNN7nKHoskh_tcjfuHKQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzgiIGhlaWdodD0iNDAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>這邊講者又重新介紹了一次 Vision framework 的基礎使用方式，Apple 已經封裝好了 <a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">31 種</a> (截至 iOS 18)常見的圖像辨識請求「Request」與對應回傳的「Observation」物件。</p><ol><li><strong>Request:</strong> DetectFaceRectanglesRequest 人臉區域識別請求 <strong>Result:</strong> FaceObservation 之前的文章「 <a href="/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/">Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)</a> 」就是用這對請求。<li><strong>Request:</strong> RecognizeTextRequest 文字辨識請求 <strong>Result:</strong> RecognizedTextObservation<li><strong>Request:</strong> GenerateObjectnessBasedSaliencyImageRequest 主體物件辨識請求 <strong>Result:</strong> SaliencyImageObservation</ol><h3 id="全部-31-種請求-request"><span class="me-2">全部 31 種請求 Request：</span><a href="#全部-31-種請求-request" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">VisionRequest</a> 。</p><div class="table-wrapper"><table><thead><tr><th>Request 用途<th>Observation 說明<tbody><tr><td>CalculateImageAestheticsScoresRequest<br />計算圖像的美學分數。<td>AestheticsObservation<br />返回圖像的美學評分，如構圖、色彩等因素。<tr><td>ClassifyImageRequest<br />分類圖像內容。<td>ClassificationObservation<br />返回圖像中物體或場景的分類標籤及置信度。<tr><td>CoreMLRequest<br />使用 Core ML 模型分析圖像。<td>CoreMLFeatureValueObservation<br />根據 Core ML 模型的輸出結果生成觀察值。<tr><td>DetectAnimalBodyPoseRequest<br />檢測圖像中的動物姿勢。<td>RecognizedPointsObservation<br />返回動物的骨架點及其位置。<tr><td>DetectBarcodesRequest<br />檢測圖像中的條碼。<td>BarcodeObservation<br />返回條碼數據及類型（如 QR code）。<tr><td>DetectContoursRequest<br />檢測圖像中的輪廓。<td>ContoursObservation<br />返回圖像中檢測到的輪廓線。<tr><td>DetectDocumentSegmentationRequest<br />檢測並分割圖像中的文件。<td>RectangleObservation<br />返回文件邊界的矩形框位置。<tr><td>DetectFaceCaptureQualityRequest<br />評估面部捕捉質量。<td>FaceObservation<br />返回面部圖像的質量評估分數。<tr><td>DetectFaceLandmarksRequest<br />檢測面部特徵點。<td>FaceObservation<br />返回面部特徵點（如眼睛、鼻子等）的詳細位置。<tr><td>DetectFaceRectanglesRequest<br />檢測圖像中的面部。<td>FaceObservation<br />返回人臉的邊界框位置。<tr><td>DetectHorizonRequest<br />檢測圖像中的地平線。<td>HorizonObservation<br />返回地平線的角度和位置。<tr><td>DetectHumanBodyPose3DRequest<br />檢測圖像中的 3D 人體姿勢。<td>RecognizedPointsObservation<br />返回 3D 人體骨架點及其空間坐標。<tr><td>DetectHumanBodyPoseRequest<br />檢測圖像中的人體姿勢。<td>RecognizedPointsObservation<br />返回人體骨架點及其坐標。<tr><td>DetectHumanHandPoseRequest<br />檢測圖像中的手部姿勢。<td>RecognizedPointsObservation<br />返回手部骨架點及其位置。<tr><td>DetectHumanRectanglesRequest<br />檢測圖像中的人體。<td>HumanObservation<br />返回人體的邊界框位置。<tr><td>DetectRectanglesRequest<br />檢測圖像中的矩形。<td>RectangleObservation<br />返回矩形的四個頂點坐標。<tr><td>DetectTextRectanglesRequest<br />檢測圖像中的文本區域。<td>TextObservation<br />返回文本區域的位置和邊界框。<tr><td>DetectTrajectoriesRequest<br />檢測並分析物體運動軌跡。<td>TrajectoryObservation<br />返回運動軌跡點及其時間序列。<tr><td>GenerateAttentionBasedSaliencyImageRequest<br />生成基於注意力的顯著性圖像。<td>SaliencyImageObservation<br />返回圖像中最具吸引力區域的顯著性地圖。<tr><td>GenerateForegroundInstanceMaskRequest<br />生成前景實例掩膜圖像。<td>InstanceMaskObservation<br />返回前景物體的掩膜。<tr><td>GenerateImageFeaturePrintRequest<br />生成圖像特徵指紋以進行比較。<td>FeaturePrintObservation<br />返回圖像的特徵指紋數據，用於相似度比較。<tr><td>GenerateObjectnessBasedSaliencyImageRequest<br />生成基於物體顯著性的圖像。<td>SaliencyImageObservation<br />返回物體顯著性區域的顯著性地圖。<tr><td>GeneratePersonInstanceMaskRequest<br />生成人物實例掩膜圖像。<td>InstanceMaskObservation<br />返回人物實例的掩膜。<tr><td>GeneratePersonSegmentationRequest<br />生成人物分割圖像。<td>SegmentationObservation<br />返回人物分割的二值圖。<tr><td>RecognizeAnimalsRequest<br />檢測並識別圖像中的動物。<td>RecognizedObjectObservation<br />返回動物類型及其置信度。<tr><td>RecognizeTextRequest<br />檢測並識別圖像中的文本。<td>RecognizedTextObservation<br />返回檢測到的文本內容及其區域位置。<tr><td>TrackHomographicImageRegistrationRequest<br />跟踪圖像的同位影像配準。<td>ImageAlignmentObservation<br />返回圖像間的同位變換矩陣，用於影像配準。<tr><td>TrackObjectRequest<br />跟踪圖像中的物體。<td>DetectedObjectObservation<br />返回物體在影像中的位置和速度信息。<tr><td>TrackOpticalFlowRequest<br />跟踪圖像中的光流。<td>OpticalFlowObservation<br />返回光流矢量場，用於描述像素移動情況。<tr><td>TrackRectangleRequest<br />跟踪圖像中的矩形。<td>RectangleObservation<br />返回矩形在影像中的位置、大小和旋轉角度。<tr><td>TrackTranslationalImageRegistrationRequest<br />跟踪圖像的平移影像配準。<td>ImageAlignmentObservation<br />返回圖像間的平移變換矩陣，用於影像配準。</table></div><ul><li>前面補上 VN 就是舊的 API 寫法 (iOS 18 以前的版本)</ul><p>講者提到了幾個常用的 Request，如下。</p><h4 id="classifyimagerequest"><span class="me-2">ClassifyImageRequest</span><a href="#classifyimagerequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨識輸入的圖片，得到標籤分類與置信度。</p><p><a href="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.webp" alt="[遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc3NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>[遊記] 2024 二訪九州 9 日自由行，經釜山→博多郵輪入境</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">ClassifyImageRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNClassificationObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNClassifyImageRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*3_jdrLurFuUfNdW4BJaRww.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析結果：</strong></p><div class="language-r highlighter-rouge"><div class="code-header"> <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">outdoor</span><span class="err">（</span><span class="n">戶外</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sky</span><span class="err">（</span><span class="n">天空</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">blue_sky</span><span class="err">（</span><span class="n">藍天</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.7519531</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">machine</span><span class="err">（</span><span class="n">機器</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.6958008</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">cloudy</span><span class="err">（</span><span class="n">多雲</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.26538086</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">structure</span><span class="err">（</span><span class="n">結構</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.15728651</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sign</span><span class="err">（</span><span class="n">標誌</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.14224191</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">fence</span><span class="err">（</span><span class="n">柵欄</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.118652344</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">banner</span><span class="err">（</span><span class="n">橫幅</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.0793457</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">material</span><span class="err">（</span><span class="n">材料</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.075975396</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">plant</span><span class="err">（</span><span class="n">植物</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.054406323</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">foliage</span><span class="err">（</span><span class="n">樹葉</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.05029297</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">light</span><span class="err">（</span><span class="n">光</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.048126098</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">lamppost</span><span class="err">（</span><span class="n">燈柱</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.048095703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">billboards</span><span class="err">（</span><span class="n">廣告牌</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.040039062</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">art</span><span class="err">（</span><span class="n">藝術</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.03977703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">branch</span><span class="err">（</span><span class="n">樹枝</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.03930664</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">decoration</span><span class="err">（</span><span class="n">裝飾</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.036868922</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">flag</span><span class="err">（</span><span class="n">旗幟</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.036865234</span><span class="w">
</span><span class="n">....略</span><span class="w">
</span></pre></table></code></div></div><h4 id="recognizetextrequest"><span class="me-2">RecognizeTextRequest</span><a href="#recognizetextrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨識圖片中的文字內容。(a.k.a 圖片轉文字)</p><p><a href="/assets/755509180ca8/1*XL40lLT774PfO60rCIfnxA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*XL40lLT774PfO60rCIfnxA.webp" alt="[[遊記] 2023 東京 5 日自由行](/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E6%9D%B1%E4%BA%AC%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-5-%E5%A4%A9%E9%A3%9F%E4%BD%8F%E8%A1%8C%E5%85%A8%E8%A8%98%E9%8C%84%E8%88%87%E5%BF%85%E8%A8%AA%E6%99%AF%E9%BB%9E%E6%8E%A8%E8%96%A6-9da2c51fa4f2/)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E6%9D%B1%E4%BA%AC%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-5-%E5%A4%A9%E9%A3%9F%E4%BD%8F%E8%A1%8C%E5%85%A8%E8%A8%98%E9%8C%84%E8%88%87%E5%BF%85%E8%A8%AA%E6%99%AF%E9%BB%9E%E6%8E%A8%E8%96%A6-9da2c51fa4f2/">[遊記] 2023 東京 5 日自由行</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"ja-JP"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ja-JP"</span><span class="p">,</span> <span class="s">"en-US"</span><span class="p">]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析結果：</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="err">LE</span> <span class="err">LABO</span> <span class="err">青山店</span>
<span class="nl">TEL</span><span class="o">:</span><span class="nf">03-6419-7167</span>
<span class="err">＊お買い上げありがとうございます*</span>
<span class="nl">No</span><span class="o">:</span> <span class="nf">21347</span>
<span class="err">日付：2023/06/10</span> <span class="err">14.14.57</span>
<span class="err">担当：</span>
<span class="err">1690370</span>
<span class="err">レジ：008A</span> <span class="err">1</span>
<span class="err">商品名</span>
<span class="err">税込上代数量税込合計</span>
<span class="err">カイアック</span> <span class="err">10</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1P7010000S</span>
<span class="err">16,800</span>
<span class="err">16,800</span>
<span class="err">アナザー</span> <span class="err">13</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1PJ010000S</span>
<span class="err">10,700</span>
<span class="err">10,700</span>
<span class="err">リップパーム</span> <span class="err">15ML</span>
<span class="err">JOWC010000S</span>
<span class="err">2,000</span>
<span class="err">1</span>
<span class="err">合計金額</span>
<span class="err">（内税額）</span>
<span class="err">CARD</span>
<span class="err">2,000</span>
<span class="err">3点御買上げ</span>
<span class="err">29,500</span>
<span class="err">0</span>
<span class="err">29,500</span>
<span class="err">29,500</span>
</pre></table></code></div></div><h4 id="detectbarcodesrequest"><span class="me-2">DetectBarcodesRequest</span><a href="#detectbarcodesrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>偵測圖片中的條碼、QRCode 數據。</p><p><a href="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.webp" alt="泰國當地人推薦鵝牌清涼膏" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>泰國當地人推薦鵝牌清涼膏</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6777"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地測試圖片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析結果：</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nl">Payload</span><span class="o">:</span> <span class="nf">8859126000911</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://lin.ee/hGynbVM</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">http://www.hongthaipanich.com/</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://www.facebook.com/qr?id=100063856061714</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
</pre></table></code></div></div><h4 id="recognizeanimalsrequest"><span class="me-2">RecognizeAnimalsRequest</span><a href="#recognizeanimalsrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨識圖片中的動物與置信度。</p><p><a href="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjkwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.webp" alt="[meme Source](https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTAwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7" target="_blank">meme Source</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_5026"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地測試圖片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeAnimalsRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">label</span> <span class="k">in</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedObjectObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">label</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeAnimalsRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>分析結果：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Detected</span> <span class="n">animal</span><span class="p">:</span> <span class="n">Cat</span> <span class="k">with</span> <span class="n">confidence</span><span class="p">:</span> <span class="m">0.77245045</span>
</pre></table></code></div></div><h4 id="其他"><span class="me-2">其他：</span><a href="#其他" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>偵測圖像中的人體：DetectHumanRectanglesRequest<li>偵測人、動物的 Pose 動作 (3D or 2D 都可以)：DetectAnimalBodyPoseRequest、DetectHumanBodyPose3DRequest、DetectHumanBodyPoseRequest、DetectHumanHandPoseRequest<li>檢測並追蹤物件的運動軌跡(在影片、動畫不同的偵中)：DetectTrajectoriesRequest、TrackObjectRequest、TrackRectangleRequest</ul><h4 id="ios--18-update-highlight"><span class="me-2"><strong>iOS ≥ 18 Update Highlight:</strong></span><a href="#ios--18-update-highlight" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">VN</span><span class="o">*</span><span class="n">Request</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Request</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNDetectBarcodesRequest</span> <span class="k">-&gt;</span> <span class="n">DetectBarcodesRequest</span><span class="p">)</span>
<span class="n">VN</span><span class="o">*</span><span class="n">Observation</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Observation</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNRecognizedObjectObservation</span> <span class="k">-&gt;</span> <span class="n">RecognizedObjectObservation</span><span class="p">)</span>
<span class="n">VNRequestCompletionHandler</span> <span class="k">-&gt;</span> <span class="k">async</span><span class="o">/</span><span class="k">await</span>
<span class="n">VNImageRequestHandler</span><span class="nf">.perform</span><span class="p">([</span><span class="n">VN</span><span class="o">*</span><span class="n">Request</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="n">Request</span><span class="nf">.perform</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="wwdc-example"><span class="me-2">WWDC Example</span><a href="#wwdc-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>WWDC 官方影片以超市商品掃描器為例。</p><h4 id="首先大多數的商品都有-barcode-可供掃描"><span class="me-2">首先大多數的商品都有 Barcode 可供掃描</span><a href="#首先大多數的商品都有-barcode-可供掃描" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDAiIGhlaWdodD0iODY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYwNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>我們可以從 <code class="language-plaintext highlighter-rouge">observation.boundingBox</code> 取得 Barcode 所在位置，但不同於常見 UIView 座標系， <code class="language-plaintext highlighter-rouge">BoundingBox</code> 的相對位置起點是從左下角，值的範圍落在 0~1 之間。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6785"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地測試圖片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要掃描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// 標記顏色 Layer</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// iOS &gt;=18 新的座標轉換 API toImageCoordinates</span>
                    <span class="c1">// 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// 標記顏色 Layer</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要掃描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><pre><code class="language-less">// iOS &gt;=18 新的座標轉換 API toImageCoordinates
observation.boundingBox.toImageCoordinates(CGSize, origin: .upperLeft)
// https://developer.apple.com/documentation/vision/normalizedpoint/toimagecoordinates(from:imagesize:origin:)
</code></pre><p><strong>Helper:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">// Gen by ChatGPT 4o</span>
<span class="c1">// 因為照片在 ImageView 是設定 ContentMode = AspectFit</span>
<span class="c1">// 所以要多計算上下因 Fit 造成的空白位移</span>
<span class="kd">func</span> <span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">_</span> <span class="nv">boundingBox</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">,</span> <span class="n">to</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">UIImageView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGRect</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">zero</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">imageSize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">viewSize</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">imageRatio</span> <span class="o">=</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">let</span> <span class="nv">viewRatio</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">var</span> <span class="nv">scaleFactor</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">var</span> <span class="nv">offsetX</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">offsetY</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">imageRatio</span> <span class="o">&gt;</span> <span class="n">viewRatio</span> <span class="p">{</span>
        <span class="c1">// 圖像在寬度方向上適配</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span>
        <span class="n">offsetY</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 圖像在高度方向上適配</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
        <span class="n">offsetX</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">minX</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetX</span>
    <span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">maxY</span><span class="p">)</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetY</span>
    <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">let</span> <span class="nv">height</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">return</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">height</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>輸出結果</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">BoundingBox</span><span class="o">:</span> <span class="nf">(0.5295758928571429</span><span class="p">,</span><span class="nf"> 0.21408638121589782</span><span class="p">,</span><span class="nf"> 0.0943080357142857</span><span class="p">,</span><span class="nf"> 0.21254415360708087)</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">4710018183805</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
</pre></table></code></div></div><h4 id="部分商品無-barcode如散裝水果只有商品標籤"><span class="me-2">部分商品無 Barcode，如散裝水果只有商品標籤</span><a href="#部分商品無-barcode如散裝水果只有商品標籤" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzYiIGhlaWdodD0iODM0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>因此我們的掃瞄器也需要同時支援掃描純文字標籤。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"apple"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"jpg"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地測試圖片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要掃描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
            <span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
            <span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
            <span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// 標記顏色 Layer</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// iOS &gt;=18 新的座標轉換 API toImageCoordinates</span>
                    <span class="c1">// 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 舊的寫法</span>
    <span class="k">let</span> <span class="nv">barcodesCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// 標記顏色 Layer</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">textCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">barcodesCompletionHandler</span><span class="p">)</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要掃描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">let</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">textCompletionHandler</span><span class="p">)</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"en-US"</span><span class="p">]</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>輸出結果：</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>94128s
ORGANIC
Pink Lady®
Produce of USh
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
<span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
<span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
<span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="ios--18-performall--方法"><span class="me-2">iOS ≥ 18 <a href="https://developer.apple.com/documentation/vision/imagerequesthandler/performall(_:)?changes=latest_minor" target="_blank">performAll( )</a> 方法</span><a href="#ios--18-performall--方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAwIiBoZWlnaHQ9Ijc0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>前面的 <code class="language-plaintext highlighter-rouge">perform(barcodesRequest, textRequest)</code> 處理 Barcode 掃描跟文字掃描的方式需要等到兩個 Request 都完成才能繼續執行；iOS 18 開始提供新的 <code class="language-plaintext highlighter-rouge">performAll()</code> 方法，將回應方式改為串流，在收到其中一個 Reqeust 結果是就能做對應處理，例如掃描到 Barcode 就直接響應。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要掃描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="nf">performAll</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">]</span> <span class="k">as</span> <span class="p">[</span><span class="kd">any</span> <span class="kt">VisionRequest</span><span class="p">])</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">result</span> <span class="k">in</span> <span class="n">observation</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">detectBarcodes</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">barcodesObservation</span><span class="p">):</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                        <span class="c1">// 標記顏色 Layer</span>
                        <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                        <span class="c1">// iOS &gt;=18 新的座標轉換 API toImageCoordinates</span>
                        <span class="c1">// 未經測試，實際可能還需要計算 ContentMode = AspectFit 的位移:</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">recognizeText</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">textObservation</span><span class="p">):</span>
                <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">observation</span> <span class="k">in</span>
                    <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Unrecongnized result: </span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="optimize-with-swift-concurrency"><span class="me-2">Optimize with Swift Concurrency</span><a href="#optimize-with-swift-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*LgxxMOVS6is3n6EqPWqA6Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*LgxxMOVS6is3n6EqPWqA6Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ0IiBoZWlnaHQ9IjYxOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*80CFJpkb-gjy3bJs4jAC2A.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*80CFJpkb-gjy3bJs4jAC2A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTYiIGhlaWdodD0iODQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>假設我們有一個圖片牆列表，每張圖片都需要自動裁切出物件主體；這時候可以善用 Swift Concurrency 增加載入效率。</p><h4 id="原始寫法"><span class="me-2"><strong>原始寫法</strong></span><a href="#原始寫法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="k">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">GenerateAttentionBasedSaliencyImageRequest</span><span class="p">()</span>
  <span class="k">let</span> <span class="nv">saliencyObservation</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="nf">cropImage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">saliencyObservation</span><span class="o">.</span><span class="n">salientObjects</span><span class="p">)</span>
<span class="p">}</span>
    
<span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>一次只執行一個，效率、效能緩慢。</p><h4 id="優化-1--taskgroup-concurrency"><span class="me-2"><strong>優化 (1) — TaskGroup</strong> Concurrency</span><a href="#優化-1--taskgroup-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>
<span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span> <span class="n">taskGroup</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
      <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>將每個 Task 都加入 TaskGroup Concurrency 執行。</p><blockquote><p><strong><em>問題：圖片辨識、截圖操作非常消耗記憶體性能，如果無節制狂加並行任務，可能造成使用者卡頓、OOM 閃退問題。</em></strong></p></blockquote><h4 id="優化-2--taskgroup-concurrency--限制並行數量"><span class="me-2">優化 (2) — TaskGroup Concurrency + 限制並行數量</span><a href="#優化-2--taskgroup-concurrency--限制並行數量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span>
        <span class="n">taskGroup</span> <span class="k">in</span>
        <span class="c1">// 最多執行數量不得超過 5</span>
        <span class="k">let</span> <span class="nv">maxImageTasks</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="c1">// 先填充 5 個 Task</span>
        <span class="k">for</span> <span class="n">index</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">maxImageTasks</span> <span class="p">{</span>
            <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">nextIndex</span> <span class="o">=</span> <span class="n">maxImageTasks</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">_</span> <span class="k">in</span> <span class="n">taskGroup</span> <span class="p">{</span>
            <span class="c1">// taskGroup 裡 Task await 完成時...</span>
            <span class="c1">// 檢查 Index 是否到尾部</span>
            <span class="k">if</span> <span class="n">nextIndex</span> <span class="o">&lt;</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">nextIndex</span><span class="p">]</span>
                <span class="c1">// 繼續逐個填充 Task (將維持在最多 5 個)</span>
                <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">nextIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="update-an-existing-vision-app"><span class="me-2">Update an existing Vision app</span><a href="#update-an-existing-vision-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*0OhzcxQ7OpSujeyvt9918Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*0OhzcxQ7OpSujeyvt9918Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjcxNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*MH4Xa0RB2DZQ1Fl9-kItSw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*MH4Xa0RB2DZQ1Fl9-kItSw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ol><li>Vision 將在具備神經引擎的設備上移除對部分請求的 CPU 和 GPU 支持。在這些設備上，神經引擎是性能最好的選擇。 可以使用 <code class="language-plaintext highlighter-rouge">supportedComputeDevices()</code> API 進行檢查<li>移除所有 VN 前綴 <code class="language-plaintext highlighter-rouge">VNXXRequest</code> , <code class="language-plaintext highlighter-rouge">VNXXXObservation</code> -&gt; <code class="language-plaintext highlighter-rouge">Reqeust</code> , <code class="language-plaintext highlighter-rouge">Observation</code><li>使用 async/await 取代原本的 VNRequestCompletionHandler<li>直接使用 <code class="language-plaintext highlighter-rouge">*Request.perform()</code> 取代原本的 <code class="language-plaintext highlighter-rouge">VNImageRequestHandler.perform([VN*Request])</code></ol><h3 id="wrap-up"><span class="me-2">Wrap-up</span><a href="#wrap-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>為 Swift 語言特性新設計的 API<li>新的功能、方法都為 Swift Only, iOS ≥ 18 可用<li>新的圖片評分功能、身體＋手部動作追蹤</ul><h3 id="thanks"><span class="me-2">Thanks!</span><a href="#thanks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijc3OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h3 id="kkday-招募工商"><span class="me-2">KKday 招募工商</span><a href="#kkday-招募工商" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iNDM5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>👉👉👉本次讀書會分享源於 KKday App Team 組內每週技術分享活動， <strong>目前團隊也正在熱情招募 <a href="https://kkday.bamboohr.com/careers/25?source=aWQ9Mjk%3D" target="_blank">Senior iOS Engineer</a> ，有興趣的朋友歡迎投遞履歷</strong> 。👈👈👈</p><h4 id="參考資料"><span class="me-2">參考資料</span><a href="#參考資料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="discover-swift-enhancements-in-the-vision-framework"><span class="me-2"><a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">Discover Swift enhancements in the Vision framework</a></span><a href="#discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The Vision Framework API has been redesigned to leverage modern Swift features like concurrency, making it easier and faster to integrate a wide array of Vision algorithms into your app. We’ll tour the updated API and share sample code, along with best practices, to help you get the benefits of this framework with less coding effort. We’ll also demonstrate two new features: image aesthetics and holistic body pose.</p><h3 id="chapters"><span class="me-2">Chapters</span><a href="#chapters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>0:00 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=0" target="_blank">Introduction</a><li>1:07 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=67" target="_blank">New Vision API</a><li>1:47 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=107" target="_blank">Get started with Vision</a><li>8:59 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=539" target="_blank">Optimize with Swift Concurrency</a><li>11:05 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=665" target="_blank">Update an existing Vision app</a><li>13:46 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=826" target="_blank">What’s new in Vision?</a></ul><h4 id="vision-framework-apple-developer-documentation"><span class="me-2"><a href="https://developer.apple.com/documentation/vision/" target="_blank">Vision framework Apple Developer Documentation</a></span><a href="#vision-framework-apple-developer-documentation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>-</p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/755509180ca8" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2024-08-13-755509180ca8.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/kkday-tech-blog/">KKday Tech Blog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/vision-framework/" class="post-tag no-text-decoration" >vision-framework</a> <a href="/tags/apple-intelligence/" class="post-tag no-text-decoration" >apple-intelligence</a> <a href="/tags/ai/" class="post-tag no-text-decoration" >ai</a> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine-learning</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20Vision%20framework%EF%BD%9CWWDC%2024%20Swift%20Concurrency%20%E8%88%87%E6%96%B0%20API%20%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E8%2588%2587%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20Vision%20framework%EF%BD%9CWWDC%2024%20Swift%20Concurrency%20%E8%88%87%E6%96%B0%20API%20%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E8%2588%2587%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E8%2588%2587%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%B3-%E4%BD%8E%E6%89%8B%E7%BA%8C%E8%B2%BB150%E5%85%83-%E5%B8%B3%E6%88%B6%E5%8D%87%E7%B4%9A%E8%88%87%E6%89%8B%E7%BA%8C%E8%B2%BB%E8%A3%9C%E5%8A%A9%E7%94%B3%E8%AB%8B%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教學 — LINE Bank 入金 Firstrade 快速到帳、手續費只要 150 元及帳戶升級/約定轉帳/手續費補助申請教學</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/japan-overseas-shopping-rakuten-consolidated-shipping-for-taiwan-buy-from-rakuten-amazon-bea62c251f1b/">Japan Overseas Shopping｜Rakuten Consolidated Shipping for Taiwan｜Buy from Rakuten & Amazon</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/%E6%97%A5%E6%9C%AC%E4%B9%90%E5%A4%A9%E9%9B%86%E8%BF%90%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E8%B4%AD%E4%B9%B0horie%E9%92%9B%E6%9D%AF%E4%B8%8Eamazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E6%B9%BE%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外购物寄送台湾教学 — 使用乐天集运购买乐天拍卖与 Amazon 商品 (Horie 钛杯)</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1723536637" data-df="ll" > Aug 13, 2024 </time><h4 class="pt-0 my-2">iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</h4><div class="text-muted"><p>iOS 开发者面对 Vision framework 复杂图像辨识需求，透过 WWDC 24 Swift Concurrency 新 API，掌握 31 种图像辨识请求与身体手势追踪，提升辨识效率与安全性，实现高效图像分析与即时应用。</p></div></div></a></article><article class="col"> <a href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1723536637" data-df="ll" > Aug 13, 2024 </time><h4 class="pt-0 my-2">iOS Vision Framework｜Explore Swift API Enhancements from WWDC 24 Session</h4><div class="text-muted"><p>Discover how iOS 18&#39;s Vision framework Swift APIs simplify image analysis and improve development efficiency. Learn key updates and practical usage to boost your app&#39;s computer vision capabilities ...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/coreml-2-0-automate-article-classification-with-custom-trained-machine-learning-models-793bf2cdda0f/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539789635" data-df="ll" > Oct 17, 2018 </time><h4 class="pt-0 my-2">CoreML 2.0｜Automate Article Classification with Custom-Trained Machine Learning Models</h4><div class="text-muted"><p>Discover how iOS developers leverage CoreML 2.0 to train and convert machine learning models, enabling automatic article classification and seamless integration into real-world apps for improved ac...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</p></a> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
