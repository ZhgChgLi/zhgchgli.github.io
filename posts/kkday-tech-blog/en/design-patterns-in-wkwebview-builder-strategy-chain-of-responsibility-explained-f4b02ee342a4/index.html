<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Design Patterns in WKWebView: Builder, Strategy &amp; Chain of Responsibility Explained" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Explore how to apply Builder, Strategy, and Chain of Responsibility patterns to streamline WKWebView encapsulation in iOS, solving complex UI logic and improving code maintainability effectively." /><meta property="og:description" content="Explore how to apply Builder, Strategy, and Chain of Responsibility patterns to streamline WKWebView encapsulation in iOS, solving complex UI logic and improving code maintainability effectively." /><link rel="canonical" href="https://zhgchg.li/posts/kkday-tech-blog/en/design-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4/" /><meta property="og:url" content="https://zhgchg.li/posts/kkday-tech-blog/en/design-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-09-06T13:47:47+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" /><meta property="twitter:title" content="Design Patterns in WKWebView: Builder, Strategy &amp; Chain of Responsibility Explained" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-07T16:45:32+08:00","datePublished":"2024-09-06T13:47:47+08:00","description":"Explore how to apply Builder, Strategy, and Chain of Responsibility patterns to streamline WKWebView encapsulation in iOS, solving complex UI logic and improving code maintainability effectively.","headline":"Design Patterns in WKWebView: Builder, Strategy &amp; Chain of Responsibility Explained","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/kkday-tech-blog/en/design-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4/"},"url":"https://zhgchg.li/posts/kkday-tech-blog/en/design-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4/"}</script><title>Design Patterns in WKWebView: Builder, Strategy & Chain of Responsibility Explained | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-cn" href="/posts/kkday-tech-blog/zh-cn/wkwebview-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98-builder-strategy-%E4%B8%8E%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/"><link rel="alternate" hreflang="zh-tw" href="/posts/kkday-tech-blog/wkwebview-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E6%88%B0-builder-strategy-%E8%88%87%E8%B2%AC%E4%BB%BB%E9%8F%88%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E6%87%89%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/"><link rel="alternate" hreflang="x-default" href="/posts/kkday-tech-blog/en/design-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4/"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Design Patterns in WKWebView: Builder, Strategy & Chain of Responsibility Explained</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Design Patterns in WKWebView: Builder, Strategy & Chain of Responsibility Explained</h1><p class="post-desc fw-light mb-4">Explore how to apply Builder, Strategy, and Chain of Responsibility patterns to streamline WKWebView encapsulation in iOS, solving complex UI logic and improving code maintainability effectively.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1725601667" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 6, 2024 </time> </span> <span> Updated <time data-ts="1725698732" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 7, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" class="popup img-link preview-img blur"><img data-src="/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3604 words" > <em>20 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Design Patterns in WKWebView: Builder, Strategy & Chain of Responsibility Explained</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Design Patterns in WKWebView: Builder, Strategy & Chain of Responsibility Explained</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/zh-cn/wkwebview-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98-builder-strategy-%E4%B8%8E%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/wkwebview-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E6%88%B0-builder-strategy-%E8%88%87%E8%B2%AC%E4%BB%BB%E9%8F%88%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E6%87%89%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance — let me know if anything sounds off!</p></blockquote><hr /><h3 id="practical-application-record-of-design-patternsin-wkwebview-with-builder-strategy--chain-of-responsibility-pattern"><span class="me-2">Practical Application Record of Design Patterns—In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern</span><a href="#practical-application-record-of-design-patternsin-wkwebview-with-builder-strategy--chain-of-responsibility-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Design Patterns Used When Encapsulating iOS WKWebView (Strategy, Chain of Responsibility, Builder).</p><p><a href="/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*pwh6uN0WQNWPa8zmSSyMXA.webp" alt="Photo by [Dean Pugh](https://unsplash.com/@wezlar11?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@wezlar11?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Dean Pugh</a></p><h3 id="about-design-patterns"><span class="me-2">About Design Patterns</span><a href="#about-design-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Before discussing Design Patterns, it’s important to mention that the classic GoF 23 design patterns were published over 30 years ago (1994). With changes in tools, languages, and software development approaches, the landscape has evolved significantly. Many new design patterns have since emerged in different fields. Design Patterns are neither a cure-all nor the only solution. They serve more as a “language shorthand” to apply the right pattern in the right context, reducing collaboration barriers during development. For example, applying the Strategy Pattern here allows future maintenance and extension to follow the Strategy Pattern structure directly. Most design patterns also provide good decoupling, which greatly benefits extensibility and testability.</p><h4 id="mindset-for-using-design-patterns"><span class="me-2"><strong>Mindset for Using Design Patterns</strong></span><a href="#mindset-for-using-design-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>Not the only solution</p><li><p>Not a cure-all</p><li><p>Do not apply rigidly; choose the appropriate design pattern based on the type of problem to solve (creation? behavior? structure?) and the purpose.</p><li><p>Do not drastically alter the code. Major changes can cause confusion for future maintainers. Just like language, everyone calls Apple “Apple.” If you define it as “Banana,” it becomes an additional development cost that requires special knowledge.</p><li><p>Avoid using keywords whenever possible. For example, the Factory Pattern is commonly named <code class="language-plaintext highlighter-rouge">XXXFactory</code>. If it is not a factory pattern, this naming keyword should not be used.</p><li><p><strong>Be cautious when creating your own patterns</strong>. Although there are only 23 classic ones, many new patterns have emerged through years of evolution across various fields. You can first refer to online resources to find suitable patterns (after all, three heads are better than one). If none fit, then propose new design patterns and try to publish them for review and adjustment by people from different fields and contexts.</p><li><p>Code is ultimately written for people to maintain. As long as it is easy to maintain and extend, using design patterns is not always necessary.</p><li><p>The team must have a consensus on Design Patterns before using them.</p><li><p>Design Patterns can be combined with other Design Patterns for advanced techniques.</p><li><p>Getting started with Design Patterns requires continuous practical experience to develop a sharper sense of which scenarios are suitable or unsuitable for their application.</p></ul><h4 id="helpful-tool-chatgpt"><span class="me-2">Helpful Tool ChatGPT</span><a href="#helpful-tool-chatgpt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f4b02ee342a4/1*gs1hW3YcAkpTgvzzz0lMkQ.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*gs1hW3YcAkpTgvzzz0lMkQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTYxIiBoZWlnaHQ9IjkzMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Since the arrival of ChatGPT, learning practical applications of Design Patterns has become easier. Just describe your problem clearly and ask which design patterns suit the scenario. It can provide several possible patterns along with explanations. Although not every answer is perfect, it at least offers feasible directions. We only need to explore these patterns further in the context of our own practical issues, and we can eventually find a good solution!</p><h3 id="practical-use-cases-of-wkwebview-design-patterns"><span class="me-2">Practical Use Cases of WKWebView Design Patterns</span><a href="#practical-use-cases-of-wkwebview-design-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This practical application of Design Patterns focuses on consolidating the WKWebView object features within the current codebase and applying Design Patterns at several suitable logical abstraction points while developing a unified WKWebView component. This is a record of insights and experiences shared.</p><blockquote><p><em>The complete demo project code will be attached at the end of the article.</em></p></blockquote><h3 id="original-non-abstract-writing-style"><span class="me-2">Original Non-Abstract Writing Style</span><a href="#original-non-abstract-writing-style" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">WKWebViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="c1">// MARK - Define some variables and switches for injecting features during external init...</span>

    <span class="c1">// Simulate business logic: switch to match special paths to open native pages</span>
    <span class="k">let</span> <span class="nv">noNeedNativePresent</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="c1">// Simulate business logic: switch for DeeplinkManager check</span>
    <span class="k">let</span> <span class="nv">deeplinkCheck</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="c1">// Simulate business logic: is it the home page?</span>
    <span class="k">let</span> <span class="nv">isHomePage</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="c1">// Simulate business logic: WKUserScript scripts to inject into WKWebView</span>
    <span class="k">let</span> <span class="nv">userScripts</span><span class="p">:</span> <span class="p">[</span><span class="kt">WKUserScript</span><span class="p">]</span>
    <span class="c1">// Simulate business logic: WKScriptMessageHandler scripts to inject into WKWebView</span>
    <span class="k">let</span> <span class="nv">scriptMessageHandlers</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">WKScriptMessageHandler</span><span class="p">]</span>
    <span class="c1">// Allow overriding ViewController title from WebView title</span>
    <span class="k">let</span> <span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kt">Bool</span>
    
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    
    <span class="c1">// ... </span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="kd">extension</span> <span class="kt">OldWKWebViewController</span><span class="p">:</span> <span class="kt">WKNavigationDelegate</span> <span class="p">{</span>
    <span class="c1">// MARK - iOS WKWebView navigationAction Delegate, used to decide how to handle the upcoming link</span>
    <span class="c1">// Must call decisionHandler(.allow) or decisionHandler(.cancel) at the end</span>
    <span class="c1">// decisionHandler(.cancel) will stop loading the upcoming page</span>

    <span class="c1">// Here simulates different logic based on different variables and switches:</span>

    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">navigationAction</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController deeplinkCheck == true (means need to check with DeepLinkManager and open page)</span>
        <span class="k">if</span> <span class="n">deeplinkCheck</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"DeepLinkManager.open(</span><span class="se">\(</span><span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="c1">// Simulate DeepLinkManager logic, if URL can be opened successfully, open it and end the process.</span>
            <span class="c1">// if DeepLinkManager.open(url) == true {</span>
                <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1">// }</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController isHomePage == true (means it is home page) &amp; WebView is browsing home page, then switch TabBar Index</span>
        <span class="k">if</span> <span class="n">isHomePage</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span> <span class="o">==</span> <span class="s">"https://zhgchg.li"</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Switch UITabBarController to Index 0"</span><span class="p">)</span>
                <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController noNeedNativePresent == false (means need to match special paths to open native pages)</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">noNeedNativePresent</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"product"</span> <span class="p">{</span>
                    <span class="c1">// match http://zhgchg.li/product/1234</span>
                    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Present ProductViewController(</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"shop"</span> <span class="p">{</span>
                    <span class="c1">// match http://zhgchg.li/shop/1234</span>
                    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Present ShopViewController(</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="c1">// more...</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</pre></table></code></div></div><h4 id="question"><span class="me-2">Question</span><a href="#question" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><p>Setting variables and toggles openly within a class makes it unclear which are meant for configuration.</p><li><p>Directly exposing the WKUserScript variable externally is not recommended; we want to control the injected JS and only allow specific behaviors to be injected.</p><li><p>Unable to control WKScriptMessageHandler registration rules.</p><li><p>If you need to initialize similar WebViews, you must repeatedly write the injection parameter rules, and the parameter rules cannot be reused.</p><li><p>Inside the <code class="language-plaintext highlighter-rouge">navigationAction Delegate</code>, the flow is controlled by variables. To delete or change the flow or order, you must modify the entire code, which may break the originally working flow.</p></ol><h3 id="builder-pattern-建造者模式"><span class="me-2">Builder Pattern 建造者模式</span><a href="#builder-pattern-建造者模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/f4b02ee342a4/1*NvnrtRMn05Wo45QeQ221LA.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*NvnrtRMn05Wo45QeQ221LA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzcxIiBoZWlnaHQ9IjExMjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><em>Builder Pattern belongs to the <strong>creational</strong> design patterns. It separates the steps and logic of object creation, allowing the user to set parameters step by step and reuse configurations, ultimately creating the target object. Additionally, the same creation steps can produce different object implementations.</em></p></blockquote><p>The above diagram uses making Pizza as an example. First, the steps to make Pizza are divided into several methods and declared in the <code class="language-plaintext highlighter-rouge">PizzaBuilder</code> Protocol (Interface). The <code class="language-plaintext highlighter-rouge">ConcretePizzaBuilder</code> is the object that actually makes the Pizza, which could be a <code class="language-plaintext highlighter-rouge">Vegetarian PizzaBuilder</code> or a <code class="language-plaintext highlighter-rouge">Meat PizzaBuilder</code>. Different Builders may use different ingredients, but they all ultimately <code class="language-plaintext highlighter-rouge">build()</code> to produce a <code class="language-plaintext highlighter-rouge">Pizza</code> object.</p><h4 id="wkwebview-scenario"><span class="me-2">WKWebView Scenario</span><a href="#wkwebview-scenario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Back to the WKWebView scenario, our final output object is <code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguration</code>. We unify all the variables needed for <code class="language-plaintext highlighter-rouge">WKWebView</code> settings into this object and use the Builder Pattern <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> to gradually complete the construction of the Configuration.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MyWKWebViewConfiguration</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">scriptMessageStrategies</span><span class="p">:</span> <span class="p">[</span><span class="kt">ScriptMessageStrategy</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">userScripts</span><span class="p">:</span> <span class="p">[</span><span class="kt">WKUserScript</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
<span class="p">}</span>
<span class="c1">// All parameters are exposed only within the Module (Internal)</span>
</pre></table></code></div></div><h4 id="mywkwebviewconfigurator-builder-pattern"><span class="me-2">MyWKWebViewConfigurator (Builder Pattern)</span><a href="#mywkwebviewconfigurator-builder-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f4b02ee342a4/1*ZKpTThUiS8ZkV3jbpmWylw.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*ZKpTThUiS8ZkV3jbpmWylw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzcxIiBoZWlnaHQ9IjExMjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><em>Here, since I only need to build for MyWKWebView, I did not further split <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> into a Protocol (Interface).</em></p></blockquote><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">MyWKWebViewConfigurator</span> <span class="p">{</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">disableZoom</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">scriptMessageStrategies</span><span class="p">:</span> <span class="p">[</span><span class="kt">ScriptMessageStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
    <span class="c1">// Parameter encapsulation and internal control</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="nv">disableZoom</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">disableZoom</span> <span class="o">=</span> <span class="n">disableZoom</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">overrideTitleFromWebView</span> <span class="o">=</span> <span class="n">overrideTitleFromWebView</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">headNavigationHandler</span> <span class="o">=</span> <span class="n">headNavigationHandler</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="c1">// You can encapsulate additional logic rules here</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nv">scriptMessageStrategy</span><span class="p">:</span> <span class="kt">ScriptMessageStrategy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">scriptMessageStrategies</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span><span class="o">.</span><span class="n">identifier</span> <span class="o">==</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scriptMessageStrategy</span><span class="p">)</span><span class="o">.</span><span class="n">identifier</span> <span class="p">})</span>
        <span class="n">scriptMessageStrategies</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">scriptMessageStrategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">build</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MyWKWebViewConfiguration</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">userScripts</span><span class="p">:[</span><span class="kt">WKUserScript</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">// Attach only when generating</span>
        <span class="k">if</span> <span class="n">disableZoom</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">script</span> <span class="o">=</span> <span class="s">"var meta = document.createElement('meta'); meta.name='viewport'; meta.content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'; document.getElementsByTagName('head')[0].appendChild(meta);"</span>
            <span class="k">let</span> <span class="nv">disableZoomScript</span> <span class="o">=</span> <span class="kt">WKUserScript</span><span class="p">(</span><span class="nv">source</span><span class="p">:</span> <span class="n">script</span><span class="p">,</span> <span class="nv">injectionTime</span><span class="p">:</span> <span class="o">.</span><span class="n">atDocumentEnd</span><span class="p">,</span> <span class="nv">forMainFrameOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
            <span class="n">userScripts</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">disableZoomScript</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="kt">MyWKWebViewConfiguration</span><span class="p">(</span><span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="n">headNavigationHandler</span><span class="p">,</span> <span class="nv">scriptMessageStrategies</span><span class="p">:</span> <span class="n">scriptMessageStrategies</span><span class="p">,</span> <span class="nv">userScripts</span><span class="p">:</span> <span class="n">userScripts</span><span class="p">,</span> <span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="n">overrideTitleFromWebView</span><span class="p">,</span> <span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/f4b02ee342a4/1*nD3Dc6Gxksr6vS6t2TXH-A.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*nD3Dc6Gxksr6vS6t2TXH-A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjYzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Adding an extra layer of separation can better utilize Access Control to restrict parameter usage. In this scenario, we want to allow direct injection of <code class="language-plaintext highlighter-rouge">WKUserScript</code> into <code class="language-plaintext highlighter-rouge">MyWKWebView</code>, but we don’t want to open it up so much that users can inject scripts arbitrarily. By combining the Builder Pattern with Swift Access Control, once <code class="language-plaintext highlighter-rouge">MyWKWebView</code> is placed inside a module, <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> exposes an operation method <code class="language-plaintext highlighter-rouge">func set(disableZoom: Bool)</code> externally. Internally, when creating <code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguration</code>, it attaches the <code class="language-plaintext highlighter-rouge">WKUserScript</code>. All parameters of <code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguration</code> are immutable from outside and can only be generated through <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code>.</p><h4 id="mywkwebviewconfigurator--simple-factory"><span class="me-2">MyWKWebViewConfigurator + Simple Factory</span><a href="#mywkwebviewconfigurator--simple-factory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After having the <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> Builder, we can create a simple factory to encapsulate and reuse the setup process.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">MyWKWebViewConfiguratorFactory</span> <span class="p">{</span>
    <span class="k">enum</span> <span class="n">ForType</span> <span class="p">{</span>
        <span class="k">case</span> <span class="err">`</span><span class="k">default</span><span class="err">`</span>
        <span class="k">case</span> <span class="n">productPage</span>
        <span class="k">case</span> <span class="n">payment</span>
    <span class="p">}</span>
    
    <span class="k">static</span> <span class="n">func</span> <span class="nf">make</span><span class="p">(</span><span class="k">for</span> <span class="n">type</span><span class="p">:</span> <span class="n">ForType</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MyWKWebViewConfigurator</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">.</span><span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">MyWKWebViewConfigurator</span><span class="p">()</span>
                <span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">scriptMessageStrategy</span><span class="p">:</span> <span class="nf">PageScriptMessageStrategy</span><span class="p">())</span>
                <span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">overrideTitleFromWebView</span><span class="p">:</span> <span class="k">false</span><span class="p">)</span>
                <span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">disableZoom</span><span class="p">:</span> <span class="k">false</span><span class="p">)</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">productPage</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Self</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="k">default</span><span class="p">).</span><span class="k">set</span><span class="p">(</span><span class="n">disableZoom</span><span class="p">:</span> <span class="k">true</span><span class="p">).</span><span class="k">set</span><span class="p">(</span><span class="n">overrideTitleFromWebView</span><span class="p">:</span> <span class="k">true</span><span class="p">)</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">payment</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">MyWKWebViewConfigurator</span><span class="p">().</span><span class="k">set</span><span class="p">(</span><span class="n">headNavigationHandler</span><span class="p">:</span> <span class="n">paymentNavigationActionHandler</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="chain-of-responsibility-pattern-責任鏈模式"><span class="me-2">Chain of Responsibility Pattern 責任鏈模式</span><a href="#chain-of-responsibility-pattern-責任鏈模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/f4b02ee342a4/1*C0nmAQ9UzwMQ0vnAr8p2Ag.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*C0nmAQ9UzwMQ0vnAr8p2Ag.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzI3IiBoZWlnaHQ9IjExMzUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><em>The Chain of Responsibility Pattern belongs to <strong>behavioral</strong> design patterns. It encapsulates object handling operations and links them in a chain structure. Requests are passed along the chain until one handles them. The linked operation encapsulations can be freely combined and reordered.</em></p></blockquote><blockquote><p><strong><em>The Chain of Responsibility focuses on whether you need to handle the incoming item; if not, just Skip</em></strong> <em>, so it cannot process partially or modify the input object before passing it to the next. If that is the requirement, then it is another <a href="https://stackoverflow.com/questions/7951306/chain-of-responsibility-vs-interceptor" target="_blank"><strong>Interceptor Pattern</strong></a>.</em></p></blockquote><p>The above diagram uses Tech Support (or OnCall…) as an example. When an issue arrives, it first goes through <code class="language-plaintext highlighter-rouge">CustomerService</code>. If they can’t handle it, it is passed down to the next level, <code class="language-plaintext highlighter-rouge">Supervisor</code>. If still unresolved, it continues down to <code class="language-plaintext highlighter-rouge">TechSupport</code>. Additionally, different chains of responsibility can be formed for different issues. For example, problems from major clients may be handled directly starting from <code class="language-plaintext highlighter-rouge">Supervisor</code>. The <a href="https://www.appcoda.com.tw/responder-chain/" target="_blank">Responder Chain in Swift UIKit</a> also uses the Chain of Responsibility pattern to respond to user actions on the UI.</p><h4 id="wkwebview-scenario-1"><span class="me-2">WKWebView Scenario</span><a href="#wkwebview-scenario-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In our WKWebView scenario, it is mainly applied in the <code class="language-plaintext highlighter-rouge">func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void)</code> delegate method.</p><blockquote><p><em>When the system receives a URL request, it passes through this method for us to decide whether to allow navigation, and calls <code class="language-plaintext highlighter-rouge">decisionHandler(.allow)</code> or <code class="language-plaintext highlighter-rouge">decisionHandler(.cancel)</code> at the end to indicate the result.</em></p></blockquote><p><strong>In the implementation of WKWebView, many conditions arise, or some pages need to be handled differently and bypassed:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="c1">// Original implementation...</span>
<span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">navigationAction</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController deeplinkCheck == true (means need to check and open page via DeepLinkManager)</span>
        <span class="k">if</span> <span class="n">deeplinkCheck</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"DeepLinkManager.open(</span><span class="se">\(</span><span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="c1">// Simulate DeepLinkManager logic, if URL can be opened successfully, open it and end the process.</span>
            <span class="c1">// if DeepLinkManager.open(url) == true {</span>
                <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1">// }</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController isHomePage == true (means opening home page) &amp; WebView is browsing home page, then switch TabBar Index</span>
        <span class="k">if</span> <span class="n">isHomePage</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span> <span class="o">==</span> <span class="s">"https://zhgchg.li"</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Switch UITabBarController to Index 0"</span><span class="p">)</span>
                <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: WebViewController noNeedNativePresent == false (means need to match special paths to open native pages)</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">noNeedNativePresent</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"product"</span> <span class="p">{</span>
                    <span class="c1">// match http://zhgchg.li/product/1234</span>
                    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Present ProductViewController(</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"shop"</span> <span class="p">{</span>
                    <span class="c1">// match http://zhgchg.li/shop/1234</span>
                    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Present ShopViewController(</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="c1">// more...</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// more...</span>
        <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As time goes by, features become more complex, and the logic here increases. If the processing order also needs to change, it will turn into a disaster.</p><h4 id="navigationactionhandler-chain-of-responsibility-pattern"><span class="me-2">NavigationActionHandler (Chain of Responsibility Pattern)</span><a href="#navigationactionhandler-chain-of-responsibility-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/f4b02ee342a4/1*29n1VSQhXFc4qUZ50IULIw.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*29n1VSQhXFc4qUZ50IULIw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjU3MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>First, define the Handler Protocol:</strong></p><pre><code class="language-less">public protocol NavigationActionHandler: AnyObject {
    var nextHandler: NavigationActionHandler? { get set }

    /// Handles navigation actions for the web view. Returns true if the action was handled, otherwise false.
    func handle(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) -&gt; Bool
    /// Executes the navigation action policy decision. If the current handler does not handle it, the next handler in the chain will be executed.
    func exeute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void)
}

public extension NavigationActionHandler {
    func exeute(webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) {
        if !handle(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) {
            self.nextHandler?.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler) ?? decisionHandler(.allow)
        }
    }
}
</code></pre><ul><li><p>The operation will be implemented in <code class="language-plaintext highlighter-rouge">func handle()</code>. Return <code class="language-plaintext highlighter-rouge">true</code> if there are further processes, otherwise return <code class="language-plaintext highlighter-rouge">false</code>.</p><li><p><code class="language-plaintext highlighter-rouge">func execute()</code> is the default chain access implementation. It traverses the entire operation chain from here. The default behavior is that when <code class="language-plaintext highlighter-rouge">func handle()</code> returns <code class="language-plaintext highlighter-rouge">false</code> (meaning this node cannot handle it), it automatically calls the next <code class="language-plaintext highlighter-rouge">nextHandler</code>’s <code class="language-plaintext highlighter-rouge">execute()</code> to continue processing until the end.</p></ul><p><strong>Implementation:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="c1">// Default implementation, usually placed at the end</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">DefaultNavigationActionHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">?</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">PaymentNavigationActionHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">navigationAction</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate business logic: Payment related, two-factor verification WebView...etc</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Present Payment Verify View Controller"</span><span class="p">)</span>
        <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">DeeplinkManagerNavigationActionHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">NavigationActionHandler</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">navigationAction</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        
        
        <span class="c1">// Simulate DeepLinkManager logic, if URL can be opened successfully, open it and end the process.</span>
        <span class="c1">// if DeepLinkManager.open(url) == true {</span>
            <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="c1">// } else {</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// More...</span>
</pre></table></code></div></div><p>Usage:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">MyWKWebViewController</span><span class="p">:</span> <span class="kt">WKNavigationDelegate</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">let</span> <span class="nv">headNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DeeplinkManagerNavigationActionHandler</span><span class="p">()</span>
       <span class="k">let</span> <span class="nv">defaultNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DefaultNavigationActionHandler</span><span class="p">()</span>
       <span class="k">let</span> <span class="nv">paymentNavigationActionHandler</span> <span class="o">=</span> <span class="kt">PaymentNavigationActionHandler</span><span class="p">()</span>
       
       <span class="n">headNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">paymentNavigationActionHandler</span>
       <span class="n">paymentNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">defaultNavigationActionHandler</span>
       
       <span class="n">headNavigationActionHandler</span><span class="o">.</span><span class="nf">exeute</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="n">webView</span><span class="p">,</span> <span class="nv">decidePolicyFor</span><span class="p">:</span> <span class="n">navigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="n">decisionHandler</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This way, when a request is received, it will be processed sequentially according to the handler chain we defined.</p><p><strong>Combine with the previous Builder Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> <strong>by making <code class="language-plaintext highlighter-rouge">headNavigationActionHandler</code> a parameter, allowing external control over the WKWebView’s handling requirements and order:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">MyWKWebViewController</span><span class="p">:</span> <span class="kt">WKNavigationDelegate</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">decidePolicyFor</span> <span class="nv">navigationAction</span><span class="p">:</span> <span class="kt">WKNavigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">WKNavigationActionPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">headNavigationHandler</span><span class="p">?</span><span class="o">.</span><span class="nf">exeute</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="n">webView</span><span class="p">,</span> <span class="nv">decidePolicyFor</span><span class="p">:</span> <span class="n">navigationAction</span><span class="p">,</span> <span class="nv">decisionHandler</span><span class="p">:</span> <span class="n">decisionHandler</span><span class="p">)</span> <span class="p">??</span> <span class="nf">decisionHandler</span><span class="p">(</span><span class="o">.</span><span class="n">allow</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//...</span>
<span class="kd">struct</span> <span class="kt">MyWKWebViewConfiguratorFactory</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">ForType</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">`</span><span class="nv">default</span><span class="p">`</span>
        <span class="k">case</span> <span class="n">productPage</span>
        <span class="k">case</span> <span class="n">payment</span>
    <span class="p">}</span>
    
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">make</span><span class="p">(</span><span class="k">for</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">ForType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MyWKWebViewConfigurator</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="k">default</span><span class="p">:</span>
            <span class="c1">// Simulate default case with these handlers</span>
            <span class="k">let</span> <span class="nv">deplinkManagerNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DeeplinkManagerNavigationActionHandler</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">homePageTabSwitchNavigationActionHandler</span> <span class="o">=</span> <span class="kt">HomePageTabSwitchNavigationActionHandler</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">nativeViewControllerNavigationActionHandlera</span> <span class="o">=</span> <span class="kt">NativeViewControllerNavigationActionHandler</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">defaultNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DefaultNavigationActionHandler</span><span class="p">()</span>
            
            <span class="n">deplinkManagerNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">homePageTabSwitchNavigationActionHandler</span>
            <span class="n">homePageTabSwitchNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">nativeViewControllerNavigationActionHandlera</span>
            <span class="n">nativeViewControllerNavigationActionHandlera</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">defaultNavigationActionHandler</span>
            
            <span class="k">return</span> <span class="kt">MyWKWebViewConfigurator</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">scriptMessageStrategy</span><span class="p">:</span> <span class="kt">PageScriptMessageStrategy</span><span class="p">())</span>
                <span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">scriptMessageStrategy</span><span class="p">:</span> <span class="kt">UserScriptMessageStrategy</span><span class="p">())</span>
                <span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="n">deplinkManagerNavigationActionHandler</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">disableZoom</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">productPage</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">Self</span><span class="o">.</span><span class="nf">make</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">disableZoom</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">overrideTitleFromWebView</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">payment</span><span class="p">:</span>
            <span class="c1">// Simulate payment page only needs these handlers, with paymentNavigationActionHandler having highest priority</span>
            <span class="k">let</span> <span class="nv">paymentNavigationActionHandler</span> <span class="o">=</span> <span class="kt">PaymentNavigationActionHandler</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">deplinkManagerNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DeeplinkManagerNavigationActionHandler</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">defaultNavigationActionHandler</span> <span class="o">=</span> <span class="kt">DefaultNavigationActionHandler</span><span class="p">()</span>
            
            <span class="n">paymentNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">deplinkManagerNavigationActionHandler</span>
            <span class="n">deplinkManagerNavigationActionHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">defaultNavigationActionHandler</span>
            
            <span class="k">return</span> <span class="kt">MyWKWebViewConfigurator</span><span class="p">()</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">headNavigationHandler</span><span class="p">:</span> <span class="n">paymentNavigationActionHandler</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="strategy-pattern-策略模式"><span class="me-2">Strategy Pattern 策略模式</span><a href="#strategy-pattern-策略模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/f4b02ee342a4/1*RiMbrBGdFG6INBRCcE_WZw.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*RiMbrBGdFG6INBRCcE_WZw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQ5MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><em>The Strategy Pattern is part of <strong>behavioral</strong> design patterns. It abstracts the actual operations, enabling the implementation of multiple operations that can be flexibly swapped according to different scenarios.</em></p></blockquote><p>The above diagram uses different payment methods as examples. We abstract payment as a <code class="language-plaintext highlighter-rouge">Payment</code> Protocol (Interface), then each payment method implements its own version. In <code class="language-plaintext highlighter-rouge">PaymentContext</code> (simulating external use), the corresponding Payment instance is created based on the user’s chosen payment method, and <code class="language-plaintext highlighter-rouge">pay()</code> is called uniformly to process the payment.</p><h4 id="wkwebview-scenario-2"><span class="me-2">WKWebView Scenario</span><a href="#wkwebview-scenario-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><em>Used in interaction between WebView and frontend pages.</em></p></blockquote><blockquote><p><em>When the frontend JavaScript calls:</em></p></blockquote><blockquote><p><em><code class="language-plaintext highlighter-rouge">window.webkit.messageHandlers.Name.postMessage(Parameters);</code></em></p></blockquote><blockquote><p><em>It will enter WKWebView to find the corresponding <code class="language-plaintext highlighter-rouge">WKScriptMessageHandler</code> class with the given <code class="language-plaintext highlighter-rouge">Name</code> and execute the operation.</em></p></blockquote><p>The system already defines the Protocol and the corresponding <code class="language-plaintext highlighter-rouge">func add(_ scriptMessageHandler: any WKScriptMessageHandler, name: String)</code> method. We only need to implement our own <code class="language-plaintext highlighter-rouge">WKScriptMessageHandler</code> and add it to the WKWebView. The system will then dispatch to the appropriate concrete strategy based on the received <code class="language-plaintext highlighter-rouge">name</code>, following the Strategy Pattern.</p><p>Here is a simple Protocol extension of <code class="language-plaintext highlighter-rouge">WKScriptMessageHandler</code> with an additional <code class="language-plaintext highlighter-rouge">identifier:String</code> for <code class="language-plaintext highlighter-rouge">add(.. name:)</code> usage:</p><p><a href="/assets/f4b02ee342a4/1*RLA13rSVDIG9cV3CsWtS3g.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*RLA13rSVDIG9cV3CsWtS3g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjM1MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">ScriptMessageStrategy</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">WKScriptMessageHandler</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Implementation:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">final</span> <span class="kd">class</span> <span class="kt">PageScriptMessageStrategy</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">ScriptMessageStrategy</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"page"</span>
    
    <span class="kd">func</span> <span class="nf">userContentController</span><span class="p">(</span><span class="n">_</span> <span class="nv">userContentController</span><span class="p">:</span> <span class="kt">WKUserContentController</span><span class="p">,</span> <span class="n">didReceive</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">WKScriptMessage</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Simulate called from js: window.webkit.messageHandlers.page.postMessage("Close");</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="k">Self</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">UserScriptMessageStrategy</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">ScriptMessageStrategy</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"user"</span>
    
    <span class="kd">func</span> <span class="nf">userContentController</span><span class="p">(</span><span class="n">_</span> <span class="nv">userContentController</span><span class="p">:</span> <span class="kt">WKUserContentController</span><span class="p">,</span> <span class="n">didReceive</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">WKScriptMessage</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Simulate called from js: window.webkit.messageHandlers.user.postMessage("Hello");</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="k">Self</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>WKWebView Registration Usage:</strong></p><div class="language-css highlighter-rouge"><div class="code-header"> <span data-label-text="CSS"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">var</span> <span class="nt">scriptMessageStrategies</span><span class="o">:</span> <span class="o">[</span><span class="nt">ScriptMessageStrategy</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span>
<span class="nt">scriptMessageStrategies</span><span class="nc">.forEach</span> <span class="p">{</span> <span class="err">scriptMessageStrategy</span> <span class="err">in</span>
  <span class="err">webView.configuration.userContentController.add(scriptMessageStrategy,</span> <span class="py">name</span><span class="p">:</span> <span class="n">type</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="n">scriptMessageStrategy</span><span class="p">).</span><span class="n">identifier</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Combining with the previous Builder Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> manages the registration of <code class="language-plaintext highlighter-rouge">ScriptMessageStrategy</code> from outside:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">MyWKWebViewConfigurator</span> <span class="p">{</span>
    <span class="c1">//...</span>
    
    <span class="c1">// You can encapsulate additional logic rules here</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nv">scriptMessageStrategy</span><span class="p">:</span> <span class="kt">ScriptMessageStrategy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="c1">// Here, the logic is to remove the old one first if there is a duplicate identifier</span>
        <span class="n">scriptMessageStrategies</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span><span class="o">.</span><span class="n">identifier</span> <span class="o">==</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scriptMessageStrategy</span><span class="p">)</span><span class="o">.</span><span class="n">identifier</span> <span class="p">})</span>
        <span class="n">scriptMessageStrategies</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">scriptMessageStrategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="c1">//...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">MyWKWebViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="kd">public</span> <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
       
        <span class="c1">//...</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">scriptMessageStrategies</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">scriptMessageStrategy</span> <span class="k">in</span>
            <span class="n">webView</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">userContentController</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">scriptMessageStrategy</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scriptMessageStrategy</span><span class="p">)</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">//...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="question-can-this-scenario-also-be-implemented-using-the-chain-of-responsibility-pattern"><span class="me-2">Question: Can this scenario also be implemented using the Chain of Responsibility Pattern?</span><a href="#question-can-this-scenario-also-be-implemented-using-the-chain-of-responsibility-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>At this point, some may ask if the Strategy Pattern here can be replaced by the Chain of Responsibility Pattern?</p><blockquote><p><em>These two design patterns are both behavioral and can be interchangeable; however, the choice depends on the specific scenario. Here, it is a typical Strategy Pattern where WKWebView selects different strategies based on the Name. If the requirement involves chained dependencies or recovery relationships between strategies—for example, if AStrategy does not handle it and passes it to BStrategy—then the Chain of Responsibility Pattern should be considered.</em></p></blockquote><p><a href="/assets/f4b02ee342a4/1*UWT-2lfzUyS7CARahfEN-A.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*UWT-2lfzUyS7CARahfEN-A.webp" alt="Strategy v.s. Chain of Responsibility" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc4NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Strategy vs. Chain of Responsibility</p><ul><li><p>Strategy Pattern: There is a clear dispatch execution strategy, and the strategies are independent of each other.</p><li><p>Chain of Responsibility Pattern: The execution strategy is determined within each implementation. If it cannot handle the request, it passes it to the next implementation.</p></ul><p>Complex scenarios can be achieved by applying the Chain of Responsibility Pattern within the Strategy Pattern.</p><h3 id="final-combination"><span class="me-2">Final Combination</span><a href="#final-combination" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/f4b02ee342a4/1*VgMVoIWfkuCPLn584Qv-xg.webp" class="popup img-link blur"><img data-src="/assets/f4b02ee342a4/1*VgMVoIWfkuCPLn584Qv-xg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><p><strong>Simple Factory Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguratorFactory</code> -&gt; Encapsulates the creation process of <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code></p><li><p><strong>Builder Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewConfigurator</code> -&gt; Encapsulates <code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguration</code> parameters and build steps</p><li><p><code class="language-plaintext highlighter-rouge">MyWKWebViewConfiguration</code> Injection -&gt; Used by <code class="language-plaintext highlighter-rouge">MyWKWebViewController</code></p><li><p><strong>Chain of Responsibility Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewController</code>’s <code class="language-plaintext highlighter-rouge">func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void)</code> -&gt; calls <code class="language-plaintext highlighter-rouge">headNavigationHandler?.exeute(webView: webView, decidePolicyFor: navigationAction, decisionHandler: decisionHandler)</code> to execute the chain processing</p><li><p><strong>Strategy Pattern</strong> <code class="language-plaintext highlighter-rouge">MyWKWebViewController</code> uses <code class="language-plaintext highlighter-rouge">webView.configuration.userContentController.addUserScript(XXX)</code> to dispatch corresponding JS Callers to the appropriate handling strategies</p></ul><h4 id="complete-demo-repo"><span class="me-2">Complete Demo Repo</span><a href="#complete-demo-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/zhgchgli0718/DesignPatternsInWKWebViewDemo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/dc74860bc0c53748213df85fb768a4317fe357347a630b6a75bdaf5b2e36acb1/zhgchgli0718/DesignPatternsInWKWebViewDemo" alt="" loading="lazy"></a></p><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p><a href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/">Practical Application of Design Patterns</a></p><li><p><a href="/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-design-pattern-practical-applications-ba5773a7bfea/">Visitor Pattern in Swift (Share Object to XXX Example)</a></p><li><p><a href="/posts/zrealm-dev/en/visitor-pattern-enhance-tableview-readability-and-extensibility-60473cb47550/">Visitor Pattern in TableView</a></p></ul><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/f4b02ee342a4" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2024-09-06-f4b02ee342a4.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/kkday-tech-blog/">KKday Tech Blog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/design-patterns/" class="post-tag no-text-decoration" >design-patterns</a> <a href="/tags/chain-of-responsibility/" class="post-tag no-text-decoration" >chain-of-responsibility</a> <a href="/tags/builder-pattern/" class="post-tag no-text-decoration" >builder-pattern</a> <a href="/tags/strategy-pattern/" class="post-tag no-text-decoration" >strategy-pattern</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Design%20Patterns%20in%20WKWebView:%20Builder,%20Strategy%20&%20Chain%20of%20Responsibility%20Explained%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fen%2Fdesign-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Design%20Patterns%20in%20WKWebView:%20Builder,%20Strategy%20&%20Chain%20of%20Responsibility%20Explained%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fen%2Fdesign-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fen%2Fdesign-patterns-in-wkwebview-builder-strategy-chain-of-responsibility-explained-f4b02ee342a4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E7%82%B9-%E7%BE%8E%E9%A3%9F%E4%B8%8E%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AF%81%E7%9C%81%E9%92%B1%E7%A7%98%E8%AF%80-8ace34a1a3d8/">游记 2025 韩国釜山 8 天 7 夜自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/kkday-tech-blog/wkwebview-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E6%88%B0-builder-strategy-%E8%88%87%E8%B2%AC%E4%BB%BB%E9%8F%88%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E6%87%89%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1725601667" data-df="ll" > Sep 6, 2024 </time><h4 class="pt-0 my-2">Design Patterns 的實戰應用紀錄—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern</h4><div class="text-muted"><p>封裝 iOS WKWebView 時使用到的 Design Patterns 場景 (策略、責任鏈、建造模式)。</p></div></div></a></article><article class="col"> <a href="/posts/kkday-tech-blog/zh-cn/wkwebview-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98-builder-strategy-%E4%B8%8E%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1725601667" data-df="ll" > Sep 6, 2024 </time><h4 class="pt-0 my-2">Design Patterns 的实战应用纪录—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern</h4><div class="text-muted"><p>封装 iOS WKWebView 时使用到的 Design Patterns 场景 (策略、责任链、建造模式)。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/visitor-pattern-enhance-tableview-readability-and-extensibility-60473cb47550/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1657267110" data-df="ll" > Jul 8, 2022 </time><h4 class="pt-0 my-2">Visitor Pattern｜Enhance TableView Readability and Extensibility</h4><div class="text-muted"><p>Improve TableView management with Visitor Pattern to simplify code maintenance and enable flexible feature expansion, boosting development efficiency and scalability.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E6%9B%BC%E8%B0%B7%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-5-%E6%97%A5%E8%A1%8C%E7%A8%8B%E8%A6%8F%E5%8A%83-%E5%BF%85%E8%A8%AA%E6%99%AF%E9%BB%9E%E8%88%87%E5%AF%A6%E7%94%A8%E6%97%85%E9%81%8A%E5%AE%89%E5%85%A8%E6%8F%90%E9%86%92-b7e7c0938985/" class="btn btn-outline-primary" aria-label="Older" ><p>曼谷自由行攻略｜5 日行程規劃、必訪景點與實用旅遊安全提醒</p></a> <a href="/posts/kkday-tech-blog/zh-cn/wkwebview-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98-builder-strategy-%E4%B8%8E%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/" class="btn btn-outline-primary" aria-label="Newer" ><p>Design Patterns 的实战应用纪录—In WKWebView with Builder, Strategy & Chain of Responsibility Pattern</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
