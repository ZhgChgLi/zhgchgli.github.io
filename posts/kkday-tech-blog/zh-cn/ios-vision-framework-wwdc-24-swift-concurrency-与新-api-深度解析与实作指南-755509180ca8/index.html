<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS 开发者面对 Vision framework 复杂图像辨识需求，透过 WWDC 24 Swift Concurrency 新 API，掌握 31 种图像辨识请求与身体手势追踪，提升辨识效率与安全性，实现高效图像分析与即时应用。" /><meta property="og:description" content="iOS 开发者面对 Vision framework 复杂图像辨识需求，透过 WWDC 24 Swift Concurrency 新 API，掌握 31 种图像辨识请求与身体手势追踪，提升辨识效率与安全性，实现高效图像分析与即时应用。" /><link rel="canonical" href="https://zhgchg.li/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" /><meta property="og:url" content="https://zhgchg.li/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-13T16:10:37+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" /><meta property="twitter:title" content="iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-08-14T20:07:49+08:00","datePublished":"2024-08-13T16:10:37+08:00","description":"iOS 开发者面对 Vision framework 复杂图像辨识需求，透过 WWDC 24 Swift Concurrency 新 API，掌握 31 种图像辨识请求与身体手势追踪，提升辨识效率与安全性，实现高效图像分析与即时应用。","headline":"iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"},"url":"https://zhgchg.li/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"}</script><title>iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/"><link rel="alternate" hreflang="zh-Hant" href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><link rel="alternate" hreflang="zh-Hans" href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><link rel="alternate" hreflang="x-default" href="/posts/kkday-tech-blog/zh-cn/ios-vision-framework-wwdc-24-swift-concurrency-%E4%B8%8E%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</h1><p class="post-desc fw-light mb-4">iOS 开发者面对 Vision framework 复杂图像辨识需求，透过 WWDC 24 Swift Concurrency 新 API，掌握 31 种图像辨识请求与身体手势追踪，提升辨识效率与安全性，实现高效图像分析与即时应用。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1723536637" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 13, 2024 </time> </span> <span> Updated <time data-ts="1723637269" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 14, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="6210 words" > <em>34 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS Vision framework｜WWDC 24 Swift Concurrency 与新 API 深度解析与实作指南</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><hr /><h3 id="ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session"><span class="me-2">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</span><a href="#ios-vision-framework-x-wwdc-24-discover-swift-enhancements-in-the-vision-framework-session" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision framework 功能回顾 &amp; iOS 18 新 Swift API 试玩</p><p><a href="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*NqN-_MAE4tt11n6MnUQWxQ.webp" alt="Photo by [BoliviaInteligente](https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijg3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@boliviainteligente?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">BoliviaInteligente</a></p><h4 id="主题"><span class="me-2">主题</span><a href="#主题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*ebqm2jzCK1GSrDDY0XtrUA.webp" alt="跟 Vision Pro 的关系就跟热狗跟狗的关系一样，毫无关系。" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNTYwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>跟 Vision Pro 的关系就跟热狗跟狗的关系一样，毫无关系。</p><h3 id="vision-framework"><span class="me-2">Vision framework</span><a href="#vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision framework 是 Apple 整合机器学习的图像辨识框架，让开发者可以简单快速地实现常见的图像辨识功能；Vision framework 早在 iOS 11.0+ (2017/ iPhone 8) 就已推出，期间不断地迭代优化，并完善与 Swift Concurrency 的特性整合提升执行效能，并且从 iOS 18.0 提供全新的 Swift Vision framework API 发挥 Swift Concurrency 最大效果。</p><p><strong>Vision framework 特色</strong></p><ul><li><p>内建众多图片辨识、动态追踪方法 (iOS 18 为止一共 31 种)</p><li><p>On-Device 单纯使用手机晶片运算，辨识过程不依赖云端服务，快速又安全</p><li><p>API 简单好操作</p><li><p>Apple 全平台均支援 iOS 11.0+, iPadOS 11.0+, Mac Catalyst 13.0+, macOS 10.13+, tvOS 11.0+, visionOS 1.0+</p><li><p>已发布多年 (2017~今) 且不断更新</p><li><p>整合 Swift 语言特性提升运算效能</p></ul><blockquote><p><strong><em>6 年前曾经小玩过： <a href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/">Vision 初探 — APP 头像上传 自动识别人脸裁图 (Swift)</a></em></strong></p></blockquote><blockquote><p><em>这次搭配 <a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">WWDC 24 Discover Swift enhancements in the Vision framework Session</a> 重新回顾并结合新的 Swfit 特性再玩一次。</em></p></blockquote><h4 id="coreml"><span class="me-2">CoreML</span><a href="#coreml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Apple 还有另外一个 Framework 叫 <a href="https://developer.apple.com/documentation/coreml" target="_blank">CoreML</a> ，也是基于 On-Device 晶片的机器学习框架；但他可以让你自己训练想辨识的物件、文件模型，并将模型放到 App 中直接使用，有兴趣的朋友也可以玩看看。(e.g. <a href="/posts/zrealm-dev/zh-cn/ios-12-coreml-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%96%87%E5%AD%97%E5%88%86%E7%B1%BB-%E8%87%AA%E8%AE%A2%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%AE%9E%E6%88%98%E6%95%99%E5%AD%A6-793bf2cdda0f/">即时文章分类</a> 、即时 <a href="https://apps.apple.com/tw/app/%E7%86%8A%E7%8C%AB%E5%90%83%E7%9F%AD%E4%BF%A1-%E5%9E%83%E5%9C%BE%E7%9F%AD%E4%BF%A1%E8%BF%87%E6%BB%A4/id1319191852" target="_blank">垃圾讯息检测</a> …)</p><h4 id="ps"><span class="me-2">p.s.</span><a href="#ps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://developer.apple.com/documentation/vision/" target="_blank"><strong>Vision</strong></a> <strong>v.s. <a href="https://developer.apple.com/documentation/visionkit" target="_blank">VisionKit</a> ：</strong></p><blockquote><p><a href="https://developer.apple.com/documentation/vision/" target="*blank"><strong><em>Vision</em></strong></a> _：主要用于图像分析任务，如脸部识别、条码检测、文本识别等。它提供了强大的 API 来处理和分析静态图像或视频中的视觉内容。*</p></blockquote><blockquote><p><a href="https://developer.apple.com/documentation/visionkit" target="*blank"><strong><em>VisionKit</em></strong></a> _：专门用于处理与文件扫描相关的任务。它提供了一个扫描仪视图控制器，可以用来扫描文档，并生成高质量的 PDF 或图像。*</p></blockquote><p>Vision framework 在 M1 机型上无法跑在模拟器，只能接实体手机测试；在模拟器环境执行会抛出 <code class="language-plaintext highlighter-rouge">Could not create Espresso context</code> Error，查 <a href="https://forums.developer.apple.com/forums/thread/675806" target="_blank">官方论坛讨论，没找到解答</a> 。</p><blockquote><p><em>因手边没有实体 iOS 18 装置进行测试，所以本文中的所有执行结果都是使用旧的 (iOS 18 以前) 的写法结果； <strong>如新写法有出现错误再麻烦留言指教</strong> 。</em></p></blockquote><h3 id="wwdc-2024--discover-swift-enhancements-in-the-vision-framework"><span class="me-2">WWDC 2024 — Discover Swift enhancements in the Vision framework</span><a href="#wwdc-2024--discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8N5GtY1uqxP-4iAAAticOA.webp" alt="[Discover Swift enhancements in the Vision framework](https://developer.apple.com/videos/play/wwdc2024/10163/?time=45){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTEiIGhlaWdodD0iNDUyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45" target="_blank">Discover Swift enhancements in the Vision framework</a></p><blockquote><p><em>本文是针对 WWDC 24 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=45" target="_blank">Discover Swift enhancements in the Vision framework</a> Session 的分享笔记，跟一些自己实验的心得。</em></p></blockquote><h3 id="introduction--vision-framework-features"><span class="me-2">Introduction — Vision framework Features</span><a href="#introduction--vision-framework-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="人脸辨识轮廓识别"><span class="me-2">人脸辨识、轮廓识别</span><a href="#人脸辨识轮廓识别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*RNGfE_EeaQhiKAPdJeFYQw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjYiIGhlaWdodD0iNDgyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*iMdzeLm2aWjATVV6_Kvrjg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDciIGhlaWdodD0iNDQ4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="图像内容文字辨识"><span class="me-2">图像内容文字辨识</span><a href="#图像内容文字辨识" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>截至 iOS 18 为止，支援 18 种语言。</p><p><a href="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*kU_OYn5w368h-ahDYU4lDw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTciIGhlaWdodD0iMzk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// 支援的语系列表</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="kt">RecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="n">supportedRecognitionLanguages</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">languageCode</span><span class="o">!</span><span class="se">)</span><span class="s">-</span><span class="se">\(</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">region</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span> <span class="p">??</span> <span class="nv">$0</span><span class="o">.</span><span class="n">script</span><span class="p">?</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span><span class="o">!</span><span class="se">)</span><span class="s">"</span> <span class="p">})</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="k">try!</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">()</span><span class="o">.</span><span class="nf">supportedRecognitionLanguages</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 实际可用辨识语言以这为主。</span>
<span class="c1">// 实测 iOS 18 输出以下结果：</span>
<span class="c1">// ["en-US", "fr-FR", "it-IT", "de-DE", "es-ES", "pt-BR", "zh-Hans", "zh-Hant", "yue-Hans", "yue-Hant", "ko-KR", "ja-JP", "ru-RU", "uk-UA", "th-TH", "vi-VT", "ar-SA", "ars-SA"]</span>
<span class="c1">// 未看到 WWDC 提到的 Swedish 语言，不确定是还没推出还是跟装置地区、语系有关联</span>
</pre></table></code></div></div><h4 id="动态动作捕捉"><span class="me-2">动态动作捕捉</span><a href="#动态动作捕捉" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*6TfyCcszdD1NdId0bdM16Q.gif" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*6TfyCcszdD1NdId0bdM16Q.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTQiIGhlaWdodD0iNDEwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*8y_XXdH36uKpfP0p6BCJQA.gif" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8y_XXdH36uKpfP0p6BCJQA.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTgiIGhlaWdodD0iNDIwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>可以实现人、物件动态捕捉</p><li><p>手势补捉实现隔空签名功能</p></ul><h4 id="whats-new-in-vision-ios-18-图片评分功能-品质记忆点"><span class="me-2">What’s new in Vision? (iOS 18)— 图片评分功能 (品质、记忆点)</span><a href="#whats-new-in-vision-ios-18-图片评分功能-品质记忆点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>可对输入图片得计算出分数，方便筛选出优质照片</p><li><p>分数计算方式包含多个维度，不只是画质，还有光线、角度、拍摄主体、 <strong>是否有让人感到的记忆点</strong> …等等</p></ul><p><a href="/assets/755509180ca8/1*XwjeaHcB6arxJhIR7cFsWg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*XwjeaHcB6arxJhIR7cFsWg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTIiIGhlaWdodD0iNDQ5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*YdhZlZBlTaIZd4nLxhBtaQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YdhZlZBlTaIZd4nLxhBtaQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDgiIGhlaWdodD0iNDUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*IhMDFdk6DWwTv1qIG0Gi0Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*IhMDFdk6DWwTv1qIG0Gi0Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDkiIGhlaWdodD0iNDQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>WWDC 中给了以上三张图片做说明(相同画质之下)，分别是：</p><ul><li><p>高分的图片：取景、光线、有记忆点</p><li><p>低分的图片：没有主体、像是随手或不小心拍的</p><li><p>素材的图片：技术上拍的很好但是没有记忆点，像是作为素材图库用的图片</p></ul><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/calculateimageaestheticsscoresrequest" target="_blank">CalculateImageAestheticsScoresRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">CalculateImageAestheticsScoresRequest</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

<span class="c1">// 照片分数</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">overallScore</span><span class="p">)</span>

<span class="c1">// 是否被判定为素材图片</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">isUtility</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="whats-new-in-vision-ios-18--身体手势姿势同时侦测"><span class="me-2">What’s new in Vision? (iOS 18) — 身体＋手势姿势同时侦测</span><a href="#whats-new-in-vision-ios-18--身体手势姿势同时侦测" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*A9320aRV-jdccgiXrmSrJw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*A9320aRV-jdccgiXrmSrJw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMzM0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>以往只能个别侦测人体 Pose 和 手部 Pose，这次更新可以让开发者同时侦测身体 Pose + 手部 Pose，合成同一个请求跟结果，方便我们做更多应用功能开发。</p><p><strong>iOS ≥ 18 New API: <a href="https://developer.apple.com/documentation/vision/detecthumanbodyposerequest" target="_blank">DetectHumanBodyPoseRequest</a></strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectHumanBodyPoseRequest</span><span class="p">()</span>
<span class="c1">// 一并侦测手部 Pose</span>
<span class="n">request</span><span class="o">.</span><span class="n">detectsHands</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">bodyPose</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">image</span><span class="p">)</span><span class="o">.</span> <span class="n">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

<span class="c1">// 身体 Pose Joints</span>
<span class="k">let</span> <span class="nv">bodyJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// 左手 Pose Joints</span>
<span class="k">let</span> <span class="nv">leftHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">leftHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
<span class="c1">// 右手 Pose Joints</span>
<span class="k">let</span> <span class="nv">rightHandJoints</span> <span class="o">=</span> <span class="n">bodyPose</span><span class="o">.</span><span class="n">rightHand</span><span class="o">.</span><span class="nf">allJoints</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="new-vision-api"><span class="me-2">New Vision API</span><a href="#new-vision-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Apple 在这次的更新当中提供了新的 Swift Vision API 封装给开发者使用，除了基本的包含原本的功能支援之外，主要针对加强 Swift 6 / Swift Concurrency 的特性，提供效能更优、写起来更 Swift 的 API 操作方式。</p><h3 id="get-started-with-vision"><span class="me-2">Get started with Vision</span><a href="#get-started-with-vision" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*mv9g5jmqrS6YScxoGYJemQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*mv9g5jmqrS6YScxoGYJemQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDAiIGhlaWdodD0iNDE5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*iidNN7nKHoskh_tcjfuHKQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*iidNN7nKHoskh_tcjfuHKQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzgiIGhlaWdodD0iNDAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>这边讲者又重新介绍了一次 Vision framework 的基础使用方式，Apple 已经封装好了 <a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">31 种</a> (截至 iOS 18)常见的图像辨识请求「Request」与对应回传的「Observation」物件。</p><ol><li><p><strong>Request:</strong> DetectFaceRectanglesRequest 人脸区域识别请求 <strong>Result:</strong> FaceObservation 之前的文章「 <a href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/">Vision 初探 — APP 头像上传 自动识别人脸裁图 (Swift)</a> 」就是用这对请求。</p><li><p><strong>Request:</strong> RecognizeTextRequest 文字辨识请求 <strong>Result:</strong> RecognizedTextObservation</p><li><p><strong>Request:</strong> GenerateObjectnessBasedSaliencyImageRequest 主体物件辨识请求 <strong>Result:</strong> SaliencyImageObservation</p></ol><h3 id="全部-31-种请求-request"><span class="me-2">全部 31 种请求 Request：</span><a href="#全部-31-种请求-request" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://developer.apple.com/documentation/vision/visionrequest" target="_blank">VisionRequest</a> 。</p><p>\| Request 用途 \| Observation 说明 \| \|———————————————–\|——————————————————————\| \| CalculateImageAestheticsScoresRequest<br />计算图像的美学分数。 \| AestheticsObservation<br />返回图像的美学评分，如构图、色彩等因素。 \| \| ClassifyImageRequest<br />分类图像内容。 \| ClassificationObservation<br />返回图像中物体或场景的分类标签及置信度。 \| \| CoreMLRequest<br />使用 Core ML 模型分析图像。 \| CoreMLFeatureValueObservation<br />根据 Core ML 模型的输出结果生成观察值。 \| \| DetectAnimalBodyPoseRequest<br />检测图像中的动物姿势。 \| RecognizedPointsObservation<br />返回动物的骨架点及其位置。 \| \| DetectBarcodesRequest<br />检测图像中的条码。 \| BarcodeObservation<br />返回条码数据及类型（如 QR code）。 \| \| DetectContoursRequest<br />检测图像中的轮廓。 \| ContoursObservation<br />返回图像中检测到的轮廓线。 \| \| DetectDocumentSegmentationRequest<br />检测并分割图像中的文件。 \| RectangleObservation<br />返回文件边界的矩形框位置。 \| \| DetectFaceCaptureQualityRequest<br />评估面部捕捉质量。 \| FaceObservation<br />返回面部图像的质量评估分数。 \| \| DetectFaceLandmarksRequest<br />检测面部特征点。 \| FaceObservation<br />返回面部特征点（如眼睛、鼻子等）的详细位置。 \| \| DetectFaceRectanglesRequest<br />检测图像中的面部。 \| FaceObservation<br />返回人脸的边界框位置。 \| \| DetectHorizonRequest<br />检测图像中的地平线。 \| HorizonObservation<br />返回地平线的角度和位置。 \| \| DetectHumanBodyPose3DRequest<br />检测图像中的 3D 人体姿势。 \| RecognizedPointsObservation<br />返回 3D 人体骨架点及其空间坐标。 \| \| DetectHumanBodyPoseRequest<br />检测图像中的人体姿势。 \| RecognizedPointsObservation<br />返回人体骨架点及其坐标。 \| \| DetectHumanHandPoseRequest<br />检测图像中的手部姿势。 \| RecognizedPointsObservation<br />返回手部骨架点及其位置。 \| \| DetectHumanRectanglesRequest<br />检测图像中的人体。 \| HumanObservation<br />返回人体的边界框位置。 \| \| DetectRectanglesRequest<br />检测图像中的矩形。 \| RectangleObservation<br />返回矩形的四个顶点坐标。 \| \| DetectTextRectanglesRequest<br />检测图像中的文本区域。 \| TextObservation<br />返回文本区域的位置和边界框。 \| \| DetectTrajectoriesRequest<br />检测并分析物体运动轨迹。 \| TrajectoryObservation<br />返回运动轨迹点及其时间序列。 \| \| GenerateAttentionBasedSaliencyImageRequest<br />生成基于注意力的显著性图像。 \| SaliencyImageObservation<br />返回图像中最具吸引力区域的显著性地图。 \| \| GenerateForegroundInstanceMaskRequest<br />生成前景实例掩膜图像。 \| InstanceMaskObservation<br />返回前景物体的掩膜。 \| \| GenerateImageFeaturePrintRequest<br />生成图像特征指纹以进行比较。 \| FeaturePrintObservation<br />返回图像的特征指纹数据，用于相似度比较。 \| \| GenerateObjectnessBasedSaliencyImageRequest<br />生成基于物体显著性的图像。 \| SaliencyImageObservation<br />返回物体显著性区域的显著性地图。 \| \| GeneratePersonInstanceMaskRequest<br />生成人物实例掩膜图像。 \| InstanceMaskObservation<br />返回人物实例的掩膜。 \| \| GeneratePersonSegmentationRequest<br />生成人物分割图像。 \| SegmentationObservation<br />返回人物分割的二值图。 \| \| RecognizeAnimalsRequest<br />检测并识别图像中的动物。 \| RecognizedObjectObservation<br />返回动物类型及其置信度。 \| \| RecognizeTextRequest<br />检测并识别图像中的文本。 \| RecognizedTextObservation<br />返回检测到的文本内容及其区域位置。 \| \| TrackHomographicImageRegistrationRequest<br />跟踪图像的同位影像配准。 \| ImageAlignmentObservation<br />返回图像间的同位变换矩阵，用于影像配准。 \| \| TrackObjectRequest<br />跟踪图像中的物体。 \| DetectedObjectObservation<br />返回物体在影像中的位置和速度信息。 \| \| TrackOpticalFlowRequest<br />跟踪图像中的光流。 \| OpticalFlowObservation<br />返回光流矢量场，用于描述像素移动情况。 \| \| TrackRectangleRequest<br />跟踪图像中的矩形。 \| RectangleObservation<br />返回矩形在影像中的位置、大小和旋转角度。 \| \| TrackTranslationalImageRegistrationRequest<br />跟踪图像的平移影像配准。 \| ImageAlignmentObservation<br />返回图像间的平移变换矩阵，用于影像配准。 \|</p><ul><li>前面补上 VN 就是旧的 API 写法 (iOS 18 以前的版本)</ul><p>讲者提到了几个常用的 Request，如下。</p><h4 id="classifyimagerequest"><span class="me-2">ClassifyImageRequest</span><a href="#classifyimagerequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨识输入的图片，得到标签分类与置信度。</p><p><a href="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*8NSQEjxGejujKLbXcILmxQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjE4NjciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*f1rNoOIQbE33M9F9NmoTXg.webp" alt="[游记] 2024 二访九州 9 日自由行，经釜山→博多邮轮入境" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc3NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>[游记] 2024 二访九州 9 日自由行，经釜山→博多邮轮入境</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">ClassifyImageRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*yL3vI1ADzwlovctW5WQgJw.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNClassificationObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNClassifyImageRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/cb65fd5ab770/1*3_jdrLurFuUfNdW4BJaRww.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析结果：</strong></p><div class="language-r highlighter-rouge"><div class="code-header"> <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">outdoor</span><span class="err">（</span><span class="n">户外</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sky</span><span class="err">（</span><span class="n">天空</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.75392926</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">blue_sky</span><span class="err">（</span><span class="n">蓝天</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.7519531</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">machine</span><span class="err">（</span><span class="n">机器</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.6958008</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">cloudy</span><span class="err">（</span><span class="n">多云</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.26538086</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">structure</span><span class="err">（</span><span class="n">结构</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.15728651</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">sign</span><span class="err">（</span><span class="n">标志</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.14224191</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">fence</span><span class="err">（</span><span class="n">栅栏</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.118652344</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">banner</span><span class="err">（</span><span class="n">横幅</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.0793457</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">material</span><span class="err">（</span><span class="n">材料</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.075975396</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">plant</span><span class="err">（</span><span class="n">植物</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.054406323</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">foliage</span><span class="err">（</span><span class="n">树叶</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.05029297</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">light</span><span class="err">（</span><span class="n">光</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.048126098</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">lamppost</span><span class="err">（</span><span class="n">灯柱</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.048095703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">billboards</span><span class="err">（</span><span class="n">广告牌</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.040039062</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">art</span><span class="err">（</span><span class="n">艺术</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.03977703</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">branch</span><span class="err">（</span><span class="n">树枝</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.03930664</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">decoration</span><span class="err">（</span><span class="n">装饰</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.036868922</span><span class="w">
 </span><span class="err">•</span><span class="w"> </span><span class="n">flag</span><span class="err">（</span><span class="n">旗帜</span><span class="err">）</span><span class="o">:</span><span class="w"> </span><span class="m">0.036865234</span><span class="w">
</span><span class="n">....略</span><span class="w">
</span></pre></table></code></div></div><h4 id="recognizetextrequest"><span class="me-2">RecognizeTextRequest</span><a href="#recognizetextrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨识图片中的文字内容。(a.k.a 图片转文字)</p><p><a href="/assets/755509180ca8/1*XL40lLT774PfO60rCIfnxA.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*XL40lLT774PfO60rCIfnxA.webp" alt="[[游记] 2023 东京 5 日自由行](/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E4%B8%9C%E4%BA%AC%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-5-%E5%A4%A9%E9%A3%9F%E4%BD%8F%E8%A1%8C%E5%85%A8%E8%AE%B0%E5%BD%95%E4%B8%8E%E5%BF%85%E8%AE%BF%E6%99%AF%E7%82%B9%E6%8E%A8%E8%8D%90-9da2c51fa4f2/)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iMTAyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E4%B8%9C%E4%BA%AC%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-5-%E5%A4%A9%E9%A3%9F%E4%BD%8F%E8%A1%8C%E5%85%A8%E8%AE%B0%E5%BD%95%E4%B8%8E%E5%BF%85%E8%AE%BF%E6%99%AF%E7%82%B9%E6%8E%A8%E8%8D%90-9da2c51fa4f2/">[游记] 2023 东京 5 日自由行</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"ja-JP"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">request</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ja-JP"</span><span class="p">,</span> <span class="s">"en-US"</span><span class="p">]</span> <span class="c1">// Specify language code, e.g., Traditional Chinese</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://zhgchg.li/assets/9da2c51fa4f2/1*fBbNbDepYioQ-3-0XUkF6Q.jpeg"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析结果：</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="err">LE</span> <span class="err">LABO</span> <span class="err">青山店</span>
<span class="nl">TEL</span><span class="o">:</span><span class="nf">03-6419-7167</span>
<span class="err">＊お买い上げありがとうございます*</span>
<span class="nl">No</span><span class="o">:</span> <span class="nf">21347</span>
<span class="err">日付：2023/06/10</span> <span class="err">14.14.57</span>
<span class="err">担当：</span>
<span class="err">1690370</span>
<span class="err">レジ：008A</span> <span class="err">1</span>
<span class="err">商品名</span>
<span class="err">税込上代数量税込合计</span>
<span class="err">カイアック</span> <span class="err">10</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1P7010000S</span>
<span class="err">16,800</span>
<span class="err">16,800</span>
<span class="err">アナザー</span> <span class="err">13</span> <span class="err">EDP</span> <span class="err">FB</span> <span class="err">15ML</span>
<span class="err">J1PJ010000S</span>
<span class="err">10,700</span>
<span class="err">10,700</span>
<span class="err">リップパーム</span> <span class="err">15ML</span>
<span class="err">JOWC010000S</span>
<span class="err">2,000</span>
<span class="err">1</span>
<span class="err">合计金额</span>
<span class="err">（内税额）</span>
<span class="err">CARD</span>
<span class="err">2,000</span>
<span class="err">3点御买上げ</span>
<span class="err">29,500</span>
<span class="err">0</span>
<span class="err">29,500</span>
<span class="err">29,500</span>
</pre></table></code></div></div><h4 id="detectbarcodesrequest"><span class="me-2">DetectBarcodesRequest</span><a href="#detectbarcodesrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>侦测图片中的条码、QRCode 数据。</p><p><a href="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*Z72y9rIwIKQCmnnuwsq0uQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEwNTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*s3V1UQRIqto-iG1e30PK7Q.webp" alt="泰国当地人推荐鹅牌清凉膏" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>泰国当地人推荐鹅牌清凉膏</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6777"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地测试图片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>分析结果：</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nl">Payload</span><span class="o">:</span> <span class="nf">8859126000911</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://lin.ee/hGynbVM</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">http://www.hongthaipanich.com/</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">https://www.facebook.com/qr?id=100063856061714</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyQR</span>
</pre></table></code></div></div><h4 id="recognizeanimalsrequest"><span class="me-2">RecognizeAnimalsRequest</span><a href="#recognizeanimalsrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>辨识图片中的动物与置信度。</p><p><a href="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*5zF3gA3WB1Q0-_cgt6mTCw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEwNTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*KZ7mdE8fobP-_oj7tJf_Ww.webp" alt="[meme Source](https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTAwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://www.redbubble.com/i/canvas-print/Funny-AI-Woman-yelling-at-a-cat-meme-design-Machine-learning-by-omolog/43039298.5Y5V7" target="_blank">meme Source</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_5026"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地测试图片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RecognizeAnimalsRequest</span><span class="p">()</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">label</span> <span class="k">in</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedObjectObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">labels</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">labels</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">label</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Detected animal: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">identifier</span><span class="se">)</span><span class="s"> with confidence: </span><span class="se">\(</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNRecognizeAnimalsRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>分析结果：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Detected</span> <span class="n">animal</span><span class="p">:</span> <span class="n">Cat</span> <span class="k">with</span> <span class="n">confidence</span><span class="p">:</span> <span class="m">0.77245045</span>
</pre></table></code></div></div><h4 id="其他"><span class="me-2">其他：</span><a href="#其他" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>侦测图像中的人体：DetectHumanRectanglesRequest</p><li><p>侦测人、动物的 Pose 动作 (3D or 2D 都可以)：DetectAnimalBodyPoseRequest、DetectHumanBodyPose3DRequest、DetectHumanBodyPoseRequest、DetectHumanHandPoseRequest</p><li><p>检测并追踪物件的运动轨迹(在影片、动画不同的侦中)：DetectTrajectoriesRequest、TrackObjectRequest、TrackRectangleRequest</p></ul><h4 id="ios--18-update-highlight"><span class="me-2"><strong>iOS ≥ 18 Update Highlight:</strong></span><a href="#ios--18-update-highlight" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">VN</span><span class="o">*</span><span class="n">Request</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Request</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNDetectBarcodesRequest</span> <span class="k">-&gt;</span> <span class="n">DetectBarcodesRequest</span><span class="p">)</span>
<span class="n">VN</span><span class="o">*</span><span class="n">Observation</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="nf">Observation</span> <span class="p">(</span><span class="n">e</span><span class="py">.g. VNRecognizedObjectObservation</span> <span class="k">-&gt;</span> <span class="n">RecognizedObjectObservation</span><span class="p">)</span>
<span class="n">VNRequestCompletionHandler</span> <span class="k">-&gt;</span> <span class="k">async</span><span class="o">/</span><span class="k">await</span>
<span class="n">VNImageRequestHandler</span><span class="nf">.perform</span><span class="p">([</span><span class="n">VN</span><span class="o">*</span><span class="n">Request</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="o">*</span><span class="n">Request</span><span class="nf">.perform</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="wwdc-example"><span class="me-2">WWDC Example</span><a href="#wwdc-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>WWDC 官方影片以超市商品扫描器为例。</p><h4 id="首先大多数的商品都有-barcode-可供扫描"><span class="me-2">首先大多数的商品都有 Barcode 可供扫描</span><a href="#首先大多数的商品都有-barcode-可供扫描" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YT_Uf8eEi36Iv7zcOrmP4A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDAiIGhlaWdodD0iODY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*J9uIwRKubLoJoC7i096AdQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*gKg-NfHYqy7uBqe5hxzBSw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjcwNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>我们可以从 <code class="language-plaintext highlighter-rouge">observation.boundingBox</code> 取得 Barcode 所在位置，但不同于常见 UIView 座标系， <code class="language-plaintext highlighter-rouge">BoundingBox</code> 的相对位置起点是从左下角，值的范围落在 0~1 之间。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"IMG_6785"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"png"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地测试图片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要扫描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// 标记颜色 Layer</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// iOS &gt;=18 新的座标转换 API toImageCoordinates</span>
                    <span class="c1">// 未经测试，实际可能还需要计算 ContentMode = AspectFit 的位移:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// 标记颜色 Layer</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要扫描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">request</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><pre><code class="language-less">// iOS &gt;=18 新的座标转换 API toImageCoordinates
observation.boundingBox.toImageCoordinates(CGSize, origin: .upperLeft)
// https://developer.apple.com/documentation/vision/normalizedpoint/toimagecoordinates(from:imagesize:origin:)
</code></pre><p><strong>Helper:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">// Gen by ChatGPT 4o</span>
<span class="c1">// 因为照片在 ImageView 是设定 ContentMode = AspectFit</span>
<span class="c1">// 所以要多计算上下因 Fit 造成的空白位移</span>
<span class="kd">func</span> <span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">_</span> <span class="nv">boundingBox</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">,</span> <span class="n">to</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">UIImageView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGRect</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">zero</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">imageSize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">viewSize</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span>
    <span class="k">let</span> <span class="nv">imageRatio</span> <span class="o">=</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">let</span> <span class="nv">viewRatio</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span>
    <span class="k">var</span> <span class="nv">scaleFactor</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">var</span> <span class="nv">offsetX</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">offsetY</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">imageRatio</span> <span class="o">&gt;</span> <span class="n">viewRatio</span> <span class="p">{</span>
        <span class="c1">// 图像在宽度方向上适配</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span>
        <span class="n">offsetY</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 图像在高度方向上适配</span>
        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">viewSize</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span>
        <span class="n">offsetX</span> <span class="o">=</span> <span class="p">(</span><span class="n">viewSize</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">minX</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetX</span>
    <span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">maxY</span><span class="p">)</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span> <span class="o">+</span> <span class="n">offsetY</span>
    <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">let</span> <span class="nv">height</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">scaleFactor</span>
    <span class="k">return</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">height</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>输出结果</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">BoundingBox</span><span class="o">:</span> <span class="nf">(0.5295758928571429</span><span class="p">,</span><span class="nf"> 0.21408638121589782</span><span class="p">,</span><span class="nf"> 0.0943080357142857</span><span class="p">,</span><span class="nf"> 0.21254415360708087)</span>
<span class="nl">Payload</span><span class="o">:</span> <span class="nf">4710018183805</span>
<span class="nl">Symbology</span><span class="o">:</span> <span class="nf">VNBarcodeSymbologyEAN13</span>
</pre></table></code></div></div><h4 id="部分商品无-barcode如散装水果只有商品标签"><span class="me-2">部分商品无 Barcode，如散装水果只有商品标签</span><a href="#部分商品无-barcode如散装水果只有商品标签" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*jeZhLtg9j11kgOAvKZmevg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NzYiIGhlaWdodD0iODM0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*YNokMMUewMA2kzjoGmMJPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjk2IiBoZWlnaHQ9IjY5NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>因此我们的扫瞄器也需要同时支援扫描纯文字标签。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">filePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"apple"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"jpg"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// 本地测试图片</span>
<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要扫描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
            <span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
            <span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
            <span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                    <span class="c1">// 标记颜色 Layer</span>
                    <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                    <span class="c1">// iOS &gt;=18 新的座标转换 API toImageCoordinates</span>
                    <span class="c1">// 未经测试，实际可能还需要计算 ContentMode = AspectFit 的位移:</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                    <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">observation</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 旧的写法</span>
    <span class="k">let</span> <span class="nv">barcodesCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNBarcodeObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span>
                <span class="c1">// 标记颜色 Layer</span>
                <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convertBoundingBox</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="p">)</span>
                <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadStringValue</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="o">.</span><span class="n">rawValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">textCompletionHandler</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">observations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNRecognizedTextObservation</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">observation</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">VNDetectBarcodesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">barcodesCompletionHandler</span><span class="p">)</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要扫描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">let</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">VNRecognizeTextRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">textCompletionHandler</span><span class="p">)</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">accurate</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="s">"en-US"</span><span class="p">]</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Request failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>输出结果：</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>94128s
ORGANIC
Pink Lady®
Produce of USh
</pre></table></code></div></div><p><strong>iOS ≥ 18 Update Highlight:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
<span class="c1">// parameter pack syntax and we must wait for all requests to finish before we can use their results.</span>
<span class="c1">// let (barcodesObservation, textObservation, ...) = try await handler.perform(barcodesRequest, textRequest, ...)</span>
<span class="k">let</span> <span class="p">(</span><span class="nv">barcodesObservation</span><span class="p">,</span> <span class="nv">textObservation</span><span class="p">)</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="ios--18-performall-changeslatest_minortarget_blank-方法"><span class="me-2">iOS ≥ 18 <a href="https://developer.apple.com/documentation/vision/imagerequesthandler/performall(_:">performAll( )</a>?changes=latest_minor){:target=”_blank”} 方法</span><a href="#ios--18-performall-changeslatest_minortarget_blank-方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*z0364eYD4F4On194EgQ1kQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTAwIiBoZWlnaHQ9Ijc0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>前面的 <code class="language-plaintext highlighter-rouge">perform(barcodesRequest, textRequest)</code> 处理 Barcode 扫描跟文字扫描的方式需要等到两个 Request 都完成才能继续执行；iOS 18 开始提供新的 <code class="language-plaintext highlighter-rouge">performAll()</code> 方法，将回应方式改为串流，在收到其中一个 Reqeust 结果是就能做对应处理，例如扫描到 Barcode 就直接响应。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">18.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 新的使用 Swift 特性的 API</span>
    <span class="k">var</span> <span class="nv">barcodesRequest</span> <span class="o">=</span> <span class="kt">DetectBarcodesRequest</span><span class="p">()</span>
    <span class="n">barcodesRequest</span><span class="o">.</span><span class="n">symbologies</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">ean13</span><span class="p">]</span> <span class="c1">// 如果只要扫描 EAN13 Barcode，可直接指定，提升效能</span>
    <span class="k">var</span> <span class="nv">textRequest</span> <span class="o">=</span> <span class="kt">RecognizeTextRequest</span><span class="p">()</span>
    <span class="n">textRequest</span><span class="o">.</span><span class="n">recognitionLanguages</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"zh-Hnat"</span><span class="p">),</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"en-US"</span><span class="p">)]</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">ImageRequestHandler</span><span class="p">(</span><span class="n">fileURL</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="nf">performAll</span><span class="p">([</span><span class="n">barcodesRequest</span><span class="p">,</span> <span class="n">textRequest</span><span class="p">]</span> <span class="k">as</span> <span class="p">[</span><span class="kd">any</span> <span class="kt">VisionRequest</span><span class="p">])</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">result</span> <span class="k">in</span> <span class="n">observation</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">detectBarcodes</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">barcodesObservation</span><span class="p">):</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="n">barcodesObservation</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">infoLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span>
                        <span class="c1">// 标记颜色 Layer</span>
                        <span class="k">let</span> <span class="nv">colorLayer</span> <span class="o">=</span> <span class="kt">CALayer</span><span class="p">()</span>
                        <span class="c1">// iOS &gt;=18 新的座标转换 API toImageCoordinates</span>
                        <span class="c1">// 未经测试，实际可能还需要计算 ContentMode = AspectFit 的位移:</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">toImageCoordinates</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nv">origin</span><span class="p">:</span> <span class="o">.</span><span class="n">upperLeft</span><span class="p">)</span>
                        <span class="n">colorLayer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">withAlphaComponent</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">baseImageView</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">colorLayer</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"BoundingBox: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">cgRect</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Payload: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">payloadString</span> <span class="p">??</span> <span class="s">"No payload"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Symbology: </span><span class="se">\(</span><span class="n">observation</span><span class="o">.</span><span class="n">symbology</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">recognizeText</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">let</span> <span class="nv">textObservation</span><span class="p">):</span>
                <span class="n">textObservation</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                    <span class="n">observation</span> <span class="k">in</span>
                    <span class="k">let</span> <span class="nv">topCandidate</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">topCandidates</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">topCandidate</span><span class="p">?</span><span class="o">.</span><span class="n">string</span> <span class="p">??</span> <span class="s">"No text recognized"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Unrecongnized result: </span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="optimize-with-swift-concurrency"><span class="me-2">Optimize with Swift Concurrency</span><a href="#optimize-with-swift-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*LgxxMOVS6is3n6EqPWqA6Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*LgxxMOVS6is3n6EqPWqA6Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ0IiBoZWlnaHQ9IjYxOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*80CFJpkb-gjy3bJs4jAC2A.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*80CFJpkb-gjy3bJs4jAC2A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTYiIGhlaWdodD0iODQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>假设我们有一个图片墙列表，每张图片都需要自动裁切出物件主体；这时候可以善用 Swift Concurrency 增加载入效率。</p><h4 id="原始写法"><span class="me-2"><strong>原始写法</strong></span><a href="#原始写法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="k">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">GenerateAttentionBasedSaliencyImageRequest</span><span class="p">()</span>
  <span class="k">let</span> <span class="nv">saliencyObservation</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="nf">cropImage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">saliencyObservation</span><span class="o">.</span><span class="n">salientObjects</span><span class="p">)</span>
<span class="p">}</span>
    
<span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>一次只执行一个，效率、效能缓慢。</p><h4 id="优化-1--taskgroup-concurrency"><span class="me-2"><strong>优化 (1) — TaskGroup</strong> Concurrency</span><a href="#优化-1--taskgroup-concurrency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>
<span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span> <span class="n">taskGroup</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span> <span class="p">{</span>
      <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>将每个 Task 都加入 TaskGroup Concurrency 执行。</p><blockquote><p><strong><em>问题：图片辨识、截图操作非常消耗记忆体性能，如果无节制狂加并行任务，可能造成使用者卡顿、OOM 闪退问题。</em></strong></p></blockquote><h4 id="优化-2--taskgroup-concurrency--限制并行数量"><span class="me-2">优化 (2) — TaskGroup Concurrency + 限制并行数量</span><a href="#优化-2--taskgroup-concurrency--限制并行数量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">generateAllThumbnails</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">try</span> <span class="k">await</span> <span class="n">withThrowingDiscardingTaskGroup</span> <span class="p">{</span>
        <span class="n">taskGroup</span> <span class="k">in</span>
        <span class="c1">// 最多执行数量不得超过 5</span>
        <span class="k">let</span> <span class="nv">maxImageTasks</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="c1">// 先填充 5 个 Task</span>
        <span class="k">for</span> <span class="n">index</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">maxImageTasks</span> <span class="p">{</span>
            <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">nextIndex</span> <span class="o">=</span> <span class="n">maxImageTasks</span>
        <span class="k">for</span> <span class="k">try</span> <span class="k">await</span> <span class="n">_</span> <span class="k">in</span> <span class="n">taskGroup</span> <span class="p">{</span>
            <span class="c1">// taskGroup 里 Task await 完成时...</span>
            <span class="c1">// 检查 Index 是否到尾部</span>
            <span class="k">if</span> <span class="n">nextIndex</span> <span class="o">&lt;</span> <span class="n">images</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">nextIndex</span><span class="p">]</span>
                <span class="c1">// 继续逐个填充 Task (将维持在最多 5 个)</span>
                <span class="n">taskGroup</span><span class="o">.</span><span class="n">addTask</span> <span class="p">{</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="nf">generateThumbnail</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">nextIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="update-an-existing-vision-app"><span class="me-2">Update an existing Vision app</span><a href="#update-an-existing-vision-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*0OhzcxQ7OpSujeyvt9918Q.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*0OhzcxQ7OpSujeyvt9918Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYxNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/755509180ca8/1*MH4Xa0RB2DZQ1Fl9-kItSw.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*MH4Xa0RB2DZQ1Fl9-kItSw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjIyIiBoZWlnaHQ9IjQxOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ol><li><p>Vision 将在具备神经引擎的设备上移除对部分请求的 CPU 和 GPU 支持。在这些设备上，神经引擎是性能最好的选择。 可以使用 <code class="language-plaintext highlighter-rouge">supportedComputeDevices()</code> API 进行检查</p><li><p>移除所有 VN 前缀 <code class="language-plaintext highlighter-rouge">VNXXRequest</code> , <code class="language-plaintext highlighter-rouge">VNXXXObservation</code> -&gt; <code class="language-plaintext highlighter-rouge">Reqeust</code> , <code class="language-plaintext highlighter-rouge">Observation</code></p><li><p>使用 async/await 取代原本的 VNRequestCompletionHandler</p><li><p>直接使用 <code class="language-plaintext highlighter-rouge">*Request.perform()</code> 取代原本的 <code class="language-plaintext highlighter-rouge">VNImageRequestHandler.perform([VN*Request])</code></p></ol><h3 id="wrap-up"><span class="me-2">Wrap-up</span><a href="#wrap-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>为 Swift 语言特性新设计的 API</p><li><p>新的功能、方法都为 Swift Only, iOS ≥ 18 可用</p><li><p>新的图片评分功能、身体＋手部动作追踪</p></ul><h3 id="thanks"><span class="me-2">Thanks!</span><a href="#thanks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*BK_5eH1i4-drOUOGnuQRSg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY2NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h3 id="kkday-招募工商"><span class="me-2">KKday 招募工商</span><a href="#kkday-招募工商" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.webp" class="popup img-link blur"><img data-src="/assets/755509180ca8/1*kjcldhvCP1cM-QqDfRFaYg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjgiIGhlaWdodD0iNDM5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>👉👉👉本次读书会分享源于 KKday App Team 组内每周技术分享活动， <strong>目前团队也正在热情招募 <a href="https://kkday.bamboohr.com/careers/25?source=aWQ9Mjk%3D" target="_blank">Senior iOS Engineer</a> ，有兴趣的朋友欢迎投递履历</strong> 。👈👈👈</p><h4 id="参考资料"><span class="me-2">参考资料</span><a href="#参考资料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="discover-swift-enhancements-in-the-vision-framework"><span class="me-2"><a href="https://developer.apple.com/videos/play/wwdc2024/10163/" target="_blank">Discover Swift enhancements in the Vision framework</a></span><a href="#discover-swift-enhancements-in-the-vision-framework" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The Vision Framework API has been redesigned to leverage modern Swift features like concurrency, making it easier and faster to integrate a wide array of Vision algorithms into your app. We’ll tour the updated API and share sample code, along with best practices, to help you get the benefits of this framework with less coding effort. We’ll also demonstrate two new features: image aesthetics and holistic body pose.</p><h3 id="chapters"><span class="me-2">Chapters</span><a href="#chapters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>0:00 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=0" target="_blank">Introduction</a></p><li><p>1:07 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=67" target="_blank">New Vision API</a></p><li><p>1:47 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=107" target="_blank">Get started with Vision</a></p><li><p>8:59 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=539" target="_blank">Optimize with Swift Concurrency</a></p><li><p>11:05 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=665" target="_blank">Update an existing Vision app</a></p><li><p>13:46 — <a href="https://developer.apple.com/videos/play/wwdc2024/10163/?time=826" target="_blank">What’s new in Vision?</a></p></ul><h4 id="vision-framework-apple-developer-documentation"><span class="me-2"><a href="https://developer.apple.com/documentation/vision/" target="_blank">Vision framework Apple Developer Documentation</a></span><a href="#vision-framework-apple-developer-documentation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>-</p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/755509180ca8" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2024-08-13-755509180ca8.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/kkday-tech-blog/">KKday Tech Blog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/vision-framework/" class="post-tag no-text-decoration" >vision-framework</a> <a href="/tags/apple-intelligence/" class="post-tag no-text-decoration" >apple-intelligence</a> <a href="/tags/ai/" class="post-tag no-text-decoration" >ai</a> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine-learning</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20Vision%20framework%EF%BD%9CWWDC%2024%20Swift%20Concurrency%20%E4%B8%8E%E6%96%B0%20API%20%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fzh-cn%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E4%25B8%258E%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E5%25AE%259E%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20Vision%20framework%EF%BD%9CWWDC%2024%20Swift%20Concurrency%20%E4%B8%8E%E6%96%B0%20API%20%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fzh-cn%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E4%25B8%258E%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E5%25AE%259E%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fkkday-tech-blog%2Fzh-cn%2Fios-vision-framework-wwdc-24-swift-concurrency-%25E4%25B8%258E%25E6%2596%25B0-api-%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E5%25AE%259E%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-755509180ca8%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1723536637" data-df="ll" > Aug 13, 2024 </time><h4 class="pt-0 my-2">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</h4><div class="text-muted"><p>Vision framework 功能回顧 &amp; iOS 18 新 Swift API 試玩</p></div></div></a></article><article class="col"> <a href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1723536637" data-df="ll" > Aug 13, 2024 </time><h4 class="pt-0 my-2">iOS Vision Framework｜Explore Swift API Enhancements from WWDC 24 Session</h4><div class="text-muted"><p>Discover how iOS 18&#39;s Vision framework Swift APIs simplify image analysis and improve development efficiency. Learn key updates and practical usage to boost your app&#39;s computer vision capabilities ...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-12-coreml-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%96%87%E5%AD%97%E5%88%86%E7%B1%BB-%E8%87%AA%E8%AE%A2%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%AE%9E%E6%88%98%E6%95%99%E5%AD%A6-793bf2cdda0f/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539789635" data-df="ll" > Oct 17, 2018 </time><h4 class="pt-0 my-2">iOS 12 CoreML 机器学习文字分类｜自订模型训练实战教学</h4><div class="text-muted"><p>针对iOS开发者，解析如何利用CoreML 2.0自订并训练文字分类模型，解决文章分类自动化痛点，实现准确率提升与快速部署，助你打造智能分类App功能。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/kkday-tech-blog/en/ios-vision-framework-explore-swift-api-enhancements-from-wwdc-24-session-755509180ca8/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS Vision Framework｜Explore Swift API Enhancements from WWDC 24 Session</p></a> <a href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
