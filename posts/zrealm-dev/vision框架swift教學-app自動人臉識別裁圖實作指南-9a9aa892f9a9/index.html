<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Vision框架Swift教學｜APP自動人臉識別裁圖實作指南" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="針對iOS APP開發者，解決頭像裁圖時人臉被截斷問題，透過Vision框架自動定位人臉並精準裁切，提升用戶頭像呈現品質，實現人臉中心點裁圖，優化APP使用體驗。" /><meta property="og:description" content="針對iOS APP開發者，解決頭像裁圖時人臉被截斷問題，透過Vision框架自動定位人臉並精準裁切，提升用戶頭像呈現品質，實現人臉中心點裁圖，優化APP使用體驗。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-10-17T00:01:24+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" /><meta property="twitter:title" content="Vision框架Swift教學｜APP自動人臉識別裁圖實作指南" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-08-13T16:17:24+08:00","datePublished":"2018-10-17T00:01:24+08:00","description":"針對iOS APP開發者，解決頭像裁圖時人臉被截斷問題，透過Vision框架自動定位人臉並精準裁切，提升用戶頭像呈現品質，實現人臉中心點裁圖，優化APP使用體驗。","headline":"Vision框架Swift教學｜APP自動人臉識別裁圖實作指南","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"},"url":"https://zhgchg.li/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"}</script><title>Vision框架Swift教學｜APP自動人臉識別裁圖實作指南 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/vision-face-detection-swift-app-auto-crop-profile-pictures-with-precision-9a9aa892f9a9/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%B8-app%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"如何利用 Vision 框架自動偵測並裁切人臉作為頭像？","acceptedAnswer":{"@type":"Answer","text":"使用 Vision 框架的 VNDetectFaceRectanglesRequest 偵測人臉位置，並將座標轉換成 ImageView 尺寸，再以人臉中心點為基準裁切圖片，確保頭像裁圖不會將臉部裁掉，提升使用者頭像品質。"}},{"@type":"Question","name":"如何解決 UIImageView 與圖片尺寸不符導致人臉標記位置錯誤的問題？","acceptedAnswer":{"@type":"Answer","text":"先調整 UIImageView 大小與圖片原始尺寸一致，避免縮放留白，再將 Vision 偵測出的人臉 boundingBox 做座標系轉換，將原始座標映射到 ImageView 上，確保標記框精準覆蓋人臉位置。"}},{"@type":"Question","name":"Vision 框架的人臉偵測結果如何轉換成 UI 座標系以便標記？","acceptedAnswer":{"@type":"Answer","text":"Vision 回傳的 boundingBox 是以左下角為原點的比例座標，需先以 ImageView 實際尺寸放大，再做垂直翻轉和平移，將座標轉換成 UIKit 左上角為原點的座標系，才能正確顯示人臉標記框。"}},{"@type":"Question","name":"使用 Vision 偵測多張人臉時，如何避免裁切錯誤？","acceptedAnswer":{"@type":"Answer","text":"當 Vision 偵測到多張人臉時，應避免自動裁切，改為提示用戶或選擇特定人臉，因為裁切依賴單一臉部中心點，避免裁切範圍錯置導致頭像不完整。"}},{"@type":"Question","name":"如何在背景執行緒使用 Vision 偵測人臉避免 UI 卡頓？","acceptedAnswer":{"@type":"Answer","text":"將 VNImageRequestHandler.perform() 呼叫放在 DispatchQueue.global().async 執行背景執行緒，完成後再回到主執行緒更新 UI，確保人臉偵測不阻塞主線程，提升 APP 流暢度。"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Vision框架Swift教學｜APP自動人臉識別裁圖實作指南</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Vision框架Swift教學｜APP自動人臉識別裁圖實作指南</h1><p class="post-desc fw-light mb-4">針對iOS APP開發者，解決頭像裁圖時人臉被截斷問題，透過Vision框架自動定位人臉並精準裁切，提升用戶頭像呈現品質，實現人臉中心點裁圖，優化APP使用體驗。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1539705684" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 17, 2018 </time> </span> <span> Updated <time data-ts="1723537044" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" class="popup img-link preview-img blur"><img data-src="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1551 words" > <em>8 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Vision框架Swift教學｜APP自動人臉識別裁圖實作指南</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Vision框架Swift教學｜APP自動人臉識別裁圖實作指南</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/vision-face-detection-swift-app-auto-crop-profile-pictures-with-precision-9a9aa892f9a9/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目錄</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li><a href="#vision-初探--app-頭像上傳-自動識別人臉裁圖-swift">Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)</a></li><li class="has-children"><details><summary>[2024/08/13 Update] <a href="#20240813-update">#</a></summary><ul><li><a href="#一樣不多說先上一張成品圖">一樣不多說，先上一張成品圖</a></li></ul></details></li><li class="has-children"><details><summary>實戰開始 <a href="#實戰開始">#</a></summary><ul><li><a href="#首先我們先做能標記人臉位置的功能初步認識一下vision怎麼用">首先我們先做能標記人臉位置的功能，初步認識一下Vision怎麼用</a></li><li><a href="#再來我們來做今天的重頭戲--依照人臉的位置裁切出大頭貼的正確位置">再來我們來做今天的重頭戲 — 依照人臉的位置裁切出大頭貼的正確位置</a></li><li><a href="#完成效果圖">完成效果圖</a></li></ul></details></li><li><a href="#完整app範例">完整APP範例</a></li></ul></nav><hr /><h3 id="vision-初探--app-頭像上傳-自動識別人臉裁圖-swift"><span class="me-2">Vision 初探 — APP 頭像上傳 自動識別人臉裁圖 (Swift)</span><a href="#vision-初探--app-頭像上傳-自動識別人臉裁圖-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vision 實戰應用</p><h3 id="20240813-update"><span class="me-2">[2024/08/13 Update]</span><a href="#20240813-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>請參考新文章、新的 API：「 <a href="/posts/kkday-tech-blog/ios-vision-framework-wwdc-24-swift-concurrency-%E8%88%87%E6%96%B0-api-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E8%88%87%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97-755509180ca8/">iOS Vision framework x WWDC 24 Discover Swift enhancements in the Vision framework Session</a> 」</ul><h4 id="一樣不多說先上一張成品圖"><span class="me-2">一樣不多說，先上一張成品圖：</span><a href="#一樣不多說先上一張成品圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*c-ioRH_Z2nMYRxSbuBD71A.webp" alt="優化前 V.S 優化後 — [結婚吧APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjUyNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>優化前 V.S 優化後 — <a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8" target="_blank">結婚吧APP</a></p><p>前陣子iOS 12發佈更新，注意到新開放的CoreML 機器學習框架；覺得挺有趣的，就開始構想如果想用在當前的產品上能放在哪裡？</p><blockquote><p><strong>CoreML嚐鮮文章現已發佈： <a href="/posts/zrealm-dev/ios-12-coreml-%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92%E6%96%87%E5%AD%97%E5%88%86%E9%A1%9E-%E8%87%AA%E8%A8%82%E6%A8%A1%E5%9E%8B%E8%A8%93%E7%B7%B4%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8-793bf2cdda0f/">使用機器學習自動預測文章分類，連模型也自己訓練</a></strong></p></blockquote><p>CoreML提供文字、圖像的機器學習模型訓練及引用到APP裡的接口，我原先的想法是，使用CoreML來做到人臉識別，解決APP中有裁圖的項目頭或臉被卡掉的問題，如上圖左所示，若人臉出現在周圍則很容易因為縮放＋裁圖造成臉不完整．</p><p>經過網路搜尋一番後才發現我學識短淺，這個功能在iOS 11就已發佈：「Vision」框架，支援文字偵測、人臉偵測、圖像比對、QRCODE偵測、物件追蹤…功能</p><p>這邊使用的就是其中的人臉偵測項目，經優化後如右圖所示；找到人臉並以此為中心裁圖．</p><h3 id="實戰開始"><span class="me-2">實戰開始：</span><a href="#實戰開始" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="首先我們先做能標記人臉位置的功能初步認識一下vision怎麼用"><span class="me-2">首先我們先做能標記人臉位置的功能，初步認識一下Vision怎麼用</span><a href="#首先我們先做能標記人臉位置的功能初步認識一下vision怎麼用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*cpGgpXsBhuiJoZI03WAGUw.webp" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*cpGgpXsBhuiJoZI03WAGUw.webp" alt="Demo APP" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzIiIGhlaWdodD0iNTcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Demo APP</p><p>完成圖如上所示，能標記出照片中人臉的位置</p><p>p.s 僅能標記「人臉」，整個頭包含頭髮並不行😅</p><p>這塊程式主要分為兩部分，第一部分要解決 圖片原尺寸縮放放入 ImageView時會留白的狀況；簡單來說我們要的是Image的Size多大，ImageView的Size就有多大，若直接放入圖片會造成如下走位情形</p><p><a href="/assets/9a9aa892f9a9/1*Mb70Ed6pALO-8sllCpb7Qg.webp" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*Mb70Ed6pALO-8sllCpb7Qg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDcwIiBoZWlnaHQ9IjEwMTQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>你可能會想說直接改ContentMode變成fill、fit、redraw，但就會變形或圖片被卡掉</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">ratio</span> <span class="o">=</span> <span class="kt">UIScreen</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span>
<span class="c1">//這邊是因為我UIIMAGEVIEW 那邊設定左右對齊0，寬高比1:1</span>

<span class="k">let</span> <span class="nv">sourceImage</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"Demo2"</span><span class="p">)?</span><span class="o">.</span><span class="n">kf</span><span class="o">.</span><span class="nf">resize</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">ratio</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="o">.</span><span class="n">leastNonzeroMagnitude</span><span class="p">),</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">aspectFill</span><span class="p">)</span>
<span class="c1">//使用KingFisher的圖片變形功能，已寬為基準，高度自由</span>

<span class="n">imageView</span><span class="o">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="o">.</span><span class="n">redraw</span>
<span class="c1">//contentMode使用redraw填滿</span>

<span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span>
<span class="c1">//賦予圖片</span>

<span class="n">imageViewConstraints</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">-</span> <span class="p">(</span><span class="n">sourceImage</span><span class="p">?</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="p">??</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">layoutIfNeeded</span><span class="p">()</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">sizeToFit</span><span class="p">()</span>
<span class="c1">//這一塊是我去改變 imageView的Constraints，詳情可看文末完整範例</span>
</pre></table></code></div></div><p>以上就是針對圖片做的處理</p><p><em>裁圖部分使用Kingfisher幫助我們，也可替換成其他套件或自刻方法</em></p><p>第二部分，進入重點直接看Code</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">11.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//iOS 11之後才支援</span>
    <span class="k">let</span> <span class="nv">completionHandle</span><span class="p">:</span> <span class="kt">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">faceObservations</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">results</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">VNFaceObservation</span><span class="p">]</span> <span class="p">{</span>
            <span class="c1">//辨識到的臉臉們</span>
            
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="c1">//操作UIVIEW，切回主執行緒</span>
                <span class="k">let</span> <span class="nv">size</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span>
                
                <span class="n">faceObservations</span><span class="o">.</span><span class="nf">forEach</span><span class="p">({</span> <span class="p">(</span><span class="n">faceObservation</span><span class="p">)</span> <span class="k">in</span>
                    <span class="c1">//坐標系轉換</span>
                    <span class="k">let</span> <span class="nv">translate</span> <span class="o">=</span> <span class="kt">CGAffineTransform</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="nf">scaledBy</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransform</span><span class="p">(</span><span class="nv">scaleX</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nf">translatedBy</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="o">-</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">transRect</span> <span class="o">=</span>  <span class="n">faceObservation</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">translate</span><span class="p">)</span><span class="o">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
                    
                    <span class="k">let</span> <span class="nv">markerView</span> <span class="o">=</span> <span class="kt">UIView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="n">transRect</span><span class="p">)</span>
                    <span class="n">markerView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">0</span><span class="sr">/255, green: 255/255, blue: 0/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">)</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">markerView</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"未偵測到任何臉"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">//辨識請求</span>
    <span class="k">let</span> <span class="nv">baseRequest</span> <span class="o">=</span> <span class="kt">VNDetectFaceRectanglesRequest</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandle</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">faceHandle</span> <span class="o">=</span> <span class="kt">VNImageRequestHandler</span><span class="p">(</span><span class="nv">ciImage</span><span class="p">:</span> <span class="n">ciImage</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[:])</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
        <span class="c1">//辨識需要時間，所以放入背景子執行緒執行，避免當前畫面卡住</span>
        <span class="k">do</span><span class="p">{</span>
            <span class="k">try</span> <span class="n">faceHandle</span><span class="o">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">baseRequest</span><span class="p">])</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Throws：</span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"不支援"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>主要要注意的是，坐標系轉換部分；辨識出來的結果是Image的原始座標；我們須將它轉換成包在外面的ImageView的實際座標才能正確地使用它．</p><h4 id="再來我們來做今天的重頭戲--依照人臉的位置裁切出大頭貼的正確位置"><span class="me-2">再來我們來做今天的重頭戲 — 依照人臉的位置裁切出大頭貼的正確位置</span><a href="#再來我們來做今天的重頭戲--依照人臉的位置裁切出大頭貼的正確位置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="n">let</span> <span class="n">ratio</span> <span class="o">=</span> <span class="nc">UIScreen</span><span class="mf">.</span><span class="n">main</span><span class="mf">.</span><span class="n">bounds</span><span class="mf">.</span><span class="n">size</span><span class="mf">.</span><span class="n">width</span>
<span class="c1">//這邊是因為我UIIMAGEVIEW 那邊設定左右對齊0，寬高比1:1，詳情可看文末完整範例</span>

<span class="n">let</span> <span class="n">sourceImage</span> <span class="o">=</span> <span class="nf">UIImage</span><span class="p">(</span><span class="n">named</span><span class="o">:</span> <span class="s2">"Demo"</span><span class="p">)</span>

<span class="n">imageView</span><span class="mf">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="mf">.</span><span class="n">scaleAspectFill</span>
<span class="c1">//使用scaleAspectFill模式填滿</span>

<span class="n">imageView</span><span class="mf">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span>
<span class="c1">//直接賦予原圖片，我們之後再操作</span>

<span class="k">if</span> <span class="n">let</span> <span class="n">image</span> <span class="o">=</span> <span class="n">sourceImage</span><span class="p">,</span><span class="c1">#available(iOS 11.0, *),let ciImage = CIImage(image: image) {</span>
    <span class="n">let</span> <span class="n">completionHandle</span><span class="o">:</span> <span class="nc">VNRequestCompletionHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span> <span class="n">in</span>
        <span class="k">if</span> <span class="n">request</span><span class="mf">.</span><span class="n">results</span><span class="o">?</span><span class="mf">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span><span class="n">let</span> <span class="n">faceObservation</span> <span class="o">=</span> <span class="n">request</span><span class="mf">.</span><span class="n">results</span><span class="o">?</span><span class="mf">.</span><span class="n">first</span> <span class="k">as</span><span class="o">?</span> <span class="nc">VNFaceObservation</span> <span class="p">{</span>
            <span class="c1">//ㄧ張臉</span>
            <span class="n">let</span> <span class="n">size</span> <span class="o">=</span> <span class="nf">CGSize</span><span class="p">(</span><span class="n">width</span><span class="o">:</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">height</span><span class="o">:</span> <span class="n">ratio</span><span class="p">)</span>
            
            <span class="n">let</span> <span class="n">translate</span> <span class="o">=</span> <span class="nc">CGAffineTransform</span><span class="mf">.</span><span class="n">identity</span><span class="mf">.</span><span class="nf">scaledBy</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="n">size</span><span class="mf">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">transform</span> <span class="o">=</span> <span class="nf">CGAffineTransform</span><span class="p">(</span><span class="n">scaleX</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="mf">.</span><span class="nf">translatedBy</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">:</span> <span class="o">-</span><span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">finalRect</span> <span class="o">=</span>  <span class="n">faceObservation</span><span class="mf">.</span><span class="n">boundingBox</span><span class="mf">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">translate</span><span class="p">)</span><span class="mf">.</span><span class="nf">applying</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
            
            <span class="n">let</span> <span class="n">center</span> <span class="o">=</span> <span class="nf">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span> <span class="p">(</span><span class="n">finalRect</span><span class="mf">.</span><span class="n">origin</span><span class="mf">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">finalRect</span><span class="mf">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">size</span><span class="mf">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">y</span><span class="o">:</span> <span class="p">(</span><span class="n">finalRect</span><span class="mf">.</span><span class="n">origin</span><span class="mf">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">finalRect</span><span class="mf">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">size</span><span class="mf">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="c1">//這裡是計算臉的範圍中間點位置</span>
            
            <span class="n">let</span> <span class="n">newImage</span> <span class="o">=</span> <span class="n">image</span><span class="mf">.</span><span class="n">kf</span><span class="mf">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">to</span><span class="o">:</span> <span class="n">size</span><span class="p">,</span> <span class="k">for</span><span class="o">:</span> <span class="mf">.</span><span class="n">aspectFill</span><span class="p">)</span><span class="mf">.</span><span class="n">kf</span><span class="mf">.</span><span class="nf">crop</span><span class="p">(</span><span class="n">to</span><span class="o">:</span> <span class="n">size</span><span class="p">,</span> <span class="n">anchorOn</span><span class="o">:</span> <span class="n">center</span><span class="p">)</span>
            <span class="c1">//將圖片依照中間點裁切</span>
            
            <span class="nc">DispatchQueue</span><span class="mf">.</span><span class="n">main</span><span class="mf">.</span><span class="n">async</span> <span class="p">{</span>
                <span class="c1">//操作UIVIEW，切回主執行緒</span>
                <span class="k">self</span><span class="mf">.</span><span class="n">imageView</span><span class="mf">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">newImage</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"偵測到多張臉或沒有偵測到臉"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">let</span> <span class="n">baseRequest</span> <span class="o">=</span> <span class="nf">VNDetectFaceRectanglesRequest</span><span class="p">(</span><span class="n">completionHandler</span><span class="o">:</span> <span class="n">completionHandle</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">faceHandle</span> <span class="o">=</span> <span class="nf">VNImageRequestHandler</span><span class="p">(</span><span class="n">ciImage</span><span class="o">:</span> <span class="n">ciImage</span><span class="p">,</span> <span class="n">options</span><span class="o">:</span> <span class="p">[</span><span class="o">:</span><span class="p">])</span>
    <span class="nc">DispatchQueue</span><span class="mf">.</span><span class="k">global</span><span class="p">()</span><span class="mf">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">do</span><span class="p">{</span>
            <span class="k">try</span> <span class="n">faceHandle</span><span class="mf">.</span><span class="nf">perform</span><span class="p">([</span><span class="n">baseRequest</span><span class="p">])</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">{</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Throws：\(error)"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"不支援"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>道理跟標記人臉位置差不多，差別在大頭貼的部分是固定尺寸(如:300x300)，所以我們略過前面需要讓Image適應ImageView的第一部分</p><p>另一個差別是我們要多計算人臉範圍的中心點，並以這個中心點為準做裁切圖片</p><p><a href="/assets/9a9aa892f9a9/1*civytcKOguHfVFHYPVWecA.webp" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*civytcKOguHfVFHYPVWecA.webp" alt="紅點為臉的範圍中心點" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNjAiIGhlaWdodD0iMTU4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>紅點為臉的範圍中心點</p><h4 id="完成效果圖"><span class="me-2">完成效果圖：</span><a href="#完成效果圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9a9aa892f9a9/1*WocYjt0xLkqtGVilxfT2LA.gif" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*WocYjt0xLkqtGVilxfT2LA.gif" alt="頓丹前的那一秒是原始圖位置" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzAiIGhlaWdodD0iNDE0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>頓丹前的那一秒是原始圖位置</p><h3 id="完整app範例"><span class="me-2">完整APP範例:</span><a href="#完整app範例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/9a9aa892f9a9/1*J8oByw8gBCamIac2TkT1SA.gif" class="popup img-link blur"><img data-src="/assets/9a9aa892f9a9/1*J8oByw8gBCamIac2TkT1SA.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzAiIGhlaWdodD0iNDE0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>程式碼已上傳至Github： <a href="https://github.com/zhgchgli0718/VisionDemo" target="_blank">請點此</a></p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/9a9aa892f9a9" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2018-10-16-9a9aa892f9a9.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine-learning</a> <a href="/tags/facedetection/" class="post-tag no-text-decoration" >facedetection</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Vision%E6%A1%86%E6%9E%B6Swift%E6%95%99%E5%AD%B8%EF%BD%9CAPP%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fvision%25E6%25A1%2586%25E6%259E%25B6swift%25E6%2595%2599%25E5%25AD%25B8-app%25E8%2587%25AA%25E5%258B%2595%25E4%25BA%25BA%25E8%2587%2589%25E8%25AD%2598%25E5%2588%25A5%25E8%25A3%2581%25E5%259C%2596%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-9a9aa892f9a9%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Vision%E6%A1%86%E6%9E%B6Swift%E6%95%99%E5%AD%B8%EF%BD%9CAPP%E8%87%AA%E5%8B%95%E4%BA%BA%E8%87%89%E8%AD%98%E5%88%A5%E8%A3%81%E5%9C%96%E5%AF%A6%E4%BD%9C%E6%8C%87%E5%8D%97%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fvision%25E6%25A1%2586%25E6%259E%25B6swift%25E6%2595%2599%25E5%25AD%25B8-app%25E8%2587%25AA%25E5%258B%2595%25E4%25BA%25BA%25E8%2587%2589%25E8%25AD%2598%25E5%2588%25A5%25E8%25A3%2581%25E5%259C%2596%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-9a9aa892f9a9%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fvision%25E6%25A1%2586%25E6%259E%25B6swift%25E6%2595%2599%25E5%25AD%25B8-app%25E8%2587%25AA%25E5%258B%2595%25E4%25BA%25BA%25E8%2587%2589%25E8%25AD%2598%25E5%2588%25A5%25E8%25A3%2581%25E5%259C%2596%25E5%25AF%25A6%25E4%25BD%259C%25E6%258C%2587%25E5%258D%2597-9a9aa892f9a9%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%B3-%E4%BD%8E%E6%89%8B%E7%BA%8C%E8%B2%BB150%E5%85%83-%E5%B8%B3%E6%88%B6%E5%8D%87%E7%B4%9A%E8%88%87%E6%89%8B%E7%BA%8C%E8%B2%BB%E8%A3%9C%E5%8A%A9%E7%94%B3%E8%AB%8B%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教學 — LINE Bank 入金 Firstrade 快速到帳、手續費只要 150 元及帳戶升級/約定轉帳/手續費補助申請教學</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/japan-overseas-shopping-rakuten-consolidated-shipping-for-taiwan-buy-from-rakuten-amazon-bea62c251f1b/">Japan Overseas Shopping｜Rakuten Consolidated Shipping for Taiwan｜Buy from Rakuten & Amazon</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/%E6%97%A5%E6%9C%AC%E4%B9%90%E5%A4%A9%E9%9B%86%E8%BF%90%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E8%B4%AD%E4%B9%B0horie%E9%92%9B%E6%9D%AF%E4%B8%8Eamazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E6%B9%BE%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外购物寄送台湾教学 — 使用乐天集运购买乐天拍卖与 Amazon 商品 (Horie 钛杯)</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539705684" data-df="ll" > Oct 17, 2018 </time><h4 class="pt-0 my-2">Vision框架Swift教学｜APP自动人脸识别裁图实作指南</h4><div class="text-muted"><p>针对iOS APP开发者，解决头像裁图时人脸被截断问题，透过Vision框架自动定位人脸并精准裁切，提升用户头像呈现品质，实现人脸中心点裁图，优化APP使用体验。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-12-coreml-%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92%E6%96%87%E5%AD%97%E5%88%86%E9%A1%9E-%E8%87%AA%E8%A8%82%E6%A8%A1%E5%9E%8B%E8%A8%93%E7%B7%B4%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8-793bf2cdda0f/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539789635" data-df="ll" > Oct 17, 2018 </time><h4 class="pt-0 my-2">嚐鮮 iOS 12 CoreML — 使用機器學習自動預測文章分類，連模型也自己訓練！</h4><div class="text-muted"><p>探索CoreML 2.0，如何轉換或訓練模型及將其應用在實際產品上</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-12-coreml-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%96%87%E5%AD%97%E5%88%86%E7%B1%BB-%E8%87%AA%E8%AE%A2%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%AE%9E%E6%88%98%E6%95%99%E5%AD%A6-793bf2cdda0f/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539789635" data-df="ll" > Oct 17, 2018 </time><h4 class="pt-0 my-2">尝鲜 iOS 12 CoreML — 使用机器学习自动预测文章分类，连模型也自己训练！</h4><div class="text-muted"><p>探索CoreML 2.0，如何转换或训练模型及将其应用在实际产品上</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/zh-cn/vision%E6%A1%86%E6%9E%B6swift%E6%95%99%E5%AD%A6-app%E8%87%AA%E5%8A%A8%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E8%A3%81%E5%9B%BE%E5%AE%9E%E4%BD%9C%E6%8C%87%E5%8D%97-9a9aa892f9a9/" class="btn btn-outline-primary" aria-label="Older" ><p>Vision框架Swift教学｜APP自动人脸识别裁图实作指南</p></a> <a href="/posts/zrealm-dev/en/coreml-2-0-automate-article-classification-with-custom-trained-machine-learning-models-793bf2cdda0f/" class="btn btn-outline-primary" aria-label="Newer" ><p>CoreML 2.0｜Automate Article Classification with Custom-Trained Machine Learning Models</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
