<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析" /><meta name="author" content="ZhgChgLi<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="vertical-align: middle;"><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/> </svg>" /><meta property="og:locale" content="en" /><meta name="description" content="針對iOS App推廣，解決未安裝用戶跳轉後資料遺失問題，透過剪貼簿與Cookie共享技術，實現安裝後自動還原目標頁面，提升用戶體驗與轉換率。本文詳解Swift實作步驟與iOS版本支援策略。" /><meta property="og:description" content="針對iOS App推廣，解決未安裝用戶跳轉後資料遺失問題，透過剪貼簿與Cookie共享技術，實現安裝後自動還原目標頁面，提升用戶體驗與轉換率。本文詳解Swift實作步驟與iOS版本支援策略。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-11T22:34:57+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" /><meta property="twitter:title" content="iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" width=\"16\" height=\"16\" style=\"vertical-align: middle;\"><path fill=\"#007bff\" d=\"M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z\"/><path d=\"M250 330 l60 60 100 -140\" stroke=\"#ffffff\" stroke-width=\"40\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/> </svg>","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-13T17:32:09+08:00","datePublished":"2019-11-11T22:34:57+08:00","description":"針對iOS App推廣，解決未安裝用戶跳轉後資料遺失問題，透過剪貼簿與Cookie共享技術，實現安裝後自動還原目標頁面，提升用戶體驗與轉換率。本文詳解Swift實作步驟與iOS版本支援策略。","headline":"iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"},"url":"https://zhgchg.li/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"}</script><title>iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析</h1><p class="post-desc fw-light mb-4">針對iOS App推廣，解決未安裝用戶跳轉後資料遺失問題，透過剪貼簿與Cookie共享技術，實現安裝後自動還原目標頁面，提升用戶體驗與轉換率。本文詳解Swift實作步驟與iOS版本支援策略。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1573482897" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 11, 2019 </time> </span> <span> Updated <time data-ts="1726219929" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" class="popup img-link preview-img blur"><img data-src="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="vertical-align: middle;"><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/> </svg></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3485 words" > <em>19 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS Deferred Deep Link 延遲深度連結實作｜Swift 完整流程與技巧解析</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-info"><p><a href="/posts/en/b08ef940c196/"><strong>Click here</strong></a> to view the English version of this article, translated by OpenAI.</p></blockquote><blockquote class="prompt-tip"><p>基於 SEO 考量，本文標題與描述經 GPT 調整，原始版本請參考內文，若有不恰當的用語，敬請指正。</p></blockquote><hr /><h3 id="ios-deferred-deep-link-延遲深度連結實作swift"><span class="me-2">iOS Deferred Deep Link 延遲深度連結實作(Swift)</span><a href="#ios-deferred-deep-link-延遲深度連結實作swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>動手打造適應所有場景、不中斷的App轉跳流程</p><h3 id="20220722-更新-ios-16-upcoming-changes"><span class="me-2">[2022/07/22] 更新 iOS 16 Upcoming Changes</span><a href="#20220722-更新-ios-16-upcoming-changes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS ≥ 16 開始非使用者主動操作貼上動作，App 主動讀取剪貼簿的行為會跳出詢問視窗，使用者需要按允許，App 才能讀取到剪貼簿資訊。</p><p><a href="/assets/b08ef940c196/0*E8h6Fy0H9_5jxhjV.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/0*E8h6Fy0H9_5jxhjV.webp" alt="[UIPasteBoard’s privacy change in iOS 16](https://sarunw.com/posts/uipasteboard-privacy-change-ios16/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNjAiIGhlaWdodD0iMTkzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://sarunw.com/posts/uipasteboard-privacy-change-ios16/" target="_blank">UIPasteBoard’s privacy change in iOS 16</a></p><h3 id="20200702-更新"><span class="me-2">[2020/07/02] 更新</span><a href="#20200702-更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/ios-14-剪貼簿隱私問題-揭露-app-讀取原因與安全風險解析-8a04443024e2/">因應 iOS 14 更新，讀取剪貼簿時會提示使用者，如要實作請一併參考此篇文章。</a></ul><h4 id="無關"><span class="me-2">無關</span><a href="#無關" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>畢業當完兵到現在庸庸碌碌工作了快三年，成長已趨於平緩，開始進入舒適圈，所幸心一橫提了離職，沈澱重新出發。</p><p>在閱讀 <a href="https://www.books.com.tw/products/0010733134" target="_blank">做自己的生命設計師</a> 重新梳理自己的人生規劃時，回顧了一下工作跟人生，雖然本身技術能力沒有很好，但在寫 Medium 與大家分享能讓我進入「心流」跟獲得大量的精力；剛好前陣子有朋友在問 Deep Link 問題，藉此整理了我研究的做法，也順便補充下自己的精力！</p><h3 id="場景"><span class="me-2">場景</span><a href="#場景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>首先要先說明實際應用場景。</p><p>1.當使用者有裝 APP 時點擊網址連結(Google搜尋來源、FB貼文、Line連結…) 則直接開 APP 呈現目標畫面，若無則跳轉到 APP Store 安裝 APP； <strong>安裝完後打開APP，要能重現之前欲前往的畫面</strong> 。</p><p><a href="https://www.youtube.com/watch?v=sY6-Q7BFUOM" target="_blank"></a></p><p>2.APP 下載和開啟數據追蹤，我們想知道 APP 推廣連結有多少人確實從這個入口下載和開啟 APP 的。</p><p>3.特殊活動入口，例如透過特定網址下載後開啟能獲得獎勵。</p><h4 id="支援度"><span class="me-2">支援度：</span><a href="#支援度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>iOS ≥ 9</p><h3 id="何謂-deferred-deep-link-與-deep-link-的差別"><span class="me-2">何謂 Deferred Deep Link 與 Deep Link 的差別？</span><a href="#何謂-deferred-deep-link-與-deep-link-的差別" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="純-deep-link-本身"><span class="me-2">純 Deep Link 本身：</span><a href="#純-deep-link-本身" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/b08ef940c196/1*15arO4L94ZoEyOLtFARtsA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*15arO4L94ZoEyOLtFARtsA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTciIGhlaWdodD0iNTMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可以看到 iOS Deep Link 本身運作機制只有判斷 APP 有無安裝，有則開 APP，無則不處理．</p><h4 id="首先我們要先加上無則跳轉到-app-store提示使用者安裝-app"><span class="me-2">首先我們要先加上「無則跳轉到 APP Store」提示使用者安裝 APP：</span><a href="#首先我們要先加上無則跳轉到-app-store提示使用者安裝-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>URL Scheme</strong> 的部分是由系統控制，一般用於 APP 內呼叫鮮少公開出來；因為如果觸發點在自己無法控制的區域(如：Line連結)，則無法處理。</p><p>若觸發點在自身網頁上可以使用些小技巧處理，請參考 <a href="https://stackoverflow.com/questions/627916/check-if-url-scheme-is-supported-in-javascript" target="_blank"><strong>這裡</strong></a> ：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Redirect...<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    var appurl = 'marry://open';
    var appstore = 'https://apps.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329';

    var timeout;
    function start() {
      window.location = appurl;
      timeout = setTimeout(function(){
        if(confirm('馬上安裝結婚吧APP?')){
          document.location = appstore;
        }
      }, 1000);
    }

    window.onload = function() {
      start()
    }
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>大略邏輯是 <strong>一樣呼叫 URL Scheme，然後設個 Timeout，時間到若還在本頁沒跳轉就當沒安裝 Call 不到 Scheme，轉而導 APP Store 頁面</strong> (但體驗還是不好還是會跳網址錯誤提示，只是多了自動轉址)。</p><p><strong>Universal Link</strong> 本身就是個自己的網頁，若無跳轉，預設就是使用網頁瀏覽器呈現，這邊有網頁服務的可以選擇直接跳網頁瀏覽、沒有的就直接導 APP Store 頁面。</p><p>有網頁服務的網站可以在 <code class="language-plaintext highlighter-rouge">&lt;head&gt;&lt;/head&gt;</code> 中加入：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"apple-itunes-app"</span> <span class="na">content=</span><span class="s">"app-id=APPID, app-argument=頁面參數"</span><span class="nt">&gt;</span>
</pre></table></code></div></div><p><a href="/assets/b08ef940c196/1*nC1JytAwIwKU04EMBBvf0A.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*nC1JytAwIwKU04EMBBvf0A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDMiIGhlaWdodD0iNDk4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>使用 iPhone Safari 瀏覽網頁版上方就會出現 APP 安裝提示、使用 APP 開啟本頁的按鈕； 參數 <code class="language-plaintext highlighter-rouge">app-argument</code> 就是用來帶入頁面值，並傳遞到 APP 用的。</p><p><a href="/assets/b08ef940c196/1*B-_5tIDWQpNO8NxpXQsEcA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*B-_5tIDWQpNO8NxpXQsEcA.webp" alt="加上「無則跳轉到 APP Store」的流程圖" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjciIGhlaWdodD0iMTE0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>加上「無則跳轉到 APP Store」的流程圖</p><h4 id="完善-deep-link-app-端處理"><span class="me-2">完善 Deep Link APP 端處理：</span><a href="#完善-deep-link-app-端處理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我們要的當然不只是「當使用者有安裝 APP 則開啟 APP」，我們還要將來源資訊與 APP 串起，讓 APP 開啟後自動呈現目標頁面的 APP 畫面。</p><p><strong>URL Scheme</strong> 方式可在 AppDelegate 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool</code> 進行處理：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">sourceApplication</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">annotation</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"marry"</span><span class="p">,</span><span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">queryParameters</span> <span class="p">{</span>
      <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
        <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
      <span class="p">}</span>    
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Universal Link</strong> 則是在 AppDelegate 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool</code> 進行處理：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">URL</span> <span class="p">{</span>
    <span class="c1">/// test=1&amp;a=b&amp;c=d =&gt; ["test":"1","a":"b","c":"d"]</span>
    <span class="c1">/// 解析網址query轉換成[String: String]數組資料</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">queryParameters</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">components</span> <span class="o">=</span> <span class="kt">URLComponents</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">resolvingAgainstBaseURL</span><span class="p">:</span> <span class="kc">true</span><span class="p">),</span> <span class="k">let</span> <span class="nv">queryItems</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">queryItems</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">queryItems</span> <span class="p">{</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">parameters</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>先附上一個 URL 的擴充方法 queryParameters，用於方便將 URL Query 轉換成 Swift Dictionary。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="k">continue</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">,</span> <span class="nv">restorationHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        
  <span class="k">if</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">activityType</span> <span class="o">==</span> <span class="kt">NSUserActivityTypeBrowsingWeb</span><span class="p">,</span> <span class="n">webpageURL</span> <span class="o">=</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">webpageURL</span> <span class="p">{</span>
    <span class="c1">/// 如果是universal link url來源...</span>
    <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">webpageURL</span><span class="o">.</span><span class="n">queryParameters</span>
    
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
      <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="kc">true</span>  
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/b08ef940c196/1*zhtWK56EqWpE91yTVu64Lg.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*zhtWK56EqWpE91yTVu64Lg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDkiIGhlaWdodD0iNDI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>完成！</p><h4 id="那還缺什麼"><span class="me-2">那還缺什麼？</span><a href="#那還缺什麼" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>目前看來已經很完美了，我們處理了所有會遇到的狀況，那還缺什麼？</p><p><a href="/assets/b08ef940c196/1*ulrLKyvTKoChPScWD9wHyA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*ulrLKyvTKoChPScWD9wHyA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcyNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>如圖所示，如果是 未安裝 -&gt; APP Store 安裝 -&gt; APP Store 打開，來源所帶的資料就會中斷，APP 不知道來源所以就只會顯示首頁；使用者要再回到上一步網頁再點一次開啟，APP 才會驅動跳頁。</p><p><a href="/assets/b08ef940c196/1*dFdvCRRdM3vrN3lnyG8Diw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*dFdvCRRdM3vrN3lnyG8Diw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><em>雖然這樣也不是不行，但考慮到跳出流失率，多一個步驟就是多一層流失，還有使用者體驗起來不順暢；更何況使用者未必這麼聰明。</em></p></blockquote><h4 id="進入本文重點"><span class="me-2">進入本文重點</span><a href="#進入本文重點" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>何謂 Deferred Deep Link？，延遲深度連結；就是讓我們的 Deep Link 可以延伸到 APP Store 安裝完後依然保有來源資料。</p><p>據 Android 工程師表示 Android 本身就有此功能，但在 iOS 上並不支援此設定、要達到此功能的做法也不友善，請繼續看下去。</p><h3 id="deferred-deep-link"><span class="me-2">Deferred Deep Link</span><a href="#deferred-deep-link" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><em>如果不想花時間自己做的話可以直接使用 <a href="http://branch.io" target="_blank">branch.io</a> 或 <a href="https://firebase.google.com/docs/dynamic-links" target="_blank">Firebase Dynamic Links</a> 本文介紹的方法就是 Firebase 使用的方式。</em></p></blockquote><p><strong>要達成 Deferred Deep Link 的效果網路上有兩種做法：</strong></p><p>一種是透過使用者裝置、IP、環境…等等參數計算出一個雜湊值，在網頁端存入資料到伺服器；當 APP 安裝後打開用同樣方式計算，如果值相同則取出資料恢復（branch.io 的做法）。</p><p>另一種是本文要介紹的方法，同 Firebase 作法；使用 iPhone 剪貼簿和 Safari 與 APP Cookie 共享機制的方法，等於是把資料存在剪貼簿或Cookie，APP安裝完成後再去讀出來使用。</p><p><a href="/assets/b08ef940c196/1*VVahSlHV2N2jcIw4afzr2g.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*VVahSlHV2N2jcIw4afzr2g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzUiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>
點擊「Open」後你的剪貼簿就會被 JavaScript 自動覆蓋複製上跳轉相關資訊：https://XXX.app.goo.gl/?link=https://XXX.net/topicID=1&amp;type=topic
</pre></table></code></div></div><p>相信有套過 Firebase Dynamic Links 的人一定不陌生這個開啟跳轉頁，了解到原理之後就知道這頁在流程中是無法移除的！</p><p>另外 Firebase 也不提供進行樣式修改。</p><h4 id="支援度-1"><span class="me-2">支援度</span><a href="#支援度-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先講個坑，支援度問題；如前所說的「不友善」！</p><p><a href="/assets/b08ef940c196/1*LR3MSAcwjaoSQhwvtD2sUQ.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*LR3MSAcwjaoSQhwvtD2sUQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDIiIGhlaWdodD0iNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>如果 APP 只考慮 iOS ≥ 10 以上的話容易許多，APP 實作剪貼簿存取、Web 使用 JavaScript 將資訊覆蓋到剪貼簿，然後再跳轉到 APP Store 導下載就好。</p><p>iOS = 9 不支援JavaScript自動剪貼簿但支援 <strong>Safari 與 APP SFSafariViewController「Cookie 互通大法」</strong></p><p>另外在 APP 需要偷偷在背景加入 SFSafariViewController 載入 Web，再從 Web 取得剛才點連結時存的Cookie資訊。</p><blockquote><p><em>步驟繁瑣＆連結點擊僅限 Safari瀏覽器。</em></p></blockquote><p><a href="/assets/b08ef940c196/1*tPXHlrQE3MdrjMzFbnS_4w.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*tPXHlrQE3MdrjMzFbnS_4w.webp" alt="[SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTQiIGhlaWdodD0iNDQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller" target="_blank">SFSafariViewController</a></p><blockquote><p><em>根據官方文件，iOS 11 已無法取得使用者的 Safari Cookie，若有這方面需求可使用 SFAuthenticationSession，但此方法無法在背景偷執行，每次載入前都會跳出以下詢問視窗：</em></p></blockquote><p><a href="/assets/b08ef940c196/1*eisreftWPWn9PTCbuLQqdw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*eisreftWPWn9PTCbuLQqdw.webp" alt="_SFAuthenticationSession 詢問視窗_" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzQyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><em>SFAuthenticationSession 詢問視窗</em></p><blockquote><p><em>還有就是 APP審查是不允許將SFSafariViewController放在使用者看不到的地方的。(用程式觸發再 addSubview 不太容易被發現)</em></p></blockquote><h3 id="動手做"><span class="me-2">動手做</span><a href="#動手做" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>先講簡單的，只考慮 iOS ≥ 10 以上的用戶，單純使用 iPhone 剪貼簿轉傳資訊。</p><h4 id="web-端"><span class="me-2">Web 端：</span><a href="#web-端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>我們仿造 Firebase Dynamic Links 客製化刻了自己的頁面，使用 <code class="language-plaintext highlighter-rouge">clipboard.js</code> 這個套件讓使用者點擊「立即前往」時先將我們要帶給 APP 的資訊複製到剪貼簿 <code class="language-plaintext highlighter-rouge">（marry://topicID=1&amp;type=topic）</code> ，然後再使用 <code class="language-plaintext highlighter-rouge">location.href</code> 跳轉到 APP Store 商城頁。</p><h4 id="app-端"><span class="me-2">APP 端：</span><a href="#app-端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>在 AppDelegate 或 主頁 UIViewController 中讀取剪貼簿的值：</p><p><code class="language-plaintext highlighter-rouge">let pasteData = UIPasteboard.general.string</code></p><p>這邊建議還是將資訊使用 URL Scheme 方式包裝，方便進行辨識、資料反解：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">pasteData</span> <span class="o">=</span> <span class="kt">UIPasteboard</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">string</span><span class="p">,</span><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">pasteData</span><span class="p">),</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"marry"</span><span class="p">,</span><span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">queryParameters</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
      <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>最後在處理完動作後使用 <code class="language-plaintext highlighter-rouge">UIPasteboard.general.string = “”</code> 將剪貼簿中的資訊清除。</p><h3 id="動手做--支援-ios-9-版本"><span class="me-2">動手做 — 支援 iOS 9 版本</span><a href="#動手做--支援-ios-9-版本" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>麻煩的來了，支援 iOS 9 版，前文有說由於不支援剪貼簿，要使用 <strong>Cookie 互通大法</strong> 。</p><h4 id="web-端-1"><span class="me-2">Web 端：</span><a href="#web-端-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>web 端也算好處理，就是改成使用者點擊「立即前往」時將我們要帶給 APP 的資訊存到 Cookie <code class="language-plaintext highlighter-rouge">（marry://topicID=1&amp;type=topic）</code> ，然後再使用 <code class="language-plaintext highlighter-rouge">location.href</code> 跳轉到 APP Store 商城頁。</p><p>這裡提供兩個封裝好的 JavaScript 處理 Cookie 的方法，加速開發：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">/// name: Cookie 名稱</span>
<span class="c1">/// val: Cookie 值</span>
<span class="c1">/// day: Cookie 有效期限，預設１天</span>
<span class="c1">/// EX1: setcookie("iosDeepLinkData","marry://topicID=1&amp;type=topic")</span>
<span class="c1">/// EX2: setcookie("hey","hi",365) = 一年有效</span>
<span class="kd">function</span> <span class="nf">setcookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">exdate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="nx">day</span> <span class="o">=</span> <span class="nx">day</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">exdate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">exdate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">+</span> <span class="nx">day</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="dl">""</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;expires=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">exdate</span><span class="p">.</span><span class="nf">toGMTString</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">/// getCookie("iosDeepLinkData") =&gt; marry://topicID=1&amp;type=topic</span>
<span class="kd">function</span> <span class="nf">getCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="k">new</span> <span class="nc">RegExp</span><span class="p">(</span><span class="dl">"</span><span class="s2">(^| )</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">=([^;]*)(;|$)</span><span class="dl">"</span><span class="p">));</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="nf">decodeURI</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="app-端-1"><span class="me-2">APP 端：</span><a href="#app-端-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>本文最麻煩的地方來了。</p><p>前文有提到原理，我們要在主頁的UIViewController用程式偷偷加載一個SFSafariViewController 在背景不讓使用者察覺。</p><p><strong>再說個坑：</strong> 偷偷加載這件事，iOS ≥ 10 SFSafariViewController 的 View如果大小設定小於1、透明度小於0.05、設成 isHidden，SFSafariViewController 就 <strong>不會載入</strong> 。</p><blockquote><p>p.s iOS = 10 同時支援 Cookie 及 剪貼簿。</p></blockquote><p><a href="/assets/b08ef940c196/1*ab-6ppwHU72AsKKLYBitbw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*ab-6ppwHU72AsKKLYBitbw.webp" alt="[https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788](https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTAiIGhlaWdodD0iMjY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788" target="_blank">https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788</a></p><p>我這邊的做法是在 主頁的UIViewController 上方放一個 UIView 隨便給個高度，但底部對齊 主頁面 UIView 上方，然後拉 IBOutlet <code class="language-plaintext highlighter-rouge">（sharedCookieView）</code> 到 Class；在 viewDidLoad( ) 時 init SFSafariViewController 並將其 View 加入到 <code class="language-plaintext highlighter-rouge">sharedCookieView</code> 上，所以他實際有顯示有載入，只是跑出畫面了，使用者看不到🌝。</p><p><strong>SFSafariViewController 的 URL 該指向？</strong></p><p>同 Web 端分享頁面，我們要再刻一個 For 讀取 Cookie 的頁面，並將兩個頁面放在同個網域之下避免跨網域Cookie問題，頁面內容稍後附上。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">SharedCookieView</span><span class="p">:</span> <span class="kt">UIView</span><span class="o">!</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    
    <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"http://app.marry.com.tw/loadCookie.html"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">sharedCookieViewController</span> <span class="o">=</span> <span class="kt">SFSafariViewController</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="kt">VC</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    
    <span class="k">self</span><span class="o">.</span><span class="nf">addChildViewController</span><span class="p">(</span><span class="n">sharedCookieViewController</span><span class="p">)</span>
    <span class="k">self</span><span class="o">.</span><span class="kt">SharedCookieView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">sharedCookieViewController</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
    
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">beginAppearanceTransition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">didMove</span><span class="p">(</span><span class="nv">toParentViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">endAppearanceTransition</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">sharedCookieViewController.delegate = self</code></p><p><code class="language-plaintext highlighter-rouge">class HomeViewController: UIViewController, SFSafariViewControllerDelegate</code></p><p>需要加上這個 Delegate 才能捕獲載入完成後的 CallBack 處理。</p><p>我們可以在：</p><p><code class="language-plaintext highlighter-rouge">func safariViewController(_ controller: SFSafariViewController, didCompleteInitialLoad didLoadSuccessfully: Bool) {</code></p><p>方法中捕獲載入完成事件。</p><p>到這步，你可能會想再來就是在 <code class="language-plaintext highlighter-rouge">didCompleteInitialLoad</code> 中讀取 網頁內的 Cookie 就完成了！</p><p>在這裡我沒找到讀取 SFSafariViewController Cookie 的方法，使用網路的方法讀出來都是空的。</p><blockquote><p><em>或可能要使用 JavaScript 與頁面內容進行交互，叫 JavaScript 讀 Cookie 回傳給 UIViewController。</em></p></blockquote><h4 id="tricky-的-url-scheme-法"><span class="me-2">Tricky 的 URL Scheme 法</span><a href="#tricky-的-url-scheme-法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>既然 iOS 不知到如何取得共享的 Cookie，那我們就直接交由「讀取 Cookie 的頁面」去幫我們「讀取 Cookie」。</p><p>前文附上的 JavaScript 處理 Cookie 的方法中的 getCookie( ) 就是用在這，我們的「讀取 Cookie 的頁面」內容是個空白頁(反正使用者看不到)，但是在 JavaScript 部分要在 body onload 之後去讀取 Cookie：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Load iOS Deep Link Saved Cookie...<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;script&gt;</span>
  function checkCookie() {
    var iOSDeepLinkData = getCookie("iOSDeepLinkData");
    if (iOSDeepLinkData <span class="err">&amp;&amp;</span> iOSDeepLinkData != '') {
        setcookie("iOSDeepLinkData", "", -1);
        window.location.href = iOSDeepLinkData; /// marry://topicID=1<span class="err">&amp;</span>type=topic
    }
  }
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"checkCookie();"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>實際的原理總結就是：在 <code class="language-plaintext highlighter-rouge">HomeViewController viewDidLoad</code> 時加入 <code class="language-plaintext highlighter-rouge">SFSafariViewController</code> 偷加載 <code class="language-plaintext highlighter-rouge">loadCookie.html</code> 頁面， <code class="language-plaintext highlighter-rouge">loadCookie.html</code> 頁面讀取檢查先前存的 Cookie，若有則讀出清除，然後使用 <code class="language-plaintext highlighter-rouge">window.location.href</code> 呼叫，觸發 <code class="language-plaintext highlighter-rouge">URL Scheme</code> 機制。</p><p>所以之後對應的 CallBack 處理就會回到 <code class="language-plaintext highlighter-rouge">AppDelegate</code> 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool</code> 進行處理。</p><h3 id="完工總結"><span class="me-2">完工！總結：</span><a href="#完工總結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/b08ef940c196/1*kp26TdlJBW5sVxw4zYa9Rg.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*kp26TdlJBW5sVxw4zYa9Rg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjczIiBoZWlnaHQ9Ijg0MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>如果覺得煩瑣，可以直接使用 <a href="http://branch.io" target="_blank">branch.io</a> 或 <a href="https://firebase.google.com/docs/dynamic-links" target="_blank">Firebase Dynamic</a> 沒必要重造輪子，這邊是因為介面客製化及一些複雜需求，只好自己打造。</p><p>iOS=9 的用戶已經非常稀少，不是很必要的話可以直接忽略；使用剪貼簿的方法快又有效率，而且用剪貼簿就不用局限連結一定要用 Safari 開啟！</p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><blockquote class="prompt-info"><p>本文首次發表於 Medium ➡️ <a href="https://medium.com/p/b08ef940c196" target="_blank"><strong>前往查看</strong></a>，由 <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> 與 <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2019-11-11-b08ef940c196.md" target="_blank">Improve this page on Github.</a></p></blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 21,134 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-20 | 20,952 Views on <a href="https://medium.com/p/b08ef940c196" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/deeplink/" class="post-tag no-text-decoration" >deeplink</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/universal-links/" class="post-tag no-text-decoration" >universal-links</a> <a href="/tags/app-store/" class="post-tag no-text-decoration" >app-store</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20Deferred%20Deep%20Link%20%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C%EF%BD%9CSwift%20%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E9%2581%25B2%25E6%25B7%25B1%25E5%25BA%25A6%25E9%2580%25A3%25E7%25B5%2590%25E5%25AF%25A6%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%2588%2587%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20Deferred%20Deep%20Link%20%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C%EF%BD%9CSwift%20%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E9%2581%25B2%25E6%25B7%25B1%25E5%25BA%25A6%25E9%2580%25A3%25E7%25B5%2590%25E5%25AF%25A6%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%2588%2587%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E9%2581%25B2%25E6%25B7%25B1%25E5%25BA%25A6%25E9%2580%25A3%25E7%25B5%2590%25E5%25AF%25A6%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%2588%2587%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E9%BB%9E-%E7%BE%8E%E9%A3%9F%E8%88%87%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AD%89%E7%9C%81%E9%8C%A2%E7%A7%98%E8%A8%A3-8ace34a1a3d8/">遊記 2025 韓國釜山 8 天 7 夜自由行</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/nagoya-one-day-quick-trip-peach-aviation-flight-experience-and-travel-tips-7b8a0563c157/">Nagoya One-Day Quick Trip｜Peach Aviation Flight Experience and Travel Tips</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/universal-links-ios-%E9%96%8B%E7%99%BC%E6%94%BB%E7%95%A5-%E8%A8%AD%E5%AE%9A%E6%8A%80%E5%B7%A7%E8%88%87%E6%9C%AC%E5%9C%B0%E6%B8%AC%E8%A9%A6%E7%92%B0%E5%A2%83%E6%90%AD%E5%BB%BA-12c5026da33d/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1612411045" data-df="ll" > Feb 4, 2021 </time><h4 class="pt-0 my-2">Universal Links 新鮮事</h4><div class="text-muted"><p>iOS 13, iOS 14 Universal Links 新鮮事＆建立本地測試環境</p></div></div></a></article><article class="col"> <a href="/posts/exploring-the-long-standing-issues-of-xcode-virtual-directories-and-my-open-source-tool-solution-fd719053b376-en/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1740918091" data-df="ll" > Mar 2, 2025 </time><h4 class="pt-0 my-2">Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution</h4><div class="text-muted"><p>The occupational hazards of Apple developers using virtual directories in Xcode early on, leading to chaotic directory structures and difficulties integrating modern tools like XcodeGen and Tuist.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-robotic-process-automation/github-action-%E5%85%8D%E8%B2%BB%E9%83%A8%E7%BD%B2-zreviewtender-app-%E5%95%86%E5%9F%8E%E8%A9%95%E5%83%B9%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-0095528cf875/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1727354541" data-df="ll" > Sep 26, 2024 </time><h4 class="pt-0 my-2">Quick Start! Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人</h4><div class="text-muted"><p>簡單三步驟為您建立免費穩定安全的 App 評價機器人，即時關注使用者的最新評價。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-guide-to-seamless-app-navigation-b08ef940c196/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS Deferred Deep Link Implementation｜Swift Guide to Seamless App Navigation</p></a> <a href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS UIViewController Transitions｜Master Pull-Down Close, Pull-Up Present & Full-Page Swipe Back</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">中文</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-21 09:26:25 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
