<!doctype html><html lang="zh-tw" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="zh_tw" /><meta name="description" content="針對iOS開發者，解決無法即時辨識來電的痛點，透過Swift與Call Directory Extension離線資料庫技術，打造本地電話號碼標記功能，提升用戶接聽體驗並避免漏接重要來電。" /><meta property="og:description" content="針對iOS開發者，解決無法即時辨識來電的痛點，透過Swift與Call Directory Extension離線資料庫技術，打造本地電話號碼標記功能，提升用戶接聽體驗並避免漏接重要來電。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-04-28T00:07:27+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" /><meta property="twitter:title" content="Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://www.linkedin.com/in/zhgchgli"},"dateModified":"2024-04-13T15:40:07+08:00","datePublished":"2019-04-28T00:07:27+08:00","description":"針對iOS開發者，解決無法即時辨識來電的痛點，透過Swift與Call Directory Extension離線資料庫技術，打造本地電話號碼標記功能，提升用戶接聽體驗並避免漏接重要來電。","headline":"Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"},"url":"https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"}</script><title>Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/zh.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=false" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="https://en.zhgchg.li/posts/zrealm-dev/ios-caller-id-with-swift-build-your-own-number-recognition-tagging-ac557047d206/"><link rel="alternate" hreflang="zh-Hans" href="https://zh-hans.zhgchg.li/posts/zrealm-dev/swift-ios%E7%94%B5%E8%AF%9D%E8%BE%A8%E8%AF%86%E5%AE%9E%E4%BD%9C-call-directory-extension%E7%A6%BB%E7%BA%BF%E5%8F%B7%E7%A0%81%E6%A0%87%E8%AE%B0%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"><link rel="alternate" hreflang="zh-Hant" href="https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"><link rel="alternate" hreflang="x-default" href="https://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"如何在 iOS App 中實作離線的電話號碼來電辨識功能？","acceptedAnswer":{"@type":"Answer","text":"透過 Call Directory Extension 建立本地電話辨識資料庫，將電話號碼與名稱對應存成 JSON，並由 Extension 讀取寫入系統，實現離線即時來電標記，提升用戶接聽決策效率。"}},{"@type":"Question","name":"如何確保使用者已啟用 iOS 的通話封鎖與識別功能？","acceptedAnswer":{"@type":"Answer","text":"利用 CXCallDirectoryManager 的 getEnabledStatusForExtension 方法檢查 Extension 啟用狀態，並引導使用者手動在「設定」>「電話」>「通話封鎖與識別」中啟用，確保來電辨識功能正常運作。"}},{"@type":"Question","name":"如何維護及更新本地來電辨識資料庫以支援大量電話號碼？","acceptedAnswer":{"@type":"Answer","text":"將電話號碼與標籤以字典形式存於跨 Extension 的 App Group 目錄中的 JSON 檔，並使用 CXCallDirectoryManager.reloadExtension 主動通知 Extension 重新載入資料，確保資料庫更新與擴充不影響效能。"}},{"@type":"Question","name":"iOS 電話號碼格式在來電辨識中有何要求？","acceptedAnswer":{"@type":"Answer","text":"電話號碼需為純數字字串，台灣號碼需將前導 0 改為 886，市話分機直接接在號碼後方不加符號，如此格式可被 Call Directory Extension 正確辨識與標記。"}},{"@type":"Question","name":"為何 Call Directory Extension 不支援即時 API 查詢來電號碼？","acceptedAnswer":{"@type":"Answer","text":"Call Directory Extension 僅允許離線資料庫方式辨識電話，無法在來電時即時呼叫 API 查詢，須預先準備號碼對應資料並寫入本地，避免影響系統效能與隱私安全。"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"><div aria-label="Language switch" style="display:flex;align-items:center;justify-content:center;gap:2px"> <a href="https://zhgchg.li" style="display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;border-radius:999px;border:1px solid #dc3545;background:#dc3545;color:#fff;font-size:12px;font-weight:600;line-height:1;text-decoration:none;"> 正體中文 </a> <span style="width:1px;height:18px;background:rgba(0,0,0,.12);"></span> <a href="https://zh-hans.zhgchg.li" style="display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(220,53,69,.35);background:rgba(220,53,69,.08);color:#dc3545;font-size:12px;font-weight:600;line-height:1;text-decoration:none;"> 简体中文 </a> <span style="width:1px;height:18px;background:rgba(0,0,0,.12);"></span> <a href="https://en.zhgchg.li" style="display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(220,53,69,.35);background:rgba(220,53,69,.08);color:#dc3545;font-size:12px;font-weight:600;line-height:1;text-decoration:none;"> English </a></div><li class="nav-item"> <a href="https://medium.com/@zhgchgli" class="nav-link" target="_blank" style="background: #EDF4FF; color: #0A84FF;"> <i class="fa-brands fa-medium"></i> <span>Follow Me!<br/><strong>1,050+</strong> Followers</span> </a><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>首頁</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>分類</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>標籤</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>歸檔</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>關於我</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>聯絡我</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">首頁</a> </span> <span>Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> 文章</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜尋..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略</h1><p class="post-desc fw-light mb-4">針對iOS開發者，解決無法即時辨識來電的痛點，透過Swift與Call Directory Extension離線資料庫技術，打造本地電話號碼標記功能，提升用戶接聽體驗並避免漏接重要來電。</p><div class="post-meta text-muted"> <span> 發佈於 <time data-ts="1556381247" data-df="YYYY 年 M 月 D 日" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2019 年 04 月 28 日 </time> </span> <span> 更新於 <time data-ts="1712994007" data-df="YYYY 年 M 月 D 日" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2024 年 04 月 13 日 </time> </span><div class="mt-3 mb-3"> <a href="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> 作者 <em> <a href="https://www.linkedin.com/in/zhgchgli">ZhgChgLi</a> </em> | <em><a href="https://www.linkedin.com/in/zhgchgli" target="_blank">Senior Software Engineer</a></em><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2841 字" > <em>15 分鐘</em>閱讀</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節目錄 🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Swift iOS電話辨識實作｜Call Directory Extension離線號碼標記完整攻略</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p><a href="https://en.zhgchg.li/posts/zrealm-dev/ios-caller-id-with-swift-build-your-own-number-recognition-tagging-ac557047d206/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="https://zh-hans.zhgchg.li/posts/zrealm-dev/swift-ios%E7%94%B5%E8%AF%9D%E8%BE%A8%E8%AF%86%E5%AE%9E%E4%BD%9C-call-directory-extension%E7%A6%BB%E7%BA%BF%E5%8F%B7%E7%A0%81%E6%A0%87%E8%AE%B0%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目錄</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>自己的電話自己辨識(Swift) <a href="#自己的電話自己辨識swift">#</a></summary><ul><li><a href="#起源">起源</a></li><li><a href="#用途">用途？</a></li><li><a href="#限制">限制？</a></li><li><a href="#應用場景">應用場景？</a></li><li><a href="#直接上一張成品圖">直接上一張成品圖</a></li></ul></details></li><li><a href="#call-directory-extension-電話辨識功能運作流程">Call Directory Extension 電話辨識功能運作流程</a></li><li class="has-children"><details><summary>開工 <a href="#開工">#</a></summary><ul><li><a href="#1為-ios-專案加入-call-directory-extension">1.為 iOS 專案加入 Call Directory Extension</a></li><li><a href="#2開始編寫-call-directory-extension-相關程式">2.開始編寫 Call Directory Extension 相關程式</a></li><li><a href="#補充--電話號碼格式">補充 — 電話號碼格式</a></li><li><a href="#3開始修改-call-directory-extension-的程式">3.開始修改 Call Directory Extension 的程式</a></li><li><a href="#完工">完工！</a></li></ul></details></li><li><a href="#tips">Tips</a></li></ul></nav><hr /><h3 id="自己的電話自己辨識swift"><span class="me-2">自己的電話自己辨識(Swift)</span><a href="#自己的電話自己辨識swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS自幹 Whoscall 來電辨識、電話號碼標記 功能</p><h4 id="起源"><span class="me-2">起源</span><a href="#起源" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>一直以來都是Whoscall的忠實用戶，從原本用Android手機時就有使用，能夠非常即時的顯示陌生來電資訊，當下就能直接決定接通與否；後來轉跳蘋果陣營，第一隻蘋果手機是iPhone 6 (iOS 9)，那時在使用Whoscall上非常彆扭，無法即時辨識電話，要複製電話號碼去APP查詢，後期Whoscall提供將陌生電話資料庫安裝在本地手機的服務，雖然能解決即時辨識的問題，但很容易就弄亂你的手機通訊錄！</p><p>直到 iOS 10+ 之後蘋果開放電話辨識功能(Call Directory Extension)權限給開發者，才使whoscall目前至少就體驗來說已和Android版無太大缺別，甚至超越Android版(Android版廣告超多，但以開發者的立場是可以理解的)</p><h4 id="用途"><span class="me-2">用途？</span><a href="#用途" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://developer.apple.com/documentation/callkit/cxcalldirectoryextensioncontext" target="_blank">Call Directory Extension</a> 能做到什麼呢？</p><ol><li>電話 <strong>撥打</strong> 辨識標記<li>電話 <strong>來電</strong> 辨識標記<li><strong>通話紀錄</strong> 辨識標記<li>電話 <strong>拒接</strong> 黑名單設置</ol><h4 id="限制"><span class="me-2">限制？</span><a href="#限制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>使用者需手動進入「設定」「電話」「通話封鎖與識別」打開您的APP才能使用<li>僅能以離線資料庫方式辨識電話(無法即時取得來電資訊然後Call API查詢，僅能預先寫入號碼&lt;-&gt;名稱對應在手機資料庫中) <em>*也因此Whoscall會定期推播請使用者開APP更新來電辨識資料庫</em><li>數量上限？目前沒查到資料，應該是依照使用者手機容量無特別上限；但是數量多得辨識清單、封鎖清單要分批處理寫入！<li>軟體限制：iOS 版本需 ≥ 10</ol><p><a href="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.webp" alt="「設定」-&gt;「電話」-&gt;「通話封鎖與識別」" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iNjE3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>「設定」-&gt;「電話」-&gt;「通話封鎖與識別」</p><h4 id="應用場景"><span class="me-2">應用場景？</span><a href="#應用場景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>通訊軟體、辦公室通訊軟體；在APP內你可能有對方的聯絡人，但實際並未將手機號碼加入手機通訊錄中，這個功能就能避免同事甚至老闆來電時，被當陌生電話，結果漏接．<li>敝站( <a href="https://www.marry.com.tw" target="_blank">結婚吧</a> )或敝私的( <a href="https://www.591.com.tw/" target="_blank">591房屋交易</a> )，使用者與店家或房東聯繫時所撥打的電話都是我們的轉接號碼，經由轉接中心在轉撥到目標電話，大致流程如下：</ol><p><a href="/assets/ac557047d206/1*BXrzNfimPVPCQ0_XsY5HRg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*BXrzNfimPVPCQ0_XsY5HRg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NjEiIGhlaWdodD0iMjMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>使用者所撥打的電話都是轉接中心代表號( #分機)，不會知道真實的電話號碼；一方面是保護個資隱私、另一方面也能知道有多少人聯絡商家(評估成效)甚至能知道是在哪看到然後撥打的(EX:網頁顯示#1234,APP顯示#5678)、還有也能推免費服務，由我方吸收電話通信費用．</p><p>但此做法會帶來ㄧ項不可避免的問題，就是電話號碼凌亂；無法辨識出是打給誰或是店家回撥時，使用者不知道來電者是誰，透過使用電話辨識功能就能大大解決這個問題，提升使用者體驗！</p><h4 id="直接上一張成品圖"><span class="me-2">直接上一張成品圖：</span><a href="#直接上一張成品圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/ac557047d206/1*WEUjz38cymEtywWDvm86vg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*WEUjz38cymEtywWDvm86vg.webp" alt="[結婚吧 APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjU2IiBoZWlnaHQ9IjczNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8" target="_blank">結婚吧 APP</a></p><p>可以看到在輸入電話、電話來電時能直接顯示辨識結果、通話記錄列表也不在亂糟糟ㄧ樣能在下方顯示辨識結果．</p><h3 id="call-directory-extension-電話辨識功能運作流程"><span class="me-2">Call Directory Extension 電話辨識功能運作流程：</span><a href="#call-directory-extension-電話辨識功能運作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/ac557047d206/1*f0vCDqocPfZkoPJW7w3vBg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*f0vCDqocPfZkoPJW7w3vBg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MzUiIGhlaWdodD0iMjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h3 id="開工"><span class="me-2">開工：</span><a href="#開工" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>讓我們開始動手做吧！</p><h4 id="1為-ios-專案加入-call-directory-extension"><span class="me-2">1.為 iOS 專案加入 Call Directory Extension</span><a href="#1為-ios-專案加入-call-directory-extension" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/ac557047d206/1*k7RnXKeXW2uZPawkYQfIDg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*k7RnXKeXW2uZPawkYQfIDg.webp" alt="Xcode -&gt; File -&gt; New -&gt; Target" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTMiIGhlaWdodD0iMjY0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Xcode -&gt; File -&gt; New -&gt; Target</p><p><a href="/assets/ac557047d206/1*w5sK8DfqYOTUTPDJVYFyLg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*w5sK8DfqYOTUTPDJVYFyLg.webp" alt="選擇 Call Directory Extension" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjkiIGhlaWdodD0iNTI3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>選擇 Call Directory Extension</p><p><a href="/assets/ac557047d206/1*EqazaGGWvgLSQa0gQMYF7Q.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*EqazaGGWvgLSQa0gQMYF7Q.webp" alt="輸入Extension名稱" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjMiIGhlaWdodD0iNTIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>輸入Extension名稱</p><p><a href="/assets/ac557047d206/1*WklbrBGAppM2leAsCuuKLg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*WklbrBGAppM2leAsCuuKLg.webp" alt="可順帶加入 Scheme 方便 Debug" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTUiIGhlaWdodD0iMTc3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可順帶加入 Scheme 方便 Debug</p><p><a href="/assets/ac557047d206/1*8SfvjnXa2be6C8mdLk3Wwg.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*8SfvjnXa2be6C8mdLk3Wwg.webp" alt="目錄底下就會出現Call Directory Extension的資料夾及程式" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjQ3IiBoZWlnaHQ9IjUwNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>目錄底下就會出現Call Directory Extension的資料夾及程式</p><h4 id="2開始編寫-call-directory-extension-相關程式"><span class="me-2">2.開始編寫 Call Directory Extension 相關程式</span><a href="#2開始編寫-call-directory-extension-相關程式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先回到主 iOS 專案上</p><p><strong>第一個問題是我們該如何判斷使用者的裝置支不支援Call Directory Extension或是設定中的「通話封鎖與識別」是否已經打開：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已複製！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">CallKit</span>
<span class="c1">//</span>
<span class="c1">//......</span>
<span class="c1">//</span>
<span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">10.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">CXCallDirectoryManager</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">getEnabledStatusForExtension</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"這裡輸入call directory extension的bundle identifier"</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">enabled</span> <span class="p">{</span>
          <span class="c1">//啟用中</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">disabled</span> <span class="p">{</span>
          <span class="c1">//未啟用</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">//未知,不支援</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>前面有提到，來電辨識的運作方式是要在本地維護一個辨識資料庫；再來就是重頭戲該如何達成這個功能？</strong></p><p>很遺憾，您無法直接對Call Directory Extension進行呼叫寫入資料，所以你需要多維護一層對應結構，然後Call Directory Extension再去讀取你的結構再寫入辨識資料庫中，流程如下：</p><p><a href="/assets/ac557047d206/1*Fn8KAsdfolQ7ADigii9aHA.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*Fn8KAsdfolQ7ADigii9aHA.webp" alt="意旨我們需要多維護一個自己的資料庫文件，再讓Extenstion去讀取寫入到手機中" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3ODIiIGhlaWdodD0iMTIyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>意旨我們需要多維護一個自己的資料庫文件，再讓Extenstion去讀取寫入到手機中</p><p><strong>那所謂的辨識資料、檔案該長怎樣？</strong></p><blockquote><p>其實就是個Dictionary結構，如：[“電話”:”王大明”]</p></blockquote><blockquote><p>存在本地的檔案可用一些Local DB(但Extension那邊也要能裝能用)，這邊是直接存一個.json檔在手機裡； <strong>不建議直接存在UserDefaults，如果是測試或資料很少可以，實際應用強烈不建議！</strong></p></blockquote><p><strong>好的，開始：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已複製！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">10.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">dir</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">containerURL</span><span class="p">(</span><span class="nv">forSecurityApplicationGroupIdentifier</span><span class="p">:</span> <span class="s">"你的跨Extesion,Group Identifier名稱"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"phoneIdentity.json"</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">datas</span><span class="p">:[</span><span class="kt">String</span><span class="p">:</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"8869190001234"</span><span class="p">:</span><span class="s">"李先生"</span><span class="p">,</span><span class="s">"886912002456"</span><span class="p">:</span><span class="s">"大帥"</span><span class="p">]</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">json2</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">mutableContainers</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span><span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="n">json2</span> <span class="p">{</span>
            <span class="n">datas</span> <span class="o">=</span> <span class="n">json</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="nf">jsonToData</span><span class="p">(</span><span class="nv">jsonDic</span><span class="p">:</span> <span class="n">datas</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"phoneIdentity"</span><span class="p">)</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">data</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//寫入json檔完成</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>就只是一般的本地檔案維護，要注意的就是目錄需要在Extesion也能讀取的地方。</p><h4 id="補充--電話號碼格式"><span class="me-2">補充 — 電話號碼格式：</span><a href="#補充--電話號碼格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>台灣地區市話、手機都需去掉0以886代替：如 0255667788 -&gt; 886255667788<li>電話格式是純數字組合的字串，勿夾雜「-」、「,」、「#」…等符號<li>市話電話如有包含要辨識到 <strong>分機</strong> ，直接接在後面即可不需帶任何符號：如 0255667788,0718 -&gt; 8862556677880718<li>將一般iOS電話格式轉換成辨識資料庫可接受格式可參考以下兩個取代方法：</ol><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已複製！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">newNumber</span> <span class="o">=</span> <span class="s">"0255667788,0718"</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">"^0{1}"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">newNumber</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="nf">stringByReplacingMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">newNumber</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="n">newNumber</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="nv">withTemplate</span><span class="p">:</span> <span class="s">"886"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">newNumber</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="nf">stringByReplacingMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">newNumber</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="n">newNumber</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="nv">withTemplate</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>再來就是如流程，辨識資料已維護好；需要通知Call Directory Extension去刷新手機那邊的資料：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已複製！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">10.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">CXCallDirectoryManager</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">reloadExtension</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"tw.com.marry.MarryiOS.CallDirectory"</span><span class="p">)</span> <span class="p">{</span> <span class="n">errorOrNil</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">errorOrNil</span> <span class="k">as?</span> <span class="kt">CXErrorCodeCallDirectoryManagerError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload failed"</span><span class="p">)</span>
            
            <span class="k">switch</span> <span class="n">error</span><span class="o">.</span><span class="n">code</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is unknown"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">noExtensionFound</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is noExtensionFound"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">loadingInterrupted</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is loadingInterrupted"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">entriesOutOfOrder</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is entriesOutOfOrder"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">duplicateEntries</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error is duplicateEntries"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">maximumEntriesExceeded</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"maximumEntriesExceeded"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">extensionDisabled</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"extensionDisabled"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">currentlyLoading</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"currentlyLoading"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unexpectedIncrementalRemoval</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"unexpectedIncrementalRemoval"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">errorOrNil</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"reload succeeded"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>使用以上方法通知Extension刷新，並取得執行結果。（這時候會呼叫執行Call Directory Extension裡的beginRequest，請繼續往下看）</p><p>主 iOS 專案的程式就到這了！</p><h4 id="3開始修改-call-directory-extension-的程式"><span class="me-2">3.開始修改 Call Directory Extension 的程式</span><a href="#3開始修改-call-directory-extension-的程式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>打開Call Directory Extension 目錄，找到底下已經幫你建立好的檔案 CallDirectoryHandler.swift</p><p>能實作的方法只有 <strong>beginRequest</strong> 當要處理手機電話資料時的動作，預設範例都把我們建好了，不太需要去動：</p><ol><li><strong>addAllBlockingPhoneNumbers</strong> ：處理加入黑名單號碼(全新增)<li><strong>addOrRemoveIncrementalBlockingPhoneNumbers</strong> ：處理加入黑名單號碼(遞增方式)<li><strong>addAllIdentificationPhoneNumbers</strong> ：處理加入來電辨識號碼(全新增)<li><strong>addOrRemoveIncrementalIdentificationPhoneNumbers</strong> ：處理加入來電辨識號碼(遞增方式)</ol><p>我們只要完成以上的Function實作即可，黑名單功能跟來電辨識方式原理都ㄧ樣這邊就不多作介紹．</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已複製！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">func</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">dir</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">containerURL</span><span class="p">(</span><span class="nv">forSecurityApplicationGroupIdentifier</span><span class="p">:</span> <span class="s">"你的跨Extesion,Group Identifier名稱"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"phoneIdentity.json"</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">fileURL</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span><span class="k">let</span> <span class="nv">numbers</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">mutableContainers</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">numbers</span><span class="p">?</span><span class="o">.</span><span class="nf">sorted</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="kt">Int</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">$1</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span> <span class="p">})</span><span class="o">.</span><span class="nf">forEach</span><span class="p">({</span> <span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="kt">CXCallDirectoryPhoneNumber</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">autoreleasepool</span><span class="p">{</span>
                        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">isIncremental</span> <span class="p">{</span>
                            <span class="n">context</span><span class="o">.</span><span class="nf">removeIdentificationEntry</span><span class="p">(</span><span class="nv">withPhoneNumber</span><span class="p">:</span> <span class="n">number</span><span class="p">)</span>
                        <span class="p">}</span>
                        <span class="n">context</span><span class="o">.</span><span class="nf">addIdentificationEntry</span><span class="p">(</span><span class="nv">withNextSequentialPhoneNumber</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span> <span class="nv">label</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">addAllIdentificationPhoneNumbers</span><span class="p">(</span><span class="n">to</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve phone numbers to identify and their identification labels from data store. For optimal performance and memory usage when there are many phone numbers,</span>
    <span class="c1">// consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded.</span>
    <span class="c1">//</span>
    <span class="c1">// Numbers must be provided in numerically ascending order.</span>
    <span class="c1">//        let allPhoneNumbers: [CXCallDirectoryPhoneNumber] = [ 1_877_555_5555, 1_888_555_5555 ]</span>
    <span class="c1">//        let labels = [ "Telemarketer", "Local business" ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for (phoneNumber, label) in zip(allPhoneNumbers, labels) {</span>
    <span class="c1">//            context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label)</span>
    <span class="c1">//        }</span>
    <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">addOrRemoveIncrementalIdentificationPhoneNumbers</span><span class="p">(</span><span class="n">to</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">CXCallDirectoryExtensionContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve any changes to the set of phone numbers to identify (and their identification labels) from data store. For optimal performance and memory usage when there are many phone numbers,</span>
    <span class="c1">// consider only loading a subset of numbers at a given time and using autorelease pool(s) to release objects allocated during each batch of numbers which are loaded.</span>
    <span class="c1">//        let phoneNumbersToAdd: [CXCallDirectoryPhoneNumber] = [ 1_408_555_5678 ]</span>
    <span class="c1">//        let labelsToAdd = [ "New local business" ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for (phoneNumber, label) in zip(phoneNumbersToAdd, labelsToAdd) {</span>
    <span class="c1">//            context.addIdentificationEntry(withNextSequentialPhoneNumber: phoneNumber, label: label)</span>
    <span class="c1">//        }</span>
    <span class="c1">//</span>
    <span class="c1">//        let phoneNumbersToRemove: [CXCallDirectoryPhoneNumber] = [ 1_888_555_5555 ]</span>
    <span class="c1">//</span>
    <span class="c1">//        for phoneNumber in phoneNumbersToRemove {</span>
    <span class="c1">//            context.removeIdentificationEntry(withPhoneNumber: phoneNumber)</span>
    <span class="c1">//        }</span>
    
    <span class="c1">//context.removeIdentificationEntry(withPhoneNumber: CXCallDirectoryPhoneNumber("886277283610")!)</span>
    <span class="c1">//context.addIdentificationEntry(withNextSequentialPhoneNumber: CXCallDirectoryPhoneNumber("886277283610")!, label: "TEST")</span>
    
    <span class="nf">fetchAll</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
    <span class="c1">// Record the most-recently loaded set of identification entries in data store for the next incremental load...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>因為敝站的資料不會到太多而且我的本地資料結構相當簡易，無法做到遞增；所以這邊 <strong>統一都用全新增的方式，如是遞增方式則要先刪除舊的(這步很重要不然會reload extensiton失敗！)</strong></p><h4 id="完工"><span class="me-2">完工！</span><a href="#完工" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>到此為止就完成囉！實作方面非常簡單！</p><h3 id="tips"><span class="me-2">Tips:</span><a href="#tips" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>如果在「設定」「電話」「通話封鎖與識別」打開APP時一直轉或是打開後無法辨識號碼，可先確認號碼是否正確、本地維護的.json資料是否正確、reload extensiton是否成功；或重開機試試，都找不出來可以選call directory extension的Scheme Build 看看錯誤訊息．<li>這個功能 <strong>最困難的點不是程式方面而是要引導使用者手動去設定打開</strong> ，具體方式及引導可參考whoscall：</ol><p><a href="/assets/ac557047d206/1*L0EKptoSnE88lB8uEN7H3A.webp" class="popup img-link blur"><img data-src="/assets/ac557047d206/1*L0EKptoSnE88lB8uEN7H3A.webp" alt="[Whoscall](https://whoscall.com/zh-TW/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjgzMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://whoscall.com/zh-TW/" target="_blank">Whoscall</a></p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><script src="/assets/clipboard.min.js"></script><div style=" display:flex; align-items:center; gap:10px; border:1px solid #e5e7eb; background:#f9fafb; padding:12px 16px; border-radius:12px; margin:18px 0; box-shadow:0 3px 8px rgba(0,0,0,0.05); width: auto;"> <input id="share-url" value="https://zhgchg.lihttps://zhgchg.li/posts/zrealm-dev/swift-ios%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C-call-directory-extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206/" readonly="" style=" flex:1; border:1px solid #d1d5db; border-radius:8px; padding:10px 12px; font-size:0.9rem; background:#ffffff; color:#111827; outline:none; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; " /> <button class="btn" data-clipboard-target="#share-url" id="copy-btn" style=" border:none; background:#3b82f6; color:white; padding:10px 16px; border-radius:10px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all .15s ease; box-shadow:0 2px 5px rgba(59,130,246,0.35); " onmouseover="this.style.opacity='0.92';" onmouseout="this.style.opacity='1';"> <span style="font-size:1rem;">🔗</span> <span id="copy-btn-text">Copy link to share!</span> </button></div><script> new ClipboardJS('.btn'); var btn = document.getElementById("copy-btn"); var text = document.getElementById("copy-btn-text"); btn.addEventListener("click", function () { text.textContent = "Copied!"; btn.style.background = "#16a34a"; btn.style.boxShadow = "0 2px 6px rgba(22,163,74,0.35)"; setTimeout(() => { text.textContent = "Copy link to share!"; btn.style.background = "#3b82f6"; btn.style.boxShadow = "0 2px 5px rgba(59,130,246,0.35)"; }, 1500); });</script><hr /><p><a href="https://www.paypal.com/ncp/payment/CMALMPT8UUTY2" target="_blank" rel="noopener" style="display:block;margin:12px 0;text-align:center;align-items:center;justify-content:center;padding:10px 22px;border-radius:999px;text-decoration:none;background:linear-gradient(135deg,#ffd54f,#ffb300);color:#000;font-size:16px;font-weight:700;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;box-shadow:0 4px 10px rgba(0,0,0,.15);cursor:pointer;transition:all .15s ease;width:350px" onmouseover="this.style.background=&quot;linear-gradient(135deg,#FFE082,#FFC107)&quot;,this.style.transform=&quot;translateY(-1px)&quot;,this.style.boxShadow=&quot;0 6px 14px rgba(0,0,0,0.2)&quot;" onmouseout="this.style.background=&quot;linear-gradient(135deg,#FFD54F,#FFB300)&quot;,this.style.transform=&quot;translateY(0)&quot;,this.style.boxShadow=&quot;0 4px 10px rgba(0,0,0,0.15)&quot;">🍺 Buy me a beer on PayPal</a></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/ac557047d206" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2019-04-27-ac557047d206.md" target="_blank">Improve this page on Github.</a></p></blockquote><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1,050+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/whoscall/" class="post-tag no-text-decoration" >whoscall</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/ios-apps/" class="post-tag no-text-decoration" >ios-apps</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> 本文由作者以 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh-hant"> CC BY 4.0 </a> 授權。</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Swift%20iOS%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C%EF%BD%9CCall%20Directory%20Extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-ios%25E9%259B%25BB%25E8%25A9%25B1%25E8%25BE%25A8%25E8%25AD%2598%25E5%25AF%25A6%25E4%25BD%259C-call-directory-extension%25E9%259B%25A2%25E7%25B7%259A%25E8%2599%259F%25E7%25A2%25BC%25E6%25A8%2599%25E8%25A8%2598%25E5%25AE%258C%25E6%2595%25B4%25E6%2594%25BB%25E7%2595%25A5-ac557047d206%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Swift%20iOS%E9%9B%BB%E8%A9%B1%E8%BE%A8%E8%AD%98%E5%AF%A6%E4%BD%9C%EF%BD%9CCall%20Directory%20Extension%E9%9B%A2%E7%B7%9A%E8%99%9F%E7%A2%BC%E6%A8%99%E8%A8%98%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-ios%25E9%259B%25BB%25E8%25A9%25B1%25E8%25BE%25A8%25E8%25AD%2598%25E5%25AF%25A6%25E4%25BD%259C-call-directory-extension%25E9%259B%25A2%25E7%25B7%259A%25E8%2599%259F%25E7%25A2%25BC%25E6%25A8%2599%25E8%25A8%2598%25E5%25AE%258C%25E6%2595%25B4%25E6%2594%25BB%25E7%2595%25A5-ac557047d206%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-ios%25E9%259B%25BB%25E8%25A9%25B1%25E8%25BE%25A8%25E8%25AD%2598%25E5%25AF%25A6%25E4%25BD%259C-call-directory-extension%25E9%259B%25A2%25E7%25B7%259A%25E8%2599%259F%25E7%25A2%25BC%25E6%25A8%2599%25E8%25A8%2598%25E5%25AE%258C%25E6%2595%25B4%25E6%2594%25BB%25E7%2595%25A5-ac557047d206%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="複製連結" data-title-succeed="連結已成功複製！" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">最近更新</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/app-store-connect-api-webhook-%E4%B8%B2%E6%8E%A5-%E6%8F%90%E5%8D%87-ios-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E6%95%88%E7%8E%87%E8%88%87%E9%80%9A%E7%9F%A5%E6%B5%81%E7%A8%8B-7c0974856393/">CI/CD 使用 App Store Connect API Webhook 串接自動化工作流程</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/">CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/">使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/github-action-%E5%85%8D%E8%B2%BB%E9%83%A8%E7%BD%B2-zreviewtender-app-%E5%95%86%E5%9F%8E%E8%A9%95%E5%83%B9%E7%9B%A3%E6%8E%A7%E6%A9%9F%E5%99%A8%E4%BA%BA-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-0095528cf875/">Quick Start! Github Action x ZReviewTender 免費快速部署你的 App 商城評價監控機器人</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ios-timer-%E8%88%87-dispatchsourcetimer-%E9%81%B8%E6%93%87%E8%88%87%E5%AE%89%E5%85%A8%E5%B0%81%E8%A3%9D%E6%8A%80%E5%B7%A7-%E6%9C%89%E9%99%90%E7%8B%80%E6%85%8B%E6%A9%9F%E9%98%B2%E6%AD%A2%E9%96%83%E9%80%80-62f68ebeecd3/">iOS Timer 與 DispatchSourceTimer 如何選擇與安全的使用?</a></ul></section><section><h2 class="panel-heading">熱門標籤</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E9%96%8B%E7%AE%B1/">開箱</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/cicd/">cicd</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節目錄 🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">延伸閱讀</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/swift-%E5%8E%9F%E7%94%9F%E9%A1%9E%E5%9E%8B%E6%93%B4%E5%B1%95-%E6%89%93%E9%80%A0-namespace-%E5%AE%B9%E5%99%A8%E9%81%BF%E5%85%8D%E5%91%BD%E5%90%8D%E8%A1%9D%E7%AA%81-%E6%8F%90%E5%8D%87%E6%A8%A1%E7%B5%84%E5%8C%96%E7%B6%AD%E8%AD%B7%E6%80%A7-a8925ad9ed01/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1735740152" data-df="YYYY 年 M 月 D 日" > 2025 年 01 月 01 日 </time><h4 class="pt-0 my-2">Swift 一個優雅的原生類型擴展方式</h4><div class="text-muted"><p>自行封裝擴充方法，使其有 Namespace 的功能</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-equatable-%E5%BD%B1%E9%9F%BF%E8%A7%A3%E6%9E%90%E8%88%87%E9%96%83%E9%80%80%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4-9e43897d99fc/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1726837422" data-df="YYYY 年 M 月 D 日" > 2024 年 09 月 20 日 </time><h4 class="pt-0 my-2">iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變</h4><div class="text-muted"><p>iOS ≥ 18 開始 NSAttributedString attributes Range 合併會參考 Equatable</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-%E6%93%B4%E5%A4%A7%E6%8C%89%E9%88%95%E9%BB%9E%E6%93%8A%E7%AF%84%E5%9C%8D-swift-%E8%87%AA%E8%A8%82-uibutton-%E6%93%B4%E5%B1%95%E8%A7%B8%E6%8E%A7%E5%8D%80%E5%9F%9F%E6%8A%80%E5%B7%A7-a8c2d7ed144b/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1580564749" data-df="YYYY 年 M 月 D 日" > 2020 年 02 月 01 日 </time><h4 class="pt-0 my-2">iOS 擴大按鈕點擊範圍</h4><div class="text-muted"><p>重寫 pointInside 擴大感應區域</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/ios-tintadjustmentmode-%E5%B1%AC%E6%80%A7%E8%A9%B3%E8%A7%A3-%E8%A7%A3%E6%B1%BA-uialertcontroller-%E5%B0%8E%E8%87%B4-tintcolor-%E5%A4%B1%E6%95%88%E5%95%8F%E9%A1%8C-6012b7b4f612/" class="btn btn-outline-primary" aria-label="上一篇" ><p>iOS tintAdjustmentMode 屬性詳解｜解決 UIAlertController 導致 tintColor 失效問題</p></a> <a href="/posts/zrealm-dev/ios-devicecheck-%E5%AF%A6%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E8%88%87%E8%A9%A6%E7%94%A8-swift-%E6%95%99%E5%AD%B8%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/" class="btn btn-outline-primary" aria-label="下一篇" ><p>iOS 完美實踐一次性優惠或試用的方法 (Swift)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="除非另有註明，本網站上的所有文章皆由作者依據 創用 CC 姓名標示 4.0 國際授權條款（CC BY 4.0）授權使用。" >版權所有。</span> <br/> Last updated: 2025-12-28 23:31:46 +08:00</p><p>本站使用 <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> 主題建置於 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>。<br/> Medium 文章由 <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> 轉換而成。</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">熱門標籤</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E9%96%8B%E7%AE%B1/">開箱</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a> <a class="post-tag btn btn-outline-primary" href="/tags/cicd/">cicd</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">發現有新的內容版本。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'zh-TW';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOHdowL84CU-q5', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">找不到符合的結果。</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
