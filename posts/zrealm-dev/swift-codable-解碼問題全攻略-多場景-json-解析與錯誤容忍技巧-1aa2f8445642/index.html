<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="針對 iOS 開發中 Swift Codable 解碼常見困境，提供多場景 JSON 解析實戰範例，解決欄位多型、陣列錯誤容忍與自訂日期格式等問題，助你打造穩健高效的資料映射流程。" /><meta property="og:description" content="針對 iOS 開發中 Swift Codable 解碼常見困境，提供多場景 JSON 解析實戰範例，解決欄位多型、陣列錯誤容忍與自訂日期格式等問題，助你打造穩健高效的資料映射流程。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-14T00:33:58+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" /><meta property="twitter:title" content="Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:24:35+08:00","datePublished":"2020-06-14T00:33:58+08:00","description":"針對 iOS 開發中 Swift Codable 解碼常見困境，提供多場景 JSON 解析實戰範例，解決欄位多型、陣列錯誤容忍與自訂日期格式等問題，助你打造穩健高效的資料映射流程。","headline":"Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"},"url":"https://zhgchg.li/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"}</script><title>Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"><link rel="alternate" hreflang="zh-cn" href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧</h1><p class="post-desc fw-light mb-4">針對 iOS 開發中 Swift Codable 解碼常見困境，提供多場景 JSON 解析實戰範例，解決欄位多型、陣列錯誤容忍與自訂日期格式等問題，助你打造穩健高效的資料映射流程。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1592066038" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 14, 2020 </time> </span> <span> Updated <time data-ts="1712996675" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4825 words" > <em>26 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Swift Codable 解碼問題全攻略｜多場景 JSON 解析與錯誤容忍技巧</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><hr /><h3 id="現實使用-codable-上遇到的-decode-問題場景總匯上"><span class="me-2">現實使用 Codable 上遇到的 Decode 問題場景總匯(上)</span><a href="#現實使用-codable-上遇到的-decode-問題場景總匯上" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>從基礎到進階，深入使用 Decodable 滿足所有可能會遇到的問題場景</p><p><a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" alt="Photo by [Gustas Brazaitis](https://unsplash.com/@gustasbrazaitis){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjYyNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@gustasbrazaitis" target="_blank">Gustas Brazaitis</a></p><h3 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>因應後端 API 升級需要調整 API 處理架構，近期趁這個機會一併將原本使用 Objective-C 撰寫的網路處理架構更新成 Swift；因語言不同，也不在適合使用原本的 <a href="https://github.com/RestKit/RestKit" target="_blank">Restkit</a> 幫我們處理網路層應用，但不得不說 Restkit 的功能包山包海非常強大，在專案中也用得活靈活現，基本沒有太大的問題；但相對的非常笨重、幾乎已不再維護、純 Objective-C；未來勢必也要更換的。</p><p>Restkit 幾乎幫我們處理完所有網路請求相關會需要到的功能，從基本的網路處理、API 呼叫、網路處理，到 Response 處理 JSON String to Object 甚至是 Object 存入 Core Data 它都能一起處理實打實的一個 Framework 打十個。</p><p>隨著時代的演進，目前的 Framework 已不在主打一個包全部，更多的是靈活、輕巧、組合，增加更多彈性創造更多變化；因此再替換成 Swift 語言的同時，我們選擇使用 Moya 作為網路處理部分的套件，其他我們需要的功能再選擇其他方式進行組合。</p><h3 id="正題"><span class="me-2">正題</span><a href="#正題" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>關於 JSON String to Object Mapping 部分，我們使用 Swift 自帶的 Codable (Decodable) 協議 &amp; JSONDecoder 進行處理；並拆分 Entity/Model 加強權責區分、操作及閱讀性、另外 Code Base 混 Objective-C 和 Swift 也要考量進去。</p><blockquote><p><em>＊ Encodable 的部份省略、範例均只展示實作 Decodable，大同小異，可以 Decode 基本也能 Encode。</em></p></blockquote><h3 id="開始"><span class="me-2">開始</span><a href="#開始" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>假設我們初始的 API Response JSON String 如下:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"是告五人，不是五告人!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"披星戴月的想你"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>由上範例我們可以拆成：User/Song/Comment 三個 Entity &amp; Model，讓我們組合能複用，為方便展示先將 Entity/Model 寫在同個檔案。</p><p>User:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">UserModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">UserEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
      <span class="k">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">email</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Song:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Comment:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongEntity</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">CommentModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">CommentEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">comment</span>
      <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="kt">SongModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
      <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="kt">UserModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongModel</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserModel</span>
<span class="p">}</span>
</pre></table></code></div></div><p>JSONDecoder:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 123456, </span><span class="se">\"</span><span class="s">comment</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">是告五人，不是五告人!</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">target_object</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">披星戴月的想你</span><span class="se">\"</span><span class="s"> }, </span><span class="se">\"</span><span class="s">commenter</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">user</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 1, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">email</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli@gmail.com</span><span class="se">\"</span><span class="s"> } }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="codingkeys-enum"><span class="me-2">CodingKeys Enum?</span><a href="#codingkeys-enum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>當我們的 JSON String Key Name 與 Entity Object Property Name 不相匹配時可以在內部加一個 CodingKeys 枚舉進行對應，畢竟後端資料源的 Naming Convention 不是我們可以控制的。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="o">=</span> <span class="s">"後端欄位名稱"</span>
<span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="c1">//不指定則預設使用 PropertyKeyName 為後端欄位名稱</span>
</pre></table></code></div></div><p>一旦加入 CodingKeys 枚舉，則必須列舉出所有非 Optional 的欄位，不能只列舉想要客製的 Key。</p><p>另外一種方式是設定 JSONDecoder 的 keyDecodingStrategy，若 Response 資料欄位與 Property Name 僅為 <code class="language-plaintext highlighter-rouge">snake_case</code> &lt;-&gt; <code class="language-plaintext highlighter-rouge">camelCase</code> 區別，可直接設定 <code class="language-plaintext highlighter-rouge">.keyDecodingStrategy</code> = <code class="language-plaintext highlighter-rouge">.convertFromSnakeCase</code> 就能自動匹配 Mapping。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">jsonDecoder</span><span class="o">.</span><span class="n">keyDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">convertFromSnakeCase</span>
<span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="回傳資料是陣列時"><span class="me-2">回傳資料是陣列時：</span><a href="#回傳資料是陣列時" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">songs</span><span class="p">:[</span><span class="kt">SongEntity</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="為-string-加上約束"><span class="me-2">為 String 加上約束：</span><a href="#為-string-加上約束" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">SongType</span>
  
  <span class="kd">enum</span> <span class="kt">SongType</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">rock</span>
    <span class="k">case</span> <span class="n">pop</span>
    <span class="k">case</span> <span class="n">country</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>適用於有限範圍的字串類型，寫成 Enum 方便我們傳遞、使用；若出現為列舉的值會 Decode 失敗！</p><h4 id="善用泛型包裹固定結構"><span class="me-2">善用泛型包裹固定結構：</span><a href="#善用泛型包裹固定結構" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>假設多筆回傳的 JSON String 固定格式為：</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>即可用泛型方式包裹起來：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">PageEntity</span><span class="o">&lt;</span><span class="kt">E</span><span class="p">:</span> <span class="kt">Decodable</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">offset</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">limit</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">E</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>使用： <code class="language-plaintext highlighter-rouge">PageEntity&lt;Song&gt;.self</code></p><h4 id="datetimestamp-自動-decode"><span class="me-2">Date/Timestamp 自動 Decode：</span><a href="#datetimestamp-自動-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>設定 <code class="language-plaintext highlighter-rouge">JSONDecoder</code> 的 <code class="language-plaintext highlighter-rouge">dateDecodingStrategy</code></p><ul><li><code class="language-plaintext highlighter-rouge">.secondsSince1970/.millisecondsSince1970</code> : unix timestamp<li><code class="language-plaintext highlighter-rouge">.deferredToDate</code> : 蘋果的 timestamp，罕用，不同於 unix timestamp，這是從 2001/01/01 起算<li><code class="language-plaintext highlighter-rouge">.iso8601</code> : ISO 8601 日期格式<li><code class="language-plaintext highlighter-rouge">.formatted(DateFormatter)</code> : 依照傳入的 DateFormatter Decode Date<li><code class="language-plaintext highlighter-rouge">.custom</code> : 自訂 Date Decode 邏輯</ul><p><strong>.cutstom 範例：假設 API 會回傳 YYYY/MM/DD 和 ISO 8601 兩種格式，兩中都要能 Decode：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">dateFormatter</span> <span class="o">=</span> <span class="kt">DateFormatter</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">iso8601DateFormatter</span> <span class="o">=</span> <span class="kt">ISO8601DateFormatter</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">decoder</span><span class="o">.</span><span class="n">dateDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="nf">custom</span><span class="p">({</span> <span class="p">(</span><span class="n">decoder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Date</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">dateString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    
    <span class="c1">//ISO8601:</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">iso8601DateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="c1">//YYYY-MM-DD:</span>
    <span class="n">dateFormatter</span><span class="o">.</span><span class="n">dateFormat</span> <span class="o">=</span> <span class="s">"yyyy-MM-dd"</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="k">throw</span> <span class="kt">DecodingError</span><span class="o">.</span><span class="nf">dataCorruptedError</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="s">"Cannot decode date string </span><span class="se">\(</span><span class="n">dateString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p><em>＊DateFormatter 在 init 時非常消耗性能，盡可能重複使用。</em></p></blockquote><h4 id="基本-decode-常識"><span class="me-2">基本 Decode 常識：</span><a href="#基本-decode-常識" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Decodable Protocol 內的的欄位類型(struct/class/enum)，都須實作 Decodable Protocol；亦或是在 init decoder 時賦予值<li>欄位類型不相符時會 Decode 失敗<li>Decodable Object 中欄位設為 Optional 的話則為可有可無，有給就 Decode<li>Optional 欄位可接受: JSON String 無欄位、有給但給 nil<li>空白、0 不等於 nil，nil 是 nil；弱型別的後端 API 需注意！<li>預設 Decodable Object 中有列舉且非 Optional 的欄位，若 JSON String 沒給會 Decode 失敗（後續會說明如何處理）<li>預設 遇到 Decode 失敗會直接中斷跳出，無法單純跳過有誤的資料（後續會說明如何處理）</ol><p><a href="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.webp" alt="[左：”” 右：nil](https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY3MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/" target="_blank">左：”” / 右：nil</a></p><h3 id="進階使用"><span class="me-2">進階使用</span><a href="#進階使用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>到此為止基本的使用已經完成了，但現實世界不會那麼簡單；以下列舉幾個進階會遇到的場景並提出適用 Codable 的解決方案，從這邊開始我們就無法靠原始的 Decode 幫我們補 Mapping 了，要自行實作 <code class="language-plaintext highlighter-rouge">init(from decoder: Decoder)</code> 客製 Decode 操作。</p><blockquote><p><em>＊這邊暫時先只展示 Entity 的部分，Model 還用不到。</em></p></blockquote><h4 id="initfrom-decoder-decoder"><span class="me-2">init(from decoder: Decoder)</span><a href="#initfrom-decoder-decoder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>init decoder，必須賦予所有非 Optional 的欄位初始值（就是 init 啦！）。</p><p>自訂 Decode 操作時，我們需要從 <code class="language-plaintext highlighter-rouge">decoder</code> 中取得 <code class="language-plaintext highlighter-rouge">container</code> 出來操作取值， <code class="language-plaintext highlighter-rouge">container</code> 有三種取得內容的類型。</p><p><a href="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODEiIGhlaWdodD0iMjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>第一種 container(keyedBy: CodingKeys.self)</strong> <strong>依照 CodingKeys 操作：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">name</span>
    <span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1">//參數 1 接受支援：實作 Decodable 的類別</span>
        <span class="c1">//參數 2 CodingKeys</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>第二種 singleValueContainer</strong> <strong>將整包取出操作（單值）：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">HandsomeLevel</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">handsome</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">normal</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"zhgchgli"</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">handsome</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">normal</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">HandsomeLevel</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">email</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>適用於 Associated Value Enum 欄位類型，例如 name 還自帶帥氣程度！</p><p><strong>第三種 unkeyedContainer</strong> <strong>將整包視為一包陣列：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">unkeyedContainer</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="c1">//unkeyedContainer 內部指針會自動在 decode 操作後指向下一個對象</span>
            <span class="c1">//直到指向結尾即代表遍歷結束</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"[</span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s">,1234,5566]"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ListEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>適用不固定類型的陣列欄位。</p><h4 id="container-之下我們還能使用-nestedcontainer--nestedunkeyedcontainer-對特定欄位操作"><span class="me-2">Container 之下我們還能使用 nestedContainer / nestedUnkeyedContainer 對特定欄位操作：</span><a href="#container-之下我們還能使用-nestedcontainer--nestedunkeyedcontainer-對特定欄位操作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>＊將資料欄位扁平化（類似 flatMap）</em></strong></p></blockquote><p><a href="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTExIiBoZWlnaHQ9IjI0MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">items</span>
        <span class="k">case</span> <span class="n">date</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">target</span>
    <span class="p">}</span>
    
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="k">var</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">Decodable</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">nestedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">type</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type</span> <span class="o">==</span> <span class="s">"song"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>存取、Decode 不同階層的物件，範例展示 target/items 使用 nestedContainer flat 出 type 再依照 type 去做對應的 decode。</p><h4 id="decode--decodeifpresent"><span class="me-2">Decode &amp; DecodeIfPresent</span><a href="#decode--decodeifpresent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>DecodeIfPresent：</strong> Response 有給資料欄位時才會進行 Decode（Codable Property 設 Optional 時）<li><strong>Decode：進行</strong> Decode 操作，若 Response 無給資料欄位會拋出 Error</ul><blockquote><p><strong><em>＊以上只是簡單介紹一下 init decoder、container 有哪些方法、功能，看不懂也沒關係，我們直接進入現實場景；在範例中感受組合起來的操作方式。</em></strong></p></blockquote><h3 id="現實場景"><span class="me-2">現實場景</span><a href="#現實場景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>回到原本的範例 JSON String。</p><h4 id="場景1-假設今天對誰留言可能是對歌曲或對人留言-targetobject-欄位可能的對象是-user-或-song--那該如何處理"><span class="me-2">場景1. 假設今天對誰留言可能是對歌曲或對人留言， <code class="language-plaintext highlighter-rouge">targetObject</code> 欄位可能的對象是 <code class="language-plaintext highlighter-rouge">User</code> 或 <code class="language-plaintext highlighter-rouge">Song</code> ? 那該如何處理?</span><a href="#場景1-假設今天對誰留言可能是對歌曲或對人留言-targetobject-欄位可能的對象是-user-或-song--那該如何處理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"是告五人，不是五告人!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"披星戴月的想你"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"66666!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h4 id="方式-a"><span class="me-2">方式 a.</span><a href="#方式-a" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>使用 Enum 做為容器 Decode。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">TargetObject</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="kd">enum</span> <span class="kt">TargetObject</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">song</span><span class="p">(</span><span class="kt">SongEntity</span><span class="p">)</span>
        <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="kt">UserEntity</span><span class="p">)</span>
        
        <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">type</span>
        <span class="p">}</span>
        
        <span class="kd">enum</span> <span class="kt">TargetObjectType</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">song</span>
            <span class="k">case</span> <span class="n">user</span>
        <span class="p">}</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">singleValueContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">TargetObjectType</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
            
            <span class="k">switch</span> <span class="n">targetObjectType</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">song</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">user</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>我們將 <code class="language-plaintext highlighter-rouge">targetObject</code> 的屬性換成 Associated Value Enum，在 Decode 時才決定 Enum 內要放什麼內容。</p><p>核心實踐是建立一個符合 Decodable 的 Enum 做為容器，decode 時先取關鍵欄位出來判斷(範例 JSON String 中的 <code class="language-plaintext highlighter-rouge">type</code> 欄位)，若為 <code class="language-plaintext highlighter-rouge">Song</code> 則使用 singleValueContainer 將整包解成 <code class="language-plaintext highlighter-rouge">SongEntity</code> ，若為 <code class="language-plaintext highlighter-rouge">User</code> 亦然。</p><p><strong>要使用時再從 Enum 中取出：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//if case let</span>
<span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//switch case let</span>
<span class="k">switch</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="k">let</span> <span class="nv">song</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="方式-b"><span class="me-2">方式 b.</span><a href="#方式-b" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>改宣告欄位屬性為 Base Class。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">Decodable</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
        
        <span class="c1">//</span>
        <span class="k">let</span> <span class="nv">targetObjectContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">targetObjectContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">targetObjectType</span> <span class="o">==</span> <span class="s">"user"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>原理差不多，但這邊先使用 <code class="language-plaintext highlighter-rouge">nestedContainer</code> 衝進去 <code class="language-plaintext highlighter-rouge">targetObject</code> 拿 <code class="language-plaintext highlighter-rouge">type</code> 出來判斷，再決定 <code class="language-plaintext highlighter-rouge">targetObject</code> 要解析成什麼類型。</p><p><strong>要使用時再 Cast ：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">Song</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">User</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="場景2-假設資料陣列欄位放多種類型的資料該如何-decode"><span class="me-2">場景2. 假設資料陣列欄位放多種類型的資料該如何 Decode?</span><a href="#場景2-假設資料陣列欄位放多種類型的資料該如何-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>{
  "results": [
    {
      "type": "song",
      "id": 99,
      "name": "披星戴月的想你"
    },
    {
      "type": "user",
      "id": 1,
      "name": "zhgchgli",
      "email": "zhgchgli@gmail.com"
    }
  ]
}
</pre></table></code></div></div><p>結合上述提到的 <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> +場景1. 的解決方案即可；這邊也能改用 <strong>場景1.</strong> 的 <strong>a.解決方案</strong> ，用 Associated Value Enum 存取值。</p><h4 id="場景3-json-string-欄位有給值時才-decode"><span class="me-2">場景3. JSON String 欄位有給值時才 Decode</span><a href="#場景3-json-string-欄位有給值時才-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[
  {
    "type": "song",
    "id": 99,
    "name": "披星戴月的想你"
  },
    {
    "type": "song",
    "id": 11
  }
]
</pre></table></code></div></div><p>使用 decodeIfPresent 進行 decode。</p><h4 id="場景4-陣列資料略過-decode-失敗錯誤的資料"><span class="me-2">場景4. 陣列資料略過 Decode 失敗錯誤的資料</span><a href="#場景4-陣列資料略過-decode-失敗錯誤的資料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"披星戴月的想你"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"errro"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"帶我去找夜生活"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>如前述，Decodable 預設是所有資料剖析都正確才能 Mapping 輸出；有時會遇到後端給的資料不穩定，給一長串 Array 但就有幾筆資料缺了欄位或欄位類型不符導致 Decode 失敗；造成整包全部失敗，直接 nil。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ResultsEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">results</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">SongEntity</span><span class="p">]</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">nestedUnkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">results</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">EmptyEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">EmptyEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">results</span><span class="se">\"</span><span class="s">: [ { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">披星戴月的想你</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">error</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">errro</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 19, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">帶我去找夜生活</span><span class="se">\"</span><span class="s"> } ] }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ResultsEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>解決方式也類似 <strong>場景2.的解決方案</strong> ； <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> 遍歷每個內容，並進行 try? Decode，如果 Decode 失敗則使用 Empty Decode 讓 <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> 的內部指針繼續執行。</p><blockquote><p><em>＊此方法有點 workaround，因我們無法對 <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> 命令跳過，且 <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> 必須有成功 decode 才會繼續執行；所以才這樣做，看 swift 社群有人提增加 <a href="https://forums.swift.org/t/pitch-unkeyeddecodingcontainer-movenext-to-skip-items-in-deserialization/22151/16" target="_blank">moveNext( )</a> ，但目前版本尚未實作。</em></p></blockquote><h4 id="場景5-有的欄位是我程式內部要使用的而非要-decode"><span class="me-2">場景5. 有的欄位是我程式內部要使用的，而非要 Decode</span><a href="#場景5-有的欄位是我程式內部要使用的而非要-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="方式a-entitymodel"><span class="me-2">方式a. Entity/Model</span><a href="#方式a-entitymodel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>這邊就要提一開始說的，我們拆分 Entity/Model 的功用了；Entity 單純負責 JSON String to Entity(Decodable) Mapping；Model initWith Entity，實際程式傳遞、操作、商業邏輯都是使用 Model。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">type</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="k">var</span> <span class="nv">isSave</span><span class="p">:</span><span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">//business logic</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>拆分 Entity/Model 的好處：</strong></p><ol><li>權責分明，Entity: JSON String to Decodable, Model: business logic<li>一目瞭然 mapping 了哪些欄位看 Entity 就知道<li>避免欄位一多全喇在一起<li><strong>Objective-C 也可用</strong> （因 Model 只是 NSObject、struct/Decodable Objective-C 不可見）<li>內部要使用的商業邏輯、欄位放在 Model 即可</ol><h4 id="方式b-init-處理"><span class="me-2">方式b. init 處理</span><a href="#方式b-init-處理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>列出 CodingKeys 並排除內部使用的欄位，init 時給預設值或欄位有給預設值或設為 Optional，但都不是好方法，只是可以 run 而已。</p><h4 id="20200626-更新--下篇-場景6api-response-使用-01-代表-bool該如何-decode"><span class="me-2">[2020/06/26 更新] — 下篇 場景6.API Response 使用 0/1 代表 Bool，該如何 Decode?</span><a href="#20200626-更新--下篇-場景6api-response-使用-01-代表-bool該如何-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/">現實使用 Codable 上遇到的 Decode 問題場景總匯(下)</a></ul><h4 id="20200626-更新--下篇-場景7不想要每每都要重寫-init-decoder"><span class="me-2">[2020/06/26 更新] — 下篇 場景7.不想要每每都要重寫 init decoder</span><a href="#20200626-更新--下篇-場景7不想要每每都要重寫-init-decoder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/">現實使用 Codable 上遇到的 Decode 問題場景總匯(下)</a></ul><h4 id="20200626-更新--下篇-場景8合理的處理-response-null-欄位資料"><span class="me-2">[2020/06/26 更新] — 下篇 場景8.合理的處理 Response Null 欄位資料</span><a href="#20200626-更新--下篇-場景8合理的處理-response-null-欄位資料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/">現實使用 Codable 上遇到的 Decode 問題場景總匯(下)</a></ul><h3 id="綜合場景範例"><span class="me-2">綜合場景範例</span><a href="#綜合場景範例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>綜合以上基本使用及進階使用的完整範例：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>{
  "count": 5,
  "offset": 0,
  "limit": 10,
  "results": [
    {
      "id": 123456,
      "comment": "是告五人，不是五告人!",
      "target_object": {
        "type": "song",
        "id": 99,
        "name": "披星戴月的想你",
        "create_date": "2020-06-13T15:21:42+0800"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      }
    },
    {
      "error": "not found"
    },
    {
      "error": "not found"
    },
    {
      "id": 2,
      "comment": "哈哈，我也是!",
      "target_object": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "路人甲",
        "email": "man@gmail.com",
        "birthday": "2000/01/12"
      }
    }
  ]
}
</pre></table></code></div></div><p><strong>Output:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>zhgchgli:是告五人，不是五告人!
</pre></table></code></div></div><p>完整範例演示如上！</p><h3 id="下篇其他場景已更新"><span class="me-2">(下)篇＆其他場景已更新：</span><a href="#下篇其他場景已更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/">現實使用 Codable 上遇到的 Decode 問題場景總匯(下)</a></ul><h3 id="總結"><span class="me-2">總結</span><a href="#總結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>選擇使用 Codable 的好處，第一當然是因為原生，不用怕後續無人維護、還有寫起來漂亮；但相對的限制較嚴格、比較不能靈活解 JSON String，不然就是要如本文做更多的事去完成、還有效能其實不比使用其他 Mapping 套件優（Decodable 依然使用Objective 時代的 NSJSONSerialization 進行解析），但我想在後續的更新中或許蘋果會對此進行優化，那時我們也不必更動程式。</p><p>文中場景、範例或許有些很極端，但有時候遇到了也沒辦法；當然希望一般情況下單純的 Codable 就能滿足我們的需求；但有了以上招式之後應該沒有打不倒的問題了！</p><blockquote><p><em>感謝 <a href="https://twitter.com/saiday" target="_blank">＠saiday</a> 大大技術支援。</em></p></blockquote><p><a href="https://www.youtube.com/watch?v=W9Fq1HC_5hg" target="_blank"></a></p><h3 id="延伸閱讀"><span class="me-2">延伸閱讀</span><a href="#延伸閱讀" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><a href="https://kemchenj.github.io/2018-06-03/" target="_blank">深入 Decodable — — 写一个超越原生的 JSON 解析器</a> 滿滿的內容，深入了解 Decoder/JSONDecoder。<li><a href="https://onevcat.com/2018/03/swift-meta/" target="_blank">不同角度看问题 — 从 Codable 到 Swift 元编程</a><li><a href="https://medium.com/better-programming/why-model-objects-shouldnt-implement-swift-s-decodable-or-encodable-protocols-1249cb44d4b3" target="_blank">Why Model Objects Shouldn’t Implement Swift’s Decodable or Encodable Protocols</a></ol><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/1aa2f8445642" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2020-06-13-1aa2f8445642.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/codable/" class="post-tag no-text-decoration" >codable</a> <a href="/tags/json/" class="post-tag no-text-decoration" >json</a> <a href="/tags/decode/" class="post-tag no-text-decoration" >decode</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Swift%20Codable%20%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5%EF%BD%9C%E5%A4%9A%E5%A0%B4%E6%99%AF%20JSON%20%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-codable-%25E8%25A7%25A3%25E7%25A2%25BC%25E5%2595%258F%25E9%25A1%258C%25E5%2585%25A8%25E6%2594%25BB%25E7%2595%25A5-%25E5%25A4%259A%25E5%25A0%25B4%25E6%2599%25AF-json-%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E9%258C%25AF%25E8%25AA%25A4%25E5%25AE%25B9%25E5%25BF%258D%25E6%258A%2580%25E5%25B7%25A7-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Swift%20Codable%20%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5%EF%BD%9C%E5%A4%9A%E5%A0%B4%E6%99%AF%20JSON%20%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-codable-%25E8%25A7%25A3%25E7%25A2%25BC%25E5%2595%258F%25E9%25A1%258C%25E5%2585%25A8%25E6%2594%25BB%25E7%2595%25A5-%25E5%25A4%259A%25E5%25A0%25B4%25E6%2599%25AF-json-%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E9%258C%25AF%25E8%25AA%25A4%25E5%25AE%25B9%25E5%25BF%258D%25E6%258A%2580%25E5%25B7%25A7-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fswift-codable-%25E8%25A7%25A3%25E7%25A2%25BC%25E5%2595%258F%25E9%25A1%258C%25E5%2585%25A8%25E6%2594%25BB%25E7%2595%25A5-%25E5%25A4%259A%25E5%25A0%25B4%25E6%2599%25AF-json-%25E8%25A7%25A3%25E6%259E%2590%25E8%2588%2587%25E9%258C%25AF%25E8%25AA%25A4%25E5%25AE%25B9%25E5%25BF%258D%25E6%258A%2580%25E5%25B7%25A7-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E7%82%B9-%E7%BE%8E%E9%A3%9F%E4%B8%8E%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AF%81%E7%9C%81%E9%92%B1%E7%A7%98%E8%AF%80-8ace34a1a3d8/">游记 2025 韩国釜山 8 天 7 夜自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1592066038" data-df="ll" > Jun 14, 2020 </time><h4 class="pt-0 my-2">Swift Codable 解码问题全攻略｜多场景 JSON 解析与错误容忍技巧</h4><div class="text-muted"><p>针对 iOS 开发中 Swift Codable 解码常见困境，提供多场景 JSON 解析实战范例，解决栏位多型、阵列错误容忍与自订日期格式等问题，助你打造稳健高效的资料映射流程。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1592066038" data-df="ll" > Jun 14, 2020 </time><h4 class="pt-0 my-2">Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges</h4><div class="text-muted"><p>iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1593107791" data-df="ll" > Jun 26, 2020 </time><h4 class="pt-0 my-2">現實使用 Codable 上遇到的 Decode 問題場景總匯(下)</h4><div class="text-muted"><p>合理的處理 Response Null 欄位資料、不一定都要重寫 init decoder</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" class="btn btn-outline-primary" aria-label="Older" ><p>Swift Codable 解码问题全攻略｜多场景 JSON 解析与错误容忍技巧</p></a> <a href="/posts/zrealm-life/en/google-site-personal-website-modern-setup-and-experience-guide-724a7fb9a364/" class="btn btn-outline-primary" aria-label="Newer" ><p>Google Site Personal Website｜Modern Setup and Experience Guide</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">中文</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
