<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="針對 iOS WKWebView 使用者面臨載入緩慢問題，深入解析 HTTP Cache 與預載技術，結合純資源預載與 CachePolicy 設定，實現流量與效能平衡，加速頁面響應並提升使用體驗。" /><meta property="og:description" content="針對 iOS WKWebView 使用者面臨載入緩慢問題，深入解析 HTTP Cache 與預載技術，結合純資源預載與 CachePolicy 設定，實現流量與效能平衡，加速頁面響應並提升使用體驗。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-28T17:53:05+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" /><meta property="twitter:title" content="iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-08-10T17:11:41+08:00","datePublished":"2024-07-28T17:53:05+08:00","description":"針對 iOS WKWebView 使用者面臨載入緩慢問題，深入解析 HTTP Cache 與預載技術，結合純資源預載與 CachePolicy 設定，實現流量與效能平衡，加速頁面響應並提升使用體驗。","headline":"iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"},"url":"https://zhgchg.li/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"}</script><title>iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"如何利用 iOS WKWebView 內建的 HTTP Cache 機制提升頁面載入速度？","acceptedAnswer":{"@type":"Answer","text":"iOS WKWebView 會自動依照 HTTP Cache Header 緩存資源，開發者只需設定 URLRequest 的 cachePolicy 為 reloadRevalidatingCacheData，系統便會自動判斷資源是否過期並使用快取，從而有效提升第二次及後續頁面載入速度。"}},{"@type":"Question","name":"WKWebView 預載整個頁面是否可行？","acceptedAnswer":{"@type":"Answer","text":"雖然透過先行載入整個頁面可在理論上讓後續載入更快，但實務中會造成過大網路流量與性能負擔，且使用者可能根本沒瀏覽該頁面，因此不建議使用此方法。"}},{"@type":"Question","name":"如何在 WKWebView 中有效預載並緩存頁面資源？","acceptedAnswer":{"@type":"Answer","text":"可透過 HTML 的<link rel='preload'> 預載頁面關鍵資源（如 .js、.css、字型、圖片），並搭配完善的 HTTP Cache 設定，讓 WKWebView 預先緩存這些跨頁面共用資源，達成平衡的預載效果，提升首屏載入速度。"}},{"@type":"Question","name":"為什麼 WKWebView 無法使用 URLProtocol 攔截並緩存網路請求？","acceptedAnswer":{"@type":"Answer","text":"WKWebView 運作於 App 主執行緒外的獨立執行緒，系統不會透過 App 的 URL Loading System 處理請求，因此 URLProtocol 無法攔截 WKWebView 的 http/https 請求，無法用此方式實現預載緩存。"}},{"@type":"Question","name":"WKURLSchemeHandler 是否適合用來實現 WKWebView 的資源預載與緩存？","acceptedAnswer":{"@type":"Answer","text":"WKURLSchemeHandler 僅能攔截自訂非 http/https 的 URL Scheme，且需修改頁面資源路徑並處理 CORS 問題，實作複雜且維護成本高，整體效益有限，不建議用於一般 WKWebView 預載緩存。"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析</h1><p class="post-desc fw-light mb-4">針對 iOS WKWebView 使用者面臨載入緩慢問題，深入解析 HTTP Cache 與預載技術，結合純資源預載與 CachePolicy 設定，實現流量與效能平衡，加速頁面響應並提升使用體驗。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1722160385" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 28, 2024 </time> </span> <span> Updated <time data-ts="1723281101" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 10, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" class="popup img-link preview-img blur"><img data-src="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4762 words" > <em>26 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS WKWebView 預載與 Cache 緩存技術｜提升頁面載入速度與資源管理全解析</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目錄</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>iOS WKWebView 頁面與檔案資源 Preload 預載 / Cache 緩存研究 <a href="#ios-wkwebview-頁面與檔案資源-preload-預載--cache-緩存研究">#</a></summary><ul><li><a href="#背景">背景</a></li></ul></details></li><li class="has-children"><details><summary>技術細節 <a href="#技術細節">#</a></summary><ul><li><a href="#ios-限制">iOS 限制</a></li><li><a href="#http-cache-flow">HTTP Cache Flow</a></li></ul></details></li><li><a href="#ios-wkwebview-總攬">iOS WKWebView 總攬</a></li><li><a href="#ios-wkwebview-預載緩存可行性方案研究">iOS WKWebView 預載緩存可行性方案研究</a></li><li class="has-children"><details><summary>完善 HTTP Cache ✅ <a href="#完善-http-cache-">#</a></summary><ul><li><a href="#cachepolicy-設定">CachePolicy 設定</a></li><li><a href="#設定快取大小">設定快取大小</a></li><li><a href="#如何在-wkwebview-中使用-safari-開發者工具">如何在 WKWebView 中使用 Safari 開發者工具?</a></li><li><a href="#清除-wkwebview-快取">清除 WKWebView 快取</a></li></ul></details></li><li><a href="#完善-http-cache--wkwebview-preload-全頁面-">完善 HTTP Cache + WKWebView Preload 全頁面 😕</a></li><li><a href="#完善-http-cache--wkwebview-preload-純資源">完善 HTTP Cache + WKWebView Preload 純資源🎉</a></li><li><a href="#urlprotocol-">URLProtocol ❌</a></li><li class="has-children"><details><summary>WKURLSchemeHandler 😕 <a href="#wkurlschemehandler-">#</a></summary><ul><li><a href="#橋接-wkwebview-網路請求改由-app-發送-">橋接 WKWebView 網路請求改由 App 發送 🫥</a></li></ul></details></li><li><a href="#從-service-worker-下手-">從 Service Worker 下手 ❌</a></li><li><a href="#wkwebview-性能優化-">WKWebView 性能優化 🫥</a></li><li><a href="#local-html-local-資源檔案-">Local HTML, Local 資源檔案 🫥</a></li><li><a href="#前端優化下手-">前端優化下手 🎉🎉🎉</a></li><li><a href="#使用者體驗下手-">使用者體驗下手 🎉🎉🎉</a></li><li><a href="#結論">結論</a></li><li class="has-children"><details><summary>參考資料 <a href="#參考資料">#</a></summary><ul><li><a href="#wkwebview-preload-純資源-方案可參考以下影片">WKWebView Preload 純資源🎉 方案可參考以下影片</a></li><li><a href="#ios-老司機週報">iOS 老司機週報</a></li></ul></details></li><li><a href="#雜談">雜談</a></li></ul></nav><hr /><h3 id="ios-wkwebview-頁面與檔案資源-preload-預載--cache-緩存研究"><span class="me-2">iOS WKWebView 頁面與檔案資源 Preload 預載 / Cache 緩存研究</span><a href="#ios-wkwebview-頁面與檔案資源-preload-預載--cache-緩存研究" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS WKWebView 預先下載與緩存資源提升頁面載入速度研究。</p><p><a href="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" alt="Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Antoine Gravier</a></p><h4 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>不知為何，一直跟 “Cache” 緩存蠻有緣的，之前也負責研究實踐過 AVPlayer 的「 <a href="/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E9%82%8A%E6%92%AD%E9%82%8A%E5%BF%AB%E5%8F%96%E6%8A%80%E8%A1%93%E8%A7%A3%E6%9E%90-d796bf8e661e/">iOS HLS Cache 實踐方法探究之旅</a> 」與「 <a href="/posts/zrealm-dev/avplayer-%E6%9C%AC%E5%9C%B0-cache-%E5%AF%A6%E4%BD%9C%E6%94%BB%E7%95%A5-%E4%BD%BF%E7%94%A8-avassetresourceloaderdelegate-%E7%AF%80%E7%9C%81-ios-%E9%9F%B3%E6%A8%82%E4%B8%B2%E6%B5%81%E6%B5%81%E9%87%8F-6ce488898003/">AVPlayer 實踐本地 Cache 功能大全</a> 」；不同於串流緩存目的是減少播放流量， <strong>這次的主要任務是提升 In-app WKWebView 載入速度</strong> ，其中也牽涉到 WKWebView 的預先加載與緩存研究；不過老實說 WKWebView 的場景更為複雜，不同於 AVPlayer 串流影音是一個或是多個連續的 Chunk 檔案，只需要針對檔案做 Cache，WKWebView 除了本身頁面檔案還有引入的資源檔案( .js, .css, font, image…) 再經由 Browser Engine 渲染出頁面呈現給使用者，這中間不是 App 可以控制的環節太多，從網路到前端頁面 JavaScript 語法效能、渲染方式，都需要花費時間。</p><p><strong>本篇文章只是就 iOS 技術上可行性進行研究，並不一定是最終解法，綜觀來說此議題還是請前端從前端下手比較能達成四兩撥千斤的效果</strong> ，請前端夥伴優化第一個畫面出現的時間(First Contentful Paint) 與完善 HTTP Cache 機制，一方面能加速 Web/mWeb 自身，同時影響 Android/iOS in-app WebView 速度，並且也會提升 <a href="https://developers.google.com/search/blog/2018/01/using-page-speed-in-mobile-search?hl=zh-tw" target="_blank">Google SEO 權重</a> 。</p><h3 id="技術細節"><span class="me-2">技術細節</span><a href="#技術細節" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="ios-限制"><span class="me-2">iOS 限制</span><a href="#ios-限制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>根據 <a href="https://developer.apple.com/app-store/review/guidelines/" target="_blank">Apple Review Guidelines 2.5.6</a> ：</p><blockquote><p><em>Apps that browse the web must use the appropriate WebKit framework and WebKit JavaScript. You may apply for an entitlement to use an alternative web browser engine in your app. <a href="https://developer.apple.com/support/alternative-browser-engines/" target="_blank">Learn more about these entitlements</a> .</em></p></blockquote><p><strong>Apps 內只能使用 Apple 提供的 WebKit Framework (WKWebView) 不允許使用第三方或自行修改過的 WebKit 引擎</strong> ，否則將不允許上架；另外 iOS 17.4 開始，為符合法規，歐盟地區可以在 <strong>取得 Apple 特別許可</strong> 後 <a href="https://developer.apple.com/support/alternative-browser-engines/" target="_blank">使用其他 Browser Engine</a> 。</p><blockquote><p>蘋果不給的，我們也不能做。</p></blockquote><p>[未驗證] 查資料說就連 iOS 版的 Chrome, Firefox 也都是只能用 Apple WebKit (WKWebView)。</p><p><strong>另外還有一個很重要的事：</strong></p><blockquote><p><em>WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此所有請求、操作都不會經過我們的 App。</em></p></blockquote><h4 id="http-cache-flow"><span class="me-2">HTTP Cache Flow</span><a href="#http-cache-flow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MzYiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>在 HTTP 協議中就有包含 Cache 協議，並且在所有跟網路有關的元件(URLSession, WKWebView…)當中系統都已經幫我們實作好了 Cache 機制，因此 Client App 這邊不需要做任何實現，也不推薦大家自己幹一套自己的 Cache 機制，直接走 HTTP 協議才是最快最穩定最有效的路。</p><p><strong>HTTP Cache 大致運作流程如上圖：</strong></p><ol><li>Client 發起請求<li>Server 響應 Cache 策略在 Response Header，系統 URLSession, WKWebView… 會依照 Cache Header 自動幫我們將 Response 緩存下來，後續請求也會自動套用這個策略<li>再次請求相同資源時，如果緩存未過期則直接從記憶體、磁碟讀取本地緩存直接回應給 App<li>如果已過期(過期不代表無效)，則發起真實網路請求問 Server，如果內容沒更改 (雖過期待仍有效) Server 會直接回應 304 Not Modified (Empt Body)，雖然真的有發起網路請求但是基本上是毫秒回應＋無 Response Body 沒什麼流量耗損<li>如果內容有更改則重新給一次資料跟 Cache Header。</ol><blockquote><p><em>緩存除了本地 Cache、在 Network Proxy Server 或途經的路上也可能有網路的緩存。</em></p></blockquote><p><strong>常見 HTTP Response Cache Header 參數：</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="na">expires</span><span class="pi">:</span> <span class="s">RFC 2822 日期</span>
<span class="na">pragma</span><span class="pi">:</span> <span class="s">no-cache</span>
<span class="c1"># 較新的參數:</span>
<span class="na">cache-control</span><span class="pi">:</span> <span class="s">private/public/no-store/no-cache/max-age/s-max-age/must-revalidate/proxy-revalidate...</span>
<span class="na">etag</span><span class="pi">:</span> <span class="s">XXX</span>
</pre></table></code></div></div><p><strong>常見 HTTP Request Cache Header 參數：</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">If-Modified-Since</span><span class="pi">:</span> <span class="s">2024-07-18 13:00:00</span>
<span class="na">IF-None-Match</span><span class="pi">:</span> <span class="m">1234</span>
</pre></table></code></div></div><blockquote><p><strong><em>在 iOS 中網路有關的元件(URLSession, WKWebView…)會自己處理 HTTP Request/Response Cache Header 並自動做緩存，我們不需自己處理 Cache Header 參數。</em></strong></p></blockquote><p>更詳細的 HTTP Cache 運作細節可參考「 <a href="https://blog.techbridge.cc/2017/06/17/cache-introduction/" target="_blank">Huli 大大寫的循序漸進理解 HTTP Cache 機制</a> 」</p><h3 id="ios-wkwebview-總攬"><span class="me-2">iOS WKWebView 總攬</span><a href="#ios-wkwebview-總攬" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk3MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>回到 iOS 上，因為我們只能使用 Apple WebKit，因此只能從蘋果提供的 WebKit 方法下手，探究有機會達成預載緩存的方式。</p><p>上圖是使用 ChatGPT 4o 簡介的所有 Apple iOS WebKit (WKWebView) 相關的方法，並附上簡短說明；綠色部分為跟資料儲存有關的方法。</p><p><strong>跟大家分享其中比較幾個有趣的方法：</strong></p><ul><li>WKProcessPool：可以讓多個 WKWebView 之間共享資源、數據、Cookie…等等。<li>WKHTTPCookieStore：可以管理 WKWebView Cookie，WKWebView 與 WKWebView 之間或是 App 內的 URLSession Cookie 與 WKWebView。<li>WKWebsiteDataStore：管理網站緩存檔案。(只能讀資訊跟清除)<li>WKURLSchemeHandler：當 WKWebView 無法認得處理的 URL Scheme 則可註冊自定義 Handler 處理。<li>WKContentWorld：可以把注入的 JavaScript (WKUserScript) 腳本分組管理。<li>WKFindXXX：可以控制頁面搜尋功能。<li>WKContentRuleListStore：可以在 WKWebView 內實現內容阻擋器功能(e.g. 遮擋廣告之類的)。</ul><h3 id="ios-wkwebview-預載緩存可行性方案研究"><span class="me-2">iOS WKWebView 預載緩存可行性方案研究</span><a href="#ios-wkwebview-預載緩存可行性方案研究" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="完善-http-cache-"><span class="me-2">完善 HTTP Cache ✅</span><a href="#完善-http-cache-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如同前文介紹的 HTTP Cache 機制，我們可以請 Web Team 完善活動頁面的 HTTP Cache 設定，Client iOS 這邊只需要簡單的檢查一下 CachePolicy 設定就好，其他的事系統都做好了！</p><h4 id="cachepolicy-設定"><span class="me-2"><strong>CachePolicy 設定</strong></span><a href="#cachepolicy-設定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>URLSession:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
<span class="n">configuration</span><span class="o">.</span><span class="n">requestCachePolicy</span> <span class="o">=</span> <span class="o">.</span><span class="n">useProtocolCachePolicy</span>
<span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>URLRequest/WKWebView:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">cachePolicy</span> <span class="o">=</span> <span class="o">.</span><span class="n">reloadRevalidatingCacheData</span>
<span class="c1">//</span>
<span class="n">wkWebView</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></table></code></div></div><ul><li><strong>useProtocolCachePolicy</strong> : 默認，照默認 HTTP Cache 控制。<li><strong>reloadIgnoringLocalCacheData</strong> : 不使用本地快取，每次請求都從網絡加載數據(但允許網路, Proxy 快取…)。<li><strong>reloadIgnoringLocalAndRemoteCacheData</strong> : 無論本地或遠端快取，總是從網絡加載數據。<li><strong>returnCacheDataElseLoad</strong> : 如果有快取數據則使用快取數據，否則從網絡加載數據。<li><strong>returnCacheDataDontLoad</strong> : 僅使用快取數據，如果沒有快取數據也不打網路請求。<li><strong>reloadRevalidatingCacheData</strong> : 發送請求檢查本地快取是否過期，如果沒有過期(304 Not Modified)則使用快取數據，否則從網絡重新加載數據。</ul><h4 id="設定快取大小"><span class="me-2"><strong>設定快取大小</strong></span><a href="#設定快取大小" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>App 全域:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">memoryCapacity</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="c1">// 512 MB</span>
<span class="k">let</span> <span class="nv">diskCapacity</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="c1">// 10 GB</span>
<span class="k">let</span> <span class="nv">urlCache</span> <span class="o">=</span> <span class="kt">URLCache</span><span class="p">(</span><span class="nv">memoryCapacity</span><span class="p">:</span> <span class="n">memoryCapacity</span><span class="p">,</span> <span class="nv">diskCapacity</span><span class="p">:</span> <span class="n">diskCapacity</span><span class="p">,</span> <span class="nv">diskPath</span><span class="p">:</span> <span class="s">"myCache"</span><span class="p">)</span>
        
<span class="kt">URLCache</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="n">urlCache</span>
</pre></table></code></div></div><p><strong>個別 URLSession:</strong></p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="n">memoryCapacity</span> <span class="p">=</span> <span class="m">512</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="c1">// 512 MB</span>
<span class="k">let</span> <span class="n">diskCapacity</span> <span class="p">=</span> <span class="m">10</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="c1">// 10 GB</span>
<span class="k">let</span> <span class="n">cache</span> <span class="p">=</span> <span class="nf">URLCache</span><span class="p">(</span><span class="n">memoryCapacity</span><span class="p">:</span> <span class="n">memoryCapacity</span><span class="p">,</span> <span class="n">diskCapacity</span><span class="p">:</span> <span class="n">diskCapacity</span><span class="p">,</span> <span class="n">diskPath</span><span class="p">:</span> <span class="s">"myCache"</span><span class="p">)</span>
        
<span class="k">let</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">URLSessionConfiguration</span><span class="p">.</span><span class="k">default</span>
<span class="n">configuration</span><span class="p">.</span><span class="n">urlCache</span> <span class="p">=</span> <span class="n">cache</span>
</pre></table></code></div></div><blockquote><p><strong><em>另外同前述，WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此 URLRequest, URLSession 的快取跟 WKWebView 的是不共用的。</em></strong></p></blockquote><h4 id="如何在-wkwebview-中使用-safari-開發者工具"><span class="me-2"><strong>如何在</strong> WKWebView <strong>中使用 Safari 開發者工具?</strong></span><a href="#如何在-wkwebview-中使用-safari-開發者工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>檢查是否是使用本地 Cache 快取。</p><p><strong>Safari 啟用開發者功能：</strong></p><p><a href="/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDY0IiBoZWlnaHQ9IjcyMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>WKWebView 啟用 isInspectable：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">makeWKWebView</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">WKWebView</span> <span class="p">{</span>
 <span class="k">let</span> <span class="nv">webView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>
 <span class="n">webView</span><span class="o">.</span><span class="n">isInspectable</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// is only available in ios 16.4 or newer</span>
 <span class="k">return</span> <span class="n">webView</span>
<span class="p">}</span>
</pre></table></code></div></div><p>WKWebView 加上 <code class="language-plaintext highlighter-rouge">webView.isInspectable = true</code> 才能在 Debug Build 版使用 Safari 開發者工具。</p><p><a href="/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.webp" alt="p.s. 這是我另開的測試 WKWebView 用 Project" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NDkiIGhlaWdodD0iMTAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>p.s. 這是我另開的測試 WKWebView 用 Project</p><p>在 <code class="language-plaintext highlighter-rouge">webView.load</code> 的地方下一個斷點。</p><p><strong>開始測試：</strong></p><p>Build &amp; Run：</p><p><a href="/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjkiIGhlaWdodD0iMjU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>執行到 webView.load 斷點時，點擊「逐行偵錯」。</p><p><a href="/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNTQyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>回到 Safari，選擇工具列的「開發」-&gt;「模擬器」-&gt;「你的專案」-&gt;「about:blank」。</p><ul><li>因為頁面尚未開始載入 所以網址會是 about:blank<li>如果沒出現 about:blank 就再回到 XCode 點一次逐行偵錯按鈕，直到出現為止</ul><p>出現該頁面對應的開發者工具：</p><p><a href="/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjg5IiBoZWlnaHQ9Ijk0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>回 XCode 點擊繼續執行：</p><p><a href="/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4OTUiIGhlaWdodD0iMzUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>再回到 Safari 開發者工具就能看到資源載入狀況跟完整的開發者工具功能了 (元件、儲存空間調試…等等)</p><p><a href="/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjg5IiBoZWlnaHQ9Ijk0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>如果網路資源有 HTTP Cache，傳算大小則會顯示「磁碟」：</strong></p><p><a href="/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjIiIGhlaWdodD0iMzI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzMiIGhlaWdodD0iNDI5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>點進去也能看到緩存資訊。</p><h4 id="清除-wkwebview-快取"><span class="me-2">清除 WKWebView 快取</span><a href="#清除-wkwebview-快取" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// Clean Cookies</span>
<span class="kt">HTTPCookieStorage</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">removeCookies</span><span class="p">(</span><span class="nv">since</span><span class="p">:</span> <span class="kt">Date</span><span class="o">.</span><span class="n">distantPast</span><span class="p">)</span>

<span class="c1">// Clean Stored Data, Cache Data</span>
<span class="k">let</span> <span class="nv">dataTypes</span> <span class="o">=</span> <span class="kt">WKWebsiteDataStore</span><span class="o">.</span><span class="nf">allWebsiteDataTypes</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">WKWebsiteDataStore</span><span class="o">.</span><span class="nf">default</span><span class="p">()</span>
<span class="n">store</span><span class="o">.</span><span class="nf">fetchDataRecords</span><span class="p">(</span><span class="nv">ofTypes</span><span class="p">:</span> <span class="n">dataTypes</span><span class="p">)</span> <span class="p">{</span> <span class="n">records</span> <span class="k">in</span>
 <span class="n">records</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">record</span> <span class="k">in</span>
  <span class="n">store</span><span class="o">.</span><span class="nf">removeData</span><span class="p">(</span>
   <span class="nv">ofTypes</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">,</span>
   <span class="nv">for</span><span class="p">:</span> <span class="n">records</span><span class="p">,</span>
   <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span>
          <span class="nf">print</span><span class="p">(</span><span class="s">"clearWebViewCache() - </span><span class="se">\(</span><span class="n">record</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>           
   <span class="p">}</span>
  <span class="p">)</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>可使用以上方法清除 WKWebView 已緩存的資源、本地數據、Cookie 數據。</p><blockquote><p><strong><em>但完善 HTTP Cache 只是做到緩存部分(第二次進入很快)，預載(第一次進入)不會有影響。</em></strong> <em>✅</em></p></blockquote><h3 id="完善-http-cache--wkwebview-preload-全頁面-"><span class="me-2">完善 HTTP Cache + WKWebView Preload 全頁面 😕</span><a href="#完善-http-cache--wkwebview-preload-全頁面-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">WebViewPreloader</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">WebViewPreloader</span><span class="p">()</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">_webview</span><span class="p">:</span> <span class="kt">WKWebView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">()</span>

    <span class="kd">private</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">preload</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="kt">Task</span> <span class="p">{</span> <span class="kd">@MainActor</span> <span class="k">in</span>
            <span class="n">webview</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/campaign/summer"</span><span class="p">)</span>
</pre></table></code></div></div><p>基於完善 HTTP Cache 之後，第二次 Load WKWebView 會有緩存，我們可以先在列表或首頁偷先把裡面的 URL 都 Load 過一次讓他有緩存，使用者進去之後就會比較快。</p><blockquote><p><strong><em>經過測試，原理上可行；但是對性能、網路流量損耗太大</em></strong> <em>；使用者可能根本沒進去詳細頁，但我們為了做預載把所有頁面全都 Load 了一遍，有點亂槍打鳥的感覺。</em></p></blockquote><blockquote><p><em>個人認為現實上不可行，且利大於弊、因噎廢食。😕</em></p></blockquote><h3 id="完善-http-cache--wkwebview-preload-純資源"><span class="me-2">完善 HTTP Cache + WKWebView Preload 純資源🎉</span><a href="#完善-http-cache--wkwebview-preload-純資源" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>基於上面方法的優化，我們可以搭配 HTML Link Preload 方法，僅針對頁面裡面會用到的資源檔案(e.g. .js, .css, font, image…)進行 Preload，讓使用者進去之後可以直接使用緩存資源，不用再發起網路請求拿資源檔案。</p><blockquote><p><strong><em>意即我不預載整個頁面的所有東西了，我只預載頁面會用到的資源檔案，這些檔案可能也是跨頁面共用的；頁面檔案 .html 還是從網路拿取再結合預載檔案渲染出頁面。</em></strong></p></blockquote><p>請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。</p><p>請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。</p><p>請注意：這邊依然走的是 HTTP Cache，因此這些資源也要支援 HTTP Cache，否則之後請求還是會走網路。</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"zh-tw"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/dist/main.js"</span> <span class="na">as=</span><span class="s">"script"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://image.zhgchg.li/v2/image/get/campaign.jpg"</span> <span class="na">as=</span><span class="s">"image"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/assets/fonts/glyphicons-halflings-regular.woff2"</span> <span class="na">as=</span><span class="s">"font"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/assets/fonts/Simple-Line-Icons.woff2?v=2.4.0"</span> <span class="na">as=</span><span class="s">"font"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>常見支援檔案類型：</strong></p><ul><li>.js script<li>.css style<li>font<li>image</ul><p>Web Team 將以上 HTML 內容放在與 App 約定好的路徑，我們的 <code class="language-plaintext highlighter-rouge">WebViewPreloader</code> 改去 Load 這個路徑，WKWebView Load 的同時就會解析 &lt;link&gt; preload 資源產生緩存了。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/campaign/summer/preload"</span><span class="p">)</span>
<span class="c1">// or 統一都在</span>
<span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/assets/preload"</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p><strong><em>經過測試，可以在流量損耗與預載中取得一個不錯的平衡</em></strong> <em>。</em> 🎉</p></blockquote><blockquote><p><strong><em>缺點應該是需要維護這份 Cache 資源列表，跟還是需要 Web 優化頁面渲染跟載入，不然第一個頁面出現的體感時間依然會很久。</em></strong></p></blockquote><h3 id="urlprotocol-"><span class="me-2">URLProtocol <em>❌</em></span><a href="#urlprotocol-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>另外想到我們的老朋友 <a href="https://developer.apple.com/documentation/foundation/urlprotocol" target="_blank">URLProtocol</a> ，所有基於 <code class="language-plaintext highlighter-rouge">URL Loading System</code> 的請求 (URLSession, openURL…) 都可以被攔截下來操作。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">CustomURLProtocol</span><span class="p">:</span> <span class="kt">URLProtocol</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">class</span> <span class="kd">func</span> <span class="nf">canInit</span><span class="p">(</span><span class="n">with</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// 判斷是否要處理這個請求</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"custom"</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">class</span> <span class="kd">func</span> <span class="nf">canonicalRequest</span><span class="p">(</span><span class="k">for</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">URLRequest</span> <span class="p">{</span>
        <span class="c1">// 返回請求</span>
        <span class="k">return</span> <span class="n">request</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">startLoading</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 處理請求並加載數據</span>
        <span class="c1">// 改成緩存策略，先從本地讀檔案</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">URLResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="nv">expectedContentLength</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">textEncodingName</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocol</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">didReceive</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span> <span class="nv">cacheStoragePolicy</span><span class="p">:</span> <span class="o">.</span><span class="n">notAllowed</span><span class="p">)</span>
            
            <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="s">"This is a custom response!"</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocol</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">didLoad</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocolDidFinishLoading</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">stopLoading</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 停止加載數據</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// AppDelegate.swift didFinishLaunchingWithOptions:</span>
<span class="kt">URLProtocol</span><span class="o">.</span><span class="nf">registerClass</span><span class="p">(</span><span class="kt">CustomURLProtocol</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</pre></table></code></div></div><p>抽象想法是在背景偷發 URLReqeust -&gt; URLProtocol -&gt; 從中自己下載所有資源，使用者 -&gt; WKWebView -&gt; Request -&gt; URLProtocol -&gt; 回應預載的資源。</p><blockquote><p><strong><em>一樣同前述，WKWebView 是跑在 App 主執行緒之外的獨立執行緒，因此 URLProtocol 是攔截不到 WKWebView 的請求的。</em></strong></p></blockquote><blockquote><p><strong><em>但聽說上黑魔法好像可以，不推薦、會延伸其他問題(送審被拒)</em></strong></p></blockquote><blockquote><p><strong><em>此路不通</em></strong> <em>❌。</em></p></blockquote><h3 id="wkurlschemehandler-"><span class="me-2">WKURLSchemeHandler <em>😕</em></span><a href="#wkurlschemehandler-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>蘋果在 iOS 11 推出的新方法，感覺是為了補足 WKWebView 無法使用 URLProtocol 的特型；但是這個方法跟 <a href="/posts/zrealm-dev/avplayer-%E6%9C%AC%E5%9C%B0-cache-%E5%AF%A6%E4%BD%9C%E6%94%BB%E7%95%A5-%E4%BD%BF%E7%94%A8-avassetresourceloaderdelegate-%E7%AF%80%E7%9C%81-ios-%E9%9F%B3%E6%A8%82%E4%B8%B2%E6%B5%81%E6%B5%81%E9%87%8F-6ce488898003/">AVPlayer 的 ResourceLoader</a> 比較類似， <strong>只有系統無法辨識的 Scheme 才會丟給我們自己訂的 WKURLSchemeHandler 進行處理</strong> 。</p><p>抽象想法一樣是在背景偷發 WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; 從中自己下載所有資源，使用者 -&gt; WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; 回應預載的資源。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">WebKit</span>

<span class="kd">class</span> <span class="kt">CustomSchemeHandler</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">WKURLSchemeHandler</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">start</span> <span class="nv">urlSchemeTask</span><span class="p">:</span> <span class="kt">WKURLSchemeTask</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 處理自定義</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">urlSchemeTask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">!</span>
        
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"custom-scheme"</span> <span class="p">{</span>
            <span class="c1">// 改成緩存策略，先從本地讀檔案</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">URLResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="nv">expectedContentLength</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">textEncodingName</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didReceive</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            
            <span class="k">let</span> <span class="nv">html</span> <span class="o">=</span> <span class="s">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from custom scheme!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>
            <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didReceive</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didFinish</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">stop</span> <span class="nv">urlSchemeTask</span><span class="p">:</span> <span class="kt">WKURLSchemeTask</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 停止</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">webViewConfiguration</span> <span class="o">=</span> <span class="kt">WKWebViewConfiguration</span><span class="p">()</span>
<span class="n">webViewConfiguration</span><span class="o">.</span><span class="nf">setURLSchemeHandler</span><span class="p">(</span><span class="kt">CustomSchemeHandler</span><span class="p">(),</span> <span class="nv">forURLScheme</span><span class="p">:</span> <span class="s">"mycacher"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">customURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"mycacher://zhgchg.li/campaign/summer"</span><span class="p">)</span><span class="o">!</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">customURL</span><span class="p">))</span>
</pre></table></code></div></div><ul><li>因為 http/https 是系統能處理的 Scheme 所以我們不能自定義 http/https 的處理；需要把 Scheme 換成系統認不得的 Scheme (e.g. <code class="language-plaintext highlighter-rouge">mycacher://</code> )。<li>頁面裡面統一都要用相對路徑才會自動套上 <code class="language-plaintext highlighter-rouge">mycacher://</code> 讓我們的 Handler 捕獲。<li>如果不想改 http/https 又想獲取 http/https 請求只能上黑魔法， <strong>不推薦、</strong> 會延伸其他問題(送審被拒)<li>自行緩存頁面檔案並響應，頁面中使用的 Ajax, XMLHttpRequest, Fetch 請求可能會被 <a href="https://developer.mozilla.org/zh-TW/docs/Web/Security/Same-origin_policy" target="_blank"><strong>CORS 同源政策</strong></a> <strong>阻擋</strong> ，要降低網站安全性才能使用 (因為會變成 mycacher:// 發送請求打 http://zhgchg.li/xxx，不同源)<li>可能需要自己實現 Cache Policy，例如那何時該更新？有效多久？ <strong>(這就跟 HTTP Cache 在做的事一樣了)</strong></ul><blockquote><p><strong><em>綜合以上，雖然原理上可行，但是實現上投入巨大；整體來說不符合效益並且很難擴充跟保持穩定性</em></strong> <em>😕</em></p></blockquote><p>感覺 WKURLSchemeHandler 這方法比較適合針對網頁內有很大的資源檔案需要下載，宣告一個自訂的 Scheme 丟給 App 去處理，互相合作渲染出網頁。</p><h4 id="橋接-wkwebview-網路請求改由-app-發送-"><span class="me-2">橋接 WKWebView 網路請求改由 App 發送 🫥</span><a href="#橋接-wkwebview-網路請求改由-app-發送-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>WKWebView 改成打 App 定好的接口 (WkUserScript) 替代 Ajax, XMLHttpRequest, Fetch，由 App 去請求資源。</p><blockquote><p><em>以此案例幫助不大，因為是第一個畫面出現的時間太慢，而不是後續加載太慢；並且此方法會造成 Web x App 有過深根奇怪的依賴關係 🫥</em></p></blockquote><h3 id="從-service-worker-下手-"><span class="me-2">從 Service Worker 下手 <em>❌</em></span><a href="#從-service-worker-下手-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><em>基於安全性問題，只有蘋果自己的 Safari App 支援，WKWebView 不支援❌。</em></p></blockquote><h3 id="wkwebview-性能優化-"><span class="me-2">WKWebView 性能優化 🫥</span><a href="#wkwebview-性能優化-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>優化提升 WKWebView Load View 的性能。</p><blockquote><p><em>WKWebView 本身像是骨架、Web 頁面是血肉，研究下來優化骨架(e.g. 復用 WKProcessPool)的效果很有限，可能是 0.0003 -&gt; 0.000015 秒的區別。</em></p></blockquote><h3 id="local-html-local-資源檔案-"><span class="me-2">Local HTML, Local 資源檔案 🫥</span><a href="#local-html-local-資源檔案-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>類似 Preload 方式，只是改成將活動頁放入 App Bundle 或是啟動時從遠端拿。</p><blockquote><p><em>放整個 HTML 頁面可能也會遇到 CORS 同源問題；純放網頁資源檔案感覺可以使用 「完善 HTTP Cache + WKWebView Preload 純資源」方式取代；放 App Bundle 徒增 App Size、從遠端拿就是 WKWebView Preload 🫥</em></p></blockquote><h3 id="前端優化下手-"><span class="me-2">前端優化下手 🎉🎉🎉</span><a href="#前端優化下手-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.webp" alt="[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDA4IiBoZWlnaHQ9IjM0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/" target="_blank">Source: wedevs</a></p><p>參考 <a href="https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/" target="_blank">wedevs 優化建議</a> ，前端 HTML 頁面應該會有四個載入階段，從一開始載完頁面檔案 ( .html) First Paint (空白頁) 到 First Contentful Paint (渲染出頁面骨架) 再到 First Meaningful Paint (補上頁面內容) 到 Time To Interactive(最後可讓使用者互動)。</p><p><a href="/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MTUiIGhlaWdodD0iNzc5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>用我們的頁面測試；瀏覽器、WKWebView 會先請求頁面本體 .html 再載入需要用到的資源，同時依照程式指引構建出畫面給使用者，對比文章發現頁面階段其實只有 First Paint (空白)到 Time To Interactive (First Contentful Paint 只有 Navigation Bar 應該不太算…)，少了中間的分階段渲染給使用者，因此使用者整體等待時間會拉長。</p><blockquote><p><em>並且目前只有資源類的檔案有設定 HTTP Cache，頁面本體沒有。</em></p></blockquote><p>另外也可以參考 <a href="https://pagespeed.web.dev/" target="_blank">Google PageSpeed Insights</a> 建議進行優化，例如壓縮、減少腳本大小. .等等</p><p><a href="/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjgiIGhlaWdodD0iNTA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>因為 in-app WKWebView 的核心還是 Web 頁面本身；因此從前端網頁下手調整是個很好的四兩撥千斤方式 。🎉🎉🎉</em></p></blockquote><h3 id="使用者體驗下手-"><span class="me-2">使用者體驗下手 🎉🎉🎉</span><a href="#使用者體驗下手-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTYiIGhlaWdodD0iNjA5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>一個簡單的實現，從使用者體驗下手，增加 Loading Progress Bar，不要只展示空白頁面讓使用者不知所措，讓他知道頁面正在加載中並且進度到哪裡。🎉🎉🎉</em></p></blockquote><h3 id="結論"><span class="me-2">結論</span><a href="#結論" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>以上就是本次探究 WKWebView 預載與緩存可行方案的一些發想研究，技術反而不是最大的問題，重點還是選擇，哪些方式才是對使用者最有效對開發端投入成本最低的方案，選擇這些方式可能小小改了些地方就能直接達成目標；選擇錯誤的方式會導致投入巨大的資源繞圈圈並且很有可能在後續難以維護跟使用。</p><blockquote><p><em>辦法總比困難多，有時候是缺少想像。</em></p></blockquote><p>說不定也有我沒想到的神級組合做法，歡迎大家協助補充。</p><h3 id="參考資料"><span class="me-2">參考資料</span><a href="#參考資料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="wkwebview-preload-純資源-方案可參考以下影片"><span class="me-2">WKWebView Preload 純資源🎉 方案可參考以下影片</span><a href="#wkwebview-preload-純資源-方案可參考以下影片" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>&lt;iframe class=”embed-video” loading=”lazy” src=”https://www.youtube.com/embed/ZQvyfFieBfs” title=”“Preload strategies using WKWebView” by Jonatán Urquiza” frameborder=”0” allow=”accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture” allowfullscreen&gt;&lt;/iframe&gt;</p><p>另外作者也有提到 WKURLSchemeHandler 的方法。</p><p><strong>影片中的完整 Demo Repo 如下：</strong></p><p><a href="https://github.com/jonurq/preload-strategies-wkwebview" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/6789eaaf4d4f56f69df9d39e4abae4a910b10da24a14ff934a367da52fbde78c/jonurq/preload-strategies-wkwebview" alt="" loading="lazy"></a></p><h4 id="ios-老司機週報"><span class="me-2">iOS 老司機週報</span><a href="#ios-老司機週報" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/SwiftOldDriver/iOS-Weekly/issues?q=WkWebView" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/115476023/2a31ab00-183a-11eb-889c-b9674f419108" alt="" loading="lazy"></a></p><p>老司機週報中關於 WkWebView 的分享也值得一看。</p><h3 id="雜談"><span class="me-2">雜談</span><a href="#雜談" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>久違的回歸撰寫 iOS 開發相關長篇文章。</p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/5033090c18ba" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2024-07-28-5033090c18ba.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cache/" class="post-tag no-text-decoration" >cache</a> <a href="/tags/webview/" class="post-tag no-text-decoration" >webview</a> <a href="/tags/http-request/" class="post-tag no-text-decoration" >http-request</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20WKWebView%20%E9%A0%90%E8%BC%89%E8%88%87%20Cache%20%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93%EF%BD%9C%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-wkwebview-%25E9%25A0%2590%25E8%25BC%2589%25E8%2588%2587-cache-%25E7%25B7%25A9%25E5%25AD%2598%25E6%258A%2580%25E8%25A1%2593-%25E6%258F%2590%25E5%258D%2587%25E9%25A0%2581%25E9%259D%25A2%25E8%25BC%2589%25E5%2585%25A5%25E9%2580%259F%25E5%25BA%25A6%25E8%2588%2587%25E8%25B3%2587%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%25E5%2585%25A8%25E8%25A7%25A3%25E6%259E%2590-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20WKWebView%20%E9%A0%90%E8%BC%89%E8%88%87%20Cache%20%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93%EF%BD%9C%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-wkwebview-%25E9%25A0%2590%25E8%25BC%2589%25E8%2588%2587-cache-%25E7%25B7%25A9%25E5%25AD%2598%25E6%258A%2580%25E8%25A1%2593-%25E6%258F%2590%25E5%258D%2587%25E9%25A0%2581%25E9%259D%25A2%25E8%25BC%2589%25E5%2585%25A5%25E9%2580%259F%25E5%25BA%25A6%25E8%2588%2587%25E8%25B3%2587%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%25E5%2585%25A8%25E8%25A7%25A3%25E6%259E%2590-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fios-wkwebview-%25E9%25A0%2590%25E8%25BC%2589%25E8%2588%2587-cache-%25E7%25B7%25A9%25E5%25AD%2598%25E6%258A%2580%25E8%25A1%2593-%25E6%258F%2590%25E5%258D%2587%25E9%25A0%2581%25E9%259D%25A2%25E8%25BC%2589%25E5%2585%25A5%25E9%2580%259F%25E5%25BA%25A6%25E8%2588%2587%25E8%25B3%2587%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%25E5%2585%25A8%25E8%25A7%25A3%25E6%259E%2590-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/japan-overseas-shopping-rakuten-consolidated-shipping-for-taiwan-buy-from-rakuten-amazon-bea62c251f1b/">Japan Overseas Shopping｜Rakuten Consolidated Shipping for Taiwan｜Buy from Rakuten & Amazon</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/%E6%97%A5%E6%9C%AC%E4%B9%90%E5%A4%A9%E9%9B%86%E8%BF%90%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E8%B4%AD%E4%B9%B0horie%E9%92%9B%E6%9D%AF%E4%B8%8Eamazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E6%B9%BE%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外购物寄送台湾教学 — 使用乐天集运购买乐天拍卖与 Amazon 商品 (Horie 钛杯)</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/%E6%97%A5%E6%9C%AC%E6%A8%82%E5%A4%A9%E9%9B%86%E9%81%8B%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E8%B3%BC%E8%B2%B7horie%E9%88%A6%E6%9D%AF%E8%88%87amazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E7%81%A3%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外購物寄送台灣教學 — 使用樂天集運購買樂天拍賣與 Amazon 商品 (Horie 鈦杯)</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1722160385" data-df="ll" > Jul 28, 2024 </time><h4 class="pt-0 my-2">iOS WKWebView 预载与 Cache 缓存技术｜提升页面载入速度与资源管理全解析</h4><div class="text-muted"><p>针对 iOS WKWebView 使用者面临载入缓慢问题，深入解析 HTTP Cache 与预载技术，结合纯资源预载与 CachePolicy 设定，实现流量与效能平衡，加速页面响应并提升使用体验。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1722160385" data-df="ll" > Jul 28, 2024 </time><h4 class="pt-0 my-2">iOS WKWebView Preload and Cache｜Boost Page Load Speed with Efficient Resource Management</h4><div class="text-muted"><p>Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively.</p></div></div></a></article><article class="col"> <a href="/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E6%8A%80%E8%A1%93%E5%AF%A6%E6%88%B0-ios-%E6%9C%AC%E5%9C%B0%E7%B7%A9%E5%AD%98%E5%84%AA%E5%8C%96%E6%94%BB%E7%95%A5-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer 邊播邊 Cache 技術實戰｜iOS 本地緩存優化攻略</h4><div class="text-muted"><p>針對 iOS 開發者面臨 AVPlayer 播放時緩存不足問題，解析 AVAssetResourceLoaderDelegate 實作技巧，有效提升播放流暢度與本地緩存效率，減少重複下載與延遲，打造穩定音樂與影片播放器體驗。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS WKWebView 预载与 Cache 缓存技术｜提升页面载入速度与资源管理全解析</p></a> <a href="/posts/zrealm-life/en/medium-partner-program-global-writers-including-taiwan-now-eligible-for-earnings-cefdf4d41746/" class="btn btn-outline-primary" aria-label="Newer" ><p>Medium Partner Program｜Global Writers Including Taiwan Now Eligible for Earnings</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
