<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="針對開發團隊自動化需求，解析 GitHub Actions 與 Self-hosted Runner 架構與設定，並透過三大實戰案例教你快速建立自動標記 PR、指派負責人及每日 PR 統計通知，提升 CI/CD 執行效率與成本優化。" /><meta property="og:description" content="針對開發團隊自動化需求，解析 GitHub Actions 與 Self-hosted Runner 架構與設定，並透過三大實戰案例教你快速建立自動標記 PR、指派負責人及每日 PR 統計通知，提升 CI/CD 執行效率與成本優化。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-07-02T20:22:32+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" /><meta property="twitter:title" content="GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2025-07-12T22:49:01+08:00","datePublished":"2025-07-02T20:22:32+08:00","description":"針對開發團隊自動化需求，解析 GitHub Actions 與 Self-hosted Runner 架構與設定，並透過三大實戰案例教你快速建立自動標記 PR、指派負責人及每日 PR 統計通知，提升 CI/CD 執行效率與成本優化。","headline":"GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"},"url":"https://zhgchg.li/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"}</script><title>GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置</h1><p class="post-desc fw-light mb-4">針對開發團隊自動化需求，解析 GitHub Actions 與 Self-hosted Runner 架構與設定，並透過三大實戰案例教你快速建立自動標記 PR、指派負責人及每日 PR 統計通知，提升 CI/CD 執行效率與成本優化。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1751458952" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 2, 2025 </time> </span> <span> Updated <time data-ts="1752331741" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 12, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" class="popup img-link preview-img blur"><img data-src="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="11091 words" > <em>61 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-info"><p><a href="/posts/en/404bd5c70040/"><strong>Click here</strong></a> to view the English version of this article, translated by OpenAI.</p></blockquote><blockquote class="prompt-tip"><p>出於 SEO 考量，本文標題與描述經 GPT 調整，原始版本請參考內文，若有不恰當的用語，敬請指正。</p></blockquote><hr /><h3 id="cicd-實戰指南二github-actions-與-self-hosted-runner-使用與建置大全"><span class="me-2">CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全</span><a href="#cicd-實戰指南二github-actions-與-self-hosted-runner-使用與建置大全" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>帶您從頭了解 GitHub Actions/Self-hosted Runner 運作方式與手把手使用教學。</p><p><a href="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" alt="Photo by [Dan Taylor](https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Dan Taylor</a></p><h4 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前篇「 <a href="/posts/zrealm-dev/ci-cd-是什麼-打造高效穩定開發團隊的關鍵流程與工具選擇-c008a9e8ceca/"><strong>CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？</strong></a> 」我們介紹了 CI/CD 是什麼？能帶來哪些效益與工具的選擇， <strong>這篇將著重在 GitHub Actions, Self-hosted Runner 的架構與使用介紹</strong> ，並手把手一起建立幾個有趣的自動化工作流程，帶您慢慢上手。</p><h3 id="github-actions-架構流程圖"><span class="me-2">GitHub Actions 架構流程圖</span><a href="#github-actions-架構流程圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在開始之前我們先來確定一下 GitHub Actions 的運作架構流程關係與職責。</p><p><a href="/assets/404bd5c70040/1*iacfyTX_b3YTSzMcn2ldjw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*iacfyTX_b3YTSzMcn2ldjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="github-repo"><span class="me-2"><strong>GitHub Repo</strong></span><a href="#github-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>在 GitHub Actions 的世界裡，所有 Actions (Workflow YAML 檔案) 都要存放在某個 Git Repo 之中 ( <code class="language-plaintext highlighter-rouge">REPO/.github/workflows/</code> )</ul><h4 id="github-repo-actions-secrets"><span class="me-2">GitHub Repo —Actions Secrets</span><a href="#github-repo-actions-secrets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Settings → Secrets and variables → Actions → Secrets。</p><ul><li>存放 Actions 步驟中會用到的 Secret Key, Token e.g. Slack Bot Token、Apple Store Connect API .p8 Key<li><strong>Secrets 內容無法在 Action Log 中查看，會自動用 * * * * 隱蔽</strong><li>Secrets 內容無法查看、編輯，只能覆蓋<li>Secrets <strong>目前只支援純文字內容，無法上傳檔案</strong> <strong>-</strong> 如果是二進制的金要請參考 <a href="https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/using-secrets-in-github-actions#storing-base64-binary-blobs-as-secrets" target="_blank">官方步驟使用 Base64 編碼轉換後儲存</a> 。 - iOS 開發憑證儲存方式可參考官方教學： <a href="https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development" target="_blank">Installing an Apple certificate on macOS runners for Xcode development</a><li>可以儲存組織層級的 Secrets，跨 Repo 共享</ul><h4 id="github-repo--actions-variables"><span class="me-2">GitHub Repo — Actions Variables</span><a href="#github-repo--actions-variables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Settings → Secrets and variables → Actions → Variables。</p><ul><li>存放 Actions 步驟中常用到的變數 e.g. 模擬器 iOS 版本、工作目錄<li>Variables 內容可以查看、編輯<li>Variables 內容可以輸出在 Action Log 中<li>Variables 只支援純文字，也可存放 json 字串然後自己解析使用<li>可以儲存組織層級的 Variables，跨 Repo 共享</ul><h4 id="github-actions--trigger"><span class="me-2">GitHub Actions — Trigger</span><a href="#github-actions--trigger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>Github Action 中最重要的起始點 — 觸發事件(條件)</strong><li>符合觸發事件的 GitHub Actions 才會觸發執行<li>完整事件列表可 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">參考官方文件</a><li>基本上涵蓋了所有 CI/CD、自動化會遇到的事件場景。 但 <strong>如果有特殊場景沒有事件，那就只能用其他事件+在 Job 中判斷組合或是用 Schedule 排程手動檢查了</strong> 。 e.g. 例如沒有 PR Merged 事件，就只能用 <code class="language-plaintext highlighter-rouge">pull_request: closed</code> + Job <code class="language-plaintext highlighter-rouge">if: github.event.pull_request.merged == true</code> 達成</ul><p><strong>常用事件：</strong></p><ul><li><code class="language-plaintext highlighter-rouge">schedule</code> (cron)：排程定時執行(同 crontab) 可以用來做自動化：定時檢查 PR、定時打包、定時執行自動化腳本 <strong>統一都在 main / develop (Default Branch) 執行。</strong><li><code class="language-plaintext highlighter-rouge">pull_request:</code> ：PR 相關事件 當 PR 開啟時、PR Assign 時、加 Label 時、有新 Push Commit 時…等等<li><code class="language-plaintext highlighter-rouge">issues</code> 、 <code class="language-plaintext highlighter-rouge">issue_comment</code> ：Issue 相關事件 當 Issue 開啟時、有新留言時…等等<li><code class="language-plaintext highlighter-rouge">workflow_dispatch</code> ：手動觸發；可以設定需要提供的欄位，GitHub Actions 提供簡易的表單讓使用者可以填寫資訊。 e.g.:</ul><p><a href="/assets/404bd5c70040/1*XogIJsCbrNPerWBto_PG8w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*XogIJsCbrNPerWBto_PG8w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMzIiIGhlaWdodD0iNDMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><code class="language-plaintext highlighter-rouge">workflow_call</code> ：觸發另一個 Action(Workflow) 執行任務。<li><code class="language-plaintext highlighter-rouge">workflow_run</code> ：當別的 Action(Workflow) 執行任務，觸發執行此任務。</ul><blockquote><p><em>更多事件類型、設定細節請 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">參考官方文件</a> 。</em></p></blockquote><h4 id="github-actions--workflow"><span class="me-2"><strong>GitHub Actions — Workflow</strong></span><a href="#github-actions--workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>a.k.a Action<li>使用 YAML 撰寫 .yaml 檔案，檔案統一放置在 <code class="language-plaintext highlighter-rouge">REPO/.github/workflows/</code> 之下<li><strong>以主分支內的 Workflow YAML 檔案為主</strong> 如果在其他分支看不到正在開發的 Action 或執行上有誤，可以先 Merge 回主分支看看。<li>GitHub Actions 中的最基礎單位，每個 Workflow 就代表一項 CI/CD 或自動化操作<li>Workflow 可以呼叫別的 Workflow 執行任務 (可以利用這個特性拆出核心 Workflow 和呼叫的 Workflow)<li>當中會定義任務名稱、執行策略、觸發事件、任務工作…等等所有 Action 相關設定<li>目前檔案結構不支援子目錄<li>Action 完全免費 (Public and Private Repo)</ul><h4 id="github-actions--workflow--job"><span class="me-2">GitHub Actions — Workflow — Job</span><a href="#github-actions--workflow--job" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub Actions 中的執行單位<li>定義 Workflow 中的任務工作有哪些<li>每個 Workflow 可以有多個 Jobs<li>每個 Job 需要指定使用哪個 Runner Label，執行的時候會使用對應的 Runner 機器來執行任務<li><strong>多個 Jobs 是並發執行</strong> (如有順序可以用 <code class="language-plaintext highlighter-rouge">needs</code> 約束)<li><strong>每個 Job 應該視為獨立執行個體(每個都要當成是 Sandbox)</strong> ，Job 結束後如果有產出資源檔案要給後續其他 Job/Workflow 使用，需要 Upload Artifacts 或在 self-hosted 移動到共用產出目錄。<li>Job 做完可以 Output 字串給其他 Job 參考使用。 (例如執行結果 true or false)<li>沒特別設流程條件的話，多個 Job 如果其中有 Job 發生錯誤， <strong>其他 Job 依然會繼續執行</strong></ul><h4 id="github-actions--reuse-workflowjob"><span class="me-2">GitHub Actions — Reuse Workflow/Job</span><a href="#github-actions--reuse-workflowjob" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Workflow 定義 <code class="language-plaintext highlighter-rouge">on: workflow_call</code> 就能封裝給其他 Workflow 當成 Job 複用<li>同個組織下可以跨 Repo 分享使用<li>因此可以把跨 Repo 共用的 CI/CD 工作放到共享的 Repo 一起使用</ul><h4 id="github-actions--workflow--job--step"><span class="me-2">GitHub Actions — Workflow — Job — Step</span><a href="#github-actions--workflow--job--step" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub Actions 中的最小執行項目<li>Job 中實際執行任務的程式<li>每個 Job 可以有多個 Steps<li><strong>多個 Steps 是照順序執行</strong><li>Step 做完可以 Output 字串給後續 Steps 參考使用。<li><strong>Step 可以直接撰寫 shell script 程式</strong> 可以引用 <a href="https://cli.github.com/manual/gh" target="_blank">gh cli</a> 、當前環境變數(例如取得 PR 編號)，直接做想做的事<li>沒特別設流程條件的話，Step 如果發生錯誤， <strong>會直接中斷</strong> ，後續的 Steps 不會執行</ul><h4 id="github-actions--workflow--job--reuse-action-step"><span class="me-2">GitHub Actions — Workflow — Job — Reuse Action Step</span><a href="#github-actions--workflow--job--reuse-action-step" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>可以直接復用 <a href="https://github.com/marketplace?type=actions" target="_blank">Marketplace</a> 上各路大神包好的現有工作步驟。</strong> 例如： <a href="https://github.com/marketplace/actions/comment-pull-request" target="_blank">Comment 內容到 PR</a> 。<li>也可以將自己一系列的工作任務 Step 打包成一個 Action GitHub Repo 讓其他工作直接復用<li>Public Repo 的 Action 可以上架到 Marketplace</ul><p><strong>打包 Action 支援使用：</strong></p><ul><li><strong>Docker Action</strong> — 代表 GitHub Actions 會把環境變數傳到 Docker 容器中，再看你要怎麼處理，可以是 shell script、Java、PHP…etc.<li><strong>JavaScript/TypeScript Action</strong> — 直接使用 node.js 撰寫 GitHub Actions 處理邏輯，同樣的會把環境變數都傳給你參考使用。 e.g. <a href="https://github.com/pozil/auto-assign-issue/blob/v2/action.yml" target="_blank">pozil/auto-assign-issue</a><li><strong>Composite (YAML) —</strong> 純 YAML 描述任務步驟 (同 GitHub Actions — Workflow — Job — Step) 可以宣告有哪寫步驟要做或直接在上面寫 shell script。 e.g. <a href="https://github.com/ZhgChgLi/ZReviewTender/blob/main/action.yml" target="_blank">ZhgChgLi/ZReviewTender</a></ul><blockquote><p><em>礙於篇幅，本篇文章不會介紹如何打包 Github Actions Action，有興趣可以參考官方文件： <a href="https://docs.github.com/en/actions/tutorials/creating-a-composite-action" target="_blank">tutorials/creating-a-composite-action</a> 。</em></p></blockquote><h4 id="github-runner"><span class="me-2">GitHub Runner</span><a href="#github-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub 會根據 Runner Label 派發對應的 Job 給 Runner 執行<li>Runner 只做為監聽者，輪詢監聽 GitHub 派發任務<li>只關心 Job 不關心是哪個 Action(Workflow) 因此會出現 Action A 的 Job-1 執行完，下一個換 Action B 的 Job-1，而不是 Action A 的 Jobs 都執行完才換 Action B。<li>Runner 可以使用 GitHub Hosted Runner 或 Self-hosted Runner。</ul><h4 id="github-hosted-runner"><span class="me-2"><strong>GitHub Hosted Runner</strong></span><a href="#github-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub 提供的 Runner，可參考官方 Repo 列表：</ul><p><a href="https://github.com/actions/runner-images" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/b479f2537a0d7620cc8bed955bf9331e739ee02383a1715546a26bc35390a494/actions/runner-images" alt="" loading="lazy"></a></p><p><a href="/assets/404bd5c70040/1*KtQV4kDCWscEeaZ8jQI8Dg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*KtQV4kDCWscEeaZ8jQI8Dg.webp" alt="[2025/06 的 Images 列表](https://github.com/actions/runner-images){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjExNTQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://github.com/actions/runner-images" target="_blank">2025/06 的 Images 列表</a></p><ul><li>Runner 預先安裝了什麼可以點進去查看： e.g. <a href="https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md" target="_blank">macos-14-arm64</a></ul><p><a href="/assets/404bd5c70040/1*svXtXH78-TvK1C_XXCyYLA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*svXtXH78-TvK1C_XXCyYLA.webp" alt="[macos-14-arm64](https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijc4MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md" target="_blank">macos-14-arm64</a></p><ul><li>iOS 開發優先使用 -arm64 (M系列) 處理器的 Runner，跑起來比較快<li>只要在 Job <code class="language-plaintext highlighter-rouge">run-on</code> 貼上表格上的 YAML Label，就能使用該 Runner 執行任務<li><strong>Public Repo 收費方式: 完全免費無限使用</strong><li><strong>️</strong> Private Repo 免費額度: 免費額度(依照帳號不同額度不同，以 GitHub Free 為例)： 用量：每月免費 2,000 分鐘 儲存：500 MB<li><strong>⚠️️Private Repo 計費方式:</strong> <strong>超過免費額度之後開始用用量計費(可設上限跟通知)，依照 Runner 所屬的機器作業系統、核心不同，價格也不同：</strong></ul><p><a href="/assets/404bd5c70040/1*rkhRJN4ZRas_lDOJh-pjkQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*rkhRJN4ZRas_lDOJh-pjkQ.webp" alt="[about-billing-for-github-actions](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc4IiBoZWlnaHQ9IjEzMjgiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions" target="_blank">about-billing-for-github-actions</a></p><p>可以看到 macOS 的價格因為設備成本很高所以貴。</p><ul><li>最多並發任務數限制：</ul><p><a href="/assets/404bd5c70040/1*LU3zGSBe57NBVMfDwl0wdQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*LU3zGSBe57NBVMfDwl0wdQ.webp" alt="[usage-limits-billing-and-administration](https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ5MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits" target="_blank">usage-limits-billing-and-administration</a></p><blockquote><p><em>這邊扯太多了，我們的重點是 Self-hosted Runner。</em></p></blockquote><h4 id="self-hosted-runner-on-in-house-server"><span class="me-2">Self-hosted Runner on In-house Server</span><a href="#self-hosted-runner-on-in-house-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>將自己的機器作為 Runner<li><strong>一台實體機器可以起多個 Runner 並發接任務來做</strong><li><strong>免費無限量無限制使用</strong> 只有機器購買成本，花一次使用到飽！ 以 32G RAM M4 Mini (=NT$40,900) 計算，如果用 GitHub Hosted Runner 一個月要花 500 USD； <strong>買一台架設好用超過三個月就回本</strong> 了！<li>支援 Windows, macOS, Linux (x64/ARM/ARM64)<li><strong>同個組織可以跨 Repo 共享 Runner</strong><li><strong>⚠️目前：actions/cache, actions/upload-artifact, actions/download-artifact 都只支援 GitHub 雲端服務，代表這些內容還是會上傳到 GitHub 伺服器並計算儲存量收費。</strong> 可以在自己的機器上開共用目錄取代。<li>Self-hosted Runner 也支援 <a href="https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller" target="_blank">Docker, k8s</a> 只是我沒研究。</ul><blockquote><p><strong><em>架設 Self-hosted Runner 只需幾步 (10 分鐘內設定好) 就能上線開始接任務執行(本文稍後會介紹)。</em></strong></p></blockquote><h4 id="github-workflow-x-job-x-step-x-runner-流程關係圖"><span class="me-2">GitHub Workflow x Job x Step x Runner 流程關係圖</span><a href="#github-workflow-x-job-x-step-x-runner-流程關係圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*WHIVfXdVRoEsdXGfJhu2Rw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*WHIVfXdVRoEsdXGfJhu2Rw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjczMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>這邊用一張圖總結工作流程與關係，假設我們有兩個 Workflow、兩個 Runner:</p><ul><li>CI —假設 R有 3 個 Jobs，每個 Job 各有幾個 Steps，Runner Label(run-on) — <code class="language-plaintext highlighter-rouge">self-hosted-app</code><li>CD — 有 4 個 Jobs，每個 Job 各有幾個 Steps，Runner Label(run-on) — <code class="language-plaintext highlighter-rouge">self-hosted-app</code><li>Runner — 有 2 個，Runner Label 也都是— <code class="language-plaintext highlighter-rouge">self-hosted-app</code></ul><p>同前述，Runner 跟 Workflow 是依照 Runnler Label 來派發、接收任務來做，這個案例都是用同個 <code class="language-plaintext highlighter-rouge">self-hosted-app</code> Runner Label，Workflow 的 Jobs 預設是並發執行、Steps 是每個 Job 的實際執行內容，串行照順序執行，Steps 都執行完等於 Job 執行完畢。</p><blockquote><p><strong><em>因此 Workflow 實際執行的時間軸會是在兩個 Runner 之間穿梭執行 Job，也會並發執行、當前 Job 執行完下一個也不一定是接著同個 Worflow 的下一個 Job。</em></strong></p></blockquote><blockquote><p><em>⚠️ 所以才說確保每個 Job 是獨立的很重要 (尤其在 Self-hosted Runner 環境之下，Job 結束之後可能不會清除的太乾淨，我們可能會下意識覺得這個 Job 的產出，下一個 Job 可以接著做事)，不應該這樣用。</em></p></blockquote><h4 id="如果-job-有產出要給後續的-job-使用"><span class="me-2">如果 Job 有產出要給後續的 Job 使用:</span><a href="#如果-job-有產出要給後續的-job-使用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>Job Output String</strong> : 輸出純文字到變數給其他 Job 引用<li><strong>Artifact-upload/download:</strong> Job 的 Step 最後一步將執行結果上傳到 GitHub Artifact，另一個 Job 的第一個 Step 下載回來繼續處理使用。 e.g. 例如 Job — 打包 → 將打包結果 .ipa 傳到 <strong>Artifact →</strong> Job — 部署 → 下載回來 .ipa → 上傳 App Store 部署 要注意： <strong>目前就算是 Self-hosted 也是會上 GitHub Artifact 雲儲存。</strong><li><strong>AWS/GCP…雲端儲存</strong> : 同上，只是是用自己的雲端儲存服務。<li><strong>[Self-hosted Only] 共用硬碟、目錄:</strong> Self-hosted Runner 如果都有掛載一個共用目錄，則可用這個目錄依照 UUID 建立資料夾存放產出結果，然後後續 Job 去讀取前一個 Job Output UUID 去找到對應的儲存再拿回來用。 要注意，不同主機的 Runner 也都要掛載同個共用目錄。<li>在同個 Job 的 Steps 把所有事情做完。</ul><h3 id="做中學-github-actions--案例實作"><span class="me-2">做中學 GitHub Actions — 案例實作</span><a href="#做中學-github-actions--案例實作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>「坐而言，不如起而行」以上名詞解釋跟流程架構介紹相信大家也是看得懵懵懂懂，接下來會直接舉三個功能例子，帶大家實際動手做，並一邊解釋碰到的東西，從做當中學習，以了解 GitHub Actions 到底是什麼。</p><h3 id="案例--1"><span class="me-2">案例 — 1</span><a href="#案例--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>建立 Pull Request 後自動標記 File Changes Size Label 讓 Reviewer 方便安排 Review 工作。</p><h4 id="成果圖"><span class="me-2">成果圖</span><a href="#成果圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*vjSWeu2zB-hmVpfziMDR5Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*vjSWeu2zB-hmVpfziMDR5Q.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzQiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><h4 id="運作流程"><span class="me-2">運作流程</span><a href="#運作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>使用者開 PR、重開 PR、Push 新 Commit 到 PR<li>觸發 GitHub Actions Workflow<li>shell script 取的 file changes 數量<li>判斷數量對 PR 標記上 Label<li>完成</ul><h4 id="動手做"><span class="me-2">動手做</span><a href="#動手做" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>檔案名稱：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></p><p>Action Workflow 可以每個任務獨立一個檔案，也可以依照觸發事件、目的，同個目的聚合在同個檔案，反正多個 Job 是並發執行的，另外 <strong>因為 GitHub Actions 暫時不支援目錄結構，所以檔案少一點、使用階層命名檔案會比較好管理</strong> 。</p><p>這邊把 PR 相關事件的 Actions 都放在同個 Workflow。</p><h4 id="automation-pullrequestyml"><span class="me-2"><code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></span><a href="#automation-pullrequestyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># Actions Log 的標題名稱</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[Pull</span><span class="nv"> </span><span class="s">Reqeust</span><span class="nv"> </span><span class="s">Automation]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.event.pull_request.title</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 開啟、重開、有新 Push Commit 時</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同個 Concurrency Group 如果有新的 Job 會取消正在跑的</span>
<span class="c1"># 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># Job 名稱 (可省略，有設定在 Log 顯示比較好讀)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by changes file count</span>

    <span class="c1"># 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>

    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作</span>
    <span class="c1"># 如果是 Private Repo 會計算用量，超過可能會產生費用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># 工作步驟</span>
    <span class="c1"># 工作步驟會照順序執行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步驟名稱</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get changed file count and apply label</span>
        <span class="c1"># 步驟 ID (可省略，後續若沒有 Step 要引用 Output 輸出則不需設定)</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">get-changed-files-count-by-gh</span>
        <span class="c1"># 注入外部環境參數到執行階段</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="c1"># gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有權限操作  </span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="c1"># Shell script</span>
        <span class="c1"># GitHub Hosted Runner 內建都有安裝好 gh cli，不需要安裝 Job 就能直接使用</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">#   ${{ github.xxx }} 是 GitHub Actions Context 表達式</span>
          <span class="s">#   不是 Shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值</span>
          <span class="s">#   其他參數：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          
          <span class="s"># 取得 PR 編號:</span>
          <span class="s">PR_NUMBER=${{ github.event.pull_request.number }}</span>

          <span class="s"># 取得 Repo:</span>
          <span class="s">REPO=${{ github.repository }}</span>

          <span class="s"># 使用 GitHub API (gh cli) 取得 File changed 數量</span>
          <span class="s">FILE_COUNT=$(gh pr view $PR_NUMBER --repo $REPO --json files --jq '.files | length')</span>
          
          <span class="s"># Print Log</span>
          <span class="s">echo "Changed file count: $FILE_COUNT"</span>

          <span class="s"># Label 邏輯</span>
          <span class="s">if [ "$FILE_COUNT" -lt 5 ]; then</span>
            <span class="s">LABEL="XS"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 10 ]; then</span>
            <span class="s">LABEL="S"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 30 ]; then</span>
            <span class="s">LABEL="M"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 80 ]; then</span>
            <span class="s">LABEL="L"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 200 ]; then</span>
            <span class="s">LABEL="XL"</span>
          <span class="s">else</span>
            <span class="s">LABEL="XXL"</span>
          <span class="s">fi</span>

          <span class="s"># 使用 GitHub API (gh cli) 移除目前的 Size Label</span>
          <span class="s">EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')</span>
          <span class="s">for EXISTING in $EXISTING_LABELS; do</span>
            <span class="s">case "$EXISTING" in</span>
              <span class="s">XS|S|M|L|XL|XXL)</span>
                <span class="s">echo "🧹 Removing existing label: $EXISTING"</span>
                <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"</span>
                <span class="s">;;</span>
            <span class="s">esac</span>
          <span class="s">done</span>

          <span class="s"># (可選)如果 Label 不存在則建立</span>
          <span class="s">if ! gh label list --repo "$REPO" | grep -q "^$LABEL"; then</span>
            <span class="s">echo "🆕 Creating missing label: $LABEL"</span>
            <span class="s">gh label create "$LABEL" --repo "$REPO" --description "Size label: $LABEL" --color "ededed"</span>
          <span class="s">else</span>
            <span class="s">echo "✅ Label '$LABEL' already exists"</span>
          <span class="s">fi</span>
          
          <span class="s"># 使用 GitHub API (gh cli) 標記上 Label</span>
          <span class="s">gh pr edit $PR_NUMBER --repo $REPO --add-label "$LABEL"</span>
</pre></table></code></div></div><p>Commit 檔案到 Repo 主分支之後，我們再開新 PR 就會自動觸發 GitHub Actions：</p><p><a href="/assets/404bd5c70040/1*wdAztL0BgPeSZdqXxqUEXg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*wdAztL0BgPeSZdqXxqUEXg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MzgiIGhlaWdodD0iNzQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Action 執行狀態顯示 <strong>Queued</strong> 代表任務正在等待 Runner 接任務回去做。</p><h4 id="執行結果"><span class="me-2">執行結果</span><a href="#執行結果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*-JoD8IQYHVrDqHmLmrXyaQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*-JoD8IQYHVrDqHmLmrXyaQ.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijg1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><p>執行完畢並且成功後 PR 上就會自動標記好對應的 Label 了！紀錄會顯示由 <code class="language-plaintext highlighter-rouge">github-actions</code> 標記。</p><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><h4 id="直接使用別人包好的-action-步驟-pascalgnsize-label-action"><span class="me-2">直接使用別人包好的 Action 步驟： <a href="https://github.com/pascalgn/size-label-action/tree/main" target="_blank">pascalgn/size-label-action</a></span><a href="#直接使用別人包好的-action-步驟-pascalgnsize-label-action" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前面有說到可以直接使用別人封裝好的 Action，標記 PR Size Label 這任務已經有現成的輪子可以使用，上述只是為了教學目的，實際上不需要自己重造輪子。</p><p>只需要在 Action Workflow Job Step 中直接使用就能完成任務：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 開啟、重開、有新 Push Commit 時</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同個 Concurrency Group 如果有新的 Job 會取消正在跑的</span>
<span class="c1"># 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># Job 名稱 (可省略，有設定在 Log 顯示比較好讀)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by changes file count</span>

    <span class="c1"># 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>

    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作</span>
    <span class="c1"># 如果是 Private Repo 會計算用量，超過可能會產生費用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># 工作步驟</span>
    <span class="c1"># 工作步驟會照順序執行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步驟名稱</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get changed file count and apply label</span>
        <span class="c1"># 步驟 ID (可省略，後續若沒有 Step 要引用 Output 輸出則不需設定)</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">get-changed-files-count-by-gh</span>
        <span class="c1"># 直接使用別人封裝好的程式</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pascalgn/size-label-action@v0.5.5"</span>
        <span class="c1"># 注入外部環境參數到執行階段</span>
        <span class="c1"># 參數命名、可用參數要參考說明：https://github.com/pascalgn/size-label-action/tree/main</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token (github-actions 身份)，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">secrets.GITHUB_TOKEN</span><span class="nv"> </span><span class="s">}}"</span>
</pre></table></code></div></div><p><a href="https://github.com/pascalgn/size-label-action/tree/main" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/1e5c6f52127032dc1a5fea71a498fa9cc585987880889f0306ef705de3990867/pascalgn/size-label-action" alt="" loading="lazy"></a></p><p>這個包好的 Action 是 JavaScript Action，實際執行程式碼可以參考以下檔案： <a href="https://github.com/pascalgn/size-label-action/blob/main/dist/index.js" target="_blank">dist/index.js</a> 。</p><h4 id="name-run-name-的補充"><span class="me-2">name, run-name 的補充：</span><a href="#name-run-name-的補充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*zBmjm_3AU53NN0UhTrmOBQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*zBmjm_3AU53NN0UhTrmOBQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDEyIiBoZWlnaHQ9IjU2OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>name: Action Workflow 的名稱<li>run-name: 執行紀錄的標題名稱 (可帶入 PR Title or Branch or Author…etc) 如果是 on:pull_request 事件預設是 PR Title。</ul><h3 id="案例--2"><span class="me-2">案例 — 2</span><a href="#案例--2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>建立 Pull Request 後如果沒有 Assignee 則自動 Assign 作者自己並且 Comment 提示。(只有在初次建立時才會執行)</p><h4 id="成果圖-1"><span class="me-2">成果圖</span><a href="#成果圖-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*EL-0nQF7jhP34d6ZoSkJAg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*EL-0nQF7jhP34d6ZoSkJAg.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><h4 id="運作流程-1"><span class="me-2">運作流程</span><a href="#運作流程-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>使用者開 PR<li>觸發 GitHub Actions Workflow<li>github script 取得 assignee<li>如果沒有 asignee 則 assign 開 PR 的作者 &amp; Comment 訊息<li>完成</ul><h4 id="動手做-1"><span class="me-2">動手做</span><a href="#動手做-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>檔案名稱：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code> (同上)</p><h4 id="automation-pullrequestyml-1"><span class="me-2"><code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></span><a href="#automation-pullrequestyml-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># Actions Log 的標題名稱</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Pull</span><span class="nv"> </span><span class="s">Reqeust</span><span class="nv"> </span><span class="s">Automation</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">Daily</span><span class="nv"> </span><span class="s">Checker"</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 開啟、重開、有新 Push Commit 時</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同個 Concurrency Group 如果有新的 Job 會取消正在跑的</span>
<span class="c1"># 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># 請參考前文，略....</span>
  <span class="c1"># ---------</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Automatically assign to self if no assignee is specified</span>
    <span class="c1"># 因為是共用觸發事件，所以在 Job 上自己判斷，當是 Pull Request Opened(首次建立) 時才執行 Job 否則會 Skipped</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened'</span>

    <span class="c1"># 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>
    
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作</span>
    <span class="c1"># 如果是 Private Repo 會計算用量，超過可能會產生費用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Assign self if No Assignee</span>
        <span class="c1"># 使用 GitHub Script (JavaScript) 撰寫腳本 (Node.js 環境)</span>
        <span class="c1"># 相較上面直接用 Shell Script 寫起來更方便漂亮</span>
        <span class="c1"># 也不需要自行注入環境變數、GITHUB_TOKEN</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">// github-script 中會自動注入到 context 變數供 javascript 直接引用</span>
            <span class="s">// https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>

            <span class="s">const issue = context.payload.pull_request; // 如果要連 Issue 一起支援可寫成 context.payload.issue || context.payload.pull_request</span>
            <span class="s">const assignees = issue.assignees || [];</span>
            <span class="s">const me = context.actor;</span>

            <span class="s">if (assignees.length === 0) {</span>
              <span class="s">// Assignee 設成自己</span>
              <span class="s">await github.rest.issues.addAssignees({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">issue_number: issue.number,</span>
                <span class="s">assignees: [me]</span>
              <span class="s">});</span>

              <span class="s">// 留言通知</span>
              <span class="s">await github.rest.issues.createComment({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">issue_number: issue.number,</span>
                <span class="s">body: `🔧 No assignee was set, so I have assigned this to myself (@${me}).`</span>
              <span class="s">});</span>
            <span class="s">}</span>
</pre></table></code></div></div><p>這次我們示範改用 GitHub Script (JavaScript) 撰寫腳本，程式碼語法上更彈性更好撰寫。</p><p>當然如果你想照我之前說的每個任務一個檔案，就可以拔掉 Job If. . 直接在 Action Workflow 觸發條件設定：</p><p><code class="language-plaintext highlighter-rouge">Automation-PullRequest-Auto-Assign.yml</code> <strong>：</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation - Auto Assignee Self</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 開啟時</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Automatically assign to self if no assignee is specified</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 請參考前文，略....</span>
</pre></table></code></div></div><p>Commit 檔案到 Repo 主分支之後，我們再開新 PR 就會自動觸發 GitHub Actions：</p><p><a href="/assets/404bd5c70040/1*Y-A6owUibNEFBoRFHnqIYg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Y-A6owUibNEFBoRFHnqIYg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjcxIiBoZWlnaHQ9IjcwOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>現在有兩個 Job 要執行了！</p><h4 id="執行結果-1"><span class="me-2">執行結果</span><a href="#執行結果-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*23muCVgUJKmZt746khBMFQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*23muCVgUJKmZt746khBMFQ.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjExMDEiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><p>執行完畢並且成功後 PR 如果沒有 Asignees 會自動 Assign PR 作者並且 Comment 訊息。(都是用 <code class="language-plaintext highlighter-rouge">github-actions</code> 身份操作)</p><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><h4 id="測試重開reopened-pr"><span class="me-2">測試重開(Reopened) PR</span><a href="#測試重開reopened-pr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*mcDa7TZjv6mO7HtwhOE-Vw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*mcDa7TZjv6mO7HtwhOE-Vw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNDA3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可看到只會執行 Size Label Job，Auto Assignee Job 被 Skipped 了。</p><blockquote><p><em>這個任務也有人包好 Action 可以直接復用，可參考： <a href="https://github.com/pozil/auto-assign-issue" target="_blank">pozil/auto-assign-issue</a> 。</em></p></blockquote><h3 id="案例--3"><span class="me-2">案例 — 3</span><a href="#案例--3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>每日早上 9 點自動統計當前 PR 數量及已開啟多久時間發送通知訊息到 Slack 工作尋組、自動關閉已開啟超過 3 個月的 PR。</p><h4 id="成果圖-2"><span class="me-2">成果圖</span><a href="#成果圖-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDgiIGhlaWdodD0iMTQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*Nbg3r1zzhx24YIBEjPJnaw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Nbg3r1zzhx24YIBEjPJnaw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjgiIGhlaWdodD0iMTg3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Slack 工作群組每天早上自動收到報告<li>自動關閉超過 90 天的 PR</ul><h4 id="運作流程-2"><span class="me-2">運作流程</span><a href="#運作流程-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub Actions 每天早上 9 點自動觸發<li>觸發 GitHub Actions Workflow<li>github script 取得 開啟中的 PR 列表、統計開啟了幾天<li>傳送統計報告訊息到 Slack<li>關閉超過 90 天的 PR<li>完成</ul><h4 id="動手做-2"><span class="me-2">動手做</span><a href="#動手做-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>檔案名稱：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest-Daily.yml</code></p><h4 id="automation-pullrequest-dailyyml"><span class="me-2">Automation-PullRequest-Daily.yml</span><a href="#automation-pullrequest-dailyyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation - Daily Checker</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 排程定時自動執行</span>
  <span class="c1"># https://crontab.guru/</span>
  <span class="c1"># UTC 時間</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># UTC 的 01:00 = 每天 UTC+8 的 09:00</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>
  <span class="c1"># 手動觸發</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">caculate-pr-status</span><span class="pi">:</span>
    <span class="c1"># Job 名稱 (可省略，有設定在 Log 顯示比較好讀)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Caculate PR Status</span>
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作</span>
    <span class="c1"># 如果是 Private Repo 會計算用量，超過可能會產生費用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># Job Output</span>
    <span class="na">outputs</span><span class="pi">:</span>
      <span class="na">pr_list</span><span class="pi">:</span> <span class="s">${{ steps.pr-info.outputs.pr_list }}</span>

    <span class="c1"># 工作步驟</span>
    <span class="c1"># 工作步驟會照順序執行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步驟名稱</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fetch open PRs and caculate</span>
        <span class="c1"># Step 外部要引用 Output 輸出，需設定</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">pr-info</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">const now = new Date();</span>
            <span class="s">const per_page = 100;</span>
            <span class="s">let page = 1;</span>
            <span class="s">let allPRs = [];</span>
      
            <span class="s">while (true) {</span>
              <span class="s">const { data: prs } = await github.rest.pulls.list({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">state: 'open',</span>
                <span class="s">per_page,</span>
                <span class="s">page,</span>
              <span class="s">});</span>
              <span class="s">if (prs.length === 0) break;</span>
              <span class="s">allPRs = allPRs.concat(prs);</span>
              <span class="s">if (prs.length &lt; per_page) break;</span>
              <span class="s">page++;</span>
            <span class="s">}</span>
      
            <span class="s">const result = allPRs.map(pr =&gt; {</span>
              <span class="s">const created = new Date(pr.created_at);</span>
              <span class="s">const daysOpen = Math.floor((now - created) / (1000 * 60 * 60 * 24));</span>
              <span class="s">return {</span>
                <span class="s">pr: pr.number.toString(),</span>
                <span class="s">title: pr.title,</span>
                <span class="s">idle: daysOpen</span>
              <span class="s">};</span>
            <span class="s">});</span>

            <span class="s">// 設定回 Output，只接受 String</span>
            <span class="s">core.setOutput('pr_list', JSON.stringify(result));</span>
  <span class="c1"># ----</span>
  <span class="na">send-pr-summary-message-to-slack</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Send PR Summary Messag to Slack</span>
    <span class="c1"># Job 預設是並發，使用 needs 可以迫使當前 Job 等到 need Job 完成時才會執行</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">caculate-pr-status</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Generate Message</span>
        <span class="c1"># Step 外部要引用 Output 輸出，需設定</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">gen-msg</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);</span>
            <span class="s">const blocks = [];</span>
      
            <span class="s">// 標題</span>
            <span class="s">blocks.push({</span>
              <span class="s">type: "section",</span>
              <span class="s">text: {</span>
                <span class="s">type: "mrkdwn",</span>
                <span class="s">text: `📬 *Open PR Report*\nTotal: *${prList.length}* PR(s)`</span>
              <span class="s">}</span>
            <span class="s">});</span>
      
            <span class="s">// 每個 PR 一行</span>
            <span class="s">for (const pr of prList) {</span>
              <span class="s">blocks.push({</span>
                <span class="s">type: "section",</span>
                <span class="s">text: {</span>
                  <span class="s">type: "mrkdwn",</span>
                  <span class="s">text: `• &lt;https://github.com/${context.repo.owner}/${context.repo.repo}/pull/${pr.pr}|PR #${pr.pr}&gt; *${pr.title}* - 🕒 ${pr.idle} day(s)`</span>
                <span class="s">}</span>
              <span class="s">});</span>
            <span class="s">}</span>

            <span class="s">// 設定回 Output，只接受 String</span>
            <span class="s">core.setOutput('blocks', JSON.stringify(blocks));</span>

            
      <span class="c1"># 使用 Slack 官方封裝好的 Slack API Github Actions</span>
      <span class="c1"># https://tools.slack.dev/slack-github-action/sending-techniques/sending-data-slack-api-method/</span>
      <span class="c1"># 發送訊息</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post text to a Slack channel</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">slackapi/slack-github-action@v2.1.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">chat.postMessage</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
          <span class="na">payload</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}</span>
            <span class="s">blocks: ${{ steps.gen-msg.outputs.blocks }}</span>
  <span class="c1"># ----</span>
  <span class="na">auto-close-old-prs</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Auto Close Old PRs</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">caculate-pr-status</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Auto close PRs opened more than 90 days</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);</span>
            <span class="s">const oldPRs = prList.filter(pr =&gt; pr.idle &gt; 90);</span>

            <span class="s">for (const pr of oldPRs) {</span>
              <span class="s">await github.rest.pulls.update({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">pull_number: parseInt(pr.pr),</span>
                <span class="s">state: 'closed'</span>
              <span class="s">});</span>

              <span class="s">await github.rest.issues.createComment({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">issue_number: parseInt(pr.pr),</span>
                <span class="s">body: `⚠️ This pull request has been automatically closed because it has been open for more than 90 days. Please reopen if needed.`</span>
              <span class="s">});</span>
            <span class="s">}</span>
            <span class="s">console.log(`Closed ${oldPRs.length} PR(s)`);</span>
</pre></table></code></div></div><p>在這個範例中我們使用：</p><ul><li>on: schedule Crontab 排程自動觸發跟 workflow_dispatch 支援手動觸發<li>Job output/Step output (都只能是字串)<li>多個 Jobs 預設是並發但可以用 <code class="language-plaintext highlighter-rouge">needs</code> 時間依賴等待關係<li>從 Repo Secrets/Variables 取得設定<li>串接 Slack API</ul><p><strong>Repo Secrets — 新增</strong> <code class="language-plaintext highlighter-rouge">SLACK_BOT_TOKEN</code></p><p><a href="/assets/404bd5c70040/1*YC4DBHtKmX5XGgcSSzaE5A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*YC4DBHtKmX5XGgcSSzaE5A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjIxIiBoZWlnaHQ9Ijk4NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Slack App 建立、發訊息權限設定可參考我 <a href="/posts/zrealm-dev/slack-app-整合-chatgpt-利用-openai-api-與-google-cloud-functions-自建智能助理-bd94cc88f9c9/">之前的文章</a></ul><p><strong>Repo Variables — 新增</strong> <code class="language-plaintext highlighter-rouge">SLACK_TEAM_CHANNEL_ID</code></p><p><a href="/assets/404bd5c70040/1*X4gZ5_IRvsiehAL0O9AleQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*X4gZ5_IRvsiehAL0O9AleQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc0IiBoZWlnaHQ9Ijk5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Commit 檔案到 Repo 主分支之後，回到 Actions 手動觸發看看：</p><blockquote><p><em>日後會每日自動觸發。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*WNFKXl-QC2WGyaSWep5-DA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*WNFKXl-QC2WGyaSWep5-DA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ4IiBoZWlnaHQ9IjQzOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Actions → Pull Request Automation — Daily Checker → Run workflow → Branch: main → Run workflow。</p><p><strong>執行後可以點擊進入查看執行狀況：</strong></p><p><a href="/assets/404bd5c70040/1*4mvOxnd1uS4ZlxnNoNdHaQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*4mvOxnd1uS4ZlxnNoNdHaQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDg3IiBoZWlnaHQ9IjU0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*BluzFgY2tM2E7DwoVq1jQw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BluzFgY2tM2E7DwoVq1jQw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDMwIiBoZWlnaHQ9IjQ1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>因為有 <code class="language-plaintext highlighter-rouge">needs</code> 的限制，Jobs 流程就會是 <code class="language-plaintext highlighter-rouge">Cacluate PR Status</code> 先完成後才會並發執行 <code class="language-plaintext highlighter-rouge">Auto Close Old PRs</code> 和 <code class="language-plaintext highlighter-rouge">Send PR Summary Message to Slack</code> 。</p><h4 id="執行結果-2"><span class="me-2">執行結果</span><a href="#執行結果-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>任務都成功執行後可以查看 Slack 訊息：</strong></p><p><a href="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDgiIGhlaWdodD0iMTQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>成功 🚀🚀🚀</p><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest-Daily.yml" target="_blank">Automation-PullRequest-Daily.yml</a></strong></p><h3 id="小結"><span class="me-2">小結</span><a href="#小結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>希望上面三個案例能讓您對 GitHub Actions 有個初步的了解也希望有激起你的自動化工作創意，可以自己發想工作流程(請務必先參考 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">觸發事件</a> )，然後撰寫腳本執行；也記得先去 <a href="https://github.com/marketplace?type=actions" target="_blank"><strong>Marketplace</strong></a> 找找現有的步驟可以站在巨人的肩膀直接使用。</p></blockquote><p>本篇只是入門基礎(甚至沒 Checkout Code)，下一篇「 <a href="/posts/zrealm-dev/github-actions-ios-ci-cd-完整實作自動化建置-測試與部署流程教學-4b001d2e8440/"><strong>CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程</strong></a> 」會在介紹更複雜深入的 GitHub Actions Workflow。</p><h4 id="github-自動化延伸議題"><span class="me-2">GitHub 自動化延伸議題</span><a href="#github-自動化延伸議題" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GitHub 可以與 Slack 整合，訂閱 Repo 的 PR 更新通知、Push Default Branch 通知…等等。</p><p><a href="/assets/404bd5c70040/1*BMTT4koRBIIsQ7_mklC86w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BMTT4koRBIIsQ7_mklC86w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzkiIGhlaWdodD0iNDMwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>問題 1. GitHub 訊息無法標記到人，只標記了 GitHub 帳號，Slack 帳號收不到通知：</strong></p><p><a href="/assets/404bd5c70040/1*Ddp0cEtXE10hScM1rozmtg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Ddp0cEtXE10hScM1rozmtg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzAwIiBoZWlnaHQ9Ijk0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*uHGJ7l__AdYoWT9KpvihLQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*uHGJ7l__AdYoWT9KpvihLQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQzIiBoZWlnaHQ9Ijc3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://slack.github.com/" target="_blank">Slack App</a> or Apps 搜尋 GitHub → 打開訊息視窗 →完成 <strong>Connect GitHub Account</strong> 步驟，這樣 GitHub 才知道你對應的 Slack UID 是什麼，才能標記你。</p><p><strong>問題 2. Pull Request Reminder</strong></p><p>我記得這本來是第三方開發的功能，後來直接整合在 GitHub 裡面了，不要傻傻的自己用 GitHub Actions 寫腳本做！</p><p><a href="/assets/404bd5c70040/1*BpMd2K0NBDE6xB1XzFY94Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BpMd2K0NBDE6xB1XzFY94Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDA4IiBoZWlnaHQ9IjEyMDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><a href="https://docs.github.com/en/organizations/organizing-members-into-teams/managing-scheduled-reminders-for-your-team" target="_blank"><strong><em>GitHub 內建的是 by Team 設置，你需要先為組織增加 Team、Repo 加入 Team 然後才能設置 Pull Request Reminder。</em></strong></a></p></blockquote><ul><li>輸入完 Slack Channel 跟規則儲存之後每天就會自動傳送提示訊息跟標記 Reviewer 了，設置可 <a href="https://michaelheap.com/github-scheduled-reminders/" target="_blank">參考</a> ，結果如下圖：</ul><p><a href="/assets/404bd5c70040/1*kvqFXkIKIxP79Wm8vIaN0Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*kvqFXkIKIxP79Wm8vIaN0Q.webp" alt="[https://michaelheap.com/github-scheduled-reminders/](https://michaelheap.com/github-scheduled-reminders/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iMzE1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://michaelheap.com/github-scheduled-reminders/" target="_blank">https://michaelheap.com/github-scheduled-reminders/</a></p><p><strong>問題 4. GitHub PR 訊息，作者收不到通知：</strong></p><p><a href="/assets/404bd5c70040/1*wmtXwXAcQZDXqInRd0ivPw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*wmtXwXAcQZDXqInRd0ivPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTIiIGhlaWdodD0iNTM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>這是一個萬年的問題，就是 PR 的 Slack 訊息 <strong>其實作者並不知道有人 Reply Threads 討論</strong> ，GitHub 發的這則 Slack 訊息只會標記 Reviewers，不會標記 Assignee or PR 作者。</em></p></blockquote><p>這時候 GitHub Actions 做自動化小工具就派上用場了，我們可以加一個 Job 在 PR Description 最後 Append 標記作者，這樣訊息傳到 Slack 也會一並標記到作者的 Slack:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="c"># Workflow(Action) 名稱</span>
name: Pull Reqeust Automation
<span class="c"># 請參考前文，略....</span>

  <span class="c"># ---------</span>
  append-author-to-pr-description:
    name: Append author to PR description
    <span class="c"># 因為是共用觸發事件，所以在 Job 上自己判斷，當是 Pull Request Opened(首次建立) 時才執行 Job 否則會 Skipped</span>
    <span class="k">if</span>: github.event_name <span class="o">==</span> <span class="s1">'pull_request'</span> <span class="o">&amp;&amp;</span> github.event.action <span class="o">==</span> <span class="s1">'opened'</span>
    
    <span class="c"># 如果這個 Job 失敗，不影響整個 Workflow，繼續其他 Job</span>
    <span class="k">continue</span><span class="nt">-on-error</span>: <span class="nb">true</span>
    
    <span class="c"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    timeout-minutes: 10
    
    <span class="c"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 來執行工作</span>
    <span class="c"># 如果是 Private Repo 會計算用量，超過可能會產生費用</span>
    <span class="c"># 但這種自動化小工作不太容易用過量</span>
    runs-on: ubuntu-latest
    steps:
      - name: Append author to PR description
        <span class="nb">env</span>:
          <span class="c"># secrets.GITHUB_TOKEN 是 GitHub Actions 執行時自動產生的 Token，不需自行在 Secrets 設定，擁有一些 GitHub Repo API Scopes 權限</span>
          <span class="c"># gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有權限操作</span>
          <span class="c"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          GH_TOKEN: <span class="k">${</span><span class="p">{ secrets.GITHUB_TOKEN </span><span class="k">}</span><span class="o">}</span>

          <span class="c">#   ${{ github.xxx }} 是 GitHub Actions Context 表達式</span>
          <span class="c">#   不是 Shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值</span>
          <span class="c">#   其他參數：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          PR_NUMBER: <span class="k">${</span><span class="p">{ github.event.pull_request.number </span><span class="k">}</span><span class="o">}</span>
          AUTHOR_TAG: <span class="s1">'@${{ github.event.pull_request.user.login }}'</span>
        run: |
          <span class="nv">PR_BODY</span><span class="o">=</span><span class="si">$(</span>gh <span class="nb">pr </span>view <span class="nv">$PR_NUMBER</span> <span class="nt">--repo</span> <span class="k">${</span><span class="p">{ github.repository </span><span class="k">}</span><span class="o">}</span> <span class="nt">--json</span> body <span class="nt">-q</span> <span class="s2">".body"</span><span class="si">)</span>
          <span class="nv">NEW_BODY</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s2">"%s</span><span class="se">\n\n</span><span class="s2">Created by %s"</span> <span class="s2">"</span><span class="nv">$PR_BODY</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$AUTHOR_TAG</span><span class="s2">"</span><span class="si">)</span>
          gh <span class="nb">pr </span>edit <span class="nv">$PR_NUMBER</span> <span class="nt">--repo</span> <span class="k">${</span><span class="p">{ github.repository </span><span class="k">}</span><span class="o">}</span> <span class="nt">--body</span> <span class="s2">"</span><span class="nv">$NEW_BODY</span><span class="s2">"</span>
</pre></table></code></div></div><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><p>開 PR 時會自動在描述後加上作者資訊、Slack 訊息也會正確的標記作者：</p><p><a href="/assets/404bd5c70040/1*UtTDtIQJ0vJks79UzCQSAQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*UtTDtIQJ0vJks79UzCQSAQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NTMiIGhlaWdodD0iMzcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*MjVsFqE--xAq1zSQfCNVdQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*MjVsFqE--xAq1zSQfCNVdQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTYiIGhlaWdodD0iMjQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>問題 5. GitHub 瘋狂寄通知信到信箱很干擾：</strong></p><p>GitHub Repo 通知跟 Slack 都有設定好之後，統一都在 Slack 收通知了，可以去 GitHub 個人設定把 Email 通知關掉：</p><p><a href="/assets/404bd5c70040/1*INgfO9B2bNFy-Nd1ZjnzOw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*INgfO9B2bNFy-Nd1ZjnzOw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzA2IiBoZWlnaHQ9IjY4NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="其他"><span class="me-2">其他</span><a href="#其他" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Actions 目前沒有目錄結構，但可以在 Actions 頁，置頂(Pin) 五個 Actions；也可以使用 Disable 暫停某個 Action。</p><p><a href="/assets/404bd5c70040/1*ZD-5xkparhJqtnm2REeu6A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*ZD-5xkparhJqtnm2REeu6A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>可以在 Insights 查看 GitHub Actions 用量跟執行成效：</p><p><a href="/assets/404bd5c70040/1*re91ZRtQ0frOF6GVJ-MKrw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*re91ZRtQ0frOF6GVJ-MKrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU5MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h3 id="reuse-workflow-補充"><span class="me-2">Reuse Workflow 補充</span><a href="#reuse-workflow-補充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/posts/zrealm-dev/ci-cd-打包工具平台-使用-google-apps-script-web-app-串接-github-actions-提升跨團隊效率-4273e57e7148/">下一篇文章</a> 有用到同個 Repo 拆 Reuse Workflow，這邊補充一下不同 Repo 拆 Reuse Workflow 的範例。</p><p>先定義一個 Reuse Workflow: <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank"><strong>Automation-label-pr-base-branch.yml:</strong></a> <strong>在 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank">ZhgChgLi/github-actions-ci-cd-demo-share-actions</a> Repo</strong> 。</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Automation-label-pr-base-branch</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[Automation-label-pr-base-branch]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.event.inputs.PR_NUMBER</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.event.inputs.PR_NUMBER || github.ref }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 其他 Workflow 呼叫此 Workflow 觸發</span>
  <span class="na">workflow_call</span><span class="pi">:</span>
    <span class="c1"># 資料輸入</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># PR Number</span>
      <span class="na">PR_NUMBER</span><span class="pi">:</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="c1"># 密鑰輸入</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="na">GH_TOKEN</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GitHub</span><span class="nv"> </span><span class="s">token</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">access"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">label-pr-base-branch</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR Base Branch</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by Base Branch</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">label-pr-base-branch</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">PR_NUMBER="${{ inputs.PR_NUMBER }}"</span>
          <span class="s">REPO="${{ github.repository }}"</span>

          <span class="s">echo "📦 Processing PR #$PR_NUMBER in repo $REPO"</span>

          <span class="s"># 取得 PR 的 base branch</span>
          <span class="s">BASE_BRANCH=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json baseRefName --jq '.baseRefName')</span>
          <span class="s">echo "🔖 PR Base Branch: $BASE_BRANCH"</span>

          <span class="s"># 允許的 base branch labels</span>
          <span class="s">BRANCH_LABELS=("develop" "main" "master")</span>

          <span class="s"># Label 是否在允許列表</span>
          <span class="s">if [[ " ${BRANCH_LABELS[@]} " =~ " ${BASE_BRANCH} " ]]; then</span>
            <span class="s">LABEL="$BASE_BRANCH"</span>
          <span class="s">else</span>
            <span class="s">echo "⚠️ Base branch '$BASE_BRANCH' not in allowed list, skipping label."</span>
            <span class="s">exit 0</span>
          <span class="s">fi</span>

          <span class="s"># 移除現有的 base branch labels</span>
          <span class="s">EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')</span>
          <span class="s">for EXISTING in $EXISTING_LABELS; do</span>
            <span class="s">if [[ " ${BRANCH_LABELS[@]} " =~ " ${EXISTING} " ]]; then</span>
              <span class="s">echo "🧹 Removing existing base branch label: $EXISTING"</span>
              <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"</span>
            <span class="s">fi</span>
          <span class="s">done</span>

          <span class="s"># 如果 Label 不存在則建立</span>
          <span class="s">if ! gh label list --repo "$REPO" | grep -q "^$LABEL$"; then</span>
            <span class="s">echo "🆕 Creating missing label: $LABEL"</span>
            <span class="s">gh label create "$LABEL" --repo "$REPO" --description "PR targeting $LABEL branch" --color "ededed"</span>
          <span class="s">else</span>
            <span class="s">echo "✅ Label '$LABEL' already exists"</span>
          <span class="s">fi</span>

          <span class="s"># 加上 base branch label</span>
          <span class="s">echo "🏷️ Adding label '$LABEL' to PR #$PR_NUMBER"</span>
          <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --add-label "$LABEL"</span>
</pre></table></code></div></div><p>回到我們的 <strong>主 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">ZhgChgLi/github-actions-ci-cd-demo</a> Repo，</strong> 新增一個主 <strong>Workflow <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">Demo-Reuse-Action-From-Another-Repo.yml</a> :</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Automation-label-pr-base-branch</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">call-label-pr-workflow</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Call Base Branch Label Workflow</span>
    <span class="c1"># ✅ 如果被呼叫的 workflow 在同一個 repo：</span>
    <span class="c1">#    uses: ./.github/workflows/Automation-label-pr-base-branch.yml</span>
    <span class="c1">#    注意：這種寫法無法指定分支（固定使用 caller workflow 的 branch）</span>
    <span class="c1">#    參考範例：</span>
    <span class="c1">#    - CD-Deploy-Form.yml 呼叫本 repo workflow</span>
    <span class="c1">#    - CD-Deploy.yml 呼叫跨 repo workflow</span>
    <span class="c1">#</span>
    <span class="c1"># ✅ 如果被呼叫的 workflow 在其他 repo：</span>
    <span class="c1">#    uses: {owner}/{repo}/.github/workflows/{file}.yml@{branch_or_tag}</span>
    <span class="c1">#    可以指定 branch 或 tag</span>
    <span class="c1">#    ref: https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">PR_NUMBER</span><span class="pi">:</span> <span class="s">${{ github.event.number }}</span>
      
    <span class="c1"># 如果所有 secrets 都要繼承 caller workflow，直接用 `inherit`</span>
    <span class="c1"># secrets: inherit</span>
    <span class="c1">#</span>
    <span class="c1"># 如果只要傳特定 secrets，個別指定</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
</pre></table></code></div></div><p>Commit 檔案後開 PR 試試看。</p><p><strong>工作流程：主 Repo 的 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">Demo-Reuse-Action-From-Another-Repo.yml</a> → 呼叫並把參數傳到另一個 Repo 的 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank">Automation-label-pr-base-branch.yml</a> 執行任務 → 回到主 Repo 回報結果。</strong></p><p><a href="/assets/404bd5c70040/1*13bqlAgpBkHM7UthTJAuOg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*13bqlAgpBkHM7UthTJAuOg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE5IiBoZWlnaHQ9IjQ1MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*CAF3HzS4PHBveDQYu3H73g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*CAF3HzS4PHBveDQYu3H73g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDIiIGhlaWdodD0iMTQ1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>成功！</p><h4 id="private-repo-存取問題"><span class="me-2">Private Repo 存取問題</span><a href="#private-repo-存取問題" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>這邊要注意一個安全性問題，Public Repo 完全沒問題，但如果 Reuse Workflow 在 Private Repo 當中，只有在 <strong>同個組織下的其他 Repo + Repo 同樣也是 Private + 設定允許</strong> =才能存取使用 Private Repo Reuse Workflow。</p><ul><li><code class="language-plaintext highlighter-rouge">Public — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private or Public-ZhgChgli or harry/myRepo</code> = ✅<li><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private or Public— harry/myRepo</code> = ❌<li><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Public — ZhgChgLi/anotherRepo</code> = ❌<li><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/anotherRepo</code> = ✅</ul><p><strong>設定允許的方式，要去 Reuse Workflow Repo → Settings → Actions → General → Acces:</strong></p><p><a href="/assets/404bd5c70040/1*iZCEifgyArTJS3URMSk01g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*iZCEifgyArTJS3URMSk01g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjUiIGhlaWdodD0iMzAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>改勾選：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Accessible from repositories in the 'ZhgChgLi' organization
Workflows in other repositories that are part of the 'ZhgChgLi' organization can access the actions and reusable workflows in this repository. Access is allowed only from private repositories.
</pre></table></code></div></div><p>點擊「Save」儲存，完成。</p><p><strong>如果沒權限存取會出現以下錯誤訊息：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Invalid workflow file: .github/workflows/Demo-reuse-action-from-another-repo.yml#L21
error parsing called workflow
<span class="s2">".github/workflows/Demo-reuse-action-from-another-repo.yml"</span>
-&gt; <span class="s2">"ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main"</span>
: workflow was not found.
</pre></table></code></div></div><h3 id="github-actions-script-語法補充"><span class="me-2">GitHub Actions Script 語法補充</span><a href="#github-actions-script-語法補充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>補充一下大家可能會感到疑惑的 <code class="language-plaintext highlighter-rouge">${{ XXX }}</code> or <code class="language-plaintext highlighter-rouge">${XXX}</code> or <code class="language-plaintext highlighter-rouge">$XXX</code> 變數語法。</p><p><strong>Demo-Env-Vars- .yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Demo-Env-Vars</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">print-env-vars</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">print-env</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">env</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">context-vars-vs-vars</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">SAY_MY_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Heisenberg"</span>
          <span class="c1"># GitHub Actions Context 表達式，同下方解釋</span>
          <span class="na">FROM_REF</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># Sehll Script:</span>
          <span class="s"># 引用自訂注入的 ENV 變數內容</span>
          <span class="s"># ${SAY_MY_NAME} or $SAY_MY_NAME 都可以</span>
          <span class="s"># ${XX} 遇到字串拼接比較好用:</span>
          <span class="s">echo "HI: ${SAY_MY_NAME}"</span>
          
          <span class="s"># 💡 GitHub Actions Context 表達式</span>
          <span class="s"># 這不是 shell 變數，而是 YAML 解析階段由 GitHub Actions 替換成對應值</span>
          <span class="s"># ⚠ 在本機或非 GitHub Actions 環境執行會失敗</span>
          <span class="s"># 🔗 https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          <span class="s">BRANCH_NAME_FROM_CONTEXT="${{ github.ref }}"</span>
          
          <span class="s"># 💡 GitHub Actions 執行階段的環境變數</span>
          <span class="s"># 這些變數在 runner 執行 shell 時由 GitHub Actions 自動注入</span>
          <span class="s"># ✅ 在其他環境可用 export 或 ENV 預先定義相同變數</span>
          <span class="s"># 🔗 https://docs.github.com/en/actions/learn-github-actions/environment-variables</span>
          <span class="s">BRANCH_NAME_FROM_ENV_VARS="${GITHUB_REF}"</span>
          
          <span class="s">echo "FROM_REF: ${FROM_REF}"</span>
          <span class="s">echo "BRANCH_NAME_FROM_CONTEXT: ${BRANCH_NAME_FROM_CONTEXT}"</span>
          <span class="s">echo "BRANCH_NAME_FROM_ENV_VARS: ${BRANCH_NAME_FROM_ENV_VARS}"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">print-github-script-env</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">SAY_MY_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Heisenberg"</span>
          <span class="c1"># GitHub Actions Context 表達式，同上方解釋</span>
          <span class="na">FROM_REF</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">// GitHub Script: (JavaScript (Node.js)):</span>
            <span class="s">// 從 process.env 取 ENV 值</span>
            <span class="s">console.log(`HI: ${process.env.SAY_MY_NAME}`);</span>
            <span class="s">console.log(`FROM_REF: ${process.env.FROM_REF}`);</span>
            <span class="s">// github-script 中會自動注入到 context 變數供 javascript 直接引用</span>
            <span class="s">// https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
            <span class="s">const branch_name_from_context_vars = context.ref;</span>
            <span class="s">console.log(`branch_name_from_context_vars: ${branch_name_from_context_vars}`);</span>
            <span class="s">// 同樣也能用 GitHub Actions Context 表達式(只是意義不大):</span>
            <span class="s">const branch_name_from_context = "${{ github.ref }}";</span>
            <span class="s">console.log(`branch_name_from_context: ${branch_name_from_context}`);</span>
            
            <span class="s">for (const [key, value] of Object.entries(process.env)) {</span>
              <span class="s">console.log(`${key}=${value}`);</span>
            <span class="s">}</span>
            <span class="s">// github-script 中的 github 物件是 Octokit REST API 實例</span>
            <span class="s">// 用來操作 github api 使用</span>
            <span class="s">// 例如：</span>
            <span class="s">// await github.rest.pulls.list({</span>
            <span class="s">//   owner: context.repo.owner,</span>
            <span class="s">//   repo: context.repo.repo,</span>
            <span class="s">//   state: "open"</span>
            <span class="s">//  });</span>
      <span class="c1"># gh CLI does NOT use GITHUB_TOKEN by default; requires GH_TOKEN</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">gh CLI without GH_TOKEN (expected to fail)</span>
        <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')</span>
          <span class="s">echo "Found $PR_COUNT open pull requests"</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">gh CLI with GH_TOKEN (expected to succeed)</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># Assign GH_TOKEN so gh CLI can authenticate</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')</span>
          <span class="s">echo "Found $PR_COUNT open pull requests"</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">github-script auto-authentication (no GH_TOKEN needed)</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">// github = Octokit REST client (auto-authenticated with GITHUB_TOKEN)</span>
            <span class="s">const pulls = await github.rest.pulls.list({</span>
              <span class="s">owner: context.repo.owner,</span>
              <span class="s">repo: context.repo.repo,</span>
              <span class="s">state: "open"</span>
            <span class="s">});</span>
            <span class="s">console.log(`Found ${pulls.data.length} open pull requests`);</span>
</pre></table></code></div></div><h4 id="--xxx---github-actions-context-表達式"><span class="me-2">${ { XXX } } GitHub Actions Context 表達式</span><a href="#--xxx---github-actions-context-表達式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*e3jpPuwdmf005cjbaXjAwQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*e3jpPuwdmf005cjbaXjAwQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3ODkiIGhlaWdodD0iNjg0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*ed5Wm7Xk48xuP8yQzHpJ9w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*ed5Wm7Xk48xuP8yQzHpJ9w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODAiIGhlaWdodD0iODAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><code class="language-plaintext highlighter-rouge">${{ XXX }}</code> 是 GitHub Actions Context 表達式， <strong>在YAML 解析階段由 GitHub Actions 替換成對應值</strong> (如上圖 <code class="language-plaintext highlighter-rouge">BRANCH_NAME_FROM_CONTEXT</code> )<li>完整可用表達式可 <a href="https://docs.github.com/en/actions/learn-github-actions/contexts#github-context" target="_blank">參考官方文件</a><li><code class="language-plaintext highlighter-rouge">${XXX}</code> or <code class="language-plaintext highlighter-rouge">$XXX</code> 是真實環境變數， <code class="language-plaintext highlighter-rouge">${XXX}</code> 在字串拼接比較好用<li>GitHub Actions 預設會注入一些環境變數，完整可 <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" target="_blank">參考官方文件</a></ul><h4 id="actionsgithub-scriptv7"><span class="me-2">actions/github-script@v7</span><a href="#actionsgithub-scriptv7" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*TjJQnlAAU3VRwS9_dFz1yA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*TjJQnlAAU3VRwS9_dFz1yA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MTgiIGhlaWdodD0iOTEzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*5bHEdjrGsVdWnYSQgpnsZA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*5bHEdjrGsVdWnYSQgpnsZA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDE4IiBoZWlnaHQ9IjExNTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><ul><li>在 <code class="language-plaintext highlighter-rouge">github-script</code> 中同樣可以用 <code class="language-plaintext highlighter-rouge">${{ XXX }}</code> 是 GitHub Actions Context 表達式，但是意義不大；因為 <strong>在 github-scirpt 環境中預設會注入 context 變數可以直接在 javascript 中引用</strong><li>在 <code class="language-plaintext highlighter-rouge">github-script</code> 中 <code class="language-plaintext highlighter-rouge">github</code> 物件是 Octokit REST API 實例<li><code class="language-plaintext highlighter-rouge">github-script</code> 也能從 <code class="language-plaintext highlighter-rouge">env:</code> 注入變數，但是要用 <code class="language-plaintext highlighter-rouge">${process.env.xxx}</code> 存取<li>同樣預設會注入一些環境變數，完整可 <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" target="_blank">參考官方文件</a> <code class="language-plaintext highlighter-rouge">${process.env.xxx}</code> 存取；但是已經有 <code class="language-plaintext highlighter-rouge">context</code> 變數了，從這存取意義也不大</ul><p><a href="/assets/404bd5c70040/1*oW85Sju0sN4caXiaLSg32A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*oW85Sju0sN4caXiaLSg32A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzUiIGhlaWdodD0iNDA4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><code class="language-plaintext highlighter-rouge">github-script</code> 會自動帶入 <code class="language-plaintext highlighter-rouge">github-token</code> ，無需指定</ul><h4 id="gh-cli-gh_token"><span class="me-2">gh cli GH_TOKEN</span><a href="#gh-cli-gh_token" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*NUfaaKIobZWVBuXrGg0TPw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*NUfaaKIobZWVBuXrGg0TPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NjYiIGhlaWdodD0iNDMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>在 GitHub Actions Shell Script 使用 <code class="language-plaintext highlighter-rouge">gh cli</code> 需指定 <code class="language-plaintext highlighter-rouge">GH_TOKEN</code> 參數<li>可以直接帶入預設 Token — <code class="language-plaintext highlighter-rouge">secrets.GITHUB_TOKEN</code> (GitHub Actions 執行時自動產生)<li><strong>預設 Token 有一些基本權限，如果要操作的指令權限不夠就要改用 <a href="https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows" target="_blank">Personal Access Token</a></strong> ，團隊使用建議用共用帳號建立 PAT。</ul><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Env-Vars-.yml" target="_blank">Demo-Env-Vars- .yml</a></strong></p><p>GitHub Actions 已經開發好了，下一步我們可以抽換 GitHub Hosted Runner 成自己的 Self-hosted Runner。</p><blockquote><p><em>GitHub Hosted Runner 有免費額度 2,000 分鐘一個月(起)，跑這種小的自動化任務花不了多少時間，而且是跑在 linux 機器花費很低，可能還用不到免費上限； <strong>不一定要改成 Self-hosted Runner</strong> ，改 Runner 還要確保 Runner 環境正確(例如 GitHub Hosted Runner 自帶 gh cli，self-hosted Runner 就記得要自己安裝好)， <strong>本文純粹是因為教學才會這樣抽換</strong> 。</em></p></blockquote><blockquote><p><em>如果是用在執行 CI/CD 任務才必須要用 Self-hosted Runner。</em></p></blockquote><h4 id="新增-self-hosted-runner"><span class="me-2">新增 Self-hosted Runner</span><a href="#新增-self-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><em>本文以 <strong>macOS M1</strong> 為例。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*mEInaj-tLaprMAa2OfowCw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*mEInaj-tLaprMAa2OfowCw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjExMTMiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><ul><li>Settings → Actions → Runners → New self-hosted runner。<li><strong>Runner image:</strong> macOS<li><strong>Architecture</strong> : M1 記得選 ARM64 執行比較快</ul><p><strong>在實體電腦上開一個 Termnial。</strong></p><p><strong>按照 Download 步驟在本地電腦完成：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c"># 在你想要的路徑，建立 Runner 目錄</span>
<span class="nb">mkdir </span>actions-runner <span class="o">&amp;&amp;</span> <span class="nb">cd </span>actions-runner
<span class="c"># 下載 Runner image</span>
curl <span class="nt">-o</span> actions-runner-osx-x64-2.325.0.tar.gz <span class="nt">-L</span> https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-osx-x64-2.325.0.tar.gz

<span class="c"># Optional: Validate the hash</span>
<span class="nb">echo</span> <span class="s2">"0562bd934b27ca0c6d8a357df00809fbc7b4d5524d4aeb6ec152e14fd520a4c3  actions-runner-osx-x64-2.325.0.tar.gz"</span> | shasum <span class="nt">-a</span> 256 <span class="nt">-c</span>

<span class="c"># 解壓縮</span>
<span class="nb">tar </span>xzf ./actions-runner-osx-x64-2.325.0.tar.gz
</pre></table></code></div></div><blockquote><p><em>以上只是參考；建議照你設定頁裡的步驟來做，才會是最新版本的 Runner image。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*Q0k0EPjrY2V4owseESe5lg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Q0k0EPjrY2V4owseESe5lg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTYxIiBoZWlnaHQ9IjE5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>設定 Configure:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># 請參考設定頁指令，Token 會隨時間改變</span>
./config.sh <span class="nt">--url</span> https://github.com/ORG/REPO <span class="nt">--token</span> XXX
</pre></table></code></div></div><p>會依序要你輸入：</p><ul><li>Enter the name of the runner group to add this runner to: [press Enter for Default] <strong>直接 Enter</strong> *只有註冊到 Organization 組織層級的 Runner 才有 Group 分組功能<li>Enter the name of runner: [press Enter for ZhgChgLideMacBook-Pro] <strong>可以輸入想設定的 Runner 名稱 e.g.</strong> <code class="language-plaintext highlighter-rouge">app-runner-1</code> <strong>或直接 Enter</strong><li>This runner will have the following labels: ‘self-hosted’, ‘macOS’, ‘X64’ Enter any additional labels (ex. label-1,label-2): [press Enter to skip] <strong>輸入想要設定的 Runner label，可以多輸入自訂 Label 方便之後使用</strong> 同前述 GitHub Acitons/Runner 是依照對應 Label 找任務來做， <strong>如果只用 default label，Runner 可能會撿到組織內的其他 Runner 來執行工作，自訂一個最保險</strong> 。 這邊我自己亂定了一個 label <code class="language-plaintext highlighter-rouge">self-hosted-zhgchgli</code><li>Enter name of work folder: [press Enter for _work] <strong>直接 Enter</strong></ul><p>出現 √ Settings Saved. 代表設定完成了。</p><p><a href="/assets/404bd5c70040/1*yxLfii0rWhzsiFuYVmPgFw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*yxLfii0rWhzsiFuYVmPgFw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjkiIGhlaWdodD0iNTAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>啟動 Runner:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./run.sh
</pre></table></code></div></div><p>出現 √ Connected to GitHub、Listening for Jobs 就代表已經在監聽 Actions 任務了：</p><p><a href="/assets/404bd5c70040/1*1RmPPOosAoCxHA9tg_WE2w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*1RmPPOosAoCxHA9tg_WE2w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyOTAiIGhlaWdodD0iOTgiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><strong><em>這個 Terminal 視窗不關閉就會持續接收任務來做。</em></strong></p></blockquote><blockquote><p><strong><em>🚀🚀🚀同一台電腦開多個 Terminal 在不同目錄就能起多個 Runner。</em></strong></p></blockquote><p><strong>回到 Repo 設定頁也能看到 Runner 正在等待任務：</strong></p><p><a href="/assets/404bd5c70040/1*jjq5NTPYMuC3gH3ey_VTtg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*jjq5NTPYMuC3gH3ey_VTtg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDIiIGhlaWdodD0iMjQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>Status:</strong></p><ul><li>Idle: 閑置，在等待任務<li>Active: 有任務正在執行<li>Offline: Runner 不在線上</ul><h4 id="workflowgithub-actions-runner-改用-self-hosted-runner"><span class="me-2">Workflow(GitHub Actions) Runner 改用 Self-hosted Runner</span><a href="#workflowgithub-actions-runner-改用-self-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>以 <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code> 為例：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># 請參考前文，略....</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># 請參考前文，略....</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">self-hosted-zhgchgli</span><span class="pi">]</span>
    <span class="c1"># 請參考前文，略....</span>
  <span class="c1"># ---------</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="c1"># 請參考前文，略....</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">self-hosted-zhgchgli</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 請參考前文，略....</span>
</pre></table></code></div></div><p>Commit 檔案到 Repo 主分支之後，重新開 PR 觸發驗證一下 Actions。</p><p><strong>回到 Runner Terminal 就能看到有新的任務進來了，正在執行跟執行結果：</strong></p><p><a href="/assets/404bd5c70040/1*Hu0DxKQbenPmBEw8swv65A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Hu0DxKQbenPmBEw8swv65A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjgiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>失敗了，因為我本機電腦沒有安裝 <a href="https://github.com/cli/cli" target="_blank">gh cli</a> 環境：</p><p><a href="/assets/404bd5c70040/1*9xguacdPATIeEZdbFszmHw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*9xguacdPATIeEZdbFszmHw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NzMiIGhlaWdodD0iMTIzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>使用 <code class="language-plaintext highlighter-rouge">brew install gh</code> 在實體電腦上安裝完 gh 後再次觸發執行：</p><p><a href="/assets/404bd5c70040/1*TbkAt00K89Ysbix33dK8ZA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*TbkAt00K89Ysbix33dK8ZA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MzEiIGhlaWdodD0iMjkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>成功！現在這個任務就完全是使用我們自己的電腦在執行，不使用 GitHub Hosted Runner、不計費使用。</p><p><strong>我們可以點進去 Action Log 查看任務執行在的 Runner、機器是哪一個：</strong></p><p><a href="/assets/404bd5c70040/1*oqLcWfn6cbWsCt9fVsrikQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*oqLcWfn6cbWsCt9fVsrikQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDkyIiBoZWlnaHQ9IjgyNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="runs-on--runner-label-設定"><span class="me-2">runs-on: [ <strong>Runner Label] 設定</strong></span><a href="#runs-on--runner-label-設定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>這裡是 AND 不是 OR，GitHub Runner 暫不支援 OR 挑選 Runner 執行。</p><p>例如： <code class="language-plaintext highlighter-rouge">[self-hosted, macOS, app]</code> → 代表 Runner 要 <strong>同時有</strong> <code class="language-plaintext highlighter-rouge">self-hosted, macOS, app</code> 這 3 個 Labels 才會匹配接任務來執行。</p><p>如果一個 Job 想同時測試不同 Runner 環境下的結果可以使用 <code class="language-plaintext highlighter-rouge">matrix</code> 參數：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">${{ matrix.runner }}</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">runner</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="pi">[</span><span class="nv">self-hosted</span><span class="pi">,</span> <span class="nv">linux</span><span class="pi">,</span> <span class="nv">high-memory</span><span class="pi">]</span>
          <span class="pi">-</span> <span class="pi">[</span><span class="nv">self-hosted</span><span class="pi">,</span> <span class="nv">macos</span><span class="pi">,</span> <span class="nv">xcode-15</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo "Running on ${{ matrix.runner }}"</span>
</pre></table></code></div></div><p>這樣這個 Job 會在下列兩個 Runner Labels Runner 中並行各執行一次：</p><ul><li>self-hosted, linux, high-memory<li>self-hosted, macos, xcode-15</ul><blockquote><p><strong><em>Runner 暫不支援：</em></strong></p></blockquote><blockquote><p><em>- OR 挑選 Runner</em></p></blockquote><blockquote><p><em>- Runner 權重設定</em></p></blockquote><h4 id="註冊-runner-成-service"><span class="me-2">註冊 Runner 成 Service</span><a href="#註冊-runner-成-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>可以參考官方文件「 <a href="https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac" target="_blank">Configuring the self-hosted runner application as a service</a> 」將 Runner 直接註冊成系統 Service，這樣就能在背景執行(不用開 Terminal 在前景)、開機後也會自動啟動。</p><p>有多個 Runner 記得調整「 <a href="https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac#customizing-the-self-hosted-runner-service-1" target="_blank">Customizing the self-hosted runner service</a> 」設定註冊不同名稱。</p><blockquote><p><em>iOS 這邊我有一個待研究排除的問題， <strong>就是我改用背景 Service 之後在 Archive 會遇到錯誤(疑似是跟 keychain 權限有關)</strong> ，當時沒時間解決，就先用起前景 Terminal Runner 了。</em></p></blockquote><p>如果是傳統前景要做到開機自動啟動就要去 <code class="language-plaintext highlighter-rouge">~/Library/LaunchAgents</code> 新增一個自動啟動設定檔案：</p><p><code class="language-plaintext highlighter-rouge">actions.runner.REPO.RUNNER_NAME.plist</code> ：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;string&gt;</span>actions.runner.REPO.RUNNER_NAME<span class="nt">&lt;/string&gt;</span>
  <span class="c">&lt;!-- 指定 Terminal.app 來啟動 --&gt;</span>
  <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;array&gt;</span>
   <span class="nt">&lt;string&gt;</span>/usr/bin/open<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>-a<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>Terminal<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>/Users/zhgchgli/Documents/actions-runner/run.sh<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;/array&gt;</span>
  <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;true/&gt;</span>
  <span class="nt">&lt;key&gt;</span>WorkingDirectory<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;string&gt;</span>/Users/zhgchgli/Documents/actions-runner<span class="nt">&lt;/string&gt;</span>
 <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre></table></code></div></div><blockquote><p><em>有興趣深入研究 DevOps 的朋友可參考官方 <a href="https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller#scaling-runners" target="_blank">k8s Runner</a> 文件。</em></p></blockquote><h4 id="完整專案-repo"><span class="me-2">完整專案 Repo</span><a href="#完整專案-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/8b25f8eae56bc35c92b97c5d7e7834aa5cb87673e718a1ce829f5bb80f3edebb/ZhgChgLi/github-actions-ci-cd-demo" alt="" loading="lazy"></a></p><h3 id="官方文件"><span class="me-2">官方文件</span><a href="#官方文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://docs.github.com/en/actions/get-started/quickstart" target="_blank" class="img-link shimmer" ><img src="https://docs.github.com/assets/cb-345/images/social-cards/actions.png" alt="" loading="lazy"></a></p><p>更細節的設置方式請務必參考官方手冊。</p><h4 id="ai-can-help"><span class="me-2">AI Can Help!</span><a href="#ai-can-help" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*JecNUCqujV1oeAvHA14X-g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*JecNUCqujV1oeAvHA14X-g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE0IiBoZWlnaHQ9IjExNDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>實測給 ChatGPT 完整的步驟跟時機點就能幫你寫好 GitHub Actions 直接使用!</p><h3 id="總結"><span class="me-2">總結</span><a href="#總結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>現在你應該已經對 GitHub Actions + Self-hosted Runner 有了一定程度的了解，下一篇我將開始以 App (iOS) CI/CD 為案例，手把手建置整套流程。</p><h3 id="系列文章"><span class="me-2">系列文章：</span><a href="#系列文章" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/ci-cd-是什麼-打造高效穩定開發團隊的關鍵流程與工具選擇-c008a9e8ceca/"><strong>CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？</strong></a><li><a href="/posts/zrealm-dev/github-actions-self-hosted-runner-詳解與實戰案例-ci-cd-自動化工作流程建置-404bd5c70040/"><strong>CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全</strong></a><li><a href="/posts/zrealm-dev/github-actions-ios-ci-cd-完整實作自動化建置-測試與部署流程教學-4b001d2e8440/"><strong>CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程</strong></a><li><a href="/posts/zrealm-dev/ci-cd-打包工具平台-使用-google-apps-script-web-app-串接-github-actions-提升跨團隊效率-4273e57e7148/"><strong>CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台</strong></a></ul><h4 id="buy-me-a-coffee"><span class="me-2"><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></span><a href="#buy-me-a-coffee" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank"><strong><em>本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！</em></strong></a></p></blockquote><p><a href="/assets/404bd5c70040/1*QJj54G9gOjtQS-rbHVT1SQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*QJj54G9gOjtQS-rbHVT1SQ.webp" alt="[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iNzAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><blockquote class="prompt-info"><p>本文首次發表於 Medium ➡️ <a href="https://medium.com/p/404bd5c70040" target="_blank"><strong>前往查看</strong></a>，由 <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> 與 <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2025-07-02-404bd5c70040.md" target="_blank">Improve this page on Github.</a></p></blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 194 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-19 | 182 Views on <a href="https://medium.com/p/404bd5c70040" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cicd/" class="post-tag no-text-decoration" >cicd</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >github-actions</a> <a href="/tags/github/" class="post-tag no-text-decoration" >github</a> <a href="/tags/self-hosted/" class="post-tag no-text-decoration" >self-hosted</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GitHub%20Actions%EF%BD%9CSelf-hosted%20Runner%20%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B%EF%BD%9CCI/CD%20%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-self-hosted-runner-%25E8%25A9%25B3%25E8%25A7%25A3%25E8%2588%2587%25E5%25AF%25A6%25E6%2588%25B0%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GitHub%20Actions%EF%BD%9CSelf-hosted%20Runner%20%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B%EF%BD%9CCI/CD%20%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-self-hosted-runner-%25E8%25A9%25B3%25E8%25A7%25A3%25E8%2588%2587%25E5%25AF%25A6%25E6%2588%25B0%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-self-hosted-runner-%25E8%25A9%25B3%25E8%25A7%25A3%25E8%2588%2587%25E5%25AF%25A6%25E6%2588%25B0%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E9%BB%9E-%E7%BE%8E%E9%A3%9F%E8%88%87%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AD%89%E7%9C%81%E9%8C%A2%E7%A7%98%E8%A8%A3-8ace34a1a3d8/">遊記 2025 韓國釜山 8 天 7 夜自由行</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/nagoya-one-day-quick-trip-peach-aviation-flight-experience-and-travel-tips-7b8a0563c157/">Nagoya One-Day Quick Trip｜Peach Aviation Flight Experience and Travel Tips</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751900544" data-df="ll" > Jul 7, 2025 </time><h4 class="pt-0 my-2">CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程</h4><div class="text-muted"><p>iOS App 自動化建置、測試、部署的 GitHub Actions 實作步驟完整教學</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751267416" data-df="ll" > Jun 30, 2025 </time><h4 class="pt-0 my-2">CI/CD 是什麼｜打造高效穩定開發團隊的關鍵流程與工具選擇</h4><div class="text-muted"><p>針對 iOS App 團隊，解析無 CI/CD 流程的痛點，透過 GitHub Actions 與 self-hosted Runner 自動化測試與打包，減少人力浪費與錯誤，提升團隊穩定性與開發效率，搭配 Google Apps Script Web App 實現跨職能便捷操作。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1736594383" data-df="ll" > Jan 11, 2025 </time><h4 class="pt-0 my-2">Google Apps Script Web App｜打造 Github Action CI/CD 自訂表單提升開發效率</h4><div class="text-muted"><p>針對缺乏動態 GUI 表單的 Github Action CI/CD，使用 Google Apps Script Web App 建立組織內專屬表單，串接 Github API 自動取得分支並觸發工作流程，並整合 Slack 通知與 Jira、Asana 工單查詢，實現免維護、低成本的自動化打包工具。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-development/en/github-actions-self-hosted-runner-setup-and-usage-guide-for-efficient-ci-cd-404bd5c70040/" class="btn btn-outline-primary" aria-label="Older" ><p>GitHub Actions｜Self-hosted Runner Setup and Usage Guide for Efficient CI/CD</p></a> <a href="/posts/zrealm-development/en/github-actions-ios-app-ci-cd-workflow-automation-for-faster-builds-and-deployments-4b001d2e8440/" class="btn btn-outline-primary" aria-label="Newer" ><p>GitHub Actions｜iOS App CI/CD Workflow Automation for Faster Builds and Deployments</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-20 23:28:22 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
