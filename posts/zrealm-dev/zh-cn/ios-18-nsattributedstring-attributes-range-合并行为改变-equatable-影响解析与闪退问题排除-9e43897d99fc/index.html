<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS 18 起 NSAttributedString attributes 合并机制改为参考 Equatable，导致自订属性 Range 合并行为异动，造成 HTML 解析闪退。深入剖析底层合并逻辑与 Swift Equatable 实作，快速掌握修正关键，避免闪退并优化字串属性管理。" /><meta property="og:description" content="iOS 18 起 NSAttributedString attributes 合并机制改为参考 Equatable，导致自订属性 Range 合并行为异动，造成 HTML 解析闪退。深入剖析底层合并逻辑与 Swift Equatable 实作，快速掌握修正关键，避免闪退并优化字串属性管理。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-09-20T21:03:42+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" /><meta property="twitter:title" content="iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-20T21:03:42+08:00","datePublished":"2024-09-20T21:03:42+08:00","description":"iOS 18 起 NSAttributedString attributes 合并机制改为参考 Equatable，导致自订属性 Range 合并行为异动，造成 HTML 解析闪退。深入剖析底层合并逻辑与 Swift Equatable 实作，快速掌握修正关键，避免闪退并优化字串属性管理。","headline":"iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/"}</script><title>iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-18-nsattributedstring-attributes-range-merging-equatable-behavior-change-explained-9e43897d99fc/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-equatable-%E5%BD%B1%E9%9F%BF%E8%A7%A3%E6%9E%90%E8%88%87%E9%96%83%E9%80%80%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4-9e43897d99fc/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/ios-18-nsattributedstring-attributes-range-%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98-equatable-%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4-9e43897d99fc/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除</h1><p class="post-desc fw-light mb-4">iOS 18 起 NSAttributedString attributes 合并机制改为参考 Equatable，导致自订属性 Range 合并行为异动，造成 HTML 解析闪退。深入剖析底层合并逻辑与 Swift Equatable 实作，快速掌握修正关键，避免闪退并优化字串属性管理。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1726837422" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 20, 2024 </time> </span> <span> Updated <time data-ts="1726837422" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 20, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" class="popup img-link preview-img blur"><img data-src="/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1095 words" > <em>6 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS 18 NSAttributedString attributes Range 合并行为改变｜Equatable 影响解析与闪退问题排除</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/ios-18-nsattributedstring-attributes-range-merging-equatable-behavior-change-explained-9e43897d99fc/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-equatable-%E5%BD%B1%E9%9F%BF%E8%A7%A3%E6%9E%90%E8%88%87%E9%96%83%E9%80%80%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4-9e43897d99fc/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目录</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>iOS ≥ 18 NSAttributedString attributes Range 合并的一个行为改变 <a href="#ios--18-nsattributedstring-attributes-range-合并的一个行为改变">#</a></summary><ul><li><a href="#问题起因">问题起因</a></li><li><a href="#crash-trace">Crash Trace</a></li><li><a href="#nsattributedstring-attributes-nsattributedstringkey-any">NSAttributedString attributes: [NSAttributedString.Key: Any?]</a></li><li><a href="#nsattributedstring-attributes-合并--底层实践方式推测">NSAttributedString attributes 合并 — 底层实践方式推测</a></li><li><a href="#ios--17-前会得到以下-attributes-合并结果">iOS ≤ 17 前会得到以下 Attributes 合并结果</a></li><li><a href="#ios--18-会得到以下-attributes-合并结果">iOS ≥ 18 会得到以下 Attributes 合并结果</a></li><li><a href="#️-ios--18-nsattributedstring-attributes-nsattributedstringkey-any-会多参考-equatable-️">⭐️ iOS ≥ 18 NSAttributedString attributes: [NSAttributedString.Key: Any?] 会多参考 Equatable ==⭐️</a></li></ul></details></li><li><a href="#结论">结论</a></li></ul></nav><hr /><h3 id="ios--18-nsattributedstring-attributes-range-合并的一个行为改变"><span class="me-2">iOS ≥ 18 NSAttributedString attributes Range 合并的一个行为改变</span><a href="#ios--18-nsattributedstring-attributes-range-合并的一个行为改变" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS ≥ 18 开始 NSAttributedString attributes Range 合并会参考 Equatable</p><p><a href="/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" class="popup img-link blur"><img data-src="/assets/9e43897d99fc/1*PJ_qm75Yz_7y0UUBk8X6bg.webp" alt="Photo by [C M](https://unsplash.com/@ubahnverleih?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@ubahnverleih?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">C M</a></p><h4 id="问题起因"><span class="me-2">问题起因</span><a href="#问题起因" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/602927147/57ce75c1-8548-449c-b44a-f4b0451ed5ea" alt="" loading="lazy"></a></p><p>iOS 18 2024/9/17 上线后，之前做的开源专案 <a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">ZMarkupParser</a> 就有开发者回报 iOS 18 在解析部分 HTML 时会发生闪退。</p><p>看到这个 Issue 有点困惑，因为程式在以前都没问题，iOS 18 开始才会闪退，不符合常理，应该是 iOS 18 底层 Foundation 有什么调整导致。</p><h4 id="crash-trace"><span class="me-2">Crash Trace</span><a href="#crash-trace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Trace Code 后定位到闪退问题点是遍历 <code class="language-plaintext highlighter-rouge">.breaklinePlaceholder</code> Attributes 并针对 Range 进行删除操作时会发生闪退:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>mutableAttributedString.enumerateAttribute(.breaklinePlaceholder, in: NSMakeRange(0, NSMakeRange(0, mutableAttributedString.string.utf16.count))) { value, range, _ in
  // ...if condition...
  // mutableAttributedString.deleteCharacters(in: preRange)
  // ...if condition...
  // mutableAttributedString.deleteCharacters(in: range)
}
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">.breaklinePlaceholder</code> 是我自行扩充的一个 NSAttributedString.Key，用来标记 HTML 标签资讯，优化换行符号使用:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">BreaklinePlaceholder</span><span class="p">:</span> <span class="kt">OptionSet</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">static</span> <span class="k">let</span> <span class="nv">tagBoundaryPrefix</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">tagBoundarySuffix</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">breaklineTag</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">breaklinePlaceholder</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span> <span class="o">=</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="s">"breaklinePlaceholder"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong><em>但核心问题不是这里</em></strong> <em>，因为在 iOS 17 以前，输入的 <code class="language-plaintext highlighter-rouge">mutableAttributedString</code> 在执行以上操作时不会有问题；代表输入的资料内容在 iOS 18 有所变动。</em></p></blockquote><h4 id="nsattributedstring-attributes-nsattributedstringkey-any"><span class="me-2">NSAttributedString attributes: [NSAttributedString.Key: Any?]</span><a href="#nsattributedstring-attributes-nsattributedstringkey-any" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>在深入挖掘问题之前先介绍一下 NSAttributedString attributes 的 <strong>合并机制</strong> 。</p><p>NSAttributedString attributes 会 <strong>自动比较 .key 相同的相邻 Range Attributes 物件是否相同，相同则合并成同个 Attribute</strong> 例如：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">mutableAttributedString</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;div&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">font</span><span class="p">:</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">14</span><span class="p">)]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;div&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">font</span><span class="p">:</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">14</span><span class="p">)]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;p&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">font</span><span class="p">:</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">14</span><span class="p">)]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"Test"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">font</span><span class="p">:</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">12</span><span class="p">)]))</span>
</pre></table></code></div></div><p><strong>最终 Attributes 合并结果：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="kt">NSFont</span> <span class="o">=</span> <span class="s">"&lt;UICTFont: 0x101d13400&gt; font-family: </span><span class="se">\"</span><span class="s">.SFUI-Regular</span><span class="se">\"</span><span class="s">; font-weight: normal; font-style: normal; font-size: 14.00pt"</span><span class="p">;</span>
<span class="p">}</span><span class="kt">Test</span><span class="p">{</span>
    <span class="kt">NSFont</span> <span class="o">=</span> <span class="s">"&lt;UICTFont: 0x101d13860&gt; font-family: </span><span class="se">\"</span><span class="s">.SFUI-Regular</span><span class="se">\"</span><span class="s">; font-weight: normal; font-style: normal; font-size: 12.00pt"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>在 <code class="language-plaintext highlighter-rouge">enumerateAttribute(.breaklinePlaceholder...)</code> 时会得到以下结果:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">NSRange</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">}:</span> <span class="o">&lt;</span><span class="kt">UICTFont</span><span class="p">:</span> <span class="mh">0x101d13400</span><span class="o">&gt;</span> <span class="n">font</span><span class="o">-</span><span class="nv">family</span><span class="p">:</span> <span class="s">".SFUI-Regular"</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">weight</span><span class="p">:</span> <span class="n">normal</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">style</span><span class="p">:</span> <span class="n">normal</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">size</span><span class="p">:</span> <span class="mf">14.00</span><span class="n">pt</span>
<span class="kt">NSRange</span> <span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">}:</span> <span class="o">&lt;</span><span class="kt">UICTFont</span><span class="p">:</span> <span class="mh">0x101d13860</span><span class="o">&gt;</span> <span class="n">font</span><span class="o">-</span><span class="nv">family</span><span class="p">:</span> <span class="s">".SFUI-Regular"</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">weight</span><span class="p">:</span> <span class="n">normal</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">style</span><span class="p">:</span> <span class="n">normal</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="nv">size</span><span class="p">:</span> <span class="mf">12.00</span><span class="n">pt</span>
</pre></table></code></div></div><h4 id="nsattributedstring-attributes-合并--底层实践方式推测"><span class="me-2">NSAttributedString attributes 合并 — 底层实践方式推测</span><a href="#nsattributedstring-attributes-合并--底层实践方式推测" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>推测底层是使用 <code class="language-plaintext highlighter-rouge">Set&lt;Hashable&gt;</code> 做为 Attributes 容器，会自动排除相同的 Attriubte 物件。</p><p>但是为了使用方便， <code class="language-plaintext highlighter-rouge">NSAttributedString attributes: [NSAttributedString.Key: Any?]</code> Value 物件是宣告成 <code class="language-plaintext highlighter-rouge">Any?</code> Type，没有限制 Hashable。</p><p>也因此推测系统在底层会在 Conform <code class="language-plaintext highlighter-rouge">as? Hashable</code> 然后使用 Set 合并管理物件。</p><blockquote><p><strong><em>这次的 iOS ≥ 18 调整差异推测就是这边底层的实现问题。</em></strong></p></blockquote><p>以下是以我们自订的 <code class="language-plaintext highlighter-rouge">.breaklinePlaceholder</code> Attributes 为例:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">BreaklinePlaceholder</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">static</span> <span class="k">let</span> <span class="nv">tagBoundaryPrefix</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">tagBoundarySuffix</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">breaklineTag</span> <span class="o">=</span> <span class="kt">BreaklinePlaceholder</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">breaklinePlaceholder</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span> <span class="o">=</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="s">"breaklinePlaceholder"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//</span>

<span class="k">let</span> <span class="nv">mutableAttributedString</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;div&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">breaklinePlaceholder</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="o">.</span><span class="kt">BreaklinePlaceholder</span><span class="o">.</span><span class="n">tagBoundaryPrefix</span><span class="p">]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;div&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">breaklinePlaceholder</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="o">.</span><span class="kt">BreaklinePlaceholder</span><span class="o">.</span><span class="n">tagBoundaryPrefix</span><span class="p">]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;p&gt;"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">breaklinePlaceholder</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="o">.</span><span class="kt">BreaklinePlaceholder</span><span class="o">.</span><span class="n">tagBoundaryPrefix</span><span class="p">]))</span>
<span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"Test"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
</pre></table></code></div></div><h4 id="ios--17-前会得到以下-attributes-合并结果"><span class="me-2">iOS ≤ 17 前会得到以下 <strong>Attributes 合并结果：</strong></span><a href="#ios--17-前会得到以下-attributes-合并结果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>&lt;div&gt;<span class="o">{</span>
    breaklinePlaceholder <span class="o">=</span> <span class="s2">"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)"</span><span class="p">;</span>
<span class="o">}</span>&lt;div&gt;<span class="o">{</span>
    breaklinePlaceholder <span class="o">=</span> <span class="s2">"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)"</span><span class="p">;</span>
<span class="o">}</span>&lt;p&gt;<span class="o">{</span>
    breaklinePlaceholder <span class="o">=</span> <span class="s2">"NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)"</span><span class="p">;</span>
<span class="o">}</span>Test<span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="ios--18-会得到以下-attributes-合并结果"><span class="me-2">iOS ≥ 18 会得到以下 Attributes 合并结果：</span><a href="#ios--18-会得到以下-attributes-合并结果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;div&gt;&lt;div&gt;&lt;p&gt;</span>{
    breaklinePlaceholder = "NSAttributedStringCrash.BreaklinePlaceholder(rawValue: 1)";
}Test{
}
</pre></table></code></div></div><blockquote><p><strong><em>可以看到同样的程式在不同版本的 iOS 有不同的结果，这最终导致了后续的 <code class="language-plaintext highlighter-rouge">enumerateAttribute(.breaklinePlaceholder..)</code> 中的处理逻辑不合预期造成闪退。</em></strong></p></blockquote><h4 id="️-ios--18-nsattributedstring-attributes-nsattributedstringkey-any-会多参考-equatable-️"><span class="me-2">⭐️ iOS ≥ 18 NSAttributedString attributes: [NSAttributedString.Key: Any?] 会多参考 Equatable ==⭐️</span><a href="#️-ios--18-nsattributedstring-attributes-nsattributedstringkey-any-会多参考-equatable-️" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9e43897d99fc/1*0TKpBawJoLZUbUKwovRUJQ.webp" class="popup img-link blur"><img data-src="/assets/9e43897d99fc/1*0TKpBawJoLZUbUKwovRUJQ.webp" alt="比较 iOS 17/18 有无实现 Equatable/Hashable 的结果" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQzOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>比较 iOS 17/18 有无实现 Equatable/Hashable 的结果</p><blockquote><p><strong><em>⭐️⭐️ iOS ≥ 18 会多参考 <code class="language-plaintext highlighter-rouge">Equatable</code> ，iOS ≤ 17 则不会。⭐️⭐️</em></strong></p></blockquote><p>结合前述， <code class="language-plaintext highlighter-rouge">NSAttributedString attributes: [NSAttributedString.Key: Any?]</code> Value 物件是宣告成 <code class="language-plaintext highlighter-rouge">Any?</code> Type， <strong>就观测结果， iOS ≥ 18 会先参考 <code class="language-plaintext highlighter-rouge">Equatable</code> 判断是否相同，然后再使用 <code class="language-plaintext highlighter-rouge">Hashable</code> Set 合并管理物件。</strong></p><h3 id="结论"><span class="me-2">结论</span><a href="#结论" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>NSAttributedString attributes: [NSAttributedString.Key: Any?] 在合并 Range Attribute 时，iOS ≥ 18 会多参考 Equatable，这点与以往不同。</p></blockquote><p>另外在 iOS 18 开始如果只宣告 <code class="language-plaintext highlighter-rouge">Equatable</code> XCode Console 也会输出 Warning:</p><blockquote><p><strong><em>Obj-C ` -hash<code class="language-plaintext highlighter-rouge"> invoked on a Swift value of type </code>BreaklinePlaceholder` that is Equatable but not Hashable; this can lead to severe performance problems.</em></strong></p></blockquote><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/9e43897d99fc" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2024-09-20-9e43897d99fc.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/nsattributedstring/" class="post-tag no-text-decoration" >nsattributedstring</a> <a href="/tags/ios-18/" class="post-tag no-text-decoration" >ios-18</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%2018%20NSAttributedString%20attributes%20Range%20%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98%EF%BD%9CEquatable%20%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-18-nsattributedstring-attributes-range-%25E5%2590%2588%25E5%25B9%25B6%25E8%25A1%258C%25E4%25B8%25BA%25E6%2594%25B9%25E5%258F%2598-equatable-%25E5%25BD%25B1%25E5%2593%258D%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E9%2597%25AA%25E9%2580%2580%25E9%2597%25AE%25E9%25A2%2598%25E6%258E%2592%25E9%2599%25A4-9e43897d99fc%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%2018%20NSAttributedString%20attributes%20Range%20%E5%90%88%E5%B9%B6%E8%A1%8C%E4%B8%BA%E6%94%B9%E5%8F%98%EF%BD%9CEquatable%20%E5%BD%B1%E5%93%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%97%AA%E9%80%80%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-18-nsattributedstring-attributes-range-%25E5%2590%2588%25E5%25B9%25B6%25E8%25A1%258C%25E4%25B8%25BA%25E6%2594%25B9%25E5%258F%2598-equatable-%25E5%25BD%25B1%25E5%2593%258D%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E9%2597%25AA%25E9%2580%2580%25E9%2597%25AE%25E9%25A2%2598%25E6%258E%2592%25E9%2599%25A4-9e43897d99fc%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-18-nsattributedstring-attributes-range-%25E5%2590%2588%25E5%25B9%25B6%25E8%25A1%258C%25E4%25B8%25BA%25E6%2594%25B9%25E5%258F%2598-equatable-%25E5%25BD%25B1%25E5%2593%258D%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E9%2597%25AA%25E9%2580%2580%25E9%2597%25AE%25E9%25A2%2598%25E6%258E%2592%25E9%2599%25A4-9e43897d99fc%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%B3-%E4%BD%8E%E6%89%8B%E7%BA%8C%E8%B2%BB150%E5%85%83-%E5%B8%B3%E6%88%B6%E5%8D%87%E7%B4%9A%E8%88%87%E6%89%8B%E7%BA%8C%E8%B2%BB%E8%A3%9C%E5%8A%A9%E7%94%B3%E8%AB%8B%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教學 — LINE Bank 入金 Firstrade 快速到帳、手續費只要 150 元及帳戶升級/約定轉帳/手續費補助申請教學</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/japan-overseas-shopping-rakuten-consolidated-shipping-for-taiwan-buy-from-rakuten-amazon-bea62c251f1b/">Japan Overseas Shopping｜Rakuten Consolidated Shipping for Taiwan｜Buy from Rakuten & Amazon</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/%E6%97%A5%E6%9C%AC%E4%B9%90%E5%A4%A9%E9%9B%86%E8%BF%90%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E8%B4%AD%E4%B9%B0horie%E9%92%9B%E6%9D%AF%E4%B8%8Eamazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E6%B9%BE%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外购物寄送台湾教学 — 使用乐天集运购买乐天拍卖与 Amazon 商品 (Horie 钛杯)</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-equatable-%E5%BD%B1%E9%9F%BF%E8%A7%A3%E6%9E%90%E8%88%87%E9%96%83%E9%80%80%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4-9e43897d99fc/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1726837422" data-df="ll" > Sep 20, 2024 </time><h4 class="pt-0 my-2">iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變</h4><div class="text-muted"><p>iOS ≥ 18 開始 NSAttributedString attributes Range 合併會參考 Equatable</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-18-nsattributedstring-attributes-range-merging-equatable-behavior-change-explained-9e43897d99fc/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1726837422" data-df="ll" > Sep 20, 2024 </time><h4 class="pt-0 my-2">iOS 18 NSAttributedString Attributes Range Merging｜Equatable Behavior Change Explained</h4><div class="text-muted"><p>Discover how iOS 18 updates NSAttributedString attributes range merging by referencing Equatable, resolving inconsistencies and improving attribute handling for developers.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-12-%E4%BB%A5%E4%B8%8A-swift-%E5%AE%9E%E4%BD%9Capp%E9%80%9A%E7%9F%A5%E8%AE%BE%E5%AE%9A%E9%A1%B5%E6%8D%B7%E5%BE%84-%E6%8F%90%E5%8D%87%E4%BD%BF%E7%94%A8%E8%80%85%E9%80%9A%E7%9F%A5%E4%BD%93%E9%AA%8C-f644db1bb8bf/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1542033522" data-df="ll" > Nov 12, 2018 </time><h4 class="pt-0 my-2">iOS 12 以上：Swift 实作APP通知设定页捷径｜提升使用者通知体验</h4><div class="text-muted"><p>针对iOS 12以上用户，透过Swift新增APP通知设定捷径，让使用者可直接在APP内调整通知偏好，避免系统直接关闭通知导致错过重要讯息，提升推播精准度与使用者满意度。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/ios-18-nsattributedstring-attributes-range-merging-equatable-behavior-change-explained-9e43897d99fc/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS 18 NSAttributedString Attributes Range Merging｜Equatable Behavior Change Explained</p></a> <a href="/posts/zrealm-dev/ios-18-nsattributedstring-attributes-range-%E5%90%88%E4%BD%B5%E8%A1%8C%E7%82%BA%E6%94%B9%E8%AE%8A-equatable-%E5%BD%B1%E9%9F%BF%E8%A7%A3%E6%9E%90%E8%88%87%E9%96%83%E9%80%80%E5%95%8F%E9%A1%8C%E6%8E%92%E9%99%A4-9e43897d99fc/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS ≥ 18 NSAttributedString attributes Range 合併的一個行為改變</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
