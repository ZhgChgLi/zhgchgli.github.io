<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="深入解析 iOS UIViewController 转场动画，解决下拉关闭、上拉渐入与全页右滑返回手势难题，搭配 UIPercentDrivenInteractiveTransition 实现流畅交互动画，提升使用者体验并兼容多版本系统。" /><meta property="og:description" content="深入解析 iOS UIViewController 转场动画，解决下拉关闭、上拉渐入与全页右滑返回手势难题，搭配 UIPercentDrivenInteractiveTransition 实现流畅交互动画，提升使用者体验并兼容多版本系统。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-01-12T02:41:06+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" /><meta property="twitter:title" content="iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:06:12+08:00","datePublished":"2020-01-12T02:41:06+08:00","description":"深入解析 iOS UIViewController 转场动画，解决下拉关闭、上拉渐入与全页右滑返回手势难题，搭配 UIPercentDrivenInteractiveTransition 实现流畅交互动画，提升使用者体验并兼容多版本系统。","headline":"iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"}</script><title>iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB-%E4%B8%8B%E6%8B%89%E9%97%9C%E9%96%89-%E4%B8%8A%E6%8B%89%E6%BC%B8%E5%85%A5%E8%88%87%E5%85%A8%E9%A0%81%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AF%A6%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/ios-uiviewcontroller-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD-%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧</h1><p class="post-desc fw-light mb-4">深入解析 iOS UIViewController 转场动画，解决下拉关闭、上拉渐入与全页右滑返回手势难题，搭配 UIPercentDrivenInteractiveTransition 实现流畅交互动画，提升使用者体验并兼容多版本系统。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1578768066" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 12, 2020 </time> </span> <span> Updated <time data-ts="1712995572" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" class="popup img-link preview-img blur"><img data-src="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="5691 words" > <em>31 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS UIViewController 转场动画｜下拉关闭、上拉渐入与全页右滑返回实作技巧</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB-%E4%B8%8B%E6%8B%89%E9%97%9C%E9%96%89-%E4%B8%8A%E6%8B%89%E6%BC%B8%E5%85%A5%E8%88%87%E5%85%A8%E9%A0%81%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AF%A6%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目录</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li><a href="#ios-uiviewcontroller-转场二三事">iOS UIViewController 转场二三事</a></li><li class="has-children"><details><summary>前言 <a href="#前言">#</a></summary><ul><li><a href="#探索之路">探索之路</a></li></ul></details></li><li class="has-children"><details><summary>iOS 13 卡片样式呈现页面 <a href="#ios-13-卡片样式呈现页面">#</a></summary><ul><li><a href="#如何取消下拉关闭关闭确认">如何取消下拉关闭？关闭确认？</a></li><li><a href="#by-the-way">By the way…</a></li></ul></details></li><li class="has-children"><details><summary>哪里可做转场动画？ <a href="#哪里可做转场动画">#</a></summary><ul><li><a href="#uitabbarcontroller-切换时">UITabBarController 切换时</a></li><li><a href="#uiviewcontroller-presentdismiss-时">UIViewController Present/Dismiss 时</a></li><li><a href="#uinavigationcontroller-pushpop-时">UINavigationController Push/Pop 时</a></li></ul></details></li><li><a href="#交互非交互动画">交互非交互动画？</a></li><li class="has-children"><details><summary>怎么实作动画效果？ <a href="#怎么实作动画效果">#</a></summary><ul><li><a href="#一般转场动画-uiviewanimate">一般转场动画: UIView.animate</a></li><li><a href="#可中断继续的转场动画-uiviewpropertyanimator">可中断、继续的转场动画: UIViewPropertyAnimator</a></li><li><a href="#transitioncoordinator">transitionCoordinator</a></li></ul></details></li><li class="has-children"><details><summary>怎么控制动画？ <a href="#怎么控制动画">#</a></summary><ul><li><a href="#控制代理设置">控制代理设置</a></li><li><a href="#动画交互处理类-uipercentdriveninteractivetransition">动画交互处理类 UIPercentDrivenInteractiveTransition</a></li></ul></details></li><li><a href="#组合">组合</a></li><li><a href="#自制下拉关闭页面效果">自制下拉关闭页面效果</a></li><li class="has-children"><details><summary>全页右滑返回 <a href="#全页右滑返回">#</a></summary><ul><li><a href="#还是走正规的吧">还是走正规的吧</a></li></ul></details></li><li><a href="#上拉渐入-uiviewcontroller">上拉渐入 UIViewController</a></li><li class="has-children"><details><summary>完成！ <a href="#完成">#</a></summary><ul><li><a href="#全篇-github-范例下载">全篇 GitHub 范例下载</a></li></ul></details></li></ul></nav><hr /><h3 id="ios-uiviewcontroller-转场二三事"><span class="me-2">iOS UIViewController 转场二三事</span><a href="#ios-uiviewcontroller-转场二三事" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>UIViewController 下拉关闭/上拉出现/全页右滑返回 效果全解</p><h3 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*6IQTrlT4vIKR-NjLRsvZ-A.gif" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDg2IiBoZWlnaHQ9Ijg1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>一直以来都很好奇诸如 Facebook、Line、Spotify…等等常用的 APP 是如何实作「Present 的 UIViewController 可下拉关闭」、「上拉渐入 UIViewController」、「全页面支援手势右滑返回」这些效果的。</p><p>因为这些效果内建都没有，下拉关闭也直到 iOS ≥ 13 才有系统的卡片样式支援。</p><h4 id="探索之路"><span class="me-2">探索之路</span><a href="#探索之路" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>不知道是不会下关键字还是资料本身难找，一直找不到这类功能的实践做法，找到的资料都很含糊零散，只能东拼西凑。</p><p>一开始自己研究做法时找到 <code class="language-plaintext highlighter-rouge">UIPresentationController</code> 这个 API ，没再深掘其他资料，就用这个方法搭配 <code class="language-plaintext highlighter-rouge">UIPanGestureRecognizer</code> 用很土炮的方式完成下拉关闭的效果；一直都觉得哪里怪怪的，感觉会有更好的方式。</p><p>直到最近接触新专案拜读 <a href="https://imnotyourson.com/draggable-view-controller-interactive-view-controller/" target="_blank">大大的文章</a> ，扩大眼界才发现有其他 API 更漂亮、更有弹性的做法可以用。</p><blockquote><p><em>本篇一方面是自我纪录，另一方面希望有帮助到跟我有一样困惑的朋友。</em></p></blockquote><blockquote><p><em>内容有点多，嫌麻烦的可以直接拉到底看范例，或直接下载 Github 专案回来研究！</em></p></blockquote><h3 id="ios-13-卡片样式呈现页面"><span class="me-2">iOS 13 卡片样式呈现页面</span><a href="#ios-13-卡片样式呈现页面" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>首先讲最新系统内建的效果 iOS ≥ 13 后 <code class="language-plaintext highlighter-rouge">UIViewController.present(_:animated:completion:)</code> 默认的 <code class="language-plaintext highlighter-rouge">modalPresentationStyle</code> 效果就是 <code class="language-plaintext highlighter-rouge">UIModalPresentationAutomatic</code> 片样式呈现页面，若想要保持之前的全页面呈现就要特别指定回 <code class="language-plaintext highlighter-rouge">UIModalPresentationFullScreen</code> 即可。</p><p><a href="/assets/14cee137c565/1*j0NeJfAuR2fXP56KWglS7Q.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*j0NeJfAuR2fXP56KWglS7Q.gif" alt="内建行事历新增效果" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OTYiIGhlaWdodD0iODUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>内建行事历新增效果</p><h4 id="如何取消下拉关闭关闭确认"><span class="me-2">如何取消下拉关闭？关闭确认？</span><a href="#如何取消下拉关闭关闭确认" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>更好的使用者体验应该要能在触发下拉关闭时检查有无输入资料，有的话需要提示使用者是否舍弃动作离开。</p><p>这部分苹果也帮我们想好了，只需实作 <code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate</code> 里的方法即可。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">DetailViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">onEdit</span><span class="p">:</span><span class="kt">Bool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="c1">//设置代理</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presentationController</span><span class="p">?</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="c1">//if uiviewcontroller embed in navigationController:</span>
        <span class="c1">//self.navigationController?.presentationController?.delegate = self</span>
        
        <span class="c1">//取消下拉关闭方式(1):</span>
        <span class="k">self</span><span class="o">.</span><span class="n">isModalInPresentation</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="c1">//代理实作</span>
<span class="kd">extension</span> <span class="kt">DetailViewController</span><span class="p">:</span> <span class="kt">UIAdaptivePresentationControllerDelegate</span> <span class="p">{</span>
    <span class="c1">//取消下拉关闭方式(2):</span>
    <span class="kd">func</span> <span class="nf">presentationControllerShouldDismiss</span><span class="p">(</span><span class="n">_</span> <span class="nv">presentationController</span><span class="p">:</span> <span class="kt">UIPresentationController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">//下拉关闭取消时，下拉手势触发</span>
    <span class="kd">func</span> <span class="nf">presentationControllerDidAttemptToDismiss</span><span class="p">(</span><span class="n">_</span> <span class="nv">presentationController</span><span class="p">:</span> <span class="kt">UIPresentationController</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">onEdit</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">let</span> <span class="nv">alert</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"资料尚未存储"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">actionSheet</span><span class="p">)</span>
          <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"舍弃离开"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
              <span class="k">self</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
          <span class="p">})</span>
          <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"继续编辑"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
          <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">alert</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>      
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">self</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>取消下拉关闭可指定 <code class="language-plaintext highlighter-rouge">UIViewController</code> 的变数 <code class="language-plaintext highlighter-rouge">isModalInPresentation</code> 为 false 或实作 <code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate</code> <code class="language-plaintext highlighter-rouge">presentationControllerShouldDismiss</code> 并回传 <code class="language-plaintext highlighter-rouge">true</code> 择一都可。</p><p><code class="language-plaintext highlighter-rouge">UIAdaptivePresentationControllerDelegate presentationControllerDidAttemptToDismiss</code> 这个方法只有在 <strong>下拉关闭取消时</strong> 才会呼叫使用。</p><h4 id="by-the-way"><span class="me-2">By the way…</span><a href="#by-the-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>卡片样式呈现页面对系统来说就是 <code class="language-plaintext highlighter-rouge">Sheet</code> ，行为上跟 <code class="language-plaintext highlighter-rouge">FullScreen</code> 有所不同。</p><blockquote><p><em>假设今天 <code class="language-plaintext highlighter-rouge">RootViewController</code> 是 <code class="language-plaintext highlighter-rouge">HomeViewController</code></em></p></blockquote><blockquote><p><em>在卡片样式呈现下 (UIModalPresentationAutomatic) 则：</em></p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">HomeViewController</code> <em><code class="language-plaintext highlighter-rouge">Present</code> <code class="language-plaintext highlighter-rouge">DetailViewController</code> 时…</em></p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">HomeViewController</code> <strong><em>的 <code class="language-plaintext highlighter-rouge">viewWillDisAppear</code> / <code class="language-plaintext highlighter-rouge">viewDidDisAppear</code> 都不会触发。</em></strong></p></blockquote><blockquote><p><em>当 <code class="language-plaintext highlighter-rouge">DetailViewController</code> <code class="language-plaintext highlighter-rouge">Dismiss</code> 时…</em></p></blockquote><blockquote><p><code class="language-plaintext highlighter-rouge">HomeViewController</code> <strong><em>的 <code class="language-plaintext highlighter-rouge">viewWillAppear</code> / <code class="language-plaintext highlighter-rouge">viewDidAppear</code> 都不会触发。</em></strong></p></blockquote><blockquote><p><em>⚠️ <strong>因 XCODE 11 之后版本打包的 iOS ≥ 13 APP 预设 Present 都会使用卡片样式 (UIModalPresentationAutomatic)</strong></em></p></blockquote><blockquote><p><em><strong>如果之前有把一些逻辑放在 viewWillAppear/viewWillDisappear/viewDidAppear/viewDidDisappear 的要多加检查注意！</strong> ⚠️</em></p></blockquote><blockquote><p>看完系统内建的，来看本篇重头戏吧！如何自干这些效果？</p></blockquote><h3 id="哪里可做转场动画"><span class="me-2">哪里可做转场动画？</span><a href="#哪里可做转场动画" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>首先先整理哪里可以做视窗切换转场动画。</p><p><a href="/assets/14cee137c565/1*G0us0AtYJCy3va1sh_bWhQ.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*G0us0AtYJCy3va1sh_bWhQ.gif" alt="UITabBarController/UIViewController/UINavigationController" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTU0IiBoZWlnaHQ9IjY1NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>UITabBarController/UIViewController/UINavigationController</p><h4 id="uitabbarcontroller-切换时"><span class="me-2">UITabBarController 切换时</span><a href="#uitabbarcontroller-切换时" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们可以在 <code class="language-plaintext highlighter-rouge">UITabBarController</code> 设定 <code class="language-plaintext highlighter-rouge">delegate</code> 然后实作 <code class="language-plaintext highlighter-rouge">animationControllerForTransitionFrom</code> 方法，就能在切换 <code class="language-plaintext highlighter-rouge">UITabBarController</code> 时对内容套用自订转场特效。</p><p>系统预设无动画，上方展示图的是淡入淡出切换特效。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">MainTabBarViewController</span><span class="p">:</span> <span class="kt">UITabBarController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">MainTabBarViewController</span><span class="p">:</span> <span class="kt">UITabBarControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">tabBarController</span><span class="p">(</span><span class="n">_</span> <span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="n">animationControllerForTransitionFrom</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return UIViewControllerAnimatedTransitioning</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="uiviewcontroller-presentdismiss-时"><span class="me-2">UIViewController Present/Dismiss 时</span><a href="#uiviewcontroller-presentdismiss-时" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>理所当然，在 <code class="language-plaintext highlighter-rouge">Present/Dismiss</code> <code class="language-plaintext highlighter-rouge">UIViewController</code> 时可以指定要套用的动画效果，不然就不会有此篇文章了XD；不过值得一提的是，如果只是单纯要做 Present 动画没有要做手势控制，可以直接使用 <code class="language-plaintext highlighter-rouge">UIPresentationController</code> 方便快速 (详见文末参考资料)。</p><p>系统预设是上滑出现下滑消失！自己客制的话可以加入淡入、圆角、出现位置控制…等效果。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">self</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forPresented</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">presenting</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Present时要套用的动画</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forDismissed</span> <span class="nv">dismissed</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Dismiss时要套用的动画</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><em>任何 <code class="language-plaintext highlighter-rouge">UIViewController</code> 都能实作 <code class="language-plaintext highlighter-rouge">transitioningDelegate</code> 告知 <code class="language-plaintext highlighter-rouge">Present/Dismiss</code> 动画； <code class="language-plaintext highlighter-rouge">UITabBarViewController</code> 、 <code class="language-plaintext highlighter-rouge">UINavigationController</code> 、 <code class="language-plaintext highlighter-rouge">UITableViewController</code> ….都可</em></p></blockquote><h4 id="uinavigationcontroller-pushpop-时"><span class="me-2">UINavigationController Push/Pop 时</span><a href="#uinavigationcontroller-pushpop-时" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">UINavigationController</code> 大概是最不太需要会改动画的，因为系统预设的左滑出现右滑返回动画已经是最好的效果，能想得到要做这部分的客制可能可以用来做无缝 <code class="language-plaintext highlighter-rouge">UIViewController</code> 左右切换效果。</p><p>因为我们要做全页都可手势返回，需要配合自订 POP 动画，所以需要自己实作一个返回动画效果。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">animationControllerFor</span> <span class="nv">operation</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="o">.</span><span class="kt">Operation</span><span class="p">,</span> <span class="n">from</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">pop</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning 返回时要套用的动画</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">push</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning push时要套用的动画</span>
        <span class="p">}</span>
        
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="交互非交互动画"><span class="me-2">交互非交互动画？</span><a href="#交互非交互动画" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>再讲动画实作、手势控制前，先讲一下何谓交互与非交互。</p><p><strong>交互动画：</strong> 手势触发动画，如 UIPanGestureRecognizer</p><p><strong>非交互动画：</strong> 系统呼叫动画，如 self.present( )</p><h3 id="怎么实作动画效果"><span class="me-2">怎么实作动画效果？</span><a href="#怎么实作动画效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>讲完哪里可以做，再来看怎么做动画效果。</p><p>我们需要实作 <code class="language-plaintext highlighter-rouge">UIViewControllerAnimatedTransitioning</code> 这个 <code class="language-plaintext highlighter-rouge">Protocol</code> 并在里面对视窗做动画。</p><h4 id="一般转场动画-uiviewanimate"><span class="me-2">一般转场动画: UIView.animate</span><a href="#一般转场动画-uiviewanimate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>直接使用 <code class="language-plaintext highlighter-rouge">UIView.animate</code> 做动画处理，此时的 <code class="language-plaintext highlighter-rouge">UIViewControllerAnimatedTransitioning</code> 需要实作 <code class="language-plaintext highlighter-rouge">transitionDuration</code> 告知动画时长、 <code class="language-plaintext highlighter-rouge">animateTransition</code> 实作动画内容这两个方法。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">SlideFromLeftToRightTransition</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">TimeInterval</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mf">0.4</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="c1">//可用参数：</span>
        <span class="c1">//取得要展示的目标 UIViewController 的 View 内容:</span>
        <span class="k">let</span> <span class="nv">toView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">view</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">to</span><span class="p">)</span>
        <span class="c1">//取得要展示的目标 UIViewController:</span>
        <span class="k">let</span> <span class="nv">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewController</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">to</span><span class="p">)</span>
        <span class="c1">//取得要展示的目标 UIViewController 的 View 的初始化 Frame 资讯:</span>
        <span class="k">let</span> <span class="nv">toInitalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">initialFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">toViewController</span><span class="o">!</span><span class="p">)</span>
        <span class="c1">//取得要展示的目标 UIViewController 的 View 的最终 Frame 资讯:</span>
        <span class="k">let</span> <span class="nv">toFinalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">finalFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">toViewController</span><span class="o">!</span><span class="p">)</span>
        
        <span class="c1">//取得当前 UIViewController 的 View 内容:</span>
        <span class="k">let</span> <span class="nv">fromView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">view</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">from</span><span class="p">)</span>
        <span class="c1">//取得当前 UIViewController:</span>
        <span class="k">let</span> <span class="nv">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewController</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">from</span><span class="p">)</span>
        <span class="c1">//取得当前 UIViewController 的 View 的初始化 Frame 资讯:</span>
        <span class="k">let</span> <span class="nv">fromInitalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">initialFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">fromViewController</span><span class="o">!</span><span class="p">)</span>
        <span class="c1">//取得当前 UIViewController 的 View 的最终 Frame 资讯: (在关闭动画时可以取得之前显示动画时的最终Frame)</span>
        <span class="k">let</span> <span class="nv">fromFinalFrame</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">finalFrame</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">fromViewController</span><span class="o">!</span><span class="p">)</span>
        
        <span class="c1">//toView.frame.origin.y = UIScreen.main.bounds.size.height</span>
        
        <span class="kt">UIView</span><span class="o">.</span><span class="nf">animate</span><span class="p">(</span><span class="nv">withDuration</span><span class="p">:</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">),</span> <span class="nv">delay</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">curveLinear</span><span class="p">],</span> <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">//toView.frame.origin.y = 0</span>
        <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//动画没中断</span>
            <span class="p">}</span>
            
            <span class="c1">// 告知系统动画完成</span>
            <span class="n">transitionContext</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span>
        <span class="p">}</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong><em>To 跟 From:</em></strong></p></blockquote><blockquote><p><em>假设今天 <code class="language-plaintext highlighter-rouge">HomeViewController</code> 要 <code class="language-plaintext highlighter-rouge">Present/Push</code> <code class="language-plaintext highlighter-rouge">DetailViewController</code> 时，</em></p></blockquote><blockquote><p><em>From = HomeViewController / To = DetailViewController</em></p></blockquote><blockquote><p><em><code class="language-plaintext highlighter-rouge">DetailViewController</code> 要 <code class="language-plaintext highlighter-rouge">Dismiss/Pop</code> 时，</em></p></blockquote><blockquote><p><em>From = DetailViewController / To = HomeViewController</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>官方建议从 <code class="language-plaintext highlighter-rouge">transitionContext.view</code> 拿 View 使用，而不是从 <code class="language-plaintext highlighter-rouge">transitionContext.viewController</code> 拿 .view 使用。</em></p></blockquote><blockquote><p><em>但这边有个问题，就是在做 Present/Dismiss 动画时当 <code class="language-plaintext highlighter-rouge">modalPresentationStyle = .custom</code> ；</em></p></blockquote><blockquote><p><em>Present 时使用 <code class="language-plaintext highlighter-rouge">transitionContext.view(forKey: .from)</code> 会是 <strong>nil</strong> 、</em></p></blockquote><blockquote><p><em>Dismiss 时使用 <code class="language-plaintext highlighter-rouge">transitionContext.view(forKey: .to)</code> 也会是 <strong>nil</strong> ；</em></p></blockquote><blockquote><p><em>还是需要从 viewController.view 拿值来用。</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><code class="language-plaintext highlighter-rouge">transitionContext.completeTransition(!transitionContext.transitionWasCancelled)</code> <em>动画完成必须呼叫，否则 <strong>画面会卡死</strong> ；</em></p></blockquote><blockquote><p><em>但因 <code class="language-plaintext highlighter-rouge">UIView.animate</code> 若无可执行动画就不会 Call <code class="language-plaintext highlighter-rouge">completion</code> 造成前述方法未被呼叫；所以务必确保动画是会执行的 (EX: y从100到0)。</em></p></blockquote><p>ℹ️ℹ️ℹ️ℹ️ℹ️</p><blockquote><p><em>参与动画的 <code class="language-plaintext highlighter-rouge">ToView/FromView</code> ，若因 View 较为复杂或动画时有些问题；可改用 <code class="language-plaintext highlighter-rouge">snapshotView(afterScreenUpdates:)</code> 截图作为动画展示，先截图然后 <code class="language-plaintext highlighter-rouge">transitionContext.containerView.addSubview(snapShotView)</code> 上去图层，接著隐藏原本的 <code class="language-plaintext highlighter-rouge">ToView/FromView (isHidden = true)</code> ，在动画结束时在 <code class="language-plaintext highlighter-rouge">snapShotView.removeFromSuperview()</code> 和恢复显示原本的 <code class="language-plaintext highlighter-rouge">ToView/FromView (isHidden = true)</code> 。</em></p></blockquote><h4 id="可中断继续的转场动画-uiviewpropertyanimator"><span class="me-2">可中断、继续的转场动画: UIViewPropertyAnimator</span><a href="#可中断继续的转场动画-uiviewpropertyanimator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>另外也可以使用 <strong>iOS ≥ 10</strong> 新的动画类别来实作动画效果， 看个人习惯或是动画要做到多细节来做选择， 虽然官方的建议是有交互就使用 <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> 但 <strong>不管是交互非交互(手势控制) 一般都使用 UIView.animate 即可</strong> ； <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> 的转场动画能做到中断继续的效果，虽然我不知道实际能应用在哪，有兴趣的朋友可参考 <a href="https://juejin.im/post/5c3aa7ff518825551e285b8d" target="_blank">此篇文章</a> 。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">FadeInFadeOutTransition</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">animatorForCurrentTransition</span><span class="p">:</span> <span class="kt">UIViewImplicitlyAnimating</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">interruptibleAnimator</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewImplicitlyAnimating</span> <span class="p">{</span>
        
        <span class="c1">//当前有转场动画时直接返回</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">animatorForCurrentTransition</span> <span class="o">=</span> <span class="n">animatorForCurrentTransition</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">animatorForCurrentTransition</span>
        <span class="p">}</span>
        
        <span class="c1">//参数同前述</span>
        
        <span class="c1">//fromView.frame.origin.y = 100</span>
        
        <span class="k">let</span> <span class="nv">animator</span> <span class="o">=</span> <span class="kt">UIViewPropertyAnimator</span><span class="p">(</span><span class="nv">duration</span><span class="p">:</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">),</span> <span class="nv">curve</span><span class="p">:</span> <span class="o">.</span><span class="n">linear</span><span class="p">)</span>
        
        <span class="n">animator</span><span class="o">.</span><span class="n">addAnimations</span> <span class="p">{</span>
            <span class="c1">//fromView.frame.origin.y = 0</span>
        <span class="p">}</span>
        
        <span class="n">animator</span><span class="o">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">transitionContext</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="n">transitionContext</span><span class="o">.</span><span class="n">transitionWasCancelled</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">//抓著动画</span>
        <span class="k">self</span><span class="o">.</span><span class="n">animatorForCurrentTransition</span> <span class="o">=</span> <span class="n">animator</span>
        <span class="k">return</span> <span class="n">animator</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">TimeInterval</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mf">0.4</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="n">using</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//如果是非交互会走这，就让它也走交互的动画</span>
        <span class="k">let</span> <span class="nv">animator</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">interruptibleAnimator</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">transitionContext</span><span class="p">)</span>
        <span class="n">animator</span><span class="o">.</span><span class="nf">startAnimation</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationEnded</span><span class="p">(</span><span class="n">_</span> <span class="nv">transitionCompleted</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//动画完成，清空</span>
        <span class="k">self</span><span class="o">.</span><span class="n">animatorForCurrentTransition</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><em>交互情况下 (后面讲控制会细提)，会使用 <code class="language-plaintext highlighter-rouge">interruptibleAnimator</code> 方法的动画；非交互的情况则还是使用 <code class="language-plaintext highlighter-rouge">animateTransition</code> 方法。</em></p></blockquote><blockquote><p><em>因为能继续、中断的特性；所以 <code class="language-plaintext highlighter-rouge">interruptibleAnimator</code> 是有可能会重复呼叫使用的；所以我们需要用一个全域变数做存取返回。</em></p></blockquote><p><strong>Murmur…</strong> 其实我本来是想全都改用新的 <code class="language-plaintext highlighter-rouge">UIViewPropertyAnimator</code> 也想推荐大家都用新的来做，但我遇到一个很奇怪的问题，就是在做全页手势返回 Pop 动画时，若手势放开，动画归位，上方的 Navigation Bar 的 Item 会淡入淡出闪一下…找不到解，但回去用 <code class="language-plaintext highlighter-rouge">UIView.animate</code> 就没这问题；如果有地方没注意到欢迎跟我说&lt;( _ _ )&gt;。</p><p><a href="/assets/14cee137c565/1*cVg7iZ_rFC2nxm2H5ET1Gg.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*cVg7iZ_rFC2nxm2H5ET1Gg.gif" alt="问题图; + 按钮是上一页的" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzODQiIGhlaWdodD0iMTA4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>问题图; + 按钮是上一页的</p><p>所以保险起见还是用旧的方式吧！</p><p>实际会依照不同的动画效果建立个别的 Class，若觉得很档案杂，可参考文末包好的方案；或是将同个连贯(Present+Dismii)动画放在一起。</p><h4 id="transitioncoordinator"><span class="me-2">transitionCoordinator</span><a href="#transitioncoordinator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>另外如果需要更细致的控制，例如 ViewController 里面有某个元件需要配合转场动画改变；可在 <code class="language-plaintext highlighter-rouge">UIViewController</code> 中使用 <code class="language-plaintext highlighter-rouge">transitionCoordinator</code> 进行协作，这部分我没用到；有兴趣可参考 <a href="https://kemchenj.github.io/2018-12-24/" target="_blank">此篇文章</a> 。</p><h3 id="怎么控制动画"><span class="me-2">怎么控制动画？</span><a href="#怎么控制动画" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>这边就是前述所说的「交互」，实际就是手势控制；本篇最重要的章节，因为我们的要做的是手势操作与转场动画的连动功能，才能达成我们要的下拉关闭、全页返回功能。</p><h4 id="控制代理设置"><span class="me-2">控制代理设置:</span><a href="#控制代理设置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>同前面 <code class="language-plaintext highlighter-rouge">ViewController</code> 代理动画设计，交互处理的类也需要在代理中告知 <code class="language-plaintext highlighter-rouge">ViewController</code> 。</p><p><strong>UITabBarController: 无</strong> <strong>UINavigationController (Push/Pop):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeNavigationController</span><span class="p">:</span> <span class="kt">UINavigationControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">animationControllerFor</span> <span class="nv">operation</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="o">.</span><span class="kt">Operation</span><span class="p">,</span> <span class="n">from</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">to</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">pop</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning 返回时要套用的动画</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="o">.</span><span class="n">push</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning push时要套用的动画</span>
        <span class="p">}</span>
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    
    <span class="c1">//新增交互代理方法:</span>
    <span class="kd">func</span> <span class="nf">navigationController</span><span class="p">(</span><span class="n">_</span> <span class="nv">navigationController</span><span class="p">:</span> <span class="kt">UINavigationController</span><span class="p">,</span> <span class="n">interactionControllerFor</span> <span class="nv">animationController</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//这边无法得知是Pop还是Push 只能从要做的动画本身做判断</span>
        <span class="k">if</span> <span class="n">animationController</span> <span class="k">is</span> <span class="n">push时套用的动画</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition push动画的交互控制方法</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">animationController</span> <span class="k">is</span> <span class="n">返回时套用的动画</span> <span class="p">{</span>
            <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition pop动画的交互控制方法</span>
        <span class="p">}</span>
        <span class="c1">//回传 nil 即不做交互处理</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>UIViewController (Present/Dismiss):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">self</span><span class="o">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">custom</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HomeAddViewController</span><span class="p">:</span> <span class="kt">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForDismissal</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil 即不做交互处理</span>
        <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition Dismiss时交互控制方法</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">interactionControllerForPresentation</span><span class="p">(</span><span class="n">using</span> <span class="nv">animator</span><span class="p">:</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerInteractiveTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//return nil 即不做交互处理</span>
        <span class="k">return</span> <span class="c1">//UIPercentDrivenInteractiveTransition Present时交互控制方法</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forPresented</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">presenting</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Present时要套用的动画</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animationController</span><span class="p">(</span><span class="n">forDismissed</span> <span class="nv">dismissed</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">//回传 nil 即走预设动画</span>
        <span class="k">return</span> <span class="c1">//UIViewControllerAnimatedTransitioning Dismiss时要套用的动画</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>有实作 interactionControllerFor … 这些方法，就算动画是非交互(EX: self.present 系统呼叫转场) 也会 Call 这些方法处理；我们需要控制的是里面的 <code class="language-plaintext highlighter-rouge">wantsInteractiveStart</code> 参数(下面介绍)。</em></p></blockquote><h4 id="动画交互处理类-uipercentdriveninteractivetransition"><span class="me-2">动画交互处理类 UIPercentDrivenInteractiveTransition:</span><a href="#动画交互处理类-uipercentdriveninteractivetransition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>再来讲核心要实作的 <code class="language-plaintext highlighter-rouge">UIPercentDrivenInteractiveTransition</code> 。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIPercentDrivenInteractiveTransition</span> <span class="p">{</span>
    
    <span class="c1">//要加手势控制交互的UIView</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="o">!</span>
    <span class="c1">//当前的UIViewController</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="o">!</span>
    <span class="c1">//当托拉超过多少%后就完成执行，否则复原</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">thredhold</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mf">0.4</span>
    
    <span class="c1">//不同转场效果可能需要不同资讯，可自订</span>
    <span class="kd">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">presented</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">_</span> <span class="nv">interactiveView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">interactiveView</span> <span class="o">=</span> <span class="n">interactiveView</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presented</span> <span class="o">=</span> <span class="n">presented</span>
        <span class="nf">setupPanGesture</span><span class="p">()</span>
        
        <span class="c1">//默认值，告知系统当前非交互动画</span>
        <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">setupPanGesture</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">panGesture</span> <span class="o">=</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="nf">handlePan</span><span class="p">(</span><span class="nv">_</span><span class="p">:)))</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">maximumNumberOfTouches</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">panGesture</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">interactiveView</span><span class="o">.</span><span class="nf">addGestureRecognizer</span><span class="p">(</span><span class="n">panGesture</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">handlePan</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">sender</span><span class="o">.</span><span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
            <span class="c1">//reset 手势位置</span>
            <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="c1">//告知系统当前开始的是手势触发的交互动画</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">true</span>
            
            <span class="c1">//在手势began时呼叫要做的转场效果(不会直接执行，系统会抓住)</span>
            <span class="c1">//然后转场效果有设对应的动画就会跳到 UIViewControllerAnimatedTransitioning 处理</span>
            <span class="c1">// animated 一定为 true 否则没动画</span>
            
            <span class="c1">//Dismiss:</span>
            <span class="k">self</span><span class="o">.</span><span class="n">presented</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="c1">//Present:</span>
            <span class="c1">//self.present(presenting,animated: true)</span>
            <span class="c1">//Push:</span>
            <span class="c1">//self.navigationController.push(presenting)</span>
            <span class="c1">//Pop:</span>
            <span class="c1">//self.navigationController.pop(animated: true)</span>
        
        <span class="k">case</span> <span class="o">.</span><span class="nv">changed</span><span class="p">:</span>
            <span class="c1">//手势滑动的位置计算 对应动画完成百分比 0~1</span>
            <span class="c1">//实际依动画类型不同，计算方式不同</span>
            <span class="k">let</span> <span class="nv">translation</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="nf">translation</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
            <span class="k">guard</span> <span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">sender</span><span class="o">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">interactiveView</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="k">let</span> <span class="nv">percentage</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">interactiveView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            
            <span class="c1">//update UIViewControllerAnimatedTransitioning 动画百分比</span>
            <span class="nf">update</span><span class="p">(</span><span class="n">percentage</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
            <span class="c1">//手势放开完成时，看完成度有没有超过 thredhold</span>
            <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="k">if</span> <span class="n">percentComplete</span> <span class="o">&gt;=</span> <span class="n">thredhold</span> <span class="p">{</span>
              <span class="c1">//有，告知动画完成</span>
              <span class="nf">finish</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="c1">//无，告知动画归位复原</span>
              <span class="nf">cancel</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="n">cancelled</span><span class="p">,</span> <span class="o">.</span><span class="nv">failed</span><span class="p">:</span>
          <span class="c1">//取消、错误时</span>
          <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="nf">cancel</span><span class="p">()</span>
        <span class="k">default</span><span class="p">:</span>
          <span class="n">wantsInteractiveStart</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//当UIViewController内有UIScrollView元件(UITableView/UICollectionView/WKWebView....)，防止手势冲突</span>
<span class="c1">//当里面的UIScrollView元件已滑到顶部，则启用交互转场的手势操作</span>
<span class="kd">extension</span> <span class="kt">PullToDismissInteractive</span><span class="p">:</span> <span class="kt">UIGestureRecognizerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">gestureRecognizer</span><span class="p">(</span><span class="n">_</span> <span class="nv">gestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">,</span> <span class="n">shouldRecognizeSimultaneouslyWith</span> <span class="nv">otherGestureRecognizer</span><span class="p">:</span> <span class="kt">UIGestureRecognizer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">scrollView</span> <span class="o">=</span> <span class="n">otherGestureRecognizer</span><span class="o">.</span><span class="n">view</span> <span class="k">as?</span> <span class="kt">UIScrollView</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">scrollView</span><span class="o">.</span><span class="n">contentOffset</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p><a href="https://stackoverflow.com/questions/29558622/pan-gesture-why-need-settranslation-to-zero" target="_blank"><em>*关于 sender.setTranslation( .zero, in:interactiveView) 原因的补充点我&lt;</em></a></p><p>我们需要依据不同的手势操作效果，实作不同的 Class；若是同个连贯(Present+Dismii)的操作也可包在一起。</p><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><code class="language-plaintext highlighter-rouge">wantsInteractiveStart</code> <em><strong>务必处于符合的状态</strong> ，若在交互动画时告知 <code class="language-plaintext highlighter-rouge">wantsInteractiveStart = false</code> 也会造成卡画面；</em></p></blockquote><blockquote><p><em>要退出重进 APP 才会恢复正。</em></p></blockquote><p>⚠️⚠️⚠️⚠️⚠️</p><blockquote><p><em>interactiveView 也一定要是 <strong>isUserInteractionEnabled = true</strong> 哦</em></p></blockquote><blockquote><p><em>可以多加设置确保一下！</em></p></blockquote><h3 id="组合"><span class="me-2">组合</span><a href="#组合" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>当我们把这里个 <code class="language-plaintext highlighter-rouge">Delegate</code> 设好、 <code class="language-plaintext highlighter-rouge">Class</code> 建好后就能做到我们想要的功能了。 再来不啰唆，直接上完成范例。</p><h3 id="自制下拉关闭页面效果"><span class="me-2">自制下拉关闭页面效果</span><a href="#自制下拉关闭页面效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>自制下拉的好处在能支援市面所有 iOS 版本、可控制盖板百分比、控制触发关闭位置、客制化动画效果。</p><p><a href="/assets/14cee137c565/1*Wz8y5UJSgS0IUN86upSqLw.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*Wz8y5UJSgS0IUN86upSqLw.gif" alt="点右上方 + Present 页面" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzODQiIGhlaWdodD0iNjYwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>点右上方 + Present 页面</p><p>这是一个 <code class="language-plaintext highlighter-rouge">HomeViewController</code> Present <code class="language-plaintext highlighter-rouge">HomeAddViewController</code> 和 <code class="language-plaintext highlighter-rouge">HomeAddViewController</code> Dismiss的范例。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
</pre><td class="rouge-code"><pre>import UIKit

class HomeViewController: UIViewController {

    @IBAction func addButtonTapped(_ sender: Any) {
        guard let homeAddViewController = UIStoryboard(name: "Main", bundle: nil).instantiateViewController(identifier: "HomeAddViewController") as? HomeAddViewController else {
            return
        }
        
        //transitioningDelegate 可指定目标ViewController处理或当前的ViewController处理
        homeAddViewController.transitioningDelegate = homeAddViewController
        homeAddViewController.modalPresentationStyle = .custom
        self.present(homeAddViewController, animated: true, completion: nil)
    }

}
import UIKit

class HomeAddViewController: UIViewController {

    private var pullToDismissInteractive:PullToDismissInteractive!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        //绑定转场交互资讯
        self.pullToDismissInteractive = PullToDismissInteractive(self, self.view)
    }
    
}

extension HomeAddViewController: UIViewControllerTransitioningDelegate {
    
    func interactionControllerForDismissal(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? {
        return pullToDismissInteractive
    }
    
    func animationController(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? {
        return PresentAndDismissTransition(false)
    }
    
    func animationController(forDismissed dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? {
        return PresentAndDismissTransition(true)
    }
    
    func interactionControllerForPresentation(using animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? {
        //这边无Present操作手势
        return nil
    }
}
import UIKit

class PullToDismissInteractive: UIPercentDrivenInteractiveTransition {
    
    private var interactiveView: UIView!
    private var presented: UIViewController!
    private var completion:(() -&gt; Void)?
    private let thredhold: CGFloat = 0.4
    
    convenience init(_ presented: UIViewController, _ interactiveView: UIView,_ completion:(() -&gt; Void)? = nil) {
        self.init()
        self.interactiveView = interactiveView
        self.completion = completion
        self.presented = presented
        setupPanGesture()
        
        wantsInteractiveStart = false
    }

    private func setupPanGesture() {
        let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:)))
        panGesture.maximumNumberOfTouches = 1
        panGesture.delegate = self
        interactiveView.addGestureRecognizer(panGesture)
    }

    @objc func handlePan(_ sender: UIPanGestureRecognizer) {
        switch sender.state {
        case .began:
            sender.setTranslation(.zero, in: interactiveView)
            wantsInteractiveStart = true
            
            self.presented.dismiss(animated: true, completion: self.completion)
        case .changed:
            let translation = sender.translation(in: interactiveView)
            guard translation.y &gt;= 0 else {
                sender.setTranslation(.zero, in: interactiveView)
                return
            }

            let percentage = abs(translation.y / interactiveView.bounds.height)
            update(percentage)
        case .ended:
            if percentComplete &gt;= thredhold {
                finish()
            } else {
                wantsInteractiveStart = false
                cancel()
            }
        case .cancelled, .failed:
            wantsInteractiveStart = false
            cancel()
        default:
            wantsInteractiveStart = false
            return
        }
    }
}

extension PullToDismissInteractive: UIGestureRecognizerDelegate {
    func gestureRecognizer(_ gestureRecognizer: UIGestureRecognizer, shouldRecognizeSimultaneouslyWith otherGestureRecognizer: UIGestureRecognizer) -&gt; Bool {
        if let scrollView = otherGestureRecognizer.view as? UIScrollView {
            if scrollView.contentOffset.y &lt;= 0 {
                return true
            } else {
                return false
            }
        }
        return true
    }
    
}
</pre></table></code></div></div><p>以上就能达到如图的效果，这边因教学展示不想弄的路太复杂，所以程式码很丑，还有很多优化整合的空间。</p><blockquote><p><strong><em>值得一提的是…</em></strong></p></blockquote><blockquote><p><em>iOS ≥ 13，如果遇到 View 内容有 UITextView，在做下拉关闭动画时，动画当中 UITextView 的文字内容会一片空白；造成体验会闪一下 <a href="https://twitter.com/zhgchgli/status/1207851671553892352" target="_blank">(影片范例)</a> …</em></p></blockquote><blockquote><p><em>这边的解决方案是在做动画时用 <code class="language-plaintext highlighter-rouge">snapshotView(afterScreenUpdates:)</code> 截图取代原本的 View 图层。</em></p></blockquote><h3 id="全页右滑返回"><span class="me-2">全页右滑返回</span><a href="#全页右滑返回" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在寻找全画面都能手势右滑返回的解决方案时，找到个 <strong>Tricky</strong> 的方法： 直接在画面上加一个 <code class="language-plaintext highlighter-rouge">UIPanGestureRecognizer</code> 然后将 <code class="language-plaintext highlighter-rouge">target</code> 、 <code class="language-plaintext highlighter-rouge">action</code> 都指定到原生的 <code class="language-plaintext highlighter-rouge">interactivePopGestureRecognizer</code> ， <code class="language-plaintext highlighter-rouge">action:handleNavigationTransition</code> 。 <a href="https://juejin.im/entry/5795809dd342d30059ed5c60" target="_blank"><em>*详细方法点我&lt;</em></a></p><p>没错！看起来就很 Private API，感觉审核会被拒；而且不确定 Swift 是否可用，应该有用到 OC 才有的 Runtime 特性。</p><h4 id="还是走正规的吧"><span class="me-2">还是走正规的吧：</span><a href="#还是走正规的吧" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ㄧ样使用本篇的方式，我们在 <code class="language-plaintext highlighter-rouge">navigationController</code> POP 返回时自行处理；添加一个全页右滑手势控制配合自订右滑动画，即可！</p><p>其他省略，只贴关键的动画跟交互处理类别：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre>import UIKit

class SwipeBackInteractive: UIPercentDrivenInteractiveTransition {
    
    private var interactiveView: UIView!
    private var navigationController: UINavigationController!

    private let thredhold: CGFloat = 0.4
    
    convenience init(_ navigationController: UINavigationController, _ interactiveView: UIView) {
        self.init()
        self.interactiveView = interactiveView
        
        self.navigationController = navigationController
        setupPanGesture()
        
        wantsInteractiveStart = false
    }

    private func setupPanGesture() {
        let panGesture = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_:)))
        panGesture.maximumNumberOfTouches = 1
        interactiveView.addGestureRecognizer(panGesture)
    }

    @objc func handlePan(_ sender: UIPanGestureRecognizer) {
        
        switch sender.state {
        case .began:
            sender.setTranslation(.zero, in: interactiveView)
            wantsInteractiveStart = true
            
            self.navigationController.popViewController(animated: true)
        case .changed:
            let translation = sender.translation(in: interactiveView)
            guard translation.x &gt;= 0 else {
                sender.setTranslation(.zero, in: interactiveView)
                return
            }

            let percentage = abs(translation.x / interactiveView.bounds.width)
            update(percentage)
        case .ended:
            if percentComplete &gt;= thredhold {
                finish()
            } else {
                wantsInteractiveStart = false
                cancel()
            }
        case .cancelled, .failed:
            wantsInteractiveStart = false
            cancel()
        default:
            wantsInteractiveStart = false
            return
        }
    }
}
</pre></table></code></div></div><h3 id="上拉渐入-uiviewcontroller"><span class="me-2">上拉渐入 UIViewController</span><a href="#上拉渐入-uiviewcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在View上上拉渐入＋下拉关闭，就是在做类似 Spotify 的播放器转场效果了！</p><p>这部分较为繁琐，但原理一样，这边就不 PO 出来了，有兴趣的朋友可参考 GitHub 范例内容。</p><p>要说哪里要注意，大概就是 <strong>在上拉渐入时，动画要确保是使用「.curveLinear 线性」否则会出现上拉不跟手的问题</strong> ；拉的程度跟显示的位置不是正比。</p><h3 id="完成"><span class="me-2">完成！</span><a href="#完成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/14cee137c565/1*RRAVb3p7mZpUCNOpd64-Pw.gif" class="popup img-link blur"><img data-src="/assets/14cee137c565/1*RRAVb3p7mZpUCNOpd64-Pw.gif" alt="完成图" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTUyIiBoZWlnaHQ9IjY1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>完成图</p><blockquote><p>此篇很长，也花了我许久时间整理制作，感谢您的耐心阅读。</p></blockquote><h4 id="全篇-github-范例下载"><span class="me-2">全篇 GitHub 范例下载：</span><a href="#全篇-github-范例下载" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/zhgchgli0718/UIViewControllerTransitionDemo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/af405b87d71ea95f59b19f5de94bda740a12566ddf86eb5a9b34d2271d53bb20/zhgchgli0718/UIViewControllerTransitionDemo" alt="" loading="lazy"></a></p><p><strong>参考资料：</strong></p><ol><li><p><a href="https://imnotyourson.com/draggable-view-controller-interactive-view-controller/" target="_blank">Draggable view controller? Interactive view controller!</a></p><li><p><a href="https://juejin.im/post/5c24745b6fb9a049d5198ce5#18-%E5%AF%BC%E8%88%AA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%BD%AC%E5%9C%BA" target="_blank">系统学习iOS动画之四：视图控制器的转场动画</a></p><li><p><a href="https://juejin.im/post/5c3aa7ff518825551e285b8d" target="_blank">系统学习iOS动画之五：使用UIViewPropertyAnimator</a></p><li><p><a href="https://juejin.im/post/5a9651d25188257a5911f666" target="_blank">用UIPresentationController来写一个简洁漂亮的底部弹出控件</a> (单纯只做Present 动画效果可直接用这个)</p></ol><p><strong>若需要参考优雅的程式码封装使用：</strong></p><ol><li><p>Swift: <a href="https://github.com/Kharauzov/SwipeableCards" target="_blank">https://github.com/Kharauzov/SwipeableCards</a></p><li><p>Objective-C: <a href="https://github.com/saiday/DraggableViewControllerDemo" target="_blank">https://github.com/saiday/DraggableViewControllerDemo</a></p></ol><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/14cee137c565" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2020-01-11-14cee137c565.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/uiviewcontroller/" class="post-tag no-text-decoration" >uiviewcontroller</a> <a href="/tags/mobile-app-development/" class="post-tag no-text-decoration" >mobile-app-development</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20UIViewController%20%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%EF%BD%9C%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD%E3%80%81%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-uiviewcontroller-%25E8%25BD%25AC%25E5%259C%25BA%25E5%258A%25A8%25E7%2594%25BB-%25E4%25B8%258B%25E6%258B%2589%25E5%2585%25B3%25E9%2597%25AD-%25E4%25B8%258A%25E6%258B%2589%25E6%25B8%2590%25E5%2585%25A5%25E4%25B8%258E%25E5%2585%25A8%25E9%25A1%25B5%25E5%258F%25B3%25E6%25BB%2591%25E8%25BF%2594%25E5%259B%259E%25E5%25AE%259E%25E4%25BD%259C%25E6%258A%2580%25E5%25B7%25A7-14cee137c565%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20UIViewController%20%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%EF%BD%9C%E4%B8%8B%E6%8B%89%E5%85%B3%E9%97%AD%E3%80%81%E4%B8%8A%E6%8B%89%E6%B8%90%E5%85%A5%E4%B8%8E%E5%85%A8%E9%A1%B5%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%9C%E6%8A%80%E5%B7%A7%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-uiviewcontroller-%25E8%25BD%25AC%25E5%259C%25BA%25E5%258A%25A8%25E7%2594%25BB-%25E4%25B8%258B%25E6%258B%2589%25E5%2585%25B3%25E9%2597%25AD-%25E4%25B8%258A%25E6%258B%2589%25E6%25B8%2590%25E5%2585%25A5%25E4%25B8%258E%25E5%2585%25A8%25E9%25A1%25B5%25E5%258F%25B3%25E6%25BB%2591%25E8%25BF%2594%25E5%259B%259E%25E5%25AE%259E%25E4%25BD%259C%25E6%258A%2580%25E5%25B7%25A7-14cee137c565%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-uiviewcontroller-%25E8%25BD%25AC%25E5%259C%25BA%25E5%258A%25A8%25E7%2594%25BB-%25E4%25B8%258B%25E6%258B%2589%25E5%2585%25B3%25E9%2597%25AD-%25E4%25B8%258A%25E6%258B%2589%25E6%25B8%2590%25E5%2585%25A5%25E4%25B8%258E%25E5%2585%25A8%25E9%25A1%25B5%25E5%258F%25B3%25E6%25BB%2591%25E8%25BF%2594%25E5%259B%259E%25E5%25AE%259E%25E4%25BD%259C%25E6%258A%2580%25E5%25B7%25A7-14cee137c565%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-uitextview-%E6%96%87%E7%BB%95%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E6%94%BB%E7%95%A5-swift-%E5%9B%BE%E7%89%87%E6%8F%92%E5%85%A5%E4%B8%8E%E8%AE%B0%E5%BF%86%E4%BD%93%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98-e37d66ea1146/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1539454069" data-df="ll" > Oct 14, 2018 </time><h4 class="pt-0 my-2">iOS UITextView 文绕图编辑器开发攻略｜Swift 图片插入与记忆体优化实战</h4><div class="text-muted"><p>针对 iOS UITextView 图片穿插与多图上传痛点，分享 Swift 实作文绕图编辑器的完整解法，包含图片插入游标定位、上传失败处理及记忆体优化技巧，有效避免多图导致卡顿与闪退，提升 APP 稳定度与使用体验。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB-%E4%B8%8B%E6%8B%89%E9%97%9C%E9%96%89-%E4%B8%8A%E6%8B%89%E6%BC%B8%E5%85%A5%E8%88%87%E5%85%A8%E9%A0%81%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AF%A6%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1578768066" data-df="ll" > Jan 12, 2020 </time><h4 class="pt-0 my-2">iOS UIViewController 轉場二三事</h4><div class="text-muted"><p>UIViewController 下拉關閉/上拉出現/全頁右滑返回 效果全解</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1578768066" data-df="ll" > Jan 12, 2020 </time><h4 class="pt-0 my-2">iOS UIViewController Transitions｜Master Pull-Down Close, Pull-Up Present & Full-Page Swipe Back</h4><div class="text-muted"><p>Discover how to implement seamless UIViewController transitions in iOS, including pull-down to close, pull-up to present, and full-page right-swipe back gestures, enhancing user interaction and nav...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS UIViewController Transitions｜Master Pull-Down Close, Pull-Up Present & Full-Page Swipe Back</p></a> <a href="/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB-%E4%B8%8B%E6%8B%89%E9%97%9C%E9%96%89-%E4%B8%8A%E6%8B%89%E6%BC%B8%E5%85%A5%E8%88%87%E5%85%A8%E9%A0%81%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AF%A6%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS UIViewController 轉場二三事</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
