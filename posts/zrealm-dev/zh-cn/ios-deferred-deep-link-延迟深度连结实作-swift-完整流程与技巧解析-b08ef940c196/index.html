<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="针对iOS App推广，解决未安装用户跳转后资料遗失问题，透过剪贴簿与Cookie共享技术，实现安装后自动还原目标页面，提升用户体验与转换率。本文详解Swift实作步骤与iOS版本支援策略。" /><meta property="og:description" content="针对iOS App推广，解决未安装用户跳转后资料遗失问题，透过剪贴簿与Cookie共享技术，实现安装后自动还原目标页面，提升用户体验与转换率。本文详解Swift实作步骤与iOS版本支援策略。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-11T22:34:57+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" /><meta property="twitter:title" content="iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-13T17:32:09+08:00","datePublished":"2019-11-11T22:34:57+08:00","description":"针对iOS App推广，解决未安装用户跳转后资料遗失问题，透过剪贴簿与Cookie共享技术，实现安装后自动还原目标页面，提升用户体验与转换率。本文详解Swift实作步骤与iOS版本支援策略。","headline":"iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"}</script><title>iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-guide-to-seamless-app-navigation-b08ef940c196/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/ios-deferred-deep-link-%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析</h1><p class="post-desc fw-light mb-4">针对iOS App推广，解决未安装用户跳转后资料遗失问题，透过剪贴簿与Cookie共享技术，实现安装后自动还原目标页面，提升用户体验与转换率。本文详解Swift实作步骤与iOS版本支援策略。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1573482897" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 11, 2019 </time> </span> <span> Updated <time data-ts="1726219929" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" class="popup img-link preview-img blur"><img data-src="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3468 words" > <em>19 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS Deferred Deep Link 延迟深度连结实作｜Swift 完整流程与技巧解析</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-guide-to-seamless-app-navigation-b08ef940c196/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><hr /><h3 id="ios-deferred-deep-link-延迟深度连结实作swift"><span class="me-2">iOS Deferred Deep Link 延迟深度连结实作(Swift)</span><a href="#ios-deferred-deep-link-延迟深度连结实作swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>动手打造适应所有场景、不中断的App转跳流程</p><h3 id="20220722-更新-ios-16-upcoming-changes"><span class="me-2">[2022/07/22] 更新 iOS 16 Upcoming Changes</span><a href="#20220722-更新-ios-16-upcoming-changes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS ≥ 16 开始非使用者主动操作贴上动作，App 主动读取剪贴簿的行为会跳出询问视窗，使用者需要按允许，App 才能读取到剪贴簿资讯。</p><p><a href="/assets/b08ef940c196/0*E8h6Fy0H9_5jxhjV.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/0*E8h6Fy0H9_5jxhjV.webp" alt="[UIPasteBoard’s privacy change in iOS 16](https://sarunw.com/posts/uipasteboard-privacy-change-ios16/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNjAiIGhlaWdodD0iMTkzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://sarunw.com/posts/uipasteboard-privacy-change-ios16/" target="_blank">UIPasteBoard’s privacy change in iOS 16</a></p><h3 id="20200702-更新"><span class="me-2">[2020/07/02] 更新</span><a href="#20200702-更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/zh-cn/ios-14-%E5%89%AA%E8%B4%B4%E7%B0%BF%E9%9A%90%E7%A7%81%E9%97%AE%E9%A2%98-%E6%8F%AD%E9%9C%B2-app-%E8%AF%BB%E5%8F%96%E5%8E%9F%E5%9B%A0%E4%B8%8E%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%E8%A7%A3%E6%9E%90-8a04443024e2/">因应 iOS 14 更新，读取剪贴簿时会提示使用者，如要实作请一并参考此篇文章。</a></ul><h4 id="无关"><span class="me-2">无关</span><a href="#无关" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>毕业当完兵到现在庸庸碌碌工作了快三年，成长已趋于平缓，开始进入舒适圈，所幸心一横提了离职，沈淀重新出发。</p><p>在阅读 <a href="https://www.books.com.tw/products/0010733134" target="_blank">做自己的生命设计师</a> 重新梳理自己的人生规划时，回顾了一下工作跟人生，虽然本身技术能力没有很好，但在写 Medium 与大家分享能让我进入「心流」跟获得大量的精力；刚好前阵子有朋友在问 Deep Link 问题，借此整理了我研究的做法，也顺便补充下自己的精力！</p><h3 id="场景"><span class="me-2">场景</span><a href="#场景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>首先要先说明实际应用场景。</p><p>1.当使用者有装 APP 时点击网址连结(Google搜寻来源、FB贴文、Line连结…) 则直接开 APP 呈现目标画面，若无则跳转到 APP Store 安装 APP； <strong>安装完后打开APP，要能重现之前欲前往的画面</strong> 。</p><p><a href="https://www.youtube.com/watch?v=sY6-Q7BFUOM" target="_blank"></a></p><p>2.APP 下载和开启数据追踪，我们想知道 APP 推广连结有多少人确实从这个入口下载和开启 APP 的。</p><p>3.特殊活动入口，例如透过特定网址下载后开启能获得奖励。</p><h4 id="支援度"><span class="me-2">支援度：</span><a href="#支援度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>iOS ≥ 9</p><h3 id="何谓-deferred-deep-link-与-deep-link-的差别"><span class="me-2">何谓 Deferred Deep Link 与 Deep Link 的差别？</span><a href="#何谓-deferred-deep-link-与-deep-link-的差别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="纯-deep-link-本身"><span class="me-2">纯 Deep Link 本身：</span><a href="#纯-deep-link-本身" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/b08ef940c196/1*15arO4L94ZoEyOLtFARtsA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*15arO4L94ZoEyOLtFARtsA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTciIGhlaWdodD0iNTMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可以看到 iOS Deep Link 本身运作机制只有判断 APP 有无安装，有则开 APP，无则不处理．</p><h4 id="首先我们要先加上无则跳转到-app-store提示使用者安装-app"><span class="me-2">首先我们要先加上「无则跳转到 APP Store」提示使用者安装 APP：</span><a href="#首先我们要先加上无则跳转到-app-store提示使用者安装-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>URL Scheme</strong> 的部分是由系统控制，一般用于 APP 内呼叫鲜少公开出来；因为如果触发点在自己无法控制的区域(如：Line连结)，则无法处理。</p><p>若触发点在自身网页上可以使用些小技巧处理，请参考 <a href="https://stackoverflow.com/questions/627916/check-if-url-scheme-is-supported-in-javascript" target="_blank"><strong>这里</strong></a> ：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Redirect...<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    var appurl = 'marry://open';
    var appstore = 'https://apps.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329';

    var timeout;
    function start() {
      window.location = appurl;
      timeout = setTimeout(function(){
        if(confirm('马上安装结婚吧APP?')){
          document.location = appstore;
        }
      }, 1000);
    }

    window.onload = function() {
      start()
    }
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>大略逻辑是 <strong>一样呼叫 URL Scheme，然后设个 Timeout，时间到若还在本页没跳转就当没安装 Call 不到 Scheme，转而导 APP Store 页面</strong> (但体验还是不好还是会跳网址错误提示，只是多了自动转址)。</p><p><strong>Universal Link</strong> 本身就是个自己的网页，若无跳转，预设就是使用网页浏览器呈现，这边有网页服务的可以选择直接跳网页浏览、没有的就直接导 APP Store 页面。</p><p>有网页服务的网站可以在 <code class="language-plaintext highlighter-rouge">&lt;head&gt;&lt;/head&gt;</code> 中加入：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"apple-itunes-app"</span> <span class="na">content=</span><span class="s">"app-id=APPID, app-argument=页面参数"</span><span class="nt">&gt;</span>
</pre></table></code></div></div><p><a href="/assets/b08ef940c196/1*nC1JytAwIwKU04EMBBvf0A.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*nC1JytAwIwKU04EMBBvf0A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NDMiIGhlaWdodD0iNDk4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>使用 iPhone Safari 浏览网页版上方就会出现 APP 安装提示、使用 APP 开启本页的按钮； 参数 <code class="language-plaintext highlighter-rouge">app-argument</code> 就是用来带入页面值，并传递到 APP 用的。</p><p><a href="/assets/b08ef940c196/1*B-_5tIDWQpNO8NxpXQsEcA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*B-_5tIDWQpNO8NxpXQsEcA.webp" alt="加上「无则跳转到 APP Store」的流程图" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjciIGhlaWdodD0iMTE0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>加上「无则跳转到 APP Store」的流程图</p><h4 id="完善-deep-link-app-端处理"><span class="me-2">完善 Deep Link APP 端处理：</span><a href="#完善-deep-link-app-端处理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们要的当然不只是「当使用者有安装 APP 则开启 APP」，我们还要将来源资讯与 APP 串起，让 APP 开启后自动呈现目标页面的 APP 画面。</p><p><strong>URL Scheme</strong> 方式可在 AppDelegate 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool</code> 进行处理：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">sourceApplication</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">annotation</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"marry"</span><span class="p">,</span><span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">queryParameters</span> <span class="p">{</span>
      <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
        <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
      <span class="p">}</span>    
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Universal Link</strong> 则是在 AppDelegate 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool</code> 进行处理：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">URL</span> <span class="p">{</span>
    <span class="c1">/// test=1&amp;a=b&amp;c=d =&gt; ["test":"1","a":"b","c":"d"]</span>
    <span class="c1">/// 解析网址query转换成[String: String]数组资料</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">queryParameters</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">components</span> <span class="o">=</span> <span class="kt">URLComponents</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">resolvingAgainstBaseURL</span><span class="p">:</span> <span class="kc">true</span><span class="p">),</span> <span class="k">let</span> <span class="nv">queryItems</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">queryItems</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">queryItems</span> <span class="p">{</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">parameters</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>先附上一个 URL 的扩充方法 queryParameters，用于方便将 URL Query 转换成 Swift Dictionary。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="k">continue</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">,</span> <span class="nv">restorationHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        
  <span class="k">if</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">activityType</span> <span class="o">==</span> <span class="kt">NSUserActivityTypeBrowsingWeb</span><span class="p">,</span> <span class="n">webpageURL</span> <span class="o">=</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">webpageURL</span> <span class="p">{</span>
    <span class="c1">/// 如果是universal link url来源...</span>
    <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">webpageURL</span><span class="o">.</span><span class="n">queryParameters</span>
    
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
      <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="kc">true</span>  
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/b08ef940c196/1*zhtWK56EqWpE91yTVu64Lg.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*zhtWK56EqWpE91yTVu64Lg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDkiIGhlaWdodD0iNDI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>完成！</p><h4 id="那还缺什么"><span class="me-2">那还缺什么？</span><a href="#那还缺什么" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>目前看来已经很完美了，我们处理了所有会遇到的状况，那还缺什么？</p><p><a href="/assets/b08ef940c196/1*ulrLKyvTKoChPScWD9wHyA.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*ulrLKyvTKoChPScWD9wHyA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjcyNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>如图所示，如果是 未安装 -&gt; APP Store 安装 -&gt; APP Store 打开，来源所带的资料就会中断，APP 不知道来源所以就只会显示首页；使用者要再回到上一步网页再点一次开启，APP 才会驱动跳页。</p><p><a href="/assets/b08ef940c196/1*dFdvCRRdM3vrN3lnyG8Diw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*dFdvCRRdM3vrN3lnyG8Diw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><em>虽然这样也不是不行，但考虑到跳出流失率，多一个步骤就是多一层流失，还有使用者体验起来不顺畅；更何况使用者未必这么聪明。</em></p></blockquote><h4 id="进入本文重点"><span class="me-2">进入本文重点</span><a href="#进入本文重点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>何谓 Deferred Deep Link？，延迟深度连结；就是让我们的 Deep Link 可以延伸到 APP Store 安装完后依然保有来源资料。</p><p>据 Android 工程师表示 Android 本身就有此功能，但在 iOS 上并不支援此设定、要达到此功能的做法也不友善，请继续看下去。</p><h3 id="deferred-deep-link"><span class="me-2">Deferred Deep Link</span><a href="#deferred-deep-link" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><em>如果不想花时间自己做的话可以直接使用 <a href="http://branch.io" target="_blank">branch.io</a> 或 <a href="https://firebase.google.com/docs/dynamic-links" target="_blank">Firebase Dynamic Links</a> 本文介绍的方法就是 Firebase 使用的方式。</em></p></blockquote><p><strong>要达成 Deferred Deep Link 的效果网路上有两种做法：</strong></p><p>一种是透过使用者装置、IP、环境…等等参数计算出一个杂凑值，在网页端存入资料到伺服器；当 APP 安装后打开用同样方式计算，如果值相同则取出资料恢复（branch.io 的做法）。</p><p>另一种是本文要介绍的方法，同 Firebase 作法；使用 iPhone 剪贴簿和 Safari 与 APP Cookie 共享机制的方法，等于是把资料存在剪贴簿或Cookie，APP安装完成后再去读出来使用。</p><p><a href="/assets/b08ef940c196/1*VVahSlHV2N2jcIw4afzr2g.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*VVahSlHV2N2jcIw4afzr2g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzUiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>
点击「Open」后你的剪贴簿就会被 JavaScript 自动覆盖复制上跳转相关资讯：https://XXX.app.goo.gl/?link=https://XXX.net/topicID=1&amp;type=topic
</pre></table></code></div></div><p>相信有套过 Firebase Dynamic Links 的人一定不陌生这个开启跳转页，了解到原理之后就知道这页在流程中是无法移除的！</p><p>另外 Firebase 也不提供进行样式修改。</p><h4 id="支援度-1"><span class="me-2">支援度</span><a href="#支援度-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先讲个坑，支援度问题；如前所说的「不友善」！</p><p><a href="/assets/b08ef940c196/1*LR3MSAcwjaoSQhwvtD2sUQ.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*LR3MSAcwjaoSQhwvtD2sUQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDIiIGhlaWdodD0iNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>如果 APP 只考虑 iOS ≥ 10 以上的话容易许多，APP 实作剪贴簿存取、Web 使用 JavaScript 将资讯覆盖到剪贴簿，然后再跳转到 APP Store 导下载就好。</p><p>iOS = 9 不支援JavaScript自动剪贴簿但支援 <strong>Safari 与 APP SFSafariViewController「Cookie 互通大法」</strong></p><p>另外在 APP 需要偷偷在背景加入 SFSafariViewController 载入 Web，再从 Web 取得刚才点连结时存的Cookie资讯。</p><blockquote><p><em>步骤繁琐＆连结点击仅限 Safari浏览器。</em></p></blockquote><p><a href="/assets/b08ef940c196/1*tPXHlrQE3MdrjMzFbnS_4w.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*tPXHlrQE3MdrjMzFbnS_4w.webp" alt="[SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTQiIGhlaWdodD0iNDQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller" target="_blank">SFSafariViewController</a></p><blockquote><p><em>根据官方文件，iOS 11 已无法取得使用者的 Safari Cookie，若有这方面需求可使用 SFAuthenticationSession，但此方法无法在背景偷执行，每次载入前都会跳出以下询问视窗：</em></p></blockquote><p><a href="/assets/b08ef940c196/1*eisreftWPWn9PTCbuLQqdw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*eisreftWPWn9PTCbuLQqdw.webp" alt="*SFAuthenticationSession 询问视窗*" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMzQyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><em>SFAuthenticationSession 询问视窗</em></p><blockquote><p><em>还有就是 APP审查是不允许将SFSafariViewController放在使用者看不到的地方的。(用程式触发再 addSubview 不太容易被发现)</em></p></blockquote><h3 id="动手做"><span class="me-2">动手做</span><a href="#动手做" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>先讲简单的，只考虑 iOS ≥ 10 以上的用户，单纯使用 iPhone 剪贴簿转传资讯。</p><h4 id="web-端"><span class="me-2">Web 端：</span><a href="#web-端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*P2saSHeIX7TZyCQY0StN1Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>我们仿造 Firebase Dynamic Links 客制化刻了自己的页面，使用 <code class="language-plaintext highlighter-rouge">clipboard.js</code> 这个套件让使用者点击「立即前往」时先将我们要带给 APP 的资讯复制到剪贴簿 <code class="language-plaintext highlighter-rouge">（marry://topicID=1&amp;type=topic）</code> ，然后再使用 <code class="language-plaintext highlighter-rouge">location.href</code> 跳转到 APP Store 商城页。</p><h4 id="app-端"><span class="me-2">APP 端：</span><a href="#app-端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>在 AppDelegate 或 主页 UIViewController 中读取剪贴簿的值：</p><p><code class="language-plaintext highlighter-rouge">let pasteData = UIPasteboard.general.string</code></p><p>这边建议还是将资讯使用 URL Scheme 方式包装，方便进行辨识、资料反解：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">pasteData</span> <span class="o">=</span> <span class="kt">UIPasteboard</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">string</span><span class="p">,</span><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">pasteData</span><span class="p">),</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"marry"</span><span class="p">,</span><span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">queryParameters</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"topic"</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">VC</span> <span class="o">=</span> <span class="kt">TopicViewController</span><span class="p">(</span><span class="nv">topicID</span><span class="p">:</span><span class="n">params</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
      <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">keyWindow</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span><span class="p">?</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="kt">VC</span><span class="p">,</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>最后在处理完动作后使用 <code class="language-plaintext highlighter-rouge">UIPasteboard.general.string = “”</code> 将剪贴簿中的资讯清除。</p><h3 id="动手做--支援-ios-9-版本"><span class="me-2">动手做 — 支援 iOS 9 版本</span><a href="#动手做--支援-ios-9-版本" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>麻烦的来了，支援 iOS 9 版，前文有说由于不支援剪贴簿，要使用 <strong>Cookie 互通大法</strong> 。</p><h4 id="web-端-1"><span class="me-2">Web 端：</span><a href="#web-端-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>web 端也算好处理，就是改成使用者点击「立即前往」时将我们要带给 APP 的资讯存到 Cookie <code class="language-plaintext highlighter-rouge">（marry://topicID=1&amp;type=topic）</code> ，然后再使用 <code class="language-plaintext highlighter-rouge">location.href</code> 跳转到 APP Store 商城页。</p><p>这里提供两个封装好的 JavaScript 处理 Cookie 的方法，加速开发：</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">/// name: Cookie 名称</span>
<span class="c1">/// val: Cookie 值</span>
<span class="c1">/// day: Cookie 有效期限，预设１天</span>
<span class="c1">/// EX1: setcookie("iosDeepLinkData","marry://topicID=1&amp;type=topic")</span>
<span class="c1">/// EX2: setcookie("hey","hi",365) = 一年有效</span>
<span class="kd">function</span> <span class="nf">setcookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">exdate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="nx">day</span> <span class="o">=</span> <span class="nx">day</span> <span class="err">\\</span><span class="o">|</span><span class="err">\\</span><span class="o">|</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">exdate</span><span class="p">.</span><span class="nf">setDate</span><span class="p">(</span><span class="nx">exdate</span><span class="p">.</span><span class="nf">getDate</span><span class="p">()</span> <span class="o">+</span> <span class="nx">day</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="dl">""</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;expires=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">exdate</span><span class="p">.</span><span class="nf">toGMTString</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">/// getCookie("iosDeepLinkData") =&gt; marry://topicID=1&amp;type=topic</span>
<span class="kd">function</span> <span class="nf">getCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="k">new</span> <span class="nc">RegExp</span><span class="p">(</span><span class="dl">"</span><span class="s2">(^</span><span class="se">\\</span><span class="s2">| )</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">=([^;]*)(;</span><span class="se">\\</span><span class="s2">|$)</span><span class="dl">"</span><span class="p">));</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">arr</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="nf">decodeURI</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="app-端-1"><span class="me-2">APP 端：</span><a href="#app-端-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>本文最麻烦的地方来了。</p><p>前文有提到原理，我们要在主页的UIViewController用程式偷偷加载一个SFSafariViewController 在背景不让使用者察觉。</p><p><strong>再说个坑：</strong> 偷偷加载这件事，iOS ≥ 10 SFSafariViewController 的 View如果大小设定小于1、透明度小于0.05、设成 isHidden，SFSafariViewController 就 <strong>不会载入</strong> 。</p><blockquote><p>p.s iOS = 10 同时支援 Cookie 及 剪贴簿。</p></blockquote><p><a href="/assets/b08ef940c196/1*ab-6ppwHU72AsKKLYBitbw.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*ab-6ppwHU72AsKKLYBitbw.webp" alt="&lt;https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788&gt;{:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTAiIGhlaWdodD0iMjY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788" target="_blank">https://stackoverflow.com/questions/39019352/ios10-sfsafariviewcontroller-not-working-when-alpha-is-set-to-0/39216788</a></p><p>我这边的做法是在 主页的UIViewController 上方放一个 UIView 随便给个高度，但底部对齐 主页面 UIView 上方，然后拉 IBOutlet <code class="language-plaintext highlighter-rouge">（sharedCookieView）</code> 到 Class；在 viewDidLoad( ) 时 init SFSafariViewController 并将其 View 加入到 <code class="language-plaintext highlighter-rouge">sharedCookieView</code> 上，所以他实际有显示有载入，只是跑出画面了，使用者看不到🌝。</p><p><strong>SFSafariViewController 的 URL 该指向？</strong></p><p>同 Web 端分享页面，我们要再刻一个 For 读取 Cookie 的页面，并将两个页面放在同个网域之下避免跨网域Cookie问题，页面内容稍后附上。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">SharedCookieView</span><span class="p">:</span> <span class="kt">UIView</span><span class="o">!</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    
    <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"http://app.marry.com.tw/loadCookie.html"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">sharedCookieViewController</span> <span class="o">=</span> <span class="kt">SFSafariViewController</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="kt">VC</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    
    <span class="k">self</span><span class="o">.</span><span class="nf">addChildViewController</span><span class="p">(</span><span class="n">sharedCookieViewController</span><span class="p">)</span>
    <span class="k">self</span><span class="o">.</span><span class="kt">SharedCookieView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">sharedCookieViewController</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
    
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">beginAppearanceTransition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">didMove</span><span class="p">(</span><span class="nv">toParentViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="n">sharedCookieViewController</span><span class="o">.</span><span class="nf">endAppearanceTransition</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">sharedCookieViewController.delegate = self</code></p><p><code class="language-plaintext highlighter-rouge">class HomeViewController: UIViewController, SFSafariViewControllerDelegate</code></p><p>需要加上这个 Delegate 才能捕获载入完成后的 CallBack 处理。</p><p>我们可以在：</p><p><code class="language-plaintext highlighter-rouge">func safariViewController(_ controller: SFSafariViewController, didCompleteInitialLoad didLoadSuccessfully: Bool) {</code></p><p>方法中捕获载入完成事件。</p><p>到这步，你可能会想再来就是在 <code class="language-plaintext highlighter-rouge">didCompleteInitialLoad</code> 中读取 网页内的 Cookie 就完成了！</p><p>在这里我没找到读取 SFSafariViewController Cookie 的方法，使用网路的方法读出来都是空的。</p><blockquote><p><em>或可能要使用 JavaScript 与页面内容进行交互，叫 JavaScript 读 Cookie 回传给 UIViewController。</em></p></blockquote><h4 id="tricky-的-url-scheme-法"><span class="me-2">Tricky 的 URL Scheme 法</span><a href="#tricky-的-url-scheme-法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>既然 iOS 不知到如何取得共享的 Cookie，那我们就直接交由「读取 Cookie 的页面」去帮我们「读取 Cookie」。</p><p>前文附上的 JavaScript 处理 Cookie 的方法中的 getCookie( ) 就是用在这，我们的「读取 Cookie 的页面」内容是个空白页(反正使用者看不到)，但是在 JavaScript 部分要在 body onload 之后去读取 Cookie：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Load iOS Deep Link Saved Cookie...<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;script&gt;</span>
  function checkCookie() {
    var iOSDeepLinkData = getCookie("iOSDeepLinkData");
    if (iOSDeepLinkData <span class="err">&amp;&amp;</span> iOSDeepLinkData != '') {
        setcookie("iOSDeepLinkData", "", -1);
        window.location.href = iOSDeepLinkData; /// marry://topicID=1<span class="err">&amp;</span>type=topic
    }
  }
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"checkCookie();"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>实际的原理总结就是：在 <code class="language-plaintext highlighter-rouge">HomeViewController viewDidLoad</code> 时加入 <code class="language-plaintext highlighter-rouge">SFSafariViewController</code> 偷加载 <code class="language-plaintext highlighter-rouge">loadCookie.html</code> 页面， <code class="language-plaintext highlighter-rouge">loadCookie.html</code> 页面读取检查先前存的 Cookie，若有则读出清除，然后使用 <code class="language-plaintext highlighter-rouge">window.location.href</code> 呼叫，触发 <code class="language-plaintext highlighter-rouge">URL Scheme</code> 机制。</p><p>所以之后对应的 CallBack 处理就会回到 <code class="language-plaintext highlighter-rouge">AppDelegate</code> 中的 <code class="language-plaintext highlighter-rouge">func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool</code> 进行处理。</p><h3 id="完工总结"><span class="me-2">完工！总结：</span><a href="#完工总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/b08ef940c196/1*kp26TdlJBW5sVxw4zYa9Rg.webp" class="popup img-link blur"><img data-src="/assets/b08ef940c196/1*kp26TdlJBW5sVxw4zYa9Rg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjczIiBoZWlnaHQ9Ijg0MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>如果觉得烦琐，可以直接使用 <a href="http://branch.io" target="_blank">branch.io</a> 或 <a href="https://firebase.google.com/docs/dynamic-links" target="_blank">Firebase Dynamic</a> 没必要重造轮子，这边是因为介面客制化及一些复杂需求，只好自己打造。</p><p>iOS=9 的用户已经非常稀少，不是很必要的话可以直接忽略；使用剪贴簿的方法快又有效率，而且用剪贴簿就不用局限连结一定要用 Safari 开启！</p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/b08ef940c196" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2019-11-11-b08ef940c196.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/deeplink/" class="post-tag no-text-decoration" >deeplink</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/universal-links/" class="post-tag no-text-decoration" >universal-links</a> <a href="/tags/app-store/" class="post-tag no-text-decoration" >app-store</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20Deferred%20Deep%20Link%20%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C%EF%BD%9CSwift%20%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E8%25BF%259F%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25BF%259E%25E7%25BB%2593%25E5%25AE%259E%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E4%25B8%258E%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20Deferred%20Deep%20Link%20%E5%BB%B6%E8%BF%9F%E6%B7%B1%E5%BA%A6%E8%BF%9E%E7%BB%93%E5%AE%9E%E4%BD%9C%EF%BD%9CSwift%20%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E8%25BF%259F%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25BF%259E%25E7%25BB%2593%25E5%25AE%259E%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E4%25B8%258E%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-deferred-deep-link-%25E5%25BB%25B6%25E8%25BF%259F%25E6%25B7%25B1%25E5%25BA%25A6%25E8%25BF%259E%25E7%25BB%2593%25E5%25AE%259E%25E4%25BD%259C-swift-%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E4%25B8%258E%25E6%258A%2580%25E5%25B7%25A7%25E8%25A7%25A3%25E6%259E%2590-b08ef940c196%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/universal-links-ios-%E5%BC%80%E5%8F%91%E6%94%BB%E7%95%A5-%E8%AE%BE%E5%AE%9A%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-12c5026da33d/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1612411045" data-df="ll" > Feb 4, 2021 </time><h4 class="pt-0 my-2">Universal Links 新鲜事</h4><div class="text-muted"><p>iOS 13, iOS 14 Universal Links 新鲜事＆建立本地测试环境</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1573482897" data-df="ll" > Nov 11, 2019 </time><h4 class="pt-0 my-2">iOS Deferred Deep Link 延遲深度連結實作(Swift)</h4><div class="text-muted"><p>動手打造適應所有場景、不中斷的App轉跳流程</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-guide-to-seamless-app-navigation-b08ef940c196/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1573482897" data-df="ll" > Nov 11, 2019 </time><h4 class="pt-0 my-2">iOS Deferred Deep Link Implementation｜Swift Guide to Seamless App Navigation</h4><div class="text-muted"><p>Discover how to implement iOS deferred deep links in Swift to create uninterrupted app navigation across all scenarios, enhancing user experience and retention with reliable link handling.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/ios-deferred-deep-link-implementation-swift-guide-to-seamless-app-navigation-b08ef940c196/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS Deferred Deep Link Implementation｜Swift Guide to Seamless App Navigation</p></a> <a href="/posts/zrealm-dev/ios-deferred-deep-link-%E5%BB%B6%E9%81%B2%E6%B7%B1%E5%BA%A6%E9%80%A3%E7%B5%90%E5%AF%A6%E4%BD%9C-swift-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%88%87%E6%8A%80%E5%B7%A7%E8%A7%A3%E6%9E%90-b08ef940c196/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS Deferred Deep Link 延遲深度連結實作(Swift)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
