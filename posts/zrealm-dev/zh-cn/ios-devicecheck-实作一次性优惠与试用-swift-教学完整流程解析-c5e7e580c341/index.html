<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="针对 iOS 开发者解决装置唯一识别难题，透过 DeviceCheck API 实现防止多次试用与优惠滥用，教你 Swift 端取得 Token、后端组合 JWT 串接 Apple 伺服器，保障一次性优惠功能稳定执行。" /><meta property="og:description" content="针对 iOS 开发者解决装置唯一识别难题，透过 DeviceCheck API 实现防止多次试用与优惠滥用，教你 Swift 端取得 Token、后端组合 JWT 串接 Apple 伺服器，保障一次性优惠功能稳定执行。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-devicecheck-%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8-swift-%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-devicecheck-%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8-swift-%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-04-29T23:30:01+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" /><meta property="twitter:title" content="iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T15:43:24+08:00","datePublished":"2019-04-29T23:30:01+08:00","description":"针对 iOS 开发者解决装置唯一识别难题，透过 DeviceCheck API 实现防止多次试用与优惠滥用，教你 Swift 端取得 Token、后端组合 JWT 串接 Apple 伺服器，保障一次性优惠功能稳定执行。","headline":"iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-devicecheck-%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8-swift-%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/ios-devicecheck-%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8-swift-%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/"}</script><title>iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-devicecheck-implement-one-time-offers-and-trials-seamlessly-with-swift-c5e7e580c341"><link rel="alternate" hreflang="zh-tw" href="/posts/zrealm-dev/ios-devicecheck-%E5%AF%A6%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E8%88%87%E8%A9%A6%E7%94%A8-swift-%E6%95%99%E5%AD%B8%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/ios-devicecheck-%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8-swift-%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析</h1><p class="post-desc fw-light mb-4">针对 iOS 开发者解决装置唯一识别难题，透过 DeviceCheck API 实现防止多次试用与优惠滥用，教你 Swift 端取得 Token、后端组合 JWT 串接 Apple 伺服器，保障一次性优惠功能稳定执行。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1556551801" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 29, 2019 </time> </span> <span> Updated <time data-ts="1712994204" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" class="popup img-link preview-img blur"><img data-src="/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2384 words" > <em>13 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS DeviceCheck 实作一次性优惠与试用｜Swift 教学完整流程解析</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/ios-devicecheck-implement-one-time-offers-and-trials-seamlessly-with-swift-c5e7e580c341"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-devicecheck-%E5%AF%A6%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E8%88%87%E8%A9%A6%E7%94%A8-swift-%E6%95%99%E5%AD%B8%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341"><strong>點此這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><hr /><h3 id="ios-完美实践一次性优惠或试用的方法-swift"><span class="me-2">iOS 完美实践一次性优惠或试用的方法 (Swift)</span><a href="#ios-完美实践一次性优惠或试用的方法-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS DeviceCheck 跟著你到天涯海角</p><p>在写上一篇 <a href="/posts/zrealm-dev/zh-cn/swift-ios%E7%94%B5%E8%AF%9D%E8%BE%A8%E8%AF%86%E5%AE%9E%E4%BD%9C-call-directory-extension%E7%A6%BB%E7%BA%BF%E5%8F%B7%E7%A0%81%E6%A0%87%E8%AE%B0%E5%AE%8C%E6%95%B4%E6%94%BB%E7%95%A5-ac557047d206">Call Directory Extension</a> 时无意间发现这个冷门的API，虽然已不是什么新鲜事(WWDC 2017时公布/iOS ≥11支援)、实作方面也非常简易；但还是小小的研究测试了一下并整理出文章当做个纪录．</p><h3 id="devicecheck-能干嘛"><span class="me-2">DeviceCheck 能干嘛？</span><a href="#devicecheck-能干嘛" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><strong>允许开发者针对使用者的装置进行识别标记</strong></p></blockquote><p>自从 iOS ≥ 6 之后开发者无法取得使用者装置的唯一识别符(UUID)，折衷的做法是使用IDFV结合KeyChain(详细可参考之前 <a href="/posts/zrealm-dev/zh-cn/ios-uuid-%E8%A7%A3%E6%9E%90-swift%E8%A3%85%E7%BD%AE%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E4%B8%8Eidfv%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88%E5%85%A8%E6%94%BB%E7%95%A5-a4bc3bce7513">这篇</a> )，但在 iCloud 换帐号或是重置手机…等状况下，UUID还是会重置；无法保证装置的唯一性，如果以此作为一些业务逻辑的储存及判断，例如：首次免费试用，就可能发生使用者狂换帐号、重置手机，可不断无限试用的漏洞．</p><p>DeviceCheck 虽然不能让我们得到保证不会改变的UUID，但他能做到「 <strong>储存」</strong> 的功能，每个装置Apple提供2 bits的云端储存空间，透过传送装置产生的临时识别Token给Apple，可写入/读取那2 bits的资讯。</p><h4 id="2-bits-能存什么"><span class="me-2">2 bits? 能存什么？</span><a href="#2-bits-能存什么" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/c5e7e580c341/1*29HWP-4vlMaMng3O2hJSQw.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*29HWP-4vlMaMng3O2hJSQw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMzEiIGhlaWdodD0iNzUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>只能组合出4种状态，能做的功能有限．</p><h4 id="与原本储存方式比较"><span class="me-2">与原本储存方式比较：</span><a href="#与原本储存方式比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/c5e7e580c341/1*fhw8C_wb2ehP_xgwMtPmoQ.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*fhw8C_wb2ehP_xgwMtPmoQ.webp" alt="✓ 表示资料还在" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MzAiIGhlaWdodD0iOTkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>✓ 表示资料还在</p><p><em>p.s. 这边小弟牺牲了自已的手机实际做了测试，结果吻合；就算我登出换iCloud、清出所有资料、还原所有设定、回到原厂初始状态，重新安装完APP都还是能取到值．</em></p><h4 id="主要运作流程如下"><span class="me-2">主要运作流程如下：</span><a href="#主要运作流程如下" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/c5e7e580c341/1*pB25wJ1uEzzznUfT05gfBw.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*pB25wJ1uEzzznUfT05gfBw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDcxIiBoZWlnaHQ9IjEwMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>iOS APP 这边透过DeviceCheck API产生一组识别装置用的临时Token，传给后端再经由后端组合开发者的private key资讯、开发者资讯成JWT格式后转传给Apple伺服器；后端取得Apple回传结果后处理完格式再丢回iOS APP．</p><h3 id="devicecheck-的应用"><span class="me-2">DeviceCheck 的应用</span><a href="#devicecheck-的应用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>附上 DeviceCheck 在 <a href="https://developer.apple.com/videos/play/wwdc2017/702/" target="_blank">WWDC2017</a> 上的截图：</p><p><a href="/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*yXSqoDouuL4Jl2sM49iLHA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTUiIGhlaWdodD0iMjkwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>因 <strong>每个装置只能存2 bits的资讯</strong> ，所以能做的项目差不多就如官方所提及的应用包含装置是否曾经已试用过、是否付费过、是否是拒绝往来户…等等；且只能实现一项．</p><p><strong>支援度：</strong> iOS ≥ 11</p><h3 id="开始"><span class="me-2">开始！</span><a href="#开始" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>了解完基本资讯后，让我们开始动手做吧！</p><h4 id="ios-app-端"><span class="me-2">iOS APP 端：</span><a href="#ios-app-端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">DeviceCheck</span>
<span class="c1">//....</span>
<span class="c1">//</span>
<span class="kt">DCDevice</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">generateToken</span> <span class="p">{</span> <span class="n">dataOrNil</span><span class="p">,</span> <span class="n">errorOrNil</span> <span class="k">in</span>
  <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">dataOrNil</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
  <span class="k">let</span> <span class="nv">deviceToken</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">()</span>
            
   <span class="c1">//...</span>
   <span class="c1">//POST deviceToken 到后端，请后端去跟苹果伺服器查询，然后再回传结果给APP处理</span>
<span class="p">}</span>
</pre></table></code></div></div><p>如流程所述，APP要做的只有取得临时识别Token（ <strong>deviceToken</strong> ）！</p><p>再来就是将deviceToken发送到后端我们自己的API去处理．</p><h4 id="后端"><span class="me-2">后端：</span><a href="#后端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>重点在后端处理的部分</p><h4 id="1首先登入-开发者后台-记下-team-id"><span class="me-2">1.首先登入 <a href="https://developer.apple.com/account/#/membership/" target="_blank">开发者后台</a> <strong>记下 Team ID</strong></span><a href="#1首先登入-开发者后台-记下-team-id" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/c5e7e580c341/1*4_DB0CfHmEqt0HO6mDt8mA.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*4_DB0CfHmEqt0HO6mDt8mA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIwIiBoZWlnaHQ9Ijg2NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="2-再点侧栏的-certificates-ids--profiles-前往凭证管理平台"><span class="me-2">2. 再点侧栏的 <a href="https://developer.apple.com/account/ios/certificate/" target="_blank">Certificates, IDs &amp; Profiles</a> 前往凭证管理平台</span><a href="#2-再点侧栏的-certificates-ids--profiles-前往凭证管理平台" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/c5e7e580c341/1*zoRcWhT9HcwLXWlmui5wNw.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*zoRcWhT9HcwLXWlmui5wNw.webp" alt="选择「Keys」-&gt; 「All」-&gt; 右上角「+」新增" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjkiIGhlaWdodD0iNDc2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>选择「Keys」-&gt; 「All」-&gt; 右上角「+」新增</p><p><a href="/assets/c5e7e580c341/1*QgSEmllj-9AjM74tGucUag.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*QgSEmllj-9AjM74tGucUag.webp" alt="Step 1.建立新Key，勾选「DeviceCheck」" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjUiIGhlaWdodD0iOTQ1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Step 1.建立新Key，勾选「DeviceCheck」</p><p><a href="/assets/c5e7e580c341/1*hC4rOksfkDJzo3TWJMFrXg.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*hC4rOksfkDJzo3TWJMFrXg.webp" alt="Step 2. 「Confirm」确认" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzIiIGhlaWdodD0iODUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Step 2. 「Confirm」确认</p><p><a href="/assets/c5e7e580c341/1*I9TWEmsmEqZA-01OGq52kA.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*I9TWEmsmEqZA-01OGq52kA.webp" alt="Finished." data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjYiIGhlaWdodD0iODQ5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Finished.</p><p>最后一步建立完成后， <strong>记下 Key ID</strong> 及点击「Download」下载回 privateKey.p8 私钥档案．</p><p>这时候你已经准备齐全了所有推播所需资料：</p><ol><li><p>Team ID</p><li><p>Key ID</p><li><p>privateKey.p8</p></ol><h4 id="3-依apple规范组合-jwtjson-web-token-格式"><span class="me-2">3. 依Apple规范组合 <a href="https://yami.io/jwt/" target="_blank">JWT(JSON Web Token)</a> 格式</span><a href="#3-依apple规范组合-jwtjson-web-token-格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>演算法：</strong> ES256</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="err">//HEADER:</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ES256"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"kid"</span><span class="p">:</span><span class="w"> </span><span class="err">Key</span><span class="w"> </span><span class="err">ID</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//PAYLOAD:</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="err">Team</span><span class="w"> </span><span class="err">ID</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="err">请求时间戳(Unix</span><span class="w"> </span><span class="err">Timestamp</span><span class="p">,</span><span class="err">EX:</span><span class="mi">1556549164</span><span class="err">)</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="err">逾期时间戳(Unix</span><span class="w"> </span><span class="err">Timestamp</span><span class="p">,</span><span class="err">EX:</span><span class="mi">1557000000</span><span class="err">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//时间戳务必是整数格式！</span><span class="w">
</span></pre></table></code></div></div><p>取得组合的JWT字串：xxxxxx.xxxxxx.xxxxxx</p><h4 id="4-将资料发送给apple伺服器取得回传结果"><span class="me-2">4. 将资料发送给Apple伺服器＆取得回传结果</span><a href="#4-将资料发送给apple伺服器取得回传结果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>同APNS推播有分开发环境跟正式环境：</strong> 1.开发环境：api.development.devicecheck.apple.com <em>（不知道为什么我开发环境发送都会回传失败）</em> 2.正式环境：api.devicecheck.apple.com</p><p><strong>DeviceCheck API 提供两个操作：</strong> <strong>1.查询储存资料：</strong> https://api.devicecheck.apple.com/v1/query_two_bits</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>//Headers:
Authorization: Bearer xxxxxx.xxxxxx.xxxxxx (组合的JWT字串)

//Content:
device_token:deviceToken (要查询的装置Token)
transaction_id:UUID().uuidString (查询识别符，这里直接用UUID代表)
timestamp: 请求时间戳（毫秒），注意！这里是毫秒（EX: 1556549164000）
</pre></table></code></div></div><p><strong>回传状态：</strong></p><p><a href="/assets/c5e7e580c341/1*MAa5Z8bK9ppAN6WJxEButg.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*MAa5Z8bK9ppAN6WJxEButg.webp" alt="[官方文件](https://developer.apple.com/documentation/devicecheck/accessing_and_modifying_per-device_data){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTciIGhlaWdodD0iNzU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/documentation/devicecheck/accessing_and_modifying_per-device_data" target="_blank">官方文件</a></p><p><strong>回传内容：</strong></p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"bit0"</span><span class="p">:</span><span class="w"> </span><span class="err">Int：</span><span class="mi">2</span><span class="w"> </span><span class="err">bits</span><span class="w"> </span><span class="err">资料中第一位的资料：</span><span class="mi">0</span><span class="err">或</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"bit1"</span><span class="p">:</span><span class="w"> </span><span class="err">Int：</span><span class="mi">2</span><span class="w"> </span><span class="err">bits</span><span class="w"> </span><span class="err">资料中第二位的资料：</span><span class="mi">0</span><span class="err">或</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"last_update_time"</span><span class="p">:</span><span class="w"> </span><span class="err">String：</span><span class="s2">"最后修改时间 YYYY-MM"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p><em>p.s. 你没看错，最后修改时间就只能显示到年-月</em></p><p><strong>2.写入储存资料：</strong> https://api.devicecheck.apple.com/v1/update_two_bits</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>//Headers:
Authorization: Bearer xxxxxx.xxxxxx.xxxxxx (组合的JWT字串)

//Content:
device_token:deviceToken (要查询的装置Token)
transaction_id:UUID().uuidString (查询识别符，这里直接用UUID代表)
timestamp: 请求时间戳（毫秒），注意！这里是毫秒（EX: 1556549164000）
bit0: 2 bits 资料中第一位的资料：0或1
bit1: 2 bits 资料中第二位的资料：0或1
</pre></table></code></div></div><h4 id="5-取得apple伺服器回传结果"><span class="me-2">5. 取得Apple伺服器回传结果</span><a href="#5-取得apple伺服器回传结果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>回传状态：</strong></p><p><a href="/assets/c5e7e580c341/1*MAa5Z8bK9ppAN6WJxEButg.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*MAa5Z8bK9ppAN6WJxEButg.webp" alt="[官方文件](https://developer.apple.com/documentation/devicecheck/accessing_and_modifying_per-device_data){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTciIGhlaWdodD0iNzU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://developer.apple.com/documentation/devicecheck/accessing_and_modifying_per-device_data" target="_blank">官方文件</a></p><p><strong>回传内容：无，回传状态 200 即表示写入成功！</strong></p><h4 id="6-后端api回传结果给app"><span class="me-2">6. 后端API回传结果给APP</span><a href="#6-后端api回传结果给app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>APP在针对相应的状态做回应就完成了！</p><h3 id="后端部分补充"><span class="me-2">后端部分补充：</span><a href="#后端部分补充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>这边太久没碰PHP了，有兴趣请参考 <a href="https://qiita.com/owen/items/85dff1e45083d2805140" target="_blank">iOS11で追加されたDeviceCheckについて</a> 这篇文章的 requestToken.php 部分</p><h4 id="swift-版示范demo"><span class="me-2">Swift 版示范Demo：</span><a href="#swift-版示范demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>因后端部分我无法提供实作且不是大家都会PHP，这边提供一个用纯iOS (Swift) 做的范例，直接在APP里处理后端该做的那些事(组JWT,发送资料给频果)，给大家做参考！</p><p>不需撰写后端程式就能模拟执行所有内容．</p><blockquote><p>⚠请注意 <em>仅为测试示范所需，不建议用于正式环境</em> ⚠</p></blockquote><p>这边要感谢 <a href="https://medium.com/u/e13f6afcf9b9" target="_blank">Ethan Huang</a> 大大的 <a href="https://github.com/ethanhuang13/CupertinoJWT" target="_blank">CupertinoJWT</a> 提供 iOS 在APP内产生JWT格式内容的支援！</p><p><strong>Demo 主要程式及画面：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">DeviceCheck</span>
<span class="kd">import</span> <span class="kt">CupertinoJWT</span>

<span class="kd">extension</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">queryEncode</span><span class="p">:</span><span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">addingPercentEncoding</span><span class="p">(</span><span class="nv">withAllowedCharacters</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)?</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"+"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"%2B"</span><span class="p">)</span> <span class="p">??</span> <span class="s">""</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">getBtn</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">statusBtn</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">getBtnClick</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">DCDevice</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">generateToken</span> <span class="p">{</span> <span class="n">dataOrNil</span><span class="p">,</span> <span class="n">errorOrNil</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">dataOrNil</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            
            <span class="k">let</span> <span class="nv">deviceToken</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">()</span>
            
            <span class="c1">//正式情况：</span>
            <span class="c1">//POST deviceToken 到后端，请后端去跟苹果伺服器查询，然后再回传结果给APP处理</span>
            
            
            <span class="c1">//!!!!!!以下仅为测试、示范所需，不建议用于正式环境!!!!!!</span>
            <span class="c1">//!!!!!!      请勿随意暴露您的PRIVATE KEY    !!!!!!</span>
                <span class="k">let</span> <span class="nv">p8</span> <span class="o">=</span> <span class="s">"""
                    -----BEGIN PRIVATE KEY-----
                    -----END PRIVATE KEY-----
                    """</span>
                <span class="k">let</span> <span class="nv">keyID</span> <span class="o">=</span> <span class="s">""</span> <span class="c1">//你的KEY ID</span>
                <span class="k">let</span> <span class="nv">teamID</span> <span class="o">=</span> <span class="s">""</span> <span class="c1">//你的Developer Team ID :https://developer.apple.com/account/#/membership</span>
            
                <span class="k">let</span> <span class="nv">jwt</span> <span class="o">=</span> <span class="kt">JWT</span><span class="p">(</span><span class="nv">keyID</span><span class="p">:</span> <span class="n">keyID</span><span class="p">,</span> <span class="nv">teamID</span><span class="p">:</span> <span class="n">teamID</span><span class="p">,</span> <span class="nv">issueDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">(),</span> <span class="nv">expireDuration</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            
                <span class="k">do</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">token</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jwt</span><span class="o">.</span><span class="nf">sign</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">p8</span><span class="p">)</span>
                    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://api.devicecheck.apple.com/v1/update_two_bits"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">httpMethod</span> <span class="o">=</span> <span class="s">"POST"</span>
                    <span class="n">request</span><span class="o">.</span><span class="nf">addValue</span><span class="p">(</span><span class="s">"Bearer </span><span class="se">\(</span><span class="n">token</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">forHTTPHeaderField</span><span class="p">:</span> <span class="s">"Authorization"</span><span class="p">)</span>
                    <span class="n">request</span><span class="o">.</span><span class="nf">addValue</span><span class="p">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="p">,</span> <span class="nv">forHTTPHeaderField</span><span class="p">:</span> <span class="s">"Content-Type"</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">json</span><span class="p">:[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"device_token"</span><span class="p">:</span><span class="n">deviceToken</span><span class="p">,</span><span class="s">"transaction_id"</span><span class="p">:</span><span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">,</span><span class="s">"timestamp"</span><span class="p">:</span><span class="kt">Int</span><span class="p">(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="o">.</span><span class="nf">rounded</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span><span class="s">"bit0"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="s">"bit1"</span><span class="p">:</span><span class="kc">false</span><span class="p">]</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">httpBody</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">withJSONObject</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span>
                    
                    <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
                        <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="k">return</span>
                        <span class="p">}</span>
                        <span class="nf">print</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">))</span>
                        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">getBtn</span><span class="o">.</span><span class="n">isHidden</span> <span class="o">=</span> <span class="kc">true</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">statusBtn</span><span class="o">.</span><span class="n">isSelected</span> <span class="o">=</span> <span class="kc">true</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                    <span class="c1">// Handle error</span>
                <span class="p">}</span>
            <span class="c1">//!!!!!!以上仅为测试、示范所需，不建议用于正式环境!!!!!!</span>
            <span class="c1">//</span>
            
        <span class="p">}</span>

    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        
        <span class="kt">DCDevice</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">generateToken</span> <span class="p">{</span> <span class="n">dataOrNil</span><span class="p">,</span> <span class="n">errorOrNil</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">dataOrNil</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            
            <span class="k">let</span> <span class="nv">deviceToken</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="nf">base64EncodedString</span><span class="p">()</span>
            
            <span class="c1">//正式情况：</span>
                <span class="c1">//POST deviceToken 到后端，请后端去跟苹果伺服器查询，然后再回传结果给APP处理</span>
            
            
            <span class="c1">//!!!!!!以下仅为测试、示范所需，不建议用于正式环境!!!!!!</span>
            <span class="c1">//!!!!!!      请勿随意暴露您的PRIVATE KEY    !!!!!!</span>
                <span class="k">let</span> <span class="nv">p8</span> <span class="o">=</span> <span class="s">"""
                -----BEGIN PRIVATE KEY-----
                
                -----END PRIVATE KEY-----
                """</span>
                <span class="k">let</span> <span class="nv">keyID</span> <span class="o">=</span> <span class="s">""</span> <span class="c1">//你的KEY ID</span>
                <span class="k">let</span> <span class="nv">teamID</span> <span class="o">=</span> <span class="s">""</span> <span class="c1">//你的Developer Team ID :https://developer.apple.com/account/#/membership</span>
            
                <span class="k">let</span> <span class="nv">jwt</span> <span class="o">=</span> <span class="kt">JWT</span><span class="p">(</span><span class="nv">keyID</span><span class="p">:</span> <span class="n">keyID</span><span class="p">,</span> <span class="nv">teamID</span><span class="p">:</span> <span class="n">teamID</span><span class="p">,</span> <span class="nv">issueDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">(),</span> <span class="nv">expireDuration</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            
                <span class="k">do</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">token</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jwt</span><span class="o">.</span><span class="nf">sign</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">p8</span><span class="p">)</span>
                    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://api.devicecheck.apple.com/v1/query_two_bits"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">httpMethod</span> <span class="o">=</span> <span class="s">"POST"</span>
                    <span class="n">request</span><span class="o">.</span><span class="nf">addValue</span><span class="p">(</span><span class="s">"Bearer </span><span class="se">\(</span><span class="n">token</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">forHTTPHeaderField</span><span class="p">:</span> <span class="s">"Authorization"</span><span class="p">)</span>
                    <span class="n">request</span><span class="o">.</span><span class="nf">addValue</span><span class="p">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="p">,</span> <span class="nv">forHTTPHeaderField</span><span class="p">:</span> <span class="s">"Content-Type"</span><span class="p">)</span>
                    <span class="k">let</span> <span class="nv">json</span><span class="p">:[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"device_token"</span><span class="p">:</span><span class="n">deviceToken</span><span class="p">,</span><span class="s">"transaction_id"</span><span class="p">:</span><span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">,</span><span class="s">"timestamp"</span><span class="p">:</span><span class="kt">Int</span><span class="p">(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="o">.</span><span class="nf">rounded</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">]</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">httpBody</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">withJSONObject</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span>
                    
                    <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
                        <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span><span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">mutableContainers</span><span class="p">)</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span><span class="kt">Any</span><span class="p">],</span><span class="k">let</span> <span class="nv">stauts</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"bit0"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="k">return</span>
                        <span class="p">}</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">stauts</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
                            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                                <span class="k">self</span><span class="o">.</span><span class="n">getBtn</span><span class="o">.</span><span class="n">isHidden</span> <span class="o">=</span> <span class="kc">true</span>
                                <span class="k">self</span><span class="o">.</span><span class="n">statusBtn</span><span class="o">.</span><span class="n">isSelected</span> <span class="o">=</span> <span class="kc">true</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                    <span class="c1">// Handle error</span>
                <span class="p">}</span>
            <span class="c1">//!!!!!!以上仅为测试、示范所需，不建议用于正式环境!!!!!!</span>
            <span class="c1">//</span>
            
        <span class="p">}</span>
        <span class="c1">// Do any additional setup after loading the view.</span>
    <span class="p">}</span>


<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/c5e7e580c341/1*SwCOuRX_5KD4GsBNfaTQDQ.webp" class="popup img-link blur"><img data-src="/assets/c5e7e580c341/1*SwCOuRX_5KD4GsBNfaTQDQ.webp" alt="画面截图" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzEiIGhlaWdodD0iNzkzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>画面截图</p><p>这边做的是一个一次性的优惠领取，每个装置只能领一次！</p><h4 id="完整专案下载"><span class="me-2">完整专案下载：</span><a href="#完整专案下载" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/zhgchgli0718/iOSDeviceCheckExample" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/5b9e31058f9022c9102e9f1235cb0d3535b7db18c15a0dc2affda91d0f97507e/zhgchgli0718/iOSDeviceCheckExample" alt="" loading="lazy"></a></p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/c5e7e580c341" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2019-04-29-c5e7e580c341.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/ios-11/" class="post-tag no-text-decoration" >ios-11</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/mobile-app-development/" class="post-tag no-text-decoration" >mobile-app-development</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20DeviceCheck%20%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8%EF%BD%9CSwift%20%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-devicecheck-%25E5%25AE%259E%25E4%25BD%259C%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E4%25BC%2598%25E6%2583%25A0%25E4%25B8%258E%25E8%25AF%2595%25E7%2594%25A8-swift-%25E6%2595%2599%25E5%25AD%25A6%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%25A7%25A3%25E6%259E%2590-c5e7e580c341%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20DeviceCheck%20%E5%AE%9E%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BC%98%E6%83%A0%E4%B8%8E%E8%AF%95%E7%94%A8%EF%BD%9CSwift%20%E6%95%99%E5%AD%A6%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-devicecheck-%25E5%25AE%259E%25E4%25BD%259C%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E4%25BC%2598%25E6%2583%25A0%25E4%25B8%258E%25E8%25AF%2595%25E7%2594%25A8-swift-%25E6%2595%2599%25E5%25AD%25A6%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%25A7%25A3%25E6%259E%2590-c5e7e580c341%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fios-devicecheck-%25E5%25AE%259E%25E4%25BD%259C%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E4%25BC%2598%25E6%2583%25A0%25E4%25B8%258E%25E8%25AF%2595%25E7%2594%25A8-swift-%25E6%2595%2599%25E5%25AD%25A6%25E5%25AE%258C%25E6%2595%25B4%25E6%25B5%2581%25E7%25A8%258B%25E8%25A7%25A3%25E6%259E%2590-c5e7e580c341%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E7%82%B9-%E7%BE%8E%E9%A3%9F%E4%B8%8E%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AF%81%E7%9C%81%E9%92%B1%E7%A7%98%E8%AF%80-8ace34a1a3d8/">游记 2025 韩国釜山 8 天 7 夜自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/ios-devicecheck-%E5%AF%A6%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E8%88%87%E8%A9%A6%E7%94%A8-swift-%E6%95%99%E5%AD%B8%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1556551801" data-df="ll" > Apr 29, 2019 </time><h4 class="pt-0 my-2">iOS 完美實踐一次性優惠或試用的方法 (Swift)</h4><div class="text-muted"><p>iOS DeviceCheck 跟著你到天涯海角</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-devicecheck-implement-one-time-offers-and-trials-seamlessly-with-swift-c5e7e580c341/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1556551801" data-df="ll" > Apr 29, 2019 </time><h4 class="pt-0 my-2">iOS DeviceCheck｜Implement One-Time Offers and Trials Seamlessly with Swift</h4><div class="text-muted"><p>iOS developers struggling with secure one-time offers or trials can leverage DeviceCheck to track user eligibility across devices, preventing abuse and ensuring fair usage. Learn how to implement t...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-uiviewcontroller-%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB-%E4%B8%8B%E6%8B%89%E9%97%9C%E9%96%89-%E4%B8%8A%E6%8B%89%E6%BC%B8%E5%85%A5%E8%88%87%E5%85%A8%E9%A0%81%E5%8F%B3%E6%BB%91%E8%BF%94%E5%9B%9E%E5%AF%A6%E4%BD%9C%E6%8A%80%E5%B7%A7-14cee137c565/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1578768066" data-df="ll" > Jan 12, 2020 </time><h4 class="pt-0 my-2">iOS UIViewController 轉場二三事</h4><div class="text-muted"><p>UIViewController 下拉關閉/上拉出現/全頁右滑返回 效果全解</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/ios-devicecheck-implement-one-time-offers-and-trials-seamlessly-with-swift-c5e7e580c341/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS DeviceCheck｜Implement One-Time Offers and Trials Seamlessly with Swift</p></a> <a href="/posts/zrealm-dev/ios-devicecheck-%E5%AF%A6%E4%BD%9C%E4%B8%80%E6%AC%A1%E6%80%A7%E5%84%AA%E6%83%A0%E8%88%87%E8%A9%A6%E7%94%A8-swift-%E6%95%99%E5%AD%B8%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-c5e7e580c341/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS 完美實踐一次性優惠或試用的方法 (Swift)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">中文</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
