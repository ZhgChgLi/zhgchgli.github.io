<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="针对开发团队自动化需求，解析 GitHub Actions 与 Self-hosted Runner 架构与设定，并透过三大实战案例教你快速建立自动标记 PR、指派负责人及每日 PR 统计通知，提升 CI/CD 执行效率与成本优化。" /><meta property="og:description" content="针对开发团队自动化需求，解析 GitHub Actions 与 Self-hosted Runner 架构与设定，并透过三大实战案例教你快速建立自动标记 PR、指派负责人及每日 PR 统计通知，提升 CI/CD 执行效率与成本优化。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-07-02T20:22:32+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" /><meta property="twitter:title" content="GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2025-07-12T22:49:01+08:00","datePublished":"2025-07-02T20:22:32+08:00","description":"针对开发团队自动化需求，解析 GitHub Actions 与 Self-hosted Runner 架构与设定，并透过三大实战案例教你快速建立自动标记 PR、指派负责人及每日 PR 统计通知，提升 CI/CD 执行效率与成本优化。","headline":"GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"}</script><title>GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/github-actions-self-hosted-runner-setup-and-usage-guide-for-efficient-ci-cd-404bd5c70040"><link rel="alternate" hreflang="zh-tw" href="/posts/zrealm-dev/github-actions-self-hosted-runner-詳解與實戰案例-ci-cd-自動化工作流程建置-404bd5c70040"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-详解与实战案例-ci-cd-自动化工作流程建置-404bd5c70040"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置</h1><p class="post-desc fw-light mb-4">针对开发团队自动化需求，解析 GitHub Actions 与 Self-hosted Runner 架构与设定，并透过三大实战案例教你快速建立自动标记 PR、指派负责人及每日 PR 统计通知，提升 CI/CD 执行效率与成本优化。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1751458952" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 2, 2025 </time> </span> <span> Updated <time data-ts="1752331741" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 12, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" class="popup img-link preview-img blur"><img data-src="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="11073 words" > <em>61 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">GitHub Actions｜Self-hosted Runner 详解与实战案例｜CI/CD 自动化工作流程建置</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/github-actions-self-hosted-runner-setup-and-usage-guide-for-efficient-ci-cd-404bd5c70040"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/github-actions-self-hosted-runner-詳解與實戰案例-ci-cd-自動化工作流程建置-404bd5c70040"><strong>點此這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><hr /><h3 id="cicd-实战指南二github-actions-与-self-hosted-runner-使用与建置大全"><span class="me-2">CI/CD 实战指南（二）：GitHub Actions 与 Self-hosted Runner 使用与建置大全</span><a href="#cicd-实战指南二github-actions-与-self-hosted-runner-使用与建置大全" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>带您从头了解 GitHub Actions/Self-hosted Runner 运作方式与手把手使用教学。</p><p><a href="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.webp" alt="Photo by [Dan Taylor](https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Dan Taylor</a></p><h4 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前篇「 <a href="/posts/zrealm-dev/zh-cn/ci-cd-是什么-打造高效稳定开发团队的关键流程与工具选择-c008a9e8ceca"><strong>CI/CD 实战指南（一）：CI/CD 是什么？如何透过 CI/CD 打造稳定高效的开发团队？工具选择？</strong></a> 」我们介绍了 CI/CD 是什么？能带来哪些效益与工具的选择， <strong>这篇将著重在 GitHub Actions, Self-hosted Runner 的架构与使用介绍</strong> ，并手把手一起建立几个有趣的自动化工作流程，带您慢慢上手。</p><h3 id="github-actions-架构流程图"><span class="me-2">GitHub Actions 架构流程图</span><a href="#github-actions-架构流程图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在开始之前我们先来确定一下 GitHub Actions 的运作架构流程关系与职责。</p><p><a href="/assets/404bd5c70040/1*iacfyTX_b3YTSzMcn2ldjw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*iacfyTX_b3YTSzMcn2ldjw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="github-repo"><span class="me-2"><strong>GitHub Repo</strong></span><a href="#github-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>在 GitHub Actions 的世界里，所有 Actions (Workflow YAML 档案) 都要存放在某个 Git Repo 之中 ( <code class="language-plaintext highlighter-rouge">REPO/.github/workflows/</code> )</ul><h4 id="github-repo-actions-secrets"><span class="me-2">GitHub Repo —Actions Secrets</span><a href="#github-repo-actions-secrets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Settings → Secrets and variables → Actions → Secrets。</p><ul><li><p>存放 Actions 步骤中会用到的 Secret Key, Token e.g. Slack Bot Token、Apple Store Connect API .p8 Key</p><li><p><strong>Secrets 内容无法在 Action Log 中查看，会自动用 * * * * 隐蔽</strong></p><li><p>Secrets 内容无法查看、编辑，只能覆盖</p><li>Secrets <strong>目前只支援纯文字内容，无法上传档案</strong> <strong>-</strong> 如果是二进制的金要请参考 <a href="https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/using-secrets-in-github-actions#storing-base64-binary-blobs-as-secrets" target="_blank">官方步骤使用 Base64 编码转换后储存</a> 。<ul><li>iOS 开发凭证储存方式可参考官方教学： <a href="https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development" target="_blank">Installing an Apple certificate on macOS runners for Xcode development</a></ul><li>可以储存组织层级的 Secrets，跨 Repo 共享</ul><h4 id="github-repo--actions-variables"><span class="me-2">GitHub Repo — Actions Variables</span><a href="#github-repo--actions-variables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Settings → Secrets and variables → Actions → Variables。</p><ul><li><p>存放 Actions 步骤中常用到的变数 e.g. 模拟器 iOS 版本、工作目录</p><li><p>Variables 内容可以查看、编辑</p><li><p>Variables 内容可以输出在 Action Log 中</p><li><p>Variables 只支援纯文字，也可存放 json 字串然后自己解析使用</p><li><p>可以储存组织层级的 Variables，跨 Repo 共享</p></ul><h4 id="github-actions--trigger"><span class="me-2">GitHub Actions — Trigger</span><a href="#github-actions--trigger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><strong>Github Action 中最重要的起始点 — 触发事件(条件)</strong></p><li><p>符合触发事件的 GitHub Actions 才会触发执行</p><li><p>完整事件列表可 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">参考官方文件</a></p><li><p>基本上涵盖了所有 CI/CD、自动化会遇到的事件场景。 但 <strong>如果有特殊场景没有事件，那就只能用其他事件+在 Job 中判断组合或是用 Schedule 排程手动检查了</strong> 。 e.g. 例如没有 PR Merged 事件，就只能用 <code class="language-plaintext highlighter-rouge">pull_request: closed</code> + Job <code class="language-plaintext highlighter-rouge">if: github.event.pull_request.merged == true</code> 达成</p></ul><p><strong>常用事件：</strong></p><ul><li><p><code class="language-plaintext highlighter-rouge">schedule</code> (cron)：排程定时执行(同 crontab) 可以用来做自动化：定时检查 PR、定时打包、定时执行自动化脚本 <strong>统一都在 main / develop (Default Branch) 执行。</strong></p><li><p><code class="language-plaintext highlighter-rouge">pull_request:</code> ：PR 相关事件 当 PR 开启时、PR Assign 时、加 Label 时、有新 Push Commit 时…等等</p><li><p><code class="language-plaintext highlighter-rouge">issues</code> 、 <code class="language-plaintext highlighter-rouge">issue_comment</code> ：Issue 相关事件 当 Issue 开启时、有新留言时…等等</p><li><p><code class="language-plaintext highlighter-rouge">workflow_dispatch</code> ：手动触发；可以设定需要提供的栏位，GitHub Actions 提供简易的表单让使用者可以填写资讯。 e.g.:</p></ul><p><a href="/assets/404bd5c70040/1*XogIJsCbrNPerWBto_PG8w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*XogIJsCbrNPerWBto_PG8w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMzIiIGhlaWdodD0iNDMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p><code class="language-plaintext highlighter-rouge">workflow_call</code> ：触发另一个 Action(Workflow) 执行任务。</p><li><p><code class="language-plaintext highlighter-rouge">workflow_run</code> ：当别的 Action(Workflow) 执行任务，触发执行此任务。</p></ul><blockquote><p><em>更多事件类型、设定细节请 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">参考官方文件</a> 。</em></p></blockquote><h4 id="github-actions--workflow"><span class="me-2"><strong>GitHub Actions — Workflow</strong></span><a href="#github-actions--workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>a.k.a Action</p><li><p>使用 YAML 撰写 .yaml 档案，档案统一放置在 <code class="language-plaintext highlighter-rouge">REPO/.github/workflows/</code> 之下</p><li><p><strong>以主分支内的 Workflow YAML 档案为主</strong> 如果在其他分支看不到正在开发的 Action 或执行上有误，可以先 Merge 回主分支看看。</p><li><p>GitHub Actions 中的最基础单位，每个 Workflow 就代表一项 CI/CD 或自动化操作</p><li><p>Workflow 可以呼叫别的 Workflow 执行任务 (可以利用这个特性拆出核心 Workflow 和呼叫的 Workflow)</p><li><p>当中会定义任务名称、执行策略、触发事件、任务工作…等等所有 Action 相关设定</p><li><p>目前档案结构不支援子目录</p><li><p>Action 完全免费 (Public and Private Repo)</p></ul><h4 id="github-actions--workflow--job"><span class="me-2">GitHub Actions — Workflow — Job</span><a href="#github-actions--workflow--job" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>GitHub Actions 中的执行单位</p><li><p>定义 Workflow 中的任务工作有哪些</p><li><p>每个 Workflow 可以有多个 Jobs</p><li><p>每个 Job 需要指定使用哪个 Runner Label，执行的时候会使用对应的 Runner 机器来执行任务</p><li><p><strong>多个 Jobs 是并发执行</strong> (如有顺序可以用 <code class="language-plaintext highlighter-rouge">needs</code> 约束)</p><li><p><strong>每个 Job 应该视为独立执行个体(每个都要当成是 Sandbox)</strong> ，Job 结束后如果有产出资源档案要给后续其他 Job/Workflow 使用，需要 Upload Artifacts 或在 self-hosted 移动到共用产出目录。</p><li><p>Job 做完可以 Output 字串给其他 Job 参考使用。 (例如执行结果 true or false)</p><li><p>没特别设流程条件的话，多个 Job 如果其中有 Job 发生错误， <strong>其他 Job 依然会继续执行</strong></p></ul><h4 id="github-actions--reuse-workflowjob"><span class="me-2">GitHub Actions — Reuse Workflow/Job</span><a href="#github-actions--reuse-workflowjob" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>Workflow 定义 <code class="language-plaintext highlighter-rouge">on: workflow_call</code> 就能封装给其他 Workflow 当成 Job 复用</p><li><p>同个组织下可以跨 Repo 分享使用</p><li><p>因此可以把跨 Repo 共用的 CI/CD 工作放到共享的 Repo 一起使用</p></ul><h4 id="github-actions--workflow--job--step"><span class="me-2">GitHub Actions — Workflow — Job — Step</span><a href="#github-actions--workflow--job--step" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>GitHub Actions 中的最小执行项目</p><li><p>Job 中实际执行任务的程式</p><li><p>每个 Job 可以有多个 Steps</p><li><p><strong>多个 Steps 是照顺序执行</strong></p><li><p>Step 做完可以 Output 字串给后续 Steps 参考使用。</p><li><p><strong>Step 可以直接撰写 shell script 程式</strong> 可以引用 <a href="https://cli.github.com/manual/gh" target="_blank">gh cli</a> 、当前环境变数(例如取得 PR 编号)，直接做想做的事</p><li><p>没特别设流程条件的话，Step 如果发生错误， <strong>会直接中断</strong> ，后续的 Steps 不会执行</p></ul><h4 id="github-actions--workflow--job--reuse-action-step"><span class="me-2">GitHub Actions — Workflow — Job — Reuse Action Step</span><a href="#github-actions--workflow--job--reuse-action-step" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><strong>可以直接复用 <a href="https://github.com/marketplace?type=actions" target="_blank">Marketplace</a> 上各路大神包好的现有工作步骤。</strong> 例如： <a href="https://github.com/marketplace/actions/comment-pull-request" target="_blank">Comment 内容到 PR</a> 。</p><li><p>也可以将自己一系列的工作任务 Step 打包成一个 Action GitHub Repo 让其他工作直接复用</p><li><p>Public Repo 的 Action 可以上架到 Marketplace</p></ul><p><strong>打包 Action 支援使用：</strong></p><ul><li><p><strong>Docker Action</strong> — 代表 GitHub Actions 会把环境变数传到 Docker 容器中，再看你要怎么处理，可以是 shell script、Java、PHP…etc.</p><li><p><strong>JavaScript/TypeScript Action</strong> — 直接使用 node.js 撰写 GitHub Actions 处理逻辑，同样的会把环境变数都传给你参考使用。 e.g. <a href="https://github.com/pozil/auto-assign-issue/blob/v2/action.yml" target="_blank">pozil/auto-assign-issue</a></p><li><p><strong>Composite (YAML) —</strong> 纯 YAML 描述任务步骤 (同 GitHub Actions — Workflow — Job — Step) 可以宣告有哪写步骤要做或直接在上面写 shell script。 e.g. <a href="https://github.com/ZhgChgLi/ZReviewTender/blob/main/action.yml" target="_blank">ZhgChgLi/ZReviewTender</a></p></ul><blockquote><p><em>碍于篇幅，本篇文章不会介绍如何打包 Github Actions Action，有兴趣可以参考官方文件： <a href="https://docs.github.com/en/actions/tutorials/creating-a-composite-action" target="_blank">tutorials/creating-a-composite-action</a> 。</em></p></blockquote><h4 id="github-runner"><span class="me-2">GitHub Runner</span><a href="#github-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>GitHub 会根据 Runner Label 派发对应的 Job 给 Runner 执行</p><li><p>Runner 只做为监听者，轮询监听 GitHub 派发任务</p><li><p>只关心 Job 不关心是哪个 Action(Workflow) 因此会出现 Action A 的 Job-1 执行完，下一个换 Action B 的 Job-1，而不是 Action A 的 Jobs 都执行完才换 Action B。</p><li><p>Runner 可以使用 GitHub Hosted Runner 或 Self-hosted Runner。</p></ul><h4 id="github-hosted-runner"><span class="me-2"><strong>GitHub Hosted Runner</strong></span><a href="#github-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>GitHub 提供的 Runner，可参考官方 Repo 列表：</ul><p><a href="https://github.com/actions/runner-images" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/b479f2537a0d7620cc8bed955bf9331e739ee02383a1715546a26bc35390a494/actions/runner-images" alt="" loading="lazy"></a></p><p><a href="/assets/404bd5c70040/1*KtQV4kDCWscEeaZ8jQI8Dg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*KtQV4kDCWscEeaZ8jQI8Dg.webp" alt="[2025/06 的 Images 列表](https://github.com/actions/runner-images){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjEzNDYiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://github.com/actions/runner-images" target="_blank">2025/06 的 Images 列表</a></p><ul><li>Runner 预先安装了什么可以点进去查看： e.g. <a href="https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md" target="_blank">macos-14-arm64</a></ul><p><a href="/assets/404bd5c70040/1*svXtXH78-TvK1C_XXCyYLA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*svXtXH78-TvK1C_XXCyYLA.webp" alt="[macos-14-arm64](https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY2OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md" target="_blank">macos-14-arm64</a></p><ul><li><p>iOS 开发优先使用 -arm64 (M系列) 处理器的 Runner，跑起来比较快</p><li><p>只要在 Job <code class="language-plaintext highlighter-rouge">run-on</code> 贴上表格上的 YAML Label，就能使用该 Runner 执行任务</p><li><p><strong>Public Repo 收费方式: 完全免费无限使用</strong></p><li><p><strong>️</strong> Private Repo 免费额度: 免费额度(依照帐号不同额度不同，以 GitHub Free 为例)： 用量：每月免费 2,000 分钟 储存：500 MB</p><li><p><strong>⚠️️Private Repo 计费方式:</strong> <strong>超过免费额度之后开始用用量计费(可设上限跟通知)，依照 Runner 所属的机器作业系统、核心不同，价格也不同：</strong></p></ul><p><a href="/assets/404bd5c70040/1*rkhRJN4ZRas_lDOJh-pjkQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*rkhRJN4ZRas_lDOJh-pjkQ.webp" alt="[about-billing-for-github-actions](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDY0IiBoZWlnaHQ9IjEyMDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions" target="_blank">about-billing-for-github-actions</a></p><p>可以看到 macOS 的价格因为设备成本很高所以贵。</p><ul><li>最多并发任务数限制：</ul><p><a href="/assets/404bd5c70040/1*LU3zGSBe57NBVMfDwl0wdQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*LU3zGSBe57NBVMfDwl0wdQ.webp" alt="[usage-limits-billing-and-administration](https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ5MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits" target="_blank">usage-limits-billing-and-administration</a></p><blockquote><p><em>这边扯太多了，我们的重点是 Self-hosted Runner。</em></p></blockquote><h4 id="self-hosted-runner-on-in-house-server"><span class="me-2">Self-hosted Runner on In-house Server</span><a href="#self-hosted-runner-on-in-house-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>将自己的机器作为 Runner</p><li><p><strong>一台实体机器可以起多个 Runner 并发接任务来做</strong></p><li><p><strong>免费无限量无限制使用</strong> 只有机器购买成本，花一次使用到饱！ 以 32G RAM M4 Mini (=NT$40,900) 计算，如果用 GitHub Hosted Runner 一个月要花 500 USD； <strong>买一台架设好用超过三个月就回本</strong> 了！</p><li><p>支援 Windows, macOS, Linux (x64/ARM/ARM64)</p><li><p><strong>同个组织可以跨 Repo 共享 Runner</strong></p><li><p><strong>⚠️目前：actions/cache, actions/upload-artifact, actions/download-artifact 都只支援 GitHub 云端服务，代表这些内容还是会上传到 GitHub 伺服器并计算储存量收费。</strong> 可以在自己的机器上开共用目录取代。</p><li><p>Self-hosted Runner 也支援 <a href="https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller" target="_blank">Docker, k8s</a> 只是我没研究。</p></ul><blockquote><p><strong><em>架设 Self-hosted Runner 只需几步 (10 分钟内设定好) 就能上线开始接任务执行(本文稍后会介绍)。</em></strong></p></blockquote><h4 id="github-workflow-x-job-x-step-x-runner-流程关系图"><span class="me-2">GitHub Workflow x Job x Step x Runner 流程关系图</span><a href="#github-workflow-x-job-x-step-x-runner-流程关系图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*WHIVfXdVRoEsdXGfJhu2Rw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*WHIVfXdVRoEsdXGfJhu2Rw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijg1MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>这边用一张图总结工作流程与关系，假设我们有两个 Workflow、两个 Runner:</p><ul><li><p>CI —假设 R有 3 个 Jobs，每个 Job 各有几个 Steps，Runner Label(run-on) — <code class="language-plaintext highlighter-rouge">self-hosted-app</code></p><li><p>CD — 有 4 个 Jobs，每个 Job 各有几个 Steps，Runner Label(run-on) — <code class="language-plaintext highlighter-rouge">self-hosted-app</code></p><li><p>Runner — 有 2 个，Runner Label 也都是— <code class="language-plaintext highlighter-rouge">self-hosted-app</code></p></ul><p>同前述，Runner 跟 Workflow 是依照 Runnler Label 来派发、接收任务来做，这个案例都是用同个 <code class="language-plaintext highlighter-rouge">self-hosted-app</code> Runner Label，Workflow 的 Jobs 预设是并发执行、Steps 是每个 Job 的实际执行内容，串行照顺序执行，Steps 都执行完等于 Job 执行完毕。</p><blockquote><p><strong><em>因此 Workflow 实际执行的时间轴会是在两个 Runner 之间穿梭执行 Job，也会并发执行、当前 Job 执行完下一个也不一定是接著同个 Worflow 的下一个 Job。</em></strong></p></blockquote><blockquote><p><em>⚠️ 所以才说确保每个 Job 是独立的很重要 (尤其在 Self-hosted Runner 环境之下，Job 结束之后可能不会清除的太干净，我们可能会下意识觉得这个 Job 的产出，下一个 Job 可以接著做事)，不应该这样用。</em></p></blockquote><h4 id="如果-job-有产出要给后续的-job-使用"><span class="me-2">如果 Job 有产出要给后续的 Job 使用:</span><a href="#如果-job-有产出要给后续的-job-使用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><strong>Job Output String</strong> : 输出纯文字到变数给其他 Job 引用</p><li><p><strong>Artifact-upload/download:</strong> Job 的 Step 最后一步将执行结果上传到 GitHub Artifact，另一个 Job 的第一个 Step 下载回来继续处理使用。 e.g. 例如 Job — 打包 → 将打包结果 .ipa 传到 <strong>Artifact →</strong> Job — 部署 → 下载回来 .ipa → 上传 App Store 部署 要注意： <strong>目前就算是 Self-hosted 也是会上 GitHub Artifact 云储存。</strong></p><li><p><strong>AWS/GCP…云端储存</strong> : 同上，只是是用自己的云端储存服务。</p><li><p><strong>[Self-hosted Only] 共用硬碟、目录:</strong> Self-hosted Runner 如果都有挂载一个共用目录，则可用这个目录依照 UUID 建立资料夹存放产出结果，然后后续 Job 去读取前一个 Job Output UUID 去找到对应的储存再拿回来用。 要注意，不同主机的 Runner 也都要挂载同个共用目录。</p><li><p>在同个 Job 的 Steps 把所有事情做完。</p></ul><h3 id="做中学-github-actions--案例实作"><span class="me-2">做中学 GitHub Actions — 案例实作</span><a href="#做中学-github-actions--案例实作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>「坐而言，不如起而行」以上名词解释跟流程架构介绍相信大家也是看得懵懵懂懂，接下来会直接举三个功能例子，带大家实际动手做，并一边解释碰到的东西，从做当中学习，以了解 GitHub Actions 到底是什么。</p><h3 id="案例--1"><span class="me-2">案例 — 1</span><a href="#案例--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>建立 Pull Request 后自动标记 File Changes Size Label 让 Reviewer 方便安排 Review 工作。</p><h4 id="成果图"><span class="me-2">成果图</span><a href="#成果图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*vjSWeu2zB-hmVpfziMDR5Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*vjSWeu2zB-hmVpfziMDR5Q.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzQiIGhlaWdodD0iMjA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><h4 id="运作流程"><span class="me-2">运作流程</span><a href="#运作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>使用者开 PR、重开 PR、Push 新 Commit 到 PR</p><li><p>触发 GitHub Actions Workflow</p><li><p>shell script 取的 file changes 数量</p><li><p>判断数量对 PR 标记上 Label</p><li><p>完成</p></ul><h4 id="动手做"><span class="me-2">动手做</span><a href="#动手做" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>档案名称：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></p><p>Action Workflow 可以每个任务独立一个档案，也可以依照触发事件、目的，同个目的聚合在同个档案，反正多个 Job 是并发执行的，另外 <strong>因为 GitHub Actions 暂时不支援目录结构，所以档案少一点、使用阶层命名档案会比较好管理</strong> 。</p><p>这边把 PR 相关事件的 Actions 都放在同个 Workflow。</p><h4 id="automation-pullrequestyml"><span class="me-2"><code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></span><a href="#automation-pullrequestyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名称</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># Actions Log 的标题名称</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[Pull</span><span class="nv"> </span><span class="s">Reqeust</span><span class="nv"> </span><span class="s">Automation]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.event.pull_request.title</span><span class="nv"> </span><span class="se">\\</span><span class="s">|</span><span class="se">\\</span><span class="s">|</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 开启、重开、有新 Push Commit 时</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同个 Concurrency Group 如果有新的 Job 会取消正在跑的</span>
<span class="c1"># 例如 Push Commit 触发的任务还没执行就又 Push Commit 时，会取消前一个任务</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作项目</span>
<span class="c1"># Job 会并发执行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># Job 名称 (可省略，有设定在 Log 显示比较好读)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by changes file count</span>

    <span class="c1"># 如果这个 Job 失败，不影响整个 Workflow，继续其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 设定最长 Timeout 时间，防止异常情况发生时无止尽的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>

    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 来执行工作</span>
    <span class="c1"># 如果是 Private Repo 会计算用量，超过可能会产生费用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># 工作步骤</span>
    <span class="c1"># 工作步骤会照顺序执行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步骤名称</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get changed file count and apply label</span>
        <span class="c1"># 步骤 ID (可省略，后续若没有 Step 要引用 Output 输出则不需设定)</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">get-changed-files-count-by-gh</span>
        <span class="c1"># 注入外部环境参数到执行阶段</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># secrets.GITHUB_TOKEN 是 GitHub Actions 执行时自动产生的 Token，不需自行在 Secrets 设定，拥有一些 GitHub Repo API Scopes 权限</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="c1"># gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有权限操作  </span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="c1"># Shell script</span>
        <span class="c1"># GitHub Hosted Runner 内建都有安装好 gh cli，不需要安装 Job 就能直接使用</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s">#   ${{ github.xxx }} 是 GitHub Actions Context 表达式</span>
          <span class="s">#   不是 Shell 变数，而是 YAML 解析阶段由 GitHub Actions 替换成对应值</span>
          <span class="s">#   其他参数：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          
          <span class="s"># 取得 PR 编号</span><span class="err">:</span>
          <span class="s">PR_NUMBER=${{ github.event.pull_request.number }}</span>

          <span class="s"># 取得 Repo</span><span class="err">:</span>
          <span class="s">REPO=${{ github.repository }}</span>

          <span class="s"># 使用 GitHub API (gh cli) 取得 File changed 数量</span>
          <span class="s">FILE_COUNT=$(gh pr view $PR_NUMBER --repo $REPO --json files --jq '.files \\| length')</span>
          
          <span class="s"># Print Log</span>
          <span class="s">echo "Changed file count</span><span class="err">:</span> <span class="s">$FILE_COUNT"</span>

          <span class="s"># Label 逻辑</span>
          <span class="s">if [ "$FILE_COUNT" -lt 5 ]; then</span>
            <span class="s">LABEL="XS"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 10 ]; then</span>
            <span class="s">LABEL="S"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 30 ]; then</span>
            <span class="s">LABEL="M"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 80 ]; then</span>
            <span class="s">LABEL="L"</span>
          <span class="s">elif [ "$FILE_COUNT" -lt 200 ]; then</span>
            <span class="s">LABEL="XL"</span>
          <span class="s">else</span>
            <span class="s">LABEL="XXL"</span>
          <span class="s">fi</span>

          <span class="s"># 使用 GitHub API (gh cli) 移除目前的 Size Label</span>
          <span class="s">EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')</span>
          <span class="s">for EXISTING in $EXISTING_LABELS; do</span>
            <span class="s">case "$EXISTING" in</span>
              <span class="s">XS\\|S\\|M\\|L\\|XL\\|XXL)</span>
                <span class="s">echo "🧹 Removing existing label</span><span class="err">:</span> <span class="s">$EXISTING"</span>
                <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"</span>
                <span class="s">;;</span>
            <span class="s">esac</span>
          <span class="s">done</span>

          <span class="s"># (可选)如果 Label 不存在则建立</span>
          <span class="s">if ! gh label list --repo "$REPO" \\| grep -q "^$LABEL"; then</span>
            <span class="s">echo "🆕 Creating missing label</span><span class="err">:</span> <span class="s">$LABEL"</span>
            <span class="s">gh label create "$LABEL" --repo "$REPO" --description "Size label</span><span class="err">:</span> <span class="s">$LABEL" --color "ededed"</span>
          <span class="s">else</span>
            <span class="s">echo "✅ Label '$LABEL' already exists"</span>
          <span class="s">fi</span>
          
          <span class="s"># 使用 GitHub API (gh cli) 标记上 Label</span>
          <span class="s">gh pr edit $PR_NUMBER --repo $REPO --add-label "$LABEL"</span>
</pre></table></code></div></div><p>Commit 档案到 Repo 主分支之后，我们再开新 PR 就会自动触发 GitHub Actions：</p><p><a href="/assets/404bd5c70040/1*wdAztL0BgPeSZdqXxqUEXg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*wdAztL0BgPeSZdqXxqUEXg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MzgiIGhlaWdodD0iNzQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Action 执行状态显示 <strong>Queued</strong> 代表任务正在等待 Runner 接任务回去做。</p><h4 id="执行结果"><span class="me-2">执行结果</span><a href="#执行结果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*-JoD8IQYHVrDqHmLmrXyaQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*-JoD8IQYHVrDqHmLmrXyaQ.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzM4IiBoZWlnaHQ9Ijk0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><p>执行完毕并且成功后 PR 上就会自动标记好对应的 Label 了！纪录会显示由 <code class="language-plaintext highlighter-rouge">github-actions</code> 标记。</p><p><strong>完整程式码： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><h4 id="直接使用别人包好的-action-步骤-pascalgnsize-label-action"><span class="me-2">直接使用别人包好的 Action 步骤： <a href="https://github.com/pascalgn/size-label-action/tree/main" target="_blank">pascalgn/size-label-action</a></span><a href="#直接使用别人包好的-action-步骤-pascalgnsize-label-action" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前面有说到可以直接使用别人封装好的 Action，标记 PR Size Label 这任务已经有现成的轮子可以使用，上述只是为了教学目的，实际上不需要自己重造轮子。</p><p>只需要在 Action Workflow Job Step 中直接使用就能完成任务：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名称</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 开启、重开、有新 Push Commit 时</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同个 Concurrency Group 如果有新的 Job 会取消正在跑的</span>
<span class="c1"># 例如 Push Commit 触发的任务还没执行就又 Push Commit 时，会取消前一个任务</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作项目</span>
<span class="c1"># Job 会并发执行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># Job 名称 (可省略，有设定在 Log 显示比较好读)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by changes file count</span>

    <span class="c1"># 如果这个 Job 失败，不影响整个 Workflow，继续其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 设定最长 Timeout 时间，防止异常情况发生时无止尽的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>

    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 来执行工作</span>
    <span class="c1"># 如果是 Private Repo 会计算用量，超过可能会产生费用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># 工作步骤</span>
    <span class="c1"># 工作步骤会照顺序执行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步骤名称</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get changed file count and apply label</span>
        <span class="c1"># 步骤 ID (可省略，后续若没有 Step 要引用 Output 输出则不需设定)</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">get-changed-files-count-by-gh</span>
        <span class="c1"># 直接使用别人封装好的程式</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pascalgn/size-label-action@v0.5.5"</span>
        <span class="c1"># 注入外部环境参数到执行阶段</span>
        <span class="c1"># 参数命名、可用参数要参考说明：https://github.com/pascalgn/size-label-action/tree/main</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># secrets.GITHUB_TOKEN 是 GitHub Actions 执行时自动产生的 Token (github-actions 身份)，不需自行在 Secrets 设定，拥有一些 GitHub Repo API Scopes 权限</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">secrets.GITHUB_TOKEN</span><span class="nv"> </span><span class="s">}}"</span>
</pre></table></code></div></div><p><a href="https://github.com/pascalgn/size-label-action/tree/main" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/1e5c6f52127032dc1a5fea71a498fa9cc585987880889f0306ef705de3990867/pascalgn/size-label-action" alt="" loading="lazy"></a></p><p>这个包好的 Action 是 JavaScript Action，实际执行程式码可以参考以下档案： <a href="https://github.com/pascalgn/size-label-action/blob/main/dist/index.js" target="_blank">dist/index.js</a> 。</p><h4 id="name-run-name-的补充"><span class="me-2">name, run-name 的补充：</span><a href="#name-run-name-的补充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*zBmjm_3AU53NN0UhTrmOBQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*zBmjm_3AU53NN0UhTrmOBQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDEyIiBoZWlnaHQ9IjU2OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><p>name: Action Workflow 的名称</p><li><p>run-name: 执行纪录的标题名称 (可带入 PR Title or Branch or Author…etc) 如果是 on:pull_request 事件预设是 PR Title。</p></ul><h3 id="案例--2"><span class="me-2">案例 — 2</span><a href="#案例--2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>建立 Pull Request 后如果没有 Assignee 则自动 Assign 作者自己并且 Comment 提示。(只有在初次建立时才会执行)</p><h4 id="成果图-1"><span class="me-2">成果图</span><a href="#成果图-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*EL-0nQF7jhP34d6ZoSkJAg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*EL-0nQF7jhP34d6ZoSkJAg.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjk3IiBoZWlnaHQ9IjczNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><h4 id="运作流程-1"><span class="me-2">运作流程</span><a href="#运作流程-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>使用者开 PR</p><li><p>触发 GitHub Actions Workflow</p><li><p>github script 取得 assignee</p><li><p>如果没有 asignee 则 assign 开 PR 的作者 &amp; Comment 讯息</p><li><p>完成</p></ul><h4 id="动手做-1"><span class="me-2">动手做</span><a href="#动手做-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>档案名称：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code> (同上)</p><h4 id="automation-pullrequestyml-1"><span class="me-2"><code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code></span><a href="#automation-pullrequestyml-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名称</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation</span>

<span class="c1"># Actions Log 的标题名称</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Pull</span><span class="nv"> </span><span class="s">Reqeust</span><span class="nv"> </span><span class="s">Automation</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">Daily</span><span class="nv"> </span><span class="s">Checker"</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 开启、重开、有新 Push Commit 时</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>


<span class="c1"># 同个 Concurrency Group 如果有新的 Job 会取消正在跑的</span>
<span class="c1"># 例如 Push Commit 触发的任务还没执行就又 Push Commit 时，会取消前一个任务</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># Job 工作项目</span>
<span class="c1"># Job 会并发执行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># 请参考前文，略....</span>
  <span class="c1"># ---------</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Automatically assign to self if no assignee is specified</span>
    <span class="c1"># 因为是共用触发事件，所以在 Job 上自己判断，当是 Pull Request Opened(首次建立) 时才执行 Job 否则会 Skipped</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'pull_request' &amp;&amp; github.event.action == 'opened'</span>

    <span class="c1"># 如果这个 Job 失败，不影响整个 Workflow，继续其他 Job</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    
    <span class="c1"># 设定最长 Timeout 时间，防止异常情况发生时无止尽的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>
    
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 来执行工作</span>
    <span class="c1"># 如果是 Private Repo 会计算用量，超过可能会产生费用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Assign self if No Assignee</span>
        <span class="c1"># 使用 GitHub Script (JavaScript) 撰写脚本 (Node.js 环境)</span>
        <span class="c1"># 相较上面直接用 Shell Script 写起来更方便漂亮</span>
        <span class="c1"># 也不需要自行注入环境变数、GITHUB_TOKEN</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">// github-script 中会自动注入到 context 变数供 javascript 直接引用</span>
            <span class="s">// https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>

            <span class="s">const issue = context.payload.pull_request; // 如果要连 Issue 一起支援可写成 context.payload.issue \\|\\| context.payload.pull_request</span>
            <span class="s">const assignees = issue.assignees \\|\\| [];</span>
            <span class="s">const me = context.actor;</span>

            <span class="s">if (assignees.length === 0) {</span>
              <span class="s">// Assignee 设成自己</span>
              <span class="s">await github.rest.issues.addAssignees({</span>
                <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
                <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
                <span class="s">issue_number</span><span class="err">:</span> <span class="s">issue.number,</span>
                <span class="s">assignees</span><span class="err">:</span> <span class="pi">[</span><span class="nv">me</span><span class="pi">]</span>
              <span class="err">}</span><span class="s">);</span>

              <span class="s">// 留言通知</span>
              <span class="s">await github.rest.issues.createComment({</span>
                <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
                <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
                <span class="s">issue_number</span><span class="err">:</span> <span class="s">issue.number,</span>
                <span class="s">body</span><span class="err">:</span> <span class="err">`</span><span class="s">🔧 No assignee was set, so I have assigned this to myself (@${me}).`</span>
              <span class="s">});</span>
            <span class="s">}</span>
</pre></table></code></div></div><p>这次我们示范改用 GitHub Script (JavaScript) 撰写脚本，程式码语法上更弹性更好撰写。</p><p>当然如果你想照我之前说的每个任务一个档案，就可以拔掉 Job If. . 直接在 Action Workflow 触发条件设定：</p><p><code class="language-plaintext highlighter-rouge">Automation-PullRequest-Auto-Assign.yml</code> <strong>：</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名称</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation - Auto Assignee Self</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 开启时</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Automatically assign to self if no assignee is specified</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 请参考前文，略....</span>
</pre></table></code></div></div><p>Commit 档案到 Repo 主分支之后，我们再开新 PR 就会自动触发 GitHub Actions：</p><p><a href="/assets/404bd5c70040/1*Y-A6owUibNEFBoRFHnqIYg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Y-A6owUibNEFBoRFHnqIYg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjcxIiBoZWlnaHQ9IjcwOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>现在有两个 Job 要执行了！</p><h4 id="执行结果-1"><span class="me-2">执行结果</span><a href="#执行结果-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*23muCVgUJKmZt746khBMFQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*23muCVgUJKmZt746khBMFQ.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzUwIiBoZWlnaHQ9IjExMDEiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><p>执行完毕并且成功后 PR 如果没有 Asignees 会自动 Assign PR 作者并且 Comment 讯息。(都是用 <code class="language-plaintext highlighter-rouge">github-actions</code> 身份操作)</p><p><strong>完整程式码： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><h4 id="测试重开reopened-pr"><span class="me-2">测试重开(Reopened) PR</span><a href="#测试重开reopened-pr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*mcDa7TZjv6mO7HtwhOE-Vw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*mcDa7TZjv6mO7HtwhOE-Vw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNDA3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>可看到只会执行 Size Label Job，Auto Assignee Job 被 Skipped 了。</p><blockquote><p><em>这个任务也有人包好 Action 可以直接复用，可参考： <a href="https://github.com/pozil/auto-assign-issue" target="_blank">pozil/auto-assign-issue</a> 。</em></p></blockquote><h3 id="案例--3"><span class="me-2">案例 — 3</span><a href="#案例--3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>每日早上 9 点自动统计当前 PR 数量及已开启多久时间发送通知讯息到 Slack 工作寻组、自动关闭已开启超过 3 个月的 PR。</p><h4 id="成果图-2"><span class="me-2">成果图</span><a href="#成果图-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDgiIGhlaWdodD0iMTQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*Nbg3r1zzhx24YIBEjPJnaw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Nbg3r1zzhx24YIBEjPJnaw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjgiIGhlaWdodD0iMTg3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>Slack 工作群组每天早上自动收到报告</p><li><p>自动关闭超过 90 天的 PR</p></ul><h4 id="运作流程-2"><span class="me-2">运作流程</span><a href="#运作流程-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>GitHub Actions 每天早上 9 点自动触发</p><li><p>触发 GitHub Actions Workflow</p><li><p>github script 取得 开启中的 PR 列表、统计开启了几天</p><li><p>传送统计报告讯息到 Slack</p><li><p>关闭超过 90 天的 PR</p><li><p>完成</p></ul><h4 id="动手做-2"><span class="me-2">动手做</span><a href="#动手做-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><p><strong>档案名称：</strong> <code class="language-plaintext highlighter-rouge">Automation-PullRequest-Daily.yml</code></p><h4 id="automation-pullrequest-dailyyml"><span class="me-2">Automation-PullRequest-Daily.yml</span><a href="#automation-pullrequest-dailyyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名称</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pull Reqeust Automation - Daily Checker</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 排程定时自动执行</span>
  <span class="c1"># https://crontab.guru/</span>
  <span class="c1"># UTC 时间</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># UTC 的 01:00 = 每天 UTC+8 的 09:00</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>
  <span class="c1"># 手动触发</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="c1"># Job 工作项目</span>
<span class="c1"># Job 会并发执行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">caculate-pr-status</span><span class="pi">:</span>
    <span class="c1"># Job 名称 (可省略，有设定在 Log 显示比较好读)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Caculate PR Status</span>
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 来执行工作</span>
    <span class="c1"># 如果是 Private Repo 会计算用量，超过可能会产生费用</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># Job Output</span>
    <span class="na">outputs</span><span class="pi">:</span>
      <span class="na">pr_list</span><span class="pi">:</span> <span class="s">${{ steps.pr-info.outputs.pr_list }}</span>

    <span class="c1"># 工作步骤</span>
    <span class="c1"># 工作步骤会照顺序执行</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 步骤名称</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fetch open PRs and caculate</span>
        <span class="c1"># Step 外部要引用 Output 输出，需设定</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">pr-info</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">const now = new Date();</span>
            <span class="s">const per_page = 100;</span>
            <span class="s">let page = 1;</span>
            <span class="s">let allPRs = [];</span>
      
            <span class="s">while (true) {</span>
              <span class="s">const { data</span><span class="err">:</span> <span class="s">prs } = await github.rest.pulls.list({</span>
                <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
                <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
                <span class="s">state</span><span class="err">:</span> <span class="s1">'</span><span class="s">open'</span><span class="err">,</span>
                <span class="s">per_page,</span>
                <span class="s">page,</span>
              <span class="s">});</span>
              <span class="s">if (prs.length === 0) break;</span>
              <span class="s">allPRs = allPRs.concat(prs);</span>
              <span class="s">if (prs.length &lt; per_page) break;</span>
              <span class="s">page++;</span>
            <span class="s">}</span>
      
            <span class="s">const result = allPRs.map(pr =&gt; {</span>
              <span class="s">const created = new Date(pr.created_at);</span>
              <span class="s">const daysOpen = Math.floor((now - created) / (1000 * 60 * 60 * 24));</span>
              <span class="s">return {</span>
                <span class="s">pr</span><span class="err">:</span> <span class="s">pr.number.toString(),</span>
                <span class="s">title</span><span class="err">:</span> <span class="s">pr.title,</span>
                <span class="s">idle</span><span class="err">:</span> <span class="s">daysOpen</span>
              <span class="s">};</span>
            <span class="s">});</span>

            <span class="s">// 设定回 Output，只接受 String</span>
            <span class="s">core.setOutput('pr_list', JSON.stringify(result));</span>
  <span class="c1"># ----</span>
  <span class="na">send-pr-summary-message-to-slack</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Send PR Summary Messag to Slack</span>
    <span class="c1"># Job 预设是并发，使用 needs 可以迫使当前 Job 等到 need Job 完成时才会执行</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">caculate-pr-status</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Generate Message</span>
        <span class="c1"># Step 外部要引用 Output 输出，需设定</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">gen-msg</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);</span>
            <span class="s">const blocks = [];</span>
      
            <span class="s">// 标题</span>
            <span class="s">blocks.push({</span>
              <span class="s">type</span><span class="err">:</span> <span class="s2">"</span><span class="s">section"</span><span class="err">,</span>
              <span class="na">text</span><span class="pi">:</span> <span class="pi">{</span>
                <span class="nv">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mrkdwn"</span><span class="pi">,</span>
                <span class="nv">text</span><span class="pi">:</span> <span class="err">`</span><span class="nv">📬 *Open PR Report*\nTotal</span><span class="pi">:</span> <span class="err">*</span><span class="nv">$</span><span class="pi">{</span><span class="nv">prList.length</span><span class="pi">}</span><span class="err">*</span> <span class="nv">PR(s)`</span>
              <span class="pi">}</span>
          <span class="err">  }</span><span class="s">);</span>
      
            <span class="s">// 每个 PR 一行</span>
            <span class="s">for (const pr of prList) {</span>
              <span class="s">blocks.push({</span>
                <span class="s">type</span><span class="err">:</span> <span class="s2">"</span><span class="s">section"</span><span class="err">,</span>
                <span class="na">text</span><span class="pi">:</span> <span class="pi">{</span>
                  <span class="nv">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mrkdwn"</span><span class="pi">,</span>
                  <span class="nv">text</span><span class="pi">:</span> <span class="err">`</span><span class="nv">• &lt;https</span><span class="pi">:</span><span class="nv">//github.com/$</span><span class="pi">{</span><span class="nv">context.repo.owner</span><span class="pi">}</span><span class="nv">/$</span><span class="pi">{</span><span class="nv">context.repo.repo</span><span class="pi">}</span><span class="nv">/pull/$</span><span class="pi">{</span><span class="nv">pr.pr</span><span class="pi">}</span><span class="nv">\\|PR</span> <span class="c1">#${pr.pr}&gt; *${pr.title}* - 🕒 ${pr.idle} day(s)`</span>
                <span class="pi">}</span>
          <span class="err">    }</span><span class="s">);</span>
            <span class="s">}</span>

            <span class="s">// 设定回 Output，只接受 String</span>
            <span class="s">core.setOutput('blocks', JSON.stringify(blocks));</span>

            
      <span class="c1"># 使用 Slack 官方封装好的 Slack API Github Actions</span>
      <span class="c1"># https://tools.slack.dev/slack-github-action/sending-techniques/sending-data-slack-api-method/</span>
      <span class="c1"># 发送讯息</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post text to a Slack channel</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">slackapi/slack-github-action@v2.1.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">chat.postMessage</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
          <span class="na">payload</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">channel</span><span class="err">:</span> <span class="s">${{ vars.SLACK_TEAM_CHANNEL_ID }}</span>
            <span class="s">blocks</span><span class="err">:</span> <span class="s">${{ steps.gen-msg.outputs.blocks }}</span>
  <span class="c1"># ----</span>
  <span class="na">auto-close-old-prs</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Auto Close Old PRs</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">caculate-pr-status</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Auto close PRs opened more than 90 days</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);</span>
            <span class="s">const oldPRs = prList.filter(pr =&gt; pr.idle &gt; 90);</span>

            <span class="s">for (const pr of oldPRs) {</span>
              <span class="s">await github.rest.pulls.update({</span>
                <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
                <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
                <span class="s">pull_number</span><span class="err">:</span> <span class="s">parseInt(pr.pr),</span>
                <span class="s">state</span><span class="err">:</span> <span class="s1">'</span><span class="s">closed'</span>
              <span class="err">}</span><span class="s">);</span>

              <span class="s">await github.rest.issues.createComment({</span>
                <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
                <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
                <span class="s">issue_number</span><span class="err">:</span> <span class="s">parseInt(pr.pr),</span>
                <span class="s">body</span><span class="err">:</span> <span class="err">`</span><span class="s">⚠️ This pull request has been automatically closed because it has been open for more than 90 days. Please reopen if needed.`</span>
              <span class="s">});</span>
            <span class="s">}</span>
            <span class="s">console.log(`Closed ${oldPRs.length} PR(s)`);</span>
</pre></table></code></div></div><p>在这个范例中我们使用：</p><ul><li><p>on: schedule Crontab 排程自动触发跟 workflow_dispatch 支援手动触发</p><li><p>Job output/Step output (都只能是字串)</p><li><p>多个 Jobs 预设是并发但可以用 <code class="language-plaintext highlighter-rouge">needs</code> 时间依赖等待关系</p><li><p>从 Repo Secrets/Variables 取得设定</p><li><p>串接 Slack API</p></ul><p><strong>Repo Secrets — 新增</strong> <code class="language-plaintext highlighter-rouge">SLACK_BOT_TOKEN</code></p><p><a href="/assets/404bd5c70040/1*YC4DBHtKmX5XGgcSSzaE5A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*YC4DBHtKmX5XGgcSSzaE5A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijk3MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Slack App 建立、发讯息权限设定可参考我 <a href="/posts/zrealm-dev/zh-cn/slack-app-整合-chatgpt-利用-openai-api-与-google-cloud-functions-自建智能助理-bd94cc88f9c9">之前的文章</a></ul><p><strong>Repo Variables — 新增</strong> <code class="language-plaintext highlighter-rouge">SLACK_TEAM_CHANNEL_ID</code></p><p><a href="/assets/404bd5c70040/1*X4gZ5_IRvsiehAL0O9AleQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*X4gZ5_IRvsiehAL0O9AleQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc0IiBoZWlnaHQ9Ijk5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Commit 档案到 Repo 主分支之后，回到 Actions 手动触发看看：</p><blockquote><p><em>日后会每日自动触发。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*WNFKXl-QC2WGyaSWep5-DA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*WNFKXl-QC2WGyaSWep5-DA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ4IiBoZWlnaHQ9IjQzOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Actions → Pull Request Automation — Daily Checker → Run workflow → Branch: main → Run workflow。</p><p><strong>执行后可以点击进入查看执行状况：</strong></p><p><a href="/assets/404bd5c70040/1*4mvOxnd1uS4ZlxnNoNdHaQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*4mvOxnd1uS4ZlxnNoNdHaQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDg3IiBoZWlnaHQ9IjU0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*BluzFgY2tM2E7DwoVq1jQw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BluzFgY2tM2E7DwoVq1jQw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDMwIiBoZWlnaHQ9IjQ1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>因为有 <code class="language-plaintext highlighter-rouge">needs</code> 的限制，Jobs 流程就会是 <code class="language-plaintext highlighter-rouge">Cacluate PR Status</code> 先完成后才会并发执行 <code class="language-plaintext highlighter-rouge">Auto Close Old PRs</code> 和 <code class="language-plaintext highlighter-rouge">Send PR Summary Message to Slack</code> 。</p><h4 id="执行结果-2"><span class="me-2">执行结果</span><a href="#执行结果-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>任务都成功执行后可以查看 Slack 讯息：</strong></p><p><a href="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDgiIGhlaWdodD0iMTQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>成功 🚀🚀🚀</p><p><strong>完整程式码： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest-Daily.yml" target="_blank">Automation-PullRequest-Daily.yml</a></strong></p><h3 id="小结"><span class="me-2">小结</span><a href="#小结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>希望上面三个案例能让您对 GitHub Actions 有个初步的了解也希望有激起你的自动化工作创意，可以自己发想工作流程(请务必先参考 <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" target="_blank">触发事件</a> )，然后撰写脚本执行；也记得先去 <a href="https://github.com/marketplace?type=actions" target="_blank"><strong>Marketplace</strong></a> 找找现有的步骤可以站在巨人的肩膀直接使用。</p></blockquote><p>本篇只是入门基础(甚至没 Checkout Code)，下一篇「 <a href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-完整实作自动化建置-测试与部署流程教学-4b001d2e8440"><strong>CI/CD 实战指南（三）：使用 GitHub Actions 实作 App 专案的 CI 与 CD 工作流程</strong></a> 」会在介绍更复杂深入的 GitHub Actions Workflow。</p><h4 id="github-自动化延伸议题"><span class="me-2">GitHub 自动化延伸议题</span><a href="#github-自动化延伸议题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GitHub 可以与 Slack 整合，订阅 Repo 的 PR 更新通知、Push Default Branch 通知…等等。</p><p><a href="/assets/404bd5c70040/1*BMTT4koRBIIsQ7_mklC86w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BMTT4koRBIIsQ7_mklC86w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzkiIGhlaWdodD0iNDMwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>问题 1. GitHub 讯息无法标记到人，只标记了 GitHub 帐号，Slack 帐号收不到通知：</strong></p><p><a href="/assets/404bd5c70040/1*Ddp0cEtXE10hScM1rozmtg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Ddp0cEtXE10hScM1rozmtg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzAwIiBoZWlnaHQ9Ijk0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*uHGJ7l__AdYoWT9KpvihLQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*uHGJ7l__AdYoWT9KpvihLQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQzIiBoZWlnaHQ9Ijc3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://slack.github.com/" target="_blank">Slack App</a> or Apps 搜寻 GitHub → 打开讯息视窗 →完成 <strong>Connect GitHub Account</strong> 步骤，这样 GitHub 才知道你对应的 Slack UID 是什么，才能标记你。</p><p><strong>问题 2. Pull Request Reminder</strong></p><p>我记得这本来是第三方开发的功能，后来直接整合在 GitHub 里面了，不要傻傻的自己用 GitHub Actions 写脚本做！</p><p><a href="/assets/404bd5c70040/1*BpMd2K0NBDE6xB1XzFY94Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*BpMd2K0NBDE6xB1XzFY94Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDA4IiBoZWlnaHQ9IjEyMDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><a href="https://docs.github.com/en/organizations/organizing-members-into-teams/managing-scheduled-reminders-for-your-team" target="_blank"><strong><em>GitHub 内建的是 by Team 设置，你需要先为组织增加 Team、Repo 加入 Team 然后才能设置 Pull Request Reminder。</em></strong></a></p></blockquote><ul><li>输入完 Slack Channel 跟规则储存之后每天就会自动传送提示讯息跟标记 Reviewer 了，设置可 <a href="https://michaelheap.com/github-scheduled-reminders/" target="_blank">参考</a> ，结果如下图：</ul><p><a href="/assets/404bd5c70040/1*kvqFXkIKIxP79Wm8vIaN0Q.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*kvqFXkIKIxP79Wm8vIaN0Q.webp" alt="&lt;https://michaelheap.com/github-scheduled-reminders/&gt;{:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iMzE1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://michaelheap.com/github-scheduled-reminders/" target="_blank">https://michaelheap.com/github-scheduled-reminders/</a></p><p><strong>问题 4. GitHub PR 讯息，作者收不到通知：</strong></p><p><a href="/assets/404bd5c70040/1*wmtXwXAcQZDXqInRd0ivPw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*wmtXwXAcQZDXqInRd0ivPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTIiIGhlaWdodD0iNTM1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>这是一个万年的问题，就是 PR 的 Slack 讯息 <strong>其实作者并不知道有人 Reply Threads 讨论</strong> ，GitHub 发的这则 Slack 讯息只会标记 Reviewers，不会标记 Assignee or PR 作者。</em></p></blockquote><p>这时候 GitHub Actions 做自动化小工具就派上用场了，我们可以加一个 Job 在 PR Description 最后 Append 标记作者，这样讯息传到 Slack 也会一并标记到作者的 Slack:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="c"># Workflow(Action) 名称</span>
name: Pull Reqeust Automation
<span class="c"># 请参考前文，略....</span>

  <span class="c"># ---------</span>
  append-author-to-pr-description:
    name: Append author to PR description
    <span class="c"># 因为是共用触发事件，所以在 Job 上自己判断，当是 Pull Request Opened(首次建立) 时才执行 Job 否则会 Skipped</span>
    <span class="k">if</span>: github.event_name <span class="o">==</span> <span class="s1">'pull_request'</span> <span class="o">&amp;&amp;</span> github.event.action <span class="o">==</span> <span class="s1">'opened'</span>
    
    <span class="c"># 如果这个 Job 失败，不影响整个 Workflow，继续其他 Job</span>
    <span class="k">continue</span><span class="nt">-on-error</span>: <span class="nb">true</span>
    
    <span class="c"># 设定最长 Timeout 时间，防止异常情况发生时无止尽的等待</span>
    timeout-minutes: 10
    
    <span class="c"># Runner Label - 使用 GitHub Hosted Runner ubuntu-latest 来执行工作</span>
    <span class="c"># 如果是 Private Repo 会计算用量，超过可能会产生费用</span>
    <span class="c"># 但这种自动化小工作不太容易用过量</span>
    runs-on: ubuntu-latest
    steps:
      - name: Append author to PR description
        <span class="nb">env</span>:
          <span class="c"># secrets.GITHUB_TOKEN 是 GitHub Actions 执行时自动产生的 Token，不需自行在 Secrets 设定，拥有一些 GitHub Repo API Scopes 权限</span>
          <span class="c"># gh(GitHub) cli 需要注入 GH_TOKEN 到 ENV，gh 才有权限操作</span>
          <span class="c"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          GH_TOKEN: <span class="k">${</span><span class="p">{ secrets.GITHUB_TOKEN </span><span class="k">}</span><span class="o">}</span>

          <span class="c">#   ${{ github.xxx }} 是 GitHub Actions Context 表达式</span>
          <span class="c">#   不是 Shell 变数，而是 YAML 解析阶段由 GitHub Actions 替换成对应值</span>
          <span class="c">#   其他参数：https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          PR_NUMBER: <span class="k">${</span><span class="p">{ github.event.pull_request.number </span><span class="k">}</span><span class="o">}</span>
          AUTHOR_TAG: <span class="s1">'@${{ github.event.pull_request.user.login }}'</span>
        run: <span class="se">\\</span>|
          <span class="nv">PR_BODY</span><span class="o">=</span><span class="si">$(</span>gh <span class="nb">pr </span>view <span class="nv">$PR_NUMBER</span> <span class="nt">--repo</span> <span class="k">${</span><span class="p">{ github.repository </span><span class="k">}</span><span class="o">}</span> <span class="nt">--json</span> body <span class="nt">-q</span> <span class="s2">".body"</span><span class="si">)</span>
          <span class="nv">NEW_BODY</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s2">"%s</span><span class="se">\n\n</span><span class="s2">Created by %s"</span> <span class="s2">"</span><span class="nv">$PR_BODY</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$AUTHOR_TAG</span><span class="s2">"</span><span class="si">)</span>
          gh <span class="nb">pr </span>edit <span class="nv">$PR_NUMBER</span> <span class="nt">--repo</span> <span class="k">${</span><span class="p">{ github.repository </span><span class="k">}</span><span class="o">}</span> <span class="nt">--body</span> <span class="s2">"</span><span class="nv">$NEW_BODY</span><span class="s2">"</span>
</pre></table></code></div></div><p><strong>完整程式码： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml" target="_blank">Automation-PullRequest.yml</a></strong></p><p>开 PR 时会自动在描述后加上作者资讯、Slack 讯息也会正确的标记作者：</p><p><a href="/assets/404bd5c70040/1*UtTDtIQJ0vJks79UzCQSAQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*UtTDtIQJ0vJks79UzCQSAQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NTMiIGhlaWdodD0iMzcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*MjVsFqE--xAq1zSQfCNVdQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*MjVsFqE--xAq1zSQfCNVdQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTYiIGhlaWdodD0iMjQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>问题 5. GitHub 疯狂寄通知信到信箱很干扰：</strong></p><p>GitHub Repo 通知跟 Slack 都有设定好之后，统一都在 Slack 收通知了，可以去 GitHub 个人设定把 Email 通知关掉：</p><p><a href="/assets/404bd5c70040/1*INgfO9B2bNFy-Nd1ZjnzOw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*INgfO9B2bNFy-Nd1ZjnzOw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzA2IiBoZWlnaHQ9IjY4NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="其他"><span class="me-2">其他</span><a href="#其他" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Actions 目前没有目录结构，但可以在 Actions 页，置顶(Pin) 五个 Actions；也可以使用 Disable 暂停某个 Action。</p><p><a href="/assets/404bd5c70040/1*ZD-5xkparhJqtnm2REeu6A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*ZD-5xkparhJqtnm2REeu6A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>可以在 Insights 查看 GitHub Actions 用量跟执行成效：</p><p><a href="/assets/404bd5c70040/1*re91ZRtQ0frOF6GVJ-MKrw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*re91ZRtQ0frOF6GVJ-MKrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU5MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h3 id="reuse-workflow-补充"><span class="me-2">Reuse Workflow 补充</span><a href="#reuse-workflow-补充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/posts/zrealm-dev/zh-cn/ci-cd-打包工具平台-使用-google-apps-script-web-app-串接-github-actions-提升跨团队效率-4273e57e7148">下一篇文章</a> 有用到同个 Repo 拆 Reuse Workflow，这边补充一下不同 Repo 拆 Reuse Workflow 的范例。</p><p>先定义一个 Reuse Workflow: <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank"><strong>Automation-label-pr-base-branch.yml:</strong></a> <strong>在 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank">ZhgChgLi/github-actions-ci-cd-demo-share-actions</a> Repo</strong> 。</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Automation-label-pr-base-branch</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[Automation-label-pr-base-branch]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.event.inputs.PR_NUMBER</span><span class="nv"> </span><span class="se">\\</span><span class="s">|</span><span class="se">\\</span><span class="s">|</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.event.inputs.PR_NUMBER \\|\\| github.ref }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># 触发事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 其他 Workflow 呼叫此 Workflow 触发</span>
  <span class="na">workflow_call</span><span class="pi">:</span>
    <span class="c1"># 资料输入</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># PR Number</span>
      <span class="na">PR_NUMBER</span><span class="pi">:</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="c1"># 密钥输入</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="na">GH_TOKEN</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GitHub</span><span class="nv"> </span><span class="s">token</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">access"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">label-pr-base-branch</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR Base Branch</span>
    <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">10</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Label PR by Base Branch</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">label-pr-base-branch</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s">PR_NUMBER="${{ inputs.PR_NUMBER }}"</span>
          <span class="s">REPO="${{ github.repository }}"</span>

          <span class="s">echo "📦 Processing PR</span> <span class="c1">#$PR_NUMBER in repo $REPO"</span>

          <span class="c1"># 取得 PR 的 base branch</span>
          <span class="s">BASE_BRANCH=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json baseRefName --jq '.baseRefName')</span>
          <span class="s">echo "🔖 PR Base Branch</span><span class="err">:</span> <span class="s">$BASE_BRANCH"</span>

          <span class="s"># 允许的 base branch labels</span>
          <span class="s">BRANCH_LABELS=("develop" "main" "master")</span>

          <span class="s"># Label 是否在允许列表</span>
          <span class="s">if [[ " ${BRANCH_LABELS[@]} " =~ " ${BASE_BRANCH} " ]]; then</span>
            <span class="s">LABEL="$BASE_BRANCH"</span>
          <span class="s">else</span>
            <span class="s">echo "⚠️ Base branch '$BASE_BRANCH' not in allowed list, skipping label."</span>
            <span class="s">exit </span><span class="m">0</span>
          <span class="s">fi</span>

          <span class="s"># 移除现有的 base branch labels</span>
          <span class="s">EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')</span>
          <span class="s">for EXISTING in $EXISTING_LABELS; do</span>
            <span class="s">if [[ " ${BRANCH_LABELS[@]} " =~ " ${EXISTING} " ]]; then</span>
              <span class="s">echo "🧹 Removing existing base branch label</span><span class="err">:</span> <span class="s">$EXISTING"</span>
              <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"</span>
            <span class="s">fi</span>
          <span class="s">done</span>

          <span class="s"># 如果 Label 不存在则建立</span>
          <span class="s">if ! gh label list --repo "$REPO" \\| grep -q "^$LABEL$"; then</span>
            <span class="s">echo "🆕 Creating missing label</span><span class="err">:</span> <span class="s">$LABEL"</span>
            <span class="s">gh label create "$LABEL" --repo "$REPO" --description "PR targeting $LABEL branch" --color "ededed"</span>
          <span class="s">else</span>
            <span class="s">echo "✅ Label '$LABEL' already exists"</span>
          <span class="s">fi</span>

          <span class="s"># 加上 base branch label</span>
          <span class="s">echo "🏷️ Adding label '$LABEL' to PR</span> <span class="c1">#$PR_NUMBER"</span>
          <span class="s">gh pr edit "$PR_NUMBER" --repo "$REPO" --add-label "$LABEL"</span>
</pre></table></code></div></div><p>回到我们的 <strong>主 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">ZhgChgLi/github-actions-ci-cd-demo</a> Repo，</strong> 新增一个主 <strong>Workflow <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">Demo-Reuse-Action-From-Another-Repo.yml</a> :</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Automation-label-pr-base-branch</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">call-label-pr-workflow</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Call Base Branch Label Workflow</span>
    <span class="c1"># ✅ 如果被呼叫的 workflow 在同一个 repo：</span>
    <span class="c1">#    uses: ./.github/workflows/Automation-label-pr-base-branch.yml</span>
    <span class="c1">#    注意：这种写法无法指定分支（固定使用 caller workflow 的 branch）</span>
    <span class="c1">#    参考范例：</span>
    <span class="c1">#    - CD-Deploy-Form.yml 呼叫本 repo workflow</span>
    <span class="c1">#    - CD-Deploy.yml 呼叫跨 repo workflow</span>
    <span class="c1">#</span>
    <span class="c1"># ✅ 如果被呼叫的 workflow 在其他 repo：</span>
    <span class="c1">#    uses: {owner}/{repo}/.github/workflows/{file}.yml@{branch_or_tag}</span>
    <span class="c1">#    可以指定 branch 或 tag</span>
    <span class="c1">#    ref: https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">PR_NUMBER</span><span class="pi">:</span> <span class="s">${{ github.event.number }}</span>
      
    <span class="c1"># 如果所有 secrets 都要继承 caller workflow，直接用 `inherit`</span>
    <span class="c1"># secrets: inherit</span>
    <span class="c1">#</span>
    <span class="c1"># 如果只要传特定 secrets，个别指定</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
</pre></table></code></div></div><p>Commit 档案后开 PR 试试看。</p><p><strong>工作流程：主 Repo 的 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml" target="_blank">Demo-Reuse-Action-From-Another-Repo.yml</a> → 呼叫并把参数传到另一个 Repo 的 <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml" target="_blank">Automation-label-pr-base-branch.yml</a> 执行任务 → 回到主 Repo 回报结果。</strong></p><p><a href="/assets/404bd5c70040/1*13bqlAgpBkHM7UthTJAuOg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*13bqlAgpBkHM7UthTJAuOg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE5IiBoZWlnaHQ9IjQ1MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/404bd5c70040/1*CAF3HzS4PHBveDQYu3H73g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*CAF3HzS4PHBveDQYu3H73g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDIiIGhlaWdodD0iMTQ1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>成功！</p><h4 id="private-repo-存取问题"><span class="me-2">Private Repo 存取问题</span><a href="#private-repo-存取问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>这边要注意一个安全性问题，Public Repo 完全没问题，但如果 Reuse Workflow 在 Private Repo 当中，只有在 <strong>同个组织下的其他 Repo + Repo 同样也是 Private + 设定允许</strong> =才能存取使用 Private Repo Reuse Workflow。</p><ul><li><p><code class="language-plaintext highlighter-rouge">Public — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private or Public-ZhgChgli or harry/myRepo</code> = ✅</p><li><p><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private or Public— harry/myRepo</code> = ❌</p><li><p><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Public — ZhgChgLi/anotherRepo</code> = ❌</p><li><p><code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/ReuseRepo</code> + <code class="language-plaintext highlighter-rouge">Private — ZhgChgLi/anotherRepo</code> = ✅</p></ul><p><strong>设定允许的方式，要去 Reuse Workflow Repo → Settings → Actions → General → Acces:</strong></p><p><a href="/assets/404bd5c70040/1*iZCEifgyArTJS3URMSk01g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*iZCEifgyArTJS3URMSk01g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjUiIGhlaWdodD0iMzAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>改勾选：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Accessible from repositories in the 'ZhgChgLi' organization
Workflows in other repositories that are part of the 'ZhgChgLi' organization can access the actions and reusable workflows in this repository. Access is allowed only from private repositories.
</pre></table></code></div></div><p>点击「Save」储存，完成。</p><p><strong>如果没权限存取会出现以下错误讯息：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Invalid workflow file: .github/workflows/Demo-reuse-action-from-another-repo.yml#L21
error parsing called workflow
<span class="s2">".github/workflows/Demo-reuse-action-from-another-repo.yml"</span>
-&gt; <span class="s2">"ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main"</span>
: workflow was not found.
</pre></table></code></div></div><h3 id="github-actions-script-语法补充"><span class="me-2">GitHub Actions Script 语法补充</span><a href="#github-actions-script-语法补充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>补充一下大家可能会感到疑惑的 <code class="language-plaintext highlighter-rouge">${{ XXX }}</code> or <code class="language-plaintext highlighter-rouge">${XXX}</code> or <code class="language-plaintext highlighter-rouge">$XXX</code> 变数语法。</p><p><strong>Demo-Env-Vars- .yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Demo-Env-Vars</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">print-env-vars</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">print-env</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">env</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">context-vars-vs-vars</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">SAY_MY_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Heisenberg"</span>
          <span class="c1"># GitHub Actions Context 表达式，同下方解释</span>
          <span class="na">FROM_REF</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s"># Sehll Script</span><span class="err">:</span>
          <span class="c1"># 引用自订注入的 ENV 变数内容</span>
          <span class="c1"># ${SAY_MY_NAME} or $SAY_MY_NAME 都可以</span>
          <span class="c1"># ${XX} 遇到字串拼接比较好用:</span>
          <span class="s">echo "HI</span><span class="err">:</span> <span class="s">${SAY_MY_NAME}"</span>
          
          <span class="s"># 💡 GitHub Actions Context 表达式</span>
          <span class="s"># 这不是 shell 变数，而是 YAML 解析阶段由 GitHub Actions 替换成对应值</span>
          <span class="s"># ⚠ 在本机或非 GitHub Actions 环境执行会失败</span>
          <span class="s"># 🔗 https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
          <span class="s">BRANCH_NAME_FROM_CONTEXT="${{ github.ref }}"</span>
          
          <span class="s"># 💡 GitHub Actions 执行阶段的环境变数</span>
          <span class="s"># 这些变数在 runner 执行 shell 时由 GitHub Actions 自动注入</span>
          <span class="s"># ✅ 在其他环境可用 export 或 ENV 预先定义相同变数</span>
          <span class="s"># 🔗 https://docs.github.com/en/actions/learn-github-actions/environment-variables</span>
          <span class="s">BRANCH_NAME_FROM_ENV_VARS="${GITHUB_REF}"</span>
          
          <span class="s">echo "FROM_REF</span><span class="err">:</span> <span class="s">${FROM_REF}"</span>
          <span class="s">echo "BRANCH_NAME_FROM_CONTEXT</span><span class="err">:</span> <span class="s">${BRANCH_NAME_FROM_CONTEXT}"</span>
          <span class="s">echo "BRANCH_NAME_FROM_ENV_VARS</span><span class="err">:</span> <span class="s">${BRANCH_NAME_FROM_ENV_VARS}"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">print-github-script-env</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">SAY_MY_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Heisenberg"</span>
          <span class="c1"># GitHub Actions Context 表达式，同上方解释</span>
          <span class="na">FROM_REF</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">// GitHub Script</span><span class="na">: (JavaScript (Node.js))</span><span class="pi">:</span>
            <span class="s">// 从 process.env 取 ENV 值</span>
            <span class="s">console.log(`HI</span><span class="err">:</span> <span class="s">${process.env.SAY_MY_NAME}`);</span>
            <span class="s">console.log(`FROM_REF</span><span class="err">:</span> <span class="s">${process.env.FROM_REF}`);</span>
            <span class="s">// github-script 中会自动注入到 context 变数供 javascript 直接引用</span>
            <span class="s">// https://docs.github.com/en/actions/learn-github-actions/contexts#github-context</span>
            <span class="s">const branch_name_from_context_vars = context.ref;</span>
            <span class="s">console.log(`branch_name_from_context_vars</span><span class="err">:</span> <span class="s">${branch_name_from_context_vars}`);</span>
            <span class="s">// 同样也能用 GitHub Actions Context 表达式(只是意义不大)</span><span class="err">:</span>
            <span class="s">const branch_name_from_context = "${{ github.ref }}";</span>
            <span class="s">console.log(`branch_name_from_context</span><span class="err">:</span> <span class="s">${branch_name_from_context}`);</span>
            
            <span class="s">for (const [key, value] of Object.entries(process.env)) {</span>
              <span class="s">console.log(`${key}=${value}`);</span>
            <span class="s">}</span>
            <span class="s">// github-script 中的 github 物件是 Octokit REST API 实例</span>
            <span class="s">// 用来操作 github api 使用</span>
            <span class="s">// 例如：</span>
            <span class="s">// await github.rest.pulls.list({</span>
            <span class="s">//   owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
            <span class="s">//   repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
            <span class="s">//   state</span><span class="err">:</span> <span class="s2">"</span><span class="s">open"</span>
            <span class="s">//  });</span>
      <span class="c1"># gh CLI does NOT use GITHUB_TOKEN by default; requires GH_TOKEN</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">gh CLI without GH_TOKEN (expected to fail)</span>
        <span class="na">continue-on-error</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s">PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')</span>
          <span class="s">echo "Found $PR_COUNT open pull requests"</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">gh CLI with GH_TOKEN (expected to succeed)</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># Assign GH_TOKEN so gh CLI can authenticate</span>
          <span class="c1"># https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows</span>
          <span class="na">GH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s">PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')</span>
          <span class="s">echo "Found $PR_COUNT open pull requests"</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">github-script auto-authentication (no GH_TOKEN needed)</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="s">\\|</span>
            <span class="s">// github = Octokit REST client (auto-authenticated with GITHUB_TOKEN)</span>
            <span class="s">const pulls = await github.rest.pulls.list({</span>
              <span class="s">owner</span><span class="err">:</span> <span class="s">context.repo.owner,</span>
              <span class="s">repo</span><span class="err">:</span> <span class="s">context.repo.repo,</span>
              <span class="s">state</span><span class="err">:</span> <span class="s2">"</span><span class="s">open"</span>
            <span class="err">}</span><span class="s">);</span>
            <span class="s">console.log(`Found ${pulls.data.length} open pull requests`);</span>
</pre></table></code></div></div><h4 id="--xxx---github-actions-context-表达式"><span class="me-2">${ { XXX } } GitHub Actions Context 表达式</span><a href="#--xxx---github-actions-context-表达式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*e3jpPuwdmf005cjbaXjAwQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*e3jpPuwdmf005cjbaXjAwQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3ODkiIGhlaWdodD0iNjg0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*ed5Wm7Xk48xuP8yQzHpJ9w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*ed5Wm7Xk48xuP8yQzHpJ9w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODAiIGhlaWdodD0iODAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p><code class="language-plaintext highlighter-rouge">${{ XXX }}</code> 是 GitHub Actions Context 表达式， <strong>在YAML 解析阶段由 GitHub Actions 替换成对应值</strong> (如上图 <code class="language-plaintext highlighter-rouge">BRANCH_NAME_FROM_CONTEXT</code> )</p><li><p>完整可用表达式可 <a href="https://docs.github.com/en/actions/learn-github-actions/contexts#github-context" target="_blank">参考官方文件</a></p><li><p><code class="language-plaintext highlighter-rouge">${XXX}</code> or <code class="language-plaintext highlighter-rouge">$XXX</code> 是真实环境变数， <code class="language-plaintext highlighter-rouge">${XXX}</code> 在字串拼接比较好用</p><li><p>GitHub Actions 预设会注入一些环境变数，完整可 <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" target="_blank">参考官方文件</a></p></ul><h4 id="actionsgithub-scriptv7"><span class="me-2">actions/github-script@v7</span><a href="#actionsgithub-scriptv7" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*TjJQnlAAU3VRwS9_dFz1yA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*TjJQnlAAU3VRwS9_dFz1yA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MTgiIGhlaWdodD0iOTEzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/404bd5c70040/1*5bHEdjrGsVdWnYSQgpnsZA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*5bHEdjrGsVdWnYSQgpnsZA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDE4IiBoZWlnaHQ9IjExNTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><ul><li><p>在 <code class="language-plaintext highlighter-rouge">github-script</code> 中同样可以用 <code class="language-plaintext highlighter-rouge">${{ XXX }}</code> 是 GitHub Actions Context 表达式，但是意义不大；因为 <strong>在 github-scirpt 环境中预设会注入 context 变数可以直接在 javascript 中引用</strong></p><li><p>在 <code class="language-plaintext highlighter-rouge">github-script</code> 中 <code class="language-plaintext highlighter-rouge">github</code> 物件是 Octokit REST API 实例</p><li><p><code class="language-plaintext highlighter-rouge">github-script</code> 也能从 <code class="language-plaintext highlighter-rouge">env:</code> 注入变数，但是要用 <code class="language-plaintext highlighter-rouge">${process.env.xxx}</code> 存取</p><li><p>同样预设会注入一些环境变数，完整可 <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" target="_blank">参考官方文件</a> <code class="language-plaintext highlighter-rouge">${process.env.xxx}</code> 存取；但是已经有 <code class="language-plaintext highlighter-rouge">context</code> 变数了，从这存取意义也不大</p></ul><p><a href="/assets/404bd5c70040/1*oW85Sju0sN4caXiaLSg32A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*oW85Sju0sN4caXiaLSg32A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzUiIGhlaWdodD0iNDA4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><code class="language-plaintext highlighter-rouge">github-script</code> 会自动带入 <code class="language-plaintext highlighter-rouge">github-token</code> ，无需指定</ul><h4 id="gh-cli-gh_token"><span class="me-2">gh cli GH_TOKEN</span><a href="#gh-cli-gh_token" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*NUfaaKIobZWVBuXrGg0TPw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*NUfaaKIobZWVBuXrGg0TPw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NjYiIGhlaWdodD0iNDMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>在 GitHub Actions Shell Script 使用 <code class="language-plaintext highlighter-rouge">gh cli</code> 需指定 <code class="language-plaintext highlighter-rouge">GH_TOKEN</code> 参数</p><li><p>可以直接带入预设 Token — <code class="language-plaintext highlighter-rouge">secrets.GITHUB_TOKEN</code> (GitHub Actions 执行时自动产生)</p><li><p><strong>预设 Token 有一些基本权限，如果要操作的指令权限不够就要改用 <a href="https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows" target="_blank">Personal Access Token</a></strong> ，团队使用建议用共用帐号建立 PAT。</p></ul><p><strong>完整程式码： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Env-Vars-.yml" target="_blank">Demo-Env-Vars- .yml</a></strong></p><p>GitHub Actions 已经开发好了，下一步我们可以抽换 GitHub Hosted Runner 成自己的 Self-hosted Runner。</p><blockquote><p><em>GitHub Hosted Runner 有免费额度 2,000 分钟一个月(起)，跑这种小的自动化任务花不了多少时间，而且是跑在 linux 机器花费很低，可能还用不到免费上限； <strong>不一定要改成 Self-hosted Runner</strong> ，改 Runner 还要确保 Runner 环境正确(例如 GitHub Hosted Runner 自带 gh cli，self-hosted Runner 就记得要自己安装好)， <strong>本文纯粹是因为教学才会这样抽换</strong> 。</em></p></blockquote><blockquote><p><em>如果是用在执行 CI/CD 任务才必须要用 Self-hosted Runner。</em></p></blockquote><h4 id="新增-self-hosted-runner"><span class="me-2">新增 Self-hosted Runner</span><a href="#新增-self-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><em>本文以 <strong>macOS M1</strong> 为例。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*mEInaj-tLaprMAa2OfowCw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*mEInaj-tLaprMAa2OfowCw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjExMTMiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><ul><li><p>Settings → Actions → Runners → New self-hosted runner。</p><li><p><strong>Runner image:</strong> macOS</p><li><p><strong>Architecture</strong> : M1 记得选 ARM64 执行比较快</p></ul><p><strong>在实体电脑上开一个 Termnial。</strong></p><p><strong>按照 Download 步骤在本地电脑完成：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c"># 在你想要的路径，建立 Runner 目录</span>
<span class="nb">mkdir </span>actions-runner <span class="o">&amp;&amp;</span> <span class="nb">cd </span>actions-runner
<span class="c"># 下载 Runner image</span>
curl <span class="nt">-o</span> actions-runner-osx-x64-2.325.0.tar.gz <span class="nt">-L</span> https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-osx-x64-2.325.0.tar.gz

<span class="c"># Optional: Validate the hash</span>
<span class="nb">echo</span> <span class="s2">"0562bd934b27ca0c6d8a357df00809fbc7b4d5524d4aeb6ec152e14fd520a4c3  actions-runner-osx-x64-2.325.0.tar.gz"</span> <span class="se">\\</span>| shasum <span class="nt">-a</span> 256 <span class="nt">-c</span>

<span class="c"># 解压缩</span>
<span class="nb">tar </span>xzf ./actions-runner-osx-x64-2.325.0.tar.gz
</pre></table></code></div></div><blockquote><p><em>以上只是参考；建议照你设定页里的步骤来做，才会是最新版本的 Runner image。</em></p></blockquote><p><a href="/assets/404bd5c70040/1*Q0k0EPjrY2V4owseESe5lg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Q0k0EPjrY2V4owseESe5lg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTYxIiBoZWlnaHQ9IjE5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>设定 Configure:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># 请参考设定页指令，Token 会随时间改变</span>
./config.sh <span class="nt">--url</span> https://github.com/ORG/REPO <span class="nt">--token</span> XXX
</pre></table></code></div></div><p>会依序要你输入：</p><ul><li><p>Enter the name of the runner group to add this runner to: [press Enter for Default] <strong>直接 Enter</strong> *只有注册到 Organization 组织层级的 Runner 才有 Group 分组功能</p><li><p>Enter the name of runner: [press Enter for ZhgChgLideMacBook-Pro] <strong>可以输入想设定的 Runner 名称 e.g.</strong> <code class="language-plaintext highlighter-rouge">app-runner-1</code> <strong>或直接 Enter</strong></p><li><p>This runner will have the following labels: ‘self-hosted’, ‘macOS’, ‘X64’ Enter any additional labels (ex. label-1,label-2): [press Enter to skip] <strong>输入想要设定的 Runner label，可以多输入自订 Label 方便之后使用</strong> 同前述 GitHub Acitons/Runner 是依照对应 Label 找任务来做， <strong>如果只用 default label，Runner 可能会捡到组织内的其他 Runner 来执行工作，自订一个最保险</strong> 。 这边我自己乱定了一个 label <code class="language-plaintext highlighter-rouge">self-hosted-zhgchgli</code></p><li><p>Enter name of work folder: [press Enter for _work] <strong>直接 Enter</strong></p></ul><p>出现 √ Settings Saved. 代表设定完成了。</p><p><a href="/assets/404bd5c70040/1*yxLfii0rWhzsiFuYVmPgFw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*yxLfii0rWhzsiFuYVmPgFw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjkiIGhlaWdodD0iNTAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>启动 Runner:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./run.sh
</pre></table></code></div></div><p>出现 √ Connected to GitHub、Listening for Jobs 就代表已经在监听 Actions 任务了：</p><p><a href="/assets/404bd5c70040/1*1RmPPOosAoCxHA9tg_WE2w.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*1RmPPOosAoCxHA9tg_WE2w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyOTAiIGhlaWdodD0iOTgiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><blockquote><p><strong><em>这个 Terminal 视窗不关闭就会持续接收任务来做。</em></strong></p></blockquote><blockquote><p><strong><em>🚀🚀🚀同一台电脑开多个 Terminal 在不同目录就能起多个 Runner。</em></strong></p></blockquote><p><strong>回到 Repo 设定页也能看到 Runner 正在等待任务：</strong></p><p><a href="/assets/404bd5c70040/1*jjq5NTPYMuC3gH3ey_VTtg.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*jjq5NTPYMuC3gH3ey_VTtg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDIiIGhlaWdodD0iMjQ3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>Status:</strong></p><ul><li><p>Idle: 闲置，在等待任务</p><li><p>Active: 有任务正在执行</p><li><p>Offline: Runner 不在线上</p></ul><h4 id="workflowgithub-actions-runner-改用-self-hosted-runner"><span class="me-2">Workflow(GitHub Actions) Runner 改用 Self-hosted Runner</span><a href="#workflowgithub-actions-runner-改用-self-hosted-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>以 <code class="language-plaintext highlighter-rouge">Automation-PullRequest.yml</code> 为例：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># 请参考前文，略....</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">label-pr-by-file-count</span><span class="pi">:</span>
    <span class="c1"># 请参考前文，略....</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">self-hosted-zhgchgli</span><span class="pi">]</span>
    <span class="c1"># 请参考前文，略....</span>
  <span class="c1"># ---------</span>
  <span class="na">assign-self-if-no-assignee</span><span class="pi">:</span>
    <span class="c1"># 请参考前文，略....</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">self-hosted-zhgchgli</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 请参考前文，略....</span>
</pre></table></code></div></div><p>Commit 档案到 Repo 主分支之后，重新开 PR 触发验证一下 Actions。</p><p><strong>回到 Runner Terminal 就能看到有新的任务进来了，正在执行跟执行结果：</strong></p><p><a href="/assets/404bd5c70040/1*Hu0DxKQbenPmBEw8swv65A.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*Hu0DxKQbenPmBEw8swv65A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjgiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>失败了，因为我本机电脑没有安装 <a href="https://github.com/cli/cli" target="_blank">gh cli</a> 环境：</p><p><a href="/assets/404bd5c70040/1*9xguacdPATIeEZdbFszmHw.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*9xguacdPATIeEZdbFszmHw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NzMiIGhlaWdodD0iMTIzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>使用 <code class="language-plaintext highlighter-rouge">brew install gh</code> 在实体电脑上安装完 gh 后再次触发执行：</p><p><a href="/assets/404bd5c70040/1*TbkAt00K89Ysbix33dK8ZA.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*TbkAt00K89Ysbix33dK8ZA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MzEiIGhlaWdodD0iMjkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>成功！现在这个任务就完全是使用我们自己的电脑在执行，不使用 GitHub Hosted Runner、不计费使用。</p><p><strong>我们可以点进去 Action Log 查看任务执行在的 Runner、机器是哪一个：</strong></p><p><a href="/assets/404bd5c70040/1*oqLcWfn6cbWsCt9fVsrikQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*oqLcWfn6cbWsCt9fVsrikQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDkyIiBoZWlnaHQ9IjgyNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="runs-on--runner-label-设定"><span class="me-2">runs-on: [ <strong>Runner Label] 设定</strong></span><a href="#runs-on--runner-label-设定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>这里是 AND 不是 OR，GitHub Runner 暂不支援 OR 挑选 Runner 执行。</p><p>例如： <code class="language-plaintext highlighter-rouge">[self-hosted, macOS, app]</code> → 代表 Runner 要 <strong>同时有</strong> <code class="language-plaintext highlighter-rouge">self-hosted, macOS, app</code> 这 3 个 Labels 才会匹配接任务来执行。</p><p>如果一个 Job 想同时测试不同 Runner 环境下的结果可以使用 <code class="language-plaintext highlighter-rouge">matrix</code> 参数：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">${{ matrix.runner }}</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">runner</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="pi">[</span><span class="nv">self-hosted</span><span class="pi">,</span> <span class="nv">linux</span><span class="pi">,</span> <span class="nv">high-memory</span><span class="pi">]</span>
          <span class="pi">-</span> <span class="pi">[</span><span class="nv">self-hosted</span><span class="pi">,</span> <span class="nv">macos</span><span class="pi">,</span> <span class="nv">xcode-15</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo "Running on ${{ matrix.runner }}"</span>
</pre></table></code></div></div><p>这样这个 Job 会在下列两个 Runner Labels Runner 中并行各执行一次：</p><ul><li><p>self-hosted, linux, high-memory</p><li><p>self-hosted, macos, xcode-15</p></ul><blockquote><p><strong><em>Runner 暂不支援：</em></strong></p></blockquote><blockquote><p><em>- OR 挑选 Runner</em></p></blockquote><blockquote><p><em>- Runner 权重设定</em></p></blockquote><h4 id="注册-runner-成-service"><span class="me-2">注册 Runner 成 Service</span><a href="#注册-runner-成-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>可以参考官方文件「 <a href="https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac" target="_blank">Configuring the self-hosted runner application as a service</a> 」将 Runner 直接注册成系统 Service，这样就能在背景执行(不用开 Terminal 在前景)、开机后也会自动启动。</p><p>有多个 Runner 记得调整「 <a href="https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac#customizing-the-self-hosted-runner-service-1" target="_blank">Customizing the self-hosted runner service</a> 」设定注册不同名称。</p><blockquote><p><em>iOS 这边我有一个待研究排除的问题， <strong>就是我改用背景 Service 之后在 Archive 会遇到错误(疑似是跟 keychain 权限有关)</strong> ，当时没时间解决，就先用起前景 Terminal Runner 了。</em></p></blockquote><p>如果是传统前景要做到开机自动启动就要去 <code class="language-plaintext highlighter-rouge">~/Library/LaunchAgents</code> 新增一个自动启动设定档案：</p><p><code class="language-plaintext highlighter-rouge">actions.runner.REPO.RUNNER_NAME.plist</code> ：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;string&gt;</span>actions.runner.REPO.RUNNER_NAME<span class="nt">&lt;/string&gt;</span>
  <span class="c">&lt;!-- 指定 Terminal.app 来启动 --&gt;</span>
  <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;array&gt;</span>
   <span class="nt">&lt;string&gt;</span>/usr/bin/open<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>-a<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>Terminal<span class="nt">&lt;/string&gt;</span>
   <span class="nt">&lt;string&gt;</span>/Users/zhgchgli/Documents/actions-runner/run.sh<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;/array&gt;</span>
  <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;true/&gt;</span>
  <span class="nt">&lt;key&gt;</span>WorkingDirectory<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;string&gt;</span>/Users/zhgchgli/Documents/actions-runner<span class="nt">&lt;/string&gt;</span>
 <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre></table></code></div></div><blockquote><p><em>有兴趣深入研究 DevOps 的朋友可参考官方 <a href="https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller#scaling-runners" target="_blank">k8s Runner</a> 文件。</em></p></blockquote><h4 id="完整专案-repo"><span class="me-2">完整专案 Repo</span><a href="#完整专案-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/8b25f8eae56bc35c92b97c5d7e7834aa5cb87673e718a1ce829f5bb80f3edebb/ZhgChgLi/github-actions-ci-cd-demo" alt="" loading="lazy"></a></p><h3 id="官方文件"><span class="me-2">官方文件</span><a href="#官方文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://docs.github.com/en/actions/get-started/quickstart" target="_blank" class="img-link shimmer" ><img src="https://docs.github.com/assets/cb-345/images/social-cards/actions.png" alt="" loading="lazy"></a></p><p>更细节的设置方式请务必参考官方手册。</p><h4 id="ai-can-help"><span class="me-2">AI Can Help!</span><a href="#ai-can-help" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/404bd5c70040/1*JecNUCqujV1oeAvHA14X-g.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*JecNUCqujV1oeAvHA14X-g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE0IiBoZWlnaHQ9IjExNDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>实测给 ChatGPT 完整的步骤跟时机点就能帮你写好 GitHub Actions 直接使用!</p><h3 id="总结"><span class="me-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>现在你应该已经对 GitHub Actions + Self-hosted Runner 有了一定程度的了解，下一篇我将开始以 App (iOS) CI/CD 为案例，手把手建置整套流程。</p><h3 id="系列文章"><span class="me-2">系列文章：</span><a href="#系列文章" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p><a href="/posts/zrealm-dev/zh-cn/ci-cd-是什么-打造高效稳定开发团队的关键流程与工具选择-c008a9e8ceca"><strong>CI/CD 实战指南（一）：CI/CD 是什么？如何透过 CI/CD 打造稳定高效的开发团队？工具选择？</strong></a></p><li><p><a href="/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-详解与实战案例-ci-cd-自动化工作流程建置-404bd5c70040"><strong>CI/CD 实战指南（二）：GitHub Actions 与 self-hosted Runner 使用与建置大全</strong></a></p><li><p><a href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-完整实作自动化建置-测试与部署流程教学-4b001d2e8440"><strong>CI/CD 实战指南（三）：使用 GitHub Actions 实作 App 专案的 CI 与 CD 工作流程</strong></a></p><li><p><a href="/posts/zrealm-dev/zh-cn/ci-cd-打包工具平台-使用-google-apps-script-web-app-串接-github-actions-提升跨团队效率-4273e57e7148"><strong>CI/CD 实战指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免费易用的打包工具平台</strong></a></p></ul><h4 id="buy-me-a-coffee"><span class="me-2"><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></span><a href="#buy-me-a-coffee" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank"><strong><em>本系列文章花费了大量的时间精力撰写，如果内容对您有帮助、对您的团队有实质提升工作效率与产品品质；欢迎请我喝杯咖啡，感谢支持！</em></strong></a></p></blockquote><p><a href="/assets/404bd5c70040/1*QJj54G9gOjtQS-rbHVT1SQ.webp" class="popup img-link blur"><img data-src="/assets/404bd5c70040/1*QJj54G9gOjtQS-rbHVT1SQ.webp" alt="[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iNzAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/404bd5c70040" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2025-07-02-404bd5c70040.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cicd/" class="post-tag no-text-decoration" >cicd</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >github-actions</a> <a href="/tags/github/" class="post-tag no-text-decoration" >github</a> <a href="/tags/self-hosted/" class="post-tag no-text-decoration" >self-hosted</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GitHub%20Actions%EF%BD%9CSelf-hosted%20Runner%20%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BD%9CCI/CD%20%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgithub-actions-self-hosted-runner-%25E8%25AF%25A6%25E8%25A7%25A3%25E4%25B8%258E%25E5%25AE%259E%25E6%2588%2598%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GitHub%20Actions%EF%BD%9CSelf-hosted%20Runner%20%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BD%9CCI/CD%20%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgithub-actions-self-hosted-runner-%25E8%25AF%25A6%25E8%25A7%25A3%25E4%25B8%258E%25E5%25AE%259E%25E6%2588%2598%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgithub-actions-self-hosted-runner-%25E8%25AF%25A6%25E8%25A7%25A3%25E4%25B8%258E%25E5%25AE%259E%25E6%2588%2598%25E6%25A1%2588%25E4%25BE%258B-ci-cd-%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581%25E7%25A8%258B%25E5%25BB%25BA%25E7%25BD%25AE-404bd5c70040%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E7%82%B9-%E7%BE%8E%E9%A3%9F%E4%B8%8E%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AF%81%E7%9C%81%E9%92%B1%E7%A7%98%E8%AF%80-8ace34a1a3d8/">游记 2025 韩国釜山 8 天 7 夜自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751458952" data-df="ll" > Jul 2, 2025 </time><h4 class="pt-0 my-2">CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全</h4><div class="text-muted"><p>帶您從頭了解 GitHub Actions/Self-hosted Runner 運作方式與手把手使用教學。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/github-actions-self-hosted-runner-setup-and-usage-guide-for-efficient-ci-cd-404bd5c70040/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751458952" data-df="ll" > Jul 2, 2025 </time><h4 class="pt-0 my-2">GitHub Actions｜Self-hosted Runner Setup and Usage Guide for Efficient CI/CD</h4><div class="text-muted"><p>Discover step-by-step instructions to implement GitHub Actions and Self-hosted Runner, resolving CI/CD deployment challenges and accelerating your automation workflows for reliable and scalable sof...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751900544" data-df="ll" > Jul 7, 2025 </time><h4 class="pt-0 my-2">CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程</h4><div class="text-muted"><p>iOS App 自動化建置、測試、部署的 GitHub Actions 實作步驟完整教學</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/github-actions-self-hosted-runner-setup-and-usage-guide-for-efficient-ci-cd-404bd5c70040/" class="btn btn-outline-primary" aria-label="Older" ><p>GitHub Actions｜Self-hosted Runner Setup and Usage Guide for Efficient CI/CD</p></a> <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" class="btn btn-outline-primary" aria-label="Newer" ><p>CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">中文</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
