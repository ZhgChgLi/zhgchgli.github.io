<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS 开发者面对多平台分享功能需求，透过 Visitor Pattern 解决资料结构与分享逻辑混乱问题，提升程式码低耦合高聚合，实现灵活扩充与维护，避免过度设计带来的困扰。" /><meta property="og:description" content="iOS 开发者面对多平台分享功能需求，透过 Visitor Pattern 解决资料结构与分享逻辑混乱问题，提升程式码低耦合高聚合，实现灵活扩充与维护，避免过度设计带来的困扰。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-15T23:58:36+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" /><meta property="twitter:title" content="Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-06T13:58:52+08:00","datePublished":"2021-06-15T23:58:36+08:00","description":"iOS 开发者面对多平台分享功能需求，透过 Visitor Pattern 解决资料结构与分享逻辑混乱问题，提升程式码低耦合高聚合，实现灵活扩充与维护，避免过度设计带来的困扰。","headline":"Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/"}</script><title>Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-design-pattern-practical-applications-ba5773a7bfea/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%87%89%E7%94%A8-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E5%8B%99%E8%A7%A3%E6%9E%90%E8%88%87%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%A7%8B%E5%84%AA%E5%8C%96-ba5773a7bfea/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化</h1><p class="post-desc fw-light mb-4">iOS 开发者面对多平台分享功能需求，透过 Visitor Pattern 解决资料结构与分享逻辑混乱问题，提升程式码低耦合高聚合，实现灵活扩充与维护，避免过度设计带来的困扰。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1623772716" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 15, 2021 </time> </span> <span> Updated <time data-ts="1725602332" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 6, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3111 words" > <em>17 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Visitor Pattern 在 iOS Swift 分享功能应用｜设计模式实务解析与最佳架构优化</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-design-pattern-practical-applications-ba5773a7bfea/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%87%89%E7%94%A8-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E5%8B%99%E8%A7%A3%E6%9E%90%E8%88%87%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%A7%8B%E5%84%AA%E5%8C%96-ba5773a7bfea/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目录</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>Visitor Pattern in Swift (Share Object to XXX Example) <a href="#visitor-pattern-in-swift-share-object-to-xxx-example">#</a></summary><ul><li><a href="#前言">前言</a></li><li><a href="#内功与招式">内功与招式</a></li><li><a href="#找到适合自己的学习方式">找到适合自己的学习方式</a></li><li><a href="#学习资源">学习资源</a></li></ul></details></li><li class="has-children"><details><summary>Visitor — Behavioral Patterns <a href="#visitor--behavioral-patterns">#</a></summary><ul><li><a href="#visitor-是什么">Visitor 是什么</a></li></ul></details></li><li class="has-children"><details><summary>iOS 实务场景 — 分享功能 <a href="#ios-实务场景--分享功能">#</a></summary><ul><li><a href="#定义-model">定义 Model</a></li><li><a href="#什么都没想的做法">什么都没想的做法</a></li><li><a href="#优化一下">优化一下</a></li><li><a href="#visitor">Visitor</a></li></ul></details></li><li class="has-children"><details><summary>原则 <a href="#原则">#</a></summary><ul><li><a href="#参考资料">参考资料</a></li></ul></details></li><li><a href="#延伸阅读">延伸阅读</a></li></ul></nav><hr /><h3 id="visitor-pattern-in-swift-share-object-to-xxx-example"><span class="me-2">Visitor Pattern in Swift (Share Object to XXX Example)</span><a href="#visitor-pattern-in-swift-share-object-to-xxx-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Visitor Pattern 的实际应用场景分析 (在分享 商品、歌曲、文章… 到 Facebook, Line, Linkedin. . 场景)</p><p><a href="/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" class="popup img-link blur"><img data-src="/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.webp" alt="Photo by [Daniel McCullough](https://unsplash.com/@d_mccullough?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijc4OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@d_mccullough?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Daniel McCullough</a></p><h4 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>「Design Pattern」从知道有这个东西到现在也超过 10 年了依然没办法有自信的说能完全掌握，一直以来都是蒙蒙懂懂的，也好几次从头到尾把所有模式都看过一遍，但看了没内化、没在实务上应用很快就忘了。</p><blockquote><p><em>我真的废。</em></p></blockquote><h4 id="内功与招式"><span class="me-2">内功与招式</span><a href="#内功与招式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>曾经看到的一个很好的比喻 ，招式部分如：PHP、Laravel、iOS、Swift、SwiftUI…之类的应用，其实在其中切换学习门槛都不算高；但内功部分如：演算法、资料结构、设计模式…等等都属于内功；内功与招式之间有著相辅相成的效果；但是招式好学，内功难练；招式厉害的内功不一定厉害，内功厉害的也可以很快学会招式，所以与其说相辅相成不如说内功才是基础，搭配招式才能所向披靡。</p><h4 id="找到适合自己的学习方式"><span class="me-2">找到适合自己的学习方式</span><a href="#找到适合自己的学习方式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>基于之前的学习经验，我认为适合我自己的学习 Design Pattern 方式是 — 先精再通；先著重于精通几个模式，要能内化跟灵活运用，还要培养出嗅觉，能判断什么场景适合什么场景不适合；再一步一步的累积新模式，直到全部掌握；我觉得最好的方式就是多找实务场境，从应用中学习。</p><h4 id="学习资源"><span class="me-2">学习资源</span><a href="#学习资源" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>推荐两个免费的学习资源</p><ul><li><p><a href="https://refactoringguru.cn/" target="_blank">https://refactoringguru.cn/</a> ：完整介绍所有模式结构、场景、相互关系</p><li><p><a href="https://shirazian.wordpress.com/2016/04/11/design-patterns-in-swift/" target="_blank">https://shirazian.wordpress.com/2016/04/11/design-patterns-in-swift/</a> ：作者以实际开发 iOS 的场景介绍更个模式的应用，本文也会以这个方向撰写</p></ul><h3 id="visitor--behavioral-patterns"><span class="me-2">Visitor — Behavioral Patterns</span><a href="#visitor--behavioral-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>第一章纪录的是 Visitor Pattern，这也是在街声工作一年挖到的金矿之一，在 StreetVoice App 中有诸多善用 Visitor 解决架构问题的地方；我也在这段经历之中席的了 Visitor 的原理精髓；所以第一章就来写它！</p><h4 id="visitor-是什么"><span class="me-2">Visitor 是什么</span><a href="#visitor-是什么" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先请先了解 Visitor 是什么？想要解决什么问题？组成结构是什么？</p><p><a href="/assets/ba5773a7bfea/1*rbswlsges8_oS3pNI1-WKA.webp" class="popup img-link blur"><img data-src="/assets/ba5773a7bfea/1*rbswlsges8_oS3pNI1-WKA.webp" alt="图片取自 [refactoringguru](https://refactoringguru.cn/design-patterns/visitor){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NjkiIGhlaWdodD0iNjM4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>图片取自 <a href="https://refactoringguru.cn/design-patterns/visitor" target="_blank">refactoringguru</a></p><p>详细内容这边不再重复赘述，请先直接参考 <a href="https://refactoringguru.cn/design-patterns/visitor" target="_blank">refactoringguru 对于 Visitor 的讲解</a> 。</p><h3 id="ios-实务场景--分享功能"><span class="me-2">iOS 实务场景 — 分享功能</span><a href="#ios-实务场景--分享功能" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>假设今天我们有以下几个 Model：UserModel、SongModel、PlaylistModel 这三个 Model，现在我们要实作分享功能，可以分享到：Facebook、Line、Instagram，这三个平台；每个 Model 需要呈现的分享讯息皆为不同、每个平台需要的资料也各有不同：</p><p><a href="/assets/ba5773a7bfea/1*ad2ijo5Bvm9_wnM1g2LNog.webp" class="popup img-link blur"><img data-src="/assets/ba5773a7bfea/1*ad2ijo5Bvm9_wnM1g2LNog.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MzgiIGhlaWdodD0iMjk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>组合场景如上图，第一个表格显示各 Model 的客制化内容、第二个表格显示各分享平台需要的资料。</p><blockquote><p><strong><em>尤其 Instagram 在分享 Playlist 时要多张图片，跟其他分享要的 source 不一样。</em></strong></p></blockquote><h4 id="定义-model"><span class="me-2">定义 Model</span><a href="#定义-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>首先把各个 Model 有哪些 Property 定义完成：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="c1">// Model</span>
<span class="kd">struct</span> <span class="kt">UserModel</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SongModel</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span>
    <span class="k">let</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">PlaylistModel</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span>
    <span class="k">let</span> <span class="nv">songs</span><span class="p">:</span> <span class="p">[</span><span class="kt">SongModel</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// Data</span>

<span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">UserModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii"</span><span class="p">,</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/profile/1.png"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="kt">SongModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span>
                     <span class="nv">name</span><span class="p">:</span> <span class="s">"Wake me up"</span><span class="p">,</span>
                     <span class="nv">user</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                     <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/cover/1.png"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">playlist</span> <span class="o">=</span> <span class="kt">PlaylistModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span>
                            <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii Tribute Concert"</span><span class="p">,</span>
                            <span class="nv">user</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                            <span class="nv">songs</span><span class="p">:</span> <span class="p">[</span>
                                <span class="n">song</span><span class="p">,</span>
                                <span class="kt">SongModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Waiting for love"</span><span class="p">,</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii"</span><span class="p">,</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/profile/1.png"</span><span class="p">),</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/cover/3.png"</span><span class="p">),</span>
                                <span class="kt">SongModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Lonely Together"</span><span class="p">,</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii"</span><span class="p">,</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/profile/1.png"</span><span class="p">),</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/cover/1.png"</span><span class="p">),</span>
                                <span class="kt">SongModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"4"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Heaven"</span><span class="p">,</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii"</span><span class="p">,</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/profile/1.png"</span><span class="p">),</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/cover/4.png"</span><span class="p">),</span>
                                <span class="kt">SongModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"5"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"S.O.S"</span><span class="p">,</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Avicii"</span><span class="p">,</span> <span class="nv">profileImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/profile/1.png"</span><span class="p">),</span> <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/cover/5.png"</span><span class="p">)],</span>
                            <span class="nv">coverImageURLString</span><span class="p">:</span> <span class="s">"https://zhgchg.li/playlist/1.png"</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="什么都没想的做法"><span class="me-2">什么都没想的做法</span><a href="#什么都没想的做法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>完全不考虑架构，先上一个什么都没想的最脏做法。</p><p><a href="/assets/ba5773a7bfea/1*5kBPDRNpaHNyW4u4YEsOGA.webp" class="popup img-link blur"><img data-src="/assets/ba5773a7bfea/1*5kBPDRNpaHNyW4u4YEsOGA.webp" alt="周星驰 — 食神" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzgxIiBoZWlnaHQ9Ijg3NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>周星驰 — 食神</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">ShareManager</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">urlString</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">imageURLStrings</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Hi 跟你分享一位很赞的艺人</span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">urlString</span> <span class="o">=</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">imageURLStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">profileImageURLString</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">song</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Hi 与你分享刚刚听到一首很赞的歌，</span><span class="se">\(</span><span class="n">song</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s"> 的 </span><span class="se">\(</span><span class="n">song</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">urlString</span> <span class="o">=</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">song</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/song/</span><span class="se">\(</span><span class="n">song</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">imageURLStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">song</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">playlist</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Hi 这个歌单我听个不停 </span><span class="se">\(</span><span class="n">playlist</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">urlString</span> <span class="o">=</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">playlist</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/playlist/</span><span class="se">\(</span><span class="n">playlist</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">imageURLStrings</span> <span class="o">=</span> <span class="n">playlist</span><span class="o">.</span><span class="n">songs</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="n">coverImageURLString</span> <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">shareToFacebook</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Facebook share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Facebook..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[![</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">imageURLStrings</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">urlString</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">shareToInstagram</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Instagram share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Instagram..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">imageURLStrings</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">shareToLine</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Line share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Line..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">urlString</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>没啥好说的，就是 0 架构全搅和在一起，如果今天要新加一个分享平台、更改某个平台的分享资讯、增加一个可分享的 Model 都要动到 ShareManager；另外 imageURLStrings 的设计因是考量到 Instagram 在分享歌单时需要图片组资料所以才宣告成阵列，这有点倒因为果变成照需求去设计架构，其他不需要图片组的类型也遭到污染。</p><h4 id="优化一下"><span class="me-2">优化一下</span><a href="#优化一下" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>稍微分离一下逻辑。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getShareText</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span>
    <span class="kd">func</span> <span class="nf">getShareURLString</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span>
    <span class="kd">func</span> <span class="nf">getShareImageURLStrings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">UserModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getShareText</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Hi 跟你分享一位很赞的艺人</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareURLString</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareImageURLStrings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">profileImageURLString</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getShareText</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Hi 与你分享刚刚听到一首很赞的歌，</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s"> 的 </span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareURLString</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/song/</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareImageURLStrings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">PlaylistModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getShareText</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Hi 这个歌单我听个不停 </span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareURLString</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://zhgchg.li/user/</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/playlist/</span><span class="se">\(</span><span class="k">self</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getShareImageURLStrings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ShareManagerProtocol</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">share</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">FacebookShare</span><span class="p">:</span> <span class="kt">ShareManagerProtocol</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span>

    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">share</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Facebook share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Facebook..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[![</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="nf">getShareText</span><span class="p">()</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="nf">getShareImageURLStrings</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="nf">getShareURLString</span><span class="p">()</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">InstagramShare</span><span class="p">:</span> <span class="kt">ShareManagerProtocol</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span>

    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">share</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Instagram share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Instagram..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="nf">getShareImageURLStrings</span><span class="p">()</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">LineShare</span><span class="p">:</span> <span class="kt">ShareManagerProtocol</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span>

    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">Shareable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">share</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call Line share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Line..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="nf">getShareText</span><span class="p">()</span><span class="se">)</span><span class="s">](</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="nf">getShareURLString</span><span class="p">()</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>我们抽离出一个 CanShare Protocol，凡是 Model 有遵循这个协议都能支援分享；分享的部分也抽离出 ShareManagerProtocol，有新的分享只要实现协议内容即可、要修改删除也都不会影响其他 ShareManager。</p><p>但 getShareImageURLStrings 依然诡异，另外假设今天新增的分享平台需求的 Model 资料天壤之别，例如微信分享还需要播放次数、创建日期…等资讯，只有他要，这时候就会开始变得混乱。</p><h4 id="visitor"><span class="me-2">Visitor</span><a href="#visitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>使用 Visitor Pattern 的解法。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
</pre><td class="rouge-code"><pre><span class="c1">// Visitor Version</span>
<span class="kd">protocol</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="kt">SharePolicy</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">UserModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="kt">SharePolicy</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="kt">SharePolicy</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">PlaylistModel</span><span class="p">:</span> <span class="kt">Shareable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="kt">SharePolicy</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">SharePolicy</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ShareToFacebookVisitor</span><span class="p">:</span> <span class="kt">SharePolicy</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Facebook share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Facebook..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[![Hi 跟你分享一位很赞的艺人</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。](</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">profileImageURLString</span><span class="se">)</span><span class="s">](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Facebook share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Facebook..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[![Hi 与你分享刚刚听到一首很赞的歌，</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s"> 的 </span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">，他被播方式。](</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="se">)</span><span class="s">)](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/song/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Facebook share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Facebook..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[![Hi 这个歌单我听个不停 </span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。](</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="se">)</span><span class="s">)](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/playlist/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ShareToLineVisitor</span><span class="p">:</span> <span class="kt">SharePolicy</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Line share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Line..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[Hi 跟你分享一位很赞的艺人</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Line share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Line..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[Hi 与你分享刚刚听到一首很赞的歌，</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s"> 的 </span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">，他被播方式。]](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/song/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Line share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Line..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"[Hi 这个歌单我听个不停 </span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">。](https://zhgchg.li/user/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">/playlist/</span><span class="se">\(</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ShareToInstagramVisitor</span><span class="p">:</span> <span class="kt">SharePolicy</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Instagram share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Instagram..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">profileImageURLString</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Instagram share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Instagram..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coverImageURLString</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// call Instagram share sdk...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Share to Instagram..."</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">songs</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="n">coverImageURLString</span> <span class="p">})</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use case</span>
<span class="k">let</span> <span class="nv">shareToInstagramVisitor</span> <span class="o">=</span> <span class="kt">ShareToInstagramVisitor</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="n">shareToInstagramVisitor</span><span class="p">)</span>
<span class="n">playlist</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="n">shareToInstagramVisitor</span><span class="p">)</span>
</pre></table></code></div></div><p>我们逐行来看做了什么：</p><ul><li><p>首先我们创建了一个 Shareable 的 Protocol，其目的只是方便我们管理 Model 支援分享 Visitor 有统一的接口 (不定义也行)。</p><li><p>UserModel/SongModel/PlaylistModel 实现 Shareable <code class="language-plaintext highlighter-rouge">func accept(visitor: SharePolicy)</code> ，之后如果有新增支援分享的 Model 也只需实现协议</p><li><p>定义出 SharePolicy 列出所支援的 Model <code class="language-plaintext highlighter-rouge">(must be concrete type)</code> 或许你会想为何不定义成 <code class="language-plaintext highlighter-rouge">visit(model: Shareable)</code> 如果是这样就重蹈上一版的问题了</p><li><p>各个 Share 方法实现 SharePolicy，各自依照 source 去组合需要的资源</p><li><p>假设今天多一个微信分享，他要的资料比较特别(播放次数、创建日期)，也不会影响现有程式码，因为他能从 concrete model 拿到他自己需要的资讯。</p></ul><p>达成低耦合、高聚合的程式开发目标。</p><p>以上是经典的 <a href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch" target="_blank">Visitor Double Dispatch</a> 实现，但我们日常开发上比较少会遇到这种状况，一般常见的状况可能只会有一个 Visitor，但我觉得也很适合使用这套模式组合，例如今天有一个 SaveToCoreData 的需求，我们也可以直接定义 <code class="language-plaintext highlighter-rouge">accept(visitor: SaveToCoreDataVisitor)</code> ，不多宣告出 Policy Protocol，也是个很好的使用架构。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">Saveable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">accept</span><span class="p">(</span><span class="nv">visitor</span><span class="p">:</span> <span class="kt">SaveToCoreDataVisitor</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SaveToCoreDataVisitor</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">UserModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// map UserModel to coredata</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">SongModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// map SongModel to coredata</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">PlaylistModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// map PlaylistModel to coredata</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>其他应用：Save、Like、tableview/collectionview cellforrow….</p><h3 id="原则"><span class="me-2">原则</span><a href="#原则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>最后讲一下一些共通原则</p><ul><li><p>Code 是给人读的，切勿 Over Designed</p><li><p>统一很重要，同样的场境同个 Codebase 应该使用同个架构方法</p><li><p>如果范围是可控的或不可能出现其他状况，这时候如果还继续往下拆分就可以认为是 Over Designed</p><li><p>多应用、少发明；Design Pattern 已经在软体设计领域好几十年，他所考量到的场景一定比我们创造一个新的架构还来的完善</p><li><p>看不懂 Design Pattern 可以学，但如果是自己创造的架构就比较难说服别人学，因为学了可能也只能用在这个 Case 上，他就不是一个 Common sense</p><li><p>程式码重复不代表不好，如果一昧追求封装可能导致 Over Designed；一样回到前面几点，程式是给人读的，所以只要是好读加上低耦合高聚合都是好的 Code</p><li><p>勿魔改 Pattern，人家设计一定有他的道理，如果乱魔改可能导致某些场景出现问题</p><li><p>只要开始绕路就会越绕越远，程式会越来越脏</p></ul><blockquote><p><em>inspired by <a href="https://twitter.com/saiday" target="_blank">＠saiday</a></em></p></blockquote><h4 id="参考资料"><span class="me-2">参考资料</span><a href="#参考资料" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><a href="https://shirazian.wordpress.com/2016/04/22/design-patterns-in-swift-visitor/" target="_blank">Design Patterns in Swift: Visitor</a> (另一个使用 Visitor 的场景应用)</p><li><p><a href="https://github.com/kingreza/Swift-Visitor" target="_blank">https://github.com/kingreza/Swift-Visitor</a></p><li><p><a href="https://medium.com/@albertodebo/deep-linking-at-scale-on-ios-1dd8789c389f" target="_blank">Deep Linking at Scale on iOS</a> (State Pattern)</p></ul><h3 id="延伸阅读"><span class="me-2">延伸阅读</span><a href="#延伸阅读" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>Design Patterns 的实战应用纪录 — In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern</p><li><p><a href="/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/">Design Patterns 的实战应用纪录</a></p><li><p><a href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E6%8F%90%E5%8D%87-tableview-%E5%8F%AF%E6%89%A9%E5%85%85%E6%80%A7%E4%B8%8E%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7%E8%AE%BE%E8%AE%A1%E8%8C%83%E4%BE%8B-60473cb47550/">Visitor Pattern in TableView</a></p></ul><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/ba5773a7bfea" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2021-06-15-ba5773a7bfea.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/design-patterns/" class="post-tag no-text-decoration" >design-patterns</a> <a href="/tags/visitor-pattern/" class="post-tag no-text-decoration" >visitor-pattern</a> <a href="/tags/double-dispatch/" class="post-tag no-text-decoration" >double-dispatch</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Visitor%20Pattern%20%E5%9C%A8%20iOS%20Swift%20%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8%EF%BD%9C%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fvisitor-pattern-%25E5%259C%25A8-ios-swift-%25E5%2588%2586%25E4%25BA%25AB%25E5%258A%259F%25E8%2583%25BD%25E5%25BA%2594%25E7%2594%25A8-%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%25AE%259E%25E5%258A%25A1%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E6%259C%2580%25E4%25BD%25B3%25E6%259E%25B6%25E6%259E%2584%25E4%25BC%2598%25E5%258C%2596-ba5773a7bfea%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Visitor%20Pattern%20%E5%9C%A8%20iOS%20Swift%20%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8%EF%BD%9C%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fvisitor-pattern-%25E5%259C%25A8-ios-swift-%25E5%2588%2586%25E4%25BA%25AB%25E5%258A%259F%25E8%2583%25BD%25E5%25BA%2594%25E7%2594%25A8-%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%25AE%259E%25E5%258A%25A1%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E6%259C%2580%25E4%25BD%25B3%25E6%259E%25B6%25E6%259E%2584%25E4%25BC%2598%25E5%258C%2596-ba5773a7bfea%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fvisitor-pattern-%25E5%259C%25A8-ios-swift-%25E5%2588%2586%25E4%25BA%25AB%25E5%258A%259F%25E8%2583%25BD%25E5%25BA%2594%25E7%2594%25A8-%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%25AE%259E%25E5%258A%25A1%25E8%25A7%25A3%25E6%259E%2590%25E4%25B8%258E%25E6%259C%2580%25E4%25BD%25B3%25E6%259E%25B6%25E6%259E%2584%25E4%25BC%2598%25E5%258C%2596-ba5773a7bfea%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/japan-overseas-shopping-rakuten-consolidated-shipping-for-taiwan-buy-from-rakuten-amazon-bea62c251f1b/">Japan Overseas Shopping｜Rakuten Consolidated Shipping for Taiwan｜Buy from Rakuten & Amazon</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/%E6%97%A5%E6%9C%AC%E4%B9%90%E5%A4%A9%E9%9B%86%E8%BF%90%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E8%B4%AD%E4%B9%B0horie%E9%92%9B%E6%9D%AF%E4%B8%8Eamazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E6%B9%BE%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外购物寄送台湾教学 — 使用乐天集运购买乐天拍卖与 Amazon 商品 (Horie 钛杯)</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/%E6%97%A5%E6%9C%AC%E6%A8%82%E5%A4%A9%E9%9B%86%E9%81%8B%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E8%B3%BC%E8%B2%B7horie%E9%88%A6%E6%9D%AF%E8%88%87amazon%E5%95%86%E5%93%81%E5%AF%84%E9%80%81%E5%8F%B0%E7%81%A3%E5%85%A8%E6%94%BB%E7%95%A5-bea62c251f1b/">日本海外購物寄送台灣教學 — 使用樂天集運購買樂天拍賣與 Amazon 商品 (Horie 鈦杯)</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%87%89%E7%94%A8-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E5%8B%99%E8%A7%A3%E6%9E%90%E8%88%87%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%A7%8B%E5%84%AA%E5%8C%96-ba5773a7bfea/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1623772716" data-df="ll" > Jun 15, 2021 </time><h4 class="pt-0 my-2">Visitor Pattern in iOS (Swift)</h4><div class="text-muted"><p>Design Pattern Visitor 在 iOS 開發的實際應用場景分析</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-design-pattern-practical-applications-ba5773a7bfea/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1623772716" data-df="ll" > Jun 15, 2021 </time><h4 class="pt-0 my-2">Visitor Pattern in iOS｜Swift Design Pattern Practical Applications</h4><div class="text-muted"><p>Explore how the Visitor Pattern solves complex object structure traversal in iOS Swift development, enhancing code maintainability and scalability with clear, real-world use cases and implementatio...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E6%8F%90%E5%8D%87-tableview-%E5%8F%AF%E6%89%A9%E5%85%85%E6%80%A7%E4%B8%8E%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7%E8%AE%BE%E8%AE%A1%E8%8C%83%E4%BE%8B-60473cb47550/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1657267110" data-df="ll" > Jul 8, 2022 </time><h4 class="pt-0 my-2">Visitor Pattern in TableView</h4><div class="text-muted"><p>使用 Visitor Pattern 增加 TableView 的阅读和扩充性</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/visitor-pattern-in-ios-swift-design-pattern-practical-applications-ba5773a7bfea/" class="btn btn-outline-primary" aria-label="Older" ><p>Visitor Pattern in iOS｜Swift Design Pattern Practical Applications</p></a> <a href="/posts/zrealm-dev/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%87%89%E7%94%A8-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E5%8B%99%E8%A7%A3%E6%9E%90%E8%88%87%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%A7%8B%E5%84%AA%E5%8C%96-ba5773a7bfea/" class="btn btn-outline-primary" aria-label="Newer" ><p>Visitor Pattern in iOS (Swift)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
