<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="针对缺乏动态 GUI 表单的 Github Action CI/CD，使用 Google Apps Script Web App 建立组织内专属表单，串接 Github API 自动取得分支并触发工作流程，并整合 Slack 通知与 Jira、Asana 工单查询，实现免维护、低成本的自动化打包工具。" /><meta property="og:description" content="针对缺乏动态 GUI 表单的 Github Action CI/CD，使用 Google Apps Script Web App 建立组织内专属表单，串接 Github API 自动取得分支并触发工作流程，并整合 Slack 通知与 Jira、Asana 工单查询，实现免维护、低成本的自动化打包工具。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-11T19:19:43+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" /><meta property="twitter:title" content="Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2025-07-10T21:02:57+08:00","datePublished":"2025-01-11T19:19:43+08:00","description":"针对缺乏动态 GUI 表单的 Github Action CI/CD，使用 Google Apps Script Web App 建立组织内专属表单，串接 Github API 自动取得分支并触发工作流程，并整合 Slack 通知与 Jira、Asana 工单查询，实现免维护、低成本的自动化打包工具。","headline":"Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/"},"url":"https://zhgchg.li/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/"}</script><title>Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率</h1><p class="post-desc fw-light mb-4">针对缺乏动态 GUI 表单的 Github Action CI/CD，使用 Google Apps Script Web App 建立组织内专属表单，串接 Github API 自动取得分支并触发工作流程，并整合 Slack 通知与 Jira、Asana 工单查询，实现免维护、低成本的自动化打包工具。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1736594383" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 11, 2025 </time> </span> <span> Updated <time data-ts="1752152577" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 10, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" class="popup img-link preview-img blur"><img data-src="/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="5541 words" > <em>30 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Google Apps Script Web App｜打造 Github Action CI/CD 自订表单提升开发效率</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>基于 SEO 考量，本文标题与描述经 AI 调整，原始版本请参考内文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目录</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li><a href="#使用-google-apps-script-web-app-表单串接-github-action-cicd-工作">使用 Google Apps Script Web App 表单串接 Github Action CI/CD 工作</a></li><li><a href="#202507-update">2025/07 Update</a></li><li class="has-children"><details><summary>背景 <a href="#背景">#</a></summary><ul><li><a href="#问题github-action-cicd-gui-form">问题：Github Action CI/CD GUI Form</a></li><li><a href="#自建-slack-app-解决">自建 Slack App 解决</a></li><li><a href="#自己写-webiosmacos-app-工具">自己写 Web/iOS/macOS App 工具</a></li><li><a href="#-private-github-pages">❌ Private Github Pages</a></li><li><a href="#-slack-app但使用-google-apps-script-建置">❌ Slack App，但使用 Google Apps Script 建置</a></li><li><a href="#-slack-workflow-form">❌ Slack Workflow Form</a></li></ul></details></li><li class="has-children"><details><summary>✅ Google Apps Script Web App GUI Form 表单 <a href="#-google-apps-script-web-app-gui-form-表单">#</a></summary><ul><li><a href="#最终成果-">最终成果 🎉</a></li><li><a href="#工作流程">工作流程</a></li><li><a href="#step-1-建立-google-apps-script-web-app-form">Step 1. 建立 Google Apps Script Web App Form</a></li><li><a href="#step-2-建立表单内容gas-程式">Step 2. 建立表单内容、GAS 程式</a></li><li><a href="#step-2-部署-google-apps-script-web-app-form">Step 2. 部署 Google Apps Script Web App Form</a></li><li><a href="#google-apps-script-授权警告">Google Apps Script 授权警告</a></li><li><a href="#step-3-串接-github-api-取得-pr-分支列表">Step 3. 串接 Github API 取得 PR 分支列表</a></li><li><a href="#gas-x-github-api-x-github-action">GAS x Github API x Github Action</a></li><li><a href="#step-4-重新部署-google-apps-script-web-app-form">Step 4. 重新部署 Google Apps Script Web App Form</a></li></ul></details></li><li class="has-children"><details><summary>Done! 🎉🎉🎉 <a href="#done-">#</a></summary><ul><li><a href="#延伸-1-用使用者的信箱查询-slack-user-id--发送更新进度通知">延伸 (1)— 用使用者的信箱查询 Slack User ID & 发送、更新进度通知</a></li><li><a href="#延伸-2-查询-jira-工单">延伸 (2) —查询 Jira 工单</a></li><li><a href="#延伸-3--查询-asana-工单">延伸 (3) — 查询 Asana 工单</a></li></ul></details></li><li><a href="#总结">总结</a></li><li><a href="#202507-update-1">2025/07 Update</a></li></ul></nav><hr /><h3 id="使用-google-apps-script-web-app-表单串接-github-action-cicd-工作"><span class="me-2">使用 Google Apps Script Web App 表单串接 Github Action CI/CD 工作</span><a href="#使用-google-apps-script-web-app-表单串接-github-action-cicd-工作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Github Action Workflow 表单优化与整合其他工作流程工具(Jira, Asana, Slack. . )提升开发效率。</p><p><a href="/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*TiGXBQdPaCM6r2J1RHrgnA.webp" alt="左：原始的 Github Action Workflow Form 右： [最终成果 (GAS Web App Form)](https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjIyIiBoZWlnaHQ9IjY5MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>左：原始的 Github Action Workflow Form / 右： <a href="https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec" target="_blank">最终成果 (GAS Web App Form)</a></p><h3 id="202507-update"><span class="me-2">2025/07 Update:</span><a href="#202507-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>此功能已整合到实际打包工具使用，可参考最新文章案例：「 <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9B%A2%E9%98%9F%E6%95%88%E7%8E%87-4273e57e7148/"><strong>CI/CD 实战指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免费易用的打包工具平台</strong></a> 」</p><h3 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>之前的团队使用 Github Action &amp; Self-hosted Github Runner + Slack 搭建整套 CI/CD 服务；整体效果不错，对于 App 开发者来说建置与维护相对容易，只需照著官方文件提供的 YAML 参数完成设定就会自动触发、机器方面也可以轻易的使用自己的机器当成 Runner 使用，服务本身都是由 Github 维护，我们不需在意版本升级等问题并且 Runner 是反向跟 Github 要任务下来做，不需要特别开对外网路开口；对团队更好的事是，使用自己的 Runner 跑 Github Action 是完全免费的。</p><blockquote><p><em>等于同时享受到类似 Bitrise 的 GUI YAML 建置方式又有像 Jenkins 那样使用自架机器的弹性跟较低的建置成本，但不用像 Jenkins 那样需要花时间维护服务本身。</em></p></blockquote><blockquote><p><strong>未来有时间再写一篇完整的 App CI/CD x Github Action 搭建过程。</strong></p></blockquote><h4 id="问题github-action-cicd-gui-form"><span class="me-2">问题：Github Action CI/CD GUI Form</span><a href="#问题github-action-cicd-gui-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4cb4437818f2/1*55tCLFvuHtTyyvSLSv1vMA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*55tCLFvuHtTyyvSLSv1vMA.webp" alt="Github Action GUI Form" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDYiIGhlaWdodD0iNDk5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Github Action GUI Form</p><blockquote><p><em>在 App 开发中，在 CD 触发打包测试版、正式版或送审时通常会需要提供一些外部参数或是依照需求选择环境、分支，才会开始执行工作。</em></p></blockquote><p>不同于 Jenkins 是自建服务，有完整的 Web GUI；Github Action 没有，唯一的 Web GUI Form 是在 Actions 中点击 Run workflow 可以自订一个简易的表单供使用者输入外部参数，然后触发 CI/CD 工作流程。</p><p>通常会使用这个 CD 打包的使用者，不一定是 App 开发者本身、也不一定拥有这个专案的权限；例如 QA 需要打包指定版本、PM/Backend 需要打包某个开发中版本进行测试；Github Action Form 需要有该专案的权限才能使用，但使用者不要说能不能有专案权限、甚至是不一定有工程背景。</p><p><strong>而且我们无法在这边做动态表单或资料验证。</strong></p><blockquote><p><em>因此我们需要另外拉一个 GUI 服务给其他使用者操作使用。</em></p></blockquote><h4 id="自建-slack-app-解决"><span class="me-2">自建 Slack App 解决</span><a href="#自建-slack-app-解决" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>之前团队是有热爱做自动化的同仁自己用 Kotlin+Ktor 搭建了一个完整的 Slack App 网路服务，串接 Slack 讯息、表单、指令…等功能，接收、转发 CD 打包请求，触发 Github Action 执行操作并将结果串回 Slack。</p><blockquote><p><em>目前没有开发资源跟之前一样使用 Kotlin+Ktor 建置服务</em></p></blockquote><h4 id="自己写-webiosmacos-app-工具"><span class="me-2">自己写 Web/iOS/macOS App 工具</span><a href="#自己写-webiosmacos-app-工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>目前团队原本是使用 Jenkins 有基础的 Web 可以给其他使用者登入使用、另外还有自行开发了一个 App 串接 Jenkins 封装一些参数让非工程背景的使用者更方便使用。</p><blockquote><p><strong><em>不过迁移到 Github Action 之后这整套就废弃了。</em></strong></p></blockquote><h4 id="-private-github-pages"><span class="me-2">❌ Private Github Pages</span><a href="#-private-github-pages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>应该有机会直接建置 Github Pages 来当 CI/CD Web GUI，但是目前只有 Github <a href="https://docs.github.com/en/enterprise-server@3.13/admin/configuration/configuring-your-enterprise/configuring-github-pages-for-your-enterprise#enabling-public-sites-for-github-pages" target="_blank">Enterprise</a> 可以设定 Github Pages 存取权限，其他方案就算是 Private Repo 也会是公开的；无安全性可言。</p><h4 id="-slack-app但使用-google-apps-script-建置"><span class="me-2">❌ Slack App，但使用 Google Apps Script 建置</span><a href="#-slack-app但使用-google-apps-script-建置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>一开始想说依照之前团队的经验使用 Slack App 做为 CI/CD GUI Form 服务，但是目前没有资源跟之前一样使用 Kotlin+Ktor 建置服务；所以想说先使用 Function as a Service 服务快速尝试建置。</p><p>Function as a Service 有很多种， <a href="https://cloud.google.com/functions?hl=zh-tw" target="_blank">Cloud Functions</a> 的自由度比较高，但由于组织 IT 限制，无法随意新增 Public Cloud Functions 并且有收费问题；因此还是回到我们的老朋友 — Google Apps Script。</p><blockquote><p><em>之前写过好几篇关于 Google Apps Script 做自动化的文章，有兴趣的朋友可以参考：</em></p></blockquote><blockquote><p><em>1. <strong>「 <a href="/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/">使用 Google Apps Script 实现每日数据报表 RPA 自动化</a> 」</strong></em></p></blockquote><blockquote><p><em>2. 「 <a href="https://medium.com/zrealm-robotic-process-automation/%E7%B0%A1%E5%96%AE-3-%E6%AD%A5%E9%A9%9F-%E6%89%93%E9%80%A0%E5%85%8D%E8%B2%BB-ga4-%E8%87%AA%E5%8B%95%E6%95%B8%E6%93%9A%E9%80%9A%E7%9F%A5%E6%A9%9F%E5%99%A8%E4%BA%BA-1e85b8df2348?source=collection_home---6------1-----------------------" target="_blank">简单 3 步骤 — 打造免费 GA4 自动数据通知机器人</a> 」</em></p></blockquote><blockquote><p><em>3. 「 <a href="https://medium.com/zrealm-robotic-process-automation/crashlytics-google-analytics-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2-app-crash-free-users-rate-793cb8f89b72?source=collection_home---6------8-----------------------" target="_blank">Crashlytics + Google Analytics 自动查询 App Crash-Free Users Rate</a> 」</em></p></blockquote><blockquote><p><em>4. 「 <a href="https://medium.com/zrealm-robotic-process-automation/crashlytics-big-query-%E6%89%93%E9%80%A0%E6%9B%B4%E5%8D%B3%E6%99%82%E4%BE%BF%E5%88%A9%E7%9A%84-crash-%E8%BF%BD%E8%B9%A4%E5%B7%A5%E5%85%B7-e77b80cc6f89?source=collection_home---6------9-----------------------" target="_blank">Crashlytics + Big Query 打造更即时便利的 Crash 追踪工具</a> 」</em></p></blockquote><p>总而言之，Google Apps Script 是 Google 另一个 Function as a Service 服务，主要特色是免费跟与 Google 服务之间可以快速整合；但是限制也较多，例如只能用它的语言、执行时间不能超过 6 分钟、有执行次数上限、不支援多执行绪…等等，细节可以参考 <a href="/posts/zrealm-robotic-process-automation/zh-cn/google-apps-script-%E6%89%93%E9%80%A0%E6%AF%8F%E6%97%A5%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96-rpa-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-google-analytics-%E4%B8%8E-google-sheet-f6713ba3fee3/">我之前的文章</a> 。</p><p>结论是不可行，原因是：</p><ul><li><p><a href="https://www.cloudflare.com/zh-tw/learning/serverless/what-is-serverless/" target="_blank">Function as a Service 冷启动问题</a> 。 服务一段时间没呼叫会进入睡眠，再次呼叫要花较长时间启动(3~≥ 5 秒)； <strong>Slack App 对于 API 响应时间非常严格，服务需要在 3 秒内回应否则视为失败</strong> ，Slack 这边就会直接喷错误、事件监听也会被认为丢失，导致重复发送。</p><li><p><strong>Google Apps Script doGet, doPost 方法无法取得 Headers。</strong> <strong>这会导致无法走 <a href="https://api.slack.com/authentication/verifying-requests-from-slack" target="_blank">官方的安全验证</a> 、无法关闭 <a href="https://api.slack.com/authentication/verifying-requests-from-slack" target="_blank">Slack Retry</a> 。</strong></p><li><p>Google Apps Script 单执行绪问题。 如果要串接其他服务响应时间都会超过 3 秒，直接被 Slack 判定为失败。</p></ul><p>有勉强使用 Slack 讯息、Block Kit、Form 串接完整个流程，但是太容易触发上述问题，后来直接放弃。</p><blockquote><p><strong><em>如果要做这套还是要走自己起伺服器、服务，不要走 Function as a Service! !</em></strong></p></blockquote><h4 id="-slack-workflow-form"><span class="me-2">❌ Slack Workflow Form</span><a href="#-slack-workflow-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4cb4437818f2/1*KWBMdFswvl1KPdnTLStzhQ.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*KWBMdFswvl1KPdnTLStzhQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM2IiBoZWlnaHQ9IjgxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/4cb4437818f2/1*hnDPyOfGCTW_yJf71krMnA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*hnDPyOfGCTW_yJf71krMnA.webp" alt="[Slack Workflow Form](https://slack.com/intl/zh-tw/help/articles/24720245025555-%E8%87%AA%E5%8B%95%E5%8C%96%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%B0%A1%E6%98%93%E8%A1%A8%E5%96%AE%E6%94%B6%E9%9B%86%E8%B3%87%E8%A8%8A){:target=&quot;_blank&quot;} (❌ 无法客制化)" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTkiIGhlaWdodD0iNDU4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://slack.com/intl/zh-tw/help/articles/24720245025555-%E8%87%AA%E5%8B%95%E5%8C%96%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%B0%A1%E6%98%93%E8%A1%A8%E5%96%AE%E6%94%B6%E9%9B%86%E8%B3%87%E8%A8%8A" target="_blank">Slack Workflow Form</a> (❌ 无法客制化)</p><p>另外也尝试过 Slack 内建的自动化功能 Workflow Form，不过他无法做到动态表单内容 (e.g. 捞分支让使用者选)，唯一能客制化的只有后续送资料的步骤。</p><h3 id="-google-apps-script-web-app-gui-form-表单"><span class="me-2">✅ Google Apps Script Web App GUI Form 表单</span><a href="#-google-apps-script-web-app-gui-form-表单" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>山不转路转，转念一想好像也不用纠结在一定要用 Slack 整合上，用 Slack 整合是最好的方案，因为是直接整进既有的团队协作工具，不需要发散额外去学新工具；但是迫于资源限制，我们只能退而求其次找其他稳定又好用的方法。</p><blockquote><p><em>回头想到 Google Apps Script 本身就能部署成 Web App，可以在 Web doGet 时回应 GUI Form 表单，送出表单后触发后续的 Github 串接处理。</em></p></blockquote><h4 id="最终成果-"><span class="me-2">最终成果 🎉</span><a href="#最终成果-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4cb4437818f2/1*pzW-Yki-4HbE2nYXC4q-Aw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*pzW-Yki-4HbE2nYXC4q-Aw.webp" alt="[Demo Web App Form](https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTMiIGhlaWdodD0iNjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec" target="_blank">Demo Web App Form</a></p><h4 id="工作流程"><span class="me-2"><strong>工作流程</strong></span><a href="#工作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们使用 Google Apps Script Web App 建置 CI/CD 表单，直接绑定 Google Workspace 帐号，设定只有组织内的使用者可以存取；自动获取当前登入的使用者信箱、使用 Github Repo 共用帐号(或借用某个有权限的帐号)的 Personal Access Token 打 Github API 获得分支列表，送出后同样打 API 触发 Github Action 开始执行 CI/CD 工作。</p><p>另外，我们可以用使用者的信箱透过 Slack App 去打 Slack API，取得该使用者的 Slack ID，再透过 Slack App 传送讯息，通知 CI/CD 任务执行情况。</p><p>也可以再与其他工具、开发流程进行整合，例如先从 Asana, Jira 取得工单，选择后再透过 Github API 查找分支、触发 Github Action，最后再透过 Slack 通知给使用者。</p><h4 id="step-1-建立-google-apps-script-web-app-form"><span class="me-2">Step 1. 建立 Google Apps Script Web App Form</span><a href="#step-1-建立-google-apps-script-web-app-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前往 &gt; <a href="https://script.google.com/home" target="_blank">Google Apps Script</a> ，新增专案。</p><p><a href="/assets/4cb4437818f2/1*T3if7Dfo0iJaa4N5VZyA1Q.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*T3if7Dfo0iJaa4N5VZyA1Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjgiIGhlaWdodD0iMzcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="step-2-建立表单内容gas-程式"><span class="me-2">Step 2. 建立表单内容、GAS 程式</span><a href="#step-2-建立表单内容gas-程式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>太久没有写 HTML,CSS 也懒得自己设计样式，直接请 ChatGPT 产一个有一点设计的 HTML 表单范本。</p><p><a href="/assets/4cb4437818f2/1*IPv0afE5FAFj40F22s8Umg.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*IPv0afE5FAFj40F22s8Umg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzE2IiBoZWlnaHQ9IjExMzkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/4cb4437818f2/1*F_HrfV_k16g_ojm1WIDDuA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*F_HrfV_k16g_ojm1WIDDuA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NzgiIGhlaWdodD0iNjA4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>在 GAS 左方档案列表点「+」新增档案，输入档案名称「 <code class="language-plaintext highlighter-rouge">Form.html</code> 」并把 GPT 产的 HTML 表单范本内容贴上。</p><p><code class="language-plaintext highlighter-rouge">Form.html：</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
</pre><td class="rouge-code"><pre><span class="c">&lt;!--HTML &amp; Style Gen by ChatGPT 4o--&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?=title?&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;style&gt;</span>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f7f7f7;
    }
    .form-container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .form-container h2 {
      margin-bottom: 20px;
      color: #333333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555555;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 95%;
      padding: 10px;
      border: 1px solid #cccccc;
      border-radius: 4px;
      font-size: 16px;
    }
    .form-group input[type="radio"] {
      width: auto;
      margin-right: 10px;
    }
    .form-group .radio-label {
      display: inline-block;
      margin-right: 20px;
    }
    .form-group button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .form-group button:hover {
      background-color: #45a049;
    }
    .message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      font-size: 1em;
      text-align: center;
    }
    .message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .hidden {
      display: none;
    }
  <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;?=title?&gt;</span><span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"myForm"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"message-block"</span> <span class="na">class=</span><span class="s">"hidden"</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">&gt;</span>电子邮件：<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"&lt;?=email?&gt;"</span> <span class="err">readonly</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"buildNumber"</span><span class="nt">&gt;</span>版本号：<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">value=</span><span class="s">"&lt;?=buildNumber?&gt;"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"branch"</span><span class="nt">&gt;</span>Review 中的 PR：<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"branch"</span> <span class="na">name=</span><span class="s">"branch"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;option&gt;</span>请选择<span class="nt">&lt;/option&gt;</span>
          <span class="cp">&lt;? pullRequests.forEach(pullRequest =&gt; { ?&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"&lt;?=pullRequest.head.ref?&gt;"</span><span class="nt">&gt;</span>[<span class="cp">&lt;?=pullRequest.state?&gt;</span>] <span class="cp">&lt;?=pullRequest.title?&gt;</span><span class="nt">&lt;/option&gt;</span>
          <span class="cp">&lt;? }); ?&gt;</span>
        <span class="nt">&lt;/select&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"message"</span><span class="nt">&gt;</span>更新内容：<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"message"</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">rows=</span><span class="s">"4"</span> <span class="na">placeholder=</span><span class="s">"请输入您的讯息"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>送出<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    function displayMessage(ok, message) {
      const messageBlock = document.getElementById('message-block');
      messageBlock.className = ok ? 'message success' : 'message error';
      messageBlock.innerHTML = message;
      messageBlock.classList.remove('hidden');
    }
    
    document.getElementById("myForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const formObject = Object.fromEntries(formData);
      google.script.run.withSuccessHandler((response) =&gt; {
        displayMessage(response.ok, response.message);
      }).processForm(formObject);
    });
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>表单内容可依照需求自行调整。</p><p><code class="language-plaintext highlighter-rouge">程式码.gs：</code></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 对应到左方档案 Form.html</span>
  <span class="kd">const</span> <span class="nx">htmlTemplate</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">Form</span><span class="dl">'</span><span class="p">);</span>
  
  <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">Session</span><span class="p">.</span><span class="nf">getActiveUser</span><span class="p">().</span><span class="nf">getEmail</span><span class="p">();</span>
  <span class="c1">// 取得使用者信箱，只限 执行身份：存取网页程式的使用者 设定有效</span>
  
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">App CD 打包请求表单</span><span class="dl">"</span><span class="p">;</span>
  
  <span class="kd">const</span> <span class="nx">buildNumber</span> <span class="o">=</span> <span class="nf">genBuildNumber</span><span class="p">();</span>

  <span class="nx">htmlTemplate</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">email</span><span class="p">;</span>
  <span class="nx">htmlTemplate</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
  <span class="nx">htmlTemplate</span><span class="p">.</span><span class="nx">pullRequests</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 下一步在串接 Github...</span>
  <span class="nx">htmlTemplate</span><span class="p">.</span><span class="nx">buildNumber</span> <span class="o">=</span> <span class="nx">buildNumber</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">htmlTemplate</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">();</span>
  <span class="nx">html</span><span class="p">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
  <span class="c1">//html.setWidth(600) // 设定页面宽度</span>

  <span class="k">return</span> <span class="nx">html</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">processForm</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span><span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">请求送出成功！</span><span class="dl">"</span><span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">genBuildNumber</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">formattedDate</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="nx">now</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Asia/Taipei</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">yyyyMMddHHmmss</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">milliseconds</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nf">getMilliseconds</span><span class="p">().</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 确保毫秒是 3 位数</span>
  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">formattedDate</span><span class="p">}${</span><span class="nx">milliseconds</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span> 
<span class="p">}</span>
</pre></table></code></div></div><p>这一步，我们先把表单 GUI 完成，下一步再来串接 Github API 拿到 PR 分支列表。</p><p><a href="/assets/4cb4437818f2/1*RN9ftVBdgCA-IL8ra9jvTg.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*RN9ftVBdgCA-IL8ra9jvTg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDkiIGhlaWdodD0iMzI0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="step-2-部署-google-apps-script-web-app-form"><span class="me-2">Step 2. 部署 Google Apps Script Web App Form</span><a href="#step-2-部署-google-apps-script-web-app-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们先把刚刚的内容部署一次，查看结果。</p><p>在 GAS 右上角选择「部署」-&gt; 「新增部署作业」-&gt;「网页应用程式」：</p><p><a href="/assets/4cb4437818f2/1*ouVO18FtOcX8vdeGCEtwCw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*ouVO18FtOcX8vdeGCEtwCw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMzAiIGhlaWdodD0iMjE1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*4BuEtIA4H_-Q9WALonYxYg.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*4BuEtIA4H_-Q9WALonYxYg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOTYiIGhlaWdodD0iMzAyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*JagpVPTGD-W0lhIJ5nrRew.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*JagpVPTGD-W0lhIJ5nrRew.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjIiIGhlaWdodD0iNTk5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>执行身份跟谁可以存取分别可以设置成：</p><p><strong>执行身份：</strong></p><ul><li><p>我 <code class="language-plaintext highlighter-rouge">统一都用你的帐号身分执行脚本。</code></p><li><p>存取网页程式的使用者 <code class="language-plaintext highlighter-rouge">会以当前登入的 Google 帐号使用者身份执行脚本。</code></p></ul><p><strong>谁可以存取：</strong></p><ul><li><p>只有我自己</p><li><p><strong>XXX 同个组织中的所有使用者</strong> <code class="language-plaintext highlighter-rouge">只有同组织＋已登入的 Google 帐号使用者可以存取。</code></p><li><p>所有已登入 Google 帐号的使用者 <code class="language-plaintext highlighter-rouge">已登入的 Google 帐号使用者都可以存取。</code></p><li><p>所有人 <code class="language-plaintext highlighter-rouge">不需要登入 Google 帐号、所有人都可以公开存取。</code></p></ul><blockquote><p><em>我们选择「谁可以存取：XXX 同个组织中的所有使用者」＋「执行身份：存取网页程式的使用者」就能 <strong>自动限制只有组织帐号的人可以使用</strong> ，并且用他自己的身份执行！</em></p></blockquote><blockquote><p><em>是一个很方便权限控管的功能！</em></p></blockquote><p>选完点击右下「部署」。</p><p><a href="/assets/4cb4437818f2/1*dvyqYb5kcta402j3RUYJog.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*dvyqYb5kcta402j3RUYJog.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzAiIGhlaWdodD0iNjA1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>网页应用程式中的网址，就是 Web App 存取网址。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec
</pre></table></code></div></div><blockquote><p><em>网址很长很丑，但是没办法，只能自己找短网址工具缩短一下。</em></p></blockquote><p><strong>点网址打开页面查看效果：</strong></p><p><a href="/assets/4cb4437818f2/1*jbx4IO4DEhqYfwI_UTQk5Q.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*jbx4IO4DEhqYfwI_UTQk5Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDkiIGhlaWdodD0iNjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>这边要多提两个 GAS 限制：</strong></p><ul><li><p>GAS Web App 上方警告提示，预设无法隐藏</p><li><p>GAS Web App 是用 IFrame 把我们的页面嵌在里面，因此很难做到 100% RWD 效果 只能使用 <code class="language-plaintext highlighter-rouge">.setWidth()</code> 调整视窗宽度</p></ul><h4 id="google-apps-script-授权警告"><span class="me-2">Google Apps Script 授权警告</span><a href="#google-apps-script-授权警告" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>第一次使用</strong> 、点击「侦错」或「执行」可能会出下以下授权警告：</p><p><a href="/assets/4cb4437818f2/1*9q8KZGHER9vdtnbKVVQB9g.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*9q8KZGHER9vdtnbKVVQB9g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDEiIGhlaWdodD0iMTk2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*iWrkqMf8vkEGkiwkI1amIw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*iWrkqMf8vkEGkiwkI1amIw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjEiIGhlaWdodD0iNTAzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>选择想要执行的身份帐号，如果有出现「这个应用程式未经 Google 验证」则点击「进阶」-&gt;「前往 XXX (不安全)」，选择「允许」：</p><p><a href="/assets/4cb4437818f2/1*ucaqLxh-TOgJIaGyqqFd3A.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*ucaqLxh-TOgJIaGyqqFd3A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDQiIGhlaWdodD0iNTk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*l-tma_YICU24goKvZvl7Ww.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*l-tma_YICU24goKvZvl7Ww.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTMiIGhlaWdodD0iNDY4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*JAs_3__Qt2XeDcQiKEUNhg.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*JAs_3__Qt2XeDcQiKEUNhg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDQiIGhlaWdodD0iNzg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>如果 GAS 程式权限有变动(例如：多加存取 Google Sheet…etc)才会需要再重新授权，不然点过一次就不会再出现。</p><blockquote><p><em>如遇到：已封锁存取权「XXX」未完成 Google 验证程序， <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9B%A2%E9%98%9F%E6%95%88%E7%8E%87-4273e57e7148/">可参考我最新文章的 GCP 设定。</a></em></p></blockquote><h4 id="step-3-串接-github-api-取得-pr-分支列表"><span class="me-2">Step 3. 串接 Github API 取得 PR 分支列表</span><a href="#step-3-串接-github-api-取得-pr-分支列表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们新增一个 <code class="language-plaintext highlighter-rouge">Github.gs</code> 程式档案存放 Github API 相关逻辑。</p><p><code class="language-plaintext highlighter-rouge">Github.gs：</code></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
</pre><td class="rouge-code"><pre><span class="c1">// SECRET</span>
<span class="kd">const</span> <span class="nx">githubPersonalAccessToken</span> <span class="o">=</span> <span class="dl">""</span>
<span class="c1">// 使用你的 Github 帐号或组织共用的 Github 帐号创建 PAT</span>
<span class="c1">// https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens</span>

<span class="c1">// 方式 1: Restful API 存取</span>
<span class="kd">function</span> <span class="nf">githubAPI</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">payload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://api.github.com</span><span class="dl">"</span><span class="o">+</span><span class="nx">path</span><span class="p">;</span>  
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">Accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/vnd.github+json</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Authorization</span><span class="dl">"</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">githubPersonalAccessToken</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">X-GitHub-Api-Version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2022-11-28</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">().</span><span class="nf">trim</span><span class="p">()</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">payload</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 方式 2: GraphQL 存取</span>
<span class="c1">// Github API 部分更细的查询功能只有 GraphQL API 有提供</span>
<span class="c1">// https://docs.github.com/en/graphql</span>
<span class="kd">function</span> <span class="nf">githubGraphQL</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">variables</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://api.github.com/graphql</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">query</span><span class="p">:</span> <span class="nx">query</span><span class="p">,</span>
    <span class="na">variables</span><span class="p">:</span> <span class="nx">variables</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">Accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/vnd.github+json</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Authorization</span><span class="dl">"</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">githubPersonalAccessToken</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">X-GitHub-Api-Version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2022-11-28</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// GraphQL Example:</span>
<span class="c1">// const query = `</span>
<span class="c1">//   query($owner: String!, $repo: String!) {</span>
<span class="c1">//     repository(owner: $owner, name: $repo) {</span>
<span class="c1">//       pullRequests(states: OPEN, first: 100, orderBy: { field: CREATED_AT, direction: DESC }) {</span>
<span class="c1">//         nodes {</span>
<span class="c1">//           title</span>
<span class="c1">//           url</span>
<span class="c1">//           number</span>
<span class="c1">//           createdAt</span>
<span class="c1">//           author {</span>
<span class="c1">//             login</span>
<span class="c1">//           }</span>
<span class="c1">//           headRefName</span>
<span class="c1">//           baseRefName</span>
<span class="c1">//           body</span>
<span class="c1">//         }</span>
<span class="c1">//         pageInfo {</span>
<span class="c1">//           hasNextPage</span>
<span class="c1">//           endCursor</span>
<span class="c1">//         }</span>
<span class="c1">//       }</span>
<span class="c1">//     }</span>
<span class="c1">//   }</span>
<span class="c1">// `;</span>
<span class="c1">// const variables = {</span>
<span class="c1">//   owner: "swiftlang",</span>
<span class="c1">//   repo: "swift"</span>
<span class="c1">// };</span>
<span class="c1">// const response = githubGraphQL(query, variables);</span>
</pre></table></code></div></div><p>Github API 有两种存取方式，一种是传统的 Restful，另一种是更弹性的 GraphQL；本文以 Restful 为例。</p><p><code class="language-plaintext highlighter-rouge">程式码.gs：</code></p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="n">function</span> <span class="nf">doGet</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 对应到左方档案 Form.html</span>
  <span class="k">const</span> <span class="n">htmlTemplate</span> <span class="p">=</span> <span class="nc">HtmlService</span><span class="p">.</span><span class="nf">createTemplateFromFile</span><span class="p">(</span><span class="err">'</span><span class="nc">Form</span><span class="err">'</span><span class="p">);</span>
  
  <span class="k">const</span> <span class="n">email</span> <span class="p">=</span> <span class="nc">Session</span><span class="p">.</span><span class="nf">getActiveUser</span><span class="p">().</span><span class="nf">getEmail</span><span class="p">();</span>
  <span class="c1">// 取得使用者信箱，只限 执行身份：存取网页程式的使用者 设定有效</span>

  <span class="k">const</span> <span class="n">title</span> <span class="p">=</span> <span class="s">"App CD 打包请求表单"</span><span class="p">;</span>
  
  <span class="k">const</span> <span class="n">pullRequests</span> <span class="p">=</span> <span class="nf">githubAPI</span><span class="p">(</span><span class="s">"get"</span><span class="p">,</span> <span class="s">"/repos/swiftlang/swift/pulls"</span><span class="p">);</span>
  <span class="c1">// 以 https://github.com/swiftlang/swift/pulls 为例</span>
  
  <span class="k">const</span> <span class="n">buildNumber</span> <span class="p">=</span> <span class="nf">genBuildNumber</span><span class="p">();</span>

  <span class="n">htmlTemplate</span><span class="p">.</span><span class="n">email</span> <span class="p">=</span> <span class="n">email</span><span class="p">;</span>
  <span class="n">htmlTemplate</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">title</span><span class="p">;</span>
  <span class="n">htmlTemplate</span><span class="p">.</span><span class="n">pullRequests</span> <span class="p">=</span> <span class="n">pullRequests</span><span class="p">;</span>
  <span class="n">htmlTemplate</span><span class="p">.</span><span class="n">buildNumber</span> <span class="p">=</span> <span class="n">buildNumber</span><span class="p">;</span>

  <span class="k">const</span> <span class="n">html</span> <span class="p">=</span> <span class="n">htmlTemplate</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">();</span>
  <span class="n">html</span><span class="p">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
  <span class="c1">//html.setWidth(600) // 设定页面宽度</span>

  <span class="k">return</span> <span class="n">html</span>
<span class="p">}</span>

<span class="n">function</span> <span class="nf">processForm</span><span class="p">(</span><span class="k">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">buildNumber</span> <span class="p">==</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"ok"</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="s">"message"</span><span class="p">:</span> <span class="s">"请输入版本号！"</span><span class="p">};</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">branch</span> <span class="p">==</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"ok"</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="s">"message"</span><span class="p">:</span> <span class="s">"请选择分支版本！"</span><span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 带上你要带到 Github Action 的参数</span>
  <span class="k">const</span> <span class="n">payload</span> <span class="p">=</span> <span class="p">{</span>
    <span class="n">ref</span><span class="p">:</span> <span class="k">object</span><span class="p">.</span><span class="n">branch</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">buildNumber</span><span class="p">:</span> <span class="k">object</span><span class="p">.</span><span class="n">buildNumber</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="c1">//  </span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">response</span> <span class="p">=</span> <span class="nf">githubAPI</span><span class="p">(</span><span class="s">"post"</span><span class="p">,</span> <span class="s">"/repos/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/actions/workflows/CD-Job.yml/dispatches"</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
    <span class="c1">// 以 https://github.com/zhgchgli0718/ios-project-for-github-action-ci-cd-demo/blob/main/.github/workflows/CD-Job.yml 为例</span>

    <span class="k">return</span> <span class="p">{</span><span class="s">"ok"</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span> <span class="s">"message"</span><span class="p">:</span> <span class="err">`打包请求发送成功</span><span class="p">!&lt;</span><span class="n">br</span><span class="p">/&gt;</span><span class="err">对应分支：</span><span class="p">&lt;</span><span class="n">strong</span><span class="p">&gt;</span><span class="err">$</span><span class="p">{</span><span class="k">object</span><span class="p">.</span><span class="n">branch</span><span class="p">}&lt;/</span><span class="n">strong</span><span class="p">&gt;&lt;</span><span class="n">br</span><span class="p">/&gt;</span><span class="err">版号：</span><span class="p">&lt;</span><span class="n">strong</span><span class="p">&gt;</span><span class="err">$</span><span class="p">{</span><span class="k">object</span><span class="p">.</span><span class="n">buildNumber</span><span class="p">}&lt;/</span><span class="n">strong</span><span class="p">&gt;</span><span class="err">`</span><span class="p">};</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"ok"</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="s">"message"</span><span class="p">:</span> <span class="s">"发生错误："</span><span class="p">+</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">processForm</code> 方法中处理表单回传的内容，也可以多加上更多吃</p><h4 id="gas-x-github-api-x-github-action"><span class="me-2">GAS x Github API x Github Action</span><a href="#gas-x-github-api-x-github-action" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>这边多补充一下对应到的 Github Action。</p><p><code class="language-plaintext highlighter-rouge">CD-Job.yml：</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1"># CD 打包工作</span>

<span class="na">name</span><span class="pi">:</span> <span class="s">CD-Job</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">buildNumber</span><span class="pi">:</span> <span class="c1"># 对应 GAS payload.inpus.xxx</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">版本号码'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># ...More</span>
      <span class="c1"># Inputs 类型可参考官方文件：https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#onworkflow_dispatchinputs</span>
      
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">some-job</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Print Inputs</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">\\|</span>
          <span class="s">echo "Release Build Number</span><span class="err">:</span> <span class="s">${{ github.event.inputs.buildNumber }}"</span>    
</pre></table></code></div></div><h4 id="step-4-重新部署-google-apps-script-web-app-form"><span class="me-2">Step 4. 重新部署 Google Apps Script Web App Form</span><a href="#step-4-重新部署-google-apps-script-web-app-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><p>GAS 右上角选择「部署」-&gt; 选择右上角「编辑」-&gt; 版本选择「建立新版本」</p><p><a href="/assets/4cb4437818f2/1*ZMAB_m6HmsSsGSqqfZiRpA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*ZMAB_m6HmsSsGSqqfZiRpA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDgiIGhlaWdodD0iMjM4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*rUWlfzASAaeXcXUh4LavZw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*rUWlfzASAaeXcXUh4LavZw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzYiIGhlaWdodD0iNjE5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*HAr5TZtpnQeG-Ril0Rjf-g.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*HAr5TZtpnQeG-Ril0Rjf-g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3ODIiIGhlaWdodD0iNjEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>点击「部署」-&gt; 完成。</p><p><a href="/assets/4cb4437818f2/1*z6lw7R8ivUseSzR4IZgPdg.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*z6lw7R8ivUseSzR4IZgPdg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzciIGhlaWdodD0iNjExIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*eTdgKGQ1lRM7sCRXQgZ-DA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*eTdgKGQ1lRM7sCRXQgZ-DA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NzAiIGhlaWdodD0iNjEwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>再回到网页上重新整理，就能看到修改后的结果了：</strong></p><p><a href="/assets/4cb4437818f2/1*iI49OJC1uTyMEgzGTBowxQ.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*iI49OJC1uTyMEgzGTBowxQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTciIGhlaWdodD0iNTgzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><blockquote><p><strong><em>⚠️请注意，GAS 程式码的任何调整都需要重新部署，才会生效。⚠️</em></strong></p></blockquote><h3 id="done-"><span class="me-2">Done! 🎉🎉🎉</span><a href="#done-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/4cb4437818f2/1*pzW-Yki-4HbE2nYXC4q-Aw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*pzW-Yki-4HbE2nYXC4q-Aw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTMiIGhlaWdodD0iNjcyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4cb4437818f2/1*9aaNeemezNPRlSgbLFrseA.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*9aaNeemezNPRlSgbLFrseA.webp" alt="[Demo Web App Form](https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDgiIGhlaWdodD0iNjI4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://script.google.com/macros/s/AKfycbw8SuK7lLLMdY86y3jxMJyzXqa5tdxJryRnteOnNi-lK--j6CmKYXj7UuU58DiS0NSVvA/exec" target="_blank">Demo Web App Form</a></p><p>现在你可以在组织内分享这个连结给其他伙伴，他们可以直接使用这个网页 GUI 执行 CI/CD 工作。</p><h4 id="延伸-1-用使用者的信箱查询-slack-user-id--发送更新进度通知"><span class="me-2">延伸 (1)— 用使用者的信箱查询 Slack User ID &amp; 发送、更新进度通知</span><a href="#延伸-1-用使用者的信箱查询-slack-user-id--发送更新进度通知" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前文有提到，我们希望及时通知使用者 CI/CD 执行状况，我们可以使用使用者提供的信箱去查 Slack User ID。</p><p><code class="language-plaintext highlighter-rouge">Slack.gs：</code></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">slackBotToken</span> <span class="o">=</span> <span class="dl">""</span>
<span class="c1">// https://medium.com/zrealm-robotic-process-automation/slack-chatgpt-integration-bd94cc88f9c9</span>

<span class="kd">function</span> <span class="nf">slackRequest</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">slackBotToken</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="c1">// Use the bot token for authorization,</span>
      <span class="dl">'</span><span class="s1">X-Slack-No-Retry</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://slack.com/api/</span><span class="dl">"</span><span class="o">+</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">responseData</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">responseData</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">responseData</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="s2">`Slack: </span><span class="p">${</span><span class="nx">responseData</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 用信箱查询 Slask UID</span>
<span class="kd">function</span> <span class="nf">getSlackUserId</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">slackRequest</span><span class="p">(</span><span class="s2">`users.lookupByEmail?email=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">email</span><span class="p">)}</span><span class="s2">`</span><span class="p">)?.</span><span class="nx">user</span><span class="p">?.</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 发送讯息给目标 Slack UID (channelID)</span>
<span class="kd">function</span> <span class="nf">sendSlackMessage</span><span class="p">(</span><span class="nx">channelId</span><span class="p">,</span> <span class="nx">ts</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>  <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">channel</span><span class="p">:</span> <span class="nx">channelId</span>
  <span class="p">};</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">ts</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">thread_ts</span> <span class="o">=</span> <span class="nx">ts</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nf">slackRequest</span><span class="p">(</span><span class="dl">"</span><span class="s2">chat.postMessage</span><span class="dl">"</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 更新发送的讯息内容</span>
<span class="kd">function</span> <span class="nf">updateSlackMessage</span><span class="p">(</span><span class="nx">channelId</span><span class="p">,</span> <span class="nx">ts</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>  <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">channel</span><span class="p">:</span> <span class="nx">channelId</span>
  <span class="p">};</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">ts</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">ts</span> <span class="o">=</span> <span class="nx">ts</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">content</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nf">slackRequest</span><span class="p">(</span><span class="dl">"</span><span class="s2">chat.update</span><span class="dl">"</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Slack API 使用请参考 <a href="https://api.slack.com/methods/chat.postMessage" target="_blank">官方文件</a> 。</p><p><strong>Githun Action YAML 可以使用这个 Action 持续更新讯息、发送 Slack 讯息：</strong></p><p><a href="https://github.com/slackapi/slack-github-action" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/376c992b8ee6787b9708e0b82116279ec012d41f84cafbd0975214d865cf45e9/slackapi/slack-github-action" alt="" loading="lazy"></a></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1"># ...</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">buildNumber</span><span class="pi">:</span> <span class="c1"># 对应 GAS payload.inpus.xxx</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">版本号码'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># ...More</span>
      <span class="na">SLACK_USER_ID</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Slack</span><span class="nv"> </span><span class="s">User</span><span class="nv"> </span><span class="s">Id</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">receive</span><span class="nv"> </span><span class="s">action</span><span class="nv"> </span><span class="s">notification'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">SLACK_CHANNEL_ID</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Slack</span><span class="nv"> </span><span class="s">Channel</span><span class="nv"> </span><span class="s">Id</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">receive</span><span class="nv"> </span><span class="s">action</span><span class="nv"> </span><span class="s">notification'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">SLACK_THREAD_TS</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Slack</span><span class="nv"> </span><span class="s">message</span><span class="nv"> </span><span class="s">ts'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># some jobs...</span>

  <span class="na">if-deploy-failed-message</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">failure()</span>
      <span class="s">- name</span><span class="err">:</span> <span class="s">update slack message</span>
        <span class="s">uses</span><span class="err">:</span> <span class="s">slackapi/slack-github-action@v2.0.0</span>
        <span class="s">with</span><span class="err">:</span>
            <span class="na">method</span><span class="pi">:</span> <span class="s">chat.update</span>
            <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
            <span class="na">payload</span><span class="pi">:</span> <span class="s">\\|</span>
              <span class="s">channel</span><span class="err">:</span> <span class="s">${{ github.event.inputs.SLACK_CHANNEL_ID }}</span>
              <span class="s">ts</span><span class="err">:</span> <span class="s">${{ github.event.inputs.SLACK_THREAD_TS }}</span>
              <span class="s">text</span><span class="err">:</span> <span class="s2">"</span><span class="s">❌</span><span class="nv"> </span><span class="s">打包任务失败，请检查执行状况结果或稍后再试。</span><span class="se">\n</span><span class="s">&lt;${{</span><span class="nv"> </span><span class="s">github.server_url</span><span class="nv"> </span><span class="s">}}/${{</span><span class="nv"> </span><span class="s">github.repository</span><span class="nv"> </span><span class="s">}}/actions/runs/${{</span><span class="nv"> </span><span class="s">github.run_id</span><span class="nv"> </span><span class="s">}}</span><span class="se">\\</span><span class="s">|点此查看执行状况&gt;</span><span class="nv"> </span><span class="s">cc'ed</span><span class="nv"> </span><span class="s">&lt;@${{</span><span class="nv"> </span><span class="s">github.event.inputs.SLACK_USER_ID</span><span class="nv"> </span><span class="s">}}&gt;"</span>
</pre></table></code></div></div><p><strong>效果：</strong></p><p><a href="/assets/4cb4437818f2/1*-w5jqjkx6p2alpzlLcz_Nw.webp" class="popup img-link blur"><img data-src="/assets/4cb4437818f2/1*-w5jqjkx6p2alpzlLcz_Nw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MjgiIGhlaWdodD0iNTU5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><strong><em>Slack App 串接细节可参考我之前的文章： <a href="/posts/zrealm-dev/zh-cn/slack-app-%E6%95%B4%E5%90%88-chatgpt-%E5%88%A9%E7%94%A8-openai-api-%E4%B8%8E-google-cloud-functions-%E8%87%AA%E5%BB%BA%E6%99%BA%E8%83%BD%E5%8A%A9%E7%90%86-bd94cc88f9c9/">Slack &amp; ChatGPT Integration</a> 。</em></strong></p></blockquote><h4 id="延伸-2-查询-jira-工单"><span class="me-2">延伸 (2) —查询 Jira 工单</span><a href="#延伸-2-查询-jira-工单" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">Jira.gs：</code></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">jiraPersonalAccessToken</span> <span class="o">=</span> <span class="dl">""</span>
<span class="c1">// https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.html</span>

<span class="kd">function</span> <span class="nf">getJiraTickets</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://xxx.atlassian.net/rest/api/3/search`</span><span class="p">;</span>

  <span class="c1">// JQL query</span>
  <span class="kd">const</span> <span class="nx">jql</span> <span class="o">=</span> <span class="s2">`project = XXX`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">queryParams</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">jql</span><span class="p">:</span> <span class="nx">jql</span><span class="p">,</span>
    <span class="na">maxResults</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">// Adjust as needed</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Basic </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">jiraPersonalAccessToken</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">muteHttpExceptions</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">key</span><span class="p">)}</span><span class="s2">=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">[</span><span class="nx">key</span><span class="p">])}</span><span class="s2">`</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nx">url</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">?</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">queryString</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&amp;fields=</span><span class="dl">"</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="c1">// could specify only return some fields</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nf">getResponseCode</span><span class="p">()</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">issues</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">()).</span><span class="nx">issues</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">issues</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">Logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nf">getResponseCode</span><span class="p">()}</span><span class="s2"> - </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">()}</span><span class="s2">`</span><span class="p">);</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to fetch Jira issues.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> 
</pre></table></code></div></div><p>其他 Jira API 使用请参考 <a href="https://developer.atlassian.com/cloud/jira/platform/rest/v3/" target="_blank">官方文件</a> 。</p><h4 id="延伸-3--查询-asana-工单"><span class="me-2">延伸 (3) — 查询 Asana 工单</span><a href="#延伸-3--查询-asana-工单" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">Asana.gs：</code></p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">const</span> <span class="n">asanaPersonalAccessToken</span> <span class="p">=</span> <span class="s">""</span>
<span class="c1">// https://developers.asana.com/docs/personal-access-token</span>

<span class="n">function</span> <span class="nf">asanaAPI</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="s">"GET"</span><span class="p">,</span> <span class="n">data</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">options</span> <span class="p">=</span> <span class="p">{</span>
      <span class="s">"method"</span> <span class="p">:</span> <span class="n">method</span><span class="p">,</span>
      <span class="s">"contentType"</span> <span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
      <span class="s">"headers"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s">"Authorization"</span><span class="p">:</span>  <span class="s">"Bearer "</span><span class="p">+</span><span class="n">asanaPersonalAccessToken</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">options</span><span class="p">[</span><span class="s">"payload"</span><span class="p">]</span> <span class="p">=</span> <span class="nc">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">({</span><span class="s">"data"</span><span class="p">:</span><span class="n">data</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">url</span> <span class="p">=</span> <span class="s">"https://app.asana.com/api/1.0"</span><span class="p">+</span><span class="n">endpoint</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">res</span> <span class="p">=</span> <span class="nc">UrlFetchApp</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">data</span> <span class="p">=</span> <span class="nc">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">getContentText</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 查找 tasks in project</span>
<span class="c1">// asanaAPI("/projects/PROJECT_ID/tasks");</span>
</pre></table></code></div></div><p>其他 Asana API 使用请参考 <a href="https://developers.asana.com/reference/gettasksforproject" target="_blank">官方文件</a> 。</p><h3 id="总结"><span class="me-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>自动化、工作及开发流程优化缺的永远不是技术，而是想法；只要有想法我们都能找到适合的技术来实现，共勉之！</p><h3 id="202507-update-1"><span class="me-2">2025/07 Update:</span><a href="#202507-update-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>此功能已整合到实际打包工具使用，可参考最新文章案例：「 <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9B%A2%E9%98%9F%E6%95%88%E7%8E%87-4273e57e7148/"><strong>CI/CD 实战指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免费易用的打包工具平台</strong></a> 」</p><p>有任何问题及指教欢迎 <a href="https://www.zhgchg.li/contact" target="_blank">与我联络</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次发表于 Medium (<a href="https://medium.com/p/4cb4437818f2" target="_blank"><strong>点击查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自动转换与同步技术。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2025-01-11-4cb4437818f2.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/google-apps-script/" class="post-tag no-text-decoration" >google-apps-script</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >github-actions</a> <a href="/tags/slack/" class="post-tag no-text-decoration" >slack</a> <a href="/tags/github/" class="post-tag no-text-decoration" >github</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Google%20Apps%20Script%20Web%20App%EF%BD%9C%E6%89%93%E9%80%A0%20Github%20Action%20CI/CD%20%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgoogle-apps-script-web-app-%25E6%2589%2593%25E9%2580%25A0-github-action-ci-cd-%25E8%2587%25AA%25E8%25AE%25A2%25E8%25A1%25A8%25E5%258D%2595%25E6%258F%2590%25E5%258D%2587%25E5%25BC%2580%25E5%258F%2591%25E6%2595%2588%25E7%258E%2587-4cb4437818f2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Google%20Apps%20Script%20Web%20App%EF%BD%9C%E6%89%93%E9%80%A0%20Github%20Action%20CI/CD%20%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgoogle-apps-script-web-app-%25E6%2589%2593%25E9%2580%25A0-github-action-ci-cd-%25E8%2587%25AA%25E8%25AE%25A2%25E8%25A1%25A8%25E5%258D%2595%25E6%258F%2590%25E5%258D%2587%25E5%25BC%2580%25E5%258F%2591%25E6%2595%2588%25E7%258E%2587-4cb4437818f2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fzh-cn%2Fgoogle-apps-script-web-app-%25E6%2589%2593%25E9%2580%25A0-github-action-ci-cd-%25E8%2587%25AA%25E8%25AE%25A2%25E8%25A1%25A8%25E5%258D%2595%25E6%258F%2590%25E5%258D%2587%25E5%25BC%2580%25E5%258F%2591%25E6%2595%2588%25E7%258E%2587-4cb4437818f2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/line-bank-to-firstrade-transfer-fast-deposit-150-nt-fee-guide-with-account-upgrade-fee-subsidy-e4d139fe0685/">LINE Bank to Firstrade Transfer｜Fast Deposit & 150 NT Fee Guide with Account Upgrade & Fee Subsidy</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%A6-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%90-%E4%BD%8E%E6%89%8B%E7%BB%AD%E8%B4%B9150%E5%85%83-%E5%B8%90%E6%88%B7%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%A1%A5%E5%8A%A9%E7%94%B3%E8%AF%B7%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教学 — LINE Bank 入金 Firstrade 快速到帐、手续费只要 150 元及帐户升级/约定转帐/手续费补助申请教学</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/line-bank-%E5%85%A5%E9%87%91-firstrade-%E6%95%99%E5%AD%B8-%E5%BF%AB%E9%80%9F%E5%88%B0%E5%B8%B3-%E4%BD%8E%E6%89%8B%E7%BA%8C%E8%B2%BB150%E5%85%83-%E5%B8%B3%E6%88%B6%E5%8D%87%E7%B4%9A%E8%88%87%E6%89%8B%E7%BA%8C%E8%B2%BB%E8%A3%9C%E5%8A%A9%E7%94%B3%E8%AB%8B%E5%85%A8%E6%94%BB%E7%95%A5-e4d139fe0685/">手把手教學 — LINE Bank 入金 Firstrade 快速到帳、手續費只要 150 元及帳戶升級/約定轉帳/手續費補助申請教學</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1736594383" data-df="ll" > Jan 11, 2025 </time><h4 class="pt-0 my-2">使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作</h4><div class="text-muted"><p>Github Action Workflow 表單優化與整合其他工作流程工具(Jira, Asana, Slack..)提升開發效率。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1736594383" data-df="ll" > Jan 11, 2025 </time><h4 class="pt-0 my-2">Google Apps Script Web App｜Integrate Forms with GitHub Actions CI/CD for Streamlined Workflows</h4><div class="text-muted"><p>Developers facing workflow inefficiencies can automate GitHub Actions CI/CD triggers using Google Apps Script Web App forms, seamlessly integrating tools like Jira, Asana, and Slack to boost produc...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/github-actions-self-hosted-runner-%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751458952" data-df="ll" > Jul 2, 2025 </time><h4 class="pt-0 my-2">CI/CD 实战指南（二）：GitHub Actions 与 Self-hosted Runner 使用与建置大全</h4><div class="text-muted"><p>带您从头了解 GitHub Actions/Self-hosted Runner 运作方式与手把手使用教学。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/" class="btn btn-outline-primary" aria-label="Older" ><p>Google Apps Script Web App｜Integrate Forms with GitHub Actions CI/CD for Streamlined Workflows</p></a> <a href="/posts/zrealm-dev/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%A8%82%E8%A1%A8%E5%96%AE%E6%8F%90%E5%8D%87%E9%96%8B%E7%99%BC%E6%95%88%E7%8E%87-4cb4437818f2/" class="btn btn-outline-primary" aria-label="Newer" ><p>使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
