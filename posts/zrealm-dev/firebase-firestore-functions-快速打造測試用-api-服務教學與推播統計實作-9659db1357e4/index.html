<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ" /><meta name="author" content="ZhgChgLi<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="vertical-align: middle;"><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/> </svg>" /><meta property="og:locale" content="en" /><meta name="description" content="é‡å°é–‹ç™¼è€…é¢è‡¨å¾Œç«¯æ¨æ’­çµ±è¨ˆä¸æº–ç¢ºèˆ‡ Server å£“åŠ›å•é¡Œï¼Œè§£æå¦‚ä½•é‹ç”¨ Firebase Firestore èˆ‡ Functions å¿«é€Ÿæ­å»ºå¯æ¸¬è©¦çš„ API æœå‹™ï¼Œä¸¦ç¤ºç¯„å®Œæ•´ RESTful API ç¯„ä¾‹åŠåˆ†æ•£å¼è¨ˆæ•¸å™¨è¨­è¨ˆï¼Œæå‡æ¨æ’­é»æ“Šç‡çµ±è¨ˆç²¾æº–åº¦èˆ‡ç³»çµ±ç©©å®šæ€§ã€‚" /><meta property="og:description" content="é‡å°é–‹ç™¼è€…é¢è‡¨å¾Œç«¯æ¨æ’­çµ±è¨ˆä¸æº–ç¢ºèˆ‡ Server å£“åŠ›å•é¡Œï¼Œè§£æå¦‚ä½•é‹ç”¨ Firebase Firestore èˆ‡ Functions å¿«é€Ÿæ­å»ºå¯æ¸¬è©¦çš„ API æœå‹™ï¼Œä¸¦ç¤ºç¯„å®Œæ•´ RESTful API ç¯„ä¾‹åŠåˆ†æ•£å¼è¨ˆæ•¸å™¨è¨­è¨ˆï¼Œæå‡æ¨æ’­é»æ“Šç‡çµ±è¨ˆç²¾æº–åº¦èˆ‡ç³»çµ±ç©©å®šæ€§ã€‚" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8-api-%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C-9659db1357e4/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8-api-%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C-9659db1357e4/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-24T01:09:34+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" /><meta property="twitter:title" content="Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" width=\"16\" height=\"16\" style=\"vertical-align: middle;\"><path fill=\"#007bff\" d=\"M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z\"/><path d=\"M250 330 l60 60 100 -140\" stroke=\"#ffffff\" stroke-width=\"40\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/> </svg>","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-14T00:34:17+08:00","datePublished":"2021-03-24T01:09:34+08:00","description":"é‡å°é–‹ç™¼è€…é¢è‡¨å¾Œç«¯æ¨æ’­çµ±è¨ˆä¸æº–ç¢ºèˆ‡ Server å£“åŠ›å•é¡Œï¼Œè§£æå¦‚ä½•é‹ç”¨ Firebase Firestore èˆ‡ Functions å¿«é€Ÿæ­å»ºå¯æ¸¬è©¦çš„ API æœå‹™ï¼Œä¸¦ç¤ºç¯„å®Œæ•´ RESTful API ç¯„ä¾‹åŠåˆ†æ•£å¼è¨ˆæ•¸å™¨è¨­è¨ˆï¼Œæå‡æ¨æ’­é»æ“Šç‡çµ±è¨ˆç²¾æº–åº¦èˆ‡ç³»çµ±ç©©å®šæ€§ã€‚","headline":"Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijg1NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8-api-%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C-9659db1357e4/"},"url":"https://zhgchg.li/posts/zrealm-dev/firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8-api-%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C-9659db1357e4/"}</script><title>Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan ğŸ‡¹ğŸ‡¼ who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ</h1><p class="post-desc fw-light mb-4">é‡å°é–‹ç™¼è€…é¢è‡¨å¾Œç«¯æ¨æ’­çµ±è¨ˆä¸æº–ç¢ºèˆ‡ Server å£“åŠ›å•é¡Œï¼Œè§£æå¦‚ä½•é‹ç”¨ Firebase Firestore èˆ‡ Functions å¿«é€Ÿæ­å»ºå¯æ¸¬è©¦çš„ API æœå‹™ï¼Œä¸¦ç¤ºç¯„å®Œæ•´ RESTful API ç¯„ä¾‹åŠåˆ†æ•£å¼è¨ˆæ•¸å™¨è¨­è¨ˆï¼Œæå‡æ¨æ’­é»æ“Šç‡çµ±è¨ˆç²¾æº–åº¦èˆ‡ç³»çµ±ç©©å®šæ€§ã€‚</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1616519374" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 24, 2021 </time> </span> <span> Updated <time data-ts="1713026057" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" class="popup img-link preview-img blur"><img data-src="/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijg1NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="vertical-align: middle;"><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/> </svg></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4422 words" > <em>24 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">ç« ç¯€ (Chapters)ğŸ”–</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Firebase Firestoreï½œFunctions å¿«é€Ÿæ‰“é€ æ¸¬è©¦ç”¨ API æœå‹™æ•™å­¸èˆ‡æ¨æ’­çµ±è¨ˆå¯¦ä½œ</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-info"><p><a href="/posts/en/9659db1357e4/"><strong>Click here</strong></a> to view the English version of this article, translated by OpenAI.</p></blockquote><blockquote class="prompt-tip"><p>åŸºæ–¼ SEO è€ƒé‡ï¼Œæœ¬æ–‡æ¨™é¡Œèˆ‡æè¿°ç¶“ GPT èª¿æ•´ï¼ŒåŸå§‹ç‰ˆæœ¬è«‹åƒè€ƒå…§æ–‡ï¼Œè‹¥æœ‰ä¸æ°ç•¶çš„ç”¨èªï¼Œæ•¬è«‹æŒ‡æ­£ã€‚</p></blockquote><hr /><h3 id="ä½¿ç”¨-firebase-firestore--functions-å¿«é€Ÿæ­å»ºå¯ä¾›æ¸¬è©¦çš„-api-æœå‹™"><span class="me-2">ä½¿ç”¨ Firebase Firestore + Functions å¿«é€Ÿæ­å»ºå¯ä¾›æ¸¬è©¦çš„ API æœå‹™</span><a href="#ä½¿ç”¨-firebase-firestore--functions-å¿«é€Ÿæ­å»ºå¯ä¾›æ¸¬è©¦çš„-api-æœå‹™" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ç•¶æ¨æ’­çµ±è¨ˆé‡ä¸Š Firebase Firestore + Functions</p><p><a href="/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*RVPRxqz2VUuY7NGXSXzmtw.webp" alt="Photo by [Carlos Muza](https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijg1NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Carlos Muza</a></p><h3 id="å‰è¨€"><span class="me-2">å‰è¨€</span><a href="#å‰è¨€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="æ¨æ’­ç²¾ç¢ºçµ±è¨ˆåŠŸèƒ½"><span class="me-2">æ¨æ’­ç²¾ç¢ºçµ±è¨ˆåŠŸèƒ½</span><a href="#æ¨æ’­ç²¾ç¢ºçµ±è¨ˆåŠŸèƒ½" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æœ€è¿‘æƒ³ç‚º APP å°å…¥çš„åŠŸèƒ½ï¼Œæœªå¯¦ä½œå‰æˆ‘å€‘åªèƒ½å¾å¾Œç«¯ Post è³‡æ–™çµ¦ APNS/FCM çš„æˆåŠŸèˆ‡å¦ç•¶ä½œæ¨æ’­åŸºæ•¸ä¸¦è¨˜éŒ„æ¨æ’­é»æ“Šï¼Œè¨ˆç®—å‡ºã€Œé»æ“Šç‡ã€ï¼›ä½†æ­¤æ–¹æ³•å…¶å¯¦éå¸¸ä¸æº–ç¢ºï¼ŒåŸºæ•¸åŒ…å«è¨±å¤šç„¡æ•ˆè£ç½®ï¼ŒAPP å·²åˆªé™¤çš„ï¼ˆä¸ä¸€å®šæœƒé¦¬ä¸Šå¤±æ•ˆï¼‰ã€é—œé–‰æ¨æ’­æ¬Šé™çš„åœ¨å¾Œç«¯ Post æ™‚éƒ½é‚„æ˜¯æœƒå¾—åˆ°æˆåŠŸçš„å›å‚³ã€‚</p><p>åœ¨ iOS 10 ä¹‹å¾Œå¯ä»¥é€éå¯¦è¸ Notification Service Extension åœ¨æ¨æ’­æ©«å¹…å‡ºç¾æ™‚çš„æ™‚æ©Ÿé»å·å· Call API å›å‚³åšçµ±è¨ˆï¼›å¥½è™•æ˜¯éå¸¸ç²¾æº–ï¼Œåªæœ‰åœ¨ä½¿ç”¨è€…æ¨æ’­æ©«å¹…æœ‰å‡ºç¾æ‰æœƒ Callï¼›å¦‚æœ APP åˆªé™¤ã€é—œé–‰é€šçŸ¥ã€é€šçŸ¥æ²’é–‹æ©«å¹…ï¼Œéƒ½ä¸æœƒæœ‰å‹•ä½œï¼Œæ©«å¹…ç­‰æ–¼æœ‰å‡ºç¾æ¨æ’­è¨Šæ¯ï¼Œç”¨æ­¤ç•¶æ¨æ’­åŸºæ•¸ç„¶å¾Œå†ç®—ä¸Šé»æ“Šæ•¸å°±èƒ½å¾—åˆ°ã€Œç²¾ç¢ºçš„é»æ“Šç‡ã€ã€‚</p><blockquote><p><em>è©³ç´°åŸç†åŠå¯¦ä½œæ–¹å¼å¯åƒè€ƒä¹‹å‰çš„æ–‡ç« ï¼šã€Œ <a href="/posts/zrealm-dev/ios-notification-service-extension-swift-å¯¦ä½œåœ–ç‰‡æ¨æ’­èˆ‡é¡¯ç¤ºçµ±è¨ˆæŠ€å·§-cb6eba52a342/">i <strong>OS â‰¥ 10 Notification Service Extension æ‡‰ç”¨ (Swift)</strong></a> ã€</em></p></blockquote><blockquote><p><em>ç›®å‰æ¸¬è©¦ä¸‹ä¾† APP çš„ Loss ç‡æ‡‰è©²æ˜¯ 0%ï¼Œå¯¦éš›å¸¸è¦‹æ‡‰ç”¨åƒæ˜¯ Line çš„è¨Šæ¯é»å°é»åŠ è§£å¯†ï¼ˆæ¨æ’­çš„è¨Šæ¯æ˜¯åŠ å¯†éçš„ï¼Œåœ¨æ‰‹æ©Ÿæ”¶åˆ°æ‰è§£å¯†ç„¶å¾Œé¡¯ç¤ºå‡ºä¾†ï¼‰ã€‚</em></p></blockquote><h4 id="å•é¡Œ"><span class="me-2">å•é¡Œ</span><a href="#å•é¡Œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>APP ç«¯çš„åŠŸå…¶å¯¦ä¸å¤§ï¼ŒiOS/Android éƒ½åªè¦å¯¦ä½œé¡ä¼¼çš„åŠŸèƒ½ï¼ˆä½† Android å¦‚æœè¦è€ƒæ…®ä¸­åœ‹å¸‚å ´å°±æ¯”è¼ƒéº»ç…©ï¼Œè¦ç‚ºæ›´å¹³å°å¯¦ä½œæ¨æ’­æ¡†æ¶å…§å®¹ï¼‰ï¼›æ¯”è¼ƒå¤§çš„åŠŸæ˜¯å¾Œç«¯é‚„æœ‰ Server çš„å£“åŠ›è™•ç†ï¼Œå› ç‚ºæ¨æ’­ä¸€æ¬¡å‡ºå»æœƒåŒæ™‚ Call API å›å‚³ç´€éŒ„ï¼Œå¯èƒ½æœƒå¡çˆ† Server çš„ max connection å¦‚æœåˆæ˜¯ä½¿ç”¨ RDBMS å„²å­˜è¨˜éŒ„å¯èƒ½æœƒæ›´åš´é‡ï¼Œå¦‚æœç™¼ç¾çµ±è¨ˆæ•¸æœ‰ Loss å¤šåŠç™¼ç”Ÿåœ¨æ­¤ç’°ç¯€ã€‚</p><blockquote><p><em>é€™é‚Šå¯ä»¥ä»¥ log å¯«æª”æ¡ˆæ–¹å¼åšç´€éŒ„ï¼Œè¦æŸ¥è©¢æ™‚åœ¨è‡ªè¡Œåšçµ±è¨ˆé¡¯ç¤ºã€‚</em></p></blockquote><blockquote><p><em>å¦å¤–ï¼Œå¾Œä¾†æƒ³æƒ³ä¸€æ¬¡å‡ºå»åŒæ™‚å›ä¾†çš„æƒ…å¢ƒï¼Œæ•¸é‡å¯èƒ½æ²’æœ‰æƒ³åƒä¸­çš„å¤§ï¼›å› ç‚ºç™¼æ¨æ’­ä¹Ÿä¸æœƒä¸€å£æ°£ç™¼å€‹åè¬ç™¾è¬ç­†ï¼Œä¹Ÿæ˜¯å¹¾ç­†å¹¾ç­†æ‰¹æ¬¡ç™¼é€ï¼›åªè¦èƒ½æ‰›ä½æ‰¹æ¬¡ç™¼å‡ºå»åŒæ™‚å›ä¾†çš„æ•¸é‡å³å¯ï¼</em></p></blockquote><h3 id="prototype"><span class="me-2">Prototype</span><a href="#prototype" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å› åŸå…ˆæœ‰å•é¡Œä¸­çš„è€ƒé‡ï¼Œå¾Œç«¯éœ€è¦èŠ±åŠŸåŠ›ç ”ç©¶ä¿®æ”¹ä¸”å¸‚å ´ä¹Ÿä¸ä¸€å®šåœ¨æ„åšå‡ºä¾†çš„æˆæ•ˆï¼›æ‰€ä»¥æƒ³èªªå…ˆç”¨èƒ½ä½¿ç”¨çš„è³‡æºå¼„å€‹ Prototype å‡ºä¾†è©¦è©¦æ°´æº«ã€‚</p><p>é€™é‚Šé¸æ“‡çš„æ˜¯ APP å¹¾ä¹éƒ½æœƒä½¿ç”¨çš„ Firebase æœå‹™ï¼Œå…¶ä¸­çš„ Functions å’Œ Firestore åŠŸèƒ½ã€‚</p><h4 id="firebase-functions"><span class="me-2">Firebase Functions</span><a href="#firebase-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://developers.google.com/learn/topics/functions" target="_blank">Functions</a> æ˜¯ Google æä¾›çš„ serverless æœå‹™ï¼Œåªéœ€æ’°å¯«å¥½ç¨‹å¼é‚è¼¯ï¼ŒGoogle è‡ªå‹•å¹«ä½ å¼„å¥½ä¼ºæœå™¨ã€åŸ·è¡Œç’°å¢ƒï¼Œä¹Ÿä¸ç”¨å»ç®¡ä¼ºæœå™¨æ“´å……åŠæµé‡çš„å•é¡Œã€‚</p><p><a href="https://firebase.google.com/docs/functions" target="_blank">Firebase Functions</a> å…¶å¯¦å°±æ˜¯ Google Cloud Functions ä½†åªèƒ½ä½¿ç”¨ JavaScript (node.js) æ’°å¯«ï¼Œæ²’è©¦éä½†å¦‚æœç”¨ Google Cloud Functions é¸æ“‡ç”¨å…¶ä»–èªè¨€æ’°å¯«ç„¶å¾ŒåŒæ¨£ import Firebase æœå‹™æˆ‘æƒ³æ‡‰è©²ä¹Ÿèƒ½ç”¨ã€‚</p><p>ç”¨åœ¨ API å°±æ˜¯æˆ‘å¯ä»¥å¯«ä¸€å€‹ node.js æª”æ¡ˆï¼Œå¾—åˆ°ä¸€å€‹å¯¦é«” URL (ex: my-project.cloudfunctions.net/getUser)ï¼Œè‡ªè¡Œæ’°å¯«å–å¾— Request è³‡è¨Šå’Œçµ¦äºˆç›¸æ‡‰çš„ Response é‚è¼¯ã€‚</p><blockquote><p><em>ä¹‹å‰å¯«éä¸€ç¯‡é—œæ–¼ Google Functions çš„æ–‡ç« ã€Œ <a href="/posts/zrealm-dev/python-æ­é…-google-cloud-platform-èˆ‡-line-bot-æ‰“é€ æ¯æ—¥è‡ªå‹•ç°½åˆ°è…³æœ¬èˆ‡æ’ç¨‹-70a1409b149a/">ä½¿ç”¨ Python+Google Cloud Platform+Line Bot è‡ªå‹•åŸ·è¡Œä¾‹è¡Œç‘£äº‹</a> ã€</em></p></blockquote><blockquote><p><em>Firebase Functions å¿…é ˆå•Ÿç”¨ Blaze å°ˆæ¡ˆï¼ˆç”¨å¤šå°‘ã€ä»˜å¤šå°‘ï¼‰æ‰èƒ½ä½¿ç”¨ã€‚</em></p></blockquote><p><a href="/assets/9659db1357e4/1*YqIJ1tr2Ay-oLVjSSU0zUg.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*YqIJ1tr2Ay-oLVjSSU0zUg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDkiIGhlaWdodD0iNTA3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="firebase-firestore"><span class="me-2">Firebase Firestore</span><a href="#firebase-firestore" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://firebase.google.com/docs/firestore" target="_blank">Firebase Firestore</a> ï¼ŒNoSql è³‡æ–™åº«ï¼Œç”¨ä¾†å­˜æ”¾ã€ç®¡ç†æ•¸æ“šã€‚</p><p>çµåˆ Firebase Functions å¯åœ¨ Request æ™‚ import Firestore é€²ä¾†æ“ä½œè³‡æ–™åº«ï¼Œç„¶å¾ŒResponse çµ¦ä½¿ç”¨è€…ï¼Œå°±èƒ½æ­å»ºç°¡å–®çš„ Restful API æœå‹™ï¼</p><blockquote><p>å‹•æ‰‹å¯¦ä½œé–‹å§‹ï¼</p></blockquote><h3 id="å®‰è£-nodejs-ç’°å¢ƒ"><span class="me-2">å®‰è£ node.js ç’°å¢ƒ</span><a href="#å®‰è£-nodejs-ç’°å¢ƒ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>é€™é‚Šå»ºè­°ä½¿ç”¨ NVMï¼Œnode.js ç‰ˆæœ¬ç®¡ç†å·¥å…·é€²è¡Œå®‰è£ç®¡ç†ï¼ˆåƒ python ç”¨ pyenvï¼‰ã€‚</p><p>åˆ° NVM Github å°ˆæ¡ˆè¤‡è£½å®‰è£ shell scriptï¼š</p><p><a href="https://github.com/nvm-sh/nvm#installing-and-updating" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/612230/53a0c44a-1f6e-4f8d-918f-89762fafe369" alt="" loading="lazy"></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-o-</span> https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash
</pre></table></code></div></div><p>å¦‚æœå®‰è£éç¨‹å‡ºç¾éŒ¯èª¤ï¼Œè«‹ç¢ºèªæœ‰ <code class="language-plaintext highlighter-rouge">~/.bashrc</code> æˆ– <code class="language-plaintext highlighter-rouge">~/.zshrc</code> æª”æ¡ˆï¼Œæ²’æœ‰å¯ç”¨ <code class="language-plaintext highlighter-rouge">touch ~/.bashrc</code> æˆ– <code class="language-plaintext highlighter-rouge">touch ~/.zshrc</code> å»ºç«‹æª”æ¡ˆç„¶å¾Œå†è·‘ä¸€ä¸‹ install scriptã€‚</p><p>å†ä¾†å°±å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">nvm install node</code> å®‰è£æœ€æ–°ç‰ˆçš„ node.jsã€‚</p><p><a href="/assets/9659db1357e4/1*5fxz4HD9q4feAqO0zXbojg.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*5fxz4HD9q4feAqO0zXbojg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzUiIGhlaWdodD0iMTEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>å¯ä¸‹ <code class="language-plaintext highlighter-rouge">npm --version</code> ç¢ºèª npm å®‰è£æˆåŠŸã€å®‰è£ç‰ˆæœ¬ï¼š</p><p><a href="/assets/9659db1357e4/1*VHZMRFIDzFA9AxmsDNqNlA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*VHZMRFIDzFA9AxmsDNqNlA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNDgiIGhlaWdodD0iMzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><h3 id="éƒ¨ç½²-firebase-functions"><span class="me-2">éƒ¨ç½² Firebase Functions</span><a href="#éƒ¨ç½²-firebase-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="å®‰è£-firebase-tools"><span class="me-2">å®‰è£ Firebase-toolsï¼š</span><a href="#å®‰è£-firebase-tools" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm <span class="nb">install</span> <span class="nt">-g</span> firebase-tools
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*POfMR0p1600iYqy8rzQkTQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*POfMR0p1600iYqy8rzQkTQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTIiIGhlaWdodD0iMjI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>å®‰è£æˆåŠŸå¾Œï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è«‹å…ˆè¼¸å…¥ï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>firebase login
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*kqeECyXVPOq1cpKvcdOBeA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*kqeECyXVPOq1cpKvcdOBeA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDQ5IiBoZWlnaHQ9IjIxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>å®Œæˆ Firebase ç™»å…¥é©—è­‰ã€‚</p><p>å•Ÿå‹•å°ˆæ¡ˆï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>firebase init
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*Xx2grpX2PZb3wEFt9mQbNw.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*Xx2grpX2PZb3wEFt9mQbNw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODIiIGhlaWdodD0iNTI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>è¨˜ä¸‹ Firebase init æ‰€åœ¨è·¯å¾‘ï¼š</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>You're about to initialize a Firebase project in this directory:
</pre></table></code></div></div><p>é€™é‚Šå¯ä»¥é¸æ“‡è¦å®‰è£çš„ Firebase CLI å·¥å…·ï¼ŒæŒ‰ ã€Œâ†‘ã€ã€Œâ†“ã€é€²è¡Œé¸æ“‡ï¼Œã€Œç©ºç™½éµã€é€²è¡Œé¸æ“‡ï¼›é€™é‚Šå¯ä»¥åªé¸æ“‡ã€ŒFunctionsã€æˆ–é€£ã€ŒFirestoreã€ä¸€èµ·é¸æ“‡å®‰è£ã€‚</p><p><strong>=== Functions Setup</strong></p><p><a href="/assets/9659db1357e4/1*2gd9pAIdLAkJRhROpJtPKA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*2gd9pAIdLAkJRhROpJtPKA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDYiIGhlaWdodD0iMTU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>èªè¨€é¸æ“‡ã€Œ <strong>JavaScript</strong> ã€<li>é—œæ–¼ã€Œuse ESLint to catch probable bugs and enforce styleã€èªæ³• style æª¢æŸ¥ ï¼Œ <strong>YES / NO éƒ½å¯</strong> ã€‚<li>install dependencies with npm? <strong>YES</strong></ul><p><strong>===Emulators Setup</strong></p><p><a href="/assets/9659db1357e4/1*xHWp195BZIZdXyUd-ub78g.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*xHWp195BZIZdXyUd-ub78g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODAiIGhlaWdodD0iMjU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>å¯åœ¨æœ¬åœ°ç’°å¢ƒæ¸¬è©¦ Functionsã€Firestore åŠŸèƒ½åŠè¨­å®šï¼Œä¸æœƒç®—åœ¨ä½¿ç”¨åº¦ä¸”ä¸éœ€ç­‰åˆ°éƒ¨ç½²ä¸Šç·šæ‰èƒ½æ¸¬è©¦ã€‚</p><blockquote><p><em>ä¾å€‹äººéœ€æ±‚å®‰è£ï¼Œæˆ‘æœ‰è£ä½†æ²’æœ‰ç”¨ï¼ï¼ï¼å› ç‚ºåªæ˜¯å°åŠŸèƒ½è€Œå·²ã€‚</em></p></blockquote><h3 id="coding"><span class="me-2">Coding!</span><a href="#coding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å‰å¾€ä¸Šè¿°è¨˜ä¸‹çš„è·¯å¾‘ï¼Œæ‰¾åˆ° <code class="language-plaintext highlighter-rouge">functions è³‡æ–™å¤¾</code> ï¼Œç”¨ç·¨è¼¯å™¨æ‰“é–‹è£¡é¢çš„ <code class="language-plaintext highlighter-rouge">index.js</code> æª”æ¡ˆã€‚</p><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">targetID</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">targetID</span>
    <span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">action</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span>

    <span class="nx">res</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">targetID</span><span class="dl">"</span><span class="p">:</span> <span class="nx">targetID</span><span class="p">,</span> <span class="dl">"</span><span class="s2">action</span><span class="dl">"</span><span class="p">:</span> <span class="nx">action</span><span class="p">,</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="nx">name</span><span class="p">});</span>
    <span class="k">return</span>
<span class="p">})</span>
</pre></table></code></div></div><p>è²¼ä¸Šä»¥ä¸Šå…§å®¹ï¼Œæˆ‘å€‘å®šç¾©äº†ä¸€å€‹è·¯å¾‘æ¥å£ <code class="language-plaintext highlighter-rouge">/hello</code> ç„¶å¾Œæœƒå›å‚³ URL <strong>Query</strong> <code class="language-plaintext highlighter-rouge">?targetID=</code> ã€ <strong>POST</strong> <code class="language-plaintext highlighter-rouge">action</code> ã€ <code class="language-plaintext highlighter-rouge">name</code> åƒæ•¸è³‡è¨Šã€‚</p><p>ä¿®æ”¹ï¼†å„²å­˜å®Œæˆå¾Œå›åˆ° console ä¸‹ï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>firebase deploy
</pre></table></code></div></div><blockquote><p><strong><em>ä»¥å¾Œçš„æ¯æ¬¡ä¿®æ”¹éƒ½è¨˜å¾—è¦å›ä¾†ä¸‹ <code class="language-plaintext highlighter-rouge">firebase deploy</code> æŒ‡ä»¤ï¼Œæ‰æœƒç”Ÿæ•ˆã€‚</em></strong></p></blockquote><p>é–‹å§‹é©—è­‰ï¼†éƒ¨ç½²åˆ° Firebaseâ€¦</p><p><a href="/assets/9659db1357e4/1*hUdvD4ANKD3s73mLWNZZOQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*hUdvD4ANKD3s73mLWNZZOQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NjciIGhlaWdodD0iMzM3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>å¯èƒ½éœ€è¦ç¨ç­‰ä¸€ä¸‹ï¼Œ <code class="language-plaintext highlighter-rouge">Deploy complete!</code> å¾Œä½ çš„ç¬¬ä¸€å€‹ Request &amp; Response ç¶²é å°±å®Œæˆäº†ï¼</p><p>é€™æ™‚å€™å¯ä»¥å›åˆ° Firebase -&gt; Functions é é¢ï¼š</p><p><a href="/assets/9659db1357e4/1*SY4iJZL6gDEZ5AEcepIpMA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*SY4iJZL6gDEZ5AEcepIpMA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjI0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>å°±æœƒçœ‹åˆ°å‰›å‰›æ’°å¯«çš„æ¥å£å’Œç¶²å€ä½ç½®ã€‚</p><p>è¤‡è£½ä¸‹æ–¹ç¶²å€è²¼åˆ° PostMan æ¸¬è©¦ï¼š</p><p><a href="/assets/9659db1357e4/1*OMfLkdg12QHsp-yc9RkKvA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*OMfLkdg12QHsp-yc9RkKvA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDUiIGhlaWdodD0iNTExIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>POST Body è¨˜å¾—é¸æ“‡ <code class="language-plaintext highlighter-rouge">x-www-form-urlencoded</code> ã€‚</em></p></blockquote><p><strong>æˆåŠŸï¼</strong></p><h3 id="log"><span class="me-2">Log</span><a href="#log" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>æˆ‘å€‘å¯ä»¥åœ¨ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨ï¼š</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">functions</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">log:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</pre></table></code></div></div><p>é€²è¡Œ Log ç´€éŒ„ã€‚</p><p>ä¸¦å¯åœ¨ Firebase -&gt; Functions -&gt; ç´€éŒ„ä¸­æŸ¥çœ‹ log çµæœï¼š</p><p><a href="/assets/9659db1357e4/1*Wi-4MbPh2tVJ_utdhzN4_A.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*Wi-4MbPh2tVJ_utdhzN4_A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijc2NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h3 id="example-goal"><span class="me-2">Example Goal</span><a href="#example-goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>å»ºç«‹ä¸€å€‹å¯æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤ã€æŸ¥è©¢æ–‡ç« å’ŒæŒ‰è®šçš„ API</p></blockquote><p>æˆ‘å€‘å¸Œæœ›èƒ½é”æˆ Restful API çš„åŠŸèƒ½è¨­è¨ˆï¼Œæ‰€ä»¥ä¸èƒ½å†ä½¿ç”¨ä¸Šé¢ç¯„ä¾‹çš„ç´” Path æ–¹å¼ï¼Œè¦æ”¹è—‰ç”¨ <code class="language-plaintext highlighter-rouge">Express</code> æ¡†æ¶é”æˆã€‚</p><h4 id="post-æ–°å¢æ–‡ç« "><span class="me-2">POST æ–°å¢æ–‡ç« </span><a href="#post-æ–°å¢æ–‡ç« " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Insert</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// é€™é‚Šçš„ POST æŒ‡çš„æ˜¯ HTTP Method POST</span>
    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">title</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">author</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span><span class="nx">content</span><span class="p">,</span> <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="nx">author</span><span class="p">,</span> <span class="dl">"</span><span class="s2">created_at</span><span class="dl">"</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–°å¢æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="c1">// é€™é‚Šçš„ POST æŒ‡çš„æ˜¯ /post è·¯å¾‘</span>
</pre></table></code></div></div><p>ç¾åœ¨æˆ‘å€‘æ”¹ç”¨ Express ä¾†è™•ç†ç¶²è·¯è«‹æ±‚ï¼Œé€™é‚Šå…ˆæ–°å¢ä¸€å€‹ è·¯å¾‘ <code class="language-plaintext highlighter-rouge">/ çš„ POST</code> æ–¹æ³•ï¼Œæœ€å¾Œä¸€è¡Œè¡¨ç¤ºè·¯å¾‘éƒ½åœ¨ <code class="language-plaintext highlighter-rouge">/post</code> ä¹‹ä¸‹ï¼Œå†ä¾†æˆ‘å€‘æœƒåŠ ä¸Šä¿®æ”¹ã€åˆªé™¤çš„ APIã€‚</p><p>ä¸‹ <code class="language-plaintext highlighter-rouge">firebase deploy</code> éƒ¨ç½²æˆåŠŸå¾Œï¼Œå›åˆ° Post Man æ¸¬è©¦ï¼š</p><p><a href="/assets/9659db1357e4/1*yVAjhlr6wLdONeG7nY0VEw.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*yVAjhlr6wLdONeG7nY0VEw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NTIiIGhlaWdodD0iNDI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Post Man æ‰“æˆåŠŸå¾Œå¯ä»¥å†åˆ° Firebase -&gt; Firestore æª¢æŸ¥ä¸€ä¸‹è³‡æ–™æ˜¯å¦æœ‰æ­£ç¢ºå¯«å…¥ï¼š</p><p><a href="/assets/9659db1357e4/1*xYVrRdFro3bQVHx05JUaTw.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*xYVrRdFro3bQVHx05JUaTw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYxMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="put-ä¿®æ”¹æ–‡ç« "><span class="me-2">PUT ä¿®æ”¹æ–‡ç« </span><a href="#put-ä¿®æ”¹æ–‡ç« " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Update</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">title</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">author</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span><span class="nx">content</span><span class="p">,</span> <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="nx">author</span><span class="p">};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">update</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">ä¿®æ”¹æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p>éƒ¨ç½²ï¼†æ¸¬è©¦æ–¹å¼å¦‚æ–°å¢ï¼ŒPost Man Http Method è¨˜å¾—æ”¹æˆ <code class="language-plaintext highlighter-rouge">PUT</code> ã€‚</p><h4 id="delete-åˆªé™¤æ–‡ç« "><span class="me-2">DELETE åˆªé™¤æ–‡ç« </span><a href="#delete-åˆªé™¤æ–‡ç« " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Delete</span>
<span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">posts</span><span class="dl">"</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="k">delete</span><span class="p">();</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–‡ç« æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">})</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p>éƒ¨ç½²ï¼†æ¸¬è©¦æ–¹å¼å¦‚æ–°å¢ï¼ŒPost Man Http Method è¨˜å¾—æ”¹æˆ <code class="language-plaintext highlighter-rouge">DELETE</code> ã€‚</p><p>æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤åšå®Œäº†ï¼Œä¾†åšæŸ¥è©¢ï¼</p><h4 id="select-æŸ¥è©¢æ–‡ç« "><span class="me-2">SELECT æŸ¥è©¢æ–‡ç« </span><a href="#select-æŸ¥è©¢æ–‡ç« " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Select List</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">posts</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">();</span>
      <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span> <span class="p">...</span><span class="nx">data</span><span class="p">})</span>
    <span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span><span class="nx">result</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Select One</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">...</span><span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">()}});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*n_mI4l1EmhpWK8M_FbrzbQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*n_mI4l1EmhpWK8M_FbrzbQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDQiIGhlaWdodD0iNjAzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>éƒ¨ç½²ï¼†æ¸¬è©¦æ–¹å¼å¦‚æ–°å¢ï¼ŒPost Man Http Method è¨˜å¾—æ”¹æˆ <code class="language-plaintext highlighter-rouge">GET</code> é‚„æœ‰å°‡ <code class="language-plaintext highlighter-rouge">Body</code> åˆ‡å› <code class="language-plaintext highlighter-rouge">none</code> ã€‚</p><h4 id="insertorupdate"><span class="me-2">InsertOrUpdate?</span><a href="#insertorupdate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æœ‰æ™‚å€™æˆ‘å€‘éœ€è¦ç•¶å€¼å­˜åœ¨æ™‚åšæ›´æ–°ï¼Œç•¶å€¼ä¸å­˜åœ¨æ™‚æ–°å¢ï¼Œé€™æ™‚å€™å¯ä»¥ç”¨ <code class="language-plaintext highlighter-rouge">set</code> æ­é… <code class="language-plaintext highlighter-rouge">merge: true</code> ï¼š</p><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// InsertOrUpdate</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/tag</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="nx">name</span><span class="p">};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">tags</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nf">set</span><span class="p">({</span><span class="na">created_at</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–°å¢æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p>é€™é‚Šä»¥æ–°å¢ tag ç‚ºä¾‹ï¼Œéƒ¨ç½²ï¼†æ¸¬è©¦æ–¹å¼å¦‚æ–°å¢ï¼Œå¯ä»¥çœ‹åˆ° Firestore ä¸æœƒä¸€ç›´é‡è¤‡æ–°å¢æ–°è³‡æ–™ã€‚</p><p><a href="/assets/9659db1357e4/1*qkTMGjC0EkrMO85-6pQFwg.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*qkTMGjC0EkrMO85-6pQFwg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU3OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨"><span class="me-2">æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨</span><a href="#æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å‡è¨­æˆ‘å€‘çš„æ–‡ç« è³‡æ–™ç¾åœ¨å¤šä¸€å€‹ <code class="language-plaintext highlighter-rouge">likeCount</code> æ¬„ä½ç´€éŒ„æŒ‰è®šæ•¸é‡ï¼Œé‚£æˆ‘å€‘è©²æ€éº¼åšå‘¢ï¼Ÿ</p><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Like Post</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/like/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">.</span><span class="nx">FieldValue</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">set</span><span class="p">({</span><span class="na">likeCount</span><span class="p">:</span> <span class="nx">increment</span><span class="p">},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æŒ‰è®šæˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p>é‹ç”¨ <code class="language-plaintext highlighter-rouge">increment</code> é€™å€‹è®Šæ•¸å°±èƒ½ç›´æ¥åšåˆ°å–å‡ºå€¼ +1 çš„å‹•ä½œã€‚</p><h4 id="å¤§æµé‡æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨"><span class="me-2">å¤§æµé‡æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨</span><a href="#å¤§æµé‡æ–‡ç« æŒ‰è®šè¨ˆæ•¸å™¨" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å› ç‚º Firestore æœ‰ <a href="https://cloud.google.com/firestore/quotas?hl=zh-tw#soft_limits" target="_blank">å¯«å…¥é€Ÿåº¦é™åˆ¶</a> çš„ï¼š</p><p><a href="/assets/9659db1357e4/1*U9ubGe3M8XEdx9XGAV8nfA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*U9ubGe3M8XEdx9XGAV8nfA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODgiIGhlaWdodD0iNzAzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>ä¸€å€‹æ–‡æª”ä¸€ç§’åªèƒ½å¯«å…¥ä¸€æ¬¡</strong> ï¼Œæ‰€ä»¥ç•¶æŒ‰è®šçš„äººä¸€å¤šï¼›åŒæ™‚è«‹æ±‚ä¸‹å¯èƒ½æœƒè®Šå¾—å¾ˆæ…¢ã€‚</p><p>å®˜æ–¹çµ¦çš„è§£æ±ºæ–¹æ³•ã€Œ <a href="https://cloud.google.com/firestore/docs/solutions/counters#node.js_2" target="_blank">Distributed counters</a> ã€å…¶å¯¦ä¹Ÿæ²’ä»€éº¼é«˜æ·±çš„æŠ€è¡“ï¼Œå°±æ˜¯å¤šç”¨å¹¾å€‹åˆ†æ•£çš„ likeCount æ¬„ä½ä¾†çµ±è¨ˆï¼Œç„¶å¾Œè®€å–çš„æ™‚å€™å†åŠ ç¸½èµ·ä¾†ã€‚</p><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Distributed counters Like Post</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/like2/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">.</span><span class="nx">FieldValue</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">//1~10</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">likeCounter</span><span class="dl">"</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="dl">"</span><span class="s2">likeCount_</span><span class="dl">"</span><span class="o">+</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">set</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="nx">increment</span><span class="p">},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æŒ‰è®šæˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>


<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*GhNEcWUjgvYRYCMBk1DayA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*GhNEcWUjgvYRYCMBk1DayA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU3NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>ä»¥ä¸Šå°±æ˜¯åˆ†æ•£å‡ºæ¬„ä½ä¾†ç´€éŒ„ Count é¿å…å¯«å…¥å¤ªæ…¢ï¼›ä½†å¦‚æœåˆ†æ•£çš„æ¬„ä½å¤ªå¤šæœƒå¢åŠ è®€å–æˆæœ¬($$)ï¼Œä½†æ‡‰è©²é‚„æ˜¯æ¯”æ¯æ¬¡æŒ‰è®šéƒ½ add ä¸€ç­†æ–°ç´€éŒ„é‚„ä¾¿å®œã€‚</p><h4 id="ä½¿ç”¨-siege-å·¥å…·é€²è¡Œå£“åŠ›æ¸¬è©¦"><span class="me-2">ä½¿ç”¨ Siege å·¥å…·é€²è¡Œå£“åŠ›æ¸¬è©¦</span><a href="#ä½¿ç”¨-siege-å·¥å…·é€²è¡Œå£“åŠ›æ¸¬è©¦" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">brew</code> å®‰è£ <code class="language-plaintext highlighter-rouge">siege</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>siege
</pre></table></code></div></div><p><em>p.s å¦‚æœä½ å‡ºç¾ brew: command not found è«‹å…ˆå®‰è£ <a href="https://brew.sh/index_zh-tw" target="_blank">brew</a> å¥—ä»¶ç®¡ç†å·¥å…·</em> ï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/bin/ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/master/install<span class="si">)</span><span class="s2">"</span>
</pre></table></code></div></div><p>å®‰è£å®Œæˆå¾Œå¯ä¸‹ï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>siege <span class="nt">-c</span> 100 <span class="nt">-r</span> 1 <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="s1">'https://us-central1-project.cloudfunctions.net/post/like/id POST {}'</span>
</pre></table></code></div></div><p>é€²è¡Œå£“åŠ›æ¸¬è©¦ï¼š</p><ul><li><code class="language-plaintext highlighter-rouge">-c 100</code> ï¼š100 å€‹ä»»å‹™åŒæ­¥åŸ·è¡Œ<li><code class="language-plaintext highlighter-rouge">-r 1</code> ï¼šæ¯å€‹ä»»å‹™åŸ·è¡Œ 1 æ¬¡è«‹æ±‚<li><code class="language-plaintext highlighter-rouge">-H â€˜Content-Type: application/jsonâ€™</code> ï¼šå¦‚æœæ˜¯ POST æ™‚éœ€åŠ ä¸Š<li><code class="language-plaintext highlighter-rouge">â€˜https://us-central1-project.cloudfunctions.net/post/like/id POST {}â€™</code> ï¼šPOST ç¶²å€ã€Post Body (ex: <code class="language-plaintext highlighter-rouge">{â€œnameâ€:â€1234â€}</code> )</ul><p>åŸ·è¡Œå®Œæˆå¾Œå¯çœ‹åˆ°åŸ·è¡Œçµæœï¼š</p><p><a href="/assets/9659db1357e4/1*BUcMfJJ4x_mgK0HHLc6C4g.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*BUcMfJJ4x_mgK0HHLc6C4g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzODYiIGhlaWdodD0iMTk4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><code class="language-plaintext highlighter-rouge">successful_transactions: 100</code> è¡¨ç¤º 100 æ¬¡éƒ½åŸ·è¡ŒæˆåŠŸã€‚</p><p><strong>å¯ä»¥å› Firebase -&gt; Firestore æŸ¥çœ‹çµæœæ˜¯å¦æœ‰ Loss Dataï¼š</strong></p><p><a href="/assets/9659db1357e4/1*wd5z743Zp9xtjKhhcMaVOg.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*wd5z743Zp9xtjKhhcMaVOg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjY5IiBoZWlnaHQ9IjYwOSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p>æˆåŠŸï¼</p></blockquote><h4 id="å®Œæ•´-example-code"><span class="me-2">å®Œæ•´ Example Code</span><a href="#å®Œæ•´-example-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="c1">// Insert</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">title</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">author</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span><span class="nx">content</span><span class="p">,</span> <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="nx">author</span><span class="p">,</span> <span class="dl">"</span><span class="s2">created_at</span><span class="dl">"</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–°å¢æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Update</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">title</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">author</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span><span class="nx">title</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span><span class="nx">content</span><span class="p">,</span> <span class="dl">"</span><span class="s2">author</span><span class="dl">"</span><span class="p">:</span> <span class="nx">author</span><span class="p">};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">update</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">ä¿®æ”¹æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Delete</span>
<span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">posts</span><span class="dl">"</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="k">delete</span><span class="p">();</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–‡ç« æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Select List</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">posts</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">();</span>
      <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">id</span><span class="p">,</span> <span class="p">...</span><span class="nx">data</span><span class="p">})</span>
    <span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span><span class="nx">result</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Select One</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">...</span><span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">()}});</span>
<span class="p">});</span>

<span class="c1">// InsertOrUpdate</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/tag</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="nx">name</span><span class="p">};</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">tags</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nf">set</span><span class="p">({</span><span class="na">created_at</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ–°å¢æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Like Post</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/like/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">.</span><span class="nx">FieldValue</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">set</span><span class="p">({</span><span class="na">likeCount</span><span class="p">:</span> <span class="nx">increment</span><span class="p">},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æŒ‰è®šæˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Distributed counters Like Post</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/like2/:id</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">.</span><span class="nx">FieldValue</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æ‰¾ä¸åˆ°æ–‡ç« ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">//1~10</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">likeCounter</span><span class="dl">"</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="dl">"</span><span class="s2">likeCount_</span><span class="dl">"</span><span class="o">+</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">set</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="nx">increment</span><span class="p">},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">æŒ‰è®šæˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
<span class="p">});</span>


<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span><span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="å›æ­¸ä¸»é¡Œæ¨æ’­çµ±è¨ˆ"><span class="me-2">å›æ­¸ä¸»é¡Œï¼Œæ¨æ’­çµ±è¨ˆ</span><a href="#å›æ­¸ä¸»é¡Œæ¨æ’­çµ±è¨ˆ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å›åˆ°ä¸€é–‹å§‹æˆ‘å€‘æƒ³åšçš„ï¼Œæ¨æ’­çµ±è¨ˆåŠŸèƒ½ã€‚</p><p>index.js:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">admin</span><span class="p">.</span><span class="nf">initializeApp</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nf">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="kd">const</span> <span class="nx">vaildPlatformTypes</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">iOS</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">Android</span><span class="dl">"</span><span class="p">]</span>
<span class="kd">const</span> <span class="nx">vaildActionTypes</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">clicked</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">received</span><span class="dl">"</span><span class="p">]</span>

<span class="c1">// Insert Log</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">firestore</span><span class="p">.</span><span class="nx">FieldValue</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">platformType</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">platformType</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">pushID</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pushID</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">actionType</span> <span class="o">=</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">actionType</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">vaildPlatformTypes</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">platformType</span><span class="p">)</span> <span class="o">||</span> <span class="nx">pushID</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="o">!</span><span class="nx">vaildActionTypes</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">actionType</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">åƒæ•¸éŒ¯èª¤ï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="nx">platformType</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="nx">actionType</span><span class="o">+</span><span class="dl">"</span><span class="s2">_</span><span class="dl">"</span><span class="o">+</span><span class="nx">pushID</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">shards</span><span class="dl">"</span><span class="p">).</span><span class="nf">doc</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">set</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="nx">increment</span><span class="p">},</span> <span class="p">{</span><span class="na">merge</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">ç´€éŒ„æˆåŠŸï¼</span><span class="dl">"</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// View Log</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/:type/:id</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// received</span>
    <span class="kd">const</span> <span class="nx">receivedDocs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">type</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="dl">"</span><span class="s2">received_</span><span class="dl">"</span><span class="o">+</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">shards</span><span class="dl">"</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">received</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">receivedDocs</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">received</span> <span class="o">+=</span> <span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">().</span><span class="nx">count</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">// clicked</span>
    <span class="kd">const</span> <span class="nx">clickedDocs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nf">firestore</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">type</span><span class="p">).</span><span class="nf">doc</span><span class="p">(</span><span class="dl">"</span><span class="s2">clicked_</span><span class="dl">"</span><span class="o">+</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">shards</span><span class="dl">"</span><span class="p">).</span><span class="nf">get</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">clickedDocs</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">clicked</span> <span class="o">+=</span> <span class="nx">doc</span><span class="p">.</span><span class="nf">data</span><span class="p">().</span><span class="nx">count</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">received</span><span class="dl">"</span><span class="p">:</span><span class="nx">received</span><span class="p">,</span><span class="dl">"</span><span class="s2">clicked</span><span class="dl">"</span><span class="p">:</span><span class="nx">clicked</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">notification</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nf">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</pre></table></code></div></div><h4 id="æ–°å¢æ¨æ’­ç´€éŒ„"><span class="me-2">æ–°å¢æ¨æ’­ç´€éŒ„</span><a href="#æ–°å¢æ¨æ’­ç´€éŒ„" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/9659db1357e4/1*3koe6QBxF9oOhBDqjF5mhA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*3koe6QBxF9oOhBDqjF5mhA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDciIGhlaWdodD0iNDIyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="æª¢è¦–æ¨æ’­çµ±è¨ˆæ•¸å­—"><span class="me-2">æª¢è¦–æ¨æ’­çµ±è¨ˆæ•¸å­—</span><a href="#æª¢è¦–æ¨æ’­çµ±è¨ˆæ•¸å­—" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://us-centra1-xxx.cloudfunctions.net/notification/iOS/1
</pre></table></code></div></div><p><a href="/assets/9659db1357e4/1*SStEkNoDjiL7pffC2pHDkQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*SStEkNoDjiL7pffC2pHDkQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDE3IiBoZWlnaHQ9IjQ4NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>å¦å¤–ä¹Ÿåšäº†å€‹ä»‹é¢çµ±è¨ˆæ¨æ’­æ•¸å­—ã€‚</p><h4 id="è¸©å‘"><span class="me-2">è¸©å‘</span><a href="#è¸©å‘" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><em>å› ç‚ºå° node.js ç”¨æ³•ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸€é–‹å§‹æ‘¸ç´¢çš„æ™‚å€™åœ¨ add è³‡æ–™æ™‚æ²’åŠ ä¸Š <code class="language-plaintext highlighter-rouge">await</code> å†åŠ ä¸Šå¯«å…¥é€Ÿåº¦é™åˆ¶ï¼Œå°è‡´åœ¨å¤§æµé‡æƒ…æ³ä¸‹æœƒ Data Lossâ€¦</em></p></blockquote><p><a href="/assets/9659db1357e4/1*dVsBhKJQ3qqxlSvv-mCENA.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*dVsBhKJQ3qqxlSvv-mCENA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NDUiIGhlaWdodD0iMTg4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h3 id="pricing"><span class="me-2">Pricing</span><a href="#pricing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>åˆ¥å¿˜äº†åƒè€ƒ Firebase Functions &amp; Firestore çš„å®šåƒ¹ç­–ç•¥ã€‚</p><h4 id="functions"><span class="me-2">Functions</span><a href="#functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://cloud.google.com/functions/pricing?hl=zh-tw" target="_blank">https://cloud.google.com/functions/pricing?hl=zh-tw</a></ul><p><a href="/assets/9659db1357e4/1*76yRqeDyrp0kFmGHN4ZNXg.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*76yRqeDyrp0kFmGHN4ZNXg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDIwIiBoZWlnaHQ9IjI2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/9659db1357e4/1*G_At8v80BQl81EUqPuUIbQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*G_At8v80BQl81EUqPuUIbQ.webp" alt="é‹ç®—æ™‚é–“" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTM4IiBoZWlnaHQ9IjU2NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹ç®—æ™‚é–“</p><p><a href="/assets/9659db1357e4/1*iXk7oKFidHfzRVwrDvKX0A.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*iXk7oKFidHfzRVwrDvKX0A.webp" alt="ç¶²è·¯" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM1MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>ç¶²è·¯</p><blockquote><p><em>Cloud Functions é‡å°é‹ç®—æ™‚é–“è³‡æºæä¾›æ°¸ä¹…å…è²»æ–¹æ¡ˆï¼Œç•¶ä¸­åŒ…å« GB/ç§’å’Œ GHz/ç§’çš„é‹ç®—æ™‚é–“ã€‚é™¤äº† 200 è¬æ¬¡å«ç”¨ä»¥å¤–ï¼Œå…è²»æ–¹æ¡ˆä¹Ÿæä¾› 400,000 GB/ç§’å’Œ 200,000 GHz/ç§’çš„é‹ç®—æ™‚é–“ï¼Œä»¥åŠæ¯æœˆ 5 GB çš„ç¶²éš›ç¶²è·¯è¼¸å‡ºæµé‡ã€‚</em></p></blockquote><h4 id="firestore"><span class="me-2">Firestore</span><a href="#firestore" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://cloud.google.com/firestore/pricing?hl=zh-tw" target="_blank">https://cloud.google.com/firestore/pricing?hl=zh-tw</a></ul><p><a href="/assets/9659db1357e4/1*ylduiqevk4WH-eNc8EOpvQ.webp" class="popup img-link blur"><img data-src="/assets/9659db1357e4/1*ylduiqevk4WH-eNc8EOpvQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjUwMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><a href="https://cloud.google.com/firestore/docs/billing-example?hl=zh-tw" target="_blank">è¨ˆç®—ç¯„ä¾‹</a></ul><blockquote><p><strong><em>åƒ¹æ ¼å¯èƒ½éš¨æ™‚æ›´æ”¹ï¼Œè«‹ä»¥å®˜ç¶²æœ€æ–°è³‡è¨Šç‚ºæº–ã€‚</em></strong></p></blockquote><h3 id="çµè«–"><span class="me-2">çµè«–</span><a href="#çµè«–" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å¦‚åŒæ¨™é¡Œæ‰€å¯«ã€Œå¯ä¾›æ¸¬è©¦ã€ã€ã€Œå¯ä¾›æ¸¬è©¦ã€ã€ã€Œå¯ä¾›æ¸¬è©¦ã€ä¸å¤ªå»ºè­°å°‡ä»¥ä¸Šæœå‹™ç”¨æ–¼æ­£å¼ç’°å¢ƒï¼Œç”šè‡³ç•¶ä½œç”¢å“çš„æ ¸å¿ƒä¸Šç·šã€‚</p><h4 id="æ”¶è²»è²´é›£é·ç§»"><span class="me-2">æ”¶è²»è²´ã€é›£é·ç§»</span><a href="#æ”¶è²»è²´é›£é·ç§»" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä¹‹å‰æ›¾è½èªªæŸå€‹è »å¤§çš„æœå‹™å°±æ˜¯ä½¿ç”¨ Firebase æœå‹™æ­å»ºèµ·å®¶ï¼Œçµæœå¾ŒæœŸè³‡æ–™ã€æµé‡å¤§ï¼Œæ”¶è²»çˆ†è²´ï¼›è¦è½‰ç§»ä¹Ÿå¾ˆå›°é›£ï¼Œç¨‹å¼é‚„å¥½ä½†è³‡æ–™éå¸¸é›£æ¬ï¼›åªèƒ½èªªæ˜¯åˆæœŸçœäº†å°éŒ¢å»é€ æˆå¾ŒæœŸå·¨å¤§çš„è™§æï¼Œä¸å€¼å¾—ã€‚</p><h4 id="åƒ…ä¾›æ¸¬è©¦"><span class="me-2">åƒ…ä¾›æ¸¬è©¦</span><a href="#åƒ…ä¾›æ¸¬è©¦" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å› ç‚ºä»¥ä¸ŠåŸå› ï¼Œä½¿ç”¨ Firebase Functions + Firestore æ­å»ºçš„ API æœå‹™å€‹äººå»ºè­°åƒ…ä¾›æ¸¬è©¦æˆ–æ˜¯ Prototype ç”¢å“å±•ç¤ºã€‚</p><h4 id="æ›´å¤šåŠŸèƒ½"><span class="me-2">æ›´å¤šåŠŸèƒ½</span><a href="#æ›´å¤šåŠŸèƒ½" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Functions é‚„å¯ä»¥ä¸² Authentication(èº«ä»½é©—è­‰)ã€Storage(æª”æ¡ˆä¸Šå‚³)ï¼Œä½†é€™éƒ¨åˆ†æˆ‘å°±æ²’ç ”ç©¶äº†ã€‚</p><h3 id="åƒè€ƒè³‡æ–™"><span class="me-2">åƒè€ƒè³‡æ–™</span><a href="#åƒè€ƒè³‡æ–™" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://firebase.google.com/docs/firestore/query-data/queries" target="_blank">https://firebase.google.com/docs/firestore/query-data/queries</a><li><a href="https://coder.tw/?p=7198" target="_blank">https://coder.tw/?p=7198</a><li><a href="https://firebase.google.com/docs/firestore/solutions/counters#node.js_1" target="_blank">https://firebase.google.com/docs/firestore/solutions/counters#node.js_1</a><li><a href="https://javascript.plainenglish.io/firebase-cloud-functions-tutorial-creating-a-rest-api-8cbc51479f80" target="_blank">https://javascript.plainenglish.io/firebase-cloud-functions-tutorial-creating-a-rest-api-8cbc51479f80</a></ul><h3 id="å»¶ä¼¸é–±è®€"><span class="me-2">å»¶ä¼¸é–±è®€</span><a href="#å»¶ä¼¸é–±è®€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/python-æ­é…-google-cloud-platform-èˆ‡-line-bot-æ‰“é€ æ¯æ—¥è‡ªå‹•ç°½åˆ°è…³æœ¬èˆ‡æ’ç¨‹-70a1409b149a/">ä½¿ç”¨ Python+Google Cloud Platform+Line Bot è‡ªå‹•åŸ·è¡Œä¾‹è¡Œç‘£äº‹</a><li><a href="/posts/zrealm-dev/ios-notification-service-extension-swift-å¯¦ä½œåœ–ç‰‡æ¨æ’­èˆ‡é¡¯ç¤ºçµ±è¨ˆæŠ€å·§-cb6eba52a342/">i <strong>OS â‰¥ 10 Notification Service Extension æ‡‰ç”¨ (Swift)</strong></a><li><a href="/posts/zrealm-dev/google-apps-script-æ•™å­¸-è‡ªå‹•è½‰ç™¼-gmail-éƒµä»¶åˆ°-slack-channel-å®¢è£½åŒ–é€šçŸ¥-d414bdbdb8c9/">é‹ç”¨ Google Apps Script è½‰ç™¼ Gmail ä¿¡ä»¶åˆ° Slack</a></ul><p>æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ <a href="https://www.zhgchg.li/contact" target="_blank">èˆ‡æˆ‘è¯çµ¡</a> ã€‚</p><hr /><blockquote class="prompt-info"><p>æœ¬æ–‡é¦–æ¬¡ç™¼è¡¨æ–¼ Medium â¡ï¸ <a href="https://medium.com/p/9659db1357e4" target="_blank"><strong>å‰å¾€æŸ¥çœ‹</strong></a>ï¼Œç”± <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> èˆ‡ <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> æä¾›è‡ªå‹•è½‰æ›èˆ‡åŒæ­¥æŠ€è¡“ã€‚</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2021-03-23-9659db1357e4.md" target="_blank">Improve this page on Github.</a></p></blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=ğŸº&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 3,301 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-20 | 3,225 Views on <a href="https://medium.com/p/9659db1357e4" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/firebase/" class="post-tag no-text-decoration" >firebase</a> <a href="/tags/google-cloud-platform/" class="post-tag no-text-decoration" >google-cloud-platform</a> <a href="/tags/notifications/" class="post-tag no-text-decoration" >notifications</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Firebase%20Firestore%EF%BD%9CFunctions%20%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8%20API%20%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Ffirebase-firestore-functions-%25E5%25BF%25AB%25E9%2580%259F%25E6%2589%2593%25E9%2580%25A0%25E6%25B8%25AC%25E8%25A9%25A6%25E7%2594%25A8-api-%25E6%259C%258D%25E5%258B%2599%25E6%2595%2599%25E5%25AD%25B8%25E8%2588%2587%25E6%258E%25A8%25E6%2592%25AD%25E7%25B5%25B1%25E8%25A8%2588%25E5%25AF%25A6%25E4%25BD%259C-9659db1357e4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Firebase%20Firestore%EF%BD%9CFunctions%20%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E6%B8%AC%E8%A9%A6%E7%94%A8%20API%20%E6%9C%8D%E5%8B%99%E6%95%99%E5%AD%B8%E8%88%87%E6%8E%A8%E6%92%AD%E7%B5%B1%E8%A8%88%E5%AF%A6%E4%BD%9C%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Ffirebase-firestore-functions-%25E5%25BF%25AB%25E9%2580%259F%25E6%2589%2593%25E9%2580%25A0%25E6%25B8%25AC%25E8%25A9%25A6%25E7%2594%25A8-api-%25E6%259C%258D%25E5%258B%2599%25E6%2595%2599%25E5%25AD%25B8%25E8%2588%2587%25E6%258E%25A8%25E6%2592%25AD%25E7%25B5%25B1%25E8%25A8%2588%25E5%25AF%25A6%25E4%25BD%259C-9659db1357e4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Ffirebase-firestore-functions-%25E5%25BF%25AB%25E9%2580%259F%25E6%2589%2593%25E9%2580%25A0%25E6%25B8%25AC%25E8%25A9%25A6%25E7%2594%25A8-api-%25E6%259C%258D%25E5%258B%2599%25E6%2595%2599%25E5%25AD%25B8%25E8%2588%2587%25E6%258E%25A8%25E6%2592%25AD%25E7%25B5%25B1%25E8%25A8%2588%25E5%25AF%25A6%25E4%25BD%259C-9659db1357e4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxingï½œPremium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch åŸå» ä¸é½é‹¼ç±³è˜­éŒ¶å¸¶é–‹ç®±</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guideï½œ8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E9%BB%9E-%E7%BE%8E%E9%A3%9F%E8%88%87%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AD%89%E7%9C%81%E9%8C%A2%E7%A7%98%E8%A8%A3-8ace34a1a3d8/">éŠè¨˜ 2025 éŸ“åœ‹é‡œå±± 8 å¤© 7 å¤œè‡ªç”±è¡Œ</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/nagoya-one-day-quick-trip-peach-aviation-flight-experience-and-travel-tips-7b8a0563c157/">Nagoya One-Day Quick Tripï½œPeach Aviation Flight Experience and Travel Tips</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">ç« ç¯€ (Chapters)ğŸ”–</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E6%8A%80%E8%A1%93%E5%AF%A6%E6%88%B0-ios-%E6%9C%AC%E5%9C%B0%E7%B7%A9%E5%AD%98%E5%84%AA%E5%8C%96%E6%94%BB%E7%95%A5-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer é‚Šæ’­é‚Š Cache æŠ€è¡“å¯¦æˆ°ï½œiOS æœ¬åœ°ç·©å­˜å„ªåŒ–æ”»ç•¥</h4><div class="text-muted"><p>é‡å° iOS é–‹ç™¼è€…é¢è‡¨ AVPlayer æ’­æ”¾æ™‚ç·©å­˜ä¸è¶³å•é¡Œï¼Œè§£æ AVAssetResourceLoaderDelegate å¯¦ä½œæŠ€å·§ï¼Œæœ‰æ•ˆæå‡æ’­æ”¾æµæš¢åº¦èˆ‡æœ¬åœ°ç·©å­˜æ•ˆç‡ï¼Œæ¸›å°‘é‡è¤‡ä¸‹è¼‰èˆ‡å»¶é²ï¼Œæ‰“é€ ç©©å®šéŸ³æ¨‚èˆ‡å½±ç‰‡æ’­æ”¾å™¨é«”é©—ã€‚</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-robotic-process-automation/google-apps-script-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5-firebase-app-distribution-api-%E6%95%99%E5%AD%B8%E8%88%87%E9%80%B2%E9%9A%8E%E8%A8%AD%E5%AE%9A-71400d408dc8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1742479968" data-df="ll" > Mar 20, 2025 </time><h4 class="pt-0 my-2">Google Apps Script x Google APIs å¿«é€Ÿä¸²æ¥æ•´åˆæ–¹å¼</h4><div class="text-muted"><p>ä»¥ Google Apps Script x Firebase App Distribution API ä¸²æ¥ç‚ºä¾‹</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/crashlytics-big-query-%E4%B8%B2%E6%8E%A5%E6%95%99%E5%AD%B8-%E8%87%AA%E5%8B%95%E6%9F%A5%E8%A9%A2%E4%B8%A6%E8%BD%89%E7%99%BC-ios-app-%E9%96%83%E9%80%80%E5%A0%B1%E5%91%8A%E5%88%B0-slack-e77b80cc6f89/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1634654010" data-df="ll" > Oct 19, 2021 </time><h4 class="pt-0 my-2">Crashlytics + Big Query æ‰“é€ æ›´å³æ™‚ä¾¿åˆ©çš„ Crash è¿½è¹¤å·¥å…·</h4><div class="text-muted"><p>ä¸²æ¥ Crashlytics å’Œ Big Query è‡ªå‹•è½‰ç™¼é–ƒé€€è¨˜éŒ„åˆ° Slack Channel</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/en/firebase-firestore-functions-build-testable-api-services-fast-for-push-notification-analytics-9659db1357e4/" class="btn btn-outline-primary" aria-label="Older" ><p>Firebase Firestore + Functionsï½œBuild Testable API Services Fast for Push Notification Analytics</p></a> <a href="/posts/zrealm-dev/en/appstore-reviews-bot-automate-app-review-tracking-with-slack-notifications-cb0c68c33994/" class="btn btn-outline-primary" aria-label="Newer" ><p>AppStore Reviews Botï½œAutomate APP Review Tracking with Slack Notifications</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">ä¸­æ–‡</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-21 09:26:25 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">iOS App Development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios app development</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">Swift</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
