<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Discover how to implement real-time caching for m3u8 streaming on iOS using AVPlayer, solving buffering issues and enhancing playback smoothness for seamless video experiences." /><meta property="og:description" content="Discover how to implement real-time caching for m3u8 streaming on iOS using AVPlayer, solving buffering issues and enhancing playback smoothness for seamless video experiences." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-09T01:12:17+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" /><meta property="twitter:title" content="iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://www.linkedin.com/in/zhgchgli"},"dateModified":"2024-04-13T16:09:26+08:00","datePublished":"2020-04-09T01:12:17+08:00","description":"Discover how to implement real-time caching for m3u8 streaming on iOS using AVPlayer, solving buffering issues and enhancing playback smoothness for seamless video experiences.","headline":"iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/"}</script><title>iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=false" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-hls-cache-%E5%AE%9E%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E8%BE%B9%E6%92%AD%E8%BE%B9%E5%BF%AB%E5%8F%96%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90-d796bf8e661e/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E9%82%8A%E6%92%AD%E9%82%8A%E5%BF%AB%E5%8F%96%E6%8A%80%E8%A1%93%E8%A7%A3%E6%9E%90-d796bf8e661e/"><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan üáπüáº who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="https://medium.com/@zhgchgli" class="nav-link" target="_blank" style="background: #EDF4FF; color: #0A84FF;"> <i class="fa-brands fa-medium"></i> <span>Follow Me!<br/><strong>1,049+</strong> Followers</span> </a><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques</h1><p class="post-desc fw-light mb-4">Discover how to implement real-time caching for m3u8 streaming on iOS using AVPlayer, solving buffering issues and enhancing playback smoothness for seamless video experiences.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1586365937" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 9, 2020 </time> </span> <span> Updated <time data-ts="1712995766" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" class="popup img-link preview-img blur"><img data-src="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://www.linkedin.com/in/zhgchgli">ZhgChgLi</a> </em> | <em><a href="https://www.linkedin.com/in/zhgchgli" target="_blank">Senior Software Engineer</a></em><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2004 words" > <em>11 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Chapters üîñ</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS HLS CacheÔΩúOptimize AVPlayer Streaming with Real-Time Caching Techniques</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/ios-hls-cache-%E5%AE%9E%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E8%BE%B9%E6%92%AD%E8%BE%B9%E5%BF%AB%E5%8F%96%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90-d796bf8e661e/"><strong>ÁÇπÂáªËøôÈáå</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†ÁÆÄ‰Ωì‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E9%82%8A%E6%92%AD%E9%82%8A%E5%BF%AB%E5%8F%96%E6%8A%80%E8%A1%93%E8%A7%A3%E6%9E%90-d796bf8e661e/"><strong>ÈªûÊìäÈÄôË£°</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†Ê≠£È´î‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance ‚Äî let me know if anything sounds off!</p></blockquote><h4 id="zhgchgli-table-of-contents">Table of Contents</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li><a href="#exploring-practical-methods-for-ios-hls-cache-implementation">Exploring Practical Methods for iOS HLS Cache Implementation</a></li><li class="has-children"><details><summary>How to Enable Simultaneous Playback and Caching When Using AVPlayer to Play m3u8 Streaming Media Files <a href="#how-to-enable-simultaneous-playback-and-caching-when-using-avplayer-to-play-m3u8-streaming-media-files">#</a></summary><ul><li><a href="#20230312-update">[2023/03/12] Update</a></li><li><a href="#about">About</a></li><li><a href="#goal">Goal</a></li><li><a href="#question">Question</a></li><li><a href="#20210105-update">2021‚Äì01‚Äì05 Update</a></li><li class="has-children"><details><summary>Implementation Plan <a href="#implementation-plan">#</a></summary><ul><li><a href="#option-1-avassetresourceloaderdelegate-">Option 1. AVAssetResourceLoaderDelegate ‚ùå</a></li><li><a href="#option-21-urlprotocol-intercept-requests-">Option 2.1 URLProtocol Intercept Requests ‚ùå</a></li><li><a href="#plan-22-forcibly-allow-urlprotocol-">Plan 2.2 Forcibly Allow URLProtocol ‚ùå</a></li><li><a href="#plan-222--same-as-plan-22-but-implemented-with-plan-1-avassetresourceloaderdelegate-">Plan 2.2‚Äì2 ‚Äì Same as Plan 2.2 but implemented with Plan 1 AVAssetResourceLoaderDelegate ‚ùå</a></li><li><a href="#option-3-reverse-proxy-server--feasible-but-imperfect">Option 3. Reverse Proxy Server ‚çª (Feasible but Imperfect)</a></li><li><a href="#option-4-using-the-http-clients-own-caching-mechanism-">Option 4. Using the HTTP Client‚Äôs own caching mechanism ‚ùå</a></li><li><a href="#solution-5-playing-audio-files-without-using-avfoundation-avplayer-">Solution 5. Playing Audio Files Without Using AVFoundation AVPlayer ‚úî</a></li><li><a href="#plan-51-without-using-hls">Plan 5‚Äì1. Without Using HLS</a></li><li><a href="#solution-6-convert-ts-split-files-to-mp3mp4-files-">Solution 6. Convert .ts Split Files to .mp3/.mp4 Files ‚úî</a></li><li><a href="#option-7-download-the-complete-file-before-playing-">Option 7. Download the complete file before playing ‚çª</a></li></ul></details></li><li class="has-children"><details><summary>Conclusion <a href="#conclusion">#</a></summary><ul><li><a href="#references">References</a></li></ul></details></li></ul></details></li></ul></nav><hr /><h3 id="exploring-practical-methods-for-ios-hls-cache-implementation"><span class="me-2">Exploring Practical Methods for iOS HLS Cache Implementation</span><a href="#exploring-practical-methods-for-ios-hls-cache-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h1 id="how-to-enable-simultaneous-playback-and-caching-when-using-avplayer-to-play-m3u8-streaming-media-files">How to Enable Simultaneous Playback and Caching When Using AVPlayer to Play m3u8 Streaming Media Files</h1><p><a href="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" class="popup img-link blur"><img data-src="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" alt="photo by [Mihis Alex](https://www.pexels.com/zh-tw/@mcraftpix?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>photo by <a href="https://www.pexels.com/zh-tw/@mcraftpix?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank">Mihis Alex</a></p><h4 id="20230312-update"><span class="me-2">[2023/03/12] Update</span><a href="#20230312-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Next article: ‚Äú<a href="/posts/zrealm-dev/en/avplayer-local-cache-implementation-master-avassetresourceloaderdelegate-for-smooth-playback-6ce488898003/">Complete Guide to Implementing Local Cache with AVPlayer</a>‚Äù teaches you how to implement AVPlayer caching.</ul><p><a href="https://github.com/ZhgChgLi/ZPlayerCacher" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/612890185/346ae563-7278-4518-a19b-f5d367e60adc" alt="" loading="lazy"></a></p><p>I have open-sourced my previous implementation. Feel free to use it if you need.</p><ul><li><p>Custom cache strategies can use PINCache or others‚Ä¶</p><li><p>Externally, just call the AVAsset factory with the URL, and the AVAsset will support caching.</p><li><p>Using Combine to implement data flow strategy</p><li><p>Wrote some tests</p></ul><h3 id="about"><span class="me-2">About</span><a href="#about" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>HTTP Live Streaming (HLS) is an Apple-proposed HTTP-based streaming media network transmission protocol.</p><p>For playing music, in non-streaming cases, we use mp3 files as music files. The playback can only start after the entire file is downloaded, which takes time depending on the file size. HLS, on the other hand, splits a file into multiple small segments and plays as it reads. So, playback can start as soon as the first segment is received, without downloading the whole file!</p><p><code class="language-plaintext highlighter-rouge">.m3u8</code> files record the bitrate, playback order, duration of the segmented <code class="language-plaintext highlighter-rouge">.ts</code> files, and overall audio information. They can also support encryption, decryption, low-latency streaming, and more.</p><p><code class="language-plaintext highlighter-rouge">.m3u8</code> file example (aviciiwakemeup.m3u8):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>#EXTM3U
#EXT-X-VERSION:3
#EXT-X-ALLOW-CACHE:YES
#EXT-X-TARGETDURATION:10
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:9.900411,
aviciiwakemeup‚Äì00001.ts
#EXTINF:9.900400,
aviciiwakemeup‚Äì00002.ts
#EXTINF:9.900411,
aviciiwakemeup‚Äì00003.ts
#EXTINF:9.900411,
.
.
.
#EXTINF:6.269389,
aviciiwakemeup-00028.ts
#EXT-X-ENDLIST
</pre></table></code></div></div><p><strong>EXT-X-ALLOW-CACHE has been deprecated in <a href="https://developer.apple.com/documentation/http_live_streaming/about_the_ext-x-version_tag?language=objc" target="_blank">iOS‚â• 8/Protocol Ver.7</a>, so including it has no effect.</strong></p><h3 id="goal"><span class="me-2">Goal</span><a href="#goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For a streaming service, <strong>Cache is extremely important</strong>; each audio file can range from a few MB to several GB. If the file has to be fetched from the server every time it is replayed, it puts a heavy load on the server and consumes a lot of bandwidth, which is costly \(\). Having a cache layer can save the service a lot of money and also prevent users from wasting network data and time on re-downloading. It‚Äôs a win-win mechanism (but remember to set limits and clear the cache periodically to avoid filling up the user‚Äôs device).</p><h3 id="question"><span class="me-2">Question</span><a href="#question" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the past, before streaming, there was not much to handle with mp3/mp4 files. The files were downloaded to the device before playback, and playback would start only after the download was complete. Since the entire file had to be downloaded anyway, we could simply use URLSession to download the file first, then feed the local file path with a file:// URL to AVPlayer for playback. Alternatively, the proper way is to use AVAssetResourceLoaderDelegate to cache the downloaded data within the delegate methods.</p><p>The idea behind streaming is actually straightforward: first read the <code class="language-plaintext highlighter-rouge">.m3u8</code> file, then parse the information inside, and cache each <code class="language-plaintext highlighter-rouge">.ts</code> file; but in practice, it turned out to be more complicated than I expected, which is why I wrote this article!</p><p>For playback, we use iOS AVFoundation‚Äôs AVPlayer directly. There is no difference in handling streaming or non-streaming files.</p><p><strong>Example:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">url</span><span class="p">:</span><span class="kt">URL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"https://zhgchg.li/aviciiwakemeup.m3u8"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span> <span class="c1">// Play the media</span>
</pre></table></code></div></div><h3 id="20210105-update"><span class="me-2"><strong>2021‚Äì01‚Äì05 Update:</strong></span><a href="#20210105-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As a fallback, we switch back to using mp3 files, which allows direct implementation with <code class="language-plaintext highlighter-rouge">AVAssetResourceLoaderDelegate</code>. For detailed implementation, refer to ‚Äú<a href="/posts/en/avplayer-streaming-with-cache-implement-avassetresourceloaderdelegate-for-smooth-playback-ee47f8f1e2d2/">AVPlayer Streaming Cache Practical Guide</a>‚Äù.</p><h3 id="implementation-plan"><span class="me-2">Implementation Plan</span><a href="#implementation-plan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Regarding several solutions to achieve our goals and the challenges encountered during implementation.</p><h4 id="option-1-avassetresourceloaderdelegate-"><span class="me-2">Option 1. AVAssetResourceLoaderDelegate ‚ùå</span><a href="#option-1-avassetresourceloaderdelegate-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first idea is to follow the same approach as with mp3/mp4! Use AVAssetResourceLoaderDelegate to cache <code class="language-plaintext highlighter-rouge">.ts</code> files within the delegate methods.</p><p>However, sorry, this approach won‚Äôt work because the download request information for <code class="language-plaintext highlighter-rouge">.ts</code> files cannot be intercepted in the Delegate. You can refer to this <a href="https://stackoverflow.com/questions/29752028/unknown-error-12881-when-using-avassetresourceloader/30239876#30239876" target="_blank">Q&amp;A</a> and the <a href="https://developer.apple.com/library/archive/technotes/tn2232/_index.html#//apple_ref/doc/uid/DTS40012884-CH1-SECHTTPLIVESTREAMING" target="_blank">official documentation</a> for details on this issue.</p><p>The implementation of AVAssetResourceLoaderDelegate can refer to ‚Äú<a href="/posts/en/avplayer-streaming-with-cache-implement-avassetresourceloaderdelegate-for-smooth-playback-ee47f8f1e2d2/">AVPlayer Streaming and Caching in Practice</a>‚Äù.</p><h4 id="option-21-urlprotocol-intercept-requests-"><span class="me-2">Option 2.1 URLProtocol Intercept Requests ‚ùå</span><a href="#option-21-urlprotocol-intercept-requests-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>URLProtocol is a method I recently learned. All requests based on the <code class="language-plaintext highlighter-rouge">URL Loading System</code> (URLSession, API calls, image downloads, etc.) can be intercepted by us to modify the Request and Response, then returned as if nothing happened‚Äîsecretly. For more on URLProtocol, refer to <a href="https://www.jianshu.com/p/fbe57730d3e1" target="_blank">this article</a>.</p><p>Using this method, we plan to intercept AVFoundation AVPlayer requests for <code class="language-plaintext highlighter-rouge">.m3u8</code> and <code class="language-plaintext highlighter-rouge">.ts</code> files. If there is a local cache, we return the cached data directly; if not, we send the actual request. This approach helps us achieve our goal.</p><p>Similarly, sorry, this path also doesn‚Äôt work; because AVFoundation AVPlayer requests are not made through the <code class="language-plaintext highlighter-rouge">URL Loading System</code>, we cannot intercept them.<br /> <strong>There is a saying that it works on the simulator but not on a real device</strong></p><h4 id="plan-22-forcibly-allow-urlprotocol-"><span class="me-2">Plan 2.2 Forcibly Allow URLProtocol ‚ùå</span><a href="#plan-22-forcibly-allow-urlprotocol-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>According to Plan 2.1, the wildly creative brute force method, if I change the request URL to a custom scheme (e.g., streetVoiceCache://), since AVFoundation cannot handle this request, it will throw it out. This way, our URLProtocol can intercept it and do what we want.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">url</span><span class="p">:</span><span class="kt">URL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
</pre></table></code></div></div><p>URLProtocol intercepts <code class="language-plaintext highlighter-rouge">streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https</code>. At this point, we just need to restore it to the original URL, then use URLSession to request the data, allowing us to handle caching here. Requests for <code class="language-plaintext highlighter-rouge">.ts</code> files in the m3u8 will also be intercepted by URLProtocol, enabling us to cache them as well.</p><p>Everything seemed perfect, but when I excitedly Build-Run the app, Apple slapped me hard:</p><p><code class="language-plaintext highlighter-rouge">Error: 12881 ‚ÄúCoreMediaErrorDomain custom url not redirect‚Äù</code></p><p>He does not accept the <code class="language-plaintext highlighter-rouge">.ts</code> file Request Response Data I provide. I can only use the <code class="language-plaintext highlighter-rouge">urlProtocol:wasRedirectedTo</code> method to redirect to the original HTTPS request to play properly. Even if I download the <code class="language-plaintext highlighter-rouge">.ts</code> file locally and redirect to that file:// file, it is not accepted. Checking the <a href="https://forums.developer.apple.com/thread/30833" target="_blank">official forum</a> reveals the answer: this cannot be done. The <code class="language-plaintext highlighter-rouge">.m3u8</code> must come from HTTP/HTTPS (so even if you put the entire <code class="language-plaintext highlighter-rouge">.m3u8</code> and all segmented <code class="language-plaintext highlighter-rouge">.ts</code> files locally, AVPlayer cannot play them using file://). Also, <code class="language-plaintext highlighter-rouge">.ts</code> files cannot use URLProtocol to provide Data by yourself.</p><p><code class="language-plaintext highlighter-rouge">fxxk‚Ä¶</code></p><h4 id="plan-222--same-as-plan-22-but-implemented-with-plan-1-avassetresourceloaderdelegate-"><span class="me-2">Plan 2.2‚Äì2 ‚Äì Same as Plan 2.2 but implemented with Plan 1 AVAssetResourceLoaderDelegate ‚ùå</span><a href="#plan-222--same-as-plan-22-but-implemented-with-plan-1-avassetresourceloaderdelegate-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The implementation follows method 2.2, feeding AVPlayer a custom scheme to trigger AVAssetResourceLoaderDelegate; then we handle it ourselves.</p><p>Same as 2.2 results:</p><p><code class="language-plaintext highlighter-rouge">Error: 12881 ‚ÄúCoreMediaErrorDomain custom url not redirect‚Äù</code></p><p><a href="https://forums.developer.apple.com/thread/113063" target="_blank">Official Forum</a> same answer.</p><p>Can be used for decryption processing (refer to <a href="https://medium.com/@marslin_dev/how-to-play-aes-encrypted-video-with-airplay-2-82a353044f40" target="_blank">this article</a> or <a href="https://www.jianshu.com/p/2c2cbe173e99" target="_blank">this example</a>), but caching functionality still cannot be achieved.</p><h4 id="option-3-reverse-proxy-server--feasible-but-imperfect"><span class="me-2">Option 3. Reverse Proxy Server ‚çª (Feasible but Imperfect)</span><a href="#option-3-reverse-proxy-server--feasible-but-imperfect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This method is the most common answer when looking for how to handle HLS Cache; it involves running an HTTP Server on the app to serve as a Reverse Proxy Server.</p><p>The principle is simple: the app runs an HTTP server, for example on port 8080, so the URL will be <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080/</code>; then we can handle incoming requests and provide responses.</p><p>Applied to our case, replace the request URL with:<br /> <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080/aviciiwakemeup.m3u8?origin=http://zhgchg.li/</code></p><p>In the HTTP Server‚Äôs Handler, intercept requests for <code class="language-plaintext highlighter-rouge">*.m3u8</code>. When a request comes in, it will enter our Handler, allowing us to do whatever we want. We have full control over the response data. <code class="language-plaintext highlighter-rouge">.ts</code> files will also come through here; this is where we can implement our desired caching mechanism.</p><p>For AVPlayer, it is a standard http://.m3u8 streaming audio file, so there will be no issues.</p><p><strong>A complete implementation example can be found at:</strong></p><p><a href="https://github.com/StyleShare/HLSCachingReverseProxyServer/blob/master/Sources/HLSCachingReverseProxyServer/HLSCachingReverseProxyServer.swift" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/f82feda77c302ecf87673688fe78a46bccc4669783dda9b10093ecb5382f9895/StyleShare/HLSCachingReverseProxyServer" alt="" loading="lazy"></a></p><p>Because I also referred to this example, I used <a href="https://github.com/swisspol/GCDWebServer" target="_blank">GCDWebServer</a> for the Local HTTP Server part. Additionally, there is an updated <a href="https://github.com/Building42/Telegraph" target="_blank">Telegraph</a> available. (I do not recommend <a href="https://github.com/robbiehanson/CocoaHTTPServer" target="_blank">CocoaHttpServer</a> as it has not been updated for a long time.)</p><p><strong>Looks good! But there‚Äôs a problem:</strong></p><p>Our service is music streaming, not a video playback platform. In music streaming, users often switch tracks while running the app in the background; would the Local HTTP Server still be running then??</p><p>The description of GCDWebServer states that it will automatically disconnect when entering the background and automatically resume when returning to the foreground. However, you can disable this behavior by setting the parameter <code class="language-plaintext highlighter-rouge">GCDWebServerOption_AutomaticallySuspendInBackground:false</code>.</p><p>However, in actual tests, if no requests are sent for a while, the server still disconnects (and the status is incorrect, still showing as isRunning). It feels like the system is killing it. After digging into the <a href="https://izeeshan.wordpress.com/2014/08/25/local-http-server-for-ios/" target="_blank">HTTP Server approach</a>, I found that the underlying implementation is based on sockets. After checking the <a href="https://developer.apple.com/library/archive/technotes/tn2277/_index.html" target="_blank">official documentation on socket services</a>, this issue cannot be resolved. When there are no new connections in the background, the system will suspend it.</p><p><em>*There are complicated methods found online‚Ä¶ such as sending a long request or continuously sending empty requests to ensure the server is not paused by the system in the background.</em></p><p>The above points all refer to the app running in the background. When in the foreground, the server is stable and won‚Äôt be paused due to inactivity, so this issue does not occur!</p><p><strong>Since it relies on other services, even if testing in the development environment works fine, it is recommended to implement a rollback handling (AVPlayer.AVPlayerItemFailedToPlayToEndTimeErrorKey notification) in actual use; otherwise, if the service fails, the user will be stuck.</strong></p><p><code class="language-plaintext highlighter-rouge">So it's not perfect‚Ä¶</code></p><h4 id="option-4-using-the-http-clients-own-caching-mechanism-"><span class="me-2">Option 4. Using the HTTP Client‚Äôs own caching mechanism ‚ùå</span><a href="#option-4-using-the-http-clients-own-caching-mechanism-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Our <code class="language-plaintext highlighter-rouge">.m3u8/.ts</code> files‚Äô Response Headers all include <code class="language-plaintext highlighter-rouge">Cache-Control</code>, <code class="language-plaintext highlighter-rouge">Age</code>, <code class="language-plaintext highlighter-rouge">eTag</code>, and other HTTP Client Cache information. Our website‚Äôs cache mechanism works perfectly on Chrome. Additionally, the official new preliminary specification for the <a href="https://developer.apple.com/documentation/http_live_streaming/protocol_extension_for_low-latency_hls_preliminary_specification" target="_blank">Protocol Extension for Low-Latency HLS</a> also mentions that cache-control headers can be set for caching.</p><p><a href="/assets/d796bf8e661e/1*vyvVp1sf9Hbtb_nWiLXYEg.webp" class="popup img-link blur"><img data-src="/assets/d796bf8e661e/1*vyvVp1sf9Hbtb_nWiLXYEg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzEiIGhlaWdodD0iMTM2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>However, in reality, AVFoundation AVPlayer does not have any HTTP Client Caching effect, so this approach is also ineffective! It‚Äôs just wishful thinking.</p><h4 id="solution-5-playing-audio-files-without-using-avfoundation-avplayer-"><span class="me-2">Solution 5. Playing Audio Files Without Using AVFoundation AVPlayer ‚úî</span><a href="#solution-5-playing-audio-files-without-using-avfoundation-avplayer-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Implement audio file parsing, caching, encoding, and playback functions by yourself.</p><p><strong>Too hardcore, requires deep technical skills and a lot of time; no research done.</strong></p><p>Here is an open-source online player for reference: <a href="https://github.com/muhku/FreeStreamer" target="_blank">FreeStreamer</a>. If you really want to choose this solution, it‚Äôs better to stand on the shoulders of giants and use a third-party library directly.</p><h4 id="plan-51-without-using-hls"><span class="me-2">Plan 5‚Äì1. Without Using HLS</span><a href="#plan-51-without-using-hls" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Same as Plan 5, <strong>too hardcore, requires deep technical skills and a lot of time; no research done.</strong></p><h4 id="solution-6-convert-ts-split-files-to-mp3mp4-files-"><span class="me-2">Solution 6. Convert .ts Split Files to .mp3/.mp4 Files ‚úî</span><a href="#solution-6-convert-ts-split-files-to-mp3mp4-files-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>No research done, but it is indeed feasible; however, it feels complicated. You need to handle the downloaded <code class="language-plaintext highlighter-rouge">.ts</code> files, convert each one into .mp3 or .mp4 files, then play them in order, or compress them into a single file, which sounds difficult to do.</p><p>If interested, you can refer to <a href="https://github.com/xyqjay/m3u8ToMP4" target="_blank">this article</a>.</p><h4 id="option-7-download-the-complete-file-before-playing-"><span class="me-2">Option 7. Download the complete file before playing ‚çª</span><a href="#option-7-download-the-complete-file-before-playing-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This method cannot be accurately called streaming with caching; it actually downloads the entire audio file before starting playback. For <code class="language-plaintext highlighter-rouge">.m3u8</code> files, as mentioned in solution 2.2, you cannot directly download and play them locally.</p><p>To implement this, you need to use the iOS ‚â• 10 API <code class="language-plaintext highlighter-rouge">AVAssetDownloadTask.makeAssetDownloadTask</code>. It actually packages the <code class="language-plaintext highlighter-rouge">.m3u8</code> into a <strong><code class="language-plaintext highlighter-rouge">.movpkg</code></strong> stored locally for user playback.</p><p><strong>This is more like offline playback rather than a caching feature.</strong></p><p>Users can also view and manage downloaded audio files from ‚ÄúSettings‚Äù -&gt; ‚ÄúGeneral‚Äù -&gt; ‚ÄúiPhone Storage‚Äù -&gt; APP.</p><p><a href="/assets/d796bf8e661e/1*_YNIdy8NRkhVdeDTNvXzxA.webp" class="popup img-link blur"><img data-src="/assets/d796bf8e661e/1*_YNIdy8NRkhVdeDTNvXzxA.webp" alt="Downloaded Videos Section Below" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NTAiIGhlaWdodD0iMTMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>‰∏ãÊñπ Â∑≤‰∏ãËºâÁöÑÂΩ±Áâá ÈÉ®ÂàÜ</p><p>Below is the Downloaded Videos section</p><p><strong>For detailed implementation, refer to this example:</strong></p><p><a href="https://github.com/zhonglaoban/HLS-Stream" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/a2ceae202336428494e5cd51b78cfbba3d139c135eaf232b4d2dffd2a7673eba/zhonglaoban/HLS-Stream" alt="" loading="lazy"></a></p><h3 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The above exploration took nearly a whole week, going around in circles and almost driving me crazy; currently, there is no reliable and easy-to-deploy method.</p><p>If there are new ideas, I will update again!</p><h4 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><a href="http://msching.github.io/blog/2016/05/24/audio-in-ios-9/" target="_blank">iOS Audio Playback (Part 9): Play While Caching</a></p><li><p><a href="https://github.com/StyleShare/HLSCachingReverseProxyServer" target="_blank">StyleShare/HLSCachingReverseProxyServer</a></p></ul><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><script src="/assets/clipboard.min.js"></script><div style=" display:flex; align-items:center; gap:10px; border:1px solid #e5e7eb; background:#f9fafb; padding:12px 16px; border-radius:12px; margin:18px 0; box-shadow:0 3px 8px rgba(0,0,0,0.05); width: auto;"> <input id="share-url" value="https://zhgchg.li/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/" readonly="" style=" flex:1; border:1px solid #d1d5db; border-radius:8px; padding:10px 12px; font-size:0.9rem; background:#ffffff; color:#111827; outline:none; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; " /> <button class="btn" data-clipboard-target="#share-url" id="copy-btn" style=" border:none; background:#3b82f6; color:white; padding:10px 16px; border-radius:10px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all .15s ease; box-shadow:0 2px 5px rgba(59,130,246,0.35); " onmouseover="this.style.opacity='0.92';" onmouseout="this.style.opacity='1';"> <span style="font-size:1rem;">üîó</span> <span id="copy-btn-text">Copy link to share!</span> </button></div><script> new ClipboardJS('.btn'); var btn = document.getElementById("copy-btn"); var text = document.getElementById("copy-btn-text"); btn.addEventListener("click", function () { text.textContent = "Copied!"; btn.style.background = "#16a34a"; btn.style.boxShadow = "0 2px 6px rgba(22,163,74,0.35)"; setTimeout(() => { text.textContent = "Copy link to share!"; btn.style.background = "#3b82f6"; btn.style.boxShadow = "0 2px 5px rgba(59,130,246,0.35)"; }, 1500); });</script><hr /><p><a href="https://www.paypal.com/ncp/payment/CMALMPT8UUTY2" target="_blank" rel="noopener" style="display:block;margin:12px 0;text-align:center;align-items:center;justify-content:center;padding:10px 22px;border-radius:999px;text-decoration:none;background:linear-gradient(135deg,#ffd54f,#ffb300);color:#000;font-size:16px;font-weight:700;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;box-shadow:0 4px 10px rgba(0,0,0,.15);cursor:pointer;transition:all .15s ease;width:350px" onmouseover="this.style.background=&quot;linear-gradient(135deg,#FFE082,#FFC107)&quot;,this.style.transform=&quot;translateY(-1px)&quot;,this.style.boxShadow=&quot;0 6px 14px rgba(0,0,0,0.2)&quot;" onmouseout="this.style.background=&quot;linear-gradient(135deg,#FFD54F,#FFB300)&quot;,this.style.transform=&quot;translateY(0)&quot;,this.style.boxShadow=&quot;0 4px 10px rgba(0,0,0,0.15)&quot;">üç∫ Buy me a beer on PayPal</a></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/d796bf8e661e" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2020-04-08-d796bf8e661e.md" target="_blank">Improve this page on Github.</a></p></blockquote><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1,049+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/hls/" class="post-tag no-text-decoration" >hls</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cache/" class="post-tag no-text-decoration" >cache</a> <a href="/tags/reverse-proxy/" class="post-tag no-text-decoration" >reverse-proxy</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20HLS%20Cache%EF%BD%9COptimize%20AVPlayer%20Streaming%20with%20Real-Time%20Caching%20Techniques%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20HLS%20Cache%EF%BD%9COptimize%20AVPlayer%20Streaming%20with%20Real-Time%20Caching%20Techniques%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ci-cd-explained-boost-ios-app-development-stability-and-efficiency-tool-selection-guide-c008a9e8ceca/">CI/CD Explained: Boost iOS App Development Stability and EfficiencyÔΩúTool Selection Guide</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%98%AF%E4%BB%80%E4%B9%88-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A8%B3%E5%AE%9A%E5%BC%80%E5%8F%91%E5%9B%A2%E9%98%9F%E7%9A%84%E5%85%B3%E9%94%AE%E6%B5%81%E7%A8%8B%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9-c008a9e8ceca/">CI/CD ÂÆûÊàòÊåáÂçóÔºà‰∏ÄÔºâÔºöCI/CD ÊòØ‰ªÄ‰πàÔºüÂ¶Ç‰ΩïÈÄèËøá CI/CD ÊâìÈÄ†Á®≥ÂÆöÈ´òÊïàÁöÑÂºÄÂèëÂõ¢ÈòüÔºüÂ∑•ÂÖ∑ÈÄâÊã©Ôºü</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/">CI/CD ÂØ¶Êà∞ÊåáÂçóÔºà‰∏ÄÔºâÔºöCI/CD ÊòØ‰ªÄÈ∫ºÔºüÂ¶Ç‰ΩïÈÄèÈÅé CI/CD ÊâìÈÄ†Á©©ÂÆöÈ´òÊïàÁöÑÈñãÁôºÂúòÈöäÔºüÂ∑•ÂÖ∑ÈÅ∏ÊìáÔºü</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/">Google Apps Script Web AppÔΩúIntegrate Forms with GitHub Actions CI/CD for Streamlined Workflows</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/">‰ΩøÁî® Google Apps Script Web App Ë°®Âçï‰∏≤Êé• Github Action CI/CD Â∑•‰Ωú</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Chapters üîñ</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/en/avplayer-streaming-with-cache-implement-avassetresourceloaderdelegate-for-smooth-playback-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming with CacheÔΩúImplement AVAssetResourceLoaderDelegate for Smooth Playback</h4><div class="text-muted"><p>Discover how to use AVPlayer and AVURLAsset with AVAssetResourceLoaderDelegate to stream and cache audio/video simultaneously, eliminating buffering delays and ensuring seamless playback for iOS us...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1722160385" data-df="ll" > Jul 28, 2024 </time><h4 class="pt-0 my-2">iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management</h4><div class="text-muted"><p>Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/avplayer-local-cache-implementation-master-avassetresourceloaderdelegate-for-smooth-playback-6ce488898003/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1612089702" data-df="ll" > Jan 31, 2021 </time><h4 class="pt-0 my-2">AVPlayer Local Cache ImplementationÔΩúMaster AVAssetResourceLoaderDelegate for Smooth Playback</h4><div class="text-muted"><p>Discover how to implement local caching with AVPlayer and AVQueuePlayer using AVURLAsset and AVAssetResourceLoaderDelegate to reduce buffering and ensure seamless video playback on iOS devices.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/ios-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%85%A8%E6%94%BB%E7%95%A5-%E8%B6%8A%E7%8D%84%E6%8F%90%E5%8F%96ipa%E6%AA%94-ui%E5%88%86%E6%9E%90%E5%88%B0%E5%8F%8D%E7%B7%A8%E8%AD%AF%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-7498e1ff93ce/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS ÈÄÜÂêëÂ∑•Á®ãÂÖ®ÊîªÁï•ÔΩúË∂äÁçÑÊèêÂèñiPAÊ™î„ÄÅUIÂàÜÊûêÂà∞ÂèçÁ∑®Ë≠ØÊäÄË°ìË©≥Ëß£</p></a> <a href="/posts/zrealm-dev/zh-cn/ios-hls-cache-%E5%AE%9E%E4%BD%9C%E5%85%A8%E6%94%BB%E7%95%A5-avplayer-%E4%B8%B2%E6%B5%81%E8%BE%B9%E6%92%AD%E8%BE%B9%E5%BF%AB%E5%8F%96%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90-d796bf8e661e/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS HLS Cache ÂÆûË∑µÊñπÊ≥ïÊé¢Á©∂‰πãÊóÖ</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">Ê≠£È´î‰∏≠Êñá</a> | <a href="/tags/simplified-chinese">ÁÆÄ‰Ωì‰∏≠Êñá</a> | <a href="/tags/english/">English</a> <br/> Last updated: 2025-12-23 00:40:58 +08:00</p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
