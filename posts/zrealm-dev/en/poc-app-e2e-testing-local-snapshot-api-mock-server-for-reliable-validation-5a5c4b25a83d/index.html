<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Developers facing challenges in end-to-end testing for existing apps and APIs can implement a local snapshot API mock server to simulate real interactions, ensuring thorough validation and faster debugging without backend dependencies." /><meta property="og:description" content="Developers facing challenges in end-to-end testing for existing apps and APIs can implement a local snapshot API mock server to simulate real interactions, ensuring thorough validation and faster debugging without backend dependencies." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-28T22:53:27+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" /><meta property="twitter:title" content="POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2023-09-04T22:32:47+08:00","datePublished":"2023-08-28T22:53:27+08:00","description":"Developers facing challenges in end-to-end testing for existing apps and APIs can implement a local snapshot API mock server to simulate real interactions, ensuring thorough validation and faster debugging without backend dependencies.","headline":"POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/"}</script><title>POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E5%86%B3-ios-app-%E6%B5%8B%E8%AF%95%E8%B5%84%E6%96%99%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98-5a5c4b25a83d/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E6%B1%BA-ios-app-%E6%B8%AC%E8%A9%A6%E8%B3%87%E6%96%99%E4%B8%8D%E7%A9%A9%E5%AE%9A%E5%95%8F%E9%A1%8C-5a5c4b25a83d/"><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/poc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d/"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation</h1><p class="post-desc fw-light mb-4">Developers facing challenges in end-to-end testing for existing apps and APIs can implement a local snapshot API mock server to simulate real interactions, ensuring thorough validation and faster debugging without backend dependencies.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1693234407" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 28, 2023 </time> </span> <span> Updated <time data-ts="1693837967" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 4, 2023 </time> </span><div class="mt-3 mb-3"> <a href="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" class="popup img-link preview-img blur"><img data-src="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3804 words" > <em>21 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">POC App E2E Testing｜Local Snapshot API Mock Server for Reliable Validation</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E5%86%B3-ios-app-%E6%B5%8B%E8%AF%95%E8%B5%84%E6%96%99%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98-5a5c4b25a83d/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E6%B1%BA-ios-app-%E6%B8%AC%E8%A9%A6%E8%B3%87%E6%96%99%E4%B8%8D%E7%A9%A9%E5%AE%9A%E5%95%8F%E9%A1%8C-5a5c4b25a83d/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance — let me know if anything sounds off!</p></blockquote><hr /><h3 id="poc-app-end-to-end-testing-local-snapshot-api-mock-server"><span class="me-2">[POC] App End-to-End Testing Local Snapshot API Mock Server</span><a href="#poc-app-end-to-end-testing-local-snapshot-api-mock-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Feasibility Verification of Implementing E2E Testing for Existing Apps and API Architectures</p><p><a href="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" alt="Photo by [freestocks](https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">freestocks</a></p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As a project that has been running online for many years, continuously improving stability is a highly challenging issue.</p><h4 id="unit-testing"><span class="me-2">Unit Testing</span><a href="#unit-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5a5c4b25a83d/1*QAuldnLTydk33IgAdkXR-w.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*QAuldnLTydk33IgAdkXR-w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMTY4OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Because the app is developed in Swift/Kotlin with static typing, compilation, and strong typing, or converted from Objective-C to Swift (dynamic to static), if interface dependencies are not properly separated during development, adding Unit Testing later is almost impossible; however, refactoring can introduce instability, creating a chicken-and-egg problem.</p><h4 id="ui-testing"><span class="me-2">UI Testing</span><a href="#ui-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For UI interactions and button testing; slight decoupling of data dependencies in new or existing screens can achieve this.</p><h4 id="snapshot-testing"><span class="me-2">SnapShot Testing</span><a href="#snapshot-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Verify whether the UI display content and style are consistent before and after adjustments; similar to UI Testing, newly developed or existing screens can achieve this by slightly decoupling data dependencies.</p><p>Useful for converting Storyboard/XIB layouts or UIViews from Objective-C to Swift; you can directly import <a href="https://github.com/pointfreeco" target="_blank">pointfreeco</a> / <a href="https://github.com/pointfreeco/swift-snapshot-testing" target="_blank">swift-snapshot-testing</a> for quick implementation.</p><p><a href="https://github.com/pointfreeco/swift-snapshot-testing" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/b3cc52a5b949767e4cb0af82145ed6474334d3235bd785ee1f7891c6b65fd69a/pointfreeco/swift-snapshot-testing" alt="" loading="lazy"></a></p><p>Although we can add UI Testing and Snapshot Testing later, the coverage is very limited; most errors are not related to UI styles but to process or logic issues that cause users to stop their actions. <strong>If these occur in the checkout process, affecting revenue, the problem becomes very serious.</strong></p><h3 id="end-to-end-testing"><span class="me-2">End-to-End Testing</span><a href="#end-to-end-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As mentioned earlier, it is not feasible to simply add unit tests to the current project or consolidate units for integration testing. For protecting logic and processes, the remaining method is to perform End-to-End black-box testing externally, directly from the user’s perspective, to verify whether key workflows (registration/checkout…) function correctly.</p><blockquote><p>For major feature refactoring, first create tests for the workflow before refactoring, then re-validate after refactoring to ensure the feature works as expected.</p></blockquote><blockquote><p>During refactoring, add Unit Testing and Integration Testing to improve stability and resolve the chicken-and-egg problem.</p></blockquote><h4 id="qa-team"><span class="me-2">QA Team</span><a href="#qa-team" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The most straightforward and brute-force method for End-to-End Testing is to have a QA team manually test according to the Test Plan, then continuously optimize or introduce automation; calculating the cost, it requires at least 2 engineers plus 1 leader spending at least six months to a year to see results.</p><p>Evaluate the time and cost. Is there anything we can do now or prepare for the future QA Team so that when the QA Team is established, they can directly move to optimization, automation, or even AI implementation(?).</p><h4 id="automation"><span class="me-2">Automation</span><a href="#automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>At this stage, the goal is to implement automated End-to-End Testing within the CI/CD pipeline. The test coverage doesn’t need to be complete; as long as it can prevent major process issues, it is already valuable. The Test Plan can be gradually iterated and expanded later to cover more areas.</p><h3 id="end-to-end-testing--technical-challenges"><span class="me-2">End-to-End Testing — Technical Challenges</span><a href="#end-to-end-testing--technical-challenges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="ui-operation-issues"><span class="me-2">UI Operation Issues</span><a href="#ui-operation-issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The app works more like using another test app to operate the app under test, then locating target objects through the View Hierarchy. During testing, it cannot access the logs or output of the app under test because they are essentially two different apps.</p><p>iOS needs to improve View Accessibility Identifiers to enhance efficiency and accuracy, and also handle Alerts (e.g., push notification requests).</p><p>Android previously had issues finding target objects when mixing Compose with Fragments, but according to a teammate, the latest Compose version has resolved this.</p><p>In addition to the common traditional issues, a bigger problem is the difficulty in integrating dual platforms (writing one test to run on both). Currently, we are trying new testing tools <a href="https://github.com/mobile-dev-inc" target="_blank">mobile-dev-inc</a> / <a href="https://github.com/mobile-dev-inc/maestro" target="_blank">maestro</a>:</p><p><a href="https://github.com/mobile-dev-inc/maestro" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/d9e6bc8b1cb6b3db5f52dd9bfa04fe2661ed172d7be82155b8f3e4b6c874f821/mobile-dev-inc/maestro" alt="" loading="lazy"></a></p><p>You can write a Test Plan using YAML and run tests on both platforms. Details on usage and trial experience will be shared by another teammate soon, cc’ed <a href="https://medium.com/u/1139df7a27f3" target="_blank">Alejandra Ts.</a> 😝.</p><h4 id="api-data-issues"><span class="me-2">API Data Issues</span><a href="#api-data-issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The biggest variable in App E2E Testing is the API data. Without guaranteed consistent data, test instability increases, causing false positives and ultimately leading to a loss of confidence in the Test Plan.</p><p>For example, when testing the checkout process, if a product might be removed or disappear, and these status changes are not controlled by the app, the above issues are likely to occur.</p><p>There are many ways to solve data issues, such as creating clean Staging or Testing environments, or using Open API-based Auto-Gen Mock API Servers. However, these methods rely on the backend and external API factors. Since the backend API, like the app, has been running online for many years and some specifications are still being restructured and migrated, a Mock Server is temporarily not available.</p><p>Based on the above factors, if you get stuck here, the problem will remain unchanged, and the chicken-and-egg dilemma cannot be resolved. The only option is to “take the risk” by making changes first and dealing with issues as they arise.</p><h4 id="snapshot-api-local-mock-server"><span class="me-2">Snapshot API Local Mock Server</span><a href="#snapshot-api-local-mock-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>“As long as the mindset doesn’t decline, there are always more methods than difficulties.”</p></blockquote><p>We can consider a different approach. If the UI can be captured as snapshots for replay and validation testing, can the API do the same? Can we save API requests and responses to replay them later for validation testing?</p><p><strong>Introducing the main focus of this article: Building a “Snapshot API Local Mock Server” to Record API Requests &amp; Replay Responses, separating dependency on API data.</strong></p><blockquote><p>This article only presents a POC concept verification and has not fully implemented high-coverage End To End Testing. Therefore, the approach is for reference only, <strong>and we hope it inspires new ideas within your current environment</strong>.</p></blockquote><h3 id="snapshot-api-local-mock-server-1"><span class="me-2">Snapshot API Local Mock Server</span><a href="#snapshot-api-local-mock-server-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="core-concept--record--replay-api-data"><span class="me-2">Core Concept — Record &amp; Replay API Data</span><a href="#core-concept--record--replay-api-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>[Record]</strong> — After completing the development of the End-to-End Testing Test Case, open the recording parameters and run a test once. All API Requests &amp; Responses during the process will be saved in each Test Case directory.</p><p><strong>[Replay]</strong> — During the Test Case run, find the corresponding recorded Response Data from the Test Case directory based on the request to complete the test process.</p><h4 id="illustration"><span class="me-2">Illustration</span><a href="#illustration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Assuming we want to test the purchase process: after the user opens the app, they click the product card on the home page to enter the product detail page, press the purchase button at the bottom, a login box pops up to complete login, complete the purchase, and a purchase success message appears:</p><p><a href="/assets/5a5c4b25a83d/1*VtCOkH7iply6RQPs9zxJrw.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*VtCOkH7iply6RQPs9zxJrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjExMjAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>UI Testing on controlling button clicks, input fields, etc., is not the main focus of this article; you can refer to existing testing frameworks for direct use.</p><h4 id="regular-proxy-or-reverse-proxy"><span class="me-2">Regular Proxy or Reverse Proxy</span><a href="#regular-proxy-or-reverse-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To achieve Record &amp; Replay API, a proxy must be placed between the app and the API to perform a man-in-the-middle attack. You can refer to my earlier article “<a href="/posts/zrealm-dev/en/https-data-theft-in-ios-macos-apps-mitmproxy-man-in-the-middle-attack-explained-46410aaada00/">APP uses HTTPS transmission, but data was still stolen.</a>”</p><p>Simply put, it is an intermediary that passes messages between the App and the API. Like passing notes, all requests and responses between both sides go through it. It can read the contents of the notes or even forge them without either side noticing the interference.</p><p><strong>Regular Proxy:</strong></p><p>A forward proxy is when the client sends a request to the proxy server, which then forwards the request to the target server and returns the target server’s response to the client. In forward proxy mode, the proxy server initiates the request on behalf of the client. The client must explicitly specify the proxy server’s address and port number and send the request to the proxy server.</p><p><strong>Reverse Proxy:</strong></p><p>A reverse proxy is the opposite of a forward proxy; it sits between the target server and the client. The client sends requests to the reverse proxy server, which forwards the requests to the backend target server based on certain rules and returns the target server’s response to the client. To the client, the target server appears as the reverse proxy server, and the client does not need to know the real address of the target server.</p><p>For our needs, both forward and reverse can achieve the goal. The only thing to consider is the method of proxy setup:</p><p><strong>A forward proxy requires setting up a proxy on the computer, phone, or emulator network settings:</strong></p><ul><li><p>Android can individually set Proxy in the emulator directly</p><li><p>The iOS Simulator shares the computer’s network environment and cannot have a separate Proxy set up. This means you must change the computer’s settings to enable the Proxy. All traffic from the computer will go through this Proxy, and if you run other network tools like Proxyman or Charles simultaneously, they may forcibly change the Proxy settings to their own, causing the Proxy to fail.</p></ul><p><strong>Reverse proxy requires changing the API Host in the Codebase and declaring all API Domains to be proxied:</strong></p><ul><li><p>The API Host in the codebase should be replaced with the Proxy Server IP during testing.</p><li><p>Which domains should be declared to use the proxy when enabling Reverse Proxy?</p><li><p>Only declared domains will go through the proxy; undeclared ones will connect directly.</p></ul><blockquote><p>In conjunction with the iOS App, the following is a POC example using iOS &amp; Reverse Proxy. The same applies to Android.</p></blockquote><h4 id="let-the-ios-app-know-it-is-running-end-to-end-testing-now"><span class="me-2">Let the iOS App Know It Is Running End-to-End Testing Now</span><a href="#let-the-ios-app-know-it-is-running-end-to-end-testing-now" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We need to let the app know that it is currently running End-to-End Testing so that we can add API Host replacement logic in the app code:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>// UI Testing Target:
let app = XCUIApplication()
app.launchArguments = ["duringE2ETesting"]
app.launch()
</pre></table></code></div></div><p>We perform judgment and replacement at the Network layer.</p><blockquote><p>This adjustment is unavoidable; try not to change the app’s code just for testing purposes.</p></blockquote><h3 id="using-mitmproxy-to-implement-a-reverse-proxy-server"><span class="me-2">Using MITMProxy to Implement a Reverse Proxy Server</span><a href="#using-mitmproxy-to-implement-a-reverse-proxy-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>You can also develop a Swift Server using Swift yourself. This article is just a POC, so it directly uses the MITMProxy tool.</p></blockquote><h4 id="20230904-update-mitmproxy-rodo-is-now-open-source"><span class="me-2">[2023–09–04 Update] Mitmproxy-rodo is now open source</span><a href="#20230904-update-mitmproxy-rodo-is-now-open-source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The following implementation has been open-sourced in the <a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank">mitmproxy-rodo</a> project. Feel free to check it out for reference.</p><p><a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4" alt="" loading="lazy"></a></p><p>Some structure and content of this article have been adjusted; further adjustments were made after open-sourcing:</p><ul><li><p>Save the directory structure as <code class="language-plaintext highlighter-rouge">host / requestPath / method / hash</code></p><li><p>Fix Header information storage: it should be Bytes Data instead of plain JSON String</p><li><p>Correct some errors</p><li><p>Add automatic extension for Set-Cookie expiration time function</p></ul><blockquote><p><strong>⚠️ The following script is for demo reference only. Future script adjustments will be maintained in the open-source project.</strong></p></blockquote><blockquote><p><strong>⚠️ The following script is for demo reference only. Future script adjustments will be maintained in the open-source project.</strong></p></blockquote><blockquote><p><strong>⚠️ The following script is for demo reference only. Future script adjustments will be maintained in an open-source project.</strong></p></blockquote><blockquote><p><strong>⚠️ The following script is for demo reference only. Future script updates will be maintained in an open-source project.</strong></p></blockquote><blockquote><p><strong>⚠️ The following script is for demo reference only. Future script adjustments will be maintained in an open-source project.</strong></p></blockquote><h4 id="mitmproxy"><span class="me-2"><a href="https://mitmproxy.org" target="_blank">MITMProxy</a></span><a href="#mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Follow the <a href="https://mitmproxy.org" target="_blank">MITMProxy official website</a> to complete the installation:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>mitmproxy
</pre></table></code></div></div><p>For detailed usage of MITMProxy, please refer to my earlier article “<a href="/posts/zrealm-dev/en/https-data-theft-in-ios-macos-apps-mitmproxy-man-in-the-middle-attack-explained-46410aaada00/">APP uses HTTPS for transmission, but data was still stolen.</a>”</p><ul><li><p><code class="language-plaintext highlighter-rouge">mitmproxy</code> provides an interactive command-line interface.</p><li><p><code class="language-plaintext highlighter-rouge">mitmweb</code> provides a browser-based graphical user interface.</p><li><p><code class="language-plaintext highlighter-rouge">mitmdump</code> provides non-interactive terminal output.</p></ul><h4 id="implement-record--replay"><span class="me-2">Implement Record &amp; Replay</span><a href="#implement-record--replay" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Since MITMProxy Reverse Proxy does not natively support recording (or dumping) requests and mapping request replay, we need to write scripts to implement this functionality ourselves.</p><p><code class="language-plaintext highlighter-rouge">mock.py</code> :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
</pre><td class="rouge-code"><pre><span class="sh">"""</span><span class="s">
Example:
    Record: mitmdump -m reverse:https://yourapihost.com -s mock.py --set record=true --set dumper_folder=loginFlow --set config_file=config.json
    Replay: mitmdump -m reverse:https://yourapihost.com -s mock.py --set dumper_folder=loginFlow --set config_file=config.json
</span><span class="sh">"""</span>

<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">mimetypes</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">hashlib</span>

<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">mitmproxy</span> <span class="kn">import</span> <span class="n">ctx</span>
<span class="kn">from</span> <span class="n">mitmproxy</span> <span class="kn">import</span> <span class="n">http</span>

<span class="k">class</span> <span class="nc">MockServerHandler</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">loader</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">dumper_folder</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">dump</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Response Dump directory, can be created by Test Case Name</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">network_restricted</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">If no local mapping data... set true to return 404, false to make real requests to get data.</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">record</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Set true to record Request</span><span class="sh">'</span><span class="s">s Response</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">config_file</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Set file path, example file below</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">updated</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">loadConfig</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">loadConfig</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">configFile</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">config_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">config_file</span> <span class="o">==</span> <span class="sh">""</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">configFile</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">self</span><span class="p">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="n">configFile</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">query</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">ignoredQueryParameterByPaths</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">queryParamters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">ignoredQueryParameterGlobal</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">queryParamters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">filteredQuery</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">filteredQuery</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoredQueryParameterByPaths</span> <span class="o">+</span> <span class="n">ignoredQueryParameterGlobal</span><span class="p">]</span>
        
        <span class="n">formData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="sh">''</span><span class="p">:</span>
            <span class="n">formData</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">())</span>
        
        <span class="c1"># or just formData = request.urlencoded_form
</span>        <span class="c1"># or just formData = request.multipart_form
</span>        <span class="c1"># depends on your api design
</span>
        <span class="n">ignoredFormDataParametersByPaths</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">formDataParameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">ignoredFormDataParametersGlobal</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">formDataParameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">filteredFormData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">formData</span><span class="p">:</span>
            <span class="n">filteredFormData</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">formData</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoredFormDataParametersByPaths</span> <span class="o">+</span> <span class="n">ignoredFormDataParametersGlobal</span><span class="p">]</span>
        
        <span class="c1"># Serialize the dictionary to a JSON string
</span>        <span class="n">hashData</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span><span class="nf">sorted</span><span class="p">(</span><span class="n">filteredQuery</span><span class="p">),</span> <span class="sh">"</span><span class="s">form</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">filteredFormData</span><span class="p">)}</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">hashData</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># Apply SHA-256 hash function
</span>        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha256</span><span class="p">(</span><span class="n">json_str</span><span class="p">.</span><span class="nf">encode</span><span class="p">())</span>
        <span class="n">hash_string</span> <span class="o">=</span> <span class="n">hash_object</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">hash_string</span>

    <span class="k">def</span> <span class="nf">readFromFile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">host</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">folder</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">dumper_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">host</span> <span class="o">/</span> <span class="n">method</span> <span class="o">/</span> <span class="n">requestPath</span> <span class="o">/</span> <span class="nb">hash</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="nf">guess_extension</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">.json</span><span class="sh">"</span>


        <span class="n">count</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>

        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">][</span><span class="n">requestPath</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">headerFilePath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Header-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">headerFilePath</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
                <span class="n">headerFilePath</span> <span class="o">=</span> <span class="bp">None</span>
            
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">][</span><span class="n">requestPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">header</span><span class="sh">"</span><span class="p">:</span> <span class="n">headerFilePath</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">host</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">iterable</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">iterable</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="n">folder</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">dumper_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">host</span> <span class="o">/</span> <span class="n">method</span> <span class="o">/</span> <span class="n">requestPath</span> <span class="o">/</span> <span class="nb">hash</span>

        <span class="c1"># create dir if not exists
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="nf">guess_extension</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">.json</span><span class="sh">"</span>

        <span class="n">repeatNumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">while</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">iterable</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">repeatNumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="c1"># dump to file
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span> <span class="ow">or</span> <span class="sa">b</span><span class="sh">''</span><span class="p">)</span>
            
        
        <span class="n">headerFilepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Header-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">headerFilepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">responseDict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
            <span class="n">responseDict</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">responseDict</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">header</span><span class="sh">"</span><span class="p">:</span> <span class="n">headerFilepath</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">record</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">host</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">path</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">readFromFile</span><span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">statusCode</span> <span class="o">=</span> <span class="mi">200</span>

                <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">header</span><span class="sh">'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">header</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">())</span>
                    <span class="n">statusCode</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span>

                
                <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">statusCode</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Fulfill response from local with </span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">]))</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">network_restricted</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="sa">b</span><span class="sh">''</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">record</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">)</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">saveToFile</span><span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">,</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">)</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Save response to local with </span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">]))</span>

<span class="n">addons</span> <span class="o">=</span> <span class="p">[</span><span class="nc">MockServerHandler</span><span class="p">()]</span>
</pre></table></code></div></div><p>You can refer to the <a href="https://docs.mitmproxy.org/stable/api/events.html" target="_blank">official documentation</a> and adjust the script content according to your needs.</p><p><strong>The script design logic is as follows:</strong></p><ul><li><p>File path logic: <code class="language-plaintext highlighter-rouge">dumper_folder(a.k.a Test Case Name)</code> / <code class="language-plaintext highlighter-rouge">Reverse's api host</code> / <code class="language-plaintext highlighter-rouge">HTTP Method</code> / <code class="language-plaintext highlighter-rouge">Path joined with -</code> (e.g. <code class="language-plaintext highlighter-rouge">app/launch</code> -&gt; <code class="language-plaintext highlighter-rouge">app-launch</code>) / <code class="language-plaintext highlighter-rouge">Hash(Get Query &amp; Post Content)</code> /</p><li><p>File logic: Response content: <code class="language-plaintext highlighter-rouge">Content-0.xxx</code>, <code class="language-plaintext highlighter-rouge">Content-1.xxx</code> (second request for the same one)… and so on; Response header info: <code class="language-plaintext highlighter-rouge">Header-0.json</code> (same logic as <code class="language-plaintext highlighter-rouge">Content-x</code>)</p></ul><p><a href="/assets/5a5c4b25a83d/1*Lud_shSJYv4LSUfpfALGFA.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*Lud_shSJYv4LSUfpfALGFA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMTAiIGhlaWdodD0iMjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>When saving, files are stored sequentially according to the path and file logic; during Replay, they are retrieved in the same order.</p><li><p>If the number of times does not match, for example, during Replay the same path is called 3 times, but the recorded data only stores up to the 2nd time; it will continue to respond with the result of the 2nd time, which is the last recorded result.</p><li><p>When <code class="language-plaintext highlighter-rouge">record</code> is <code class="language-plaintext highlighter-rouge">True</code>, it sends a request to the target server, gets the response, and saves it according to the above logic; when <code class="language-plaintext highlighter-rouge">False</code>, it only reads data locally (equivalent to Replay Mode).</p><li><p>When <code class="language-plaintext highlighter-rouge">network_restricted</code> is <code class="language-plaintext highlighter-rouge">False</code>, if there is no local Mapping data, it will directly respond with <code class="language-plaintext highlighter-rouge">404</code>; when it is <code class="language-plaintext highlighter-rouge">True</code>, it will fetch data from the target Server.</p><li><p><code class="language-plaintext highlighter-rouge">_responseFromMitmproxy</code> is used to inform the Response Method that the current response comes from Local and can be ignored. <code class="language-plaintext highlighter-rouge">_status_code</code> uses the Header.json field to store the HTTP Response status code.</p></ul><p><code class="language-plaintext highlighter-rouge">config_file.json</code> <strong>configuration file logic design is as follows:</strong></p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"ignored"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"yourapihost.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"add-to-cart"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"POST"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"queryParamters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"created_timestamp"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"formDataParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"api-status-checker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"GET"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"iterable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"global"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"queryParamters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"timestamp"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"formDataParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">queryParamters</code> <strong>&amp; <code class="language-plaintext highlighter-rouge">formDataParameters</code> :</strong></p><p>Some API parameters may change with each call, such as time parameters in certain endpoints. According to the server design, the value of <code class="language-plaintext highlighter-rouge">Hash(Query Parameter &amp; Body Content)</code> will differ during Replay Request, causing failure to map to the Local Response. To handle this, an additional <code class="language-plaintext highlighter-rouge">config.json</code> was created. It allows excluding specific parameters from the hash calculation by Endpoint Path or globally, ensuring consistent mapping results.</p><p><code class="language-plaintext highlighter-rouge">iterable</code> <strong>:</strong></p><p>Since some polling check APIs may repeatedly call at regular intervals, the server design generates many <code class="language-plaintext highlighter-rouge">Content-x.xxx</code> &amp; <code class="language-plaintext highlighter-rouge">Header-x.json</code> files; however, if we don’t mind, we can set it to <code class="language-plaintext highlighter-rouge">True</code>, and the response will continuously save and overwrite the first files <code class="language-plaintext highlighter-rouge">Content-0.xxx</code> &amp; <code class="language-plaintext highlighter-rouge">Header-0.json</code>.</p><p><strong>Enable Reverse Proxy Record Mode:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">record</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>loginFlow <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><p><strong>Enable Reverse Proxy Replay Mode:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>loginFlow <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h3 id="assembly--proof-of-concept"><span class="me-2">Assembly &amp; Proof Of Concept</span><a href="#assembly--proof-of-concept" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="0-replace-hosts-in-the-codebase"><span class="me-2">0. Replace Hosts in the Codebase</span><a href="#0-replace-hosts-in-the-codebase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Make sure that during testing, the API has been changed to <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080</code></p><h4 id="1-start-snapshot-api-local-mock-server-aka-reverse-proxy-server-record-mode"><span class="me-2">1. Start Snapshot API Local Mock Server (a.k.a Reverse Proxy Server) Record Mode</span><a href="#1-start-snapshot-api-local-mock-server-aka-reverse-proxy-server-record-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">record</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>addCart <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h4 id="2-perform-e2e-testing-ui-operations"><span class="me-2">2. Perform E2E Testing UI Operations</span><a href="#2-perform-e2e-testing-ui-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using <a href="https://apps.apple.com/tw/app/pinkoi-%E4%BA%9E%E6%B4%B2%E9%A0%98%E5%85%88%E8%B7%A8%E5%A2%83%E8%A8%AD%E8%A8%88%E8%B3%BC%E7%89%A9%E7%B6%B2%E7%AB%99/id557252416" target="_blank">Pinkoi iOS App</a> as an example, test the following process:</p><blockquote><p>Launch App -&gt; Home -&gt; Scroll Down -&gt; Similar to Wish List Items Section -&gt; First Product -&gt; Click First Product -&gt; Enter Product Page -&gt; Click Add to Cart -&gt; UI Response Added to Cart -&gt; Test Successful ✅</p></blockquote><p><a href="/assets/5a5c4b25a83d/1*aLaMSaG-DFWzYy9RcwCfag.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*aLaMSaG-DFWzYy9RcwCfag.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ2NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>The UI automation method was mentioned earlier. Here, we first manually test the same process to verify the results.</p><h4 id="3-get-record-results"><span class="me-2">3. Get Record Results</span><a href="#3-get-record-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After completing the operation, press <code class="language-plaintext highlighter-rouge">^ + C</code> to stop the Snapshot API Mock Server, then check the recording results in the file directory:</p><p><a href="/assets/5a5c4b25a83d/1*YO957r5CGMOlsPrm26GbcA.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*YO957r5CGMOlsPrm26GbcA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTciIGhlaWdodD0iNTUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="4-replay-verification-of-the-same-process-start-server--using-replay-mode"><span class="me-2">4. Replay Verification of the Same Process, Start Server &amp; Using Replay Mode</span><a href="#4-replay-verification-of-the-same-process-start-server--using-replay-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>addCart <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h4 id="5-execute-the-previous-ui-operation-again-to-verify-the-results"><span class="me-2">5. Execute the previous UI operation again to verify the results</span><a href="#5-execute-the-previous-ui-operation-again-to-verify-the-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5a5c4b25a83d/1*70qzxOiM9uJVcvyhKdosVg.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*70qzxOiM9uJVcvyhKdosVg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDQiIGhlaWdodD0iODkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>Left: Test Successful ✅</p><li><p>Right: Test clicking on products other than the recorded ones. An error will appear (because there is no local data + <code class="language-plaintext highlighter-rouge">network_restricted</code> is set to <code class="language-plaintext highlighter-rouge">False</code> by default, no local data will directly return 404 and will not fetch data from the network).</p></ul><h4 id="6-proof-of-concept-"><span class="me-2">6. Proof Of Concept ✅</span><a href="#6-proof-of-concept-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Proof of concept succeeded. We can indeed implement a Reverse Proxy Server to store API requests and responses ourselves, and use it as a Mock API Server to respond to the app during testing 🎉🎉🎉.</p><h3 id="20230904-mitmproxy-rodo-open-sourced"><span class="me-2">[2023–09–04] mitmproxy-rodo Open Sourced</span><a href="#20230904-mitmproxy-rodo-open-sourced" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4" alt="" loading="lazy"></a></p><h3 id="follow-up-and-miscellaneous-notes"><span class="me-2">Follow-up and Miscellaneous Notes</span><a href="#follow-up-and-miscellaneous-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This article only discusses the proof of concept; there are many areas to improve and more features to implement in the future.</p><ol><li><p>Integration with <a href="https://github.com/mobile-dev-inc/maestro" target="_blank">maestro</a> UI Testing tool</p><li><p>CI/CD Pipeline Integration Design (How to Automatically Start Reverse Proxy? Where to Start It?)</p><li><p>How to Embed MITMProxy into a Development Tool?</p><li><p>Verify More Complex Test Scenarios</p><li><p><strong>For validating the sent Tracking Request, you need to implement storing the Request Body and then extract which Tracking Event Data were sent and whether the events conform to the required process</strong></p></ol><h4 id="cookie-issues"><span class="me-2">Cookie Issues</span><a href="#cookie-issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">#...
</span>    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="n">setCookies</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get_all</span><span class="p">(</span><span class="sh">"</span><span class="s">set-cookie</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># setCookies = ['ad=0; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/', 'sessionid=xxxx; Secure; HttpOnly; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/']
</span>        
        <span class="c1"># OR Replace Cookie Domain From .xxx.com To 127.0.0.1
</span>        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">\s*\.xxx\.com\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">127.0.0.1</span><span class="sh">"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>

        <span class="c1"># AND Remove security-related restrictions
</span>        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\s*Secure\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>
        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\s*HttpOnly;\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>

        <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">set_all</span><span class="p">(</span><span class="sh">"</span><span class="s">Set-Cookie</span><span class="sh">"</span><span class="p">,</span> <span class="n">setCookies</span><span class="p">)</span>

        <span class="c1">#...
</span></pre></table></code></div></div><p>If you encounter cookie-related issues, such as the API returning cookies but the app not receiving them, refer to the adjustments mentioned above.</p><h4 id="the-last-article-on-pinkoi"><span class="me-2">The Last Article on Pinkoi</span><a href="#the-last-article-on-pinkoi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In over 900 days at Pinkoi, I realized many of my career and iOS/App development and process ideas. Thanks to all my teammates for going through the pandemic and challenges together; the courage to say goodbye is like the courage I had when I first pursued my dream job.</p><blockquote><p><a href="http://resume.zhgchg.li/" target="_blank"><strong>Setting sail to find new life challenges (including but not limited to engineering). If you have suitable opportunities (iOS or engineering management or startup products), please feel free to contact me.</strong></a> 🙏🙏🙏</p></blockquote><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/5a5c4b25a83d" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2023-08-28-5a5c4b25a83d.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/end-to-end-testing/" class="post-tag no-text-decoration" >end-to-end-testing</a> <a href="/tags/ui-testing/" class="post-tag no-text-decoration" >ui-testing</a> <a href="/tags/automation-testing/" class="post-tag no-text-decoration" >automation-testing</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=POC%20App%20E2E%20Testing%EF%BD%9CLocal%20Snapshot%20API%20Mock%20Server%20for%20Reliable%20Validation%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fpoc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=POC%20App%20E2E%20Testing%EF%BD%9CLocal%20Snapshot%20API%20Mock%20Server%20for%20Reliable%20Validation%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fpoc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fpoc-app-e2e-testing-local-snapshot-api-mock-server-for-reliable-validation-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原廠不鏽鋼米蘭錶帶開箱</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel Guide｜8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E6%B1%BA-ios-app-%E6%B8%AC%E8%A9%A6%E8%B3%87%E6%96%99%E4%B8%8D%E7%A9%A9%E5%AE%9A%E5%95%8F%E9%A1%8C-5a5c4b25a83d/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1693234407" data-df="ll" > Aug 28, 2023 </time><h4 class="pt-0 my-2">POC App End-to-End Testing Local Snapshot API Mock Server</h4><div class="text-muted"><p>為現成 App 及現有 API 架構實現 E2E Testing 的可能性驗證</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E5%86%B3-ios-app-%E6%B5%8B%E8%AF%95%E8%B5%84%E6%96%99%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98-5a5c4b25a83d/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1693234407" data-df="ll" > Aug 28, 2023 </time><h4 class="pt-0 my-2">POC App End-to-End Testing Local Snapshot API Mock Server</h4><div class="text-muted"><p>为现成 App 及现有 API 架构实现 E2E Testing 的可能性验证</p></div></div></a></article><article class="col"> <a href="/posts/en/avplayer-streaming-with-cache-implement-avassetresourceloaderdelegate-for-smooth-playback-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming with Cache｜Implement AVAssetResourceLoaderDelegate for Smooth Playback</h4><div class="text-muted"><p>Discover how to use AVPlayer and AVURLAsset with AVAssetResourceLoaderDelegate to stream and cache audio/video simultaneously, eliminating buffering delays and ensuring seamless playback for iOS us...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E6%89%93%E9%80%A0%E5%85%8D%E8%B2%BB-github-repo-star-%E9%80%9A%E7%9F%A5%E5%99%A8-%E5%AF%A6%E6%99%82%E7%8D%B2%E5%8F%96-star-%E5%8B%95%E6%85%8B-382218e15697/" class="btn btn-outline-primary" aria-label="Older" ><p>Google Apps Script｜三步驟打造免費 Github Repo Star 通知器，實時獲取 Star 動態</p></a> <a href="/posts/zrealm-dev/zh-cn/end-to-end-testing-%E7%94%A8-snapshot-api-local-mock-server-%E8%A7%A3%E5%86%B3-ios-app-%E6%B5%8B%E8%AF%95%E8%B5%84%E6%96%99%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98-5a5c4b25a83d/" class="btn btn-outline-primary" aria-label="Newer" ><p>POC App End-to-End Testing Local Snapshot API Mock Server</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
