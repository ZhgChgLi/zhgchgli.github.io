<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Exploring iOS HLS Cache Implementation Methods" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="How to achieve caching functionality while playing m3u8 streaming media files using AVPlayer" /><meta property="og:description" content="How to achieve caching functionality while playing m3u8 streaming media files using AVPlayer" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/exploring-ios-hls-cache-implementation-methods-d796bf8e661e/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/exploring-ios-hls-cache-implementation-methods-d796bf8e661e/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-09T01:12:17+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" /><meta property="twitter:title" content="Exploring iOS HLS Cache Implementation Methods" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:09:26+08:00","datePublished":"2020-04-09T01:12:17+08:00","description":"How to achieve caching functionality while playing m3u8 streaming media files using AVPlayer","headline":"Exploring iOS HLS Cache Implementation Methods","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/exploring-ios-hls-cache-implementation-methods-d796bf8e661e/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/exploring-ios-hls-cache-implementation-methods-d796bf8e661e/"}</script><title>Exploring iOS HLS Cache Implementation Methods | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Exploring iOS HLS Cache Implementation Methods</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Exploring iOS HLS Cache Implementation Methods</h1><p class="post-desc fw-light mb-4">How to achieve caching functionality while playing m3u8 streaming media files using AVPlayer</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1586365937" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 9, 2020 </time> </span> <span> Updated <time data-ts="1712995766" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" class="popup img-link preview-img blur"><img data-src="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1986 words" > <em>11 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Exploring iOS HLS Cache Implementation Methods</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Exploring iOS HLS Cache Implementation Methods</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><hr /><h3 id="ℹ️ℹ️ℹ️-the-following-content-is-translated-by-openai"><span class="me-2">ℹ️ℹ️ℹ️ The following content is translated by OpenAI.</span><a href="#ℹ️ℹ️ℹ️-the-following-content-is-translated-by-openai" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="click-here-to-view-the-original-chinese-version--點此查看本文中文版"><span class="me-2"><a href="/posts/d796bf8e661e/">Click here</a> to view the original Chinese version. | <a href="/posts/d796bf8e661e/">點此查看本文中文版</a></span><a href="#click-here-to-view-the-original-chinese-version--點此查看本文中文版" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><hr /><h3 id="exploring-ios-hls-cache-implementation-methods"><span class="me-2">Exploring iOS HLS Cache Implementation Methods</span><a href="#exploring-ios-hls-cache-implementation-methods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>How to achieve caching functionality while playing m3u8 streaming media files using AVPlayer</p><p><a href="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" class="popup img-link blur"><img data-src="/assets/d796bf8e661e/1*x_Js63o52qJMmYHKIuKF7A.webp" alt="photo by [Mihis Alex](https://www.pexels.com/zh-tw/@mcraftpix?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>photo by <a href="https://www.pexels.com/zh-tw/@mcraftpix?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank">Mihis Alex</a></p><h4 id="20230312-update"><span class="me-2">[2023/03/12] Update</span><a href="#20230312-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>The next article, “<a href="/posts/en/6ce488898003/">AVPlayer Complete Guide to Implementing Local Cache Functionality</a>,” will teach you how to implement AVPlayer caching.</ul><p><a href="https://github.com/ZhgChgLi/ZPlayerCacher" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/612890185/346ae563-7278-4518-a19b-f5d367e60adc" alt="" loading="lazy"></a></p><p>I have open-sourced my previous implementation, so friends in need can use it directly.</p><ul><li>Customizable cache strategies, can use PINCache or others…<li>Externally, just call the make AVAsset factory with the URL, and the AVAsset will support caching.<li>Implemented data flow strategies using Combine.<li>Wrote some tests.</ul><h3 id="about"><span class="me-2">About</span><a href="#about" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>HTTP Live Streaming (HLS) is a streaming media network transport protocol based on HTTP proposed by Apple.</p><p>For music playback, in non-streaming situations, we use mp3 as the music file, and the time it takes to download the entire file depends on its size; HLS splits a file into multiple smaller files, allowing playback to start as soon as the first segment is received, without needing to download the entire file first!</p><p>The <code class="language-plaintext highlighter-rouge">.m3u8</code> file records the bitrate, playback order, duration, and overall audio information of these segmented <code class="language-plaintext highlighter-rouge">.ts</code> files. It can also provide encryption protection, low-latency live streaming, etc.</p><p>Example of a <code class="language-plaintext highlighter-rouge">.m3u8</code> file (aviciiwakemeup.m3u8):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>#EXTM3U
#EXT-X-VERSION:3
#EXT-X-ALLOW-CACHE:YES
#EXT-X-TARGETDURATION:10
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:9.900411,
aviciiwakemeup–00001.ts
#EXTINF:9.900400,
aviciiwakemeup–00002.ts
#EXTINF:9.900411,
aviciiwakemeup–00003.ts
#EXTINF:9.900411,
.
.
.
#EXTINF:6.269389,
aviciiwakemeup-00028.ts
#EXT-X-ENDLIST
</pre></table></code></div></div><p><em>*EXT-X-ALLOW-CACHE has been deprecated in <a href="https://developer.apple.com/documentation/http_live_streaming/about_the_ext-x-version_tag?language=objc" target="_blank">iOS≥ 8/Protocol Ver.7</a> and is no longer meaningful whether this line is present or not.</em></p><h3 id="goal"><span class="me-2">Goal</span><a href="#goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For a streaming media service, <strong>caching is extremely important</strong>; because each audio file can range from MB to several GB, if every replay requires fetching the file from the server again, it puts a heavy load on the server, and data costs are significant. Having a caching layer can save a lot of money for the service and prevent users from wasting bandwidth and time re-downloading; it’s a win-win mechanism (but remember to set limits/timely clean-up to avoid overwhelming users’ devices).</p><h3 id="issues"><span class="me-2">Issues</span><a href="#issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the past, with non-streaming mp3/mp4 files, there wasn’t much to handle; you would just download the file to the device before playback, starting playback only after the download was complete. Regardless, you had to download the entire file before playback, so why not just use URLSession to download the file and then feed the local file path to AVPlayer for playback? Alternatively, you could use the proper method of implementing caching through AVAssetResourceLoaderDelegate in the delegate methods.</p><p>When it comes to streaming, the idea is straightforward: read the <code class="language-plaintext highlighter-rouge">.m3u8</code> file, parse the information inside, and cache each <code class="language-plaintext highlighter-rouge">.ts</code> file. However, I found that the implementation was not as simple as I expected, and the complexity exceeded my imagination, which is why this article exists!</p><p>For playback, we still use AVPlayer from iOS AVFoundation directly, as there is no difference in handling streaming and non-streaming files.</p><p><strong>Example:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">url</span><span class="p">:</span><span class="kt">URL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"https://zhgchg.li/aviciiwakemeup.m3u8"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="20210105-update"><span class="me-2"><strong>2021–01–05 Update:</strong></span><a href="#20210105-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We have reverted to using mp3 files, which allows us to directly implement using <code class="language-plaintext highlighter-rouge">AVAssetResourceLoaderDelegate</code>. For detailed implementation, refer to “<a href="/posts/en/ee47f8f1e2d2/">AVPlayer Caching in Action</a>.”</p><h3 id="implementation-solutions"><span class="me-2">Implementation Solutions</span><a href="#implementation-solutions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Several solutions we can achieve for our goal and the issues encountered during implementation.</p><h4 id="solution-1-avassetresourceloaderdelegate-"><span class="me-2">Solution 1. AVAssetResourceLoaderDelegate ❌</span><a href="#solution-1-avassetresourceloaderdelegate-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first idea was to do it the same way as with mp3/mp4! Use AVAssetResourceLoaderDelegate to cache the <code class="language-plaintext highlighter-rouge">.ts</code> files in the delegate methods.</p><p>However, I’m sorry, this approach doesn’t work because we cannot intercept the download request information for the <code class="language-plaintext highlighter-rouge">.ts</code> files in the delegate. You can find this confirmed in <a href="https://stackoverflow.com/questions/29752028/unknown-error-12881-when-using-avassetresourceloader/30239876#30239876" target="_blank">this Q&amp;A</a> and <a href="https://developer.apple.com/library/archive/technotes/tn2232/_index.html#//apple_ref/doc/uid/DTS40012884-CH1-SECHTTPLIVESTREAMING" target="_blank">the official documentation</a>.</p><p>For implementation of AVAssetResourceLoaderDelegate, refer to “<a href="/posts/en/ee47f8f1e2d2/">AVPlayer Caching in Action</a>.”</p><h4 id="solution-21-urlprotocol-intercept-requests-"><span class="me-2">Solution 2.1 URLProtocol Intercept Requests ❌</span><a href="#solution-21-urlprotocol-intercept-requests-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>URLProtocol is a method I recently learned, which allows us to intercept all requests based on the <code class="language-plaintext highlighter-rouge">URL Loading System</code> (URLSession, API calls, image downloads, etc.) to modify requests and responses and return them as if nothing happened, stealthily. For more about URLProtocol, refer to <a href="https://www.jianshu.com/p/fbe57730d3e1" target="_blank">this article</a>.</p><p>Applying this method, we intended to intercept AVFoundation AVPlayer’s requests for <code class="language-plaintext highlighter-rouge">.m3u8</code> and <code class="language-plaintext highlighter-rouge">.ts</code> files, returning cached data if available locally; otherwise, we would send a real request. This would also achieve our goal.</p><p>Again, I’m sorry, this approach doesn’t work either; AVFoundation AVPlayer’s requests are not part of the <code class="language-plaintext highlighter-rouge">URL Loading System</code>, so we cannot intercept them. <em>*There is a claim that it works on the simulator but not on actual devices.</em></p><h4 id="solution-22-force-it-into-urlprotocol-"><span class="me-2">Solution 2.2 Force it into URLProtocol ❌</span><a href="#solution-22-force-it-into-urlprotocol-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Based on Solution 2.1, a brute-force method is to change the request URL to a custom scheme (e.g., streetVoiceCache://). Since AVFoundation cannot handle this request, it will throw it out, allowing our URLProtocol to intercept it and perform our desired actions.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">url</span><span class="p">:</span><span class="kt">URL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
</pre></table></code></div></div><p>URLProtocol will intercept <code class="language-plaintext highlighter-rouge">streetVoiceCache://zhgchg.li/aviciiwakemeup.m3u8?originSchme=https</code>, and we just need to revert it to the original URL, then send a URLSession request to fetch the data and perform caching ourselves; the requests for <code class="language-plaintext highlighter-rouge">.ts</code> files in the m3u8 will also be intercepted by URLProtocol, allowing us to cache them as well.</p><p>Everything seemed perfect, but when I excitedly built and ran the app, Apple slapped me with:</p><p><code class="language-plaintext highlighter-rouge">Error: 12881 “CoreMediaErrorDomain custom url not redirect”</code></p><p>It doesn’t accept the response data I provide for the <code class="language-plaintext highlighter-rouge">.ts</code> file requests; I can only use the <code class="language-plaintext highlighter-rouge">urlProtocol:wasRedirectedTo</code> method to redirect to the original HTTPS request for it to play normally. Even if I download the <code class="language-plaintext highlighter-rouge">.ts</code> files locally and redirect to that file:// file, it still doesn’t accept it. According to <a href="https://forums.developer.apple.com/thread/30833" target="_blank">the official forum</a>, the answer is that this cannot be done; <code class="language-plaintext highlighter-rouge">.m3u8</code> must originate from HTTP/HTTPS (so even if you place the entire <code class="language-plaintext highlighter-rouge">.m3u8</code> and all the segmented <code class="language-plaintext highlighter-rouge">.ts</code> files locally, you cannot use file:// to play them with AVPlayer), and <code class="language-plaintext highlighter-rouge">.ts</code> files cannot be provided with data via URLProtocol.</p><p><code class="language-plaintext highlighter-rouge">fxxk…</code></p><h4 id="solution-222-same-as-solution-22-but-with-avassetresourceloaderdelegate-"><span class="me-2">Solution 2.2–2 Same as Solution 2.2 but with AVAssetResourceLoaderDelegate ❌</span><a href="#solution-222-same-as-solution-22-but-with-avassetresourceloaderdelegate-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The implementation is similar to Solution 2.2, feeding AVPlayer a custom scheme to enter AVAssetResourceLoaderDelegate; then we handle it ourselves.</p><p>Same result as 2.2:</p><p><code class="language-plaintext highlighter-rouge">Error: 12881 “CoreMediaErrorDomain custom url not redirect”</code></p><p><a href="https://forums.developer.apple.com/thread/113063" target="_blank">The official forum</a> provides the same answer.</p><p>This can be used for decryption processing (refer to <a href="https://medium.com/@marslin_dev/how-to-play-aes-encrypted-video-with-airplay-2-82a353044f40" target="_blank">this article</a> or <a href="https://www.jianshu.com/p/2c2cbe173e99" target="_blank">this example</a>), but it still cannot achieve caching functionality.</p><h4 id="solution-3-reverse-proxy-server--feasible-but-not-perfect"><span class="me-2">Solution 3. Reverse Proxy Server ⍻ (Feasible but not perfect)</span><a href="#solution-3-reverse-proxy-server--feasible-but-not-perfect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This method is the most commonly suggested solution when looking for how to handle HLS caching; it involves setting up an HTTP server in the app to serve as a reverse proxy server.</p><p>The principle is simple: run an HTTP server on the app, say on port 8080, so the URL becomes <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080/</code>; then we can handle incoming requests and provide responses.</p><p>Applied to our case, we change the request URL to: <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080/aviciiwakemeup.m3u8?origin=http://zhgchg.li/</code></p><p>In the HTTP server’s handler, we intercept <code class="language-plaintext highlighter-rouge">*.m3u8</code> requests; when a request comes in, it enters our handler, and we can do whatever we want, controlling what data to respond with. The <code class="language-plaintext highlighter-rouge">.ts</code> files will also come in; here we can implement our desired caching mechanism.</p><p>To AVPlayer, it appears as a standard streaming audio file at <code class="language-plaintext highlighter-rouge">http://*.m3u8</code>, so there won’t be any issues.</p><p><strong>For a complete implementation example, refer to:</strong></p><p><a href="https://github.com/StyleShare/HLSCachingReverseProxyServer/blob/master/Sources/HLSCachingReverseProxyServer/HLSCachingReverseProxyServer.swift" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/f82feda77c302ecf87673688fe78a46bccc4669783dda9b10093ecb5382f9895/StyleShare/HLSCachingReverseProxyServer" alt="" loading="lazy"></a></p><p>Since I also referred to this example, I used <a href="https://github.com/swisspol/GCDWebServer" target="_blank">GCDWebServer</a> for the local HTTP server part, and there’s also the newer <a href="https://github.com/Building42/Telegraph" target="_blank">Telegraph</a> available. ( <a href="https://github.com/robbiehanson/CocoaHTTPServer" target="_blank">CocoaHttpServer</a> is not recommended due to lack of updates)</p><p><strong>It looks good! But there’s a problem:</strong></p><p>Our service is a music streaming service rather than a video playback platform, and many times users are switching music while the app is running in the background; will the local HTTP server still be active then?</p><p>GCDWebServer’s documentation states that it will automatically disconnect when entering the background and reconnect when returning to the foreground, but you can set the parameter <code class="language-plaintext highlighter-rouge">GCDWebServerOption_AutomaticallySuspendInBackground:false</code> to prevent this mechanism.</p><p>However, in practice, if there are no requests sent for a while, the server will still disconnect (and the status will be incorrect, still showing as isRunning); it feels like the system has killed it; after digging into <a href="https://izeeshan.wordpress.com/2014/08/25/local-http-server-for-ios/" target="_blank">the HTTP server approach</a>, I found that the underlying implementation is based on sockets, and according to <a href="https://developer.apple.com/library/archive/technotes/tn2277/_index.html" target="_blank">the official documentation on socket services</a>, this limitation cannot be resolved; the system will suspend it when there are no new connections in the background.</p><p><em>*I found a convoluted method online… just send a long request or continuously send empty requests to ensure the server doesn’t get suspended by the system in the background.</em></p><p>All of the above pertains to the app’s background state; when in the foreground, the server is stable and won’t be suspended due to idleness, so there’s no issue!</p><p><strong>That said, since it relies on other services, while testing in the development environment is fine, it’s also advisable to implement a rollback handling (AVPlayer.AVPlayerItemFailedToPlayToEndTimeErrorKey notification); otherwise, if the service goes down, users will be stuck.</strong></p><p><code class="language-plaintext highlighter-rouge">So it's not perfect...</code></p><h4 id="solution-4-use-the-http-clients-own-caching-mechanism-"><span class="me-2">Solution 4. Use the HTTP Client’s own caching mechanism ❌</span><a href="#solution-4-use-the-http-clients-own-caching-mechanism-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Our <code class="language-plaintext highlighter-rouge">.m3u8/.ts</code> file response headers provide <code class="language-plaintext highlighter-rouge">Cache-Control</code>, <code class="language-plaintext highlighter-rouge">Age</code>, <code class="language-plaintext highlighter-rouge">eTag</code>, and other HTTP client cache information; our website’s caching mechanism works perfectly in Chrome, and I also saw mentions of cache-control headers for caching in the official new specification document for <a href="https://developer.apple.com/documentation/http_live_streaming/protocol_extension_for_low-latency_hls_preliminary_specification" target="_blank">Protocol Extension for Low-Latency HLS</a>.</p><p><a href="/assets/d796bf8e661e/1*vyvVp1sf9Hbtb_nWiLXYEg.webp" class="popup img-link blur"><img data-src="/assets/d796bf8e661e/1*vyvVp1sf9Hbtb_nWiLXYEg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzEiIGhlaWdodD0iMTM2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>However, in practice, AVFoundation AVPlayer does not exhibit any HTTP client caching effects, so this approach doesn’t work! It’s just wishful thinking.</p><h4 id="solution-5-do-not-use-avfoundation-avplayer-to-play-audio-files-"><span class="me-2">Solution 5. Do not use AVFoundation AVPlayer to play audio files ✔</span><a href="#solution-5-do-not-use-avfoundation-avplayer-to-play-audio-files-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Implement your own audio file parsing, caching, encoding, and playback functionality.</p><p><strong>This is too hardcore, requiring deep technical skills and a lot of time; I haven’t researched it.</strong></p><p>Here’s an open-source player for reference: <a href="https://github.com/muhku/FreeStreamer" target="_blank">FreeStreamer</a>, and if you choose this solution, it would be better to stand on the shoulders of giants and use a third-party library directly.</p><h4 id="solution-51-do-not-use-hls"><span class="me-2">Solution 5–1. Do not use HLS</span><a href="#solution-51-do-not-use-hls" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Same as Solution 5, <strong>this is too hardcore, requiring deep technical skills and a lot of time; I haven’t researched it.</strong></p><h4 id="solution-6-convert-ts-segmented-files-to-mp3mp4-files-"><span class="me-2">Solution 6. Convert .ts segmented files to .mp3/.mp4 files ✔</span><a href="#solution-6-convert-ts-segmented-files-to-mp3mp4-files-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>I haven’t researched this, but it is indeed feasible; however, it seems complicated to handle the downloaded <code class="language-plaintext highlighter-rouge">.ts</code> files, converting each to .mp3 or .mp4 files and playing them in order, or compressing them into a single file, which sounds challenging.</p><p>For those interested, refer to <a href="https://github.com/xyqjay/m3u8ToMP4" target="_blank">this article</a>.</p><h4 id="solution-7-download-the-complete-file-before-playback-"><span class="me-2">Solution 7. Download the complete file before playback ⍻</span><a href="#solution-7-download-the-complete-file-before-playback-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This method cannot be accurately called caching while playing; it actually downloads the entire audio file content before starting playback. If it’s <code class="language-plaintext highlighter-rouge">.m3u8</code>, as mentioned in Solution 2.2, it cannot be directly downloaded and played locally.</p><p>To implement this, you would need to use the iOS ≥ 10 API <code class="language-plaintext highlighter-rouge">AVAssetDownloadTask.makeAssetDownloadTask</code>, which will package the <code class="language-plaintext highlighter-rouge">.m3u8</code> into a <strong><code class="language-plaintext highlighter-rouge">.movpkg</code></strong> file stored locally for user playback.</p><p><strong>This is more akin to offline playback rather than caching functionality.</strong></p><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>Additionally, users can view and manage downloaded audio files from the "Settings" -&gt; "General" -&gt; "iPhone Storage" -&gt; APP.

<span class="p">![</span><span class="nv">Downloaded Videos Section Below</span><span class="p">](</span><span class="sx">/assets/d796bf8e661e/1*_YNIdy8NRkhVdeDTNvXzxA.webp</span><span class="p">)</span>{: lqip="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NzUiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==" }

Downloaded Videos Section Below

<span class="gs">**For detailed implementation, please refer to this example:**</span>

<span class="p">[</span><span class="nv">![</span><span class="p">](</span><span class="sx">https://opengraph.githubassets.com/a2ceae202336428494e5cd51b78cfbba3d139c135eaf232b4d2dffd2a7673eba/zhonglaoban/HLS-Stream</span><span class="p">)</span>](https://github.com/zhonglaoban/HLS-Stream){:target="_blank"}

<span class="gu">### Conclusion</span>

The exploration process took almost a whole week, going around in circles and nearly driving me crazy; currently, there is no reliable and easy-to-deploy method.

I will update if I have new ideas!
<span class="gu">#### References</span>
<span class="p">-</span> <span class="p">[</span><span class="nv">iOS Audio Playback (Nine): Streaming and Caching</span><span class="p">](</span><span class="sx">http://msching.github.io/blog/2016/05/24/audio-in-ios-9/</span><span class="p">)</span>{:target="_blank"}
<span class="p">-</span> <span class="p">[</span><span class="nv">StyleShare/HLSCachingReverseProxyServer</span><span class="p">](</span><span class="sx">https://github.com/StyleShare/HLSCachingReverseProxyServer</span><span class="p">)</span>{:target="_blank"}

If you have any questions or suggestions, feel free to <span class="p">[</span><span class="nv">contact me</span><span class="p">](</span><span class="sx">https://www.zhgchg.li/contact</span><span class="p">)</span>{:target="_blank"}.<span class="sb">


</span></pre></table></code></div></div><hr /><p>This article was first published on Medium ➡️ <a href="https://medium.com/p/d796bf8e661e" target="_blank"><strong>Click Here</strong></a></p><p>Automatically converted and synchronized using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> and <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a>.</p><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2020-04-08-d796bf8e661e.md" target="_blank">Improve this page on Github.</a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 5,105 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-14 | 4,967 Views on <a href="https://medium.com/p/d796bf8e661e" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/hls/" class="post-tag no-text-decoration" >hls</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cache/" class="post-tag no-text-decoration" >cache</a> <a href="/tags/reverse-proxy/" class="post-tag no-text-decoration" >reverse-proxy</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exploring%20iOS%20HLS%20Cache%20Implementation%20Methods%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fexploring-ios-hls-cache-implementation-methods-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exploring%20iOS%20HLS%20Cache%20Implementation%20Methods%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fexploring-ios-hls-cache-implementation-methods-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fexploring-ios-hls-cache-implementation-methods-d796bf8e661e%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/">Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/">遊記 2025 韓國釜山 8 天 7 夜自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/">遊記 9/11 名古屋一日快閃自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/">遊記 2023 九州 10 日自由行獨旅</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/">遊記 2023 京阪神 8 日自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E8%B8%90%E6%96%B9%E6%B3%95%E6%8E%A2%E7%A9%B6%E4%B9%8B%E6%97%85-d796bf8e661e/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1586365937" data-df="ll" > Apr 9, 2020 </time><h4 class="pt-0 my-2">iOS HLS Cache 實踐方法探究之旅</h4><div class="text-muted"><p>使用 AVPlayer 播放 m3u8 串流影音檔時如何做到邊播放邊 Caching 的功能</p></div></div></a></article><article class="col"> <a href="/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E5%AF%A6%E6%88%B0-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer 邊播邊 Cache 實戰</h4><div class="text-muted"><p>AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegate 達成邊播放音樂/影片邊緩存</p></div></div></a></article><article class="col"> <a href="/posts/en/avplayer-streaming-and-caching-practical-guide-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming and Caching Practical Guide</h4><div class="text-muted"><p>Implementing AVPlayer/AVQueuePlayer with AVURLAsset and AVAssetResourceLoaderDelegate to achieve music/video streaming while caching.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/ios-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%88%9D%E9%AB%94%E9%A9%97-7498e1ff93ce/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS 逆向工程初體驗</p></a> <a href="/posts/zrealm-dev/ios-hls-cache-%E5%AF%A6%E8%B8%90%E6%96%B9%E6%B3%95%E6%8E%A2%E7%A9%B6%E4%B9%8B%E6%97%85-d796bf8e661e/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS HLS Cache 實踐方法探究之旅</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> All Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-15 20:05:00 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
