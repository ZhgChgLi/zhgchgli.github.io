<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Discover how to implement a UITextView text wrap editor in Swift that resolves layout challenges and enhances text editing efficiency. This guide helps developers streamline text flow around images, improving user experience and app performance." /><meta property="og:description" content="Discover how to implement a UITextView text wrap editor in Swift that resolves layout challenges and enhances text editing efficiency. This guide helps developers streamline text flow around images, improving user experience and app performance." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-10-14T02:07:49+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" /><meta property="twitter:title" content="iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://www.linkedin.com/in/zhgchgli"},"dateModified":"2024-04-13T15:11:24+08:00","datePublished":"2018-10-14T02:07:49+08:00","description":"Discover how to implement a UITextView text wrap editor in Swift that resolves layout challenges and enhances text editing efficiency. This guide helps developers streamline text flow around images, improving user experience and app performance.","headline":"iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/"}</script><title>iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=false" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-uitextview-%E6%96%87%E7%BB%95%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E6%94%BB%E7%95%A5-swift-%E5%9B%BE%E7%89%87%E6%8F%92%E5%85%A5%E4%B8%8E%E8%AE%B0%E5%BF%86%E4%BD%93%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98-e37d66ea1146/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-uitextview-%E6%96%87%E7%B9%9E%E5%9C%96%E7%B7%A8%E8%BC%AF%E5%99%A8%E9%96%8B%E7%99%BC%E6%94%BB%E7%95%A5-swift-%E5%9C%96%E7%89%87%E6%8F%92%E5%85%A5%E8%88%87%E8%A8%98%E6%86%B6%E9%AB%94%E5%84%AA%E5%8C%96%E5%AF%A6%E6%88%B0-e37d66ea1146/"><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan üáπüáº who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="https://medium.com/@zhgchgli" class="nav-link" target="_blank" style="background: #EDF4FF; color: #0A84FF;"> <i class="fa-brands fa-medium"></i> <span>Follow Me!<br/><strong>1,049+</strong> Followers</span> </a><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout</h1><p class="post-desc fw-light mb-4">Discover how to implement a UITextView text wrap editor in Swift that resolves layout challenges and enhances text editing efficiency. This guide helps developers streamline text flow around images, improving user experience and app performance.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1539454069" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 14, 2018 </time> </span> <span> Updated <time data-ts="1712992284" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" class="popup img-link preview-img blur"><img data-src="/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://www.linkedin.com/in/zhgchgli">ZhgChgLi</a> </em> | <em><a href="https://www.linkedin.com/in/zhgchgli" target="_blank">Senior Software Engineer</a></em><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1906 words" > <em>10 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Chapters üîñ</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS UITextView Text Wrap EditorÔΩúSwift Implementation for Seamless Layout</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/ios-uitextview-%E6%96%87%E7%BB%95%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E6%94%BB%E7%95%A5-swift-%E5%9B%BE%E7%89%87%E6%8F%92%E5%85%A5%E4%B8%8E%E8%AE%B0%E5%BF%86%E4%BD%93%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98-e37d66ea1146/"><strong>ÁÇπÂáªËøôÈáå</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†ÁÆÄ‰Ωì‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-uitextview-%E6%96%87%E7%B9%9E%E5%9C%96%E7%B7%A8%E8%BC%AF%E5%99%A8%E9%96%8B%E7%99%BC%E6%94%BB%E7%95%A5-swift-%E5%9C%96%E7%89%87%E6%8F%92%E5%85%A5%E8%88%87%E8%A8%98%E6%86%B6%E9%AB%94%E5%84%AA%E5%8C%96%E5%AF%A6%E6%88%B0-e37d66ea1146/"><strong>ÈªûÊìäÈÄôË£°</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†Ê≠£È´î‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance ‚Äî let me know if anything sounds off!</p></blockquote><h4 id="zhgchgli-table-of-contents">Table of Contents</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>iOS UITextView Text Wrapping Editor (Swift) <a href="#ios-uitextview-text-wrapping-editor-swift">#</a></summary><ul><li><a href="#goal-function">Goal Function</a></li><li><a href="#functional-requirements">Functional Requirements</a></li><li><a href="#heres-the-final-result-image">Here‚Äôs the final result image</a></li></ul></details></li><li class="has-children"><details><summary>Start <a href="#start">#</a></summary><ul><li><a href="#chapter-1">Chapter 1</a></li><li><a href="#at-the-beginning">At the Beginning</a></li><li><a href="#chapter-2">Chapter 2</a></li></ul></details></li><li class="has-children"><details><summary>Item 2: Using UITableView with UITextView <a href="#item-2-using-uitableview-with-uitextview">#</a></summary><ul><li><a href="#final-chapter">Final Chapter</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#further-reading">Further Reading</a></li></ul></details></li></ul></nav><hr /><h3 id="ios-uitextview-text-wrapping-editor-swift"><span class="me-2">iOS UITextView Text Wrapping Editor (Swift)</span><a href="#ios-uitextview-text-wrapping-editor-swift" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Practical Route</p><h4 id="goal-function"><span class="me-2">Goal Function:</span><a href="#goal-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The app has a forum feature that allows users to post articles. The posting interface needs to support text input, inserting multiple images, and text wrapping around images.</p><h4 id="functional-requirements"><span class="me-2">Functional Requirements:</span><a href="#functional-requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>Can enter multiple lines of text</p><li><p>Can insert images inline within text</p><li><p>Can upload multiple images</p><li><p>Can freely remove inserted images</p><li><p>Image upload success/failure handling</p><li><p>Can convert input content into transferable text, e.g., BBCODE</p></ul><h4 id="heres-the-final-result-image"><span class="me-2">Here‚Äôs the final result image:</span><a href="#heres-the-final-result-image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" class="popup img-link blur"><img data-src="/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif" alt="[ÁµêÂ©öÂêßAPP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzAiIGhlaWdodD0iNzk4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&amp;mt=8" target="_blank">ÁµêÂ©öÂêßAPP</a></p><h3 id="start"><span class="me-2">Start:</span><a href="#start" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="chapter-1"><span class="me-2">Chapter 1</span><a href="#chapter-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>What? You said Chapter One? Isn‚Äôt it enough to use UITextView to create an editor? Why bother dividing it into ‚Äúchapters‚Äù? Yes, that was my initial reaction too, until I started working on it and realized it wasn‚Äôt that simple. I struggled for two weeks, flipping through various domestic and international resources before finding a solution. Let me share the journey of my implementation‚Ä¶</p><p>If you want to see the final solution directly, please skip to the last chapter (scroll down, down, down, down, down).</p><h4 id="at-the-beginning"><span class="me-2">At the Beginning</span><a href="#at-the-beginning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The text editor naturally uses the UITextView component. According to the documentation, UITextView‚Äôs attributedText includes NSTextAttachment objects that can attach images to achieve text wrapping effects. The code is also very simple:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">imageAttachment</span> <span class="o">=</span> <span class="kt">NSTextAttachment</span><span class="p">()</span>
<span class="n">imageAttachment</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"example"</span><span class="p">)</span>
<span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">imageAttachment</span><span class="p">)</span>
</pre></table></code></div></div><p>At first, I was naive and happy, thinking it was quite simple and convenient; but the real problems are just beginning:</p><ul><li><p>Images must be selectable and uploadable from local storage: This is easy to solve. For the image picker, I use the <a href="https://github.com/tilltue/TLPhotoPicker" target="_blank">TLPhotoPicker</a> library (supports multiple image selection, customization, camera switching, and Live Photos). The approach is to convert the PHAsset to UIImage after TLPhotoPicker‚Äôs selection callback, assign it to imageAttachment.image, and upload the image to the server in the background in advance.</p><li><p>Image upload needs to show effects and allow interactive actions (click to view original image / click X to delete): not achieved yet, unable to find a way with NSTextAttachment to fulfill this requirement. However, it‚Äôs okay without this feature since images can still be deleted (pressing the ‚ÄúBack‚Äù key on the keyboard after the image deletes it). Let‚Äôs continue‚Ä¶</p><li><p>Original image files are too large, causing slow upload, slow insertion, and high resource use: Resize them before uploading and inserting using <a href="https://github.com/onevcat/Kingfisher" target="_blank">Kingfisher</a>‚Äôs resizeTo function.</p><li><p>Insert the image at the cursor position: Here, the original code should be changed as follows</p></ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">selectedRange</span><span class="o">.</span><span class="n">location</span> <span class="p">??</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">combination</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span><span class="p">)</span> <span class="c1">// Get current content</span>
<span class="n">combination</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">imageAttachment</span><span class="p">),</span> <span class="nv">at</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
<span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">combination</span> <span class="c1">// Write back</span>
</pre></table></code></div></div><ul><li>Image Upload Failure Handling: Here, I want to mention that I actually wrote a separate class to extend the original NSTextAttachment, aiming to add an extra property to store an identification value.</ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">:</span><span class="kt">NSTextAttachment</span> <span class="p">{</span>
   <span class="k">var</span> <span class="nv">uuid</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Change to when uploading images:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span>
<span class="k">let</span> <span class="nv">attachment</span> <span class="o">=</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">()</span>
<span class="n">attachment</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">id</span>
</pre></table></code></div></div><p>If we can identify the corresponding NSTextAttachment, we can search for the NSTextAttachment in the attributedText for the images that failed to upload, find them, and replace them with an error placeholder image or remove them directly.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="p">{</span>
    <span class="n">content</span><span class="o">.</span><span class="nf">enumerateAttributes</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">length</span><span class="p">),</span>  <span class="nv">options</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">EnumerationOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">object</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="kt">NSAttributedStringKey</span><span class="o">.</span><span class="n">attachment</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">attachment</span> <span class="o">=</span> <span class="n">object</span><span class="p">[</span><span class="kt">NSAttributedStringKey</span><span class="o">.</span><span class="n">attachment</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">,</span> <span class="n">attachment</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="s">"targetID"</span> <span class="p">{</span>
                <span class="n">attachment</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
                <span class="n">attachment</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"IconError"</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">combination</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="n">content</span><span class="p">)</span>
                <span class="n">combination</span><span class="o">.</span><span class="nf">replaceCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">range</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">attachment</span><span class="p">))</span>
                <span class="c1">// To remove directly, use deleteCharacters(in: range)</span>
                <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">combination</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After overcoming the above issues, the code will look roughly like this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">:</span><span class="kt">NSTextAttachment</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">uuid</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">dismissPhotoPicker</span><span class="p">(</span><span class="nv">withTLPHAssets</span><span class="p">:</span> <span class="p">[</span><span class="kt">TLPHAsset</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// Callback for TLPhotoPicker image picker</span>
    
    <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">selectedRange</span><span class="o">.</span><span class="n">location</span> <span class="p">??</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">// Get cursor position, default to start if none</span>
    
    <span class="k">guard</span> <span class="n">withTLPHAssets</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span> <span class="k">in</span>
        <span class="c1">// Process in background</span>
        <span class="k">let</span> <span class="nv">orderWithTLPHAssets</span> <span class="o">=</span> <span class="n">withTLPHAssets</span><span class="o">.</span><span class="nf">sorted</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">selectedOrder</span> <span class="o">&gt;</span> <span class="nv">$1</span><span class="o">.</span><span class="n">selectedOrder</span> <span class="p">})</span>
        <span class="n">orderWithTLPHAssets</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">var</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fullResolutionImage</span> <span class="p">{</span>
                
                <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span>
                
                <span class="k">var</span> <span class="nv">maxWidth</span><span class="p">:</span><span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">1500</span>
                <span class="k">var</span> <span class="nv">size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">maxWidth</span> <span class="p">{</span>
                    <span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">maxWidth</span>
                    <span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxWidth</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span>
                <span class="p">}</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="nf">resizeTo</span><span class="p">(</span><span class="nv">scaledToSize</span><span class="p">:</span> <span class="n">size</span><span class="p">)</span>
                <span class="c1">// Resize image</span>
                
                <span class="k">let</span> <span class="nv">attachment</span> <span class="o">=</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">()</span>
                <span class="n">attachment</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="n">attachment</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">id</span>
                
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                    <span class="c1">// Switch back to main thread to update UI and insert image</span>
                    <span class="k">let</span> <span class="nv">combination</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span><span class="p">)</span>
                    <span class="n">attachments</span><span class="o">.</span><span class="nf">forEach</span><span class="p">({</span> <span class="p">(</span><span class="n">attachment</span><span class="p">)</span> <span class="k">in</span>
                        <span class="n">combination</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">),</span> <span class="nv">at</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
                        <span class="n">combination</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">attachment</span><span class="p">),</span> <span class="nv">at</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
                        <span class="n">combination</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">),</span> <span class="nv">at</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
                    <span class="p">})</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">combination</span>
                    
                <span class="p">}</span>
                
                <span class="c1">// Upload image to server</span>
                <span class="c1">// Alamofire post or....</span>
                <span class="c1">// POST image</span>
                <span class="c1">// if failed {</span>
                    <span class="k">if</span> <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="p">{</span>
                        <span class="n">content</span><span class="o">.</span><span class="nf">enumerateAttributes</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">length</span><span class="p">),</span>  <span class="nv">options</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">EnumerationOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="k">in</span>
                            
                            <span class="k">if</span> <span class="n">object</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="kt">NSAttributedStringKey</span><span class="o">.</span><span class="n">attachment</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="k">let</span> <span class="nv">attachment</span> <span class="o">=</span> <span class="n">object</span><span class="p">[</span><span class="kt">NSAttributedStringKey</span><span class="o">.</span><span class="n">attachment</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">UploadImageNSTextAttachment</span><span class="p">,</span><span class="n">attachment</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span> <span class="p">{</span>
                                    
                                    <span class="c1">// REPLACE:</span>
                                    <span class="n">attachment</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
                                    <span class="n">attachment</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="c1">// ERROR Image</span>
                                    <span class="k">let</span> <span class="nv">combination</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="n">content</span><span class="p">)</span>
                                    <span class="n">combination</span><span class="o">.</span><span class="nf">replaceCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">range</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">attachment</span><span class="p">))</span>
                                    <span class="c1">// OR DELETE:</span>
                                    <span class="c1">// combination.deleteCharacters(in: range)</span>
                                    
                                    <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">combination</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="c1">//}</span>
                <span class="c1">//</span>
                
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>By this point, most problems were solved, so what troubled me for two weeks?</p><p>Answer: ‚ÄúMemory‚Äù issue</p><p><a href="/assets/e37d66ea1146/1*IcnoXq6e6OUnU_mg83XDxg.gif" class="popup img-link blur"><img data-src="/assets/e37d66ea1146/1*IcnoXq6e6OUnU_mg83XDxg.gif" alt="iPhone 6 can't hold on!" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjYiIGhlaWdodD0iMTE4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>iPhone 6 can‚Äôt hold up anymore!</p><p>When inserting more than 5 images using the above method, UITextView will start to lag; beyond a certain point, the app will crash due to memory overload.</p><p>p.s Tried various compression/other storage methods, but the result remains the same</p><p>The suspected reason is that UITextView does not reuse NSTextAttachments for images, so all the images you insert are loaded into memory and not released; therefore, unless they are small icons like emojis üòÖ, they cannot be used for text wrapping.</p><h4 id="chapter-2"><span class="me-2">Chapter 2</span><a href="#chapter-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After discovering this ‚Äúhardware flaw‚Äù in the memory, I continued searching online for solutions and found the following methods:</p><ul><li><p>Using WebView to embed an HTML file (with &lt;div contentEditable="true"&gt;&lt;/div&gt;) and interacting between JS and WebView</p><li><p>Using UITableView with UITextView, enabling reuse</p><li><p>Extending UITextView Based on TextKit üèÜ</p></ul><p>The first method uses WebView to embed an HTML file; considering performance and user experience, it is not considered. Interested readers can search for related solutions on GitHub (e.g., <a href="https://github.com/xiaosheng0601/RichTextDemo" target="_blank">RichTextDemo</a>).</p><h2 id="item-2-using-uitableview-with-uitextview"><span class="me-2">Item 2: Using UITableView with UITextView</span><a href="#item-2-using-uitableview-with-uitextview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I have implemented about 70% of it. Specifically, each line corresponds to a cell. There are two types of cells: one with a UITextView and one with a UIImageView. The layout alternates between an image line and a text line. The content must be stored in an array to prevent loss during reuse.</p><p>Efficient reuse can solve memory issues, but eventually, it was abandoned. The parts <strong>where pressing Return at the end of a line should create a new line and move the cursor there</strong> and <strong>where pressing Backspace at the beginning of a line should move to the previous line (and delete the current line if it is empty)</strong> were particularly challenging and hard to control.</p><p>For those interested, please refer to: <a href="https://gitee.com/dhar/MMRichTextEdit" target="_blank">MMRichTextEdit</a></p><h4 id="final-chapter"><span class="me-2">Final Chapter</span><a href="#final-chapter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Having spent a lot of time reaching this point, the development schedule is seriously delayed; the current final solution is to use TextKit.</p><p>Here are two articles for friends interested in researching:</p><ul><li><p><a href="https://www.jianshu.com/p/3f445d7f44d6" target="_blank">TextKit Exploration</a></p><li><p><a href="http://djs66256.github.io/2016/06/23/2016-06-23-cong-uitextviewkan-wen-zi-hui-zhi-you-hua/" target="_blank">Text Rendering Optimization from UITextView</a></p></ul><p>But there is a certain learning curve, which is too difficult for a newbie like me. Besides, I don‚Äôt have enough time, so I can only aimlessly search on Github to borrow ideas from others.</p><p>Finally found <a href="https://github.com/kaizeiyimi/XLYTextKitExtension" target="_blank">XLYTextKitExtension</a>, a project that can be directly imported and used in code.</p><p>‚úî Enable NSTextAttachment to support custom UIView with any interactive operations needed</p><p>‚úî NSTextAttachment can be reused without causing memory bloat</p><p>The specific implementation is similar to <strong>Chapter 1</strong>, except that NSTextAttachment is replaced with XLYTextAttachment.</p><p>For the UITextView to be used:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">contentTextView</span><span class="o">.</span><span class="nf">setUseXLYLayoutManager</span><span class="p">()</span>
</pre></table></code></div></div><p>Tip 1: Change the place where NSTextAttachment is inserted to</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">combine</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">""</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">imageView</span> <span class="o">=</span> <span class="kt">UIView</span><span class="p">()</span> <span class="c1">// your custom view</span>
<span class="k">let</span> <span class="nv">imageAttachment</span> <span class="o">=</span> <span class="kt">XLYTextAttachment</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">UIView</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">imageView</span>
<span class="p">}</span>
<span class="n">imageAttachment</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span>
<span class="n">imageAttachment</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<span class="n">combine</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">imageAttachment</span><span class="p">))</span>
<span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">combine</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
</pre></table></code></div></div><p>Tip 2: Change NSTextAttachment search to</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">self</span><span class="mf">.</span><span class="n">contentTextView</span><span class="mf">.</span><span class="n">textStorage</span><span class="mf">.</span><span class="nf">enumerateAttribute</span><span class="p">(</span><span class="nc">NSAttributedStringKey</span><span class="mf">.</span><span class="n">attachment</span><span class="p">,</span> <span class="n">in</span><span class="o">:</span> <span class="nf">NSRange</span><span class="p">(</span><span class="n">location</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">:</span> <span class="k">self</span><span class="mf">.</span><span class="n">contentTextView</span><span class="mf">.</span><span class="n">textStorage</span><span class="mf">.</span><span class="n">length</span><span class="p">),</span> <span class="n">options</span><span class="o">:</span> <span class="p">[])</span> <span class="p">{</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="n">in</span>
    <span class="k">if</span> <span class="n">let</span> <span class="n">attachment</span> <span class="o">=</span> <span class="n">value</span> <span class="k">as</span><span class="o">?</span> <span class="nc">XLYTextAttachment</span> <span class="p">{</span>
        <span class="c1">//attachment.id</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Tip 3: Delete the NSTextAttachment item and replace it with</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span><span class="o">.</span><span class="nf">deleteCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
</pre></table></code></div></div><p>Tip 4: Get the Current Content Length</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span><span class="o">.</span><span class="n">length</span>
</pre></table></code></div></div><p>Tip 5: Refresh the Bounds Size of the Attachment</p><p>The main reason is for user experience; when inserting an image, I first insert a loading image. The inserted image is replaced only after it is compressed in the background. The TextAttachment‚Äôs bounds need to be updated to the resized dimensions.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span><span class="o">.</span><span class="nf">addAttributes</span><span class="p">([:],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span>
</pre></table></code></div></div><p>(Add empty attribute to trigger refresh)</p><p>Tip 6: Convert Input Content into Transmittable Text</p><p>Use Tip 2 to search all input content and extract the Attachment IDs, then combine them into a format like [[ID]] for passing.</p><p>Tip 7: Content Replacement</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span><span class="o">.</span><span class="nf">replaceCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">range</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">attachment</span><span class="p">:</span> <span class="n">newImageAttachment</span><span class="p">))</span>
</pre></table></code></div></div><p>Tip 8: Use Regular Expressions to Match the Range of Content</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="s">"(</span><span class="se">\\</span><span class="s">[</span><span class="se">\\</span><span class="s">[image_id=){1}([0-9]+){1}(</span><span class="se">\\</span><span class="s">]</span><span class="se">\\</span><span class="s">]){1}"</span>
<span class="k">let</span> <span class="nv">textStorage</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">contentTextView</span><span class="o">.</span><span class="n">textStorage</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">pattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">caseInsensitive</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="kc">true</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="n">textStorage</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="nf">matches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">textStorage</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">withTransparentBounds</span><span class="p">,</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">matchString</span> <span class="o">=</span> <span class="n">textStorage</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>
            <span class="c1">//FOUND!</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note: When using Find &amp; Replace, you must use a While loop. Otherwise, if there are multiple search results, replacing the first one will cause the range of subsequent results to be incorrect, leading to a crash.</p><h4 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The product has been completed and launched using this method, and no issues have been encountered so far; I will take the time to thoroughly explore the underlying principles later!</p><p>This article is more of a personal problem-solving experience rather than a tutorial; if you are working on similar features, I hope it helps you. Feel free to contact me with any questions or feedback.</p><blockquote><p>The Official First Post on Medium</p></blockquote><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p><a href="/posts/zrealm-dev/en/zmarkupparser-convert-html-string-to-nsattributedstring-with-custom-style-keys-a5643de271e4/">ZMarkupParser HTML String to NSAttributedString Tool</a></p><li><p><a href="/posts/zrealm-dev/en/html-parsing-techniques-build-custom-parsers-for-nsattributedstring-rendering-2724f02f6e7/">The Story of Handcrafting an HTML Parser</a></p></ul><p>For any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><script src="/assets/clipboard.min.js"></script><div style=" display:flex; align-items:center; gap:10px; border:1px solid #e5e7eb; background:#f9fafb; padding:12px 16px; border-radius:12px; margin:18px 0; box-shadow:0 3px 8px rgba(0,0,0,0.05); width: auto;"> <input id="share-url" value="https://zhgchg.li/posts/zrealm-dev/en/ios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146/" readonly="" style=" flex:1; border:1px solid #d1d5db; border-radius:8px; padding:10px 12px; font-size:0.9rem; background:#ffffff; color:#111827; outline:none; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; " /> <button class="btn" data-clipboard-target="#share-url" id="copy-btn" style=" border:none; background:#3b82f6; color:white; padding:10px 16px; border-radius:10px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all .15s ease; box-shadow:0 2px 5px rgba(59,130,246,0.35); " onmouseover="this.style.opacity='0.92';" onmouseout="this.style.opacity='1';"> <span style="font-size:1rem;">üîó</span> <span id="copy-btn-text">Copy link to share!</span> </button></div><script> new ClipboardJS('.btn'); var btn = document.getElementById("copy-btn"); var text = document.getElementById("copy-btn-text"); btn.addEventListener("click", function () { text.textContent = "Copied!"; btn.style.background = "#16a34a"; btn.style.boxShadow = "0 2px 6px rgba(22,163,74,0.35)"; setTimeout(() => { text.textContent = "Copy link to share!"; btn.style.background = "#3b82f6"; btn.style.boxShadow = "0 2px 5px rgba(59,130,246,0.35)"; }, 1500); });</script><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=üç∫&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/e37d66ea1146" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2018-10-13-e37d66ea1146.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1,049+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/swift/" class="post-tag no-text-decoration" >swift</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/mobile-app-development/" class="post-tag no-text-decoration" >mobile-app-development</a> <a href="/tags/uitextview/" class="post-tag no-text-decoration" >uitextview</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20UITextView%20Text%20Wrap%20Editor%EF%BD%9CSwift%20Implementation%20for%20Seamless%20Layout%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20UITextView%20Text%20Wrap%20Editor%EF%BD%9CSwift%20Implementation%20for%20Seamless%20Layout%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-uitextview-text-wrap-editor-swift-implementation-for-seamless-layout-e37d66ea1146%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ci-cd-explained-boost-ios-app-development-stability-and-efficiency-tool-selection-guide-c008a9e8ceca/">CI/CD Explained: Boost iOS App Development Stability and EfficiencyÔΩúTool Selection Guide</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%98%AF%E4%BB%80%E4%B9%88-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A8%B3%E5%AE%9A%E5%BC%80%E5%8F%91%E5%9B%A2%E9%98%9F%E7%9A%84%E5%85%B3%E9%94%AE%E6%B5%81%E7%A8%8B%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9-c008a9e8ceca/">CI/CD ÂÆûÊàòÊåáÂçóÔºà‰∏ÄÔºâÔºöCI/CD ÊòØ‰ªÄ‰πàÔºüÂ¶Ç‰ΩïÈÄèËøá CI/CD ÊâìÈÄ†Á®≥ÂÆöÈ´òÊïàÁöÑÂºÄÂèëÂõ¢ÈòüÔºüÂ∑•ÂÖ∑ÈÄâÊã©Ôºü</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/">CI/CD ÂØ¶Êà∞ÊåáÂçóÔºà‰∏ÄÔºâÔºöCI/CD ÊòØ‰ªÄÈ∫ºÔºüÂ¶Ç‰ΩïÈÄèÈÅé CI/CD ÊâìÈÄ†Á©©ÂÆöÈ´òÊïàÁöÑÈñãÁôºÂúòÈöäÔºüÂ∑•ÂÖ∑ÈÅ∏ÊìáÔºü</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/">Google Apps Script Web AppÔΩúIntegrate Forms with GitHub Actions CI/CD for Streamlined Workflows</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/">‰ΩøÁî® Google Apps Script Web App Ë°®Âçï‰∏≤Êé• Github Action CI/CD Â∑•‰Ωú</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Chapters üîñ</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/en/ios-uiviewcontroller-transitions-master-pull-down-close-pull-up-present-full-page-swipe-back-14cee137c565/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1578768066" data-df="ll" > Jan 12, 2020 </time><h4 class="pt-0 my-2">iOS UIViewController TransitionsÔΩúMaster Pull-Down Close, Pull-Up Present & Full-Page Swipe Back</h4><div class="text-muted"><p>Discover how to implement seamless UIViewController transitions in iOS, including pull-down to close, pull-up to present, and full-page right-swipe back gestures, enhancing user interaction and nav...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-devicecheck-implement-one-time-offers-and-trials-seamlessly-with-swift-c5e7e580c341/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1556551801" data-df="ll" > Apr 29, 2019 </time><h4 class="pt-0 my-2">iOS DeviceCheckÔΩúImplement One-Time Offers and Trials Seamlessly with Swift</h4><div class="text-muted"><p>iOS developers struggling with secure one-time offers or trials can leverage DeviceCheck to track user eligibility across devices, preventing abuse and ensuring fair usage. Learn how to implement t...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/ios-12-enable-quick-access-to-app-notification-settings-in-user-settings-with-swift-f644db1bb8bf/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1542033522" data-df="ll" > Nov 12, 2018 </time><h4 class="pt-0 my-2">iOS ‚â• 12ÔΩúEnable Quick Access to App Notification Settings in User Settings with Swift</h4><div class="text-muted"><p>Help iOS users easily manage app notifications by adding a direct shortcut to the notification settings page within the app using Swift, offering alternatives beyond system-wide notification toggle...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-life/blog%E7%B6%93%E7%87%9F%E5%BF%83%E8%B7%AF%E6%AD%B7%E7%A8%8B-%E5%BE%9E%E6%96%B0%E6%89%8B%E5%88%B0%E6%8A%80%E8%A1%93%E5%88%86%E4%BA%AB-%E9%87%8D%E7%87%83%E5%AF%AB%E4%BD%9C%E5%8B%95%E5%8A%9B%E7%9A%84%E7%A7%98%E8%A8%A3-b7a3fb3d5531/" class="btn btn-outline-primary" aria-label="Older" ><p>BlogÁ∂ìÁáüÂøÉË∑ØÊ≠∑Á®ãÔΩúÂæûÊñ∞ÊâãÂà∞ÊäÄË°ìÂàÜ‰∫´ÔºåÈáçÁáÉÂØ´‰ΩúÂãïÂäõÁöÑÁßòË®£</p></a> <a href="/posts/zrealm-dev/zh-cn/ios-uitextview-%E6%96%87%E7%BB%95%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E6%94%BB%E7%95%A5-swift-%E5%9B%BE%E7%89%87%E6%8F%92%E5%85%A5%E4%B8%8E%E8%AE%B0%E5%BF%86%E4%BD%93%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98-e37d66ea1146/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS UITextView ÊñáÁªïÂõæÁºñËæëÂô® (Swift)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">Ê≠£È´î‰∏≠Êñá</a> | <a href="/tags/simplified-chinese">ÁÆÄ‰Ωì‰∏≠Êñá</a> | <a href="/tags/english/">English</a> <br/> Last updated: 2025-12-21 11:04:45 +08:00</p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
