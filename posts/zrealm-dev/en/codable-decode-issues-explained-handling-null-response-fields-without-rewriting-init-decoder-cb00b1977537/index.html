<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Developers facing Codable decode errors can resolve null response field issues efficiently without rewriting init decoder methods, improving data parsing reliability and reducing code complexity." /><meta property="og:description" content="Developers facing Codable decode errors can resolve null response field issues efficiently without rewriting init decoder methods, improving data parsing reliability and reducing code complexity." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-26T01:56:31+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" /><meta property="twitter:title" content="Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:29:42+08:00","datePublished":"2020-06-26T01:56:31+08:00","description":"Developers facing Codable decode errors can resolve null response field issues efficiently without rewriting init decoder methods, improving data parsing reliability and reducing code complexity.","headline":"Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/"}</script><title>Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-cn" href="/posts/zrealm-dev/zh-cn/codable-%E8%A7%A3%E7%A0%81%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7-%E5%8C%BA%E5%88%86-null-%E4%B8%8E%E6%A0%8F%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AE%9E%E7%8E%B0-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537"><link rel="alternate" hreflang="zh-tw" href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan üáπüáº who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder</h1><p class="post-desc fw-light mb-4">Developers facing Codable decode errors can resolve null response field issues efficiently without rewriting init decoder methods, improving data parsing reliability and reducing code complexity.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1593107791" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 26, 2020 </time> </span> <span> Updated <time data-ts="1712996982" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" class="popup img-link preview-img blur"><img data-src="/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1743 words" > <em>9 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Á´†ÁØÄ (Chapters)üîñ</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Codable Decode Issues ExplainedÔΩúHandling Null Response Fields Without Rewriting init Decoder</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/codable-%E8%A7%A3%E7%A0%81%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7-%E5%8C%BA%E5%88%86-null-%E4%B8%8E%E6%A0%8F%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AE%9E%E7%8E%B0-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537"><strong>ÁÇπÂáªËøôÈáå</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†ÁÆÄ‰Ωì‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537"><strong>ÈªûÊ≠§ÈÄôË£°</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†Ê≠£È´î‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance ‚Äî let me know if anything sounds off!</p></blockquote><hr /><h3 id="real-world-codable-decoding-issues-summary-part-2"><span class="me-2">Real-World Codable Decoding Issues Summary (Part 2)</span><a href="#real-world-codable-decoding-issues-summary-part-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Properly handling Response Null fields does not always require rewriting the init decoder.</p><p><a href="/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" class="popup img-link blur"><img data-src="/assets/cb00b1977537/1*zoN0YxCnWdvMs35FaP5tNA.webp" alt="Photo by [Zan](https://unsplash.com/@zanilic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@zanilic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Zan</a></p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Following the previous article ‚Äú<a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642">Practical Issues Encountered with Codable Decoding</a>,‚Äù development has progressed further, bringing new scenarios and challenges. This follow-up continues to document the situations encountered and the research process for future reference.</p><p>The previous article mainly addressed JSON String -&gt; Entity Object Decodable Mapping. With the Entity Object, we can convert it into a Model Object for use within the program, a View Model Object to handle data display logic, and so on; <strong>on the other hand, we need to convert the Entity into an NSManagedObject to store it locally in Core Data</strong>.</p><h3 id="main-issues"><span class="me-2">Main Issues</span><a href="#main-issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Assuming our song Entity structure is as follows:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">converImage</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">likeCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">like</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">length</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Since the API EndPoint may not always return complete data fields (only the id is guaranteed), all fields except for id are optional. For example, when fetching song information, the full structure is returned, but when liking or favoriting a song, only the three related fields <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">likeCount</code>, and <code class="language-plaintext highlighter-rouge">like</code> are returned.</p><p>We want all fields from the API response to be saved into Core Data. If the data already exists, update only the changed fields (incremental update).</p><blockquote><p><em>But here comes the problem: after converting Codable Decode to Entity Object, we cannot distinguish between <strong>‚Äúthe data field is intended to be set to nil‚Äù</strong> and <strong>‚Äúthe response did not provide it‚Äù</strong></em></p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>A Response:
{
  "id": 1,
  "file": null
}
</pre></table></code></div></div><p>For both A Response and B Response, the file is null, but their meanings are different; A intends to set the file field to null (clearing the original data), while B intends to update other data and simply does not provide the file field.</p><blockquote><p>The Swift community has developers proposing <a href="https://forums.swift.org/t/pitch-jsondecoder-nulldecodingstrategy/13980" target="_blank">adding a null Strategy similar to date Strategy in JSONDecoder</a>, allowing us to distinguish the above situations, but there are currently no plans to add it.</p></blockquote><h4 id="solution"><span class="me-2">Solution</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As mentioned earlier, our architecture is JSON String -&gt; Entity Object -&gt; NSManagedObject, so when we get the Entity Object, it is already the decoded result, and there is no raw data to manipulate; of course, we can use the original JSON String for comparison here, but rather than doing that, it‚Äôs better not to use Codable.</p><p>First, refer to <a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642">the previous article</a> for using Associated Value Enum as a container to hold values.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Decodable</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">null</span>
    <span class="k">case</span> <span class="nf">value</span><span class="p">(</span><span class="kt">T</span><span class="p">)</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Using generics, T represents the actual data field type; .value(T) holds the decoded value, while .null indicates the value is null.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">file</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">?</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="o">.</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="s">"""
{
    "</span><span class="n">id</span><span class="s">":1
}
"""</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Song</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">jsonData</span> <span class="o">=</span> <span class="s">"""
{
    "</span><span class="n">id</span><span class="s">":1,
    "</span><span class="n">file</span><span class="s">":null
}
"""</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="n">result</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Song</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">jsonData</span> <span class="o">=</span> <span class="s">"""
{
    "</span><span class="n">id</span><span class="s">":1,
    "</span><span class="n">file</span><span class="s">":"</span><span class="nv">https</span><span class="p">:</span><span class="c1">//test.com/m.mp3"</span>
<span class="p">}</span>
<span class="s">""".data(using: .utf8)!
result = try! JSONDecoder().decode(Song.self, from: jsonData)
print(result)
</span></pre></table></code></div></div><blockquote><p><em>The example is simplified to only include two data fields: <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">file</code>.</em></p></blockquote><p>The Song Entity overrides the Decode method by itself, using the <code class="language-plaintext highlighter-rouge">contains(.KEY)</code> method to check if the Response includes the field (regardless of its value). If it exists, it decodes it into an OptionalValue; the OptionalValue Enum then attempts to decode the actual value we want. If decoding succeeds, it stores it as <code class="language-plaintext highlighter-rouge">.value(T)</code>; if the value is null (or decoding fails), it stores it as <code class="language-plaintext highlighter-rouge">.null</code>.</p><ol><li><p>When Response has a field &amp; value: OptionalValue.value(VALUE)</p><li><p>When the Response has a field &amp; value as null: OptionalValue.null</p><li><p>Response when no field is given: nil</p></ol><blockquote><p><em>This way, you can tell if a field is provided or not. When writing to Core Data later, you can decide whether to update the field to null or skip updating it.</em></p></blockquote><h4 id="other-studies--double-optional-"><span class="me-2">Other Studies ‚Äî Double Optional ‚ùå</span><a href="#other-studies--double-optional-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Optional! Optional! Swift is well suited to handle this scenario.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">??</span>
    <span class="k">var</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">String</span><span class="p">??</span>
    <span class="k">var</span> <span class="nv">converImage</span><span class="p">:</span> <span class="kt">String</span><span class="p">??</span>
    <span class="k">var</span> <span class="nv">likeCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">??</span>
    <span class="k">var</span> <span class="nv">like</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">??</span>
    <span class="k">var</span> <span class="nv">length</span><span class="p">:</span> <span class="kt">Int</span><span class="p">??</span>
<span class="p">}</span>
</pre></table></code></div></div><ol><li><p>When the Response includes a field &amp; value: Optional(VALUE)</p><li><p>When the Response has a field &amp; value as null: Optional(nil)</p><li><p>When Response does not provide a field: nil</p></ol><p>However‚Ä¶ Codable JSONDecoder Decode handles both Double Optional and Optional with decodeIfPresent, treating them as Optional, so the result remains the same.</p><h4 id="other-research--property-wrapper-"><span class="me-2">Other Research ‚Äî Property Wrapper ‚ùå</span><a href="#other-research--property-wrapper-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Originally planned to use Property Wrapper for elegant encapsulation, for example:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">@OptionalValue</span> <span class="k">var</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
</pre></table></code></div></div><p>But before diving into the details, I found that if a Codable property is marked with a Property Wrapper, the API response must include that field; otherwise, a keyNotFound error will occur, even if the field is Optional. ?????</p><p>The official forum also has a <a href="https://forums.swift.org/t/using-property-wrappers-with-codable/29804" target="_blank">discussion thread</a> about this issue‚Ä¶ it is expected to be fixed later.</p><blockquote><p>When choosing packages like <a href="https://github.com/marksands/BetterCodable" target="_blank">BetterCodable</a> or <a href="https://github.com/GottaGetSwifty/CodableWrappers" target="_blank">CodableWrappers</a>, you need to consider the current issues with Property Wrappers.</p></blockquote><h3 id="other-problem-scenarios"><span class="me-2">Other Problem Scenarios</span><a href="#other-problem-scenarios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="1-how-to-decode-api-response-using-01-to-represent-bool"><span class="me-2">1. How to Decode API Response Using 0/1 to Represent Bool?</span><a href="#1-how-to-decode-api-response-using-01-to-represent-bool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">like</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">like</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decodeIfPresent</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">intValue</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decodeIfPresent</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">like</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">like</span> <span class="o">=</span> <span class="p">(</span><span class="n">intValue</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">?</span> <span class="nv">true</span> <span class="p">:</span> <span class="kc">false</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">boolValue</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decodeIfPresent</span><span class="p">(</span><span class="kt">Bool</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">like</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">like</span> <span class="o">=</span> <span class="n">boolValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="s">"""
{
    "</span><span class="n">id</span><span class="s">": 1,
    "</span><span class="n">name</span><span class="s">": "</span><span class="n">Âëä‰∫î‰∫∫</span><span class="s">",
    "</span><span class="n">like</span><span class="s">": 0
}
"""</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Song</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>Extending the previous article, we can decode into int/Bool ourselves in init Decode and assign the values manually. This way, the original field can accept 0/1/true/false.</p><h4 id="2-avoid-rewriting-init-decoder-every-time"><span class="me-2">2. Avoid rewriting init decoder every time</span><a href="#2-avoid-rewriting-init-decoder-every-time" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Extending the original JSON Decoder to add more features without building a Decoder from scratch.</p><p>We can extend <a href="https://developer.apple.com/documentation/swift/keyeddecodingcontainer" target="_blank">KeyedDecodingContainer</a> to define our own public methods. Swift will prioritize executing the methods we redefine in our module, overriding the original Foundation implementation.</p><blockquote><p><strong><em>The entire module is affected.</em></strong></p></blockquote><blockquote><p><strong><em>And it‚Äôs not a true override, so you can‚Äôt call super.decode. Be careful not to call yourself (e.g., decode(Bool.Type, for: key) inside decode(Bool.Type, for: key))</em></strong></p></blockquote><p><strong>There are two methods for decode:</strong></p><ul><li><p><strong>decode(Type, forKey:)</strong> Handling Non-Optional Data Fields</p><li><p><strong>decodeIfPresent(Type, forKey:)</strong> handles optional data fields</p></ul><p><strong>Example 1. The main issue mentioned above can be directly extended:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">KeyedDecodingContainer</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="n">decodeIfPresent</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">T</span><span class="o">.</span><span class="k">Type</span><span class="p">,</span> <span class="n">forKey</span> <span class="nv">key</span><span class="p">:</span> <span class="k">Self</span><span class="o">.</span><span class="kt">Key</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">T</span><span class="p">?</span> <span class="k">where</span> <span class="kt">T</span> <span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
        <span class="c1">//better:</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="k">is</span> <span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;.</span><span class="k">Type</span><span class="p">,</span>
             <span class="k">is</span> <span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="k">Type</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="nf">decode</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="c1">// or just return try? decode(type, forKey: key)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">OptionalValue</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">?</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The main issue involves Optional data fields and Decodable types, so we override the decodeIfPresent&lt;T: Decodable&gt; method.</p><p>Here it is translated according to your instructions:</p><p>It is speculated that the original implementation of decodeIfPresent returns nil directly if the data is null or the Response does not provide it, without actually running decode.</p><p>So the principle is simple: as long as the Decodable Type is OptionValue<T>, we always try to decode it to get different state results; however, it's also fine not to check the Decodable Type, which means all Optional fields will attempt to decode.</T></p><p><strong>Example 2. Problem Scenario 1 can also be expanded using this method:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">KeyedDecodingContainer</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">decodeIfPresent</span><span class="p">(</span><span class="n">_</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">Bool</span><span class="o">.</span><span class="k">Type</span><span class="p">,</span> <span class="n">forKey</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">KeyedDecodingContainer</span><span class="o">&lt;</span><span class="kt">K</span><span class="o">&gt;.</span><span class="kt">Key</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Bool</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">intValue</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="nf">decodeIfPresent</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">return</span> <span class="p">(</span><span class="n">intValue</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">boolValue</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="nf">decodeIfPresent</span><span class="p">(</span><span class="kt">Bool</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">boolValue</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Song</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">like</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">like</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="s">"""
{
    "</span><span class="n">id</span><span class="s">": 1,
    "</span><span class="n">name</span><span class="s">": "</span><span class="n">Âëä‰∫î‰∫∫</span><span class="s">",
    "</span><span class="n">like</span><span class="s">": 1
}
"""</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Song</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Most of the clever tricks for using Codable have been tried. Some are quite convoluted because Codable‚Äôs constraints are very strict, sacrificing much of the flexibility needed in real-world development. In the end, I even started questioning why I chose Codable in the first place, as its advantages seem to diminish over time‚Ä¶.</p><h4 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://kemchenj.github.io/2018-07-09/" target="_blank">Maybe You Don‚Äôt Need to Rewrite the init(from:) Method</a></ul><h3 id="review"><span class="me-2">Review</span><a href="#review" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642">Real-World Codable Decode Issues Summary (Part 1)</a></ul><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=üç∫&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2020-06-25-cb00b1977537.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/codable/" class="post-tag no-text-decoration" >codable</a> <a href="/tags/json/" class="post-tag no-text-decoration" >json</a> <a href="/tags/core-data/" class="post-tag no-text-decoration" >core-data</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Codable%20Decode%20Issues%20Explained%EF%BD%9CHandling%20Null%20Response%20Fields%20Without%20Rewriting%20init%20Decoder%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Codable%20Decode%20Issues%20Explained%EF%BD%9CHandling%20Null%20Response%20Fields%20Without%20Rewriting%20init%20Decoder%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop UnboxingÔΩúPremium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch ÂéüÂéÇ‰∏çÈîàÈí¢Á±≥ÂÖ∞Ë°®Â∏¶ÂºÄÁÆ±</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/apple-watch-%E7%B1%B3%E8%98%AD%E9%8C%B6%E5%B8%B6%E9%96%8B%E7%AE%B1-%E5%8E%9F%E5%BB%A0%E4%B8%8D%E9%8F%BD%E9%8B%BC%E7%9F%B3%E5%A2%A8%E8%89%B2%E5%84%AA%E7%BC%BA%E9%BB%9E%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch ÂéüÂª†‰∏çÈèΩÈãºÁ±≥Ëò≠Èå∂Â∏∂ÈñãÁÆ±</a><li class="text-truncate lh-lg"> <a href="/posts/travel-journals/en/busan-travel-guide-8-day-itinerary-with-visit-busan-pass-for-seamless-exploration-8ace34a1a3d8/">Busan Travel GuideÔΩú8-Day Itinerary with VISIT BUSAN PASS for Seamless Exploration</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/zh-cn/%E9%87%9C%E5%B1%B1%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-8%E5%A4%A97%E5%A4%9C%E5%BF%85%E5%8E%BB%E6%99%AF%E7%82%B9-%E7%BE%8E%E9%A3%9F%E4%B8%8E%E4%BA%A4%E9%80%9A%E5%85%A8%E8%A7%A3%E6%9E%90-%E9%87%9C%E5%B1%B1%E9%80%9A%E8%A1%8C%E8%AF%81%E7%9C%81%E9%92%B1%E7%A7%98%E8%AF%80-8ace34a1a3d8/">Ê∏∏ËÆ∞ 2025 Èü©ÂõΩÈáúÂ±± 8 Â§© 7 Â§úËá™Áî±Ë°å</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Á´†ÁØÄ (Chapters)üîñ</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1592066038" data-df="ll" > Jun 14, 2020 </time><h4 class="pt-0 my-2">Codable Decode Issues ExplainedÔΩúMaster Decodable for Real-World iOS Challenges</h4><div class="text-muted"><p>iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/codable-%E8%A7%A3%E7%A2%BC%E9%80%B2%E9%9A%8E%E6%8A%80%E5%B7%A7-%E5%8D%80%E5%88%86-null-%E8%88%87%E6%AC%84%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AF%A6%E7%8F%BE-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1593107791" data-df="ll" > Jun 26, 2020 </time><h4 class="pt-0 my-2">ÁèæÂØ¶‰ΩøÁî® Codable ‰∏äÈÅáÂà∞ÁöÑ Decode ÂïèÈ°åÂ†¥ÊôØÁ∏ΩÂåØ(‰∏ã)</h4><div class="text-muted"><p>ÂêàÁêÜÁöÑËôïÁêÜ Response Null Ê¨Ñ‰ΩçË≥áÊñô„ÄÅ‰∏ç‰∏ÄÂÆöÈÉΩË¶ÅÈáçÂØ´ init decoder</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/codable-%E8%A7%A3%E7%A0%81%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7-%E5%8C%BA%E5%88%86-null-%E4%B8%8E%E6%A0%8F%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AE%9E%E7%8E%B0-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1593107791" data-df="ll" > Jun 26, 2020 </time><h4 class="pt-0 my-2">Áé∞ÂÆû‰ΩøÁî® Codable ‰∏äÈÅáÂà∞ÁöÑ Decode ÈóÆÈ¢òÂú∫ÊôØÊÄªÊ±á(‰∏ã)</h4><div class="text-muted"><p>ÂêàÁêÜÁöÑÂ§ÑÁêÜ Response Null Ê†è‰ΩçËµÑÊñô„ÄÅ‰∏ç‰∏ÄÂÆöÈÉΩË¶ÅÈáçÂÜô init decoder</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-life/google-site-%E5%80%8B%E4%BA%BA%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E6%95%99%E5%AD%B8-%E5%84%AA%E7%BC%BA%E9%BB%9E%E8%A7%A3%E6%9E%90%E8%88%87%E7%B6%B2%E5%9F%9F%E7%B6%81%E5%AE%9A%E8%A8%AD%E5%AE%9A%E5%85%A8%E6%94%BB%E7%95%A5-724a7fb9a364/" class="btn btn-outline-primary" aria-label="Older" ><p>Google Site ÂÄã‰∫∫Á∂≤Á´ôÂª∫ÁΩÆÊïôÂ≠∏ÔΩúÂÑ™Áº∫ÈªûËß£ÊûêËàáÁ∂≤ÂüüÁ∂ÅÂÆöË®≠ÂÆöÂÖ®ÊîªÁï•</p></a> <a href="/posts/zrealm-dev/zh-cn/codable-%E8%A7%A3%E7%A0%81%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7-%E5%8C%BA%E5%88%86-null-%E4%B8%8E%E6%A0%8F%E4%BD%8D%E7%BC%BA%E5%A4%B1-%E5%AE%9E%E7%8E%B0-core-data-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0-cb00b1977537/" class="btn btn-outline-primary" aria-label="Newer" ><p>Áé∞ÂÆû‰ΩøÁî® Codable ‰∏äÈÅáÂà∞ÁöÑ Decode ÈóÆÈ¢òÂú∫ÊôØÊÄªÊ±á(‰∏ã)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved. <a href="/">‰∏≠Êñá</a>|<a href="/tags/english/">English</a></span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/japan/">japan</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
