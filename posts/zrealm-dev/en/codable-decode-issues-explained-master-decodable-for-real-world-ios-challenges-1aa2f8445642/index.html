<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability." /><meta property="og:description" content="iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-14T00:33:58+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" /><meta property="twitter:title" content="Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:24:35+08:00","datePublished":"2020-06-14T00:33:58+08:00","description":"iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability.","headline":"Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"}</script><title>Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/codable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges</h1><p class="post-desc fw-light mb-4">iOS developers facing Codable decode errors can resolve complex scenarios with practical solutions from basic to advanced Decodable techniques, ensuring robust data parsing and app stability.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1592066038" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 14, 2020 </time> </span> <span> Updated <time data-ts="1712996675" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" class="popup img-link preview-img blur"><img data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3947 words" > <em>21 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Codable Decode Issues Explained｜Master Decodable for Real-World iOS Challenges</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/"><strong>點擊這裡</strong></a>查看本文章正體中文版本。</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance — let me know if anything sounds off!</p></blockquote><h2><h4 id="zhgchgli-table-of-contents">Table of Contents</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary> <a href="#">#</a></summary><ul><li><a href="#real-world-codable-decoding-issues-overview-part-1">Real-World Codable Decoding Issues Overview (Part 1)</a></li><li><a href="#introduction">Introduction</a></li><li><a href="#main-topic">Main Topic</a></li><li class="has-children"><details><summary>Start <a href="#start">#</a></summary><ul><li><a href="#codingkeys-enum">CodingKeys Enum?</a></li><li><a href="#when-the-returned-data-is-an-array">When the returned data is an array</a></li><li><a href="#adding-constraints-to-string">Adding Constraints to String</a></li><li><a href="#use-generics-to-wrap-fixed-structures">Use Generics to Wrap Fixed Structures</a></li><li><a href="#datetimestamp-auto-decode">Date/Timestamp Auto Decode</a></li><li><a href="#basic-decode-knowledge">Basic Decode Knowledge</a></li></ul></details></li><li class="has-children"><details><summary>Advanced Usage <a href="#advanced-usage">#</a></summary><ul><li><a href="#initfrom-decoder-decoder">init(from decoder: Decoder)</a></li><li><a href="#under-a-container-we-can-also-use-nestedcontainer--nestedunkeyedcontainer-to-operate-on-specific-fields">Under a Container, we can also use nestedContainer / nestedUnkeyedContainer to operate on specific fields</a></li><li><a href="#decode--decodeifpresent">Decode & DecodeIfPresent</a></li></ul></details></li><li class="has-children"><details><summary>Real-World Scenario <a href="#real-world-scenario">#</a></summary><ul><li><a href="#scenario-1-suppose-a-comment-could-be-directed-at-either-a-song-or-a-person-the-targetobject-field-could-be-either-user-or-song-how-should-this-be-handled">Scenario 1. Suppose a comment could be directed at either a song or a person. The targetObject field could be either User or Song. How should this be handled?</a></li><li><a href="#method-a">Method a.</a></li><li><a href="#method-b">Method b.</a></li><li><a href="#scenario-2-how-to-decode-when-the-data-array-contains-multiple-data-types">Scenario 2. How to Decode When the Data Array Contains Multiple Data Types?</a></li><li><a href="#scenario-3-decode-only-when-json-string-field-has-value">Scenario 3. Decode Only When JSON String Field Has Value</a></li><li><a href="#scenario-4-skip-data-with-decode-errors-in-array-data">Scenario 4. Skip Data with Decode Errors in Array Data</a></li><li><a href="#scenario-5-some-fields-are-for-internal-program-use-and-do-not-need-to-be-decoded">Scenario 5. Some fields are for internal program use and do not need to be decoded</a></li><li><a href="#method-a-entitymodel">Method a. Entity/Model</a></li><li><a href="#method-b-init-handling">Method b. init handling</a></li><li><a href="#20200626-update--part-2-scenario-6-how-to-decode-api-response-using-01-to-represent-bool">[2020/06/26 Update] — Part 2 Scenario 6. How to Decode API Response Using 0/1 to Represent Bool?</a></li><li><a href="#20200626-update--next-scenario-7-avoid-rewriting-init-decoder-every-time">[2020/06/26 Update] — Next: Scenario 7. Avoid rewriting init decoder every time</a></li><li><a href="#20200626-update--next-scenario-8-proper-handling-of-response-null-field-data">[2020/06/26 Update] — Next: Scenario 8. Proper Handling of Response Null Field Data</a></li></ul></details></li><li><a href="#comprehensive-scenario-example">Comprehensive Scenario Example</a></li><li><a href="#part-2--other-scenarios-updated">Part (2) & Other Scenarios Updated</a></li><li><a href="#summary">Summary</a></li><li><a href="#further-reading">Further Reading</a></li></ul></details></li></ul></nav></h2><h3 id="real-world-codable-decoding-issues-overview-part-1"><span class="me-2">Real-World Codable Decoding Issues Overview (Part 1)</span><a href="#real-world-codable-decoding-issues-overview-part-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>From Basics to Advanced: Deep Dive into Using Decodable to Handle All Possible Problem Scenarios</p><p><a href="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*9VYP3_Mhj9xsLKbgCwt6XQ.webp" alt="Photo by [Gustas Brazaitis](https://unsplash.com/@gustasbrazaitis){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjUzNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@gustasbrazaitis" target="_blank">Gustas Brazaitis</a></p><h3 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Due to the backend API upgrade, we needed to adjust the API handling architecture. Recently, we took this opportunity to update the original network handling framework, which was written in Objective-C, to Swift. Because of the language difference, it was no longer suitable to use the original <a href="https://github.com/RestKit/RestKit" target="_blank">Restkit</a> for managing the network layer. However, Restkit was incredibly powerful with many features and was used effectively in the project with hardly any major issues. On the downside, it was very heavy, almost no longer maintained, and purely Objective-C; it will inevitably need to be replaced in the future.</p><p>Restkit almost handles all the features needed for network requests, from basic network handling, API calls, network processing, to response handling like converting JSON strings to objects, and even saving objects into Core Data. It’s truly a framework that can do the work of ten.</p><p>With the evolution of time, current frameworks no longer focus on all-in-one solutions. Instead, they emphasize flexibility, lightweight design, and modularity to increase adaptability and create more variations. Therefore, when switching to Swift, we chose Moya as the network handling library and combined other functionalities using different methods as needed.</p><h3 id="main-topic"><span class="me-2">Main Topic</span><a href="#main-topic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Regarding the JSON String to Object Mapping section, we use Swift’s built-in Codable (Decodable) protocol and JSONDecoder for processing; we also separate Entity/Model to enhance responsibility division, operation, and readability. Additionally, the codebase mixes Objective-C and Swift, which must be taken into account.</p><blockquote><p><em>＊ The Encodable part is omitted; examples only show Decodable implementation. They are similar—if you can decode, you can also encode.</em></p></blockquote><h3 id="start"><span class="me-2">Start</span><a href="#start" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Assuming our initial API Response JSON String is as follows:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It is '告五人', not '五告人'!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars and Moon"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>From the above example, we can split into three Entities &amp; Models: User, Song, and Comment, allowing us to reuse components. For convenience, we first write the Entities/Models in the same file for demonstration.</p><p>Please provide the Markdown paragraphs you want me to translate into English.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// Model:</span>
<span class="kd">class</span> <span class="kt">UserModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">UserEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
      <span class="k">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">email</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Song:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// Model:</span>
<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Comment:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// Entity:</span>
<span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongEntity</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
<span class="p">}</span>

<span class="c1">//Model:</span>
<span class="kd">class</span> <span class="kt">CommentModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">CommentEntity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
      <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">comment</span>
      <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="kt">SongModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
      <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="kt">UserModel</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">SongModel</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserModel</span>
<span class="p">}</span>
</pre></table></code></div></div><p>JSONDecoder:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 123456, </span><span class="se">\"</span><span class="s">comment</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">It's '告五人', not '五告人'!</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">target_object</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">披星戴月的想你</span><span class="se">\"</span><span class="s"> }, </span><span class="se">\"</span><span class="s">commenter</span><span class="se">\"</span><span class="s">: { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">user</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 1, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">email</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">zhgchgli@gmail.com</span><span class="se">\"</span><span class="s"> } }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="codingkeys-enum"><span class="me-2">CodingKeys Enum?</span><a href="#codingkeys-enum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>When our JSON string key names do not match the entity object’s property names, we can add an internal CodingKeys enum for mapping. After all, we cannot control the naming conventions of the backend data source.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="o">=</span> <span class="s">"Backend Field Name"</span>
<span class="k">case</span> <span class="kt">PropertyKeyName</span> <span class="c1">// If not specified, PropertyKeyName is used as the default backend field name</span>
</pre></table></code></div></div><p>Once you add the CodingKeys enum, you must list all non-Optional fields; you cannot list only the keys you want to customize.</p><p>Another way is to set the JSONDecoder’s keyDecodingStrategy. If the response data fields and property names differ only by <code class="language-plaintext highlighter-rouge">snake_case</code> &lt;-&gt; <code class="language-plaintext highlighter-rouge">camelCase</code>, you can directly set <code class="language-plaintext highlighter-rouge">.keyDecodingStrategy</code> = <code class="language-plaintext highlighter-rouge">.convertFromSnakeCase</code> to automatically match the mapping.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">jsonDecoder</span><span class="o">.</span><span class="n">keyDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">convertFromSnakeCase</span>
<span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="when-the-returned-data-is-an-array"><span class="me-2">When the returned data is an array:</span><a href="#when-the-returned-data-is-an-array" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">songs</span><span class="p">:</span> <span class="p">[</span><span class="kt">SongEntity</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="adding-constraints-to-string"><span class="me-2">Adding Constraints to String:</span><a href="#adding-constraints-to-string" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">SongType</span>
  
  <span class="kd">enum</span> <span class="kt">SongType</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">rock</span>
    <span class="k">case</span> <span class="n">pop</span>
    <span class="k">case</span> <span class="n">country</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Applicable to limited string types, written as Enum for easy passing and usage; if a value outside the enum appears, decoding will fail!</p><h4 id="use-generics-to-wrap-fixed-structures"><span class="me-2">Use Generics to Wrap Fixed Structures:</span><a href="#use-generics-to-wrap-fixed-structures" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Assuming multiple returned JSON strings have a fixed format:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>It can be wrapped using a generic approach:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">PageEntity</span><span class="o">&lt;</span><span class="kt">E</span><span class="p">:</span> <span class="kt">Decodable</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">offset</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">limit</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">E</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Use: <code class="language-plaintext highlighter-rouge">PageEntity&lt;Song&gt;.self</code></p><h4 id="datetimestamp-auto-decode"><span class="me-2">Date/Timestamp Auto Decode:</span><a href="#datetimestamp-auto-decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Setting <code class="language-plaintext highlighter-rouge">JSONDecoder</code>’s <code class="language-plaintext highlighter-rouge">dateDecodingStrategy</code></p><ul><li><p><code class="language-plaintext highlighter-rouge">.secondsSince1970/.millisecondsSince1970</code> : unix timestamp</p><li><p><code class="language-plaintext highlighter-rouge">.deferredToDate</code> : Apple’s timestamp, rarely used, different from unix timestamp, counted from 2001/01/01</p><li><p><code class="language-plaintext highlighter-rouge">.iso8601</code> : ISO 8601 date format</p><li><p><code class="language-plaintext highlighter-rouge">.formatted(DateFormatter)</code> : Decode Date according to the passed DateFormatter</p><li><p><code class="language-plaintext highlighter-rouge">.custom</code> : Custom Date Decode logic</p></ul><p><strong>.custom Example: Assume the API returns both YYYY/MM/DD and ISO 8601 formats, and both need to be decoded:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">dateFormatter</span> <span class="o">=</span> <span class="kt">DateFormatter</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">iso8601DateFormatter</span> <span class="o">=</span> <span class="kt">ISO8601DateFormatter</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">decoder</span><span class="o">.</span><span class="n">dateDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="nf">custom</span><span class="p">({</span> <span class="p">(</span><span class="n">decoder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Date</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">dateString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    
    <span class="c1">// ISO8601:</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">iso8601DateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="c1">// YYYY-MM-DD:</span>
    <span class="n">dateFormatter</span><span class="o">.</span><span class="n">dateFormat</span> <span class="o">=</span> <span class="s">"yyyy-MM-dd"</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">dateString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">date</span>
    <span class="p">}</span>
    
    <span class="k">throw</span> <span class="kt">DecodingError</span><span class="o">.</span><span class="nf">dataCorruptedError</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="s">"Cannot decode date string </span><span class="se">\(</span><span class="n">dateString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">CommentEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p><em>＊DateFormatter is very performance-intensive during initialization; reuse it as much as possible.</em></p></blockquote><h4 id="basic-decode-knowledge"><span class="me-2">Basic Decode Knowledge:</span><a href="#basic-decode-knowledge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><p>The field types (struct/class/enum) within the Decodable Protocol must all conform to the Decodable Protocol; alternatively, values can be assigned during the init decoder.</p><li><p>Decode fails when the field types do not match.</p><li><p>If a field in a Decodable Object is set as Optional, it means it is optional; if provided, it will be decoded.</p><li><p>Optional fields can accept: JSON String with no fields, or given but set to nil.</p><li><p>Blank and 0 are not equal to nil; nil is nil. Be careful with weakly typed backend APIs!</p><li><p>By default, if a Decodable Object has an enum field that is non-Optional, decoding will fail if the JSON string does not provide a value (handling this will be explained later).</p><li><p>By default, a decode failure will immediately stop the process, making it impossible to simply skip the erroneous data (handling will be explained later).</p></ol><p><a href="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*B-j47uMMshXozF32msbRtg.webp" alt="[Left: &quot;&quot; Right: nil](https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijc4NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://josjong.com/2017/10/16/null-vs-empty-strings-why-oracle-was-right-and-apple-is-not/" target="_blank">Left: “” / Right: nil</a></p><h3 id="advanced-usage"><span class="me-2">Advanced Usage</span><a href="#advanced-usage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So far, the basic usage is complete, but the real world is not that simple. Below are some advanced scenarios and Codable-based solutions. From this point on, we can no longer rely on the default Decode to handle mapping for us; we need to implement <code class="language-plaintext highlighter-rouge">init(from decoder: Decoder)</code> for custom decoding.</p><blockquote><p><em>＊Here, only the Entity part is shown temporarily; the Model is not needed yet.</em></p></blockquote><h4 id="initfrom-decoder-decoder"><span class="me-2">init(from decoder: Decoder)</span><a href="#initfrom-decoder-decoder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>init decoder must assign initial values to all non-Optional fields (that’s what init is for!).</p><p>When customizing the Decode operation, we need to get the <code class="language-plaintext highlighter-rouge">container</code> from the <code class="language-plaintext highlighter-rouge">decoder</code> to extract values. There are three types of content retrieval for the <code class="language-plaintext highlighter-rouge">container</code>.</p><p><a href="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*U2Rt9KZq3Vw_lkZkJl7t_Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODEiIGhlaWdodD0iMjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>The first type container(keyedBy: CodingKeys.self)</strong> <strong>Operates according to CodingKeys:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">name</span>
    <span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1">// Parameter 1 accepts support: a class implementing Decodable</span>
        <span class="c1">// Parameter 2 CodingKeys</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>The second singleValueContainer</strong> <strong>Extract the entire package for operation (single value):</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">HandsomeLevel</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">handsome</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">normal</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"zhgchgli"</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">handsome</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">normal</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">UserEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">HandsomeLevel</span>
    <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">email</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Applicable to Associated Value Enum field types, such as name which also includes a coolness level!</p><p><strong>The third type: unkeyedContainer</strong> <strong>Treat the entire package as an array:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">unkeyedContainer</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="c1">// The internal pointer of unkeyedContainer automatically moves to the next object after decode operation</span>
            <span class="c1">// When it reaches the end, it means the iteration is complete</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"[</span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s">,1234,5566]"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ListEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>Applicable to array fields with variable types.</p><h4 id="under-a-container-we-can-also-use-nestedcontainer--nestedunkeyedcontainer-to-operate-on-specific-fields"><span class="me-2">Under a Container, we can also use nestedContainer / nestedUnkeyedContainer to operate on specific fields:</span><a href="#under-a-container-we-can-also-use-nestedcontainer--nestedunkeyedcontainer-to-operate-on-specific-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>＊Flatten Data Fields (similar to flatMap)</em></strong></p></blockquote><p><a href="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.webp" class="popup img-link blur"><img data-src="/assets/1aa2f8445642/1*IE_dCAdXGDMaW-nSNT2ITg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTExIiBoZWlnaHQ9IjI0MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ListEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">items</span>
        <span class="k">case</span> <span class="n">date</span>
        <span class="k">case</span> <span class="n">name</span>
        <span class="k">case</span> <span class="n">target</span>
    <span class="p">}</span>
    
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">Decodable</span><span class="p">]</span>
    <span class="k">var</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">Decodable</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">name</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">nestedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        
        <span class="k">let</span> <span class="nv">type</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type</span> <span class="o">==</span> <span class="s">"song"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">unkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">unkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">unkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Accessing and decoding objects at different levels, the example demonstrates using nestedContainer and flat to output the type, then decoding accordingly based on the type.</p><h4 id="decode--decodeifpresent"><span class="me-2">Decode &amp; DecodeIfPresent</span><a href="#decode--decodeifpresent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><strong>DecodeIfPresent:</strong> Decode only if the response contains the data field (when the Codable property is Optional)</p><li><p><strong>Decode:</strong> Perform the decode operation. If the response lacks a data field, an error will be thrown.</p></ul><blockquote><p><strong><em>＊The above is just a brief introduction to the init decoder and container methods and functions. If you don’t understand, it’s okay. Let’s move directly to real-world scenarios and experience how they work together in the examples.</em></strong></p></blockquote><h3 id="real-world-scenario"><span class="me-2">Real-World Scenario</span><a href="#real-world-scenario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Back to the original example JSON String.</p><h4 id="scenario-1-suppose-a-comment-could-be-directed-at-either-a-song-or-a-person-the-targetobject-field-could-be-either-user-or-song-how-should-this-be-handled"><span class="me-2">Scenario 1. Suppose a comment could be directed at either a song or a person. The <code class="language-plaintext highlighter-rouge">targetObject</code> field could be either <code class="language-plaintext highlighter-rouge">User</code> or <code class="language-plaintext highlighter-rouge">Song</code>. How should this be handled?</span><a href="#scenario-1-suppose-a-comment-could-be-directed-at-either-a-song-or-a-person-the-targetobject-field-could-be-either-user-or-song-how-should-this-be-handled" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's '告五人', not '五告人'!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars and Moon"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
      </span><span class="nl">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"66666!"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhgchgli"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"commenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aaaa@gmail.com"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h4 id="method-a"><span class="me-2">Method a.</span><a href="#method-a" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using Enum as a Container for Decoding.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">TargetObject</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="kd">enum</span> <span class="kt">TargetObject</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">song</span><span class="p">(</span><span class="kt">SongEntity</span><span class="p">)</span>
        <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="kt">UserEntity</span><span class="p">)</span>
        
        <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">type</span>
        <span class="p">}</span>
        
        <span class="kd">enum</span> <span class="kt">TargetObjectType</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">song</span>
            <span class="k">case</span> <span class="n">user</span>
        <span class="p">}</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">singleValueContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">TargetObjectType</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
            
            <span class="k">switch</span> <span class="n">targetObjectType</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">song</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">user</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="k">try</span> <span class="n">singleValueContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">self</span> <span class="o">=</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We changed the property of <code class="language-plaintext highlighter-rouge">targetObject</code> to an Associated Value Enum, deciding what content to put inside the Enum only during decoding.</p><p>The core practice is to create an Enum conforming to Decodable as a container. During decoding, first extract the key field (the <code class="language-plaintext highlighter-rouge">type</code> field in the example JSON string) to determine the type. If it is <code class="language-plaintext highlighter-rouge">Song</code>, use singleValueContainer to decode the entire package into a <code class="language-plaintext highlighter-rouge">SongEntity</code>; similarly for <code class="language-plaintext highlighter-rouge">User</code>.</p><p><strong>Only extract from the Enum when needed:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//if case let</span>
<span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">case</span> <span class="k">let</span> <span class="nv">CommentEntity</span><span class="o">.</span><span class="kt">TargetObject</span><span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="n">song</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//switch case let</span>
<span class="k">switch</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="p">{</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">song</span><span class="p">(</span><span class="k">let</span> <span class="nv">song</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="method-b"><span class="me-2">Method b.</span><a href="#method-b" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Change the declaration of the field attribute to Base Class.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">CommentEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">id</span>
      <span class="k">case</span> <span class="n">comment</span>
      <span class="k">case</span> <span class="n">targetObject</span> <span class="o">=</span> <span class="s">"target_object"</span>
      <span class="k">case</span> <span class="n">commenter</span>
    <span class="p">}</span>
    <span class="kd">enum</span> <span class="kt">PredictKey</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">type</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">comment</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">targetObject</span><span class="p">:</span> <span class="kt">Decodable</span>
    <span class="k">var</span> <span class="nv">commenter</span><span class="p">:</span> <span class="kt">UserEntity</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">commenter</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">commenter</span><span class="p">)</span>
        
        <span class="c1">//</span>
        <span class="k">let</span> <span class="nv">targetObjectContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedContainer</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">PredictKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">targetObjectType</span> <span class="o">=</span> <span class="k">try</span> <span class="n">targetObjectContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">targetObjectType</span> <span class="o">==</span> <span class="s">"user"</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">UserEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">targetObject</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">targetObject</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The principle is similar, but here we first use <code class="language-plaintext highlighter-rouge">nestedContainer</code> to access <code class="language-plaintext highlighter-rouge">targetObject</code> and get <code class="language-plaintext highlighter-rouge">type</code> for judgment, then decide what type <code class="language-plaintext highlighter-rouge">targetObject</code> should be decoded into.</p><p><strong>Cast only when needed:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">Song</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targetObject</span> <span class="k">as?</span> <span class="kt">User</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="scenario-2-how-to-decode-when-the-data-array-contains-multiple-data-types"><span class="me-2">Scenario 2. How to Decode When the Data Array Contains Multiple Data Types?</span><a href="#scenario-2-how-to-decode-when-the-data-array-contains-multiple-data-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>{
  "results": [
    {
      "type": "song",
      "id": 99,
      "name": "Missing You Under the Stars"
    },
    {
      "type": "user",
      "id": 1,
      "name": "zhgchgli",
      "email": "zhgchgli@gmail.com"
    }
  ]
}
</pre></table></code></div></div><p>Combine the mentioned <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> with the solution from Scenario 1; here, you can also use the <strong>a. solution</strong> from <strong>Scenario 1</strong> to access values with an Associated Value Enum.</p><h4 id="scenario-3-decode-only-when-json-string-field-has-value"><span class="me-2">Scenario 3. Decode Only When JSON String Field Has Value</span><a href="#scenario-3-decode-only-when-json-string-field-has-value" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[
  {
    "type": "song",
    "id": 99,
    "name": "Missing You Under the Stars"
  },
    {
    "type": "song",
    "id": 11
  }
]
</pre></table></code></div></div><p>Use decodeIfPresent for decoding.</p><h4 id="scenario-4-skip-data-with-decode-errors-in-array-data"><span class="me-2">Scenario 4. Skip Data with Decode Errors in Array Data</span><a href="#scenario-4-skip-data-with-decode-errors-in-array-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thinking of You Under the Stars and Moon"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"errro"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"song"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Take Me to Find Nightlife"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>As mentioned earlier, Decodable by default requires all data to be correctly parsed to output the mapping; sometimes the backend provides unstable data, giving a long array where a few entries have missing fields or mismatched field types, causing Decode to fail; resulting in the entire batch failing and returning nil.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">ResultsEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">results</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">SongEntity</span><span class="p">]</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">nestedUnkeyedContainer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">nestedUnkeyedContainer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">results</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="o">!</span><span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="n">isAtEnd</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">song</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">SongEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedUnkeyedContainer</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">EmptyEntity</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">EmptyEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">results</span><span class="se">\"</span><span class="s">: [ { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 99, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Under the Stars Missing You</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">error</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">errro</span><span class="se">\"</span><span class="s"> }, { </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">song</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">id</span><span class="se">\"</span><span class="s">: 19, </span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Take Me to Find Nightlife</span><span class="se">\"</span><span class="s"> } ] }"</span>
<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ResultsEntity</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p>The solution is similar to <strong>Scenario 2’s solution</strong>; use <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> to iterate through each item and try? Decode. If decoding fails, use an Empty Decode to allow the internal pointer of <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> to continue.</p><blockquote><p><em>＊This method is a bit of a workaround because we cannot skip the <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> command, and <code class="language-plaintext highlighter-rouge">nestedUnkeyedContainer</code> must successfully decode to continue execution; that’s why it is done this way. Some in the Swift community have proposed adding <a href="https://forums.swift.org/t/pitch-unkeyeddecodingcontainer-movenext-to-skip-items-in-deserialization/22151/16" target="_blank">moveNext()</a>, but it is not yet implemented in the current version.</em></p></blockquote><h4 id="scenario-5-some-fields-are-for-internal-program-use-and-do-not-need-to-be-decoded"><span class="me-2">Scenario 5. Some fields are for internal program use and do not need to be decoded</span><a href="#scenario-5-some-fields-are-for-internal-program-use-and-do-not-need-to-be-decoded" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="method-a-entitymodel"><span class="me-2">Method a. Entity/Model</span><a href="#method-a-entitymodel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Here, we need to mention the purpose of splitting Entity and Model as stated earlier; Entity is solely responsible for JSON String to Entity (Decodable) mapping; Model initializes with Entity, and all actual program passing, operations, and business logic use Model.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">SongEntity</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SongModel</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">entity</span><span class="p">:</span> <span class="kt">SongEntity</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">type</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="k">var</span> <span class="nv">isSave</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">// business logic</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Benefits of Splitting Entity/Model:</strong></p><ol><li><p>Clear Responsibilities, Entity: JSON String to Decodable, Model: Business Logic</p><li><p>A clear mapping of which fields to view in the Entity at a glance</p><li><p>Avoid all fields clustering together when there are many columns</p><li><p><strong>Objective-C is also usable</strong> (because the Model is just NSObject, struct/Decodable is not visible to Objective-C)</p><li><p>Place the business logic and fields for internal use in the Model only.</p></ol><h4 id="method-b-init-handling"><span class="me-2">Method b. init handling</span><a href="#method-b-init-handling" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>List the CodingKeys and exclude internally used fields. Providing default values during init, having default values for fields, or setting them as Optional are not good practices; they just allow the code to run.</p><h4 id="20200626-update--part-2-scenario-6-how-to-decode-api-response-using-01-to-represent-bool"><span class="me-2">[2020/06/26 Update] — Part 2 Scenario 6. How to Decode API Response Using 0/1 to Represent Bool?</span><a href="#20200626-update--part-2-scenario-6-how-to-decode-api-response-using-01-to-represent-bool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/">Real-world Codable Decode Issues Summary (Part 2)</a></ul><h4 id="20200626-update--next-scenario-7-avoid-rewriting-init-decoder-every-time"><span class="me-2">[2020/06/26 Update] — Next: Scenario 7. Avoid rewriting init decoder every time</span><a href="#20200626-update--next-scenario-7-avoid-rewriting-init-decoder-every-time" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/">Practical Issues Encountered with Codable Decoding - Part 2</a></ul><h4 id="20200626-update--next-scenario-8-proper-handling-of-response-null-field-data"><span class="me-2">[2020/06/26 Update] — Next: Scenario 8. Proper Handling of Response Null Field Data</span><a href="#20200626-update--next-scenario-8-proper-handling-of-response-null-field-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/">Real-World Codable Decoding Issues Summary (Part 2)</a></ul><h3 id="comprehensive-scenario-example"><span class="me-2">Comprehensive Scenario Example</span><a href="#comprehensive-scenario-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A complete example combining both basic and advanced usage:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>{
  "count": 5,
  "offset": 0,
  "limit": 10,
  "results": [
    {
      "id": 123456,
      "comment": "It's '告五人', not '五告人'!",
      "target_object": {
        "type": "song",
        "id": 99,
        "name": "Thinking of You Under the Stars",
        "create_date": "2020-06-13T15:21:42+0800"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      }
    },
    {
      "error": "not found"
    },
    {
      "error": "not found"
    },
    {
      "id": 2,
      "comment": "Haha, me too!",
      "target_object": {
        "type": "user",
        "id": 1,
        "name": "zhgchgli",
        "email": "zhgchgli@gmail.com",
        "birthday": "1994/07/18"
      },
      "commenter": {
        "type": "user",
        "id": 1,
        "name": "RandomUserA",
        "email": "man@gmail.com",
        "birthday": "2000/01/12"
      }
    }
  ]
}
</pre></table></code></div></div><p><strong>Output:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>zhgchgli: It's "告五人," not "五告人!"
</pre></table></code></div></div><p>The complete example demonstration is as above!</p><h3 id="part-2--other-scenarios-updated"><span class="me-2">Part (2) &amp; Other Scenarios Updated:</span><a href="#part-2--other-scenarios-updated" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/">Real-World Codable Decoding Issues Summary (Part 2)</a></ul><h3 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The benefits of choosing Codable are, first of all, that it is native, so you don’t have to worry about lack of maintenance later, and it also results in clean code; however, it has stricter limitations and is less flexible in parsing JSON strings. Otherwise, you need to do more work as shown in this article to complete it. Additionally, its performance is not necessarily better than other mapping libraries (Decodable still uses the Objective-C era NSJSONSerialization for parsing). But I believe Apple may optimize this in future updates, so we won’t have to change the code then.</p><p>The scenarios and examples in the article may be extreme, but sometimes you just have to deal with them; of course, we hope that in most cases, simple Codable will meet our needs. However, with the techniques above, there should be no problem that can’t be solved!</p><blockquote><p><em>Thanks to <a href="https://twitter.com/saiday" target="_blank">＠saiday</a> for the technical support.</em></p></blockquote><p><a href="https://www.youtube.com/watch?v=W9Fq1HC_5hg" target="_blank"></a></p><h3 id="further-reading"><span class="me-2">Further Reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p><a href="https://kemchenj.github.io/2018-06-03/" target="_blank">Deep Dive into Decodable — Writing a JSON Parser Beyond the Native One</a><br /> Full of content, a thorough understanding of Decoder/JSONDecoder.</p><li><p><a href="https://onevcat.com/2018/03/swift-meta/" target="_blank">Different Perspectives on Problems — From Codable to Swift Metaprogramming</a></p><li><p><a href="https://medium.com/better-programming/why-model-objects-shouldnt-implement-swift-s-decodable-or-encodable-protocols-1249cb44d4b3" target="_blank">Why Model Objects Shouldn’t Implement Swift’s Decodable or Encodable Protocols</a></p></ol><p>If you have any questions or suggestions, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/1aa2f8445642" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2020-06-13-1aa2f8445642.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/codable/" class="post-tag no-text-decoration" >codable</a> <a href="/tags/json/" class="post-tag no-text-decoration" >json</a> <a href="/tags/decode/" class="post-tag no-text-decoration" >decode</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Codable%20Decode%20Issues%20Explained%EF%BD%9CMaster%20Decodable%20for%20Real-World%20iOS%20Challenges%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Codable%20Decode%20Issues%20Explained%EF%BD%9CMaster%20Decodable%20for%20Real-World%20iOS%20Challenges%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fcodable-decode-issues-explained-master-decodable-for-real-world-ios-challenges-1aa2f8445642%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/en/codable-decode-issues-explained-handling-null-response-fields-without-rewriting-init-decoder-cb00b1977537/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1593107791" data-df="ll" > Jun 26, 2020 </time><h4 class="pt-0 my-2">Codable Decode Issues Explained｜Handling Null Response Fields Without Rewriting init Decoder</h4><div class="text-muted"><p>Developers facing Codable decode errors can resolve null response field issues efficiently without rewriting init decoder methods, improving data parsing reliability and reducing code complexity.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/swift-codable-%E8%A7%A3%E7%A2%BC%E5%95%8F%E9%A1%8C%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%A0%B4%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E8%88%87%E9%8C%AF%E8%AA%A4%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1592066038" data-df="ll" > Jun 14, 2020 </time><h4 class="pt-0 my-2">現實使用 Codable 上遇到的 Decode 問題場景總匯</h4><div class="text-muted"><p>從基礎到進階，深入使用 Decodable 滿足所有可能會遇到的問題場景</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1592066038" data-df="ll" > Jun 14, 2020 </time><h4 class="pt-0 my-2">现实使用 Codable 上遇到的 Decode 问题场景总汇</h4><div class="text-muted"><p>从基础到进阶，深入使用 Decodable 满足所有可能会遇到的问题场景</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-life/iphone-%E9%80%8F%E8%A6%96%E9%80%8F%E6%98%8E%E6%89%8B%E6%A9%9F%E6%A1%8C%E5%B8%83%E8%A3%BD%E4%BD%9C%E6%95%99%E5%AD%B8-imovie-%E7%B6%A0%E5%B9%95%E6%91%B3%E5%9C%96%E5%BF%AB%E9%80%9F%E5%90%88%E6%88%90%E6%8A%80%E5%B7%A7-2e4429f410d6/" class="btn btn-outline-primary" aria-label="Older" ><p>iPhone 透視透明手機桌布製作教學｜iMovie 綠幕摳圖快速合成技巧</p></a> <a href="/posts/zrealm-dev/zh-cn/swift-codable-%E8%A7%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%85%A8%E6%94%BB%E7%95%A5-%E5%A4%9A%E5%9C%BA%E6%99%AF-json-%E8%A7%A3%E6%9E%90%E4%B8%8E%E9%94%99%E8%AF%AF%E5%AE%B9%E5%BF%8D%E6%8A%80%E5%B7%A7-1aa2f8445642/" class="btn btn-outline-primary" aria-label="Newer" ><p>现实使用 Codable 上遇到的 Decode 问题场景总汇</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
