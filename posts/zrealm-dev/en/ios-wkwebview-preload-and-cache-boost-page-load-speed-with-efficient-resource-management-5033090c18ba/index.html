<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively." /><meta property="og:description" content="Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively." /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-28T17:53:05+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" /><meta property="twitter:title" content="iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-08-10T17:11:41+08:00","datePublished":"2024-07-28T17:53:05+08:00","description":"Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively.","headline":"iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"},"url":"https://zhgchg.li/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"}</script><title>iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/en/ios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba/"><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan üáπüáº who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="https://medium.com/@zhgchgli" class="nav-link" target="_blank" style="background: #EDF4FF; color: #0A84FF;"> <i class="fa-brands fa-medium"></i> <span>Follow Me!<br/><strong>1,049+</strong> Followers</span> </a><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management</h1><p class="post-desc fw-light mb-4">Discover how iOS WKWebView preload and caching techniques reduce page load times by pre-downloading and storing resources, enhancing user experience and app performance effectively.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1722160385" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 28, 2024 </time> </span> <span> Updated <time data-ts="1723281101" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 10, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" class="popup img-link preview-img blur"><img data-src="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> | <em><a href="https://www.linkedin.com/in/zhgchgli" target="_blank">Senior iOS Developer / Software Engineer</a></em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3294 words" > <em>18 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Chapters üîñ</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">iOS WKWebView Preload and CacheÔΩúBoost Page Load Speed with Efficient Resource Management</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><strong>ÁÇπÂáªËøôÈáå</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†ÁÆÄ‰Ωì‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/"><strong>ÈªûÊìäÈÄôË£°</strong></a>Êü•ÁúãÊú¨ÊñáÁ´†Ê≠£È´î‰∏≠ÊñáÁâàÊú¨„ÄÇ</p></blockquote><blockquote class="prompt-info"><p>This post was translated with AI assistance ‚Äî let me know if anything sounds off!</p></blockquote><h4 id="zhgchgli-table-of-contents">Table of Contents</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>iOS WKWebView Page and File Resource Preload / Cache Study <a href="#ios-wkwebview-page-and-file-resource-preload--cache-study">#</a></summary><ul><li><a href="#background">Background</a></li></ul></details></li><li class="has-children"><details><summary>Technical Details <a href="#technical-details">#</a></summary><ul><li><a href="#ios-restrictions">iOS Restrictions</a></li><li><a href="#http-cache-flow">HTTP Cache Flow</a></li></ul></details></li><li><a href="#overview-of-ios-wkwebview">Overview of iOS WKWebView</a></li><li><a href="#feasibility-study-on-preloading-cache-for-ios-wkwebview">Feasibility Study on Preloading Cache for iOS WKWebView</a></li><li class="has-children"><details><summary>Improve HTTP Cache ‚úÖ <a href="#improve-http-cache-">#</a></summary><ul><li><a href="#cachepolicy-settings">CachePolicy Settings</a></li><li><a href="#set-cache-size">Set Cache Size</a></li><li><a href="#how-to-use-safari-developer-tools-in-wkwebview">How to Use Safari Developer Tools in WKWebView?</a></li><li><a href="#clear-wkwebview-cache">Clear WKWebView Cache</a></li></ul></details></li><li><a href="#improve-http-cache--wkwebview-full-page-preload-">Improve HTTP Cache + WKWebView Full Page Preload üòï</a></li><li><a href="#enhanced-http-cache--wkwebview-preload-for-static-resources-">Enhanced HTTP Cache + WKWebView Preload for Static Resources üéâ</a></li><li><a href="#urlprotocol-">URLProtocol ‚ùå</a></li><li class="has-children"><details><summary>WKURLSchemeHandler üòï <a href="#wkurlschemehandler-">#</a></summary><ul><li><a href="#bridge-wkwebview-network-requests-to-be-sent-by-the-app-">Bridge WKWebView Network Requests to Be Sent by the App ü´•</a></li></ul></details></li><li><a href="#start-with-service-worker-">Start with Service Worker ‚ùå</a></li><li><a href="#wkwebview-performance-optimization-">WKWebView Performance Optimization ü´•</a></li><li><a href="#local-html-local-resource-files-">Local HTML, Local Resource Files ü´•</a></li><li><a href="#frontend-optimization-starts-">Frontend Optimization Starts üéâüéâüéâ</a></li><li><a href="#user-experience-focus-">User Experience Focus üéâüéâüéâ</a></li><li><a href="#conclusion">Conclusion</a></li><li class="has-children"><details><summary>References <a href="#references">#</a></summary><ul><li><a href="#wkwebview-preload-pure-resource--you-can-refer-to-the-following-video-for-the-solution">WKWebView Preload Pure Resource üéâ You can refer to the following video for the solution</a></li><li><a href="#ios-veteran-weekly-report">iOS Veteran Weekly Report</a></li></ul></details></li><li><a href="#chat">Chat</a></li></ul></nav><hr /><h3 id="ios-wkwebview-page-and-file-resource-preload--cache-study"><span class="me-2">iOS WKWebView Page and File Resource Preload / Cache Study</span><a href="#ios-wkwebview-page-and-file-resource-preload--cache-study" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS WKWebView Pre-download and Cache Resources to Improve Page Load Speed Research.</p><p><a href="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.webp" alt="Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc1MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Antoine Gravier</a></p><h4 id="background"><span class="me-2">Background</span><a href="#background" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For some reason, I have always had a connection with ‚ÄúCache.‚Äù Previously, I was responsible for researching and implementing AVPlayer‚Äôs ‚Äú<a href="/posts/zrealm-dev/en/ios-hls-cache-optimize-avplayer-streaming-with-real-time-caching-techniques-d796bf8e661e/">iOS HLS Cache Implementation Exploration</a>‚Äù and ‚Äú<a href="/posts/zrealm-dev/en/avplayer-local-cache-implementation-master-avassetresourceloaderdelegate-for-smooth-playback-6ce488898003/">Complete Guide to AVPlayer Local Cache</a>.‚Äù Unlike streaming cache, which aims to reduce playback data usage, <strong>this time the main task is to improve the loading speed of in-app WKWebView</strong>. This also involves research on WKWebView preloading and caching. However, honestly, the WKWebView scenario is more complex. Unlike AVPlayer streaming video, which consists of one or multiple continuous chunk files and only requires file caching, WKWebView includes not only the page files but also imported resource files (.js, .css, fonts, images, etc.). These are rendered by the browser engine to display the page to the user. Many parts in this process are beyond the app‚Äôs control, from the network to frontend JavaScript performance and rendering methods, all of which take time.</p><p><strong>This article only explores the feasibility of iOS technology and is not necessarily the final solution. Overall, it is better for front-end developers to tackle this issue from the front end to achieve a more efficient result.</strong> Front-end partners are encouraged to optimize the First Contentful Paint and improve the HTTP Cache mechanism. This will speed up Web/mWeb itself, affect the speed of Android/iOS in-app WebViews, and also enhance <a href="https://developers.google.com/search/blog/2018/01/using-page-speed-in-mobile-search?hl=zh-tw" target="_blank">Google SEO ranking</a>.</p><h3 id="technical-details"><span class="me-2">Technical Details</span><a href="#technical-details" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="ios-restrictions"><span class="me-2">iOS Restrictions</span><a href="#ios-restrictions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>According to <a href="https://developer.apple.com/app-store/review/guidelines/" target="_blank">Apple Review Guidelines 2.5.6</a>:</p><blockquote><p><em>Apps that browse the web must use the appropriate WebKit framework and WebKit JavaScript. You may apply for an entitlement to use an alternative web browser engine in your app. <a href="https://developer.apple.com/support/alternative-browser-engines/" target="_blank">Learn more about these entitlements</a> .</em></p></blockquote><p><strong>Apps can only use Apple‚Äôs provided WebKit Framework (WKWebView) and are not allowed to use third-party or modified WebKit engines</strong>, otherwise they will not be approved for the App Store. Additionally, starting from iOS 17.4, to comply with regulations, the EU region can <a href="https://developer.apple.com/support/alternative-browser-engines/" target="_blank">use other browser engines</a> after <strong>obtaining special permission from Apple</strong>.</p><blockquote><p>What Apple doesn‚Äôt provide, we can‚Äôt do either.</p></blockquote><p>[Unverified] Research shows that even the iOS versions of Chrome and Firefox can only use Apple WebKit (WKWebView).</p><p><strong>Another very important thing:</strong></p><blockquote><p><em>WKWebView runs on a separate thread outside the app‚Äôs main thread, so all requests and operations do not pass through our app.</em></p></blockquote><h4 id="http-cache-flow"><span class="me-2">HTTP Cache Flow</span><a href="#http-cache-flow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MzYiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>The HTTP protocol already includes a Cache mechanism, and the system has implemented caching for all network-related components (URLSession, WKWebView, etc.). Therefore, the client app does not need to implement any caching on its own. It is also not recommended to create a custom caching system. Following the HTTP protocol is the fastest, most stable, and most efficient approach.</p><p><strong>The general workflow of HTTP Cache is shown in the above image:</strong></p><ol><li><p>Client sends a request</p><li><p>Server response cache strategies in the Response Header are automatically handled by system components like URLSession and WKWebView. They cache the response based on the Cache Header, and subsequent requests automatically apply this strategy.</p><li><p>When requesting the same resource again, if the cache has not expired, directly read the local cache from memory or disk and respond to the app.</p><li><p>If expired (expiration does not mean invalid), a real network request is sent to the server. If the content has not changed (still valid despite expiration), the server responds with 304 Not Modified (Empty Body). Although a network request is made, the response is basically in milliseconds with no response body, resulting in minimal traffic usage.</p><li><p>If the content has changed, provide the data and Cache Header again.</p></ol><blockquote><p><em>Caching can occur not only locally but also on network proxy servers or along the network path.</em></p></blockquote><p><strong>Common HTTP Response Cache Header Parameters:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="na">expires</span><span class="pi">:</span> <span class="s">RFC 2822 date</span>
<span class="na">pragma</span><span class="pi">:</span> <span class="s">no-cache</span>
<span class="c1"># Newer parameters:</span>
<span class="na">cache-control</span><span class="pi">:</span> <span class="s">private/public/no-store/no-cache/max-age/s-max-age/must-revalidate/proxy-revalidate...</span>
<span class="na">etag</span><span class="pi">:</span> <span class="s">XXX</span>
</pre></table></code></div></div><p><strong>Common HTTP Request Cache Header Parameters:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">If-Modified-Since</span><span class="pi">:</span> <span class="s">2024-07-18 13:00:00</span>
<span class="na">IF-None-Match</span><span class="pi">:</span> <span class="m">1234</span>
</pre></table></code></div></div><blockquote><p><strong><em>In iOS, network-related components (URLSession, WKWebView, etc.) automatically handle HTTP Request/Response Cache Headers and manage caching, so we do not need to handle Cache Header parameters ourselves.</em></strong></p></blockquote><p>For more detailed HTTP Cache operation details, refer to ‚Äú<a href="https://blog.techbridge.cc/2017/06/17/cache-introduction/">Step-by-step Understanding of HTTP Cache Mechanism by Huli</a>‚Äù.</p><h3 id="overview-of-ios-wkwebview"><span class="me-2">Overview of iOS WKWebView</span><a href="#overview-of-ios-wkwebview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9Ijk3MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Back to iOS, since we can only use Apple WebKit, we have to rely on the WebKit methods provided by Apple to explore possible ways to achieve preloading cache.</p><p>The above image shows all Apple iOS WebKit (WKWebView) related methods introduced by ChatGPT 4o, along with brief descriptions; the green sections indicate methods related to data storage.</p><p><strong>Sharing with everyone a few of the more interesting methods:</strong></p><ul><li><p>WKProcessPool: Allows multiple WKWebViews to share resources, data, cookies, and more.</p><li><p>WKHTTPCookieStore: Manages WKWebView cookies, including cookies shared between WKWebViews or between URLSession and WKWebView within the app.</p><li><p>WKWebsiteDataStore: Manages website cache files. (Can only read information and clear data)</p><li><p>WKURLSchemeHandler: Registers a custom handler to manage URL schemes that WKWebView does not recognize.</p><li><p>WKContentWorld: Groups and manages injected JavaScript (WKUserScript) scripts.</p><li><p>WKFindXXX: Controls the page search function.</p><li><p>WKContentRuleListStore: Enables content blockers within WKWebView (e.g., ad blocking).</p></ul><h3 id="feasibility-study-on-preloading-cache-for-ios-wkwebview"><span class="me-2">Feasibility Study on Preloading Cache for iOS WKWebView</span><a href="#feasibility-study-on-preloading-cache-for-ios-wkwebview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="improve-http-cache-"><span class="me-2">Improve HTTP Cache ‚úÖ</span><a href="#improve-http-cache-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As introduced earlier about the HTTP Cache mechanism, we can ask the Web Team to improve the HTTP Cache settings for the event page. On the client iOS side, we only need to simply check the CachePolicy settings; the system handles the rest!</p><h4 id="cachepolicy-settings"><span class="me-2"><strong>CachePolicy Settings</strong></span><a href="#cachepolicy-settings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>URLSession:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
<span class="n">configuration</span><span class="o">.</span><span class="n">requestCachePolicy</span> <span class="o">=</span> <span class="o">.</span><span class="n">useProtocolCachePolicy</span>
<span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>URLRequest/WKWebView:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">cachePolicy</span> <span class="o">=</span> <span class="o">.</span><span class="n">reloadRevalidatingCacheData</span>
<span class="c1">//</span>
<span class="n">wkWebView</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></table></code></div></div><ul><li><p><strong>useProtocolCachePolicy</strong>: Default, follows the default HTTP Cache control.</p><li><p><strong>reloadIgnoringLocalCacheData</strong>: Do not use local cache; each request loads data from the network (but allows network and proxy caching).</p><li><p><strong>reloadIgnoringLocalAndRemoteCacheData</strong>: Always load data from the network, ignoring both local and remote caches.</p><li><p><strong>returnCacheDataElseLoad</strong>: Use cached data if available; otherwise, load data from the network.</p><li><p><strong>returnCacheDataDontLoad</strong>: Use only cached data; if no cache is available, do not make a network request.</p><li><p><strong>reloadRevalidatingCacheData</strong>: Sends a request to check if the local cache has expired. If not expired (304 Not Modified), it uses the cached data; otherwise, it reloads data from the network.</p></ul><h4 id="set-cache-size"><span class="me-2"><strong>Set Cache Size</strong></span><a href="#set-cache-size" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>App Global:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">memoryCapacity</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="c1">// 512 MB</span>
<span class="k">let</span> <span class="nv">diskCapacity</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="c1">// 10 GB</span>
<span class="k">let</span> <span class="nv">urlCache</span> <span class="o">=</span> <span class="kt">URLCache</span><span class="p">(</span><span class="nv">memoryCapacity</span><span class="p">:</span> <span class="n">memoryCapacity</span><span class="p">,</span> <span class="nv">diskCapacity</span><span class="p">:</span> <span class="n">diskCapacity</span><span class="p">,</span> <span class="nv">diskPath</span><span class="p">:</span> <span class="s">"myCache"</span><span class="p">)</span>
        
<span class="kt">URLCache</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="n">urlCache</span>
</pre></table></code></div></div><p><strong>Individual URLSession:</strong></p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="n">memoryCapacity</span> <span class="p">=</span> <span class="m">512</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="c1">// 512 MB</span>
<span class="k">let</span> <span class="n">diskCapacity</span> <span class="p">=</span> <span class="m">10</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span> <span class="c1">// 10 GB</span>
<span class="k">let</span> <span class="n">cache</span> <span class="p">=</span> <span class="nf">URLCache</span><span class="p">(</span><span class="n">memoryCapacity</span><span class="p">:</span> <span class="n">memoryCapacity</span><span class="p">,</span> <span class="n">diskCapacity</span><span class="p">:</span> <span class="n">diskCapacity</span><span class="p">,</span> <span class="n">diskPath</span><span class="p">:</span> <span class="s">"myCache"</span><span class="p">)</span>
        
<span class="k">let</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">URLSessionConfiguration</span><span class="p">.</span><span class="k">default</span>
<span class="n">configuration</span><span class="p">.</span><span class="n">urlCache</span> <span class="p">=</span> <span class="n">cache</span>
</pre></table></code></div></div><blockquote><p><strong><em>Also as mentioned before, WKWebView runs on a separate thread outside the app‚Äôs main thread, so the cache of URLRequest and URLSession is not shared with WKWebView.</em></strong></p></blockquote><h4 id="how-to-use-safari-developer-tools-in-wkwebview"><span class="me-2"><strong>How to Use Safari Developer Tools in WKWebView?</strong></span><a href="#how-to-use-safari-developer-tools-in-wkwebview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Check if local Cache is being used.</p><p><strong>Enable Developer Features in Safari:</strong></p><p><a href="/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDY0IiBoZWlnaHQ9IjcyMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Enable isInspectable for WKWebView:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">makeWKWebView</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">WKWebView</span> <span class="p">{</span>
 <span class="k">let</span> <span class="nv">webView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>
 <span class="n">webView</span><span class="o">.</span><span class="n">isInspectable</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// is only available in iOS 16.4 or newer</span>
 <span class="k">return</span> <span class="n">webView</span>
<span class="p">}</span>
</pre></table></code></div></div><p>WKWebView requires <code class="language-plaintext highlighter-rouge">webView.isInspectable = true</code> to enable Safari Developer Tools in Debug Build.</p><p><a href="/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.webp" alt="p.s. This is a separate WKWebView test project I created" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NDkiIGhlaWdodD0iMTAxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>p.s. This is a separate test project I created for WKWebView.</p><p>Set a breakpoint at the <code class="language-plaintext highlighter-rouge">webView.load</code> line.</p><p><strong>Start Test:</strong></p><p>Build &amp; Run:</p><p><a href="/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjkiIGhlaWdodD0iMjU0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>When the breakpoint at webView.load is hit, click ‚ÄúStep Over‚Äù.</p><p><a href="/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNTQyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Go back to Safari, select the toolbar‚Äôs ‚ÄúDevelop‚Äù -&gt; ‚ÄúSimulator‚Äù -&gt; ‚ÄúYour Project‚Äù -&gt; ‚Äúabout:blank‚Äù.</p><ul><li><p>Because the page has not started loading, the URL will be about:blank</p><li><p>If ‚Äúabout:blank‚Äù does not appear, go back to XCode and click the step-by-step debug button again until it appears.</p></ul><p>The developer tools corresponding to this page appear as follows:</p><p><a href="/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjg5IiBoZWlnaHQ9Ijk0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Back to XCode and click Continue to run:</p><p><a href="/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4OTUiIGhlaWdodD0iMzUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Returning to Safari Developer Tools, you can see resource loading status and the full set of developer tool features (components, storage debugging, etc.).</p><p><a href="/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjg5IiBoZWlnaHQ9Ijk0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>If the online resource has HTTP Cache, the transfer size will show as ‚Äúdisk‚Äù:</strong></p><p><a href="/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjIiIGhlaWdodD0iMzI1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzMiIGhlaWdodD0iNDI5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Clicking in also shows cache information.</p><h4 id="clear-wkwebview-cache"><span class="me-2">Clear WKWebView Cache</span><a href="#clear-wkwebview-cache" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// Clean Cookies</span>
<span class="kt">HTTPCookieStorage</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">removeCookies</span><span class="p">(</span><span class="nv">since</span><span class="p">:</span> <span class="kt">Date</span><span class="o">.</span><span class="n">distantPast</span><span class="p">)</span>

<span class="c1">// Clean Stored Data, Cache Data</span>
<span class="k">let</span> <span class="nv">dataTypes</span> <span class="o">=</span> <span class="kt">WKWebsiteDataStore</span><span class="o">.</span><span class="nf">allWebsiteDataTypes</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">WKWebsiteDataStore</span><span class="o">.</span><span class="nf">default</span><span class="p">()</span>
<span class="n">store</span><span class="o">.</span><span class="nf">fetchDataRecords</span><span class="p">(</span><span class="nv">ofTypes</span><span class="p">:</span> <span class="n">dataTypes</span><span class="p">)</span> <span class="p">{</span> <span class="n">records</span> <span class="k">in</span>
 <span class="n">records</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">record</span> <span class="k">in</span>
  <span class="n">store</span><span class="o">.</span><span class="nf">removeData</span><span class="p">(</span>
   <span class="nv">ofTypes</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">,</span>
   <span class="nv">for</span><span class="p">:</span> <span class="n">records</span><span class="p">,</span>
   <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span>
          <span class="nf">print</span><span class="p">(</span><span class="s">"clearWebViewCache() - </span><span class="se">\(</span><span class="n">record</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>           
   <span class="p">}</span>
  <span class="p">)</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>You can use the above methods to clear cached resources, local data, and cookie data in WKWebView.</p><blockquote><p><strong><em>But improving HTTP Cache only affects caching (fast on the second visit), it does not impact preloading (the first visit).</em></strong> <em>‚úÖ</em></p></blockquote><h3 id="improve-http-cache--wkwebview-full-page-preload-"><span class="me-2">Improve HTTP Cache + WKWebView Full Page Preload üòï</span><a href="#improve-http-cache--wkwebview-full-page-preload-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">WebViewPreloader</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">WebViewPreloader</span><span class="p">()</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">_webview</span><span class="p">:</span> <span class="kt">WKWebView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">()</span>

    <span class="kd">private</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">preload</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="kt">Task</span> <span class="p">{</span> <span class="kd">@MainActor</span> <span class="k">in</span>
            <span class="n">webview</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/campaign/summer"</span><span class="p">)</span>
</pre></table></code></div></div><p>After improving the HTTP Cache, the second time WKWebView loads, it will have cached data. We can preload all the URLs in the list or homepage once to create the cache, so when users enter, it will be faster.</p><blockquote><p><strong><em>After testing, it is feasible in principle; however, it greatly affects performance and network traffic</em></strong> <em>; users may not even visit the detail page, but we preload and load all pages at once, which feels like shooting blindly.</em></p></blockquote><blockquote><p><em>Personally, I think it is impractical in reality, and the drawbacks outweigh the benefits, making it a case of cutting off one‚Äôs nose to spite one‚Äôs face.üòï</em></p></blockquote><h3 id="enhanced-http-cache--wkwebview-preload-for-static-resources-"><span class="me-2">Enhanced HTTP Cache + WKWebView Preload for Static Resources üéâ</span><a href="#enhanced-http-cache--wkwebview-preload-for-static-resources-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Based on the above optimization method, we can combine the HTML Link Preload technique to preload only the resource files used on the page (e.g., .js, .css, fonts, images). This allows users to directly use cached resources upon entering, without making additional network requests for resource files.</p><blockquote><p><strong><em>This means I no longer preload everything on the entire page. Instead, I only preload the resource files that the page will use, which may also be shared across pages; the page file .html is still fetched from the network and combined with the preloaded files to render the page.</em></strong></p></blockquote><p>Please note: HTTP Cache is still used here, so these resources must support HTTP Cache; otherwise, future requests will still go through the network.</p><p>Please note: HTTP Cache is still used here, so these resources must support HTTP Cache; otherwise, future requests will still go through the network.</p><p>Please note: This still uses HTTP Cache, so these resources must support HTTP Cache; otherwise, future requests will still go through the network.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"zh-tw"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/dist/main.js"</span> <span class="na">as=</span><span class="s">"script"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://image.zhgchg.li/v2/image/get/campaign.jpg"</span> <span class="na">as=</span><span class="s">"image"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/assets/fonts/glyphicons-halflings-regular.woff2"</span> <span class="na">as=</span><span class="s">"font"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"https://cdn.zhgchg.li/assets/fonts/Simple-Line-Icons.woff2?v=2.4.0"</span> <span class="na">as=</span><span class="s">"font"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><strong>Common Supported File Types:</strong></p><ul><li><p>.js script</p><li><p>.css style</p><li><p>font</p><li><p>image</p></ul><p>The Web Team places the above HTML content in the agreed path with the App. Our <code class="language-plaintext highlighter-rouge">WebViewPreloader</code> then loads this path, and WKWebView will parse the &lt;link&gt; preload resources and generate the cache during loading.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/campaign/summer/preload"</span><span class="p">)</span>
<span class="c1">// or preload all at once</span>
<span class="kt">WebViewPreloader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">preload</span><span class="p">(</span><span class="s">"https://zhgchg.li/assets/preload"</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p><strong><em>After testing, a good balance between data loss and preloading can be achieved</em></strong> <em>.</em> üéâ</p></blockquote><blockquote><p><strong><em>The downside is that this Cache resource list requires maintenance, and web page rendering and loading still need optimization; otherwise, the perceived load time of the first page will remain long.</em></strong></p></blockquote><h3 id="urlprotocol-"><span class="me-2">URLProtocol <em>‚ùå</em></span><a href="#urlprotocol-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Also, remember our old friend <a href="https://developer.apple.com/documentation/foundation/urlprotocol" target="_blank">URLProtocol</a>; all requests based on the <code class="language-plaintext highlighter-rouge">URL Loading System</code> (URLSession, openURL‚Ä¶) can be intercepted and manipulated.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">CustomURLProtocol</span><span class="p">:</span> <span class="kt">URLProtocol</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">class</span> <span class="kd">func</span> <span class="nf">canInit</span><span class="p">(</span><span class="n">with</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// Determine if this request should be handled</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"custom"</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">class</span> <span class="kd">func</span> <span class="nf">canonicalRequest</span><span class="p">(</span><span class="k">for</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">URLRequest</span> <span class="p">{</span>
        <span class="c1">// Return the request</span>
        <span class="k">return</span> <span class="n">request</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">startLoading</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Handle the request and load data</span>
        <span class="c1">// Change to cache strategy, read file locally first</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">URLResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="nv">expectedContentLength</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">textEncodingName</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocol</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">didReceive</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span> <span class="nv">cacheStoragePolicy</span><span class="p">:</span> <span class="o">.</span><span class="n">notAllowed</span><span class="p">)</span>
            
            <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="s">"This is a custom response!"</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocol</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">didLoad</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="n">client</span><span class="p">?</span><span class="o">.</span><span class="nf">urlProtocolDidFinishLoading</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">stopLoading</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Stop loading data</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// AppDelegate.swift didFinishLaunchingWithOptions:</span>
<span class="kt">URLProtocol</span><span class="o">.</span><span class="nf">registerClass</span><span class="p">(</span><span class="kt">CustomURLProtocol</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</pre></table></code></div></div><p>The abstract idea is to secretly send URLRequest in the background -&gt; URLProtocol -&gt; download all resources by itself, user -&gt; WKWebView -&gt; Request -&gt; URLProtocol -&gt; respond with preloaded resources.</p><blockquote><p><strong><em>As mentioned before, WKWebView runs on a separate thread outside the app‚Äôs main thread, so URLProtocol cannot intercept WKWebView requests.</em></strong></p></blockquote><blockquote><p><strong><em>But I heard that using black magic might work, though it‚Äôs not recommended as it can cause other issues (submission rejected)</em></strong></p></blockquote><blockquote><p><strong><em>No Entry</em></strong> <em>‚ùå.</em></p></blockquote><h3 id="wkurlschemehandler-"><span class="me-2">WKURLSchemeHandler <em>üòï</em></span><a href="#wkurlschemehandler-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Apple introduced a new method in iOS 11, seemingly to compensate for WKWebView‚Äôs inability to use URLProtocol; however, this method is more similar to <a href="/posts/zrealm-dev/en/avplayer-local-cache-implementation-master-avassetresourceloaderdelegate-for-smooth-playback-6ce488898003/">AVPlayer‚Äôs ResourceLoader</a>, where <strong>only schemes unrecognized by the system are passed to our custom WKURLSchemeHandler for handling</strong>.</p><p>The abstract idea is to secretly send WKWebView -&gt; Request -&gt; WKURLSchemeHandler in the background to download all resources by itself, while the user -&gt; WKWebView -&gt; Request -&gt; WKURLSchemeHandler responds with the preloaded resources.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">WebKit</span>

<span class="kd">class</span> <span class="kt">CustomSchemeHandler</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">WKURLSchemeHandler</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">start</span> <span class="nv">urlSchemeTask</span><span class="p">:</span> <span class="kt">WKURLSchemeTask</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle custom scheme</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">urlSchemeTask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">!</span>
        
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"custom-scheme"</span> <span class="p">{</span>
            <span class="c1">// Change to cache strategy, read file locally first</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">URLResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="nv">expectedContentLength</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">textEncodingName</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didReceive</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            
            <span class="k">let</span> <span class="nv">html</span> <span class="o">=</span> <span class="s">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from custom scheme!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>
            <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didReceive</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">urlSchemeTask</span><span class="o">.</span><span class="nf">didFinish</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="n">_</span> <span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">stop</span> <span class="nv">urlSchemeTask</span><span class="p">:</span> <span class="kt">WKURLSchemeTask</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Stop</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">webViewConfiguration</span> <span class="o">=</span> <span class="kt">WKWebViewConfiguration</span><span class="p">()</span>
<span class="n">webViewConfiguration</span><span class="o">.</span><span class="nf">setURLSchemeHandler</span><span class="p">(</span><span class="kt">CustomSchemeHandler</span><span class="p">(),</span> <span class="nv">forURLScheme</span><span class="p">:</span> <span class="s">"mycacher"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">customURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"mycacher://zhgchg.li/campaign/summer"</span><span class="p">)</span><span class="o">!</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">load</span><span class="p">(</span><span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">customURL</span><span class="p">))</span>
</pre></table></code></div></div><ul><li><p>Because http/https are system-handled schemes, we cannot customize their handling; we need to change the scheme to one not recognized by the system (e.g., <code class="language-plaintext highlighter-rouge">mycacher://</code>).</p><li><p>Use relative paths throughout the page to automatically apply <code class="language-plaintext highlighter-rouge">mycacher://</code> for our Handler to capture.</p><li><p>If you don‚Äôt want to change http/https but still want to capture http/https requests, you can only use black magic. <strong>Not recommended,</strong> as it may cause other issues (rejection during review).</p><li><p>Cache page files locally and respond; Ajax, XMLHttpRequest, and Fetch requests used in the page may be <strong>blocked</strong> by the <a href="https://developer.mozilla.org/zh-TW/docs/Web/Security/Same-origin_policy" target="_blank"><strong>CORS Same-Origin Policy</strong></a>. You need to lower the website‚Äôs security to use this (because requests are sent from mycacher:// to http://zhgchg.li/xxx, which is a different origin).</p><li><p>You may need to implement your own Cache Policy, such as when to update and how long it remains valid. <strong>(This is exactly what HTTP Cache does.)</strong></p></ul><blockquote><p><strong><em>In summary, although theoretically feasible, the implementation requires huge investment; overall, it is not cost-effective and difficult to scale and maintain stability</em></strong> <em>üòï</em></p></blockquote><p>It seems that the WKURLSchemeHandler method is more suitable for handling large resource files within a webpage by declaring a custom scheme and letting the app handle it, working together to render the webpage.</p><h4 id="bridge-wkwebview-network-requests-to-be-sent-by-the-app-"><span class="me-2">Bridge WKWebView Network Requests to Be Sent by the App ü´•</span><a href="#bridge-wkwebview-network-requests-to-be-sent-by-the-app-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>WKWebView switches to calling predefined app interfaces (WkUserScript) instead of Ajax, XMLHttpRequest, or Fetch, letting the app request resources.</p><blockquote><p><em>This case is not very helpful because the first screen takes too long to appear, not the subsequent loading; moreover, this method creates an overly deep and strange dependency between Web and App ü´•</em></p></blockquote><h3 id="start-with-service-worker-"><span class="me-2">Start with Service Worker <em>‚ùå</em></span><a href="#start-with-service-worker-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><em>Due to security concerns, only Apple‚Äôs own Safari App is supported; WKWebView is not supported‚ùå.</em></p></blockquote><h3 id="wkwebview-performance-optimization-"><span class="me-2">WKWebView Performance Optimization ü´•</span><a href="#wkwebview-performance-optimization-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Optimize and improve the performance of WKWebView Load View.</p><blockquote><p><em>WKWebView itself is like the skeleton, and the web page is the flesh. Research shows that optimizing the skeleton (e.g., reusing WKProcessPool) has very limited effect, possibly a difference of 0.0003 -&gt; 0.000015 seconds.</em></p></blockquote><h3 id="local-html-local-resource-files-"><span class="me-2">Local HTML, Local Resource Files ü´•</span><a href="#local-html-local-resource-files-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Similar to the Preload method, but instead, the event page is placed in the App Bundle or fetched remotely at startup.</p><blockquote><p><em>Hosting the entire HTML page may also encounter CORS same-origin issues; simply hosting web resource files seems suitable for using the ‚Äúcomplete HTTP Cache + WKWebView Preload pure resources‚Äù method instead; including them in the App Bundle only increases App Size, fetching from remote is WKWebView Preload ü´•</em></p></blockquote><h3 id="frontend-optimization-starts-"><span class="me-2">Frontend Optimization Starts üéâüéâüéâ</span><a href="#frontend-optimization-starts-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.webp" alt="[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDA4IiBoZWlnaHQ9IjM0OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/" target="_blank">Source: wedevs</a></p><p>Refer to <a href="https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/" target="_blank">wedevs optimization suggestions</a>, the front-end HTML page typically has four loading stages: from initially loading the page file (.html) First Paint (blank page) to First Contentful Paint (rendering the page skeleton), then to First Meaningful Paint (adding page content), and finally to Time To Interactive (when the user can interact).</p><p><a href="/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MTUiIGhlaWdodD0iNzc5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Test with our page; browsers and WKWebView first request the main .html page, then load the required resources. Meanwhile, they build the interface for the user according to the program instructions. Comparing with the article, the page phase actually only has First Paint (blank) to Time To Interactive (First Contentful Paint only shows the Navigation Bar, which probably doesn‚Äôt count‚Ä¶), missing intermediate staged rendering for the user. Therefore, the overall user waiting time is extended.</p><blockquote><p><em>Currently, only resource files have HTTP Cache set; the main page does not.</em></p></blockquote><p>You can also refer to <a href="https://pagespeed.web.dev/" target="_blank">Google PageSpeed Insights</a> for optimization suggestions, such as compression, reducing script size, and more.</p><p><a href="/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjgiIGhlaWdodD0iNTA2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>Because the core of in-app WKWebView is still the web page itself, adjusting from the front-end web is an effective and efficient approach. üéâüéâüéâ</em></p></blockquote><h3 id="user-experience-focus-"><span class="me-2">User Experience Focus üéâüéâüéâ</span><a href="#user-experience-focus-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.webp" class="popup img-link blur"><img data-src="/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTYiIGhlaWdodD0iNjA5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><blockquote><p><em>A simple implementation starting from user experience: add a Loading Progress Bar. Don‚Äôt just show a blank page that leaves users confused. Let them know the page is loading and how far along it is. üéâüéâüéâ</em></p></blockquote><h3 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The above summarizes some ideas and research on feasible approaches for WKWebView preloading and caching. The technical aspect is not the biggest issue; the key is choosing the methods that are most effective for users while minimizing development costs. Selecting the right approach may only require minor adjustments to achieve the goal directly. Choosing the wrong method can lead to wasted resources, going in circles, and likely difficulties in maintenance and usage later on.</p><blockquote><p><em>There are always more solutions than difficulties; sometimes, it‚Äôs just a lack of imagination.</em></p></blockquote><p>There might be other genius combinations I haven‚Äôt thought of. Feel free to contribute your suggestions.</p><h3 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="wkwebview-preload-pure-resource--you-can-refer-to-the-following-video-for-the-solution"><span class="me-2">WKWebView Preload Pure Resource üéâ You can refer to the following video for the solution</span><a href="#wkwebview-preload-pure-resource--you-can-refer-to-the-following-video-for-the-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>&lt;iframe class=‚Äùembed-video‚Äù loading=‚Äùlazy‚Äù src=‚Äùhttps://www.youtube.com/embed/ZQvyfFieBfs‚Äù title=‚Äù‚ÄúPreload strategies using WKWebView‚Äù by Jonat√°n Urquiza‚Äù frameborder=‚Äù0‚Äù allow=‚Äùaccelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture‚Äù allowfullscreen&gt;&lt;/iframe&gt;</p><p>The author also mentioned the methods of WKURLSchemeHandler.</p><p><strong>The complete demo repo in the video is as follows:</strong></p><p><a href="https://github.com/jonurq/preload-strategies-wkwebview" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/6789eaaf4d4f56f69df9d39e4abae4a910b10da24a14ff934a367da52fbde78c/jonurq/preload-strategies-wkwebview" alt="" loading="lazy"></a></p><h4 id="ios-veteran-weekly-report"><span class="me-2">iOS Veteran Weekly Report</span><a href="#ios-veteran-weekly-report" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/SwiftOldDriver/iOS-Weekly/issues?q=WkWebView" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/115476023/2a31ab00-183a-11eb-889c-b9674f419108" alt="" loading="lazy"></a></p><p>The veteran driver‚Äôs weekly report on WkWebView is also worth a read.</p><h3 id="chat"><span class="me-2">Chat</span><a href="#chat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A long-awaited return to writing in-depth articles about iOS development.</p><p>If you have any questions or feedback, feel free to <a href="https://www.zhgchg.li/contact" target="_blank">contact me</a>.</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=üç∫&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>This post was originally published on Medium (<a href="https://medium.com/p/5033090c18ba" target="_blank"><strong>View original post</strong></a>), and automatically converted and synced by <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a>.</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/en/zmediumtomarkdown/2024-07-28-5033090c18ba.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1,049+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/english/" class="post-tag no-text-decoration" >english</a> <a href="/tags/ai-translation/" class="post-tag no-text-decoration" >ai-translation</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cache/" class="post-tag no-text-decoration" >cache</a> <a href="/tags/webview/" class="post-tag no-text-decoration" >webview</a> <a href="/tags/http-request/" class="post-tag no-text-decoration" >http-request</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS%20WKWebView%20Preload%20and%20Cache%EF%BD%9CBoost%20Page%20Load%20Speed%20with%20Efficient%20Resource%20Management%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS%20WKWebView%20Preload%20and%20Cache%EF%BD%9CBoost%20Page%20Load%20Speed%20with%20Efficient%20Resource%20Management%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fen%2Fios-wkwebview-preload-and-cache-boost-page-load-speed-with-efficient-resource-management-5033090c18ba%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ios-timer-vs-dispatchsourcetimer-safe-usage-with-finite-state-machine-design-patterns-62f68ebeecd3/">iOS Timer vs DispatchSourceTimerÔΩúSafe Usage with Finite State Machine & Design Patterns</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ios-timer-%E4%B8%8E-dispatchsourcetimer-%E9%80%89%E6%8B%A9%E4%B8%8E%E5%AE%89%E5%85%A8%E5%B0%81%E8%A3%85%E6%8A%80%E5%B7%A7-%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E9%98%B2%E6%AD%A2%E9%97%AA%E9%80%80-62f68ebeecd3/">iOS Timer ‰∏é DispatchSourceTimer Â¶Ç‰ΩïÈÄâÊã©‰∏éÂÆâÂÖ®ÁöÑ‰ΩøÁî®?</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ios-timer-%E8%88%87-dispatchsourcetimer-%E9%81%B8%E6%93%87%E8%88%87%E5%AE%89%E5%85%A8%E5%B0%81%E8%A3%9D%E6%8A%80%E5%B7%A7-%E6%9C%89%E9%99%90%E7%8B%80%E6%85%8B%E6%A9%9F%E9%98%B2%E6%AD%A2%E9%96%83%E9%80%80-62f68ebeecd3/">iOS Timer Ëàá DispatchSourceTimer Â¶Ç‰ΩïÈÅ∏ÊìáËàáÂÆâÂÖ®ÁöÑ‰ΩøÁî®?</a><li class="text-truncate lh-lg"> <a href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/">Design PatternsÔΩúPractical Solutions for Socket.IO Client Library Challenges</a><li class="text-truncate lh-lg"> <a href="/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/">Design Patterns ÁöÑÂÆûÊàòÂ∫îÁî®Á∫™ÂΩï</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Chapters üîñ</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/en/avplayer-streaming-with-cache-implement-avassetresourceloaderdelegate-for-smooth-playback-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming with CacheÔΩúImplement AVAssetResourceLoaderDelegate for Smooth Playback</h4><div class="text-muted"><p>Discover how to use AVPlayer and AVURLAsset with AVAssetResourceLoaderDelegate to stream and cache audio/video simultaneously, eliminating buffering delays and ensuring seamless playback for iOS us...</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-wkwebview-%E9%A0%90%E8%BC%89%E8%88%87-cache-%E7%B7%A9%E5%AD%98%E6%8A%80%E8%A1%93-%E6%8F%90%E5%8D%87%E9%A0%81%E9%9D%A2%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E8%88%87%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1722160385" data-df="ll" > Jul 28, 2024 </time><h4 class="pt-0 my-2">iOS WKWebView È†ÅÈù¢ËàáÊ™îÊ°àË≥áÊ∫ê Preload È†êËºâ / Cache Á∑©Â≠òÁ†îÁ©∂</h4><div class="text-muted"><p>iOS WKWebView È†êÂÖà‰∏ãËºâËàáÁ∑©Â≠òË≥áÊ∫êÊèêÂçáÈ†ÅÈù¢ËºâÂÖ•ÈÄüÂ∫¶Á†îÁ©∂„ÄÇ</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1722160385" data-df="ll" > Jul 28, 2024 </time><h4 class="pt-0 my-2">iOS WKWebView È°µÈù¢‰∏éÊ°£Ê°àËµÑÊ∫ê Preload È¢ÑËΩΩ / Cache ÁºìÂ≠òÁ†îÁ©∂</h4><div class="text-muted"><p>iOS WKWebView È¢ÑÂÖà‰∏ãËΩΩ‰∏éÁºìÂ≠òËµÑÊ∫êÊèêÂçáÈ°µÈù¢ËΩΩÂÖ•ÈÄüÂ∫¶Á†îÁ©∂„ÄÇ</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E4%B9%9D%E5%B7%9E%E8%87%AA%E7%94%B1%E8%A1%8C%E6%94%BB%E7%95%A5-%E9%87%9C%E5%B1%B1%E6%96%B0%E5%B1%B1%E8%8C%B6%E8%8A%B1%E8%99%9F%E9%83%B5%E8%BC%AA%E5%85%A5%E5%A2%83%E6%97%A5%E6%9C%AC%E5%8D%9A%E5%A4%9A-%E6%B7%B1%E5%85%A5%E7%94%B1%E5%B8%83%E9%99%A2-%E5%A4%A7%E5%88%86-%E7%A6%8F%E5%B2%A1%E7%AD%89%E5%9C%B0-cb65fd5ab770/" class="btn btn-outline-primary" aria-label="Older" ><p>‰πùÂ∑ûËá™Áî±Ë°åÊîªÁï•ÔΩúÈáúÂ±±Êñ∞Â±±Ëå∂Ëä±ËôüÈÉµËº™ÂÖ•Â¢ÉÊó•Êú¨ÂçöÂ§öÔºåÊ∑±ÂÖ•Áî±Â∏ÉÈô¢„ÄÅÂ§ßÂàÜ„ÄÅÁ¶èÂ≤°Á≠âÂú∞</p></a> <a href="/posts/zrealm-dev/zh-cn/ios-wkwebview-%E9%A2%84%E8%BD%BD%E4%B8%8E-cache-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF-%E6%8F%90%E5%8D%87%E9%A1%B5%E9%9D%A2%E8%BD%BD%E5%85%A5%E9%80%9F%E5%BA%A6%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%85%A8%E8%A7%A3%E6%9E%90-5033090c18ba/" class="btn btn-outline-primary" aria-label="Newer" ><p>iOS WKWebView È°µÈù¢‰∏éÊ°£Ê°àËµÑÊ∫ê Preload È¢ÑËΩΩ / Cache ÁºìÂ≠òÁ†îÁ©∂</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">‰∏≠Êñá</a> | <a href="/tags/simplified-chinese">ÁÆÄ‰∏≠</a> | <a href="/tags/english/">English</a> <br/> Last updated: 2025-12-16 22:27:54 +08:00</p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ÁîüÊ¥ª</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
