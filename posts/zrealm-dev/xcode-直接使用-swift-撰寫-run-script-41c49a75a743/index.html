<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Xcode 直接使用 Swift 撰寫 Run Script！" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Run Script 腳本" /><meta property="og:description" content="導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Run Script 腳本" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/xcode-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-swift-%E6%92%B0%E5%AF%AB-run-script-41c49a75a743/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/xcode-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-swift-%E6%92%B0%E5%AF%AB-run-script-41c49a75a743/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-17T23:53:20+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" /><meta property="twitter:title" content="Xcode 直接使用 Swift 撰寫 Run Script！" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-04-13T16:35:25+08:00","datePublished":"2020-09-17T23:53:20+08:00","description":"導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Run Script 腳本","headline":"Xcode 直接使用 Swift 撰寫 Run Script！","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/xcode-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-swift-%E6%92%B0%E5%AF%AB-run-script-41c49a75a743/"},"url":"https://zhgchg.li/posts/zrealm-dev/xcode-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-swift-%E6%92%B0%E5%AF%AB-run-script-41c49a75a743/"}</script><title>Xcode 直接使用 Swift 撰寫 Run Script！ | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Xcode 直接使用 Swift 撰寫 Run Script！</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Xcode 直接使用 Swift 撰寫 Run Script！</h1><p class="post-desc fw-light mb-4">導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Run Script 腳本</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1600358000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 17, 2020 </time> </span> <span> Updated <time data-ts="1712997325" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 13, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" class="popup img-link preview-img blur"><img data-src="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4992 words" > <em>27 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Xcode 直接使用 Swift 撰寫 Run Script！</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Xcode 直接使用 Swift 撰寫 Run Script！</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><h3 id="xcode-直接使用-swift-撰寫-shell-script"><span class="me-2">Xcode 直接使用 Swift 撰寫 Shell Script！</span><a href="#xcode-直接使用-swift-撰寫-shell-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>導入 Localization 多語系及 Image Assets 缺漏檢查、使用 Swift 打造 Shell Script 腳本</p><p><a href="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*RU89TcfRAR5mmclMX9x57w.webp" alt="Photo by [Glenn Carstens-Peters](https://unsplash.com/@glenncarstenspeters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijc5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@glenncarstenspeters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Glenn Carstens-Peters</a></p><h3 id="緣由"><span class="me-2">緣由</span><a href="#緣由" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>因為自己手殘，時常在編輯多語系檔案時遺漏「;」導致 app build 出來語言顯示出錯再加上隨著開發的推移語系檔案越來越龐大，重複的、已沒用到的語句都夾雜再一起，非常混亂（Image Assets 同樣狀況）。</p><p>一直以來都想找工具協助處理這方面的問題，之前是用 <a href="https://github.com/igorkulman/iOSLocalizationEditor" target="_blank">iOSLocalizationEditor</a> 這個 Mac APP，但它比較像是語系檔案編輯器，讀取語系檔案內容＆編輯，沒有自動檢查的功能。</p><h3 id="期望功能"><span class="me-2">期望功能</span><a href="#期望功能" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>build 專案時能自動檢查多語系有無錯誤、缺露、重複、Image Assets 有無缺漏。</p><h3 id="解決方案"><span class="me-2">解決方案</span><a href="#解決方案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>要達到我們的期望功能就要在 Build Phases 加入 Run Script 檢查腳本。</p><p>但檢查腳本需要使用 shell script 撰寫，因自己對 shell script 的掌握度並不太高，想說站在巨人的肩膀上從網路搜尋現有腳本也找不太到完全符合期望功能的 script，再快要放棄的時候突然想到：</p><blockquote><p><strong>Shell Script 可以用 Swift 來寫啊</strong> ！</p></blockquote><p>相對 shell script 來說更熟悉、掌握度更高！依照這個方向果然讓我找到兩個現有的工具腳本！</p><p>由 <a href="https://freshos.github.io/" target="_blank">freshOS</a> 這個團隊撰寫的兩個檢查工具：</p><ul><li><a href="https://github.com/freshOS/Localize" target="_blank"><strong>Localize 🏁</strong></a><li><a href="https://github.com/s4cha/AssetChecker" target="_blank"><strong>Asset Checker 👮</strong></a></ul><p>完全符合我們的期望功能需求! ! 並且他們使用 swift 撰寫，要客製化魔改都很容易。</p><h4 id="localize--多語系檔檢查工具"><span class="me-2"><a href="https://github.com/freshOS/Localize" target="_blank">Localize 🏁</a> 多語系檔檢查工具</span><a href="#localize--多語系檔檢查工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>功能：</strong></p><ul><li>build 時自動檢查<li>語系檔自動排版、整理<li>檢查多語系與主要語系之缺漏、多餘<li>檢查多語系重複語句<li>檢查多語系未經翻譯語句<li>檢查多語系未使用的語句</ul><p><strong>安裝方法：</strong></p><ol><li><a href="https://github.com/freshOS/Localize/blob/master/Localize.swift" target="_blank">下載工具的 Swift Script 檔案</a><li>放到專案目錄下 EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize.swift</code><li>打開專案設定 → iOS Target → Build Phases →左上角「+」 → New Run Script Phases → 在 Script 內容貼上路徑 EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize.swift</code></ol><p><a href="/assets/41c49a75a743/1*k2OHjrcQaQIWLqV7G57TgA.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*k2OHjrcQaQIWLqV7G57TgA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQwNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>4. 使用 Xcode 打開編輯 <code class="language-plaintext highlighter-rouge">Localize.swift</code> 檔案進行設定，可以在檔案上半部看到可更動的設定項目：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="c1">//啟用檢查腳本</span>
<span class="k">let</span> <span class="nv">enabled</span> <span class="o">=</span> <span class="kc">true</span>

<span class="c1">//語系檔案目錄</span>
<span class="k">let</span> <span class="nv">relativeLocalizableFolders</span> <span class="o">=</span> <span class="s">"/Resources/Languages"</span>

<span class="c1">//專案目錄（用來搜索語句有沒有在程式碼中使用到）</span>
<span class="k">let</span> <span class="nv">relativeSourceFolder</span> <span class="o">=</span> <span class="s">"/Sources"</span>

<span class="c1">//程式碼中的 NSLocalized 語系檔案使用正規匹配表示法</span>
<span class="c1">//可自行增加、無需變動</span>
<span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"NSLocalized(Format)?String</span><span class="se">\\</span><span class="s">(</span><span class="se">\\</span><span class="s">s*@?</span><span class="se">\"</span><span class="s">([</span><span class="se">\\</span><span class="s">w</span><span class="se">\\</span><span class="s">.]+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Swift and Objc Native</span>
    <span class="s">"Localizations</span><span class="se">\\</span><span class="s">.((?:[A-Z]{1}[a-z]*[A-z]*)*(?:</span><span class="se">\\</span><span class="s">.[A-Z]{1}[a-z]*[A-z]*)*)"</span><span class="p">,</span> <span class="c1">// Laurine Calls</span>
    <span class="s">"L10n.tr</span><span class="se">\\</span><span class="s">(key: </span><span class="se">\"</span><span class="s">(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// SwiftGen generation</span>
    <span class="s">"ypLocalized</span><span class="se">\\</span><span class="s">(</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"\\</span><span class="s">)"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s">.localized"</span> <span class="c1">// "key".localized pattern</span>
<span class="p">]</span>

<span class="c1">//要忽略「語句未使用警告」的語句</span>
<span class="k">let</span> <span class="nv">ignoredFromUnusedKeys</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="cm">/* example
let ignoredFromUnusedKeys = [
    "NotificationNoOne",
    "NotificationCommentPhoto",
    "NotificationCommentHisPhoto",
    "NotificationCommentHerPhoto"
]
*/</span>

<span class="c1">//主要語系</span>
<span class="k">let</span> <span class="nv">masterLanguage</span> <span class="o">=</span> <span class="s">"en"</span>

<span class="c1">//開啟與係檔案a-z排序、整理功能</span>
<span class="k">let</span> <span class="nv">sanitizeFiles</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">//專案是單一or多語系</span>
<span class="k">let</span> <span class="nv">singleLanguage</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">//啟用檢查未翻譯語句功能</span>
<span class="k">let</span> <span class="nv">checkForUntranslated</span> <span class="o">=</span> <span class="kc">true</span>
</pre></table></code></div></div><p>5. Build！成功！</p><p><a href="/assets/41c49a75a743/1*74osParg9RRi2gcRx9ELuw.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*74osParg9RRi2gcRx9ELuw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNjQiIGhlaWdodD0iNDA0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>檢查結果提示類型：</strong></p><ul><li><strong>Build Error</strong> ❌ <strong>：</strong> - [Duplication] 項目在語系檔案內存在重複 - [Unused Key] 項目在語系檔案內有定義，但實際程式中未使用到 - [Missing] 項目在語系檔案內未定義，但實際程式中有使用到 - [Redundant] 項目在此語系檔相較於主要語系檔是多餘的 - [Missing Translation] 項目在主要語系檔有，但在此語系檔缺漏<li><strong>Build Warning</strong> ⚠️ <strong>：</strong> - [Potentially Untranslated] 此項目未經翻譯（與主語系檔項目內容相同）</ul><blockquote><p><strong><em>還沒結束，現在自動檢查提示有了，但我們還需要自行魔改一下。</em></strong></p></blockquote><p><strong>客製化匹配正規表示：</strong></p><p>回頭看檢查腳本 <code class="language-plaintext highlighter-rouge">Localize.swift</code> 頂部設定區塊 patterns 部分的第一項：</p><p><code class="language-plaintext highlighter-rouge">"NSLocalized(Format)?String\\(\\s*@?\"([\\w\\.]+)\""</code></p><p>匹配 Swift/ObjC的 <code class="language-plaintext highlighter-rouge">NSLocalizedString()</code> 方法，這個正規表示式只能匹配 <code class="language-plaintext highlighter-rouge">"Home.Title"</code> 這種格式的語句；假設我們是完整句子或有帶 Format 參數，則會被當誤當成 [Unused Key]。</p><p>EX: <code class="language-plaintext highlighter-rouge">"Hi, %@ welcome to my app"、"Hello World!"</code> <strong>&lt;- 這些語句都無法匹配</strong></p><p>我們可以新增一條 patterns 設定、或更改原本的 patterns 成：</p><p><code class="language-plaintext highlighter-rouge">"NSLocalized(Format)?String\\(\\s*@?\"([^(\")]+)\""</code></p><p>主要是調整 <code class="language-plaintext highlighter-rouge">NSLocalizedString</code> 方法後的匹配語句，變成取任意字串直到 <code class="language-plaintext highlighter-rouge">"</code> 出現就中止，你也可以 <a href="https://rubular.com/r/5eXvGy3svsAHyT" target="_blank">點此</a> 依照自己的需求進行客製。</p><p><strong>加上語系檔案格式檢查功能：</strong></p><p>此腳本僅針對語系檔做內容對應檢查，不會檢查檔案格式是否正確（是否有忘記加「 <strong>;</strong> 」），如果需要這個功能要自己加上！</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">//....</span>
<span class="k">let</span> <span class="nv">formatResult</span> <span class="o">=</span> <span class="nf">shell</span><span class="p">(</span><span class="s">"plutil -lint </span><span class="se">\(</span><span class="n">location</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">guard</span> <span class="n">formatResult</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span><span class="o">.</span><span class="nf">suffix</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s">"OK"</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj"</span>
            <span class="o">+</span> <span class="s">"/Localizable.strings:1: "</span>
            <span class="o">+</span> <span class="s">"error: [File Invaild] "</span>
            <span class="o">+</span> <span class="s">"This Localizable.strings file format is invalid."</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
  <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span>
<span class="p">}</span>
<span class="c1">//....</span>

<span class="kd">func</span> <span class="nf">shell</span><span class="p">(</span><span class="n">_</span> <span class="nv">command</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">Process</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">pipe</span> <span class="o">=</span> <span class="kt">Pipe</span><span class="p">()</span>

    <span class="n">task</span><span class="o">.</span><span class="n">standardOutput</span> <span class="o">=</span> <span class="n">pipe</span>
    <span class="n">task</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-c"</span><span class="p">,</span> <span class="n">command</span><span class="p">]</span>
    <span class="n">task</span><span class="o">.</span><span class="n">launchPath</span> <span class="o">=</span> <span class="s">"/bin/bash"</span>
    <span class="n">task</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span>

    <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fileHandleForReading</span><span class="o">.</span><span class="nf">readDataToEndOfFile</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">output</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

    <span class="k">return</span> <span class="n">output</span>
<span class="p">}</span>
</pre></table></code></div></div><p>增加 <code class="language-plaintext highlighter-rouge">shell()</code> 執行 shell script，使用 <code class="language-plaintext highlighter-rouge">plutil -lint</code> 檢查 plist 語系檔案格式正確性，有錯、少「;」會回傳錯誤，沒錯會回傳 <code class="language-plaintext highlighter-rouge">OK</code> 以此作為判斷！</p><p>檢查的地方可加在 LocalizationFiles-&gt;process( ) -&gt; <code class="language-plaintext highlighter-rouge">let location = singleLanguage…</code> 後，約 135 行的地方或參考我最後提供的完整魔改版。</p><p><strong>其他客製化：</strong></p><p>我們可以依照自己的需求進行客製，例如把 error 換成 warning 或是拔掉某個檢查功能 (EX: Potentially Untranslated、Unused Key)；腳本就是 swift 我們都很熟悉！不怕改壞改錯！</p><p>要讓 build 時出現 Error ❌：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>print("Project檔案.lproj" + "/檔案:行: " + "error: 錯誤訊息")
</pre></table></code></div></div><p>要讓 build 時出現 Warning ⚠️：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>print("Project檔案.lproj" + "/檔案:行: " + "warning: 警告訊息")
</pre></table></code></div></div><p><strong>最終魔改版：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
</pre><td class="rouge-code"><pre><span class="cp">#!/usr/bin/env xcrun --sdk macosx swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">// WHAT</span>
<span class="c1">// 1. Find Missing keys in other Localisation files</span>
<span class="c1">// 2. Find potentially untranslated keys</span>
<span class="c1">// 3. Find Duplicate keys</span>
<span class="c1">// 4. Find Unused keys and generate script to delete them all at once</span>

<span class="c1">// MARK: Start Of Configurable Section</span>

<span class="cm">/*
 You can enable or disable the script whenever you want
 */</span>
<span class="k">let</span> <span class="nv">enabled</span> <span class="o">=</span> <span class="kc">true</span>

<span class="cm">/*
 Put your path here, example -&gt;  Resources/Localizations/Languages
 */</span>
<span class="k">let</span> <span class="nv">relativeLocalizableFolders</span> <span class="o">=</span> <span class="s">"/streetvoice/SupportingFiles"</span>

<span class="cm">/*
 This is the path of your source folder which will be used in searching
 for the localization keys you actually use in your project
 */</span>
<span class="k">let</span> <span class="nv">relativeSourceFolder</span> <span class="o">=</span> <span class="s">"/streetvoice"</span>

<span class="cm">/*
 Those are the regex patterns to recognize localizations.
 */</span>
<span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"NSLocalized(Format)?String</span><span class="se">\\</span><span class="s">(</span><span class="se">\\</span><span class="s">s*@?</span><span class="se">\"</span><span class="s">([^(</span><span class="se">\"</span><span class="s">)]+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Swift and Objc Native</span>
    <span class="s">"Localizations</span><span class="se">\\</span><span class="s">.((?:[A-Z]{1}[a-z]*[A-z]*)*(?:</span><span class="se">\\</span><span class="s">.[A-Z]{1}[a-z]*[A-z]*)*)"</span><span class="p">,</span> <span class="c1">// Laurine Calls</span>
    <span class="s">"L10n.tr</span><span class="se">\\</span><span class="s">(key: </span><span class="se">\"</span><span class="s">(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// SwiftGen generation</span>
    <span class="s">"ypLocalized</span><span class="se">\\</span><span class="s">(</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"\\</span><span class="s">)"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s">.localized"</span> <span class="c1">// "key".localized pattern</span>
<span class="p">]</span>

<span class="cm">/*
 Those are the keys you don't want to be recognized as "unused"
 For instance, Keys that you concatenate will not be detected by the parsing
 so you want to add them here in order not to create false positives :)
 */</span>
<span class="k">let</span> <span class="nv">ignoredFromUnusedKeys</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="cm">/* example
let ignoredFromUnusedKeys = [
    "NotificationNoOne",
    "NotificationCommentPhoto",
    "NotificationCommentHisPhoto",
    "NotificationCommentHerPhoto"
]
*/</span>

<span class="k">let</span> <span class="nv">masterLanguage</span> <span class="o">=</span> <span class="s">"base"</span>

<span class="cm">/*
 Sanitizing files will remove comments, empty lines and order your keys alphabetically.
 */</span>
<span class="k">let</span> <span class="nv">sanitizeFiles</span> <span class="o">=</span> <span class="kc">false</span>

<span class="cm">/*
 Determines if there are multiple localizations or not.
 */</span>
<span class="k">let</span> <span class="nv">singleLanguage</span> <span class="o">=</span> <span class="kc">false</span>

<span class="cm">/*
 Determines if we should show errors if there's a key within the app
 that does not appear in master translations.
*/</span>
<span class="k">let</span> <span class="nv">checkForUntranslated</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">// MARK: End Of Configurable Section</span>

<span class="k">if</span> <span class="n">enabled</span> <span class="o">==</span> <span class="kc">false</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Localization check cancelled"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mo">000</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Detect list of supported languages automatically</span>
<span class="kd">func</span> <span class="nf">listSupportedLanguages</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">sl</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeLocalizableFolders</span>
    <span class="k">if</span> <span class="o">!</span><span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">fileExists</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Invalid configuration: </span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s"> does not exist."</span><span class="p">)</span>
        <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">extensionName</span> <span class="o">=</span> <span class="s">"lproj"</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Found these languages:"</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">element</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="n">extensionName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">".</span><span class="se">\(</span><span class="n">extensionName</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
            <span class="n">sl</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sl</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">supportedLanguages</span> <span class="o">=</span> <span class="nf">listSupportedLanguages</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">ignoredFromSameTranslation</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[:]</span>
<span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeLocalizableFolders</span>
<span class="k">var</span> <span class="nv">numberOfWarnings</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">var</span> <span class="nv">numberOfErrors</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">struct</span> <span class="kt">LocalizationFiles</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">var</span> <span class="nv">keyValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    <span class="k">var</span> <span class="nv">linesNumbers</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nf">process</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">process</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">sanitizeFiles</span> <span class="p">{</span>
            <span class="nf">removeCommentsFromFile</span><span class="p">()</span>
            <span class="nf">removeEmptyLinesFromFile</span><span class="p">()</span>
            <span class="nf">sortLinesAlphabetically</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="n">singleLanguage</span> <span class="p">?</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/Localizable.strings"</span> <span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        
        <span class="k">let</span> <span class="nv">formatResult</span> <span class="o">=</span> <span class="nf">shell</span><span class="p">(</span><span class="s">"plutil -lint </span><span class="se">\(</span><span class="n">location</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">guard</span> <span class="n">formatResult</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span><span class="o">.</span><span class="nf">suffix</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s">"OK"</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj"</span>
                <span class="o">+</span> <span class="s">"/Localizable.strings:1: "</span>
                <span class="o">+</span> <span class="s">"error: [File Invaild] "</span>
                <span class="o">+</span> <span class="s">"This Localizable.strings file format is invalid."</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
        <span class="n">keyValue</span> <span class="o">=</span> <span class="p">[:]</span>

        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">(.+)</span><span class="se">\"</span><span class="s">;"</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">pattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">var</span> <span class="nv">ignoredTranslation</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">lineNumber</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">in</span> <span class="n">lines</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

            <span class="c1">// Ignored pattern</span>
            <span class="k">let</span> <span class="nv">ignoredPattern</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">(.*)</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">(.+)</span><span class="se">\"</span><span class="s">; *</span><span class="se">\\</span><span class="s">/</span><span class="se">\\</span><span class="s">/ *ignore-same-translation-warning"</span>
            <span class="k">let</span> <span class="nv">ignoredRegex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">ignoredPattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">ignoredMatch</span> <span class="o">=</span> <span class="n">ignoredRegex</span><span class="p">?</span><span class="o">.</span><span class="nf">firstMatch</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">line</span><span class="p">,</span>
                                                           <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span>
                                                           <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">ignoredMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">ignoredTranslation</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="k">let</span> <span class="nv">firstMatch</span> <span class="o">=</span> <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">firstMatch</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">line</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">firstMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">firstMatch</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">keyValue</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj"</span>
                        <span class="o">+</span> <span class="s">"/Localizable.strings:</span><span class="se">\(</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
                        <span class="o">+</span> <span class="s">"error: [Duplication] </span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s"> "</span>
                        <span class="o">+</span> <span class="s">"is duplicated in </span><span class="se">\(</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
                    <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">keyValue</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">linesNumbers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineNumber</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">ignoredFromSameTranslation</span><span class="p">)</span>
        <span class="n">ignoredFromSameTranslation</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ignoredTranslation</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="n">from</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">r</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">s</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="nf">in</span>
            <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="s">""</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeEmptyLinesFromFile</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">}</span>
            <span class="k">let</span> <span class="nv">s</span> <span class="o">=</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeCommentsFromFile</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="o">!</span><span class="nv">$0</span><span class="o">.</span><span class="nf">hasPrefix</span><span class="p">(</span><span class="s">"//"</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">let</span> <span class="nv">s</span> <span class="o">=</span> <span class="nf">rebuildFileString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sortLinesAlphabetically</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="o">.</span><span class="n">newlines</span><span class="p">)</span>

            <span class="k">var</span> <span class="nv">s</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">in</span> <span class="nf">sortAlphabetically</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">l</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">lines</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">s</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">toFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">removeEmptyLinesFromLines</span><span class="p">(</span><span class="n">_</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sortAlphabetically</span><span class="p">(</span><span class="n">_</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="nf">sorted</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Load Localisation Files in memory</span>

<span class="k">let</span> <span class="nv">masterLocalizationFile</span> <span class="o">=</span> <span class="kt">LocalizationFiles</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">masterLanguage</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">localizationFiles</span> <span class="o">=</span> <span class="n">supportedLanguages</span>
    <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">!=</span> <span class="n">masterLanguage</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">LocalizationFiles</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// MARK: - Detect Unused Keys</span>

<span class="k">let</span> <span class="nv">sourcesPath</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="n">currentDirectoryPath</span> <span class="o">+</span> <span class="n">relativeSourceFolder</span>
<span class="k">let</span> <span class="nv">fileManager</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
<span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="n">fileManager</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">sourcesPath</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">localizedStrings</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">swiftFileLocation</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="c1">// checks the extension</span>
    <span class="k">if</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="n">swiftFileLocation</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".mm"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcesPath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">swiftFileLocation</span><span class="se">)</span><span class="s">"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
                <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:</span> <span class="p">(</span><span class="n">string</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="c1">// Obj c wa</span>
                <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
                                        <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span>
                                        <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">,</span>
                                        <span class="nv">using</span><span class="p">:</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                                            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                                                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">numberOfRanges</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                                                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                            <span class="p">}</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">masterKeys</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">usedKeys</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">ignored</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">ignoredFromUnusedKeys</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">unused</span> <span class="o">=</span> <span class="n">masterKeys</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">usedKeys</span><span class="p">)</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">ignored</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">untranslated</span> <span class="o">=</span> <span class="n">usedKeys</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">masterKeys</span><span class="p">)</span>

<span class="c1">// Here generate Xcode regex Find and replace script to remove dead keys all at once!</span>
<span class="k">var</span> <span class="nv">replaceCommand</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">("</span>
<span class="k">var</span> <span class="nv">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">unused</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
    <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Unused Key] </span><span class="se">\"\(</span><span class="n">v</span><span class="se">)\"</span><span class="s"> is never used"</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="s">"|"</span>
    <span class="p">}</span>
    <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="n">v</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="n">unused</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="n">replaceCommand</span> <span class="o">+=</span> <span class="s">")</span><span class="se">\"</span><span class="s"> = </span><span class="se">\"</span><span class="s">.*</span><span class="se">\"</span><span class="s">;"</span>
    <span class="p">}</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">replaceCommand</span><span class="p">)</span>

<span class="c1">// MARK: - Compare each translation file against master (en)</span>

<span class="k">for</span> <span class="n">file</span> <span class="k">in</span> <span class="n">localizationFiles</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">keyValue</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
            <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Missing] </span><span class="se">\"\(</span><span class="n">k</span><span class="se">)\"</span><span class="s"> missing from </span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">redundantKeys</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="o">!</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">keyValue</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">redundantKeys</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:</span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">linesNumbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">: "</span>
            <span class="o">+</span> <span class="s">"error: [Redundant key] </span><span class="se">\"\(</span><span class="n">k</span><span class="se">)\"</span><span class="s"> redundant in </span><span class="se">\(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span><span class="se">)</span><span class="s"> file"</span>

        <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">checkForUntranslated</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">key</span> <span class="k">in</span> <span class="n">untranslated</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">str</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">masterLocalizationFile</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">.lproj/Localizable.strings:1: "</span>
        <span class="n">str</span> <span class="o">+=</span> <span class="s">"error: [Missing Translation] </span><span class="se">\(</span><span class="n">key</span><span class="se">)</span><span class="s"> is not translated"</span>

        <span class="nf">print</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
        <span class="n">numberOfErrors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Number of warnings : </span><span class="se">\(</span><span class="n">numberOfWarnings</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Number of errors : </span><span class="se">\(</span><span class="n">numberOfErrors</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">numberOfErrors</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">shell</span><span class="p">(</span><span class="n">_</span> <span class="nv">command</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">Process</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">pipe</span> <span class="o">=</span> <span class="kt">Pipe</span><span class="p">()</span>

    <span class="n">task</span><span class="o">.</span><span class="n">standardOutput</span> <span class="o">=</span> <span class="n">pipe</span>
    <span class="n">task</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-c"</span><span class="p">,</span> <span class="n">command</span><span class="p">]</span>
    <span class="n">task</span><span class="o">.</span><span class="n">launchPath</span> <span class="o">=</span> <span class="s">"/bin/bash"</span>
    <span class="n">task</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span>

    <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fileHandleForReading</span><span class="o">.</span><span class="nf">readDataToEndOfFile</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">output</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

    <span class="k">return</span> <span class="n">output</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p><strong><em>最後最後，還沒結束！</em></strong></p></blockquote><p>當我們的 swift 檢查工具腳本都調試完成之後，要將其 <strong>compile 成執行檔減少 build 花費時間</strong> ，否則每次 build 都要重新 compile 一次（約能減少 90% 的時間）。</p><p>打開 terminal ，前往專案中檢查工具腳本所在目錄下執行：</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>swiftc <span class="nt">-o</span> Localize Localize.swift
</pre></table></code></div></div><p><a href="/assets/41c49a75a743/1*rwq_KZIDW-Lvtpd2xmgjDw.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*rwq_KZIDW-Lvtpd2xmgjDw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzIiIGhlaWdodD0iNTkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/41c49a75a743/1*BCKtqshZxHH17j3nBGtNlg.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*BCKtqshZxHH17j3nBGtNlg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MiIgaGVpZ2h0PSIxMDAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>然後再回頭到 Build Phases 更改 Script 內容路徑成執行檔</p><p>EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/Localize</code></p><p><a href="/assets/41c49a75a743/1*ewhCXzXNuS0MCTMCuINWng.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*ewhCXzXNuS0MCTMCuINWng.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iMjczIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>完工！</strong></p><h4 id="工具-2-asset-checker--圖片資源檢查工具"><span class="me-2">工具 2. <a href="https://github.com/s4cha/AssetChecker" target="_blank"><strong>Asset Checker 👮</strong></a> <strong>圖片資源檢查工具</strong></span><a href="#工具-2-asset-checker--圖片資源檢查工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>功能：</strong></p><ul><li>build 時自動檢查<li>檢查圖片缺漏：名稱有呼叫，但圖片資源目錄內沒有出現<li>檢查圖片多餘：名稱未使用，但圖片資源目錄存在的</ul><p><strong>安裝方法：</strong></p><ol><li><a href="https://github.com/freshOS/AssetChecker/blob/master/Classes/main.swift" target="_blank">下載工具的 Swift Script 檔案</a><li>放到專案目錄下 EX: <code class="language-plaintext highlighter-rouge">${SRCROOT}/AssetChecker.swift</code><li>打開專案設定 → iOS Target → Build Phases →左上角「+」 → New Run Script Phases → 在 Script 內容貼上路徑</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/AssetChecker.swift <span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/專案目錄 <span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/Resources/Images.xcassets
//<span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span>/Resources/Images.xcassets <span class="o">=</span> 你 .xcassets 的位置
</pre></table></code></div></div><p><a href="/assets/41c49a75a743/1*TPLS60W1iQiGFzU-inf3aA.webp" class="popup img-link blur"><img data-src="/assets/41c49a75a743/1*TPLS60W1iQiGFzU-inf3aA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDY1IiBoZWlnaHQ9IjMzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>可直接將設定參數帶在路徑上，參數1:專案目錄位置、參數2:圖片資源目錄位置；或跟語系檢查工具一樣編輯 <code class="language-plaintext highlighter-rouge">AssetChecker.swift</code> 頂部參數設定區塊：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Configure me \o/</span>

<span class="c1">// 專案目錄位置（用來搜索圖片有沒有在程式碼中使用到）</span>
<span class="k">var</span> <span class="nv">sourcePathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">// .xcassets 目錄位置</span>
<span class="k">var</span> <span class="nv">assetCatalogPathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">// Unused 警告忽略項目</span>
<span class="k">let</span> <span class="nv">ignoredUnusedNames</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
</pre></table></code></div></div><p>4. Build！ 成功！</p><p><strong>檢查結果提示類型：</strong></p><ul><li><strong>Build Error</strong> ❌ <strong>：</strong> - [Asset Missing] 項目在程式內有呼叫使用，但圖片資源目錄內沒有出現<li><strong>Build Warning</strong> ⚠️ <strong>：</strong> - [Asset Unused] 項目在程式內未使用，但圖片資源目錄內有出現 <em>p.s 假設圖片是動態變數提供，檢查工具將無法識別，可將其加入 <code class="language-plaintext highlighter-rouge">ignoredUnusedNames</code> 中設為例外。</em></ul><p>其他操作同語系檢查工具，這邊就不做贅述；最重要的事是也要 <strong>記得調適完後要 compile 成執行檔，並更改 run script 內容為執行檔！</strong></p><h4 id="開發自己的工具"><span class="me-2">開發自己的工具！</span><a href="#開發自己的工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><strong><em>我們可以參考圖片資源檢查工具腳本：</em></strong></p></blockquote><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
</pre><td class="rouge-code"><pre><span class="cp">#!/usr/bin/env xcrun --sdk macosx swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">// Configure me \o/</span>
<span class="k">var</span> <span class="nv">sourcePathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">var</span> <span class="nv">assetCatalogPathOption</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">let</span> <span class="nv">ignoredUnusedNames</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">in</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sourcePathOption</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">assetCatalogPathOption</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">sourcePath</span> <span class="o">=</span> <span class="n">sourcePathOption</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"AssetChecker:: error: Source path was missing!"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">assetCatalogAbsolutePath</span> <span class="o">=</span> <span class="n">assetCatalogPathOption</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"AssetChecker:: error: Asset Catalog path was missing!"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Searching sources in </span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s"> for assets in </span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="cm">/* Put here the asset generating false positives, 
 For instance whne you build asset names at runtime
let ignoredUnusedNames = [
    "IconArticle",
    "IconMedia",
    "voteEN",
    "voteES",
    "voteFR"
] 
*/</span>


<span class="c1">// MARK : - End Of Configurable Section</span>
<span class="kd">func</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">_</span> <span class="nv">enumerator</span><span class="p">:</span> <span class="kt">FileManager</span><span class="o">.</span><span class="kt">DirectoryEnumerator</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">e</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="n">elements</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">elements</span>
<span class="p">}</span>


<span class="c1">// MARK: - List Assets</span>
<span class="kd">func</span> <span class="nf">listAssets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">extensionName</span> <span class="o">=</span> <span class="s">"imageset"</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">assetCatalogAbsolutePath</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="n">extensionName</span><span class="p">)</span> <span class="p">}</span>                             <span class="c1">// Is Asset</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">".</span><span class="se">\(</span><span class="n">extensionName</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Remove extension</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="s">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">last</span> <span class="p">??</span> <span class="nv">$0</span> <span class="p">}</span>                 <span class="c1">// Remove folder path</span>
<span class="p">}</span>


<span class="c1">// MARK: - List Used Assets in the codebase</span>
<span class="kd">func</span> <span class="nf">localizedStrings</span><span class="p">(</span><span class="nv">inStringFile</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">localizedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">let</span> <span class="nv">namePattern</span> <span class="o">=</span> <span class="s">"([</span><span class="se">\\</span><span class="s">w-]+)"</span>
    <span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"#imageLiteral</span><span class="se">\\</span><span class="s">(resourceName: </span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Image Literal</span>
        <span class="s">"UIImage</span><span class="se">\\</span><span class="s">(named:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Default UIImage call (Swift)</span>
        <span class="s">"UIImage imageNamed:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\\</span><span class="s">@</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Default UIImage call </span>
        <span class="s">"</span><span class="se">\\</span><span class="s">&lt;image name=</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">.*"</span><span class="p">,</span> <span class="c1">// Storyboard resources</span>
        <span class="s">"R.image.</span><span class="se">\(</span><span class="n">namePattern</span><span class="se">)\\</span><span class="s">(</span><span class="se">\\</span><span class="s">)"</span> <span class="c1">//R.swift support</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">inStringFile</span><span class="p">,</span><span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">localizedStrings</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span><span class="n">sourcePath</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>
    
    <span class="cp">#if swift(&gt;=4.1)</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                             <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings ocurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#else</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings ocurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#endif</span>
<span class="p">}</span>


<span class="c1">// MARK: - Begining of script</span>
<span class="k">let</span> <span class="nv">assets</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="nf">listAssets</span><span class="p">())</span>
<span class="k">let</span> <span class="nv">used</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">+</span> <span class="n">ignoredUnusedNames</span><span class="p">)</span>


<span class="c1">// Generate Warnings for Unused Assets</span>
<span class="k">let</span> <span class="nv">unused</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">used</span><span class="p">)</span>
<span class="n">unused</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">:: warning: [Asset Unused] </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>


<span class="c1">// Generate Error for broken Assets</span>
<span class="k">let</span> <span class="nv">broken</span> <span class="o">=</span> <span class="n">used</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
<span class="n">broken</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">assetCatalogAbsolutePath</span><span class="se">)</span><span class="s">:: error: [Asset Missing] </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">if</span> <span class="n">broken</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>相較於語系檢查腳本，這個腳本簡潔且重要的功能都有，很有參考價值！</p><p><em>P.S 可以看到程式碼出現 <code class="language-plaintext highlighter-rouge">localizedStrings()</code> 命名，懷疑作者是從語系檢查工具的邏輯搬來用，忘了改方法名稱ＸＤ</em></p><p><strong>例如：</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">in</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1">//參數1</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">//參數2</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>^接收外部參數的方法</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">_</span> <span class="nv">enumerator</span><span class="p">:</span> <span class="kt">FileManager</span><span class="o">.</span><span class="kt">DirectoryEnumerator</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">e</span> <span class="o">=</span> <span class="n">enumerator</span><span class="p">?</span><span class="o">.</span><span class="nf">nextObject</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="n">elements</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">elements</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">localizedStrings</span><span class="p">(</span><span class="nv">inStringFile</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">localizedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="k">let</span> <span class="nv">namePattern</span> <span class="o">=</span> <span class="s">"([</span><span class="se">\\</span><span class="s">w-]+)"</span>
    <span class="k">let</span> <span class="nv">patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"#imageLiteral</span><span class="se">\\</span><span class="s">(resourceName: </span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Image Literal</span>
        <span class="s">"UIImage</span><span class="se">\\</span><span class="s">(named:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"\\</span><span class="s">)"</span><span class="p">,</span> <span class="c1">// Default UIImage call (Swift)</span>
        <span class="s">"UIImage imageNamed:</span><span class="se">\\</span><span class="s">s*</span><span class="se">\\</span><span class="s">@</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">"</span><span class="p">,</span> <span class="c1">// Default UIImage call </span>
        <span class="s">"</span><span class="se">\\</span><span class="s">&lt;image name=</span><span class="se">\"\(</span><span class="n">namePattern</span><span class="se">)\"</span><span class="s">.*"</span><span class="p">,</span> <span class="c1">// Storyboard resources</span>
        <span class="s">"R.image.</span><span class="se">\(</span><span class="n">namePattern</span><span class="se">)\\</span><span class="s">(</span><span class="se">\\</span><span class="s">)"</span> <span class="c1">//R.swift support</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">patterns</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">regex</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">let</span> <span class="nv">range</span> <span class="o">=</span> <span class="kt">NSRange</span><span class="p">(</span><span class="nv">location</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">length</span><span class="p">:(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">regex</span><span class="p">?</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">inStringFile</span><span class="p">,</span><span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">range</span><span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">inStringFile</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">localizedStrings</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">localizedStrings</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">listUsedAssetLiterals</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">enumerator</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">enumerator</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span><span class="n">sourcePath</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>
    
    <span class="cp">#if swift(&gt;=4.1)</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">compactMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                             <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings ocurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#else</span>
        <span class="k">return</span> <span class="nf">elementsInEnumerator</span><span class="p">(</span><span class="n">enumerator</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".m"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".xib"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".storyboard"</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// Only Swift and Obj-C files</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">"</span><span class="se">\(</span><span class="n">sourcePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span> <span class="p">}</span>                              <span class="c1">// Build file paths</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)}</span>    <span class="c1">// Get file contents</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Remove nil entries</span>
            <span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">localizedStrings</span><span class="p">)</span>                                      <span class="c1">// Find localizedStrings ocurrences</span>
            <span class="o">.</span><span class="n">flatMap</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span>                                                <span class="c1">// Flatten</span>
    <span class="cp">#endif</span>
<span class="p">}</span>
</pre></table></code></div></div><p>^遍歷所有專案檔案並進行正則匹配的方法</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">//要讓 build 時出現 Error ❌：</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Project檔案.lproj"</span> <span class="o">+</span> <span class="s">"/檔案:行: "</span> <span class="o">+</span> <span class="s">"error: 錯誤訊息"</span><span class="p">)</span>
<span class="c1">//要讓 build 時出現 Warning ⚠️：</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Project檔案.lproj"</span> <span class="o">+</span> <span class="s">"/檔案:行: "</span> <span class="o">+</span> <span class="s">"warning: 警告訊息"</span><span class="p">)</span>
</pre></table></code></div></div><p>^print error or warning</p><p>可以綜合參考以上的程式方法，自己打造想要的工具。</p><h3 id="總結"><span class="me-2">總結</span><a href="#總結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>這兩個檢查工具導入之後，我們在開發上就能更安心、更有效率並且減少冗餘；也因為這次經驗大開眼界，日後如果有什麼新的 build run script 需求都能直接使用最熟悉的語言 swift 來進行製作！</p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p>本文首次發表於 Medium ➡️ <a href="https://medium.com/p/41c49a75a743" target="_blank"><strong>前往查看</strong></a></p><p>由 <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> 與 <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> 提供自動轉換與同步技術。</p><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2020-09-17-41c49a75a743.md" target="_blank">Improve this page on Github.</a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 2,931 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-14 | 2,578 Views on <a href="https://medium.com/p/41c49a75a743" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/shell-script/" class="post-tag no-text-decoration" >shell-script</a> <a href="/tags/xcode/" class="post-tag no-text-decoration" >xcode</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/toolkit/" class="post-tag no-text-decoration" >toolkit</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Xcode%20%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%20Swift%20%E6%92%B0%E5%AF%AB%20Run%20Script%EF%BC%81%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fxcode-%25E7%259B%25B4%25E6%258E%25A5%25E4%25BD%25BF%25E7%2594%25A8-swift-%25E6%2592%25B0%25E5%25AF%25AB-run-script-41c49a75a743%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Xcode%20%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%20Swift%20%E6%92%B0%E5%AF%AB%20Run%20Script%EF%BC%81%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fxcode-%25E7%259B%25B4%25E6%258E%25A5%25E4%25BD%25BF%25E7%2594%25A8-swift-%25E6%2592%25B0%25E5%25AF%25AB-run-script-41c49a75a743%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fxcode-%25E7%259B%25B4%25E6%258E%25A5%25E4%25BD%25BF%25E7%2594%25A8-swift-%25E6%2592%25B0%25E5%25AF%25AB-run-script-41c49a75a743%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/">Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/">遊記 2025 韓國釜山 8 天 7 夜自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/">遊記 9/11 名古屋一日快閃自由行</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/">遊記 2023 九州 10 日自由行獨旅</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/">遊記 2023 京阪神 8 日自由行</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E5%AF%A6%E6%88%B0-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer 邊播邊 Cache 實戰</h4><div class="text-muted"><p>AVPlayer/AVQueuePlayer with AVURLAsset 實作 AVAssetResourceLoaderDelegate 達成邊播放音樂/影片邊緩存</p></div></div></a></article><article class="col"> <a href="/posts/en/avplayer-streaming-and-caching-practical-guide-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming and Caching Practical Guide</h4><div class="text-muted"><p>Implementing AVPlayer/AVQueuePlayer with AVURLAsset and AVAssetResourceLoaderDelegate to achieve music/video streaming while caching.</p></div></div></a></article><article class="col"> <a href="/posts/exploring-the-long-standing-issues-of-xcode-virtual-directories-and-my-open-source-tool-solution-fd719053b376-en/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1740918091" data-df="ll" > Mar 2, 2025 </time><h4 class="pt-0 my-2">Exploring the Long-Standing Issues of XCode Virtual Directories and My Open Source Tool Solution</h4><div class="text-muted"><p>The occupational hazards of Apple developers using virtual directories in Xcode early on, leading to chaotic directory structures and difficulties integrating modern tools like XcodeGen and Tuist.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/ios-14-%E5%89%AA%E8%B2%BC%E7%B0%BF%E7%AB%8A%E8%B3%87%E6%81%90%E6%85%8C-%E9%9A%B1%E7%A7%81%E8%88%87%E4%BE%BF%E5%88%A9%E7%9A%84%E5%85%A9%E9%9B%A3-8a04443024e2/" class="btn btn-outline-primary" aria-label="Older" ><p>iOS 14 剪貼簿竊資恐慌，隱私與便利的兩難</p></a> <a href="/posts/zrealm-life/apple-watch-series-6-%E9%96%8B%E7%AE%B1-%E5%85%A9%E5%B9%B4%E4%BD%BF%E7%94%A8%E9%AB%94%E9%A9%97-eab0e984043/" class="btn btn-outline-primary" aria-label="Newer" ><p>Apple Watch Series 6 開箱 & 兩年使用體驗</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> All Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-15 01:07:42 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
