<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="é‡å° iOS é–‹ç™¼è€…é¢è‡¨ HTML è½‰ NSAttributedString é–ƒé€€èˆ‡æ•ˆèƒ½ç“¶é ¸ï¼Œæä¾› Regex è§£æã€Tokenizationã€AST å»ºæ§‹åŠæ¨£å¼ç¹¼æ‰¿ç­‰å®Œæ•´è§£æ³•ï¼Œå¯¦ç¾é«˜æ•ˆä¸”å¯æ“´å……çš„å­—ä¸²æ¸²æŸ“å¼•æ“ï¼Œæå‡ UI æµæš¢åº¦èˆ‡ç©©å®šæ€§ã€‚" /><meta property="og:description" content="é‡å° iOS é–‹ç™¼è€…é¢è‡¨ HTML è½‰ NSAttributedString é–ƒé€€èˆ‡æ•ˆèƒ½ç“¶é ¸ï¼Œæä¾› Regex è§£æã€Tokenizationã€AST å»ºæ§‹åŠæ¨£å¼ç¹¼æ‰¿ç­‰å®Œæ•´è§£æ³•ï¼Œå¯¦ç¾é«˜æ•ˆä¸”å¯æ“´å……çš„å­—ä¸²æ¸²æŸ“å¼•æ“ï¼Œæå‡ UI æµæš¢åº¦èˆ‡ç©©å®šæ€§ã€‚" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-12T01:09:22+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" /><meta property="twitter:title" content="æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://www.linkedin.com/in/zhgchgli"},"dateModified":"2023-08-06T00:15:39+08:00","datePublished":"2023-03-12T01:09:22+08:00","description":"é‡å° iOS é–‹ç™¼è€…é¢è‡¨ HTML è½‰ NSAttributedString é–ƒé€€èˆ‡æ•ˆèƒ½ç“¶é ¸ï¼Œæä¾› Regex è§£æã€Tokenizationã€AST å»ºæ§‹åŠæ¨£å¼ç¹¼æ‰¿ç­‰å®Œæ•´è§£æ³•ï¼Œå¯¦ç¾é«˜æ•ˆä¸”å¯æ“´å……çš„å­—ä¸²æ¸²æŸ“å¼•æ“ï¼Œæå‡ UI æµæš¢åº¦èˆ‡ç©©å®šæ€§ã€‚","headline":"æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/"},"url":"https://zhgchg.li/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/"}</script><title>æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£ | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=false" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/html-parsing-techniques-build-custom-parsers-for-nsattributedstring-rendering-2724f02f6e7/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%AC%E6%8D%A2-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3-2724f02f6e7/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"ç‚ºä»€éº¼å…§å»º NSAttributedString.DocumentType.html è§£æ HTML æ•ˆèƒ½å·®ä¸”æœƒé–ƒé€€ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"å…§å»ºçš„ NSAttributedString.DocumentType.html è§£ææ˜¯é€é WebView Core é€²è¡Œæ¸²æŸ“ï¼Œæ•ˆèƒ½ä½ä¸”åœ¨ iOS 12 ä»¥ä¸Šç‰ˆæœ¬å¸¸å› å­—ä¸²éé•·æˆ–ç‰¹æ®Šæ¨™ç±¤å°è‡´é–ƒé€€ï¼Œç„¡æ³•å®¢è£½åŒ–æ¨£å¼ï¼Œä¸”å®˜æ–¹å°šç„¡æ ¹æœ¬è§£æ±ºæ–¹æ¡ˆã€‚"}},{"@type":"Question","name":"å¦‚ä½•è§£æ±º XMLParser å®¹éŒ¯ç‡ä½ï¼Œç„¡æ³•è§£æä¸å®Œæ•´æˆ–éŒ¯ä½ HTML æ¨™ç±¤çš„å•é¡Œï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œ Tokenizationï¼Œå°‡ HTML æ¨™ç±¤æ‹†è§£æˆå–®ä¸€æ¨™ç±¤ï¼Œä¸¦é€é Normalization è‡ªå‹•ä¿®æ­£ç¼ºå¤±çš„çµæŸæ¨™ç±¤èˆ‡éŒ¯ä½æ¨™ç±¤ï¼Œæå‡å®¹éŒ¯èƒ½åŠ›ä¸¦é¿å… XMLParser å°ä¸å®Œæ•´ HTML è§£æå¤±æ•—ã€‚"}},{"@type":"Question","name":"å¦‚ä½•å°‡ HTML è½‰æ›æˆå¯æ“´å……ä¸”æ˜“æ–¼æ“ä½œçš„ NSAttributedString çµæ§‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"å°‡ HTML Tokenization å¾Œçš„çµæœé€é Normalization è½‰æˆæŠ½è±¡èªæ³•æ¨¹ï¼ˆASTï¼‰ï¼Œä¸¦åˆ©ç”¨ Visitor Pattern å°‡ HTML æ¨™ç±¤æ˜ å°„æˆå°æ‡‰çš„ Markup ç¯€é»èˆ‡æ¨£å¼ï¼Œæœ€å¾Œçµ„åˆå‡ºå®¢è£½åŒ–çš„ NSAttributedStringï¼Œæ–¹ä¾¿æ“´å……èˆ‡æ¨£å¼ç¹¼æ‰¿ã€‚"}},{"@type":"Question","name":"å¦‚ä½•æ”¯æ´å‹•æ…‹ CSS æ¨£å¼ä¸¦å®¢è£½åŒ– HTML æ¨™ç±¤å°æ‡‰çš„ NSAttributedString æ¨£å¼ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"é€éå®šç¾© HTMLTagStyleAttribute èˆ‡ Visitorï¼Œè§£æ style å±¬æ€§å­—ä¸²ï¼Œå°‡ CSS æ¨£å¼å‹•æ…‹è½‰æ›æˆ MarkupStyleï¼Œä¸¦æä¾› MarkupStylePolicy ä¾†æ±ºå®šå„ªå…ˆä½¿ç”¨ç¨‹å¼ç¢¼é è¨­æ¨£å¼æˆ– HTML style å±¬æ€§ï¼Œé”æˆéˆæ´»ä¸”å¯æ“´å……çš„æ¨£å¼è¨­å®šã€‚"}},{"@type":"Question","name":"å¦‚ä½•åœ¨ UITextView æˆ– UILabel ä¸­æ­£ç¢ºé¡¯ç¤ºå«æœ‰é€£çµã€åœ–ç‰‡åŠè¤‡é›œæ¨£å¼çš„ NSAttributedStringï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"åˆ©ç”¨ ZMarkupParser ç”¢ç”Ÿçš„ NSAttributedStringï¼ŒUITextView å¯è¨­å®š linkTextAttributes ä»¥æ§åˆ¶é€£çµæ¨£å¼ï¼ŒUILabel å‰‡éœ€é¡å¤–è™•ç† NSTextAttachment ä»¥æ”¯æ´åœ–ç‰‡é¡¯ç¤ºï¼Œä¸¦é€éè‡ªè¨‚ ZNSTextAttachment å¯¦ç¾åœ–ç‰‡ä¸‹è¼‰èˆ‡å‹•æ…‹æ›´æ–°ï¼Œç¢ºä¿ UI æ­£ç¢ºæ¸²æŸ“ã€‚"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan ğŸ‡¹ğŸ‡¼ who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="https://medium.com/@zhgchgli" class="nav-link" target="_blank" style="background: #EDF4FF; color: #0A84FF;"> <i class="fa-brands fa-medium"></i> <span>Follow Me!<br/><strong>1,049+</strong> Followers</span> </a><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£</h1><p class="post-desc fw-light mb-4">é‡å° iOS é–‹ç™¼è€…é¢è‡¨ HTML è½‰ NSAttributedString é–ƒé€€èˆ‡æ•ˆèƒ½ç“¶é ¸ï¼Œæä¾› Regex è§£æã€Tokenizationã€AST å»ºæ§‹åŠæ¨£å¼ç¹¼æ‰¿ç­‰å®Œæ•´è§£æ³•ï¼Œå¯¦ç¾é«˜æ•ˆä¸”å¯æ“´å……çš„å­—ä¸²æ¸²æŸ“å¼•æ“ï¼Œæå‡ UI æµæš¢åº¦èˆ‡ç©©å®šæ€§ã€‚</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1678554562" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 12, 2023 </time> </span> <span> Updated <time data-ts="1691252139" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 5, 2023 </time> </span><div class="mt-3 mb-3"> <a href="/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" class="popup img-link preview-img blur"><img data-src="/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://www.linkedin.com/in/zhgchgli">ZhgChgLi</a> </em> | <em><a href="https://www.linkedin.com/in/zhgchgli" target="_blank">Senior Software Engineer</a></em><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="11851 words" > <em>65 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Chapters ğŸ”–</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½‰æ› HTML å­—ä¸²æˆ NSAttributedString æŠ€è¡“è©³è§£</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/html-parsing-techniques-build-custom-parsers-for-nsattributedstring-rendering-2724f02f6e7/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%AC%E6%8D%A2-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3-2724f02f6e7/"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æŸ¥çœ‹æœ¬æ–‡ç« ç®€ä½“ä¸­æ–‡ç‰ˆæœ¬ã€‚</p></blockquote><blockquote class="prompt-info"><p>åŸºæ–¼ SEO è€ƒé‡ï¼Œæœ¬æ–‡æ¨™é¡Œèˆ‡æè¿°ç¶“ AI èª¿æ•´ï¼ŒåŸå§‹ç‰ˆæœ¬è«‹åƒè€ƒå…§æ–‡ã€‚</p></blockquote><h4 id="zhgchgli-table-of-contents">æ–‡ç« ç›®éŒ„</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>æ‰‹å·¥æ‰“é€  HTML è§£æå™¨çš„é‚£äº›äº‹ <a href="#æ‰‹å·¥æ‰“é€ -html-è§£æå™¨çš„é‚£äº›äº‹">#</a></summary><ul><li><a href="#æ¥çºŒ">æ¥çºŒ</a></li></ul></details></li><li class="has-children"><details><summary>Convert HTML String to NSAttributedString <a href="#convert-html-string-to-nsattributedstring">#</a></summary><ul><li><a href="#nsattributedstringdocumenttypehtml">NSAttributedString.DocumentType.html</a></li><li><a href="#xmlparser">XMLParser</a></li><li><a href="#ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š">ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š</a></li></ul></details></li><li class="has-children"><details><summary>ZhgChgLi/ZMarkupParser <a href="#zhgchglizmarkupparser">#</a></summary><ul><li><a href="#ç‰¹è‰²">ç‰¹è‰²</a></li></ul></details></li><li><a href="#æŠ€è¡“ç´°ç¯€">æŠ€è¡“ç´°ç¯€</a></li><li><a href="#ç¨‹å¼ç¢¼åŒ–--tokenization">ç¨‹å¼ç¢¼åŒ– â€” Tokenization</a></li><li><a href="#æ¨™æº–åŒ–--normalization">æ¨™æº–åŒ– â€” Normalization</a></li><li class="has-children"><details><summary>Abstract Syntax Tree <a href="#abstract-syntax-tree">#</a></summary><ul><li><a href="#markupcomponent">MarkupComponent</a></li><li><a href="#htmltag--htmltagname--htmltagnamevisitor">HTMLTag & HTMLTagName & HTMLTagNameVisitor</a></li><li><a href="#htmltagnametohtmlmarkupvisitor">HTMLTagNameToHTMLMarkupVisitor</a></li><li><a href="#è½‰æ›æˆæŠ½è±¡æ¨¹-with-html-è³‡æ–™">è½‰æ›æˆæŠ½è±¡æ¨¹ with HTML è³‡æ–™</a></li><li><a href="#æ­¤æ™‚å…¶å¯¦æˆ‘å€‘å°±å®Œæˆ-selector-çš„åŠŸèƒ½äº†-">æ­¤æ™‚ï¼Œå…¶å¯¦æˆ‘å€‘å°±å®Œæˆ Selector çš„åŠŸèƒ½äº† ğŸ‰</a></li></ul></details></li><li class="has-children"><details><summary>Parser â€” HTML to MarkupSyle (Abstract of NSAttributedString.Key) <a href="#parser--html-to-markupsyle-abstract-of-nsattributedstringkey">#</a></summary><ul><li><a href="#markupstyle-struct">MarkupStyle Struct</a></li><li><a href="#htmltagstyleattribute--htmltagstyleattributevisitor">HTMLTagStyleAttribute & HTMLTagStyleAttributeVisitor</a></li><li><a href="#htmltagstyleattributetomarkupstylevisitor">HTMLTagStyleAttributeToMarkupStyleVisitor</a></li><li><a href="#htmlelementmarkupcomponentmarkupstylevisitor">HTMLElementMarkupComponentMarkupStyleVisitor</a></li><li><a href="#htmlelementwithmarkuptomarkupstyleprocessor">HTMLElementWithMarkupToMarkupStyleProcessor</a></li></ul></details></li><li class="has-children"><details><summary>Render â€” Convert To NSAttributedString <a href="#render--convert-to-nsattributedstring">#</a></summary><ul><li><a href="#markupnsattributedstringvisitor">MarkupNSAttributedStringVisitor</a></li><li><a href="#stripper--å‰é›¢-html-tag">Stripper â€” å‰é›¢ HTML Tag</a></li><li><a href="#extend--å‹•æ…‹æ“´å……">Extend â€” å‹•æ…‹æ“´å……</a></li><li><a href="#zhtmlparserbuilder">ZHTMLParserBuilder</a></li><li><a href="#uikit-å•é¡Œ">UIKit å•é¡Œ</a></li><li><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®-é …ç›®æ¸…å–®">è¤‡é›œçš„æ¸²æŸ“é …ç›®â€” é …ç›®æ¸…å–®</a></li><li><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®--table">è¤‡é›œçš„æ¸²æŸ“é …ç›® â€” Table</a></li><li><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®--image">è¤‡é›œçš„æ¸²æŸ“é …ç›® â€” Image</a></li></ul></details></li><li class="has-children"><details><summary>Testing & Continuous Integration <a href="#testing--continuous-integration">#</a></summary><ul><li><a href="#snapshot-test">Snapshot Test</a></li><li><a href="#codecov-test-coverage">Codecov Test Coverage</a></li><li><a href="#continuous-integration">Continuous Integration</a></li><li><a href="#regex">Regex</a></li><li><a href="#swift-package-manager--cocoapods">Swift Package Manager & Cocoapods</a></li><li><a href="#chatgpt">ChatGPT</a></li></ul></details></li><li><a href="#è²æ˜">è²æ˜</a></li><li><a href="#contributing">Contributing</a></li><li class="has-children"><details><summary>ç¸½çµ <a href="#ç¸½çµ">#</a></summary><ul><li><a href="#å»¶ä¼¸é–±è®€">å»¶ä¼¸é–±è®€</a></li></ul></details></li></ul></nav><hr /><h3 id="æ‰‹å·¥æ‰“é€ -html-è§£æå™¨çš„é‚£äº›äº‹"><span class="me-2">æ‰‹å·¥æ‰“é€  HTML è§£æå™¨çš„é‚£äº›äº‹</span><a href="#æ‰‹å·¥æ‰“é€ -html-è§£æå™¨çš„é‚£äº›äº‹" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ZMarkupParser HTML to NSAttributedString æ¸²æŸ“å¼•æ“çš„é–‹ç™¼å¯¦éŒ„</p><p>HTML String çš„ Tokenization è½‰æ›ã€Normalization è™•ç†ã€Abstract Syntax Tree çš„ç”¢ç”Ÿã€Visitor Pattern / Builder Pattern çš„æ‡‰ç”¨, é‚„æœ‰ä¸€äº›é›œè«‡â€¦</p><h4 id="æ¥çºŒ"><span class="me-2">æ¥çºŒ</span><a href="#æ¥çºŒ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å»å¹´ç™¼è¡¨äº†ç¯‡ã€Œ[ <strong>TL;DR]</strong> <a href="/posts/zrealm-dev/ios-nsattributedstring-html-render-%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-%E8%A7%A3%E6%B1%BA%E9%96%83%E9%80%80%E8%88%87%E6%95%88%E8%83%BD%E7%93%B6%E9%A0%B8-a8c2d26cc734/">è‡ªè¡Œå¯¦ç¾ iOS NSAttributedString HTML Render</a> ã€çš„æ–‡ç« ï¼Œç²—æ·ºçš„ä»‹ç´¹å¯ä»¥ä½¿ç”¨ XMLParser å»å‰–æ HTML å†å°‡å…¶è½‰æ›æˆ NSAttributedString.Keyï¼Œæ–‡ä¸­çš„ç¨‹å¼æ¶æ§‹åŠæ€è·¯éƒ½å¾ˆé›¶äº‚ï¼Œå› æ˜¯éæ°´ç´€éŒ„ä¸€ä¸‹ä¹‹å‰é‡åˆ°çš„å•é¡ŒåŠç•¶åˆä¸¦æ²’æœ‰èŠ±å¤ªå¤šæ™‚é–“ç ”ç©¶æ­¤è­°é¡Œã€‚</p><h3 id="convert-html-string-to-nsattributedstring"><span class="me-2">Convert HTML String to NSAttributedString</span><a href="#convert-html-string-to-nsattributedstring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å†æ¬¡é‡æ–°æ¢è¨æ­¤è­°é¡Œï¼Œæˆ‘å€‘éœ€è¦èƒ½å°‡ API çµ¦çš„ HTML å­—ä¸²è½‰æ›æˆ NSAttributedString ï¼Œä¸¦å¥—ç”¨å°æ‡‰æ¨£å¼æ”¾åˆ° UITextView/UILabel ä¸­é¡¯ç¤ºã€‚</p><p>e.g. <code class="language-plaintext highlighter-rouge">&lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt;</code> è¦èƒ½é¡¯ç¤ºæˆ <strong>Test <a href="https://blog.zhgchg.li" target="_blank">Link</a></strong></p><ul><li>è¨»1 ä¸å»ºè­°ä½¿ç”¨ HTML åšç‚º App èˆ‡è³‡æ–™é–“çš„æºé€šæ¸²æŸ“åª’ä»‹ï¼Œå›  HTML è¦æ ¼éæ–¼å½ˆæ€§ï¼ŒApp ç„¡æ³•æ”¯æ´æ‰€æœ‰ HTML æ¨£å¼ï¼Œä¹Ÿæ²’æœ‰å®˜æ–¹çš„ HTML è½‰æ›æ¸²æŸ“å¼•æ“ã€‚<li>è¨»2 iOS 14 é–‹å§‹å¯ä½¿ç”¨å®˜æ–¹åŸç”Ÿçš„ AttributedString è§£æ Markdownæˆ–å¼•å…¥ apple/swift-markdown Swift Package è§£æ Markdownã€‚<li>è¨»3 å› æ•å¸å°ˆæ¡ˆé¾å¤§ä¸”å·²æ‡‰ç”¨ HTML åšç‚ºåª’ä»‹å¤šå¹´ï¼Œæ‰€ä»¥æš«æ™‚ç„¡æ³•å…¨é¢æ›´æ›ç‚º Markdown æˆ–å…¶ä»– Markupã€‚<li><strong>è¨»4</strong> <strong>é€™é‚Šçš„ HTML ä¸¦ä¸æ˜¯è¦ç”¨ä¾†é¡¯ç¤ºæ•´å€‹ HTML ç¶²é ï¼Œåªæ˜¯æŠŠ HTML åšç‚ºæ¨£å¼ Markdown æ¸²æŸ“å­—ä¸²æ¨£å¼ã€‚</strong> <strong>(è¦æ¸²æŸ“æ•´é ã€è¤‡é›œåŒ…å«åœ–ç‰‡è¡¨æ ¼çš„ HTMLï¼Œä¾ç„¶è¦ä½¿ç”¨ WevView loadHTML)</strong></ul><blockquote><p>å¼·çƒˆå»ºè­°ä½¿ç”¨ Markdown åšç‚ºå­—ä¸²æ¸²æŸ“åª’ä»‹èªè¨€ï¼Œå¦‚æœæ‚¨çš„å°ˆæ¡ˆè·Ÿæˆ‘æœ‰ä¸€æ¨£å›°æ“¾ä¸å¾—ä¸ä½¿ç”¨ HTML ä¸¦è‹¦ç„¡å„ªé›…çš„ to NSAttributedString è½‰æ›å·¥å…·ï¼Œ å†è«‹ä½¿ç”¨ã€‚</p></blockquote><blockquote><p>é‚„è¨˜å¾—ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ä¹Ÿå¯ä»¥ç›´æ¥è·³åˆ° ZhgChgLi / ZMarkupParser ç« ç¯€ã€‚</p></blockquote><h4 id="nsattributedstringdocumenttypehtml"><span class="me-2">NSAttributedString.DocumentType.html</span><a href="#nsattributedstringdocumenttypehtml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç¶²è·¯ä¸Šèƒ½æ‰¾åˆ°çš„ HTML to NSAttributedString çš„åšæ³•éƒ½æ˜¯è¦æˆ‘å€‘ç›´æ¥ä½¿ç”¨ NSAttributedString è‡ªå¸¶çš„ options æ¸²æŸ“ HTMLï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">htmlString</span> <span class="o">=</span> <span class="s">"&lt;b&gt;Test&lt;a&gt;Link&lt;/a&gt;&lt;/b&gt;"</span>
<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">htmlString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">attributedOptions</span><span class="p">:[</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">DocumentReadingOptionKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">.</span><span class="nv">documentType</span> <span class="p">:</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">DocumentType</span><span class="o">.</span><span class="n">html</span><span class="p">,</span>
  <span class="o">.</span><span class="nv">characterEncoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="o">.</span><span class="n">rawValue</span>
<span class="p">]</span>
<span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">attributedOptions</span><span class="p">,</span> <span class="nv">documentAttributes</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>æ­¤åšæ³•çš„å•é¡Œï¼š</strong></p><ul><li>æ•ˆèƒ½å·®ï¼šæ­¤æ–¹æ³•æ˜¯é€é WebView Core å»æ¸²æŸ“å‡ºæ¨£å¼ï¼Œå†åˆ‡å› Main Thread çµ¦ UI é¡¯ç¤ºï¼›æ¸²æŸ“ 300 å¤šå€‹å­—å…ƒå°±éœ€ 0.03 Secã€‚<li>æœƒåƒå­—ï¼šä¾‹å¦‚è¡ŒéŠ·æ–‡æ¡ˆå¯èƒ½æœƒä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&lt;Congratulation!&gt;</code> æœƒè¢«ç•¶æˆ HTML Tag è¢«å»é™¤æ‰ã€‚<li>ç„¡æ³•å®¢è£½åŒ–ï¼šä¾‹å¦‚ç„¡æ³•æŒ‡å®š HTML çš„ç²—é«”åœ¨ NSAttributedString ä¸­å°æ‡‰çš„ç²—é«”ç¨‹åº¦ã€‚<li><a href="https://developer.apple.com/forums/thread/115405" target="_blank">iOS â‰¥ 12 é–‹å§‹æœƒé›¶æ˜Ÿé–ƒé€€çš„å•é¡Œä¸”å®˜æ–¹ç„¡è§£</a><li>åœ¨ iOS 15 å‡ºç¾ <a href="/posts/zrealm-dev/ios-nsattributedstring-html-render-%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-%E8%A7%A3%E6%B1%BA%E9%96%83%E9%80%80%E8%88%87%E6%95%88%E8%83%BD%E7%93%B6%E9%A0%B8-a8c2d26cc734/">å¤§é‡é–ƒé€€</a> ï¼Œæ¸¬è©¦ç™¼ç¾ä½é›»é‡æƒ…æ³ä¸‹æœƒ 100% é–ƒé€€ (iOS â‰¥ 15.2 å·²ä¿®æ­£)<li>å­—ä¸²å¤ªé•·æœƒé–ƒé€€ï¼Œå¯¦æ¸¬è¼¸å…¥è¶…é 54,600+ é•·åº¦å­—ä¸²å°±æœƒ 100% é–ƒé€€ (EXC_BAD_ACCESS)</ul><p>å°èˆ‡æˆ‘å€‘æœ€ç—›çš„é‚„æ˜¯é–ƒé€€å•é¡Œï¼ŒiOS 15 ç™¼ä½ˆåˆ° 15.2 ä¿®æ­£ä¹‹å‰ï¼ŒApp å§‹çµ‚è¢«æ­¤å•é¡Œéœ¸æ¦œï¼Œå¾æ•¸æ“šä¾†çœ‹ï¼Œ2022/03/11~2022/06/08 å°±é€ æˆäº† 2.4K+ æ¬¡é–ƒé€€ã€å½±éŸ¿ 1.4K+ ä½ä½¿ç”¨è€…ã€‚</p><p>æ­¤é–ƒé€€å•é¡Œè‡ª iOS 12 é–‹å§‹å°±æœ‰ï¼ŒiOS 15 åªæ˜¯è¸©åˆ°æ›´å¤§çš„å‘ï¼Œä½†æˆ‘çŒœ iOS 15.2 çš„ä¿®æ­£ä¹Ÿåªæ˜¯è£œæ´ï¼Œå®˜æ–¹ç„¡æ³•æ ¹é™¤ã€‚</p><p>å…¶æ¬¡å•é¡Œæ˜¯æ•ˆèƒ½ï¼Œå› ç‚ºåšç‚ºå­—ä¸²æ¨£å¼ Markup Languageï¼Œæœƒå¤§é‡æ‡‰ç”¨åœ¨ App ä¸Šçš„ UILabel/UITextViewï¼Œå¦‚åŒå‰è¿°ä¸€å€‹ Label å°±éœ€è¦ 0.03 Secï¼Œåˆ—è¡¨*UILabel/UITextView ä¹˜ä¸‹ä¾†å°±æœƒå°ä½¿ç”¨è€…æ“ä½œæ‰‹æ„Ÿä¸Šç”¢ç”Ÿå¡é “ã€‚</p><h4 id="xmlparser"><span class="me-2">XMLParser</span><a href="#xmlparser" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç¬¬äºŒå€‹æ–¹æ¡ˆæ˜¯ <a href="/posts/zrealm-dev/ios-nsattributedstring-html-render-%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-%E8%A7%A3%E6%B1%BA%E9%96%83%E9%80%80%E8%88%87%E6%95%88%E8%83%BD%E7%93%B6%E9%A0%B8-a8c2d26cc734/">ä¸Šç¯‡æ–‡ç« </a> ä»‹ç´¹çš„ï¼Œä½¿ç”¨ XMLParser è§£ææˆå°æ‡‰çš„ NSAttributedString Key ä¸¦å¥—ç”¨æ¨£å¼ã€‚</p><p>å¯åƒè€ƒ <a href="https://github.com/malcommac/SwiftRichString" target="_blank">SwiftRichString</a> çš„å¯¦ç¾åŠ <a href="/posts/zrealm-dev/ios-nsattributedstring-html-render-%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-%E8%A7%A3%E6%B1%BA%E9%96%83%E9%80%80%E8%88%87%E6%95%88%E8%83%BD%E7%93%B6%E9%A0%B8-a8c2d26cc734/">ä¸Šä¸€ç¯‡æ–‡ç« å…§å®¹</a> ã€‚</p><blockquote><p>ä¸Šä¸€ç¯‡ä¹Ÿåªæ˜¯æ¢ç©¶å‡ºå¯ä»¥ä½¿ç”¨ XMLParser è§£æ HTML ä¸¦åšå°æ‡‰è½‰æ›ï¼Œç„¶å¾Œå®Œæˆå¯¦é©—æ€§çš„å¯¦ä½œï¼Œä½†ä¸¦æ²’æœ‰æŠŠå®ƒè¨­è¨ˆæˆä¸€å€‹æœ‰æ¶æ§‹å¥½æ“´å……çš„ã€Œå·¥å…·ã€ã€‚</p></blockquote><p><strong>æ­¤åšæ³•çš„å•é¡Œï¼š</strong></p><ul><li>å®¹éŒ¯ç‡ 0ï¼š <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> / <code class="language-plaintext highlighter-rouge">&lt;Congratulation!&gt;</code> / <code class="language-plaintext highlighter-rouge">&lt;b&gt;Bold&lt;i&gt;Bold+Italic&lt;/b&gt;Italic&lt;/i&gt;</code> ä»¥ä¸Šä¸‰ç¨® HTML æœ‰å¯èƒ½å‡ºç¾çš„æƒ…å¢ƒï¼Œåœ¨ XMLParser è§£æéƒ½æœƒå‡ºéŒ¯ç›´æ¥ Throw Error é¡¯ç¤ºç©ºç™½ã€‚<li>ä½¿ç”¨ XMLParserï¼ŒHTML å­—ä¸²å¿…é ˆå®Œå…¨ç¬¦åˆ XML è¦å‰‡ï¼Œç„¡æ³•åƒç€è¦½å™¨æˆ– NSAttributedString.DocumentType.html å®¹éŒ¯æ­£å¸¸é¡¯ç¤ºã€‚</ul><h4 id="ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š"><span class="me-2">ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š</span><a href="#ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä»¥ä¸Šå…©å€‹æ–¹æ¡ˆéƒ½ä¸èƒ½å®Œç¾å„ªé›…çš„è§£æ±º HTML å•é¡Œï¼Œæ–¼æ˜¯é–‹å§‹æœå°‹æœ‰ç„¡ç¾æˆçš„è§£æ±ºæ–¹æ¡ˆã€‚</p><ul><li><a href="https://github.com/johnxnguyen" target="_blank">johnxnguyen</a> / <a href="https://github.com/johnxnguyen/Down" target="_blank">Down</a> åªæ”¯æ´è¼¸å…¥ Markdown è½‰æ›æˆ Any (XML/NSAttributedStringâ€¦)ï¼Œä½†ä¸æ”¯æ´è¼¸å…¥ HTML è½‰æ›ã€‚<li><a href="https://github.com/malcommac" target="_blank">malcommac</a> / <a href="https://github.com/malcommac/SwiftRichString" target="_blank">SwiftRichString</a> åº•å±¤æ˜¯ä½¿ç”¨ XMLParserï¼Œå¯¦æ¸¬å‰è¿°æ¡ˆä¾‹ä¹Ÿæœƒæœ‰ä¸€æ¨£å®¹éŒ¯ç‡ 0 çš„å•é¡Œã€‚<li><a href="https://github.com/scinfu" target="_blank">scinfu</a> / <a href="https://github.com/scinfu/SwiftSoup" target="_blank">SwiftSoup</a> åªæ”¯æ´ HTML Parser(Selector) <a href="https://github.com/scinfu/SwiftSoup/issues/127" target="_blank">ä¸æ”¯æ´è½‰æ›æˆ NSAttributedString</a> ã€‚</ul><blockquote><p>æ‰¾äº†ä¸€å¤§åœˆçµæœéƒ½é¡ä¼¼ä¸Šæ–¹çš„å°ˆæ¡ˆ Orzï¼Œæ²’æœ‰å·¨äººçš„è‚©è†€å¯ä»¥ç«™ã€‚</p></blockquote><h3 id="zhgchglizmarkupparser"><span class="me-2">ZhgChgLi/ZMarkupParser</span><a href="#zhgchglizmarkupparser" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/602927147/57ce75c1-8548-449c-b44a-f4b0451ed5ea" alt="" loading="lazy"></a></p><p>æ²’æœ‰å·¨äººçš„è‚©è†€ï¼Œåªå¥½è‡ªå·±ç•¶å·¨äººäº†ï¼Œæ–¼æ˜¯è‡ªè¡Œé–‹ç™¼äº† HTML String to NSAttributedString å·¥å…·ã€‚</p><p>ä½¿ç”¨ç´” Swift é–‹ç™¼ï¼Œé€é Regex å‰–æå‡º HTML Tag ä¸¦ç¶“é Tokenizationï¼Œåˆ†æä¿®æ­£ Tag æ­£ç¢ºæ€§(ä¿®æ­£æ²’æœ‰ end çš„ tag &amp; éŒ¯ä½ tag)ï¼Œå†è½‰æ›æˆ abstract syntax treeï¼Œæœ€çµ‚ä½¿ç”¨ Visitor Pattern å°‡ HTML Tag èˆ‡æŠ½è±¡æ¨£å¼å°æ‡‰ï¼Œå¾—åˆ°æœ€çµ‚ NSAttributedString çµæœï¼›å…¶ä¸­ä¸ä¾è³´ä»»ä½• Parser Libã€‚</p><h4 id="ç‰¹è‰²"><span class="me-2">ç‰¹è‰²</span><a href="#ç‰¹è‰²" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>æ”¯æ´ HTML Render (to NSAttributedString) / Stripper (å‰é›¢ HTML Tag) / Selector åŠŸèƒ½<li>æ¯” <code class="language-plaintext highlighter-rouge">NSAttributedString.DocumentType.html</code> æ›´é«˜çš„æ•ˆèƒ½<li>è‡ªå‹•åˆ†æä¿®æ­£ Tag æ­£ç¢ºæ€§(ä¿®æ­£æ²’æœ‰ end çš„ tag &amp; éŒ¯ä½ tag)<li>æ”¯æ´å¾ <code class="language-plaintext highlighter-rouge">style=â€color:redâ€¦â€</code> å‹•æ…‹è¨­å®šæ¨£å¼<li>æ”¯æ´å®¢è£½åŒ–æ¨£å¼æŒ‡å®šï¼Œä¾‹å¦‚ç²—é«”è¦å¤š <strong>ç²—</strong><li>æ”¯æ´å½ˆæ€§å¯æ“´å……æ¨™ç±¤æˆ–è‡ªè¨‚æ¨™ç±¤åŠå±¬æ€§</ul><blockquote><p>è©³ç´°ä»‹ç´¹ã€å®‰è£ä½¿ç”¨å¯åƒè€ƒæ­¤ç¯‡æ–‡ç« ï¼šã€Œ <a href="/posts/zrealm-dev/zmarkupparser-swift-html-string-%E8%BD%89-nsattributedstring-%E5%B7%A5%E5%85%B7-%E6%94%AF%E6%8F%B4%E5%AE%A2%E8%A3%BD%E6%A8%A3%E5%BC%8F%E8%88%87%E9%AB%98%E6%95%88%E8%83%BD%E6%B8%B2%E6%9F%93-a5643de271e4/"><strong>ZMarkupParser HTML String è½‰æ› NSAttributedString å·¥å…·</strong></a> ã€</p></blockquote><p>å¯ç›´æ¥ <a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">git clone å°ˆæ¡ˆ</a> å¾Œï¼Œæ‰“é–‹ <code class="language-plaintext highlighter-rouge">ZMarkupParser.xcworkspace</code> Project é¸æ“‡ <code class="language-plaintext highlighter-rouge">ZMarkupParser-Demo</code> Target ç›´æ¥ Build &amp; Run èµ·ä¾†ç©ç©ã€‚</p><p><a href="/assets/2724f02f6e7/1*PzYcnSkW7qKeJBkaiNTKjQ.gif" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*PzYcnSkW7qKeJBkaiNTKjQ.gif" alt="[ZMarkupParser](https://github.com/ZhgChgLi/ZMarkupParser){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyOTUiIGhlaWdodD0iNjQwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">ZMarkupParser</a></p><h3 id="æŠ€è¡“ç´°ç¯€"><span class="me-2">æŠ€è¡“ç´°ç¯€</span><a href="#æŠ€è¡“ç´°ç¯€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å†ä¾†æ‰æ˜¯æœ¬ç¯‡æ–‡ç« æƒ³åˆ†äº«çš„ï¼Œé—œæ–¼é–‹ç™¼é€™å€‹å·¥å…·ä¸Šçš„æŠ€è¡“ç´°ç¯€ã€‚</p><p><a href="/assets/2724f02f6e7/1*YF5L7gefMCMwU1wmnGgy6A.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*YF5L7gefMCMwU1wmnGgy6A.webp" alt="é‹ä½œæµç¨‹ç¸½è¦½" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹ä½œæµç¨‹ç¸½è¦½</p><p>ä¸Šåœ–ç‚ºå¤§æ¦‚çš„é‹ä½œæµç¨‹ï¼Œå¾Œé¢æ–‡ç« æœƒä¸€æ­¥ä¸€æ­¥ä»‹ç´¹åŠé™„ä¸Šç¨‹å¼ç¢¼ã€‚</p><blockquote><p>âš ï¸ï¸ï¸ï¸ï¸ï¸ æœ¬æ–‡æœƒç›¡é‡ç°¡åŒ– Demo Codeã€æ¸›å°‘æŠ½è±¡è·Ÿæ•ˆèƒ½è€ƒé‡ï¼Œç›¡é‡æŠŠé‡å¿ƒæ”¾åœ¨è§£é‡‹é‹ä½œåŸç†ä¸Šï¼›å¦‚éœ€äº†è§£æœ€çµ‚çµæœè«‹åƒè€ƒå°ˆæ¡ˆ <a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">Source Code</a> ã€‚</p></blockquote><h3 id="ç¨‹å¼ç¢¼åŒ–--tokenization"><span class="me-2">ç¨‹å¼ç¢¼åŒ– â€” Tokenization</span><a href="#ç¨‹å¼ç¢¼åŒ–--tokenization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>a.k.a parser, è§£æ</p></blockquote><p>è«‡åˆ° HTML æ¸²æŸ“æœ€é‡è¦çš„å°±æ˜¯è§£æçš„ç’°ç¯€ï¼Œä»¥å¾€æ˜¯é€é XMLParser å°‡ HTML åšç‚º XML è§£æï¼›ä½†æ˜¯ç„¡æ³•å…‹æœ HTML æ—¥å¸¸ç”¨æ³•ä¸¦ä¸æ˜¯ 100% çš„ XML æœƒé€ æˆè§£æå™¨éŒ¯èª¤ï¼Œä¸”ç„¡æ³•å‹•æ…‹ä¿®æ­£ã€‚</p><p>æ’é™¤æ‰ä½¿ç”¨ XMLParser é€™æ¢è·¯ä¹‹å¾Œï¼Œåœ¨ Swift ä¸Šç•™çµ¦æˆ‘å€‘çš„å°±åªå‰©ä½¿ç”¨ Regex æ­£å‰‡ä¾†åšåŒ¹é…è§£æäº†ã€‚</p><p>æœ€ä¸€é–‹å§‹æ²’æƒ³å¤ªå¤šï¼Œæƒ³èªªå¯ä»¥ç›´æ¥ç”¨æ­£å‰‡æŒ–å‡ºã€Œæˆå°ã€çš„ HTML Tagï¼Œå†éè¿´å¾€è£¡é¢ä¸€å±¤ä¸€å±¤æ‰¾ HTML Tagï¼Œç›´åˆ°çµæŸï¼›ä½†æ˜¯é€™æ¨£æ²’æœ‰è¾¦æ³•è§£æ±º HTML Tag å¯ä»¥åµŒå¥—ï¼Œæˆ–æƒ³æ”¯æ´éŒ¯ä½å®¹éŒ¯çš„å•é¡Œï¼Œå› æ­¤æˆ‘å€‘æŠŠç­–ç•¥æ”¹æˆæŒ–æˆå‡ºã€Œå–®å€‹ã€ HTML Tagï¼Œä¸¦è¨˜éŒ„æ˜¯ Start Tag, Close Tag or Self-Closing Tagï¼ŒåŠå…¶ä»–å­—ä¸²çµ„åˆæˆè§£æçµæœé™£åˆ—ã€‚</p><p><strong>Tokenization çµæ§‹å¦‚ä¸‹ï¼š</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">HTMLParsedResult</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">start</span><span class="p">(</span><span class="kt">StartItem</span><span class="p">)</span> <span class="c1">// &lt;a&gt;</span>
    <span class="k">case</span> <span class="nf">close</span><span class="p">(</span><span class="kt">CloseItem</span><span class="p">)</span> <span class="c1">// &lt;/a&gt;</span>
    <span class="k">case</span> <span class="nf">selfClosing</span><span class="p">(</span><span class="kt">SelfClosingItem</span><span class="p">)</span> <span class="c1">// &lt;br/&gt;</span>
    <span class="k">case</span> <span class="nf">rawString</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HTMLParsedResult</span> <span class="p">{</span>
    <span class="kd">class</span> <span class="kt">SelfClosingItem</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span>
        <span class="k">let</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">String</span><span class="p">]?)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tagName</span> <span class="o">=</span> <span class="n">tagName</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tagAttributedString</span> <span class="o">=</span> <span class="n">tagAttributedString</span>
            <span class="k">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">class</span> <span class="kt">StartItem</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span>
        <span class="k">let</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span>

        <span class="c1">// Start Tag æœ‰å¯èƒ½æ˜¯ç•°å¸¸ HTML Tag ä¹Ÿæœ‰å¯èƒ½æ˜¯æ­£å¸¸æ–‡å­— e.g. &lt;Congratulation!&gt;, å¾ŒçºŒ Normalization å¾Œå¦‚æœç™¼ç¾æ˜¯å­¤ç«‹ Start Tag å‰‡æ¨™è¨˜ç‚º Trueã€‚</span>
        <span class="k">var</span> <span class="nv">isIsolated</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">String</span><span class="p">]?)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tagName</span> <span class="o">=</span> <span class="n">tagName</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tagAttributedString</span> <span class="o">=</span> <span class="n">tagAttributedString</span>
            <span class="k">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="p">}</span>
        
        <span class="c1">// å¾ŒçºŒ Normalization è‡ªå‹•è£œä½ä¿®æ­£ä½¿ç”¨</span>
        <span class="kd">func</span> <span class="nf">convertToCloseParsedItem</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CloseItem</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">CloseItem</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// å¾ŒçºŒ Normalization è‡ªå‹•è£œä½ä¿®æ­£ä½¿ç”¨</span>
        <span class="kd">func</span> <span class="nf">convertToSelfClosingParsedItem</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">SelfClosingItem</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">SelfClosingItem</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">tagName</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">tagAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">class</span> <span class="kt">CloseItem</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span>
        <span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tagName</span> <span class="o">=</span> <span class="n">tagName</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>ä½¿ç”¨çš„æ­£å‰‡å¦‚ä¸‹ï¼š</strong></p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="p">(</span><span class="sc">?:</span><span class="p">(?</span><span class="o">&lt;</span><span class="n">closeTag</span><span class="o">&gt;</span><span class="p">\</span><span class="sr">/)?(?&lt;tagName&gt;[A-Za-z0-9]+)(?&lt;tagAttributes&gt;(?:\s*(\w+)\s*=\s*(["|']).*?\5)*)\s*(?&lt;selfClosingTag&gt;\/)?&gt;)
</span></pre></table></code></div></div><p>-&gt; <a href="https://regex101.com/r/aBrID8/1" target="_blank">Online Regex101 Playground</a></p><ul><li>closeTag: åŒ¹é… &lt; <code class="language-plaintext highlighter-rouge">/</code> a&gt;<li>tagName: åŒ¹é… &lt; <code class="language-plaintext highlighter-rouge">a</code> &gt; or , &lt;/ <code class="language-plaintext highlighter-rouge">a</code> &gt;<li>tagAttributes: åŒ¹é… &lt;a <code class="language-plaintext highlighter-rouge">href=â€https://zhgchg.liâ€ style=â€color:redâ€</code> &gt;<li>selfClosingTag: åŒ¹é… &lt;br <code class="language-plaintext highlighter-rouge">/</code> &gt;</ul><blockquote><p>*æ­¤æ­£å‰‡é‚„å¯ä»¥å†å„ªåŒ–ï¼Œä¹‹å¾Œå†ä¾†åš</p></blockquote><blockquote><p>æ–‡ç« å¾ŒåŠæ®µæœ‰æä¾›é—œæ–¼æ­£å‰‡çš„é™„åŠ è³‡æ–™ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥åƒè€ƒã€‚</p></blockquote><p><strong>çµ„åˆèµ·ä¾†å°±æ˜¯ï¼š</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">tokenizationResult</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLParsedResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">let</span> <span class="nv">expression</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">NSRegularExpression</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">pattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">expressionOptions</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"&lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">totalLength</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">utf16</span><span class="o">.</span><span class="n">count</span> <span class="c1">// utf-16 support emoji</span>
<span class="k">var</span> <span class="nv">lastMatch</span><span class="p">:</span> <span class="kt">NSTextCheckingResult</span><span class="p">?</span>

<span class="c1">// Start Tags Stack, å…ˆé€²å¾Œå‡º(FILO First In Last Out)</span>
<span class="c1">// æª¢æ¸¬ HTML å­—ä¸²æ˜¯å¦éœ€è¦å¾ŒçºŒ Normalization ä¿®æ­£éŒ¯ä½æˆ–è£œ Self-Closing Tag</span>
<span class="k">var</span> <span class="nv">stackStartItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="kt">StartItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">var</span> <span class="nv">needForamatter</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">expression</span><span class="o">.</span><span class="nf">enumerateMatches</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">totoalLength</span><span class="p">))</span> <span class="p">{</span> <span class="n">match</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">match</span> <span class="o">=</span> <span class="n">match</span> <span class="p">{</span>
    <span class="c1">// æª¢æŸ¥ Tag ä¹‹é–“æˆ–æ˜¯åˆ°ç¬¬ä¸€å€‹ Tag ä¹‹é–“çš„å­—ä¸²</span>
    <span class="c1">// e.g. Test&lt;a&gt;Link&lt;/a&gt;zzz&lt;b&gt;bold&lt;/b&gt;Test2 - &gt; Test,zzz</span>
    <span class="k">let</span> <span class="nv">lastMatchEnd</span> <span class="o">=</span> <span class="n">lastMatch</span><span class="p">?</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">upperBound</span> <span class="p">??</span> <span class="mi">0</span>
    <span class="k">let</span> <span class="nv">currentMatchStart</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">lowerBound</span>
    <span class="k">if</span> <span class="n">currentMatchStart</span> <span class="o">&gt;</span> <span class="n">lastMatchEnd</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">rawStringBetweenTag</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="n">lastMatchEnd</span><span class="p">,</span> <span class="p">(</span><span class="n">currentMatchStart</span> <span class="o">-</span> <span class="n">lastMatchEnd</span><span class="p">)))</span>
      <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="n">rawStringBetweenTag</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c1">// &lt;a href="https://zhgchg.li"&gt;, &lt;/a&gt;</span>
    <span class="k">let</span> <span class="nv">matchAttributedString</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>
    <span class="c1">// a, a</span>
    <span class="k">let</span> <span class="nv">matchTag</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"tagName"</span><span class="p">))?</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span><span class="o">.</span><span class="nf">lowercased</span><span class="p">()</span>
    <span class="c1">// false, true</span>
    <span class="k">let</span> <span class="nv">matchIsEndTag</span> <span class="o">=</span> <span class="n">matchResult</span><span class="o">.</span><span class="nf">attributedString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"closeTag"</span><span class="p">))?</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span> <span class="o">==</span> <span class="s">"/"</span>
    <span class="c1">// href="https://zhgchg.li", nil</span>
    <span class="c1">// ç”¨æ­£å‰‡å†æ‹†å‡º HTML Attribute, to [String: String], è«‹åƒè€ƒ Source Code</span>
    <span class="k">let</span> <span class="nv">matchTagAttributes</span> <span class="o">=</span> <span class="nf">parseAttributes</span><span class="p">(</span><span class="n">matchResult</span><span class="o">.</span><span class="nf">attributedString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"tagAttributes"</span><span class="p">)))</span>
    <span class="c1">// false, false</span>
    <span class="k">let</span> <span class="nv">matchIsSelfClosingTag</span> <span class="o">=</span> <span class="n">matchResult</span><span class="o">.</span><span class="nf">attributedString</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"selfClosingTag"</span><span class="p">))?</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span> <span class="o">==</span> <span class="s">"/"</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nv">matchAttributedString</span> <span class="o">=</span> <span class="n">matchAttributedString</span><span class="p">,</span>
       <span class="k">let</span> <span class="nv">matchTag</span> <span class="o">=</span> <span class="n">matchTag</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">matchIsSelfClosingTag</span> <span class="p">{</span>
          <span class="c1">// e.g. &lt;br/&gt;</span>
          <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">selfClosing</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">matchTag</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="n">matchAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="n">matchTagAttributes</span><span class="p">)))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// e.g. &lt;a&gt; or &lt;/a&gt;</span>
          <span class="k">if</span> <span class="n">matchIsEndTag</span> <span class="p">{</span>
            <span class="c1">// e.g. &lt;/a&gt;</span>
            <span class="c1">// å¾ Stack å–å‡ºå‡ºç¾ç›¸åŒ TagName çš„ä½ç½®ï¼Œå¾æœ€å¾Œé–‹å§‹</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">stackStartItems</span><span class="o">.</span><span class="nf">lastIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">tagName</span> <span class="o">==</span> <span class="n">matchTag</span> <span class="p">})</span> <span class="p">{</span>
              <span class="c1">// å¦‚æœä¸æ˜¯æœ€å¾Œä¸€å€‹ï¼Œä»£è¡¨æœ‰éŒ¯ä½æˆ–éºæ¼é—œé–‰çš„ Tag</span>
              <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">stackStartItems</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                  <span class="n">needForamatter</span> <span class="o">=</span> <span class="kc">true</span>
              <span class="p">}</span>
              <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">close</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">matchTag</span><span class="p">)))</span>
              <span class="n">stackStartItems</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="c1">// å¤šé¤˜çš„ close tag e.g &lt;/a&gt;</span>
              <span class="c1">// ä¸å½±éŸ¿å¾ŒçºŒï¼Œç›´æ¥å¿½ç•¥</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// e.g. &lt;a&gt;</span>
            <span class="k">let</span> <span class="nv">startItem</span><span class="p">:</span> <span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="kt">StartItem</span> <span class="o">=</span> <span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="kt">StartItem</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">matchTag</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="n">matchAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="n">matchTagAttributes</span><span class="p">)</span>
            <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="n">startItem</span><span class="p">))</span>
            <span class="c1">// å¡åˆ° Stack</span>
            <span class="n">stackStartItems</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">startItem</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>

    <span class="n">lastMatch</span> <span class="o">=</span> <span class="n">match</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// æª¢æŸ¥çµå°¾çš„ RawString</span>
<span class="c1">// e.g. Test&lt;a&gt;Link&lt;/a&gt;Test2 - &gt; Test2</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">lastMatch</span> <span class="o">=</span> <span class="n">lastMatch</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">currentIndex</span> <span class="o">=</span> <span class="n">lastMatch</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">upperBound</span>
  <span class="k">if</span> <span class="n">totoalLength</span> <span class="o">&gt;</span> <span class="n">currentIndex</span> <span class="p">{</span>
    <span class="c1">// é‚„æœ‰å‰©é¤˜å­—ä¸²</span>
    <span class="k">let</span> <span class="nv">resetString</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="n">currentIndex</span><span class="p">,</span> <span class="p">(</span><span class="n">totoalLength</span> <span class="o">-</span> <span class="n">currentIndex</span><span class="p">)))</span>
    <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="n">resetString</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// lastMatch = nil, ä»£è¡¨æ²’æ‰¾åˆ°ä»»ä½•æ¨™ç±¤ï¼Œå…¨éƒ½æ˜¯ç´”æ–‡å­—</span>
  <span class="k">let</span> <span class="nv">resetString</span> <span class="o">=</span> <span class="n">attributedString</span><span class="o">.</span><span class="nf">attributedSubstring</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">totoalLength</span><span class="p">))</span>
  <span class="n">tokenizationResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="n">resetString</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// æª¢æŸ¥ Stack æ˜¯å¦å·²ç¶“æ¸…ç©ºï¼Œå¦‚æœé‚„æœ‰ä»£è¡¨æœ‰ Start Tag æ²’æœ‰å°æ‡‰çš„ End</span>
<span class="c1">// æ¨™è¨˜æˆå­¤ç«‹ Start Tag</span>
<span class="k">for</span> <span class="n">stackStartItem</span> <span class="k">in</span> <span class="n">stackStartItems</span> <span class="p">{</span>
  <span class="n">stackStartItem</span><span class="o">.</span><span class="n">isIsolated</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="n">needForamatter</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">tokenizationResult</span><span class="p">)</span>
<span class="c1">// [</span>
<span class="c1">//    .start("a",["href":"https://zhgchg.li"])</span>
<span class="c1">//    .rawString("Li")</span>
<span class="c1">//    .start("b",nil)</span>
<span class="c1">//    .rawString("nk")</span>
<span class="c1">//    .close("a")</span>
<span class="c1">//    .rawString("Bold")</span>
<span class="c1">//    .close("b")</span>
<span class="c1">// ]</span>
</pre></table></code></div></div><p><a href="/assets/2724f02f6e7/1*U50CX56M_xy1EXZKb69YeA.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*U50CX56M_xy1EXZKb69YeA.webp" alt="é‹ä½œæµç¨‹å¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjcyNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹ä½œæµç¨‹å¦‚ä¸Šåœ–</p><p>æœ€çµ‚æœƒå¾—åˆ°ä¸€å€‹ Tokenization çµæœé™£åˆ—ã€‚</p><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLStringToParsedResultProcessor.swift" target="_blank">HTMLStringToParsedResultProcessor.swift</a> å¯¦ä½œ</p></blockquote><h3 id="æ¨™æº–åŒ–--normalization"><span class="me-2">æ¨™æº–åŒ– â€” Normalization</span><a href="#æ¨™æº–åŒ–--normalization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>a.k.a Formatter, æ­£è¦åŒ–</p></blockquote><p>ç¹¼ä¸Šä¸€æ­¥å–å¾—åˆæ­¥è§£æçµæœå¾Œï¼Œè§£æä¸­å¦‚æœç™¼ç¾é‚„éœ€è¦ Normalizationï¼Œå‰‡éœ€è¦æ­¤æ­¥é©Ÿï¼Œè‡ªå‹•ä¿®æ­£ HTML Tag å•é¡Œã€‚</p><p><strong>HTML Tag å•é¡Œæœ‰ä»¥ä¸‹ä¸‰ç¨®ï¼š</strong></p><ul><li>HTML Tag ä½†éºæ¼ Close Tag: ä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code><li>ä¸€èˆ¬æ–‡å­—è¢«ç•¶æˆ HTML Tag: ä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">&lt;Congratulation!&gt;</code><li>HTML Tag å­˜åœ¨éŒ¯ä½å•é¡Œ: ä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">&lt;a&gt;Li&lt;b&gt;nk&lt;/a&gt;Bold&lt;/b&gt;</code></ul><p>ä¿®æ­£æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œæˆ‘å€‘éœ€è¦éæ­· Tokenization çµæœçš„å…ƒç´ ï¼Œå˜—è©¦è£œé½Šç¼ºæ¼ã€‚</p><p><a href="/assets/2724f02f6e7/1*Wk-U_sQuvLo1OJhcE1BQPQ.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*Wk-U_sQuvLo1OJhcE1BQPQ.webp" alt="é‹ä½œæµç¨‹å¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjMzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹ä½œæµç¨‹å¦‚ä¸Šåœ–</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">normalizationResult</span> <span class="o">=</span> <span class="n">tokenizationResult</span>

<span class="c1">// Start Tags Stack, å…ˆé€²å¾Œå‡º(FILO First In Last Out)</span>
<span class="k">var</span> <span class="nv">stackExpectedStartItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="kt">StartItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">var</span> <span class="nv">itemIndex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">itemIndex</span> <span class="o">&lt;</span> <span class="n">newItems</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">newItems</span><span class="p">[</span><span class="n">itemIndex</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="k">let</span> <span class="nv">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isIsolated</span> <span class="p">{</span>
            <span class="c1">// å¦‚æœç‚ºå­¤ç«‹ Start Tag</span>
            <span class="k">if</span> <span class="kt">WC3HTMLTagName</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">attributes</span><span class="p">?</span><span class="o">.</span><span class="n">isEmpty</span> <span class="p">??</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// å¦‚æœä¸æ˜¯ WCS å®šç¾©çš„ HTML Tag &amp; æ²’æœ‰ä»»ä½• HTML Attribute</span>
                <span class="c1">// WC3HTMLTagName Enum å¯åƒè€ƒ Source Code</span>
                <span class="c1">// åˆ¤å®šç‚º ä¸€èˆ¬æ–‡å­—è¢«ç•¶æˆ HTML Tag</span>
                <span class="c1">// æ”¹æˆ raw string type</span>
                <span class="n">normalizationResult</span><span class="p">[</span><span class="n">itemIndex</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tagAttributedString</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// å¦å‰‡ï¼Œæ”¹æˆ self-closing tag, e.g. &lt;br&gt; -&gt; &lt;br/&gt;</span>
                <span class="n">normalizationResult</span><span class="p">[</span><span class="n">itemIndex</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">selfClosing</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="nf">convertToSelfClosingParsedItem</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="n">itemIndex</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// æ­£å¸¸ Start Tag, åŠ å…¥ Stack</span>
            <span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">itemIndex</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">close</span><span class="p">(</span><span class="k">let</span> <span class="nv">item</span><span class="p">):</span>
        <span class="c1">// é‡åˆ° Close Tag</span>
        <span class="c1">// å–å¾— Start Stack Tag åˆ°æ­¤ Close Tag ä¸­é–“éš”çš„ Tags</span>
        <span class="c1">// e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; é–“éš” 0</span>
        <span class="c1">// e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt; é–“éš” b,u</span>

        <span class="k">let</span> <span class="nv">reversedStackExpectedStartItems</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="nf">reversed</span><span class="p">())</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">reversedStackExpectedStartItemsOccurredIndex</span> <span class="o">=</span> <span class="n">reversedStackExpectedStartItems</span><span class="o">.</span><span class="nf">firstIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">tagName</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">tagName</span> <span class="p">})</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">itemIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        
        <span class="k">let</span> <span class="nv">reversedStackExpectedStartItemsOccurred</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">reversedStackExpectedStartItems</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="nv">upTo</span><span class="p">:</span> <span class="n">reversedStackExpectedStartItemsOccurredIndex</span><span class="p">))</span>
        
        <span class="c1">// é–“éš” 0, ä»£è¡¨ tag æ²’éŒ¯ä½</span>
        <span class="k">guard</span> <span class="n">reversedStackExpectedStartItemsOccurred</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// is pair, pop</span>
            <span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="nf">removeLast</span><span class="p">()</span>
            <span class="n">itemIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        
        <span class="c1">// æœ‰å…¶ä»–é–“éš”ï¼Œè‡ªå‹•åœ¨å‰å€™è£œæœŸé–“æ ¼ Tag</span>
        <span class="c1">// e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/a&gt;&lt;/u&gt;&lt;/b&gt; -&gt;</span>
        <span class="c1">// e.g &lt;a&gt;&lt;u&gt;&lt;b&gt;[CurrentIndex]&lt;/b&gt;&lt;/u&gt;&lt;/a&gt;&lt;b&gt;&lt;/u&gt;&lt;/u&gt;&lt;/b&gt;</span>
        <span class="k">let</span> <span class="nv">stackExpectedStartItemsOccurred</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">reversedStackExpectedStartItemsOccurred</span><span class="o">.</span><span class="nf">reversed</span><span class="p">())</span>
        <span class="k">let</span> <span class="nv">afterItems</span> <span class="o">=</span> <span class="n">stackExpectedStartItemsOccurred</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="k">let</span> <span class="nv">beforeItems</span> <span class="o">=</span> <span class="n">reversedStackExpectedStartItemsOccurred</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="nf">close</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="nf">convertToCloseParsedItem</span><span class="p">())</span> <span class="p">})</span>
        <span class="n">normalizationResult</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">afterItems</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">newItems</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">itemIndex</span><span class="p">))</span>
        <span class="n">normalizationResult</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">beforeItems</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">itemIndex</span><span class="p">)</span>
        
        <span class="n">itemIndex</span> <span class="o">=</span> <span class="n">newItems</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">itemIndex</span><span class="p">)</span> <span class="o">+</span> <span class="n">stackExpectedStartItemsOccurred</span><span class="o">.</span><span class="n">count</span>
        
        <span class="c1">// æ›´æ–° Start Stack Tags</span>
        <span class="c1">// e.g. -&gt; b,u</span>
        <span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="n">removeAll</span> <span class="p">{</span> <span class="n">startItem</span> <span class="k">in</span>
            <span class="k">return</span> <span class="n">reversedStackExpectedStartItems</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="nv">through</span><span class="p">:</span> <span class="n">reversedStackExpectedStartItemsOccurredIndex</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">===</span> <span class="n">startItem</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="n">selfClosing</span><span class="p">,</span> <span class="o">.</span><span class="nv">rawString</span><span class="p">:</span>
        <span class="n">itemIndex</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">normalizationResult</span><span class="p">)</span>
<span class="c1">// [</span>
<span class="c1">//    .start("a",["href":"https://zhgchg.li"])</span>
<span class="c1">//    .rawString("Li")</span>
<span class="c1">//    .start("b",nil)</span>
<span class="c1">//    .rawString("nk")</span>
<span class="c1">//    .close("b")</span>
<span class="c1">//    .close("a")</span>
<span class="c1">//    .start("b",nil)</span>
<span class="c1">//    .rawString("Bold")</span>
<span class="c1">//    .close("b")</span>
<span class="c1">// ]</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLParsedResultFormatterProcessor.swift" target="_blank">HTMLParsedResultFormatterProcessor.swift</a> å¯¦ä½œ</p></blockquote><h3 id="abstract-syntax-tree"><span class="me-2">Abstract Syntax Tree</span><a href="#abstract-syntax-tree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>a.k.a AST, æŠ½è±¡æ¨¹</p></blockquote><p>ç¶“é Tokenization &amp; Normalization è³‡æ–™é è™•ç†å®Œæˆå¾Œï¼Œå†ä¾†è¦å°‡çµæœè½‰æ›æˆæŠ½è±¡æ¨¹ğŸŒ²ã€‚</p><p><a href="/assets/2724f02f6e7/1*40z0o7R0OROURWCQVDmKrw.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*40z0o7R0OROURWCQVDmKrw.webp" alt="å¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDI4IiBoZWlnaHQ9IjU4NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>å¦‚ä¸Šåœ–</p><p>è½‰æ›æˆæŠ½è±¡æ¨¹å¯ä»¥æ–¹ä¾¿æˆ‘å€‘æ—¥å¾Œçš„æ“ä½œåŠæ“´å……ï¼Œä¾‹å¦‚å¯¦ç¾ Selector åŠŸèƒ½æˆ–æ˜¯åšå…¶ä»–è½‰æ›ï¼Œä¾‹å¦‚ HTML To Markdownï¼›äº¦æˆ–æ˜¯æ—¥å¾Œæƒ³å¢åŠ  Markdown to NSAttributedStringï¼Œåªéœ€å¯¦ç¾ Markdown çš„ Tokenization &amp; Normalization å°±èƒ½å®Œæˆã€‚</p><p><strong>é¦–å…ˆæˆ‘å€‘å®šç¾©ä¸€å€‹ Markup Protocolï¼Œæœ‰ Child &amp; Parent å±¬æ€§ï¼Œç´€éŒ„è‘‰å­è·Ÿæ¨¹æçš„è³‡è¨Š:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">Markup</span><span class="p">:</span> <span class="kt">AnyObject</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">appendChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">prependChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span>
    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="p">:</span> <span class="kt">MarkupVisitor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">appendChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">childMarkups</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">prependChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">childMarkups</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>å¦å¤–æ­é…ä½¿ç”¨ <a href="/posts/zrealm-dev/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%87%89%E7%94%A8-%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E5%AF%A6%E5%8B%99%E8%A7%A3%E6%9E%90%E8%88%87%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%A7%8B%E5%84%AA%E5%8C%96-ba5773a7bfea/">Visitor Pattern</a> ï¼Œå°‡æ¯ç¨®æ¨£å¼å±¬æ€§éƒ½å®šç¾©æˆä¸€å€‹ç‰©ä»¶ Elementï¼Œå†é€éä¸åŒçš„ Visit ç­–ç•¥å–å¾—å€‹åˆ¥çš„å¥—ç”¨çµæœã€‚</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Result</span>
        
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">RootMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">RawStringMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">BoldMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">LinkMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>åŸºæœ¬ Markup ç¯€é»ï¼š</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c1">// æ ¹ç¯€é»</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">RootMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// è‘‰ç¯€é»</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">RawStringMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">attributedString</span> <span class="o">=</span> <span class="n">attributedString</span>
    <span class="p">}</span>
    
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>å®šç¾© Markup æ¨£å¼ç¯€é»ï¼š</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">// æ¨¹æç¯€é»:</span>

<span class="c1">// é€£çµæ¨£å¼</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">LinkMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ç²—é«”æ¨£å¼</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">BoldMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/tree/main/Sources/ZMarkupParser/Core/Markup" target="_blank">Markup</a> å¯¦ä½œ</p></blockquote><p>è½‰æ›æˆæŠ½è±¡æ¨¹ä¹‹å‰æˆ‘å€‘é‚„éœ€è¦â€¦</p><h4 id="markupcomponent"><span class="me-2">MarkupComponent</span><a href="#markupcomponent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>å› ç‚ºæˆ‘å€‘çš„æ¨¹çµæ§‹ä¸èˆ‡ä»»ä½•è³‡æ–™çµæ§‹æœ‰ä¾è³´(ä¾‹å¦‚ a ç¯€é»/LinkMarkupï¼Œæ‡‰è©²è¦æœ‰ url è³‡è¨Šæ‰èƒ½åšå¾ŒçºŒ Render)ã€‚</strong> <strong>å°æ­¤æˆ‘å€‘å¦å¤–å®šç¾©ä¸€å€‹å®¹å™¨å­˜æ”¾æ¨¹ç¯€é»èˆ‡ç¯€é»ç›¸é—œçš„è³‡æ–™è³‡è¨Š:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">MarkupComponent</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">T</span>
    <span class="k">var</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">T</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Sequence</span> <span class="k">where</span> <span class="kt">Iterator</span><span class="o">.</span><span class="kt">Element</span><span class="p">:</span> <span class="kt">MarkupComponent</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Element</span><span class="o">.</span><span class="kt">T</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">first</span><span class="p">(</span><span class="nv">where</span><span class="p">:{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">markup</span> <span class="o">===</span> <span class="n">markup</span> <span class="p">})?</span><span class="o">.</span><span class="n">value</span> <span class="k">as?</span> <span class="kt">Element</span><span class="o">.</span><span class="kt">T</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/tree/main/Sources/ZMarkupParser/Core/MarkupComponent" target="_blank">MarkupComponent</a> å¯¦ä½œ</p></blockquote><p>ä¹Ÿå¯å°‡ Markup å®£å‘Š <code class="language-plaintext highlighter-rouge">Hashable</code> ï¼Œç›´æ¥ä½¿ç”¨ Dictionary å­˜æ”¾å€¼ <code class="language-plaintext highlighter-rouge">[Markup: Any]</code> ï¼Œä½†æ˜¯é€™æ¨£ Markup å°±ä¸èƒ½è¢«ç•¶ä¸€èˆ¬ type ä½¿ç”¨ï¼Œè¦åŠ ä¸Š <code class="language-plaintext highlighter-rouge">any Markup</code> ã€‚</p><h4 id="htmltag--htmltagname--htmltagnamevisitor"><span class="me-2">HTMLTag &amp; HTMLTagName &amp; HTMLTagNameVisitor</span><a href="#htmltag--htmltagname--htmltagnamevisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>HTML Tag Name éƒ¨åˆ†æˆ‘å€‘ä¹Ÿåšäº†ä¸€å±¤çš„æŠ½è±¡ï¼Œè®“ä½¿ç”¨è€…èƒ½è‡ªè¡Œæ±ºå®šæœ‰å“ªäº› Tag éœ€è¦è¢«è™•ç†ï¼Œä¹Ÿèƒ½æ–¹ä¾¿æ—¥å¾Œçš„æ“´å……ï¼Œä¾‹å¦‚: <code class="language-plaintext highlighter-rouge">&lt;strong&gt;</code> Tag Name åŒæ¨£å¯å°æ‡‰åˆ° <code class="language-plaintext highlighter-rouge">BoldMarkup</code> ã€‚</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>public protocol HTMLTagName {
    var string: String { get }
    func accept&lt;V: HTMLTagNameVisitor&gt;(_ visitor: V) -&gt; V.Result
}

public struct A_HTMLTagName: HTMLTagName {
    public let string: String = WC3HTMLTagName.a.rawValue
    
    public init() {
        
    }
    
    public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor {
        return visitor.visit(self)
    }
}

public struct B_HTMLTagName: HTMLTagName {
    public let string: String = WC3HTMLTagName.b.rawValue
    
    public init() {
        
    }
    
    public func accept&lt;V&gt;(_ visitor: V) -&gt; V.Result where V : HTMLTagNameVisitor {
        return visitor.visit(self)
    }
}
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/HTMLTag/HTMLTagNameVisitor.swift" target="_blank">HTMLTagNameVisitor</a> å¯¦ä½œ</p></blockquote><blockquote><p>å¦å¤–åƒè€ƒ W3C wiki åˆ—èˆ‰äº† HTML tag name enum: <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/HTMLTag/WC3HTMLTagName.swift" target="_blank">WC3HTMLTagName.swift</a></p></blockquote><p><strong>HTMLTag å‰‡æ˜¯å–®ç´”ä¸€å€‹å®¹å™¨ç‰©ä»¶ï¼Œå› ç‚ºæˆ‘å€‘å¸Œæœ›èƒ½è®“å¤–éƒ¨æŒ‡å®š HTML Tag å°æ‡‰åˆ°çš„æ¨£å¼ï¼Œæ‰€ä»¥å®£å‘Šä¸€å€‹å®¹å™¨æ”¾åœ¨ä¸€èµ·:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">HTMLTag</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">HTMLTagName</span>
    <span class="k">let</span> <span class="nv">customStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="c1">// å¾Œé¢ä»‹ç´¹ Render æœƒè§£é‡‹</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">HTMLTagName</span><span class="p">,</span> <span class="nv">customStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">tagName</span> <span class="o">=</span> <span class="n">tagName</span>
        <span class="k">self</span><span class="o">.</span><span class="n">customStyle</span> <span class="o">=</span> <span class="n">customStyle</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/HTMLTag/HTMLTag.swift3" target="_blank">HTMLTag</a> å¯¦ä½œ</p></blockquote><h4 id="htmltagnametohtmlmarkupvisitor"><span class="me-2">HTMLTagNameToHTMLMarkupVisitor</span><a href="#htmltagnametohtmlmarkupvisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">HTMLTagNameToMarkupVisitor</span><span class="p">:</span> <span class="kt">HTMLTagNameVisitor</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Result</span> <span class="o">=</span> <span class="kt">Markup</span>
    
    <span class="k">let</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">A_HTMLTagName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">LinkMarkup</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">tagName</span><span class="p">:</span> <span class="kt">B_HTMLTagName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">BoldMarkup</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLTagNameToHTMLMarkupVisitor.swift" target="_blank">HTMLTagNameToHTMLMarkupVisitor</a> å¯¦ä½œ</p></blockquote><h4 id="è½‰æ›æˆæŠ½è±¡æ¨¹-with-html-è³‡æ–™"><span class="me-2">è½‰æ›æˆæŠ½è±¡æ¨¹ with HTML è³‡æ–™</span><a href="#è½‰æ›æˆæŠ½è±¡æ¨¹-with-html-è³‡æ–™" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æˆ‘å€‘è¦å°‡ Normalization å¾Œçš„ HTML è³‡æ–™çµæœè½‰æ›æˆæŠ½è±¡æ¨¹ï¼Œé¦–å…ˆå®£å‘Šä¸€å€‹èƒ½å­˜æ”¾ HTML è³‡æ–™çš„ MarkupComponent è³‡æ–™çµæ§‹:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">HTMLElementMarkupComponent</span><span class="p">:</span> <span class="kt">MarkupComponent</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="kt">HTMLElement</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">tag</span><span class="p">:</span> <span class="kt">HTMLTag</span>
        <span class="k">let</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span>
        <span class="k">let</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span>
    <span class="p">}</span>
    
    <span class="kd">typealias</span> <span class="kt">T</span> <span class="o">=</span> <span class="kt">HTMLElement</span>
    
    <span class="k">let</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">HTMLElement</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="k">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>è½‰æ›æˆ Markup æŠ½è±¡æ¨¹:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">htmlElementComponents</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLElementMarkupComponent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">let</span> <span class="nv">rootMarkup</span> <span class="o">=</span> <span class="kt">RootMarkup</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">currentMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="o">=</span> <span class="n">rootMarkup</span>

<span class="k">let</span> <span class="nv">htmlTags</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">HTMLTag</span><span class="p">]</span>
<span class="nf">init</span><span class="p">(</span><span class="nv">htmlTags</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTag</span><span class="p">])</span> <span class="p">{</span>
  <span class="k">self</span><span class="o">.</span><span class="n">htmlTags</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="p">(</span><span class="nv">uniqueKeysWithValues</span><span class="p">:</span> <span class="n">htmlTags</span><span class="o">.</span><span class="n">map</span><span class="p">{</span> <span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">tagName</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Start Tags Stack, ç¢ºä¿æœ‰æ­£ç¢º pop tag</span>
<span class="c1">// å‰é¢å·²ç¶“åšé Normalization äº†, æ‡‰è©²ä¸æœƒå‡ºéŒ¯, åªæ˜¯ç¢ºä¿è€Œå·²</span>
<span class="k">var</span> <span class="nv">stackExpectedStartItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLParsedResult</span><span class="o">.</span><span class="kt">StartItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">thisItem</span> <span class="k">in</span> <span class="n">from</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">thisItem</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="k">let</span> <span class="nv">item</span><span class="p">):</span>
        <span class="k">let</span> <span class="nv">visitor</span> <span class="o">=</span> <span class="kt">HTMLTagNameToMarkupVisitor</span><span class="p">(</span><span class="nv">attributes</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">htmlTag</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">htmlTags</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">tagName</span><span class="p">]</span> <span class="p">??</span> <span class="kt">HTMLTag</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">ExtendTagName</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tagName</span><span class="p">))</span>
        <span class="c1">// ç”¨ Visitor å•å°æ‡‰çš„ Markup</span>
        <span class="k">let</span> <span class="nv">markup</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">htmlTag</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span>
        
        <span class="c1">// æŠŠè‡ªå·±åŠ å…¥ç•¶å‰æçš„è‘‰ç¯€é»</span>
        <span class="c1">// è‡ªå·±è®Šæˆç•¶å‰æç¯€é»</span>
        <span class="n">htmlElementComponents</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">tag</span><span class="p">:</span> <span class="n">htmlTag</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">tagAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">attributes</span><span class="p">)))</span>
        <span class="n">currentMarkup</span><span class="o">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">)</span>
        <span class="n">currentMarkup</span> <span class="o">=</span> <span class="n">markup</span>
        
        <span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">selfClosing</span><span class="p">(</span><span class="k">let</span> <span class="nv">item</span><span class="p">):</span>
        <span class="c1">// ç›´æ¥åŠ å…¥ç•¶å‰æçš„è‘‰ç¯€é»</span>
        <span class="k">let</span> <span class="nv">visitor</span> <span class="o">=</span> <span class="kt">HTMLTagNameToMarkupVisitor</span><span class="p">(</span><span class="nv">attributes</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">htmlTag</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">htmlTags</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">tagName</span><span class="p">]</span> <span class="p">??</span> <span class="kt">HTMLTag</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="kt">ExtendTagName</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tagName</span><span class="p">))</span>
        <span class="k">let</span> <span class="nv">markup</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">htmlTag</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span>
        <span class="n">htmlElementComponents</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">tag</span><span class="p">:</span> <span class="n">htmlTag</span><span class="p">,</span> <span class="nv">tagAttributedString</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">tagAttributedString</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">attributes</span><span class="p">)))</span>
        <span class="n">currentMarkup</span><span class="o">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">close</span><span class="p">(</span><span class="k">let</span> <span class="nv">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">lastTagName</span> <span class="o">=</span> <span class="n">stackExpectedStartItems</span><span class="o">.</span><span class="nf">popLast</span><span class="p">()?</span><span class="o">.</span><span class="n">tagName</span><span class="p">,</span>
           <span class="n">lastTagName</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">tagName</span> <span class="p">{</span>
            <span class="c1">// é‡åˆ° Close Tag, å°±å›åˆ°ä¸Šä¸€å±¤</span>
            <span class="n">currentMarkup</span> <span class="o">=</span> <span class="n">currentMarkup</span><span class="o">.</span><span class="n">parentMarkup</span> <span class="p">??</span> <span class="n">currentMarkup</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="k">let</span> <span class="nv">attributedString</span><span class="p">):</span>
        <span class="c1">// ç›´æ¥åŠ å…¥ç•¶å‰æçš„è‘‰ç¯€é»</span>
        <span class="n">currentMarkup</span><span class="o">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">RawStringMarkup</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="n">attributedString</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// print(htmlElementComponents)</span>
<span class="c1">// [(markup: LinkMarkup, (tag: a, attributes: ["href":"zhgchg.li"]...)]</span>
</pre></table></code></div></div><p><a href="/assets/2724f02f6e7/1*D-oMszCDzsBpUYnCEWGKHQ.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*D-oMszCDzsBpUYnCEWGKHQ.webp" alt="é‹ä½œçµæœå¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE0IiBoZWlnaHQ9Ijc0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹ä½œçµæœå¦‚ä¸Šåœ–</p><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLParsedResultToHTMLElementWithRootMarkupProcessor.swift" target="_blank">HTMLParsedResultToHTMLElementWithRootMarkupProcessor.swift</a> å¯¦ä½œ</p></blockquote><h4 id="æ­¤æ™‚å…¶å¯¦æˆ‘å€‘å°±å®Œæˆ-selector-çš„åŠŸèƒ½äº†-"><span class="me-2">æ­¤æ™‚ï¼Œå…¶å¯¦æˆ‘å€‘å°±å®Œæˆ Selector çš„åŠŸèƒ½äº† ğŸ‰</span><a href="#æ­¤æ™‚å…¶å¯¦æˆ‘å€‘å°±å®Œæˆ-selector-çš„åŠŸèƒ½äº†-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="kt">HTMLSelector</span><span class="p">:</span> <span class="kt">CustomStringConvertible</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span>
    <span class="k">let</span> <span class="nv">componets</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLElementMarkupComponent</span><span class="p">]</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">,</span> <span class="nv">componets</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLElementMarkupComponent</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="k">self</span><span class="o">.</span><span class="n">componets</span> <span class="o">=</span> <span class="n">componets</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">filter</span><span class="p">(</span><span class="n">_</span> <span class="nv">htmlTagName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">HTMLSelector</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="n">componets</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)?</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">tagName</span><span class="o">.</span><span class="nf">isEqualTo</span><span class="p">(</span><span class="n">htmlTagName</span><span class="p">)</span> <span class="p">??</span> <span class="kc">false</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">componets</span><span class="p">:</span> <span class="n">componets</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">}</span>

    <span class="c1">//...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>æˆ‘å€‘å¯ä»¥ä¸€å±¤ä¸€å±¤ Filter è‘‰ç¯€é»ç‰©ä»¶ã€‚</p><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLSelector.swift" target="_blank">HTMLSelector</a> å¯¦ä½œ</p></blockquote><h3 id="parser--html-to-markupsyle-abstract-of-nsattributedstringkey"><span class="me-2">Parser â€” HTML to MarkupSyle (Abstract of NSAttributedString.Key)</span><a href="#parser--html-to-markupsyle-abstract-of-nsattributedstringkey" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å†ä¾†æˆ‘å€‘è¦å…ˆå®Œæˆå°‡ HTML è½‰æ›æˆ MarkupStyle (NSAttributedString.Key)ã€‚</p><p>NSAttributedString æ˜¯é€é NSAttributedString.Key Attributes ä¾†è¨­å®šå­—çš„æ¨£å¼ï¼Œæˆ‘å€‘æŠ½è±¡å‡º NSAttributedString.Key çš„æ‰€æœ‰æ¬„ä½å°æ‡‰åˆ° MarkupStyle,MarkupStyleColor,MarkupStyleFont,MarkupStyleParagraphStyleã€‚</p><p><strong>ç›®çš„ï¼š</strong></p><ul><li>åŸæœ¬çš„ Attributes çš„è³‡æ–™çµæ§‹æ˜¯ <code class="language-plaintext highlighter-rouge">[NSAttributedString.Key: Any?]</code> ï¼Œå¦‚æœç›´æ¥æš´éœ²å‡ºå»ï¼Œæˆ‘å€‘å¾ˆé›£æ§åˆ¶ä½¿ç”¨è€…å¸¶å…¥çš„å€¼ï¼Œå¦‚æœå¸¶éŒ¯é‚„æœƒé€ æˆé–ƒé€€ï¼Œä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">.font: 123</code><li>æ¨£å¼éœ€è¦å¯ç¹¼æ‰¿ï¼Œä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">&lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt;</code> ï¼Œtest å­—ä¸²çš„æ¨£å¼å°±æ˜¯ç¹¼æ‰¿è‡ª link çš„ bold (bold+linke)ï¼›å¦‚æœç›´æ¥æš´éœ² Dictionary å‡ºå»å¾ˆé›£æ§åˆ¶å¥½ç¹¼æ‰¿è¦<li>å°è£ iOS/macOS (UIKit/Appkit) æ‰€å±¬ç‰©ä»¶</ul><h4 id="markupstyle-struct"><span class="me-2">MarkupStyle Struct</span><a href="#markupstyle-struct" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MarkupStyle</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">font</span><span class="p">:</span><span class="kt">MarkupStyleFont</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">paragraphStyle</span><span class="p">:</span><span class="kt">MarkupStyleParagraphStyle</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">foregroundColor</span><span class="p">:</span><span class="kt">MarkupStyleColor</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">backgroundColor</span><span class="p">:</span><span class="kt">MarkupStyleColor</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">ligature</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">kern</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">tracking</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">strikethroughStyle</span><span class="p">:</span><span class="kt">NSUnderlineStyle</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">underlineStyle</span><span class="p">:</span><span class="kt">NSUnderlineStyle</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">strokeColor</span><span class="p">:</span><span class="kt">MarkupStyleColor</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">strokeWidth</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">shadow</span><span class="p">:</span><span class="kt">NSShadow</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">textEffect</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">attachment</span><span class="p">:</span><span class="kt">NSTextAttachment</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">link</span><span class="p">:</span><span class="kt">URL</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">baselineOffset</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">underlineColor</span><span class="p">:</span><span class="kt">MarkupStyleColor</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">strikethroughColor</span><span class="p">:</span><span class="kt">MarkupStyleColor</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">obliqueness</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">expansion</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">writingDirection</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">verticalGlyphForm</span><span class="p">:</span><span class="kt">NSNumber</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="c1">//...</span>

    <span class="c1">// ç¹¼æ‰¿è‡ª...</span>
    <span class="c1">// é è¨­: æ¬„ä½ç‚º nil æ™‚ï¼Œå¾ from å¡«å…¥ç•¶å‰è³‡æ–™ç‰©ä»¶</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">from</span> <span class="o">=</span> <span class="n">from</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        
        <span class="k">var</span> <span class="nv">currentFont</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">font</span>
        <span class="n">currentFont</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">currentFont</span>
        
        <span class="k">var</span> <span class="nv">currentParagraphStyle</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">paragraphStyle</span>
        <span class="n">currentParagraphStyle</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="o">.</span><span class="n">paragraphStyle</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">paragraphStyle</span> <span class="o">=</span> <span class="n">currentParagraphStyle</span>
        <span class="c1">//..</span>
    <span class="p">}</span>

    <span class="c1">// MarkupStyle to NSAttributedString.Key: Any</span>
    <span class="kd">func</span> <span class="nf">render</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">data</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">font</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="nf">getFont</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">data</span><span class="p">[</span><span class="o">.</span><span class="n">font</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="k">let</span> <span class="nv">ligature</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">ligature</span> <span class="p">{</span>
            <span class="n">data</span><span class="p">[</span><span class="o">.</span><span class="n">ligature</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligature</span>
        <span class="p">}</span>
        <span class="c1">//...</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MarkupStyleFont</span><span class="p">:</span> <span class="kt">MarkupStyleItem</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="kt">FontWeight</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">style</span><span class="p">(</span><span class="kt">FontWeightStyle</span><span class="p">)</span>
        <span class="k">case</span> <span class="nf">rawValue</span><span class="p">(</span><span class="kt">CGFloat</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="kt">FontWeightStyle</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">ultraLight</span><span class="p">,</span> <span class="n">light</span><span class="p">,</span> <span class="n">thin</span><span class="p">,</span> <span class="n">regular</span><span class="p">,</span> <span class="n">medium</span><span class="p">,</span> <span class="n">semibold</span><span class="p">,</span> <span class="n">bold</span><span class="p">,</span> <span class="n">heavy</span><span class="p">,</span> <span class="n">black</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">?</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">weight</span><span class="p">:</span> <span class="kt">FontWeight</span><span class="p">?</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">italic</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MarkupStyleParagraphStyle</span><span class="p">:</span> <span class="kt">MarkupStyleItem</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">lineSpacing</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">paragraphSpacing</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">alignment</span><span class="p">:</span><span class="kt">NSTextAlignment</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">headIndent</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">tailIndent</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">firstLineHeadIndent</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">minimumLineHeight</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">maximumLineHeight</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">lineBreakMode</span><span class="p">:</span><span class="kt">NSLineBreakMode</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">baseWritingDirection</span><span class="p">:</span><span class="kt">NSWritingDirection</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">lineHeightMultiple</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">paragraphSpacingBefore</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">hyphenationFactor</span><span class="p">:</span><span class="kt">Float</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">usesDefaultHyphenation</span><span class="p">:</span><span class="kt">Bool</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">tabStops</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSTextTab</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">defaultTabInterval</span><span class="p">:</span><span class="kt">CGFloat</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">textLists</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSTextList</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">allowsDefaultTighteningForTruncation</span><span class="p">:</span><span class="kt">Bool</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">lineBreakStrategy</span><span class="p">:</span> <span class="kt">NSParagraphStyle</span><span class="o">.</span><span class="kt">LineBreakStrategy</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MarkupStyleColor</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">red</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">green</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">blue</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">alpha</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/tree/main/Sources/ZMarkupParser/Core/MarkupStyle" target="_blank">MarkupStyle</a> å¯¦ä½œ</p></blockquote><blockquote><p>å¦å¤–ä¹Ÿåƒè€ƒ W3c wiki, browser predefined color name åˆ—èˆ‰äº†å°æ‡‰ color name text &amp; color R,G,B enum: <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/Core/MarkupStyle/MarkupStyleColorName.swift" target="_blank">MarkupStyleColorName.swift</a></p></blockquote><h4 id="htmltagstyleattribute--htmltagstyleattributevisitor"><span class="me-2">HTMLTagStyleAttribute &amp; HTMLTagStyleAttributeVisitor</span><a href="#htmltagstyleattribute--htmltagstyleattributevisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é€™é‚Šå¤šæä¸€ä¸‹é€™å…©å€‹ç‰©ä»¶ï¼Œå› ç‚º HTML Tag æ˜¯å…è¨±æ­é…å¾ CSS è¨­å®šæ¨£å¼çš„ï¼›å°æ­¤æˆ‘å€‘åŒ HTMLTagName çš„æŠ½è±¡ï¼Œå†å¥—ç”¨ä¸€æ¬¡åœ¨ HTML Style Attribute ä¸Šã€‚</p><p>ä¾‹å¦‚ HTML å¯èƒ½æœƒçµ¦ï¼š <code class="language-plaintext highlighter-rouge">&lt;a style=â€color:red;font-size:14pxâ€&gt;RedLink&lt;/a&gt;</code> ï¼Œä»£è¡¨é€™å€‹é€£çµè¦è¨­å®šæˆç´…è‰²ã€å¤§å° 14pxã€‚</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>public protocol HTMLTagStyleAttribute {
    var styleName: String { get }
    
    func accept&lt;V: HTMLTagStyleAttributeVisitor&gt;(_ visitor: V) -&gt; V.Result
}

public protocol HTMLTagStyleAttributeVisitor {
    associatedtype Result
    
    func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result
    func visit(_ styleAttribute: ColorHTMLTagStyleAttribute) -&gt; Result
    func visit(_ styleAttribute: FontSizeHTMLTagStyleAttribute) -&gt; Result
    //...
}

public extension HTMLTagStyleAttributeVisitor {
    func visit(styleAttribute: HTMLTagStyleAttribute) -&gt; Result {
        return styleAttribute.accept(self)
    }
}
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/tree/main/Sources/ZMarkupParser/HTML/HTMLTag/HTMLTagStyleAttribute" target="_blank">HTMLTagStyleAttribute</a> å¯¦ä½œ</p></blockquote><h4 id="htmltagstyleattributetomarkupstylevisitor"><span class="me-2">HTMLTagStyleAttributeToMarkupStyleVisitor</span><a href="#htmltagstyleattributetomarkupstylevisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">HTMLTagStyleAttributeToMarkupStyleVisitor</span><span class="p">:</span> <span class="kt">HTMLTagStyleAttributeVisitor</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Result</span> <span class="o">=</span> <span class="kt">MarkupStyle</span><span class="p">?</span>
    
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">styleAttribute</span><span class="p">:</span> <span class="kt">ColorHTMLTagStyleAttribute</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// æ­£å‰‡æŒ–å– Color Hex or Mapping from HTML Pre-defined Color Name, è«‹åƒè€ƒ Source Code</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">color</span> <span class="o">=</span> <span class="kt">MarkupStyleColor</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">return</span> <span class="kt">MarkupStyle</span><span class="p">(</span><span class="nv">foregroundColor</span><span class="p">:</span> <span class="n">color</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">styleAttribute</span><span class="p">:</span> <span class="kt">FontSizeHTMLTagStyleAttribute</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// æ­£å‰‡æŒ–å– 10px -&gt; 10, è«‹åƒè€ƒ Source Code</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">size</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">convert</span><span class="p">(</span><span class="nv">fromPX</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">return</span> <span class="kt">MarkupStyle</span><span class="p">(</span><span class="nv">font</span><span class="p">:</span> <span class="kt">MarkupStyleFont</span><span class="p">(</span><span class="nv">size</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="n">size</span><span class="p">)))</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLTagAttributeToMarkupStyleVisitor.swift" target="_blank">HTMLTagAttributeToMarkupStyleVisitor.swift</a> å¯¦ä½œ</p></blockquote><p>init çš„ value = attribute çš„å€¼ï¼Œä¾ç…§ visit é¡å‹è½‰æ›åˆ°å°æ‡‰ MarkupStyle æ¬„ä½ã€‚</p><h4 id="htmlelementmarkupcomponentmarkupstylevisitor"><span class="me-2">HTMLElementMarkupComponentMarkupStyleVisitor</span><a href="#htmlelementmarkupcomponentmarkupstylevisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä»‹ç´¹å®Œ MarkupStyle ç‰©ä»¶å¾Œï¼Œæˆ‘å€‘è¦å¾ Normalization çš„ HTMLElementComponents çµæœè½‰æ›æˆ MarkupStyleã€‚</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
</pre><td class="rouge-code"><pre><span class="c1">// MarkupStyle ç­–ç•¥</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">MarkupStylePolicy</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">respectMarkupStyleFromCode</span> <span class="c1">// å¾ Code ä¾†çš„ç‚ºä¸», ç”¨ HTML Style Attribute ä¾†çš„å¡«ç©º</span>
    <span class="k">case</span> <span class="n">respectMarkupStyleFromHTMLStyleAttribute</span> <span class="c1">// å¾ HTML Style Attribute ä¾†çš„ç‚ºä¸», ç”¨ Code ä¾†çš„å¡«ç©º</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">HTMLElementMarkupComponentMarkupStyleVisitor</span><span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>

    <span class="kd">typealias</span> <span class="kt">Result</span> <span class="o">=</span> <span class="kt">MarkupStyle</span><span class="p">?</span>
    
    <span class="k">let</span> <span class="nv">policy</span><span class="p">:</span> <span class="kt">MarkupStylePolicy</span>
    <span class="k">let</span> <span class="nv">components</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLElementMarkupComponent</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagStyleAttribute</span><span class="p">]</span>

    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">BoldMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// .bold åªæ˜¯å®šç¾©åœ¨ MarkupStyle ä¸­çš„é è¨­æ¨£å¼, è«‹åƒè€ƒ Source Code</span>
        <span class="k">return</span> <span class="nf">defaultVisit</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">),</span> <span class="n">defaultStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">bold</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">LinkMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// .link åªæ˜¯å®šç¾©åœ¨ MarkupStyle ä¸­çš„é è¨­æ¨£å¼, è«‹åƒè€ƒ Source Code</span>
        <span class="k">var</span> <span class="nv">markupStyle</span> <span class="o">=</span> <span class="nf">defaultVisit</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">),</span> <span class="n">defaultStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">link</span><span class="p">)</span> <span class="p">??</span> <span class="o">.</span><span class="n">link</span>
        
        <span class="c1">// å¾ HtmlElementComponents å–å¾— LinkMarkup å°æ‡‰çš„ HtmlElement</span>
        <span class="c1">// å¾ HtmlElement ä¸­çš„ attributes æ‰¾ href åƒæ•¸ (HTML å¸¶ URL String çš„æ–¹å¼)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">href</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">)?</span><span class="o">.</span><span class="n">attributes</span><span class="p">?[</span><span class="s">"href"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
           <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">href</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">markupStyle</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">url</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">markupStyle</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">HTMLElementMarkupComponentMarkupStyleVisitor</span> <span class="p">{</span>
    <span class="c1">// å–å¾— HTMLTag å®¹å™¨ä¸­æŒ‡å®šæƒ³å®¢è£½åŒ–çš„ MarkupStyle</span>
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">customStyle</span><span class="p">(</span><span class="n">_</span> <span class="nv">htmlElement</span><span class="p">:</span> <span class="kt">HTMLElementMarkupComponent</span><span class="o">.</span><span class="kt">HTMLElement</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">customStyle</span> <span class="o">=</span> <span class="n">htmlElement</span><span class="p">?</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">customStyle</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">customStyle</span>
    <span class="p">}</span>
    
    <span class="c1">// é è¨­å‹•ä½œ</span>
    <span class="kd">func</span> <span class="nf">defaultVisit</span><span class="p">(</span><span class="n">_</span> <span class="nv">htmlElement</span><span class="p">:</span> <span class="kt">HTMLElementMarkupComponent</span><span class="o">.</span><span class="kt">HTMLElement</span><span class="p">?,</span> <span class="n">defaultStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">markupStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="o">=</span> <span class="nf">customStyle</span><span class="p">(</span><span class="n">htmlElement</span><span class="p">)</span> <span class="p">??</span> <span class="n">defaultStyle</span>
        <span class="c1">// å¾ HtmlElementComponents å–å¾— LinkMarkup å°æ‡‰çš„ HtmlElement</span>
        <span class="c1">// çœ‹çœ‹ HtmlElement ä¸­çš„ attributes æœ‰æ²’æœ‰ `Style` Attribute</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">styleString</span> <span class="o">=</span> <span class="n">htmlElement</span><span class="p">?</span><span class="o">.</span><span class="n">attributes</span><span class="p">?[</span><span class="s">"style"</span><span class="p">],</span>
              <span class="n">styleAttributes</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// æ²’æœ‰</span>
            <span class="k">return</span> <span class="n">markupStyle</span>
        <span class="p">}</span>

        <span class="c1">// æœ‰ Style Attributes</span>
        <span class="c1">// åˆ‡å‰² Style Value å­—ä¸²æˆé™£åˆ—</span>
        <span class="c1">// font-size:14px;color:red -&gt; ["font-size":"14px","color":"red"]</span>
        <span class="k">let</span> <span class="nv">styles</span> <span class="o">=</span> <span class="n">styleString</span><span class="o">.</span><span class="nf">split</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">";"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">split</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">":"</span><span class="p">)</span> <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">style</span> <span class="k">in</span> <span class="n">styles</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="n">style</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="c1">// e.g font-szie</span>
            <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span>
            <span class="c1">// e.g. 14px</span>
            <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="k">let</span> <span class="nv">styleAttribute</span> <span class="o">=</span> <span class="n">styleAttributes</span><span class="o">.</span><span class="nf">first</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">isEqualTo</span><span class="p">(</span><span class="nv">styleName</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
                <span class="c1">// ä½¿ç”¨ä¸Šæ–‡ä¸­çš„ HTMLTagStyleAttributeToMarkupStyleVisitor æ›å› MarkupStyle</span>
                <span class="k">let</span> <span class="nv">visitor</span> <span class="o">=</span> <span class="kt">HTMLTagStyleAttributeToMarkupStyleVisitor</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="k">var</span> <span class="nv">thisMarkupStyle</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">styleAttribute</span><span class="p">:</span> <span class="n">styleAttribute</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Style Attribute æœ‰æ›å›å€¼æ™‚..</span>
                    <span class="c1">// åˆä½µä¸Šä¸€å€‹ MarkupStyle çµæœ</span>
                    <span class="n">thisMarkupStyle</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">markupStyle</span><span class="p">)</span>
                    <span class="n">markupStyle</span> <span class="o">=</span> <span class="n">thisMarkupStyle</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// å¦‚æœæœ‰é è¨­ Style</span>
        <span class="k">if</span> <span class="k">var</span> <span class="nv">defaultStyle</span> <span class="o">=</span> <span class="n">defaultStyle</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">policy</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">respectMarkupStyleFromHTMLStyleAttribute</span><span class="p">:</span>
                  <span class="c1">// Style Attribute MarkupStyle ç‚ºä¸»ï¼Œç„¶å¾Œ</span>
                  <span class="c1">// åˆä½µ defaultStyle çµæœ</span>
                    <span class="n">markupStyle</span><span class="p">?</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">defaultStyle</span><span class="p">)</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">respectMarkupStyleFromCode</span><span class="p">:</span>
                  <span class="c1">// defaultStyle ç‚ºä¸»ï¼Œç„¶å¾Œ</span>
                  <span class="c1">// åˆä½µ Style Attribute MarkupStyle çµæœ</span>
                  <span class="n">defaultStyle</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">markupStyle</span><span class="p">)</span>
                  <span class="n">markupStyle</span> <span class="o">=</span> <span class="n">defaultStyle</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">markupStyle</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLTagAttributeToMarkupStyleVisitor.swift" target="_blank">HTMLTagAttributeToMarkupStyleVisitor.swift</a> å¯¦ä½œ</p></blockquote><p>æˆ‘å€‘æœƒå®šç¾©éƒ¨åˆ†é è¨­æ¨£å¼åœ¨ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/Core/MarkupStyle/MarkupStyle%2BExtension.swift" target="_blank">MarkupStyle</a> ä¸­ï¼Œéƒ¨åˆ† Markup å¦‚æœæ²’æœ‰å¾ Code å¤–éƒ¨æŒ‡å®š Tag æƒ³è¦çš„æ¨£å¼æ™‚æœƒä½¿ç”¨é è¨­æ¨£å¼ã€‚</p><p><strong>æ¨£å¼ç¹¼æ‰¿ç­–ç•¥æœ‰å…©ç¨®ï¼š</strong></p><ul><li>respectMarkupStyleFromCode: ä½¿ç”¨é è¨­æ¨£å¼ç‚ºä¸»ï¼›å†çœ‹ Style Attributes ä¸­èƒ½è£œä¸Šä»€éº¼æ¨£å¼ï¼Œå¦‚æœæœ¬ä¾†å°±æœ‰å€¼å‰‡å¿½ç•¥ã€‚<li>respectMarkupStyleFromHTMLStyleAttribute: çœ‹ Style Attributes ç‚ºä¸»ï¼›å†çœ‹ é è¨­æ¨£å¼ ä¸­èƒ½è£œä¸Šä»€éº¼æ¨£å¼ï¼Œå¦‚æœæœ¬ä¾†å°±æœ‰å€¼å‰‡å¿½ç•¥ã€‚</ul><h4 id="htmlelementwithmarkuptomarkupstyleprocessor"><span class="me-2">HTMLElementWithMarkupToMarkupStyleProcessor</span><a href="#htmlelementwithmarkuptomarkupstyleprocessor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å°‡ Normalization çµæœè½‰æ›æˆ AST &amp; MarkupStyleComponentã€‚</p><p><strong>æ–°å®£å‘Šä¸€å€‹ MarkupComponent é€™æ¬¡è¦å­˜æ”¾å°æ‡‰ MarkupStyle:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">MarkupStyleComponent</span><span class="p">:</span> <span class="kt">MarkupComponent</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">T</span> <span class="o">=</span> <span class="kt">MarkupStyle</span>
    
    <span class="k">let</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">MarkupStyle</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="k">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>ç°¡å–®éæ­·å€‹ Markup Tree &amp; HTMLElementMarkupComponent çµæ§‹:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagStyleAttribute</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">policy</span><span class="p">:</span> <span class="kt">MarkupStylePolicy</span>
    
<span class="kd">func</span> <span class="nf">process</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="p">(</span><span class="kt">Markup</span><span class="p">,</span> <span class="p">[</span><span class="kt">HTMLElementMarkupComponent</span><span class="p">]))</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">MarkupStyleComponent</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">components</span><span class="p">:</span> <span class="p">[</span><span class="kt">MarkupStyleComponent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">let</span> <span class="nv">visitor</span> <span class="o">=</span> <span class="kt">HTMLElementMarkupComponentMarkupStyleVisitor</span><span class="p">(</span><span class="nv">policy</span><span class="p">:</span> <span class="n">policy</span><span class="p">,</span> <span class="nv">components</span><span class="p">:</span> <span class="n">from</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="n">styleAttributes</span><span class="p">)</span>
  <span class="nf">walk</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">from</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="nv">visitor</span><span class="p">:</span> <span class="n">visitor</span><span class="p">,</span> <span class="nv">components</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">components</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">components</span>
<span class="p">}</span>
    
<span class="kd">func</span> <span class="nf">walk</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">,</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">HTMLElementMarkupComponentMarkupStyleVisitor</span><span class="p">,</span> <span class="nv">components</span><span class="p">:</span> <span class="k">inout</span> <span class="p">[</span><span class="kt">MarkupStyleComponent</span><span class="p">])</span> <span class="p">{</span>
        
  <span class="k">if</span> <span class="k">let</span> <span class="nv">markupStyle</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">components</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">markupStyle</span><span class="p">))</span>
  <span class="p">}</span>
        
  <span class="k">for</span> <span class="n">markup</span> <span class="k">in</span> <span class="n">markup</span><span class="o">.</span><span class="n">childMarkups</span> <span class="p">{</span>
    <span class="nf">walk</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">,</span> <span class="nv">visitor</span><span class="p">:</span> <span class="n">visitor</span><span class="p">,</span> <span class="nv">components</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">components</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// print(components)</span>
<span class="c1">// [(markup: LinkMarkup, MarkupStyle(link: https://zhgchg.li, color: .blue)]</span>
<span class="c1">// [(markup: BoldMarkup, MarkupStyle(font: .init(weight: .bold))]</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/Processor/HTMLElementWithMarkupToMarkupStyleProcessor.swift" target="_blank">HTMLElementWithMarkupToMarkupStyleProcessor.swift</a> å¯¦ä½œ</p></blockquote><p><a href="/assets/2724f02f6e7/1*JEMBNdbQcBgDQ49jFw4ePQ.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*JEMBNdbQcBgDQ49jFw4ePQ.webp" alt="æµç¨‹çµæœå¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE0IiBoZWlnaHQ9IjExMTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>æµç¨‹çµæœå¦‚ä¸Šåœ–</p><h3 id="render--convert-to-nsattributedstring"><span class="me-2">Render â€” Convert To NSAttributedString</span><a href="#render--convert-to-nsattributedstring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ç¾åœ¨æˆ‘å€‘æœ‰äº† HTML Tag æŠ½è±¡æ¨¹çµæ§‹ã€HTML Tag å°æ‡‰çš„ MarkupStyle å¾Œï¼›æœ€å¾Œä¸€æ­¥æˆ‘å€‘å°±èƒ½ä¾†ç”¢å‡ºæœ€å¾Œçš„ NSAttributedString æ¸²æŸ“çµæœã€‚</p><h4 id="markupnsattributedstringvisitor"><span class="me-2">MarkupNSAttributedStringVisitor</span><a href="#markupnsattributedstringvisitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>visit markup to NSAttributedString</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">MarkupNSAttributedStringVisitor</span><span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Result</span> <span class="o">=</span> <span class="kt">NSAttributedString</span>
    
    <span class="k">let</span> <span class="nv">components</span><span class="p">:</span> <span class="p">[</span><span class="kt">MarkupStyleComponent</span><span class="p">]</span>
    <span class="c1">// root / base çš„ MarkupStyle, å¤–éƒ¨æŒ‡å®šï¼Œä¾‹å¦‚å¯æŒ‡å®šæ•´ä¸²å­—çš„å¤§å°</span>
    <span class="k">let</span> <span class="nv">rootStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">RootMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// å¾€ä¸‹çœ‹ RawString ç‰©ä»¶</span>
        <span class="k">return</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">RawStringMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// å›å‚³ Raw String</span>
        <span class="c1">// æœé›†éˆä¸Šçš„æ‰€æœ‰ MarkupStyle</span>
        <span class="c1">// å¥—ç”¨ Style åˆ° NSAttributedString</span>
        <span class="k">return</span> <span class="nf">applyMarkupStyle</span><span class="p">(</span><span class="n">markup</span><span class="o">.</span><span class="n">attributedString</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="nf">collectMarkupStyle</span><span class="p">(</span><span class="n">markup</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">BoldMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// å¾€ä¸‹çœ‹ RawString ç‰©ä»¶</span>
        <span class="k">return</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">LinkMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="c1">// å¾€ä¸‹çœ‹ RawString ç‰©ä»¶</span>
        <span class="k">return</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">extension</span> <span class="kt">MarkupNSAttributedStringVisitor</span> <span class="p">{</span>
    <span class="c1">// å¥—ç”¨ Style åˆ° NSAttributedString</span>
    <span class="kd">func</span> <span class="nf">applyMarkupStyle</span><span class="p">(</span><span class="n">_</span> <span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">,</span> <span class="n">with</span> <span class="nv">markupStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">markupStyle</span> <span class="o">=</span> <span class="n">markupStyle</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="n">attributedString</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">mutableAttributedString</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">attributedString</span><span class="p">:</span> <span class="n">attributedString</span><span class="p">)</span>
        <span class="n">mutableAttributedString</span><span class="o">.</span><span class="nf">addAttributes</span><span class="p">(</span><span class="n">markupStyle</span><span class="o">.</span><span class="nf">render</span><span class="p">(),</span> <span class="nv">range</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mutableAttributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">utf16</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mutableAttributedString</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSMutableAttributedString</span> <span class="p">{</span>
        <span class="c1">// collect from downstream</span>
        <span class="c1">// Root -&gt; Bold -&gt; String("Bold")</span>
        <span class="c1">//      \</span>
        <span class="c1">//       &gt; String("Test")</span>
        <span class="c1">// Result: Bold Test</span>
        <span class="c1">// ä¸€å±¤ä¸€å±¤å¾€ä¸‹æ‰¾ raw string, éè¿´ visit ä¸¦çµ„åˆå‡ºæœ€çµ‚ NSAttributedString</span>
        <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">({</span> <span class="nf">visit</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="kt">NSMutableAttributedString</span><span class="p">())</span> <span class="p">{</span> <span class="n">partialResult</span><span class="p">,</span> <span class="n">attributedString</span> <span class="k">in</span>
            <span class="n">partialResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">attributedString</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">partialResult</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">collectMarkupStyle</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">// collect from upstream</span>
        <span class="c1">// String("Test") -&gt; Bold -&gt; Italic -&gt; Root</span>
        <span class="c1">// Result: style: Bold+Italic</span>
        <span class="c1">// ä¸€å±¤ä¸€å±¤ç¶²ä¸Šæ‰¾ parent tag çš„ markupstyle</span>
        <span class="c1">// ç„¶å¾Œä¸€å±¤ä¸€å±¤ç¹¼æ‰¿æ¨£å¼</span>
        <span class="k">var</span> <span class="nv">currentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span>
        <span class="k">var</span> <span class="nv">currentStyle</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">markup</span><span class="p">)</span>
        <span class="k">while</span> <span class="k">let</span> <span class="nv">thisMarkup</span> <span class="o">=</span> <span class="n">currentMarkup</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">thisMarkupStyle</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">markup</span><span class="p">:</span> <span class="n">thisMarkup</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">currentMarkup</span> <span class="o">=</span> <span class="n">thisMarkup</span><span class="o">.</span><span class="n">parentMarkup</span>
                <span class="k">continue</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="k">var</span> <span class="nv">thisCurrentStyle</span> <span class="o">=</span> <span class="n">currentStyle</span> <span class="p">{</span>
                <span class="n">thisCurrentStyle</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">thisMarkupStyle</span><span class="p">)</span>
                <span class="n">currentStyle</span> <span class="o">=</span> <span class="n">thisCurrentStyle</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">currentStyle</span> <span class="o">=</span> <span class="n">thisMarkupStyle</span>
            <span class="p">}</span>

            <span class="n">currentMarkup</span> <span class="o">=</span> <span class="n">thisMarkup</span><span class="o">.</span><span class="n">parentMarkup</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="k">var</span> <span class="nv">currentStyle</span> <span class="o">=</span> <span class="n">currentStyle</span> <span class="p">{</span>
            <span class="n">currentStyle</span><span class="o">.</span><span class="nf">fillIfNil</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">rootStyle</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">currentStyle</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">rootStyle</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/Core/Processor/MarkupNSAttributedStringVisitor.swift" target="_blank">MarkupNSAttributedStringVisitor.swift</a> å¯¦ä½œ</p></blockquote><p><a href="/assets/2724f02f6e7/1*gJA_6uM5tQw2kUJsqIssuw.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*gJA_6uM5tQw2kUJsqIssuw.webp" alt="é‹ä½œæµç¨‹åŠçµæœå¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjk4IiBoZWlnaHQ9IjExMTQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>é‹ä½œæµç¨‹åŠçµæœå¦‚ä¸Šåœ–</p><p><strong>æœ€çµ‚æˆ‘å€‘å¯ä»¥å¾—åˆ°:</strong></p><p><a href="/assets/2724f02f6e7/1*LOXfC8yYg2JCeoCH5m7kGA.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*LOXfC8yYg2JCeoCH5m7kGA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOTIiIGhlaWdodD0iMjU4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kt">Li</span><span class="p">{</span>
    <span class="kt">NSColor</span> <span class="o">=</span> <span class="s">"Blue"</span><span class="p">;</span>
    <span class="kt">NSFont</span> <span class="o">=</span> <span class="s">"&lt;UICTFont: 0x145d17600&gt; font-family: </span><span class="se">\"</span><span class="s">.SFUI-Regular</span><span class="se">\"</span><span class="s">; font-weight: normal; font-style: normal; font-size: 13.00pt"</span><span class="p">;</span>
    <span class="kt">NSLink</span> <span class="o">=</span> <span class="s">"https://zhgchg.li"</span><span class="p">;</span>
<span class="p">}</span><span class="n">nk</span><span class="p">{</span>
    <span class="kt">NSColor</span> <span class="o">=</span> <span class="s">"Blue"</span><span class="p">;</span>
    <span class="kt">NSFont</span> <span class="o">=</span> <span class="s">"&lt;UICTFont: 0x145d18710&gt; font-family: </span><span class="se">\"</span><span class="s">.SFUI-Semibold</span><span class="se">\"</span><span class="s">; font-weight: bold; font-style: normal; font-size: 13.00pt"</span><span class="p">;</span>
    <span class="kt">NSLink</span> <span class="o">=</span> <span class="s">"https://zhgchg.li"</span><span class="p">;</span>
<span class="p">}</span><span class="kt">Bold</span><span class="p">{</span>
    <span class="kt">NSFont</span> <span class="o">=</span> <span class="s">"&lt;UICTFont: 0x145d18710&gt; font-family: </span><span class="se">\"</span><span class="s">.SFUI-Semibold</span><span class="se">\"</span><span class="s">; font-weight: bold; font-style: normal; font-size: 13.00pt"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>ğŸ‰ğŸ‰ğŸ‰ğŸ‰å®ŒæˆğŸ‰ğŸ‰ğŸ‰ğŸ‰</p></blockquote><p>åˆ°æ­¤æˆ‘å€‘å°±å®Œæˆäº† HTML String to NSAttributedString çš„æ•´å€‹è½‰æ›éç¨‹ã€‚</p><h4 id="stripper--å‰é›¢-html-tag"><span class="me-2">Stripper â€” å‰é›¢ HTML Tag</span><a href="#stripper--å‰é›¢-html-tag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å‰é›¢ HTML Tag çš„éƒ¨åˆ†ç›¸å°ç°¡å–®ï¼Œåªéœ€è¦:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">attributedString</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">rawStringMarkup</span> <span class="o">=</span> <span class="n">markup</span> <span class="k">as?</span> <span class="kt">RawStringMarkup</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">rawStringMarkup</span><span class="o">.</span><span class="n">attributedString</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">markup</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">({</span> <span class="nf">attributedString</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="kt">NSMutableAttributedString</span><span class="p">())</span> <span class="p">{</span> <span class="n">partialResult</span><span class="p">,</span> <span class="n">attributedString</span> <span class="k">in</span>
      <span class="n">partialResult</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">attributedString</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">partialResult</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/Core/Processor/MarkupStripperProcessor.swift" target="_blank">MarkupStripperProcessor.swift</a> å¯¦ä½œ</p></blockquote><p>é¡ä¼¼ Renderï¼Œä½†ç´”ç²¹æ‰¾åˆ° RawStringMarkup å¾Œè¿”å›å…§å®¹ã€‚</p><h4 id="extend--å‹•æ…‹æ“´å……"><span class="me-2">Extend â€” å‹•æ…‹æ“´å……</span><a href="#extend--å‹•æ…‹æ“´å……" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç‚ºäº†èƒ½æ“´å……æ¶µè“‹æ‰€æœ‰ HTMLTag/Style Attribute æ‰€ä»¥é–‹äº†ä¸€å€‹å‹•æ…‹æ“´å……çš„å£ï¼Œæ–¹ä¾¿ç›´æ¥å¾ Code å‹•æ…‹æ“´å……ç‰©ä»¶ã€‚</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">ExtendTagName</span><span class="p">:</span> <span class="kt">HTMLTagName</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">let</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">w3cHTMLTagName</span><span class="p">:</span> <span class="kt">WC3HTMLTagName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">w3cHTMLTagName</span><span class="o">.</span><span class="n">rawValue</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span><span class="o">.</span><span class="nf">lowercased</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">HTMLTagNameVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// to</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">ExtendMarkup</span><span class="p">:</span> <span class="kt">Markup</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">parentMarkup</span><span class="p">:</span> <span class="kt">Markup</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">childMarkups</span><span class="p">:</span> <span class="p">[</span><span class="kt">Markup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">MarkupVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//----</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">ExtendHTMLTagStyleAttribute</span><span class="p">:</span> <span class="kt">HTMLTagStyleAttribute</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">let</span> <span class="nv">styleName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">let</span> <span class="nv">render</span><span class="p">:</span> <span class="p">((</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">MarkupStyle</span><span class="p">?))</span> <span class="c1">// å‹•æ…‹ç”¨ clourse è®Šæ›´ MarkupStyle</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">styleName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">render</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">((</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">MarkupStyle</span><span class="p">?)))</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">styleName</span> <span class="o">=</span> <span class="n">styleName</span>
        <span class="k">self</span><span class="o">.</span><span class="n">render</span> <span class="o">=</span> <span class="n">render</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="n">accept</span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">visitor</span><span class="p">:</span> <span class="kt">V</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">V</span><span class="o">.</span><span class="kt">Result</span> <span class="k">where</span> <span class="kt">V</span> <span class="p">:</span> <span class="kt">HTMLTagStyleAttributeVisitor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="nf">visit</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="zhtmlparserbuilder"><span class="me-2">ZHTMLParserBuilder</span><a href="#zhtmlparserbuilder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æœ€å¾Œæˆ‘å€‘ä½¿ç”¨ Builder Pattern è®“å¤–éƒ¨ Module å¯ä»¥å¿«é€Ÿæ§‹å»º ZMarkupParser æ‰€éœ€çš„ç‰©ä»¶ï¼Œä¸¦åšå¥½ Access Level Controlã€‚</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">ZHTMLParserBuilder</span> <span class="p">{</span>
    
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">htmlTags</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagStyleAttribute</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">rootStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">policy</span><span class="p">:</span> <span class="kt">MarkupStylePolicy</span> <span class="o">=</span> <span class="o">.</span><span class="n">respectMarkupStyleFromCode</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">initWithDefault</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">builder</span> <span class="o">=</span> <span class="k">Self</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">htmlTagName</span> <span class="k">in</span> <span class="kt">ZHTMLParserBuilder</span><span class="o">.</span><span class="n">htmlTagNames</span> <span class="p">{</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">htmlTagName</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">styleAttribute</span> <span class="k">in</span> <span class="kt">ZHTMLParserBuilder</span><span class="o">.</span><span class="n">styleAttributes</span> <span class="p">{</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">styleAttribute</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">builder</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="n">_</span> <span class="nv">htmlTagName</span><span class="p">:</span> <span class="kt">HTMLTagName</span><span class="p">,</span> <span class="n">withCustomStyle</span> <span class="nv">markupStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">htmlTagName</span><span class="p">,</span> <span class="nv">withCustomStyle</span><span class="p">:</span> <span class="n">markupStyle</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">htmlTagName</span><span class="p">:</span> <span class="kt">HTMLTagName</span><span class="p">,</span> <span class="n">withCustomStyle</span> <span class="nv">markupStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="c1">// åŒå€‹ tagName åªèƒ½å­˜åœ¨ä¸€å€‹</span>
        <span class="n">htmlTags</span><span class="o">.</span><span class="n">removeAll</span> <span class="p">{</span> <span class="n">htmlTag</span> <span class="k">in</span>
            <span class="k">return</span> <span class="n">htmlTag</span><span class="o">.</span><span class="n">tagName</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="n">htmlTagName</span><span class="o">.</span><span class="n">string</span>
        <span class="p">}</span>
        
        <span class="n">htmlTags</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">HTMLTag</span><span class="p">(</span><span class="nv">tagName</span><span class="p">:</span> <span class="n">htmlTagName</span><span class="p">,</span> <span class="nv">customStyle</span><span class="p">:</span> <span class="n">markupStyle</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">styleAttribute</span><span class="p">:</span> <span class="kt">HTMLTagStyleAttribute</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">styleAttributes</span><span class="o">.</span><span class="n">removeAll</span> <span class="p">{</span> <span class="n">thisStyleAttribute</span> <span class="k">in</span>
            <span class="k">return</span> <span class="n">thisStyleAttribute</span><span class="o">.</span><span class="n">styleName</span> <span class="o">==</span> <span class="n">styleAttribute</span><span class="o">.</span><span class="n">styleName</span>
        <span class="p">}</span>
        
        <span class="n">styleAttributes</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">styleAttribute</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="nv">rootStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">rootStyle</span> <span class="o">=</span> <span class="n">rootStyle</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="nv">policy</span><span class="p">:</span> <span class="kt">MarkupStylePolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">policy</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">build</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">ZHTMLParser</span> <span class="p">{</span>
        <span class="c1">// ZHTMLParser init åªé–‹æ”¾ internal, å¤–éƒ¨ç„¡æ³•ç›´æ¥ init</span>
        <span class="c1">// åªèƒ½é€é ZHTMLParserBuilder init</span>
        <span class="k">return</span> <span class="kt">ZHTMLParser</span><span class="p">(</span><span class="nv">htmlTags</span><span class="p">:</span> <span class="n">htmlTags</span><span class="p">,</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="n">styleAttributes</span><span class="p">,</span> <span class="nv">policy</span><span class="p">:</span> <span class="n">policy</span><span class="p">,</span> <span class="nv">rootStyle</span><span class="p">:</span> <span class="n">rootStyle</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/ZHTMLParserBuilder.swift" target="_blank">ZHTMLParserBuilder.swift</a> å¯¦ä½œ</p></blockquote><p><strong>initWithDefault é è¨­æœƒåŠ å…¥æ‰€æœ‰å·²ç¶“å¯¦ç¾çš„ HTMLTagName/Style Attribute</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">extension</span> <span class="kt">ZHTMLParserBuilder</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">htmlTagNames</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagName</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="kt">A_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">B_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">BR_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">DIV_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">HR_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">I_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">LI_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">OL_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">P_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">SPAN_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">STRONG_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">U_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">UL_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">DEL_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">TR_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">TD_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">TH_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">TABLE_HTMLTagName</span><span class="p">(),</span>
            <span class="kt">IMG_HTMLTagName</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">),</span>
            <span class="c1">// ...</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">extension</span> <span class="kt">ZHTMLParserBuilder</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagStyleAttribute</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="kt">ColorHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="kt">BackgroundColorHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="kt">FontSizeHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="kt">FontWeightHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="kt">LineHeightHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="kt">WordSpacingHTMLTagStyleAttribute</span><span class="p">(),</span>
            <span class="c1">// ...</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>ZHTMLParser init åªé–‹æ”¾ internalï¼Œå¤–éƒ¨ç„¡æ³•ç›´æ¥ initï¼Œåªèƒ½é€é ZHTMLParserBuilder initã€‚</p><p><strong>ZHTMLParser å°è£äº† Render/Selector/Stripper æ“ä½œ:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">ZHTMLParser</span><span class="p">:</span> <span class="kt">ZMarkupParser</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">htmlTags</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTag</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">styleAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTMLTagStyleAttribute</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">rootStyle</span><span class="p">:</span> <span class="kt">MarkupStyle</span><span class="p">?</span>

    <span class="kd">internal</span> <span class="nf">init</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
    
    <span class="c1">// å–å¾— link style attributes</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">linkTextAttributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">selector</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HTMLSelector</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">selector</span><span class="p">(</span><span class="n">_</span> <span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HTMLSelector</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="c1">// å…è¨±ä½¿ç”¨ HTMLSelector çµæœæ¸²æŸ“å‡ºç¯€é»å…§çš„ NSAttributedString</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">_</span> <span class="nv">selector</span><span class="p">:</span> <span class="kt">HTMLSelector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">_</span> <span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">stripper</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">stripper</span><span class="p">(</span><span class="n">_</span> <span class="nv">attributedString</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>å°æ‡‰åŸå§‹ç¢¼ä¸­çš„ <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/HTML/ZHTMLParser.swift" target="_blank">ZHTMLParser.swift</a> å¯¦ä½œ</p></blockquote><h4 id="uikit-å•é¡Œ"><span class="me-2">UIKit å•é¡Œ</span><a href="#uikit-å•é¡Œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>NSAttributedString çš„çµæœæˆ‘å€‘æœ€å¸¸çš„å°±æ˜¯æ”¾åˆ° UITextView ä¸­é¡¯ç¤ºï¼Œä½†æ˜¯è¦æ³¨æ„:</p><ul><li>UITextView è£¡çš„é€£çµæ¨£å¼æ˜¯çµ±ä¸€çœ‹ <code class="language-plaintext highlighter-rouge">linkTextAttributes</code> è¨­å®šé€£çµæ¨£å¼ï¼Œä¸æœƒçœ‹ NSAttributedString.Key çš„è¨­å®šï¼Œä¸”ç„¡æ³•å€‹åˆ¥è¨­å®šæ¨£å¼ï¼›å› æ­¤æ‰æœƒæœ‰ <code class="language-plaintext highlighter-rouge">ZMarkupParser.linkTextAttributes</code> é€™å€‹é–‹å£ã€‚<li>UILabel æš«æ™‚æ²’æœ‰æ–¹å¼æ”¹è®Šé€£çµæ¨£å¼ï¼Œä¸”å›  UILabel æ²’æœ‰ TextStroageï¼Œè‹¥è¦æ‹¿ä¾†è¼‰å…¥ NSTextAttachment åœ–ç‰‡ï¼›éœ€è¦å¦å¤–æŠ“ä½ UILabelã€‚</ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">extension</span> <span class="kt">UITextView</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setHtmlString</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">with</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">ZHTMLParser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">setHtmlString</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">string</span><span class="p">),</span> <span class="nv">with</span><span class="p">:</span> <span class="n">parser</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">setHtmlString</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">,</span> <span class="n">with</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">ZHTMLParser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">linkTextAttributes</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">linkTextAttributes</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">public</span> <span class="kd">extension</span> <span class="kt">UILabel</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setHtmlString</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">with</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">ZHTMLParser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">setHtmlString</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">string</span><span class="p">),</span> <span class="nv">with</span><span class="p">:</span> <span class="n">parser</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">setHtmlString</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">NSAttributedString</span><span class="p">,</span> <span class="n">with</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">ZHTMLParser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">attributedString</span><span class="o">.</span><span class="nf">enumerateAttribute</span><span class="p">(</span><span class="kt">NSAttributedString</span><span class="o">.</span><span class="kt">Key</span><span class="o">.</span><span class="n">attachment</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="kt">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">utf16</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span> <span class="p">{</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">effectiveRange</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">attachment</span> <span class="o">=</span> <span class="n">value</span> <span class="k">as?</span> <span class="kt">ZNSTextAttachment</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="n">attachment</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">attributedString</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>å› æ­¤å¤š Extension äº† UIKitï¼Œå¤–éƒ¨åªéœ€ç„¡è…¦ <code class="language-plaintext highlighter-rouge">setHTMLString()</code> å³å¯å®Œæˆç¶å®šã€‚</p><h4 id="è¤‡é›œçš„æ¸²æŸ“é …ç›®-é …ç›®æ¸…å–®"><span class="me-2">è¤‡é›œçš„æ¸²æŸ“é …ç›®â€” é …ç›®æ¸…å–®</span><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®-é …ç›®æ¸…å–®" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é—œæ–¼é …ç›®æ¸…å–®çš„å¯¦ç¾ç´€éŒ„ã€‚</p><p><strong>åœ¨ HTML ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&lt;ol&gt;</code> / <code class="language-plaintext highlighter-rouge">&lt;ul&gt;</code> åŒ…è£ <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code> è¡¨ç¤ºé …ç›®æ¸…å–®:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>ItemA<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>ItemB<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>ItemC<span class="nt">&lt;/li&gt;</span>
    //...
<span class="nt">&lt;/ul&gt;</span>
</pre></table></code></div></div><p>ä½¿ç”¨åŒå‰æ–‡è§£ææ–¹å¼ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ <code class="language-plaintext highlighter-rouge">visit(_ markup: ListItemMarkup)</code> å–å¾—å…¶ä»– list item çŸ¥é“ç•¶å‰ list index (å¾—åˆ©æ–¼æœ‰è½‰æ›æˆ AST)ã€‚</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">ListItemMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">siblingListItems</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span><span class="p">?</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span> <span class="k">is</span> <span class="kt">ListItemMarkup</span> <span class="p">})</span> <span class="p">??</span> <span class="p">[]</span>
  <span class="k">let</span> <span class="nv">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">siblingListItems</span><span class="o">.</span><span class="nf">firstIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">===</span> <span class="n">markup</span> <span class="p">})</span> <span class="p">??</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>NSParagraphStyle æœ‰ä¸€å€‹ NSTextList ç‰©ä»¶å¯ä»¥ç”¨ä¾†é¡¯ç¤º list itemï¼Œä½†æ˜¯åœ¨å¯¦ä½œä¸Šç„¡æ³•å®¢è£½åŒ–ç©ºç™½çš„å¯¬åº¦ (å€‹äººè¦ºå¾—ç©ºç™½å¤ªå¤§)ï¼Œå¦‚æœé …ç›®ç¬¦è™Ÿèˆ‡å­—ä¸²ä¸­é–“æœ‰ç©ºç™½æœƒè®“æ›è¡Œè§¸ç™¼åœ¨æ­¤ï¼Œé¡¯ç¤ºæœƒæœ‰é»å¥‡æ€ªï¼Œå¦‚ä¸‹åœ–:</p><p><a href="/assets/2724f02f6e7/1*jvIgDjO4DNAKpPZF1balmw.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*jvIgDjO4DNAKpPZF1balmw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODYiIGhlaWdodD0iMzkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Beter éƒ¨åˆ†æœ‰æ©Ÿæœƒé€é <a href="https://www.objc.io/issues/9-strings/string-rendering/" target="_blank">è¨­å®š headIndent, firstLineHeadIndent, NSTextTab</a> å¯¦ç¾ï¼Œä½†æ˜¯æ¸¬è©¦ç™¼ç¾å­—ä¸²å¤ªé•·ã€å¤§å°æœ‰è®Šé‚„æ˜¯ç„¡æ³•å®Œç¾å‘ˆç¾çµæœã€‚</p><p>ç›®å‰åªåšåˆ° Acceptableï¼Œè‡ªå·±çµ„åˆé …ç›®æ¸…å–®å­—ä¸² insert åˆ°å­—ä¸²å‰ã€‚</p><p>æˆ‘å€‘åªä½¿ç”¨åˆ° NSTextList.MarkerFormat ç”¨ä¾†ç”¢é …ç›®æ¸…å–®ç¬¦è™Ÿï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ NSTextListã€‚</p><p><strong>æ¸…å–®ç¬¦è™Ÿæ”¯æ´åˆ—è¡¨å¯åƒè€ƒï¼š</strong> <a href="https://github.com/ZhgChgLi/ZMarkupParser/blob/main/Sources/ZMarkupParser/Core/MarkupStyle/MarkupStyleList.swift" target="_blank">MarkupStyleList.swift</a></p><p><strong>æœ€çµ‚é¡¯ç¤ºçµæœï¼š(</strong> <code class="language-plaintext highlighter-rouge">&lt;ol&gt;&lt;li&gt;</code> <strong>)</strong></p><p><a href="/assets/2724f02f6e7/1*yM3VROfUNgnEBfIYwYwPnQ.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*yM3VROfUNgnEBfIYwYwPnQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMTEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="è¤‡é›œçš„æ¸²æŸ“é …ç›®--table"><span class="me-2">è¤‡é›œçš„æ¸²æŸ“é …ç›® â€” Table</span><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®--table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é¡ä¼¼ æ¸…å–®é …ç›®çš„å¯¦ç¾ï¼Œä½†æ˜¯æ˜¯è¡¨æ ¼ã€‚</p><p><strong>åœ¨ HTML ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&lt;table&gt;</code> è¡¨æ ¼-&gt;åŒ…è£ <code class="language-plaintext highlighter-rouge">&lt;tr&gt;</code> è¡¨æ ¼åˆ—-&gt;åŒ…è£ <code class="language-plaintext highlighter-rouge">&lt;td&gt;/&lt;th&gt;</code> è¡¨ç¤ºè¡¨æ ¼æ¬„ä½:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Company<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Contact<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Country<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>Alfreds Futterkiste<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Maria Anders<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Germany<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>Centro comercial Moctezuma<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Francisco Chang<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Mexico<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></table></code></div></div><p>å¯¦æ¸¬åŸç”Ÿçš„ <code class="language-plaintext highlighter-rouge">NSAttributedString.DocumentType.html</code> æ˜¯ç”¨ Private macOS API <code class="language-plaintext highlighter-rouge">NSTextBlock</code> ä¾†å®Œæˆé¡¯ç¤ºï¼Œå› æ­¤èƒ½å®Œæ•´é¡¯ç¤º HTML è¡¨æ ¼æ¨£å¼åŠå…§å®¹ã€‚</p><blockquote><p>æœ‰é»ä½œå¼Šï¼æˆ‘å€‘ç„¡æ³•ç”¨ Private API ğŸ¥²</p></blockquote><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre>    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">TableColumnMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">siblingColumns</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span><span class="p">?</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span> <span class="k">is</span> <span class="kt">TableColumnMarkup</span> <span class="p">})</span> <span class="p">??</span> <span class="p">[]</span>
        <span class="k">let</span> <span class="nv">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">siblingColumns</span><span class="o">.</span><span class="nf">firstIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">===</span> <span class="n">markup</span> <span class="p">})</span> <span class="p">??</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">// æœ‰ç„¡å¾å¤–éƒ¨æŒ‡å®šæƒ³è¦çš„å¯¬åº¦, å¯è¨­ .max ä¸ truncated string</span>
        <span class="k">var</span> <span class="nv">maxLength</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">fixedMaxLength</span>
        <span class="k">if</span> <span class="n">maxLength</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="c1">// æ²’æŒ‡å®šå‰‡æ‰¾åˆ°ç¬¬ä¸€è¡ŒåŒä¸€æ¬„çš„ String length åšç‚º max length</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">tableRowMarkup</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">parentMarkup</span> <span class="k">as?</span> <span class="kt">TableRowMarkup</span><span class="p">,</span>
               <span class="k">let</span> <span class="nv">firstTableRow</span> <span class="o">=</span> <span class="n">tableRowMarkup</span><span class="o">.</span><span class="n">parentMarkup</span><span class="p">?</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">first</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">is</span> <span class="kt">TableRowMarkup</span> <span class="p">})</span> <span class="k">as?</span> <span class="kt">TableRowMarkup</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">firstTableRowColumns</span> <span class="o">=</span> <span class="n">firstTableRow</span><span class="o">.</span><span class="n">childMarkups</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span> <span class="k">is</span> <span class="kt">TableColumnMarkup</span> <span class="p">})</span>
                <span class="k">if</span> <span class="n">firstTableRowColumns</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">firstTableRowColumnAttributedString</span> <span class="o">=</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">firstTableRowColumns</span><span class="p">[</span><span class="n">position</span><span class="p">])</span>
                    <span class="k">let</span> <span class="nv">length</span> <span class="o">=</span> <span class="n">firstTableRowColumnAttributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">utf16</span><span class="o">.</span><span class="n">count</span>
                    <span class="n">maxLength</span> <span class="o">=</span> <span class="n">length</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">maxLength</span> <span class="o">=</span> <span class="n">maxLength</span> <span class="p">{</span>
            <span class="c1">// æ¬„ä½è¶…é maxLength å‰‡ truncated string</span>
            <span class="k">if</span> <span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">utf16</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxLength</span> <span class="p">{</span>
                <span class="n">attributedString</span><span class="o">.</span><span class="n">mutableString</span><span class="o">.</span><span class="nf">setString</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="n">maxLength</span><span class="p">))</span><span class="o">+</span><span class="s">"..."</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">attributedString</span><span class="o">.</span><span class="n">mutableString</span><span class="o">.</span><span class="nf">setString</span><span class="p">(</span><span class="n">attributedString</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="nv">toLength</span><span class="p">:</span> <span class="n">maxLength</span><span class="p">,</span> <span class="nv">withPad</span><span class="p">:</span> <span class="s">" "</span><span class="p">,</span> <span class="nv">startingAt</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">siblingColumns</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="c1">// æ–°å¢ç©ºç™½åšç‚º spacing, å¤–éƒ¨å¯æŒ‡å®š spacing å¯¬åº¦å¹¾å€‹ç©ºç™½å­—</span>
            <span class="n">attributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">makeString</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">markup</span><span class="p">,</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">(</span><span class="nv">repeating</span><span class="p">:</span> <span class="s">" "</span><span class="p">,</span> <span class="nv">count</span><span class="p">:</span> <span class="n">markup</span><span class="o">.</span><span class="n">spacing</span><span class="p">)))</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">attributedString</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">TableRowMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="n">attributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">makeBreakLine</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">markup</span><span class="p">))</span> <span class="c1">// æ–°å¢æ›è¡Œ, è©³ç´°è«‹åƒè€ƒ Source Code</span>
        <span class="k">return</span> <span class="n">attributedString</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">visit</span><span class="p">(</span><span class="n">_</span> <span class="nv">markup</span><span class="p">:</span> <span class="kt">TableMarkup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">attributedString</span> <span class="o">=</span> <span class="nf">collectAttributedString</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="n">attributedString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">makeBreakLine</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">markup</span><span class="p">))</span> <span class="c1">// æ–°å¢æ›è¡Œ, è©³ç´°è«‹åƒè€ƒ Source Code</span>
        <span class="n">attributedString</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">makeBreakLine</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">markup</span><span class="p">),</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// æ–°å¢æ›è¡Œ, è©³ç´°è«‹åƒè€ƒ Source Code</span>
        <span class="k">return</span> <span class="n">attributedString</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><strong>æœ€çµ‚å‘ˆç¾æ•ˆæœå¦‚ä¸‹åœ–ï¼š</strong></p><p><a href="/assets/2724f02f6e7/1*Dft7H2BbeyWIO-dH4QpuSw.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*Dft7H2BbeyWIO-dH4QpuSw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNDMiIGhlaWdodD0iOTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>not perfect, but acceptable.</p><h4 id="è¤‡é›œçš„æ¸²æŸ“é …ç›®--image"><span class="me-2">è¤‡é›œçš„æ¸²æŸ“é …ç›® â€” Image</span><a href="#è¤‡é›œçš„æ¸²æŸ“é …ç›®--image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æœ€çµ‚ä¾†è¬›ä¸€å€‹æœ€å¤§çš„é­”ç‹ï¼Œè¼‰å…¥é ç«¯åœ–ç‰‡åˆ° NSAttributedStringã€‚</p><p><strong>åœ¨ HTML ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code> è¡¨ç¤ºåœ–ç‰‡:</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg"</span> <span class="na">width=</span><span class="s">"300"</span> <span class="na">height=</span><span class="s">"125"</span><span class="nt">/&gt;</span>
</pre></table></code></div></div><p>ä¸¦å¯é€é <code class="language-plaintext highlighter-rouge">width</code> / <code class="language-plaintext highlighter-rouge">height</code> HTML Attribute æŒ‡å®šæƒ³è¦çš„é¡¯ç¤ºå¤§å°ã€‚</p><p>åœ¨ NSAttributedString ä¸­é¡¯ç¤ºåœ–ç‰‡ï¼Œæ¯”æƒ³åƒä¸­è¤‡é›œå¾ˆå¤šï¼›ä¸”æ²’æœ‰å¾ˆå¥½çš„å¯¦ç¾ï¼Œä¹‹å‰åš <a href="/posts/zrealm-dev/ios-uitextview-%E6%96%87%E7%B9%9E%E5%9C%96%E7%B7%A8%E8%BC%AF%E5%99%A8%E9%96%8B%E7%99%BC%E6%94%BB%E7%95%A5-swift-%E5%9C%96%E7%89%87%E6%8F%92%E5%85%A5%E8%88%87%E8%A8%98%E6%86%B6%E9%AB%94%E5%84%AA%E5%8C%96%E5%AF%A6%E6%88%B0-e37d66ea1146/">UITextView æ–‡ç¹åœ–</a> æ™‚æœ‰ç¨å¾®è¸©éå‘ï¼Œä½†é€™æ¬¡åœ¨ç ”ç©¶ä¸€è¼ªç™¼ç¾é‚„æ˜¯æ²’æœ‰ä¸€å€‹å®Œç¾çš„è§£æ±ºæ–¹æ¡ˆã€‚</p><p>ç›®å‰å…ˆå¿½ç•¥ NSTextAttachment åŸç”Ÿä¸èƒ½ reuse é‡‹æ”¾è¨˜æ†¶é«”çš„å•é¡Œï¼Œå…ˆåªå¯¦ç¾å¾é ç«¯ä¸‹è¼‰åœ–ç‰‡æ”¾åˆ° NSTextAttachment åœ¨æ”¾åˆ° NSAttributedString ä¸­ï¼Œä¸¦å¯¦ç¾è‡ªå‹•æ›´æ–°å…§å®¹ã€‚</p><p><strong>æ­¤ç³»åˆ—æ“ä½œåˆå†æ‹†åˆ°å¦ä¸€å€‹å°çš„ Project å¯¦ç¾ï¼Œæƒ³èªªæ—¥å¾Œæ¯”è¼ƒå¥½å„ªåŒ–è·Ÿå¾©ç”¨åˆ°å…¶ä»– Project:</strong></p><p><a href="https://github.com/ZhgChgLi/ZNSTextAttachment" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/5c63c82d77259bfe295dc17bf3eedc073f2e23dbd9598642813af0bcecb5b701/ZhgChgLi/ZNSTextAttachment" alt="" loading="lazy"></a></p><p>ä¸»è¦æ˜¯åƒè€ƒ <a href="https://www.cocoanetics.com/2016/09/asynchronous-nstextattachment-1/" target="_blank">Asynchronous NSTextAttachments</a> é€™ç³»åˆ—æ–‡ç« å¯¦ç¾ï¼Œä½†æ˜¯æ›¿æ›äº†æœ€å¾Œçš„æ›´æ–°å…§å®¹éƒ¨åˆ†(ä¸‹è¼‰å®Œå¾Œè¦åˆ·æ–° UI æ‰æœƒå‘ˆç¾)é‚„æœ‰å¢åŠ  Delegate/DataSource çµ¦å¤–éƒ¨æ“´å……ä½¿ç”¨ã€‚</p><p><a href="/assets/2724f02f6e7/1*JZ8IVVNj9B2l-UBemGbAig.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*JZ8IVVNj9B2l-UBemGbAig.webp" alt="é‹åšæµç¨‹èˆ‡é—œä¿‚å¦‚ä¸Šåœ–" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjYxMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>é‹åšæµç¨‹èˆ‡é—œä¿‚å¦‚ä¸Šåœ–</p><ul><li>å®£å‘Š ZNSTextAttachmentable ç‰©ä»¶ï¼Œå°è£ NSTextStorage ç‰©ä»¶(UITextViewè‡ªå¸¶)åŠ UILabel æœ¬èº« (UILabel ç„¡ NSTextStorage) æ“ä½œæ–¹æ³•åƒ…ç‚ºå¯¦ç¾ replace attributedString from NSRange. ( <code class="language-plaintext highlighter-rouge">func replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment)</code> )<li>å¯¦ç¾åŸç†æ˜¯å…ˆä½¿ç”¨ <code class="language-plaintext highlighter-rouge">ZNSTextAttachment</code> åŒ…è£ imageURLã€PlaceholderImageã€é¡¯è¦é¡¯ç¤ºçš„å¤§å°è³‡è¨Šï¼Œç„¶å¾Œå…ˆç”¨ placeHolder ç›´æ¥é¡¯ç¤ºåœ–ç‰‡<li>ç•¶ ç³»çµ±éœ€è¦æ­¤åœ–ç‰‡åœ¨ç•«é¢æ™‚æœƒå‘¼å« <code class="language-plaintext highlighter-rouge">image(forBoundsâ€¦</code> æ–¹æ³•ï¼Œæ­¤æ™‚æˆ‘å€‘é–‹å§‹ä¸‹è¼‰ Image Data<li>DataSource å‡ºå»è®“å¤–éƒ¨å¯æ±ºå®šæ€éº¼ä¸‹è¼‰æˆ–å¯¦ç¾ Image Cache Policyï¼Œé è¨­ç›´æ¥ä½¿ç”¨ URLSession è«‹æ±‚åœ–ç‰‡ Data<li>ä¸‹è¼‰å®Œæˆå¾Œ new ä¸€å€‹æ–°çš„ <code class="language-plaintext highlighter-rouge">ZResizableNSTextAttachment</code> ä¸¦åœ¨ <code class="language-plaintext highlighter-rouge">attachmentBounds(forâ€¦</code> å¯¦ç¾è‡ªå®šåœ–ç‰‡å¤§å°çš„é‚è¼¯<li>å‘¼å« <code class="language-plaintext highlighter-rouge">replace(attachment: ZNSTextAttachment, to: ZResizableNSTextAttachment)</code> æ–¹æ³•ï¼Œå°‡ <code class="language-plaintext highlighter-rouge">ZNSTextAttachment</code> ä½ç½®æ›¿æ›ç‚º <code class="language-plaintext highlighter-rouge">ZResizableNSTextAttachment</code><li>ç™¼å‡º didLoad Delegate é€šçŸ¥ï¼Œè®“å¤–éƒ¨æœ‰éœ€è¦æ™‚å¯ä¸²æ¥<li>å®Œæˆ</ul><blockquote><p><strong>è©³ç´°ç¨‹å¼ç¢¼å¯åƒè€ƒ <a href="https://github.com/ZhgChgLi/ZNSTextAttachment" target="_blank">Source Code</a></strong> ã€‚</p></blockquote><p>ä¸ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">NSLayoutManager.invalidateLayout(forCharacterRange: range, actualCharacterRange: nil)</code> ã€ <code class="language-plaintext highlighter-rouge">NSLayoutManager.invalidateDisplay(forCharacterRange: range)</code> åˆ·æ–° UI çš„åŸå› æ˜¯ç™¼ç¾ UI æ²’æœ‰æ­£ç¢ºçš„é¡¯ç¤ºæ›´æ–°ï¼›æ—¢ç„¶éƒ½çŸ¥é“æ‰€åœ¨ Range äº†ï¼Œç›´æ¥è§¸ç™¼å–ä»£ NSAttributedStringï¼Œèƒ½ç¢ºä¿ UI æ­£ç¢ºæ›´æ–°ã€‚</p><p>æœ€çµ‚é¡¯ç¤ºçµæœå¦‚ä¸‹ï¼š</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color:red"</span><span class="nt">&gt;</span>ã“ã‚“ã«ã¡ã¯<span class="nt">&lt;/span&gt;</span>ã“ã‚“ã«ã¡ã¯ã“ã‚“ã«ã¡ã¯ <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://user-images.githubusercontent.com/33706588/219608966-20e0c017-d05c-433a-9a52-091bc0cfd403.jpg"</span><span class="nt">/&gt;</span>
</pre></table></code></div></div><p><a href="/assets/2724f02f6e7/1*bl65v-SVOK3H9ajR-Ksg6w.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*bl65v-SVOK3H9ajR-Ksg6w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NTciIGhlaWdodD0iMjQ2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h3 id="testing--continuous-integration"><span class="me-2">Testing &amp; Continuous Integration</span><a href="#testing--continuous-integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>é€™æ¬¡å°ˆæ¡ˆé™¤äº†æ’°å¯« Unit Test å–®å…ƒæ¸¬è©¦ä¹‹å¤–é‚„å»ºç«‹äº† Snapshot Test åšæ•´åˆæ¸¬è©¦æ–¹ä¾¿å°æœ€çµ‚çš„ NSAttributedString åšç¶œè§€çš„æ¸¬è©¦æ¯”è¼ƒã€‚</p><p>ä¸»è¦åŠŸèƒ½é‚è¼¯éƒ½æœ‰ UnitTests ä¸¦åŠ ä¸Šæ•´åˆæ¸¬è©¦ï¼Œæœ€çµ‚ <a href="https://app.codecov.io/gh/ZhgChgLi/ZMarkupParser" target="_blank">Test Coverage</a> åœ¨ <strong>85%</strong> å·¦å³ã€‚</p><p><a href="/assets/2724f02f6e7/1*wV6BZcEGYuT9B9Xy4QzI0w.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*wV6BZcEGYuT9B9Xy4QzI0w.webp" alt="[ZMarkupParser â€” codecov](https://app.codecov.io/gh/ZhgChgLi/ZMarkupParser){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTQiIGhlaWdodD0iMjAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://app.codecov.io/gh/ZhgChgLi/ZMarkupParser" target="_blank">ZMarkupParser â€” codecov</a></p><h4 id="snapshot-test"><span class="me-2">Snapshot Test</span><a href="#snapshot-test" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/pointfreeco/swift-snapshot-testing" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/b3cc52a5b949767e4cb0af82145ed6474334d3235bd785ee1f7891c6b65fd69a/pointfreeco/swift-snapshot-testing" alt="" loading="lazy"></a></p><p><strong>ç›´æ¥å¼•å…¥æ¡†æ¶ä½¿ç”¨:</strong></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">SnapshotTesting</span>
<span class="c1">// ...</span>
<span class="kd">func</span> <span class="nf">testShouldKeppNSAttributedString</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">parser</span> <span class="o">=</span> <span class="kt">ZHTMLParserBuilder</span><span class="o">.</span><span class="nf">initWithDefault</span><span class="p">()</span><span class="o">.</span><span class="nf">build</span><span class="p">()</span>
  <span class="k">let</span> <span class="nv">textView</span> <span class="o">=</span> <span class="kt">UITextView</span><span class="p">()</span>
  <span class="n">textView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">390</span>
  <span class="n">textView</span><span class="o">.</span><span class="n">isScrollEnabled</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="n">textView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
  <span class="n">textView</span><span class="o">.</span><span class="nf">setHtmlString</span><span class="p">(</span><span class="s">"html string..."</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="n">parser</span><span class="p">)</span>
  <span class="n">textView</span><span class="o">.</span><span class="nf">layoutIfNeeded</span><span class="p">()</span>
  <span class="nf">assertSnapshot</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="n">textView</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="nv">record</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</pre></table></code></div></div><p><a href="/assets/2724f02f6e7/1*hLPeaOTOviA0jTPNOPu1hg.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*hLPeaOTOviA0jTPNOPu1hg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzUiIGhlaWdodD0iMzE5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>ç›´æ¥æ¯”å°æœ€çµ‚çµæœæ˜¯å¦ç¬¦åˆé æœŸï¼Œç¢ºä¿èª¿æ•´æ•´åˆèµ·ä¾†æ²’æœ‰ç•°å¸¸ã€‚</p><h4 id="codecov-test-coverage"><span class="me-2">Codecov Test Coverage</span><a href="#codecov-test-coverage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä¸²æ¥ <a href="https://about.codecov.io" target="_blank">Codecov.io</a> (free for Public Repo) è©•ä¼° Test Coverageï¼Œåªéœ€å®‰è£ Codecov Github App &amp; è¨­è¨ˆå³å¯ã€‚</p><p><a href="https://app.codecov.io/gh/ZhgChgLi/ZMarkupParser" target="_blank" class="img-link shimmer" ><img src="https://storage.googleapis.com/codecov-cdn/static/Codecov-icon-600x600.png" alt="" loading="lazy"></a></p><p>Codecov &lt;-&gt; Github Repo è¨­å®šå¥½å¾Œï¼Œä¹Ÿå¯ä»¥åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŠ ä¸Š <code class="language-plaintext highlighter-rouge">codecov.yml</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">comment</span><span class="pi">:</span>                  <span class="c1"># this is a top-level key</span>
  <span class="na">layout</span><span class="pi">:</span> <span class="s2">"</span><span class="s">reach,</span><span class="nv"> </span><span class="s">diff,</span><span class="nv"> </span><span class="s">flags,</span><span class="nv"> </span><span class="s">files"</span>
  <span class="na">behavior</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">require_changes</span><span class="pi">:</span> <span class="kc">false</span>  <span class="c1"># if true: only post the comment if coverage changes</span>
  <span class="na">require_base</span><span class="pi">:</span> <span class="s">no</span>        <span class="c1"># [yes :: must have a base report to post]</span>
  <span class="na">require_head</span><span class="pi">:</span> <span class="s">yes</span>       <span class="c1"># [yes :: must have a head report to post]</span>
</pre></table></code></div></div><p>è¨­å®šæª”ï¼Œé€™æ¨£å¯ä»¥å•Ÿç”¨æ¯å€‹ PR ç™¼å‡ºå¾Œï¼Œè‡ªå‹•æŠŠ CI è·‘çš„çµæœ Comment åˆ°å…§å®¹ã€‚</p><p><a href="/assets/2724f02f6e7/1*AcKpF4dijglahV-iVYLvvA.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*AcKpF4dijglahV-iVYLvvA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjAiIGhlaWdodD0iNTg0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="continuous-integration"><span class="me-2">Continuous Integration</span><a href="#continuous-integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Github Action, CI æ•´åˆ: <code class="language-plaintext highlighter-rouge">ci.yml</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">CI</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">self-hosted</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">spm build and test</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">set -o pipefail</span>
          <span class="s">xcodebuild test -workspace ZMarkupParser.xcworkspace -testPlan ZMarkupParser -scheme ZMarkupParser -enableCodeCoverage YES -resultBundlePath './scripts/TestResult.xcresult' -destination 'platform=iOS Simulator,name=iPhone 14,OS=16.1' build test | xcpretty</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Codecov</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">codecov/codecov-action@v3.1.1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">xcode</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">xcode_archive_path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./scripts/TestResult.xcresult'</span>
</pre></table></code></div></div><p>æ­¤è¨­å®šæ˜¯åœ¨ PR opened/reopend or push main branch æ™‚è·‘ build and test æœ€å¾ŒæŠŠ test coverage å ±å‘Šä¸Šå‚³åˆ° codecov.</p><h4 id="regex"><span class="me-2">Regex</span><a href="#regex" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é—œæ–¼æ­£è¦è¡¨ç¤ºæ³•ï¼Œæ¯ç”¨åˆ°ä¸€æ¬¡å°±åˆå†ç²¾é€²ä¸€æ¬¡ï¼›é€™æ¬¡å¯¦éš›æ²’ç”¨åˆ°å¤ªå¤šï¼Œä½†æ˜¯å› ç‚ºæœ¬ä¾†æƒ³ç”¨ä¸€å€‹æ­£å‰‡æŒ–å‡ºæˆå°çš„ HTML Tag æ‰€ä»¥ä¹Ÿå¤šç ”ç©¶éè¦æ€éº¼æ’°å¯«ã€‚</p><p>ä¸€äº›é€™æ¬¡æ–°å­¸ç¿’çš„ cheat sheet ç­†è¨˜â€¦</p><ul><li><code class="language-plaintext highlighter-rouge">?:</code> å¯ä»¥è®“ ( ) åŒ¹é… group çµæœï¼Œä½†ä¸æœƒæ•ç²è¿”å› e.g. <code class="language-plaintext highlighter-rouge">(?:https?:\/\/)?(?:www\.)?example\.com</code> åœ¨ <code class="language-plaintext highlighter-rouge">https://www,example.com</code> æœƒè¿”å›æ•´å€‹ç¶²å€è€Œä¸æ˜¯ <code class="language-plaintext highlighter-rouge">https://</code> , <code class="language-plaintext highlighter-rouge">www</code><li><code class="language-plaintext highlighter-rouge">.+?</code> éè²ªå©ªçš„åŒ¹é… (æ‰¾åˆ°æœ€è¿‘çš„å°±è¿”å›) e.g. <code class="language-plaintext highlighter-rouge">&lt;.+?&gt;</code> åœ¨ <code class="language-plaintext highlighter-rouge">&lt;a&gt;test&lt;/a&gt;</code> æœƒè¿”å› <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> , <code class="language-plaintext highlighter-rouge">&lt;/a&gt;</code> è€Œéæ•´å€‹å­—ä¸²<li><code class="language-plaintext highlighter-rouge">(?=XYZ)</code> ä»»ä½•å­—ä¸²ç›´åˆ° <code class="language-plaintext highlighter-rouge">XYZ</code> å­—ä¸²å‡ºç¾ï¼›è¦æ³¨æ„ï¼Œå¦ä¸€å€‹èˆ‡ä¹‹ç›¸ä¼¼çš„ <code class="language-plaintext highlighter-rouge">[^XYZ]</code> æ˜¯ä»£è¡¨ä»»ä½•å­—ä¸²ç›´åˆ° <code class="language-plaintext highlighter-rouge">X or Y or Z</code> å­—å…ƒå‡ºç¾ e.g. <code class="language-plaintext highlighter-rouge">(?:__)(.+?(?=__))(?:__)</code> (ä»»ä½•å­—ä¸²ç›´åˆ° <code class="language-plaintext highlighter-rouge">__</code> ) æœƒåŒ¹é…å‡º <code class="language-plaintext highlighter-rouge">test</code><li><code class="language-plaintext highlighter-rouge">?R</code> éè¿´å¾€å…§æ‰¾ä¸€æ¨£è¦å‰‡çš„å€¼ e.g. <code class="language-plaintext highlighter-rouge">\((?:[^()]|((?R)))+\)</code> åœ¨ <code class="language-plaintext highlighter-rouge">(simple) (and(nested))</code> æœƒåŒ¹é…å‡º <code class="language-plaintext highlighter-rouge">(simple)</code> , <code class="language-plaintext highlighter-rouge">(and(nested))</code> , <code class="language-plaintext highlighter-rouge">(nested)</code><li><code class="language-plaintext highlighter-rouge">?&lt;GroupName&gt;</code> â€¦ <code class="language-plaintext highlighter-rouge">\k&lt;GroupName&gt;</code> åŒ¹é…å‰é¢çš„ Group Name e.g. <code class="language-plaintext highlighter-rouge">(?&lt;tagName&gt;&lt;a&gt;).*(\k&lt;GroupName&gt;)</code><li><code class="language-plaintext highlighter-rouge">(?(X)yes|no)</code> ç¬¬ <code class="language-plaintext highlighter-rouge">X</code> å€‹åŒ¹é…çµæœæœ‰å€¼(ä¹Ÿå¯ä»¥ç”¨ Group Name)æ™‚å‰‡åŒ¹é…å¾Œé¢æ¢ä»¶ <code class="language-plaintext highlighter-rouge">yes</code> å¦å‰‡åŒ¹é… <code class="language-plaintext highlighter-rouge">no</code> <strong>Swift æš«æ™‚ä¸æ”¯æ´</strong></ul><p><strong>å…¶ä»– Regex å¥½æ–‡ï¼š</strong></p><ul><li><a href="https://onevcat.com/2022/11/swift-regex/" target="_blank">Swift æ­£åˆ™é€ŸæŸ¥æ‰‹å†Œ</a><li><a href="https://mp.weixin.qq.com/s/i_C4ATnajxRDGlTA8dJDHg" target="_blank">æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ</a> -&gt; <strong>å¾ŒçºŒå„ªåŒ–æ­¤å°ˆæ¡ˆçš„æ­£å‰‡æ•ˆèƒ½æ™‚å¯åƒè€ƒ</strong><li><a href="https://juejin.cn/post/6850418120390082574" target="_blank">Regex éŒ¯èª¤å°è‡´ç„¡çª®å°‹æ‰¾ï¼Œæœ€çµ‚å¼•ç™¼ä¼ºæœå™¨æ•…éšœçš„æ¡ˆä¾‹</a><li><a href="https://regex101.com" target="_blank">Regex101 å³ä¸‹æ–¹å¯æŸ¥è©¢æ‰€æœ‰æ­£å‰‡è¦å‰‡</a></ul><h4 id="swift-package-manager--cocoapods"><span class="me-2">Swift Package Manager &amp; Cocoapods</span><a href="#swift-package-manager--cocoapods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é€™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡é–‹ç™¼ SPM &amp; Cocoapodsâ€¦è »æœ‰è¶£çš„ï¼ŒSPM çœŸçš„æ–¹ä¾¿ï¼›ä½†æ˜¯è¸©åˆ°åŒæ™‚å…©å€‹å°ˆæ¡ˆä¾è³´åŒå€‹å¥—ä»¶çš„è©±ï¼ŒåŒæ™‚é–‹å…©å€‹å°ˆæ¡ˆæœƒæœ‰å…¶ä¸­ä¸€å€‹æ‰¾ä¸åˆ°è©²å¥—ä»¶ç„¶å¾Œ Build ä¸èµ·ä¾†ã€‚ã€‚ã€‚</p><p>Cocoapods æœ‰ä¸Šå‚³ ZMarkupParser ä½†æ²’æ¸¬è©¦æ­£ä¸æ­£å¸¸ï¼Œå› ç‚ºæˆ‘æ˜¯ç”¨ SPM ğŸ˜ã€‚</p><h4 id="chatgpt"><span class="me-2">ChatGPT</span><a href="#chatgpt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å¯¦éš›æ­é…é–‹ç™¼é«”é©—ä¸‹ä¾†ï¼Œè¦ºå¾—åªæœ‰åœ¨å”åŠ©æ½¤ç¨¿ Readme æ™‚æœ€æœ‰ç”¨ï¼›åœ¨é–‹ç™¼ä¸Šç›®å‰æ²’é«”æœƒåˆ°æœ‰æ„Ÿçš„åœ°æ–¹ï¼›å› ç‚ºè©¢å• mid-senior ä»¥ä¸Šçš„å•é¡Œï¼Œä»–ä¹Ÿçµ¦ä¸å‡ºå€‹ç¢ºåˆ‡ç­”æ¡ˆç”šæ˜¯æ˜¯éŒ¯èª¤çš„ç­”æ¡ˆ (æœ‰é‡åˆ°å•ä»–ä¸€äº›æ­£å‰‡è¦å‰‡ï¼Œç­”æ¡ˆä¸å¤ªæ­£ç¢º)ï¼Œæ‰€ä»¥æœ€å¾Œé‚„æ˜¯å›åˆ° Google äººå·¥æ‰¾æ­£ç¢ºè§£ç­”ã€‚</p><p>æ›´ä¸è¦èªªè«‹ä»–å¯« Code äº†ï¼Œé™¤éæ˜¯ç°¡å–®çš„ Code Gen Objectï¼›ä¸ç„¶ä¸è¦å¹»æƒ³ä»–èƒ½ç›´æ¥å®Œæˆæ•´å€‹å·¥å…·æ¶æ§‹ã€‚ <em>(è‡³å°‘ç›®å‰æ˜¯é€™æ¨£ï¼Œæ„Ÿè¦ºå¯« Code é€™å¡Š Copilot å¯èƒ½æ›´æœ‰å¹«åŠ©)</em></p><p>ä½†ä»–å¯ä»¥çµ¦ä¸€äº›çŸ¥è­˜ç›²å€çš„å¤§æ–¹å‘ï¼Œè®“æˆ‘å€‘èƒ½å¿«é€Ÿå¤§ç•¥çŸ¥é“æŸäº›åœ°æ–¹æ‡‰è©²æœƒæ€éº¼åšï¼›æœ‰çš„æ™‚å€™æŒæ¡åº¦å¤ªä½ï¼Œåœ¨ Google åè€Œå¾ˆé›£å¿«é€Ÿå®šä½åˆ°æ­£ç¢ºçš„æ–¹å‘ï¼Œé€™æ™‚å€™ ChatGPT å°±è »æœ‰å¹«åŠ©çš„ã€‚</p><h3 id="è²æ˜"><span class="me-2">è²æ˜</span><a href="#è²æ˜" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>æ­·ç¶“ä¸‰å€‹å¤šæœˆçš„ç ”ç©¶åŠé–‹ç™¼ï¼Œå·²ç–²æ†Šä¸å ªï¼Œä½†é‚„æ˜¯è¦è²æ˜ä¸€ä¸‹æ­¤åšæ³•åƒ…ç‚ºæˆ‘ç ”ç©¶å¾Œå¾—åˆ°çš„å¯è¡Œçµæœï¼Œä¸ä¸€å®šæ˜¯æœ€ä½³è§£ï¼Œæˆ–é‚„æœ‰å¯å„ªåŒ–çš„åœ°æ–¹ï¼Œé€™å°ˆæ¡ˆæ›´åƒæ˜¯ä¸€å€‹æ‹‹ç£šå¼•ç‰ï¼Œå¸Œæœ›èƒ½å¾—åˆ°ä¸€å€‹ Markup Language to NSAttributedString çš„å®Œç¾è§£ç­”ï¼Œ <strong>éå¸¸æ­¡è¿å¤§å®¶è²¢ç»ï¼›æœ‰è¨±å¤šäº‹é …é‚„éœ€è¦ç¾¤çœ¾çš„åŠ›é‡æ‰èƒ½å®Œå–„</strong> ã€‚</p><h3 id="contributing"><span class="me-2">Contributing</span><a href="#contributing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/2724f02f6e7/1*kXjJQnSIJ7x-lSIYtacRrQ.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*kXjJQnSIJ7x-lSIYtacRrQ.webp" alt="[ZMarkupParser](https://github.com/ZhgChgLi/ZMarkupParser){:target=&quot;_blank&quot;} [â­](https://github.com/ZhgChgLi/ZMarkupParser){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNDI5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">ZMarkupParser</a> <a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">â­</a></p><p>é€™é‚Šå…ˆåˆ—ä¸€äº›æ­¤æ™‚æ­¤åˆ»(2023/03/12)æƒ³åˆ°èƒ½æ›´å¥½çš„åœ°æ–¹ï¼Œä¹‹å¾Œæœƒåœ¨ Repo ä¸Šç´€éŒ„ï¼š</p><ol><li>æ•ˆèƒ½/ç®—æ³•çš„å„ªåŒ–ï¼Œé›–ç„¶æ¯”åŸç”Ÿ <code class="language-plaintext highlighter-rouge">NSAttributedString.DocumentType.html</code> å¿«é€Ÿä¸”ç©©å®šï¼›ä½†é‚„æœ‰éœ€å¤šå„ªåŒ–ç©ºé–“ï¼Œæˆ‘ç›¸ä¿¡æ•ˆèƒ½çµ•å°ä¸å¦‚ XMLParserï¼›å¸Œæœ›æœ‰æœä¸€æ—¥èƒ½æœ‰åŒæ¨£çš„æ•ˆèƒ½ä½†åˆèƒ½ä¿æŒå®¢è£½åŒ–åŠè‡ªå‹•ä¿®æ­£å®¹éŒ¯<li>æ”¯æ´æ›´å¤š HTML Tagã€Style Attribute è½‰æ›è§£æ<li><a href="https://github.com/ZhgChgLi/ZNSTextAttachment" target="_blank">ZNSTextAttachment</a> å†å„ªåŒ–ï¼Œå¯¦ç¾ reuse èƒ½ï¼Œé‡‹æ”¾è¨˜æ†¶é«”ï¼›å¯èƒ½è¦ç ”ç©¶ CoreText<li>æ”¯æ´ Markdown è§£æï¼Œå› åº•å±¤æŠ½è±¡å…¶å¯¦ä¸å±€é™æ–¼ HTMLï¼›æ‰€ä»¥åªè¦å»ºå¥½å‰é¢çš„ Markdown è½‰ Markup ç‰©ä»¶å°±èƒ½å®Œæˆ Markdown è§£æï¼›å› æ­¤æˆ‘å–åå« ZMarkupParserï¼Œè€Œä¸æ˜¯ ZHTMLParserï¼Œå°±æ˜¯å¸Œæœ›æœ‰æœä¸€æ—¥ä¹Ÿèƒ½æ”¯æ´ Markdown to NSAttributedString<li>æ”¯æ´ Any to Any, e.g. HTML To Markdown, Markdown To HTMLï¼Œå› æˆ‘å€‘æœ‰åŸå§‹çš„ AST æ¨¹(Markup ç‰©ä»¶)ï¼Œæ‰€ä»¥å¯¦ç¾ä»»æ„ Markup é–“çš„è½‰æ›æ˜¯æœ‰æ©Ÿæœƒçš„<li>å¯¦ç¾ css <code class="language-plaintext highlighter-rouge">!important</code> åŠŸèƒ½ï¼ŒåŠ å¼·æŠ½è±¡ MarkupStyle çš„ç¹¼æ‰¿ç­–ç•¥<li>åŠ å¼· HTML Selector åŠŸèƒ½ï¼Œç›®å‰åªæ˜¯æœ€ç²—æ·ºçš„ filter åŠŸèƒ½<li>å¥½å¤šå¥½å¤š, æ­¡è¿é–‹ <a href="https://github.com/ZhgChgLi/ZMarkupParser/issues" target="_blank">issue</a></ol><blockquote><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">å¦‚æœæ‚¨å¿ƒæœ‰é¤˜è€ŒåŠ›ä¸è¶³ï¼Œä¹Ÿå¯ä»¥é€éçµ¦æˆ‘ä¸€é¡† â­ è®“ Repo å¯ä»¥è¢«æ›´å¤šäººçœ‹è¦‹ï¼Œé€²è€Œè®“ Github å¤§ç¥æœ‰æ©Ÿæœƒå”åŠ©è²¢ç»ï¼</a></p></blockquote><h3 id="ç¸½çµ"><span class="me-2">ç¸½çµ</span><a href="#ç¸½çµ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/1*A0yXupXW9-F9ZWe4gp2ObA.webp" alt="[ZMarkupParser](https://github.com/ZhgChgLi/ZMarkupParser){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgwIiBoZWlnaHQ9IjY0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/ZMarkupParser" target="_blank">ZMarkupParser</a></p><p>ä»¥ä¸Šå°±æ˜¯æˆ‘é–‹ç™¼ ZMarkupParser çš„æ‰€æœ‰æŠ€è¡“ç´°ç¯€åŠå¿ƒè·¯æ­·ç¨‹ï¼ŒèŠ±è²»äº†æˆ‘å¿«ä¸‰å€‹æœˆçš„ä¸‹ç­åŠå‡æ—¥æ™‚é–“ï¼Œç„¡æ•¸çš„ç ”ç©¶åŠå¯¦è¸éç¨‹ï¼Œåˆ°æ’°å¯«æ¸¬è©¦ã€æå‡ Test Coverageã€å»ºç«‹ CIï¼›æœ€å¾Œæ‰æœ‰ä¸€å€‹çœ‹èµ·ä¾†æœ‰é»æ¨£å­çš„æˆæœï¼›å¸Œæœ›é€™å€‹å·¥å…·æœ‰è§£æ±ºæ‰æœ‰ç›¸åŒå›°æ“¾çš„æœ‹å‹ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶èƒ½ä¸€èµ·è®“é€™å€‹å·¥å…·è®Šå¾—æ›´å¥½ã€‚</p><p><a href="/assets/2724f02f6e7/0*9YdJaNSQXlAfmT21.webp" class="popup img-link blur"><img data-src="/assets/2724f02f6e7/0*9YdJaNSQXlAfmT21.webp" alt="[pinkoi.com](https://www.pinkoi.com){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAiIGhlaWdodD0iMTg4Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://www.pinkoi.com" target="_blank">pinkoi.com</a></p><p>ç›®å‰æœ‰æ‡‰ç”¨åœ¨æ•å¸ <a href="https://www.pinkoi.com" target="_blank">pinkoi.com</a> çš„ iOS ç‰ˆ App ä¸Šï¼Œæ²’æœ‰ç™¼ç¾å•é¡Œã€‚ğŸ˜„</p><h4 id="å»¶ä¼¸é–±è®€"><span class="me-2">å»¶ä¼¸é–±è®€</span><a href="#å»¶ä¼¸é–±è®€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="/posts/zrealm-dev/zmarkupparser-swift-html-string-%E8%BD%89-nsattributedstring-%E5%B7%A5%E5%85%B7-%E6%94%AF%E6%8F%B4%E5%AE%A2%E8%A3%BD%E6%A8%A3%E5%BC%8F%E8%88%87%E9%AB%98%E6%95%88%E8%83%BD%E6%B8%B2%E6%9F%93-a5643de271e4/">ZMarkupParser HTML String è½‰æ› NSAttributedString å·¥å…·</a><li><a href="https://www.objc.io/issues/9-strings/string-rendering/" target="_blank">String Rendering</a><li><a href="https://www.cocoanetics.com/2016/09/asynchronous-nstextattachment-1/" target="_blank">Asynchronous NSTextAttachments</a></ul><p>æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ <a href="https://www.zhgchg.li/contact" target="_blank">èˆ‡æˆ‘è¯çµ¡</a> ã€‚</p><script src="/assets/clipboard.min.js"></script><div style=" display:flex; align-items:center; gap:10px; border:1px solid #e5e7eb; background:#f9fafb; padding:12px 16px; border-radius:12px; margin:18px 0; box-shadow:0 3px 8px rgba(0,0,0,0.05); width: auto;"> <input id="share-url" value="https://zhgchg.li/posts/zrealm-dev/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%89%E6%8F%9B-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3-2724f02f6e7/" readonly="" style=" flex:1; border:1px solid #d1d5db; border-radius:8px; padding:10px 12px; font-size:0.9rem; background:#ffffff; color:#111827; outline:none; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; " /> <button class="btn" data-clipboard-target="#share-url" id="copy-btn" style=" border:none; background:#3b82f6; color:white; padding:10px 16px; border-radius:10px; cursor:pointer; font-size:0.85rem; font-weight:600; display:flex; align-items:center; gap:6px; transition:all .15s ease; box-shadow:0 2px 5px rgba(59,130,246,0.35); " onmouseover="this.style.opacity='0.92';" onmouseout="this.style.opacity='1';"> <span style="font-size:1rem;">ğŸ”—</span> <span id="copy-btn-text">Copy link to share!</span> </button></div><script> new ClipboardJS('.btn'); var btn = document.getElementById("copy-btn"); var text = document.getElementById("copy-btn-text"); btn.addEventListener("click", function () { text.textContent = "Copied!"; btn.style.background = "#16a34a"; btn.style.boxShadow = "0 2px 6px rgba(22,163,74,0.35)"; setTimeout(() => { text.textContent = "Copy link to share!"; btn.style.background = "#3b82f6"; btn.style.boxShadow = "0 2px 5px rgba(59,130,246,0.35)"; }, 1500); });</script><hr /><p><a href="https://www.paypal.com/ncp/payment/CMALMPT8UUTY2" target="_blank" rel="noopener" style="display:block;margin:12px 0;text-align:center;align-items:center;justify-content:center;padding:10px 22px;border-radius:999px;text-decoration:none;background:linear-gradient(135deg,#ffd54f,#ffb300);color:#000;font-size:16px;font-weight:700;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;box-shadow:0 4px 10px rgba(0,0,0,.15);cursor:pointer;transition:all .15s ease;width:350px" onmouseover="this.style.background=&quot;linear-gradient(135deg,#FFE082,#FFC107)&quot;,this.style.transform=&quot;translateY(-1px)&quot;,this.style.boxShadow=&quot;0 6px 14px rgba(0,0,0,0.2)&quot;" onmouseout="this.style.background=&quot;linear-gradient(135deg,#FFD54F,#FFB300)&quot;,this.style.transform=&quot;translateY(0)&quot;,this.style.boxShadow=&quot;0 4px 10px rgba(0,0,0,0.15)&quot;">ğŸº Buy me a beer on PayPal</a></p><blockquote class="prompt-info"><p>æœ¬æ–‡é¦–æ¬¡ç™¼è¡¨æ–¼ Medium (<a href="https://medium.com/p/2724f02f6e7" target="_blank"><strong>é»æ­¤æŸ¥çœ‹åŸå§‹ç‰ˆæœ¬</strong></a>)ï¼Œç”± <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> æä¾›è‡ªå‹•è½‰æ›èˆ‡åŒæ­¥æŠ€è¡“ã€‚</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2023-03-11-2724f02f6e7.md" target="_blank">Improve this page on Github.</a></p></blockquote><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1,049+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/html-parsing/" class="post-tag no-text-decoration" >html-parsing</a> <a href="/tags/nsattributedstring/" class="post-tag no-text-decoration" >nsattributedstring</a> <a href="/tags/html/" class="post-tag no-text-decoration" >html</a> <a href="/tags/rendering/" class="post-tag no-text-decoration" >rendering</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%20HTML%20%E8%A7%A3%E6%9E%90%E5%99%A8%EF%BD%9CSwift%20%E8%BD%89%E6%8F%9B%20HTML%20%E5%AD%97%E4%B8%B2%E6%88%90%20NSAttributedString%20%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2F%25E6%2589%258B%25E5%25B7%25A5%25E6%2589%2593%25E9%2580%25A0%25E9%25AB%2598%25E6%2595%2588-html-%25E8%25A7%25A3%25E6%259E%2590%25E5%2599%25A8-swift-%25E8%25BD%2589%25E6%258F%259B-html-%25E5%25AD%2597%25E4%25B8%25B2%25E6%2588%2590-nsattributedstring-%25E6%258A%2580%25E8%25A1%2593%25E8%25A9%25B3%25E8%25A7%25A3-2724f02f6e7%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%20HTML%20%E8%A7%A3%E6%9E%90%E5%99%A8%EF%BD%9CSwift%20%E8%BD%89%E6%8F%9B%20HTML%20%E5%AD%97%E4%B8%B2%E6%88%90%20NSAttributedString%20%E6%8A%80%E8%A1%93%E8%A9%B3%E8%A7%A3%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2F%25E6%2589%258B%25E5%25B7%25A5%25E6%2589%2593%25E9%2580%25A0%25E9%25AB%2598%25E6%2595%2588-html-%25E8%25A7%25A3%25E6%259E%2590%25E5%2599%25A8-swift-%25E8%25BD%2589%25E6%258F%259B-html-%25E5%25AD%2597%25E4%25B8%25B2%25E6%2588%2590-nsattributedstring-%25E6%258A%2580%25E8%25A1%2593%25E8%25A9%25B3%25E8%25A7%25A3-2724f02f6e7%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2F%25E6%2589%258B%25E5%25B7%25A5%25E6%2589%2593%25E9%2580%25A0%25E9%25AB%2598%25E6%2595%2588-html-%25E8%25A7%25A3%25E6%259E%2590%25E5%2599%25A8-swift-%25E8%25BD%2589%25E6%258F%259B-html-%25E5%25AD%2597%25E4%25B8%25B2%25E6%2588%2590-nsattributedstring-%25E6%258A%2580%25E8%25A1%2593%25E8%25A9%25B3%25E8%25A7%25A3-2724f02f6e7%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/ci-cd-explained-boost-ios-app-development-stability-and-efficiency-tool-selection-guide-c008a9e8ceca/">CI/CD Explained: Boost iOS App Development Stability and Efficiencyï½œTool Selection Guide</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/ci-cd-%E6%98%AF%E4%BB%80%E4%B9%88-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A8%B3%E5%AE%9A%E5%BC%80%E5%8F%91%E5%9B%A2%E9%98%9F%E7%9A%84%E5%85%B3%E9%94%AE%E6%B5%81%E7%A8%8B%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9-c008a9e8ceca/">CI/CD å®æˆ˜æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€è¿‡ CI/CD æ‰“é€ ç¨³å®šé«˜æ•ˆçš„å¼€å‘å›¢é˜Ÿï¼Ÿå·¥å…·é€‰æ‹©ï¼Ÿ</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/">CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€éº¼ï¼Ÿå¦‚ä½•é€é CI/CD æ‰“é€ ç©©å®šé«˜æ•ˆçš„é–‹ç™¼åœ˜éšŠï¼Ÿå·¥å…·é¸æ“‡ï¼Ÿ</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/en/google-apps-script-web-app-integrate-forms-with-github-actions-ci-cd-for-streamlined-workflows-4cb4437818f2/">Google Apps Script Web Appï½œIntegrate Forms with GitHub Actions CI/CD for Streamlined Workflows</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-dev/zh-cn/google-apps-script-web-app-%E6%89%93%E9%80%A0-github-action-ci-cd-%E8%87%AA%E8%AE%A2%E8%A1%A8%E5%8D%95%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87-4cb4437818f2/">ä½¿ç”¨ Google Apps Script Web App è¡¨å•ä¸²æ¥ Github Action CI/CD å·¥ä½œ</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Chapters ğŸ”–</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%AC%E6%8D%A2-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3-2724f02f6e7/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1678554562" data-df="ll" > Mar 12, 2023 </time><h4 class="pt-0 my-2">æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½¬æ¢ HTML å­—ä¸²æˆ NSAttributedString æŠ€æœ¯è¯¦è§£</h4><div class="text-muted"><p>é’ˆå¯¹ iOS å¼€å‘è€…é¢ä¸´ HTML è½¬ NSAttributedString é—ªé€€ä¸æ•ˆèƒ½ç“¶é¢ˆï¼Œæä¾› Regex è§£æã€Tokenizationã€AST å»ºæ„åŠæ ·å¼ç»§æ‰¿ç­‰å®Œæ•´è§£æ³•ï¼Œå®ç°é«˜æ•ˆä¸”å¯æ‰©å……çš„å­—ä¸²æ¸²æŸ“å¼•æ“ï¼Œæå‡ UI æµç•…åº¦ä¸ç¨³å®šæ€§ã€‚</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/html-parsing-techniques-build-custom-parsers-for-nsattributedstring-rendering-2724f02f6e7/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1678554562" data-df="ll" > Mar 12, 2023 </time><h4 class="pt-0 my-2">HTML Parsing Techniquesï½œBuild Custom Parsers for NSAttributedString Rendering</h4><div class="text-muted"><p>Discover how to transform HTML into NSAttributedString with a custom-built ZMarkupParser engine, solving rendering challenges and enhancing text display precision for iOS developers.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/ios-nsattributedstring-html-render-%E8%87%AA%E8%A1%8C%E5%AF%A6%E7%8F%BE-%E8%A7%A3%E6%B1%BA%E9%96%83%E9%80%80%E8%88%87%E6%95%88%E8%83%BD%E7%93%B6%E9%A0%B8-a8c2d26cc734/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1654791119" data-df="ll" > Jun 10, 2022 </time><h4 class="pt-0 my-2">iOS NSAttributedString HTML Render è‡ªè¡Œå¯¦ç¾ï½œè§£æ±ºé–ƒé€€èˆ‡æ•ˆèƒ½ç“¶é ¸</h4><div class="text-muted"><p>é‡å° iOS NSAttributedString HTML è§£æé–ƒé€€èˆ‡æ•ˆèƒ½å·®å•é¡Œï¼Œæä¾›ç´” Swift XMLParser è‡ªè¡Œå¯¦ç¾ HTML Render æŠ€è¡“ï¼Œé¿å…ä¸»ç·šç¨‹é˜»å¡ï¼Œæå‡æ¸²æŸ“é€Ÿåº¦é” 5~20 å€ï¼Œä¸¦æ”¯æ´è‡ªè¨‚æ¨™ç±¤æ¨£å¼èˆ‡æ“´å……ï¼Œç¢ºä¿ç©©å®šä¸”å¯ç¶­è­·çš„æ–‡å­—æ¸²æŸ“é«”é©—ã€‚</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/zh-cn/%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88-html-%E8%A7%A3%E6%9E%90%E5%99%A8-swift-%E8%BD%AC%E6%8D%A2-html-%E5%AD%97%E4%B8%B2%E6%88%90-nsattributedstring-%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3-2724f02f6e7/" class="btn btn-outline-primary" aria-label="Older" ><p>æ‰‹å·¥æ‰“é€ é«˜æ•ˆ HTML è§£æå™¨ï½œSwift è½¬æ¢ HTML å­—ä¸²æˆ NSAttributedString æŠ€æœ¯è¯¦è§£</p></a> <a href="/posts/zrealm-dev/en/zmediumtojekyll-seamlessly-migrate-and-sync-medium-posts-to-jekyll-blogs-e7c547a5be22/" class="btn btn-outline-primary" aria-label="Newer" ><p>ZMediumToJekyllï½œSeamlessly Migrate and Sync Medium Posts to Jekyll Blogs</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">æ­£é«”ä¸­æ–‡</a> | <a href="/tags/simplified-chinese">ç®€ä½“ä¸­æ–‡</a> | <a href="/tags/english/">English</a> <br/> Last updated: 2025-12-22 22:17:30 +08:00</p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
