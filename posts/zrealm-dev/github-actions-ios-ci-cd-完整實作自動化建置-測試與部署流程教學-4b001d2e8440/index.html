<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="針對iOS開發者打造的GitHub Actions CI/CD流程，解決手動建置與測試繁瑣問題，結合Fastlane與Firebase實現自動化打包與部署，提升團隊開發效率與產品品質。" /><meta property="og:description" content="針對iOS開發者打造的GitHub Actions CI/CD流程，解決手動建置與測試繁瑣問題，結合Fastlane與Firebase實現自動化打包與部署，提升團隊開發效率與產品品質。" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-07-07T23:02:24+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" /><meta property="twitter:title" content="GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2025-07-12T10:52:21+08:00","datePublished":"2025-07-07T23:02:24+08:00","description":"針對iOS開發者打造的GitHub Actions CI/CD流程，解決手動建置與測試繁瑣問題，結合Fastlane與Firebase實現自動化打包與部署，提升團隊開發效率與產品品質。","headline":"GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/"},"url":"https://zhgchg.li/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/"}</script><title>GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學 | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/zrealm-dev/en/github-actions-ios-app-ci-cd-workflow-automation-for-faster-builds-and-deployments-4b001d2e8440/"><link rel="alternate" hreflang="zh-Hans" href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AE%9E%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%A6-4b001d2e8440/"><link rel="alternate" hreflang="zh-Hant" href="/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/"><link rel="alternate" hreflang="x-default" href="/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"如何利用 GitHub Actions 建置 iOS App 的 CI/CD 流程以提升自動化效率？","acceptedAnswer":{"@type":"Answer","text":"透過 GitHub Actions 搭配 Fastlane、Mint、Bundle 等工具，設定自動化測試、建置與部署流程，可實現 Pull Request 觸發測試、手動或排程觸發打包部署，確保程式碼品質並快速發布至 Firebase App Distribution。"}},{"@type":"Question","name":"使用 self-hosted Runner 執行 iOS CI/CD 有哪些注意事項？","acceptedAnswer":{"@type":"Answer","text":"自建 macOS Runner 除了節省 GitHub Hosted Runner 高昂費用，需注意多 Runner 共享依賴資料夾可能衝突，模擬器需為每個 Runner 分別建立獨立裝置避免互搶，並且在 Workflow 中指定相對應的模擬器名稱確保測試穩定。"}},{"@type":"Question","name":"如何在 GitHub Actions 中管理 iOS 開發憑證與 App Store Connect API Key？","acceptedAnswer":{"@type":"Answer","text":"將憑證與 API Key 轉成 Base64 編碼後存入 GitHub Secrets，Workflow 中動態解碼並匯入 Keychain 及指定路徑，Fastlane 可直接引用這些檔案進行簽名與上傳，確保 CI/CD 流程安全且自動化。"}},{"@type":"Question","name":"如何利用 GitHub Actions 實現 Pull Request 觸發的單元測試與結果回饋？","acceptedAnswer":{"@type":"Answer","text":"設定 Workflow 在 Pull Request 開啟或更新時執行 Fastlane 單元測試，並透過 action-junit-report 解析測試報告，自動在 PR 留下測試成功或失敗的評論，結合 Branch Protection Rules 強制通過測試才能合併，提升程式碼品質。"}},{"@type":"Question","name":"如何設計 GitHub Actions Workflow 以支援分離建置與部署，提升 CI/CD 彈性？","acceptedAnswer":{"@type":"Answer","text":"將建置與部署拆分為獨立 Workflow，建置完成後上傳 Artifact，部署 Workflow 下載 Artifact 後執行部署，透過 workflow_run 事件串接兩者，避免重複建置並方便多平台部署，提升整體 CI/CD 流程的彈性與維護性。"}}]} </script><link rel="stylesheet" href="/assets/css/post-toc.css"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan 🇹🇼 who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學</h1><p class="post-desc fw-light mb-4">針對iOS開發者打造的GitHub Actions CI/CD流程，解決手動建置與測試繁瑣問題，結合Fastlane與Firebase實現自動化打包與部署，提升團隊開發效率與產品品質。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1751900544" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 7, 2025 </time> </span> <span> Updated <time data-ts="1752288741" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 12, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" class="popup img-link preview-img blur"><img data-src="/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="11619 words" > <em>64 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">章節 (Chapters)🔖</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">GitHub Actions iOS CI/CD｜完整實作自動化建置、測試與部署流程教學</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/en/github-actions-ios-app-ci-cd-workflow-automation-for-faster-builds-and-deployments-4b001d2e8440/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AE%9E%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%A6-4b001d2e8440/"><strong>点击这里</strong></a>查看本文章简体中文版本。</p></blockquote><blockquote class="prompt-info"><p>基於 SEO 考量，本文標題與描述經 AI 調整，原始版本請參考內文。</p></blockquote><h4 id="zhgchgli-table-of-contents">文章目錄</h4><nav class="zhgchgli-toc"><ul class="zhgchgli-toc-list"><li class="has-children"><details><summary>CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程 <a href="#cicd-實戰指南三使用-github-actions-實作-app-ios-ci-與-cd-工作流程">#</a></summary><ul><li><a href="#前言">前言</a></li></ul></details></li><li class="has-children"><details><summary>App CI/CD 流程關係圖 <a href="#app-cicd-流程關係圖">#</a></summary><ul><li><a href="#運作流程">運作流程</a></li><li><a href="#github-actions-成果圖">GitHub Actions 成果圖</a></li></ul></details></li><li><a href="#github-actions-x-self-hosted-runner-基礎知識">GitHub Actions x Self-hosted Runner 基礎知識</a></li><li class="has-children"><details><summary>iOS Demo 專案的 Infra 架構 <a href="#ios-demo-專案的-infra-架構">#</a></summary><ul><li><a href="#mint">Mint</a></li><li><a href="#bundle">Bundle</a></li><li><a href="#cocoapods">Cocoapods</a></li><li><a href="#xcodegen">XCodeGen</a></li><li><a href="#fastlane">Fastlane</a></li><li><a href="#fastlane--match">Fastlane — Match</a></li><li><a href="#makefile">Makefile</a></li></ul></details></li><li><a href="#本篇-github-actions-cicd-案例">本篇 GitHub Actions CI/CD 案例</a></li><li class="has-children"><details><summary>CI — 發 Pull Request 執行單元測試 <a href="#ci--發-pull-request-執行單元測試">#</a></summary><ul><li><a href="#流程">流程</a></li><li><a href="#ci-testingyml">CI-Testing.yml</a></li><li><a href="#github-流程設定">GitHub 流程設定</a></li></ul></details></li><li class="has-children"><details><summary>CD — 打包+部署到 Firebase App Distribution <a href="#cd--打包部署到-firebase-app-distribution">#</a></summary><ul><li><a href="#流程-1">流程</a></li><li><a href="#cd-deployyml">CD-Deploy.yml</a></li><li><a href="#技術細節--firebase-cli-token-取得設定">技術細節 — Firebase CLI Token 取得＆設定</a></li><li><a href="#技術細節--install-the-apple-certificate-and-provisioning-profile">技術細節 — Install the Apple certificate and provisioning profile</a></li><li><a href="#技術細節-app-store-connect-api-key">技術細節 —App Store Connect API Key</a></li><li><a href="#技術延伸--reuse-action-workflow-拆分打包和部署動作">技術延伸 — Reuse Action Workflow 拆分打包和部署動作</a></li><li><a href="#github-actions--artifact">GitHub Actions — Artifact</a></li></ul></details></li><li class="has-children"><details><summary>CI— Nightly Build 執行快照+單元測試+打包+CD 部署到 Firebase App Distribution <a href="#ci-nightly-build-執行快照單元測試打包cd-部署到-firebase-app-distribution">#</a></summary><ul><li><a href="#流程-2">流程</a></li><li><a href="#ci-nightly-build-and-deployyml">CI-Nightly-Build-And-Deploy.yml</a></li><li><a href="#技術細節">技術細節</a></li></ul></details></li><li class="has-children"><details><summary>Self-hosted Runner 注意事項 <a href="#self-hosted-runner-注意事項">#</a></summary><ul><li><a href="#多個-runner-在同台機器的模擬器設定">多個 Runner 在同台機器的模擬器設定</a></li><li><a href="#完整專案-repo">完整專案 Repo</a></li></ul></details></li><li class="has-children"><details><summary>補充 SSH Agent 設定 — For Fastlane Match or Private CocoaPods Repo <a href="#補充-ssh-agent-設定--for-fastlane-match-or-private-cocoapods-repo">#</a></summary><ul><li><a href="#step-1-產生-ssh-key">Step 1. 產生 SSH Key</a></li><li><a href="#step-2-到-private-repo-設定-deploy-key">Step 2. 到 Private Repo 設定 Deploy Key</a></li><li><a href="#step-3-回-action-的-repo-設定-ssh-private-key-to-secrets">Step 3. 回 Action 的 Repo 設定 SSH Private Key to Secrets</a></li><li><a href="#step-4-ssh-agent-設定完成來驗證一下-git-clone-private-repo-的權限">Step 4. SSH Agent 設定完成，來驗證一下 Git Clone Private Repo 的權限</a></li></ul></details></li><li><a href="#總結">總結</a></li><li class="has-children"><details><summary>系列文章 <a href="#系列文章">#</a></summary><ul><li><a href="#buy-me-a-coffee">Buy me a coffee</a></li></ul></details></li></ul></nav><hr /><h3 id="cicd-實戰指南三使用-github-actions-實作-app-ios-ci-與-cd-工作流程"><span class="me-2">CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App iOS CI 與 CD 工作流程</span><a href="#cicd-實戰指南三使用-github-actions-實作-app-ios-ci-與-cd-工作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>iOS App 自動化建置、測試、部署的 GitHub Actions 實作步驟完整教學</p><p><a href="/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.webp" alt="Photo by [Robs](https://unsplash.com/@robinne?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@robinne?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" target="_blank">Robs</a></p><h4 id="前言"><span class="me-2">前言</span><a href="#前言" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前篇「 <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"><strong>CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全</strong></a> 」我們介紹了 GitHub Actions 的基礎知識與運作流程還有如何使用自己的機器當成 Runner、帶大家實現了三個簡單的自動化 Actions； <strong>本篇將深入著重在現實使用 GitHub Actions 建置 App (iOS) CI/CD 工作流程上</strong> ，一樣手把手帶大家一步一步完成並一邊補足 GitHub Actions 相關知識。</p><h3 id="app-cicd-流程關係圖"><span class="me-2">App CI/CD 流程關係圖</span><a href="#app-cicd-流程關係圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/4b001d2e8440/1*VRygfRAkBRNEDAC4RyGzRA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*VRygfRAkBRNEDAC4RyGzRA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU3MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>本篇將關注在 GitHub Actions 建置 CI/CD 的區塊，下一篇「 <a href="/posts/zrealm-dev/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9C%98%E9%9A%8A%E6%95%88%E7%8E%87-4273e57e7148/">CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台</a> 」才會介紹右半部分的使用 Google Apps Script Web App 建置跨團隊協作打包平台。</p><h4 id="運作流程"><span class="me-2">運作流程：</span><a href="#運作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>GitHub Actions 開 Pull Request 觸發 or 表單觸發 or 定時觸發<li>執行對應 Workflow Jobs/Steps<li>Step 執行對應 Fastlane (iOS) or (Android Gradle) 腳本<li>Fastlane 執行對應 xcodebuild (iOS) 指令<li>取得執行結果<li>後續 Workflow Jobs/Steps 處理結果<li>完成</ol><h4 id="github-actions-成果圖"><span class="me-2">GitHub Actions 成果圖</span><a href="#github-actions-成果圖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>先上最終成果給大家一點實作動力！</p><p><a href="/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.webp" alt="[CI Testing](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTEiIGhlaWdodD0iNTY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">CI Testing</a></p><p><a href="/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.webp" alt="[CI Nightly Build, CD Deploy](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747" target="_blank">CI Nightly Build, CD Deploy</a></p><h3 id="github-actions-x-self-hosted-runner-基礎知識"><span class="me-2">GitHub Actions x Self-hosted Runner 基礎知識</span><a href="#github-actions-x-self-hosted-runner-基礎知識" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果你對 GitHub Actions 與架設 Self-hosted Runner 還不熟悉強烈建議先看過上篇「 <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"><strong>CI/CD 實戰指南（二）：GitHub Actions 與 Self-hosted Runner 使用與建置大全</strong></a> 」或是搭配上篇知識一起實作。</p><blockquote><p><strong><em>實作開始！</em></strong></p></blockquote><h3 id="ios-demo-專案的-infra-架構"><span class="me-2">iOS Demo 專案的 Infra 架構</span><a href="#ios-demo-專案的-infra-架構" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/5952f3220c95ced947b9ee50d9c542b2edbb424be50c51c582cb226ce5f5df63/ZhgChgLi/github-actions-ci-cd-demo" alt="" loading="lazy"></a></p><p><strong>本文用到的 iOS 專案內容包含測試項目都是用 AI 產生的</strong> ，不需在意 iOS 的程式細節，只針對 Infra &amp; CI/CD 部分做討論。</p><blockquote><p><strong><em>以下工具只是憑以往經驗，如果是新專案可以考慮使用更新的 <a href="https://github.com/jdx/mise" target="_blank">mise</a> 和 <a href="https://github.com/tuist/tuist" target="_blank">tuist</a> 。</em></strong></p></blockquote><h4 id="mint"><span class="me-2">Mint</span><a href="#mint" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/yonaskolb/Mint" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/cfba5c7658c860d0ee4e97df8176a3fc6bbfd9f84c2e8334eaa30988c2700d63/yonaskolb/Mint" alt="" loading="lazy"></a></p><p>Mint 工具可以幫我們統一管理依賴工具的版本(Gemfile 只能管理 Ruby Gems)，例如 XCodeGen、XCodeGen、SwiftFormat、SwiftLint、Periphery</p><p>…etc</p><p><strong>Mintfile:</strong></p><div class="language-graphql highlighter-rouge"><div class="code-header"> <span data-label-text="GraphQL"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="err">yonaskolb/Mint@0.17.5</span><span class="w">
</span><span class="err">yonaskolb/XcodeGen@2.35.0</span><span class="w">
</span><span class="err">nicklockwood/SwiftFormat@0.51.13</span><span class="w">
</span></pre></table></code></div></div><p>這邊我們只用到三個。</p><blockquote><p><strong><em>覺得太複雜不使用也可以，直接在 Action Workflow Step 中用 brew install 安裝需要的工具即可。</em></strong></p></blockquote><h4 id="bundle"><span class="me-2">Bundle</span><a href="#bundle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Gemfile:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">source</span> <span class="s1">'https://rubygems.org'</span>
gem <span class="s1">'cocoapods'</span>, <span class="s1">'~&gt;1.16.0'</span>
gem <span class="s1">'fastlane'</span>, <span class="s1">'~&gt;2.228.0'</span>

plugins_path <span class="o">=</span> File.join<span class="o">(</span>File.dirname<span class="o">(</span>__FILE__<span class="o">)</span>, <span class="s1">'Product'</span>, <span class="s1">'fastlane'</span>, <span class="s1">'Pluginfile'</span><span class="o">)</span>
eval_gemfile<span class="o">(</span>plugins_path<span class="o">)</span> <span class="k">if </span>File.exist?<span class="o">(</span>plugins_path<span class="o">)</span>
</pre></table></code></div></div><p>管理 Ruby (Gems) 相關依賴，一般 iOS 專案最常用的就是這兩個 <code class="language-plaintext highlighter-rouge">cocoapods</code> 跟 <code class="language-plaintext highlighter-rouge">fastlane</code> 。</p><h4 id="cocoapods"><span class="me-2">Cocoapods</span><a href="#cocoapods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>Product/podfile:</strong></p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">'13.0'</span>
<span class="n">use_frameworks!</span>

<span class="n">target</span> <span class="s1">'app-ci-cd-github-actions-demo'</span> <span class="k">do</span>
  <span class="n">pod</span> <span class="s1">'SnapKit'</span>
<span class="k">end</span> 
</pre></table></code></div></div><p>雖然已宣告 <a href="https://blog.cocoapods.org/CocoaPods-Specs-Repo/" target="_blank">即將停止維護</a> ，但 Cocoapods 在有年代的 iOS 專案中仍很常見，這邊簡單加一個 Snapkit 當 Demo。</p><h4 id="xcodegen"><span class="me-2">XCodeGen</span><a href="#xcodegen" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>避免多人開發中 <code class="language-plaintext highlighter-rouge">.xcodeproj</code> / <code class="language-plaintext highlighter-rouge">.xcworkspace</code> 異動造成的衝突，統一使用 Project.yaml 定義 XCode Project 內容，然後在本地自己 Gen Project 檔案(不上 Git)。</p><p><strong>Product/project.yaml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demo</span>
<span class="na">options</span><span class="pi">:</span>
  <span class="na">bundleIdPrefix</span><span class="pi">:</span> <span class="s">com.example</span>
  <span class="na">deploymentTarget</span><span class="pi">:</span>
    <span class="na">iOS</span><span class="pi">:</span> <span class="s1">'</span><span class="s">13.0'</span>
  <span class="na">usesTabs</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">indentWidth</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">tabWidth</span><span class="pi">:</span> <span class="m">2</span>

<span class="na">configs</span><span class="pi">:</span>
  <span class="na">Debug</span><span class="pi">:</span> <span class="s">debug</span>
  <span class="na">Release</span><span class="pi">:</span> <span class="s">release</span>

<span class="na">targets</span><span class="pi">:</span>
  <span class="na">app-ci-cd-github-actions-demo</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">application</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">iOS</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-ci-cd-github-actions-demo</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-ci-cd-github-actions-demo/Assets.xcassets</span>
      <span class="pi">-</span> <span class="s">app-ci-cd-github-actions-demo/Base.lproj</span>
    <span class="na">info</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demo/Info.plist</span>
      <span class="na">properties</span><span class="pi">:</span>
        <span class="na">CFBundleIdentifier</span><span class="pi">:</span> <span class="s">$(PRODUCT_BUNDLE_IDENTIFIER)</span>
    <span class="na">settings</span><span class="pi">:</span>
      <span class="na">base</span><span class="pi">:</span>
        <span class="na">PRODUCT_BUNDLE_IDENTIFIER</span><span class="pi">:</span> <span class="s">com.test.appcicdgithubactionsdemo</span>
    <span class="na">cocoapods</span><span class="pi">:</span> <span class="kc">true</span>

  <span class="na">app-ci-cd-github-actions-demoTests</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">bundle.unit-test</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">iOS</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-ci-cd-github-actions-demoTests</span>
    <span class="na">dependencies</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">target</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demo</span>
    <span class="na">info</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demoTests/Info.plist</span>
    <span class="na">settings</span><span class="pi">:</span>
      <span class="na">base</span><span class="pi">:</span>
        <span class="na">PRODUCT_BUNDLE_IDENTIFIER</span><span class="pi">:</span> <span class="s">com.test.appcicdgithubactionsdemo.tests</span>

  <span class="na">app-ci-cd-github-actions-demoUITests</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">bundle.ui-testing</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">iOS</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-ci-cd-github-actions-demoUITests</span>
    <span class="na">dependencies</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">target</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demo</span>
    <span class="na">info</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demoUITests/Info.plist</span>
    <span class="na">settings</span><span class="pi">:</span>
      <span class="na">base</span><span class="pi">:</span>
        <span class="na">PRODUCT_BUNDLE_IDENTIFIER</span><span class="pi">:</span> <span class="s">com.test.appcicdgithubactionsdemo.uitests</span>

  <span class="na">app-ci-cd-github-actions-demoSnapshotTests</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">bundle.unit-test</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">iOS</span>
    <span class="na">sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demoSnapshotTests</span>
        <span class="na">excludes</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">**/__Snapshots__/**"</span>
    <span class="na">dependencies</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">target</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demo</span>
      <span class="pi">-</span> <span class="na">product</span><span class="pi">:</span> <span class="s">SnapshotTesting</span>
        <span class="na">package</span><span class="pi">:</span> <span class="s">SnapshotTesting</span>
    <span class="na">info</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">app-ci-cd-github-actions-demoSnapshotTests/Info.plist</span>
      <span class="na">settings</span><span class="pi">:</span>
        <span class="na">base</span><span class="pi">:</span>
          <span class="na">PRODUCT_BUNDLE_IDENTIFIER</span><span class="pi">:</span> <span class="s">com.test.appcicdgithubactionsdemo.snapshottests</span>

<span class="na">packages</span><span class="pi">:</span>
  <span class="na">SnapshotTesting</span><span class="pi">:</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://github.com/pointfreeco/swift-snapshot-testing</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s">1.18.4</span>
</pre></table></code></div></div><p>SnapshotTesting: 使用 Swift Package Manager 管理。</p><h4 id="fastlane"><span class="me-2">Fastlane</span><a href="#fastlane" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>封裝 xcodebuild 指令、封裝串接 App Store Connect API、Firebase API. .等服務的複雜步驟。</p><p><strong>Product/fastlane/Fastfile:</strong></p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre><td class="rouge-code"><pre>
<span class="nf">default_platform</span><span class="p">(</span><span class="o">:</span><span class="n">ios</span><span class="p">)</span>

<span class="n">platform</span> <span class="o">:</span><span class="n">ios</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">"Run all tests (Unit Tests + UI Tests)"</span>
  <span class="n">lane</span> <span class="o">:</span><span class="n">run_all_tests</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">device</span><span class="p">]</span>
    <span class="nf">scan</span><span class="p">(</span>
      <span class="n">scheme</span><span class="o">:</span> <span class="s2">"app-ci-cd-github-actions-demo"</span><span class="p">,</span>
      <span class="n">device</span><span class="o">:</span> <span class="n">device</span><span class="p">,</span>
      <span class="n">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="n">output_directory</span><span class="o">:</span> <span class="s2">"fastlane/test_output"</span><span class="p">,</span>
      <span class="n">output_types</span><span class="o">:</span> <span class="s2">"junit"</span>
    <span class="p">)</span>
  <span class="n">end</span>

  <span class="n">desc</span> <span class="s2">"Run only Unit Tests"</span>
  <span class="n">lane</span> <span class="o">:</span><span class="n">run_unit_tests</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">device</span><span class="p">]</span>
    <span class="nf">scan</span><span class="p">(</span>
      <span class="n">scheme</span><span class="o">:</span> <span class="s2">"app-ci-cd-github-actions-demo"</span><span class="p">,</span>
      <span class="n">device</span><span class="o">:</span> <span class="n">device</span><span class="p">,</span>
      <span class="n">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="n">only_testing</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">"app-ci-cd-github-actions-demoTests"</span>
      <span class="p">],</span>
      <span class="n">output_directory</span><span class="o">:</span> <span class="s2">"fastlane/test_output"</span><span class="p">,</span>
      <span class="n">output_types</span><span class="o">:</span> <span class="s2">"junit"</span>
    <span class="p">)</span>
  <span class="n">end</span>

  <span class="n">desc</span> <span class="s2">"Build and upload to Firebase App Distribution"</span>
  <span class="n">lane</span> <span class="o">:</span><span class="n">beta</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
    
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">version_number</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">version_number</span><span class="p">]</span><span class="mf">.</span><span class="n">to_s</span><span class="mf">.</span><span class="n">strip</span> <span class="o">!=</span> <span class="s2">""</span>
      <span class="nf">increment_version_number</span><span class="p">(</span><span class="n">version_number</span><span class="o">:</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">version_number</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">build_number</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">build_number</span><span class="p">]</span><span class="mf">.</span><span class="n">to_s</span><span class="mf">.</span><span class="n">strip</span> <span class="o">!=</span> <span class="s2">""</span>
      <span class="nf">increment_build_number</span><span class="p">(</span><span class="n">build_number</span><span class="o">:</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">build_number</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="nf">update_code_signing_settings</span><span class="p">(</span>
      <span class="n">use_automatic_signing</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="n">path</span><span class="o">:</span> <span class="s2">"app-ci-cd-github-actions-demo.xcodeproj"</span><span class="p">,</span>
      <span class="n">team_id</span><span class="o">:</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'TEAM_ID'</span><span class="p">],</span>
      <span class="n">code_sign_identity</span><span class="o">:</span> <span class="s2">"iPhone Developer"</span><span class="p">,</span>
      <span class="n">sdk</span><span class="o">:</span> <span class="s2">"iphoneos*"</span><span class="p">,</span>
      <span class="n">profile_name</span><span class="o">:</span> <span class="s2">"cicd"</span>
    <span class="p">)</span>

    <span class="nf">gym</span><span class="p">(</span>
      <span class="n">scheme</span><span class="o">:</span> <span class="s2">"app-ci-cd-github-actions-demo"</span><span class="p">,</span>
      <span class="n">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="n">export_method</span><span class="o">:</span> <span class="s2">"development"</span><span class="p">,</span>
      <span class="n">output_directory</span><span class="o">:</span> <span class="s2">"fastlane/build"</span><span class="p">,</span>
      <span class="n">output_name</span><span class="o">:</span> <span class="s2">"app-ci-cd-github-actions-demo.ipa"</span><span class="p">,</span>
      <span class="n">export_options</span><span class="o">:</span> <span class="p">{</span>
          <span class="n">provisioningProfiles</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">"com.test.appcicdgithubactionsdemo"</span> <span class="o">=&gt;</span> <span class="s2">"cicd"</span><span class="p">,</span>
          <span class="p">},</span>
      <span class="p">}</span>
    <span class="p">)</span>

    <span class="nf">firebase_app_distribution</span><span class="p">(</span>
      <span class="n">app</span><span class="o">:</span> <span class="s2">"1:127683058219:ios:98896929fa131c7a80686e"</span><span class="p">,</span>
      <span class="n">firebase_cli_token</span><span class="o">:</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"FIREBASE_CLI_TOKEN"</span><span class="p">],</span>
      <span class="n">release_notes</span><span class="o">:</span> <span class="n">options</span><span class="p">[</span><span class="o">:</span><span class="n">release_notes</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"New beta build"</span>
    <span class="p">)</span>
  <span class="n">end</span>
<span class="n">end</span>
</pre></table></code></div></div><p>註: provisioningProfiles、profile_name 對應的是 <a href="https://developer.apple.com/account/resources/certificates/list" target="_blank">App Developer 中的 Profiles 憑證名稱</a> 。(如果有用 match 則也不需要這些指定。)</p><p><a href="/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE3IiBoZWlnaHQ9IjYxNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Fastlane 是 iOS CI/CD 當中不可或缺的一部分</strong> ，直接使用它封裝好的方法就能快速開發 CI/CD 實際執行的步驟；我們只需關注在整體的腳本設計，而不需去處理複雜的 API 串接或指令撰寫。</p><p>例如：Fastlane 只需要寫「scan(xxx)」就能執行測試，如果要寫成 xcodebuild 則需要「 <code class="language-plaintext highlighter-rouge">xcodebuild -workspace ./xxx.xcworkspace -scheme xxx -derivedDataPath xxx ‘platform=iOS Simulator,id=xxx’ clean build test</code> 」，打包部署要自己做更是麻煩，要自行串接 App Store Connect/Firebase API，光金鑰驗證都要寫超過 10 行程式了。</p><p><strong>Demo 專案我們只有三個 Lane:</strong></p><ul><li>run_all_tests: 跑所有類型的測試 (Snapshot+Unit)<li>run_unit_tests: 只跑單元測試 (Unit)<li>beta: 打包部署到 Firebase App Distribution</ul><h4 id="fastlane--match"><span class="me-2">Fastlane — Match</span><a href="#fastlane--match" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>因 Demo 專案限制，這邊沒用到 Match 管理團隊開發、部署憑證，但這邊還是要提一下，建議使用 Match 去管理團隊的所有開發、部署憑證，方便控管跟統一更新。</p><blockquote><p><em>有用 Match 就能在專案 Setup 步驟直接使用 <code class="language-plaintext highlighter-rouge">match all</code> 之類的指令一鍵安裝好所有開發需要的憑證。</em></p></blockquote><ul><li><strong>Fastlane Match 會使用另一個 Private Repo 管理憑證金鑰，在 GitHub Actions 中需要設定好 SSH Agent 才能 Clone 另一個 Private Repo。</strong> (請參考文末補充)</ul><p>— — —</p><h4 id="makefile"><span class="me-2">Makefile</span><a href="#makefile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4b001d2e8440/1*jYACUYFP3MkeHCgeUY7j3w.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*jYACUYFP3MkeHCgeUY7j3w.webp" alt="Makefile" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQyMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Makefile</p><p>讓開發端與 CI/CD 統一都使用 Makefile 執行指令，方便我們封裝同樣的環境、路徑與操作行爲。</p><blockquote><p><em>經典的案例是有的人使用的是本機安裝的 <code class="language-plaintext highlighter-rouge">pod install</code> 有的人則使用的是 Bundel 管理的 <code class="language-plaintext highlighter-rouge">bundle exec pod install</code> 如果版本不同就可能產生差異。</em></p></blockquote><blockquote><p><strong><em>覺得太複雜不使用也可以，那就是在 Action Workflow Step 中直接寫要執行的指令即可。</em></strong></p></blockquote><p><strong>Makefile:</strong></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c">#!make
</span><span class="nv">PRODUCT_FOLDER</span> <span class="o">=</span> ./Product/
<span class="nv">SHELL</span>         <span class="o">:=</span> /bin/zsh
<span class="nv">.DEFAULT_GOAL</span> <span class="o">:=</span> <span class="nb">install</span>
<span class="nv">MINT_DIRECTORY</span> <span class="o">:=</span> ./mint/

<span class="k">export </span><span class="nv">MINT_PATH</span><span class="o">=</span><span class="p">$(</span>MINT_DIRECTORY<span class="p">)</span>

<span class="c">## 👇 Help function
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">help</span>
<span class="nl">help</span><span class="o">:</span>
 <span class="err">@echo</span> <span class="s2">""</span>
 <span class="nl">@echo "📖 可用指令</span><span class="o">:</span><span class="nf">"</span>
 <span class="nl">@grep -E '^[a-zA-Z_-]+</span><span class="o">:</span><span class="nf">.*?</span><span class="c">##</span><span class="nf"> .*$$' $(MAKEFILE_LIST) | </span>\
<span class="nf">  awk 'BEGIN {FS = ":.*?</span><span class="c">##</span><span class="nf"> "}; {printf "  </span>\0<span class="nf">33[36m%-20s</span>\0<span class="nf">33[0m %s</span>\n<span class="nf">"</span><span class="p">,</span><span class="nf"> $$1</span><span class="p">,</span><span class="nf"> $$2}'</span>
 <span class="err">@echo</span> <span class="s2">""</span>

<span class="c">## Setup
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">setup</span>
<span class="nl">setup</span><span class="o">:</span> <span class="nf">check-mint </span><span class="c">##</span><span class="nf"> 安裝 Ruby 和 Mint 依賴</span>
 <span class="err">@echo</span> <span class="s2">"🔨 Installing Ruby dependencies..."</span>
 <span class="err">bundle</span> <span class="err">config</span> <span class="err">set</span> <span class="err">path</span> <span class="s1">'vendor/bundle'</span>
 <span class="err">bundle</span> <span class="err">install</span>
 <span class="err">@echo</span> <span class="s2">"🔨 Installing Mint dependencies..."</span>
 <span class="err">mint</span> <span class="err">bootstrap</span>

<span class="c">## Install
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">install</span>
<span class="nl">install</span><span class="o">:</span> <span class="nf">XcodeGen PodInstall </span><span class="c">##</span><span class="nf"> 執行 XcodeGen 和 CocoaPods 安裝</span>

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">XcodeGen</span>
<span class="nl">XcodeGen</span><span class="o">:</span> <span class="nf">check-mint </span><span class="c">##</span><span class="nf"> 用 XcodeGen 產生 .xcodeproj</span>
 <span class="err">@echo</span> <span class="s2">"🔨 Execute XcodeGen"</span>
 <span class="err">cd</span> <span class="err">$(PRODUCT_FOLDER)</span> <span class="err">&amp;&amp;</span> <span class="err">\</span>
 <span class="err">mint</span> <span class="err">run</span> <span class="err">yonaskolb/XcodeGen</span> <span class="err">--quiet</span>

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">PodInstall</span>
<span class="nl">PodInstall</span><span class="o">:</span> <span class="c">##</span><span class="nf"> 安裝 CocoaPods 依賴</span>
 <span class="err">@echo</span> <span class="s2">"📦 Installing CocoaPods dependencies..."</span>
 <span class="err">cd</span> <span class="err">$(PRODUCT_FOLDER)</span> <span class="err">&amp;&amp;</span> <span class="err">\</span>
 <span class="err">bundle</span> <span class="err">exec</span> <span class="err">pod</span> <span class="err">install</span>

<span class="c">### Mint
</span><span class="nl">check-mint</span><span class="o">:</span> <span class="nf">check-brew </span><span class="c">##</span><span class="nf"> 檢查 Mint 是否安裝，沒有就自動安裝</span>
 <span class="err">@if</span> <span class="err">!</span> <span class="err">command</span> <span class="err">-v</span> <span class="err">mint</span> <span class="err">&amp;&gt;</span> <span class="err">/dev/null;</span> <span class="err">then</span> <span class="err">\</span>
  <span class="err">echo</span> <span class="s2">"🔨 Installing mint..."</span><span class="err">;</span> <span class="err">\</span>
  <span class="err">brew</span> <span class="err">install</span> <span class="err">mint;</span> <span class="err">\</span>
 <span class="err">fi</span>

<span class="c">### Brew
</span><span class="nl">check-brew</span><span class="o">:</span> <span class="c">##</span><span class="nf"> 檢查 Homebrew 是否安裝，沒有就自動安裝</span>
 <span class="err">@if</span> <span class="err">!</span> <span class="err">command</span> <span class="err">-v</span> <span class="err">brew</span> <span class="err">&amp;&gt;</span> <span class="err">/dev/null;</span> <span class="err">then</span> <span class="err">\</span>
  <span class="err">echo</span> <span class="s2">"🔨 Installing Homebrew..."</span><span class="err">;</span> <span class="err">\</span>
  <span class="nl">/bin/bash -c "$$(curl -fsSL https</span><span class="o">:</span><span class="nf">//raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"; </span>\
<span class="nf"> fi</span>

<span class="c">## Format only git swift files
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">format</span>
<span class="nl">format</span><span class="o">:</span> <span class="nf">check-mint </span><span class="c">##</span><span class="nf"> 格式化 Product/ 下所有 Swift 檔</span>
 <span class="err">mint</span> <span class="err">run</span> <span class="err">swiftformat</span> <span class="err">$(PRODUCT_FOLDER)</span>
</pre></table></code></div></div><p>為了避免污染整個系統或其他專案，我們盡可能把 Dependency 套件(e.g. mint, bundle…etc)的路徑都改指定在專案目錄之下 (再搭配 <code class="language-plaintext highlighter-rouge">.gitignore</code> 排除)。</p><div class="language-scss highlighter-rouge"><div class="code-header"> <span data-label-text="SCSS"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="err">├──</span> <span class="nt">mint</span> <span class="o">(</span><span class="nt">Mint</span> <span class="err">依賴</span><span class="o">)</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nt">packages</span>
<span class="err">├──</span> <span class="nt">Product</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demo</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demo</span><span class="nc">.xcodeproj</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demo</span><span class="nc">.xcworkspace</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demoSnapshotTests</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demoTests</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">app-ci-cd-github-actions-demoUITests</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="nt">fastlane</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nt">Pods</span> <span class="o">(</span><span class="nt">Cocoapods</span> <span class="err">依賴</span><span class="o">)</span>
<span class="err">└──</span> <span class="nt">vendor</span> <span class="o">(</span><span class="nt">Bundle</span> <span class="err">依賴</span><span class="o">)</span>
    <span class="err">└──</span> <span class="nt">bundle</span>
</pre></table></code></div></div><p><a href="/assets/4b001d2e8440/1*F1KFntT8bCZzyYm9JahiuA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*F1KFntT8bCZzyYm9JahiuA.webp" alt="make help" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NDkiIGhlaWdodD0iMTQyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>make help</p><p><strong>使用 Makefine 的統一專案 Setup 步驟：</strong></p><ol><li><code class="language-plaintext highlighter-rouge">git clone repo</code><li><code class="language-plaintext highlighter-rouge">cd ./repo</code><li><code class="language-plaintext highlighter-rouge">make setup</code> 安裝必要的工具依賴 ( <strong>brew</strong> , <strong>mint</strong> , <strong>bundle</strong> , xcodegen, swiftformat,…)<li><code class="language-plaintext highlighter-rouge">make install</code> 產生專案 (執行 pod install, xcodegen)<li>完成<li>打開、執行專案</ol><blockquote><p><strong><em>不管是 CI/CD 或新人 onboard 都是照以上步驟把專案建置起來。</em></strong></p></blockquote><h3 id="本篇-github-actions-cicd-案例"><span class="me-2">本篇 GitHub Actions CI/CD 案例</span><a href="#本篇-github-actions-cicd-案例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>本篇會介紹三個 GitHub Actions CI/CD 工作流程建置案例，大家也可以參考其中的步驟建置符合自己團隊工作流程的 CI/CD。</p><ol><li>CI — 發 Pull Request 執行單元測試<li>CD — 打包+部署到 Firebase App Distribution<li>CI +CD— Nightly Build 執行快照+單元測試+打包+部署到 Firebase App Distribution</ol><blockquote><p><em>因 Demo 限制，本文只會串接 打包部署到 Firebase App Distribution，打包到 Testflight 或是 App Store 也是同樣步驟只差別在 Fastlane 裡的腳本不同，大家可以自行發揮。</em></p></blockquote><h3 id="ci--發-pull-request-執行單元測試"><span class="me-2">CI — 發 Pull Request 執行單元測試</span><a href="#ci--發-pull-request-執行單元測試" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="流程"><span class="me-2">流程</span><a href="#流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Develop 分支 <strong>無法直接推送</strong> ，必須發 Pull Request 才能更新；所有 Pull Request <strong>均需 Review 通過加上單元測試通過才能 Merge</strong> 、有新 Commit Push 會重新測試。</p><h4 id="ci-testingyml"><span class="me-2">CI-Testing.yml</span><a href="#ci-testingyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">CI-Testing</span>

<span class="c1"># Actions Log 的標題名稱</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[CI-Testing]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.event.pull_request.title</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># 同個 Concurrency Group 如果有新的 Job 會取消正在跑的</span>
<span class="c1"># 例如 Push Commit 觸發的任務還沒執行就又 Push Commit 時，會取消前一個任務</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.event_name }}-${{ github.event.pull_request.number || github.ref }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># PR 事件</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="c1"># PR - 開啟、重開、有新 Push Commit 時</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">]</span>
  <span class="c1"># 手動表單觸發</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="c1"># 表單 Inputs 欄位</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># 執行的 Test Fastlane Lane</span>
      <span class="na">TEST_LANE</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Test</span><span class="nv"> </span><span class="s">Lane'</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">run_unit_tests'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">choice</span>
        <span class="na">options</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">run_unit_tests</span>
          <span class="pi">-</span> <span class="s">run_all_tests</span>
  <span class="c1"># 其他 Workflow 呼叫此 Workflow 觸發</span>
  <span class="c1"># Nightly Build 會呼叫使用</span>
  <span class="na">workflow_call</span><span class="pi">:</span>
    <span class="c1"># 表單 Inputs 欄位</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># 執行的 Test Fastlane Lane</span>
      <span class="na">TEST_LANE</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Test</span><span class="nv"> </span><span class="s">Lane'</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">run_unit_tests'</span>
        <span class="c1"># workflow_call inputs 不支援 choice</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">BRANCH</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Branch'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
  
<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">testing</span><span class="pi">:</span>
    <span class="c1"># Job 名稱 (可省略，有設定在 Log 顯示比較好讀)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Testing</span>
    
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner macos-15 來執行工作</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 如果是 Private Repo 需要按計量收費，macOS 機器是最貴的(10倍)，可能跑 10 次就達到 2,000 分鐘免費上限</span>
    <span class="c1"># 建議使用 self-hosted Runner</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">macos-15</span>

    <span class="c1"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">30</span>

    <span class="c1"># use zsh</span>
    <span class="c1"># 可省略，只是我習慣用 zsh，預設是 bash</span>
    <span class="na">defaults</span><span class="pi">:</span>
      <span class="na">run</span><span class="pi">:</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">zsh {0}</span>
          
    <span class="c1"># 工作步驟</span>
    <span class="c1"># 工作步驟會照順序執行  </span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># git clone 當前專案 &amp; checkout 到執行的分支</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout repository</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="c1"># Git Large File Storage，我們的測試環境用不到</span>
          <span class="c1"># default: false</span>
          <span class="na">lfs</span><span class="pi">:</span> <span class="kc">false</span>
          
          <span class="c1"># 如果有指定則 Checkout 指定分支，沒有則使用預設(當前分支)</span>
          <span class="c1"># 因 on: schedule 事件只能在 main 主分支執行，因此想做 Nightly Build 之類的工作就需要指定分支</span>
          <span class="c1"># e.g. on: schedule -&gt; main 分支，Nightly Build master 分支</span>
          <span class="na">ref</span><span class="pi">:</span> <span class="s">${{ github.event.inputs.BRANCH || '' }}</span>

      <span class="c1"># ========== Env Setup Steps ==========</span>
      
      <span class="c1"># 讀取專案指定的 XCode 版本</span>
      <span class="c1"># 在後續之中，我們自己手動指定使用的 XCode_x.x.x.app</span>
      <span class="c1"># 而不使用 xcversion，因為 xcversion 已經 sunset 不穩定。 </span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Read .xcode-version</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">read_xcode_version</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">XCODE_VERSION=$(cat .xcode-version)</span>
          <span class="s">echo "XCODE_VERSION: ${XCODE_VERSION}"</span>
          <span class="s">echo "xcode_version=${XCODE_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>

          <span class="s"># 也可以直接在這指定全域 XCode 版本，這樣就不用在後續步驟指定 DEVELOPER_DIR</span>
          <span class="s"># 但此指令需要 sudoer 權限，如果是 self-hosted runner 就要確定 runner 執行環境有 sudo 權限</span>
          <span class="s"># sudo xcode-select -s "/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer"</span>

      <span class="c1"># 讀取專案指定的 Ruby 版本</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Read .ruby-version</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">read_ruby_version</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">RUBY_VERSION=$(cat .ruby-version)</span>
          <span class="s">echo "RUBY_VERSION: ${RUBY_VERSION}"</span>
          <span class="s">echo "ruby_version=${RUBY_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>

      <span class="c1"># 安裝或設定 Runner Ruby 版本成專案指定版本</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Ruby</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ruby-version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">steps.read_ruby_version.outputs.ruby_version</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="c1"># 可設可不設，原因是之前在 self-hosted 起多個 runner 跑 CI/CD 因為 cocoapods repos 是共用目錄</span>
      <span class="c1"># 解決的問題是：有很小的機率會出現在同時 pod install 時拉 cocoapods repos 出現衝突(因為預設都是用) $HOME/.cocoapods/</span>
      <span class="c1"># GitHub Hosted Runner 則不需此設定</span>
      <span class="c1"># - name: Change Cocoapods Repos Folder</span>
      <span class="c1">#   if: contains(runner.labels, 'self-hosted')</span>
      <span class="c1">#   run: |</span>
      <span class="c1">#     # 每個 Runner 用自己的 .cocoapods 資料夾，防止資源衝突</span>
      <span class="c1">#     mkdir -p "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/"</span>
      <span class="c1">#     export CP_HOME_DIR="$HOME/.cocoapods-${{ env.RUNNER_NAME }}"</span>
      <span class="c1">#     rm -f "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock"</span>

      <span class="c1"># ========== Cache Setting Steps ==========</span>
      <span class="c1"># 請注意，就算是 self-hosted，Cache 目前也是 Cloud Cache 會計算用量</span>
      <span class="c1"># 規則：7 天未 hit 自動刪除、單個 Cache 上限 10 GB、Action 成功才會 Cache</span>
      <span class="c1"># Public Repo: 免費無限制</span>
      <span class="c1"># Private Repo: 5 GB 起</span>
      <span class="c1"># Self-hosted 可以自己用 shell script 撰寫 Cache &amp; Restore 策略或使用其他工具協助</span>
      
      <span class="c1"># Bundle Cache (Gemfile)</span>
      <span class="c1"># 對應 Makefile 中我們指定了 Bundle  安裝路徑 ./vendor 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache Bundle</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">./vendor</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-bundle-</span>

      <span class="c1"># CocoaPods Cache (Podfile)</span>
      <span class="c1"># 默認就是 專案/Pods 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache CocoaPods</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">./Product/Pods</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-cocoapods-</span>

      <span class="c1"># Mint cache</span>
      <span class="c1"># 對應 Makefile 中我們指定的 Mint 安裝路徑 ./mint 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache Mint</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./mint</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-mint-${{ hashFiles('Mintfile') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-mint-</span>

      <span class="c1"># ====================</span>

      <span class="c1"># 專案 Setup &amp; 依賴安裝</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup &amp; Install Dependency</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># 執行 Makefile 中封裝的 Setup 指令，對應成指令大概是：</span>
          <span class="s"># brew install mint</span>
          <span class="s"># bundle config set path 'vendor/bundle'</span>
          <span class="s"># bundle install</span>
          <span class="s"># mint bootstrap</span>
          <span class="s"># ...</span>
          <span class="s"># 等等 setup 指令</span>
          <span class="s">make setup</span>

          <span class="s"># 執行 Makefile 中封裝的 Install 指令，對應成指令大概是：</span>
          <span class="s"># mint run yonaskolb/XcodeGen --quiet</span>
          <span class="s"># bundle exec pod install</span>
          <span class="s"># ...</span>
          <span class="s"># 等等 install 指令</span>
          <span class="s">make install</span>

      <span class="c1"># 執行 Fastlane Unit 測試 Lane</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Tests</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">testing</span>
        <span class="c1"># 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/</span>
        <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./Product/</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># 測試計劃，全跑還是只跑單元測試</span>
          <span class="c1"># 如為開 PR 觸發則使用 run_unit_tests，否則看 inputs.TEST_LANE 的值，預設值 run_all_tests</span>
          <span class="na">TEST_LANE</span><span class="pi">:</span> <span class="s">${{ github.event_name == 'pull_request' &amp;&amp; 'run_unit_tests' || github.event.inputs.TEST_LANE || 'run_all_tests' }}</span>
          
          <span class="c1"># 指定這個 Job 要使用 XCode_x.x.x 指定的版本執行</span>
          <span class="na">DEVELOPER_DIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/Applications/Xcode_${{</span><span class="nv"> </span><span class="s">steps.read_xcode_version.outputs.xcode_version</span><span class="nv"> </span><span class="s">}}.app/Contents/Developer"</span>
          
          <span class="c1"># Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables</span>
          <span class="c1"># 使用的模擬器名稱</span>
          <span class="na">SIMULATOR_NAME</span><span class="pi">:</span> <span class="s">${{ vars.SIMULATOR_NAME }}</span>
          <span class="c1"># 模擬器的 iOS 版本</span>
          <span class="na">SIMULATOR_IOS_VERSION</span><span class="pi">:</span> <span class="s">${{ vars.SIMULATOR_IOS_VERSION }}</span>

          <span class="c1"># 當前 Runner 名稱</span>
          <span class="na">RUNNER_NAME</span><span class="pi">:</span> <span class="s">${{ runner.name }}</span>
          
          <span class="c1"># 提升 XCodebuild 指令 timeout 時間, retry 次數</span>
          <span class="c1"># 因為機器 Loading 比較大的時候可能 3 次就失敗了</span>
          <span class="na">FASTLANE_XCODEBUILD_SETTINGS_TIMEOUT</span><span class="pi">:</span> <span class="m">60</span>
          <span class="na">FASTLANE_XCODEBUILD_SETTINGS_RETRIES</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>

          <span class="s"># 如果是 self-hosted 在同一台機器起多個 Runner 會出現搶模擬器的問題 (文章後會講)</span>
          <span class="s"># 要避免這問題建議將模擬名稱命名成 Runner 名稱，每個 Runner 都設一個模擬器，這樣就不會互搶導致測試失敗</span>
          <span class="s"># e.g. bundle exec fastlane run_unit_tests device:"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})"</span>
          <span class="s"># 這邊是用 GitHub Hosted Runner 沒這問題，所以直接用 device:"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})"</span>

          <span class="s"># 發生錯誤不直接退出並將所有輸出都寫入 temp/testing_output.txt 檔案</span>
          <span class="s"># 後續我們會分析檔案內容區分出是 Build Failed 還是 Test Failed，Comment 不同訊息到 PR</span>
          <span class="s">set +e</span>
          
          <span class="s"># EXIT_CODE 儲存執行結果的 exit code.</span>
          <span class="s"># 0 = OK</span>
          <span class="s"># 1 = exit</span>
          <span class="s">EXIT_CODE=0</span>
          
          <span class="s"># 所有輸出都寫入檔案</span>
          <span class="s">bundle exec fastlane ${TEST_LANE} device:"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})" | tee "$RUNNER_TEMP/testing_output.txt"</span>
          <span class="s"># 如果目前 EXIT_CODE 是 0，則將 ${pipestatus[1]} 賦值給 EXIT_CODE</span>
          <span class="s">[[ $EXIT_CODE -eq 0 ]] &amp;&amp; EXIT_CODE=${pipestatus[1]}</span>

          <span class="s"># 恢復出錯就退出</span>
          <span class="s">set -e</span>

          <span class="s"># 檢查 Testing Output</span>
          <span class="s"># 如果 Testing Output 包含 "Error building"，則設 is_build_error=true 給 Actions 環境變數，為 Build 就失敗</span>
          <span class="s"># 如果 Testing Output 包含 "Tests have failed"，則設 is_test_error=true 給 Actions 環境變數，為測試失敗</span>
          
          <span class="s">if grep -q "Error building" "$RUNNER_TEMP/testing_output.txt"; then</span>
            <span class="s">echo "is_build_error=true" &gt;&gt; $GITHUB_OUTPUT</span>
            <span class="s">echo "❌ Detected Build Error"</span>
          <span class="s">elif grep -q "Tests have failed" "$RUNNER_TEMP/testing_output.txt"; then</span>
            <span class="s">echo "is_test_error=true" &gt;&gt; $GITHUB_OUTPUT</span>
            <span class="s">echo "❌ Detected Test Error"</span>
          <span class="s">fi</span>

          <span class="s"># 恢復 Exit Code Output</span>
          <span class="s">exit $EXIT_CODE</span>
          
      <span class="c1"># ========== Handle Result Steps ==========</span>
      
      <span class="c1"># 解析 *.junit 測試報告，並標記結果、Comment(如果是 PR 的話)</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish Test Report</span>
        <span class="c1"># 直接復用別人寫好的 .junit Paser Actions: https://github.com/mikepenz/action-junit-report</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">mikepenz/action-junit-report@v5</span>
        <span class="c1"># if:</span>
        <span class="c1"># 上一步(Testing) success or</span>
        <span class="c1"># 上一步(Testing) failed and is_test_error (build failed 不執行這個 step)</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ (failure() &amp;&amp; steps.testing.outputs.is_test_error == 'true') || success() }}</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">check_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Testing</span><span class="nv"> </span><span class="s">Report"</span>
          <span class="na">comment</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">updateComment</span><span class="pi">:</span> <span class="kc">false</span>
          <span class="na">require_tests</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">detailed_summary</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">report_paths</span><span class="pi">:</span> <span class="s2">"</span><span class="s">./Product/fastlane/test_output/*.junit"</span>

      <span class="c1"># 測試建置失敗 Comment</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Failure Comment</span>
        <span class="c1"># if:</span>
        <span class="c1"># 上一步(Testing) failed and is_build_error and 有 PR Number</span>
        <span class="c1"># </span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ failure() &amp;&amp; steps.testing.outputs.is_build_error == 'true' &amp;&amp; github.event.pull_request.number }}</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v6</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">action_url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">github.server_url</span><span class="nv"> </span><span class="s">}}/${{</span><span class="nv"> </span><span class="s">github.repository</span><span class="nv"> </span><span class="s">}}/actions/runs/${{</span><span class="nv"> </span><span class="s">github.run_id</span><span class="nv"> </span><span class="s">}}/attempts/${{</span><span class="nv"> </span><span class="s">github.run_attempt</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">with</span><span class="pi">:</span>
            <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
              <span class="s">const action_url = process.env.action_url</span>
              <span class="s">const pullRequest = context.payload.pull_request || {}</span>
              <span class="s">const commitSha = pullRequest.head?.sha || context.sha</span>
              <span class="s">const creator = pullRequest.user?.login || context.actor</span>
        
              <span class="s">const commentBody = [</span>
                <span class="s">`# 專案或測試建置失敗 ❌`,</span>
                <span class="s">`請確認您的 Pull Request 是否可以正確編譯與執行測試。`,</span>
                <span class="s">``,</span>
                <span class="s">`🔗 **Action**: [View Workflow Run](${action_url})`,</span>
                <span class="s">`📝 **Commit**: ${commitSha}`,</span>
                <span class="s">`👤 **Author**: @${creator}`</span>
              <span class="s">].join('\n')</span>
        
              <span class="s">await github.rest.issues.createComment({</span>
                <span class="s">owner: context.repo.owner,</span>
                <span class="s">repo: context.repo.repo,</span>
                <span class="s">issue_number: context.payload.pull_request.number,</span>
                <span class="s">body: commentBody</span>
              <span class="s">})</span>
</pre></table></code></div></div><p><strong>技術重點說明：</strong></p><ul><li>runs-on: 建議改用 self-hosted Runner， <a href="https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions#per-minute-rates" target="_blank">GitHub Hosted Runner macOS 很貴的</a> 。<li>手動讀取 <code class="language-plaintext highlighter-rouge">.xcode-version</code> 檔案取得指定的 XCode 版本並在需要指定 XCode 的 Step 設定 <code class="language-plaintext highlighter-rouge">DEVELOPER_DIR</code> env 可以輕鬆免 Sudo 切換 XCode<li>Cache: 可以加速依賴安裝速度，但需注意就算是 self-hosted Runner 依然會使用 GitHub Cloud Cache，受到收費限制<li>使用 <code class="language-plaintext highlighter-rouge">set +e</code> 使指令執行失敗不會馬上退出+將 output 都輸出到檔案+讀取檔案判斷是 Build Failed or Test Failed；如果不這樣做訊息統一都會是 Test Failed。 也可以延伸去判斷其他錯誤，例如： <code class="language-plaintext highlighter-rouge">Underlying Error: Unable to boot the Simulator.</code> 模擬器啟動失敗，請重新嘗試。<li>Checkout Code 可接受指定分支：因為 <code class="language-plaintext highlighter-rouge">on: schedule</code> 事件只能在 main (Default Branch) 觸發，如果我們希望排程對某個其他分支操作，就需要指定分支。<li>指定 .cocoapods Repo 路徑可做可不做，之前是遇過 self-hosted 同一台機器兩個 Runner 同時卡在 pod install 就是因為剛好都在針對 .cocoapods Repo 操作造成 git lock。 (但機率很低就是了)<li><strong>如果你有 Private Pods Repo 需要設定 SSH Agent 才有權限 Clone。</strong> <strong>(請參考文末補充)</strong><li>記得到 Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables 新增： <code class="language-plaintext highlighter-rouge">SIMULATOR_IOS_VERSION</code> 模擬器 iOS 版本 <code class="language-plaintext highlighter-rouge">SIMULATOR_NAME</code> 模擬器名稱</ul><p><a href="/assets/4b001d2e8440/1*Vj37P9vZ6KL5wWNvU3Cq3Q.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Vj37P9vZ6KL5wWNvU3Cq3Q.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTU2IiBoZWlnaHQ9IjU0OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Commit 檔案到 Repo 主分支，手動觸發一次驗證正不正確：</strong></p><p><a href="/assets/4b001d2e8440/1*tA2nKehTJ7aURSGgU7MM0g.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*tA2nKehTJ7aURSGgU7MM0g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjQ4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/4b001d2e8440/1*Qap3KmhIJrLov2O7GneV3w.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Qap3KmhIJrLov2O7GneV3w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDMxIiBoZWlnaHQ9IjkxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>正確後繼續設定。</p><h4 id="github-流程設定"><span class="me-2">GitHub 流程設定</span><a href="#github-流程設定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Settins → Rules → Rulesets。</p><p><a href="/assets/4b001d2e8440/1*cf_M6NnakdcbzvC2VHSfpw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*cf_M6NnakdcbzvC2VHSfpw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAyIiBoZWlnaHQ9Ijk2NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Ruleset Name: 規則名稱<li>Enforcement status: 啟用/停用 此規則限制<li>Target branches: 目標的 Base 分支，設 Default Branch 就是所有想合進到 main or develop 的分支都受到此規則限制<li>Bypass list: 可指定特殊身份、Team 可以不受此限<li>Branch rules:</ul><p><a href="/assets/4b001d2e8440/1*Hzd9CCTsu18kyDR1goRWag.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Hzd9CCTsu18kyDR1goRWag.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTIiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li>Restrict deletions: 禁止刪除分支<li>Require a pull request before mergin: 只能透過 PR Merge Required approvals: 限制需要幾人 Approve<li>Require status checks to pass: 限制哪些 Checks 要 Passed 才能 Merge 點 + Add checks 輸入 <code class="language-plaintext highlighter-rouge">Testing</code> 選擇有 GitHub Actions 標誌的。 <strong>這邊有個小問題，如果 Suggestions</strong> <strong>找不到 <code class="language-plaintext highlighter-rouge">Testing</code> 那需要先回到 Actions 觸發(開 PR 試試)成功一次，這裡才會出現。</strong></ul><p><a href="/assets/4b001d2e8440/1*MRPwUEVVbbz8nH0sS2hFfQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*MRPwUEVVbbz8nH0sS2hFfQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MzQiIGhlaWdodD0iMzk0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Block force pushes: 禁止 Force push</ul><p>儲存、確定 Enforcement status 是 Active 後，規則就會生效了。</p><p><strong>都設定好之後，開 PR 測試看看：</strong></p><p><a href="/assets/4b001d2e8440/1*iPETBWx6Boq12rY1fHXmuQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*iPETBWx6Boq12rY1fHXmuQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTkiIGhlaWdodD0iNTQ2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Checks 有出現 CI-Testing ( <strong>Requried</strong> )、Merging is blocked、At least X approving review is required by reviewers with write access. 代表設置成功了。</ul><p><strong>如果專案建置失敗 (Build Failed) 會 Comment：</strong></p><p><a href="/assets/4b001d2e8440/1*4E35VRPo--pI8uqrR4UZNA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*4E35VRPo--pI8uqrR4UZNA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTUiIGhlaWdodD0iMjk1Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>如果專案建置成功但測試案例失敗 (Test Failed) 會 Comment：</strong></p><p><a href="/assets/4b001d2e8440/1*wYFzsn5a_yvi8CbZxi-QdQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*wYFzsn5a_yvi8CbZxi-QdQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjEiIGhlaWdodD0iMzg5Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>如果專案建置成功測試也成功(Test Success) 會 Comment：</strong></p><p><a href="/assets/4b001d2e8440/1*WqPK1629jYdYTEWCWBHWqg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*WqPK1629jYdYTEWCWBHWqg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTUiIGhlaWdodD0iMzIxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>完成 Review Approve + Check 測試通過後：</strong></p><p><a href="/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.webp" alt="[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MTEiIGhlaWdodD0iNTY2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11" target="_blank">Demo PR</a></p><p>就能 Merge PR。</p><ul><li>如果有 Push New Commit 會自動重跑 Checks 測試。</ul><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/CI-Testing.yml" target="_blank">CI-Testing.yml</a></strong></p><p><strong>Auto-merge:</strong></p><p>另外，也可以打開 Repo Settings → General → Pull Request 中的：</p><p><a href="/assets/4b001d2e8440/1*hl6mfqnnv_zAA3YVrI_M0w.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*hl6mfqnnv_zAA3YVrI_M0w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NTYiIGhlaWdodD0iMjU3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>Automatically delete head branches: Merge PR 後自動刪除分支<li>Allow Auto-merge: 當 Checks 通過＋符合條件的 Approvals 達成會自動 Merge PR <strong>只有當有設條件＋當前條件還不能 Merge 時才會出現 Enable auto-merge 按鈕。</strong></ul><p><a href="/assets/4b001d2e8440/1*gi0LaaMVXit-DGKnsxS1lQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*gi0LaaMVXit-DGKnsxS1lQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjciIGhlaWdodD0iNDMxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h3 id="cd--打包部署到-firebase-app-distribution"><span class="me-2">CD — 打包+部署到 Firebase App Distribution</span><a href="#cd--打包部署到-firebase-app-distribution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="流程-1"><span class="me-2">流程</span><a href="#流程-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>使用 GitHub Actions 表單觸發打包工作，可指定版本號、Release Notes，打包完會自動上傳到 Firebase App Distribution 供團隊下載測試使用。</p><h4 id="cd-deployyml"><span class="me-2">CD-Deploy.yml</span><a href="#cd-deployyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">CD-Deploy</span>

<span class="c1"># Actions Log 的標題名稱</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[CD-Deploy]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># 同個 Concurrency Group 如果有新的 Job 會取消正在跑的</span>
<span class="c1"># 例如 重複觸發相同分支的打包任務，會取消前一個任務</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 手動表單觸發</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="c1"># 表單 Inputs 欄位</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># App 版本號</span>
      <span class="na">VERSION_NUMBER</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Version</span><span class="nv"> </span><span class="s">Number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">(e.g.,</span><span class="nv"> </span><span class="s">1.0.0).</span><span class="nv"> </span><span class="s">Auto-detect</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Xcode</span><span class="nv"> </span><span class="s">project</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">left</span><span class="nv"> </span><span class="s">blank.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># App Build Number</span>
      <span class="na">BUILD_NUMBER</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Build</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">(e.g.,</span><span class="nv"> </span><span class="s">1).</span><span class="nv"> </span><span class="s">Will</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">timestamp</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">left</span><span class="nv"> </span><span class="s">blank.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># App Release Note</span>
      <span class="na">RELEASE_NOTE</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release</span><span class="nv"> </span><span class="s">notes</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">deployment.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
  <span class="c1"># 其他 Workflow 呼叫此 Workflow 觸發</span>
  <span class="c1"># Nightly Build 會呼叫使用</span>
  <span class="na">workflow_call</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="c1"># App 版本號</span>
      <span class="na">VERSION_NUMBER</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Version</span><span class="nv"> </span><span class="s">Number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">(e.g.,</span><span class="nv"> </span><span class="s">1.0.0).</span><span class="nv"> </span><span class="s">Auto-detect</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Xcode</span><span class="nv"> </span><span class="s">project</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">left</span><span class="nv"> </span><span class="s">blank.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># App Build Number</span>
      <span class="na">BUILD_NUMBER</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Build</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">(e.g.,</span><span class="nv"> </span><span class="s">1).</span><span class="nv"> </span><span class="s">Will</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">timestamp</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">left</span><span class="nv"> </span><span class="s">blank.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="c1"># App Release Note</span>
      <span class="na">RELEASE_NOTE</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release</span><span class="nv"> </span><span class="s">notes</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">deployment.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">BRANCH</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Branch'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>


<span class="c1"># 定義全域靜態變數</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">APP_STORE_CONNECT_API_KEY_FILE_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">app_store_connect_api_key.json"</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job ID</span>
  <span class="na">deploy</span><span class="pi">:</span>
    <span class="c1"># Job 名稱 (可省略，有設定在 Log 顯示比較好讀)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy - Firebase App Distribution</span>
    
    <span class="c1"># Runner Label - 使用 GitHub Hosted Runner macos-15 來執行工作</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 請注意：因為此專案是 Public Repo 可以無限免費使用</span>
    <span class="c1"># 如果是 Private Repo 需要按計量收費，macOS 機器是最貴的(10倍)，可能跑 10 次就達到 2,000 分鐘免費上限</span>
    <span class="c1"># 建議使用 self-hosted Runner</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">macos-15</span>

    <span class="c1"># 設定最長 Timeout 時間，防止異常情況發生時無止盡的等待</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">30</span>

    <span class="c1"># use zsh</span>
    <span class="c1"># 可省略，只是我習慣用 zsh，預設是 bash</span>
    <span class="na">defaults</span><span class="pi">:</span>
      <span class="na">run</span><span class="pi">:</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">zsh {0}</span>

    <span class="c1"># 工作步驟</span>
    <span class="c1"># 工作步驟會照順序執行  </span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># git clone 當前專案 &amp; checkout 到執行的分支</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout repository</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="c1"># Git Large File Storage，我們的測試環境用不到</span>
          <span class="c1"># default: false</span>
          <span class="na">lfs</span><span class="pi">:</span> <span class="kc">false</span>
          
          <span class="c1"># 如果有指定則 Checkout 指定分支，沒有則使用預設(當前分支)</span>
          <span class="c1"># 因 on: schedule 事件只能在 main 主分支執行，因此想做 Nightly Build 之類的工作就需要指定分支</span>
          <span class="c1"># e.g. on: schedule -&gt; main 分支，Nightly Build master 分支</span>
          <span class="na">ref</span><span class="pi">:</span> <span class="s">${{ github.event.inputs.BRANCH || '' }}</span>

      <span class="c1"># ========== Certificates Steps ==========</span>
      
      <span class="c1"># 建議是使用 Fastlnae - Match 管理開發憑證並在 Lane 中直接執行 match 安裝設定好</span>
      <span class="c1"># Match 會用另一個 Private Repo 管理憑證，但要設定好 SSH Agent 才有權限 git clone private repo</span>
      <span class="c1"># ref: https://stackoverflow.com/questions/57612428/cloning-private-github-repository-within-organisation-in-actions</span>
      <span class="c1">#</span>
      <span class="c1">#</span>
      <span class="c1"># --- 以下是沒有使用 Fastlane - Match 的情況下直接下載 &amp; Import 憑證給 Runner 的做法 ---</span>
      <span class="c1"># ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development</span>
      <span class="c1">#</span>
      <span class="c1"># GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secret</span>
      <span class="c1"># 在 GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並移動到正確位置給系統讀取使用</span>
      <span class="c1"># 其他設定細節請參考文章</span>
      <span class="c1">#</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install the Apple certificate and provisioning profile</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">BUILD_CERTIFICATE_BASE64</span><span class="pi">:</span> <span class="s">${{ secrets.BUILD_CERTIFICATE_BASE64 }}</span>
          <span class="na">P12_PASSWORD</span><span class="pi">:</span> <span class="s">${{ secrets.BUILD_CERTIFICATE_P12_PASSWORD }}</span>
          <span class="na">BUILD_PROVISION_PROFILE_BASE64</span><span class="pi">:</span> <span class="s">${{ secrets.BUILD_PROVISION_PROFILE_BASE64 }}</span>
          <span class="c1"># GitHub Hosted Runner 為自定義字串</span>
          <span class="c1"># Self-hosted Runner 為機器登入密碼</span>
          <span class="na">KEYCHAIN_PASSWORD</span><span class="pi">:</span> <span class="s">${{ secrets.KEYCHAIN_PASSWORD }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># create variables</span>
          <span class="s">CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12</span>
          <span class="s">PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision</span>
          <span class="s">KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db</span>

          <span class="s"># import certificate and provisioning profile from secrets</span>
          <span class="s">echo -n "$BUILD_CERTIFICATE_BASE64" | base64 --decode -o $CERTIFICATE_PATH</span>
          <span class="s">echo -n "$BUILD_PROVISION_PROFILE_BASE64" | base64 --decode -o $PP_PATH</span>

          <span class="s"># create temporary keychain</span>
          <span class="s">security create-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH</span>
          <span class="s">security set-keychain-settings -lut 21600 $KEYCHAIN_PATH</span>
          <span class="s">security unlock-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH</span>

          <span class="s"># import certificate to keychain</span>
          <span class="s">security import $CERTIFICATE_PATH -P "$P12_PASSWORD" -A -t cert -f pkcs12 -k $KEYCHAIN_PATH</span>
          <span class="s">security set-key-partition-list -S apple-tool:,apple: -k "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH</span>
          <span class="s">security list-keychain -d user -s $KEYCHAIN_PATH</span>

          <span class="s"># apply provisioning profile</span>
          <span class="s">mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles</span>
          <span class="s">cp $PP_PATH ~/Library/MobileDevice/Provisioning\ Profiles</span>

      <span class="c1"># App Store Connect API Fastlane JSON Key</span>
      <span class="c1"># 另一個在打包環境幾乎是必須的 App Store Connect API Fastlane JSON Key (.json)</span>
      <span class="c1"># format: .json 內容格式：https://docs.fastlane.tools/app-store-connect-api/</span>
      <span class="c1"># 裡面包含 App Store Connect API .p8 Key</span>
      <span class="c1"># 會在後續帶給 Fastlane，用於上傳到 Testflight、App Store API 使用</span>
      <span class="c1">#</span>
      <span class="c1"># GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secret</span>
      <span class="c1"># 在 GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案供其他步驟引用使用</span>
      <span class="c1"># 其他設定細節請參考文章</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Read and Write Apple Store Connect API Key to Temp</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">APP_STORE_CONNECT_API_KEY_BASE64</span><span class="pi">:</span> <span class="s">${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}</span>
          <span class="na">APP_STORE_CONNECT_API_KEY_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">runner.temp</span><span class="nv"> </span><span class="s">}}/${{</span><span class="nv"> </span><span class="s">env.APP_STORE_CONNECT_API_KEY_FILE_NAME</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># import certificate and provisioning profile from secrets</span>
          <span class="s">echo -n "$APP_STORE_CONNECT_API_KEY_BASE64" | base64 --decode -o $APP_STORE_CONNECT_API_KEY_PATH</span>

      <span class="c1"># ========== Env Setup Steps ==========</span>
      
      <span class="c1"># 讀取專案指定的 XCode 版本</span>
      <span class="c1"># 在後續之中，我們自己手動指定使用的 XCode_x.x.x.app</span>
      <span class="c1"># 而不使用 xcversion，因為 xcversion 已經 sunset 不穩定。 </span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Read .xcode-version</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">read_xcode_version</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">XCODE_VERSION=$(cat .xcode-version)</span>
          <span class="s">echo "XCODE_VERSION: ${XCODE_VERSION}"</span>
          <span class="s">echo "xcode_version=${XCODE_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>

          <span class="s"># 也可以直接在這指定全域 XCode 版本，這樣就不用在後續步驟指定 DEVELOPER_DIR</span>
          <span class="s"># 但此指令需要 sudoer 權限，如果是 self-hosted runner 就要確定 runner 執行環境有 sudo 權限</span>
          <span class="s"># sudo xcode-select -s "/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer"</span>

      <span class="c1"># 讀取專案指定的 Ruby 版本</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Read .ruby-version</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">read_ruby_version</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">RUBY_VERSION=$(cat .ruby-version)</span>
          <span class="s">echo "RUBY_VERSION: ${RUBY_VERSION}"</span>
          <span class="s">echo "ruby_version=${RUBY_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>

      <span class="c1"># 安裝或設定 Runner Ruby 版本成專案指定版本</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Ruby</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ruby-version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">steps.read_ruby_version.outputs.ruby_version</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="c1"># 可設可不設，原因是之前在 self-hosted 起多個 runner 跑 CI/CD 因為 cocoapods repos 是共用目錄</span>
      <span class="c1"># 解決的問題是：有很小的機率會出現在同時 pod install 時拉 cocoapods repos 出現衝突(因為預設都是用) $HOME/.cocoapods/</span>
      <span class="c1"># GitHub Hosted Runner 則不需此設定</span>
      <span class="c1"># - name: Change Cocoapods Repos Folder</span>
      <span class="c1">#   if: contains(runner.labels, 'self-hosted')</span>
      <span class="c1">#   run: |</span>
      <span class="c1">#     # 每個 Runner 用自己的 .cocoapods 資料夾，防止資源衝突</span>
      <span class="c1">#     mkdir -p "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/"</span>
      <span class="c1">#     export CP_HOME_DIR="$HOME/.cocoapods-${{ env.RUNNER_NAME }}"</span>
      <span class="c1">#     rm -f "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock"</span>

      <span class="c1"># ========== Cache Setting Steps ==========</span>
      <span class="c1"># 請注意，就算是 self-hosted，Cache 目前也是 Cloud Cache 會計算用量</span>
      <span class="c1"># 規則：7 天未 hit 自動刪除、單個 Cache 上限 10 GB、Action 成功才會 Cache</span>
      <span class="c1"># Public Repo: 免費無限制</span>
      <span class="c1"># Private Repo: 5 GB 起</span>
      <span class="c1"># Self-hosted 可以自己用 shell script 撰寫 Cache &amp; Restore 策略或使用其他工具協助</span>
      
      <span class="c1"># Bundle Cache (Gemfile)</span>
      <span class="c1"># 對應 Makefile 中我們指定了 Bundle  安裝路徑 ./vendor 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache Bundle</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">./vendor</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-bundle-</span>

      <span class="c1"># CocoaPods Cache (Podfile)</span>
      <span class="c1"># 默認就是 專案/Pods 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache CocoaPods</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">./Product/Pods</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-cocoapods-</span>

      <span class="c1"># Mint cache</span>
      <span class="c1"># 對應 Makefile 中我們指定的 Mint 安裝路徑 ./mint 下</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache Mint</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./mint</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-mint-${{ hashFiles('Mintfile') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-mint-</span>

      <span class="c1"># ====================</span>

      <span class="c1"># 專案 Setup &amp; 依賴安裝</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup &amp; Install Dependency</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># 執行 Makefile 中封裝的 Setup 指令，對應成指令大概是：</span>
          <span class="s"># brew install mint</span>
          <span class="s"># bundle config set path 'vendor/bundle'</span>
          <span class="s"># bundle install</span>
          <span class="s"># mint bootstrap</span>
          <span class="s"># ...</span>
          <span class="s"># 等等 setup 指令</span>
          <span class="s">make setup</span>

          <span class="s"># 執行 Makefile 中封裝的 Install 指令，對應成指令大概是：</span>
          <span class="s"># mint run yonaskolb/XcodeGen --quiet</span>
          <span class="s"># bundle exec pod install</span>
          <span class="s"># ...</span>
          <span class="s"># 等等 install 指令</span>
          <span class="s">make install</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Beta</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">deploy</span>
        <span class="c1"># 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/</span>
        <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./Product/</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># 打包 Input 參數</span>
          <span class="na">VERSION_NUMBER</span><span class="pi">:</span> <span class="s">${{ inputs.VERSION_NUMBER || '' }}</span>
          <span class="na">BUILD_NUMBER</span><span class="pi">:</span> <span class="s">${{ inputs.BUILD_NUMBER || '' }}</span>
          <span class="na">RELEASE_NOTE</span><span class="pi">:</span> <span class="s">${{ inputs.RELEASE_NOTE || '' }}</span>
          <span class="na">AUTHOR</span><span class="pi">:</span> <span class="s">${{ github.actor }}</span>

          <span class="c1"># Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets</span>
          <span class="c1"># Firebase CLI Token 密鑰 (取得方式請參考文章)</span>
          <span class="na">FIREBASE_CLI_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.FIREBASE_CLI_TOKEN }}</span>
          <span class="c1"># Apple Developer Program Team ID</span>
          <span class="na">TEAM_ID</span><span class="pi">:</span> <span class="s">${{ secrets.TEAM_ID }}</span>
                    
          <span class="c1"># 指定這個 Job 要使用 XCode_x.x.x 指定的版本執行</span>
          <span class="na">DEVELOPER_DIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/Applications/Xcode_${{</span><span class="nv"> </span><span class="s">steps.read_xcode_version.outputs.xcode_version</span><span class="nv"> </span><span class="s">}}.app/Contents/Developer"</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># 取得當前 Timestamp</span>
          <span class="s">BUILD_TIMESTAMP=$(date +'%Y%m%d%H%M%S')</span>

          <span class="s"># 如果 BUILD_NUMBER 沒有值，用 Timestamp 當 App Build Number</span>
          <span class="s">BUILD_NUMBER="${BUILD_NUMBER:-$BUILD_TIMESTAMP}"</span>
  
          <span class="s">ID="${{ github.run_id }}"</span>
          <span class="s">COMMIT_SHA="${{ github.sha }}"</span>
          <span class="s">BRANCH_NAME="${{ github.ref_name }}"</span>
          <span class="s">AUTHOR="${{ env.AUTHOR }}"</span>

          <span class="s"># 組合 Release Note</span>
          <span class="s">RELEASE_NOTE="${{ env.RELEASE_NOTE }}</span>
          <span class="s">ID: ${ID}</span>
          <span class="s">Commit SHA: ${COMMIT_SHA}</span>
          <span class="s">Branch: ${BRANCH_NAME}</span>
          <span class="s">Author: ${AUTHOR}</span>
          <span class="s">"</span>

          <span class="s"># 執行 Fastlane 打包＆部署 Lane</span>
          <span class="s">bundle exec fastlane beta release_notes:"${RELEASE_NOTE}" version_number:"${VERSION_NUMBER}" build_number:"${BUILD_NUMBER}"</span>

      <span class="c1"># GitHub Actions 建議的 self-hosted 安全性設定：</span>
      <span class="c1"># ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development#required-clean-up-on-self-hosted-runners</span>
      <span class="c1"># 對應 Step: Install the Apple certificate and provisioning profile</span>
      <span class="c1"># 用途是刪除機器上下載下來的金鑰憑證</span>
      <span class="c1"># 如果你是用 Match 則需要改寫成 Match 的 Clean</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clean up keychain and provisioning profile</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ always() &amp;&amp; contains(runner.labels, 'self-hosted') }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">security delete-keychain $RUNNER_TEMP/app-signing.keychain-db</span>
          <span class="s">rm ~/Library/MobileDevice/Provisioning\ Profiles/build_pp.mobileprovision</span>
</pre></table></code></div></div><ul><li>記得到 Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; secrets 新增一個 <code class="language-plaintext highlighter-rouge">TEAM_ID</code> 變數，內容是 Apple Developer Team ID 字串。</ul><p><a href="/assets/4b001d2e8440/1*dxdmT_N_w_VUd56f6GRLSQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*dxdmT_N_w_VUd56f6GRLSQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTgxIiBoZWlnaHQ9IjQ5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><strong>Commit 檔案到 Repo 主分支，測試看看打包功能：</strong></p><p><a href="/assets/4b001d2e8440/1*Z_UAfWAsJSIoWxeTRMvtDQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Z_UAfWAsJSIoWxeTRMvtDQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDcyIiBoZWlnaHQ9IjY4NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><em>請注意若其他分支要使用此 Action 需要先 Merge 主分支的 CD-Deploy.yml 檔案。</em></p></blockquote><p><strong>等待任務跑完：</strong></p><p><a href="/assets/4b001d2e8440/1*Q-c2IUlJpssooiqcqcm_Bg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Q-c2IUlJpssooiqcqcm_Bg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzg2IiBoZWlnaHQ9IjEyODgiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="/assets/4b001d2e8440/1*W8PBkatfsITMDFSlp7xpjg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*W8PBkatfsITMDFSlp7xpjg.webp" alt="[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16114046420){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9Ijk3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16114046420" target="_blank">Demo</a></p><blockquote><p><strong><em>打包＋部署成功 ✅</em></strong></p></blockquote><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/CD-Deploy.yml" target="_blank">CD-Deploy.yml</a></strong></p><h4 id="技術細節--firebase-cli-token-取得設定"><span class="me-2">技術細節 — Firebase CLI Token 取得＆設定</span><a href="#技術細節--firebase-cli-token-取得設定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>按照 <a href="https://firebase.google.com/docs/cli?hl=zh-tw#install-cli-mac-linux" target="_blank">Firebase 官方文件步驟</a> ：</p><p>先安裝好 Firebase CLI 工具：</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-sL</span> https://firebase.tools | bash
</pre></table></code></div></div><p>執行：</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>firebase login:ci
</pre></table></code></div></div><p>完成登入、授權：</p><p><a href="/assets/4b001d2e8440/1*Jex5aYzRSs7Trfx6z_e1Aw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Jex5aYzRSs7Trfx6z_e1Aw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDYzIiBoZWlnaHQ9IjcwMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/4b001d2e8440/1*S-1ckn9WC6j0DIqZGSdUUg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*S-1ckn9WC6j0DIqZGSdUUg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MjciIGhlaWdodD0iMjEzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>回到 Terminal 複製 Firebase CLI Token:</p><p><a href="/assets/4b001d2e8440/1*sa_h8L08JbeC2nA0kACQtQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*sa_h8L08JbeC2nA0kACQtQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODIiIGhlaWdodD0iNDgzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">FIREBASE_CLI_TOKEN</code> 並貼上 Firebase CLI Token。</p><p><a href="/assets/4b001d2e8440/1*Lc6yGPu7L_0z6u1HH2PB5A.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Lc6yGPu7L_0z6u1HH2PB5A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTcxIiBoZWlnaHQ9IjUxNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><strong><em>這個 Token = 你的登入身份</em></strong> <em>，請妥善保存，如果帳號離職也需要進行更換。</em></p></blockquote><h4 id="技術細節--install-the-apple-certificate-and-provisioning-profile"><span class="me-2">技術細節 — Install the Apple certificate and provisioning profile</span><a href="#技術細節--install-the-apple-certificate-and-provisioning-profile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>補充開發憑證匯入 Runner 的步驟細節。</p><p>因 GitHub Actions Secret 無法儲存檔案，因此所有憑證檔案都要先轉成 Base64 Encoded 文字格式存在 Secrets，GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並移動到正確位置給系統讀取使用。</p><p><strong>打包 Development 需要兩把金鑰憑證：</strong></p><ul><li><a href="https://developer.apple.com/account/resources/certificates/list" target="_blank">Provision Profile ( .mobileprovision)</a><li><a href="https://developer.apple.com/account/resources/certificates/list" target="_blank">Development Certifcate ( .p12)</a></ul><p><a href="/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.webp" alt="cicd.mobileprovision" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTE3IiBoZWlnaHQ9IjYxNiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>cicd.mobileprovision</p><p><a href="/assets/4b001d2e8440/1*RkeZ1PkXeY9Nt1kSRJKEQw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*RkeZ1PkXeY9Nt1kSRJKEQw.webp" alt="development.cer" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDc4IiBoZWlnaHQ9IjczOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>development.cer</p><p>從 <a href="https://developer.apple.com/account/resources/certificates/list" target="_blank">Apple Developer</a> 中下載的 Certificate 是 .cer 格式，而我們需要的是 .p12 格式，可以先把下載下來的 .cer 點兩下安裝到 Keychain，然後打開 Keychain 選擇該憑證右鍵 Export 匯出。</p><p><a href="/assets/4b001d2e8440/1*HJMxwM3IDjxT-UGqnoUtWw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*HJMxwM3IDjxT-UGqnoUtWw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MjQiIGhlaWdodD0iNTI2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>檔案名稱：cicd.p12、格式 .p12</p><p>P12 金鑰密碼：輸入一組安全的自訂義字串 (範例是不好的示範，用 <code class="language-plaintext highlighter-rouge">123456</code> )</p><p><a href="/assets/4b001d2e8440/1*tyH0XqDVPGPWFJPL4dxksw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*tyH0XqDVPGPWFJPL4dxksw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzIiIGhlaWdodD0iMzU2Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4b001d2e8440/1*qKeZWel3w_5wW7meMtHmLA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*qKeZWel3w_5wW7meMtHmLA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTYiIGhlaWdodD0iMzgxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><strong>現在兩個檔案：</strong> cicd.p12、cicd.mobileprovision 都準備好了</p><p><strong>轉換成 BASE64 格式字串並存到 Repo Secrets：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">base64</span> <span class="nt">-i</span> cicd.mobileprovision | pbcopy
</pre></table></code></div></div><p>到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">BUILD_PROVISION_PROFILE_BASE64</code> 並貼上以上內容。</p><p>-</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">base64</span> <span class="nt">-i</span> cicd.p12 | pbcopy
</pre></table></code></div></div><p>到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">BUILD_CERTIFICATE_BASE64</code> 並貼上以上內容。</p><p>-</p><p>到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">P12_PASSWORD</code> 內容是剛匯出 P12 金鑰設定的密碼。</p><p>- 到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">KEYCHAIN_PASSWORD</code> ： 如果是 GitHub Hosted Runner 則隨便輸入一個任意字串， <strong>如果是 Self-hosted Runner 則為 macOS Runner 使用者的登入密碼</strong> 。</p><p><a href="/assets/4b001d2e8440/1*JZCkFUJCQsggqYtW8acjTw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*JZCkFUJCQsggqYtW8acjTw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDg4IiBoZWlnaHQ9IjQ5MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="技術細節-app-store-connect-api-key"><span class="me-2">技術細節 —App Store Connect API Key</span><a href="#技術細節-app-store-connect-api-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Fastlane 打包部署到 App Store, Testflight <a href="https://docs.fastlane.tools/app-store-connect-api/" target="_blank">必須提供的 .json 金鑰</a> ，同樣受限 GitHub Actions Secrets 只能存字串不能存檔案，所以我們也要把金鑰內容轉成 Base64 字串，GitHub Actions Step 中再動態讀出來寫入 TEMP 檔案並把檔案路徑給 Fastlane 引用使用。</p><p><strong>首先到 <a href="/posts/zrealm-dev/app-store-connect-api-%E5%BF%AB%E9%80%9F%E8%AE%80%E5%8F%96%E8%88%87%E7%AE%A1%E7%90%86-customer-reviews-%E6%8F%90%E5%8D%87-ios-app-%E8%A9%95%E5%83%B9%E6%95%B4%E5%90%88%E6%95%88%E7%8E%87-f1365e51902c/">App Store Connect 建立&amp;下載好 App Store Connect API Key</a> ( .p8) ：</strong></p><pre><code class="language-vbnet">-----BEGIN PRIVATE KEY-----
sss
axzzvcxz
zxzvzcxv
vzxcvzxvczxcvz
-----END PRIVATE KEY-----
</code></pre><p>新增一個 <code class="language-plaintext highlighter-rouge">app_store_connect_api.json</code> 檔案( <a href="https://docs.fastlane.tools/app-store-connect-api/" target="_blank">內容參考</a> )：</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">{</span>
  <span class="s2">"key_id"</span>: <span class="s2">"App Store Connect 上寫的 Key ID"</span>,
  <span class="s2">"issuer_id"</span>: <span class="s2">"App Store Connect 上寫的 Issuer ID"</span>,
  <span class="s2">"key"</span>: <span class="s2">"-----BEGIN PRIVATE KEY-----記得把換行改成</span><span class="se">\n</span><span class="s2">-----END PRIVATE KEY-----"</span>,
  <span class="s2">"duration"</span>: 1200, <span class="c"># optional (maximum 1200)</span>
  <span class="s2">"in_house"</span>: <span class="nb">false</span> <span class="c"># optional but may be required if using match/sigh</span>
<span class="o">}</span>
</pre></table></code></div></div><p>儲存檔案後執行：</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">base64</span> <span class="nt">-i</span> app_store_connect_api.json | pbcopy
</pre></table></code></div></div><p>將字串內容貼到 Repo → Settings → Secrets and variables → Actions → 新增一個 Secret: <code class="language-plaintext highlighter-rouge">APP_STORE_CONNECT_API_KEY_BASE64</code> 並貼上以上內容。</p><p><a href="/assets/4b001d2e8440/1*QxRuxEPEfWbJ383hhnxGkA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*QxRuxEPEfWbJ383hhnxGkA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTU5IiBoZWlnaHQ9IjU0OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><code class="language-plaintext highlighter-rouge">Read and Write Apple Store Connect API Key to Temp</code> Step 完成之後在後續的 Step 只要傳入 env <code class="language-plaintext highlighter-rouge">APP_STORE_CONNECT_API_KEY_PATH</code> :</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">APP_STORE_CONNECT_API_KEY_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${{</span><span class="nv"> </span><span class="s">runner.temp</span><span class="nv"> </span><span class="s">}}/${{</span><span class="nv"> </span><span class="s">env.APP_STORE_CONNECT_API_KEY_FILE_NAME</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">....</span>
</pre></table></code></div></div><p>Fastlane 就能自動取得使用。</p><h4 id="技術延伸--reuse-action-workflow-拆分打包和部署動作"><span class="me-2">技術延伸 — Reuse Action Workflow 拆分打包和部署動作</span><a href="#技術延伸--reuse-action-workflow-拆分打包和部署動作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>在這個案例中我們直接使用 Fastlane <code class="language-plaintext highlighter-rouge">beta</code> Lane 執行打包＋部署兩個動作。</p><p>在實際案例中我們可能需要將同一包打包結果分別部署到不同平台上(Firebase, Testflight…etc) 因此比較好的做法是打包是一個 Action、部署是一個 Action，不然會重復跑兩次打包；而且也更符合 CI/CD 的權責劃分。</p><blockquote><p><strong><em>以下爲範例介紹：</em></strong></p></blockquote><p><strong>CI-Build.yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
  <span class="na">workflow_call</span><span class="pi">:</span>
     <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">RELEASE_NOTE</span><span class="pi">:</span>
          <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release</span><span class="nv"> </span><span class="s">notes</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">deployment.'</span>
          <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">macos-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout Code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">make steup</span>
          <span class="s">make instal</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Project</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec fastlane build</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload Build Artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">build-artifact</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./fastlane/build/</span>
</pre></table></code></div></div><p><strong>CD-Deploy-Firebase.yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Firebase</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 當 Build Action 完成時自動觸發執行</span>
  <span class="na">workflow_run</span><span class="pi">:</span>
    <span class="na">workflows</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Build"</span><span class="pi">]</span>
    <span class="na">types</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">completed</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="c1"># 完成＋執行成功才執行部署</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.event.workflow_run.conclusion == 'success' }}</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout Code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">make steup</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download Build Artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">build-artifact</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./fastlane/build/</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Production</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">bundle exec fastlane deploy-firebase</span>
</pre></table></code></div></div><p><strong>CD-Deploy-Testflight.yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Testflight</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 當 Build Action 完成時自動觸發執行</span>
  <span class="na">workflow_run</span><span class="pi">:</span>
    <span class="na">workflows</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Build"</span><span class="pi">]</span>
    <span class="na">types</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">completed</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="c1"># 完成＋執行成功才執行部署</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.event.workflow_run.conclusion == 'success' }}</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout Code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">make steup</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download Build Artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">build-artifact</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./fastlane/build/</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Production</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">bundle exec fastlane deploy-testflight</span>
</pre></table></code></div></div><p><strong>另外也可以用 <a href="https://docs.github.com/en/actions/how-tos/sharing-automations/reusing-workflows" target="_blank">Reusing Workflow</a> :</strong></p><p><strong>CD-Deploy-Firebase.yml:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Firebase</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 任意的觸發條件，這裡以手動表單觸發為例</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">RELEASE_NOTE</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release</span><span class="nv"> </span><span class="s">notes</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">deployment.'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">Build</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">./.github/workflows/CD-Build.yml</span>
    <span class="na">secrets</span><span class="pi">:</span> <span class="s">inherit</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">RELEASE_NOTE</span><span class="pi">:</span> <span class="s">${{ inputs.RELEASE_NOTE }}</span>

  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="c1"># Job 預設是並發執行，用 needs 限制需等待 build 完成才執行</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build</span><span class="pi">]</span>
    <span class="c1"># 執行成功，才部署</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ always() &amp;&amp; needs.deploy.result == 'success' }}</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout Code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">make steup</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download Build Artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">build-artifact</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./fastlane/build/</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Production</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">bundle exec fastlane deploy-firebase</span>
</pre></table></code></div></div><h4 id="github-actions--artifact"><span class="me-2">GitHub Actions — Artifact</span><a href="#github-actions--artifact" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>同 Cache，目前 <strong>就算是 Self-hosted Runner Artifcact 功能依然會走 GitHub Cloud</strong> 受到使用量限制 ( <a href="https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions#included-storage-and-minutes" target="_blank">免費帳號 500MB 起</a> )。</p><blockquote><p><em>Self-hosted Runner 要達到類似的效果可以自行建立共享主機目錄或找其他工具替代。</em></p></blockquote><p>因此目前 Artifact 實際我只用來存放小資料，例如 Snapshot Tests 的錯誤結果、測試報告…等等</p><h3 id="ci-nightly-build-執行快照單元測試打包cd-部署到-firebase-app-distribution"><span class="me-2">CI— Nightly Build 執行快照+單元測試+打包+CD 部署到 Firebase App Distribution</span><a href="#ci-nightly-build-執行快照單元測試打包cd-部署到-firebase-app-distribution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="流程-2"><span class="me-2">流程</span><a href="#流程-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>每天凌晨 3 點自動針對 main(develop or master) 分支跑全部測試(unit+snapshot tests)，如果失敗則傳送失敗通知到 Slack 工作群組；如果成功則打包+部署一個版本到 Firebase App Disturbution，打包成功/失敗都會傳送 Slack 通知。</p><h4 id="ci-nightly-build-and-deployyml"><span class="me-2">CI-Nightly-Build-And-Deploy.yml</span><a href="#ci-nightly-build-and-deployyml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Repo → Actions → New workflow → set up a workflow yourself。</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre><td class="rouge-code"><pre><span class="c1"># Workflow(Action) 名稱</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">CI-Nightly Build And Deploy</span>

<span class="c1"># Actions Log 的標題名稱</span>
<span class="na">run-name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[CI-Nightly</span><span class="nv"> </span><span class="s">Build</span><span class="nv"> </span><span class="s">And</span><span class="nv"> </span><span class="s">Deploy]</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.ref</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># 觸發事件</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># 排程定時自動執行</span>
  <span class="c1"># https://crontab.guru/</span>
  <span class="c1"># UTC 時間</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># UTC 的 19:00 = 每天 UTC+8 的 03:00</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">19</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>
  <span class="c1"># 手動觸發</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="c1"># Job 工作項目</span>
<span class="c1"># Job 會並發執行</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># 測試工作</span>
  <span class="na">testing</span><span class="pi">:</span>
    <span class="c1"># Reuse Workflow (workflow_call)</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">./.github/workflows/CI-Testing.yml</span>
    <span class="c1"># 傳遞所有 Secrets 給 CD-Testing.yml</span>
    <span class="na">secrets</span><span class="pi">:</span> <span class="s">inherit</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="c1"># 執行全部測試</span>
      <span class="na">TEST_LANE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">run_all_tests"</span>
      <span class="c1"># 目標分支：main, develop or master...etc</span>
      <span class="na">BRANCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">main"</span>

  <span class="na">deploy-env</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">outputs</span><span class="pi">:</span>
      <span class="na">DATE_STRING</span><span class="pi">:</span> <span class="s">${{ steps.get_date.outputs.DATE_STRING }}</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get Date String</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">get_date</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">VERSION_DATE=$(date -u '+%Y%m%d')</span>
          <span class="s">echo "${VERSION_DATE}"</span>
          <span class="s">echo "DATE_STRING=${VERSION_DATE}" &gt;&gt; $GITHUB_ENV</span>
          <span class="s">echo "DATE_STRING=${VERSION_DATE}" &gt;&gt; $GITHUB_OUTPUT</span>
    
  <span class="na">deploy</span><span class="pi">:</span>
    <span class="c1"># Job 預設是並發執行，用 needs 限制需等待 testing 和 deploy-env 完成才執行</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">testing</span><span class="pi">,</span> <span class="nv">deploy-env</span><span class="pi">]</span>
    <span class="c1"># 如果測試成功才執行</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ needs.testing.result == 'success' }}</span>
    <span class="c1"># Reuse Workflow (workflow_call)</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">./.github/workflows/CD-Deploy.yml</span>
    <span class="c1"># 傳遞所有 Secrets 給 CD-Deploy.yml</span>
    <span class="na">secrets</span><span class="pi">:</span> <span class="s">inherit</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">VERSION_NUMBER</span><span class="pi">:</span> <span class="s">NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }}</span>
      <span class="na">RELEASE_NOTE</span><span class="pi">:</span> <span class="s">NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }}</span>
      <span class="c1"># 目標分支：main, develop or master...etc</span>
      <span class="na">BRANCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">main"</span>

<span class="c1"># ----- Slack Notify -----</span>
  <span class="na">testing-failed-slack-notify</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">testing</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ needs.testing.result == 'failure' }}</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post text to a Slack channel</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">slackapi/slack-github-action@v2.1.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">chat.postMessage</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
          <span class="na">payload</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}</span>
            <span class="s">text: ":x: Nightly Build - Testing 失敗\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;"</span>

  <span class="na">deploy-failed-slack-notify</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">deploy</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ needs.deploy.result == 'failure' }}</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post text to a Slack channel</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">slackapi/slack-github-action@v2.1.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">chat.postMessage</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
          <span class="na">payload</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}</span>
            <span class="s">text: ":x: Nightly Build Deploy 失敗\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;"</span>

  <span class="na">deploy-success-slack-notify</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">deploy</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ needs.deploy.result == 'success' }}</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post text to a Slack channel</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">slackapi/slack-github-action@v2.1.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">chat.postMessage</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.SLACK_BOT_TOKEN }}</span>
          <span class="na">payload</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}</span>
            <span class="s">text: ":white_check_mark: Nightly Build Deploy 成功\nWorkflow: &lt;${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run&gt;"</span>
</pre></table></code></div></div><p><strong>Commit 檔案到 Repo 主分支，手動觸發測試、打包功能看看結果：</strong></p><p><a href="/assets/4b001d2e8440/1*l71fL8oLoeAv-JX_FgkqzQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*l71fL8oLoeAv-JX_FgkqzQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjU2NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><blockquote><p><em>日後會每日自動觸發。</em></p></blockquote><p><a href="/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.webp" alt="[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjgwMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747" target="_blank">Demo</a></p><p><a href="/assets/4b001d2e8440/1*6DQL_v4eahSqSuVJZRPrEA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*6DQL_v4eahSqSuVJZRPrEA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMTAiIGhlaWdodD0iOTIiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>等待測試任務、打包部署任務、通知任務都完成後，查看結果。</p><p><a href="/assets/4b001d2e8440/1*4UVgyCQljqZQgzxHpXPB4g.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*4UVgyCQljqZQgzxHpXPB4g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDMiIGhlaWdodD0iOTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTQiIGhlaWdodD0iMTIwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>我們就能直接在手機上安裝 Nightly Build 版本來進行搶先體驗測試。</p><h4 id="技術細節"><span class="me-2">技術細節</span><a href="#技術細節" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>這個 Action 我們直接復用前面設計的 CI-Testing 和 CD-Deploy，組合成我們的 Nightly Build，非常彈性好用！</p><p><strong>完整程式碼： <a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/workflows/CI-Nightly-Build-And-Deploy.yml" target="_blank">CI-Nightly-Build-And-Deploy.yml</a></strong></p><h3 id="self-hosted-runner-注意事項"><span class="me-2">Self-hosted Runner 注意事項</span><a href="#self-hosted-runner-注意事項" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>本文是 Public Repo 因此直接使用 GitHub Hosted 的 macOS Runner，但在實際工作上我們的 Repo 一定是 Private，直接使用 GitHub Hosted Runner 超貴不划算(約一個月就能買一台 Mac Mini 放在公司吃到飽爽爽跑)，每一台依照效能可以起多個 Runner 同時並發接任務來做。</p><blockquote><p><strong><em>細節可參考 <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/">上一篇</a> 「 <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/">Self-hosted Runner 建置與改用</a> 」部分</em></strong> <em>，在本地電腦安裝好 XCode 跟基本環境後註冊、啟用 Runner、Action Worflow YAML 中把 <code class="language-plaintext highlighter-rouge">runs-on</code> 改成 <code class="language-plaintext highlighter-rouge">[self-hosted]</code> 即可。</em></p></blockquote><p>多個 Runner 在同一台電腦的問題，我們多半已在上面的 Actions 裡解決了，例如把所有依賴的共用目錄都改成本地目錄，還有一個測試會遇到的問題要解決，就是搶模擬器問題：「 <strong>當兩個測試 Job 被兩個 Runner 在同一台機器上同時檢來做，如果指定同個模擬器就會互相干擾導致測試失敗。」</strong></p><p>解決方法也很容易，就是為個別 Runner 都設定一台模擬器。</p><h4 id="多個-runner-在同台機器的模擬器設定"><span class="me-2">多個 Runner 在同台機器的模擬器設定</span><a href="#多個-runner-在同台機器的模擬器設定" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>假設我 <strong>同一台電腦上有兩個 Runner</strong> 在並行接收任務：</p><ul><li><code class="language-plaintext highlighter-rouge">ZhgChgLideMacBook-Pro-Runner-A</code><li><code class="language-plaintext highlighter-rouge">ZhgChgLideMacBook-Pro-Runner-B</code></ul><p><a href="/assets/4b001d2e8440/1*3ptg9Tl5fBbEIYB4kgh0kw.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*3ptg9Tl5fBbEIYB4kgh0kw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTkiIGhlaWdodD0iMzMzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>在 XCode 模擬器設定我們就需要新增兩個模擬器：</p><p><a href="/assets/4b001d2e8440/1*k9bR2C12Wk11HAKKiYJ2zg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*k9bR2C12Wk11HAKKiYJ2zg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDM3IiBoZWlnaHQ9IjY5NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p><a href="/assets/4b001d2e8440/1*iigArewZEW0063Q6xwZn7g.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*iigArewZEW0063Q6xwZn7g.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMjIiIGhlaWdodD0iMjgxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>型號、iOS 版本同測試環境</ul><p><strong>CI-Testing.yml 中測試步驟改成：</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c"># 執行 Fastlane Unit 測試 Lane</span>
      - name: Run Tests
        <span class="nb">id</span>: testing
        <span class="c"># 指定工作目錄，這樣後續指令就不用在特別 cd ./Product/</span>
        working-directory: ./Product/
        <span class="nb">env</span>:
          <span class="c"># ...</span>
          <span class="c"># Repo -&gt; Settings -&gt; Actions secrets and variables -&gt; variables</span>
          <span class="c"># 模擬器的 iOS 版本</span>
          SIMULATOR_IOS_VERSION: <span class="k">${</span><span class="p">{ vars.SIMULATOR_IOS_VERSION </span><span class="k">}</span><span class="o">}</span>

          <span class="c"># 當前 Runner 名稱</span>
          RUNNER_NAME: <span class="k">${</span><span class="p">{ runner.name </span><span class="k">}</span><span class="o">}</span>
          
          <span class="c"># ...</span>
        run: |

          <span class="c"># ...</span>
          bundle <span class="nb">exec </span>fastlane <span class="k">${</span><span class="nv">TEST_LANE</span><span class="k">}</span> device:<span class="s2">"</span><span class="k">${</span><span class="nv">RUNNER_NAME</span><span class="k">}</span><span class="s2"> (</span><span class="k">${</span><span class="nv">SIMULATOR_IOS_VERSION</span><span class="k">}</span><span class="s2">)"</span> | <span class="nb">tee</span> <span class="s2">"</span><span class="nv">$RUNNER_TEMP</span><span class="s2">/testing_output.txt"</span>
          <span class="c"># ...</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">device</code> <strong>改成</strong> <code class="language-plaintext highlighter-rouge">${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})</code><li><code class="language-plaintext highlighter-rouge">SIMULATOR_IOS_VERSION</code> 還是統一看 Repo variables 變數</ul><p><strong>組合結果就會是(以 18.4 為例)：</strong></p><ul><li>Runner: <code class="language-plaintext highlighter-rouge">ZhgChgLideMacBook-Pro-Runner-A</code> 模擬器: <strong>ZhgChgLideMacBook-Pro-Runner-A(18.4)</strong><li>Runner: <code class="language-plaintext highlighter-rouge">ZhgChgLideMacBook-Pro-Runner-B</code> 模擬器: <strong>ZhgChgLideMacBook-Pro-Runner-B(18.4)</strong></ul><p>這樣兩個 Runner 同時在執行測試時就會起兩個模擬器自己跑自己的了。</p><h4 id="完整專案-repo"><span class="me-2">完整專案 Repo</span><a href="#完整專案-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/5952f3220c95ced947b9ee50d9c542b2edbb424be50c51c582cb226ce5f5df63/ZhgChgLi/github-actions-ci-cd-demo" alt="" loading="lazy"></a></p><h3 id="補充-ssh-agent-設定--for-fastlane-match-or-private-cocoapods-repo"><span class="me-2">補充 SSH Agent 設定 — For Fastlane Match or Private CocoaPods Repo</span><a href="#補充-ssh-agent-設定--for-fastlane-match-or-private-cocoapods-repo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在使用 Fastlane Match 或 Private CocoaPods Repo，因為是在另一個 Private Repo 當中，當前 Repo/Action 環境無法直接 git clone，需要使用 ssh agent 設定好環境，在 Action 執行時才有權限操作。</p><h4 id="step-1-產生-ssh-key"><span class="me-2">Step 1. 產生 SSH Key</span><a href="#step-1-產生-ssh-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4b001d2e8440/1*kPWl9hombBgQ15i-n2sY2A.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*kPWl9hombBgQ15i-n2sY2A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2ODIiIGhlaWdodD0iNDgzIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"zhgchgli@gmail.com"</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Enter file in which to save the key (/Users/zhgchgli/.ssh/id_ed25519):</code> /Users/zhgchgli/Downloads/zhgchgli</p><ul><li>輸入到下載路徑方便我們拷貝內容</ul><p><code class="language-plaintext highlighter-rouge">Enter passphrase for “/Users/zhgchgli/Downloads/zhgchgli” (empty for no passphrase):</code></p><ul><li><strong>留空：</strong> CI/CD 使用，無法在 CLI 交互下輸入 Passphrase， <strong>因此請留空</strong><li>產生完畢 ( .pub/private_key)</ul><p><a href="/assets/4b001d2e8440/1*aF5P6EK9Hfv-CI3MRZ8MCA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*aF5P6EK9Hfv-CI3MRZ8MCA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjAiIGhlaWdodD0iNTEiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><h4 id="step-2-到-private-repo-設定-deploy-key"><span class="me-2">Step 2. 到 Private Repo 設定 Deploy Key</span><a href="#step-2-到-private-repo-設定-deploy-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4b001d2e8440/1*3K6JvCHa23QfvWoNq2xdBQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*3K6JvCHa23QfvWoNq2xdBQ.webp" alt="github-actions-ci-cd-demo-certificates Repo" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTcyIiBoZWlnaHQ9Ijc4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>github-actions-ci-cd-demo-certificates Repo</p><p>Settings → Security → Deploy keys → Add deploy key。</p><ul><li>Title: 輸入 Key 名稱<li>Key: <code class="language-plaintext highlighter-rouge">貼上 .pub Key 內容</code></ul><p>完成。</p><p><a href="/assets/4b001d2e8440/1*Xo_g-AchEk0j4SGXOmBuxg.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Xo_g-AchEk0j4SGXOmBuxg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTY4IiBoZWlnaHQ9IjgxNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><h4 id="step-3-回-action-的-repo-設定-ssh-private-key-to-secrets"><span class="me-2">Step 3. 回 Action 的 Repo 設定 SSH Private Key to Secrets</span><a href="#step-3-回-action-的-repo-設定-ssh-private-key-to-secrets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/4b001d2e8440/1*Jm92pQHMOImQzZtmmvd1ng.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*Jm92pQHMOImQzZtmmvd1ng.webp" alt="github-actions-ci-cd-demo Repo" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTc0IiBoZWlnaHQ9Ijg5OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>github-actions-ci-cd-demo Repo</p><p>Settings → Secrets and variables → Actions → New repository secret。</p><ul><li>Name: 輸入密鑰變數名稱 <code class="language-plaintext highlighter-rouge">SSH_PRIVATE_KEY</code><li>Secret: <code class="language-plaintext highlighter-rouge">貼上 private_key 內容</code></ul><p>完成。</p><h4 id="step-4-ssh-agent-設定完成來驗證一下-git-clone-private-repo-的權限"><span class="me-2">Step 4. SSH Agent 設定完成，來驗證一下 Git Clone Private Repo 的權限</span><a href="#step-4-ssh-agent-設定完成來驗證一下-git-clone-private-repo-的權限" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/workflows/Demo-Git-Clone-Private-Repo.yml" target="_blank"><strong>Demo-Git-Clone-Private-Repo.yml</strong></a> <strong>:</strong></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Demo Git Clone Private Repo</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">clone-private-repo</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Git Clone Private Repo</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">timeout-minutes</span><span class="pi">:</span> <span class="m">30</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 🔐 啟用 SSH Agent 並加入私鑰</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup SSH Agent</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">webfactory/ssh-agent@v0.9.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ssh-private-key</span><span class="pi">:</span> <span class="s">${{ secrets.SSH_PRIVATE_KEY }}</span>

      <span class="c1"># 🛡️ 將 github.com 加入 known_hosts 以避免 host verification 錯誤</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Add GitHub to known_hosts</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">mkdir -p ~/.ssh</span>
          <span class="s">ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span>
      <span class="c1"># 📦 使用 SSH clone private repo 並驗證</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clone and Verify Private Repo</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">git clone git@github.com:ZhgChgLi/github-actions-ci-cd-demo-certificates.git ./fakeMatch/</span>
          <span class="s">if [ -d "./fakeMatch/.git" ]; then</span>
            <span class="s">echo "✅ Repo cloned successfully into ./fakeMatch/"</span>
            <span class="s">cd ./fakeMatch</span>
            <span class="s">echo "📌 Current commit: $(git rev-parse --short HEAD)"</span>
          <span class="s">else</span>
            <span class="s">echo "❌ Clone failed. SSH Agent may not be configured properly."</span>
            <span class="s">exit 1</span>
          <span class="s">fi</span>
</pre></table></code></div></div><p>可以用以上 Action 驗證一下是否設定成功。</p><p><a href="/assets/4b001d2e8440/1*YLbr7l0FBSOYx_fQT-tiCA.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*YLbr7l0FBSOYx_fQT-tiCA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY5MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>成功，後續 <code class="language-plaintext highlighter-rouge">fastlane match</code> or <code class="language-plaintext highlighter-rouge">pod install</code> private pods 應該就能正確執行。</p><h3 id="總結"><span class="me-2">總結</span><a href="#總結" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>這篇文章詳細紀錄了使用 GitHub Actions 開發完整的 iOS CI/CD 流程，下一篇將優化使用者端(工程師/PM/設計師)體驗， <strong>完善 Slack 通知及使用 Google Apps Script Web App 串接 GitHub Actions 打造免費易用的跨團隊打包平台工具。</strong></p><h3 id="系列文章"><span class="me-2">系列文章：</span><a href="#系列文章" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="/posts/zrealm-dev/ci-cd-%E6%98%AF%E4%BB%80%E9%BA%BC-%E6%89%93%E9%80%A0%E9%AB%98%E6%95%88%E7%A9%A9%E5%AE%9A%E9%96%8B%E7%99%BC%E5%9C%98%E9%9A%8A%E7%9A%84%E9%97%9C%E9%8D%B5%E6%B5%81%E7%A8%8B%E8%88%87%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87-c008a9e8ceca/"><strong>CI/CD 實戰指南（一）：CI/CD 是什麼？如何透過 CI/CD 打造穩定高效的開發團隊？工具選擇？</strong></a><li><a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/"><strong>CI/CD 實戰指南（二）：GitHub Actions 與 self-hosted Runner 使用與建置大全</strong></a><li><a href="/posts/zrealm-dev/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8-4b001d2e8440/"><strong>CI/CD 實戰指南（三）：使用 GitHub Actions 實作 App 專案的 CI 與 CD 工作流程</strong></a><li><a href="/posts/zrealm-dev/ci-cd-%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8-google-apps-script-web-app-%E4%B8%B2%E6%8E%A5-github-actions-%E6%8F%90%E5%8D%87%E8%B7%A8%E5%9C%98%E9%9A%8A%E6%95%88%E7%8E%87-4273e57e7148/"><strong>CI/CD 實戰指南（四）：使用 Google Apps Script Web App 串接 GitHub Actions 建置免費易用的打包工具平台</strong></a></ul><h4 id="buy-me-a-coffee"><span class="me-2"><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></span><a href="#buy-me-a-coffee" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank"><strong><em>本系列文章花費了大量的時間精力撰寫，如果內容對您有幫助、對您的團隊有實質提升工作效率與產品品質；歡迎請我喝杯咖啡，感謝支持！</em></strong></a></p></blockquote><p><a href="/assets/4b001d2e8440/1*QJj54G9gOjtQS-rbHVT1SQ.webp" class="popup img-link blur"><img data-src="/assets/4b001d2e8440/1*QJj54G9gOjtQS-rbHVT1SQ.webp" alt="[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iNzAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank">Buy me a coffee</a></p><p>有任何問題及指教歡迎 <a href="https://www.zhgchg.li/contact" target="_blank">與我聯絡</a> 。</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=🍺&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>本文首次發表於 Medium (<a href="https://medium.com/p/4b001d2e8440" target="_blank"><strong>點此查看原始版本</strong></a>)，由 <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> 提供自動轉換與同步技術。</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2025-07-07-4b001d2e8440.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/cicd/" class="post-tag no-text-decoration" >cicd</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >github-actions</a> <a href="/tags/firebase/" class="post-tag no-text-decoration" >firebase</a> <a href="/tags/cicd-pipeline/" class="post-tag no-text-decoration" >cicd-pipeline</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GitHub%20Actions%20iOS%20CI/CD%EF%BD%9C%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE%E3%80%81%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-ios-ci-cd-%25E5%25AE%258C%25E6%2595%25B4%25E5%25AF%25A6%25E4%25BD%259C%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25BB%25BA%25E7%25BD%25AE-%25E6%25B8%25AC%25E8%25A9%25A6%25E8%2588%2587%25E9%2583%25A8%25E7%25BD%25B2%25E6%25B5%2581%25E7%25A8%258B%25E6%2595%2599%25E5%25AD%25B8-4b001d2e8440%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GitHub%20Actions%20iOS%20CI/CD%EF%BD%9C%E5%AE%8C%E6%95%B4%E5%AF%A6%E4%BD%9C%E8%87%AA%E5%8B%95%E5%8C%96%E5%BB%BA%E7%BD%AE%E3%80%81%E6%B8%AC%E8%A9%A6%E8%88%87%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%B8%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-ios-ci-cd-%25E5%25AE%258C%25E6%2595%25B4%25E5%25AF%25A6%25E4%25BD%259C%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25BB%25BA%25E7%25BD%25AE-%25E6%25B8%25AC%25E8%25A9%25A6%25E8%2588%2587%25E9%2583%25A8%25E7%25BD%25B2%25E6%25B5%2581%25E7%25A8%258B%25E6%2595%2599%25E5%25AD%25B8-4b001d2e8440%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fgithub-actions-ios-ci-cd-%25E5%25AE%258C%25E6%2595%25B4%25E5%25AF%25A6%25E4%25BD%259C%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25BB%25BA%25E7%25BD%25AE-%25E6%25B8%25AC%25E8%25A9%25A6%25E8%2588%2587%25E9%2583%25A8%25E7%25BD%25B2%25E6%25B5%2581%25E7%25A8%258B%25E6%2595%2599%25E5%25AD%25B8-4b001d2e8440%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automation｜Auto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS 捷径自动化应用场景 — 自动转发简讯与自动建立提醒待办事项</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS 捷徑自動化應用場景 — 自動轉發簡訊與自動建立提醒待辦事項</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxing｜Premium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch 原厂不锈钢米兰表带开箱</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">章節 (Chapters)🔖</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AE%9E%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%A6-4b001d2e8440/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751900544" data-df="ll" > Jul 7, 2025 </time><h4 class="pt-0 my-2">GitHub Actions iOS CI/CD｜完整实作自动化建置、测试与部署流程教学</h4><div class="text-muted"><p>针对iOS开发者打造的GitHub Actions CI/CD流程，解决手动建置与测试繁琐问题，结合Fastlane与Firebase实现自动化打包与部署，提升团队开发效率与产品品质。</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/en/github-actions-ios-app-ci-cd-workflow-automation-for-faster-builds-and-deployments-4b001d2e8440/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751900544" data-df="ll" > Jul 7, 2025 </time><h4 class="pt-0 my-2">GitHub Actions｜iOS App CI/CD Workflow Automation for Faster Builds and Deployments</h4><div class="text-muted"><p>iOS developers struggling with manual build and deployment can automate CI/CD using GitHub Actions to streamline testing and release, achieving faster and more reliable app delivery.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/github-actions-self-hosted-runner-%E8%A9%B3%E8%A7%A3%E8%88%87%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B-ci-cd-%E8%87%AA%E5%8B%95%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%BB%BA%E7%BD%AE-404bd5c70040/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1751458952" data-df="ll" > Jul 2, 2025 </time><h4 class="pt-0 my-2">GitHub Actions｜Self-hosted Runner 詳解與實戰案例｜CI/CD 自動化工作流程建置</h4><div class="text-muted"><p>針對開發團隊自動化需求，解析 GitHub Actions 與 Self-hosted Runner 架構與設定，並透過三大實戰案例教你快速建立自動標記 PR、指派負責人及每日 PR 統計通知，提升 CI/CD 執行效率與成本優化。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/zh-cn/github-actions-ios-ci-cd-%E5%AE%8C%E6%95%B4%E5%AE%9E%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BB%BA%E7%BD%AE-%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%95%99%E5%AD%A6-4b001d2e8440/" class="btn btn-outline-primary" aria-label="Older" ><p>GitHub Actions iOS CI/CD｜完整实作自动化建置、测试与部署流程教学</p></a> <a href="/posts/zrealm-dev/en/ci-cd-guide-integrate-google-apps-script-web-app-with-github-actions-for-free-packaging-platform-4273e57e7148/" class="btn btn-outline-primary" aria-label="Newer" ><p>CI/CD Guide｜Integrate Google Apps Script Web App with GitHub Actions for Free Packaging Platform</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">中文</a>|<a href="/tags/simplified-chinese">简中</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
