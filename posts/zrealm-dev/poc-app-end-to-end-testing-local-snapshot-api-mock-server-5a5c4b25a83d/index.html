<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="POC App End-to-End Testing Local Snapshot API Mock Server" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="ç‚ºç¾æˆ App åŠç¾æœ‰ API æ¶æ§‹å¯¦ç¾ E2E Testing çš„å¯èƒ½æ€§é©—è­‰" /><meta property="og:description" content="ç‚ºç¾æˆ App åŠç¾æœ‰ API æ¶æ§‹å¯¦ç¾ E2E Testing çš„å¯èƒ½æ€§é©—è­‰" /><link rel="canonical" href="https://zhgchg.li/posts/zrealm-dev/poc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d/" /><meta property="og:url" content="https://zhgchg.li/posts/zrealm-dev/poc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-28T22:53:27+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" /><meta property="twitter:title" content="POC App End-to-End Testing Local Snapshot API Mock Server" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2023-09-04T22:32:47+08:00","datePublished":"2023-08-28T22:53:27+08:00","description":"ç‚ºç¾æˆ App åŠç¾æœ‰ API æ¶æ§‹å¯¦ç¾ E2E Testing çš„å¯èƒ½æ€§é©—è­‰","headline":"POC App End-to-End Testing Local Snapshot API Mock Server","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg==","url":"https://zhgchg.li/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/zrealm-dev/poc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d/"},"url":"https://zhgchg.li/posts/zrealm-dev/poc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d/"}</script><title>POC App End-to-End Testing Local Snapshot API Mock Server | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0"> <a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a> An iOS, web, and automation developer from Taiwan ğŸ‡¹ğŸ‡¼ who also loves sharing, traveling, and writing.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>POC App End-to-End Testing Local Snapshot API Mock Server</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>POC App End-to-End Testing Local Snapshot API Mock Server</h1><p class="post-desc fw-light mb-4">ç‚ºç¾æˆ App åŠç¾æœ‰ API æ¶æ§‹å¯¦ç¾ E2E Testing çš„å¯èƒ½æ€§é©—è­‰</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1693234407" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 28, 2023 </time> </span> <span> Updated <time data-ts="1693837967" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 4, 2023 </time> </span><div class="mt-3 mb-3"> <a href="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" class="popup img-link preview-img blur"><img data-src="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="5096 words" > <em>28 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">POC App End-to-End Testing Local Snapshot API Mock Server</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">ç« ç¯€ (Chapters)ğŸ”–</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">POC App End-to-End Testing Local Snapshot API Mock Server</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><h3 id="poc-app-end-to-end-testing-local-snapshot-api-mock-server"><span class="me-2">[POC] App End-to-End Testing Local Snapshot API Mock Server</span><a href="#poc-app-end-to-end-testing-local-snapshot-api-mock-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ç‚ºç¾æˆ App åŠç¾æœ‰ API æ¶æ§‹å¯¦ç¾ E2E Testing çš„å¯èƒ½æ€§é©—è­‰</p><p><a href="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*L-FE2o3LRQQZSLZQx96urw.webp" alt="Photo by [freestocks](https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjkzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">freestocks</a></p><h3 id="å‰è¨€"><span class="me-2">å‰è¨€</span><a href="#å‰è¨€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ä½œç‚ºä¸€å€‹å·²åœ¨ç·šä¸Šé‹ä½œå¤šå¹´çš„å°ˆæ¡ˆï¼Œå¦‚ä½•æŒçºŒæå‡ç©©å®šæ€§æ˜¯ä¸€ä»¶æ¥µå…·æŒ‘æˆ°çš„å•é¡Œã€‚</p><h4 id="unit-testing"><span class="me-2">Unit Testing</span><a href="#unit-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5a5c4b25a83d/1*QAuldnLTydk33IgAdkXR-w.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*QAuldnLTydk33IgAdkXR-w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMTY4OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>App å› é–‹ç™¼èªè¨€ Swift/Kotlin éœæ…‹+ç·¨è­¯+å¼·å‹åˆ¥ æˆ– Objective-C to Swift å‹•æ…‹è½‰éœæ…‹ï¼Œåœ¨é–‹ç™¼æ™‚æ²’è€ƒæ…®åˆ°å¯æ¸¬è©¦æ€§æŠŠä»‹é¢ä¾è³´åˆ‡ä¹¾æ·¨ï¼Œå¾Œé¢è¦è£œ Unit Testing å¹¾ä¹ä¸å¯èƒ½ï¼›ä½†åœ¨é‡æ§‹çš„éç¨‹ä¹Ÿæœƒå¸¶ä¾†ä¸ç©©å®šå› ç´ ï¼Œæœƒé™·å…¥ä¸€å€‹é›ç”Ÿè›‹è›‹ç”Ÿé›å•é¡Œã€‚</p><h4 id="ui-testing"><span class="me-2">UI Testing</span><a href="#ui-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å° UI äº¤äº’ã€æŒ‰éˆ•æ¸¬è©¦ï¼›æ–°é–‹ç™¼æˆ–èˆŠæœ‰çš„ç•«é¢ç¨å¾®è§£è€¦è³‡æ–™ä¾è³´å°±å¯ä»¥å¯¦ç¾ã€‚</p><h4 id="snapshot-testing"><span class="me-2">SnapShot Testing</span><a href="#snapshot-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>é©—è­‰èª¿æ•´å‰å¾Œçš„ UI é¡¯ç¤ºå…§å®¹ã€æ¨£å¼æ˜¯å¦ä¸€è‡´ï¼›åŒ UI Testingï¼Œæ–°é–‹ç™¼æˆ–èˆŠæœ‰çš„ç•«é¢ç¨å¾®è§£è€¦è³‡æ–™ä¾è³´å°±å¯ä»¥å¯¦ç¾ã€‚</p><p>ç”¨åœ¨ Storyboard/XIB è½‰ Code Layout or UIView from OC to Swift å¾ˆå¯¦ç”¨ï¼›å¯ä»¥ç›´æ¥å°å…¥ <a href="https://github.com/pointfreeco" target="_blank">pointfreeco</a> / <a href="https://github.com/pointfreeco/swift-snapshot-testing" target="_blank">swift-snapshot-testing</a> å¿«é€Ÿå¯¦ç¾ã€‚</p><p><a href="https://github.com/pointfreeco/swift-snapshot-testing" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/b3cc52a5b949767e4cb0af82145ed6474334d3235bd785ee1f7891c6b65fd69a/pointfreeco/swift-snapshot-testing" alt="" loading="lazy"></a></p><p>é›–ç„¶æˆ‘å€‘å¯ä»¥å¾ŒæœŸè£œä¸Š UI Testingã€SnapShot Testingï¼Œä½†èƒ½æ¶µè“‹çš„æ¸¬è©¦ç¯„åœå¾ˆæœ‰é™ï¼›å› ç‚ºå¤šåŠçš„éŒ¯èª¤ä¸æœƒæ˜¯ UI æ¨£å¼ï¼Œè€Œæ˜¯æµç¨‹æˆ–æ˜¯é‚è¼¯å•é¡Œï¼Œå°è‡´ä½¿ç”¨è€…ä¸­æ–·æ“ä½œï¼Œ <strong>å¦‚æœå‡ºç¾åœ¨çµå¸³æµç¨‹ï¼Œç‰½æ¶‰åˆ°ç‡Ÿæ”¶ï¼Œå•é¡Œå±¤ç´šå°±å¾ˆåš´é‡</strong> ã€‚</p><h3 id="end-to-end-testing"><span class="me-2">End-to-End Testing</span><a href="#end-to-end-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å¦‚å‰è¿°ï¼Œç„¡æ³•åœ¨ç¾è¡Œå°ˆæ¡ˆç°¡æ˜“çš„è£œä¸Šå–®å…ƒæ¸¬è©¦ä¹Ÿç„¡æ³•èšæ”å–®å…ƒåšæ•´åˆæ¸¬è©¦ï¼Œå°æ–¼é‚è¼¯ã€æµç¨‹çš„é˜²è­·ï¼Œé‚„å‰©ä¸‹å¾å¤–éƒ¨åš End-to-End é»‘ç®±æ¸¬è©¦çš„æ–¹æ³•ï¼Œç›´æ¥ä»¥ä½¿ç”¨è€…è§’åº¦å‡ºç™¼ï¼Œæ“ä½œæµç¨‹æª¢æŸ¥é‡è¦çš„æµç¨‹(è¨»å†Š/çµå¸³â€¦)æ˜¯å¦æ­£å¸¸ã€‚</p><blockquote><p>å°é‡å¤§åŠŸèƒ½çš„é‡æ§‹ä¹Ÿèƒ½å…ˆå»ºç«‹é‡æ§‹å‰çš„æµç¨‹æ¸¬è©¦ï¼Œé‡æ§‹å¾Œé‡æ–°é©—è­‰ï¼Œç¢ºä¿é‡æ§‹å¾ŒåŠŸèƒ½å¦‚é æœŸã€‚</p></blockquote><blockquote><p>é‡æ§‹ä¸­ä¸€ä½µè£œä¸Š Unit Testingã€Integration Testing å¢åŠ ç©©å®šæ€§ï¼Œæ‰“ç ´é›ç”Ÿè›‹è›‹ç”Ÿé›çš„å•é¡Œã€‚</p></blockquote><h4 id="qa-team"><span class="me-2">QA Team</span><a href="#qa-team" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>End-to-End Testing æœ€ç›´æ¥æš´åŠ›çš„æ–¹å¼å°±æ˜¯è«‹ä¸€çµ„ QA Team ä¾ç…§ Test Plan é€²è¡Œæ‰‹å‹•æ¸¬è©¦ï¼Œç„¶å¾Œå†æŒçºŒå„ªåŒ–æˆ–å¼•å…¥è‡ªå‹•åŒ–æ“ä½œï¼›è¨ˆç®—äº†ä¸€ä¸‹æˆæœ¬è‡³å°‘éœ€è¦ 2 ä½å·¥ç¨‹å¸« + 1 ä½ Leader èŠ±è²»è‡³å°‘åŠå¹´ä¸€å¹´æ™‚é–“æ‰èƒ½çœ‹åˆ°æˆæœã€‚</p><p>è©•ä¼°æ™‚é–“èˆ‡æˆæœ¬ï¼Œæœ‰æ²’æœ‰ä»€éº¼æ˜¯ç¾æ³æˆ‘å€‘èƒ½åšçš„æˆ–æ˜¯èƒ½ç‚ºæœªä¾† QA Team åšå¥½æº–å‚™ï¼Œç•¶æœ‰ QA Team æ™‚èƒ½ç›´æ¥è·³åˆ°å„ªåŒ–èˆ‡è‡ªå‹•åŒ–æ“ä½œç”šè‡³å°å…¥ AI(?)ã€‚</p><h4 id="automation"><span class="me-2">Automation</span><a href="#automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç¾éšæ®µä»¥å°å…¥è‡ªå‹•åŒ– End-to-End Testing ç‚ºç›®æ¨™ï¼Œæ”¾åœ¨ CI/CD ç’°ç¯€è‡ªå‹•æª¢æŸ¥ï¼Œæ¸¬è©¦å…§å®¹å¯ä»¥ä¸ç”¨å¤ªå®Œæ•´ã€åªè¦èƒ½é˜²æ­¢é‡å¤§æµç¨‹å•é¡Œå°±å·²ç¶“å¾ˆæœ‰åƒ¹å€¼äº†ï¼›å¾Œé¢å†æ…¢æ…¢è¿­ä»£ Test Plan é€æ­¥è£œé½Šå®ˆå‚™ç¯„åœã€‚</p><h3 id="end-to-end-testing-æŠ€è¡“é›£é»"><span class="me-2">End-to-End Testing â€”æŠ€è¡“é›£é»</span><a href="#end-to-end-testing-æŠ€è¡“é›£é»" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="ui-æ“ä½œå•é¡Œ"><span class="me-2">UI æ“ä½œå•é¡Œ</span><a href="#ui-æ“ä½œå•é¡Œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>App çš„åŸç†æ¯”è¼ƒåƒæ˜¯é€éå¦ä¸€å€‹æ¸¬è©¦ App å»æ“ä½œæˆ‘å€‘çš„è¢«æ¸¬è©¦ Appï¼Œç„¶å¾Œå¾ View Hierarchy å»æ‰¾å°‹ç›®æ¨™ç‰©ä»¶ï¼›ä¸¦ä¸”åœ¨æ¸¬è©¦æ™‚ç„¡æ³•å–å¾—è¢«æ¸¬è©¦ App çš„ Log æˆ– Outputï¼Œå› ç‚ºæœ¬è³ªä¸Šå°±æ˜¯å…©å€‹ä¸åŒ Appã€‚</p><p>iOS éœ€è¦å®Œå–„ View Accessibility Identifier å¢åŠ æ•ˆç‡èˆ‡æº–ç¢ºæ€§é‚„æœ‰è¦è™•ç† Alert (e.g. æ¨æ’­è«‹æ±‚)ã€‚</p><p>Android åœ¨ä¹‹å‰çš„å¯¦ä½œä¸Šæœ‰é‡åˆ°æ··ç”¨ Compose èˆ‡ Fragment æ™‚æœƒæ‰¾ä¸åˆ°ç›®æ¨™ç‰©ä»¶çš„å•é¡Œï¼Œä½†æ“š Teammate è¡¨ç¤ºï¼Œæ–°ç‰ˆçš„ Compose å·²ç¶“è§£æ±ºã€‚</p><p>é™¤ä»¥ä¸Šå‚³çµ±å¸¸è¦‹å•é¡Œå¤–ï¼Œæ›´å¤§çš„å•é¡Œæ˜¯é›™å¹³å°é›£ä»¥æ•´åˆ(å¯«ä¸€å€‹æ¸¬è©¦è·‘å…©å€‹å¹³å°)ï¼›ç›®å‰æˆ‘å€‘åœ¨å˜—è©¦ä½¿ç”¨æ–°çš„æ¸¬è©¦å·¥å…· <a href="https://github.com/mobile-dev-inc" target="_blank">mobile-dev-inc</a> / <a href="https://github.com/mobile-dev-inc/maestro" target="_blank">maestro</a> ï¼š</p><p><a href="https://github.com/mobile-dev-inc/maestro" target="_blank" class="img-link shimmer" ><img src="https://opengraph.githubassets.com/d9e6bc8b1cb6b3db5f52dd9bfa04fe2661ed172d7be82155b8f3e4b6c874f821/mobile-dev-inc/maestro" alt="" loading="lazy"></a></p><p>å¯ä»¥ç”¨ YAML å¯« Test Plan ç„¶å¾Œåœ¨é›™å¹³å°åŸ·è¡Œæ¸¬è©¦ï¼Œç´°ç¯€ä½¿ç”¨æ–¹å¼ã€è©¦ç”¨å¿ƒå¾—ï¼Œéœå¾…å¦ä¸€ä½ Teammate çš„æ–‡ç« åˆ†äº« ccâ€™ed <a href="https://medium.com/u/1139df7a27f3" target="_blank">Alejandra Ts.</a> ğŸ˜ã€‚</p><h4 id="api-è³‡æ–™å•é¡Œ"><span class="me-2">API è³‡æ–™å•é¡Œ</span><a href="#api-è³‡æ–™å•é¡Œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å°æ–¼ App E2E Testing æœ€å¤§çš„æ¸¬è©¦è®Šé‡å°±æ˜¯ API è³‡æ–™ï¼Œå¦‚æœç„¡æ³•æä¾›ä¿è­‰ç¢ºå®šçš„è³‡æ–™ï¼Œæœƒå¢åŠ æ¸¬è©¦çš„ä¸ç©©å®šæ€§ï¼Œå°è‡´èª¤å ±ï¼Œæœ€å¾Œå¤§å®¶å° Test Plan ä¹Ÿä¸å†æœ‰ä¿¡å¿ƒäº†ã€‚</p><p>ä¾‹å¦‚æ¸¬è©¦çµå¸³æµç¨‹ï¼Œå¦‚æœå•†å“æœ‰å¯èƒ½è¢«ä¸‹æ¶æˆ–æ¶ˆå¤±ï¼Œä¸”é€™äº›ç‹€æ…‹æ”¹è®Šä¸æ˜¯ App å¯æ§çš„å°±å¾ˆæœ‰å¯èƒ½å‡ºç¾ä»¥ä¸Šç‹€æ³ã€‚</p><p>è§£æ±ºè³‡æ–™å•é¡Œçš„æ–¹å¼æœ‰å¾ˆå¤šç¨®ï¼Œå¯ä»¥å»ºç«‹ä¹¾æ·¨çš„ Staging æˆ– Testing ç’°å¢ƒï¼›æˆ–æ˜¯åŸºæ–¼ Open API çš„ Auto-Gen Mock API Serverï¼›ä½†éƒ½éœ€è¦ä¾è³´å¾Œç«¯ã€ä¾è³´ API çš„å¤–éƒ¨å› ç´ ï¼ŒåŠ ä¸Šå¾Œç«¯ API åŒ App ä¸€æ¨£æ˜¯åœ¨ç·šä¸Šé‹ä½œå¤šå¹´çš„å°ˆæ¡ˆï¼Œéƒ¨ä»½è¦æ ¼ä¹Ÿé‚„åœ¨é‡æ§‹ Migrate æš«æ™‚ç„¡æ³•æœ‰ Mock Serverã€‚</p><p>åŸºæ–¼ä»¥ä¸Šå› ç´ ï¼Œå¦‚æœå°±å¡åœ¨é€™ï¼Œé‚£å•é¡Œä¸€æ¨£ä¸æœƒæ”¹è®Šã€é›ç”Ÿè›‹è›‹ç”Ÿé›å•é¡Œä¹Ÿç„¡æ³•çªç ´ï¼ŒçœŸçš„å°±åªèƒ½ã€ŒæŒºè€Œèµ°éšªã€çš„ç›´æ¥å…ˆæ”¹ã€å‡ºå•é¡Œå†èªªäº†ã€‚</p><h4 id="snapshot-api-local-mock-server"><span class="me-2">Snapshot API Local Mock Server</span><a href="#snapshot-api-local-mock-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>ã€Œåªè¦æ€æƒ³ä¸æ»‘å¡ï¼Œæ–¹æ³•ç¸½æ¯”å›°é›£å¤šã€</p></blockquote><p>æˆ‘å€‘å¯ä»¥æ›ä¸€å€‹æƒ³æ³•ï¼Œå¦‚æœ UI å¯ä»¥ç”¨ Snapshot å¿«ç…§æˆåœ–ç‰‡ä¸‹ä¾† Replay é€²è¡Œé©—è­‰æ¸¬è©¦ï¼Œé‚£ API æ˜¯å¦ä¹Ÿå¯ä»¥ï¼Ÿ æˆ‘å€‘æ˜¯å¦å¯ä»¥æŠŠ API Request &amp; Response å­˜ä¸‹ä¾†ï¼Œåœ¨å¾ŒçºŒ Replay é€²è¡Œé©—è­‰æ¸¬è©¦ï¼Ÿ</p><p><strong>è—‰æ­¤å¼•å…¥æœ¬ç¯‡æ–‡ç« çš„é‡é»ï¼šå»ºç«‹ã€ŒSnapshot API Local Mock Serverã€Record API Request &amp; Replay Response å‰é›¢èˆ‡ API è³‡æ–™çš„ä¾è³´ã€‚</strong></p><blockquote><p>æœ¬æ–‡åªåšäº† POC æ¦‚å¿µé©—è­‰ï¼Œé‚„æ²’æœ‰çœŸæ­£å…¨é¢å¯¦ç¾é«˜è¦†è“‹ç‡çš„ End To End Testingï¼Œå› æ­¤åšæ³•åƒ…ä¾›åƒè€ƒï¼Œ <strong>å¸Œæœ›å°å¤§å®¶åœ¨ç¾æœ‰ç’°å¢ƒä¸‹æœ‰æ–°çš„å•Ÿç™¼</strong> ã€‚</p></blockquote><h3 id="snapshot-api-local-mock-server-1"><span class="me-2">Snapshot API Local Mock Server</span><a href="#snapshot-api-local-mock-server-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="æ ¸å¿ƒæ¦‚å¿µ--record--replay-api-data"><span class="me-2">æ ¸å¿ƒæ¦‚å¿µ â€” Record &amp; Replay API Data</span><a href="#æ ¸å¿ƒæ¦‚å¿µ--record--replay-api-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>[Record]</strong> â€” End-to-End Testing Test Case é–‹ç™¼å®Œæˆå¾Œï¼Œæ‰“é–‹éŒ„è£½åƒæ•¸ï¼ŒåŸ·è¡Œä¸€æ¬¡æ¸¬è©¦ï¼Œéç¨‹ä¸­æ‰€æœ‰ API Request &amp; Response æœƒå­˜ä¸‹ä¾†æ”¾åœ¨å„å€‹ Test Case ç›®éŒ„å…§ã€‚</p><p><strong>[Replay]</strong> â€” å¾Œé¢åœ¨è·‘ Test Case æ™‚ï¼Œä¾ç…§è«‹æ±‚å¾ Test Case ç›®éŒ„ä¸­æ‰¾åˆ°å°æ‡‰éŒ„è£½ä¸‹ä¾†çš„ Response Dataï¼Œå®Œæˆæ¸¬è©¦æµç¨‹ã€‚</p><h4 id="ç¤ºæ„åœ–"><span class="me-2">ç¤ºæ„åœ–</span><a href="#ç¤ºæ„åœ–" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å‡è¨­æˆ‘å€‘è¦æ¸¬è©¦åŠ å…¥è³¼è²·æµç¨‹ï¼Œä½¿ç”¨è€…æ‰“é–‹ App å¾Œåœ¨é¦–é é»æ“Šå•†å“å¡é€²å…¥å•†å“è©³ç´°é ï¼ŒæŒ‰åº•éƒ¨è³¼è²·ï¼Œè·³å‡ºç™»å…¥åŒ¡å®Œæˆç™»å…¥ï¼Œå®Œæˆè³¼è²·ï¼Œè·³å‡ºè³¼è²·æˆåŠŸæç¤ºï¼š</p><p><a href="/assets/5a5c4b25a83d/1*VtCOkH7iply6RQPs9zxJrw.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*VtCOkH7iply6RQPs9zxJrw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjExMjAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p>UI Testing å¦‚ä½•æ§åˆ¶æŒ‰éˆ•é»æ“Šã€è¼¸å…¥åŒ¡è¼¸å…¥â€¦ç­‰ç­‰ï¼Œä¸æ˜¯æœ¬æ–‡ä¸»è¦ç ”ç©¶é‡é»ï¼›å¯åƒè€ƒç¾æœ‰çš„æ¸¬è©¦æ¡†æ¶ç›´æ¥ä½¿ç”¨ã€‚</p><h4 id="regular-proxy-or-reverse-proxy"><span class="me-2">Regular Proxy or Reverse Proxy</span><a href="#regular-proxy-or-reverse-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>è¦é”æˆ Record &amp; Replay API éœ€è¦åœ¨ App èˆ‡ API ä¹‹é–“åŠ ä¸Š Proxy åšä¸­é–“äººæ”»æ“Šï¼Œå¯åƒè€ƒæˆ‘æ—©æœŸçš„æ–‡ç« ã€Œ <a href="/posts/zrealm-dev/appæœ‰ç”¨httpså‚³è¼¸-ä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†-46410aaada00/">APPæœ‰ç”¨HTTPSå‚³è¼¸ï¼Œä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†ã€‚</a> ã€</p><p>ç°¡å–®ä¾†èªªå°±æ˜¯åœ¨ App èˆ‡ API ä¹‹é–“å¤šäº†ä¸€å€‹ä»£ç†çš„å‚³éè€…ï¼Œå¦‚åŒå‚³ç´™æ¢ä¸€æ¨£ï¼Œé›™æ–¹å‚³éçš„è«‹æ±‚èˆ‡å›æ‡‰éƒ½æœƒç¶“éä»–ï¼Œä»–å¯ä»¥æ‰“é–‹ä¾†ç´™æ¢çš„å…§å®¹ï¼Œä¹Ÿå¯ä»¥å½é€ ç´™æ¢å…§å®¹çµ¦å½¼æ­¤ï¼Œé›™æ–¹ä¸æœƒå¯Ÿè¦ºä½ å¾ä¸­åšæ¢—ã€‚</p><p><strong>æ­£å‘ä»£ç† Regular Proxyï¼š</strong></p><p>æ­£å‘ä»£ç†æ˜¯å®¢æˆ¶ç«¯å‘ä»£ç†ä¼ºæœå™¨ç™¼é€è«‹æ±‚ï¼Œä»£ç†ä¼ºæœå™¨å†å°‡è«‹æ±‚è½‰ç™¼çµ¦ç›®æ¨™ä¼ºæœå™¨ï¼Œä¸¦å°‡ç›®æ¨™ä¼ºæœå™¨çš„å›æ‡‰è¿”å›çµ¦å®¢æˆ¶ç«¯ã€‚åœ¨æ­£å‘ä»£ç†æ¨¡å¼ä¸‹ï¼Œä»£ç†ä¼ºæœå™¨ä»£è¡¨å®¢æˆ¶ç«¯ç™¼èµ·è«‹æ±‚ã€‚å®¢æˆ¶ç«¯éœ€è¦æ˜ç¢ºæŒ‡å®šä»£ç†ä¼ºæœå™¨çš„ä½å€å’ŒåŸ è™Ÿï¼Œä¸¦å°‡è«‹æ±‚ç™¼é€çµ¦ä»£ç†ä¼ºæœå™¨ã€‚</p><p><strong>åå‘ä»£ç† Reverse Proxyï¼š</strong></p><p>åå‘ä»£ç†èˆ‡æ­£å‘ä»£ç†ç›¸åï¼Œå®ƒä½æ–¼ç›®æ¨™ä¼ºæœå™¨å’Œå®¢æˆ¶ç«¯ä¹‹é–“ã€‚å®¢æˆ¶ç«¯å‘åå‘ä»£ç†ä¼ºæœå™¨ç™¼é€è«‹æ±‚ï¼Œåå‘ä»£ç†ä¼ºæœå™¨æ ¹æ“šä¸€å®šçš„è¦å‰‡å°‡è«‹æ±‚è½‰ç™¼çµ¦å¾Œç«¯çš„ç›®æ¨™ä¼ºæœå™¨ï¼Œä¸¦å°‡ç›®æ¨™ä¼ºæœå™¨çš„å›æ‡‰è¿”å›çµ¦å®¢æˆ¶ç«¯ã€‚å°æ–¼å®¢æˆ¶ç«¯ä¾†èªªï¼Œç›®æ¨™ä¼ºæœå™¨çœ‹èµ·ä¾†å°±åƒæ˜¯åå‘ä»£ç†ä¼ºæœå™¨ï¼Œå®¢æˆ¶ç«¯ä¸éœ€è¦çŸ¥é“ç›®æ¨™ä¼ºæœå™¨çš„çœŸå¯¦ä½å€ã€‚</p><p>å°æˆ‘å€‘çš„éœ€æ±‚ä¾†èªªæ­£å‘æˆ–åå‘éƒ½å¯ä»¥é”æˆç›®çš„ï¼Œå”¯ä¸€è¦è€ƒæ…®çš„äº‹æ˜¯ä»£ç†è¨­ç½®çš„æ–¹å¼ï¼š</p><p><strong>æ­£å‘ä»£ç†éœ€è¦åœ¨é›»è…¦ä¸Šæˆ–æ‰‹æ©Ÿã€æ¨¡æ“¬èµ·çš„ç¶²è·¯è¨­ç½®ä¸­æ›ä¸Š Proxy ä»£ç†ï¼š</strong></p><ul><li>Android èƒ½åœ¨æ¨¡æ“¬å™¨ä¸­å€‹åˆ¥ç›´æ¥è¨­ç½® Proxy ä»£ç†<li>iOS Simulator åŒé›»è…¦çš„ç¶²è·¯ç’°å¢ƒï¼Œç„¡æ³•å€‹è¨­ç½® Proxyï¼Œè®Šæˆè¦å»æ”¹é›»è…¦çš„è¨­ç½®æ‰èƒ½æ›ä¸Š Proxyï¼Œé›»è…¦çš„æ‰€æœ‰æµé‡ä¹Ÿéƒ½æœƒç¶“éé€™å€‹ Proxy ä¸¦ä¸”å¦‚æœåŒæ™‚é–‹å•Ÿ Proxyman æˆ– Charles ç­‰ç­‰å…¶ä»–ç¶²è·¯å·¥å…·ï¼Œæœ‰æ©Ÿæœƒæœƒå¼·åˆ¶æ›´æ”¹ Proxy è¨­ç½®æˆè©²è»Ÿé«”çš„ï¼Œå°è‡´å¤±æ•ˆã€‚</ul><p><strong>åå‘ä»£ç†éœ€è¦æ”¹ Codebase ä¸­çš„ API Host ä¸¦ä¸”è¦å®£å‘Šè¦ä»£ç†çš„æ‰€æœ‰ API Domainsï¼š</strong></p><ul><li>Codebase ä¸­çš„ API Host è¦åœ¨æ¸¬è©¦æ™‚æ›¿æ›æˆ Proxy Server IP<li>åœ¨å•Ÿç”¨ Reverse Proxy æ™‚è¦å®£å‘Šå“ªäº› Domain è¦æ›ä¸Š Proxy<li>åªæœ‰å®£å‘Šçš„ Domain æ‰æœƒèµ° Proxyï¼Œæ²’å®£å‘Šçš„æœƒç›´é€šå‡ºå»</ul><blockquote><p>é…åˆ iOS Appï¼Œä»¥ä¸‹ä»¥ iOS &amp; ä½¿ç”¨ Reverse Proxy åå‘ä»£ç†ç‚ºä¾‹åš POCï¼ŒAndroid ä¸€æ¨£å¯ä»¥ä½¿ç”¨ã€‚</p></blockquote><h4 id="è®“-ios-app-çŸ¥é“ç¾åœ¨æ­£åœ¨è·‘-end-to-end-testing"><span class="me-2">è®“ iOS App çŸ¥é“ç¾åœ¨æ­£åœ¨è·‘ End-to-End Testing</span><a href="#è®“-ios-app-çŸ¥é“ç¾åœ¨æ­£åœ¨è·‘-end-to-end-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æˆ‘å€‘éœ€è¦è®“ App çŸ¥é“ç¾åœ¨æ­£åœ¨è·‘ End-to-End Testing æ‰èƒ½åœ¨ App ç¨‹å¼è£¡åŠ ä¸Š API Host æ›¿æ›é‚è¼¯ï¼š</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>// UI Testing Target:
let app = XCUIApplication()
app.launchArguments = ["duringE2ETesting"]
app.launch()
</pre></table></code></div></div><p>æˆ‘å€‘åœ¨ Network å±¤åšåˆ¤æ–·æŠ½æ›ã€‚</p><blockquote><p>é€™æ˜¯ä¸å¾—å·²çš„èª¿æ•´ï¼Œç›¡é‡é‚„æ˜¯ä¸è¦ç‚ºäº†æ¸¬è©¦è€Œå»æ”¹ App çš„ Codeã€‚</p></blockquote><h3 id="ä½¿ç”¨-mitmproxy-å¯¦ç¾-reverse-proxy-server"><span class="me-2">ä½¿ç”¨ MITMProxy å¯¦ç¾ Reverse Proxy Server</span><a href="#ä½¿ç”¨-mitmproxy-å¯¦ç¾-reverse-proxy-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>äº¦å¯ä½¿ç”¨ Swift è‡ªè¡Œé–‹ç™¼ Swift Server é”æˆï¼Œæœ¬æ–‡åªæ˜¯ POC å› æ­¤ç›´æ¥ä½¿ç”¨ MITMProxy å·¥å…·ã€‚</p></blockquote><h4 id="20230904-update-mitmproxy-rodo-å·²é–‹æº"><span class="me-2">[2023â€“09â€“04 Update] Mitmproxy-rodo å·²é–‹æº</span><a href="#20230904-update-mitmproxy-rodo-å·²é–‹æº" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä»¥ä¸‹å¯¦ä½œå…§å®¹å·²ç¶“é–‹æºåˆ° <a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank">mitmproxy-rodo</a> å°ˆæ¡ˆï¼Œæ­¡è¿ç›´æ¥å‰å¾€å°ç…§ä½¿ç”¨ã€‚</p><p><a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4" alt="" loading="lazy"></a></p><p>éƒ¨ä»½çµæ§‹èˆ‡æœ¬æ–‡ç« å…§å®¹æœ‰æ‰€èª¿æ•´ï¼Œé–‹æºæ™‚å¾ŒçºŒèª¿æ•´äº†ï¼š</p><ul><li>å„²å­˜ç›®éŒ„çš„çµæ§‹ï¼Œæ”¹ç‚º <code class="language-plaintext highlighter-rouge">host / requestPath / method / hash</code><li>ä¿®æ­£ Header è³‡è¨Šå„²å­˜ï¼Œæ‡‰è©²ç‚º Bytes Data è€Œéç´” JSON String<li>ä¿®æ­£éƒ¨ä»½éŒ¯èª¤<li>å¢åŠ è‡ªå‹•å»¶é•· Set-Cookie æ™‚æ•ˆåŠŸèƒ½</ul><blockquote><p><strong>âš ï¸ ä»¥ä¸‹è…³æœ¬åƒ…å…± Demo åƒè€ƒï¼Œå¾ŒçºŒè…³æœ¬èª¿æ•´å°‡ç§»è‡³é–‹æºå°ˆæ¡ˆç¶­è­·ã€‚</strong></p></blockquote><blockquote><p><strong>âš ï¸ ä»¥ä¸‹è…³æœ¬åƒ…å…± Demo åƒè€ƒï¼Œå¾ŒçºŒè…³æœ¬èª¿æ•´å°‡ç§»è‡³é–‹æºå°ˆæ¡ˆç¶­è­·ã€‚</strong></p></blockquote><blockquote><p><strong>âš ï¸ ä»¥ä¸‹è…³æœ¬åƒ…å…± Demo åƒè€ƒï¼Œå¾ŒçºŒè…³æœ¬èª¿æ•´å°‡ç§»è‡³é–‹æºå°ˆæ¡ˆç¶­è­·ã€‚</strong></p></blockquote><blockquote><p><strong>âš ï¸ ä»¥ä¸‹è…³æœ¬åƒ…å…± Demo åƒè€ƒï¼Œå¾ŒçºŒè…³æœ¬èª¿æ•´å°‡ç§»è‡³é–‹æºå°ˆæ¡ˆç¶­è­·ã€‚</strong></p></blockquote><blockquote><p><strong>âš ï¸ ä»¥ä¸‹è…³æœ¬åƒ…å…± Demo åƒè€ƒï¼Œå¾ŒçºŒè…³æœ¬èª¿æ•´å°‡ç§»è‡³é–‹æºå°ˆæ¡ˆç¶­è­·ã€‚</strong></p></blockquote><h4 id="mitmproxy"><span class="me-2"><a href="https://mitmproxy.org" target="_blank">MITMProxy</a></span><a href="#mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç…§è‘— <a href="https://mitmproxy.org" target="_blank">MITMProxy å®˜ç¶²</a> å®Œæˆå®‰è£ï¼š</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>mitmproxy
</pre></table></code></div></div><p>MITMProxy ç´°ç¯€ç”¨æ³•å¯åƒè€ƒæˆ‘æ—©æœŸçš„æ–‡ç« ã€Œ <a href="/posts/zrealm-dev/appæœ‰ç”¨httpså‚³è¼¸-ä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†-46410aaada00/">APPæœ‰ç”¨HTTPSå‚³è¼¸ï¼Œä½†è³‡æ–™é‚„æ˜¯è¢«å·äº†ã€‚</a> ã€</p><ul><li><code class="language-plaintext highlighter-rouge">mitmproxy</code> æä¾›ä¸€å€‹äº’å‹•å¼çš„å‘½ä»¤è¡Œç•Œé¢ã€‚<li><code class="language-plaintext highlighter-rouge">mitmweb</code> æä¾›åŸºæ–¼ç€è¦½å™¨çš„åœ–å½¢ç”¨æˆ¶ç•Œé¢ã€‚<li><code class="language-plaintext highlighter-rouge">mitmdump</code> æä¾›éäº’å‹•çš„çµ‚ç«¯è¼¸å‡ºã€‚</ul><h4 id="å¯¦ç¾-record--replay"><span class="me-2">å¯¦ç¾ Record &amp; Replay</span><a href="#å¯¦ç¾-record--replay" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å›  MITMProxy Reverse Proxy åŸç”Ÿæ²’æœ‰ Record (or dump) request &amp; Mapping Request Replay çš„åŠŸèƒ½ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦è‡ªè¡Œæ’°å¯«è…³æœ¬å¯¦ç¾æ­¤åŠŸèƒ½ã€‚</p><p><code class="language-plaintext highlighter-rouge">mock.py</code> :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
</pre><td class="rouge-code"><pre><span class="sh">"""</span><span class="s">
Example:
    Record: mitmdump -m reverse:https://yourapihost.com -s mock.py --set record=true --set dumper_folder=loginFlow --set config_file=config.json
    Replay: mitmdump -m reverse:https://yourapihost.com -s mock.py --set dumper_folder=loginFlow --set config_file=config.json
</span><span class="sh">"""</span>

<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">mimetypes</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">hashlib</span>

<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">mitmproxy</span> <span class="kn">import</span> <span class="n">ctx</span>
<span class="kn">from</span> <span class="n">mitmproxy</span> <span class="kn">import</span> <span class="n">http</span>

<span class="k">class</span> <span class="nc">MockServerHandler</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">loader</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">dumper_folder</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">dump</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Response Dump ç›®éŒ„ï¼Œå¯ä»¥ by Test Case Name å»ºç«‹</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">network_restricted</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">æœ¬åœ°æ²’æœ‰ Mapping è³‡æ–™...è¨­ç½® true æœƒ return 404ã€false æœƒå»æ‰“çœŸå¯¦è«‹æ±‚æ‹¿è³‡æ–™ã€‚</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">record</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">è¨­ç½® true éŒ„è£½ Request</span><span class="sh">'</span><span class="s">s Response</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">loader</span><span class="p">.</span><span class="nf">add_option</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">config_file</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">typespec</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">è¨­ç½®æª”æ¡ˆè·¯å¾‘ï¼Œç¯„ä¾‹æª”æ¡ˆåœ¨ä¸‹é¢</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">updated</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">loadConfig</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">loadConfig</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">configFile</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">config_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">config_file</span> <span class="o">==</span> <span class="sh">""</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">configFile</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">self</span><span class="p">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="n">configFile</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">query</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">ignoredQueryParameterByPaths</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">queryParamters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">ignoredQueryParameterGlobal</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">queryParamters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">filteredQuery</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">filteredQuery</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoredQueryParameterByPaths</span> <span class="o">+</span> <span class="n">ignoredQueryParameterGlobal</span><span class="p">]</span>
        
        <span class="n">formData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="sh">''</span><span class="p">:</span>
            <span class="n">formData</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">get_content</span><span class="p">())</span>
        
        <span class="c1"># or just formData = request.urlencoded_form
</span>        <span class="c1"># or just formData = request.multipart_form
</span>        <span class="c1"># depends on your api design
</span>
        <span class="n">ignoredFormDataParametersByPaths</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">formDataParameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">ignoredFormDataParametersGlobal</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">formDataParameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">filteredFormData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">formData</span><span class="p">:</span>
            <span class="n">filteredFormData</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">formData</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoredFormDataParametersByPaths</span> <span class="o">+</span> <span class="n">ignoredFormDataParametersGlobal</span><span class="p">]</span>
        
        <span class="c1"># Serialize the dictionary to a JSON string
</span>        <span class="n">hashData</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span><span class="nf">sorted</span><span class="p">(</span><span class="n">filteredQuery</span><span class="p">),</span> <span class="sh">"</span><span class="s">form</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">filteredFormData</span><span class="p">)}</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">hashData</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># Apply SHA-256 hash function
</span>        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha256</span><span class="p">(</span><span class="n">json_str</span><span class="p">.</span><span class="nf">encode</span><span class="p">())</span>
        <span class="n">hash_string</span> <span class="o">=</span> <span class="n">hash_object</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">hash_string</span>

    <span class="k">def</span> <span class="nf">readFromFile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">host</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">folder</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">dumper_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">host</span> <span class="o">/</span> <span class="n">method</span> <span class="o">/</span> <span class="n">requestPath</span> <span class="o">/</span> <span class="nb">hash</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="nf">guess_extension</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">.json</span><span class="sh">"</span>


        <span class="n">count</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>

        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">host</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">method</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">][</span><span class="n">requestPath</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">headerFilePath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Header-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">headerFilePath</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
                <span class="n">headerFilePath</span> <span class="o">=</span> <span class="bp">None</span>
            
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">self</span><span class="p">.</span><span class="n">readHistory</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="n">method</span><span class="p">][</span><span class="n">requestPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">header</span><span class="sh">"</span><span class="p">:</span> <span class="n">headerFilePath</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">host</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">requestPath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path_components</span><span class="p">)</span>

        <span class="n">iterable</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ignored</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">paths</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">requestPath</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">iterable</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="n">folder</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">dumper_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">host</span> <span class="o">/</span> <span class="n">method</span> <span class="o">/</span> <span class="n">requestPath</span> <span class="o">/</span> <span class="nb">hash</span>

        <span class="c1"># create dir if not exists
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="nf">guess_extension</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">.json</span><span class="sh">"</span>

        <span class="n">repeatNumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">while</span> <span class="n">filepath</span><span class="p">.</span><span class="nf">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">iterable</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">repeatNumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Content-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="c1"># dump to file
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span> <span class="ow">or</span> <span class="sa">b</span><span class="sh">''</span><span class="p">)</span>
            
        
        <span class="n">headerFilepath</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Header-</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">repeatNumber</span><span class="p">)</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">headerFilepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">responseDict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
            <span class="n">responseDict</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">responseDict</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">filepath</span><span class="p">,</span> <span class="sh">"</span><span class="s">header</span><span class="sh">"</span><span class="p">:</span> <span class="n">headerFilepath</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">record</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">host</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">path</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">readFromFile</span><span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">statusCode</span> <span class="o">=</span> <span class="mi">200</span>

                <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">header</span><span class="sh">'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">header</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">())</span>
                    <span class="n">statusCode</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_status_code</span><span class="sh">'</span><span class="p">]</span>

                
                <span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">statusCode</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Fullfill response from local with </span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">]))</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">network_restricted</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="sa">b</span><span class="sh">''</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">record</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">_responseFromMitmproxy</span><span class="sh">'</span><span class="p">)</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">saveToFile</span><span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">request</span><span class="p">,</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">)</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Save response to local with </span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">]))</span>

<span class="n">addons</span> <span class="o">=</span> <span class="p">[</span><span class="nc">MockServerHandler</span><span class="p">()]</span>
</pre></table></code></div></div><p>å¯ä»¥è‡ªè¡Œåƒè€ƒ <a href="https://docs.mitmproxy.org/stable/api/events.html" target="_blank">å®˜æ–¹æ–‡ä»¶</a> ï¼Œä¾ç…§éœ€æ±‚èª¿æ•´è…³æœ¬å…§å®¹ã€‚</p><p><strong>æ­¤è…³æœ¬è¨­è¨ˆé‚è¼¯å¦‚ä¸‹ï¼š</strong></p><ul><li>æª”æ¡ˆè·¯å¾‘é‚è¼¯ï¼š <code class="language-plaintext highlighter-rouge">dumper_folder(a.k.a Test Case Name)</code> / <code class="language-plaintext highlighter-rouge">Reverse's api host</code> / <code class="language-plaintext highlighter-rouge">HTTP Method</code> / <code class="language-plaintext highlighter-rouge">Path join with -</code> (e.g. <code class="language-plaintext highlighter-rouge">app/launch</code> -&gt; <code class="language-plaintext highlighter-rouge">app-launch</code> ) / <code class="language-plaintext highlighter-rouge">Hash(Get Query &amp; Post Content)</code> /<li>æª”æ¡ˆé‚è¼¯ï¼šå›æ‡‰çš„å…§å®¹ï¼š <code class="language-plaintext highlighter-rouge">Content-0.xxx</code> ã€ <code class="language-plaintext highlighter-rouge">Content-1.xxx</code> (åŒå€‹è«‹æ±‚æ‰“ç¬¬äºŒæ¬¡)â€¦ä»¥æ­¤é¡æ¨ï¼›å›æ‡‰çš„ Header è³‡è¨Šï¼š <code class="language-plaintext highlighter-rouge">Header-0.json</code> (åŒ <code class="language-plaintext highlighter-rouge">Content-x</code> é‚è¼¯)</ul><p><a href="/assets/5a5c4b25a83d/1*Lud_shSJYv4LSUfpfALGFA.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*Lud_shSJYv4LSUfpfALGFA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMTAiIGhlaWdodD0iMjQxIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>å„²å­˜æ™‚æœƒä¾ç…§è·¯å¾‘ã€æª”æ¡ˆé‚è¼¯ä¾åºå„²å­˜ï¼›åœ¨ Replay æ™‚åŒæ¨£ä¾åºå–å‡º<li>å¦‚æœæ¬¡æ•¸ä¸åŒ¹é…ï¼Œä¾‹å¦‚ Replay æ™‚åŒå€‹è·¯å¾‘æ‰“äº† 3 æ¬¡ï¼Œä½† Record å„²å­˜çš„è³‡æ–™åªå­˜åˆ°ç¬¬ 2 æ¬¡ï¼›å‰‡é‚„æ˜¯æœƒæŒçºŒå›æ‡‰ç¬¬ 2 æ¬¡ï¼Œä¹Ÿå°±æ˜¯æœ€å¾Œä¸€æ¬¡çš„çµæœ<li><code class="language-plaintext highlighter-rouge">record</code> ç‚º <code class="language-plaintext highlighter-rouge">True</code> æ™‚ï¼Œæœƒå»æ‰“ç›®æ¨™ Server å–å¾—å›æ‡‰ä¸¦ä¾ç…§ä¸Šè¿°é‚è¼¯å„²å­˜ä¸‹ä¾†ï¼› <code class="language-plaintext highlighter-rouge">False</code> æ™‚å‰‡åªæœƒå¾æœ¬åœ°è®€è³‡æ–™ (ç­‰æ–¼ Replay Mode)<li><code class="language-plaintext highlighter-rouge">network_restricted</code> ç‚º <code class="language-plaintext highlighter-rouge">False</code> æ™‚ï¼Œæœ¬åœ°æ²’ Mapping è³‡æ–™æœƒç›´æ¥å›æ‡‰ <code class="language-plaintext highlighter-rouge">404</code> ï¼›ç‚º <code class="language-plaintext highlighter-rouge">True</code> æ™‚æœƒå»æ‰“ç›®æ¨™ Server æ‹¿è³‡æ–™ã€‚<li><code class="language-plaintext highlighter-rouge">_responseFromMitmproxy</code> ç”¨æ–¼å‘ŠçŸ¥ Response Method ç•¶å‰å›æ‡‰ä¾†è‡ª Localï¼Œå¯ä»¥å¿½ç•¥ä¸ç®¡ã€ <code class="language-plaintext highlighter-rouge">_status_code</code> å€Ÿç”¨ Header.json æ¬„ä½å„²å­˜ HTTP Response ç‹€æ…‹ç¢¼ã€‚</ul><p><code class="language-plaintext highlighter-rouge">config_file.json</code> <strong>è¨­ç½®æª”æ¡ˆé‚è¼¯è¨­è¨ˆå¦‚ä¸‹ï¼š</strong></p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"ignored"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"yourapihost.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"add-to-cart"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"POST"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"queryParamters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"created_timestamp"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"formDataParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"api-status-checker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"GET"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"iterable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"global"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"queryParamters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"timestamp"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"formDataParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">queryParamters</code> <strong>&amp; <code class="language-plaintext highlighter-rouge">formDataParameters</code> :</strong></p><p>å› éƒ¨åˆ† API åƒæ•¸å¯èƒ½æœƒéš¨å‘¼å«æ”¹è®Šï¼Œä¾‹å¦‚æœ‰çš„ Endpoint æœƒå¸¶ä¸Šæ™‚é–“åƒæ•¸ï¼Œæ­¤æ™‚ä¾ç…§ Server çš„è¨­è¨ˆï¼Œ <code class="language-plaintext highlighter-rouge">Hash(Query Parameter &amp; Body Content)</code> çš„å€¼å°±æœƒåœ¨ Replay Request æ™‚ä¸ä¸€æ¨£ï¼Œå°è‡´ Mapping ä¸åˆ° Local Responseï¼Œå› æ­¤å¤šé–‹äº†ä¸€å€‹ <code class="language-plaintext highlighter-rouge">config.json</code> è™•ç†é€™å€‹æƒ…æ³ï¼Œå¯ä»¥ by Endpoint Path or Global è¨­å®šæŸå€‹åƒæ•¸æ‡‰è©²åœ¨æ’é™¤ Hash æ™‚æ’é™¤ï¼Œå°±èƒ½å–å¾—åŒæ¨£çš„ Mapping çµæœã€‚</p><p><code class="language-plaintext highlighter-rouge">iterable</code> <strong>:</strong></p><p>å› éƒ¨åˆ†è¼ªè©¢æª¢æŸ¥çš„ API å¯èƒ½æœƒé‡è¤‡å®šæ™‚ä¸æ–·å‘¼å«ï¼Œç…§ Server çš„è¨­è¨ˆæœƒç”¢å‡ºå¾ˆå¤š <code class="language-plaintext highlighter-rouge">Content-x.xxx</code> &amp; <code class="language-plaintext highlighter-rouge">Header-x.json</code> æª”æ¡ˆï¼›ä½†å‡è¨­æˆ‘å€‘ä¸åœ¨æ„å‰‡å¯è¨­å®šç‚º <code class="language-plaintext highlighter-rouge">True</code> ï¼ŒResponse æœƒæŒçºŒå„²å­˜è¦†è“‹åˆ° <code class="language-plaintext highlighter-rouge">Content-0.xxx</code> &amp; <code class="language-plaintext highlighter-rouge">Header-0.json</code> ç¬¬ä¸€å€‹æª”æ¡ˆå…§ã€‚</p><p><strong>å•Ÿç”¨ Reverse Proxy Record Modeï¼š</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">record</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>loginFlow <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><p><strong>å•Ÿç”¨ Reverse Proxy Replay Modeï¼š</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>loginFlow <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h3 id="çµ„è£--proof-of-concept"><span class="me-2">çµ„è£ &amp; Proof Of Concept</span><a href="#çµ„è£--proof-of-concept" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="0-å®Œæˆ-codebase-ä¸­-host-çš„æŠ½æ›"><span class="me-2">0. å®Œæˆ Codebase ä¸­ Host çš„æŠ½æ›</span><a href="#0-å®Œæˆ-codebase-ä¸­-host-çš„æŠ½æ›" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä¸¦ç¢ºèªåœ¨è·‘æ¸¬è©¦æ™‚ï¼ŒAPI å·²æ”¹ç”¨ <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080</code></p><h4 id="1-å•Ÿå‹•-snapshot-api-local-mock-server-aka-reverse-proxy-server-record-mode"><span class="me-2">1. å•Ÿå‹• Snapshot API Local Mock Server (a.k.a Reverse Proxy Server) Record Mode</span><a href="#1-å•Ÿå‹•-snapshot-api-local-mock-server-aka-reverse-proxy-server-record-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">record</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>addCart <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h4 id="2-åŸ·è¡Œ-e2e-testing-ui-æ“ä½œ"><span class="me-2">2. åŸ·è¡Œ E2E Testing UI æ“ä½œ</span><a href="#2-åŸ·è¡Œ-e2e-testing-ui-æ“ä½œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ä»¥ <a href="https://apps.apple.com/tw/app/pinkoi-%E4%BA%9E%E6%B4%B2%E9%A0%98%E5%85%88%E8%B7%A8%E5%A2%83%E8%A8%AD%E8%A8%88%E8%B3%BC%E7%89%A9%E7%B6%B2%E7%AB%99/id557252416" target="_blank">Pinkoi iOS App</a> ç‚ºä¾‹ï¼Œæ¸¬è©¦ä»¥ä¸‹æµç¨‹ï¼š</p><blockquote><p>Launch App -&gt; Home -&gt; Scroll Down -&gt; Similar to Wish List Items Section -&gt; First Product -&gt; Click First Product -&gt; Enter Product Page -&gt; Click Add to Cart -&gt; UI Response Added to Cart -&gt; Test Successful âœ…</p></blockquote><p><a href="/assets/5a5c4b25a83d/1*aLaMSaG-DFWzYy9RcwCfag.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*aLaMSaG-DFWzYy9RcwCfag.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjQ2NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>UI è‡ªå‹•åŒ–æ“ä½œæ–¹å¼å‰é¢æœ‰æåˆ°ï¼Œé€™é‚Šå…ˆæ‰‹å‹•æ¸¬è©¦ç›¸åŒçš„æµç¨‹é©—è­‰çµæœã€‚</p><h4 id="3-å–å¾—-record-çµæœ"><span class="me-2">3. å–å¾— Record çµæœ</span><a href="#3-å–å¾—-record-çµæœ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æ“ä½œå®Œæˆå¾Œå¯ä»¥ä¸‹ <code class="language-plaintext highlighter-rouge">^ + C</code> çµ‚æ­¢ Snapshot API Mock Serverï¼Œåˆ°æª”æ¡ˆç›®éŒ„æŸ¥çœ‹éŒ„è£½çµæœï¼š</p><p><a href="/assets/5a5c4b25a83d/1*YO957r5CGMOlsPrm26GbcA.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*YO957r5CGMOlsPrm26GbcA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTciIGhlaWdodD0iNTUwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><h4 id="4-replay-é©—è­‰åŒå€‹æµç¨‹å•Ÿå‹•-server--using-replay-mode"><span class="me-2">4. Replay é©—è­‰åŒå€‹æµç¨‹ï¼Œå•Ÿå‹• Server &amp; Using Replay Mode</span><a href="#4-replay-é©—è­‰åŒå€‹æµç¨‹å•Ÿå‹•-server--using-replay-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmdump <span class="nt">-m</span> reverse:https://yourapihost.com <span class="nt">-s</span> mock.py <span class="nt">--set</span> <span class="nv">dumper_folder</span><span class="o">=</span>addCart <span class="nt">--set</span> <span class="nv">config_file</span><span class="o">=</span>config.json
</pre></table></code></div></div><h4 id="5-å†æ¬¡åŸ·è¡Œå‰›å‰›çš„-ui-æ“ä½œé©—è­‰çµæœ"><span class="me-2">5. å†æ¬¡åŸ·è¡Œå‰›å‰›çš„ UI æ“ä½œé©—è­‰çµæœ</span><a href="#5-å†æ¬¡åŸ·è¡Œå‰›å‰›çš„-ui-æ“ä½œé©—è­‰çµæœ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/5a5c4b25a83d/1*70qzxOiM9uJVcvyhKdosVg.webp" class="popup img-link blur"><img data-src="/assets/5a5c4b25a83d/1*70qzxOiM9uJVcvyhKdosVg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NDQiIGhlaWdodD0iODkyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li>å·¦ï¼šTest Successful âœ…<li>å³ï¼šæ¸¬è©¦é»æ“ŠéŒ„è£½ä»¥å¤–çš„å•†å“ï¼Œæ­¤æ™‚æœƒå‡ºç¾ Error (å› æœ¬åœ°æ²’è³‡æ–™ + <code class="language-plaintext highlighter-rouge">network_restricted</code> é è¨­æ˜¯ <code class="language-plaintext highlighter-rouge">False</code> æœ¬åœ°æ²’è³‡æ–™ç›´æ¥å‚³ 404ï¼Œä¸æœƒå¾ç¶²è·¯æ‹¿è³‡æ–™)</ul><h4 id="6-proof-of-concept-"><span class="me-2">6. Proof Of Concept âœ…</span><a href="#6-proof-of-concept-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æ¦‚å¿µé©—è­‰é€šéï¼Œæˆ‘å€‘ç¢ºå¯¦èƒ½é€éå¯¦ç¾ Reverse Proxy Server ä¾†è‡ªè¡Œå„²å­˜ API Request &amp; Response ä¸¦ä½œç‚º Mock API Server åœ¨æ¸¬è©¦æ™‚å›æ‡‰è³‡æ–™çµ¦ App ğŸ‰ğŸ‰ğŸ‰ã€‚</p><h3 id="20230904-mitmproxy-rodo-å·²é–‹æº"><span class="me-2">[2023â€“09â€“04] mitmproxy-rodo å·²é–‹æº</span><a href="#20230904-mitmproxy-rodo-å·²é–‹æº" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/ZhgChgLi/mitmproxy-rodo/tree/main" target="_blank" class="img-link shimmer" ><img src="https://repository-images.githubusercontent.com/686628812/44cf2ec7-4de1-4a10-b213-bf7dd30748a4" alt="" loading="lazy"></a></p><h3 id="å¾ŒçºŒå’Œé›œè¨˜"><span class="me-2">å¾ŒçºŒå’Œé›œè¨˜</span><a href="#å¾ŒçºŒå’Œé›œè¨˜" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>æœ¬æ–‡åªæ¢è¨äº†æ¦‚å¿µé©—è­‰ï¼Œå¾ŒçºŒé‚„æœ‰è¨±å¤šåœ°æ–¹è¦è£œé½Šä¹Ÿé‚„æœ‰æ›´å¤šåŠŸèƒ½å¯ä»¥å¯¦ç¾ã€‚</p><ol><li>èˆ‡ <a href="https://github.com/mobile-dev-inc/maestro" target="_blank">maestro</a> UI Testinga å·¥å…·æ•´åˆ<li>CI/CD æµç¨‹æ•´åˆè¨­è¨ˆ (æ€éº¼è‡ªå‹•èµ· Reverse Proxy? èµ·åœ¨å“ªè£¡? )<li>æ€éº¼æŠŠ MITMProxy å°è£åœ¨é–‹ç™¼å·¥å…·å…§?<li>é©—è­‰æ›´è¤‡é›œçš„æ¸¬è©¦å ´æ™¯<li><strong>é‡å°ç™¼é€çš„ Tracking Request åšé©—è­‰ï¼Œéœ€å¤šå¯¦ç¾å­˜ Request Bodyï¼Œç„¶å¾Œå¾ä¸­å–å¾—æ‰“äº†å“ªäº› Tracking Event Dataã€æ˜¯å¦ç¬¦åˆæµç¨‹è©²é€çš„äº‹ä»¶</strong></ol><h4 id="cookie-å•é¡Œ"><span class="me-2">Cookie å•é¡Œ</span><a href="#cookie-å•é¡Œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">#...
</span>    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="n">setCookies</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get_all</span><span class="p">(</span><span class="sh">"</span><span class="s">set-cookie</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># setCookies = ['ad=0; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/', 'sessionid=xxxx; Secure; HttpOnly; Domain=.xxx.com; expires=Wed, 23 Aug 2023 04:59:07 GMT; Max-Age=1800; Path=/']
</span>        
        <span class="c1"># OR Replace Cookie Domain From .xxx.com To 127.0.0.1
</span>        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">\s*\.xxx\.com\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">127.0.0.1</span><span class="sh">"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>

        <span class="c1"># AND ç§»é™¤å®‰å…¨æ€§ç›¸é—œé™åˆ¶
</span>        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\s*Secure\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>
        <span class="n">setCookies</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\s*HttpOnly;\s*</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">setCookies</span><span class="p">]</span>

        <span class="n">flow</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">set_all</span><span class="p">(</span><span class="sh">"</span><span class="s">Set-Cookie</span><span class="sh">"</span><span class="p">,</span> <span class="n">setCookies</span><span class="p">)</span>

        <span class="c1">#...
</span></pre></table></code></div></div><p>å¦‚æœæœ‰é‡åˆ° Cookie æ–¹é¢çš„å•é¡Œï¼Œä¾‹å¦‚ API æœ‰å›æ‡‰ Cookie ä½† App æ²’æ¥åˆ°ï¼Œå¯åƒè€ƒä»¥ä¸Šçš„èª¿æ•´ã€‚</p><h4 id="åœ¨-pinkoi-çš„æœ€å¾Œä¸€ç¯‡æ–‡ç« "><span class="me-2">åœ¨ Pinkoi çš„æœ€å¾Œä¸€ç¯‡æ–‡ç« </span><a href="#åœ¨-pinkoi-çš„æœ€å¾Œä¸€ç¯‡æ–‡ç« " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>åœ¨ Pinkoi 900 å¤šå¤©çš„æ—¥å­è£¡ï¼Œå¯¦ç¾äº†è¨±å¤šæˆ‘è·æ¶¯ä¸Šé‚„æœ‰ iOS / App é–‹ç™¼ã€æµç¨‹çš„æƒ³åƒï¼Œæ„Ÿè¬æ‰€æœ‰éšŠå‹ï¼Œä¸€èµ·èµ°éç–«æƒ…ã€ç¶“æ­·é¢¨é›¨ï¼›å‘Šåˆ¥çš„å‹‡æ°£å¦‚åŒç•¶åˆè¿½å°‹å¤¢æƒ³å…¥è·çš„å‹‡æ°£ã€‚</p><blockquote><p><a href="http://resume.zhgchg.li/" target="_blank"><strong>æ­£åœ¨å•Ÿèˆªæ‰¾å°‹æ–°çš„äººç”ŸæŒ‘æˆ°(åŒ…æ‹¬ä½†ä¸é™æ–¼å·¥ç¨‹)ï¼Œå¦‚æœæ‚¨æœ‰åˆé©çš„æ©Ÿæœƒï¼ˆiOS or å·¥ç¨‹ç®¡ç† or æ–°å‰µç”¢å“ï¼‰æ­¡è¿èˆ‡æˆ‘è¯çµ¡ã€‚</strong></a> ğŸ™ğŸ™ğŸ™</p></blockquote><p>æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ <a href="https://www.zhgchg.li/contact" target="_blank">èˆ‡æˆ‘è¯çµ¡</a> ã€‚</p><hr /><p>æœ¬æ–‡é¦–æ¬¡ç™¼è¡¨æ–¼ Medium â¡ï¸ <a href="https://medium.com/p/5a5c4b25a83d" target="_blank"><strong>å‰å¾€æŸ¥çœ‹</strong></a></p><p>ç”± <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a> èˆ‡ <a href="https://github.com/ZhgChgLi/medium-to-jekyll-starter.github.io" target="_blank">Medium-to-jekyll-starter</a> æä¾›è‡ªå‹•è½‰æ›èˆ‡åŒæ­¥æŠ€è¡“ã€‚</p><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-tw/zmediumtomarkdown/2023-08-28-5a5c4b25a83d.md" target="_blank">Improve this page on Github.</a></p><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=ğŸº&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a></p><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic> <script async="" src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); border-bottom: 1px solid var(--main-border-color);transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div><div style="font-size: 0.8em; cursor:default; text-align: right;"> 621 <span style="font-size: 0.9em;">Total Views</span><br /> <span style="font-size: 0.8em;">Last Statistics Date: 2025-08-15 | 597 Views on <a href="https://medium.com/p/5a5c4b25a83d" target="_blank">Medium.</a></span></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/zrealm-dev/">ZRealm Dev.</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/end-to-end-testing/" class="post-tag no-text-decoration" >end-to-end-testing</a> <a href="/tags/ui-testing/" class="post-tag no-text-decoration" >ui-testing</a> <a href="/tags/automation-testing/" class="post-tag no-text-decoration" >automation-testing</a> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=POC%20App%20End-to-End%20Testing%20Local%20Snapshot%20API%20Mock%20Server%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fpoc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=POC%20App%20End-to-End%20Testing%20Local%20Snapshot%20API%20Mock%20Server%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fpoc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fzrealm-dev%2Fpoc-app-end-to-end-testing-local-snapshot-api-mock-server-5a5c4b25a83d%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/z-travel-diaries/en/travel-diary-8-days-and-7-nights-in-busan-south-korea-2025-8ace34a1a3d8/">Travel Diary: 8 Days and 7 Nights in Busan, South Korea 2025</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2025-%E9%9F%93%E5%9C%8B%E9%87%9C%E5%B1%B1-8-%E5%A4%A9-7-%E5%A4%9C%E8%87%AA%E7%94%B1%E8%A1%8C-8ace34a1a3d8/">éŠè¨˜ 2025 éŸ“åœ‹é‡œå±± 8 å¤© 7 å¤œè‡ªç”±è¡Œ</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-9-11-%E5%90%8D%E5%8F%A4%E5%B1%8B%E4%B8%80%E6%97%A5%E5%BF%AB%E9%96%83%E8%87%AA%E7%94%B1%E8%A1%8C-7b8a0563c157/">éŠè¨˜ 9/11 åå¤å±‹ä¸€æ—¥å¿«é–ƒè‡ªç”±è¡Œ</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%B9%9D%E5%B7%9E-10-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C%E7%8D%A8%E6%97%85-d78e0b15a08a/">éŠè¨˜ 2023 ä¹å· 10 æ—¥è‡ªç”±è¡Œç¨æ—…</a><li class="text-truncate lh-lg"> <a href="/posts/z-%E5%BA%A6%E6%97%85%E8%A1%8C%E9%81%8A%E8%A8%98/%E9%81%8A%E8%A8%98-2023-%E4%BA%AC%E9%98%AA%E7%A5%9E-8-%E6%97%A5%E8%87%AA%E7%94%B1%E8%A1%8C-76d66c2e34af/">éŠè¨˜ 2023 äº¬é˜ªç¥ 8 æ—¥è‡ªç”±è¡Œ</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">ç« ç¯€ (Chapters)ğŸ”–</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/avplayer-%E9%82%8A%E6%92%AD%E9%82%8A-cache-%E5%AF%A6%E6%88%B0-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer é‚Šæ’­é‚Š Cache å¯¦æˆ°</h4><div class="text-muted"><p>AVPlayer/AVQueuePlayer with AVURLAsset å¯¦ä½œ AVAssetResourceLoaderDelegate é”æˆé‚Šæ’­æ”¾éŸ³æ¨‚/å½±ç‰‡é‚Šç·©å­˜</p></div></div></a></article><article class="col"> <a href="/posts/en/avplayer-streaming-and-caching-practical-guide-ee47f8f1e2d2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1609856872" data-df="ll" > Jan 5, 2021 </time><h4 class="pt-0 my-2">AVPlayer Streaming and Caching Practical Guide</h4><div class="text-muted"><p>Implementing AVPlayer/AVQueuePlayer with AVURLAsset and AVAssetResourceLoaderDelegate to achieve music/video streaming while caching.</p></div></div></a></article><article class="col"> <a href="/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-firebase-firestore-functions-%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%BE%9B%E6%B8%AC%E8%A9%A6%E7%9A%84-api-%E6%9C%8D%E5%8B%99-9659db1357e4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616519374" data-df="ll" > Mar 24, 2021 </time><h4 class="pt-0 my-2">ä½¿ç”¨ Firebase Firestore + Functions å¿«é€Ÿæ­å»ºå¯ä¾›æ¸¬è©¦çš„ API æœå‹™</h4><div class="text-muted"><p>ç•¶æ¨æ’­çµ±è¨ˆé‡ä¸Š Firebase Firestore + Functions</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/zrealm-dev/%E4%BD%BF%E7%94%A8-google-apps-script-%E4%B8%89%E6%AD%A5%E9%A9%9F%E5%85%8D%E8%B2%BB%E5%BB%BA%E7%AB%8B-github-repo-star-notifier-382218e15697/" class="btn btn-outline-primary" aria-label="Older" ><p>ä½¿ç”¨ Google Apps Script ä¸‰æ­¥é©Ÿå…è²»å»ºç«‹ Github Repo Star Notifier</p></a> <a href="/posts/travel-diaries/en/travel-diary-one-day-flash-trip-to-nagoya-on-9-11-7b8a0563c157/" class="btn btn-outline-primary" aria-label="Newer" ><p>Travel Diary: One-Day Flash Trip to Nagoya on 9/11</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> All Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a><br/>Last updated: 2025-08-16 11:02:43 +08:00</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
