<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ" /><meta name="author" content="ZhgChgLi" /><meta property="og:locale" content="en" /><meta name="description" content="é’ˆå¯¹ iOS ä¸ Android å³æ—¶é€šè®¯éœ€æ±‚ï¼Œè§£æå°è£… Socket.IO è¿‡ç¨‹ä¸­é‡åˆ°çš„å¤æ‚è¿çº¿ç®¡ç†ä¸è·¨å¹³å°æŒ‘æˆ˜ï¼Œé€è¿‡ä¸ƒå¤§è®¾è®¡æ¨¡å¼ä¼˜åŒ–è¿çº¿å¤ç”¨ã€ç¦»çº¿äº‹ä»¶ç¼“å­˜ä¸çŠ¶æ€ç®¡ç†ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å……æ€§ï¼ŒåŠ©ä½ æ‰“é€ é«˜æ•ˆä¸”æ˜“ç»´æŠ¤çš„åŒå‘é€šè®¯æ¶æ„ã€‚" /><meta property="og:description" content="é’ˆå¯¹ iOS ä¸ Android å³æ—¶é€šè®¯éœ€æ±‚ï¼Œè§£æå°è£… Socket.IO è¿‡ç¨‹ä¸­é‡åˆ°çš„å¤æ‚è¿çº¿ç®¡ç†ä¸è·¨å¹³å°æŒ‘æˆ˜ï¼Œé€è¿‡ä¸ƒå¤§è®¾è®¡æ¨¡å¼ä¼˜åŒ–è¿çº¿å¤ç”¨ã€ç¦»çº¿äº‹ä»¶ç¼“å­˜ä¸çŠ¶æ€ç®¡ç†ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å……æ€§ï¼ŒåŠ©ä½ æ‰“é€ é«˜æ•ˆä¸”æ˜“ç»´æŠ¤çš„åŒå‘é€šè®¯æ¶æ„ã€‚" /><link rel="canonical" href="https://zhgchg.li/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/" /><meta property="og:url" content="https://zhgchg.li/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/" /><meta property="og:site_name" content="ZhgChgLi (Harry Li)" /><meta property="og:image" content="https://zhgchg.li/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-07T22:49:17+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zhgchg.li/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" /><meta property="twitter:title" content="Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ" /><meta name="twitter:site" content="@zhgchgli" /><meta name="twitter:creator" content="@zhgchgli" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZhgChgLi","url":"https://medium.com/@zhgchgli/"},"dateModified":"2024-09-06T14:00:33+08:00","datePublished":"2022-04-07T22:49:17+08:00","description":"é’ˆå¯¹ iOS ä¸ Android å³æ—¶é€šè®¯éœ€æ±‚ï¼Œè§£æå°è£… Socket.IO è¿‡ç¨‹ä¸­é‡åˆ°çš„å¤æ‚è¿çº¿ç®¡ç†ä¸è·¨å¹³å°æŒ‘æˆ˜ï¼Œé€è¿‡ä¸ƒå¤§è®¾è®¡æ¨¡å¼ä¼˜åŒ–è¿çº¿å¤ç”¨ã€ç¦»çº¿äº‹ä»¶ç¼“å­˜ä¸çŠ¶æ€ç®¡ç†ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å……æ€§ï¼ŒåŠ©ä½ æ‰“é€ é«˜æ•ˆä¸”æ˜“ç»´æŠ¤çš„åŒå‘é€šè®¯æ¶æ„ã€‚","headline":"Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ","image":{"lqip":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+","url":"https://zhgchg.li/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhgchg.li/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"},"url":"https://zhgchg.li/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"}</script><title>Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ | ZhgChgLi (Harry Li)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ZhgChgLi (Harry Li)"><meta name="application-name" content="ZhgChgLi (Harry Li)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WZJENT8WR"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-6WZJENT8WR'); }); </script><link rel="alternate" hreflang="en" href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/"><link rel="alternate" hreflang="zh-Hant" href="/posts/pinkoi-engineering/design-patterns-%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8-%E5%B0%81%E8%A3%9D-socket-io-%E5%8D%B3%E6%99%82%E9%80%9A%E8%A8%8A%E6%9E%B6%E6%A7%8B%E8%88%87%E4%B8%83%E5%A4%A7%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"><link rel="alternate" hreflang="zh-Hans" href="/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"><link rel="alternate" hreflang="x-default" href="/posts/pinkoi-engineering/zh-cn/design-patterns-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85-socket-io-%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3184248473087645" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/zhgchgli.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ZhgChgLi (Harry Li)</a><p class="site-subtitle fst-italic mb-0">An iOS, web, and automation developer from Taiwan ğŸ‡¹ğŸ‡¼ who also loves sharing, traveling, and writing.</p><a href="https://medium.com/@zhgchgli" target="_blank" style="display: block;text-align: center;font-style: normal;/* text-decoration: underline; */font-size: 1.2em;color: var(--heading-color);">1K+ Followers on Medium</a></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fa fa-envelope-open"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/english/" class="nav-link"> <i class="fa-fw fa fa-solid fa-language"></i> <span>ENGLISH POSTS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://link.zhgchg.li" aria-label="link" target="_blank" rel="noopener noreferrer" > <i class="fas fa-link"></i> </a> <a href="https://www.linkedin.com/in/zhgchgli" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zhgchgli','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ</h1><p class="post-desc fw-light mb-4">é’ˆå¯¹ iOS ä¸ Android å³æ—¶é€šè®¯éœ€æ±‚ï¼Œè§£æå°è£… Socket.IO è¿‡ç¨‹ä¸­é‡åˆ°çš„å¤æ‚è¿çº¿ç®¡ç†ä¸è·¨å¹³å°æŒ‘æˆ˜ï¼Œé€è¿‡ä¸ƒå¤§è®¾è®¡æ¨¡å¼ä¼˜åŒ–è¿çº¿å¤ç”¨ã€ç¦»çº¿äº‹ä»¶ç¼“å­˜ä¸çŠ¶æ€ç®¡ç†ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å……æ€§ï¼ŒåŠ©ä½ æ‰“é€ é«˜æ•ˆä¸”æ˜“ç»´æŠ¤çš„åŒå‘é€šè®¯æ¶æ„ã€‚</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1649342957" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 7, 2022 </time> </span> <span> Updated <time data-ts="1725602433" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 6, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" class="popup img-link preview-img blur"><img data-src="/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjAiIGhlaWdodD0iMTAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></div><div class="d-flex justify-content-between"> <span style="display: inline-flex; align-items: center; gap: 4px;"> By <em> <a href="https://medium.com/@zhgchgli/">ZhgChgLi</a> </em> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="16" height="16" style="display: block; "><path fill="#007bff" d="M271.2 56C265.1 49.8 256.2 47.3 247.8 49.6C239.4 51.9 232.9 58.4 230.8 66.8L215.5 127C214.4 131.4 209.9 134 205.6 132.7L145.8 115.9C137.4 113.5 128.4 115.9 122.3 122C116.2 128.1 113.8 137.1 116.2 145.5L133.1 205.3C134.3 209.6 131.7 214.1 127.4 215.2L67.1 230.5C58.7 232.6 52.1 239.2 49.8 247.6C47.5 256 50 264.9 56.2 271L100.7 314.3C103.9 317.4 103.9 322.6 100.7 325.8L56.3 369.1C50.1 375.2 47.6 384.1 49.9 392.5C52.2 400.9 58.8 407.4 67.2 409.6L127.4 424.9C131.8 426 134.4 430.5 133.1 434.8L116.2 494.5C113.8 502.9 116.2 511.9 122.3 518C128.4 524.1 137.4 526.5 145.8 524.1L205.6 507.2C209.9 506 214.4 508.6 215.5 512.9L230.8 573.1C232.9 581.5 239.5 588.1 247.9 590.4C256.3 592.7 265.2 590.2 271.3 584L314.6 539.5C317.7 536.3 322.9 536.3 326.1 539.5L369.3 584C375.4 590.2 384.3 592.7 392.7 590.4C401.1 588.1 407.6 581.5 409.8 573.1L425.1 513C426.2 508.6 430.7 506 435 507.3L494.8 524.2C503.2 526.6 512.2 524.2 518.3 518.1C524.4 512 526.8 503 524.4 494.6L507.5 434.8C506.3 430.5 508.9 426 513.2 424.9L573.4 409.6C581.8 407.5 588.4 400.9 590.7 392.5C593 384.1 590.5 375.1 584.3 369.1L539.8 325.8C536.6 322.7 536.6 317.5 539.8 314.3L584.3 271C590.5 264.9 593 256 590.7 247.6C588.4 239.2 581.8 232.7 573.4 230.5L513.2 215.2C508.8 214.1 506.2 209.6 507.5 205.3L524.4 145.5C526.8 137.1 524.4 128.1 518.3 122C512.2 115.9 503.2 113.5 494.8 115.9L435 132.8C430.7 134 426.2 131.4 425.1 127.1L409.8 66.8C407.7 58.4 401.1 51.8 392.7 49.5C384.3 47.2 375.4 49.7 369.3 55.9L326 100.5C322.9 103.7 317.7 103.7 314.5 100.5L271.2 56z"/><path d="M250 330 l60 60 100 -140" stroke="#ffffff" stroke-width="40" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="6515 words" > <em>36 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">ç« ç¯€ (Chapters)ğŸ”–</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Design Patterns å®æˆ˜åº”ç”¨ï½œå°è£… Socket.IO å³æ—¶é€šè®¯æ¶æ„ä¸ä¸ƒå¤§è®¾è®¡æ¨¡å¼è§£æ</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"> <widgetic id="64ce7263ecb2a197598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><blockquote class="prompt-tip"><p><a href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/"><strong>Click here</strong></a> to view the English version of this article.</p></blockquote><blockquote class="prompt-tip"><p><a href="/posts/pinkoi-engineering/design-patterns-%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8-%E5%B0%81%E8%A3%9D-socket-io-%E5%8D%B3%E6%99%82%E9%80%9A%E8%A8%8A%E6%9E%B6%E6%A7%8B%E8%88%87%E4%B8%83%E5%A4%A7%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/"><strong>é»æ“Šé€™è£¡</strong></a>æŸ¥çœ‹æœ¬æ–‡ç« æ­£é«”ä¸­æ–‡ç‰ˆæœ¬ã€‚</p></blockquote><blockquote class="prompt-info"><p>åŸºäº SEO è€ƒé‡ï¼Œæœ¬æ–‡æ ‡é¢˜ä¸æè¿°ç» AI è°ƒæ•´ï¼ŒåŸå§‹ç‰ˆæœ¬è¯·å‚è€ƒå†…æ–‡ã€‚</p></blockquote><hr /><h3 id="design-patterns-çš„å®æˆ˜åº”ç”¨çºªå½•"><span class="me-2">Design Patterns çš„å®æˆ˜åº”ç”¨çºªå½•</span><a href="#design-patterns-çš„å®æˆ˜åº”ç”¨çºªå½•" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>å°è£… Socket.IO Client Library éœ€æ±‚æ—¶é‡åˆ°çš„é—®é¢˜åœºæ™¯åŠè§£å†³æ–¹æ³•åº”ç”¨åˆ°çš„ Design Patterns</p><p><a href="/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*mkG0YtCzyPQpU9MG0HI79w.webp" alt="Photo by [Daniel McCullough](https://unsplash.com/@d_mccullough?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjY3NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Photo by <a href="https://unsplash.com/@d_mccullough?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank">Daniel McCullough</a></p><h3 id="å‰è¨€"><span class="me-2">å‰è¨€</span><a href="#å‰è¨€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>æ­¤ç¯‡æ–‡ç« æ˜¯çœŸå®çš„éœ€æ±‚å¼€å‘ï¼Œæ‰€è¿ç”¨åˆ° Design Pattern è§£å†³é—®é¢˜çš„åœºæ™¯è®°å½•ï¼›å†…å®¹ç¯‡å¹…ä¼šæ¶µç›–éœ€æ±‚èƒŒæ™¯ã€å®é™…é‡åˆ°çš„é—®é¢˜åœºæ™¯ (What?)ã€ä¸ºä½•è¦å¥—ç”¨ Pattern è§£å†³é—®é¢˜ (Why?)ã€å®ä½œä¸Šå¦‚ä½•ä½¿ç”¨ (How?)ï¼Œå»ºè®®å¯ä»¥ä»å¤´é˜…è¯»ä¼šæ¯”è¾ƒæœ‰è¿è´¯æ€§ã€‚</p><blockquote><p><em>æœ¬æ–‡ä¼šä»‹ç»å››ä¸ªå¼€å‘æ­¤éœ€æ±‚é‡åˆ°çš„åœºæ™¯åŠä¸ƒä¸ªè§£å†³æ­¤åœºæ™¯çš„ Design Patterns åº”ç”¨ã€‚</em></p></blockquote><h3 id="èƒŒæ™¯"><span class="me-2">èƒŒæ™¯</span><a href="#èƒŒæ™¯" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="ç»„ç»‡æ¶æ„"><span class="me-2">ç»„ç»‡æ¶æ„</span><a href="#ç»„ç»‡æ¶æ„" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æ•å¸äºä»Šå¹´æ‹†åˆ†å‡º Feature Teams (multiple) ä¸ Platform Teamï¼›å‰è€…ä¸å¿…å¤šè¯´ä¸»è¦è´Ÿè´£ä½¿ç”¨è€…ç«¯éœ€æ±‚ã€Platform Team è¿™è¾¹åˆ™é¢å¯¹çš„æ˜¯å…¬å¸å†…éƒ¨çš„æˆå‘˜ï¼Œå…¶ä¸­ä¸€ä¸ªå·¥ä½œé¡¹ç›®å°±æ˜¯æŠ€æœ¯å¼•å…¥ã€åŸºç¡€å»ºè®¾åŠåšå¥½ç³»ç»Ÿæ€§æ•´åˆï¼Œä¸º Feature Teams å¼€å‘éœ€æ±‚æ—¶å…ˆé”‹é“ºå¥½é“è·¯ã€‚</p><h4 id="å½“å‰éœ€æ±‚"><span class="me-2">å½“å‰éœ€æ±‚</span><a href="#å½“å‰éœ€æ±‚" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Feature Teams è¦å°†åŸæœ¬çš„è®¯æ¯åŠŸèƒ½ (è¿›é¡µé¢æ‰“ API æ‹¿è®¯æ¯èµ„æ–™ï¼Œè¦æ›´æ–°æœ€æ–°è®¯æ¯åªèƒ½é‡æ•´) æ”¹ä¸º å³æ—¶é€šè®¯ (èƒ½å³æ—¶æ”¶åˆ°æœ€æ–°è®¯æ¯ã€å¯¹ä¼ è®¯æ¯)ã€‚</p><h4 id="platform-team-å·¥ä½œ"><span class="me-2">Platform Team å·¥ä½œ</span><a href="#platform-team-å·¥ä½œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Platform Team è‘—é‡çš„ç‚¹ä¸åªæ˜¯å½“ä¸‹çš„å³æ—¶é€šè®¯éœ€æ±‚ï¼Œè€Œæ˜¯é•¿è¿œçš„å»ºè®¾ä¸å¤ç”¨æ€§ï¼›è¯„ä¼°å webSocket åŒå‘é€šè®¯çš„æœºåˆ¶åœ¨ç°ä»£ App ä¸­æ˜¯ä¸å¯æˆ–ç¼ºï¼Œé™¤äº†æ­¤æ¬¡çš„éœ€æ±‚ä¹‹å¤–ï¼Œä»¥åä¹Ÿæœ‰å¾ˆå¤šæœºä¼šéƒ½ä¼šç”¨åˆ°ï¼ŒåŠ ä¸ŠäººåŠ›èµ„æºè®¸å¯ï¼Œæ•…æŠ•å…¥ååŠ©è®¾è®¡å¼€å‘ä»‹é¢ã€‚</p><p><strong>ç›®æ ‡ï¼š</strong></p><ul><li><p>å°è£… Pinkoi Server Side ä¸ Socket.IO é€šè®¯ã€èº«ä»½éªŒè¯é€»è¾‘</p><li><p>å°è£… Socket.IO çƒ¦çæ“ä½œï¼Œæä¾›åŸºäº Pinkoi å•†ä¸šéœ€æ±‚çš„å¯æ‰©å……åŠæ–¹ä¾¿ä½¿ç”¨ä»‹é¢</p><li><p>ç»Ÿä¸€åŒå¹³å°ä»‹é¢ <strong>(Socket.IO çš„ Android ä¸ iOS Client Side Library æ”¯æ´çš„åŠŸèƒ½åŠä»‹é¢ä¸ç›¸åŒ)</strong></p><li><p>Feature ç«¯æ— éœ€äº†è§£ Socket.IO æœºåˆ¶</p><li><p>Feature ç«¯æ— éœ€ç®¡ç†å¤æ‚çš„è¿çº¿çŠ¶æ€</p><li><p>æœªæ¥æœ‰ webSocket åŒå‘é€šè®¯éœ€æ±‚èƒ½ç›´æ¥ä½¿ç”¨</p></ul><p><strong>æ—¶é—´åŠäººåŠ›ï¼š</strong></p><ul><li><p>iOS &amp; Android å„æŠ•å…¥ä¸€ä½</p><li><p>å¼€å‘æ—¶ç¨‹ï¼šæ—¶ç¨‹ 3 å‘¨</p></ul><h4 id="æŠ€æœ¯ç»†èŠ‚"><span class="me-2">æŠ€æœ¯ç»†èŠ‚</span><a href="#æŠ€æœ¯ç»†èŠ‚" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Web &amp; iOS &amp; Android ä¸‰å¹³å°å‡ä¼šæ”¯æ´æ­¤ Featureï¼›è¦å¼•å…¥ webSocket åŒå‘é€šè®¯åè®®æ¥å®ç°ï¼Œåç«¯é¢„è®¡ç›´æ¥ä½¿ç”¨ <a href="http://socket.io/" target="_blank">Socket.io</a> æœåŠ¡ã€‚</p><blockquote><p><strong><em>é¦–å…ˆè¦è¯´ Socket != WebSocket</em></strong></p></blockquote><p>å…³äº Socket ä¸ WebSocket åŠæŠ€æœ¯ç»†èŠ‚å¯å‚è€ƒä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š</p><ul><li><p><a href="https://leesonhsu.blogspot.com/2018/07/socketwebsocketsocketio.html" target="_blank">Socketï¼ŒWebsocketï¼ŒSocket.ioçš„å·®å¼‚</a></p><li><p><a href="https://github.com/onlyliuxin/coding2017/issues/497" target="_blank">ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨socket ,è¿˜è¦å®šä¹‰ä¸€ä¸ªæ–°çš„websocket çš„å‘¢ï¼Ÿ</a></p></ul><p>ç®€è€Œè¨€ä¹‹ï¼š</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Socket æ˜¯ TCP/UDP ä¼ è¾“å±‚çš„æŠ½è±¡å°è£…ä»‹é¢ï¼Œè€Œ WebSocket æ˜¯åº”ç”¨å±‚çš„ä¼ è¾“åè®®ã€‚
Socket ä¸ WebSocket çš„å…³ç³»å°±åƒç‹—è·Ÿçƒ­ç‹—çš„å…³ç³»ä¸€æ ·ï¼Œæ²¡æœ‰å…³ç³»ã€‚
</pre></table></code></div></div><p><a href="/assets/78507a8de6a5/1*MC_nQC382khMeWggLejWOA.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*MC_nQC382khMeWggLejWOA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU4NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>Socket.IO æ˜¯ Engine.IO çš„ä¸€å±‚æŠ½è±¡æ“ä½œå°è£…ï¼ŒEngine.IO åˆ™æ˜¯å¯¹ WebSocket çš„ä½¿ç”¨å°è£…ï¼Œæ¯å±‚åªè´Ÿè´£å¯¹ä¸Šå¯¹ä¸‹ä¹‹é—´çš„äº¤æµï¼Œä¸å…è®¸è´¯ç©¿æ“ä½œ(e.g. Socket.IO ç›´æ¥æ“ä½œ WebSocket è¿çº¿)ã€‚</p><p>Socket.IO/Engine.IO é™¤äº†åŸºæœ¬çš„ WebSocket è¿çº¿å¤–è¿˜å®åšäº†å¾ˆå¤šæ–¹ä¾¿å¥½ç”¨çš„åŠŸèƒ½é›†åˆ(e.g. ç¦»çº¿å‘é€ Event æœºåˆ¶ã€ç±»ä¼¼ Http Request æœºåˆ¶ã€Room/Group æœºåˆ¶â€¦ç­‰ç­‰)ã€‚</p><p>Platform Team è¿™å±‚çš„ä¸»è¦èŒè´£æ˜¯æ¡¥æ¥ Socket.IO ä¸ Pinkoi Server Side ä¹‹é—´çš„é€»è¾‘ï¼Œä¾›åº”ä¸Šå±‚ Feature Teams å¼€å‘åŠŸèƒ½æ—¶ä½¿ç”¨ã€‚</p><h4 id="socketio-swift-client-æœ‰å‘"><span class="me-2"><a href="https://github.com/socketio/socket.io-client-swift" target="_blank">Socket.IO Swift Client</a> æœ‰å‘</span><a href="#socketio-swift-client-æœ‰å‘" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>å·²è®¸ä¹…æœªæ›´æ–° (æœ€æ–°ä¸€ç‰ˆè¿˜åœ¨ 2019)ï¼Œä¸ç¡®å®šæ˜¯å¦è¿˜æœ‰åœ¨ç»´æŠ¤ã€‚</p><li><p>Client &amp; Server Side Socket IO Version è¦å¯¹é½ï¼ŒServer Side å¯åŠ ä¸Š <code class="language-plaintext highlighter-rouge">{allowEIO3: true}</code> / æˆ– Client Side æŒ‡å®šç›¸åŒç‰ˆæœ¬ <code class="language-plaintext highlighter-rouge">.version</code> å¦åˆ™æ€ä¹ˆè¿éƒ½è¿ä¸ä¸Šã€‚</p><li><p>å‘½åæ–¹å¼ã€ä»‹é¢ä¸å®˜ç½‘èŒƒä¾‹å¾ˆå¤šéƒ½å¯¹ä¸èµ·æ¥ã€‚</p><li><p>Socket.io å®˜ç½‘èŒƒä¾‹éƒ½æ˜¯æ‹¿ Web åšä»‹ç»ï¼Œå®é™…ä¸Š Swift Client <strong>å¹¶ä¸ä¸€å®šæœ‰å…¨æ”¯æ´å®˜ç½‘å†™çš„åŠŸèƒ½</strong> ã€‚ æ­¤æ¬¡å®ä½œå‘ç° iOS è¿™è¾¹ Library å¹¶æœªå®ç°ç¦»çº¿å‘é€ Event æœºåˆ¶ (æˆ‘ä»¬æ˜¯è‡ªè¡Œå®ç°çš„ï¼Œè¯·å¾€åç»§ç»­é˜…è¯»)</p></ul><blockquote><p><strong><em>å»ºè®®æœ‰è¦é‡‡ç”¨ Socket.IO å‰å…ˆå®éªŒçœ‹çœ‹ä½ æƒ³è¦çš„æœºåˆ¶æ˜¯å¦æ”¯æ´ã€‚</em></strong></p></blockquote><blockquote><p><em>Socket.IO Swift Client æ˜¯åŸºäº <strong><a href="https://github.com/daltoniam/Starscream" target="_blank">Starscream</a></strong> WebSocket Library çš„å°è£…ï¼Œå¿…è¦æ—¶å¯é™çº§ä½¿ç”¨ Starscreamã€‚</em></p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>èƒŒæ™¯èµ„è®¯è¡¥å……åˆ°æ­¤ç»“æŸï¼Œæ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ã€‚
</pre></table></code></div></div><h3 id="design-patterns"><span class="me-2">Design Patterns</span><a href="#design-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>è®¾è®¡æ¨¡å¼è¯´ç©¿äº†å°±åªæ˜¯è½¯ä½“è®¾è®¡å½“ä¸­å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä¸ä¸€å®šè¦ç”¨è®¾è®¡æ¨¡å¼æ‰èƒ½å¼€å‘ã€è®¾è®¡æ¨¡å¼ä¸ä¸€å®šèƒ½é€‚ç”¨æ‰€æœ‰åœºæ™¯ã€ä¹Ÿæ²¡äººè¯´ä¸èƒ½è‡ªè¡Œå½’çº³å‡ºæ–°çš„è®¾è®¡æ¨¡å¼ã€‚</p><p><a href="/assets/78507a8de6a5/1*MAm5WPynbv7M9tdmW2lNGQ.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*MAm5WPynbv7M9tdmW2lNGQ.webp" alt="[The Catalog of Design Patterns](https://refactoring.guru/design-patterns/catalog){:target=&quot;_blank&quot;}" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjEwODMiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImdyZXkiLz48L3N2Zz4="></a></p><p><a href="https://refactoring.guru/design-patterns/catalog" target="_blank">The Catalog of Design Patterns</a></p><p>ä½†ç°æœ‰çš„è®¾è®¡æ¨¡å¼ (The 23 Gang of Four Design Patterns) å·²æ˜¯è½¯ä½“è®¾è®¡ä¸­çš„å…±åŒçŸ¥è¯†ï¼Œåªè¦æåˆ° XXX Pattern å¤§å®¶è„‘ä¸­å°±ä¼šæœ‰ç›¸åº”çš„æ¶æ„è“å›¾ï¼Œä¸éœ€å¤šåšè§£é‡Šã€åç»­ç»´æŠ¤ä¹Ÿæ¯”è¾ƒå¥½çŸ¥é“è„‰ç»œã€ä¸”å·²æ˜¯ç»è¿‡ä¸šç•ŒéªŒè¯çš„æ–¹æ³•ä¸å¤ªéœ€è¦èŠ±æ—¶é—´å®¡è§†ç‰©ä»¶ä¾èµ–é—®é¢˜ï¼›åœ¨é€‚åˆçš„åœºæ™¯é€‰ç”¨é€‚åˆçš„æ¨¡å¼å¯ä»¥é™ä½æ²Ÿé€šåŠç»´æŠ¤æˆæœ¬ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚</p><blockquote><p><strong><em>è®¾è®¡æ¨¡å¼å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œä½†ä¸å»ºè®®å¯¹ç°æœ‰è®¾è®¡æ¨¡å¼é­”æ”¹ã€å¼ºè¡Œä¸ºå¥—ç”¨è€Œå¥—ç”¨ã€å¥—ç”¨ä¸ç¬¦åˆåˆ†ç±»çš„ Pattern (e.g. ç”¨è´£ä»»ç»ƒæ¨¡å¼æ¥äº§ç”Ÿç‰©ä»¶)ï¼Œä¼šå¤±å»ä½¿ç”¨çš„æ„ä¹‰æ›´å¯èƒ½é€ æˆåç»­æ¥æ‰‹çš„äººçš„è¯¯ä¼šã€‚</em></strong></p></blockquote><h4 id="æœ¬ç¯‡ä¼šæåˆ°çš„-design-patterns"><span class="me-2">æœ¬ç¯‡ä¼šæåˆ°çš„ Design Patternsï¼š</span><a href="#æœ¬ç¯‡ä¼šæåˆ°çš„-design-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><a href="https://refactoring.guru/design-patterns/singleton" target="_blank">Singleton Pattern</a></p><li><p><a href="https://refactoring.guru/design-patterns/flyweight" target="_blank">Flywieght Pattern</a></p><li><p><a href="https://refactoring.guru/design-patterns/factory-method" target="_blank">Factory Pattern</a></p><li><p><a href="https://refactoring.guru/design-patterns/command" target="_blank">Command Pattern</a></p><li><p><a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank">Finite-State Machine</a> + <a href="https://refactoring.guru/design-patterns/state" target="_blank">State Pattern</a></p><li><p><a href="https://refactoring.guru/design-patterns/chain-of-responsibility" target="_blank">Chain Of Resposibility</a></p><li><p><a href="https://refactoring.guru/design-patterns/builder" target="_blank">Builder Pattern</a></p></ul><p>ä¼šé€ä¸€åœ¨åé¢è§£é‡Šä»€ä¹ˆåœºå¢ƒç”¨äº†ã€ä¸ºä½•è¦ç”¨ã€‚</p><blockquote><p><em>æœ¬æ–‡è‘—é‡åœ¨ Design Pattern çš„åº”ç”¨ï¼Œè€Œé Socket.IO çš„æ“ä½œï¼Œéƒ¨åˆ†ç¤ºä¾‹ä¼šå› ä¸ºæè¿°æ–¹ä¾¿è€Œæœ‰æ‰€åˆ å‡ï¼Œ <strong>æ— æ³•é€‚ç”¨çœŸå®çš„ Socket.IO å°è£…</strong> ã€‚</em></p></blockquote><blockquote><p><em>å› ç¯‡å¹…æœ‰é™ï¼Œæœ¬æ–‡ä¸ä¼šè¯¦ç»†ä»‹ç»æ¯ä¸ªè®¾è®¡æ¨¡å¼çš„æ¶æ„ï¼Œè¯·å…ˆç‚¹å„ä¸ªæ¨¡å¼çš„è¿ç»“è¿›å…¥äº†è§£è¯¥æ¨¡å¼çš„æ¶æ„åå†ç»§ç»­é˜…è¯»ã€‚</em></p></blockquote><blockquote><p><em>Demo Code ä¼šä½¿ç”¨ Swift æ’°å†™ã€‚</em></p></blockquote><h3 id="éœ€æ±‚åœºæ™¯-1"><span class="me-2">éœ€æ±‚åœºæ™¯ 1.</span><a href="#éœ€æ±‚åœºæ™¯-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what"><span class="me-2">What?</span><a href="#what" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>ä½¿ç”¨ç›¸åŒçš„ Path åœ¨ä¸åŒé¡µé¢ã€Object è¯·æ±‚ Connection æ—¶èƒ½å¤ç”¨å–å¾—ç›¸åŒçš„ç‰©ä»¶ã€‚</p><li><p>Connection éœ€ä¸ºæŠ½è±¡ä»‹é¢ï¼Œä¸ç›´æ¥ä¾èµ– Socket.IO Object</p></ul><h4 id="why"><span class="me-2">Why?</span><a href="#why" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>å‡å°‘è®°å¿†ä½“å¼€é”€åŠé‡å¤è¿çº¿çš„æ—¶é—´ã€æµé‡æˆæœ¬ã€‚</p><li><p>ä¸ºæœªæ¥æŠ½æ¢æˆå…¶ä»–æ¡†æ¶é¢„ç•™ç©ºé—´</p></ul><h4 id="how"><span class="me-2">How?</span><a href="#how" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><a href="https://refactoring.guru/design-patterns/singleton" target="_blank">Singleton Pattern</a> ï¼šåˆ›å»ºå‹ Patternï¼Œä¿è¯ä¸€ä¸ªç‰©ä»¶åªä¼šæœ‰ä¸€ä¸ªå®ä½“ã€‚</p><li><p><a href="https://refactoring.guru/design-patterns/flyweight" target="_blank">Flywieght Pattern</a> ï¼šç»“æ„å‹ Patternï¼ŒåŸºäºå…±äº«å¤šä¸ªç‰©ä»¶ç›¸åŒçš„çŠ¶æ€ï¼Œé‡å¤ä½¿ç”¨ã€‚</p><li><p><a href="https://refactoring.guru/design-patterns/factory-method" target="_blank">Factory Pattern</a> ï¼šåˆ›å»ºå‹ Patternï¼ŒæŠ½è±¡ç‰©ä»¶äº§ç”Ÿæ–¹æ³•ï¼Œä½¿å…¶èƒ½åœ¨å¤–éƒ¨æŠ½æ¢ã€‚</p></ul><p><strong>å®é™…æ¡ˆä¾‹ä½¿ç”¨ï¼š</strong></p><p><a href="/assets/78507a8de6a5/1*flQa_EfErGBwbmEwpI7ZgQ.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*flQa_EfErGBwbmEwpI7ZgQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NDAiIGhlaWdodD0iNzA3Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p><strong>Singleton Patternï¼š</strong> <code class="language-plaintext highlighter-rouge">ConnectionManager</code> åœ¨ App Lifecycle ä¸­ä»…å­˜åœ¨ä¸€ä¸ªçš„ç‰©ä»¶ï¼Œç”¨æ¥ç®¡ç† <code class="language-plaintext highlighter-rouge">Connection</code> å–ç”¨æ“ä½œã€‚</p><li><p><strong>Flywieght Patternï¼š</strong> <code class="language-plaintext highlighter-rouge">ConnectionPool</code> é¡¾åæ€ä¹‰å°±æ˜¯ Connection çš„å…±ç”¨æ± å­ï¼Œç»Ÿä¸€ä»è¿™ä¸ªæ± å­çš„æ–¹æ³•æ‹¿å‡º Connectionï¼Œå…¶ä¸­é€»è¾‘å°±ä¼šåŒ…å«å½“å‘ç° URL Path ä¸€æ ·æ—¶ç›´æ¥ç»™äºˆå·²ç»åœ¨æ± å­é‡Œçš„ Connectionã€‚ <code class="language-plaintext highlighter-rouge">ConnectionHandler</code> åˆ™åšä¸º <code class="language-plaintext highlighter-rouge">Connection</code> çš„å¤–åœ¨æ“ä½œã€çŠ¶æ€ç®¡ç†å™¨ã€‚</p><li><p><strong>Factory Patternï¼š</strong> <code class="language-plaintext highlighter-rouge">ConnectionFactory</code> æ­é…ä¸Šé¢ Flywieght Pattern å½“å‘ç°æ± å­æ²¡æœ‰å¯å¤ç”¨çš„ <code class="language-plaintext highlighter-rouge">Connection</code> æ—¶åˆ™ç”¨æ­¤å·¥å‚ä»‹é¢å»äº§ç”Ÿã€‚</p></ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
</pre><td class="rouge-code"><pre><span class="kd">import</span> <span class="kt">Combine</span>
<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">protocol</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ConnectionFactory</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Connection</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ConnectionPool</span> <span class="p">{</span>
    
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">connectionFactory</span><span class="p">:</span> <span class="kt">ConnectionFactory</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">connections</span><span class="p">:</span> <span class="p">[</span><span class="kt">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">connectionFactory</span><span class="p">:</span> <span class="kt">ConnectionFactory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">connectionFactory</span> <span class="o">=</span> <span class="n">connectionFactory</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">getOrCreateConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Connection</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="n">connections</span><span class="o">.</span><span class="nf">first</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">url</span> <span class="p">})</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">connection</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
            <span class="n">connections</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">connection</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ConnectionHandler</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">connection</span><span class="p">:</span> <span class="kt">Connection</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">connection</span><span class="p">:</span> <span class="kt">Connection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">getConnectionUUID</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">UUID</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">id</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ConnectionManager</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">ConnectionManager</span><span class="p">(</span><span class="nv">connectionPool</span><span class="p">:</span> <span class="kt">ConnectionPool</span><span class="p">(</span><span class="nv">connectionFactory</span><span class="p">:</span> <span class="kt">SIOConnectionFactory</span><span class="p">()))</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">connectionPool</span><span class="p">:</span> <span class="kt">ConnectionPool</span>
    <span class="kd">private</span> <span class="nf">init</span><span class="p">(</span><span class="nv">connectionPool</span><span class="p">:</span> <span class="kt">ConnectionPool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">connectionPool</span> <span class="o">=</span> <span class="n">connectionPool</span>
    <span class="p">}</span>
    
    <span class="c1">//</span>
    <span class="kd">func</span> <span class="nf">requestConnectionHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ConnectionHandler</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="n">connectionPool</span><span class="o">.</span><span class="nf">getOrCreateConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="kt">ConnectionHandler</span><span class="p">(</span><span class="nv">connection</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Socket.IO Implementation</span>
<span class="kd">class</span> <span class="kt">SIOConnection</span><span class="p">:</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
        <span class="k">return</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionFactory</span><span class="p">:</span> <span class="kt">ConnectionFactory</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Connection</span> <span class="p">{</span>
        <span class="c1">//</span>
        <span class="k">return</span> <span class="kt">SIOConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//</span>

<span class="nf">print</span><span class="p">(</span><span class="kt">ConnectionManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">requestConnectionHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com/1"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="nf">getConnectionUUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">ConnectionManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">requestConnectionHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com/1"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="nf">getConnectionUUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="kt">ConnectionManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">requestConnectionHandler</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com/2"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="nf">getConnectionUUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">)</span>

<span class="c1">// output:</span>
<span class="c1">// D99F5429-1C6D-4EB5-A56E-9373D6F37307</span>
<span class="c1">// D99F5429-1C6D-4EB5-A56E-9373D6F37307</span>
<span class="c1">// 599CF16F-3D7C-49CF-817B-5A57C119FE31</span>
</pre></table></code></div></div><h3 id="éœ€æ±‚åœºæ™¯-2"><span class="me-2">éœ€æ±‚åœºæ™¯ 2.</span><a href="#éœ€æ±‚åœºæ™¯-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what-1"><span class="me-2">What?</span><a href="#what-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>å¦‚èƒŒæ™¯æŠ€æœ¯ç»†èŠ‚æ‰€è¿°ï¼ŒSocket.IO Swift Client çš„ <code class="language-plaintext highlighter-rouge">Send Event</code> å¹¶ä¸æ”¯æ´ç¦»çº¿å‘é€ (ä½† Web/Android ç‰ˆçš„ Library å´å¯ä»¥)ï¼Œå› æ­¤ iOS ç«¯éœ€è¦è‡ªè¡Œå®ç°æ­¤åŠŸèƒ½ã€‚</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ç¥å¥‡çš„æ˜¯ Socket.IO Swift Client - onEvent æ˜¯æ”¯æ´ç¦»çº¿è®¢é˜…çš„ã€‚
</pre></table></code></div></div><h4 id="why-1"><span class="me-2">Why?</span><a href="#why-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>è·¨å¹³å°åŠŸèƒ½ç»Ÿä¸€</p><li><p>ç¨‹å¼ç å®¹æ˜“ç†è§£</p></ul><h4 id="how-1"><span class="me-2">How?</span><a href="#how-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://refactoring.guru/design-patterns/command" target="_blank">Command Pattern</a> ï¼šè¡Œä¸ºå‹ Patternï¼Œå°†æ“ä½œåŒ…è£…æˆå¯¹è±¡ï¼Œæä¾›é˜Ÿåˆ—ã€å»¶è¿Ÿã€å–æ¶ˆâ€¦ç­‰ç­‰é›†åˆæ“ä½œã€‚</ul><p><a href="/assets/78507a8de6a5/1*O9zc28nMx64HDiDy4aiexA.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*O9zc28nMx64HDiDy4aiexA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4ODkiIGhlaWdodD0iMzQ0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><strong>Command Patternï¼š</strong> <code class="language-plaintext highlighter-rouge">SIOManager</code> ä¸ºä¸ Socket.IO æ²Ÿé€šçš„æœ€åº•å±‚å°è£…ï¼Œå…¶ä¸­çš„ <code class="language-plaintext highlighter-rouge">send</code> ã€ <code class="language-plaintext highlighter-rouge">request</code> æ–¹æ³•éƒ½æ˜¯å¯¹ Socket.IO Send Event çš„æ“ä½œï¼Œå½“å‘ç°å½“å‰ Socket.IO å¤„äºæ–­çº¿çŠ¶æ€ï¼Œåˆ™å°†è¯·æ±‚å‚æ•°æ”¾åˆ° <code class="language-plaintext highlighter-rouge">bufferedCommands</code> ä¸­ï¼Œå½“è¿ä¸Šä¹‹åå°±é€ä¸€æ‹¿å‡ºæ¥å¤„ç† (First In First Out)ã€‚</ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">BufferedCommand</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">?</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SendBufferedCommand</span><span class="p">:</span> <span class="kt">BufferedCommand</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">sioManager</span><span class="p">?</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">RequestBufferedCommand</span><span class="p">:</span> <span class="kt">BufferedCommand</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">sioManager</span><span class="p">?</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="n">callback</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">SIOManagerSpec</span><span class="p">:</span> <span class="kt">AnyObject</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">ConnectionState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">created</span>
    <span class="k">case</span> <span class="n">connected</span>
    <span class="k">case</span> <span class="n">disconnected</span>
    <span class="k">case</span> <span class="n">reconnecting</span>
    <span class="k">case</span> <span class="n">released</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span> <span class="p">{</span>
        
    <span class="k">var</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">disconnected</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="p">{</span>
                <span class="nf">executeBufferedCommands</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">bufferedCommands</span><span class="p">:</span> <span class="p">[</span><span class="kt">BufferedCommand</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">connected</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">disconnected</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">SendBufferedCommand</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="s">"Send:</span><span class="se">\(</span><span class="n">event</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">RequestBufferedCommand</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="n">callback</span><span class="p">,</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="s">"request:</span><span class="se">\(</span><span class="n">event</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">BufferedCommand</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">connectionCommand</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">executeBufferedCommands</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// First in, first out</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">connectionCommand</span> <span class="k">in</span>
            <span class="n">connectionCommand</span><span class="o">.</span><span class="nf">execute</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">removeAllBufferedCommands</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">SIOManager</span><span class="p">()</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"send_event_1"</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"send_event_2"</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="s">"request_event_1"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="c1">//</span>
<span class="p">}</span>
<span class="n">manager</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">connected</span>
</pre></table></code></div></div><p>åŒç†ä¹Ÿå¯ä»¥å®ç°åˆ° <code class="language-plaintext highlighter-rouge">onEvent</code> ä¸Šã€‚</p><p>å»¶ä¼¸ï¼šå¯ä»¥å†å¥—ç”¨ <a href="https://refactoring.guru/design-patterns/proxy" target="_blank">Proxy Pattern</a> ï¼Œå°† Buffer åŠŸèƒ½è§†ä¸ºä¸€ç§ Proxyã€‚</p><h3 id="éœ€æ±‚åœºæ™¯-3"><span class="me-2">éœ€æ±‚åœºæ™¯ 3.</span><a href="#éœ€æ±‚åœºæ™¯-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what-2"><span class="me-2">What?</span><a href="#what-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Connection æœ‰å¤šä¸ªçŠ¶æ€ï¼Œæœ‰åºçš„çŠ¶æ€ä¸çŠ¶æ€é—´åˆ‡æ¢ã€å„çŠ¶æ€å…è®¸ä¸åŒçš„æ“ä½œã€‚</p><p><a href="/assets/78507a8de6a5/1*DBl6K1cPQc_cHOYXZ1VQ8A.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*DBl6K1cPQc_cHOYXZ1VQ8A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OTMiIGhlaWdodD0iMzE0Ij48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p><a href="/assets/78507a8de6a5/1*-Xk_TT6SMW5Jxd-c8iSCcw.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*-Xk_TT6SMW5Jxd-c8iSCcw.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTAiIGhlaWdodD0iMTMyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><ul><li><p>Createdï¼šç‰©ä»¶è¢«å»ºç«‹ï¼Œå…è®¸ -&gt; <code class="language-plaintext highlighter-rouge">Connected</code> æˆ–ç›´æ¥è¿› <code class="language-plaintext highlighter-rouge">Disconnected</code></p><li><p>Connectedï¼šå·²è¿ä¸Š Socket.IOï¼Œå…è®¸ -&gt; <code class="language-plaintext highlighter-rouge">Disconnected</code></p><li><p>Disconnectedï¼šå·²ä¸ Socket.IO æ–­çº¿ï¼Œå…è®¸ -&gt; <code class="language-plaintext highlighter-rouge">Reconnectiong</code> ã€ <code class="language-plaintext highlighter-rouge">Released</code></p><li><p>Reconnectiongï¼šæ­£åœ¨å°è¯•é‡æ–°è¿ä¸Š Socket.IOï¼Œå…è®¸ -&gt; <code class="language-plaintext highlighter-rouge">Connected</code> ã€ <code class="language-plaintext highlighter-rouge">Disconnected</code></p><li><p>Releasedï¼šç‰©ä»¶å·²è¢«æ ‡ç¤ºä¸ºç­‰å¾…è¢«è®°å¿†ä½“å›æ”¶ï¼Œä¸å…è®¸ä»»ä½•æ“ä½œåŠåˆ‡æ¢çŠ¶æ€</p></ul><h4 id="why-2"><span class="me-2">Why?</span><a href="#why-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>çŠ¶æ€ä¸çŠ¶æ€çš„åˆ‡æ¢é€»è¾‘è·Ÿè¡¨è¿°ä¸å®¹æ˜“</p><li><p>å„çŠ¶æ€è¦é™åˆ¶æ“ä½œæ–¹æ³•(e.g. State = Released æ—¶æ— æ³• Call Send Event)ï¼Œç›´æ¥ä½¿ç”¨ if. .else ä¼šè®©ç¨‹å¼éš¾ä»¥ç»´æŠ¤é˜…è¯»</p></ul><h4 id="how-2"><span class="me-2">How?</span><a href="#how-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p><a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank">Finite State Machine</a> ï¼šç®¡ç†çŠ¶æ€é—´çš„åˆ‡æ¢</p><li><p><a href="https://refactoring.guru/design-patterns/state" target="_blank">State Pattern</a> ï¼šè¡Œä¸ºå‹ Patternï¼Œå¯¹è±¡çš„çŠ¶æ€æœ‰å˜åŒ–æ—¶ï¼Œæœ‰ä¸åŒçš„ç›¸åº”å¤„ç†</p></ul><p><a href="/assets/78507a8de6a5/1*NgehABZTiXL_fFEYQh63Hg.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*NgehABZTiXL_fFEYQh63Hg.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAwIiBoZWlnaHQ9IjYyMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><p><strong>Finite State Machine</strong> ï¼š <code class="language-plaintext highlighter-rouge">SIOConnectionStateMachine</code> ä¸ºçŠ¶æ€æœºå®ä½œï¼Œ <code class="language-plaintext highlighter-rouge">currentSIOConnectionState</code> ä¸ºå½“å‰çŠ¶æ€ï¼Œ <code class="language-plaintext highlighter-rouge">createdã€connectedã€disconnectedã€reconnectingã€released</code> è¡¨åˆ—å‡ºæ­¤çŠ¶æ€æœºå¯èƒ½çš„åˆ‡æ¢çŠ¶æ€ã€‚ <code class="language-plaintext highlighter-rouge">enterXXXState() throws</code> ä¸ºä» Current State è¿›å…¥æŸä¸ªçŠ¶æ€æ—¶çš„å…è®¸ä¸ä¸å…è®¸(throw error)å®ä½œã€‚</p><li><p><strong>State Pattern</strong> ï¼š <code class="language-plaintext highlighter-rouge">SIOConnectionState</code> ä¸ºæ‰€æœ‰çŠ¶æ€ä¼šç”¨åˆ°çš„æ“ä½œæ–¹æ³•ä»‹é¢æŠ½è±¡ã€‚</p></ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
</pre><td class="rouge-code"><pre><span class="kd">protocol</span> <span class="kt">SIOManagerSpec</span><span class="p">:</span> <span class="kt">AnyObject</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">ConnectionState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">created</span>
    <span class="k">case</span> <span class="n">connected</span>
    <span class="k">case</span> <span class="n">disconnected</span>
    <span class="k">case</span> <span class="n">reconnecting</span>
    <span class="k">case</span> <span class="n">released</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span> <span class="p">{</span>
        
    <span class="k">var</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">disconnected</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="p">{</span>
                <span class="nf">executeBufferedCommands</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">bufferedCommands</span><span class="p">:</span> <span class="p">[</span><span class="kt">BufferedCommand</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">connected</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">disconnected</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">SendBufferedCommand</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="s">"Send:</span><span class="se">\(</span><span class="n">event</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">RequestBufferedCommand</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="n">callback</span><span class="p">,</span> <span class="nv">sioManager</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="s">"request:</span><span class="se">\(</span><span class="n">event</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">appendBufferedCommands</span><span class="p">(</span><span class="nv">connectionCommand</span><span class="p">:</span> <span class="kt">BufferedCommand</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">connectionCommand</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">executeBufferedCommands</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// First in, first out</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">connectionCommand</span> <span class="k">in</span>
            <span class="n">connectionCommand</span><span class="o">.</span><span class="nf">execute</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">removeAllBufferedCommands</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">bufferedCommands</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">SIOManager</span><span class="p">()</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"send_event_1"</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"send_event_2"</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="s">"request_event_1"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="c1">//</span>
<span class="p">}</span>
<span class="n">manager</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">connected</span>

<span class="c1">//</span>

<span class="kd">class</span> <span class="kt">SIOConnectionStateMachine</span> <span class="p">{</span>
    
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">currentSIOConnectionState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">created</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">connected</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">disconnected</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">reconnecting</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">released</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="o">!</span>
    
    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="kt">SIOConnectionCreatedState</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kt">SIOConnectionConnectedState</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">disconnected</span> <span class="o">=</span> <span class="kt">SIOConnectionDisconnectedState</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">reconnecting</span> <span class="o">=</span> <span class="kt">SIOConnectionReconnectingState</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">released</span> <span class="o">=</span> <span class="kt">SIOConnectionReleasedState</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        
        <span class="k">self</span><span class="o">.</span><span class="n">currentSIOConnectionState</span> <span class="o">=</span> <span class="n">created</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">enterConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">created</span><span class="o">.</span><span class="n">connectionState</span><span class="p">,</span> <span class="n">reconnecting</span><span class="o">.</span><span class="n">connectionState</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">enter</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="se">)</span><span class="s"> can't enter to Connected"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">enterDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">created</span><span class="o">.</span><span class="n">connectionState</span><span class="p">,</span> <span class="n">connected</span><span class="o">.</span><span class="n">connectionState</span><span class="p">,</span> <span class="n">reconnecting</span><span class="o">.</span><span class="n">connectionState</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">enter</span><span class="p">(</span><span class="n">disconnected</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="se">)</span><span class="s"> can't enter to Disconnected"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">enterReconnecting</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">disconnected</span><span class="o">.</span><span class="n">connectionState</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">enter</span><span class="p">(</span><span class="n">reconnecting</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="se">)</span><span class="s"> can't enter to Reconnecting"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">enterReleased</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">disconnected</span><span class="o">.</span><span class="n">connectionState</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">enter</span><span class="p">(</span><span class="n">released</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="n">connectionState</span><span class="se">)</span><span class="s"> can't enter to Released"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">enter</span><span class="p">(</span><span class="n">_</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">SIOConnectionState</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentSIOConnectionState</span> <span class="o">=</span> <span class="n">state</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">protocol</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span>

    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span>
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span>
    
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span>
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span>
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span>

    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">localizedDescription</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionCreatedState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">created</span>
    <span class="k">let</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">stateMachine</span> <span class="o">=</span> <span class="n">stateMachine</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterConnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterDisconnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ConnectedState can't release!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"CreatedState can't disconnect!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionConnectedState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">connected</span>
    <span class="k">let</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">stateMachine</span> <span class="o">=</span> <span class="n">stateMachine</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterDisconnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ConnectedState can't release!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ConnectedState can't connect!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionDisconnectedState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">disconnected</span>
    <span class="k">let</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">stateMachine</span> <span class="o">=</span> <span class="n">stateMachine</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterConnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterReleased</span><span class="p">()</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterReconnecting</span><span class="p">()</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionReconnectingState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">reconnecting</span>
    <span class="k">let</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">stateMachine</span> <span class="o">=</span> <span class="n">stateMachine</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterConnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="nf">enterDisconnected</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReconnectState can't release!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReconnectState can't connect!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// allow</span>
        <span class="c1">// can use Helper to reduce the repeating code</span>
        <span class="c1">// e.g. helper.XXX(socketManager: SIOManagerSpec, ....)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionReleasedState</span><span class="p">:</span> <span class="kt">SIOConnectionState</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">released</span>
    <span class="k">let</span> <span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">stateMachine</span><span class="p">:</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">stateMachine</span> <span class="o">=</span> <span class="n">stateMachine</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onConnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't onConnected!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onDisconnected</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't onDisconnected!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't release!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't request!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Data</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't receiveOn!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't send!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't connect!"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="kt">SIOManagerSpec</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">SIOConnectionStateMachineError</span><span class="p">(</span><span class="s">"ReleasedState can't disconnect!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">stateMachine</span> <span class="o">=</span> <span class="kt">SIOConnectionStateMachine</span><span class="p">()</span>
    <span class="c1">// mock on socket.io connect:</span>
    <span class="c1">// socketIO.on(connect){</span>
    <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="nf">onConnected</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="n">manager</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="s">"test"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="nf">release</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="n">manager</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">stateMachine</span><span class="o">.</span><span class="n">currentSIOConnectionState</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">socketManager</span><span class="p">:</span> <span class="n">manager</span><span class="p">,</span> <span class="nv">event</span><span class="p">:</span> <span class="s">"test"</span><span class="p">)</span>
    <span class="c1">// }</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// output:</span>
<span class="c1">// error: SIOConnectionStateMachineError(message: "ConnectedState can\'t release!")</span>
</pre></table></code></div></div><h3 id="éœ€æ±‚åœºæ™¯-3-1"><span class="me-2">éœ€æ±‚åœºæ™¯ 3.</span><a href="#éœ€æ±‚åœºæ™¯-3-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what-3"><span class="me-2">What?</span><a href="#what-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>ç»“åˆåœºæ™¯ 1. 2.ï¼Œæœ‰äº† <code class="language-plaintext highlighter-rouge">ConnectionPool</code> äº«å…ƒæ± å­åŠ ä¸Š State Pattern çŠ¶æ€ç®¡ç†åï¼›æˆ‘ä»¬ç»§ç»­å¾€ä¸‹å»¶ä¼¸ï¼Œå¦‚èƒŒæ™¯ç›®æ ‡æ‰€è¿°ï¼ŒFeature ç«¯ä¸éœ€å»ç®¡èƒŒå Connection çš„è¿çº¿æœºåˆ¶ï¼›å› æ­¤æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªè½®è¯¢å™¨ (å‘½åä¸º <code class="language-plaintext highlighter-rouge">ConnectionKeeper</code> ) ä¼šå®šæ—¶æ‰«æ <code class="language-plaintext highlighter-rouge">ConnectionPool</code> ä¸­å¼ºæŒæœ‰çš„ <code class="language-plaintext highlighter-rouge">Connection</code> ï¼Œå¹¶åœ¨å‘ç”Ÿä»¥ä¸‹çŠ¶å†µæ—¶åšæ“ä½œï¼š</p><ul><li><p><code class="language-plaintext highlighter-rouge">Connection</code> æœ‰äººåœ¨ä½¿ç”¨ä¸”çŠ¶æ€é <code class="language-plaintext highlighter-rouge">Connected</code> ï¼šå°†çŠ¶æ€æ”¹ä¸º <code class="language-plaintext highlighter-rouge">Reconnecting</code> å¹¶å°è¯•é‡æ–°è¿çº¿</p><li><p><code class="language-plaintext highlighter-rouge">Connection</code> å·²æ— äººä½¿ç”¨ä¸”çŠ¶æ€ä¸º <code class="language-plaintext highlighter-rouge">Connected</code> ï¼šå°†çŠ¶æ€æ”¹ä¸º <code class="language-plaintext highlighter-rouge">Disconnected</code></p><li><p><code class="language-plaintext highlighter-rouge">Connection</code> å·²æ— äººä½¿ç”¨ä¸”çŠ¶æ€ä¸º <code class="language-plaintext highlighter-rouge">Disconnected</code> ï¼šå°†çŠ¶æ€æ”¹ä¸º <code class="language-plaintext highlighter-rouge">Released</code> å¹¶ä» <code class="language-plaintext highlighter-rouge">ConnectionPool</code> ä¸­ç§»é™¤</p></ul><h4 id="why-3"><span class="me-2">Why?</span><a href="#why-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>ä¸‰ä¸ªæ“ä½œæœ‰ä¸Šä¸‹å…³ç³»ä¸”äº’æ–¥ (disconnected -&gt; released or reconnecting)</p><li><p>å¯å¼¹æ€§æŠ½æ¢ã€å¢åŠ çŠ¶å†µæ“ä½œ</p><li><p>æœªå°è£…çš„è¯åªèƒ½å°†ä¸‰ä¸ªåˆ¤æ–­åŠæ“ä½œç›´æ¥å†™åœ¨æ–¹æ³•ä¸­ (éš¾ä»¥æµ‹è¯•å…¶ä¸­é€»è¾‘)</p><li><p>e.g:</p></ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="o">!</span><span class="n">connection</span><span class="o">.</span><span class="nf">isOccupie</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">connection</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="n">then</span>
<span class="o">...</span> <span class="n">connection</span><span class="o">.</span><span class="nf">disconnected</span><span class="p">()</span>
<span class="k">else</span> <span class="k">if</span> <span class="o">!</span><span class="n">connection</span><span class="o">.</span><span class="nf">isOccupie</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">released</span> <span class="n">then</span>
<span class="o">...</span> <span class="n">connection</span><span class="o">.</span><span class="nf">release</span><span class="p">()</span>
<span class="k">else</span> <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="nf">isOccupie</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">disconnected</span> <span class="n">then</span>
<span class="o">...</span> <span class="n">connection</span><span class="o">.</span><span class="nf">reconnecting</span><span class="p">()</span>
<span class="n">end</span>
</pre></table></code></div></div><h4 id="how-3"><span class="me-2">How?</span><a href="#how-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://refactoring.guru/design-patterns/chain-of-responsibility" target="_blank">Chain Of Resposibility</a> ï¼šè¡Œä¸ºå‹ Patternï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€æ¡é“¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ç›¸åº”çš„æ“ä½œï¼Œè¾“å…¥èµ„æ–™åèŠ‚ç‚¹å¯å†³å®šæ˜¯å¦è¦æ“ä½œè¿˜æ˜¯ä¸¢ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†ï¼Œå¦ä¸€ä¸ªç°å®åº”ç”¨æ˜¯ <a href="https://swiftrocks.com/understanding-the-ios-responder-chain" target="_blank">iOS Responder Chain</a> ã€‚</ul><blockquote><p><em>ç…§å®šä¹‰ Chain of responsibility Pattern æ˜¯ä¸å…è®¸æŸä¸ªèŠ‚ç‚¹å·²ç»æ¥ä¸‹å¤„ç†èµ„æ–™ï¼Œä½†å¤„ç†å®Œåˆä¸¢ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­å¤„ç†ï¼Œ <strong>è¦åšå°±åšå®Œï¼Œä¸ç„¶ä¸è¦åš</strong> ã€‚</em></p></blockquote><blockquote><p><em>å¦‚æœæ˜¯ä¸Šè¿°åœºæ™¯æ¯”è¾ƒé€‚åˆçš„åº”è¯¥æ˜¯ <a href="https://stackoverflow.com/questions/7951306/chain-of-responsibility-vs-interceptor" target="_blank">Interceptor Pattern</a> ã€‚</em></p></blockquote><p><a href="/assets/78507a8de6a5/1*e8jHpykN1m3Y66Ukf-5OJA.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*e8jHpykN1m3Y66Ukf-5OJA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjM5MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><strong>Chain of responsibilityï¼š</strong> <code class="language-plaintext highlighter-rouge">ConnectionKeeperHandler</code> ä¸ºç‚¼çš„èŠ‚ç‚¹æŠ½è±¡ï¼Œç‰¹åˆ«æŠ½å‡º <code class="language-plaintext highlighter-rouge">canExcute</code> æ–¹æ³•é¿å…å‘ç”Ÿä¸Šè¿° è¿™ä¸ªèŠ‚ç‚¹æ¥ä¸‹æ¥å¤„ç†äº†ï¼Œä½†åšå®Œåˆæƒ³å‘¼å«åé¢çš„èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œçš„çŠ¶å†µã€ <code class="language-plaintext highlighter-rouge">handle</code> ä¸ºç‚¼çš„èŠ‚ç‚¹ä¸²è¿ã€ <code class="language-plaintext highlighter-rouge">excute</code> ä¸ºè¦å¤„ç†çš„è¯ä¼šæ€ä¹ˆå¤„ç†çš„é€»è¾‘ã€‚ <code class="language-plaintext highlighter-rouge">ConnectionKeeperHandlerContext</code> ç”¨æ¥å­˜æ”¾ä¼šç”¨åˆ°çš„èµ„æ–™ï¼Œ <code class="language-plaintext highlighter-rouge">isOccupie</code> ä»£è¡¨ Connection æœ‰æ— äººåœ¨ä½¿ç”¨ã€‚</ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">ConnectionState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">created</span>
    <span class="k">case</span> <span class="n">connected</span>
    <span class="k">case</span> <span class="n">disconnected</span>
    <span class="k">case</span> <span class="n">reconnecting</span>
    <span class="k">case</span> <span class="n">released</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">reconnect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="c1">// Socket.IO Implementation</span>
<span class="kd">class</span> <span class="kt">SIOConnection</span><span class="p">:</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">created</span>
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">reconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
        <span class="k">return</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//</span>

<span class="kd">struct</span> <span class="kt">ConnectionKeeperHandlerContext</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">connection</span><span class="p">:</span> <span class="kt">Connection</span>
    <span class="k">let</span> <span class="nv">isOccupie</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ConnectionKeeperHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span><span class="p">?</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">canExcute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ConnectionKeeperHandler</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nf">canExcute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">execute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">nextHandler</span><span class="p">?</span><span class="o">.</span><span class="nf">handle</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">DisconnectedConnectionKeeperHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">canExcute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connectionState</span> <span class="o">==</span> <span class="o">.</span><span class="n">connected</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">context</span><span class="o">.</span><span class="n">isOccupie</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ReconnectConnectionKeeperHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="nf">reconnect</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">canExcute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connectionState</span> <span class="o">==</span> <span class="o">.</span><span class="n">disconnected</span> <span class="o">&amp;&amp;</span> <span class="n">context</span><span class="o">.</span><span class="n">isOccupie</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ReleasedConnectionKeeperHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">nextHandler</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandler</span><span class="p">?</span>
    
    <span class="kd">func</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">canExcute</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connectionState</span> <span class="o">==</span> <span class="o">.</span><span class="n">disconnected</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">context</span><span class="o">.</span><span class="n">isOccupie</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">SIOConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">disconnectedHandler</span> <span class="o">=</span> <span class="kt">DisconnectedConnectionKeeperHandler</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">reconnectHandler</span> <span class="o">=</span> <span class="kt">ReconnectConnectionKeeperHandler</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">releasedHandler</span> <span class="o">=</span> <span class="kt">ReleasedConnectionKeeperHandler</span><span class="p">()</span>
<span class="n">disconnectedHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">reconnectHandler</span>
<span class="n">reconnectHandler</span><span class="o">.</span><span class="n">nextHandler</span> <span class="o">=</span> <span class="n">releasedHandler</span>

<span class="n">disconnectedHandler</span><span class="o">.</span><span class="nf">handle</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">ConnectionKeeperHandlerContext</span><span class="p">(</span><span class="nv">connection</span><span class="p">:</span> <span class="n">connection</span><span class="p">,</span> <span class="nv">isOccupie</span><span class="p">:</span> <span class="kc">false</span><span class="p">))</span>
</pre></table></code></div></div><h3 id="éœ€æ±‚åœºæ™¯-4"><span class="me-2">éœ€æ±‚åœºæ™¯ 4.</span><a href="#éœ€æ±‚åœºæ™¯-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what-4"><span class="me-2">What?</span><a href="#what-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>æˆ‘ä»¬å°è£…å‡ºçš„ <code class="language-plaintext highlighter-rouge">Connection</code> éœ€è¦ç»è¿‡ setup åæ‰èƒ½ä½¿ç”¨ï¼Œä¾‹å¦‚ç»™äºˆ URL Pathã€è®¾å®š Configâ€¦ç­‰ç­‰</p><h4 id="why-4"><span class="me-2">Why?</span><a href="#why-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>å¯ä»¥å¼¹æ€§çš„å¢å‡æ„å»ºå¼€å£</p><li><p>å¯å¤ç”¨æ„å»ºé€»è¾‘</p><li><p>æœªå°è£…çš„è¯ï¼Œå¤–éƒ¨å¯ä»¥ä¸ç…§é¢„æœŸæ“ä½œç±»åˆ«</p><li><p>e.g.:</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>âŒ
let connection = Connection()
connection.send(event) // unexpected method call, should call .connect() first
âœ…
let connection = Connection()
connection.connect()
connection.send(event)
// but...who knows???
</pre></table></code></div></div><h4 id="how-4"><span class="me-2">How?</span><a href="#how-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><a href="https://refactoring.guru/design-patterns/builder" target="_blank">Builder Pattern</a> ï¼šåˆ›å»ºå‹ Patternï¼Œèƒ½å¤Ÿåˆ†æ­¥éª¤æ„å»ºå¯¹è±¡åŠå¤ç”¨æ„å»ºæ–¹æ³•ã€‚</ul><p><a href="/assets/78507a8de6a5/1*J5eKaks1-fT6u8FojeUkUQ.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*J5eKaks1-fT6u8FojeUkUQ.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjE0IiBoZWlnaHQ9IjQ3OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><ul><li><strong>Builder Patternï¼š</strong> <code class="language-plaintext highlighter-rouge">SIOConnectionBuilder</code> ä¸º <code class="language-plaintext highlighter-rouge">Connection</code> çš„æ„å»ºå™¨ï¼Œè´Ÿè´£è®¾å®šã€å­˜æ”¾æ„å»º <code class="language-plaintext highlighter-rouge">Connection</code> æ—¶ä¼šç”¨åˆ°çš„èµ„æ–™ï¼› <code class="language-plaintext highlighter-rouge">ConnectionConfiguration</code> æŠ½è±¡ä»‹é¢ç”¨æ¥ä¿è¯è¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Connection</code> å‰å¿…é¡»å‘¼å« <code class="language-plaintext highlighter-rouge">.connect()</code> æ‰èƒ½æ‹¿åˆ° <code class="language-plaintext highlighter-rouge">Connection</code> å®ä½“ã€‚</ul><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="kt">ConnectionState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">created</span>
    <span class="k">case</span> <span class="n">connected</span>
    <span class="k">case</span> <span class="n">disconnected</span>
    <span class="k">case</span> <span class="n">reconnecting</span>
    <span class="k">case</span> <span class="n">released</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">reconnect</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="c1">// Socket.IO Implementation</span>
<span class="kd">class</span> <span class="kt">SIOConnection</span><span class="p">:</span> <span class="kt">Connection</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">connectionState</span><span class="p">:</span> <span class="kt">ConnectionState</span> <span class="o">=</span> <span class="o">.</span><span class="n">created</span>
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">reconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">onEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
        <span class="k">return</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="kd">class</span> <span class="kt">SIOConnectionClient</span><span class="p">:</span> <span class="kt">ConnectionConfiguration</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">config</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">config</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Connection</span> <span class="p">{</span>
        <span class="c1">// set config</span>
        <span class="k">return</span> <span class="kt">SIOConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ConnectionConfiguration</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Connection</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SIOConnectionBuilder</span> <span class="p">{</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">config</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    
    <span class="kd">func</span> <span class="nf">setConfig</span><span class="p">(</span><span class="n">_</span> <span class="nv">config</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">SIOConnectionBuilder</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">return</span> <span class="k">self</span>
    <span class="p">}</span>
    
    <span class="c1">// url is required parameter</span>
    <span class="kd">func</span> <span class="nf">build</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ConnectionConfiguration</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">SIOConnectionClient</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">config</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">builder</span> <span class="o">=</span> <span class="kt">SIOConnectionBuilder</span><span class="p">()</span><span class="o">.</span><span class="nf">setConfig</span><span class="p">([</span><span class="s">"test"</span><span class="p">:</span><span class="mi">123</span><span class="p">])</span>


<span class="k">let</span> <span class="nv">connection1</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="nf">build</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com/1"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">connection2</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="nf">build</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://pinkoi.com/1"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span>
</pre></table></code></div></div><p>å»¶ä¼¸ï¼šè¿™é‡Œä¹Ÿå¯ä»¥å†å¥—ç”¨ <a href="https://refactoring.guru/design-patterns/factory-method" target="_blank">Factory Pattern</a> ï¼Œå°†ç”¨å·¥å‚äº§å‡º <code class="language-plaintext highlighter-rouge">SIOConnection</code> ã€‚</p><h3 id="å®Œç»“"><span class="me-2">å®Œç»“!</span><a href="#å®Œç»“" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡å°è£… Socket.IO ä¸­é‡åˆ°çš„å››ä¸ªåœºæ™¯åŠä¸ƒä¸ªä½¿ç”¨åˆ°è§£å†³é—®é¢˜çš„ Design Patternsã€‚</p><h4 id="æœ€åé™„ä¸Šæ­¤æ¬¡å°è£…-socketio-çš„å®Œæ•´è®¾è®¡è“å›¾"><span class="me-2">æœ€åé™„ä¸Šæ­¤æ¬¡å°è£… Socket.IO çš„å®Œæ•´è®¾è®¡è“å›¾</span><a href="#æœ€åé™„ä¸Šæ­¤æ¬¡å°è£…-socketio-çš„å®Œæ•´è®¾è®¡è“å›¾" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/78507a8de6a5/1*DMfFpmF7aVCIIM1dskn97w.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*DMfFpmF7aVCIIM1dskn97w.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjU0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iZ3JleSIvPjwvc3ZnPg=="></a></p><p>ä¸æ–‡ä¸­å‘½åã€ç¤ºèŒƒç•¥ä¸ºä¸åŒï¼Œè¿™å¼ å›¾æ‰æ˜¯çœŸå®çš„è®¾è®¡æ¶æ„ï¼›æœ‰æœºä¼šå†è¯·åŸè®¾è®¡è€…åˆ†äº«è®¾è®¡ç†å¿µåŠå¼€æºã€‚</p><h3 id="who"><span class="me-2">Who?</span><a href="#who" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>è°åšäº†è¿™äº›è®¾è®¡è·Ÿè´Ÿè´£ Socket.IO å°è£…ä¸“æ¡ˆå‘¢ï¼Ÿ</p><h4 id="sean-zheng--android-engineer--pinkoi"><span class="me-2"><a href="https://www.linkedin.com/in/%E5%AE%87%E7%BF%94-%E9%84%AD-9b3409175/" target="_blank">Sean Zheng</a> , Android Engineer @ Pinkoi</span><a href="#sean-zheng--android-engineer--pinkoi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/78507a8de6a5/1*Q_35023LtcZbOtnfvSxv-A.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*Q_35023LtcZbOtnfvSxv-A.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>ä¸»è¦æ¶æ„è®¾è®¡è€…ã€Design Pattern è¯„ä¼°å¥—ç”¨ã€åœ¨ Android ç«¯ä½¿ç”¨ Kotlin å®ç°è®¾è®¡ã€‚</p><h4 id="zhgchgli--enginner-leadios-enginner--pinkoi"><span class="me-2"><a href="https://www.linkedin.com/in/zhgchgli/" target="_blank">ZhgChgLi</a> , Enginner Lead/iOS Enginner @ Pinkoi</span><a href="#zhgchgli--enginner-leadios-enginner--pinkoi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="/assets/78507a8de6a5/1*1NCE3Q7fO5Mh15NT2xoYlA.webp" class="popup img-link blur"><img data-src="/assets/78507a8de6a5/1*1NCE3Q7fO5Mh15NT2xoYlA.webp" alt="" data-lqip="true" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJncmV5Ii8+PC9zdmc+"></a></p><p>Platform Team ä¸“æ¡ˆè´Ÿè´£äººã€Pair programmingã€åœ¨ iOS ç«¯ä½¿ç”¨ Swift å®ç°è®¾è®¡ã€è®¨è®ºå¹¶æå‡ºè´¨ç–‘(a.k.a. å‡ºä¸€å¼ å˜´)åŠæœ€åæ’°å†™æœ¬æ–‡ä¸å¤§å®¶åˆ†äº«ã€‚</p><h3 id="å»¶ä¼¸é˜…è¯»"><span class="me-2">å»¶ä¼¸é˜…è¯»</span><a href="#å»¶ä¼¸é˜…è¯»" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>Design Patterns çš„å®æˆ˜åº”ç”¨çºªå½• â€” In WKWebView with Builder, Strategy &amp; Chain of Responsibility Pattern</p><li><p><a href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E5%9C%A8-ios-swift-%E5%88%86%E4%BA%AB%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E5%8A%A1%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96-ba5773a7bfea/">Visitor Pattern in Swift (Share Object to XXX Example)</a></p><li><p><a href="/posts/zrealm-dev/zh-cn/visitor-pattern-%E6%8F%90%E5%8D%87-tableview-%E5%8F%AF%E6%89%A9%E5%85%85%E6%80%A7%E4%B8%8E%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7%E8%AE%BE%E8%AE%A1%E8%8C%83%E4%BE%8B-60473cb47550/">Visitor Pattern in TableView</a></p></ul><p>æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ <a href="https://www.zhgchg.li/contact" target="_blank">ä¸æˆ‘è”ç»œ</a> ã€‚</p><hr /><p><a href="https://www.buymeacoffee.com/zhgchgli" target="_blank" style="display:block !important;" class="img-link shimmer" ><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a beer&amp;emoji=ğŸº&amp;slug=zhgchgli&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Bree&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy me a beer" loading="lazy"></a><br /></p><blockquote class="prompt-info"><p>æœ¬æ–‡é¦–æ¬¡å‘è¡¨äº Medium (<a href="https://medium.com/p/78507a8de6a5" target="_blank"><strong>ç‚¹å‡»æŸ¥çœ‹åŸå§‹ç‰ˆæœ¬</strong></a>)ï¼Œç”± <a href="/posts/tools/medium-to-jekyll/" target="_blank">ZMediumToMarkdown</a> æä¾›è‡ªåŠ¨è½¬æ¢ä¸åŒæ­¥æŠ€æœ¯ã€‚</p></blockquote><blockquote class="prompt-info"><p><a href="https://github.com/ZhgChgLi/zhgchgli.github.io/blob/main/_posts/zh-cn/zmediumtomarkdown/2022-04-07-78507a8de6a5.md" target="_blank">Improve this page on Github.</a></p></blockquote><widgetic id="64ce71d5ecb2a165598b4567" resize="fill-width" height="50" autoscale="on"></widgetic><script async src="https://widgetic.com/sdk/sdk.js"></script><div onclick="this.style.position='';" style="text-align: center; position: -webkit-sticky; position: sticky; bottom: 0; z-index: 1; margin: 0 -1rem; padding: 5px; background: var(--main-bg); transition: all .2s ease-in-out;"><a href="https://medium.com/@zhgchgli" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px 20px;font-size:16px;font-weight:bold;color:#ffffff;background-color:#00ab6c;border-radius:5px;text-decoration:none;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.3s ease;cursor:pointer;" onmouseover="this.style.backgroundColor='#008f5a';this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 10px rgba(0,0,0,0.15)';" onmouseout="this.style.backgroundColor='#00ab6c';this.style.transform='translateY(0)';this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';">Follow Me on Medium <span style="font-size:14px;color:rgba(255,255,255,0.9);font-weight:normal;opacity:0.9;">1K+ Followers</span></a></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/pinkoi-engineering/">Pinkoi Engineering</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/simplified-chinese/" class="post-tag no-text-decoration" >simplified-chinese</a> <a href="/tags/ios-app-development/" class="post-tag no-text-decoration" >ios-app-development</a> <a href="/tags/design-patterns/" class="post-tag no-text-decoration" >design-patterns</a> <a href="/tags/socketio/" class="post-tag no-text-decoration" >socketio</a> <a href="/tags/websocket/" class="post-tag no-text-decoration" >websocket</a> <a href="/tags/finite-state-machine/" class="post-tag no-text-decoration" >finite-state-machine</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Design%20Patterns%20%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%EF%BD%9C%E5%B0%81%E8%A3%85%20Socket.IO%20%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fpinkoi-engineering%2Fzh-cn%2Fdesign-patterns-%25E5%25AE%259E%25E6%2588%2598%25E5%25BA%2594%25E7%2594%25A8-%25E5%25B0%2581%25E8%25A3%2585-socket-io-%25E5%258D%25B3%25E6%2597%25B6%25E9%2580%259A%25E8%25AE%25AF%25E6%259E%25B6%25E6%259E%2584%25E4%25B8%258E%25E4%25B8%2583%25E5%25A4%25A7%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E8%25A7%25A3%25E6%259E%2590-78507a8de6a5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Design%20Patterns%20%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%EF%BD%9C%E5%B0%81%E8%A3%85%20Socket.IO%20%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90%20-%20ZhgChgLi%20(Harry%20Li)&u=https%3A%2F%2Fzhgchg.li%2Fposts%2Fpinkoi-engineering%2Fzh-cn%2Fdesign-patterns-%25E5%25AE%259E%25E6%2588%2598%25E5%25BA%2594%25E7%2594%25A8-%25E5%25B0%2581%25E8%25A3%2585-socket-io-%25E5%258D%25B3%25E6%2597%25B6%25E9%2580%259A%25E8%25AE%25AF%25E6%259E%25B6%25E6%259E%2584%25E4%25B8%258E%25E4%25B8%2583%25E5%25A4%25A7%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E8%25A7%25A3%25E6%259E%2590-78507a8de6a5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzhgchg.li%2Fposts%2Fpinkoi-engineering%2Fzh-cn%2Fdesign-patterns-%25E5%25AE%259E%25E6%2588%2598%25E5%25BA%2594%25E7%2594%25A8-%25E5%25B0%2581%25E8%25A3%2585-socket-io-%25E5%258D%25B3%25E6%2597%25B6%25E9%2580%259A%25E8%25AE%25AF%25E6%259E%25B6%25E6%259E%2584%25E4%25B8%258E%25E4%25B8%2583%25E5%25A4%25A7%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E8%25A7%25A3%25E6%259E%2590-78507a8de6a5%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/en/ios-shortcut-automation-auto-forward-sms-create-reminder-tasks-effortlessly-309d0302877b/">iOS Shortcut Automationï½œAuto-Forward SMS & Create Reminder Tasks Effortlessly</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/zh-cn/ios-%E6%8D%B7%E5%BE%84%E8%87%AA%E5%8A%A8%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E7%AE%80%E8%AE%AF%E4%B8%8E%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E6%95%99%E5%AD%A6-309d0302877b/">iOS æ·å¾„è‡ªåŠ¨åŒ–åº”ç”¨åœºæ™¯â€Šâ€”â€Šè‡ªåŠ¨è½¬å‘ç®€è®¯ä¸è‡ªåŠ¨å»ºç«‹æé†’å¾…åŠäº‹é¡¹</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-robotic-process-automation/ios-%E6%8D%B7%E5%BE%91%E8%87%AA%E5%8B%95%E5%8C%96-3-%E6%8B%9B%E8%87%AA%E5%8B%95%E8%BD%89%E7%99%BC%E7%B0%A1%E8%A8%8A%E8%88%87%E5%BB%BA%E7%AB%8B%E6%8F%90%E9%86%92%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85%E6%95%99%E5%AD%B8-309d0302877b/">iOS æ·å¾‘è‡ªå‹•åŒ–æ‡‰ç”¨å ´æ™¯â€Šâ€”â€Šè‡ªå‹•è½‰ç™¼ç°¡è¨Šèˆ‡è‡ªå‹•å»ºç«‹æé†’å¾…è¾¦äº‹é …</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/en/apple-watch-stainless-steel-milanese-loop-unboxing-premium-44mm-graphite-band-review-c0f99f987d9c/">Apple Watch Stainless Steel Milanese Loop Unboxingï½œPremium 44mm Graphite Band Review</a><li class="text-truncate lh-lg"> <a href="/posts/zrealm-life/zh-cn/apple-watch-%E7%B1%B3%E5%85%B0%E8%A1%A8%E5%B8%A6%E5%BC%80%E7%AE%B1-%E5%8E%9F%E5%8E%82%E4%B8%8D%E9%94%88%E9%92%A2%E7%9F%B3%E5%A2%A8%E8%89%B2%E4%BC%98%E7%BC%BA%E7%82%B9%E5%85%A8%E8%A7%A3%E6%9E%90-c0f99f987d9c/">Apple Watch åŸå‚ä¸é”ˆé’¢ç±³å…°è¡¨å¸¦å¼€ç®±</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">ç« ç¯€ (Chapters)ğŸ”–</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/pinkoi-engineering/design-patterns-%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8-%E5%B0%81%E8%A3%9D-socket-io-%E5%8D%B3%E6%99%82%E9%80%9A%E8%A8%8A%E6%9E%B6%E6%A7%8B%E8%88%87%E4%B8%83%E5%A4%A7%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1649342957" data-df="ll" > Apr 7, 2022 </time><h4 class="pt-0 my-2">Design Patterns çš„å¯¦æˆ°æ‡‰ç”¨ç´€éŒ„</h4><div class="text-muted"><p>å°è£ Socket.IO Client Library éœ€æ±‚æ™‚é‡åˆ°çš„å•é¡Œå ´æ™¯åŠè§£æ±ºæ–¹æ³•æ‡‰ç”¨åˆ°çš„ Design Patterns</p></div></div></a></article><article class="col"> <a href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1649342957" data-df="ll" > Apr 7, 2022 </time><h4 class="pt-0 my-2">Design Patternsï½œPractical Solutions for Socket.IO Client Library Challenges</h4><div class="text-muted"><p>Developers facing Socket.IO Client Library issues can apply proven Design Patterns to encapsulate functionality effectively, resolving integration challenges and improving code maintainability in r...</p></div></div></a></article><article class="col"> <a href="/posts/kkday-tech-blog/zh-cn/wkwebview-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98-builder-strategy-%E4%B8%8E%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7-f4b02ee342a4/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1725601667" data-df="ll" > Sep 6, 2024 </time><h4 class="pt-0 my-2">Design Patterns çš„å®æˆ˜åº”ç”¨çºªå½•â€”In WKWebView with Builder, Strategy & Chain of Responsibility Pattern</h4><div class="text-muted"><p>å°è£… iOS WKWebView æ—¶ä½¿ç”¨åˆ°çš„ Design Patterns åœºæ™¯ (ç­–ç•¥ã€è´£ä»»é“¾ã€å»ºé€ æ¨¡å¼)ã€‚</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/pinkoi-engineering/en/design-patterns-practical-solutions-for-socket-io-client-library-challenges-78507a8de6a5/" class="btn btn-outline-primary" aria-label="Older" ><p>Design Patternsï½œPractical Solutions for Socket.IO Client Library Challenges</p></a> <a href="/posts/pinkoi-engineering/design-patterns-%E5%AF%A6%E6%88%B0%E6%87%89%E7%94%A8-%E5%B0%81%E8%A3%9D-socket-io-%E5%8D%B3%E6%99%82%E9%80%9A%E8%A8%8A%E6%9E%B6%E6%A7%8B%E8%88%87%E4%B8%83%E5%A4%A7%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90-78507a8de6a5/" class="btn btn-outline-primary" aria-label="Newer" ><p>Design Patterns çš„å¯¦æˆ°æ‡‰ç”¨ç´€éŒ„</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://medium.com/@zhgchgli">ZhgChgLi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span> <a href="/">ä¸­æ–‡</a>|<a href="/tags/simplified-chinese">ç®€ä¸­</a>|<a href="/tags/english/">English</a></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>. <br/> Medium articles were converted using <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown.</a> <br/></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ios-app-development/">ios-app-development</a> <a class="post-tag btn btn-outline-primary" href="/tags/english/">english</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai-translation/">ai-translation</a> <a class="post-tag btn btn-outline-primary" href="/tags/simplified-chinese/">simplified-chinese</a> <a class="post-tag btn btn-outline-primary" href="/tags/ios/">ios</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a> <a class="post-tag btn btn-outline-primary" href="/tags/medium/">medium</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/google-apps-script/">google-apps-script</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ZhgChgLi/zhgchgli.github.io', 'data-repo-id': 'R_kgDOHdowLw', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHdowL84CU-q6', 'data-mapping': 'url', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
