---
author: ZhgChgLi
categories:
- ZRealm Robotic Process Automation
date: 2025-03-20T14:12:48.523+0000
description: Google Apps Scriptを活用し、Firebase App Distribution APIとの連携で開発効率を大幅向上。API統合の課題を解決し、スムーズなアプリ配布を実現する具体的手法を解説。
image:
  path: /assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png
last_modified_at: 2025-07-10T13:00:24.208+0000
render_with_liquid: false
tags:
- iosアプリ開発
- firebaseアプリ配布
- google-apps-script
- google-api
- google-cloud-platform
- japanese
- ai-translation
title: Google Apps Script：Firebase App Distribution APIとの高速連携方法｜効率的なGoogle APIs統合
---

### Google Apps Script x Google APIs 迅速な連携方法

Google Apps Script と Firebase App Distribution API の連携例として

### 背景

以前、Google Apps Script を使った記事をいくつか書きました。その中で「[Google Apps Script を使って毎日のデータレポートを RPA 自動化する方法](../f6713ba3fee3/)」や「[簡単3ステップ — 無料で GA4 自動データ通知ロボットを作る](../1e85b8df2348/)」では、Google Apps Script を使って Google Analytics と Google Sheet、Web App、Slack、Telegram を連携し、視覚化データプラットフォームや通知サービスを素早く構築する方法を紹介しました。また、先月公開した記事「[Google Apps Script Web App フォームで Github Action CI/CD ワークを連携する](../4cb4437818f2/)」では、Google Apps Script Web App を使って Github API と連携し、CI/CD の GUI フォームサービスを実現しています。これらはすべて Google Apps Script の内蔵サービスを使った連携や、Slack や Github などの外部サービスとの直接連携であり、Google APIs を使った連携はありませんでした。

> *今回、CI/CDのGUIフォームを最適化する際に、内測版をパッケージ化した後にWebアプリ上でFirebase Distributionのダウンロードリンクを直接表示したいと考えました。これを実現するにはGoogle APIsの連携が必要です。*

#### Google Apps Script x [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"}

![](/assets/71400d408dc8/1*O6JWKIIS5oxyrOS3q9NXRQ.png)

上図のように、従来の Google Analytics の内蔵サービス「AnalyticsData」とは異なり、Firebase App Distribution は内蔵の接続サービスを提供していないため、進階的な方法で接続する必要があります。

> *もともとは Service Account を使って Access Token の生成や交換を自分で行う必要があると思っていた（少し面倒で、以前の[評価ロボットのオープンソースプロジェクト](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"}を参照）が、**実はそれほど面倒ではない。***

### Google Apps Script x Google APIs 高度なサービス連携

#### 接続設定

**参考 [公式ドキュメントの説明](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#requirements){:target="_blank"} に従い、以下の手順で詳細設定を行う必要があります。**

1. コマンドスクリプトプロジェクトで [高度なサービスを有効化](https://developers.google.com/apps-script/guides/services/advanced?hl=zh-tw#enable_advanced_services){:target="_blank"} する必要があります。

2. スクリプトで使用している [Cloud Platform (GCP) プロジェクト](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw){:target="_blank"} に、対応する高度なサービスの API が有効になっていることを確認してください。

3. もしスクリプトプロジェクトが2019年4月8日以降に作成された[デフォルトGCPプロジェクト](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#default_cloud_platform_projects){:target="_blank"}を使用している場合、詳細サービスを有効化してスクリプトプロジェクトを保存すると、APIは自動的に有効になります。まだ同意していない場合は、システムから[Google Cloud](https://cloud.google.com/terms/?hl=zh-tw){:target="_blank"}および[Google API](https://developers.google.com/terms?hl=zh-tw){:target="_blank"}の利用規約への同意を求められることがあります。

4. もしスクリプトプロジェクトが[標準 GCP プロジェクト](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#standard_cloud_platform_projects){:target="_blank"} または古いデフォルトの GCP プロジェクトを使用している場合、GCP プロジェクト内で[対応する API を有効化](https://developers.google.com/apps-script/guides/cloud-platform-projects?hl=zh-tw#enabling_an_api_in_a_standard_gcp_project){:target="_blank"}する必要があります。この変更を行うには、GCP プロジェクトの編集権限が必要です。

#### 1. プロジェクト設定 — 関連する Google Cloud Platform (GCP) プロジェクトの設定

Google Apps Script x Google APIs の高度なサービス連携では、GCP プロジェクトを作成し、Google Apps Script に関連付ける必要があります。Google APIs の使用権限は GCP の設定に基づきます。

したがって、GCP プロジェクト（Firebase の GCP プロジェクトでも可）を作成し、情報ページの「`プロジェクト番号`」を控え、この GCP プロジェクトで使用したい Google APIs が有効になっていること、そして現在ログインしているアカウントまたは使用するアカウントがその GCP プロジェクトと Google APIs の権限を持っていることを確認してください。

![](/assets/71400d408dc8/1*-BlhyGAEtkcDRrZ86H2BHg.png)

![](/assets/71400d408dc8/1*fycqt1HNNO9qiu6RZ-WMlw.png)

> ***本記事では「 [Firebase App Distribution API](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} 」を例にしています。***

![](/assets/71400d408dc8/1*T13M_lq7z-ui0_cLZtuHXg.png)

`プロジェクト番号` を Google Apps Script プロジェクト設定の下にある Google Cloud Platform プロジェクト番号欄に入力すると、現在ログインしているアカウントにその GCP プロジェクトの権限があれば、自動的に紐付けが成功します。

#### 2. プロジェクト設定 — エディタで「appsscript.json」マニフェストファイルを表示する

![](/assets/71400d408dc8/1*YnhdxRSyr_CYB2CFnO_31Q.png)

有効化後、エディタに戻るとファイルリストに「`appsscript.json`」設定ファイルが表示されます：

![](/assets/71400d408dc8/1*r8bheyYWj-TX7vFIum2GIQ.png)

oauthScopes に以下の2つの記述が含まれていることを確認してください：

```json
  "oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```

もし保存されていなければ、手動で貼り付けてください。

#### 3. 接続コードの作成

GCP プロジェクトを設定したら、すぐに連携コードの作成を開始できます。連携したい Google APIs の公式ドキュメントを直接参照してください。 [Firebase App Distribution API v1](https://firebase.google.com/docs/reference/app-distribution/rest/){:target="_blank"} ：

![](/assets/71400d408dc8/1*N0Zg4TEZQwTTLGCsaTdx8A.png)

```javascript
const project = "projects/[Firebase Project ID]/apps/[Firebase APP ID]"; // あなたの Project ID と App ID に置き換えてください

function debug() {
  const releases = firebaseDistribution("");

  releases.forEach(function(release) {
    // Release オブジェクト: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases?hl=zh-tw#Release
    Logger.log(`${release.name} ダウンロード URL: ${release.testingUri}`);
  });
}

function firebaseDistribution(releaseNote) {
  const url = "https://firebaseappdistribution.googleapis.com/v1/"+project+"/releases?filter=releaseNotes.text%3D*"+releaseNote+"*";
  // フィルター: https://firebase.google.com/docs/reference/app-distribution/rest/v1/projects.apps.releases/list?hl=zh-tw
  const headers = {
    "Content-Type": "application/json; charset=UTF-8",
    "Authorization": "Bearer " + ScriptApp.getOAuthToken(), // 現在のアカウントのトークンを直接使用
  };
  
  const options = {
    "method": "get",
    "headers": headers
  };
  const data = UrlFetchApp.fetch(url, options);
  const result = JSON.parse(data.getContentText()).releases;
  
  if (result == undefined) {
    return [];
  }

  return result;
}
```

`[Firebase Project ID]` **と `[Firebase APP ID]` は Firebase プロジェクトの設定から取得できます：**

![](/assets/71400d408dc8/1*oql_FnmO7_ct8S3cOhP8lg.png)

コードを貼り付けた後、初回実行時に権限の承認が必要です。

![](/assets/71400d408dc8/1*sW3ZjQA3dKS8HhAOCDsmBA.png)

![](/assets/71400d408dc8/0*p-Zl0cob4mPrsNO6.png)

- 「権限を確認」をクリックしてください

- 実行するアカウントを選択します。通常は現在の Google Apps Script アカウントと同じです。

![](/assets/71400d408dc8/0*m7enb51ZiNlWYeoT.png)

![](/assets/71400d408dc8/0*SN-0owiePlKXIxLk.png)

- 「詳細設定」を展開 -> 「XXX に移動」をクリック  
  これは自分たちで使うアプリケーションなので、Google の認証は不要です。

- 「許可する」をクリックしてください

> *上記の画面は必ず表示されるわけではなく、表示されなくても問題ありません。*

**許可した後、「デバッグ」または「実行」をクリックするとプログラムを実行できます：**

エラーが発生した場合：

```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 403. Truncated server response: {
  "error": {
    "code": 403,
    "message": "リクエストに認証スコープが不足しています。",
    "status": "PERMISSION_DENIED",
    "details":... (muteHttpExceptions オプションを使って完全なレスポンスを確認してください)
...
```

または

```
Exception: 指定された権限では UrlFetchApp.fetch を呼び出すことができません。必要な権限: https://www.googleapis.com/auth/script.external_request
```

`appsscript.json` の oauthScopes に以下の2つの記述が含まれていることを確認してください（ステップ2を参照）：

```json
"oauthScopes": [
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
```

エラーが発生した場合：

```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 401. Truncated server response: {
  "error": {
    "code": 401,
    "message": "リクエストに無効な認証情報が含まれていました。OAuth 2 アクセストークン、ログインクッキー、またはその他の認証情報が必要です…（muteHttpExceptions オプションを使用して完全なレスポンスを確認してください）"
```

まだバインドされていない GCP プロジェクトを示しています（手順 1 を参照）。または、その GCP プロジェクトで使用したい Google APIs が有効化されていない、現在のアカウントに該当の GCP / Google APIs の使用権限や Firebase App の権限がない場合があります。設定を確認してください。

エラーが発生した場合：

```
Exception: https://firebaseappdistribution.googleapis.com へのリクエストが失敗し、コード404が返されました。サーバー応答は省略されています:
```

または

```php
Exception: Request failed for https://firebaseappdistribution.googleapis.com returned code 400. Truncated server response: {
  "error": {
    "code": 400,
    "message": "リクエストに無効な引数が含まれています。",
    "status": "INVALID_ARGUMENT"
  }
}
```

Google APIs のリクエストパスが正しいかどうかを確認してください。

#### 接続成功🎉🎉🎉

![](/assets/71400d408dc8/1*9OyoPtblFnGGIBRvlGw10Q.png)

短くて10行未満のコードでGoogle APIsを簡単に連携できるのがわかります。本当に便利です。興味がある方は、比較のために[自分で実装した](https://github.com/ZhgChgLi/ZReviewTender/blob/main/lib/GoogleAPI.rb){:target="_blank"} Google APIs連携時の認証トークン交換のコード手順をご覧ください。非常に面倒です。

#### 次のステップ：

以前の記事「 [使用 Google Apps Script Web App 表單串接 Github Action CI/CD 工作](../4cb4437818f2/) 」と組み合わせて、Firebase App Distribution のダウンロードリンクも Web App 上に表示し、メンバーが直接ダウンロードしやすくします。

![Demo Result](/assets/71400d408dc8/1*nK3H3e3KgHEg8qz-KZ9ZGA.png)

デモ結果

> *他の Google APIs も同様に接続可能です。*

### 2025/07 アップデート:

この機能は実際のパッケージングツールに統合されています。最新の記事事例をご参照ください：「[**CI/CD 実践ガイド（4）：Google Apps Script Web App を使って GitHub Actions と連携し、無料で使いやすいパッケージングツールプラットフォームを構築する**](../4273e57e7148/)」

ご質問やご意見がありましたら、[こちらからご連絡ください](https://www.zhgchg.li/contact){:target="_blank"} 。

*[Post](https://medium.com/zrealm-robotic-process-automation/google-apps-script-x-google-apis-%E5%BF%AB%E9%80%9F%E4%B8%B2%E6%8E%A5%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F-71400d408dc8){:target="_blank"} Mediumから[ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}を使って変換。*