---
author: ZhgChgLi
categories:
- ZRealmã®é–‹ç™º
date: 2025-07-07T15:02:24.147+0000
description: iOSé–‹ç™ºè€…å‘ã‘ã«GitHub Actionsã‚’æ´»ç”¨ã—ãŸCI/CDã®è‡ªå‹•åŒ–æ‰‹é †ã‚’è©³è§£ã€‚ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã®èª²é¡Œã‚’è§£æ±ºã—ã€åŠ¹ç‡åŒ–ã¨å“è³ªå‘ä¸Šã‚’åŒæ™‚ã«é”æˆã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã€‚
image:
  path: /assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.jpeg
last_modified_at: 2025-07-12T02:52:21.006+0000
render_with_liquid: false
tags:
- iOSã‚¢ãƒ—ãƒªé–‹ç™º
- CI/CD
- GitHub Actions
- Firebase
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- japanese
- ai-translation
title: GitHub Actionsï½œiOS App CI/CD è‡ªå‹•åŒ–æ§‹ç¯‰ã§ãƒ“ãƒ«ãƒ‰ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§æœ€é€Ÿå®Ÿç¾
---

### CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ3ï¼‰ï¼šGitHub Actions ã‚’ä½¿ã£ãŸ iOS ã‚¢ãƒ—ãƒªã® CI ã¨ CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…

iOS App è‡ªå‹•åŒ–ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã® GitHub Actions å®Ÿè£…æ‰‹é † å®Œå…¨ã‚¬ã‚¤ãƒ‰

![Photo by [Robs](https://unsplash.com/@robinne?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/4b001d2e8440/1*0LK6m6CTImL6rcsrliiOQA.jpeg)

Photo by [Robs](https://unsplash.com/@robinne?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}

#### ã¯ã˜ã‚ã«

å‰å›ã®ã€Œ[**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆäºŒï¼‰ï¼šGitHub Actions ã¨ Self-hosted Runner ã®ä½¿ã„æ–¹ã¨æ§‹ç¯‰å¤§å…¨**](../404bd5c70040/)ã€ã§ã¯ã€GitHub Actions ã®åŸºæœ¬çŸ¥è­˜ã¨å‹•ä½œãƒ•ãƒ­ãƒ¼ã€è‡ªåˆ†ã®ãƒã‚·ãƒ³ã‚’ Runner ã¨ã—ã¦ä½¿ã†æ–¹æ³•ã€ãã—ã¦3ã¤ã®ç°¡å˜ãªè‡ªå‹•åŒ– Actions ã®å®Ÿè£…ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚**æœ¬è¨˜äº‹ã§ã¯ã€å®Ÿéš›ã« GitHub Actions ã‚’ä½¿ã£ã¦ iOS ã‚¢ãƒ—ãƒªã® CI/CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã«é‡ç‚¹ã‚’ç½®ãã¾ã™**ã€‚ä»Šå›ã‚‚æ‰‹å–ã‚Šè¶³å–ã‚Šã€ä¸€æ­©ãšã¤é€²ã‚ãªãŒã‚‰ GitHub Actions ã«é–¢ã™ã‚‹çŸ¥è­˜ã‚’è£œè¶³ã—ã¦ã„ãã¾ã™ã€‚

### App CI/CD ãƒ•ãƒ­ãƒ¼é–¢ä¿‚å›³

![](/assets/4b001d2e8440/1*VRygfRAkBRNEDAC4RyGzRA.png)

æœ¬ç¨¿ã§ã¯ GitHub Actions ã‚’ä½¿ã£ãŸ CI/CD æ§‹ç¯‰éƒ¨åˆ†ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚æ¬¡å›ã®ã€Œ[CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ4ï¼‰ï¼šGoogle Apps Script Web App ã‚’ä½¿ã£ã¦ GitHub Actions ã¨é€£æºã—ã€ç„¡æ–™ã§ä½¿ã„ã‚„ã™ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹](../4273e57e7148/)ã€ã§ã¯ã€å³å´ã® Google Apps Script Web App ã‚’ä½¿ã£ãŸãƒãƒ¼ãƒ é–“å”åŠ›å‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ§‹ç¯‰ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

#### é‹ç”¨ãƒ•ãƒ­ãƒ¼ï¼š

1. GitHub Actions ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒˆãƒªã‚¬ãƒ¼ ã¾ãŸã¯ ãƒ•ã‚©ãƒ¼ãƒ ãƒˆãƒªã‚¬ãƒ¼ ã¾ãŸã¯ å®šæœŸãƒˆãƒªã‚¬ãƒ¼

2. å¯¾å¿œã™ã‚‹ Workflow ã®ã‚¸ãƒ§ãƒ–ï¼ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹

3. ã‚¹ãƒ†ãƒƒãƒ—ã§å¯¾å¿œã™ã‚‹ Fastlaneï¼ˆiOSï¼‰ã¾ãŸã¯ï¼ˆAndroid Gradleï¼‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

4. Fastlane ãŒå®Ÿè¡Œã™ã‚‹å¯¾å¿œã™ã‚‹ xcodebuildï¼ˆiOSï¼‰ã‚³ãƒãƒ³ãƒ‰

5. å®Ÿè¡Œçµæœã‚’å–å¾—ã™ã‚‹

6. å¾Œç¶šã® Workflow ã‚¸ãƒ§ãƒ–ï¼ã‚¹ãƒ†ãƒƒãƒ—ã®å‡¦ç†çµæœã‚’å‡¦ç†ã™ã‚‹

7. å®Œäº†

#### GitHub Actions æˆæœå›³

ã¾ãšã¯æœ€çµ‚æˆæœã‚’ãŠè¦‹ã›ã—ã¦ã€çš†ã•ã‚“ã®å®Ÿè£…æ„æ¬²ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ï¼

![[CI Testing](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.png)

[CI Testing](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

![](/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.png)

![[CI Nightly Build, CD Deploy](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target="_blank"}](/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.jpeg)

[CI Nightly Build, CD Deploy](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target="_blank"}

### GitHub Actions x Self-hosted Runner åŸºæœ¬çŸ¥è­˜

ã‚‚ã— GitHub Actions ã¨ Self-hosted Runner ã®æ§‹ç¯‰ã«ã¾ã æ…£ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ãœã²å‰å›ã®è¨˜äº‹ã€Œ[**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆäºŒï¼‰ï¼šGitHub Actions ã¨ Self-hosted Runner ã®ä½¿ã„æ–¹ã¨æ§‹ç¯‰å¤§å…¨**](../404bd5c70040/)ã€ã‚’å…ˆã«ã”è¦§ã„ãŸã ãã‹ã€å‰å›ã®çŸ¥è­˜ã¨åˆã‚ã›ã¦å®Ÿè·µã™ã‚‹ã“ã¨ã‚’å¼·ããŠã™ã™ã‚ã—ã¾ã™ã€‚

> ***å®Ÿè£…é–‹å§‹ï¼***

### iOS Demo ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

[![](https://opengraph.githubassets.com/5952f3220c95ced947b9ee50d9c542b2edbb424be50c51c582cb226ce5f5df63/ZhgChgLi/github-actions-ci-cd-demo)](https://github.com/ZhgChgLi/github-actions-ci-cd-demo){:target="_blank"}

**æœ¬æ–‡ã§ä½¿ç”¨ã™ã‚‹ iOS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ãŠã‚ˆã³ãƒ†ã‚¹ãƒˆé …ç›®ã¯ã™ã¹ã¦ AI ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™**ã€‚iOS ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ è©³ç´°ã¯æ°—ã«ã›ãšã€Infra ã¨ CI/CD ã®éƒ¨åˆ†ã«ã®ã¿ç„¦ç‚¹ã‚’å½“ã¦ã¦è­°è«–ã—ã¾ã™ã€‚

> ***ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã¯éå»ã®çµŒé¨“ã«åŸºã¥ã„ã¦ã„ã¾ã™ãŒã€æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯æœ€æ–°ã® [mise](https://github.com/jdx/mise){:target="_blank"} ã¨ [tuist](https://github.com/tuist/tuist){:target="_blank"} ã®ä½¿ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚***

#### Mint

[![](https://opengraph.githubassets.com/cfba5c7658c860d0ee4e97df8176a3fc6bbfd9f84c2e8334eaa30988c2700d63/yonaskolb/Mint)](https://github.com/yonaskolb/Mint){:target="_blank"}

Mint ãƒ„ãƒ¼ãƒ«ã¯ä¾å­˜ãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’çµ±ä¸€ã§ãã¾ã™ï¼ˆGemfile ã¯ Ruby Gems ã®ã¿ç®¡ç†å¯èƒ½ï¼‰ã€‚ä¾‹ãˆã°ã€XcodeGenã€SwiftFormatã€SwiftLintã€Periphery ãªã©ã§ã™ã€‚

â€¦ãªã©

**Mintfile:**

```graphql
yonaskolb/Mint@0.17.5
yonaskolb/XcodeGen@2.35.0
nicklockwood/SwiftFormat@0.51.13
```

ã“ã“ã§ã¯3ã¤ã ã‘ä½¿ç”¨ã—ã¾ã™ã€‚

> ***è¤‡é›‘ã™ãã‚‹ã¨æ„Ÿã˜ã‚‹å ´åˆã¯ç„¡ç†ã«ä½¿ã‚ãšã€Action Workflow Step å†…ã§ç›´æ¥ brew install ã‚’ä½¿ã£ã¦å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚***

#### Bundle

**Gemfile:**

```bash
source 'https://rubygems.org'
gem 'cocoapods', '~>1.16.0'
gem 'fastlane', '~>2.228.0'

plugins_path = File.join(File.dirname(__FILE__), 'Product', 'fastlane', 'Pluginfile')
eval_gemfile(plugins_path) if File.exist?(plugins_path)
```

Rubyï¼ˆGemsï¼‰é–¢é€£ã®ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç†ã™ã‚‹éš›ã€ä¸€èˆ¬çš„ãªiOSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æœ€ã‚‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã®ã¯ã“ã®2ã¤ã€`cocoapods` ã¨ `fastlane` ã§ã™ã€‚

#### Cocoapods

**Product/podfile:**

```ruby
platform :ios, '13.0'
use_frameworks!

target 'app-ci-cd-github-actions-demo' do
  pod 'SnapKit'
end 
```

[CocoaPods Specs Repoã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹çµ‚äº†](https://blog.cocoapods.org/CocoaPods-Specs-Repo/){:target="_blank"} ãŒå®£è¨€ã•ã‚Œã¦ã„ã¾ã™ãŒã€å¤ã„iOSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯CocoapodsãŒã¾ã ã‚ˆãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ç°¡å˜ã«Snapkitã‚’ãƒ‡ãƒ¢ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

#### XCodeGen

å¤šäººé–‹ç™ºã§ã® `.xcodeproj` / `.xcworkspace` ã®å¤‰æ›´ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€Project.yaml ã§ Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’çµ±ä¸€ã—ã¦å®šç¾©ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§è‡ªåˆ†è‡ªèº«ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆGitã«ã¯ä¸Šã’ãªã„ï¼‰ã€‚

**Product/project.yaml:**

```yaml
name: app-ci-cd-github-actions-demo
options:
  bundleIdPrefix: com.example
  deploymentTarget:
    iOS: '13.0'
  usesTabs: false
  indentWidth: 2
  tabWidth: 2

configs:
  Debug: debug
  Release: release

targets:
  app-ci-cd-github-actions-demo:
    type: application
    platform: iOS
    sources:
      - app-ci-cd-github-actions-demo
    resources:
      - app-ci-cd-github-actions-demo/Assets.xcassets
      - app-ci-cd-github-actions-demo/Base.lproj
    info:
      path: app-ci-cd-github-actions-demo/Info.plist
      properties:
        CFBundleIdentifier: $(PRODUCT_BUNDLE_IDENTIFIER)
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo
    cocoapods: true

  app-ci-cd-github-actions-demoTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - app-ci-cd-github-actions-demoTests
    dependencies:
      - target: app-ci-cd-github-actions-demo
    info:
      path: app-ci-cd-github-actions-demoTests/Info.plist
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.tests

  app-ci-cd-github-actions-demoUITests:
    type: bundle.ui-testing
    platform: iOS
    sources:
      - app-ci-cd-github-actions-demoUITests
    dependencies:
      - target: app-ci-cd-github-actions-demo
    info:
      path: app-ci-cd-github-actions-demoUITests/Info.plist
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.uitests

  app-ci-cd-github-actions-demoSnapshotTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: app-ci-cd-github-actions-demoSnapshotTests
        excludes:
          - "**/__Snapshots__/**"
    dependencies:
      - target: app-ci-cd-github-actions-demo
      - product: SnapshotTesting
        package: SnapshotTesting
    info:
      path: app-ci-cd-github-actions-demoSnapshotTests/Info.plist
      settings:
        base:
          PRODUCT_BUNDLE_IDENTIFIER: com.test.appcicdgithubactionsdemo.snapshottests

packages:
  SnapshotTesting:
    url: https://github.com/pointfreeco/swift-snapshot-testing
    from: 1.18.4
```

SnapshotTesting: Swift Package Manager ã‚’ä½¿ç”¨ã—ã¦ç®¡ç†ã€‚

#### Fastlane

xcodebuildã‚³ãƒãƒ³ãƒ‰ã®ãƒ©ãƒƒãƒ—ã€App Store Connect APIã‚„Firebase APIãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®è¤‡é›‘ãªæ‰‹é †ã®ãƒ©ãƒƒãƒ—ã€‚

**Product/fastlane/Fastfile:**

```php

default_platform(:ios)

platform :ios do
  desc "ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‹UIãƒ†ã‚¹ãƒˆï¼‰"
  lane :run_all_tests do \\|options\\|
    device = options[:device]
    scan(
      scheme: "app-ci-cd-github-actions-demo",
      device: device,
      clean: true,
      output_directory: "fastlane/test_output",
      output_types: "junit"
    )
  end

  desc "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿ã‚’å®Ÿè¡Œã™ã‚‹"
  lane :run_unit_tests do \\|options\\|
    device = options[:device]
    scan(
      scheme: "app-ci-cd-github-actions-demo",
      device: device,
      clean: true,
      only_testing: [
        "app-ci-cd-github-actions-demoTests"
      ],
      output_directory: "fastlane/test_output",
      output_types: "junit"
    )
  end

  desc "ãƒ“ãƒ«ãƒ‰ã—ã¦Firebase App Distributionã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹"
  lane :beta do \\|options\\|
    
    if options[:version_number] && options[:version_number].to_s.strip != ""
      increment_version_number(version_number: options[:version_number])
    end

    if options[:build_number] && options[:build_number].to_s.strip != ""
      increment_build_number(build_number: options[:build_number])
    end

    update_code_signing_settings(
      use_automatic_signing: false,
      path: "app-ci-cd-github-actions-demo.xcodeproj",
      team_id: ENV['TEAM_ID'],
      code_sign_identity: "iPhone Developer",
      sdk: "iphoneos*",
      profile_name: "cicd"
    )

    gym(
      scheme: "app-ci-cd-github-actions-demo",
      clean: true,
      export_method: "development",
      output_directory: "fastlane/build",
      output_name: "app-ci-cd-github-actions-demo.ipa",
      export_options: {
          provisioningProfiles: {
            "com.test.appcicdgithubactionsdemo" => "cicd",
          },
      }
    )

    firebase_app_distribution(
      app: "1:127683058219:ios:98896929fa131c7a80686e",
      firebase_cli_token: ENV["FIREBASE_CLI_TOKEN"],
      release_notes: options[:release_notes] \\|\\| "New beta build"
    )
  end
end
```

è¨»: provisioningProfilesã€profile_name ã¯ [App Developer ã® Profiles è¨¼æ˜æ›¸å](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} ã«å¯¾å¿œã—ã¾ã™ã€‚ï¼ˆmatch ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®æŒ‡å®šã¯ä¸è¦ã§ã™ã€‚ï¼‰

![](/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.png)

**Fastlane ã¯ iOS CI/CD ã«ãŠã„ã¦æ¬ ã‹ã›ãªã„å­˜åœ¨** ã§ã‚ã‚Šã€ç”¨æ„ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã ã‘ã§è¿…é€Ÿã« CI/CD ã®å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ã‚’é–‹ç™ºã§ãã¾ã™ã€‚ç§ãŸã¡ã¯å…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨­è¨ˆã«é›†ä¸­ã§ãã€è¤‡é›‘ãª API é€£æºã‚„ã‚³ãƒãƒ³ãƒ‰ä½œæˆã‚’æ°—ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ã€Fastlane ã¯ã€Œscan(xxx)ã€ã¨æ›¸ãã ã‘ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ãŒã€xcodebuild ã§æ›¸ãå ´åˆã¯ã€Œ`xcodebuild -workspace ./xxx.xcworkspace -scheme xxx -derivedDataPath xxx â€˜platform=iOS Simulator,id=xxxâ€™ clean build test`ã€ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€ãƒ“ãƒ«ãƒ‰ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ã¯è‡ªåˆ†ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã€App Store Connect ã‚„ Firebase API ã¨é€£æºã™ã‚‹ã®ã‚‚é¢å€’ã§ã™ã€‚éµã®èªè¨¼ã ã‘ã§ã‚‚10è¡Œä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**Demo ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ Lane ã¯3ã¤ã ã‘ã§ã™ï¼š**

- run_all_tests: ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒ—ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆSnapshotï¼‹Unitï¼‰

- run_unit_tests: å˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œï¼ˆUnitï¼‰

- beta: Firebase App Distributionã¸ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é…å¸ƒ

#### Fastlane â€” Match

Demoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆ¶é™ã«ã‚ˆã‚Šã€ã“ã“ã§ã¯Matchã‚’ä½¿ã£ã¦ãƒãƒ¼ãƒ ã®é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¨¼æ˜æ›¸ã‚’ç®¡ç†ã—ã¦ã„ã¾ã›ã‚“ãŒã€ãƒãƒ¼ãƒ ã®ã™ã¹ã¦ã®é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¨¼æ˜æ›¸ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«Matchã‚’ä½¿ã†ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚ç®¡ç†ã¨æ›´æ–°ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚

> *Match ã‚’ä½¿ãˆã°ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã« `match all` ã‚³ãƒãƒ³ãƒ‰ã§é–‹ç™ºã«å¿…è¦ãªã™ã¹ã¦ã®è¨¼æ˜æ›¸ã‚’ä¸€æ‹¬ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚*

- **Fastlane Match ã¯åˆ¥ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§è¨¼æ˜æ›¸ã¨éµã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€GitHub Actions ã§ SSH Agent ã‚’è¨­å®šã—ã€åˆ¥ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**  
  ï¼ˆè©³ç´°ã¯è¨˜äº‹æœ«ã®è£œè¶³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼‰

â€” â€” â€”

#### Makefile

![Makefile](/assets/4b001d2e8440/1*jYACUYFP3MkeHCgeUY7j3w.png)

Makefile

é–‹ç™ºå´ã¨ CI/CD ã®ä¸¡æ–¹ã§ Makefile ã‚’ä½¿ã£ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€åŒã˜ç’°å¢ƒã€ãƒ‘ã‚¹ã€æ“ä½œã‚’çµ±ä¸€ã—ã¦ç®¡ç†ã—ã‚„ã™ãã—ã¾ã™ã€‚

> *å…¸å‹çš„ãªã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `pod install` ã‚’ä½¿ã†äººã‚‚ã„ã‚Œã°ã€Bundle ç®¡ç†ã® `bundle exec pod install` ã‚’ä½¿ã†äººã‚‚ã„ã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ã¨å·®ç•°ãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚*

> ***è¤‡é›‘ã™ãã¦ä½¿ã„ãŸããªã„å ´åˆã¯ã€Action Workflow Step ã«ç›´æ¥å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ›¸ãã ã‘ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚***

**Makefile:**

```makefile
#!make
PRODUCT_FOLDER = ./Product/
SHELL         := /bin/zsh
.DEFAULT_GOAL := install
MINT_DIRECTORY := ./mint/

export MINT_PATH=$(MINT_DIRECTORY)

## ğŸ‘‡ Help function
.PHONY: help
help:
 @echo ""
 @echo "ğŸ“– åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
 @grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) \\| \
  awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'
 @echo ""

## Setup
.PHONY: setup
setup: check-mint ## Ruby ã¨ Mint ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
 @echo "ğŸ”¨ Rubyä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
 bundle config set path 'vendor/bundle'
 bundle install
 @echo "ğŸ”¨ Mintä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
 mint bootstrap

## Install
.PHONY: install
install: XcodeGen PodInstall ## XcodeGen ã¨ CocoaPods ã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

.PHONY: XcodeGen
XcodeGen: check-mint ## XcodeGen ã§ .xcodeproj ã‚’ç”Ÿæˆ
 @echo "ğŸ”¨ XcodeGenã‚’å®Ÿè¡Œä¸­"
 cd $(PRODUCT_FOLDER) && \
 mint run yonaskolb/XcodeGen --quiet

.PHONY: PodInstall
PodInstall: ## CocoaPods ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
 @echo "ğŸ“¦ CocoaPodsä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
 cd $(PRODUCT_FOLDER) && \
 bundle exec pod install

### Mint
check-mint: check-brew ## Mint ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€ãªã‘ã‚Œã°è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
 @if ! command -v mint &> /dev/null; then \
  echo "ğŸ”¨ mintã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
  brew install mint; \
 fi

### Brew
check-brew: ## Homebrew ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€ãªã‘ã‚Œã°è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
 @if ! command -v brew &> /dev/null; then \
  echo "ğŸ”¨ Homebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
  /bin/bash -c "$$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"; \
 fi

## Format only git swift files
.PHONY: format
format: check-mint ## Product/ ä»¥ä¸‹ã®ã™ã¹ã¦ã® Swift ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 mint run swiftformat $(PRODUCT_FOLDER)
```

ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚„ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å½±éŸ¿ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€Dependency ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆä¾‹ï¼šmintã€bundle ãªã©ï¼‰ã®ãƒ‘ã‚¹ã¯ã§ãã‚‹ã ã‘ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«æŒ‡å®šã—ï¼ˆã•ã‚‰ã« `.gitignore` ã§é™¤å¤–ï¼‰ã—ã¦ã„ã¾ã™ã€‚

```scss
â”œâ”€â”€ mint (Mint ä¾å­˜é–¢ä¿‚)
â”‚   â””â”€â”€ packages
â”œâ”€â”€ Product
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demo
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demo.xcodeproj
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demo.xcworkspace
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demoSnapshotTests
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demoTests
â”‚   â”œâ”€â”€ app-ci-cd-github-actions-demoUITests
â”‚   â”œâ”€â”€ fastlane
â”‚   â””â”€â”€ Pods (Cocoapods ä¾å­˜é–¢ä¿‚)
â””â”€â”€ vendor (Bundle ä¾å­˜é–¢ä¿‚)
    â””â”€â”€ bundle
```

![make help](/assets/4b001d2e8440/1*F1KFntT8bCZzyYm9JahiuA.png)

make help ã‚³ãƒãƒ³ãƒ‰ã¯ã€Makefile ã«å®šç¾©ã•ã‚ŒãŸãƒ˜ãƒ«ãƒ—æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚é€šå¸¸ã€Makefile å†…ã«ãƒ˜ãƒ«ãƒ—ç”¨ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«æœ‰åŠ¹ã§ã™ã€‚

**Makefine ã‚’ä½¿ã£ãŸçµ±ä¸€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ï¼š**

1. `git clone repo`

2. `cd ./repo`

3. `make setup`  
   å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼ˆ**brew**ã€**mint**ã€**bundle**ã€xcodegenã€swiftformat ãªã©ï¼‰

4. `make install`  
   ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆpod install ã¨ xcodegen ã‚’å®Ÿè¡Œï¼‰

5. å®Œäº†

6. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã„ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„

> ***CI/CDã§ã‚‚æ–°äººã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã‚‚ã€ä¸Šè¨˜ã®æ‰‹é †ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚***

### æœ¬è¨˜äº‹ã® GitHub Actions CI/CD äº‹ä¾‹

æœ¬è¨˜äº‹ã§ã¯ã€3ã¤ã® GitHub Actions CI/CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰äº‹ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚çš†ã•ã‚“ã‚‚ã“ã‚Œã‚‰ã®æ‰‹é †ã‚’å‚è€ƒã«ã—ã¦ã€è‡ªåˆ†ã®ãƒãƒ¼ãƒ ã«åˆã£ãŸ CI/CD ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

1. CI â€” ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

2. CD â€” Firebase App Distributionã¸ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

3. CI + CD â€” Nightly Build å®Ÿè¡Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‹å˜ä½“ãƒ†ã‚¹ãƒˆï¼‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ï¼‹Firebase App Distributionã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

> *ãƒ‡ãƒ¢ã®åˆ¶é™ã«ã‚ˆã‚Šã€æœ¬è¨˜äº‹ã§ã¯ Firebase App Distribution ã¸ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é…å¸ƒã®ã¿ã‚’é€£æºã—ã¾ã™ã€‚Testflight ã‚„ App Store ã¸ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é…å¸ƒã‚‚åŒæ§˜ã®æ‰‹é †ã§ã™ãŒã€Fastlane å†…ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç•°ãªã‚‹ã ã‘ãªã®ã§ã€å„è‡ªã§å¿œç”¨ã—ã¦ãã ã•ã„ã€‚*

### CI â€” ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

#### ãƒ•ãƒ­ãƒ¼

Develop ãƒ–ãƒ©ãƒ³ãƒã¯ **ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ã§ãã¾ã›ã‚“**ã€‚æ›´æ–°ã™ã‚‹ã«ã¯ Pull Request ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ã® Pull Request ã¯ **ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èªã¨å˜ä½“ãƒ†ã‚¹ãƒˆã®æˆåŠŸãŒå¿…é ˆã§ã€ãƒãƒ¼ã‚¸å¯èƒ½** ã§ã™ã€‚æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã¨å†åº¦ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

#### CI-Testing.yml

Repo â†’ Actions â†’ New workflow â†’ è‡ªåˆ†ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

```yaml
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆActionï¼‰å
name: CI-Testing

# Actions ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«å
run-name: "[CI-Testing] ${{ github.event.pull_request.title \\|\\| github.ref }}"

# åŒã˜ Concurrency Group ã§æ–°ã—ã„ã‚¸ãƒ§ãƒ–ãŒé–‹å§‹ã•ã‚ŒãŸå ´åˆã€å®Ÿè¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
# ä¾‹ï¼šPush Commit ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ãŒã¾ã å®Ÿè¡Œä¸­ã«å†åº¦ Push Commit ãŒã‚ã£ãŸå ´åˆã€å‰ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
concurrency:
  group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.event.pull_request.number \\|\\| github.ref }}
  cancel-in-progress: true

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # PR ã‚¤ãƒ™ãƒ³ãƒˆ
  pull_request:
    # PR - ã‚ªãƒ¼ãƒ—ãƒ³ã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã€æ–°ã—ã„ Push Commit æ™‚
    types: [opened, synchronize, reopened]
  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:
    # ãƒ•ã‚©ãƒ¼ãƒ  Inputs ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    inputs:
      # å®Ÿè¡Œã™ã‚‹ Test Fastlane Lane
      TEST_LANE:
        description: 'Test Lane'
        default: 'run_unit_tests'
        type: choice
        options:
          - run_unit_tests
          - run_all_tests
  # ä»–ã® Workflow ã‹ã‚‰ã“ã® Workflow ã‚’å‘¼ã³å‡ºã—ãƒˆãƒªã‚¬ãƒ¼
  # Nightly Build ã§ä½¿ç”¨
  workflow_call:
    # ãƒ•ã‚©ãƒ¼ãƒ  Inputs ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    inputs:
      # å®Ÿè¡Œã™ã‚‹ Test Fastlane Lane
      TEST_LANE:
        description: 'Test Lane'
        default: 'run_unit_tests'
        # workflow_call inputs ã¯ choice ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„
        type: string
      BRANCH:
        description: 'Branch'
        type: string
  
# ã‚¸ãƒ§ãƒ–
# ã‚¸ãƒ§ãƒ–ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # ã‚¸ãƒ§ãƒ– ID
  testing:
    # ã‚¸ãƒ§ãƒ–åï¼ˆçœç•¥å¯èƒ½ã€ãƒ­ã‚°è¡¨ç¤ºã®ãŸã‚è¨­å®šæ¨å¥¨ï¼‰
    name: Testing
    
    # Runner ãƒ©ãƒ™ãƒ« - GitHub Hosted Runner macos-15 ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œ
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Public Repo ãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Public Repo ãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Public Repo ãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # Private Repo ã®å ´åˆã¯å¾“é‡èª²é‡‘ã§ macOS ãƒã‚·ãƒ³ã¯æœ€ã‚‚é«˜ä¾¡ï¼ˆ10å€ï¼‰ã€10å›å®Ÿè¡Œã§2,000åˆ†ã®ç„¡æ–™ä¸Šé™ã«é”ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    # self-hosted Runner ã®åˆ©ç”¨ã‚’æ¨å¥¨
    runs-on: macos-15

    # æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“è¨­å®šã€ç•°å¸¸æ™‚ã®ç„¡é™å¾…æ©Ÿã‚’é˜²æ­¢
    timeout-minutes: 30

    # zsh ã‚’ä½¿ç”¨
    # çœç•¥å¯èƒ½ã€ç§ã¯ zsh ãŒå¥½ããªã®ã§è¨­å®šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ bash
    defaults:
      run:
        shell: zsh {0}
          
    # ã‚¹ãƒ†ãƒƒãƒ—
    # ã‚¹ãƒ†ãƒƒãƒ—ã¯é †ç•ªã«å®Ÿè¡Œã•ã‚Œã‚‹  
    steps:
      # ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ git clone & å®Ÿè¡Œãƒ–ãƒ©ãƒ³ãƒã« checkout
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          # Git Large File Storageã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ä¸è¦
          # default: false
          lfs: false
          
          # æŒ‡å®šãŒã‚ã‚Œã°æŒ‡å®šãƒ–ãƒ©ãƒ³ãƒã‚’ checkoutã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒï¼‰
          # on: schedule ã‚¤ãƒ™ãƒ³ãƒˆã¯ main ãƒ–ãƒ©ãƒ³ãƒã®ã¿ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€Nightly Build ç­‰ã¯ãƒ–ãƒ©ãƒ³ãƒæŒ‡å®šãŒå¿…è¦
          # ä¾‹ï¼šon: schedule -> main ãƒ–ãƒ©ãƒ³ãƒã€Nightly Build ã¯ master ãƒ–ãƒ©ãƒ³ãƒ
          ref: ${{ github.event.inputs.BRANCH \\|\\| '' }}

      # ========== ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ãƒ†ãƒƒãƒ— ==========
      
      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šã® XCode ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
      # å¾Œç¶šã‚¹ãƒ†ãƒƒãƒ—ã§æ‰‹å‹•æŒ‡å®šã® XCode_x.x.x.app ã‚’ä½¿ç”¨
      # xcversion ã¯éæ¨å¥¨ã§ä¸å®‰å®šãªãŸã‚ä½¿ç”¨ã—ãªã„
      - name: Read .xcode-version
        id: read_xcode_version
        run: \\|
          XCODE_VERSION=$(cat .xcode-version)
          echo "XCODE_VERSION: ${XCODE_VERSION}"
          echo "xcode_version=${XCODE_VERSION}" >> $GITHUB_OUTPUT

          # ã“ã“ã§ã‚°ãƒ­ãƒ¼ãƒãƒ« XCode ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šå¯èƒ½ã€ä»¥é™ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ DEVELOPER_DIR æŒ‡å®šä¸è¦ã«
          # ãŸã ã— sudo æ¨©é™ãŒå¿…è¦ã€self-hosted runner ãªã‚‰ runner ç’°å¢ƒã« sudo æ¨©é™ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
          # sudo xcode-select -s "/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer"

      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šã® Ruby ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
      - name: Read .ruby-version
        id: read_ruby_version
        run: \\|
          RUBY_VERSION=$(cat .ruby-version)
          echo "RUBY_VERSION: ${RUBY_VERSION}"
          echo "ruby_version=${RUBY_VERSION}" >> $GITHUB_OUTPUT

      # Runner ã® Ruby ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«è¨­å®š
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "${{ steps.read_ruby_version.outputs.ruby_version }}"

      # è¨­å®šã¯ä»»æ„ã€self-hosted ã§è¤‡æ•° Runner ãŒ pod install æ™‚ã« cocoapods repos ã®ç«¶åˆå›é¿ç”¨
      # GitHub Hosted Runner ã§ã¯ä¸è¦
      # - name: Change Cocoapods Repos Folder
      #   if: contains(runner.labels, 'self-hosted')
      #   run: \\|
      #     # å„ Runner ã”ã¨ã«ç‹¬è‡ªã® .cocoapods ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½¿ã„ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆã‚’é˜²æ­¢
      #     mkdir -p "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/"
      #     export CP_HOME_DIR="$HOME/.cocoapods-${{ env.RUNNER_NAME }}"
      #     rm -f "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock"

      # ========== ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šã‚¹ãƒ†ãƒƒãƒ— ==========
      # self-hosted ã§ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ä½¿ç”¨é‡ã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹
      # ãƒ«ãƒ¼ãƒ«ï¼š7æ—¥é–“æœªãƒ’ãƒƒãƒˆã§è‡ªå‹•å‰Šé™¤ã€å˜ä¸€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€å¤§10GBã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸæ™‚ã®ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      # Public Repo: ç„¡æ–™ç„¡åˆ¶é™
      # Private Repo: 5GB ã‹ã‚‰
      # Self-hosted ã¯ç‹¬è‡ªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ä»–ãƒ„ãƒ¼ãƒ«ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†å¯èƒ½
      
      # Bundle Cache (Gemfile)
      # Makefile ã§ Bundle ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’ ./vendor ã«æŒ‡å®šã—ã¦ã„ã‚‹å¯¾å¿œ
      - name: Cache Bundle
        uses: actions/cache@v3
        with:
          path: \\|
            ./vendor
          key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }}
          restore-keys: \\|
            ${{ runner.os }}-bundle-

      # CocoaPods Cache (Podfile)
      # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Pods ãƒ•ã‚©ãƒ«ãƒ€
      - name: Cache CocoaPods
        uses: actions/cache@v3
        with:
          path: \\|
            ./Product/Pods
          key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }}
          restore-keys: \\|
            ${{ runner.os }}-cocoapods-

      # Mint cache
      # Makefile ã§ Mint ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’ ./mint ã«æŒ‡å®šã—ã¦ã„ã‚‹å¯¾å¿œ
      - name: Cache Mint
        uses: actions/cache@v3
        with:
          path: ./mint
          key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }}
          restore-keys: \\|
            ${{ runner.os }}-mint-

      # ====================

      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— & ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Setup & Install Dependency
        run: \\|
          # Makefile ã® Setup ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã€å†…å®¹ã¯å¤§ä½“ä»¥ä¸‹ã®é€šã‚Šï¼š
          # brew install mint
          # bundle config set path 'vendor/bundle'
          # bundle install
          # mint bootstrap
          # ...
          make setup

          # Makefile ã® Install ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã€å†…å®¹ã¯å¤§ä½“ä»¥ä¸‹ã®é€šã‚Šï¼š
          # mint run yonaskolb/XcodeGen --quiet
          # bundle exec pod install
          # ...
          make install

      # Fastlane Unit ãƒ†ã‚¹ãƒˆ Lane å®Ÿè¡Œ
      - name: Run Tests
        id: testing
        # ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®šã€ä»¥é™ã®ã‚³ãƒãƒ³ãƒ‰ã§ cd ./Product/ ä¸è¦ã«
        working-directory: ./Product/
        env:
          # ãƒ†ã‚¹ãƒˆãƒ—ãƒ©ãƒ³ã€å…¨ãƒ†ã‚¹ãƒˆã‹å˜ä½“ãƒ†ã‚¹ãƒˆã‹
          # PR ãƒˆãƒªã‚¬ãƒ¼ã®å ´åˆã¯ run_unit_testsã€ãã‚Œä»¥å¤–ã¯ inputs.TEST_LANE ã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ run_all_tests
          TEST_LANE: ${{ github.event_name == 'pull_request' && 'run_unit_tests' \\|\\| github.event.inputs.TEST_LANE \\|\\| 'run_all_tests' }}
          
          # ã“ã®ã‚¸ãƒ§ãƒ–ã§ä½¿ç”¨ã™ã‚‹ XCode_x.x.x ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
          DEVELOPER_DIR: "/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer"
          
          # Repo -> Settings -> Actions secrets and variables -> variables
          # ä½¿ç”¨ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿å
          SIMULATOR_NAME: ${{ vars.SIMULATOR_NAME }}
          # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã® iOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³
          SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }}

          # å®Ÿè¡Œä¸­ã® Runner å
          RUNNER_NAME: ${{ runner.name }}
          
          # XCodebuild ã‚³ãƒãƒ³ãƒ‰ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ãƒªãƒˆãƒ©ã‚¤å›æ•°å¢—åŠ 
          # ãƒã‚·ãƒ³è² è·ãŒé«˜ã„å ´åˆã€3å›ã§å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚
          FASTLANE_XCODEBUILD_SETTINGS_TIMEOUT: 60
          FASTLANE_XCODEBUILD_SETTINGS_RETRIES: 10
        run: \\|

          # self-hosted ã§åŒä¸€ãƒã‚·ãƒ³ã«è¤‡æ•° Runner èµ·å‹•ã™ã‚‹ã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ç«¶åˆå•é¡Œç™ºç”Ÿï¼ˆå¾Œè¿°ï¼‰
          # å›é¿ç­–ã¨ã—ã¦ Runner åã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿åã«ã—ã€Runner ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’æŒã¤
          # ä¾‹ï¼šbundle exec fastlane run_unit_tests device:"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})"
          # ã“ã“ã¯ GitHub Hosted Runner ãªã®ã§å•é¡Œãªã—ã€ãã®ã¾ã¾ device:"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})" ã‚’ä½¿ç”¨

          # ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«å³çµ‚äº†ã›ãšå…¨å‡ºåŠ›ã‚’ temp/testing_output.txt ã«ä¿å­˜
          # å¾Œã§å†…å®¹è§£æã— Build Failed ã‹ Test Failed ã‹ã‚’åˆ¤åˆ¥ã—ã¦ PR ã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
          set +e
          
          # EXIT_CODE ã«å®Ÿè¡Œçµæœã® exit code ã‚’ä¿å­˜
          # 0 = OK
          # 1 = exit
          EXIT_CODE=0
          
          # å…¨å‡ºåŠ›ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
          bundle exec fastlane ${TEST_LANE} device:"${SIMULATOR_NAME} (${SIMULATOR_IOS_VERSION})" \\| tee "$RUNNER_TEMP/testing_output.txt"
          # ç¾åœ¨ EXIT_CODE ãŒ 0 ãªã‚‰ ${pipestatus[1]} ã‚’ EXIT_CODE ã«è¨­å®š
          [[ $EXIT_CODE -eq 0 ]] && EXIT_CODE=${pipestatus[1]}

          # ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥æ™‚ã¯çµ‚äº†
          set -e

          # ãƒ†ã‚¹ãƒˆå‡ºåŠ›ã‚’ãƒã‚§ãƒƒã‚¯
          # "Error building" ãŒã‚ã‚Œã° is_build_error=true ã‚’ Actions ç’°å¢ƒå¤‰æ•°ã«è¨­å®šï¼ˆãƒ“ãƒ«ãƒ‰å¤±æ•—ï¼‰
          # "Tests have failed" ãŒã‚ã‚Œã° is_test_error=true ã‚’ Actions ç’°å¢ƒå¤‰æ•°ã«è¨­å®šï¼ˆãƒ†ã‚¹ãƒˆå¤±æ•—ï¼‰
          
          if grep -q "Error building" "$RUNNER_TEMP/testing_output.txt"; then
            echo "is_build_error=true" >> $GITHUB_OUTPUT
            echo "âŒ Detected Build Error"
          elif grep -q "Tests have failed" "$RUNNER_TEMP/testing_output.txt"; then
            echo "is_test_error=true" >> $GITHUB_OUTPUT
            echo "âŒ Detected Test Error"
          fi

          # Exit Code ã‚’å¾©å…ƒã—ã¦çµ‚äº†
          exit $EXIT_CODE
          
      # ========== çµæœå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ— ==========
      
      # *.junit ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’è§£æã—çµæœã‚’ãƒãƒ¼ã‚¯ã€PR ãªã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚‚è¿½åŠ 
      - name: Publish Test Report
        # æ—¢å­˜ã® .junit ãƒ‘ãƒ¼ã‚µãƒ¼ Actions ã‚’åˆ©ç”¨ï¼šhttps://github.com/mikepenz/action-junit-report
        uses: mikepenz/action-junit-report@v5
        # if:
        # å‰ã‚¹ãƒ†ãƒƒãƒ—(Testing) æˆåŠŸã¾ãŸã¯
        # å‰ã‚¹ãƒ†ãƒƒãƒ—(Testing) å¤±æ•—ã‹ã¤ is_test_errorï¼ˆãƒ“ãƒ«ãƒ‰å¤±æ•—ã¯ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ãªã„ï¼‰
        if: ${{ (failure() && steps.testing.outputs.is_test_error == 'true') \\|\\| success() }}
        with:
          check_name: "Testing Report"
          comment: true
          updateComment: false
          require_tests: true
          detailed_summary: true
          report_paths: "./Product/fastlane/test_output/*.junit"

      # ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã‚³ãƒ¡ãƒ³ãƒˆ
      - name: Build Failure Comment
        # if:
        # å‰ã‚¹ãƒ†ãƒƒãƒ—(Testing) å¤±æ•—ã‹ã¤ is_build_error ã‹ã¤ PR ç•ªå·ã‚ã‚Š
        # 
        if: ${{ failure() && steps.testing.outputs.is_build_error == 'true' && github.event.pull_request.number }}
        uses: actions/github-script@v6
        env:
          action_url: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/attempts/${{ github.run_attempt }}"
        with:
            script: \\|
              const action_url = process.env.action_url
              const pullRequest = context.payload.pull_request \\|\\| {}
              const commitSha = pullRequest.head?.sha \\|\\| context.sha
              const creator = pullRequest.user?.login \\|\\| context.actor
        
              const commentBody = [
                `# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯ãƒ†ã‚¹ãƒˆã®ãƒ“ãƒ«ãƒ‰å¤±æ•— âŒ`,
                `Pull Request ãŒæ­£ã—ããƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`,
                ``,
                `ğŸ”— **Action**: [View Workflow Run](${action_url})`,
                `ğŸ“ **Commit**: ${commitSha}`,
                `ğŸ‘¤ **Author**: @${creator}`
              ].join('\n')
        
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: commentBody
              })
```

**æŠ€è¡“çš„ãªãƒã‚¤ãƒ³ãƒˆèª¬æ˜ï¼š**

- runs-on: self-hosted Runner ã®ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ [GitHub Hosted Runner macOS ã¯éå¸¸ã«é«˜ä¾¡ã§ã™](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions#per-minute-rates){:target="_blank"} ã€‚

- æ‰‹å‹•ã§ `.xcode-version` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã€æŒ‡å®šã•ã‚ŒãŸ Xcode ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã—ã€Xcode ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã§ `DEVELOPER_DIR` ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€Sudo ã‚’ä½¿ã‚ãšã«ç°¡å˜ã« Xcode ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚

- Cache: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã¾ã™ãŒã€self-hosted Runner ã§ã‚ã£ã¦ã‚‚ GitHub Cloud Cache ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€èª²é‡‘åˆ¶é™ã®å¯¾è±¡ã¨ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

- ä½¿ç”¨ `set +e` ã«ã‚ˆã‚Šã‚³ãƒãƒ³ãƒ‰ãŒå¤±æ•—ã—ã¦ã‚‚ã™ãã«çµ‚äº†ã—ãªã„ã‚ˆã†ã«ã—ã€å‡ºåŠ›ã‚’ã™ã¹ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ Build Failed ã‹ Test Failed ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã‚ãªã„ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã™ã¹ã¦ Test Failed ã«ãªã‚Šã¾ã™ã€‚  
  ã¾ãŸã€ä»–ã®ã‚¨ãƒ©ãƒ¼ã‚‚åˆ¤å®šå¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ï¼š`Underlying Error: Unable to boot the Simulator.` ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®èµ·å‹•å¤±æ•—ã‚’æ„å‘³ã—ã€å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚

- Checkout Code ã¯æŒ‡å®šã—ãŸãƒ–ãƒ©ãƒ³ãƒã‚’å—ã‘å…¥ã‚Œå¯èƒ½ï¼š`on: schedule` ã‚¤ãƒ™ãƒ³ãƒˆã¯ mainï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒï¼‰ã§ã®ã¿ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ãŸã‚ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã§å®Ÿè¡Œã—ãŸã„å ´åˆã¯ã€ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- æŒ‡å®šã—ãŸ .cocoapods ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‘ã‚¹ã¯è¨­å®šã—ã¦ã‚‚ã—ãªãã¦ã‚‚ã‚ˆã„ã§ã™ã€‚ä»¥å‰ã€åŒã˜ãƒã‚·ãƒ³ä¸Šã§ self-hosted ã®2ã¤ã® Runner ãŒåŒæ™‚ã« pod install ã‚’å®Ÿè¡Œã—ãŸéš›ã€ä¸¡æ–¹ã¨ã‚‚ .cocoapods ãƒªãƒã‚¸ãƒˆãƒªã‚’æ“ä½œã—ã¦ã„ãŸãŸã‚ã« git lock ãŒç™ºç”Ÿã—ã¦æ­¢ã¾ã£ã¦ã—ã¾ã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚  
  ï¼ˆãŸã ã—ã€ç™ºç”Ÿç¢ºç‡ã¯éå¸¸ã«ä½ã„ã§ã™ï¼‰

- **Private Pods ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯ã€SSH Agent ã‚’è¨­å®šã—ã¦ã‚¯ãƒ­ãƒ¼ãƒ³æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**  
  **ï¼ˆè©³ç´°ã¯è¨˜äº‹æœ«ã®è£œè¶³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼‰**

- ãƒªãƒã‚¸ãƒˆãƒªã® Settings â†’ Actions secrets and variables â†’ variables ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š  
  `SIMULATOR_IOS_VERSION` ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã® iOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³  
  `SIMULATOR_NAME` ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®åå‰

![](/assets/4b001d2e8440/1*Vj37P9vZ6KL5wWNvU3Cq3Q.png)

**Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã€æ‰‹å‹•ã§ä¸€åº¦æ¤œè¨¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ï¼š**

![](/assets/4b001d2e8440/1*tA2nKehTJ7aURSGgU7MM0g.png)

![](/assets/4b001d2e8440/1*Qap3KmhIJrLov2O7GneV3w.png)

æ­£ã—ãç¶šã‘ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚

#### GitHub ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š

Repo â†’ Settins â†’ Rules â†’ Rulesetsã€‚

![](/assets/4b001d2e8440/1*cf_M6NnakdcbzvC2VHSfpw.png)

- Ruleset Name: è¦å‰‡å

- Enforcement status: æœ‰åŠ¹/ç„¡åŠ¹ ã“ã®ãƒ«ãƒ¼ãƒ«åˆ¶é™

- Target branches: å¯¾è±¡ã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã€‚Default Branch ã«è¨­å®šã™ã‚‹ã¨ã€main ã‚„ develop ã«ãƒãƒ¼ã‚¸ã™ã‚‹ã™ã¹ã¦ã®ãƒ–ãƒ©ãƒ³ãƒãŒã“ã®ãƒ«ãƒ¼ãƒ«ã®å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚

- Bypass list: ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒãƒ¼ãƒ ã‚’æŒ‡å®šã—ã¦ã€ã“ã®åˆ¶é™ã‚’å›é¿ã§ãã¾ã™

- ãƒ–ãƒ©ãƒ³ãƒãƒ«ãƒ¼ãƒ«:

![](/assets/4b001d2e8440/1*Hzd9CCTsu18kyDR1goRWag.png)

- Restrict deletions: ãƒ–ãƒ©ãƒ³ãƒã®å‰Šé™¤ã‚’ç¦æ­¢ã™ã‚‹

- Require a pull request before mergin: ãƒãƒ¼ã‚¸å‰ã«ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¿…é ˆã«ã™ã‚‹  
  Required approvals: å¿…è¦ãªæ‰¿èªäººæ•°ã‚’è¨­å®šã™ã‚‹

- Require status checks to pass: ãƒãƒ¼ã‚¸ã«å¿…è¦ãªãƒã‚§ãƒƒã‚¯ã®åˆæ ¼ã‚’åˆ¶é™ã™ã‚‹  
  ã€Œ+ Add checksã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã€ŒTestingã€ã¨å…¥åŠ›ã—ã¦GitHub Actionsã®ãƒãƒ¼ã‚¯ãŒä»˜ã„ã¦ã„ã‚‹ã‚‚ã®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚  
  **ã“ã“ã§å°ã•ãªå•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã—Suggestionsã«** **`Testing`ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€å…ˆã«Actionsã«æˆ»ã£ã¦ï¼ˆPRã‚’ä½œæˆã—ã¦ï¼‰ä¸€åº¦æˆåŠŸã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**

![](/assets/4b001d2e8440/1*MRPwUEVVbbz8nH0sS2hFfQ.png)

- Block force pushes: Force push ã‚’ç¦æ­¢ã™ã‚‹

ä¿å­˜ã—ã€Enforcement status ãŒ Active ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒ«ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

**ã™ã¹ã¦è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ã€PRã‚’é–‹ã„ã¦ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š**

![](/assets/4b001d2e8440/1*iPETBWx6Boq12rY1fHXmuQ.png)

- Checks ã« CI-Testingï¼ˆ**å¿…é ˆ**ï¼‰ã€Merging is blockedã€At least X approving review is required by reviewers with write access ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€è¨­å®šã¯æˆåŠŸã—ã¦ã„ã¾ã™ã€‚

**ã‚‚ã—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ãŸå ´åˆï¼ˆBuild Failedï¼‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ï¼š**

![](/assets/4b001d2e8440/1*4E35VRPo--pI8uqrR4UZNA.png)

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã¯æˆåŠŸã—ãŸãŒãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå¤±æ•—ã—ãŸå ´åˆ (Test Failed) ã«ã‚³ãƒ¡ãƒ³ãƒˆï¼š**

![](/assets/4b001d2e8440/1*wYFzsn5a_yvi8CbZxi-QdQ.png)

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãƒ†ã‚¹ãƒˆã‚‚æˆåŠŸã—ãŸå ´åˆï¼ˆTest Successï¼‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ï¼š**

![](/assets/4b001d2e8440/1*WqPK1629jYdYTEWCWBHWqg.png)

**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èªï¼‹ãƒ†ã‚¹ãƒˆé€šéå¾Œï¼š**

![[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/4b001d2e8440/1*5gnQYdVAOtGR-bMK4ZrOhA.png)

[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

ã“ã‚Œã§ PR ã‚’ãƒãƒ¼ã‚¸ã§ãã¾ã™ã€‚

- Pushã§æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆãŒã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«Checksãƒ†ã‚¹ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [CI-Testing.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/CI-Testing.yml){:target="_blank"}**

**è‡ªå‹•ãƒãƒ¼ã‚¸ï¼š**

ã¾ãŸã€Repo Settings â†’ General â†’ Pull Request ã®ä¸­ã®ä»¥ä¸‹ã‚‚æœ‰åŠ¹ã«ã§ãã¾ã™ï¼š

![](/assets/4b001d2e8440/1*hl6mfqnnv_zAA3YVrI_M0w.png)

- Automatically delete head branches: PRãƒãƒ¼ã‚¸å¾Œã«ãƒ–ãƒ©ãƒ³ãƒã‚’è‡ªå‹•ã§å‰Šé™¤

- Allow Auto-merge: ãƒã‚§ãƒƒã‚¯ãŒé€šéã—ã€æ¡ä»¶ã‚’æº€ãŸã—ãŸæ‰¿èªãŒå¾—ã‚‰ã‚ŒãŸå ´åˆã«è‡ªå‹•ã§PRã‚’ãƒãƒ¼ã‚¸ã—ã¾ã™  
  **æ¡ä»¶ãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã€ã‹ã¤ç¾åœ¨ã®æ¡ä»¶ã§ã¾ã ãƒãƒ¼ã‚¸ã§ããªã„å ´åˆã«ã®ã¿ã€ŒEnable auto-mergeã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**

![](/assets/4b001d2e8440/1*gi0LaaMVXit-DGKnsxS1lQ.png)

### CD â€” Firebase App Distributionã¸ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

#### ãƒ•ãƒ­ãƒ¼

GitHub Actions ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒˆãƒªã‚¬ãƒ¼ã§ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚„ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã§ãã¾ã™ã€‚ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã¯è‡ªå‹•ã§ Firebase App Distribution ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€ãƒãƒ¼ãƒ ãŒãƒ†ã‚¹ãƒˆç”¨ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚

#### CD-Deploy.yml

Repo â†’ Actions â†’ New workflow â†’ è‡ªåˆ†ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

```yaml
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(Action) åç§°
name: CD-Deploy

# Actions ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«å
run-name: "[CD-Deploy] ${{ github.ref }}"

# åŒã˜ Concurrency Group ã«æ–°ã—ã„ã‚¸ãƒ§ãƒ–ãŒæ¥ãŸã‚‰å®Ÿè¡Œä¸­ã®ã‚‚ã®ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
# ä¾‹ãˆã°åŒã˜ãƒ–ãƒ©ãƒ³ãƒã®ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ãŒé‡è¤‡ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸå ´åˆã€å‰ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
concurrency:
  group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }}
  cancel-in-progress: true

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒ ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:
    # ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›é …ç›®
    inputs:
      # ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·
      VERSION_NUMBER:
        description: 'ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ï¼ˆä¾‹: 1.0.0ï¼‰ã€‚ç©ºæ¬„ã®å ´åˆã¯Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰è‡ªå‹•æ¤œå‡ºã€‚'
        required: false
        type: string
      # ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ç•ªå·
      BUILD_NUMBER:
        description: 'ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ç•ªå·ï¼ˆä¾‹: 1ï¼‰ã€‚ç©ºæ¬„ã®å ´åˆã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä½¿ç”¨ã€‚'
        required: false
        type: string
      # ã‚¢ãƒ—ãƒªã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ
      RELEASE_NOTE:
        description: 'ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã€‚'
        required: false
        type: string
  # ä»–ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒˆãƒªã‚¬ãƒ¼
  # Nightly Buildã§å‘¼ã³å‡ºã—åˆ©ç”¨
  workflow_call:
    inputs:
      # ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·
      VERSION_NUMBER:
        description: 'ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ï¼ˆä¾‹: 1.0.0ï¼‰ã€‚ç©ºæ¬„ã®å ´åˆã¯Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰è‡ªå‹•æ¤œå‡ºã€‚'
        required: false
        type: string
      # ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ç•ªå·
      BUILD_NUMBER:
        description: 'ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ç•ªå·ï¼ˆä¾‹: 1ï¼‰ã€‚ç©ºæ¬„ã®å ´åˆã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä½¿ç”¨ã€‚'
        required: false
        type: string
      # ã‚¢ãƒ—ãƒªã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ
      RELEASE_NOTE:
        description: 'ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã€‚'
        required: false
        type: string
      BRANCH:
        description: 'ãƒ–ãƒ©ãƒ³ãƒ'
        type: string


# ã‚°ãƒ­ãƒ¼ãƒãƒ«é™çš„å¤‰æ•°å®šç¾©
env:
  APP_STORE_CONNECT_API_KEY_FILE_NAME: "app_store_connect_api_key.json"

# ã‚¸ãƒ§ãƒ–å®šç¾©
# ã‚¸ãƒ§ãƒ–ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # ã‚¸ãƒ§ãƒ–ID
  deploy:
    # ã‚¸ãƒ§ãƒ–åï¼ˆçœç•¥å¯ã€‚ãƒ­ã‚°è¡¨ç¤ºç”¨ã«è¨­å®šæ¨å¥¨ï¼‰
    name: Deploy - Firebase App Distribution
    
    # ãƒ©ãƒ³ãƒŠãƒ¼ãƒ©ãƒ™ãƒ« - GitHub Hosted Runner macos-15ã‚’ä½¿ç”¨
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Public Repoãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Public Repoãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # æ³¨æ„ï¼šã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Public Repoãªã®ã§ç„¡åˆ¶é™ã«ç„¡æ–™åˆ©ç”¨å¯èƒ½
    # Private Repoã®å ´åˆã¯å¾“é‡èª²é‡‘ã§ã€macOSã¯æœ€ã‚‚é«˜ä¾¡ï¼ˆ10å€ï¼‰ã€10å›å®Ÿè¡Œã§2,000åˆ†ç„¡æ–™ä¸Šé™ã«é”ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    # self-hosted Runnerã®åˆ©ç”¨ã‚’æ¨å¥¨
    runs-on: macos-15

    # æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®šã—ã€ç•°å¸¸æ™‚ã®ç„¡é™å¾…æ©Ÿã‚’é˜²æ­¢
    timeout-minutes: 30

    # zshã‚’ä½¿ç”¨
    # çœç•¥å¯ã€‚ç­†è€…ã¯zshã‚’å¥½ã‚€ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯bash
    defaults:
      run:
        shell: zsh {0}

    # ã‚¹ãƒ†ãƒƒãƒ—
    # ã‚¹ãƒ†ãƒƒãƒ—ã¯é †æ¬¡å®Ÿè¡Œã•ã‚Œã‚‹  
    steps:
      # git cloneã§ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã€å®Ÿè¡Œãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆ
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          # Git Large File Storageã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ä¸è¦
          # default: false
          lfs: false
          
          # æŒ‡å®šãŒã‚ã‚Œã°ãã®ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã€‚ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒï¼‰
          # on: schedule ã¯mainãƒ–ãƒ©ãƒ³ãƒã§ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€Nightly Buildãªã©ã§ã¯åˆ¥ãƒ–ãƒ©ãƒ³ãƒæŒ‡å®šãŒå¿…è¦
          # ä¾‹: on: schedule -> mainãƒ–ãƒ©ãƒ³ãƒã€Nightly Buildã¯masterãƒ–ãƒ©ãƒ³ãƒ
          ref: ${{ github.event.inputs.BRANCH \\|\\| '' }}

      # ========== è¨¼æ˜æ›¸é–¢é€£ã‚¹ãƒ†ãƒƒãƒ— ==========
      
      # Fastlane - Matchã‚’ä½¿ã„é–‹ç™ºè¨¼æ˜æ›¸ã‚’ç®¡ç†ã—ã€Laneå†…ã§matchã‚’å®Ÿè¡Œã—ã¦è¨­å®šã™ã‚‹ã®ãŒæ¨å¥¨
      # Matchã¯åˆ¥ã®Private Repoã§è¨¼æ˜æ›¸ã‚’ç®¡ç†ã€‚SSH Agentè¨­å®šãŒå¿…è¦ã§private repoã®git cloneæ¨©é™ã‚’ä»˜ä¸
      # ref: https://stackoverflow.com/questions/57612428/cloning-private-github-repository-within-organisation-in-actions
      #
      #
      # --- Fastlane - Matchã‚’ä½¿ã‚ãªã„å ´åˆã®è¨¼æ˜æ›¸ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼†ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹æ–¹æ³• ---
      # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development
      #
      # GitHub Actions Secretã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã§ããªã„ãŸã‚ã€ã™ã¹ã¦ã®è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã¯Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—ã§Secretã«ä¿å­˜
      # Actionsã®ã‚¹ãƒ†ãƒƒãƒ—ã§å‹•çš„ã«èª­ã¿å‡ºã—ã¦ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã€æ­£ã—ã„å ´æ‰€ã«ç§»å‹•ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
      # è©³ç´°ã¯è¨˜äº‹ã‚’å‚ç…§
      #
      - name: Install the Apple certificate and provisioning profile
        env:
          BUILD_CERTIFICATE_BASE64: ${{ secrets.BUILD_CERTIFICATE_BASE64 }}
          P12_PASSWORD: ${{ secrets.BUILD_CERTIFICATE_P12_PASSWORD }}
          BUILD_PROVISION_PROFILE_BASE64: ${{ secrets.BUILD_PROVISION_PROFILE_BASE64 }}
          # GitHub Hosted Runnerã¯ä»»æ„ã®æ–‡å­—åˆ—
          # Self-hosted Runnerã¯ãƒã‚·ãƒ³ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          KEYCHAIN_PASSWORD: ${{ secrets.KEYCHAIN_PASSWORD }}
        run: \\|
          # å¤‰æ•°ä½œæˆ
          CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12
          PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision
          KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db

          # Secretã‹ã‚‰è¨¼æ˜æ›¸ã¨ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ä¿å­˜
          echo -n "$BUILD_CERTIFICATE_BASE64" \\| base64 --decode -o $CERTIFICATE_PATH
          echo -n "$BUILD_PROVISION_PROFILE_BASE64" \\| base64 --decode -o $PP_PATH

          # ä¸€æ™‚ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ä½œæˆ
          security create-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
          security set-keychain-settings -lut 21600 $KEYCHAIN_PATH
          security unlock-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH

          # ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã«è¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
          security import $CERTIFICATE_PATH -P "$P12_PASSWORD" -A -t cert -f pkcs12 -k $KEYCHAIN_PATH
          security set-key-partition-list -S apple-tool:,apple: -k "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
          security list-keychain -d user -s $KEYCHAIN_PATH

          # ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é©ç”¨
          mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
          cp $PP_PATH ~/Library/MobileDevice/Provisioning\ Profiles

      # App Store Connect API Fastlane JSON Key
      # ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã§ã»ã¼å¿…é ˆã®App Store Connect API Fastlane JSON Key (.json)
      # format: .jsonã®å†…å®¹ï¼šhttps://docs.fastlane.tools/app-store-connect-api/
      # ä¸­ã«App Store Connect APIã®.p8ã‚­ãƒ¼ãŒå«ã¾ã‚Œã‚‹
      # Fastlaneã«æ¸¡ã—ã¦Testflightã‚„App Store APIã«åˆ©ç”¨
      #
      # GitHub Actions Secretã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã§ããªã„ãŸã‚ã€ã™ã¹ã¦Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦Secretã«ä¿å­˜
      # Actionsã‚¹ãƒ†ãƒƒãƒ—ã§å‹•çš„ã«èª­ã¿å‡ºã—ã¦ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã€ä»–ã®ã‚¹ãƒ†ãƒƒãƒ—ã§åˆ©ç”¨
      # è©³ç´°ã¯è¨˜äº‹å‚ç…§
      - name: Read and Write Apple Store Connect API Key to Temp
        env:
          APP_STORE_CONNECT_API_KEY_BASE64: ${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}
          APP_STORE_CONNECT_API_KEY_PATH: "${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}"
        run: \\|
          # Secretã‹ã‚‰APIã‚­ãƒ¼ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ä¿å­˜
          echo -n "$APP_STORE_CONNECT_API_KEY_BASE64" \\| base64 --decode -o $APP_STORE_CONNECT_API_KEY_PATH

      # ========== ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ãƒ†ãƒƒãƒ— ==========
      
      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šã®Xcodeãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
      # å¾Œç¶šã§æ‰‹å‹•ã§æŒ‡å®šã—ãŸXcode_x.x.x.appã‚’ä½¿ã†
      # xcversionã¯éæ¨å¥¨ã§ä¸å®‰å®šãªãŸã‚ä½¿ã‚ãªã„
      - name: Read .xcode-version
        id: read_xcode_version
        run: \\|
          XCODE_VERSION=$(cat .xcode-version)
          echo "XCODE_VERSION: ${XCODE_VERSION}"
          echo "xcode_version=${XCODE_VERSION}" >> $GITHUB_OUTPUT

          # ã“ã“ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«Xcodeãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã‚‚å¯èƒ½ï¼ˆå¾Œç¶šã‚¹ãƒ†ãƒƒãƒ—ã§DEVELOPER_DIRæŒ‡å®šä¸è¦ï¼‰
          # ãŸã ã—sudoæ¨©é™ãŒå¿…è¦ã€‚self-hosted runnerãªã‚‰runnerå®Ÿè¡Œç’°å¢ƒã«sudoæ¨©é™ãŒã‚ã‚‹ã‹è¦ç¢ºèª
          # sudo xcode-select -s "/Applications/Xcode_${XCODE_VERSION}.app/Contents/Developer"

      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šã®Rubyãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
      - name: Read .ruby-version
        id: read_ruby_version
        run: \\|
          RUBY_VERSION=$(cat .ruby-version)
          echo "RUBY_VERSION: ${RUBY_VERSION}"
          echo "ruby_version=${RUBY_VERSION}" >> $GITHUB_OUTPUT

      # ãƒ©ãƒ³ãƒŠãƒ¼ã®Rubyãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«è¨­å®š
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "${{ steps.read_ruby_version.outputs.ruby_version }}"

      # ä»»æ„è¨­å®šã€‚self-hostedã§è¤‡æ•°runnerãŒåŒæ™‚ã«CI/CDå®Ÿè¡Œæ™‚ã€cocoapods reposãŒå…±æœ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§è¡çªã™ã‚‹å•é¡Œã‚’å›é¿
      # GitHub Hosted Runnerã§ã¯ä¸è¦
      # - name: Change Cocoapods Repos Folder
      #   if: contains(runner.labels, 'self-hosted')
      #   run: \\|
      #     # å„Runnerã”ã¨ã«ç‹¬è‡ªã®.cocoapodsãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½¿ç”¨ã—ãƒªã‚½ãƒ¼ã‚¹è¡çªã‚’é˜²æ­¢
      #     mkdir -p "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/"
      #     export CP_HOME_DIR="$HOME/.cocoapods-${{ env.RUNNER_NAME }}"
      #     rm -f "$HOME/.cocoapods-${{ env.RUNNER_NAME }}/repos/cocoapods/.git/index.lock"

      # ========== ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šã‚¹ãƒ†ãƒƒãƒ— ==========
      # æ³¨æ„ï¼šself-hostedã§ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§å®¹é‡è¨ˆç®—ã•ã‚Œã‚‹
      # ãƒ«ãƒ¼ãƒ«ï¼š7æ—¥é–“æœªãƒ’ãƒƒãƒˆã§è‡ªå‹•å‰Šé™¤ã€1ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€å¤§10GBã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸæ™‚ã®ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      # Public Repo: ç„¡åˆ¶é™ç„¡æ–™
      # Private Repo: 5GBã‹ã‚‰
      # Self-hostedã¯ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã©ã§ç‹¬è‡ªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’çµ„ã‚€ã‹ä»–ãƒ„ãƒ¼ãƒ«åˆ©ç”¨æ¨å¥¨
      
      # Bundle Cache (Gemfile)
      # Makefileã§Bundleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’./vendorã«æŒ‡å®šã—ã¦ã„ã‚‹
      - name: Cache Bundle
        uses: actions/cache@v3
        with:
          path: \\|
            ./vendor
          key: ${{ runner.os }}-bundle-${{ hashFiles('Gemfile.lock') }}
          restore-keys: \\|
            ${{ runner.os }}-bundle-

      # CocoaPods Cache (Podfile)
      # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸‹ã®Podsãƒ•ã‚©ãƒ«ãƒ€
      - name: Cache CocoaPods
        uses: actions/cache@v3
        with:
          path: \\|
            ./Product/Pods
          key: ${{ runner.os }}-cocoapods-${{ hashFiles('Product/Podfile.lock') }}
          restore-keys: \\|
            ${{ runner.os }}-cocoapods-

      # Mint cache
      # Makefileã§Mintã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’./mintã«æŒ‡å®šã—ã¦ã„ã‚‹
      - name: Cache Mint
        uses: actions/cache@v3
        with:
          path: ./mint
          key: ${{ runner.os }}-mint-${{ hashFiles('Mintfile') }}
          restore-keys: \\|
            ${{ runner.os }}-mint-

      # ====================

      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼†ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Setup & Install Dependency
        run: \\|
          # Makefileã®setupã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã€‚ä¸­èº«ã¯ãŠãŠã‚ˆãä»¥ä¸‹
          # brew install mint
          # bundle config set path 'vendor/bundle'
          # bundle install
          # mint bootstrap
          # ...
          make setup

          # Makefileã®installã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã€‚ä¸­èº«ã¯ãŠãŠã‚ˆãä»¥ä¸‹
          # mint run yonaskolb/XcodeGen --quiet
          # bundle exec pod install
          # ...
          make install

      - name: Deploy Beta
        id: deploy
        # ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®šã€‚ä»¥é™ã®ã‚³ãƒãƒ³ãƒ‰ã§cdä¸è¦
        working-directory: ./Product/
        env:
          # ãƒ“ãƒ«ãƒ‰å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
          VERSION_NUMBER: ${{ inputs.VERSION_NUMBER \\|\\| '' }}
          BUILD_NUMBER: ${{ inputs.BUILD_NUMBER \\|\\| '' }}
          RELEASE_NOTE: ${{ inputs.RELEASE_NOTE \\|\\| '' }}
          AUTHOR: ${{ github.actor }}

          # Repo -> Settings -> Actions secrets and variables -> secrets
          # Firebase CLI Tokenï¼ˆå–å¾—æ–¹æ³•ã¯è¨˜äº‹å‚ç…§ï¼‰
          FIREBASE_CLI_TOKEN: ${{ secrets.FIREBASE_CLI_TOKEN }}
          # Apple Developer Program Team ID
          TEAM_ID: ${{ secrets.TEAM_ID }}
                    
          # ã“ã®ã‚¸ãƒ§ãƒ–ã§ä½¿ç”¨ã™ã‚‹XCodeãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
          DEVELOPER_DIR: "/Applications/Xcode_${{ steps.read_xcode_version.outputs.xcode_version }}.app/Contents/Developer"
        run: \\|
          # ç¾åœ¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å–å¾—
          BUILD_TIMESTAMP=$(date +'%Y%m%d%H%M%S')

          # BUILD_NUMBERãŒç©ºãªã‚‰ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ“ãƒ«ãƒ‰ç•ªå·ã«è¨­å®š
          BUILD_NUMBER="${BUILD_NUMBER:-$BUILD_TIMESTAMP}"
  
          ID="${{ github.run_id }}"
          COMMIT_SHA="${{ github.sha }}"
          BRANCH_NAME="${{ github.ref_name }}"
          AUTHOR="${{ env.AUTHOR }}"

          # ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’çµ„ã¿ç«‹ã¦
          RELEASE_NOTE="${{ env.RELEASE_NOTE }}
          ID: ${ID}
          Commit SHA: ${COMMIT_SHA}
          Branch: ${BRANCH_NAME}
          Author: ${AUTHOR}
          "

          # Fastlaneã§ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤Laneã‚’å®Ÿè¡Œ
          bundle exec fastlane beta release_notes:"${RELEASE_NOTE}" version_number:"${VERSION_NUMBER}" build_number:"${BUILD_NUMBER}"

      # GitHub Actionsæ¨å¥¨ã®self-hostedã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼š
      # ref: https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development#required-clean-up-on-self-hosted-runners
      # Step: Install the Apple certificate and provisioning profileã«å¯¾å¿œ
      # ãƒã‚·ãƒ³ä¸Šã®è¨¼æ˜æ›¸ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚
      # Matchã‚’ä½¿ã†å ´åˆã¯Matchã®ã‚¯ãƒªãƒ¼ãƒ³ã«æ›¸ãæ›ãˆãŒå¿…è¦
      - name: Clean up keychain and provisioning profile
        if: ${{ always() && contains(runner.labels, 'self-hosted') }}
        run: \\|
          security delete-keychain $RUNNER_TEMP/app-signing.keychain-db
          rm ~/Library/MobileDevice/Provisioning\ Profiles/build_pp.mobileprovision
```

- Repo -> Settings -> Actions secrets and variables -> secrets ã« `TEAM_ID` ã¨ã„ã†å¤‰æ•°ã‚’è¿½åŠ ã—ã€å†…å®¹ã¯ Apple Developer Team ID ã®æ–‡å­—åˆ—ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

![](/assets/4b001d2e8440/1*dxdmT_N_w_VUd56f6GRLSQ.png)

**Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ã€ãƒ“ãƒ«ãƒ‰æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š**

![](/assets/4b001d2e8440/1*Z_UAfWAsJSIoWxeTRMvtDQ.png)

> *ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã§ã“ã® Action ã‚’ä½¿ã†å ´åˆã¯ã€äº‹å‰ã«ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã® CD-Deploy.yml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚*

**ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’å¾…ã¤ï¼š**

![](/assets/4b001d2e8440/1*Q-c2IUlJpssooiqcqcm_Bg.png)

![[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16114046420){:target="_blank"}](/assets/4b001d2e8440/1*W8PBkatfsITMDFSlp7xpjg.png)

[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16114046420){:target="_blank"}

> ***ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ï¼‹ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ âœ…***

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [CD-Deploy.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/CD-Deploy.yml){:target="_blank"}**

#### æŠ€è¡“çš„è©³ç´° â€” Firebase CLI ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ï¼†è¨­å®š

Firebase å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ï¼ˆ[ãƒªãƒ³ã‚¯](https://firebase.google.com/docs/cli?hl=zh-tw#install-cli-mac-linux){:target="_blank"}ï¼‰ï¼š

ã¾ãš Firebase CLI ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

```bash
curl -sL https://firebase.tools \\| bash
```

å®Ÿè¡Œï¼š

```bash
firebase login:ci
```

ãƒ­ã‚°ã‚¤ãƒ³ã¨èªè¨¼ã‚’å®Œäº†ã™ã‚‹ï¼š

![](/assets/4b001d2e8440/1*Jex5aYzRSs7Trfx6z_e1Aw.png)

![](/assets/4b001d2e8440/1*S-1ckn9WC6j0DIqZGSdUUg.png)

Terminal ã«æˆ»ã‚Šã€Firebase CLI ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™:

![](/assets/4b001d2e8440/1*sa_h8L08JbeC2nA0kACQtQ.png)

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ `FIREBASE_CLI_TOKEN` ã‚’è¿½åŠ ã—ã€Firebase CLI ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

![](/assets/4b001d2e8440/1*Lc6yGPu7L_0z6u1HH2PB5A.png)

> ***ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã‚ãªãŸã®ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼æƒ…å ±ã§ã™ã€‚*** *å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é€€è·ã™ã‚‹å ´åˆã¯å¿…ãšæ›´æ–°ãŒå¿…è¦ã§ã™ã€‚*

#### æŠ€è¡“çš„è©³ç´° â€” Appleè¨¼æ˜æ›¸ã¨ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Runnerã«é–‹ç™ºè¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹æ‰‹é †ã®è©³ç´°ã€‚

GitHub Actions ã® Secret ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã§ããªã„ãŸã‚ã€ã™ã¹ã¦ã®è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã¯äº‹å‰ã« Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—åˆ—ã¨ã—ã¦ Secrets ã«ä¿å­˜ã—ã¾ã™ã€‚GitHub Actions ã®ã‚¹ãƒ†ãƒƒãƒ—å†…ã§å‹•çš„ã«èª­ã¿è¾¼ã¿ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã€æ­£ã—ã„å ´æ‰€ã«ç§»å‹•ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ãŒèª­ã¿å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

**Developmentãƒ“ãƒ«ãƒ‰ã«ã¯2ã¤ã®éµè¨¼æ˜æ›¸ãŒå¿…è¦ã§ã™ï¼š**

- [Provision Profile ( .mobileprovision)](https://developer.apple.com/account/resources/certificates/list){:target="_blank"}

- [é–‹ç™ºè¨¼æ˜æ›¸ (.p12)](https://developer.apple.com/account/resources/certificates/list){:target="_blank"}

![cicd.mobileprovision](/assets/4b001d2e8440/1*WXqqnErto3nn8rnNg6TXgw.png)

cicd.mobileprovision

![development.cer](/assets/4b001d2e8440/1*RkeZ1PkXeY9Nt1kSRJKEQw.png)

development.cer

å¾ [Apple Developer](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ Certificate ã¯ .cer å½¢å¼ã§ã™ãŒã€å¿…è¦ãªã®ã¯ .p12 å½¢å¼ã§ã™ã€‚ã¾ãšãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ .cer ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ Keychain ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Keychain ã‚’é–‹ã„ã¦è©²å½“ã®è¨¼æ˜æ›¸ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€Export ã§æ›¸ãå‡ºã—ã¾ã™ã€‚

![](/assets/4b001d2e8440/1*HJMxwM3IDjxT-UGqnoUtWw.png)

ãƒ•ã‚¡ã‚¤ãƒ«åï¼šcicd.p12ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ .p12

P12 ã‚­ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼šå®‰å…¨ãªã‚«ã‚¹ã‚¿ãƒ æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ã¯è‰¯ããªã„ä¾‹ã§ã€`123456` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼‰

![](/assets/4b001d2e8440/1*tyH0XqDVPGPWFJPL4dxksw.png)

![](/assets/4b001d2e8440/1*qKeZWel3w_5wW7meMtHmLA.png)

**ç¾åœ¨ã€2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼š** cicd.p12ã€cicd.mobileprovision ãŒæº–å‚™ã§ãã¾ã—ãŸ

**BASE64å½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦Repo Secretsã«ä¿å­˜ï¼š**

```bash
base64 -i cicd.mobileprovision \\| pbcopy
```

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ `BUILD_PROVISION_PROFILE_BASE64` ã‚’è¿½åŠ ã—ã€ä¸Šè¨˜ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

-

```bash
base64 -i cicd.p12 \\| pbcopy
```

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ æ–°ã—ã„ Secret ã‚’è¿½åŠ ï¼š`BUILD_CERTIFICATE_BASE64` ã«ä¸Šè¨˜ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

-

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ æ–°ã—ã„ Secret ã‚’è¿½åŠ ï¼š`P12_PASSWORD` å†…å®¹ã¯å…ˆã»ã©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸ P12 éµã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚

-
Repo â†’ Settings â†’ Secrets and variables â†’ Actions ã«ç§»å‹•ã—ã€Secret ã‚’è¿½åŠ ã—ã¾ã™ï¼š`KEYCHAIN_PASSWORD`  
GitHub Hosted Runner ã®å ´åˆã¯ä»»æ„ã®æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚**Self-hosted Runner ã®å ´åˆã¯ macOS Runner ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚**

![](/assets/4b001d2e8440/1*JZCkFUJCQsggqYtW8acjTw.png)

#### æŠ€è¡“çš„è©³ç´° â€” App Store Connect API Key

Fastlane ã§ App Store ã‚„ Testflight ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«å¿…è¦ãª [.json ã‚­ãƒ¼](https://docs.fastlane.tools/app-store-connect-api/){:target="_blank"} ã¯ã€GitHub Actions Secrets ãŒæ–‡å­—åˆ—ã®ã¿ä¿å­˜å¯èƒ½ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã§ããªã„åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ã€ã‚­ãƒ¼ã®å†…å®¹ã‚’ Base64 æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚GitHub Actions ã®ã‚¹ãƒ†ãƒƒãƒ—å†…ã§å‹•çš„ã«èª­ã¿è¾¼ã¿ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—ã¦ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ Fastlane ã«æ¸¡ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

**ã¾ãšã¯ [App Store Connect ã§ App Store Connect API Key](../f1365e51902c/)ï¼ˆ.p8ï¼‰ã‚’ä½œæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š**

```vbnet
-----BEGIN PRIVATE KEY-----
sss
axzzvcxz
zxzvzcxv
vzxcvzxvczxcvz
-----END PRIVATE KEY-----
```

`app_store_connect_api.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°è¦ä½œæˆã™ã‚‹ï¼ˆ[å†…å®¹å‚è€ƒ](https://docs.fastlane.tools/app-store-connect-api/){:target="_blank"}ï¼‰ï¼š

```bash
{
  "key_id": "App Store Connect ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ Key ID",
  "issuer_id": "App Store Connect ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ Issuer ID",
  "key": "-----BEGIN PRIVATE KEY-----æ”¹è¡Œã¯\nã«ç½®ãæ›ãˆã¦ãã ã•ã„-----END PRIVATE KEY-----",
  "duration": 1200, # ä»»æ„ï¼ˆæœ€å¤§1200ï¼‰
  "in_house": false # ä»»æ„ã§ã™ãŒã€match/sigh ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯å¿…è¦ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™
}
```

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ãŸå¾Œã«å®Ÿè¡Œï¼š

```bash
base64 -i app_store_connect_api.json \\| pbcopy
```

# è§£èª¬
# `app_store_connect_api.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã€ãã®çµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

æ–‡å­—åˆ—ã®å†…å®¹ã‚’ Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ æ–°ã—ã„ Secret: `APP_STORE_CONNECT_API_KEY_BASE64` ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚

![](/assets/4b001d2e8440/1*QxRuxEPEfWbJ383hhnxGkA.png)

`Read and Write Apple Store Connect API Key to Temp` ã‚¹ãƒ†ãƒƒãƒ—å®Œäº†å¾Œã€ä»¥é™ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ env `APP_STORE_CONNECT_API_KEY_PATH` ã‚’æ¸¡ã™ã ã‘ã§ã‚ˆã„ï¼š

```yaml
- name: Deploy
  env:
    APP_STORE_CONNECT_API_KEY_PATH: "${{ runner.temp }}/${{ env.APP_STORE_CONNECT_API_KEY_FILE_NAME }}"
  run: \\|
    ....
```

Fastlane ã¯è‡ªå‹•çš„ã«å–å¾—ã§ãã¾ã™ã€‚

#### æŠ€è¡“æ‹¡å¼µ â€” Reuse Action Workflow ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ†å‰²ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€Fastlaneã® `beta` ãƒ¬ãƒ¼ãƒ³ã‚’ä½¿ã£ã¦ã€ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®2ã¤ã®å‡¦ç†ã‚’ç›´æ¥å®Ÿè¡Œã—ã¾ã™ã€‚

å®Ÿéš›ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€åŒã˜ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ç•°ãªã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆFirebaseã€Testflightãªã©ï¼‰ã«ãã‚Œãã‚Œãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã¯ä¸€ã¤ã®Actionã€ãƒ‡ãƒ—ãƒ­ã‚¤ã¯åˆ¥ã®Actionã«åˆ†ã‘ã‚‹ã®ãŒæœ›ã¾ã—ã„ã§ã™ã€‚ãã†ã—ãªã„ã¨ãƒ“ãƒ«ãƒ‰ãŒäºŒåº¦å®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã—ã€CI/CDã®è²¬ä»»åˆ†æ‹…ã«ã‚‚é©ã—ã¦ã„ã¾ã™ã€‚

> ***ä»¥ä¸‹ã¯ã‚µãƒ³ãƒ—ãƒ«ç´¹ä»‹ã§ã™ï¼š***

**CI-Build.yml:**

```yaml
name: Build

on:
  push:
    branches:
      - main
  workflow_call:
     inputs:
        RELEASE_NOTE:
          description: 'ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã€‚'
          required: false
          type: string

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: \\|
          make steup
          make instal

      - name: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰
        run: bundle exec fastlane build

      - name: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4
        with:
          name: build-artifact
          path: ./fastlane/build/
```

**CD-Deploy-Firebase.yml:**

```yaml
name: Deploy Firebase

on:
  # Build ActionãŒå®Œäº†ã—ãŸã¨ãã«è‡ªå‹•ã§ãƒˆãƒªã‚¬ãƒ¼
  workflow_run:
    workflows: ["Build"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    # å®Œäº†ã‹ã¤æˆåŠŸæ™‚ã«ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: \\|
          make steup

      - name: Download Build Artifact
        uses: actions/download-artifact@v4
        with:
          name: build-artifact
          path: ./fastlane/build/

      - name: Deploy to Production
        run: \\|
          bundle exec fastlane deploy-firebase
```

**CD-Deploy-Testflight.yml:**

```yaml
name: Deploy Testflight

on:
  # Build Action å®Œäº†æ™‚ã«è‡ªå‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹
  workflow_run:
    workflows: ["Build"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    # å®Œäº†ã‹ã¤æˆåŠŸæ™‚ã«ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: \\|
          make steup

      - name: Download Build Artifact
        uses: actions/download-artifact@v4
        with:
          name: build-artifact
          path: ./fastlane/build/

      - name: Deploy to Production
        run: \\|
          bundle exec fastlane deploy-testflight
```

**ã¾ãŸã€[Reusing Workflow](https://docs.github.com/en/actions/how-tos/sharing-automations/reusing-workflows){:target="_blank"} ã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ï¼š**

**CD-Deploy-Firebase.yml:**

```yaml
name: Deploy Firebase

on:
  # ä»»æ„ã®ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ã€ã“ã“ã§ã¯æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒ ãƒˆãƒªã‚¬ãƒ¼ã®ä¾‹
  workflow_dispatch:
    inputs:
      RELEASE_NOTE:
        description: 'ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã€‚'
        required: false
        type: string
jobs:
  build:
    needs: Build
    uses: ./.github/workflows/CD-Build.yml
    secrets: inherit
    with:
      RELEASE_NOTE: ${{ inputs.RELEASE_NOTE }}

  deploy:
    runs-on: ubuntu-latest
    # ã‚¸ãƒ§ãƒ–ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦è¡Œå®Ÿè¡Œã€needsã§buildå®Œäº†ã‚’å¾…ã¤ã‚ˆã†åˆ¶é™
    needs: [build]
    # æˆåŠŸæ™‚ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
    if: ${{ always() && needs.deploy.result == 'success' }}
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: \\|
          make steup

      - name: Download Build Artifact
        uses: actions/download-artifact@v4
        with:
          name: build-artifact
          path: ./fastlane/build/

      - name: Deploy to Production
        run: \\|
          bundle exec fastlane deploy-firebase
```

#### GitHub Actions â€” Artifact

åŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ã™ãŒã€ç¾åœ¨ **Self-hosted Runner ã® Artifact æ©Ÿèƒ½ã‚‚ GitHub Cloud ã‚’çµŒç”±ã™ã‚‹ãŸã‚** ä½¿ç”¨é‡åˆ¶é™ã‚’å—ã‘ã¾ã™ ( [ç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯500MBã‹ã‚‰](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions#included-storage-and-minutes){:target="_blank"} )ã€‚

> *Self-hosted Runnerã§åŒã˜åŠ¹æœã‚’å¾—ã‚‹ã«ã¯ã€å…±æœ‰ãƒ›ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è‡ªåˆ†ã§ä½œæˆã™ã‚‹ã‹ã€ä»–ã®ãƒ„ãƒ¼ãƒ«ã‚’ä»£æ›¿ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚*

ã—ãŸãŒã£ã¦ã€ç¾åœ¨ Artifact ã¯å®Ÿéš›ã«ã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã‚¨ãƒ©ãƒ¼çµæœã‚„ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãªã©ã€å°ã•ãªãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«ã®ã¿ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

### CIâ€” Nightly Build å®Ÿè¡Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‹å˜ä½“ãƒ†ã‚¹ãƒˆï¼‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‹CD Firebase App Distribution ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

#### ãƒ•ãƒ­ãƒ¼

æ¯æ—¥åˆå‰3æ™‚ã« mainï¼ˆdevelop ã¾ãŸã¯ masterï¼‰ãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã—ã¦å…¨ãƒ†ã‚¹ãƒˆï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‹ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰ã‚’è‡ªå‹•å®Ÿè¡Œã—ã€å¤±æ•—ã—ãŸå ´åˆã¯ Slack ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«å¤±æ•—é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™ã€‚æˆåŠŸã—ãŸå ´åˆã¯ãƒ“ãƒ«ãƒ‰ï¼‹Firebase App Distributionã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã€ãƒ“ãƒ«ãƒ‰ã®æˆåŠŸãƒ»å¤±æ•—ã„ãšã‚Œã‚‚ Slack ã«é€šçŸ¥ã—ã¾ã™ã€‚

#### CI-Nightly-Build-And-Deploy.yml

Repo â†’ Actions â†’ New workflow â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªåˆ†ã§è¨­å®šã™ã‚‹ã€‚

```yaml
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(Action) åç§°
name: CI-Nightly Build And Deploy

# Actions ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«åç§°
run-name: "[CI-Nightly Build And Deploy] ${{ github.ref }}"

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®šæœŸè‡ªå‹•å®Ÿè¡Œ
  # https://crontab.guru/
  # UTCæ™‚é–“
  schedule:
    # UTCã®19:00 = æ¯æ—¥ UTC+8 ã®03:00
    - cron: '0 19 * * *'
  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:

# Job ä½œæ¥­é …ç›®
# Job ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # ãƒ†ã‚¹ãƒˆä½œæ¥­
  testing:
    # Reuse Workflow (workflow_call)
    uses: ./.github/workflows/CI-Testing.yml
    # ã™ã¹ã¦ã® Secrets ã‚’ CD-Testing.yml ã«æ¸¡ã™
    secrets: inherit
    with:
      # å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      TEST_LANE: "run_all_tests"
      # å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒï¼šmain, develop, master ãªã©
      BRANCH: "main"

  deploy-env:
    runs-on: ubuntu-latest
    outputs:
      DATE_STRING: ${{ steps.get_date.outputs.DATE_STRING }}
    steps:
      - name: æ—¥ä»˜æ–‡å­—åˆ—ã‚’å–å¾—
        id: get_date
        run: \\|
          VERSION_DATE=$(date -u '+%Y%m%d')
          echo "${VERSION_DATE}"
          echo "DATE_STRING=${VERSION_DATE}" >> $GITHUB_ENV
          echo "DATE_STRING=${VERSION_DATE}" >> $GITHUB_OUTPUT
    
  deploy:
    # Job ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦è¡Œå®Ÿè¡Œã€needs ã§ testing ã¨ deploy-env ã®å®Œäº†ã‚’å¾…ã¤
    needs: [testing, deploy-env]
    # ãƒ†ã‚¹ãƒˆæˆåŠŸæ™‚ã®ã¿å®Ÿè¡Œ
    if: ${{ needs.testing.result == 'success' }}
    # Reuse Workflow (workflow_call)
    uses: ./.github/workflows/CD-Deploy.yml
    # ã™ã¹ã¦ã® Secrets ã‚’ CD-Deploy.yml ã«æ¸¡ã™
    secrets: inherit
    with:
      VERSION_NUMBER: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }}
      RELEASE_NOTE: NightlyBuild-${{ needs.deploy-env.outputs.DATE_STRING }}
      # å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒï¼šmain, develop, master ãªã©
      BRANCH: "main"

# ----- Slack é€šçŸ¥ -----
  testing-failed-slack-notify:
    needs: [testing]
    runs-on: ubuntu-latest
    if: ${{ needs.testing.result == 'failure' }}
    steps:
      - name: Slack ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿
        uses: slackapi/slack-github-action@v2.1.0
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: \\|
            channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}
            text: ":x: Nightly Build - ãƒ†ã‚¹ãƒˆå¤±æ•—\nWorkflow: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\\|å®Ÿè¡Œã‚’è¡¨ç¤º>"

  deploy-failed-slack-notify:
    needs: [deploy]
    runs-on: ubuntu-latest
    if: ${{ needs.deploy.result == 'failure' }}
    steps:
      - name: Slack ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿
        uses: slackapi/slack-github-action@v2.1.0
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: \\|
            channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}
            text: ":x: Nightly Build Deploy å¤±æ•—\nWorkflow: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\\|å®Ÿè¡Œã‚’è¡¨ç¤º>"

  deploy-success-slack-notify:
    needs: [deploy]
    runs-on: ubuntu-latest
    if: ${{ needs.deploy.result == 'success' }}
    steps:
      - name: Slack ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿
        uses: slackapi/slack-github-action@v2.1.0
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: \\|
            channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}
            text: ":white_check_mark: Nightly Build Deploy æˆåŠŸ\nWorkflow: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\\|å®Ÿè¡Œã‚’è¡¨ç¤º>"
```

**Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã€æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã¨ãƒ“ãƒ«ãƒ‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¦çµæœã‚’ç¢ºèªã—ã¾ã™ï¼š**

![](/assets/4b001d2e8440/1*l71fL8oLoeAv-JX_FgkqzQ.png)

> *ä»Šå¾Œã¯æ¯æ—¥è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚*

![[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target="_blank"}](/assets/4b001d2e8440/1*u6A77KwkXS2SY5-DPPPR9A.png)

[Demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/runs/16119750747){:target="_blank"}

![](/assets/4b001d2e8440/1*6DQL_v4eahSqSuVJZRPrEA.png)

ãƒ†ã‚¹ãƒˆã‚¿ã‚¹ã‚¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¿ã‚¹ã‚¯ã€é€šçŸ¥ã‚¿ã‚¹ã‚¯ãŒã™ã¹ã¦å®Œäº†ã—ãŸã‚‰ã€çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚

![](/assets/4b001d2e8440/1*4UVgyCQljqZQgzxHpXPB4g.png)

![](/assets/4b001d2e8440/1*t9PrQfcTANyvG7gfXXC-bw.jpeg)

ç§ãŸã¡ã¯ç›´æ¥ã‚¹ãƒãƒ›ã« Nightly Build ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€å…ˆè¡Œä½“é¨“ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

#### æŠ€è¡“çš„ãªè©³ç´°

ã“ã® Action ã§ã¯ã€å‰ã«è¨­è¨ˆã—ãŸ CI-Testing ã¨ CD-Deploy ã‚’ãã®ã¾ã¾å†åˆ©ç”¨ã—ã€Nightly Build ã«çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ã€‚éå¸¸ã«æŸ”è»Ÿã§ä½¿ã„ã‚„ã™ã„ã§ã™ï¼

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [CI-Nightly-Build-And-Deploy.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/workflows/CI-Nightly-Build-And-Deploy.yml){:target="_blank"}**

### Self-hosted Runner æ³¨æ„äº‹é …

æœ¬æ–‡ã¯ Public Repo ãªã®ã§ç›´æ¥ GitHub Hosted ã® macOS Runner ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®æ¥­å‹™ã§ã¯å¿…ãš Private Repo ã§ã™ã€‚GitHub Hosted Runner ã‚’ç›´æ¥ä½¿ã†ã¨éå¸¸ã«é«˜é¡ã«ãªã‚‹ãŸã‚ï¼ˆç´„1ãƒ¶æœˆåˆ†ã§ä¼šç¤¾ã« Mac Mini ã‚’ç½®ã„ã¦ä½¿ã„æ”¾é¡Œã«ã—ãŸæ–¹ãŒå®‰ã„ï¼‰ã€æ€§èƒ½ã«å¿œã˜ã¦1å°ã§è¤‡æ•°ã® Runner ã‚’ç«‹ã¡ä¸Šã’ã¦åŒæ™‚ã«ã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

> ***è©³ç´°ã¯[å‰å›ã®è¨˜äº‹](../404bd5c70040/)ã®ã€Œ[Self-hosted Runner ã®æ§‹ç¯‰ã¨åˆ‡ã‚Šæ›¿ãˆ](../404bd5c70040/)ã€éƒ¨åˆ†ã‚’ã”å‚ç…§ãã ã•ã„*** *ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‘ã‚½ã‚³ãƒ³ã«Xcodeã¨åŸºæœ¬ç’°å¢ƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€Runnerã‚’ç™»éŒ²ãƒ»æœ‰åŠ¹åŒ–ã—ã€Action Workflowã®YAMLã§ `runs-on` ã‚’ `[self-hosted]` ã«å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ã€‚*

è¤‡æ•°ã® Runner ãŒåŒã˜ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã§å‹•ä½œã™ã‚‹å•é¡Œã¯ã€ä¸Šè¨˜ã® Actions ã§ã»ã¨ã‚“ã©è§£æ±ºã—ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ã™ã¹ã¦ã®ä¾å­˜å…±æœ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã™ã€‚ã¾ãŸã€ãƒ†ã‚¹ãƒˆã§ç›´é¢ã™ã‚‹å•é¡Œã®ä¸€ã¤ã«ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ç«¶åˆãŒã‚ã‚Šã¾ã™ï¼šã€Œ**2ã¤ã®ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ãŒåŒã˜ãƒã‚·ãƒ³ä¸Šã®2ã¤ã® Runner ã«ã‚ˆã£ã¦åŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã€åŒã˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã¨äº’ã„ã«å¹²æ¸‰ã—ã¦ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ã€‚**ã€

è§£æ±ºæ–¹æ³•ã‚‚ç°¡å˜ã§ã€å„ Runner ã«ãã‚Œãã‚Œ1å°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚

#### è¤‡æ•°ã® Runner ãŒåŒã˜ãƒã‚·ãƒ³ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹è¨­å®š

åŒã˜ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã« **2ã¤ã® Runner** ãŒä¸¦è¡Œã—ã¦ã‚¸ãƒ§ãƒ–ã‚’å—ã‘å–ã‚‹å ´åˆï¼š

- `ZhgChgLideMacBook-Pro-Runner-A`

- `ZhgChgLideMacBook-Pro-Runner-B`

![](/assets/4b001d2e8440/1*3ptg9Tl5fBbEIYB4kgh0kw.png)

XCode ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®è¨­å®šã§ã¯ã€2ã¤ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

![](/assets/4b001d2e8440/1*k9bR2C12Wk11HAKKiYJ2zg.png)

![](/assets/4b001d2e8440/1*iigArewZEW0063Q6xwZn7g.png)

- ãƒ¢ãƒ‡ãƒ«ã€iOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŠã‚ˆã³ãƒ†ã‚¹ãƒˆç’°å¢ƒ

**CI-Testing.yml ã®ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒƒãƒ—ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ï¼š**

```bash
# Fastlaneã®Unitãƒ†ã‚¹ãƒˆLaneã‚’å®Ÿè¡Œ
      - name: Run Tests
        id: testing
        # ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã€ä»¥é™ã®ã‚³ãƒãƒ³ãƒ‰ã§ç‰¹åˆ¥ã«cd ./Product/ã—ãªãã¦ã‚ˆã„
        working-directory: ./Product/
        env:
          # ...
          # Repo -> Settings -> Actions secrets and variables -> variables
          # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®iOSãƒãƒ¼ã‚¸ãƒ§ãƒ³
          SIMULATOR_IOS_VERSION: ${{ vars.SIMULATOR_IOS_VERSION }}

          # ç¾åœ¨ã®Runnerå
          RUNNER_NAME: ${{ runner.name }}
          
          # ...
        run: \\|

          # ...
          bundle exec fastlane ${TEST_LANE} device:"${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})" \\| tee "$RUNNER_TEMP/testing_output.txt"
          # ...
```

- `device` **ã‚’** `${RUNNER_NAME} (${SIMULATOR_IOS_VERSION})` **ã«å¤‰æ›´**

- `SIMULATOR_IOS_VERSION` ã¯å¼•ãç¶šã Repo variables ã®å¤‰æ•°ã‚’å‚ç…§ã—ã¾ã™ã€‚

**çµ„ã¿åˆã‚ã›ã®çµæœã¯ï¼ˆ18.4ã‚’ä¾‹ã«ï¼‰ï¼š**

- Runner: `ZhgChgLideMacBook-Pro-Runner-A`
  ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼: **ZhgChgLideMacBook-Pro-Runner-A(18.4)**

- Runner: `ZhgChgLideMacBook-Pro-Runner-B`
  ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼: **ZhgChgLideMacBook-Pro-Runner-B(18.4)**

ã“ã†ã™ã‚‹ã“ã¨ã§ã€2ã¤ã®RunnerãŒåŒæ™‚ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€ãã‚Œãã‚Œåˆ¥ã€…ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒè‡ªå‹•ã§èµ·å‹•ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

#### å®Œå…¨ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒª

[![](https://opengraph.githubassets.com/5952f3220c95ced947b9ee50d9c542b2edbb424be50c51c582cb226ce5f5df63/ZhgChgLi/github-actions-ci-cd-demo)](https://github.com/ZhgChgLi/github-actions-ci-cd-demo){:target="_blank"}

### SSH Agent ã®è¨­å®šè£œè¶³ â€” Fastlane Match ã¾ãŸã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ CocoaPods ãƒªãƒã‚¸ãƒˆãƒªç”¨

Fastlane Match ã‚„ Private CocoaPods Repo ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€åˆ¥ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ãŸã‚ã€ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚„ Action ç’°å¢ƒã§ã¯ç›´æ¥ git clone ãŒã§ãã¾ã›ã‚“ã€‚ssh agent ã‚’è¨­å®šã—ã¦ç’°å¢ƒã‚’æ•´ãˆã€Action å®Ÿè¡Œæ™‚ã«æ“ä½œæ¨©é™ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### Step 1. SSHã‚­ãƒ¼ã®ç”Ÿæˆ

![](/assets/4b001d2e8440/1*kPWl9hombBgQ15i-n2sY2A.png)

```bash
ssh-keygen -t ed25519 -C "zhgchgli@gmail.com"
```

ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãªã—ã€ã‚³ãƒ¼ãƒ‰ã¯ãã®ã¾ã¾ï¼‰

`Enter file in which to save the key (/Users/zhgchgli/.ssh/id_ed25519):` /Users/zhgchgli/Downloads/zhgchgli

- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«å…¥åŠ›ã™ã‚‹ã¨ã€å†…å®¹ã®ã‚³ãƒ”ãƒ¼ãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚

`â€œ/Users/zhgchgli/Downloads/zhgchgliâ€ ã®ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºãªã—ã®å ´åˆã¯ç©ºã®ã¾ã¾ï¼‰ï¼š`

- **ç©ºæ¬„ã«ã—ã¦ãã ã•ã„ï¼š** CI/CDã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã€CLIã®å¯¾è©±å¼å…¥åŠ›ã§ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å…¥åŠ›ã§ãã¾ã›ã‚“ã€‚**ãã®ãŸã‚ç©ºæ¬„ã«ã—ã¦ãã ã•ã„**

- ç”Ÿæˆå®Œäº†ï¼ˆ.pub/private_keyï¼‰

![](/assets/4b001d2e8440/1*aF5P6EK9Hfv-CI3MRZ8MCA.png)

#### Step 2. Private Repoã§Deploy Keyã‚’è¨­å®šã™ã‚‹

![github-actions-ci-cd-demo-certificates Repo](/assets/4b001d2e8440/1*3K6JvCHa23QfvWoNq2xdBQ.jpeg)

github-actions-ci-cd-demo-certificates ãƒªãƒã‚¸ãƒˆãƒª

Settings â†’ Security â†’ Deploy keys â†’ Add deploy keyã€‚

- Title: ã‚­ãƒ¼åã®å…¥åŠ›

- Key: `.pub ã‚­ãƒ¼ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘`

å®Œäº†ã€‚

![](/assets/4b001d2e8440/1*Xo_g-AchEk0j4SGXOmBuxg.jpeg)

#### Step 3. Action ã®ãƒªãƒã‚¸ãƒˆãƒªã« SSH Private Key ã‚’ Secrets ã¨ã—ã¦è¨­å®šã™ã‚‹

![github-actions-ci-cd-demo Repo](/assets/4b001d2e8440/1*Jm92pQHMOImQzZtmmvd1ng.jpeg)

github-actions-ci-cd-demo ãƒªãƒã‚¸ãƒˆãƒª

Settings â†’ Secrets and variables â†’ Actions â†’ New repository secretã€‚

- Name: ã‚­ãƒ¼å¤‰æ•°å `SSH_PRIVATE_KEY` ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„

- Secret: `private_key ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘`

å®Œäº†ã€‚

#### Step 4. SSH Agent è¨­å®šå®Œäº†ã‚‰ã€Git Clone Private Repo ã®æ¨©é™ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†

[**Demo-Git-Clone-Private-Repo.yml**](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/actions/workflows/Demo-Git-Clone-Private-Repo.yml){:target="_blank"} **ï¼š**

```yaml
name: Demo Git Clone Private Repo

on:
  workflow_dispatch:

jobs:
  clone-private-repo:
    name: Git Clone Private Repo
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      # ğŸ” SSHã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã—ã€ç§˜å¯†éµã‚’è¿½åŠ 
      - name: Setup SSH Agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      # ğŸ›¡ï¸ github.comã‚’known_hostsã«è¿½åŠ ã—ã€ãƒ›ã‚¹ãƒˆèªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’é˜²æ­¢
      - name: Add GitHub to known_hosts
        run: \\|
          mkdir -p ~/.ssh
          ssh-keyscan github.com >> ~/.ssh/known_hosts
      # ğŸ“¦ SSHã‚’ä½¿ã£ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã€æ¤œè¨¼
      - name: Clone and Verify Private Repo
        run: \\|
          git clone git@github.com:ZhgChgLi/github-actions-ci-cd-demo-certificates.git ./fakeMatch/
          if [ -d "./fakeMatch/.git" ]; then
            echo "âœ… Repo cloned successfully into ./fakeMatch/"
            cd ./fakeMatch
            echo "ğŸ“Œ Current commit: $(git rev-parse --short HEAD)"
          else
            echo "âŒ Clone failed. SSH Agent may not be configured properly."
            exit 1
          fi
```

ä»¥ä¸Šã® Action ã‚’ä½¿ã£ã¦è¨­å®šãŒæˆåŠŸã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

![](/assets/4b001d2e8440/1*YLbr7l0FBSOYx_fQT-tiCA.png)

æˆåŠŸã—ã€ä»¥é™ `fastlane match` ã‚„ `pod install` ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒ‰ãŒæ­£å¸¸ã«å®Ÿè¡Œã§ãã‚‹ã¯ãšã§ã™ã€‚

### ã¾ã¨ã‚

ã“ã®æ–‡ç« ã¯ GitHub Actions ã‚’ä½¿ã£ã¦å®Œå…¨ãª iOS CI/CD ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è©³ã—ãè¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚æ¬¡å›ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢/PM/ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ï¼‰ã®ä½“é¨“ã‚’æœ€é©åŒ–ã—ã€**Slack é€šçŸ¥ã®å……å®Ÿã¨ Google Apps Script Web App ã‚’é€£æºã—ã¦ã€ç„¡æ–™ã§ä½¿ã„ã‚„ã™ã„ã‚¯ãƒ­ã‚¹ãƒãƒ¼ãƒ å‘ã‘ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚**

### ã‚·ãƒªãƒ¼ã‚ºè¨˜äº‹ï¼š

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ1ï¼‰ï¼šCI/CD ã¨ã¯ï¼ŸCI/CD ã§å®‰å®šã‹ã¤åŠ¹ç‡çš„ãªé–‹ç™ºãƒãƒ¼ãƒ ã‚’ä½œã‚‹ã«ã¯ï¼Ÿãƒ„ãƒ¼ãƒ«é¸ã³ã¯ï¼Ÿ**](../c008a9e8ceca/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆäºŒï¼‰ï¼šGitHub Actions ã¨ self-hosted Runner ã®ä½¿ç”¨ã¨æ§‹ç¯‰å¤§å…¨**](../404bd5c70040/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆä¸‰ï¼‰ï¼šGitHub Actions ã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® CI ã¨ CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…**](../4b001d2e8440/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ4ï¼‰ï¼šGoogle Apps Script Web App ã‚’ä½¿ã£ã¦ GitHub Actions ã¨é€£æºã—ã€ç„¡æ–™ã§ä½¿ã„ã‚„ã™ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹**](../4273e57e7148/)

#### [Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

> [***æœ¬ã‚·ãƒªãƒ¼ã‚ºã®è¨˜äº‹ã¯å¤šãã®æ™‚é–“ã¨åŠ´åŠ›ã‚’ã‹ã‘ã¦åŸ·ç­†ã—ã¾ã—ãŸã€‚å†…å®¹ãŒã‚ãªãŸã®ãŠå½¹ã«ç«‹ã¡ã€ãƒãƒ¼ãƒ ã®ä½œæ¥­åŠ¹ç‡ã‚„è£½å“å“è³ªã®å‘ä¸Šã«è²¢çŒ®ã§ããŸãªã‚‰ã€ãœã²ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’ã”é¦³èµ°ã—ã¦ãã ã•ã„ã€‚ã”æ”¯æ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼***](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

![[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}](/assets/4b001d2e8440/1*QJj54G9gOjtQS-rbHVT1SQ.png)

[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

ã”è³ªå•ã‚„ã”æ„è¦‹ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€[ã“ã¡ã‚‰ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„](https://www.zhgchg.li/contact){:target="_blank"} ã€‚

*[Post](https://dev.zhgchg.li/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E4%B8%89-%E4%BD%BF%E7%94%A8-github-actions-%E5%AF%A6%E4%BD%9C-app-ios-ci-%E8%88%87-cd-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-4b001d2e8440){:target="_blank"} Mediumã‹ã‚‰[ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}ã«ã‚ˆã£ã¦å¤‰æ›ã•ã‚Œã¾ã—ãŸã€‚*