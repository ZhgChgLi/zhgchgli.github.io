---
author: ZhgChgLi
categories:
- ZRealmã®é–‹ç™º
date: 2025-07-02T12:22:32.788+0000
description: GitHub Actionsã¨Self-hosted Runnerã®åŸºæœ¬ã‹ã‚‰å¿œç”¨ã¾ã§ã‚’è©³è§£ã€‚è¨­å®šã®æ‚©ã¿ã‚’è§£æ¶ˆã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®è‡ªå‹•åŒ–ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«å®Ÿç¾ã™ã‚‹å…·ä½“çš„æ‰‹æ³•ã‚’ç´¹ä»‹ã€‚
image:
  path: /assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.jpeg
last_modified_at: 2025-07-12T14:49:01.276+0000
render_with_liquid: false
tags:
- iosã‚¢ãƒ—ãƒªé–‹ç™º
- ci-cd
- github-actions
- github
- ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ
- japanese
- ai-translation
title: GitHub Actionsï½œSelf-hosted Runnerï¼šCI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ã§è‡ªå‹•åŒ–åŠ¹ç‡æœ€å¤§åŒ–
---

### CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆäºŒï¼‰ï¼šGitHub Actions ã¨ Self-hosted Runner ã®ä½¿ç”¨ã¨æ§‹ç¯‰å¤§å…¨

GitHub Actions/Self-hosted Runner ã®å‹•ä½œæ–¹æ³•ã¨ãƒãƒ³ã‚ºã‚ªãƒ³ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ã‚’ã‚¼ãƒ­ã‹ã‚‰ã”æ¡ˆå†…ã—ã¾ã™ã€‚

![Photo by [Dan Taylor](https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/404bd5c70040/1*_vGYh_XSI3ZDbdeT8xCihA.jpeg)

Photo by [Dan Taylor](https://unsplash.com/@theoneandonlydantaylor?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}

#### ã¯ã˜ã‚ã«

å‰å›ã®ã€Œ[**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆä¸€ï¼‰ï¼šCI/CD ã¨ã¯ï¼ŸCI/CD ã‚’ä½¿ã£ã¦å®‰å®šã‹ã¤åŠ¹ç‡çš„ãªé–‹ç™ºãƒãƒ¼ãƒ ã‚’ä½œã‚‹æ–¹æ³•ã¯ï¼Ÿãƒ„ãƒ¼ãƒ«ã®é¸ã³æ–¹ã¯ï¼Ÿ**](../c008a9e8ceca/)ã€ã§ã¯ã€CI/CD ã¨ã¯ä½•ã‹ã€ãã®åŠ¹æœã‚„ãƒ„ãƒ¼ãƒ«ã®é¸æŠã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚**ä»Šå›ã¯ GitHub Actions ã¨ Self-hosted Runner ã®æ§‹é€ ã¨ä½¿ã„æ–¹ã«ç„¦ç‚¹ã‚’å½“ã¦**ã€ã„ãã¤ã‹ã®é¢ç™½ã„è‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä¸€ç·’ã«ä½œã‚ŠãªãŒã‚‰ã€ã˜ã£ãã‚Šã¨ç¿’å¾—ã—ã¦ã„ãã¾ã™ã€‚

### GitHub Actions ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

å§‹ã‚ã‚‹å‰ã«ã€GitHub Actions ã®å‹•ä½œæ§‹é€ ã€ãƒ•ãƒ­ãƒ¼ã®é–¢ä¿‚ã¨å½¹å‰²ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

![](/assets/404bd5c70040/1*iacfyTX_b3YTSzMcn2ldjw.png)

#### **GitHub ãƒªãƒã‚¸ãƒˆãƒª**

- GitHub Actions ã®ä¸–ç•Œã§ã¯ã€ã™ã¹ã¦ã® Actionsï¼ˆWorkflow YAML ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¯ç‰¹å®šã® Git ãƒªãƒã‚¸ãƒˆãƒªå†…ï¼ˆ`REPO/.github/workflows/`ï¼‰ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### GitHub ãƒªãƒã‚¸ãƒˆãƒª â€” Actions Secrets

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ Secretsã€‚

- Actions ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ä½¿ç”¨ã™ã‚‹ Secret Key ã‚„ Token ã‚’ä¿å­˜  
  ä¾‹ï¼šSlack Bot Tokenã€Apple Store Connect API ã® .p8 ã‚­ãƒ¼

- **Secrets ã®å†…å®¹ã¯ Action ãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œãšã€è‡ªå‹•çš„ã« * * * * ã§éš ã•ã‚Œã¾ã™**

- Secrets ã®å†…å®¹ã¯é–²è¦§ã‚„ç·¨é›†ãŒã§ããšã€ä¸Šæ›¸ãã®ã¿å¯èƒ½ã§ã™

- Secrets **ã¯ç¾åœ¨ãƒ†ã‚­ã‚¹ãƒˆã®ã¿å¯¾å¿œã—ã¦ãŠã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯ã§ãã¾ã›ã‚“**  
  **-** ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ã€[å…¬å¼æ‰‹é †ã®Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ä¿å­˜ã™ã‚‹æ–¹æ³•](https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/using-secrets-in-github-actions#storing-base64-binary-blobs-as-secrets){:target="_blank"} ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚  
  - iOSé–‹ç™ºè¨¼æ˜æ›¸ã®ä¿å­˜æ–¹æ³•ã¯å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã”è¦§ãã ã•ã„ï¼š [Installing an Apple certificate on macOS runners for Xcode development](https://docs.github.com/en/actions/how-tos/use-cases-and-examples/deploying/installing-an-apple-certificate-on-macos-runners-for-xcode-development){:target="_blank"}

- çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã® Secrets ã‚’ä¿å­˜ã—ã€ãƒªãƒã‚¸ãƒˆãƒªé–“ã§å…±æœ‰å¯èƒ½ã§ã™

#### GitHub Repo â€” Actions Variables

Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ Variablesã€‚

- Actions ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ˆãä½¿ã†å¤‰æ•°ã‚’æ ¼ç´  
  ä¾‹ï¼šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã® iOS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

- Variables ã®å†…å®¹ã¯ç¢ºèªãŠã‚ˆã³ç·¨é›†å¯èƒ½ã§ã™

- Variables ã®å†…å®¹ã¯ Action Log ã«å‡ºåŠ›ã§ãã¾ã™

- Variables ã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã¿å¯¾å¿œã—ã¦ãŠã‚Šã€JSONæ–‡å­—åˆ—ã‚’æ ¼ç´ã—ã¦è‡ªåˆ†ã§è§£æã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

- çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã® Variables ã‚’ä¿å­˜ã—ã€ãƒªãƒã‚¸ãƒˆãƒªé–“ã§å…±æœ‰å¯èƒ½

#### GitHub Actions â€” ãƒˆãƒªã‚¬ãƒ¼

- **Github Action ã«ãŠã‘ã‚‹æœ€ã‚‚é‡è¦ãªå‡ºç™ºç‚¹ â€” ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ¡ä»¶ï¼‰**

- ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã«è©²å½“ã™ã‚‹ GitHub Actions ã®ã¿ãŒå®Ÿè¡Œã•ã‚Œã¾ã™

- å®Œå…¨ãªã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions/reference/events-that-trigger-workflows){:target="_blank"}ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

- åŸºæœ¬çš„ã«ã™ã¹ã¦ã® CI/CD ã‚„è‡ªå‹•åŒ–ã§é­é‡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚  
  ã—ã‹ã—ã€**ç‰¹æ®Šãªã‚·ãƒŠãƒªã‚ªã§ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆã¯ã€ä»–ã®ã‚¤ãƒ™ãƒ³ãƒˆã¨çµ„ã¿åˆã‚ã›ã¦ Job å†…ã§æ¡ä»¶åˆ¤å®šã‚’è¡Œã†ã‹ã€Schedule ã‚’ä½¿ã£ã¦æ‰‹å‹•ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“**ã€‚  
  ä¾‹ï¼šPR ãƒãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆã¯ã€`pull_request: closed` ã¨ Job ã® `if: github.event.pull_request.merged == true` ã‚’çµ„ã¿åˆã‚ã›ã¦å®Ÿç¾ã—ã¾ã™ã€‚

**ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆï¼š**

- `schedule` (cron)ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚‹å®šæœŸå®Ÿè¡Œï¼ˆcrontabã¨åŒæ§˜ï¼‰  
  è‡ªå‹•åŒ–ã«åˆ©ç”¨å¯èƒ½ï¼šå®šæœŸçš„ãªPRãƒã‚§ãƒƒã‚¯ã€å®šæœŸãƒ“ãƒ«ãƒ‰ã€å®šæœŸçš„ãªè‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ  
  **ã™ã¹ã¦ main / developï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒï¼‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚**

- `pull_request:` ï¼šPRé–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆ  
  PRãŒã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚ŒãŸã¨ãã€PRã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚ŒãŸã¨ãã€ãƒ©ãƒ™ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã€æ–°ã—ã„ãƒ—ãƒƒã‚·ãƒ¥ã‚³ãƒŸãƒƒãƒˆãŒã‚ã£ãŸã¨ãâ€¦ãªã©

- `issues` ã€ `issue_comment` ï¼šIssueã«é–¢ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ  
  IssueãŒä½œæˆã•ã‚ŒãŸã¨ãã€æ–°ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã£ãŸã¨ãâ€¦ãªã©

- `workflow_dispatch` ï¼šæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼›å…¥åŠ›ãŒå¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã§ãã€GitHub Actionsã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæƒ…å ±ã‚’å…¥åŠ›ã§ãã‚‹ç°¡å˜ãªãƒ•ã‚©ãƒ¼ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚  
  e.g.:

![](/assets/404bd5c70040/1*XogIJsCbrNPerWBto_PG8w.png)

- `workflow_call` ï¼šåˆ¥ã® Actionï¼ˆWorkflowï¼‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- `workflow_run` ï¼šä»–ã® Actionï¼ˆWorkflowï¼‰ãŒã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ãŸã¨ãã«ã€ã“ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚

> *ãã®ä»–ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚„è¨­å®šã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions/reference/events-that-trigger-workflows){:target="_blank"} ã‚’ã”è¦§ãã ã•ã„ã€‚*

#### **GitHub Actions â€” ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**

- åˆ¥å Action

- YAML ã‚’ä½¿ã£ã¦ .yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã™ã¹ã¦ `REPO/.github/workflows/` ã«é…ç½®ã—ã¾ã™ã€‚

- **ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒå†…ã® Workflow YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŸºæº–ã¨ã™ã‚‹**  
  ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã§é–‹ç™ºä¸­ã® Action ãŒè¦‹ãˆãªã‹ã£ãŸã‚Šã€å®Ÿè¡Œã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ã¾ãšãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- GitHub Actions ã®æœ€ã‚‚åŸºæœ¬çš„ãªå˜ä½ã§ã‚ã‚Šã€å„ Workflow ã¯ä¸€ã¤ã® CI/CD ã¾ãŸã¯è‡ªå‹•åŒ–æ“ä½œã‚’è¡¨ã—ã¾ã™ã€‚

- Workflow ã¯ä»–ã® Workflow ã‚’å‘¼ã³å‡ºã—ã¦ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™  
  ï¼ˆã“ã®ç‰¹æ€§ã‚’åˆ©ç”¨ã—ã¦ã€ã‚³ã‚¢ Workflow ã¨å‘¼ã³å‡ºã™ Workflow ã‚’åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰

- ã“ã“ã§ã¯ã€ã‚¿ã‚¹ã‚¯åã€å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã€ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚¿ã‚¹ã‚¯ä½œæ¥­ãªã©ã€ã™ã¹ã¦ã® Action é–¢é€£è¨­å®šã‚’å®šç¾©ã—ã¾ã™

- ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã¯ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“

- Action ã¯å®Œå…¨ã«ç„¡æ–™ï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯ãŠã‚ˆã³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªï¼‰

#### GitHub Actions â€” ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ â€” ã‚¸ãƒ§ãƒ–

- GitHub Actions ã®å®Ÿè¡Œå˜ä½

- Workflow å†…ã®ã‚¸ãƒ§ãƒ–ï¼ˆã‚¿ã‚¹ã‚¯ï¼‰ã®å®šç¾©ã«ã¯ã©ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚‹ã‹

- å„ Workflow ã¯è¤‡æ•°ã® Jobs ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™

- å„ã‚¸ãƒ§ãƒ–ã¯ä½¿ç”¨ã™ã‚‹ãƒ©ãƒ³ãƒŠãƒ¼ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€å®Ÿè¡Œæ™‚ã«ã¯å¯¾å¿œã™ã‚‹ãƒ©ãƒ³ãƒŠãƒ¼ã®ãƒã‚·ãƒ³ã§ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

- **è¤‡æ•°ã®ã‚¸ãƒ§ãƒ–ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã¾ã™**ï¼ˆé †åºãŒã‚ã‚‹å ´åˆã¯ `needs` ã§åˆ¶ç´„å¯èƒ½ï¼‰

- **å„ã‚¸ãƒ§ãƒ–ã¯ç‹¬ç«‹ã—ãŸå®Ÿè¡Œå˜ä½ï¼ˆSandboxã¨ã—ã¦æ‰±ã†ã¹ãï¼‰** ã§ã‚ã‚Šã€ã‚¸ãƒ§ãƒ–çµ‚äº†å¾Œã«ç”Ÿæˆã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»–ã®ã‚¸ãƒ§ãƒ–ã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€Artifactsã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‹ã€self-hostedç’°å¢ƒã§ã¯å…±æœ‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- Job ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»–ã® Job ãŒå‚ç…§ã§ãã‚‹æ–‡å­—åˆ—ã‚’ Output ã¨ã—ã¦å‡ºåŠ›ã§ãã¾ã™ã€‚  
  ï¼ˆä¾‹ï¼šå®Ÿè¡Œçµæœ true ã¾ãŸã¯ falseï¼‰

- ç‰¹ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¡ä»¶ã‚’è¨­å®šã—ã¦ã„ãªã„å ´åˆã€è¤‡æ•°ã®ã‚¸ãƒ§ãƒ–ã®ã†ã¡ã©ã‚Œã‹ã®ã‚¸ãƒ§ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã€**ä»–ã®ã‚¸ãƒ§ãƒ–ã¯å¼•ãç¶šãå®Ÿè¡Œã•ã‚Œã¾ã™**ã€‚

#### GitHub Actions â€” ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼/ã‚¸ãƒ§ãƒ–ã®å†åˆ©ç”¨

- Workflow å®šç¾©ã® `on: workflow_call` ã«ã‚ˆã‚Šã€ä»–ã® Workflow ã§ Job ã¨ã—ã¦å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã§ãã¾ã™ã€‚

- åŒã˜çµ„ç¹”å†…ã®ãƒªãƒã‚¸ãƒˆãƒªé–“ã§å…±æœ‰å¯èƒ½ã§ã™ã€‚

- ãã®ãŸã‚ã€è¤‡æ•°ã®ãƒªãƒã‚¸ãƒˆãƒªã§ä½¿ã† CI/CD ã®ä½œæ¥­ã‚’å…±é€šã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¾ã¨ã‚ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚

#### GitHub Actions â€” ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ â€” ã‚¸ãƒ§ãƒ– â€” ã‚¹ãƒ†ãƒƒãƒ—

- GitHub Actions ã«ãŠã‘ã‚‹æœ€å°å®Ÿè¡Œå˜ä½

- Job å†…ã§å®Ÿéš›ã«ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

- å„ã‚¸ãƒ§ãƒ–ã¯è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™

- **è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯é †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™**

- Step ãŒå®Œäº†ã—ãŸã‚‰ã€å¾Œç¶šã® Steps ãŒå‚ç…§ã§ãã‚‹ã‚ˆã†ã«æ–‡å­—åˆ—ã‚’ Output ã§ãã¾ã™ã€‚

- **Step ã¯ç›´æ¥ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°å¯èƒ½**  
  [gh cli](https://cli.github.com/manual/gh){:target="_blank"} ã‚„ç¾åœ¨ã®ç’°å¢ƒå¤‰æ•°ï¼ˆä¾‹ï¼šPRç•ªå·ã®å–å¾—ï¼‰ã‚’å‚ç…§ã—ã¦ã€ã‚„ã‚ŠãŸã„ã“ã¨ã‚’ç›´æ¥å®Ÿè¡Œã§ãã¾ã™ã€‚

- ç‰¹ã«æ¡ä»¶ã‚’è¨­å®šã—ã¦ã„ãªã„å ´åˆã€Step ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¨ **å³åº§ã«ä¸­æ–­** ã•ã‚Œã€å¾Œç¶šã® Steps ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚

#### GitHub Actions â€” ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ â€” ã‚¸ãƒ§ãƒ– â€” ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ã®å†åˆ©ç”¨

- **[Marketplace](https://github.com/marketplace?type=actions){:target="_blank"} ã«ã‚ã‚‹å¤šãã®å„ªã‚ŒãŸæ—¢å­˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãã®ã¾ã¾å†åˆ©ç”¨ã§ãã¾ã™ã€‚**  
  ä¾‹ãˆã°ã€[PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿](https://github.com/marketplace/actions/comment-pull-request){:target="_blank"} ãªã©ã§ã™ã€‚

- è‡ªåˆ†ã®ä¸€é€£ã®ä½œæ¥­ã‚¹ãƒ†ãƒƒãƒ—ã‚’ Action GitHub ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã€ä»–ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ç›´æ¥å†åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

- Public Repo ã® Action ã¯ Marketplace ã«å…¬é–‹ã§ãã¾ã™

**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚ŒãŸ Action ã®ä½¿ç”¨ã‚µãƒãƒ¼ãƒˆï¼š**

- **Docker Action** â€” GitHub Actions ã¯ç’°å¢ƒå¤‰æ•°ã‚’ Docker ã‚³ãƒ³ãƒ†ãƒŠã«æ¸¡ã—ã€ãã®ä¸­ã§ shell scriptã€Javaã€PHP ãªã©å¥½ããªæ–¹æ³•ã§å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

- **JavaScript/TypeScript Action** â€” node.js ã‚’ä½¿ã£ã¦ç›´æ¥ GitHub Actions ã®å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¾ã™ã€‚åŒæ§˜ã«ç’°å¢ƒå¤‰æ•°ã‚‚æ¸¡ã•ã‚Œã¦å‚ç…§å¯èƒ½ã§ã™ã€‚  
  e.g. [pozil/auto-assign-issue](https://github.com/pozil/auto-assign-issue/blob/v2/action.yml){:target="_blank"}

- **Composite (YAML) â€”** ç´”ç²‹ãª YAML ã§ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¨˜è¿°ã—ã¾ã™ï¼ˆGitHub Actions ã® Workflow â€” Job â€” Step ã¨åŒæ§˜ï¼‰ã€‚ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ã‹å®£è¨€ã—ãŸã‚Šã€ç›´æ¥ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚  
  e.g. [ZhgChgLi/ZReviewTender](https://github.com/ZhgChgLi/ZReviewTender/blob/main/action.yml){:target="_blank"}

> *æ–‡å­—æ•°ã®é–¢ä¿‚ã§ã€æœ¬è¨˜äº‹ã§ã¯ GitHub Actions ã® Action ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–æ–¹æ³•ã¯ç´¹ä»‹ã—ã¾ã›ã‚“ã€‚èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ï¼š [tutorials/creating-a-composite-action](https://docs.github.com/en/actions/tutorials/creating-a-composite-action){:target="_blank"} ã€‚*

#### GitHub Runner

- GitHub ã¯ Runner ã®ãƒ©ãƒ™ãƒ«ã«å¿œã˜ã¦å¯¾å¿œã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’ Runner ã«å‰²ã‚Šå½“ã¦ã¾ã™

- Runner ã¯ãƒªã‚¹ãƒŠãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã—ã€GitHub ã‹ã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã§ç›£è¦–ã—ã¾ã™ã€‚

- Job ã®ã¿ã‚’é‡è¦–ã—ã€ã©ã® Actionï¼ˆWorkflowï¼‰ã‹ã¯æ°—ã«ã—ã¾ã›ã‚“ã€‚  
  ãã®ãŸã‚ã€Action A ã® Job-1 ãŒå®Œäº†ã—ãŸå¾Œã€æ¬¡ã¯ Action B ã® Job-1 ãŒå®Ÿè¡Œã•ã‚Œã€Action A ã®ã™ã¹ã¦ã® Jobs ãŒå®Œäº†ã—ã¦ã‹ã‚‰ Action B ã«ç§»ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

- Runner ã¯ GitHub Hosted Runner ã¾ãŸã¯ Self-hosted Runner ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

#### **GitHub ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼**

- GitHub ãŒæä¾›ã™ã‚‹ Runner ã¯ã€å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªä¸€è¦§ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

[![](https://opengraph.githubassets.com/b479f2537a0d7620cc8bed955bf9331e739ee02383a1715546a26bc35390a494/actions/runner-images)](https://github.com/actions/runner-images){:target="_blank"}

![[2025/06 ã® Images ãƒªã‚¹ãƒˆ](https://github.com/actions/runner-images){:target="_blank"}](/assets/404bd5c70040/1*KtQV4kDCWscEeaZ8jQI8Dg.png)

[2025/06 ã® Images ä¸€è¦§](https://github.com/actions/runner-images){:target="_blank"}

- Runner ã«ã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ã€ã“ã¡ã‚‰ã‹ã‚‰ç¢ºèªã§ãã¾ã™ï¼š  
  e.g. [macos-14-arm64](https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md){:target="_blank"}

![[macos-14-arm64](https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md){:target="_blank"}](/assets/404bd5c70040/1*svXtXH78-TvK1C_XXCyYLA.png)

[macos-14-arm64](https://github.com/actions/runner-images/blob/main/images/macos/macos-14-arm64-Readme.md){:target="_blank"}

- iOS é–‹ç™ºã§ã¯ -arm64 (Mã‚·ãƒªãƒ¼ã‚º) ãƒ—ãƒ­ã‚»ãƒƒã‚µã® Runner ã‚’å„ªå…ˆã—ã¦ä½¿ç”¨ã™ã‚‹ã¨ã€å®Ÿè¡Œé€Ÿåº¦ãŒé€Ÿããªã‚Šã¾ã™

- Job ã® `run-on` ã«è¡¨ã® YAML ãƒ©ãƒ™ãƒ«ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§ã€ãã® Runner ã‚’ä½¿ã£ã¦ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

- **Public Repo ã®æ–™é‡‘ä½“ç³»: å®Œå…¨ç„¡æ–™ã§ç„¡åˆ¶é™ã«åˆ©ç”¨å¯èƒ½**

- **ï¸** Private Repo ç„¡æ–™æ :  
  ç„¡æ–™æ ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ãŒã€GitHub Free ã‚’ä¾‹ã¨ã—ã¾ã™ï¼‰ï¼š  
  ä½¿ç”¨é‡ï¼šæ¯æœˆ 2,000 åˆ†ç„¡æ–™  
  ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼š500 MB

- **âš ï¸ï¸Private Repo ã®èª²é‡‘æ–¹å¼ï¼š**  
  **ç„¡æ–™æ ã‚’è¶…ãˆã‚‹ã¨ä½¿ç”¨é‡ã«å¿œã˜ãŸèª²é‡‘ãŒå§‹ã¾ã‚Šã¾ã™ï¼ˆä¸Šé™è¨­å®šã‚„é€šçŸ¥å¯èƒ½ï¼‰ã€‚Runner ãŒå‹•ä½œã™ã‚‹ãƒã‚·ãƒ³ã®OSã‚„ã‚³ã‚¢æ•°ã«ã‚ˆã£ã¦æ–™é‡‘ãŒç•°ãªã‚Šã¾ã™ï¼š**

![[about-billing-for-github-actions](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions){:target="_blank"}](/assets/404bd5c70040/1*rkhRJN4ZRas_lDOJh-pjkQ.png)

[about-billing-for-github-actions](https://docs.github.com/en/billing/managing-billing-for-your-products/about-billing-for-github-actions){:target="_blank"}

macOS ã®ä¾¡æ ¼ã¯ã€è¨­å‚™ã‚³ã‚¹ãƒˆãŒé«˜ã„ãŸã‚é«˜ä¾¡ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

- æœ€å¤§åŒæ™‚å®Ÿè¡Œã‚¸ãƒ§ãƒ–æ•°ã®åˆ¶é™ï¼š

![[usage-limits-billing-and-administration](https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits){:target="_blank"}](/assets/404bd5c70040/1*LU3zGSBe57NBVMfDwl0wdQ.png)

[usage-limits-billing-and-administration](https://docs.github.com/en/actions/concepts/overview/usage-limits-billing-and-administration#usage-limits){:target="_blank"}

> *ã“ã“ã§ã¯è©±ãŒãã‚Œã™ãã¾ã—ãŸã€‚ç§ãŸã¡ã®é‡ç‚¹ã¯ Self-hosted Runner ã§ã™ã€‚*

#### ç¤¾å†…ã‚µãƒ¼ãƒãƒ¼ã§ã®ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼

- è‡ªåˆ†ã®ãƒã‚·ãƒ³ã‚’ Runner ã¨ã—ã¦ä½¿ã†

- **1å°ã®ç‰©ç†ãƒã‚·ãƒ³ã§è¤‡æ•°ã®ãƒ©ãƒ³ãƒŠãƒ¼ã‚’èµ·å‹•ã—ã€ä¸¦è¡Œã—ã¦ã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã§ãã‚‹**

- **ç„¡æ–™ã§ç„¡åˆ¶é™ã«ä½¿ç”¨å¯èƒ½**  
  ãƒã‚·ãƒ³ã®è³¼å…¥è²»ç”¨ã®ã¿ã§ã€ä¸€åº¦è²·ãˆã°ä½¿ã„æ”¾é¡Œï¼  
  32G RAM M4 Miniï¼ˆ=NT$40,900ï¼‰ã‚’ä¾‹ã«ã™ã‚‹ã¨ã€GitHub Hosted Runner ã‚’ä½¿ã†ã¨1ãƒ¶æœˆã§500 USDã‹ã‹ã‚‹ãŒã€**1å°è³¼å…¥ã—ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚Œã°3ãƒ¶æœˆä»¥ä¸Šã§å…ƒãŒå–ã‚Œã‚‹**ï¼

- Windowsã€macOSã€Linuxï¼ˆx64/ARM/ARM64ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™

- **åŒã˜çµ„ç¹”å†…ã§ãƒªãƒã‚¸ãƒˆãƒªé–“ã§ Runner ã‚’å…±æœ‰å¯èƒ½**

- **âš ï¸ç¾åœ¨ï¼šactions/cacheã€actions/upload-artifactã€actions/download-artifact ã¯ã™ã¹ã¦ GitHub ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿å¯¾å¿œã—ã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã®å†…å®¹ã¯ GitHub ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã«èª²é‡‘ã•ã‚Œã¾ã™ã€‚**  
  è‡ªåˆ†ã®ãƒã‚·ãƒ³ä¸Šã§å…±æœ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ä»£æ›¿ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

- Self-hosted Runner ã¯ [Docker, k8s](https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller){:target="_blank"} ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ãŒã€ç§ã¯ã¾ã èª¿ã¹ã¦ã„ã¾ã›ã‚“ã€‚

> ***Self-hosted Runner ã®æ§‹ç¯‰ã¯æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œäº†ï¼ˆ10åˆ†ä»¥å†…ã«è¨­å®šå¯èƒ½ï¼‰ã—ã€ã™ãã«ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã‚’é–‹å§‹ã§ãã¾ã™ï¼ˆæœ¬æ–‡ã®å¾ŒåŠã§è©³ã—ãç´¹ä»‹ã—ã¾ã™ï¼‰ã€‚***

#### GitHub Workflow x Job x Step x Runner ãƒ•ãƒ­ãƒ¼é–¢ä¿‚å›³

![](/assets/404bd5c70040/1*WHIVfXdVRoEsdXGfJhu2Rw.png)

ã“ã“ã§ã¯ã€2ã¤ã®Workflowã¨2ã¤ã®RunnerãŒã‚ã‚‹å ´åˆã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨é–¢ä¿‚ã‚’å›³ã§ã¾ã¨ã‚ã¾ã™ã€‚

- CI â€” Rã«ã¯3ã¤ã®ã‚¸ãƒ§ãƒ–ãŒã‚ã‚Šã€ãã‚Œãã‚Œã®ã‚¸ãƒ§ãƒ–ã«è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚Runnerãƒ©ãƒ™ãƒ«ï¼ˆrun-onï¼‰ â€” `self-hosted-app`

- CD â€” 4ã¤ã®ã‚¸ãƒ§ãƒ–ãŒã‚ã‚Šã€å„ã‚¸ãƒ§ãƒ–ã«ã¯ã„ãã¤ã‹ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚Runnerãƒ©ãƒ™ãƒ«ï¼ˆrun-onï¼‰ â€” `self-hosted-app`

- Runner â€” 2ã¤ã‚ã‚Šã€Runnerãƒ©ãƒ™ãƒ«ã‚‚ä¸¡æ–¹ã¨ã‚‚ `self-hosted-app` ã§ã™

å‰è¿°ã®é€šã‚Šã€Runner ã¨ Workflow ã¯ Runner Label ã«åŸºã¥ã„ã¦ã‚¿ã‚¹ã‚¯ã‚’å‰²ã‚Šå½“ã¦ãƒ»å—ä¿¡ã—ã¾ã™ã€‚ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã™ã¹ã¦åŒã˜ `self-hosted-app` Runner Label ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚Workflow ã® Jobs ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã€Steps ã¯å„ Job ã®å®Ÿéš›ã®å®Ÿè¡Œå†…å®¹ã§ã€é †ç•ªã«ç›´åˆ—å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã™ã¹ã¦ã® Steps ãŒå®Œäº†ã™ã‚‹ã¨ Job ã‚‚å®Œäº†ã¨ãªã‚Šã¾ã™ã€‚

> ***ãã®ãŸã‚ã€Workflow ã®å®Ÿéš›ã®å®Ÿè¡Œã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¯ã€2ã¤ã® Runner é–“ã‚’è¡Œãæ¥ã—ãªãŒã‚‰ Job ã‚’å®Ÿè¡Œã—ã€ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€ç¾åœ¨ã® Job ãŒå®Œäº†ã—ã¦ã‚‚æ¬¡ã«å®Ÿè¡Œã•ã‚Œã‚‹ Job ãŒå¿…ãšã—ã‚‚åŒã˜ Workflow ã®æ¬¡ã® Job ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚***

> *âš ï¸ ã ã‹ã‚‰ã“ãã€å„ Job ãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã“ã¨ãŒéå¸¸ã«é‡è¦ã§ã™ï¼ˆç‰¹ã« Self-hosted Runner ç’°å¢ƒã§ã¯ã€Job çµ‚äº†å¾Œã«å®Œå…¨ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã€ã“ã® Job ã®æˆæœç‰©ã‚’æ¬¡ã® Job ãŒãã®ã¾ã¾ä½¿ãˆã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ï¼‰ã€‚*

#### Job ãŒå‡ºåŠ›ã‚’æŒã¡ã€å¾Œç¶šã® Job ã«æ¸¡ã™å ´åˆ:

- **Job Output String** : ç´”ç²‹ãªãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ•°ã«å‡ºåŠ›ã—ã¦ä»–ã®ã‚¸ãƒ§ãƒ–ã§å‚ç…§ã™ã‚‹

- **Artifact-upload/download:** Job ã® Step ã®æœ€å¾Œã«å®Ÿè¡Œçµæœã‚’ GitHub Artifact ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€åˆ¥ã® Job ã®æœ€åˆã® Step ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ç¶šã‘ã¦å‡¦ç†ã«ä½¿ç”¨ã—ã¾ã™ã€‚  
  e.g. ä¾‹ãˆã° Job â€” ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚° â†’ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸çµæœã® .ipa ã‚’ **Artifact â†’** Job â€” ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ .ipa ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ App Store ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤  
  æ³¨æ„ç‚¹ï¼š**ç¾åœ¨ã€Self-hosted ã§ã‚‚ GitHub Artifact ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚**

- **AWS/GCPâ€¦ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** : åŒæ§˜ã«ã€è‡ªåˆ†ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

- **[Self-hosted Only] å…±æœ‰ãƒ‡ã‚£ã‚¹ã‚¯ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:** Self-hosted Runner ãŒå…±ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹å ´åˆã€ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« UUID ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦æˆæœç‰©ã‚’ä¿å­˜ã§ãã¾ã™ã€‚ãã—ã¦ã€å¾Œç¶šã® Job ã¯å‰ã® Job ã® Output UUID ã‚’ä½¿ã£ã¦å¯¾å¿œã™ã‚‹ä¿å­˜å ´æ‰€ã‚’è¦‹ã¤ã‘ã¦èª­ã¿è¾¼ã‚€ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  
  æ³¨æ„ç‚¹ã¨ã—ã¦ã€ç•°ãªã‚‹ãƒ›ã‚¹ãƒˆã® Runner ã‚‚åŒã˜å…±ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- åŒã˜ Job ã® Steps ã§å…¨ã¦ã®ä½œæ¥­ã‚’å®Œäº†ã•ã›ã‚‹ã€‚

### å®Ÿè·µã§å­¦ã¶ GitHub Actions â€” ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£

ã€Œè¨€ã†ã‚ˆã‚Šè¡Œã†ã€ä»¥ä¸Šã®åè©èª¬æ˜ã¨ãƒ—ãƒ­ã‚»ã‚¹æ§‹é€ ã®ç´¹ä»‹ã¯çš†ã•ã‚“ã‚‚å°‘ã—æ›–æ˜§ã«æ„Ÿã˜ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‹ã‚‰ã¯å®Ÿéš›ã®3ã¤ã®æ©Ÿèƒ½ä¾‹ã‚’æŒ™ã’ã¦ã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰èª¬æ˜ã—ã€ä½œæ¥­ã‚’é€šã—ã¦å­¦ã³ã€GitHub Actionsã¨ã¯ä½•ã‹ã‚’ç†è§£ã—ã¦ã„ãã¾ã™ã€‚

### ã‚±ãƒ¼ã‚¹ â€” 1

Pull Request ä½œæˆå¾Œã«ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚µã‚¤ã‚ºã®ãƒ©ãƒ™ãƒ«ã‚’è‡ªå‹•ã§ä»˜ã‘ã¦ã€ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ä½œæ¥­ã‚’åŠ¹ç‡çš„ã«è¨ˆç”»ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### æˆæœå›³

![[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/404bd5c70040/1*vjSWeu2zB-hmVpfziMDR5Q.png)

[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

#### å‹•ä½œã®æµã‚Œ

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPRã‚’ä½œæˆã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã€PRã«æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹

- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹

- shellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•

- å¤‰æ›´æ•°ã«åŸºã¥ã„ã¦PRãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸ã™ã‚‹

- å®Œäº†

#### å®Ÿè·µã™ã‚‹

Repo â†’ Actions â†’ New workflow â†’ è‡ªåˆ†ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«åï¼š** `Automation-PullRequest.yml`

Action Workflow ã¯å„ã‚¸ãƒ§ãƒ–ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã‚‹ã“ã¨ã‚‚ã€ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚„ç›®çš„ã«å¿œã˜ã¦åŒã˜ç›®çš„ã®ã‚‚ã®ã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã„ãšã‚Œã«ã›ã‚ˆè¤‡æ•°ã® Job ã¯ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãªãŠã€**GitHub Actions ã¯ç¾æ™‚ç‚¹ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å°‘ãªãã—ã€éšå±¤çš„ãªå‘½åè¦å‰‡ã§ç®¡ç†ã™ã‚‹æ–¹ãŒä¾¿åˆ©ã§ã™**ã€‚

ã“ã“ã§ã¯ PR é–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆã«é–¢ã™ã‚‹ Actions ã‚’åŒã˜ Workflow ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

#### `Automation-PullRequest.yml`

```yaml
# Workflow(Action) åç§°
name: Pull Reqeust Automation

# Actions ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«å
run-name: "[Pull Reqeust Automation] ${{ github.event.pull_request.title \\|\\| github.ref }}"

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # PRã‚¤ãƒ™ãƒ³ãƒˆ
  pull_request:
    # PR - ã‚ªãƒ¼ãƒ—ãƒ³ã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã€æ–°ã—ã„Pushã‚³ãƒŸãƒƒãƒˆæ™‚
    types: [opened, synchronize, reopened]


# åŒã˜ Concurrency Group ã«æ–°ã—ã„ Job ãŒæ¥ãŸå ´åˆã€å®Ÿè¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
# ä¾‹ï¼šPushã‚³ãƒŸãƒƒãƒˆã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œå‰ã«å†åº¦Pushã•ã‚ŒãŸå ´åˆã€å‰ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

# Job ä½œæ¥­é …ç›®
# Job ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # Job ID
  label-pr-by-file-count:
    # Job åç§°ï¼ˆçœç•¥å¯ã€ãƒ­ã‚°è¡¨ç¤ºã‚’åˆ†ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚è¨­å®šæ¨å¥¨ï¼‰
    name: Label PR by changes file count

    # ã“ã®JobãŒå¤±æ•—ã—ã¦ã‚‚Workflowå…¨ä½“ã«ã¯å½±éŸ¿ã›ãšä»–ã®Jobã‚’ç¶™ç¶š
    continue-on-error: true
    
    # æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®šã—ã€ç•°å¸¸æ™‚ã®ç„¡é™å¾…æ©Ÿã‚’é˜²æ­¢
    timeout-minutes: 10

    # Runnerãƒ©ãƒ™ãƒ« - GitHub Hosted Runner ubuntu-latest ã‚’ä½¿ç”¨ã—ã¦ä½œæ¥­ã‚’å®Ÿè¡Œ
    # Privateãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã¯ä½¿ç”¨é‡ã«å¿œã˜ã¦èª²é‡‘ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š
    runs-on: ubuntu-latest

    # ä½œæ¥­ã‚¹ãƒ†ãƒƒãƒ—
    # ã‚¹ãƒ†ãƒƒãƒ—ã¯é †ç•ªã«å®Ÿè¡Œã•ã‚Œã‚‹
    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—å
      - name: Get changed file count and apply label
        # ã‚¹ãƒ†ãƒƒãƒ—IDï¼ˆçœç•¥å¯ã€å‡ºåŠ›ã‚’å‚ç…§ã—ãªã„å ´åˆã¯ä¸è¦ï¼‰
        id: get-changed-files-count-by-gh
        # å¤–éƒ¨ç’°å¢ƒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®Ÿè¡Œæ™‚ã«æ³¨å…¥
        env:
          # secrets.GITHUB_TOKEN ã¯GitHub Actionså®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã§ã€Secretsã«è¨­å®šä¸è¦ã€‚GitHubãƒªãƒã‚¸ãƒˆãƒªAPIã®ä¸€éƒ¨ã‚¹ã‚³ãƒ¼ãƒ—æ¨©é™ã‚’æŒã¤
          # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows
          # gh(GitHub) CLI ã¯GH_TOKENã‚’ç’°å¢ƒå¤‰æ•°ã«æ³¨å…¥ã—ãªã„ã¨æ“ä½œæ¨©é™ãŒãªã„
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        # Shellã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        # GitHub Hosted Runner ã«ã¯ gh CLI ãŒæ¨™æº–ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã§ä½¿ç”¨å¯èƒ½
        run: \\|
          #   ${{ github.xxx }} ã¯GitHub Actionsã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼
          #   ã‚·ã‚§ãƒ«å¤‰æ•°ã§ã¯ãªãã€YAMLè§£ææ™‚ã«GitHub ActionsãŒå¯¾å¿œã™ã‚‹å€¤ã«ç½®æ›
          #   ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šhttps://docs.github.com/en/actions/learn-github-actions/contexts#github-context
          
          # PRç•ªå·ã‚’å–å¾—:
          PR_NUMBER=${{ github.event.pull_request.number }}

          # ãƒªãƒã‚¸ãƒˆãƒªã‚’å–å¾—:
          REPO=${{ github.repository }}

          # GitHub API(gh CLI)ã‚’ä½¿ã£ã¦å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å–å¾—
          FILE_COUNT=$(gh pr view $PR_NUMBER --repo $REPO --json files --jq '.files \\| length')
          
          # ãƒ­ã‚°å‡ºåŠ›
          echo "Changed file count: $FILE_COUNT"

          # ãƒ©ãƒ™ãƒ«ä»˜ã‘ãƒ­ã‚¸ãƒƒã‚¯
          if [ "$FILE_COUNT" -lt 5 ]; then
            LABEL="XS"
          elif [ "$FILE_COUNT" -lt 10 ]; then
            LABEL="S"
          elif [ "$FILE_COUNT" -lt 30 ]; then
            LABEL="M"
          elif [ "$FILE_COUNT" -lt 80 ]; then
            LABEL="L"
          elif [ "$FILE_COUNT" -lt 200 ]; then
            LABEL="XL"
          else
            LABEL="XXL"
          fi

          # GitHub API(gh CLI)ã§ç¾åœ¨ã®ã‚µã‚¤ã‚ºãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤
          EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')
          for EXISTING in $EXISTING_LABELS; do
            case "$EXISTING" in
              XS\\|S\\|M\\|L\\|XL\\|XXL)
                echo "ğŸ§¹ æ—¢å­˜ãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤: $EXISTING"
                gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"
                ;;
            esac
          done

          # ï¼ˆä»»æ„ï¼‰ãƒ©ãƒ™ãƒ«ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ä½œæˆ
          if ! gh label list --repo "$REPO" \\| grep -q "^$LABEL"; then
            echo "ğŸ†• ãƒ©ãƒ™ãƒ«ä½œæˆ: $LABEL"
            gh label create "$LABEL" --repo "$REPO" --description "Size label: $LABEL" --color "ededed"
          else
            echo "âœ… ãƒ©ãƒ™ãƒ« '$LABEL' ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™"
          fi
          
          # GitHub API(gh CLI)ã§ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸
          gh pr edit $PR_NUMBER --repo $REPO --add-label "$LABEL"
```

Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸå¾Œã€æ–°ã—ã„ PR ã‚’ä½œæˆã™ã‚‹ã¨è‡ªå‹•çš„ã« GitHub Actions ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ï¼š

![](/assets/404bd5c70040/1*wdAztL0BgPeSZdqXxqUEXg.png)

Action å®Ÿè¡ŒçŠ¶æ…‹ãŒ **Queued** ã§ã‚ã‚‹ã“ã¨ã¯ã€ã‚¿ã‚¹ã‚¯ãŒ Runner ã«ã‚ˆã£ã¦å—ã‘å–ã‚‰ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

#### å®Ÿè¡Œçµæœ

![[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/404bd5c70040/1*-JoD8IQYHVrDqHmLmrXyaQ.png)

[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

å®Ÿè¡ŒãŒå®Œäº†ã—æˆåŠŸã™ã‚‹ã¨ã€PR ã«å¯¾å¿œã™ã‚‹ãƒ©ãƒ™ãƒ«ãŒè‡ªå‹•ã§ä»˜ã‘ã‚‰ã‚Œã¾ã™ï¼è¨˜éŒ²ã«ã¯ `github-actions` ã«ã‚ˆã‚‹ãƒ©ãƒ™ãƒ«ä»˜ã‘ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [Automation-PullRequest.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml){:target="_blank"}**

#### ä»–äººãŒä½œæˆã—ãŸ Action ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ï¼š [pascalgn/size-label-action](https://github.com/pascalgn/size-label-action/tree/main){:target="_blank"}

å‰è¿°ã§ä»–äººãŒä½œæˆã—ãŸActionã‚’ç›´æ¥ä½¿ãˆã‚‹ã¨èª¬æ˜ã—ã¾ã—ãŸãŒã€PRã®ã‚µã‚¤ã‚ºãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã‚‹ã‚¿ã‚¹ã‚¯ã«ã¯æ—¢è£½ã®ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã¯ã‚ãã¾ã§å­¦ç¿’ç›®çš„ã§ã‚ã‚Šã€å®Ÿéš›ã«ã¯è‡ªåˆ†ã§ä½œã‚Šç›´ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Action Workflow Job Step å†…ã§ç›´æ¥ä½¿ç”¨ã™ã‚‹ã ã‘ã§ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã§ãã¾ã™ï¼š

```yaml
# Workflow(Action) åç§°
name: Pull Reqeust Automation

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # PR ã‚¤ãƒ™ãƒ³ãƒˆ
  pull_request:
    # PR - ã‚ªãƒ¼ãƒ—ãƒ³ã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã€æ–°ã—ã„ãƒ—ãƒƒã‚·ãƒ¥ã‚³ãƒŸãƒƒãƒˆæ™‚
    types: [opened, synchronize, reopened]


# åŒã˜ Concurrency Group å†…ã§æ–°ã—ã„ã‚¸ãƒ§ãƒ–ãŒé–‹å§‹ã•ã‚ŒãŸå ´åˆã€å®Ÿè¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
# ä¾‹ãˆã°ãƒ—ãƒƒã‚·ãƒ¥ã‚³ãƒŸãƒƒãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ãŒã¾ã å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§å†åº¦ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå ´åˆã€å‰ã®ã‚¸ãƒ§ãƒ–ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹
concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

# ã‚¸ãƒ§ãƒ–
# ã‚¸ãƒ§ãƒ–ã¯ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # ã‚¸ãƒ§ãƒ–ID
  label-pr-by-file-count:
    # ã‚¸ãƒ§ãƒ–åï¼ˆçœç•¥å¯ã€ãƒ­ã‚°è¡¨ç¤ºã§ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«è¨­å®šï¼‰
    name: Label PR by changes file count

    # ã“ã®ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ã¦ã‚‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã«ã¯å½±éŸ¿ã›ãšã€ä»–ã®ã‚¸ãƒ§ãƒ–ã¯ç¶™ç¶šã™ã‚‹
    continue-on-error: true
    
    # æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®šã—ã€ç•°å¸¸æ™‚ã®ç„¡é™å¾…æ©Ÿã‚’é˜²æ­¢
    timeout-minutes: 10

    # ãƒ©ãƒ³ãƒŠãƒ¼ãƒ©ãƒ™ãƒ« - GitHub Hosted Runner ã® ubuntu-latest ã‚’ä½¿ç”¨ã—ã¦ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œ
    # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã¯ä½¿ç”¨é‡ãŒè¨ˆç®—ã•ã‚Œã€è¶…éã™ã‚‹ã¨æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    runs-on: ubuntu-latest

    # ã‚¹ãƒ†ãƒƒãƒ—
    # ã‚¹ãƒ†ãƒƒãƒ—ã¯é †ç•ªã«å®Ÿè¡Œã•ã‚Œã‚‹
    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—å
      - name: Get changed file count and apply label
        # ã‚¹ãƒ†ãƒƒãƒ—IDï¼ˆçœç•¥å¯ã€å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§å‡ºåŠ›ã‚’å‚ç…§ã—ãªã„å ´åˆã¯ä¸è¦ï¼‰
        id: get-changed-files-count-by-gh
        # ä»–è€…ãŒä½œæˆã—ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç›´æ¥åˆ©ç”¨
        uses: "pascalgn/size-label-action@v0.5.5"
        # å¤–éƒ¨ç’°å¢ƒå¤‰æ•°ã‚’å®Ÿè¡Œæ™‚ã«æ³¨å…¥
        # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚„åˆ©ç”¨å¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯èª¬æ˜ã‚’å‚ç…§ï¼šhttps://github.com/pascalgn/size-label-action/tree/main
        env:
          # secrets.GITHUB_TOKEN ã¯ GitHub Actions å®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆgithub-actions ã®æ¨©é™ï¼‰ã€Secrets ã«è‡ªåˆ†ã§è¨­å®šä¸è¦ã§ã€GitHub ãƒªãƒã‚¸ãƒˆãƒªAPIã®ä¸€éƒ¨ã‚¹ã‚³ãƒ¼ãƒ—æ¨©é™ã‚’æŒã¤
          # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
```

[![](https://opengraph.githubassets.com/1e5c6f52127032dc1a5fea71a498fa9cc585987880889f0306ef705de3990867/pascalgn/size-label-action)](https://github.com/pascalgn/size-label-action/tree/main){:target="_blank"}

ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚ŒãŸ Action ã¯ JavaScript Action ã§ã‚ã‚Šã€å®Ÿéš›ã®å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š [dist/index.js](https://github.com/pascalgn/size-label-action/blob/main/dist/index.js){:target="_blank"} ã€‚

#### name, run-name ã®è£œè¶³ï¼š

![](/assets/404bd5c70040/1*zBmjm_3AU53NN0UhTrmOBQ.png)

- name: Action Workflow ã®åå‰

- run-name: å®Ÿè¡Œãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«åï¼ˆPRã‚¿ã‚¤ãƒˆãƒ«ã‚„ãƒ–ãƒ©ãƒ³ãƒã€ä½œæˆè€…ãªã©ã‚’æŒ‡å®šå¯èƒ½ï¼‰  
  on: pull_request ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ PRã‚¿ã‚¤ãƒˆãƒ«ã§ã™ã€‚

### ã‚±ãƒ¼ã‚¹ â€” 2

Pull Request ä½œæˆå¾Œã€Assignee ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯è‡ªå‹•çš„ã«ä½œæˆè€…ã‚’å‰²ã‚Šå½“ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã§é€šçŸ¥ã—ã¾ã™ã€‚ï¼ˆåˆå›ä½œæˆæ™‚ã®ã¿å®Ÿè¡Œï¼‰

#### æˆæœå›³

![[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/404bd5c70040/1*EL-0nQF7jhP34d6ZoSkJAg.png)

[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

#### å‹•ä½œã®æµã‚Œ

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPRã‚’ä½œæˆã™ã‚‹

- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹

- github script ã§ assignee ã‚’å–å¾—ã™ã‚‹æ–¹æ³•

- ã‚‚ã—ã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã€PRã‚’ä½œæˆã—ãŸä½œè€…ã«ã‚¢ã‚µã‚¤ãƒ³ã—ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹

- å®Œäº†

#### å®Ÿè·µã—ã¦ã¿ã‚ˆã†

Repo â†’ Actions â†’ New workflow â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªåˆ†ã§è¨­å®šã™ã‚‹ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«åï¼š** `Automation-PullRequest.yml` (åŒä¸Š)

#### `Automation-PullRequest.yml`

```yaml
# Workflow(Action) åç§°
name: Pull Reqeust Automation

# Actions ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒˆãƒ«å
run-name: "Pull Reqeust Automation - Daily Checker"

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # PR ã‚¤ãƒ™ãƒ³ãƒˆ
  pull_request:
    # PR - ã‚ªãƒ¼ãƒ—ãƒ³ã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã€æ–°ã—ã„ Push Commit æ™‚
    types: [opened, synchronize, reopened]


# åŒã˜ Concurrency Group ã«æ–°ã—ã„ Job ãŒã‚ã‚‹å ´åˆã€å®Ÿè¡Œä¸­ã®ã‚‚ã®ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
# ä¾‹ãˆã° Push Commit ãƒˆãƒªã‚¬ãƒ¼ã®ã‚¸ãƒ§ãƒ–ãŒã¾ã å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã®ã«å†åº¦ Push Commit ã•ã‚ŒãŸå ´åˆã€å‰ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

# Job ä½œæ¥­é …ç›®
# Job ã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # Job ID
  label-pr-by-file-count:
    # å‰è¿°å‚ç…§ã€çœç•¥....
  # ---------
  assign-self-if-no-assignee:
    name: Automatically assign to self if no assignee is specified
    # å…±é€šãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã€Job å†…ã§åˆ¤å®šã—ã€Pull Request Openedï¼ˆåˆå›ä½œæˆï¼‰ã®å ´åˆã®ã¿å®Ÿè¡Œã€ãã‚Œä»¥å¤–ã¯ã‚¹ã‚­ãƒƒãƒ—
    if: github.event_name == 'pull_request' && github.event.action == 'opened'

    # ã“ã® Job ãŒå¤±æ•—ã—ã¦ã‚‚ Workflow å…¨ä½“ã«å½±éŸ¿ã›ãšã€ä»–ã® Job ã‚’ç¶™ç¶š
    continue-on-error: true
    
    # æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®šã—ã€ç•°å¸¸æ™‚ã®ç„¡é™å¾…æ©Ÿã‚’é˜²æ­¢
    timeout-minutes: 10
    
    # Runner ãƒ©ãƒ™ãƒ« - GitHub Hosted Runner ubuntu-latest ã‚’ä½¿ç”¨ã—ã¦ä½œæ¥­ã‚’å®Ÿè¡Œ
    # Private Repo ã®å ´åˆã¯ä½¿ç”¨é‡ãŒè¨ˆç®—ã•ã‚Œã€è¶…éã™ã‚‹ã¨æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    runs-on: ubuntu-latest

    steps:
      - name: Assign self if No Assignee
        # GitHub Script (JavaScript) ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ (Node.js ç’°å¢ƒ)
        # ä¸Šè¨˜ã® Shell Script ã‚ˆã‚Šä¾¿åˆ©ã§è¦‹ã‚„ã™ã„
        # ç’°å¢ƒå¤‰æ•°ã‚„ GITHUB_TOKEN ã‚’è‡ªåˆ†ã§æ³¨å…¥ã™ã‚‹å¿…è¦ãªã—
        uses: actions/github-script@v7
        with:
          script: \\|
            // github-script ã§ã¯ context å¤‰æ•°ãŒè‡ªå‹•ã§æ³¨å…¥ã•ã‚Œã€JavaScript ã‹ã‚‰ç›´æ¥å‚ç…§å¯èƒ½
            // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context

            const issue = context.payload.pull_request; // Issue ã‚‚å¯¾å¿œã™ã‚‹å ´åˆã¯ context.payload.issue \\|\\| context.payload.pull_request ã¨æ›¸ã‘ã‚‹
            const assignees = issue.assignees \\|\\| [];
            const me = context.actor;

            if (assignees.length === 0) {
              // Assignee ã‚’è‡ªåˆ†ã«è¨­å®š
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                assignees: [me]
              });

              // ã‚³ãƒ¡ãƒ³ãƒˆã§é€šçŸ¥
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ğŸ”§ No assignee was set, so I have assigned this to myself (@${me}).`
              });
            }
```

ä»Šå›ã¯ GitHub Scriptï¼ˆJavaScriptï¼‰ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãæ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã®æ–‡æ³•ãŒã‚ˆã‚ŠæŸ”è»Ÿã§æ›¸ãã‚„ã™ããªã‚Šã¾ã™ã€‚

ã‚‚ã¡ã‚ã‚“ã€ã‚‚ã—ç§ãŒå‰ã«è¨€ã£ãŸã‚ˆã†ã«å„ã‚¿ã‚¹ã‚¯ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ãŸã„å ´åˆã¯ã€Jobã®Ifæ¡ä»¶ã‚’å¤–ã—ã¦ã€Action Workflowã®ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ã‚’ç›´æ¥è¨­å®šã™ã‚Œã°è‰¯ã„ã§ã™ï¼š

`Automation-PullRequest-Auto-Assign.yml` **ï¼š**

```yaml
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(Action) åç§°
name: Pull Request Automation - Auto Assignee Self

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # PRã‚¤ãƒ™ãƒ³ãƒˆ
  pull_request:
    # PR - ã‚ªãƒ¼ãƒ—ãƒ³æ™‚
    types: [opened]

jobs:
  assign-self-if-no-assignee:
    name: æ‹…å½“è€…ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã«è‡ªå‹•ã§è‡ªåˆ†ã‚’å‰²ã‚Šå½“ã¦ã‚‹
    runs-on: ubuntu-latest
    steps:
      # å‰æ–‡ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
```

Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸå¾Œã€æ–°ã—ã„ PR ã‚’ä½œæˆã™ã‚‹ã¨è‡ªå‹•çš„ã« GitHub Actions ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ï¼š

![](/assets/404bd5c70040/1*Y-A6owUibNEFBoRFHnqIYg.png)

ç¾åœ¨ã€2ã¤ã®ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã¾ã™ï¼

#### å®Ÿè¡Œçµæœ

![[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}](/assets/404bd5c70040/1*23muCVgUJKmZt746khBMFQ.png)

[Demo PR](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/pull/11){:target="_blank"}

å®Ÿè¡ŒãŒå®Œäº†ã—æˆåŠŸã—ãŸå¾Œã€PR ã« Asignees ãŒã„ãªã‘ã‚Œã°è‡ªå‹•çš„ã« PR ä½œæˆè€…ã‚’ã‚¢ã‚µã‚¤ãƒ³ã—ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã™ã€‚ï¼ˆã™ã¹ã¦ `github-actions` ã®æ¨©é™ã§æ“ä½œï¼‰

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [Automation-PullRequest.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml){:target="_blank"}**

#### ãƒ†ã‚¹ãƒˆå†ã‚ªãƒ¼ãƒ—ãƒ³(Reopened) PR

![](/assets/404bd5c70040/1*mcDa7TZjv6mO7HtwhOE-Vw.png)

Size Label Job ã®ã¿ãŒå®Ÿè¡Œã•ã‚Œã€Auto Assignee Job ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

> *ã“ã®ã‚¿ã‚¹ã‚¯ã¯æ—¢ã«Actionã¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ãŠã‚Šã€ãã®ã¾ã¾å†åˆ©ç”¨ã§ãã¾ã™ã€‚å‚è€ƒï¼š[pozil/auto-assign-issue](https://github.com/pozil/auto-assign-issue){:target="_blank"} ã€‚*

### ã‚±ãƒ¼ã‚¹ â€” 3

æ¯æœ9æ™‚ã«ç¾åœ¨ã®PRæ•°ã¨é–‹ã„ã¦ã‹ã‚‰ã®æœŸé–“ã‚’è‡ªå‹•é›†è¨ˆã—ã€Slackã®ä½œæ¥­ãƒãƒ¼ãƒ ã«é€šçŸ¥ã‚’é€ä¿¡ã€‚ã•ã‚‰ã«ã€3ãƒ¶æœˆä»¥ä¸Šé–‹ã„ã¦ã„ã‚‹PRã‚’è‡ªå‹•ã§ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã™ã€‚

#### æˆæœå›³

![](/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.png)

![](/assets/404bd5c70040/1*Nbg3r1zzhx24YIBEjPJnaw.png)

- Slack ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãŒæ¯æœè‡ªå‹•ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’å—ä¿¡ã™ã‚‹

- 90æ—¥ä»¥ä¸ŠçµŒéã—ãŸPRã®è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚º

#### å‹•ä½œã®æµã‚Œ

- GitHub Actions ã¯æ¯æœ9æ™‚ã«è‡ªå‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹

- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒˆãƒªã‚¬ãƒ¼

- github script ã§é–‹ã„ã¦ã„ã‚‹ PR ä¸€è¦§ã‚’å–å¾—ã—ã€é–‹ã„ã¦ã‹ã‚‰ã®æ—¥æ•°ã‚’é›†è¨ˆã™ã‚‹æ–¹æ³•

- Slack ã«çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹

- 90æ—¥ä»¥ä¸ŠçµŒéã—ãŸ PR ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹

- å®Œäº†

#### ãƒãƒ³ã‚ºã‚ªãƒ³

Repo â†’ Actions â†’ New workflow â†’ è‡ªåˆ†ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®šã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«åï¼š** `Automation-PullRequest-Daily.yml`

#### Automation-PullRequest-Daily.yml

```yaml
# Workflow(Action) åç§°
name: Pull Reqeust Automation - Daily Checker

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®šæœŸè‡ªå‹•å®Ÿè¡Œ
  # https://crontab.guru/
  # UTCæ™‚é–“
  schedule:
    # UTCã®01:00 = æ¯æ—¥ UTC+8 ã®09:00
    - cron: '0 1 * * *'
  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:

# Job ä½œæ¥­é …ç›®
# Jobã¯ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # Job ID
  caculate-pr-status:
    # Job åç§°ï¼ˆçœç•¥å¯èƒ½ã€ãƒ­ã‚°è¡¨ç¤ºãŒèª­ã¿ã‚„ã™ããªã‚‹ï¼‰
    name: Caculate PR Status
    # Runnerãƒ©ãƒ™ãƒ« - GitHub Hosted Runner ubuntu-latest ã‚’ä½¿ç”¨ã—ã¦ä½œæ¥­ã‚’å®Ÿè¡Œ
    # Private Repoã®å ´åˆã¯ä½¿ç”¨é‡ãŒè¨ˆç®—ã•ã‚Œã€è¶…éã™ã‚‹ã¨è²»ç”¨ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    runs-on: ubuntu-latest

    # Job å‡ºåŠ›
    outputs:
      pr_list: ${{ steps.pr-info.outputs.pr_list }}

    # ä½œæ¥­ã‚¹ãƒ†ãƒƒãƒ—
    # ã‚¹ãƒ†ãƒƒãƒ—ã¯é †ç•ªã«å®Ÿè¡Œã•ã‚Œã‚‹
    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—å
      - name: Fetch open PRs and caculate
        # Stepå¤–éƒ¨ã§Outputã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«è¨­å®šãŒå¿…è¦
        id: pr-info
        uses: actions/github-script@v7
        with:
          script: \\|
            const now = new Date();
            const per_page = 100;
            let page = 1;
            let allPRs = [];
      
            while (true) {
              const { data: prs } = await github.rest.pulls.list({
                owner: context.repo.owner,
                repo: context.repo.repo,
                state: 'open',
                per_page,
                page,
              });
              if (prs.length === 0) break;
              allPRs = allPRs.concat(prs);
              if (prs.length < per_page) break;
              page++;
            }
      
            const result = allPRs.map(pr => {
              const created = new Date(pr.created_at);
              const daysOpen = Math.floor((now - created) / (1000 * 60 * 60 * 24));
              return {
                pr: pr.number.toString(),
                title: pr.title,
                idle: daysOpen
              };
            });

            // Outputã«è¨­å®šã€æ–‡å­—åˆ—ã®ã¿å—ã‘ä»˜ã‘ã‚‹
            core.setOutput('pr_list', JSON.stringify(result));
  # ----
  send-pr-summary-message-to-slack:
    name: Send PR Summary Messag to Slack
    # Jobã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦è¡Œå®Ÿè¡Œã€needsã‚’ä½¿ã†ã¨æŒ‡å®šJobå®Œäº†å¾Œã«å®Ÿè¡Œå¯èƒ½
    needs: [caculate-pr-status]
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate Message
        # Stepå¤–éƒ¨ã§Outputã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«è¨­å®šãŒå¿…è¦
        id: gen-msg
        uses: actions/github-script@v7
        with:
          script: \\|
            const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);
            const blocks = [];
      
            // ã‚¿ã‚¤ãƒˆãƒ«
            blocks.push({
              type: "section",
              text: {
                type: "mrkdwn",
                text: `ğŸ“¬ *Open PR Report*\nTotal: *${prList.length}* PR(s)`
              }
            });
      
            // å„PRã‚’1è¡Œã§è¡¨ç¤º
            for (const pr of prList) {
              blocks.push({
                type: "section",
                text: {
                  type: "mrkdwn",
                  text: `â€¢ <https://github.com/${context.repo.owner}/${context.repo.repo}/pull/${pr.pr}\\|PR #${pr.pr}> *${pr.title}* - ğŸ•’ ${pr.idle} day(s)`
                }
              });
            }

            // Outputã«è¨­å®šã€æ–‡å­—åˆ—ã®ã¿å—ã‘ä»˜ã‘ã‚‹
            core.setOutput('blocks', JSON.stringify(blocks));

            
      # Slackå…¬å¼ã®Slack API GitHub Actionsã‚’ä½¿ç”¨
      # https://tools.slack.dev/slack-github-action/sending-techniques/sending-data-slack-api-method/
      # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
      - name: Post text to a Slack channel
        uses: slackapi/slack-github-action@v2.1.0
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: \\|
            channel: ${{ vars.SLACK_TEAM_CHANNEL_ID }}
            blocks: ${{ steps.gen-msg.outputs.blocks }}
  # ----
  auto-close-old-prs:
    name: Auto Close Old PRs
    needs: [caculate-pr-status]
    runs-on: ubuntu-latest

    steps:
      - name: Auto close PRs opened more than 90 days
        uses: actions/github-script@v7
        with:
          script: \\|
            const prList = JSON.parse(`${{ needs.caculate-pr-status.outputs.pr_list }}`);
            const oldPRs = prList.filter(pr => pr.idle > 90);

            for (const pr of oldPRs) {
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: parseInt(pr.pr),
                state: 'closed'
              });

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: parseInt(pr.pr),
                body: `âš ï¸ This pull request has been automatically closed because it has been open for more than 90 days. Please reopen if needed.`
              });
            }
            console.log(`Closed ${oldPRs.length} PR(s)`);
```

ã“ã®ä¾‹ã§ã¯ä»¥ä¸‹ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

- on: schedule ã‚¯ãƒ­ãƒ³ã‚¿ãƒ–ã«ã‚ˆã‚‹è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ã¨ workflow_dispatch ã«ã‚ˆã‚‹æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆ

- Job output/Step outputï¼ˆã©ã¡ã‚‰ã‚‚æ–‡å­—åˆ—ã®ã¿ï¼‰

- è¤‡æ•°ã®ã‚¸ãƒ§ãƒ–ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€`needs` ã‚’ä½¿ã£ã¦æ™‚é–“çš„ãªä¾å­˜é–¢ä¿‚ã‚’è¨­å®šã—ã€å¾…æ©Ÿã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™

- Repo Secrets/Variables ã‹ã‚‰è¨­å®šã‚’å–å¾—ã™ã‚‹

- Slack APIã¨ã®é€£æº

**Repo Secrets â€” æ–°è¦è¿½åŠ ** `SLACK_BOT_TOKEN`

![](/assets/404bd5c70040/1*YC4DBHtKmX5XGgcSSzaE5A.png)

- Slack App ã®ä½œæˆãŠã‚ˆã³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ¨©é™ã®è¨­å®šã«ã¤ã„ã¦ã¯ã€ç§ã®[ä»¥å‰ã®è¨˜äº‹](../bd94cc88f9c9/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**Repo Variables â€” æ–°è¦è¿½åŠ ** `SLACK_TEAM_CHANNEL_ID`

![](/assets/404bd5c70040/1*X4gZ5_IRvsiehAL0O9AleQ.png)

Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸå¾Œã€Actions ã«æˆ»ã£ã¦æ‰‹å‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã—ã¦ã¿ã¦ãã ã•ã„ï¼š

> *ä»Šå¾Œã¯æ¯æ—¥è‡ªå‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚*

![](/assets/404bd5c70040/1*WNFKXl-QC2WGyaSWep5-DA.png)

Actions â†’ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆè‡ªå‹•åŒ– â€” ãƒ‡ã‚¤ãƒªãƒ¼ãƒã‚§ãƒƒã‚«ãƒ¼ â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ â†’ ãƒ–ãƒ©ãƒ³ãƒ: main â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã€‚

**å®Ÿè¡Œå¾Œã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Ÿè¡ŒçŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ï¼š**

![](/assets/404bd5c70040/1*4mvOxnd1uS4ZlxnNoNdHaQ.png)

![](/assets/404bd5c70040/1*BluzFgY2tM2E7DwoVq1jQw.png)

`needs` ã®åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ã€ã‚¸ãƒ§ãƒ–ã®æµã‚Œã¯ `Calculate PR Status` ãŒå…ˆã«å®Œäº†ã—ã€ãã®å¾Œã« `Auto Close Old PRs` ã¨ `Send PR Summary Message to Slack` ãŒä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

#### å®Ÿè¡Œçµæœ

**ã‚¿ã‚¹ã‚¯ãŒã™ã¹ã¦æˆåŠŸã—ãŸå¾Œã€Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã§ãã¾ã™ï¼š**

![](/assets/404bd5c70040/1*0stX9KpZi6PcXpG-90wyIg.png)

æˆåŠŸ ğŸš€ğŸš€ğŸš€

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [Automation-PullRequest-Daily.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest-Daily.yml){:target="_blank"}**

### å°çµ

> ä¸Šè¨˜ã®3ã¤ã®äº‹ä¾‹ãŒã€GitHub Actionsã®åŸºæœ¬çš„ãªç†è§£ã«å½¹ç«‹ã¡ã€è‡ªå‹•åŒ–ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’åˆºæ¿€ã§ãã‚Œã°å¹¸ã„ã§ã™ã€‚ãœã²ã”è‡ªèº«ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è€ƒæ¡ˆã—ï¼ˆã¾ãšã¯[ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ](https://docs.github.com/en/actions/reference/events-that-trigger-workflows){:target="_blank"} ã‚’ã”å‚ç…§ãã ã•ã„ï¼‰ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€[**Marketplace**](https://github.com/marketplace?type=actions){:target="_blank"} ã§æ—¢å­˜ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã€å·¨äººã®è‚©ã«ä¹—ã£ã¦æ´»ç”¨ã™ã‚‹ã“ã¨ã‚‚ãŠå¿˜ã‚Œãªãã€‚

æœ¬è¨˜äº‹ã¯å…¥é–€åŸºç¤ã®ã¿ï¼ˆã‚³ãƒ¼ãƒ‰ã® Checkout ã™ã‚‰è¡Œã„ã¾ã›ã‚“ï¼‰ã€æ¬¡å›ã®è¨˜äº‹ã€Œ[**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆä¸‰ï¼‰ï¼šGitHub Actions ã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® CI ã¨ CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…**](../4b001d2e8440/)ã€ã§ã¯ã€ã‚ˆã‚Šè¤‡é›‘ã§æ·±ã„ GitHub Actions Workflow ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

#### GitHub è‡ªå‹•åŒ–æ‹¡å¼µãƒˆãƒ”ãƒƒã‚¯

GitHub ã¯ Slack ã¨é€£æºã§ãã€ãƒªãƒã‚¸ãƒˆãƒªã® PR æ›´æ–°é€šçŸ¥ã‚„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãªã©ã‚’è³¼èª­ã§ãã¾ã™ã€‚

![](/assets/404bd5c70040/1*BMTT4koRBIIsQ7_mklC86w.png)

**å•é¡Œ 1. GitHub ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒäººã‚’ã‚¿ã‚°ä»˜ã‘ã§ããšã€GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã¿ã‚¿ã‚°ä»˜ã‘ã•ã‚Œã€Slack ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é€šçŸ¥ãŒå±Šã‹ãªã„ï¼š**

![](/assets/404bd5c70040/1*Ddp0cEtXE10hScM1rozmtg.png)

![](/assets/404bd5c70040/1*uHGJ7l__AdYoWT9KpvihLQ.png)

[Slack App](https://slack.github.com/){:target="_blank"} ã¾ãŸã¯ Apps ã§ GitHub ã‚’æ¤œç´¢ â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã â†’ **Connect GitHub Account** ã®æ‰‹é †ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€GitHub ãŒã‚ãªãŸã®å¯¾å¿œã™ã‚‹ Slack UID ã‚’èªè­˜ã—ã€ã‚¿ã‚°ä»˜ã‘ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**å•é¡Œ 2. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼**

ã“ã‚Œã¯ã‚‚ã¨ã‚‚ã¨ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ãŒé–‹ç™ºã—ãŸæ©Ÿèƒ½ã ã¨è¨˜æ†¶ã—ã¦ã„ã¾ã™ãŒã€å¾Œã«ç›´æ¥ GitHub ã«çµ±åˆã•ã‚Œã¾ã—ãŸã€‚ã‚ã–ã‚ã–è‡ªåˆ†ã§ GitHub Actions ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã‹ãªã„ã§ãã ã•ã„ï¼

![](/assets/404bd5c70040/1*BpMd2K0NBDE6xB1XzFY94Q.png)

> [***GitHub å†…è”µã¯ãƒãƒ¼ãƒ å˜ä½ã®è¨­å®šã§ã™ã€‚çµ„ç¹”ã«ãƒãƒ¼ãƒ ã‚’è¿½åŠ ã—ã€ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦ã¦ã‹ã‚‰ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚***](https://docs.github.com/en/organizations/organizing-members-into-teams/managing-scheduled-reminders-for-your-team){:target="_blank"}

- Slack ãƒãƒ£ãƒ³ãƒãƒ«ã¨ãƒ«ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã™ã‚‹ã¨ã€æ¯æ—¥è‡ªå‹•ã§ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãŒé€ä¿¡ã•ã‚Œã€Reviewer ã«ã‚¿ã‚°ä»˜ã‘ã•ã‚Œã¾ã™ã€‚è¨­å®šæ–¹æ³•ã¯[ã“ã¡ã‚‰](https://michaelheap.com/github-scheduled-reminders/){:target="_blank"}ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚çµæœã¯ä»¥ä¸‹ã®ç”»åƒã®é€šã‚Šã§ã™ï¼š

![<https://michaelheap.com/github-scheduled-reminders/>{:target="_blank"}](/assets/404bd5c70040/1*kvqFXkIKIxP79Wm8vIaN0Q.png)

<https://michaelheap.com/github-scheduled-reminders/>{:target="_blank"}

**å•é¡Œ 4. GitHub PR ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã€ä½œæˆè€…ãŒé€šçŸ¥ã‚’å—ã‘å–ã‚Œãªã„ï¼š**

![](/assets/404bd5c70040/1*wmtXwXAcQZDXqInRd0ivPw.png)

> *ã“ã‚Œã¯é•·å¹´ã®å•é¡Œã§ã€PR ã® Slack ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ **å®Ÿã¯ä½œè€…ãŒèª°ã‹ãŒã‚¹ãƒ¬ãƒƒãƒ‰ã§è¿”ä¿¡ã—ã¦ã„ã‚‹ã“ã¨ã‚’çŸ¥ã‚‰ãªã„** ã¨ã„ã†ç‚¹ã§ã™ã€‚GitHub ãŒé€ã‚‹ã“ã® Slack ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ Reviewers ã®ã¿ã‚’ã‚¿ã‚°ä»˜ã‘ã—ã€Assignee ã‚„ PR ã®ä½œè€…ã¯ã‚¿ã‚°ä»˜ã‘ã—ã¾ã›ã‚“ã€‚*

ã“ã®æ™‚ã€GitHub Actions ã‚’ä½¿ã£ãŸè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ãŒå½¹ç«‹ã¡ã¾ã™ã€‚PR Description ã®æœ€å¾Œã«ä½œè€…ã‚’è¿½è¨˜ã™ã‚‹ Job ã‚’è¿½åŠ ã™ã‚Œã°ã€Slack ã«é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚‚ä½œè€…ãŒã‚¿ã‚°ä»˜ã‘ã•ã‚Œã¾ã™ï¼š

```bash
# Workflow(Action) åç§°
name: Pull Reqeust Automation
# å‰è¿°ã‚’å‚ç…§ã€çœç•¥....

  # ---------
  append-author-to-pr-description:
    name: PRèª¬æ˜ã«ä½œæˆè€…ã‚’è¿½åŠ 
    # å…±é€šã®ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã€Jobå†…ã§åˆ¤å®šã—ã€Pull RequestãŒOpenedï¼ˆåˆå›ä½œæˆï¼‰ã®å ´åˆã®ã¿å®Ÿè¡Œã—ã€ãã‚Œä»¥å¤–ã¯ã‚¹ã‚­ãƒƒãƒ—
    if: github.event_name == 'pull_request' && github.event.action == 'opened'
    
    # ã“ã®JobãŒå¤±æ•—ã—ã¦ã‚‚Workflowå…¨ä½“ã«ã¯å½±éŸ¿ã›ãšã€ä»–ã®Jobã¯ç¶™ç¶š
    continue-on-error: true
    
    # ç•°å¸¸æ™‚ã«ç„¡é™å¾…æ©Ÿã—ãªã„ã‚ˆã†æœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®š
    timeout-minutes: 10
    
    # Runnerãƒ©ãƒ™ãƒ« - GitHub Hosted Runnerã®ubuntu-latestã§å®Ÿè¡Œ
    # Privateãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã¯ä½¿ç”¨é‡ãŒè¨ˆç®—ã•ã‚Œã€è¶…éã™ã‚‹ã¨è²»ç”¨ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
    # ãŸã ã—ã“ã®ã‚ˆã†ãªå°è¦æ¨¡è‡ªå‹•åŒ–ã¯éå‰°ä½¿ç”¨ã«ãªã‚Šã«ãã„
    runs-on: ubuntu-latest
    steps:
      - name: PRèª¬æ˜ã«ä½œæˆè€…ã‚’è¿½åŠ 
        env:
          # secrets.GITHUB_TOKENã¯GitHub Actionså®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹Tokenã§ã€Secretsã«è¨­å®šä¸è¦ã€‚GitHubãƒªãƒã‚¸ãƒˆãƒªAPIã®ä¸€éƒ¨ã‚¹ã‚³ãƒ¼ãƒ—æ¨©é™ã‚’æŒã¤
          # gh(GitHub) CLIã¯GH_TOKENã‚’ç’°å¢ƒå¤‰æ•°ã«æ³¨å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ghãŒæ“ä½œæ¨©é™ã‚’æŒã¤
          # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # ${{ github.xxx }}ã¯GitHub Actionsã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼
          # Shellå¤‰æ•°ã§ã¯ãªãã€YAMLè§£ææ™‚ã«GitHub ActionsãŒå¯¾å¿œã™ã‚‹å€¤ã«ç½®æ›
          # ãã®ä»–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šhttps://docs.github.com/en/actions/learn-github-actions/contexts#github-context
          PR_NUMBER: ${{ github.event.pull_request.number }}
          AUTHOR_TAG: '@${{ github.event.pull_request.user.login }}'
        run: \\|
          PR_BODY=$(gh pr view $PR_NUMBER --repo ${{ github.repository }} --json body -q ".body")
          NEW_BODY=$(printf "%s\n\nCreated by %s" "$PR_BODY" "$AUTHOR_TAG")
          gh pr edit $PR_NUMBER --repo ${{ github.repository }} --body "$NEW_BODY"
```

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [Automation-PullRequest.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Automation-PullRequest.yml){:target="_blank"}**

PRã‚’ä½œæˆã™ã‚‹ã¨ã€èª¬æ˜æ–‡ã®å¾Œã«è‡ªå‹•ã§ä½œæˆè€…æƒ…å ±ãŒè¿½åŠ ã•ã‚Œã€Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚‚æ­£ã—ãä½œæˆè€…ãŒã‚¿ã‚°ä»˜ã‘ã•ã‚Œã¾ã™ï¼š

![](/assets/404bd5c70040/1*UtTDtIQJ0vJks79UzCQSAQ.png)

![](/assets/404bd5c70040/1*MjVsFqE--xAq1zSQfCNVdQ.png)

**å•é¡Œ 5. GitHub ãŒå¤§é‡ã®é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’é€ã£ã¦ãã¦éå¸¸ã«è¿·æƒ‘ï¼š**

GitHub ãƒªãƒã‚¸ãƒˆãƒªã®é€šçŸ¥ã¨ Slack ã®è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ã€é€šçŸ¥ã¯ã™ã¹ã¦ Slack ã§å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¦ã€GitHub ã®å€‹äººè¨­å®šã§ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’ã‚ªãƒ•ã«ã§ãã¾ã™ï¼š

![](/assets/404bd5c70040/1*INgfO9B2bNFy-Nd1ZjnzOw.png)

#### ãã®ä»–

Actions ã¯ç¾åœ¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ãŒã€Actions ãƒšãƒ¼ã‚¸ã§æœ€å¤§5ã¤ã® Actions ã‚’ãƒ”ãƒ³ç•™ã‚ï¼ˆPinï¼‰ã§ãã¾ã™ã€‚ã¾ãŸã€Disable ã‚’ä½¿ã£ã¦ç‰¹å®šã® Action ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![](/assets/404bd5c70040/1*ZD-5xkparhJqtnm2REeu6A.png)

Insights ã§ GitHub Actions ã®ä½¿ç”¨é‡ã¨å®Ÿè¡Œçµæœã‚’ç¢ºèªã§ãã¾ã™ï¼š

![](/assets/404bd5c70040/1*re91ZRtQ0frOF6GVJ-MKrw.png)

### Reuse Workflow è£œè¶³

[æ¬¡ã®è¨˜äº‹](../4273e57e7148/) ã§ã¯åŒã˜ãƒªãƒã‚¸ãƒˆãƒªå†…ã§ã® Reuse Workflow ã®åˆ†å‰²ã‚’æ‰±ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªé–“ã§ã® Reuse Workflow ã®åˆ†å‰²ä¾‹ã‚’è£œè¶³ã—ã¾ã™ã€‚

ã¾ãš Reuse Workflow ã‚’å®šç¾©ã—ã¾ã™: [**Automation-label-pr-base-branch.yml:**](https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml){:target="_blank"} **[ZhgChgLi/github-actions-ci-cd-demo-share-actions](https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml){:target="_blank"} ãƒªãƒã‚¸ãƒˆãƒªå†…**ã€‚

```yaml
name: Automation-label-pr-base-branch
run-name: "[Automation-label-pr-base-branch] ${{ github.event.inputs.PR_NUMBER \\|\\| github.ref }}"

concurrency:
  group: ${{ github.workflow }}-${{ github.event.inputs.PR_NUMBER \\|\\| github.ref }}
  cancel-in-progress: true

# ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
on:
  # ä»–ã®Workflowã‹ã‚‰ã“ã®Workflowã‚’å‘¼ã³å‡ºã—ãƒˆãƒªã‚¬ãƒ¼
  workflow_call:
    # å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    inputs:
      # PRç•ªå·
      PR_NUMBER:
        required: true
        type: string
    # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå…¥åŠ›
    secrets:
      GH_TOKEN:
        description: "APIã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®GitHubãƒˆãƒ¼ã‚¯ãƒ³"
        required: true
jobs:
  label-pr-base-branch:
    name: PRã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã«ãƒ©ãƒ™ãƒ«ä»˜ã‘
    continue-on-error: true
    timeout-minutes: 10
    runs-on: ubuntu-latest

    steps:
      - name: ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã§PRã«ãƒ©ãƒ™ãƒ«ä»˜ã‘
        id: label-pr-base-branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: \\|
          PR_NUMBER="${{ inputs.PR_NUMBER }}"
          REPO="${{ github.repository }}"

          echo "ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒª $REPO ã®PR #$PR_NUMBER ã‚’å‡¦ç†ä¸­"

          # PRã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—
          BASE_BRANCH=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json baseRefName --jq '.baseRefName')
          echo "ğŸ”– PRã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ: $BASE_BRANCH"

          # è¨±å¯ã•ã‚ŒãŸãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã®ãƒ©ãƒ™ãƒ«
          BRANCH_LABELS=("develop" "main" "master")

          # ãƒ©ãƒ™ãƒ«ãŒè¨±å¯ãƒªã‚¹ãƒˆã«ã‚ã‚‹ã‹
          if [[ " ${BRANCH_LABELS[@]} " =~ " ${BASE_BRANCH} " ]]; then
            LABEL="$BASE_BRANCH"
          else
            echo "âš ï¸ ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ '$BASE_BRANCH' ã¯è¨±å¯ãƒªã‚¹ãƒˆã«ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ©ãƒ™ãƒ«ä»˜ã‘ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
            exit 0
          fi

          # æ—¢å­˜ã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤
          EXISTING_LABELS=$(gh pr view "$PR_NUMBER" --repo "$REPO" --json labels --jq '.labels[].name')
          for EXISTING in $EXISTING_LABELS; do
            if [[ " ${BRANCH_LABELS[@]} " =~ " ${EXISTING} " ]]; then
              echo "ğŸ§¹ æ—¢å­˜ã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤ä¸­: $EXISTING"
              gh pr edit "$PR_NUMBER" --repo "$REPO" --remove-label "$EXISTING"
            fi
          done

          # ãƒ©ãƒ™ãƒ«ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ä½œæˆ
          if ! gh label list --repo "$REPO" \\| grep -q "^$LABEL$"; then
            echo "ğŸ†• ãƒ©ãƒ™ãƒ«ã‚’æ–°è¦ä½œæˆ: $LABEL"
            gh label create "$LABEL" --repo "$REPO" --description "PRãŒå¯¾è±¡ã¨ã™ã‚‹$LABELãƒ–ãƒ©ãƒ³ãƒ" --color "ededed"
          else
            echo "âœ… ãƒ©ãƒ™ãƒ« '$LABEL' ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™"
          fi

          # ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
          echo "ğŸ·ï¸ PR #$PR_NUMBER ã«ãƒ©ãƒ™ãƒ« '$LABEL' ã‚’è¿½åŠ "
          gh pr edit "$PR_NUMBER" --repo "$REPO" --add-label "$LABEL"
```

å…ƒã® **ä¸» [ZhgChgLi/github-actions-ci-cd-demo](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml){:target="_blank"} ãƒªãƒã‚¸ãƒˆãƒªã«æˆ»ã‚Šã€** æ–°ã—ã„ä¸»ãª **Workflow [Demo-Reuse-Action-From-Another-Repo.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml){:target="_blank"} ã‚’è¿½åŠ ã—ã¾ã™ï¼š**

```yaml
name: Automation-label-pr-base-branch

on:
  pull_request:
    types: [opened]

jobs:
  call-label-pr-workflow:
    name: Call Base Branch Label Workflow
    # âœ… å‘¼ã³å‡ºã•ã‚Œã‚‹ workflow ãŒåŒã˜ãƒªãƒã‚¸ãƒˆãƒªå†…ã®å ´åˆï¼š
    #    uses: ./.github/workflows/Automation-label-pr-base-branch.yml
    #    æ³¨æ„ï¼šã“ã®æ›¸ãæ–¹ã¯ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã§ããšï¼ˆå‘¼ã³å‡ºã—å…ƒ workflow ã®ãƒ–ãƒ©ãƒ³ãƒã‚’å›ºå®šä½¿ç”¨ï¼‰
    #    å‚è€ƒä¾‹ï¼š
    #    - CD-Deploy-Form.yml ã¯æœ¬ãƒªãƒã‚¸ãƒˆãƒªã® workflow ã‚’å‘¼ã³å‡ºã—
    #    - CD-Deploy.yml ã¯åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã® workflow ã‚’å‘¼ã³å‡ºã—
    #
    # âœ… å‘¼ã³å‡ºã•ã‚Œã‚‹ workflow ãŒåˆ¥ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆï¼š
    #    uses: {owner}/{repo}/.github/workflows/{file}.yml@{branch_or_tag}
    #    ãƒ–ãƒ©ãƒ³ãƒã¾ãŸã¯ã‚¿ã‚°ã‚’æŒ‡å®šå¯èƒ½
    #    ref: https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml
    uses: ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main
    with:
      PR_NUMBER: ${{ github.event.number }}
      
    # ã™ã¹ã¦ã® secrets ã‚’å‘¼ã³å‡ºã—å…ƒ workflow ã‹ã‚‰ç¶™æ‰¿ã™ã‚‹å ´åˆã¯ `inherit` ã‚’ä½¿ã†
    # secrets: inherit
    #
    # ç‰¹å®šã® secrets ã®ã¿æ¸¡ã™å ´åˆã¯å€‹åˆ¥ã«æŒ‡å®š
    secrets:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

ã‚³ãƒŸãƒƒãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã§PRã‚’ä½œæˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼šãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒªã® [Demo-Reuse-Action-From-Another-Repo.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Reuse-Action-From-Another-Repo.yml){:target="_blank"} â†’ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã® [Automation-label-pr-base-branch.yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo-share-actions/blob/main/.github/workflows/Automation-label-pr-base-branch.yml){:target="_blank"} ã‚’å®Ÿè¡Œ â†’ ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒªã«æˆ»ã£ã¦çµæœã‚’å ±å‘Šã€‚**

![](/assets/404bd5c70040/1*13bqlAgpBkHM7UthTJAuOg.png)

![](/assets/404bd5c70040/1*CAF3HzS4PHBveDQYu3H73g.png)

æˆåŠŸï¼

#### Private Repo ã‚¢ã‚¯ã‚»ã‚¹å•é¡Œ

ã“ã“ã§æ³¨æ„ã™ã¹ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚Publicãƒªãƒã‚¸ãƒˆãƒªã§ã¯å…¨ãå•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€Privateãƒªãƒã‚¸ãƒˆãƒªå†…ã§Reuse Workflowã‚’ä½¿ã†å ´åˆã¯ã€**åŒã˜çµ„ç¹”å†…ã®ä»–ã®ãƒªãƒã‚¸ãƒˆãƒª + ãã®ãƒªãƒã‚¸ãƒˆãƒªã‚‚Private + è¨­å®šã§è¨±å¯ã•ã‚Œã¦ã„ã‚‹**å ´åˆã«é™ã‚Šã€Privateãƒªãƒã‚¸ãƒˆãƒªã®Reuse Workflowã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚

- `Public â€” ZhgChgLi/ReuseRepo` + `Private or Public-ZhgChgli or harry/myRepo` = âœ…

- `Private â€” ZhgChgLi/ReuseRepo` + `Private or Publicâ€” harry/myRepo` = âŒ

- `Private â€” ZhgChgLi/ReuseRepo` + `Public â€” ZhgChgLi/anotherRepo` = âŒ

- `Private â€” ZhgChgLi/ReuseRepo` + `Private â€” ZhgChgLi/anotherRepo` = âœ…

**è¨±å¯ã™ã‚‹æ–¹æ³•ã®è¨­å®šã¯ã€Reuse Workflow Repo â†’ Settings â†’ Actions â†’ General â†’ Access ã«ç§»å‹•ã—ã¦ãã ã•ã„ï¼š**

![](/assets/404bd5c70040/1*iZCEifgyArTJS3URMSk01g.png)

ãƒã‚§ãƒƒã‚¯ã‚’å¤‰æ›´ï¼š

```
'ZhgChgLi' çµ„ç¹”å†…ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
'ZhgChgLi' çµ„ç¹”ã«å±ã™ã‚‹ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„å†åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®ã¿è¨±å¯ã•ã‚Œã¾ã™ã€‚
```

ã€Œä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å®Œäº†ã§ã™ã€‚

**æ¨©é™ãŒãªã„å ´åˆã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š**

```bash
ç„¡åŠ¹ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«: .github/workflows/Demo-reuse-action-from-another-repo.yml#L21
å‘¼ã³å‡ºã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è§£æã‚¨ãƒ©ãƒ¼
".github/workflows/Demo-reuse-action-from-another-repo.yml"
-> "ZhgChgLi/github-actions-ci-cd-demo-share-actions/.github/workflows/Automation-label-pr-base-branch.yml@main"
: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
```

### GitHub Actions Script æ–‡æ³•è£œè¶³

è£œè¶³ã¨ã—ã¦ã€çš†ã•ã‚“ãŒç–‘å•ã«æ€ã†ã‹ã‚‚ã—ã‚Œãªã„ `${{ XXX }}` ã‚„ `${XXX}`ã€ã¾ãŸã¯ `$XXX` ã®å¤‰æ•°æ§‹æ–‡ã«ã¤ã„ã¦ã€‚

**Demo-Env-Vars- .yml:**

```yaml
name: Demo-Env-Vars

on:
  workflow_dispatch:

jobs:
  print-env-vars:
    runs-on: ubuntu-latest

    steps:
      - name: print-env
        run: env
      - name: context-vars-vs-vars
        env:
          SAY_MY_NAME: "Heisenberg"
          # GitHub Actions Context å¼ã€ä¸‹è¨˜å‚ç…§
          FROM_REF: "${{ github.ref }}"
        run: \\|
          # Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:
          # ã‚«ã‚¹ã‚¿ãƒ æ³¨å…¥ã•ã‚ŒãŸ ENV å¤‰æ•°ã®å‚ç…§
          # ${SAY_MY_NAME} ã¾ãŸã¯ $SAY_MY_NAME ã©ã¡ã‚‰ã‚‚å¯
          # ${XX} ã¯æ–‡å­—åˆ—é€£çµã«ä¾¿åˆ©:
          echo "HI: ${SAY_MY_NAME}"
          
          # ğŸ’¡ GitHub Actions Context å¼
          # ã“ã‚Œã¯ã‚·ã‚§ãƒ«å¤‰æ•°ã§ã¯ãªãã€YAML ãƒ‘ãƒ¼ã‚¹æ™‚ã« GitHub Actions ãŒå€¤ã«ç½®æ›
          # âš  ãƒ­ãƒ¼ã‚«ãƒ«ã‚„ GitHub Actions ä»¥å¤–ã®ç’°å¢ƒã§ã¯å¤±æ•—ã™ã‚‹
          # ğŸ”— https://docs.github.com/en/actions/learn-github-actions/contexts#github-context
          BRANCH_NAME_FROM_CONTEXT="${{ github.ref }}"
          
          # ğŸ’¡ GitHub Actions å®Ÿè¡Œæ™‚ã®ç’°å¢ƒå¤‰æ•°
          # ã“ã‚Œã‚‰ã¯ runner ãŒã‚·ã‚§ãƒ«å®Ÿè¡Œæ™‚ã«è‡ªå‹•æ³¨å…¥
          # âœ… ä»–ç’°å¢ƒã§ã¯ export ã‚„ ENV ã§äº‹å‰å®šç¾©ã™ã‚Œã°ä½¿ç”¨å¯èƒ½
          # ğŸ”— https://docs.github.com/en/actions/learn-github-actions/environment-variables
          BRANCH_NAME_FROM_ENV_VARS="${GITHUB_REF}"
          
          echo "FROM_REF: ${FROM_REF}"
          echo "BRANCH_NAME_FROM_CONTEXT: ${BRANCH_NAME_FROM_CONTEXT}"
          echo "BRANCH_NAME_FROM_ENV_VARS: ${BRANCH_NAME_FROM_ENV_VARS}"
      - name: print-github-script-env
        uses: actions/github-script@v7
        env:
          SAY_MY_NAME: "Heisenberg"
          # GitHub Actions Context å¼ã€ä¸Šè¨˜å‚ç…§
          FROM_REF: "${{ github.ref }}"
        with:
          script: \\|
            // GitHub Script: (JavaScript (Node.js)):
            // process.env ã‹ã‚‰ ENV å€¤ã‚’å–å¾—
            console.log(`HI: ${process.env.SAY_MY_NAME}`);
            console.log(`FROM_REF: ${process.env.FROM_REF}`);
            // github-script ã§ã¯ context å¤‰æ•°ã«è‡ªå‹•æ³¨å…¥ã•ã‚Œ JS ã‹ã‚‰ç›´æ¥å‚ç…§å¯èƒ½
            // https://docs.github.com/en/actions/learn-github-actions/contexts#github-context
            const branch_name_from_context_vars = context.ref;
            console.log(`branch_name_from_context_vars: ${branch_name_from_context_vars}`);
            // åŒæ§˜ã« GitHub Actions Context å¼ã‚‚ä½¿ãˆã‚‹ï¼ˆã‚ã¾ã‚Šæ„å‘³ã¯ãªã„ãŒï¼‰:
            const branch_name_from_context = "${{ github.ref }}";
            console.log(`branch_name_from_context: ${branch_name_from_context}`);
            
            for (const [key, value] of Object.entries(process.env)) {
              console.log(`${key}=${value}`);
            }
            // github-script ã® github ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ Octokit REST API ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
            // GitHub API æ“ä½œç”¨
            // ä¾‹ï¼š
            // await github.rest.pulls.list({
            //   owner: context.repo.owner,
            //   repo: context.repo.repo,
            //   state: "open"
            //  });
      # gh CLI ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ GITHUB_TOKEN ã‚’ä½¿ã‚ãš GH_TOKEN ãŒå¿…è¦
      - name: gh CLI without GH_TOKEN (expected to fail)
        continue-on-error: true
        run: \\|
          PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')
          echo "Found $PR_COUNT open pull requests"
      
      - name: gh CLI with GH_TOKEN (expected to succeed)
        env:
          # GH_TOKEN ã‚’è¨­å®šã—ã¦ gh CLI ã®èªè¨¼ã‚’å¯èƒ½ã«ã™ã‚‹
          # https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: \\|
          PR_COUNT=$(gh pr list --repo $GITHUB_REPOSITORY --json number --jq 'length')
          echo "Found $PR_COUNT open pull requests"
      
      - name: github-script auto-authentication (no GH_TOKEN needed)
        uses: actions/github-script@v7
        with:
          script: \\|
            // github = Octokit REST ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆGITHUB_TOKEN ã§è‡ªå‹•èªè¨¼æ¸ˆã¿ï¼‰
            const pulls = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: "open"
            });
            console.log(`Found ${pulls.data.length} open pull requests`);
```

#### ${ { XXX } } GitHub Actions ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼

![](/assets/404bd5c70040/1*e3jpPuwdmf005cjbaXjAwQ.png)

![](/assets/404bd5c70040/1*ed5Wm7Xk48xuP8yQzHpJ9w.png)

- `${{ XXX }}` ã¯ GitHub Actions ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼ã§ã€**YAML ã®è§£ææ®µéšã§ GitHub Actions ã«ã‚ˆã£ã¦å¯¾å¿œã™ã‚‹å€¤ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™**ï¼ˆä¸Šå›³ã® `BRANCH_NAME_FROM_CONTEXT` ã®ã‚ˆã†ã«ï¼‰

- å®Œå…¨ãªä½¿ç”¨å¯èƒ½ãªå¼ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions/learn-github-actions/contexts#github-context){:target="_blank"}ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

- `${XXX}` ã¾ãŸã¯ `$XXX` ã¯å®Ÿéš›ã®ç’°å¢ƒå¤‰æ•°ã§ã€`${XXX}` ã¯æ–‡å­—åˆ—ã®é€£çµæ™‚ã«ã‚ˆã‚Šä½¿ã„ã‚„ã™ã„ã§ã™ã€‚

- GitHub Actions ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã„ãã¤ã‹ã®ç’°å¢ƒå¤‰æ•°ã‚’æ³¨å…¥ã—ã¾ã™ã€‚è©³ç´°ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions/learn-github-actions/environment-variables){:target="_blank"}ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

#### actions/github-script@v7

![](/assets/404bd5c70040/1*TjJQnlAAU3VRwS9_dFz1yA.png)

![](/assets/404bd5c70040/1*5bHEdjrGsVdWnYSQgpnsZA.png)

- `github-script` å†…ã§ã‚‚ `${{ XXX }}` ã¯ GitHub Actions ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼ã¨ã—ã¦ä½¿ãˆã¾ã™ãŒã€ã‚ã¾ã‚Šæ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**ãªãœãªã‚‰ github-script ç’°å¢ƒã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ context å¤‰æ•°ãŒæ³¨å…¥ã•ã‚Œã¦ãŠã‚Šã€JavaScript å†…ã§ç›´æ¥å‚ç…§ã§ãã‚‹ã‹ã‚‰ã§ã™**ã€‚

- `github-script` å†…ã® `github` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ Octokit REST API ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã™

- `github-script` ã‚‚ `env:` ã‹ã‚‰å¤‰æ•°ã‚’æ³¨å…¥ã§ãã¾ã™ãŒã€`${process.env.xxx}` ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

- åŒæ§˜ã«ã„ãã¤ã‹ã®ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•ã§æ³¨å…¥ã•ã‚Œã¾ã™ã€‚è©³ç´°ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions/learn-github-actions/environment-variables){:target="_blank"}ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚`${process.env.xxx}`ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ãŒã€ã™ã§ã« `context` å¤‰æ•°ãŒã‚ã‚‹ãŸã‚ã€ã“ã“ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ„å‘³ã¯ã‚ã¾ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚

![](/assets/404bd5c70040/1*oW85Sju0sN4caXiaLSg32A.png)

- `github-script` ã¯è‡ªå‹•çš„ã« `github-token` ã‚’æ¸¡ã™ãŸã‚ã€æŒ‡å®šã¯ä¸è¦ã§ã™

#### gh cli GH_TOKEN

![](/assets/404bd5c70040/1*NUfaaKIobZWVBuXrGg0TPw.png)

- GitHub Actions ã®ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ `gh cli` ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€`GH_TOKEN` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ â€” `secrets.GITHUB_TOKEN` ã‚’ç›´æ¥ä½¿ç”¨å¯èƒ½ï¼ˆGitHub Actions å®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼‰

- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ã«ã¯åŸºæœ¬çš„ãªæ¨©é™ãŒã‚ã‚Šã€æ“ä½œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ [Personal Access Token](https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/use-github_token-in-workflows){:target="_blank"} ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒ¼ãƒ ã§ã®åˆ©ç”¨ã¯å…±æœ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§PATã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚**

**å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼š [Demo-Env-Vars- .yml](https://github.com/ZhgChgLi/github-actions-ci-cd-demo/blob/main/.github/workflows/Demo-Env-Vars-.yml){:target="_blank"}**

GitHub Actions ã¯æ—¢ã«é–‹ç™ºæ¸ˆã¿ãªã®ã§ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ GitHub Hosted Runner ã‚’è‡ªåˆ†ã® Self-hosted Runner ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> *GitHub Hosted Runner ã«ã¯æœˆã«2,000åˆ†ã®ç„¡æ–™æ ãŒã‚ã‚Šã¾ã™ã€‚å°è¦æ¨¡ãªè‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯ãªã‚‰ãã‚Œã»ã©æ™‚é–“ãŒã‹ã‹ã‚‰ãšã€Linuxãƒã‚·ãƒ³ä¸Šã§å‹•ä½œã™ã‚‹ãŸã‚ã‚³ã‚¹ãƒˆã‚‚ä½ãã€ç„¡æ–™æ ã‚’ä½¿ã„åˆ‡ã‚‰ãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚**å¿…ãšã—ã‚‚ Self-hosted Runner ã«åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚Runner ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ç’°å¢ƒãŒæ­£ã—ã„ã‹ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ãˆã° GitHub Hosted Runner ã«ã¯ gh CLI ãŒæ¨™æº–ã§å…¥ã£ã¦ã„ã¾ã™ãŒã€Self-hosted Runner ã§ã¯è‡ªåˆ†ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚**ã“ã®è¨˜äº‹ã§ã¯ã‚ãã¾ã§æ•™è‚²ç›®çš„ã§åˆ‡ã‚Šæ›¿ãˆã‚’è¡Œã£ã¦ã„ã¾ã™**ã€‚*

> *CI/CD ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã®ã¿ã€Self-hosted Runner ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚*

#### Self-hosted Runner ã®è¿½åŠ 

> *æœ¬æ–‡ã¯ **macOS M1** ã‚’ä¾‹ã«ã—ã¦ã„ã¾ã™ã€‚*

![](/assets/404bd5c70040/1*mEInaj-tLaprMAa2OfowCw.png)

- Settings â†’ Actions â†’ Runners â†’ New self-hosted runnerã€‚

- **Runner image:** macOS

- **Architecture** : M1 ã¯ ARM64 ã‚’é¸æŠã™ã‚‹ã¨å®Ÿè¡ŒãŒé€Ÿããªã‚Šã¾ã™

**å®Ÿæ©Ÿã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€‚**

**Download æ‰‹é †ã«å¾“ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§å®Œäº†ã™ã‚‹ï¼š**

```bash
# ä»»æ„ã®ãƒ‘ã‚¹ã« Runner ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir actions-runner && cd actions-runner
# Runner ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -o actions-runner-osx-x64-2.325.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-osx-x64-2.325.0.tar.gz

# ä»»æ„: ãƒãƒƒã‚·ãƒ¥ã®æ¤œè¨¼
echo "0562bd934b27ca0c6d8a357df00809fbc7b4d5524d4aeb6ec152e14fd520a4c3  actions-runner-osx-x64-2.325.0.tar.gz" \\| shasum -a 256 -c

# è§£å‡
tar xzf ./actions-runner-osx-x64-2.325.0.tar.gz
```

> *ä»¥ä¸Šã¯å‚è€ƒã§ã™ï¼›è¨­å®šãƒšãƒ¼ã‚¸ã®æ‰‹é †ã«å¾“ã†ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§æœ€æ–°ã® Runner ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚*

![](/assets/404bd5c70040/1*Q0k0EPjrY2V4owseESe5lg.png)

**è¨­å®š Configure:**

```bash
# è¨­å®šãƒšãƒ¼ã‚¸ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã¯æ™‚é–“ã¨ã¨ã‚‚ã«å¤‰ã‚ã‚Šã¾ã™
./config.sh --url https://github.com/ORG/REPO --token XXX
```

é †ç•ªã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

- ãƒ©ãƒ³ãƒŠãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š[Enterã‚­ãƒ¼ã§Default] **ãã®ã¾ã¾Enterã‚’æŠ¼ã—ã¦ãã ã•ã„**  
  *ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘æ©Ÿèƒ½ã¯ã€Organizationãƒ¬ãƒ™ãƒ«ã®ãƒ©ãƒ³ãƒŠãƒ¼ç™»éŒ²æ™‚ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™

- ãƒ©ãƒ³ãƒŠãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: [ZhgChgLideMacBook-Proã§Enter] **è¨­å®šã—ãŸã„ãƒ©ãƒ³ãƒŠãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ ä¾‹ï¼š** `app-runner-1` **ã¾ãŸã¯ãã®ã¾ã¾Enter**

- ã“ã®ãƒ©ãƒ³ãƒŠãƒ¼ã«ã¯æ¬¡ã®ãƒ©ãƒ™ãƒ«ãŒä»˜ä¸ã•ã‚Œã¾ã™: â€˜self-hostedâ€™, â€˜macOSâ€™, â€˜X64â€™  
  è¿½åŠ ã®ãƒ©ãƒ™ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: label-1,label-2ï¼‰: [Enterã‚­ãƒ¼ã§ã‚¹ã‚­ãƒƒãƒ—]  
  **è¨­å®šã—ãŸã„ãƒ©ãƒ³ãƒŠãƒ¼ã®ãƒ©ãƒ™ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚è¤‡æ•°ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ã¨å¾Œã§ä¾¿åˆ©ã§ã™ã€‚**  
  å‰è¿°ã®é€šã‚Šã€GitHub Actions/Runnerã¯å¯¾å¿œã™ã‚‹ãƒ©ãƒ™ãƒ«ã«åŸºã¥ã„ã¦ã‚¸ãƒ§ãƒ–ã‚’å–å¾—ã—ã¾ã™ã€‚**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ©ãƒ™ãƒ«ã®ã¿ã‚’ä½¿ã†ã¨ã€çµ„ç¹”å†…ã®ä»–ã®ãƒ©ãƒ³ãƒŠãƒ¼ãŒã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ã®ãŒå®‰å…¨ã§ã™ã€‚**  
  ã“ã“ã§ã¯è‡ªåˆ†ã§é©å½“ã« `self-hosted-zhgchgli` ã¨ã„ã†ãƒ©ãƒ™ãƒ«ã‚’è¨­å®šã—ã¾ã—ãŸã€‚

- ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: [_workã§Enter] **ãã®ã¾ã¾Enter**

âˆš Settings Saved. ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€è¨­å®šã¯å®Œäº†ã§ã™ã€‚

![](/assets/404bd5c70040/1*yxLfii0rWhzsiFuYVmPgFw.png)

**ãƒ©ãƒ³ãƒŠãƒ¼ã®èµ·å‹•:**

```bash
./run.sh
```

âˆš Connected to GitHubã€Listening for Jobs ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã™ã§ã« Actions ã®ã‚¸ãƒ§ãƒ–ã‚’ç›£è¦–ã—ã¦ã„ã¾ã™ï¼š

![](/assets/404bd5c70040/1*1RmPPOosAoCxHA9tg_WE2w.png)

> ***ã“ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ãªã„é™ã‚Šã€ã‚¿ã‚¹ã‚¯ã®å—ä¿¡ã‚’ç¶™ç¶šã—ã¾ã™ã€‚***

> ***ğŸš€ğŸš€ğŸš€åŒã˜ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§è¤‡æ•°ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€ç•°ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§è¤‡æ•°ã®ãƒ©ãƒ³ãƒŠãƒ¼ã‚’èµ·å‹•ã§ãã¾ã™ã€‚***

**ãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ã¨ã€Runner ãŒã‚¸ãƒ§ãƒ–ã‚’å¾…æ©Ÿã—ã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã¾ã™ï¼š**

![](/assets/404bd5c70040/1*jjq5NTPYMuC3gH3ey_VTtg.png)

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š**

- Idle: ã‚¢ã‚¤ãƒ‰ãƒ«çŠ¶æ…‹ã€ã‚¿ã‚¹ã‚¯ã‚’å¾…æ©Ÿä¸­

- Active: ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œä¸­ã§ã™

- Offline: ãƒ©ãƒ³ãƒŠãƒ¼ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™

#### Workflow(GitHub Actions) Runner ã‚’ Self-hosted Runner ã«å¤‰æ›´ã™ã‚‹

`Automation-PullRequest.yml` ã‚’ä¾‹ã«ï¼š

```yaml
# å‰è¿°ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
jobs:
  label-pr-by-file-count:
    # å‰è¿°ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
    runs-on: [self-hosted-zhgchgli]
    # å‰è¿°ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
  # ---------
  assign-self-if-no-assignee:
    # å‰è¿°ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
    runs-on: [self-hosted-zhgchgli]

    steps:
      # å‰è¿°ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€çœç•¥....
```

Commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸå¾Œã€PR ã‚’å†åº¦é–‹ã„ã¦ Actions ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¦æ¤œè¨¼ã—ã¾ã™ã€‚

**Runner ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã‚‹ã¨ã€æ–°ã—ã„ã‚¸ãƒ§ãƒ–ãŒæ¥ã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã€å®Ÿè¡Œä¸­ãŠã‚ˆã³å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š**

![](/assets/404bd5c70040/1*Hu0DxKQbenPmBEw8swv65A.png)

å¤±æ•—ã—ã¾ã—ãŸã€‚ãªãœãªã‚‰ã€ç§ã®ãƒ­ãƒ¼ã‚«ãƒ«PCã« [gh cli](https://github.com/cli/cli){:target="_blank"} ç’°å¢ƒãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã‹ã£ãŸã‹ã‚‰ã§ã™ï¼š

![](/assets/404bd5c70040/1*9xguacdPATIeEZdbFszmHw.png)

`brew install gh` ã‚’å®Ÿæ©Ÿã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã€å†åº¦å®Ÿè¡Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ï¼š

![](/assets/404bd5c70040/1*TbkAt00K89Ysbix33dK8ZA.png)

æˆåŠŸã—ã¾ã—ãŸï¼ã“ã‚Œã§ã“ã®ã‚¸ãƒ§ãƒ–ã¯å®Œå…¨ã«è‡ªåˆ†ã®PCã§å®Ÿè¡Œã•ã‚Œã€GitHub Hosted Runnerã¯ä½¿ã‚ãšã€æ–™é‡‘ã‚‚ã‹ã‹ã‚Šã¾ã›ã‚“ã€‚

**Action Log ã§ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚ŒãŸ Runner ã‚„ãƒã‚·ãƒ³ã‚’ç¢ºèªã§ãã¾ã™ï¼š**

![](/assets/404bd5c70040/1*oqLcWfn6cbWsCt9fVsrikQ.png)

#### runs-on: [ **Runner Label] è¨­å®š**

ã“ã“ã¯ AND ã§ã™ã€‚GitHub Runner ã¯ç¾æ™‚ç‚¹ã§ OR ã«ã‚ˆã‚‹ Runner é¸æŠã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ã€`[self-hosted, macOS, app]` â†’ Runner ãŒ **åŒæ™‚ã«** `self-hosted, macOS, app` ã®3ã¤ã®ãƒ©ãƒ™ãƒ«ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã«ã®ã¿ã€ã‚¸ãƒ§ãƒ–ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚‚ã—ä¸€ã¤ã® Job ã§ç•°ãªã‚‹ Runner ç’°å¢ƒã®çµæœã‚’åŒæ™‚ã«ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã¯ã€`matrix` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š

```yaml
jobs:
  test:
    runs-on: ${{ matrix.runner }}
    strategy:
      matrix:
        runner:
          - [self-hosted, linux, high-memory]
          - [self-hosted, macos, xcode-15]

    steps:
      - run: echo "Running on ${{ matrix.runner }}"
```

ã“ã†ã™ã‚‹ã¨ã€ã“ã®ã‚¸ãƒ§ãƒ–ã¯ä»¥ä¸‹ã®2ã¤ã® Runner ãƒ©ãƒ™ãƒ«ã® Runner ä¸Šã§ä¸¦è¡Œã—ã¦ãã‚Œãã‚Œ1å›ãšã¤å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

- self-hostedã€linuxã€é«˜ãƒ¡ãƒ¢ãƒª

- self-hostedã€macosã€xcode-15

> ***Runner ã¯ã¾ã ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ï¼š***

> *- ã¾ãŸã¯ Runner ã®é¸æŠ*

> *- Runner ã®é‡ã¿ä»˜ã‘è¨­å®š*

#### Runner ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç™»éŒ²ã™ã‚‹

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€Œ [Configuring the self-hosted runner application as a service](https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac){:target="_blank"} ã€ã‚’å‚è€ƒã«ã—ã¦ã€Runner ã‚’ç›´æ¥ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç™»éŒ²ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚Œï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã‹ãšã«ï¼‰ã€èµ·å‹•æ™‚ã«è‡ªå‹•ã§é–‹å§‹ã•ã‚Œã¾ã™ã€‚

è¤‡æ•°ã®ãƒ©ãƒ³ãƒŠãƒ¼ãŒã‚ã‚‹å ´åˆã¯ã€ã€Œ[Customizing the self-hosted runner service](https://docs.github.com/en/actions/how-tos/hosting-your-own-runners/managing-self-hosted-runners/configuring-the-self-hosted-runner-application-as-a-service?platform=mac#customizing-the-self-hosted-runner-service-1){:target="_blank"}ã€ã®è¨­å®šã§ç•°ãªã‚‹åå‰ã‚’ç™»éŒ²ã™ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

> *iOS ã“ã¡ã‚‰ã§èª¿æŸ»ãŒå¿…è¦ãªå•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆãŸå¾Œã€Archive æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ï¼ˆã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³æ¨©é™ã«é–¢é€£ã—ã¦ã„ã‚‹ç–‘ã„ãŒã‚ã‚Šã¾ã™ï¼‰**ã€‚å½“æ™‚ã¯æ™‚é–“ãŒãªã‹ã£ãŸãŸã‚ã€å…ˆã«ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã® Terminal Runner ã‚’ä½¿ã„ã¾ã—ãŸã€‚*

ã‚‚ã—å¾“æ¥ã®ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•ã•ã›ãŸã„å ´åˆã¯ã€`~/Library/LaunchAgents` ã«è‡ªå‹•èµ·å‹•è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

`actions.runner.REPO.RUNNER_NAME.plist` ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
 <dict>
  <key>Label</key>
  <string>actions.runner.REPO.RUNNER_NAME</string>
  <!-- Terminal.app ã‚’æŒ‡å®šã—ã¦èµ·å‹• -->
  <key>ProgramArguments</key>
  <array>
   <string>/usr/bin/open</string>
   <string>-a</string>
   <string>Terminal</string>
   <string>/Users/zhgchgli/Documents/actions-runner/run.sh</string>
  </array>
  <key>RunAtLoad</key>
  <true/>
  <key>WorkingDirectory</key>
  <string>/Users/zhgchgli/Documents/actions-runner</string>
 </dict>
</plist>
```

> *DevOps ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã€å…¬å¼ã® [k8s Runner](https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller#scaling-runners){:target="_blank"} ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚*

#### å®Œå…¨ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒª

[![](https://opengraph.githubassets.com/8b25f8eae56bc35c92b97c5d7e7834aa5cb87673e718a1ce829f5bb80f3edebb/ZhgChgLi/github-actions-ci-cd-demo)](https://github.com/ZhgChgLi/github-actions-ci-cd-demo){:target="_blank"}

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

[![](https://docs.github.com/assets/cb-345/images/social-cards/actions.png)](https://docs.github.com/en/actions/get-started/quickstart){:target="_blank"}

ã‚ˆã‚Šè©³ç´°ãªè¨­å®šæ–¹æ³•ã«ã¤ã„ã¦ã¯ã€å¿…ãšå…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### AI ãŒåŠ©ã‘ã«ãªã‚Šã¾ã™ï¼

![](/assets/404bd5c70040/1*JecNUCqujV1oeAvHA14X-g.png)

å®Ÿéš›ã«ChatGPTã«å®Œå…¨ãªæ‰‹é †ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ä¼ãˆã‚Œã°ã€GitHub Actionsã‚’ã™ãã«ä½œæˆã—ã¦ãã‚Œã¾ã™ï¼

### ã¾ã¨ã‚

ç¾åœ¨ã€GitHub Actions + Self-hosted Runner ã«ã¤ã„ã¦ã‚ã‚‹ç¨‹åº¦ç†è§£ã§ããŸã¨æ€ã„ã¾ã™ã€‚æ¬¡å›ã¯ App (iOS) ã® CI/CD ã‚’äº‹ä¾‹ã«ã€æ‰‹å–ã‚Šè¶³å–ã‚Šã§ä¸€é€£ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

### ã‚·ãƒªãƒ¼ã‚ºè¨˜äº‹ï¼š

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ1ï¼‰ï¼šCI/CD ã¨ã¯ï¼ŸCI/CD ã‚’ä½¿ã£ã¦å®‰å®šã§åŠ¹ç‡çš„ãªé–‹ç™ºãƒãƒ¼ãƒ ã‚’ä½œã‚‹æ–¹æ³•ã¯ï¼Ÿãƒ„ãƒ¼ãƒ«ã®é¸ã³æ–¹ã¯ï¼Ÿ**](../c008a9e8ceca/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆäºŒï¼‰ï¼šGitHub Actions ã¨ self-hosted Runner ã®ä½¿ç”¨ã¨æ§‹ç¯‰å¤§å…¨**](../404bd5c70040/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆä¸‰ï¼‰ï¼šGitHub Actions ã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® CI ã¨ CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…**](../4b001d2e8440/)

- [**CI/CD å®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼ˆ4ï¼‰ï¼šGoogle Apps Script Web App ã‚’ä½¿ã£ã¦ GitHub Actions ã¨é€£æºã—ã€ç„¡æ–™ã§ä½¿ã„ã‚„ã™ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹**](../4273e57e7148/)

#### [Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

> [***æœ¬ã‚·ãƒªãƒ¼ã‚ºã®è¨˜äº‹ã¯å¤šãã®æ™‚é–“ã¨åŠ´åŠ›ã‚’ã‹ã‘ã¦åŸ·ç­†ã—ã¦ã„ã¾ã™ã€‚å†…å®¹ãŒå½¹ç«‹ã¡ã€ã”è‡ªèº«ã‚„ãƒãƒ¼ãƒ ã®ä½œæ¥­åŠ¹ç‡ã‚„è£½å“å“è³ªã®å‘ä¸Šã«ç¹‹ãŒã‚‹å ´åˆã¯ã€ãœã²ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’ã”é¦³èµ°ã—ã¦ãã ã•ã„ã€‚ã”æ”¯æ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼***](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

![[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}](/assets/404bd5c70040/1*QJj54G9gOjtQS-rbHVT1SQ.png)

[Buy me a coffee](https://www.buymeacoffee.com/zhgchgli){:target="_blank"}

ã”è³ªå•ã‚„ã”æ„è¦‹ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãœã²[ã“ã¡ã‚‰ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„](https://www.zhgchg.li/contact){:target="_blank"} ã€‚

*[Post](https://dev.zhgchg.li/ci-cd-%E5%AF%A6%E6%88%B0%E6%8C%87%E5%8D%97-%E4%BA%8C-github-actions-%E8%88%87-self-hosted-runner-%E4%BD%BF%E7%94%A8%E8%88%87%E5%BB%BA%E7%BD%AE%E5%A4%A7%E5%85%A8-404bd5c70040){:target="_blank"} Mediumã‹ã‚‰[ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}ã§å¤‰æ›ã€‚*