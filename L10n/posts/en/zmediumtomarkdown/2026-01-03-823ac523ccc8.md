---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2026-01-03T17:03:46.382+0000
description: Discover how to streamline iOS certificate issuance and management using
  Fastlane Match, integrating Certificates, Identifiers & Profiles seamlessly into
  your CI/CD pipeline for efficient app deployment.
image:
  path: /assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg
last_modified_at: 2026-01-05T00:55:47.972+0000
render_with_liquid: false
tags:
- ios-app-development
- fastlane
- keychain
- github-actions
- macos
- english
- ai-translation
title: iOS Certificates, Identifiers & Profiles ExplainedÔΩúFastlane Match for Unified
  Certificate Management in CI/CD
---

### What are iOS Certificates, Identifiers & Profiles and **Some Notes on Unified Management of Certificates and CI/CD with Fastlane Match**

Introduction to the relationship between Certificates, Identifiers & Profiles and using Fastlane Match to centrally manage issued certificates and integrate them into the CI/CD workflow.

![Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg)

Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}

#### Preface

In mid-2025, a series of articles was written on building a complete App CI/CD process from scratch using GitHub Actions:

- [CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team with CI/CD? Tool Selection?](../c008a9e8ceca/)

- [CI/CD Practical Guide (Part 2): Complete Guide to Using and Building GitHub Actions with Self-hosted Runner](../404bd5c70040/)

- [CI/CD Practical Guide (Part 3): Implementing CI and CD Workflows for App Projects with GitHub Actions](../4b001d2e8440/)

- [CI/CD Practical Guide (Part 4): Using Google Apps Script Web App to Connect GitHub Actions for Building a Free and Easy Packaging Tool Platform](../4273e57e7148/)

Recently, I set up everything again in a new environment and learned new things each time. This time, I focused on iOS Codesigning: the relationship between Certificates, Profiles, and Devices, and how I use Fastlane Match to manage certificates and integrate with CI/CD.

### [What are Certificates, Identifiers & Profiles, and Devices?](https://developer.apple.com/account/resources/certificates/list){:target="_blank"}

In the Apple ecosystem, app development is based on certificate and profile management, unlike Android where having an .apk file is enough to install and use. Apple enforces strict certificate matching rules; if these are not met, the app cannot be installed or used.

#### **Main Components and Their Functions:**

![](/assets/823ac523ccc8/1*PyM0l-jXXcVBKubOwCiTsw.png)

#### **Certificates:** The identity used to sign the App (Signing Identity)

- **Development** ‚Äî Used on physical devices during the development phase (no certificates needed for simulators), belongs to a person or API Key (with quantity limits).

- **Distribution** ‚Äî Packaging for App Store, TestFlight, or Ad Hoc internal testing (limited to registered devices), with quantity limits, belongs to the Team.

- **Enterprise** ‚Äî For internal use within the enterprise.

> ***Format*** *: Requires both `Private Key` and `Certificate .cer` to use, or exporting from the original creation computer's Keychain as a `.p12` file will include both.*

![](/assets/823ac523ccc8/1*oP_p2kJ1Prqku4D8LIZ7yg.png)

#### **Identifiers: Which App/Extension (Bundle ID)**

App's Bundle ID registration and the required enabled Capabilities (such as Push Notifications, App Groups‚Ä¶) and App Services.

Extensions also have their own Identifier.

#### **Devices: Registered Devices (iPhone/iPad, etc.)**

Development running on physical devices and Distribution Ad Hoc internal testing can only be used on registered devices.

> ***Limit: 100; including cancellations, the quota resets only at the start of each annual billing cycle.***

#### **Provisioning Profile (hereafter Profile):**

Combination of Certificates + Identifiers + Devices Relationships.

- **Development** ‚Äî The provisioning profile used during the development phase. It is required for running tests on physical devices. The profile includes the relationship between Certificates, Identifiers, and Devices.

- **Ad Hoc** ‚Äî A provisioning profile for internal testing (e.g., Deploy to Firebase App Distribution), containing the relationship between Certificates, Identifiers, and Devices.

- **App Store** ‚Äî The provisioning profile used for packaging and uploading to the App Store / TestFlight, containing the relationship between Certificates and Identifiers.

> *Format: `.mobileprovision`*

> ***Note: A Profile is just a description file that defines relationships; it does not contain the actual certificate.***

#### Summary

Based on the above, to build on a clean machine without logging into the Xcode Apple Account for a physical device (Development Certificate) or to perform Archive packaging (Distribution Certificate), **you must have two files**:

- `.mobileprovision` Provisioning Profile: Describes the relationship between Certificates, Identifiers, and Devices.

- `.p12` Certificate: The physical certificate (exported from the original computer where the certificate was created).

**Additionally, for macOS ‚â• 15, the Keychain has moved to:**

```bash
open /System/Library/CoreServices/Applications/Keychain\ Access.app
```

*Looked for a long time...*

#### Common Errors

**‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è Certificates and Profiles are confirmed correct but errors still occur:**

> *Most likely, you still have leftover or multiple certificates from before, causing Xcode to get confused.*

> ***This issue is very common!***

1. Close Xcode

2. Open macOS keychain: `open /System/Library/CoreServices/Applications/Keychain\ Access.app`

3. login keychain -> All items -> search `apple development` -> delete all Certificates

4. Finder -> Go -> Go to -> `~/Library/MobileDevice/Provisioning\ Profiles` -> Delete all Profiles files

5. Re-pull Certificates

6. Restarting Xcode should fix the issue.

**No signing certificate ‚ÄúiOS Distribution‚Äù found / No signing certificate ‚ÄúiOS Development‚Äù found:**

```vbnet
No "iOS Distribution" signing certificate matching team ID "" with a private key was found.
No "iOS Development" signing certificate matching team ID "" with a private key was found.
```

**Reason:**

- Missing iOS Distribution/iOS Development Certificate

- Have an iOS Distribution/iOS Development Certificate **but no corresponding Private Key**

**Solution:**

- Delete all old Certificates and Profiles from the Keychain

- Find the certificate in the Keychain of the computer where the Certificate was originally created, export it as a `.p12` file, and install it on the problematic computer.

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} to revoke the old Certificate and generate a new one  
  (Don't worry, this won't affect the live app; it only impacts development and packaging stages)

**Provisioning profile ‚Äú‚Äù doesn‚Äôt include signing certificate ‚ÄúApple Development: XXX‚Äù. / Provisioning profile ‚Äú‚Äù doesn‚Äôt include signing certificate ‚ÄúApple Distribution: XXX‚Äù.:**

**Reason:**

- The currently selected Provisioning Profile does not match the current Certificate.

**Solution:**

- Delete all old Certificates and Profiles from the Keychain

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles to ensure the profile has the corresponding certificate checked or regenerate the Profile for use.

**No profile for team ‚Äò‚Äô matching ‚Äò‚Äô found: Xcode couldn‚Äôt find any provisioning profiles matching ‚Äò‚Äô.:**

**Reason:**

- Specified Provisioning Profile Not Found

**Solution:**

- Delete all old Certificates and Profiles from the Keychain

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} to download the corresponding Profile for use

**Provisioning profile ‚Äú‚Äù has app ID ‚Äú‚Äù, which does not match the bundle ID ‚Äú‚Äù. / Provisioning profile doesn‚Äôt match the bundle identifier:**

**Reason:**

- Provisioning profile does not include the current Bundle Identifier

**Solution:**

- Delete all old Certificates and Profiles in the Keychain

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} and verify that the Bundle Identifier is registered under Identifiers.

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} to download the corresponding Profile for use

**Provisioning profile ‚Äú‚Äù doesn‚Äôt include the currently selected device ‚Äú‚Äù (identifier ).:**

**Reason:**

- Provisioning profile does not include the selected physical device's Device Identifier

**Solution:**

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Devices to confirm the physical device's Identifier is registered.

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} and make sure the corresponding Profile has the physical device checked and enabled.

- Re-download Profile for Use

**Could not create another Development/Distribution certificate, reached the maximum number of available Development/Distribution certificates. :**

**Reason:**

Indicates that the maximum number of Development/Distribution Certificates has been reached.

**Solution:**

- Go to [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} to delete unused certificates.

**Xcode certificates are correct and packaging works fine, but signing errors occur when running packaging commands via CLI (Fastlane):**

**Reason:**

Here I also ran into another issue: I foolishly placed the project in the iCloud sync folder, and for some reason, Fastlane kept showing certificate problems (suspected keychain access issues).

**Solution:**

Simply move out of the iCloud sync directory.

### Common Issues in Daily Use

#### Development Certificate

![](/assets/823ac523ccc8/1*uNICvLN0a9gdGAzi4EZ24g.png)

- Before adopting Match for unified certificate management, each developer creates their own `Development Certificate` and `Development Profile`; assuming there are 1,000+ developers in the organization, the [Certificates, Identifiers & Profiles, Devices](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} backend becomes extremely chaotic and unmanageable.

- If you have an outsourced team responsible only for development, you still need to add them to the Apple Developer Program backend so they can create their own development certificates and profiles.

#### Distribution Certificate

![](/assets/823ac523ccc8/1*1JKlvoO8d89dlcpz2mJvjg.png)

- Distribution Certificates are created by the Team, so each developer program Team can only create a limited number of distribution certificates.

- A common practice is for one engineer to create the Distribution Certificate and export the .p12 file to other developers who need to publish the app or to use it on the CI/CD machines.

- When the team is large and there are many apps, sending certificates back and forth becomes very troublesome, and **they need to be renewed every year**.

- **When packaging Ad Hoc, if a new device is registered, everyone and the CI/CD must re-download the Profile for the new device to take effect.**

### [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"}

Based on the above issues, we want a platform to manage everything related to certificates on our behalf. All developers and CI/CD services will pull and update data uniformly from this platform. The storage of this platform must be secure. This is ‚Äî [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"}.

> *Easily sync your certificates and profiles across your team*

> *A new approach to iOS and macOS code signing: Share one code signing identity across your development team to simplify your code signing setup and prevent code signing issues.*

> *match is the implementation of the [codesigning.guide concept](https://codesigning.guide/){:target="_blank"}. match creates all required certificates & provisioning profiles and stores them in a separate git repository, Google Cloud, or Amazon S3. Every team member with access to the selected storage can use those credentials for code signing. match also automatically repairs broken and expired credentials. It‚Äôs the easiest way to share signing credentials across teams*

![](/assets/823ac523ccc8/1*UEL7Abx3PFrYbAc2yVlq8A.png)

**Fastlane Match:**

- Interact with App Store Connect (via App Store Connect API or Apple Developer Login Session) to generate or update certificates

- Encrypt and upload the certificate files (`.mobileprovision` Profiles, `.p12` Certificate, `.cer` Certificate) to the Git Repo (or other storage).  
  The `.cer` Certificate is also stored separately, as this allows verification of the certificate's validity.

- If you want to divide permissions, you can use two Repos: one for managing Development certificates and another for Distribution certificates.

[**Folder structure:**](https://docs.fastlane.tools/actions/match/){:target="_blank"}

- The `certs` folder contains all certificates with their private keys

- The `profiles` folder contains all provisioning profiles

![<https://docs.fastlane.tools/actions/match/>{:target="_blank"}](/assets/823ac523ccc8/1*mStp0t3Ty3xGTKvbiBGtqw.png)

<https://docs.fastlane.tools/actions/match/>{:target="_blank"}

Encryption Algorithm: [AES-256-GCM](https://github.com/fastlane/fastlane/blob/master/match/lib/match/encryption/encryption.rb){:target="_blank"}

**Developers, CI/CD Services:**

- Use the Fastlane match command to manage certificates consistently.

- Fastlane Match will first fetch the certificate files from the Git repo and decrypt them for use. If it detects expired or unusable certificates and has Create/Write permissions, it will automatically regenerate and push them back to the repo; if it only has Read permission, it will report an error.

**Create/Write:**

- Only the person responsible for managing certificates can generate, update, and push certificates.

- **Important Distribution Certificates should be stored in a separate repo accessible only by CI/CD services or administrators**

**Read:**

- Other developers and CI/CD services have **read-only** access to pull certificates.

- The CI/CD service pulls the latest certificates before each task execution.

- Everyone shares the same Development & Distribution Certificate.

- After personnel changes, access to the Match Repo will be lost. You can revoke the old certificates and generate new ones. Others just need to pull again (if integrated with a make project script, it‚Äôs even smoother).

### Fastlane Match Setup and Usage

Taking Git Storage as an example, all certificates.

**1. Create an Empty Git Private Match Repo for Storing Certificates**  
Although all Certificates and Profiles are stored encrypted, you still need to set proper access permissions for the repo.

2. Confirm that Git SSH access permissions are set up locally. You can use `git clone git@github.com:xxx/certificates.git` to verify.

> *It is recommended to **use SSH Git Clone Repo consistently**, as CI/CD will use the same method.*

> *If running fastlane match gets stuck at `If cloning the repo takes too long, you can use the `clone_branch_directly` option in match.`, it is most likely an SSH permission issue.*

3. Run `bundle exec fastlane match init` in the project directory to complete the setup

```lua
[21:54:32]: fastlane match supports multiple storage modes, please select the one you want to use:
1. git
2. google_cloud
3. s3
4. gitlab_secure_files
# Enter 1 to use git
?   1

[22:04:40]: Please create a new, private git repository to store the certificates and profiles there
[22:04:40]: URL of the Git Repo: git@github.com:xxx/certificates.git
# Enter the SSH URL of the Git Private Match Repo you created

[22:04:47]: Successfully created './fastlane/Matchfile'. You can open the file using a code editor.
[22:04:47]: You can now run `fastlane match development`, `fastlane match adhoc`, `fastlane match enterprise` and `fastlane match appstore`
[22:04:47]: On the first run for each environment it will create the provisioning profiles and
[22:04:47]: certificates for you. From then on, it will automatically import the existing profiles.
[22:04:47]: For more information visit https://docs.fastlane.tools/actions/match/
```

4. After completion, a **`fastlane/Matchfile` :** will be generated

```bash
# Your Git Private Match Repo SSH URL
git_url("git@github.com:xxxx/certificates.git")

storage_mode("git")

type("development") # The default type, can be: appstore, adhoc, enterprise or development

# app_identifier(["tools.fastlane.app", "tools.fastlane.app2"])
# username("user@fastlane.tools") # Your Apple Developer Portal username

# For all available options run `fastlane match --help`
# Remove the # at the beginning of the line to enable other options

# The docs are available on https://docs.fastlane.tools/actions/match
```

**5. Generate [App Store Connect API .p8 Key](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"}**, **use the API Key uniformly to create certificates:**

![](/assets/823ac523ccc8/1*RFhS_XtZ3TfIJBAeoE-laA.png)

> *‚ö†Ô∏èÔ∏èÔ∏èÔ∏è [**App Store Connect API .p8 Key**](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"} **has extensive permissions**. It can manage certificates, app submissions and reviews, as well as backend users, reviews, and financial reports.*

> *Whether to include it in the team's .git for everyone to access can be decided based on the team's situation.*

> ***A higher security approach is to allow only the managers to handle it and store it encrypted for use in CI/CD (introduced later in the article).***

> ***For demo convenience, it is placed directly under the fastlane directory for access.***

> ***Also, the Fastlane script in this article is simplified for demonstration purposes and does not consider code duplication or structure.***

#### Certificate Management

```bash
platform :ios do
  lane :match_development do \\|options\\|
    # Replace with your App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    type = options.fetch(:type, "development")
    isRead = options.fetch(:isRead, true)
    if isRead 
      readonly = true
      force = false
    else
      readonly = false
      force = true

      # App Store Connect API Key is required to manage certificates in Apple backend
      # Assume the App Store Connect API .p8 Key is in the ./fastlane/ directory
      app_store_connect_api_key(
        key_id: "XXXXXX",
        issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
        key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
      )
    end

    # Fetch Development certificates for app_identifier
    match(
      type: type,
      app_identifier: app_identifier, 
      readonly: readonly, # Whether to update/upload cert/profile if needed
      force: force # Whether to recreate provisioning profile unconditionally
    )
  end
end
```

**Create Development Certificate & Profile and Upload to Match Repo:**

```
bundle exec fastlane match_development type:development isRead:false
```

- No errors mean the Development Certificate & Profile were successfully created, installed, and pushed to the Match Repo.

**The first time setup requires you to set a `Passphrase`:**

```markdown
[23:29:12]: Enter the passphrase that should be used to encrypt/decrypt your certificates
[23:29:12]: This passphrase is specific per repository and will be stored in your local keychain
[23:29:12]: Make sure to remember the password, as you'll need it when you run match on a different machine
[23:29:12]: Passphrase for Match storage:
```

- This value is used as a reference for encrypting all the files in your Match Repo (passphrase + random salt).

- It is recommended to generate a [random string](https://www.random.org/strings/?num=1&len=32&digits=on&upperalpha=on&loweralpha=on&unique=on&format=html&rnd=new){:target="_blank"}, set it, and record it.

- Future updates or other users pulling the Match Repo certificates will need to enter this string to decrypt the original files.

**Other team members uniformly pull the Development Certificate & Profile from the Match Repo:**

```bash
bundle exec fastlane match_development type:development
```

**The first time you use it, you will be asked for your login password (login keychain) because the certificate needs to be installed into the keychain. Just enter it twice to confirm:**

```markdown
[16:52:59]: Installing certificate...
[16:53:00]: There are no local code signing identities found.
You can run security find-identity -v -p codesigning to get this output.
This Stack Overflow thread has more information: https://stackoverflow.com/q/35390072/774.
(Check in Keychain Access for an expired WWDR certificate: https://stackoverflow.com/a/35409835/774 has more info.)
[16:53:00]: Enter the password for /Users/zhgchgli/Library/Keychains/login.keychain-db
[16:53:00]: This passphrase will be stored in your local keychain with the name fastlane_keychain_login and used in future runs
[16:53:00]: This prompt can be avoided by specifying the 'keychain_password' option or 'MATCH_KEYCHAIN_PASSWORD' environment variable
[16:53:00]: Password for login keychain: ********
[16:53:24]: Type password for login keychain again: ********
```

**If Match Development has fetched the certificates, but Xcode still shows errors or invalid status:**

You can refer to the common errors mentioned earlier. Most are caused by old, corrupted certificates. Clearing all certificates and then fetching them again should resolve the issue.

‚Äî

**Create AdHoc Distribution Certificate & Profile and Upload to Match Repo:**

```bash
bundle exec fastlane match_development type:adhoc isRead:false
```

**Create AppStore Distribution Certificate & Profile and Upload to Match Repo:**

```bash
bundle exec fastlane match_development type:appstore isRead:false
```

**CI/CD services uniformly pull Distribution Certificate & Profile ( `isRead:true` ) from the Match Repo, then execute the build and release tasks.**

#### Register a New Device

```php
platform :ios do  
  desc "Register a new device and refresh profiles"
  lane :registerDevice do \\|options\\|
    # Replace with your App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    # App Store Connect API Key is required to manage certificates in Apple backend
    # Assume the App Store Connect API .p8 Key is in the ./fastlane/ directory
    app_store_connect_api_key(
      key_id: "XXXXXX",
      issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
      key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
    )
    # Input: UDID and device name
    udid = options[:udid] \\|\\| UI.input("Enter device UDID:")
    device_name = options[:name] \\|\\| UI.input("Enter device name:")
    UI.message("üì± Registering device #{device_name} (#{udid})")
    register_device(
      name: device_name,
      udid: udid,
      platform: 'ios'
    )

    # Update Development certificates for app_identifier
    match(
      type: "development",
      app_identifier: app_identifier, 
      readonly: false, # Update and upload cert/profile if needed
      force_for_new_devices: true # Recreate provisioning profile for new devices
    )

    # Update AdHoc certificates for app_identifier
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # Update and upload cert/profile if needed
      force_for_new_devices: true # Recreate provisioning profile for new devices
    )
  end
end
```

After registration, other developers or CI/CD services pulling the Profile (Development or AdHoc) from the Match Repo will include the new devices.

### Fastlane Match x CI/CD Workflow Integration

After a general introduction to how Fastlane Match generates Push and Pull certificates, next is to explain how to integrate it into the CI/CD process.

#### Question 1 ‚Äî How to Clone Private Match Repo

The most common issue is how to clone the private Match repo in CI/CD. On local development, we use SSH git clone with our own account's SSH key, so there is no problem. However, CI/CD does not have this key. Although you can use a personal key, it is not secure.

**GitHub ‚Äî Repo Deploy Key:**

1. First, generate the private/public key locally: `ssh-keygen -t rsa -b 4096 -f ./id_rsa` ( **do NOT enter a `passphrase`** )

2. Go to **Match Private Repo** -> Settings -> Security -> Deploy keys -> Add deploy key:

![](/assets/823ac523ccc8/1*nzo-oPRi7DDxPvtJIWBspw.png)

3. Open `id_rsa.pub` with a text editor, copy the content, and paste it into Key -> "Add key"

![](/assets/823ac523ccc8/1*mbwtijzM-2iAzfgFiT32rw.png)

5. Go back to the main Repo -> Settings -> Security -> Secrets and variables

![](/assets/823ac523ccc8/1*jvY8Yg6tI85LNKHgIaHVVQ.png)

5. Add SSH Private Key Content to Secret:

![](/assets/823ac523ccc8/1*8WiPfOz21rJWD6yiMwP3aw.png)

- Name: `MATCH_REPO_DEPLOY_PRIVATE_KEY`

6. Back to the main repo's GitHub Actions setting SSH Key:

```yaml
name: CI - Deploy

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: Test Clone
        run: \\|
          git clone git@github.com:xxxx/match-certificates.git
# Success!
# .. do deploy job...
```

7. Setup Successful!

#### Question 2 ‚Äî Secure Storage and Use of App Store Connect API .p8 Key

Because GitHub Actions cannot store files directly, you must first save as a string and then write it to a file.

1. Same as step 1, add an `APP_STORE_CONNECT_API_KEY_CONTENT` Secret in the main Repo.

2. Open `AuthKey_XXXXXX.p8` with a text editor, then copy and paste the content.

3. **Add a step in the main repo's GitHub Actions to read content and write to a file:**

```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```

#### Issue 3 ‚Äî Setting a Passphrase for the Private Match Repo to Prevent Prompt Interruptions During Match

1. For the same step as Question 1, add `MATCH_PASSWORD` to Secrets in the main Repo

2. Enter the `Passphrase` for the Fastlane Match Repo you configured

3. **Add** `env: secret.MATCH_PASSWORD` **to the main repo's GitHub Actions:**

```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```

#### Question 4 ‚Äî Keychain Handling on Self-hosted Runner

Unlike cloud machines that are always clean and new each time, with Self-hosted Runner we can specify `derived_data_path`, `output_directory`, `buildlog_path`, and `reinstall_app` in Fastlane to ensure a clean environment for each run; however, Certificates and Profiles are installed in the system Keychain app. How should we handle this?

Actually, Fastlane has considered this for us. You can create a clean Keychain before running Match:

```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Create fastlane keychain
        env:
          KEYCHAIN_NAME: "${{ runner.name }}"
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: \\|
          bundle exec fastlane run create_keychain \
            name:"$KEYCHAIN_NAME" \
            password:"$MATCH_PASSWORD" \
            unlock:true \
            timeout:0 \
            lock_when_sleeps:false
      
      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
          KEYCHAIN_NAME: "${{ runner.name }}"
        run: bundle exec fastlane deploy_to_firebase

      # üî• This will run regardless of success or failure above
      - name: Delete fastlane keychain
        if: always()
        env:
          KEYCHAIN_NAME: ${{ runner.name }}
        run: \\|
          bundle exec fastlane run delete_keychain \
            name:"$KEYCHAIN_NAME"
```

- Each Runner only executes one job at a time, so we use the Runner Name as the Keychain Name. Each Runner will have its own Keychain.

- Deleted regardless of success or failure after execution

- I did not set a separate `keychain_password`; I used `MATCH_PASSWORD` uniformly.

Add keychain parameters to the match method in `Fastlane/Fastfile`:

```ruby
#...
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # Update and upload cert/profile if needed
      force_for_new_devices: true, # Recreate provisioning profile for new devices
      keychain_name: ENV['KEYCHAIN_NAME'], # default value: nil
      keychain_password: ENV['MATCH_PASSWORD'] # default value: nil
    )
#...
```

This way, when Match fetches certificates, it will save them to the specified Keychain instead of the shared login keychain.

### Conclusion

The scope of Fastlane is very broad, so here I will only document the process of using Fastlane Match; other lanes like testing, packaging, and publishing will be covered in a separate article if there is a chance. I will also add more Match-related issues and cases as they come up! Feel free to leave questions in the comments!

### Further Reading

- [CI/CD Practical Guide (Part 1): What is CI/CD? How to Build a Stable and Efficient Development Team with CI/CD? Tool Selection?](../c008a9e8ceca/)

- [CI/CD Practical Guide (Part 2): Complete Guide to Using and Building GitHub Actions with Self-hosted Runner](../404bd5c70040/)

- [CI/CD Practical Guide (Part 3): Implementing CI and CD Workflows for App Projects with GitHub Actions](../4b001d2e8440/)

- [CI/CD Practical Guide (Part 4): Using Google Apps Script Web App to Connect GitHub Actions for Building a Free and Easy Packaging Tool Platform](../4273e57e7148/)

**Please kindly proceed to read. ü§ûüèª**

If you have any questions or feedback, feel free to [contact me](https://www.zhgchg.li/contact){:target="_blank"}.

*[Post](https://medium.com/zrealm-ios-dev/ios-certificates-identifiers-profiles-%E6%98%AF%E4%BB%80%E9%BA%BC%E5%8F%8A-fastlane-match-%E7%B5%B1%E4%B8%80%E7%AE%A1%E7%90%86%E6%86%91%E8%AD%89%E8%88%87-ci-cd-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%86%E8%A8%98-823ac523ccc8){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*