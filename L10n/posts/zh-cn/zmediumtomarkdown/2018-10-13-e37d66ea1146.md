---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2018-10-13T18:07:49.431+0000
description: æ–‡
image:
  path: /assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif
last_modified_at: 2024-04-13T07:11:24.880+0000
render_with_liquid: false
tags:
- simplified-chinese
- swift
- ios
- mobile-app-development
- uitextview
- ios-app-development
title: iOS UITextView æ–‡ç»•å›¾ç¼–è¾‘å™¨ (Swift)
---

### iOS UITextView æ–‡ç»•å›¾ç¼–è¾‘å™¨ (Swift)



å®æˆ˜è·¯çº¿



#### ç›®æ ‡åŠŸèƒ½ï¼š



APPä¸Šæœ‰ä¸€ä¸ªè®©ä½¿ç”¨è€…èƒ½å‘è¡¨æ–‡ç« çš„è®¨è®ºåŒºåŠŸèƒ½ï¼Œå‘è¡¨æ–‡ç« åŠŸèƒ½ä»‹é¢éœ€è¦èƒ½è¾“å…¥æ–‡å­—ã€æ’å…¥å¤šå¼ å›¾ç‰‡ã€æ”¯æ´æ–‡ç»•å›¾ç©¿æ’ï¼



#### åŠŸèƒ½éœ€æ±‚ï¼š



- èƒ½è¾“å…¥å¤šè¡Œæ–‡å­—


- èƒ½åœ¨è¡Œä¸­ç©¿æ’å›¾ç‰‡


- èƒ½ä¸Šä¼ å¤šå¼ å›¾ç‰‡


- èƒ½éšæ„ç§»é™¤æ’å…¥çš„å›¾ç‰‡


- å›¾ç‰‡ä¸Šä¼ æ•ˆæœ/å¤±è´¥å¤„ç†


- èƒ½å°†è¾“å…¥å†…å®¹è½¬è¯‘æˆå¯ä¼ é€’æ–‡æœ¬ EX: BBCODE



#### å…ˆä¸Šä¸ªæˆå“æ•ˆæœå›¾ï¼š



![[ç»“å©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}](/assets/e37d66ea1146/1*Sh0XaryqYnqVGV0wJ_dDHA.gif)



[ç»“å©šå§APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E4%B8%8D%E6%89%BE%E6%9C%80%E8%B2%B4-%E5%8F%AA%E6%89%BE%E6%9C%80%E5%B0%8D/id1356057329?ls=1&mt=8){:target="_blank"}



### å¼€å§‹ï¼š



#### ç¬¬ä¸€ç« 



ä»€ä¹ˆï¼Ÿä½ è¯´ç¬¬ä¸€ç« ï¼Ÿä¸å°±ç”¨UITextViewå°±èƒ½åšåˆ°ç¼–è¾‘å™¨åŠŸèƒ½ï¼Œå“ªæ¥è¿˜éœ€è¦åˆ†åˆ°ã€Œç« èŠ‚ã€ï¼›æ˜¯çš„ï¼Œæˆ‘ä¸€å¼€å§‹çš„ååº”ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç›´åˆ°æˆ‘å¼€å§‹åšæ‰å‘ç°äº‹æƒ…æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå…¶ä¸­è‹¦æ¼äº†æˆ‘ä¸¤ä¸ªæ˜ŸæœŸã€ç¿»ç‰‡å›½å†…å¤–å„ç§èµ„æ–™æœ€åæ‰æ‰¾åˆ°è§£æ³•ï¼Œå®ä½œçš„å¿ƒè·¯å†ç¨‹å°±è®©æˆ‘å¨“å¨“é“æ¥â€¦.



å¦‚æœæƒ³ç›´æ¥çŸ¥é“æœ€ç»ˆè§£æ³•ï¼Œè¯·ç›´æ¥è·³åˆ°æœ€åä¸€ç« (å¾€ä¸‹æ»šæ»šæ»šæ»šæ»š)ï¼



#### ä¸€å¼€å§‹



æ–‡å­—ç¼–è¾‘å™¨ç†æ‰€å½“ç„¶æ˜¯ä½¿ç”¨UITextViewå…ƒä»¶ï¼Œçœ‹äº†ä¸€ä¸‹æ–‡ä»¶UITextView attributedText è‡ªå¸¦ NSTextAttachmentç‰©ä»¶ å¯ä»¥é™„åŠ å›¾ç‰‡å®åšå‡ºæ–‡ç»•å›¾æ•ˆæœï¼Œç¨‹å¼ç ä¹Ÿå¾ˆç®€å•ï¼š



```swift
let imageAttachment = NSTextAttachment()
imageAttachment.image = UIImage(named: "example")
self.contentTextView.attributedText = NSAttributedString(attachment: imageAttachment)
```



å½“åˆå¤©çœŸçš„æˆ‘è¿˜å¾ˆå¼€å¿ƒæƒ³è¯´è›®ç®€å•çš„å•Šã€å¥½æ–¹ä¾¿ï¼›é—®é¢˜ç°åœ¨æ‰æ­£è¦å¼€å§‹ï¼š



- å›¾ç‰‡è¦èƒ½æ˜¯ä»æœ¬åœ°é€‰æ‹©&ä¸Šä¼ ï¼šè¿™å¥½è§£å†³ï¼Œå›¾ç‰‡é€‰æ‹©å™¨æˆ‘ä½¿ç”¨ [TLPhotoPicker](https://github.com/tilltue/TLPhotoPicker){:target="_blank"} è¿™ä¸ªå¥—ä»¶(æ”¯æ´å¤šå›¾é€‰æ‹©/å®¢åˆ¶åŒ–è®¾å®š/åˆ‡æ¢ç›¸æœºæ‹ç…§/Live Photos)ï¼Œå…·ä½“ä½œæ³•å°±æ˜¯ TLPhotoPickeré€‰å®Œå›¾ç‰‡Callbackåå°†PHAssetè½¬æˆUIImageå¡è¿›å»imageAttachment.imageå¹¶é¢„å…ˆåœ¨èƒŒæ™¯ä¸Šä¼ å›¾ç‰‡è‡³Serverã€‚


- å›¾ç‰‡ä¸Šä¼ è¦æœ‰æ•ˆæœå¹¶èƒ½æ·»åŠ äº’åŠ¨æ“ä½œ(ç‚¹å‡»æŸ¥çœ‹åŸå›¾/ç‚¹å‡»Xèƒ½åˆ é™¤)ï¼šæ²¡åšå‡ºæ¥ï¼Œæ‰¾ä¸åˆ°NSTextAttachmentæœ‰ä»€ä¹ˆåŠæ³•èƒ½åšåˆ°è¿™é¡¹éœ€æ±‚ï¼Œä¸è¿‡è¿™åŠŸèƒ½æ²¡æœ‰è¿˜è¡Œåæ­£è¿˜æ˜¯èƒ½åˆ é™¤(åœ¨å›¾ç‰‡åæŒ‰é”®ç›˜ä¸Šçš„ã€ŒBackã€é”®èƒ½åˆ é™¤å›¾ç‰‡)ï¼Œæˆ‘ä»¬ç»§ç»­â€¦


- åŸå§‹å›¾æ¡£æ¡ˆè¿‡å¤§ï¼Œä¸Šä¼ æ…¢ã€æ’å…¥æ…¢ã€åƒæ•ˆèƒ½ï¼šæ’å…¥åŠä¸Šä¼ å‰å…ˆResizeè¿‡ï¼Œç”¨ [Kingfisher](https://github.com/onevcat/Kingfisher){:target="_blank"} çš„resizeTo


- å›¾ç‰‡æ’å…¥åœ¨æ¸¸æ ‡åœç•™çš„ä½ç½®ï¼šè¿™é‡Œå°±è¦å°†åŸæœ¬çš„Codeæ”¹æˆå¦‚ä¸‹



```swift
let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0)
let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText) //å–å¾—å½“å‰å†…å®¹
combination.insert(NSAttributedString(attachment: imageAttachment), at: range)
self.contentTextView.attributedText = combination //å›å†™å›å»
```



- å›¾ç‰‡ä¸Šä¼ å¤±è´¥å¤„ç†ï¼šè¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œæˆ‘å®é™…å¦å¤–å†™äº†ä¸€ä¸ªClass æ‰©å……åŸå§‹çš„ NSTextAttachment ç›®çš„å°±æ˜¯è¦å¤šå¡ä¸ªå±æ€§å­˜è¯†åˆ«ç”¨çš„å€¼



```swift
class UploadImageNSTextAttachment:NSTextAttachment {
   var uuid:String?
}
```



ä¸Šä¼ å›¾ç‰‡æ—¶æ”¹æˆï¼š



```swift
let id = UUID().uuidString
let attachment = UploadImageNSTextAttachment()
attachment.uuid = id
```



æœ‰åŠæ³•è¾¨è¯†NSTextAttachmentçš„å¯¹åº”ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½é’ˆå¯¹ä¸Šä¼ å¤±è´¥çš„å›¾ç‰‡ï¼Œå»attributedTextdé‡ŒåšNSTextAttachmentæœç´¢ï¼Œæ‰¾åˆ°ä»–å¹¶å–ä»£æˆé”™è¯¯æç¤ºå›¾æˆ–ç›´æ¥ç§»é™¤



```swift
if let content = self.contentTextView.attributedText {
    content.enumerateAttributes(in: NSMakeRange(0, content.length),  options: NSAttributedString.EnumerationOptions(rawValue: 0)) { (object, range, stop) in
        if object.keys.contains(NSAttributedStringKey.attachment) {
            if let attachment = object[NSAttributedStringKey.attachment] as? UploadImageNSTextAttachment,attachment.uuid == "ç›®æ ‡ID" {
                attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30)
                attachment.image =  UIImage(named: "IconError")
                let combination = NSMutableAttributedString(attributedString: content)
                combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment))
                //å¦‚è¦ç›´æ¥ç§»é™¤å¯ç”¨deleteCharacters(in: range)
                self.contentTextView.attributedText = combination
            }
        }
    }
}
```



å…‹æœä¸Šè¿°é—®é¢˜åï¼Œç¨‹å¼ç å¤§çº¦ä¼šé•¿æˆè¿™æ ·ï¼š



```swift
class UploadImageNSTextAttachment:NSTextAttachment {
    var uuid:String?
}
func dismissPhotoPicker(withTLPHAssets: [TLPHAsset]) {
    //TLPhotoPicker å›¾ç‰‡é€‰æ‹©å™¨çš„Callback
    
    let range = self.contentTextView.selectedRange.location ?? NSRange(location: 0, length: 0)
    //å–å¾—æ¸¸æ ‡åœç•™ä½ç½®ï¼Œæ— åˆ™ä»å¤´
    
    guard withTLPHAssets.count > 0 else {
        return
    }
    
    DispatchQueue.global().async { in
        //åœ¨èƒŒæ™¯å¤„ç†
        let orderWithTLPHAssets = withTLPHAssets.sorted(by: { $0.selectedOrder > $1.selectedOrder })
        orderWithTLPHAssets.forEach { (obj) in
            if var image = obj.fullResolutionImage {
                
                let id = UUID().uuidString
                
                var maxWidth:CGFloat = 1500
                var size = image.size
                if size.width > maxWidth {
                    size.width = maxWidth
                    size.height = (maxWidth/image.size.width) * size.height
                }
                image = image.resizeTo(scaledToSize: size)
                //ç¼©å›¾
                
                let attachment = UploadImageNSTextAttachment()
                attachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height)
                attachment.uuid = id
                
                DispatchQueue.main.async {
                    //åˆ‡å›ä¸»æ‰§è¡Œç»ªæ›´æ–°UIæ’å…¥å›¾ç‰‡
                    let combination = NSMutableAttributedString(attributedString: self.contentTextView.attributedText)
                    attachments.forEach({ (attachment) in
                        combination.insert(NSAttributedString(string: "\n"), at: range)
                        combination.insert(NSAttributedString(attachment: attachment), at: range)
                        combination.insert(NSAttributedString(string: "\n"), at: range)
                    })
                    self.contentTextView.attributedText = combination
                    
                }
                
                //ä¸Šä¼ å›¾ç‰‡è‡³Server
                //Alamofire post or....
                //POST image
                //if failed {
                    if let content = self.contentTextView.attributedText {
                        content.enumerateAttributes(in: NSMakeRange(0, content.length),  options: NSAttributedString.EnumerationOptions(rawValue: 0)) { (object, range, stop) in
                            
                            if object.keys.contains(NSAttributedStringKey.attachment) {
                                if let attachment = object[NSAttributedStringKey.attachment] as? UploadImageNSTextAttachment,attachment.uuid == obj.key {
                                    
                                    //REPLACE:
                                    attachment.bounds = CGRect(x: 0, y: 0, width: 30, height: 30)
                                    attachment.image = //ERROR Image
                                    let combination = NSMutableAttributedString(attributedString: content)
                                    combination.replaceCharacters(in: range, with: NSAttributedString(attachment: attachment))
                                    //OR DELETE:
                                    //combination.deleteCharacters(in: range)
                                    
                                    self.contentTextView.attributedText = combination
                                }
                            }
                        }
                    }
                //}
                //
                
            }
        }
    }
}
```



åˆ°æ­¤å·®ä¸å¤šé—®é¢˜éƒ½è§£å†³äº†ï¼Œé‚£æ˜¯ä»€ä¹ˆè‹¦æ¼äº†æˆ‘ä¸¤å‘¨å‘¢ï¼Ÿ



ç­”ï¼šã€Œè®°å¿†ä½“ã€é—®é¢˜



![iPhone 6é¡¶ä¸ä½å•Š!](/assets/e37d66ea1146/1*IcnoXq6e6OUnU_mg83XDxg.gif)



iPhone 6é¡¶ä¸ä½å•Š!



ä»¥ä¸Šåšæ³•æ’å…¥è¶…è¿‡5å¼ å›¾ç‰‡ï¼ŒUITextViewå°±ä¼šå¼€å§‹å¡é¡¿ï¼›åˆ°ä¸€ä¸ªç¨‹åº¦å°±ä¼šå› ä¸ºè®°å¿†ä½“è´Ÿè·ä¸äº†APPç›´æ¥é—ªé€€



p.s è¯•è¿‡å„ç§å‹ç¼©/å…¶ä»–å‚¨å­˜æ–¹å¼ï¼Œç»“æœä¾ç„¶



æ¨æµ‹åŸå› æ˜¯ï¼ŒUITextViewæ²¡æœ‰é’ˆå¯¹å›¾ç‰‡çš„NSTextAttachmentåšReuseï¼Œä½ æ‰€æ’å…¥çš„æ‰€æœ‰å›¾ç‰‡éƒ½Loadåœ¨è®°å¿†ä½“ä¹‹ä¸­ä¸ä¼šé‡Šæ”¾ï¼›æ‰€ä»¥é™¤éæ˜¯æ‹¿æ¥ç©¿æ’è¡¨æƒ…ç¬¦å·é‚£ç§å°å›¾ğŸ˜…ï¼Œä¸ç„¶æ ¹æœ¬ä¸èƒ½æ‹¿æ¥åšæ–‡ç»•å›¾



#### ç¬¬äºŒç« 



å‘ç°è®°å¿†ä½“è¿™ä¸ªã€Œç¡¬ä¼¤ã€åï¼Œç»§ç»­åœ¨ç½‘è·¯ä¸Šæœç´¢è§£å†³æ–¹æ¡ˆï¼Œå¾—åˆ°ä»¥ä¸‹å…¶ä»–åšæ³•ï¼š



- ç”¨WebViewåµŒå¥—HTMLæ¡£æ¡ˆ( &lt;div contentEditable=â€trueâ€&gt;&lt;/div&gt;)å¹¶ç”¨JSè·ŸWebViewåšäº¤äº’å¤„ç†


- ç”¨UITableViewç»“åˆUITextViewï¼Œèƒ½Reuse


- åŸºäºTextKitè‡ªè¡Œæ‰©å……UITextViewğŸ†



ç¬¬ä¸€é¡¹ç”¨WebViewåµŒå¥—HTMLæ¡£æ¡ˆçš„åšæ³•ï¼›è€ƒé‡åˆ°æ•ˆèƒ½è·Ÿä½¿ç”¨è€…ä½“éªŒï¼Œæ‰€ä»¥ä¸è€ƒè™‘ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨Githubæœå¯»ç›¸å…³çš„è§£å†³æ–¹æ¡ˆ(EX: [RichTextDemo](https://github.com/xiaosheng0601/RichTextDemo){:target="_blank"} )



ç¬¬äºŒé¡¹ç”¨UITableViewç»“åˆUITextView



æˆ‘å®ä½œäº†å¤§çº¦7æˆå‡ºæ¥ï¼Œå…·ä½“å¤§çº¦æ˜¯æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªCellï¼ŒCellæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯UITextViewå¦ä¸€ç§æ˜¯UIImageViewï¼Œå›¾ç‰‡ä¸€è¡Œæ–‡å­—ä¸€è¡Œï¼›å†…å®¹å¿…é¡»ç”¨é˜µåˆ—å»å‚¨å­˜ï¼Œé¿å…Reuseè¿‡ç¨‹æ¶ˆå¤±



èƒ½ä¼˜ç§€çš„Reuseè§£å†³è®°å¿†ä½“é—®é¢˜ï¼Œä½†åšåˆ°åé¢è¿˜æ˜¯æ”¾å¼ƒäº†ï¼Œåœ¨ **æ§åˆ¶è¡Œå°¾æŒ‰Returnè¦èƒ½æ–°å»ºä¸€è¡Œå¹¶è·³åˆ°è¯¥è¡Œ** å’Œ **æ§åˆ¶è¡Œå¤´æŒ‰Backé”®è¦èƒ½è·³åˆ°ä¸Šä¸€è¡Œ(è‹¥å½“å‰ä¸ºç©ºè¡Œè¦èƒ½åˆ é™¤è¯¥è¡Œ)** è¿™ä¸¤ä¸ªéƒ¨åˆ†ä¸Šåƒè¶³è‹¦å¤´ï¼Œéå¸¸éš¾æ§åˆ¶



æœ‰å…´è¶£çš„æœ‹å‹å¯å‚è€ƒï¼š [MMRichTextEdit](https://gitee.com/dhar/MMRichTextEdit){:target="_blank"} ã€



#### æœ€ç»ˆç« 



èµ°åˆ°è¿™é‡Œå·²ç»è€—è´¹äº†è®¸å¤šæ—¶é—´ï¼Œå¼€å‘æ—¶ç¨‹ä¸¥é‡æ‹–å»¶ï¼›ç›®å‰æœ€ç»ˆè§£æ³•å°±æ˜¯ç”¨TextKit



è¿™é‡Œé™„ä¸Šä¸¤ç¯‡æ‰¾åˆ°çš„æ–‡ç« ç»™æœ‰å…´è¶£ç ”ç©¶çš„æœ‹å‹ï¼š



- [TextKit æ¢ç©¶](https://www.jianshu.com/p/3f445d7f44d6){:target="_blank"}


- [ä»UITextViewçœ‹æ–‡å­—ç»˜åˆ¶ä¼˜åŒ–](http://djs66256.github.io/2016/06/23/2016-06-23-cong-uitextviewkan-wen-zi-hui-zhi-you-hua/){:target="_blank"}



ä½†æœ‰ä¸€å®šçš„å­¦ä¹ é—¨æ§›ï¼Œå¯¹æˆ‘è¿™ä¸ªèœé¸Ÿæ¥è¯´å¤ªéš¾äº†ï¼Œå†è¯´æ—¶é—´ä¹Ÿå·²ä¸å¤Ÿï¼Œåªèƒ½æ¼«æ— ç›®çš„åœ¨Githubå¯»æ‰¾ä»–å±±ä¹‹çŸ³å€Ÿå€Ÿç”¨ç”¨



æœ€ç»ˆæ‰¾åˆ° [XLYTextKitExtension](https://github.com/kaizeiyimi/XLYTextKitExtension){:target="_blank"} è¿™ä¸ªé¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥å¼•å…¥Codeä½¿ç”¨



âœ” è®© NSTextAttachment æ”¯æ´è‡ªè®¢ä¹‰UIView è¦åŠ ä»€ä¹ˆäº¤äº’æ“ä½œéƒ½å¯ä»¥



âœ” NSTextAttachment å¯ä»¥Reuse ä¸ä¼šæ’‘çˆ†è®°å¿†ä½“



å…·ä½“å®ä½œæ–¹å¼è·Ÿ **ç¬¬ä¸€ç« ** å·®ä¸å¤šï¼Œå°±åªå·®åœ¨åŸæœ¬æ˜¯ç”¨NSTextAttachmentè€Œç°åœ¨æ”¹ç”¨XLYTextAttachment



é’ˆå¯¹è¦ä½¿ç”¨çš„UITextView:



```swift
contentTextView.setUseXLYLayoutManager()
```



Tip 1:æ’å…¥NSTextAttachmentçš„åœ°æ–¹æ”¹ä¸º



```swift
let combine = NSMutableAttributedString(attributedString: NSAttributedString(string: ""))
let imageView = UIView() // your custom view
let imageAttachment = XLYTextAttachment { () -> UIView in
    return imageView
}
imageAttachment.id = id
imageAttachment.bounds = CGRect(x: 0, y: 0, width: size.width, height: size.height)
combine.append(NSAttributedString(attachment: imageAttachment))
self.contentTextView.textStorage.insert(combine, at: range)
```



Tip 2:NSTextAttachmentæœç´¢æ”¹ä¸º



```php
self.contentTextView.textStorage.enumerateAttribute(NSAttributedStringKey.attachment, in: NSRange(location: 0, length: self.contentTextView.textStorage.length), options: []) { (value, range, stop) in
    if let attachment = value as? XLYTextAttachment {
        //attachment.id
    }
}
```



Tip 3:åˆ é™¤NSTextAttachmenté¡¹ç›®æ”¹ä¸º



```swift
self.contentTextView.textStorage.deleteCharacters(in: range)
```



Tip 4:å–å¾—å½“å‰å†…å®¹é•¿åº¦



```swift
self.contentTextView.textStorage.length
```



Tip 5:åˆ·æ–°Attachmentçš„Boundså¤§å°



ä¸»å› æ˜¯ä¸ºäº†ä½¿ç”¨è€…ä½“éªŒï¼›æ’å…¥å›¾ç‰‡æ—¶æˆ‘ä¼šå…ˆå¡ä¸€å¼ loadingå›¾ï¼Œæ’å…¥çš„å›¾ç‰‡åœ¨èƒŒæ™¯å‹ç¼©åæ‰ä¼šæ›¿æ¢ä¸Šå»ï¼Œè¦å»æ›´æ–°TextAttachmentçš„BoundsæˆResizeåå¤§å°



```swift
self.contentTextView.textStorage.addAttributes([:], range: range)
```



(æ–°å¢ç©ºå±æ€§ï¼Œè§¦å‘åˆ·æ–°)



Tip 6: å°†è¾“å…¥å†…å®¹è½¬è¯‘æˆå¯ä¼ é€’æ–‡æœ¬



è¿ç”¨Tip 2æœç´¢å…¨éƒ¨è¾“å…¥å†…å®¹å¹¶å°†æ‰¾åˆ°çš„Attachmentå–å‡ºIDç»„åˆæˆç±»ä¼¼[ [ID] ]æ ¼å¼ä¼ é€’



Tip 7: å†…å®¹å–ä»£



```swift
self.contentTextView.textStorage.replaceCharacters(in: range,with: NSAttributedString(attachment: newImageAttachment))
```



Tip 8: æ­£è§„è¡¨ç¤ºæ³•åŒ¹é…å†…å®¹æ‰€åœ¨Range



```swift
let pattern = "(\\[\\[image_id=){1}([0-9]+){1}(\\]\\]){1}"
let textStorage = self.contentTextView.textStorage

if let regex = try? NSRegularExpression(pattern: pattern, options: .caseInsensitive) {
    while true {
        let range = NSRange(location: 0, length: textStorage.length)
        if let match = regex.matches(in: textStorage.string, options: .withTransparentBounds, range: range).first {
            let matchString = textStorage.attributedSubstring(from: match.range)
            //FINDED!
        } else {
            break
        }
    }
}
```



æ³¨æ„ï¼šå¦‚æœä½ è¦æœå¯»ï¼†å–ä»£é¡¹ç›®ï¼Œéœ€è¦ä½¿ç”¨Whileå›åœˆï¼Œä¸ç„¶å½“æœ‰å¤šä¸ªæœå¯»ç»“æœæ—¶ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¹¶å–ä»£åï¼Œåé¢çš„æœå¯»ç»“æœçš„Rangeå°±ä¼šé”™è¯¯å¯¼è‡´é—ªé€€ï¼



#### ç»“è¯­



ç›®å‰ä½¿ç”¨æ­¤æ–¹æ³•å®Œæˆæˆå“å¹¶ä¸Šçº¿äº†ï¼Œè¿˜æ²¡é‡åˆ°æœ‰ä»€ä¹ˆé—®é¢˜ï¼›æœ‰æ—¶é—´æˆ‘å†æ¥å¥½å¥½æ¢ç©¶ä¸€ä¸‹å…¶ä¸­çš„åŸç†å§ï¼



è¿™ç¯‡æ¯”è¾ƒä¸æ˜¯æ•™å­¦æ–‡ç« ï¼Œè€Œæ˜¯ä¸ªäººè§£é¢˜å¿ƒå¾—åˆ†äº«ï¼›å¦‚æœæ‚¨ä¹Ÿåœ¨å®ä½œç±»ä¼¼åŠŸèƒ½ï¼Œå¸Œæœ›æœ‰å¸®åŠ©åˆ°ä½ ï¼Œæœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ä¸æˆ‘è”ç»œï¼



> Mediumçš„æ­£å¼ç¬¬ä¸€ç¯‡



### å»¶ä¼¸é˜…è¯»



- [ZMarkupParser HTML String è½¬æ¢ NSAttributedString å·¥å…·](../a5643de271e4/)


- [æ‰‹å·¥æ‰“é€  HTML è§£æå™¨çš„é‚£äº›äº‹](../2724f02f6e7/)



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/ios-uitextview-%E6%96%87%E7%B9%9E%E5%9C%96%E7%B7%A8%E8%BC%AF%E5%99%A8-swift-e37d66ea1146){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*