---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2026-01-03T17:03:46.382+0000
description: ä»‹ç» Certificates, Identifiers & Profiles ä¹‹é—´çš„å…³ç³»ä¸ä½¿ç”¨ Fastlane Match ç»Ÿä¸€ç®¡ç†ç­¾å‘å‡­è¯å¹¶æ•´åˆè¿›
  CI/CD å·¥ä½œæµç¨‹çš„çºªå½•ã€‚
image:
  path: /assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg
last_modified_at: 2026-01-04T02:51:43.896+0000
render_with_liquid: false
tags:
- ios-app-development
- fastlane
- keychain
- github-actions
- macos
- simplified-chinese
title: iOS Certificates, Identifiers & Profiles æ˜¯ä»€ä¹ˆåŠ Fastlane Match ç»Ÿä¸€ç®¡ç†å‡­è¯ä¸ CI/CD
  çš„ä¸€äº›ç¬”è®°
---

### iOS Certificates, Identifiers & Profiles æ˜¯ä»€ä¹ˆåŠ **Fastlane Match ç»Ÿä¸€** ç®¡ç† **å‡­è¯ä¸ CI/CD çš„ä¸€äº›ç¬”è®°**



ä»‹ç» Certificates, Identifiers & Profiles ä¹‹é—´çš„å…³ç³»ä¸ä½¿ç”¨ Fastlane Match ç»Ÿä¸€ç®¡ç†ç­¾å‘å‡­è¯å¹¶æ•´åˆè¿› CI/CD å·¥ä½œæµç¨‹çš„çºªå½•ã€‚



![Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg)



Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}



#### å‰è¨€



2025 å¹´ä¸­æ—¶å†™è¿‡ä¸€ç³»åˆ—ä» 0 åˆ° 1 ä½¿ç”¨ GitHub Actions å»ºç½® App CI/CD å®Œæ•´æµç¨‹çš„æ–‡ç« ï¼š



- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€è¿‡ CI/CD æ‰“é€ ç¨³å®šé«˜æ•ˆçš„å¼€å‘å›¢é˜Ÿï¼Ÿå·¥å…·é€‰æ‹©ï¼Ÿ](../c008a9e8ceca/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆäºŒï¼‰ï¼šGitHub Actions ä¸ self-hosted Runner ä½¿ç”¨ä¸å»ºç½®å¤§å…¨](../404bd5c70040/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šä½¿ç”¨ GitHub Actions å®ä½œ App ä¸“æ¡ˆçš„ CI ä¸ CD å·¥ä½œæµç¨‹](../4b001d2e8440/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆå››ï¼‰ï¼šä½¿ç”¨ Google Apps Script Web App ä¸²æ¥ GitHub Actions å»ºç½®å…è´¹æ˜“ç”¨çš„æ‰“åŒ…å·¥å…·å¹³å°](../4273e57e7148/)



æœ€è¿‘åˆ°æ–°ç¯å¢ƒåˆé‡æ–°è·‘äº†ä¸€æ¬¡ï¼Œæ¯æ¬¡éƒ½æœ‰å­¦ä¹ åˆ°æ–°çš„ä¸œè¥¿ï¼Œè¿™æ¬¡èšç„¦åœ¨ iOS Codesigningï¼šCertificates / Profiles / Devices çš„å…³ç³»ï¼Œä¸æˆ‘å¦‚ä½•ç”¨ Fastlane Match æŠŠå‡­è¯ç®¡ç†ä¸ CI/CD ä¸²èµ·æ¥ã€‚



### [Certificates, Identifiers & Profiles, Devices æ˜¯ä»€ä¹ˆï¼Ÿ](https://developer.apple.com/account/resources/certificates/list){:target="_blank"}



åœ¨ Apple ç”Ÿæ€ç³»ä¸­ï¼ŒApp å¼€å‘æ˜¯åŸºäºå‡­è¯ä¸æè¿°æ¡£æ§ç®¡çš„ï¼Œè·Ÿ Android åªè¦æœ‰ .apk å°±èƒ½å®‰è£…ä½¿ç”¨ä¸åŒï¼›Apple æœ‰ä¸¥æ ¼çš„å‡­è¯å¯¹åº”ç®¡åˆ¶ï¼Œä¸ç¬¦åˆè§„åˆ™å°±ä¸èƒ½å®‰è£…ã€ä½¿ç”¨ã€‚



#### **ä¸»è¦é¡¹ç›®ç»„æˆåŠåŠŸèƒ½ï¼š**



![](/assets/823ac523ccc8/1*PyM0l-jXXcVBKubOwCiTsw.png)



#### **Certificates:** ç­¾ç½² App çš„èº«åˆ† (Signing Identity)



- **Development** â€” å¼€å‘é˜¶æ®µè·‘åœ¨å®ä½“æœºä¸Šä½¿ç”¨(åªè·‘æ¨¡æ‹Ÿå™¨ä¸ç”¨å‡­è¯)ï¼Œæ‰€å±æ˜¯äººæˆ– API Key (æœ‰æ•°é‡é™åˆ¶)ã€‚


- **Distribution** â€” æ‰“åŒ…ä¸Š AppStore, TestFlight æˆ–æ˜¯ Ad Hoc å†…æµ‹(é™å®šå·²æ³¨å†Œè£…ç½®)ä½¿ç”¨ï¼Œæœ‰æ•°é‡é™åˆ¶ï¼Œæ‰€å±æ˜¯ Teamã€‚


- **Enterprise** â€” ä¼ä¸šå†…éƒ¨ App ä½¿ç”¨ã€‚



> ***æ ¼å¼*** *ï¼šéœ€è¦æœ‰ `Private Key (ç§é’¥)` åŠ  `Certificate .cer (å…¬é’¥å‡­è¯)` æ‰èƒ½ä½¿ç”¨ï¼Œæˆ–æ˜¯åœ¨åŸåˆ›å»ºç”µè„‘ä¸Šçš„ Keychain æ±‡å‡ºæˆ `.p12` æ¡£æ¡ˆå°±ä¼šåŒæ—¶åŒ…å«ã€‚*



![](/assets/823ac523ccc8/1*oP_p2kJ1Prqku4D8LIZ7yg.png)



#### **Identifiers: å“ªä¸€ä¸ª App/Extension (Bundle ID)**



App çš„ Bundle ID æ³¨å†Œè·Ÿéœ€è¦å¯ç”¨çš„ Capabilities(ä¾‹å¦‚å¯ç”¨ Push Notifications, App Groupsâ€¦)ã€App Servicesã€‚



Extension ä¹Ÿä¼šæœ‰è‡ªå·±çš„ Identifierã€‚



#### **Devices: å·²æ³¨å†Œè£…ç½® (iPhone/iPad. . )**



Development è·‘åœ¨å®ä½“æœºä¸Šè·Ÿ Distribution Ad Hoc å†…æµ‹åªæœ‰æ³¨å†Œçš„è£…ç½®æ‰èƒ½ä½¿ç”¨ã€‚



> ***ä¸Šé™ï¼š100 ä¸ªï¼›åŒ…å«å–æ¶ˆï¼Œè¦ç­‰åˆ°æ¯å¹´ä»˜è´¹å‘¨æœŸæ‰ä¼šé‡æ–°åˆ·æ–°é‡Šå‡ºé¢åº¦ã€‚***



#### **Provisioning Profile (ä»¥ä¸‹ç®€ç§° Profile): æè¿°æ¡£**



ç»„åˆ Certificates+Identifiers+Devices å…³ç³»ã€‚



- **Development** â€” å¼€å‘é˜¶æ®µä½¿ç”¨çš„æè¿°æ¡£ï¼Œå¦‚æœè¦è·‘å®ä½“æœºæµ‹è¯•å°±å¿…é¡»ä½¿ç”¨ï¼Œæè¿°æ¡£åŒ…å« Certificates+Identifiers+Devices ä¹‹é—´çš„å…³ç³»ã€‚


- **Ad Hoc** â€”æ‰“åŒ…ç»™å†…éƒ¨æµ‹è¯•ä½¿ç”¨(e.g. Deploy to Firebase App Distribution)çš„æè¿°æ¡£ï¼Œæè¿°æ¡£åŒ…å« Certificates+Identifiers+Devices ä¹‹é—´çš„å…³ç³»ã€‚


- **App Store** â€” æ‰“åŒ…ä¸Šä¼ åˆ° App Store / TestFlight ä½¿ç”¨çš„æè¿°æ¡£ï¼Œæè¿°æ¡£åŒ…å« Certificates+Identifiers ä¹‹é—´çš„å…³ç³»ã€‚



> *æ ¼å¼ï¼š `.mobileprovision`*



> ***è¦æ³¨æ„ï¼šProfile åªæ˜¯æè¿°æ¡£ï¼Œæè¿°å…³ç³»ï¼Œä¸ä¼šåŒ…å«å‡­è¯æœ¬ä½“ã€‚***



#### å°ç»“



ç»¼åˆä»¥ä¸Šï¼Œå¦‚æœè¦åœ¨ä¸€å°å¹²å‡€çš„æœºå™¨ã€ä¸ç™»å…¥ Xcode Apple Account çš„æƒ…å†µä¸‹è¦èƒ½ Build å®ä½“æœº (Development Certificate) æˆ–æ˜¯æ‰§è¡Œ Archive æ‰“åŒ… (Distribution Certificate)ï¼Œ **å¿…é¡»è¦æœ‰ä¸¤ä¸ªæ¡£æ¡ˆ** ï¼š



- `.mobileprovision` Provisioning Profile æè¿°æ¡£: æè¿°Certificates+Identifiers+Devices å…³ç³»ã€‚


- `.p12` Certificate: å‡­è¯çš„å®ä½“ (ä»åŸåˆ›å»º Certificate çš„ç”µè„‘æ±‡å‡º)ã€‚



**å¦å¤– macOS â‰¥ 15 åçš„ Keychain ç§»åŠ¨åˆ°ï¼š**



```bash
open /System/Library/CoreServices/Applications/Keychain\ Access.app
```



*æ‰¾äº†è¶…ä¹…. .*



#### å¸¸è§é”™è¯¯



**âš ï¸âš ï¸âš ï¸ ç¡®å®šå‡­è¯ã€Profile éƒ½æ­£ç¡®ä½†æ€ä¹ˆæ ·éƒ½æŠ¥é”™:**



> *å¤šåŠæ˜¯ä½ è¿˜æ®‹å­˜æœ‰ä¹‹å‰çš„å‡­è¯ã€å¤šå¼ å‡­è¯ï¼ŒXcode ä¼šé”™ä¹±ã€‚*



> ***è¿™é—®é¢˜å¾ˆå¸¸ä¼šé‡åˆ°ï¼***



1. å…³é—­ Xcode


2. æ‰“å¼€ macOS keychain: `open /System/Library/CoreServices/Applications/Keychain\ Access.app`


3. login keychain -&gt; All items -&gt; æœå¯» `apple development` -&gt; åˆ é™¤æ‰€æœ‰ Certificates å‡­è¯


4. Finder -&gt; Go -&gt; Go to -&gt; `~/Library/MobileDevice/Provisioning\ Profiles` -&gt; åˆ é™¤æ‰€æœ‰ Profiles æè¿°æ¡£


5. é‡æ–°æ‹‰å–å‡­è¯


6. é‡å¼€ Xcode åº”è¯¥å°±æ­£å¸¸äº†



**No signing certificate â€œiOS Distributionâ€ found / No signing certificate â€œiOS Developmentâ€ found.:**



```vbnet
No "iOS Distribution" signing certificate matching team ID "" with a private key was found.
No "iOS Development" signing certificate matching team ID "" with a private key was found.
```



**åŸå› :**



- ç¼ºå°‘ iOS Distribution/iOS Development Certificate å‡­è¯


- æœ‰ iOS Distribution/iOS Development Certificate å‡­è¯ **ä½†æ˜¯ æ²¡æœ‰å¯¹åº”çš„ Private Key ç§é’¥**



**è§£å†³åŠæ³•:**



- åˆ é™¤ Keychain é‡Œçš„æ‰€æœ‰æ—§ Certificates å‡­è¯ã€Profiles æè¿°æ¡£


- åœ¨å½“åˆåˆ›å»º Certificate çš„ç”µè„‘ Keychain ä¸Šæ‰¾åˆ°è¯¥å‡­è¯ï¼Œæ±‡å‡ºæˆ `.p12` æ ¼å¼ï¼Œåœ¨æœ‰é—®é¢˜ç”µè„‘ä¸Šå®‰è£…ã€‚


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Revoke æ—§çš„ Certificateï¼Œé‡æ–°äº§ç”Ÿ
  (æ”¾å¿ƒï¼Œä¸å½±å“çº¿ä¸Šç‰ˆ Appï¼›åªå½±å“å¼€å‘ä¸æ‰“åŒ…é˜¶æ®µ)



**Provisioning profile â€œâ€ doesnâ€™t include signing certificate â€œApple Development: XXXâ€. / Provisioning profile â€œâ€ doesnâ€™t include signing certificate â€œApple Distribution: XXXâ€.:**



**åŸå› :**



- ç›®å‰é€‰æ‹©çš„ Provisioning profile æè¿°æ¡£è·Ÿå½“å‰çš„ Certificate æ²¡æœ‰å¯¹åº”å…³ç³»



**è§£å†³åŠæ³•:**



- åˆ é™¤ Keychain é‡Œçš„æ‰€æœ‰æ—§ Certificates å‡­è¯ã€Profiles æè¿°æ¡£


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ç¡®è®¤æè¿°æ¡£æœ‰å‹¾é€‰å¯¹åº”å‡­è¯æˆ–é‡äº§ Profile ä½¿ç”¨



**No profile for team â€˜â€™ matching â€˜â€™ found: Xcode couldnâ€™t find any provisioning profiles matching â€˜â€™.:**



**åŸå› :**



- æ‰¾ä¸åˆ°æŒ‡å®šçš„ Provisioning profile æè¿°æ¡£



**è§£å†³åŠæ³•:**



- åˆ é™¤ Keychain é‡Œçš„æ‰€æœ‰æ—§ Certificates å‡­è¯ã€Profiles æè¿°æ¡£


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ä¸‹è½½å¯¹åº”çš„ Profile ä½¿ç”¨



**Provisioning profile â€œâ€ has app ID â€œâ€, which does not match the bundle ID â€œâ€. / Provisioning profile doesnâ€™t match the bundle identifier:**



**åŸå› :**



- Provisioning profile ä¸åŒ…å«ç›®å‰çš„ Bundle Identifier



**è§£å†³åŠæ³•:**



- åˆ é™¤ Keychain é‡Œçš„æ‰€æœ‰æ—§ Certificates å‡­è¯ã€Profiles æè¿°æ¡£


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Identifiers ç¡®è®¤ Bundle Identifier å·²æ³¨å†Œ


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ä¸‹è½½å¯¹åº”çš„ Profile ä½¿ç”¨



**Provisioning profile â€œâ€ doesnâ€™t include the currently selected device â€œâ€ (identifier ) .:**



**åŸå› :**



- Provisioning profile ä¸åŒ…å«é€‰æ‹©çš„å®ä½“æœº Device Identifier



**è§£å†³åŠæ³•:**



- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Devices ç¡®è®¤å®ä½“æœºçš„ Identifier å·²æ³¨å†Œ


- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles å¯¹åº”çš„ Profile è¯¥ å®ä½“æœº æœ‰å‹¾é€‰å¯ç”¨ã€‚


- é‡æ–°ä¸‹è½½ Profile ä½¿ç”¨



**Could not create another Development/Distribution certificate, reached the maximum number of available Development/Distribution certificates. :**



**åŸå› :**



ä»£è¡¨å»ºç«‹çš„ Development/Distribution Certificate å·²è¾¾ä¸Šé™æ•°é‡ã€‚



**è§£å†³åŠæ³•:**



- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} åˆ é™¤ä¸ä½¿ç”¨çš„å‡­è¯ã€‚



**Xcode å‡­è¯æ­£ç¡®ä¸”å¯ä»¥æ­£å¸¸æ‰“åŒ…ä½†æ˜¯ç”¨ CLI (Fastlane) æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ä¼šå‡ºç°ç­¾åé”™è¯¯:**



**åŸå› :**



è¿™è¾¹è¿˜æœ‰è¸©åˆ°å¦ä¸€ä¸ªé›·ï¼Œå°±æ˜¯æˆ‘æ‰‹è´±æŠŠä¸“æ¡ˆæ”¾åœ¨ iCloud åŒæ­¥ç›®å½•ä¸‹ï¼Œä¸çŸ¥é“ä¸ºä½•Fastlane ä¼šä¸€ç›´å‡ºç°å‡­è¯é—®é¢˜ (ç–‘ä¼¼ keychain å­˜å–æœ‰é—®é¢˜)ã€‚



**è§£å†³åŠæ³•:**



ç§»å‡º iCloud åŒæ­¥ç›®å½•å³å¯ã€‚



### æ—¥å¸¸ä½¿ç”¨çš„é—®é¢˜åœºæ™¯



#### Development Certificate



![](/assets/823ac523ccc8/1*W8bgbVPEBOQZyHBEKZHmAw.png)



- åœ¨å¯¼å…¥ Match ç»Ÿä¸€ç®¡ç†å‡­è¯ä¹‹å‰ï¼Œæ¯ä½å¼€å‘è€…éƒ½ä¼šå»ºç«‹è‡ªå·±çš„ `Development Certificate` å’Œ `Development Profile` ï¼›å‡è®¾ç»„ç»‡å†…æœ‰ 1,000+ ä½å¼€å‘è€…ï¼Œåœ¨ [Certificates, Identifiers & Profiles, Devices](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} åå°ä¼šéå¸¸çš„æ··ä¹±å¯æ€•ã€‚


- å¦‚æœæœ‰å¤–åŒ…å›¢é˜Ÿï¼Œåªè´Ÿè´£å¼€å‘å·¥ä½œï¼Œè¿˜æ˜¯éœ€è¦æŠŠä»–åŠ å…¥åˆ° Apple Developer Program åå°ï¼Œè®©ä»–äº§è‡ªå·±çš„å¼€å‘å‡­è¯è·Ÿ Profileã€‚



#### Distribution Certificate



![](/assets/823ac523ccc8/1*z00mYi900fkZV-EmHXMCeg.png)



- Distribution Certificate æ˜¯ by Team å»ºç«‹ï¼Œå› æ­¤æ¯ä¸ªå¼€å‘è€…è®¡åˆ’çš„ Team åªèƒ½å»ºç«‹æœ‰é™æ•°é‡çš„å‘è¡Œå‡­è¯ã€‚


- å¸¸è§åšæ³•æ˜¯ç”±ä¸€ä½å·¥ç¨‹å¸ˆå»ºç«‹äº§ç”Ÿ Distribution Certificate å†æ±‡å‡º .p12 æ¡£æ¡ˆç»™å…¶ä»–éœ€è¦ä¸Šæ¶çš„å¼€å‘è€…æˆ–æ˜¯æ”¾åˆ° CI/CD æœºå™¨ä¸Šä½¿ç”¨ã€‚


- å›¢é˜Ÿå¤§ã€App æ•°é‡å¤šæ—¶è¦å¯„æ¥å¯„å»çš„ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œä¸” **æ¯å¹´éƒ½è¦æ›´æ–°ä¸€æ¬¡**


- **æ‰“åŒ… Ad Hoc æ—¶ï¼Œå½“æœ‰æ–°è£…ç½®æ³¨å†Œï¼›æ‰€æœ‰äººã€CI/CD éƒ½éœ€è¦é‡æ–°ä¸‹è½½ Profile æ‰èƒ½è®©æ–°è£…ç½®ç”Ÿæ•ˆã€‚**



### [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"}



åŸºäºä»¥ä¸Šé—®é¢˜æˆ‘ä»¬å¸Œæœ›èƒ½æœ‰ä¸€ä¸ªå¹³å°å¸®æˆ‘ä»¬ä»£ä¸ºç®¡ç†æ‰€æœ‰è·Ÿå‡­è¯æœ‰å…³çš„äº‹ç‰©ï¼Œæ‰€æœ‰å¼€å‘è€…è·Ÿ CI/CD æœåŠ¡éƒ½æ˜¯ç»Ÿä¸€å¯¹è¿™ä¸ªå¹³å°æ‹‰å–ã€æ›´æ–°èµ„æ–™ï¼Œè¿™ä¸ªå¹³å°çš„å‚¨å­˜å¿…é¡»å®‰å…¨ï¼Œè¿™å°±æ˜¯ â€” [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"} ã€‚



> *Easily sync your certificates and profiles across your team*



> *A new approach to iOS and macOS code signing: Share one code signing identity across your development team to simplify your codesigning setup and prevent code signing issues.*



> *match is the implementation of the [codesigning.guide concept](https://codesigning.guide/){:target="_blank"} . match creates all required certificates & provisioning profiles and stores them in a separate git repository, Google Cloud, or Amazon S3. Every team member with access to the selected storage can use those credentials for code signing. match also automatically repairs broken and expired credentials. Itâ€™s the easiest way to share signing credentials across teams*



![](/assets/823ac523ccc8/1*UEL7Abx3PFrYbAc2yVlq8A.png)



**Fastlane Matchï¼š**



- è·Ÿ App Store Connect åšäº¤äº’ (é€è¿‡ App Store Connect API or Apple Developer Login Session)ï¼Œäº§ç”Ÿæˆ–æ˜¯æ›´æ–°å‡­è¯


- æŠŠå‡­è¯ç»“æœ ( `.mobileprovision` Profiles, `.p12` Certificate, `.cer` Certificate) ä¸‰ä¸ªæ¡£æ¡ˆåŠ å¯†ä¸Šä¼ åˆ° Git Repo (ä¹Ÿå¯ä»¥ç”¨å…¶ä»– Storage)
  `.cer` Certificate ä¹Ÿä¼šç‹¬ç«‹å­˜ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½çŸ¥é“å‡­è¯æ˜¯å¦æœ‰æ•ˆ


- å¦‚æœè¦ç»†åˆ†æƒé™å¯ä»¥åˆ†ä¸¤ä¸ª Reposï¼Œä¸€ä¸ªç®¡ç† Development å‡­è¯ã€ä¸€ä¸ªç®¡ç† Distribution å‡­è¯ã€‚



[**Folder structure:**](https://docs.fastlane.tools/actions/match/){:target="_blank"}



- The `certs` folder contains all certificates with their private keys


- The `profiles` folder contains all provisioning profiles



![<https://docs.fastlane.tools/actions/match/>{:target="_blank"}](/assets/823ac523ccc8/1*mStp0t3Ty3xGTKvbiBGtqw.png)



<https://docs.fastlane.tools/actions/match/>{:target="_blank"}



åŠ å¯†ç®—æ³•ï¼š [AES-256-GCM](https://github.com/fastlane/fastlane/blob/master/match/lib/match/encryption/encryption.rb){:target="_blank"}



**å¼€å‘è€…ã€CI/CD æœåŠ¡ï¼š**



- ç»Ÿä¸€ä½¿ç”¨ Fastlane match æŒ‡ä»¤æ“ä½œå‡­è¯ã€‚


- Fastlane Match ä¼šä¼˜å…ˆæ‹‰å› Git Repo çš„å‡­è¯æ¡£æ¡ˆã€è§£å¯†å›æ¥ä½¿ç”¨ï¼Œå¦‚æœå‘ç°è¿‡æœŸæˆ–æ˜¯æ— æ³•ä½¿ç”¨ï¼Œæœ‰æƒé™(Create/Write)çš„æƒ…å†µä¸‹ä¼šè‡ªåŠ¨é‡æ–°äº§ç”Ÿå¹¶ Push å›å» Repoï¼›è‹¥åªæœ‰ Read æƒé™åˆ™æŠ¥é”™ã€‚



**Create/Writeï¼š**



- åªæœ‰è´Ÿè´£ç®¡ç†å‡­è¯çš„äººå¯ä»¥äº§ç”Ÿ/æ›´æ–°ã€Push ä¸Šä¼ å‡­è¯



**Read:**



- å…¶ä»–å¼€å‘è€…ã€CI/CD æœåŠ¡éƒ½ **åªæœ‰è¯»å–** Pull å‡­è¯æƒé™


- CI/CD æœåŠ¡ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»»åŠ¡å‰æ‹‰å–æœ€æ–°å‡­è¯



### Fastlane Match è®¾å®šä¸ä½¿ç”¨



æˆ‘ä»¬ä»¥ Git Storage ä¸ºä¾‹ï¼Œæ‰€æœ‰å‡­è¯ã€‚



**1.å»ºç«‹ä¸€ä¸ªç©ºçš„å‚¨å­˜å‡­è¯çš„ Git Private Match Repo**
è™½ç„¶æ‰€æœ‰ Certificates, Profiles éƒ½ä¼šåŠ å¯†å‚¨å­˜ï¼Œä½†è¿˜æ˜¯è¦è®¾å®šå¥½è¯¥ Repo çš„å­˜å–æƒé™ã€‚



2.ç¡®è®¤æœ¬åœ°æœ‰è®¾å®šå¥½ Git SSH å­˜å–æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ `git clone git@github.com:xxx/certificates.git`



> *è¿™è¾¹å»ºè®® **ç»Ÿä¸€éƒ½ä½¿ç”¨ SSH Git Clone Repo** ï¼Œå› ä¸º CI/CD ä¹Ÿä¼šä½¿ç”¨ç›¸åŒçš„æ–¹å¼ã€‚*



> *å¦‚æœæ‰§è¡Œ fastlane match ä¸€ç›´å¡åœ¨ `If cloning the repo takes too long, you can use the `clone_branch_directly` option in match.` å¤šåŠå°±æ˜¯é‡åˆ° SSH æƒé™é—®é¢˜ã€‚*



3. åœ¨ä¸“æ¡ˆç›®å½•æ‰§è¡Œ `bundle exec fastlane match init` å®Œæˆè®¾å®š



```lua
[21:54:32]: fastlane match supports multiple storage modes, please select the one you want to use:
1. git
2. google_cloud
3. s3
4. gitlab_secure_files
# è¾“å…¥ 1 ç”¨ git
?   1

[22:04:40]: Please create a new, private git repository to store the certificates and profiles there
[22:04:40]: URL of the Git Repo: git@github.com:xxx/certificates.git
# è¾“å…¥ä½ å»ºç«‹çš„ Git Private Match Repo SSH URL

[22:04:47]: Successfully created './fastlane/Matchfile'. You can open the file using a code editor.
[22:04:47]: You can now run `fastlane match development`, `fastlane match adhoc`, `fastlane match enterprise` and `fastlane match appstore`
[22:04:47]: On the first run for each environment it will create the provisioning profiles and
[22:04:47]: certificates for you. From then on, it will automatically import the existing profiles.
[22:04:47]: For more information visit https://docs.fastlane.tools/actions/match/
```



4.å®Œæˆåä¼šäº§ç”Ÿä¸€ä¸ª **`fastlane/Matchfile` :**



```bash
# ä½ çš„ Git Private Match Repo SSH URL
git_url("git@github.com:xxxx/certificates.git")

storage_mode("git")

type("development") # The default type, can be: appstore, adhoc, enterprise or development

# app_identifier(["tools.fastlane.app", "tools.fastlane.app2"])
# username("user@fastlane.tools") # Your Apple Developer Portal username

# For all available options run `fastlane match --help`
# Remove the # in the beginning of the line to enable the other options

# The docs are available on https://docs.fastlane.tools/actions/match
```



**5. äº§ç”Ÿ [App Store Connect API .p8 Key](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"}** ï¼Œ **ç»Ÿä¸€ä½¿ç”¨ API Key äº§ç”Ÿå‡­è¯:**



![](/assets/823ac523ccc8/1*RFhS_XtZ3TfIJBAeoE-laA.png)



> *âš ï¸ï¸ï¸ï¸ [**App Store Connect API .p8 Key**](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"} **çš„æƒé™å¾ˆå¤§** ï¼Œé™¤äº†å¯ä»¥ç®¡ç†å‡­è¯ã€ä¹Ÿå¯ä»¥ç®¡ç† App çš„ä¸Šæ¶ã€é€å®¡ï¼Œè¿˜æœ‰åå°ä½¿ç”¨è€…è·Ÿè¯„è®ºã€è´¢åŠ¡æ•°æ®æŠ¥è¡¨ã€‚*



> *è¦ä¸è¦è¿›åˆ°å›¢é˜Ÿçš„ .git è®©å¤§å®¶éƒ½èƒ½å­˜å–ï¼Œå¯ä¾ç…§å›¢é˜Ÿæƒ…å¢ƒè‡ªè¡Œå†³å®šã€‚*



> ***æ¯”è¾ƒé«˜é£æ§çš„æ–¹å¼æ˜¯åªæœ‰è´Ÿè´£ç®¡ç†çš„äººè·ŸåŠ å¯†å‚¨å­˜åœ¨ CI/CD ä¸Šä½¿ç”¨(æ–‡åä¼šä»‹ç»)ã€‚***



> ***è¿™è¾¹ä¸ºäº† Demo æ–¹ä¾¿ç›´æ¥æ”¾è¿› fastlane ç›®å½•ä¸‹å­˜å–ã€‚***



> ***å¦å¤–æœ¬ç¯‡çš„ Fastlane Script ä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œä¸è€ƒè™‘é‡å¤ç¨‹å¼ç ä¸ç¨‹å¼ç»“æ„ã€‚***



#### å‡­è¯ç®¡ç†



```bash
platform :ios do
  lane :match_development do \\|options\\|
    # æ¢æˆä½ çš„ App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    type = options.fetch(:type, "development")
    isRead = options.fetch(:isRead, true)
    if isRead 
      readonly = true
      force = false
    else
      readonly = false
      force = true

      # éœ€è¦ App Store Connect API Key æ‰æœ‰æƒé™å» Apple åå°ç®¡ç†å‡­è¯
      # å‡è®¾ App Store Connect API .p8 Key åœ¨ ./fastlane/ ç›®å½•å†…
      app_store_connect_api_key(
        key_id: "XXXXXX",
        issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
        key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
      )
    end

    # æ‹‰å– app_identifier çš„ Development å‡­è¯
    match(
      type: type,
      app_identifier: app_identifier, 
      readonly: readonly, # èƒ½å¦ä»æœ‰éœ€è¦æ—¶ï¼Œæ›´æ–°ã€ä¸Šä¼  cert / profile
      force: force # è¦ä¸è¦æ— æ¡ä»¶é‡å»º provisioning profile
    )
  end
end
```



**å»ºç«‹ Development Certificate & Profile å¹¶ä¸Šä¼ åˆ° Match Repo:**



```
bundle exec fastlane match_development type:development isRead:false
```



- æ²¡æœ‰é”™è¯¯å°±ä»£è¡¨ Development Certificate & Profile äº§ç”Ÿã€å®‰è£…æˆåŠŸå¹¶åŒæ­¥ Push ä¸Šä¼ åˆ° Match Repo æˆåŠŸã€‚



**é¦–æ¬¡å»ºç«‹ä¼šéœ€è¦ä½ è®¾å®š `Passphrase` ï¼š**



```markdown
[23:29:12]: Enter the passphrase that should be used to encrypt/decrypt your certificates
[23:29:12]: This passphrase is specific per repository and will be stored in your local keychain
[23:29:12]: Make sure to remember the password, as you'll need it when you run match on a different machine
[23:29:12]: Passphrase for Match storage:
```



- è¿™ä¸ªå€¼å°±æ˜¯ç”¨æ¥åŠ å¯†ä½ çš„æ‰€æœ‰ Match Repo ä¸Šçš„æ¡£æ¡ˆçš„ä¼šéœ€è¦ç”¨åˆ°çš„å‚è€ƒ (passphrase + random salt)


- å»ºè®®äº§ç”Ÿä¸€ä¸ª [éšæœºå­—ä¸²](https://www.random.org/strings/?num=1&len=32&digits=on&upperalpha=on&loweralpha=on&unique=on&format=html&rnd=new){:target="_blank"} è®¾å®šå¹¶è®°å½•ä¸‹æ¥


- æ—¥åæ›´æ–°æˆ–æ˜¯å…¶ä»–äººæ‹‰å– Match Repo å‡­è¯éƒ½éœ€è¦è¾“å…¥è¿™ä¸ª å­—ä¸² è§£å¯†å›åŸå§‹æ¡£æ¡ˆã€‚



**å›¢é˜Ÿå…¶ä»–æˆå‘˜ç»Ÿä¸€ä» Match Repo Pull æ‹‰å– Development Certificate & Profile:**



```bash
bundle exec fastlane match_development type:development
```



**é¦–æ¬¡ä½¿ç”¨ä¼šè¯¢é—®ä½ çš„ç™»å…¥å¯†ç  (login keychain)ï¼Œå› ä¸ºè¦æŠŠå‡­è¯å®‰è£…åˆ° keychain ä¸­ï¼Œè¾“å…¥ä¸¤æ¬¡ç¡®è®¤å³å¯:**



```markdown
[16:52:59]: Installing certificate...
[16:53:00]: There are no local code signing identities found.
You can run security find-identity -v -p codesigning to get this output.
This Stack Overflow thread has more information: https://stackoverflow.com/q/35390072/774.
(Check in Keychain Access for an expired WWDR certificate: https://stackoverflow.com/a/35409835/774 has more info.)
[16:53:00]: Enter the password for /Users/zhgchgli/Library/Keychains/login.keychain-db
[16:53:00]: This passphrase will be stored in your local keychain with the name fastlane_keychain_login and used in future runs
[16:53:00]: This prompt can be avoided by specifying the 'keychain_password' option or 'MATCH_KEYCHAIN_PASSWORD' environment variable
[16:53:00]: Password for login keychain: ********
[16:53:24]: Type password for login keychain again: ********
```



**å¦‚æœ Match Development æ‹‰å®Œå‡­è¯ï¼Œä½† Xcode ä¸€ç›´æ˜¾ç¤ºæœ‰é”™è¯¯æˆ–æ— æ•ˆ:**



å¯å‚è€ƒå‰æ–‡æåˆ°çš„å¸¸è§é”™è¯¯ï¼Œå¤šåŠæ˜¯æœ‰æ—§çš„è„å‡­è¯ï¼Œæ¸…é™¤æ‰€æœ‰å‡­è¯å†é‡æ–°æ‹‰å–ï¼Œåº”è¯¥å°±å¯ä»¥äº†ã€‚



â€”



**å»ºç«‹ AdHoc Distribution Certificate & Profile å¹¶ä¸Šä¼ åˆ° Match Repo:**



```bash
bundle exec fastlane match_development type:adhoc isRead:false
```



**å»ºç«‹ AppStore Distribution Certificate & Profile å¹¶ä¸Šä¼ åˆ° Match Repo:**



```bash
bundle exec fastlane match_development type:appstore isRead:false
```



**CI/CD æœåŠ¡ç»Ÿä¸€ä» Match Repo Pull æ‹‰å– Distribution Certificate & Profile ( `isRead:true` )ï¼Œç„¶åå†æ‰§è¡Œæ‰“åŒ…å‘å¸ƒä»»åŠ¡ã€‚**



#### æ³¨å†Œæ–°è£…ç½®



```php
platform :ios do  
  desc "Register a new device and refresh profiles"
  lane :registerDevice do \\|options\\|
    # æ¢æˆä½ çš„ App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    # éœ€è¦ App Store Connect API Key æ‰æœ‰æƒé™å» Apple åå°ç®¡ç†å‡­è¯
    # å‡è®¾ App Store Connect API .p8 Key åœ¨ ./fastlane/ ç›®å½•å†…
    app_store_connect_api_key(
      key_id: "XXXXXX",
      issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
      key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
    )
    # Input: UDID and device name
    udid = options[:udid] \\|\\| UI.input("Enter device UDID:")
    device_name = options[:name] \\|\\| UI.input("Enter device name:")
    UI.message("ğŸ“± Registering device #{device_name} (#{udid})")
    register_device(
      name: device_name,
      udid: udid,
      platform: 'ios'
    )

    # æ›´æ–° app_identifier çš„ Development å‡­è¯
    match(
      type: "development",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šä¼  cert / profile
      force_for_new_devices: true # å¦‚æœä¸ºæ–°è£…ç½®åˆ™é‡å»º provisioning profile
    )

    # æ›´æ–° app_identifier çš„ AdHoc å‡­è¯
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šä¼  cert / profile
      force_for_new_devices: true # å¦‚æœä¸ºæ–°è£…ç½®åˆ™é‡å»º provisioning profile
    )
  end
end
```



æ³¨å†Œå®Œä¹‹åå…¶ä»–å¼€å‘è€…æˆ– CI/CD æœåŠ¡å†ä» Match Repo æ‹‰ Profile (Development or AdHoc) å°±ä¼šåŒ…å«æ–°çš„è£…ç½®äº†ã€‚



### Fastlane Match x CI/CD å·¥ä½œæµç¨‹æ•´åˆ



å¤§è‡´ä»‹ç»å®Œ Fastlane Match æ€ä¹ˆäº§ç”Ÿ Push / æ‹‰å– Pull å‡­è¯åï¼Œå†æ¥è¦è®²æ€ä¹ˆæ•´åˆè¿› CI/CD æµç¨‹ã€‚



#### é—®é¢˜1 â€” æ€ä¹ˆ Clone Private Match Repo



ç¬¬ä¸€ä¸ªæœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯åœ¨ CI/CD ä¸Šæ€ä¹ˆ Clone Private Match Repo ä¸“æ¡ˆï¼Œåœ¨æœ¬æœºå¼€å‘ä¸Šå› ä¸ºæˆ‘ä»¬ç»Ÿä¸€éƒ½ä½¿ç”¨ ssh git clone å¹¶ä¸”æ˜¯ç”¨æˆ‘ä»¬è‡ªå·±å¸å·çš„ ssh key æ‰€ä»¥ä¸ä¼šé‡åˆ°é—®é¢˜ï¼›ä½†æ˜¯ CI/CD ä¸Šæ²¡æœ‰è¿™ä¸ª keyï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸ªäººçš„ key ä½†æ˜¯å¾ˆä¸ä¿é™©ã€‚



**GitHub â€” Repo Deploy Key:**



1.æˆ‘ä»¬å…ˆåœ¨æœ¬åœ°äº§ç”Ÿ private/public key: `ssh-keygen -t rsa -b 4096 -f ./id_rsa` ( **ä¸è¦è¾“å…¥ `passphrase`** )



2.åˆ° **Match Private Repo** -&gt; Settings -&gt; Security -&gt; Deploy keys -&gt; Add deploy key:



![](/assets/823ac523ccc8/1*nzo-oPRi7DDxPvtJIWBspw.png)



3. ç”¨æ–‡å­—ç¼–è¾‘å™¨æ‰“å¼€ã€Œ `id_rsa.pub` ã€å¤åˆ¶å†…å®¹è´´ä¸Šåˆ° Key -&gt;ã€ŒAdd keyã€



![](/assets/823ac523ccc8/1*mbwtijzM-2iAzfgFiT32rw.png)



5. å›åˆ°ä¸»è¦ Repo -&gt; Settings -&gt; Security -&gt; Secrets and variables



![](/assets/823ac523ccc8/1*jvY8Yg6tI85LNKHgIaHVVQ.png)



5. æ–°å¢ SSH Private Key Content åˆ° Secret:



![](/assets/823ac523ccc8/1*8WiPfOz21rJWD6yiMwP3aw.png)



- Name: `MATCH_REPO_DEPLOY_PRIVATE_KEY`



6. å›åˆ°ä¸»è¦ Repo çš„ GitHub Actions è®¾å®š SSH Key:



```yaml
name: CI - Deploy

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: Test Clone
        run: \\|
          git clone git@github.com:xxxx/match-certificates.git
# Success!
# .. do deploy job...
```



7. è®¾å®šæˆåŠŸ!



#### é—®é¢˜2â€” App Store Connect API .p8 Key å®‰å…¨å­˜æ”¾ä½¿ç”¨



å› ä¸º GitHub Actions ä¸èƒ½å­˜æ¡£æ¡ˆï¼Œæ‰€ä»¥åªèƒ½å…ˆå­˜æˆå­—ä¸²ï¼Œç„¶åå†™å…¥æ¡£æ¡ˆã€‚



1. åŒé—®é¢˜ 1 æ­¥éª¤ï¼Œåœ¨ä¸»è¦ Repo æ–°å¢ä¸€ä¸ª `APP_STORE_CONNECT_API_KEY_CONTENT` Secret


2. ç”¨æ–‡å­—ç¼–è¾‘å™¨æ‰“å¼€ `AuthKey_XXXXXX.p8` å¤åˆ¶å¹¶è´´ä¸Šå†…å®¹


3. **ä¸»è¦ Repo çš„ GitHub Actions åŠ ä¸Šä¸€ä¸ªæ­¥éª¤è¯»å‡ºå†…å®¹å†™å…¥æ¡£æ¡ˆ:**



```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```



#### é—®é¢˜3 â€” è®¾å®š Private Match Repo çš„ Passphraseï¼Œé˜²æ­¢ Match æ—¶è·³ Prompt ä¸­æ–­



1. åŒé—®é¢˜ 1 æ­¥éª¤ï¼Œåœ¨ä¸»è¦ Repo æ–°å¢ `MATCH_PASSWORD` åˆ° Secret


2. å†…å®¹è¾“å…¥ä½ è®¾å®šçš„ Fastlane Match Repo `Passphrase`


3. **ä¸»è¦ Repo çš„ GitHub Actions åŠ ä¸Š** `env: secret.MATCH_PASSWORD` **:**



```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```



#### é—®é¢˜4 â€” Self-hosted Runner ä¸Šçš„ Keychain å¤„ç†



è·Ÿäº‘ç«¯æœºå™¨æ¯æ¬¡éƒ½æ˜¯å¹²å‡€å…¨æ–°çš„ä¸åŒï¼Œå¦‚æœæ˜¯ç”¨ Self-hosted Runner æˆ‘ä»¬å¯ä»¥åœ¨ Fastlane æŒ‡å®š `derived_data_path` ã€ `output_directory` ã€ `buildlog_path` ã€ `reinstall_app` è®©æ¯æ¬¡æ‰§è¡Œçš„ç¯å¢ƒéƒ½æ˜¯å¹²å‡€çš„ï¼›ä½†æ˜¯ Certificates, Profiles æ˜¯å®‰è£…åˆ°ç³»ç»Ÿçš„ Keychain åº”ç”¨ä¸­ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ



å…¶å® Fastlane ä¹Ÿå¸®æˆ‘ä»¬è€ƒè™‘åˆ°äº†ï¼Œå¯ä»¥åœ¨ Match ä¹‹å‰å…ˆå»ºç«‹ä¸€ä¸ªå¹²å‡€çš„ Keychain:



```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: \\|
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: \\|
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Create fastlane keychain
        env:
          KEYCHAIN_NAME: "${{ runner.name }}"
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: \\|
          bundle exec fastlane run create_keychain \
            name:"$KEYCHAIN_NAME" \
            password:"$MATCH_PASSWORD" \
            unlock:true \
            timeout:0 \
            lock_when_sleeps:false
      
      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
          KEYCHAIN_NAME: "${{ runner.name }}"
        run: bundle exec fastlane deploy_to_firebase

      # ğŸ”¥ ä¸ç®¡å‰é¢æˆåŠŸæˆ–å¤±è´¥ï¼Œä¸€å®šä¼šæ‰§è¡Œ
      - name: Delete fastlane keychain
        if: always()
        env:
          KEYCHAIN_NAME: ${{ runner.name }}
        run: \\|
          bundle exec fastlane run delete_keychain \
            name:"$KEYCHAIN_NAME"
```



- æ¯ä¸ª Runner åŒæ—¶åªä¼šæ‰§è¡Œä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬ç”¨ Runner Name å½“æˆ Keychain Nameï¼Œæ¯ä¸ª Runner éƒ½ä¼šæœ‰è‡ªå·±çš„ Keychain


- æ‰§è¡Œå®Œæ¯•ï¼Œä¸ç®¡æˆåŠŸæˆ–å¤±è´¥éƒ½ä¼šåˆ é™¤


- `keychain_password` æˆ‘å°±æ²¡ç‰¹åˆ«å¦å¤–è®¾å®šäº†ï¼Œç»Ÿä¸€ç”¨ `MATCH_PASSWORD`



`Fastlane/Fastfile` é‡Œçš„ match æ–¹æ³•å¤šåŠ ä¸Š keychain parameters:



```ruby
#...
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šä¼  cert / profile
      force_for_new_devices: true, # å¦‚æœä¸ºæ–°è£…ç½®åˆ™é‡å»º provisioning profile
      keychain_name: ENV['KEYCHAIN_NAME'], # default value: nil
      keychain_password: ENV['MATCH_PASSWORD'] # default value: nil
    )
#...
```



è¿™æ · Match åœ¨æ‹‰å–å‡­è¯çš„æ—¶å€™å°±ä¼šæ”¹å­˜åˆ°æŒ‡å®šçš„ Keychainï¼Œè€Œéå…±ç”¨çš„ login keychainã€‚



### ç»“è¯­



Fastlane çš„æ–‡ç« èŒƒå›´å¤ªå¤§äº†ï¼Œè¿™è¾¹å°±åªè®°å½•ä½¿ç”¨ Fastlane Match çš„è¿‡ç¨‹ï¼›å…¶ä»–å…³äº Fastlane è·‘æµ‹è¯•ã€æ‰“åŒ…å‘å¸ƒâ€¦ç­‰ç­‰ Lane æœ‰æœºä¼šå†å†™ä¸€ç¯‡æ–°çš„è¡¥å……ï¼›å…¶ä»– Match ç›¸å…³çš„é—®é¢˜ï¼Œæœ‰æƒ³åˆ°ä»€ä¹ˆæ¡ˆä¾‹ä¼šå†æ¥è¡¥å……ï¼ä¹Ÿæ¬¢è¿ç•™è¨€æé—®ï¼



### å»¶ä¼¸é˜…è¯»



- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€è¿‡ CI/CD æ‰“é€ ç¨³å®šé«˜æ•ˆçš„å¼€å‘å›¢é˜Ÿï¼Ÿå·¥å…·é€‰æ‹©ï¼Ÿ](../c008a9e8ceca/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆäºŒï¼‰ï¼šGitHub Actions ä¸ self-hosted Runner ä½¿ç”¨ä¸å»ºç½®å¤§å…¨](../404bd5c70040/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šä½¿ç”¨ GitHub Actions å®ä½œ App ä¸“æ¡ˆçš„ CI ä¸ CD å·¥ä½œæµç¨‹](../4b001d2e8440/)


- [CI/CD å®æˆ˜æŒ‡å—ï¼ˆå››ï¼‰ï¼šä½¿ç”¨ Google Apps Script Web App ä¸²æ¥ GitHub Actions å»ºç½®å…è´¹æ˜“ç”¨çš„æ‰“åŒ…å·¥å…·å¹³å°](../4273e57e7148/)



**æ•¬è¯·ç§»æ­¥é˜…è§ˆã€‚ğŸ¤ğŸ»**



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/ios-certificates-identifiers-profiles-%E6%98%AF%E4%BB%80%E9%BA%BC%E5%8F%8A-fastlane-match-%E7%B5%B1%E4%B8%80%E7%AE%A1%E7%90%86%E6%86%91%E8%AD%89%E8%88%87-ci-cd-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%86%E8%A8%98-823ac523ccc8){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*