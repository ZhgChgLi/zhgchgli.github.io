---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2024-07-28T09:53:05.535+0000
description: iOS WKWebView é¢„å…ˆä¸‹è½½ä¸ç¼“å­˜èµ„æºæå‡é¡µé¢è½½å…¥é€Ÿåº¦ç ”ç©¶ã€‚
image:
  path: /assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.jpeg
last_modified_at: 2024-08-10T09:11:41.233+0000
render_with_liquid: false
tags:
- simplified-chinese
- ios
- ios-app-development
- cache
- webview
- http-request
title: iOS WKWebView é¡µé¢ä¸æ¡£æ¡ˆèµ„æº Preload é¢„è½½ / Cache ç¼“å­˜ç ”ç©¶
---

### iOS WKWebView é¡µé¢ä¸æ¡£æ¡ˆèµ„æº Preload é¢„è½½ / Cache ç¼“å­˜ç ”ç©¶



iOS WKWebView é¢„å…ˆä¸‹è½½ä¸ç¼“å­˜èµ„æºæå‡é¡µé¢è½½å…¥é€Ÿåº¦ç ”ç©¶ã€‚



![Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.jpeg)



Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}



#### èƒŒæ™¯



ä¸çŸ¥ä¸ºä½•ï¼Œä¸€ç›´è·Ÿ â€œCacheâ€ ç¼“å­˜è›®æœ‰ç¼˜çš„ï¼Œä¹‹å‰ä¹Ÿè´Ÿè´£ç ”ç©¶å®è·µè¿‡ AVPlayer çš„ã€Œ [iOS HLS Cache å®è·µæ–¹æ³•æ¢ç©¶ä¹‹æ—…](../d796bf8e661e/) ã€ä¸ã€Œ [AVPlayer å®è·µæœ¬åœ° Cache åŠŸèƒ½å¤§å…¨](../6ce488898003/) ã€ï¼›ä¸åŒäºä¸²æµç¼“å­˜ç›®çš„æ˜¯å‡å°‘æ’­æ”¾æµé‡ï¼Œ **è¿™æ¬¡çš„ä¸»è¦ä»»åŠ¡æ˜¯æå‡ In-app WKWebView è½½å…¥é€Ÿåº¦** ï¼Œå…¶ä¸­ä¹Ÿç‰µæ¶‰åˆ° WKWebView çš„é¢„å…ˆåŠ è½½ä¸ç¼“å­˜ç ”ç©¶ï¼›ä¸è¿‡è€å®è¯´ WKWebView çš„åœºæ™¯æ›´ä¸ºå¤æ‚ï¼Œä¸åŒäº AVPlayer ä¸²æµå½±éŸ³æ˜¯ä¸€ä¸ªæˆ–æ˜¯å¤šä¸ªè¿ç»­çš„ Chunk æ¡£æ¡ˆï¼Œåªéœ€è¦é’ˆå¯¹æ¡£æ¡ˆåš Cacheï¼ŒWKWebView é™¤äº†æœ¬èº«é¡µé¢æ¡£æ¡ˆè¿˜æœ‰å¼•å…¥çš„èµ„æºæ¡£æ¡ˆ( .js, .css, font, imageâ€¦) å†ç»ç”± Browser Engine æ¸²æŸ“å‡ºé¡µé¢å‘ˆç°ç»™ä½¿ç”¨è€…ï¼Œè¿™ä¸­é—´ä¸æ˜¯ App å¯ä»¥æ§åˆ¶çš„ç¯èŠ‚å¤ªå¤šï¼Œä»ç½‘è·¯åˆ°å‰ç«¯é¡µé¢ JavaScript è¯­æ³•æ•ˆèƒ½ã€æ¸²æŸ“æ–¹å¼ï¼Œéƒ½éœ€è¦èŠ±è´¹æ—¶é—´ã€‚



**æœ¬ç¯‡æ–‡ç« åªæ˜¯å°± iOS æŠ€æœ¯ä¸Šå¯è¡Œæ€§è¿›è¡Œç ”ç©¶ï¼Œå¹¶ä¸ä¸€å®šæ˜¯æœ€ç»ˆè§£æ³•ï¼Œç»¼è§‚æ¥è¯´æ­¤è®®é¢˜è¿˜æ˜¯è¯·å‰ç«¯ä»å‰ç«¯ä¸‹æ‰‹æ¯”è¾ƒèƒ½è¾¾æˆå››ä¸¤æ‹¨åƒæ–¤çš„æ•ˆæœ** ï¼Œè¯·å‰ç«¯ä¼™ä¼´ä¼˜åŒ–ç¬¬ä¸€ä¸ªç”»é¢å‡ºç°çš„æ—¶é—´(First Contentful Paint) ä¸å®Œå–„ HTTP Cache æœºåˆ¶ï¼Œä¸€æ–¹é¢èƒ½åŠ é€Ÿ Web/mWeb è‡ªèº«ï¼ŒåŒæ—¶å½±å“ Android/iOS in-app WebView é€Ÿåº¦ï¼Œå¹¶ä¸”ä¹Ÿä¼šæå‡ [Google SEO æƒé‡](https://developers.google.com/search/blog/2018/01/using-page-speed-in-mobile-search?hl=zh-tw){:target="_blank"} ã€‚



### æŠ€æœ¯ç»†èŠ‚



#### iOS é™åˆ¶



æ ¹æ® [Apple Review Guidelines 2.5.6](https://developer.apple.com/app-store/review/guidelines/){:target="_blank"} ï¼š



> *Apps that browse the web must use the appropriate WebKit framework and WebKit JavaScript. You may apply for an entitlement to use an alternative web browser engine in your app. [Learn more about these entitlements](https://developer.apple.com/support/alternative-browser-engines/){:target="_blank"} .*



**Apps å†…åªèƒ½ä½¿ç”¨ Apple æä¾›çš„ WebKit Framework (WKWebView) ä¸å…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹æˆ–è‡ªè¡Œä¿®æ”¹è¿‡çš„ WebKit å¼•æ“** ï¼Œå¦åˆ™å°†ä¸å…è®¸ä¸Šæ¶ï¼›å¦å¤– iOS 17.4 å¼€å§‹ï¼Œä¸ºç¬¦åˆæ³•è§„ï¼Œæ¬§ç›Ÿåœ°åŒºå¯ä»¥åœ¨ **å–å¾— Apple ç‰¹åˆ«è®¸å¯** å [ä½¿ç”¨å…¶ä»– Browser Engine](https://developer.apple.com/support/alternative-browser-engines/){:target="_blank"} ã€‚



> è‹¹æœä¸ç»™çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½åšã€‚



[æœªéªŒè¯] æŸ¥èµ„æ–™è¯´å°±è¿ iOS ç‰ˆçš„ Chrome, Firefox ä¹Ÿéƒ½æ˜¯åªèƒ½ç”¨ Apple WebKit (WKWebView)ã€‚



**å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹ï¼š**



> *WKWebView æ˜¯è·‘åœ¨ App ä¸»æ‰§è¡Œç»ªä¹‹å¤–çš„ç‹¬ç«‹æ‰§è¡Œç»ªï¼Œå› æ­¤æ‰€æœ‰è¯·æ±‚ã€æ“ä½œéƒ½ä¸ä¼šç»è¿‡æˆ‘ä»¬çš„ Appã€‚*



#### HTTP Cache Flow



![](/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.jpeg)



åœ¨ HTTP åè®®ä¸­å°±æœ‰åŒ…å« Cache åè®®ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰è·Ÿç½‘è·¯æœ‰å…³çš„å…ƒä»¶(URLSession, WKWebViewâ€¦)å½“ä¸­ç³»ç»Ÿéƒ½å·²ç»å¸®æˆ‘ä»¬å®ä½œå¥½äº† Cache æœºåˆ¶ï¼Œå› æ­¤ Client App è¿™è¾¹ä¸éœ€è¦åšä»»ä½•å®ç°ï¼Œä¹Ÿä¸æ¨èå¤§å®¶è‡ªå·±å¹²ä¸€å¥—è‡ªå·±çš„ Cache æœºåˆ¶ï¼Œç›´æ¥èµ° HTTP åè®®æ‰æ˜¯æœ€å¿«æœ€ç¨³å®šæœ€æœ‰æ•ˆçš„è·¯ã€‚



**HTTP Cache å¤§è‡´è¿ä½œæµç¨‹å¦‚ä¸Šå›¾ï¼š**



1. Client å‘èµ·è¯·æ±‚


2. Server å“åº” Cache ç­–ç•¥åœ¨ Response Headerï¼Œç³»ç»Ÿ URLSession, WKWebViewâ€¦ ä¼šä¾ç…§ Cache Header è‡ªåŠ¨å¸®æˆ‘ä»¬å°† Response ç¼“å­˜ä¸‹æ¥ï¼Œåç»­è¯·æ±‚ä¹Ÿä¼šè‡ªåŠ¨å¥—ç”¨è¿™ä¸ªç­–ç•¥


3. å†æ¬¡è¯·æ±‚ç›¸åŒèµ„æºæ—¶ï¼Œå¦‚æœç¼“å­˜æœªè¿‡æœŸåˆ™ç›´æ¥ä»è®°å¿†ä½“ã€ç£ç¢Ÿè¯»å–æœ¬åœ°ç¼“å­˜ç›´æ¥å›åº”ç»™ App


4. å¦‚æœå·²è¿‡æœŸ(è¿‡æœŸä¸ä»£è¡¨æ— æ•ˆ)ï¼Œåˆ™å‘èµ·çœŸå®ç½‘è·¯è¯·æ±‚é—® Serverï¼Œå¦‚æœå†…å®¹æ²¡æ›´æ”¹ (è™½è¿‡æœŸå¾…ä»æœ‰æ•ˆ) Server ä¼šç›´æ¥å›åº” 304 Not Modified (Empt Body)ï¼Œè™½ç„¶çœŸçš„æœ‰å‘èµ·ç½‘è·¯è¯·æ±‚ä½†æ˜¯åŸºæœ¬ä¸Šæ˜¯æ¯«ç§’å›åº”ï¼‹æ—  Response Body æ²¡ä»€ä¹ˆæµé‡è€—æŸ


5. å¦‚æœå†…å®¹æœ‰æ›´æ”¹åˆ™é‡æ–°ç»™ä¸€æ¬¡èµ„æ–™è·Ÿ Cache Headerã€‚



> *ç¼“å­˜é™¤äº†æœ¬åœ° Cacheã€åœ¨ Network Proxy Server æˆ–é€”ç»çš„è·¯ä¸Šä¹Ÿå¯èƒ½æœ‰ç½‘è·¯çš„ç¼“å­˜ã€‚*



**å¸¸è§ HTTP Response Cache Header å‚æ•°ï¼š**



```yaml
expires: RFC 2822 æ—¥æœŸ
pragma: no-cache
# è¾ƒæ–°çš„å‚æ•°:
cache-control: private/public/no-store/no-cache/max-age/s-max-age/must-revalidate/proxy-revalidate...
etag: XXX
```



**å¸¸è§ HTTP Request Cache Header å‚æ•°ï¼š**



```yaml
If-Modified-Since: 2024-07-18 13:00:00
IF-None-Match: 1234
```



> ***åœ¨ iOS ä¸­ç½‘è·¯æœ‰å…³çš„å…ƒä»¶(URLSession, WKWebViewâ€¦)ä¼šè‡ªå·±å¤„ç† HTTP Request/Response Cache Header å¹¶è‡ªåŠ¨åšç¼“å­˜ï¼Œæˆ‘ä»¬ä¸éœ€è‡ªå·±å¤„ç† Cache Header å‚æ•°ã€‚***



æ›´è¯¦ç»†çš„ HTTP Cache è¿ä½œç»†èŠ‚å¯å‚è€ƒã€Œ [Huli å¤§å¤§å†™çš„å¾ªåºæ¸è¿›ç†è§£ HTTP Cache æœºåˆ¶](https://blog.techbridge.cc/2017/06/17/cache-introduction/){:target="_blank"} ã€



### iOS WKWebView æ€»æ½



![](/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.jpeg)



å›åˆ° iOS ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½ä½¿ç”¨ Apple WebKitï¼Œå› æ­¤åªèƒ½ä»è‹¹æœæä¾›çš„ WebKit æ–¹æ³•ä¸‹æ‰‹ï¼Œæ¢ç©¶æœ‰æœºä¼šè¾¾æˆé¢„è½½ç¼“å­˜çš„æ–¹å¼ã€‚



ä¸Šå›¾æ˜¯ä½¿ç”¨ ChatGPT 4o ç®€ä»‹çš„æ‰€æœ‰ Apple iOS WebKit (WKWebView) ç›¸å…³çš„æ–¹æ³•ï¼Œå¹¶é™„ä¸Šç®€çŸ­è¯´æ˜ï¼›ç»¿è‰²éƒ¨åˆ†ä¸ºè·Ÿèµ„æ–™å‚¨å­˜æœ‰å…³çš„æ–¹æ³•ã€‚



**è·Ÿå¤§å®¶åˆ†äº«å…¶ä¸­æ¯”è¾ƒå‡ ä¸ªæœ‰è¶£çš„æ–¹æ³•ï¼š**



- WKProcessPoolï¼šå¯ä»¥è®©å¤šä¸ª WKWebView ä¹‹é—´å…±äº«èµ„æºã€æ•°æ®ã€Cookieâ€¦ç­‰ç­‰ã€‚


- WKHTTPCookieStoreï¼šå¯ä»¥ç®¡ç† WKWebView Cookieï¼ŒWKWebView ä¸ WKWebView ä¹‹é—´æˆ–æ˜¯ App å†…çš„ URLSession Cookie ä¸ WKWebViewã€‚


- WKWebsiteDataStoreï¼šç®¡ç†ç½‘ç«™ç¼“å­˜æ¡£æ¡ˆã€‚(åªèƒ½è¯»èµ„è®¯è·Ÿæ¸…é™¤)


- WKURLSchemeHandlerï¼šå½“ WKWebView æ— æ³•è®¤å¾—å¤„ç†çš„ URL Scheme åˆ™å¯æ³¨å†Œè‡ªå®šä¹‰ Handler å¤„ç†ã€‚


- WKContentWorldï¼šå¯ä»¥æŠŠæ³¨å…¥çš„ JavaScript (WKUserScript) è„šæœ¬åˆ†ç»„ç®¡ç†ã€‚


- WKFindXXXï¼šå¯ä»¥æ§åˆ¶é¡µé¢æœå¯»åŠŸèƒ½ã€‚


- WKContentRuleListStoreï¼šå¯ä»¥åœ¨ WKWebView å†…å®ç°å†…å®¹é˜»æŒ¡å™¨åŠŸèƒ½(e.g. é®æŒ¡å¹¿å‘Šä¹‹ç±»çš„)ã€‚



### iOS WKWebView é¢„è½½ç¼“å­˜å¯è¡Œæ€§æ–¹æ¡ˆç ”ç©¶



### å®Œå–„ HTTP Cache âœ…



å¦‚åŒå‰æ–‡ä»‹ç»çš„ HTTP Cache æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯· Web Team å®Œå–„æ´»åŠ¨é¡µé¢çš„ HTTP Cache è®¾å®šï¼ŒClient iOS è¿™è¾¹åªéœ€è¦ç®€å•çš„æ£€æŸ¥ä¸€ä¸‹ CachePolicy è®¾å®šå°±å¥½ï¼Œå…¶ä»–çš„äº‹ç³»ç»Ÿéƒ½åšå¥½äº†ï¼



#### **CachePolicy è®¾å®š**



**URLSession:**



```swift
let configuration = URLSessionConfiguration.default
configuration.requestCachePolicy = .useProtocolCachePolicy
let session = URLSession(configuration: configuration)
```



**URLRequest/WKWebView:**



```swift
var request = URLRequest(url: url)
request.cachePolicy = .reloadRevalidatingCacheData
//
wkWebView.load(request)
```



- **useProtocolCachePolicy** : é»˜è®¤ï¼Œç…§é»˜è®¤ HTTP Cache æ§åˆ¶ã€‚


- **reloadIgnoringLocalCacheData** : ä¸ä½¿ç”¨æœ¬åœ°å¿«å–ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä»ç½‘ç»œåŠ è½½æ•°æ®(ä½†å…è®¸ç½‘è·¯, Proxy å¿«å–â€¦)ã€‚


- **reloadIgnoringLocalAndRemoteCacheData** : æ— è®ºæœ¬åœ°æˆ–è¿œç«¯å¿«å–ï¼Œæ€»æ˜¯ä»ç½‘ç»œåŠ è½½æ•°æ®ã€‚


- **returnCacheDataElseLoad** : å¦‚æœæœ‰å¿«å–æ•°æ®åˆ™ä½¿ç”¨å¿«å–æ•°æ®ï¼Œå¦åˆ™ä»ç½‘ç»œåŠ è½½æ•°æ®ã€‚


- **returnCacheDataDontLoad** : ä»…ä½¿ç”¨å¿«å–æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å¿«å–æ•°æ®ä¹Ÿä¸æ‰“ç½‘è·¯è¯·æ±‚ã€‚


- **reloadRevalidatingCacheData** : å‘é€è¯·æ±‚æ£€æŸ¥æœ¬åœ°å¿«å–æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸ(304 Not Modified)åˆ™ä½¿ç”¨å¿«å–æ•°æ®ï¼Œå¦åˆ™ä»ç½‘ç»œé‡æ–°åŠ è½½æ•°æ®ã€‚



#### **è®¾å®šå¿«å–å¤§å°**



**App å…¨åŸŸ:**



```swift
let memoryCapacity = 512 * 1024 * 1024 // 512 MB
let diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GB
let urlCache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: "myCache")
        
URLCache.shared = urlCache
```



**ä¸ªåˆ« URLSession:**



```csharp
let memoryCapacity = 512 * 1024 * 1024 // 512 MB
let diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GB
let cache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: "myCache")
        
let configuration = URLSessionConfiguration.default
configuration.urlCache = cache
```



> ***å¦å¤–åŒå‰è¿°ï¼ŒWKWebView æ˜¯è·‘åœ¨ App ä¸»æ‰§è¡Œç»ªä¹‹å¤–çš„ç‹¬ç«‹æ‰§è¡Œç»ªï¼Œå› æ­¤ URLRequest, URLSession çš„å¿«å–è·Ÿ WKWebView çš„æ˜¯ä¸å…±ç”¨çš„ã€‚***



#### **å¦‚ä½•åœ¨** WKWebView **ä¸­ä½¿ç”¨ Safari å¼€å‘è€…å·¥å…·?**



æ£€æŸ¥æ˜¯å¦æ˜¯ä½¿ç”¨æœ¬åœ° Cache å¿«å–ã€‚



**Safari å¯ç”¨å¼€å‘è€…åŠŸèƒ½ï¼š**



![](/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.png)



**WKWebView å¯ç”¨ isInspectableï¼š**



```swift
func makeWKWebView() -> WKWebView {
 let webView = WKWebView(frame: .zero)
 webView.isInspectable = true // is only available in ios 16.4 or newer
 return webView
}
```



WKWebView åŠ ä¸Š `webView.isInspectable = true` æ‰èƒ½åœ¨ Debug Build ç‰ˆä½¿ç”¨ Safari å¼€å‘è€…å·¥å…·ã€‚



![p.s. è¿™æ˜¯æˆ‘å¦å¼€çš„æµ‹è¯• WKWebView ç”¨ Project](/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.png)



p.s. è¿™æ˜¯æˆ‘å¦å¼€çš„æµ‹è¯• WKWebView ç”¨ Project



åœ¨ `webView.load` çš„åœ°æ–¹ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚



**å¼€å§‹æµ‹è¯•ï¼š**



Build & Runï¼š



![](/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.png)



æ‰§è¡Œåˆ° webView.load æ–­ç‚¹æ—¶ï¼Œç‚¹å‡»ã€Œé€è¡Œä¾¦é”™ã€ã€‚



![](/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.png)



å›åˆ° Safariï¼Œé€‰æ‹©å·¥å…·åˆ—çš„ã€Œå¼€å‘ã€-&gt;ã€Œæ¨¡æ‹Ÿå™¨ã€-&gt;ã€Œä½ çš„ä¸“æ¡ˆã€-&gt;ã€Œabout:blankã€ã€‚



- å› ä¸ºé¡µé¢å°šæœªå¼€å§‹è½½å…¥ æ‰€ä»¥ç½‘å€ä¼šæ˜¯ about:blank


- å¦‚æœæ²¡å‡ºç° about:blank å°±å†å›åˆ° XCode ç‚¹ä¸€æ¬¡é€è¡Œä¾¦é”™æŒ‰é’®ï¼Œç›´åˆ°å‡ºç°ä¸ºæ­¢



å‡ºç°è¯¥é¡µé¢å¯¹åº”çš„å¼€å‘è€…å·¥å…·ï¼š



![](/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.png)



å› XCode ç‚¹å‡»ç»§ç»­æ‰§è¡Œï¼š



![](/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.png)



å†å›åˆ° Safari å¼€å‘è€…å·¥å…·å°±èƒ½çœ‹åˆ°èµ„æºè½½å…¥çŠ¶å†µè·Ÿå®Œæ•´çš„å¼€å‘è€…å·¥å…·åŠŸèƒ½äº† (å…ƒä»¶ã€å‚¨å­˜ç©ºé—´è°ƒè¯•â€¦ç­‰ç­‰)



![](/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.png)



**å¦‚æœç½‘è·¯èµ„æºæœ‰ HTTP Cacheï¼Œä¼ ç®—å¤§å°åˆ™ä¼šæ˜¾ç¤ºã€Œç£ç¢Ÿã€ï¼š**



![](/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.png)



![](/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.png)



ç‚¹è¿›å»ä¹Ÿèƒ½çœ‹åˆ°ç¼“å­˜èµ„è®¯ã€‚



#### æ¸…é™¤ WKWebView å¿«å–



```swift
// Clean Cookies
HTTPCookieStorage.shared.removeCookies(since: Date.distantPast)

// Clean Stored Data, Cache Data
let dataTypes = WKWebsiteDataStore.allWebsiteDataTypes()
let store = WKWebsiteDataStore.default()
store.fetchDataRecords(ofTypes: dataTypes) { records in
 records.forEach { record in
  store.removeData(
   ofTypes: record.dataTypes,
   for: records,
   completionHandler: {
          print("clearWebViewCache() - \(record)")           
   }
  )
 }
}
```



å¯ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•æ¸…é™¤ WKWebView å·²ç¼“å­˜çš„èµ„æºã€æœ¬åœ°æ•°æ®ã€Cookie æ•°æ®ã€‚



> ***ä½†å®Œå–„ HTTP Cache åªæ˜¯åšåˆ°ç¼“å­˜éƒ¨åˆ†(ç¬¬äºŒæ¬¡è¿›å…¥å¾ˆå¿«)ï¼Œé¢„è½½(ç¬¬ä¸€æ¬¡è¿›å…¥)ä¸ä¼šæœ‰å½±å“ã€‚*** *âœ…*



### å®Œå–„ HTTP Cache + WKWebView Preload å…¨é¡µé¢ ğŸ˜•



```swift
class WebViewPreloader {
    static let shared = WebViewPreloader()

    private var _webview: WKWebView = WKWebView()

    private init() { }

    func preload(url: URL) {
        let request = URLRequest(url: url)
        Task { @MainActor in
            webview.load(request)
        }
    }
}

WebViewPreloader.shared.preload("https://zhgchg.li/campaign/summer")
```



åŸºäºå®Œå–„ HTTP Cache ä¹‹åï¼Œç¬¬äºŒæ¬¡ Load WKWebView ä¼šæœ‰ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨åˆ—è¡¨æˆ–é¦–é¡µå·å…ˆæŠŠé‡Œé¢çš„ URL éƒ½ Load è¿‡ä¸€æ¬¡è®©ä»–æœ‰ç¼“å­˜ï¼Œä½¿ç”¨è€…è¿›å»ä¹‹åå°±ä¼šæ¯”è¾ƒå¿«ã€‚



> ***ç»è¿‡æµ‹è¯•ï¼ŒåŸç†ä¸Šå¯è¡Œï¼›ä½†æ˜¯å¯¹æ€§èƒ½ã€ç½‘è·¯æµé‡æŸè€—å¤ªå¤§*** *ï¼›ä½¿ç”¨è€…å¯èƒ½æ ¹æœ¬æ²¡è¿›å»è¯¦ç»†é¡µï¼Œä½†æˆ‘ä»¬ä¸ºäº†åšé¢„è½½æŠŠæ‰€æœ‰é¡µé¢å…¨éƒ½ Load äº†ä¸€éï¼Œæœ‰ç‚¹ä¹±æªæ‰“é¸Ÿçš„æ„Ÿè§‰ã€‚*



> *ä¸ªäººè®¤ä¸ºç°å®ä¸Šä¸å¯è¡Œï¼Œä¸”åˆ©å¤§äºå¼Šã€å› å™åºŸé£Ÿã€‚ğŸ˜•*



### å®Œå–„ HTTP Cache + WKWebView Preload çº¯èµ„æºğŸ‰



åŸºäºä¸Šé¢æ–¹æ³•çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ­é… HTML Link Preload æ–¹æ³•ï¼Œä»…é’ˆå¯¹é¡µé¢é‡Œé¢ä¼šç”¨åˆ°çš„èµ„æºæ¡£æ¡ˆ(e.g. .js, .css, font, imageâ€¦)è¿›è¡Œ Preloadï¼Œè®©ä½¿ç”¨è€…è¿›å»ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜èµ„æºï¼Œä¸ç”¨å†å‘èµ·ç½‘è·¯è¯·æ±‚æ‹¿èµ„æºæ¡£æ¡ˆã€‚



> ***æ„å³æˆ‘ä¸é¢„è½½æ•´ä¸ªé¡µé¢çš„æ‰€æœ‰ä¸œè¥¿äº†ï¼Œæˆ‘åªé¢„è½½é¡µé¢ä¼šç”¨åˆ°çš„èµ„æºæ¡£æ¡ˆï¼Œè¿™äº›æ¡£æ¡ˆå¯èƒ½ä¹Ÿæ˜¯è·¨é¡µé¢å…±ç”¨çš„ï¼›é¡µé¢æ¡£æ¡ˆ .html è¿˜æ˜¯ä»ç½‘è·¯æ‹¿å–å†ç»“åˆé¢„è½½æ¡£æ¡ˆæ¸²æŸ“å‡ºé¡µé¢ã€‚***



è¯·æ³¨æ„ï¼šè¿™è¾¹ä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤è¿™äº›èµ„æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦åˆ™ä¹‹åè¯·æ±‚è¿˜æ˜¯ä¼šèµ°ç½‘è·¯ã€‚



è¯·æ³¨æ„ï¼šè¿™è¾¹ä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤è¿™äº›èµ„æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦åˆ™ä¹‹åè¯·æ±‚è¿˜æ˜¯ä¼šèµ°ç½‘è·¯ã€‚



è¯·æ³¨æ„ï¼šè¿™è¾¹ä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤è¿™äº›èµ„æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦åˆ™ä¹‹åè¯·æ±‚è¿˜æ˜¯ä¼šèµ°ç½‘è·¯ã€‚



```xml
<!DOCTYPE html>
<html lang="zh-tw">
 <head>
    <link rel="preload" href="https://cdn.zhgchg.li/dist/main.js" as="script">
    <link rel="preload" href="https://image.zhgchg.li/v2/image/get/campaign.jpg" as="image">
    <link rel="preload" href="https://cdn.zhgchg.li/assets/fonts/glyphicons-halflings-regular.woff2" as="font">
    <link rel="preload" href="https://cdn.zhgchg.li/assets/fonts/Simple-Line-Icons.woff2?v=2.4.0" as="font">
  </head>
</html>
```



**å¸¸è§æ”¯æ´æ¡£æ¡ˆç±»å‹ï¼š**



- .js script


- .css style


- font


- image



Web Team å°†ä»¥ä¸Š HTML å†…å®¹æ”¾åœ¨ä¸ App çº¦å®šå¥½çš„è·¯å¾„ï¼Œæˆ‘ä»¬çš„ `WebViewPreloader` æ”¹å» Load è¿™ä¸ªè·¯å¾„ï¼ŒWKWebView Load çš„åŒæ—¶å°±ä¼šè§£æ &lt;link&gt; preload èµ„æºäº§ç”Ÿç¼“å­˜äº†ã€‚



```swift
WebViewPreloader.shared.preload("https://zhgchg.li/campaign/summer/preload")
// or ç»Ÿä¸€éƒ½åœ¨
WebViewPreloader.shared.preload("https://zhgchg.li/assets/preload")
```



> ***ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥åœ¨æµé‡æŸè€—ä¸é¢„è½½ä¸­å–å¾—ä¸€ä¸ªä¸é”™çš„å¹³è¡¡*** *ã€‚* ğŸ‰



> ***ç¼ºç‚¹åº”è¯¥æ˜¯éœ€è¦ç»´æŠ¤è¿™ä»½ Cache èµ„æºåˆ—è¡¨ï¼Œè·Ÿè¿˜æ˜¯éœ€è¦ Web ä¼˜åŒ–é¡µé¢æ¸²æŸ“è·Ÿè½½å…¥ï¼Œä¸ç„¶ç¬¬ä¸€ä¸ªé¡µé¢å‡ºç°çš„ä½“æ„Ÿæ—¶é—´ä¾ç„¶ä¼šå¾ˆä¹…ã€‚***



### URLProtocol *âŒ*



å¦å¤–æƒ³åˆ°æˆ‘ä»¬çš„è€æœ‹å‹ [URLProtocol](https://developer.apple.com/documentation/foundation/urlprotocol){:target="_blank"} ï¼Œæ‰€æœ‰åŸºäº `URL Loading System` çš„è¯·æ±‚ (URLSession, openURLâ€¦) éƒ½å¯ä»¥è¢«æ‹¦æˆªä¸‹æ¥æ“ä½œã€‚



```swift
class CustomURLProtocol: URLProtocol {
    override class func canInit(with request: URLRequest) -> Bool {
        // åˆ¤æ–­æ˜¯å¦è¦å¤„ç†è¿™ä¸ªè¯·æ±‚
        if let url = request.url {
            return url.scheme == "custom"
        }
        return false
    }
    
    override class func canonicalRequest(for request: URLRequest) -> URLRequest {
        // è¿”å›è¯·æ±‚
        return request
    }
    
    override func startLoading() {
        // å¤„ç†è¯·æ±‚å¹¶åŠ è½½æ•°æ®
        // æ”¹æˆç¼“å­˜ç­–ç•¥ï¼Œå…ˆä»æœ¬åœ°è¯»æ¡£æ¡ˆ
        if let url = request.url {
            let response = URLResponse(url: url, mimeType: "text/plain", expectedContentLength: -1, textEncodingName: nil)
            self.client?.urlProtocol(self, didReceive: response, cacheStoragePolicy: .notAllowed)
            
            let data = "This is a custom response!".data(using: .utf8)!
            self.client?.urlProtocol(self, didLoad: data)
            self.client?.urlProtocolDidFinishLoading(self)
        }
    }
    
    override func stopLoading() {
        // åœæ­¢åŠ è½½æ•°æ®
    }
}

// AppDelegate.swift didFinishLaunchingWithOptions:
URLProtocol.registerClass(CustomURLProtocol.self)
```



æŠ½è±¡æƒ³æ³•æ˜¯åœ¨èƒŒæ™¯å·å‘ URLReqeust -&gt; URLProtocol -&gt; ä»ä¸­è‡ªå·±ä¸‹è½½æ‰€æœ‰èµ„æºï¼Œä½¿ç”¨è€… -&gt; WKWebView -&gt; Request -&gt; URLProtocol -&gt; å›åº”é¢„è½½çš„èµ„æºã€‚



> ***ä¸€æ ·åŒå‰è¿°ï¼ŒWKWebView æ˜¯è·‘åœ¨ App ä¸»æ‰§è¡Œç»ªä¹‹å¤–çš„ç‹¬ç«‹æ‰§è¡Œç»ªï¼Œå› æ­¤ URLProtocol æ˜¯æ‹¦æˆªä¸åˆ° WKWebView çš„è¯·æ±‚çš„ã€‚***



> ***ä½†å¬è¯´ä¸Šé»‘é­”æ³•å¥½åƒå¯ä»¥ï¼Œä¸æ¨èã€ä¼šå»¶ä¼¸å…¶ä»–é—®é¢˜(é€å®¡è¢«æ‹’)***



> ***æ­¤è·¯ä¸é€š*** *âŒã€‚*



### WKURLSchemeHandler *ğŸ˜•*



è‹¹æœåœ¨ iOS 11 æ¨å‡ºçš„æ–°æ–¹æ³•ï¼Œæ„Ÿè§‰æ˜¯ä¸ºäº†è¡¥è¶³ WKWebView æ— æ³•ä½¿ç”¨ URLProtocol çš„ç‰¹å‹ï¼›ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è·Ÿ [AVPlayer çš„ ResourceLoader](../6ce488898003/) æ¯”è¾ƒç±»ä¼¼ï¼Œ **åªæœ‰ç³»ç»Ÿæ— æ³•è¾¨è¯†çš„ Scheme æ‰ä¼šä¸¢ç»™æˆ‘ä»¬è‡ªå·±è®¢çš„ WKURLSchemeHandler è¿›è¡Œå¤„ç†** ã€‚



æŠ½è±¡æƒ³æ³•ä¸€æ ·æ˜¯åœ¨èƒŒæ™¯å·å‘ WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; ä»ä¸­è‡ªå·±ä¸‹è½½æ‰€æœ‰èµ„æºï¼Œä½¿ç”¨è€… -&gt; WKWebView -&gt; Request -&gt; WKURLSchemeHandler -&gt; å›åº”é¢„è½½çš„èµ„æºã€‚



```swift
import WebKit

class CustomSchemeHandler: NSObject, WKURLSchemeHandler {
    func webView(_ webView: WKWebView, start urlSchemeTask: WKURLSchemeTask) {
        // å¤„ç†è‡ªå®šä¹‰
        let url = urlSchemeTask.request.url!
        
        if url.scheme == "custom-scheme" {
            // æ”¹æˆç¼“å­˜ç­–ç•¥ï¼Œå…ˆä»æœ¬åœ°è¯»æ¡£æ¡ˆ
            let response = URLResponse(url: url, mimeType: "text/html", expectedContentLength: -1, textEncodingName: nil)
            urlSchemeTask.didReceive(response)
            
            let html = "<html><body><h1>Hello from custom scheme!</h1></body></html>"
            let data = html.data(using: .utf8)!
            urlSchemeTask.didReceive(data)
            urlSchemeTask.didFinish()
        }
    }

    func webView(_ webView: WKWebView, stop urlSchemeTask: WKURLSchemeTask) {
        // åœæ­¢
    }
}

let webViewConfiguration = WKWebViewConfiguration()
webViewConfiguration.setURLSchemeHandler(CustomSchemeHandler(), forURLScheme: "mycacher")

let customURL = URL(string: "mycacher://zhgchg.li/campaign/summer")!
webView.load(URLRequest(url: customURL))
```



- å› ä¸º http/https æ˜¯ç³»ç»Ÿèƒ½å¤„ç†çš„ Scheme æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è‡ªå®šä¹‰ http/https çš„å¤„ç†ï¼›éœ€è¦æŠŠ Scheme æ¢æˆç³»ç»Ÿè®¤ä¸å¾—çš„ Scheme (e.g. `mycacher://` )ã€‚


- é¡µé¢é‡Œé¢ç»Ÿä¸€éƒ½è¦ç”¨ç›¸å¯¹è·¯å¾„æ‰ä¼šè‡ªåŠ¨å¥—ä¸Š `mycacher://` è®©æˆ‘ä»¬çš„ Handler æ•è·ã€‚


- å¦‚æœä¸æƒ³æ”¹ http/https åˆæƒ³è·å– http/https è¯·æ±‚åªèƒ½ä¸Šé»‘é­”æ³•ï¼Œ **ä¸æ¨èã€** ä¼šå»¶ä¼¸å…¶ä»–é—®é¢˜(é€å®¡è¢«æ‹’)


- è‡ªè¡Œç¼“å­˜é¡µé¢æ¡£æ¡ˆå¹¶å“åº”ï¼Œé¡µé¢ä¸­ä½¿ç”¨çš„ Ajax, XMLHttpRequest, Fetch è¯·æ±‚å¯èƒ½ä¼šè¢« [**CORS åŒæºæ”¿ç­–**](https://developer.mozilla.org/zh-TW/docs/Web/Security/Same-origin_policy){:target="_blank"} **é˜»æŒ¡** ï¼Œè¦é™ä½ç½‘ç«™å®‰å…¨æ€§æ‰èƒ½ä½¿ç”¨ (å› ä¸ºä¼šå˜æˆ mycacher:// å‘é€è¯·æ±‚æ‰“ http://zhgchg.li/xxxï¼Œä¸åŒæº)


- å¯èƒ½éœ€è¦è‡ªå·±å®ç° Cache Policyï¼Œä¾‹å¦‚é‚£ä½•æ—¶è¯¥æ›´æ–°ï¼Ÿæœ‰æ•ˆå¤šä¹…ï¼Ÿ **(è¿™å°±è·Ÿ HTTP Cache åœ¨åšçš„äº‹ä¸€æ ·äº†)**



> ***ç»¼åˆä»¥ä¸Šï¼Œè™½ç„¶åŸç†ä¸Šå¯è¡Œï¼Œä½†æ˜¯å®ç°ä¸ŠæŠ•å…¥å·¨å¤§ï¼›æ•´ä½“æ¥è¯´ä¸ç¬¦åˆæ•ˆç›Šå¹¶ä¸”å¾ˆéš¾æ‰©å……è·Ÿä¿æŒç¨³å®šæ€§*** *ğŸ˜•*



æ„Ÿè§‰ WKURLSchemeHandler è¿™æ–¹æ³•æ¯”è¾ƒé€‚åˆé’ˆå¯¹ç½‘é¡µå†…æœ‰å¾ˆå¤§çš„èµ„æºæ¡£æ¡ˆéœ€è¦ä¸‹è½½ï¼Œå®£å‘Šä¸€ä¸ªè‡ªè®¢çš„ Scheme ä¸¢ç»™ App å»å¤„ç†ï¼Œäº’ç›¸åˆä½œæ¸²æŸ“å‡ºç½‘é¡µã€‚



#### æ¡¥æ¥ WKWebView ç½‘è·¯è¯·æ±‚æ”¹ç”± App å‘é€ ğŸ«¥



WKWebView æ”¹æˆæ‰“ App å®šå¥½çš„æ¥å£ (WkUserScript) æ›¿ä»£ Ajax, XMLHttpRequest, Fetchï¼Œç”± App å»è¯·æ±‚èµ„æºã€‚



> *ä»¥æ­¤æ¡ˆä¾‹å¸®åŠ©ä¸å¤§ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€ä¸ªç”»é¢å‡ºç°çš„æ—¶é—´å¤ªæ…¢ï¼Œè€Œä¸æ˜¯åç»­åŠ è½½å¤ªæ…¢ï¼›å¹¶ä¸”æ­¤æ–¹æ³•ä¼šé€ æˆ Web x App æœ‰è¿‡æ·±æ ¹å¥‡æ€ªçš„ä¾èµ–å…³ç³» ğŸ«¥*



### ä» Service Worker ä¸‹æ‰‹ *âŒ*



> *åŸºäºå®‰å…¨æ€§é—®é¢˜ï¼Œåªæœ‰è‹¹æœè‡ªå·±çš„ Safari App æ”¯æ´ï¼ŒWKWebView ä¸æ”¯æ´âŒã€‚*



### WKWebView æ€§èƒ½ä¼˜åŒ– ğŸ«¥



ä¼˜åŒ–æå‡ WKWebView Load View çš„æ€§èƒ½ã€‚



> *WKWebView æœ¬èº«åƒæ˜¯éª¨æ¶ã€Web é¡µé¢æ˜¯è¡€è‚‰ï¼Œç ”ç©¶ä¸‹æ¥ä¼˜åŒ–éª¨æ¶(e.g. å¤ç”¨ WKProcessPool)çš„æ•ˆæœå¾ˆæœ‰é™ï¼Œå¯èƒ½æ˜¯ 0.0003 -&gt; 0.000015 ç§’çš„åŒºåˆ«ã€‚*



### Local HTML, Local èµ„æºæ¡£æ¡ˆ ğŸ«¥



ç±»ä¼¼ Preload æ–¹å¼ï¼Œåªæ˜¯æ”¹æˆå°†æ´»åŠ¨é¡µæ”¾å…¥ App Bundle æˆ–æ˜¯å¯åŠ¨æ—¶ä»è¿œç«¯æ‹¿ã€‚



> *æ”¾æ•´ä¸ª HTML é¡µé¢å¯èƒ½ä¹Ÿä¼šé‡åˆ° CORS åŒæºé—®é¢˜ï¼›çº¯æ”¾ç½‘é¡µèµ„æºæ¡£æ¡ˆæ„Ÿè§‰å¯ä»¥ä½¿ç”¨ ã€Œå®Œå–„ HTTP Cache + WKWebView Preload çº¯èµ„æºã€æ–¹å¼å–ä»£ï¼›æ”¾ App Bundle å¾’å¢ App Sizeã€ä»è¿œç«¯æ‹¿å°±æ˜¯ WKWebView Preload ğŸ«¥*



### å‰ç«¯ä¼˜åŒ–ä¸‹æ‰‹ ğŸ‰ğŸ‰ğŸ‰



![[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"}](/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.png)



[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"}



å‚è€ƒ [wedevs ä¼˜åŒ–å»ºè®®](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"} ï¼Œå‰ç«¯ HTML é¡µé¢åº”è¯¥ä¼šæœ‰å››ä¸ªè½½å…¥é˜¶æ®µï¼Œä»ä¸€å¼€å§‹è½½å®Œé¡µé¢æ¡£æ¡ˆ ( .html) First Paint (ç©ºç™½é¡µ) åˆ° First Contentful Paint (æ¸²æŸ“å‡ºé¡µé¢éª¨æ¶) å†åˆ° First Meaningful Paint (è¡¥ä¸Šé¡µé¢å†…å®¹) åˆ° Time To Interactive(æœ€åå¯è®©ä½¿ç”¨è€…äº’åŠ¨)ã€‚



![](/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.png)



ç”¨æˆ‘ä»¬çš„é¡µé¢æµ‹è¯•ï¼›æµè§ˆå™¨ã€WKWebView ä¼šå…ˆè¯·æ±‚é¡µé¢æœ¬ä½“ .html å†è½½å…¥éœ€è¦ç”¨åˆ°çš„èµ„æºï¼ŒåŒæ—¶ä¾ç…§ç¨‹å¼æŒ‡å¼•æ„å»ºå‡ºç”»é¢ç»™ä½¿ç”¨è€…ï¼Œå¯¹æ¯”æ–‡ç« å‘ç°é¡µé¢é˜¶æ®µå…¶å®åªæœ‰ First Paint (ç©ºç™½)åˆ° Time To Interactive (First Contentful Paint åªæœ‰ Navigation Bar åº”è¯¥ä¸å¤ªç®—â€¦)ï¼Œå°‘äº†ä¸­é—´çš„åˆ†é˜¶æ®µæ¸²æŸ“ç»™ä½¿ç”¨è€…ï¼Œå› æ­¤ä½¿ç”¨è€…æ•´ä½“ç­‰å¾…æ—¶é—´ä¼šæ‹‰é•¿ã€‚



> *å¹¶ä¸”ç›®å‰åªæœ‰èµ„æºç±»çš„æ¡£æ¡ˆæœ‰è®¾å®š HTTP Cacheï¼Œé¡µé¢æœ¬ä½“æ²¡æœ‰ã€‚*



å¦å¤–ä¹Ÿå¯ä»¥å‚è€ƒ [Google PageSpeed Insights](https://pagespeed.web.dev/){:target="_blank"} å»ºè®®è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚å‹ç¼©ã€å‡å°‘è„šæœ¬å¤§å°. .ç­‰ç­‰



![](/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.png)



> *å› ä¸º in-app WKWebView çš„æ ¸å¿ƒè¿˜æ˜¯ Web é¡µé¢æœ¬èº«ï¼›å› æ­¤ä»å‰ç«¯ç½‘é¡µä¸‹æ‰‹è°ƒæ•´æ˜¯ä¸ªå¾ˆå¥½çš„å››ä¸¤æ‹¨åƒæ–¤æ–¹å¼ ã€‚ğŸ‰ğŸ‰ğŸ‰*



### ä½¿ç”¨è€…ä½“éªŒä¸‹æ‰‹ ğŸ‰ğŸ‰ğŸ‰



![](/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.png)



> *ä¸€ä¸ªç®€å•çš„å®ç°ï¼Œä»ä½¿ç”¨è€…ä½“éªŒä¸‹æ‰‹ï¼Œå¢åŠ  Loading Progress Barï¼Œä¸è¦åªå±•ç¤ºç©ºç™½é¡µé¢è®©ä½¿ç”¨è€…ä¸çŸ¥æ‰€æªï¼Œè®©ä»–çŸ¥é“é¡µé¢æ­£åœ¨åŠ è½½ä¸­å¹¶ä¸”è¿›åº¦åˆ°å“ªé‡Œã€‚ğŸ‰ğŸ‰ğŸ‰*



### ç»“è®º



ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡æ¢ç©¶ WKWebView é¢„è½½ä¸ç¼“å­˜å¯è¡Œæ–¹æ¡ˆçš„ä¸€äº›å‘æƒ³ç ”ç©¶ï¼ŒæŠ€æœ¯åè€Œä¸æ˜¯æœ€å¤§çš„é—®é¢˜ï¼Œé‡ç‚¹è¿˜æ˜¯é€‰æ‹©ï¼Œå“ªäº›æ–¹å¼æ‰æ˜¯å¯¹ä½¿ç”¨è€…æœ€æœ‰æ•ˆå¯¹å¼€å‘ç«¯æŠ•å…¥æˆæœ¬æœ€ä½çš„æ–¹æ¡ˆï¼Œé€‰æ‹©è¿™äº›æ–¹å¼å¯èƒ½å°å°æ”¹äº†äº›åœ°æ–¹å°±èƒ½ç›´æ¥è¾¾æˆç›®æ ‡ï¼›é€‰æ‹©é”™è¯¯çš„æ–¹å¼ä¼šå¯¼è‡´æŠ•å…¥å·¨å¤§çš„èµ„æºç»•åœˆåœˆå¹¶ä¸”å¾ˆæœ‰å¯èƒ½åœ¨åç»­éš¾ä»¥ç»´æŠ¤è·Ÿä½¿ç”¨ã€‚



> *åŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œæœ‰æ—¶å€™æ˜¯ç¼ºå°‘æƒ³åƒã€‚*



è¯´ä¸å®šä¹Ÿæœ‰æˆ‘æ²¡æƒ³åˆ°çš„ç¥çº§ç»„åˆåšæ³•ï¼Œæ¬¢è¿å¤§å®¶ååŠ©è¡¥å……ã€‚



### å‚è€ƒèµ„æ–™



#### WKWebView Preload çº¯èµ„æºğŸ‰ æ–¹æ¡ˆå¯å‚è€ƒä»¥ä¸‹å½±ç‰‡



<iframe class="embed-video" loading="lazy" src="https://www.youtube.com/embed/ZQvyfFieBfs" title=""Preload strategies using WKWebView" by JonatÃ¡n Urquiza" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>



å¦å¤–ä½œè€…ä¹Ÿæœ‰æåˆ° WKURLSchemeHandler çš„æ–¹æ³•ã€‚



**å½±ç‰‡ä¸­çš„å®Œæ•´ Demo Repo å¦‚ä¸‹ï¼š**



[![](https://opengraph.githubassets.com/6789eaaf4d4f56f69df9d39e4abae4a910b10da24a14ff934a367da52fbde78c/jonurq/preload-strategies-wkwebview)](https://github.com/jonurq/preload-strategies-wkwebview){:target="_blank"}



#### iOS è€å¸æœºå‘¨æŠ¥



[![](https://repository-images.githubusercontent.com/115476023/2a31ab00-183a-11eb-889c-b9674f419108)](https://github.com/SwiftOldDriver/iOS-Weekly/issues?q=WkWebView){:target="_blank"}



è€å¸æœºå‘¨æŠ¥ä¸­å…³äº WkWebView çš„åˆ†äº«ä¹Ÿå€¼å¾—ä¸€çœ‹ã€‚



### æ‚è°ˆ



ä¹…è¿çš„å›å½’æ’°å†™ iOS å¼€å‘ç›¸å…³é•¿ç¯‡æ–‡ç« ã€‚



æœ‰ä»»ä½•é—®é¢˜åŠæŒ‡æ•™æ¬¢è¿ [ä¸æˆ‘è”ç»œ](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



*[Post](https://medium.com/zrealm-ios-dev/ios-wkwebview-%E9%A0%81%E9%9D%A2%E8%88%87%E6%AA%94%E6%A1%88%E8%B3%87%E6%BA%90-preload-%E9%A0%90%E8%BC%89-cache-%E7%B7%A9%E5%AD%98%E7%A0%94%E7%A9%B6-5033090c18ba){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}.*