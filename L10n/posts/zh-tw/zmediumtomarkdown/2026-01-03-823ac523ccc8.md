---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2026-01-03T17:03:46.382+0000
description: ä»‹ç´¹ Certificates, Identifiers & Profiles ä¹‹é–“çš„é—œä¿‚èˆ‡ä½¿ç”¨ Fastlane Match çµ±ä¸€ç®¡ç†ç°½ç™¼æ†‘è­‰ä¸¦æ•´åˆé€²
  CI/CD å·¥ä½œæµç¨‹çš„ç´€éŒ„ã€‚
image:
  path: /assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg
last_modified_at: 2026-01-05T00:55:47.972+0000
render_with_liquid: false
tags:
- ios-app-development
- fastlane
- keychain
- github-actions
- macos
title: iOS Certificates, Identifiers & Profiles æ˜¯ä»€éº¼åŠ Fastlane Match çµ±ä¸€ç®¡ç†æ†‘è­‰èˆ‡ CI/CD
  çš„ä¸€äº›ç­†è¨˜
---

### iOS Certificates, Identifiers & Profiles æ˜¯ä»€éº¼åŠ **Fastlane Match çµ±ä¸€** ç®¡ç† **æ†‘è­‰èˆ‡ CI/CD çš„ä¸€äº›ç­†è¨˜**

ä»‹ç´¹ Certificates, Identifiers & Profiles ä¹‹é–“çš„é—œä¿‚èˆ‡ä½¿ç”¨ Fastlane Match çµ±ä¸€ç®¡ç†ç°½ç™¼æ†‘è­‰ä¸¦æ•´åˆé€² CI/CD å·¥ä½œæµç¨‹çš„ç´€éŒ„ã€‚



![Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/823ac523ccc8/1*-OS8G9xu0CFpnlAQRgnGAg.jpeg)

Photo by [marcos mayer](https://unsplash.com/@mmayyer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}
#### å‰è¨€

2025 å¹´ä¸­æ™‚å¯«éä¸€ç³»åˆ—å¾ 0 åˆ° 1 ä½¿ç”¨ GitHub Actions å»ºç½® App CI/CD å®Œæ•´æµç¨‹çš„æ–‡ç« ï¼š
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€éº¼ï¼Ÿå¦‚ä½•é€é CI/CD æ‰“é€ ç©©å®šé«˜æ•ˆçš„é–‹ç™¼åœ˜éšŠï¼Ÿå·¥å…·é¸æ“‡ï¼Ÿ](../c008a9e8ceca/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆäºŒï¼‰ï¼šGitHub Actions èˆ‡ self\-hosted Runner ä½¿ç”¨èˆ‡å»ºç½®å¤§å…¨](../404bd5c70040/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šä½¿ç”¨ GitHub Actions å¯¦ä½œ App å°ˆæ¡ˆçš„ CI èˆ‡ CD å·¥ä½œæµç¨‹](../4b001d2e8440/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆå››ï¼‰ï¼šä½¿ç”¨ Google Apps Script Web App ä¸²æ¥ GitHub Actions å»ºç½®å…è²»æ˜“ç”¨çš„æ‰“åŒ…å·¥å…·å¹³å°](../4273e57e7148/)


æœ€è¿‘åˆ°æ–°ç’°å¢ƒåˆé‡æ–°è·‘äº†ä¸€æ¬¡ï¼Œæ¯æ¬¡éƒ½æœ‰å­¸ç¿’åˆ°æ–°çš„æ±è¥¿ï¼Œé€™æ¬¡èšç„¦åœ¨ iOS Codesigningï¼šCertificates / Profiles / Devices çš„é—œä¿‚ï¼Œèˆ‡æˆ‘å¦‚ä½•ç”¨ Fastlane Match æŠŠæ†‘è­‰ç®¡ç†èˆ‡ CI/CD ä¸²èµ·ä¾†ã€‚
### [Certificates, Identifiers & Profiles, Devices æ˜¯ä»€éº¼ï¼Ÿ](https://developer.apple.com/account/resources/certificates/list){:target="_blank"}

åœ¨ Apple ç”Ÿæ…‹ç³»ä¸­ï¼ŒApp é–‹ç™¼æ˜¯åŸºæ–¼æ†‘è­‰èˆ‡æè¿°æª”æ§ç®¡çš„ï¼Œè·Ÿ Android åªè¦æœ‰ \.apk å°±èƒ½å®‰è£ä½¿ç”¨ä¸åŒï¼›Apple æœ‰åš´æ ¼çš„æ†‘è­‰å°æ‡‰ç®¡åˆ¶ï¼Œä¸ç¬¦åˆè¦å‰‡å°±ä¸èƒ½å®‰è£ã€ä½¿ç”¨ã€‚
#### **ä¸»è¦é …ç›®çµ„æˆåŠåŠŸèƒ½ï¼š**


![](/assets/823ac523ccc8/1*PyM0l-jXXcVBKubOwCiTsw.png)

#### **Certificates:** ç°½ç½² App çš„èº«åˆ† \(Signing Identity\)
- **Development** â€” é–‹ç™¼éšæ®µè·‘åœ¨å¯¦é«”æ©Ÿä¸Šä½¿ç”¨\(åªè·‘æ¨¡æ“¬å™¨ä¸ç”¨æ†‘è­‰\)ï¼Œæ‰€å±¬æ˜¯äººæˆ– API Key \(æœ‰æ•¸é‡é™åˆ¶\)ã€‚
- **Distribution** â€” æ‰“åŒ…ä¸Š AppStore, TestFlight æˆ–æ˜¯ Ad Hoc å…§æ¸¬\(é™å®šå·²è¨»å†Šè£ç½®\)ä½¿ç”¨ï¼Œæœ‰æ•¸é‡é™åˆ¶ï¼Œæ‰€å±¬æ˜¯ Teamã€‚
- **Enterprise** â€” ä¼æ¥­å…§éƒ¨ App ä½¿ç”¨ã€‚



> **_æ ¼å¼_** _ï¼šéœ€è¦æœ‰ `Private Key (ç§é‘°)` åŠ  `Certificate .cer (å…¬é‘°æ†‘è­‰)` æ‰èƒ½ä½¿ç”¨ï¼Œæˆ–æ˜¯åœ¨åŸå‰µå»ºé›»è…¦ä¸Šçš„ Keychain åŒ¯å‡ºæˆ `.p12` æª”æ¡ˆå°±æœƒåŒæ™‚åŒ…å«ã€‚_ 






![](/assets/823ac523ccc8/1*oP_p2kJ1Prqku4D8LIZ7yg.png)

#### **Identifiers: å“ªä¸€å€‹ App/Extension \(Bundle ID\)**

App çš„ Bundle ID è¨»å†Šè·Ÿéœ€è¦å•Ÿç”¨çš„ Capabilities\(ä¾‹å¦‚å•Ÿç”¨ Push Notifications, App Groupsâ€¦\)ã€App Servicesã€‚

Extension ä¹Ÿæœƒæœ‰è‡ªå·±çš„ Identifierã€‚
#### **Devices: å·²è¨»å†Šè£ç½® \(iPhone/iPad\. \. \)**

Development è·‘åœ¨å¯¦é«”æ©Ÿä¸Šè·Ÿ Distribution Ad Hoc å…§æ¸¬åªæœ‰è¨»å†Šçš„è£ç½®æ‰èƒ½ä½¿ç”¨ã€‚


> **_ä¸Šé™ï¼š100 å€‹ï¼›åŒ…å«å–æ¶ˆï¼Œè¦ç­‰åˆ°æ¯å¹´ä»˜è²»é€±æœŸæ‰æœƒé‡æ–°åˆ·æ–°é‡‹å‡ºé¡åº¦ã€‚_** 




#### **Provisioning Profile \(ä»¥ä¸‹ç°¡ç¨± Profile\): æè¿°æª”**

çµ„åˆ Certificates\+Identifiers\+Devices é—œä¿‚ã€‚
- **Development** â€” é–‹ç™¼éšæ®µä½¿ç”¨çš„æè¿°æª”ï¼Œå¦‚æœè¦è·‘å¯¦é«”æ©Ÿæ¸¬è©¦å°±å¿…é ˆä½¿ç”¨ï¼Œæè¿°æª”åŒ…å« Certificates\+Identifiers\+Devices ä¹‹é–“çš„é—œä¿‚ã€‚
- **Ad Hoc** â€”æ‰“åŒ…çµ¦å…§éƒ¨æ¸¬è©¦ä½¿ç”¨\(e\.g\. Deploy to Firebase App Distribution\)çš„æè¿°æª”ï¼Œæè¿°æª”åŒ…å« Certificates\+Identifiers\+Devices ä¹‹é–“çš„é—œä¿‚ã€‚
- **App Store** â€” æ‰“åŒ…ä¸Šå‚³åˆ° App Store / TestFlight ä½¿ç”¨çš„æè¿°æª”ï¼Œæè¿°æª”åŒ…å« Certificates\+Identifiers ä¹‹é–“çš„é—œä¿‚ã€‚



> _æ ¼å¼ï¼š `.mobileprovision`_ 
 

> _**è¦æ³¨æ„ï¼šProfile åªæ˜¯æè¿°æª”ï¼Œæè¿°é—œä¿‚ï¼Œä¸æœƒåŒ…å«æ†‘è­‰æœ¬é«”ã€‚**_ 




#### å°çµ

ç¶œåˆä»¥ä¸Šï¼Œå¦‚æœè¦åœ¨ä¸€å°ä¹¾æ·¨çš„æ©Ÿå™¨ã€ä¸ç™»å…¥ Xcode Apple Account çš„æƒ…æ³ä¸‹è¦èƒ½ Build å¯¦é«”æ©Ÿ \(Development Certificate\) æˆ–æ˜¯åŸ·è¡Œ Archive æ‰“åŒ… \(Distribution Certificate\)ï¼Œ **å¿…é ˆè¦æœ‰å…©å€‹æª”æ¡ˆ** ï¼š
- `.mobileprovision` Provisioning Profile æè¿°æª”: æè¿°Certificates\+Identifiers\+Devices é—œä¿‚ã€‚
- `.p12` Certificate: æ†‘è­‰çš„å¯¦é«” \(å¾åŸå‰µå»º Certificate çš„é›»è…¦åŒ¯å‡º\)ã€‚


**å¦å¤– macOS â‰¥ 15 å¾Œçš„ Keychain ç§»å‹•åˆ°ï¼š**
```bash
open /System/Library/CoreServices/Applications/Keychain\ Access.app
```

_æ‰¾äº†è¶…ä¹…\. \._
#### å¸¸è¦‹éŒ¯èª¤

**âš ï¸âš ï¸âš ï¸ ç¢ºå®šæ†‘è­‰ã€Profile éƒ½æ­£ç¢ºä½†æ€éº¼æ¨£éƒ½å ±éŒ¯:**


> _å¤šåŠæ˜¯ä½ é‚„æ®˜å­˜æœ‰ä¹‹å‰çš„æ†‘è­‰ã€å¤šå¼µæ†‘è­‰ï¼ŒXcode æœƒéŒ¯äº‚ã€‚_ 
 

> _**é€™å•é¡Œå¾ˆå¸¸æœƒé‡åˆ°ï¼**_ 




1. é—œé–‰ Xcode
2. æ‰“é–‹ macOS keychain: `open /System/Library/CoreServices/Applications/Keychain\ Access.app`
3. login keychain \-&gt; All items \-&gt; æœå°‹ `apple development` \-&gt; åˆªé™¤æ‰€æœ‰ Certificates æ†‘è­‰
4. Finder \-&gt; Go \-&gt; Go to \-&gt; `~/Library/MobileDevice/Provisioning\ Profiles` \-&gt; åˆªé™¤æ‰€æœ‰ Profiles æè¿°æª”
5. é‡æ–°æ‹‰å–æ†‘è­‰
6. é‡é–‹ Xcode æ‡‰è©²å°±æ­£å¸¸äº†


**No signing certificate â€œiOS Distributionâ€ found / No signing certificate â€œiOS Developmentâ€ found\.:**
```vbnet
No "iOS Distribution" signing certificate matching team ID "" with a private key was found.
No "iOS Development" signing certificate matching team ID "" with a private key was found.
```

**åŸå› :**
- ç¼ºå°‘ iOS Distribution/iOS Development Certificate æ†‘è­‰
- æœ‰ iOS Distribution/iOS Development Certificate æ†‘è­‰ **ä½†æ˜¯ æ²’æœ‰å°æ‡‰çš„ Private Key ç§é‘°**


**è§£æ±ºè¾¦æ³•:**
- åˆªé™¤ Keychain è£¡çš„æ‰€æœ‰èˆŠ Certificates æ†‘è­‰ã€Profiles æè¿°æª”
- åœ¨ç•¶åˆå‰µå»º Certificate çš„é›»è…¦ Keychain ä¸Šæ‰¾åˆ°è©²æ†‘è­‰ï¼ŒåŒ¯å‡ºæˆ `.p12` æ ¼å¼ï¼Œåœ¨æœ‰å•é¡Œé›»è…¦ä¸Šå®‰è£ã€‚
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Revoke èˆŠçš„ Certificateï¼Œé‡æ–°ç”¢ç”Ÿ
\(æ”¾å¿ƒï¼Œä¸å½±éŸ¿ç·šä¸Šç‰ˆ Appï¼›åªå½±éŸ¿é–‹ç™¼èˆ‡æ‰“åŒ…éšæ®µ\)


**Provisioning profile â€œâ€ doesnâ€™t include signing certificate â€œApple Development: XXXâ€\. / Provisioning profile â€œâ€ doesnâ€™t include signing certificate â€œApple Distribution: XXXâ€\.:**

**åŸå› :**
- ç›®å‰é¸æ“‡çš„ Provisioning profile æè¿°æª”è·Ÿç•¶å‰çš„ Certificate æ²’æœ‰å°æ‡‰é—œä¿‚


**è§£æ±ºè¾¦æ³•:**
- åˆªé™¤ Keychain è£¡çš„æ‰€æœ‰èˆŠ Certificates æ†‘è­‰ã€Profiles æè¿°æª”
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ç¢ºèªæè¿°æª”æœ‰å‹¾é¸å°æ‡‰æ†‘è­‰æˆ–é‡ç”¢ Profile ä½¿ç”¨


**No profile for team â€˜â€™ matching â€˜â€™ found: Xcode couldnâ€™t find any provisioning profiles matching â€˜â€™\.:**

**åŸå› :**
- æ‰¾ä¸åˆ°æŒ‡å®šçš„ Provisioning profile æè¿°æª”


**è§£æ±ºè¾¦æ³•:**
- åˆªé™¤ Keychain è£¡çš„æ‰€æœ‰èˆŠ Certificates æ†‘è­‰ã€Profiles æè¿°æª”
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ä¸‹è¼‰å°æ‡‰çš„ Profile ä½¿ç”¨


**Provisioning profile â€œâ€ has app ID â€œâ€, which does not match the bundle ID â€œâ€\. / Provisioning profile doesnâ€™t match the bundle identifier:**

**åŸå› :**
- Provisioning profile ä¸åŒ…å«ç›®å‰çš„ Bundle Identifier


**è§£æ±ºè¾¦æ³•:**
- åˆªé™¤ Keychain è£¡çš„æ‰€æœ‰èˆŠ Certificates æ†‘è­‰ã€Profiles æè¿°æª”
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Identifiers ç¢ºèª Bundle Identifier å·²è¨»å†Š
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles ä¸‹è¼‰å°æ‡‰çš„ Profile ä½¿ç”¨


**Provisioning profile â€œâ€ doesnâ€™t include the currently selected device â€œâ€ \(identifier \) \.:**

**åŸå› :**
- Provisioning profile ä¸åŒ…å«é¸æ“‡çš„å¯¦é«”æ©Ÿ Device Identifier


**è§£æ±ºè¾¦æ³•:**
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Devices ç¢ºèªå¯¦é«”æ©Ÿçš„ Identifier å·²è¨»å†Š
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} Profiles å°æ‡‰çš„ Profile è©² å¯¦é«”æ©Ÿ æœ‰å‹¾é¸å•Ÿç”¨ã€‚
- é‡æ–°ä¸‹è¼‰ Profile ä½¿ç”¨


**Could not create another Development/Distribution certificate, reached the maximum number of available Development/Distribution certificates\. :**

**åŸå› :**

ä»£è¡¨å»ºç«‹çš„ Development/Distribution Certificate å·²é”ä¸Šé™æ•¸é‡ã€‚

**è§£æ±ºè¾¦æ³•:**
- åˆ° [Certificates, Identifiers & Profiles](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} åˆªé™¤ä¸ä½¿ç”¨çš„æ†‘è­‰ã€‚


**Xcode æ†‘è­‰æ­£ç¢ºä¸”å¯ä»¥æ­£å¸¸æ‰“åŒ…ä½†æ˜¯ç”¨ CLI \(Fastlane\) åŸ·è¡Œæ‰“åŒ…å‘½ä»¤æœƒå‡ºç¾ç°½åéŒ¯èª¤:**

**åŸå› :**

é€™é‚Šé‚„æœ‰è¸©åˆ°å¦ä¸€å€‹é›·ï¼Œå°±æ˜¯æˆ‘æ‰‹è³¤æŠŠå°ˆæ¡ˆæ”¾åœ¨ iCloud åŒæ­¥ç›®éŒ„ä¸‹ï¼Œä¸çŸ¥é“ç‚ºä½•Fastlane æœƒä¸€ç›´å‡ºç¾æ†‘è­‰å•é¡Œ \(ç–‘ä¼¼ keychain å­˜å–æœ‰å•é¡Œ\)ã€‚

**è§£æ±ºè¾¦æ³•:**

ç§»å‡º iCloud åŒæ­¥ç›®éŒ„å³å¯ã€‚
### æ—¥å¸¸ä½¿ç”¨çš„å•é¡Œå ´æ™¯
#### Development Certificate


![](/assets/823ac523ccc8/1*uNICvLN0a9gdGAzi4EZ24g.png)

- åœ¨å°å…¥ Match çµ±ä¸€ç®¡ç†æ†‘è­‰ä¹‹å‰ï¼Œæ¯ä½é–‹ç™¼è€…éƒ½æœƒå»ºç«‹è‡ªå·±çš„ `Development Certificate` å’Œ `Development Profile` ï¼›å‡è¨­çµ„ç¹”å…§æœ‰ 1,000\+ ä½é–‹ç™¼è€…ï¼Œåœ¨ [Certificates, Identifiers & Profiles, Devices](https://developer.apple.com/account/resources/certificates/list){:target="_blank"} å¾Œå°æœƒéå¸¸çš„æ··äº‚å¯æ€•ã€‚
- å¦‚æœæœ‰å¤–åŒ…åœ˜éšŠï¼Œåªè² è²¬é–‹ç™¼å·¥ä½œï¼Œé‚„æ˜¯éœ€è¦æŠŠä»–åŠ å…¥åˆ° Apple Developer Program å¾Œå°ï¼Œè®“ä»–ç”¢è‡ªå·±çš„é–‹ç™¼æ†‘è­‰è·Ÿ Profileã€‚

#### Distribution Certificate


![](/assets/823ac523ccc8/1*1JKlvoO8d89dlcpz2mJvjg.png)

- Distribution Certificate æ˜¯ by Team å»ºç«‹ï¼Œå› æ­¤æ¯å€‹é–‹ç™¼è€…è¨ˆåŠƒçš„ Team åªèƒ½å»ºç«‹æœ‰é™æ•¸é‡çš„ç™¼è¡Œæ†‘è­‰ã€‚
- å¸¸è¦‹åšæ³•æ˜¯ç”±ä¸€ä½å·¥ç¨‹å¸«å»ºç«‹ç”¢ç”Ÿ Distribution Certificate å†åŒ¯å‡º \.p12 æª”æ¡ˆçµ¦å…¶ä»–éœ€è¦ä¸Šæ¶çš„é–‹ç™¼è€…æˆ–æ˜¯æ”¾åˆ° CI/CD æ©Ÿå™¨ä¸Šä½¿ç”¨ã€‚
- åœ˜éšŠå¤§ã€App æ•¸é‡å¤šæ™‚è¦å¯„ä¾†å¯„å»çš„æœƒå¾ˆéº»ç…©ï¼Œè€Œä¸” **æ¯å¹´éƒ½è¦æ›´æ–°ä¸€æ¬¡**
- **æ‰“åŒ… Ad Hoc æ™‚ï¼Œç•¶æœ‰æ–°è£ç½®è¨»å†Šï¼›æ‰€æœ‰äººã€CI/CD éƒ½éœ€è¦é‡æ–°ä¸‹è¼‰ Profile æ‰èƒ½è®“æ–°è£ç½®ç”Ÿæ•ˆã€‚**

### [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"}

åŸºæ–¼ä»¥ä¸Šå•é¡Œæˆ‘å€‘å¸Œæœ›èƒ½æœ‰ä¸€å€‹å¹³å°å¹«æˆ‘å€‘ä»£ç‚ºç®¡ç†æ‰€æœ‰è·Ÿæ†‘è­‰æœ‰é—œçš„äº‹ç‰©ï¼Œæ‰€æœ‰é–‹ç™¼è€…è·Ÿ CI/CD æœå‹™éƒ½æ˜¯çµ±ä¸€å°é€™å€‹å¹³å°æ‹‰å–ã€æ›´æ–°è³‡æ–™ï¼Œé€™å€‹å¹³å°çš„å„²å­˜å¿…é ˆå®‰å…¨ï¼Œé€™å°±æ˜¯ â€” [Fastlane Match](https://docs.fastlane.tools/actions/match/){:target="_blank"} ã€‚


> _Easily sync your certificates and profiles across your team_ 





> _A new approach to iOS and macOS code signing: Share one code signing identity across your development team to simplify your codesigning setup and prevent code signing issues\._ 





> _match is the implementation of the [codesigning\.guide concept](https://codesigning.guide/){:target="_blank"} \. match creates all required certificates & provisioning profiles and stores them in a separate git repository, Google Cloud, or Amazon S3\. Every team member with access to the selected storage can use those credentials for code signing\. match also automatically repairs broken and expired credentials\. Itâ€™s the easiest way to share signing credentials across teams_ 






![](/assets/823ac523ccc8/1*UEL7Abx3PFrYbAc2yVlq8A.png)


**Fastlane Matchï¼š**
- è·Ÿ App Store Connect åšäº¤äº’ \(é€é App Store Connect API or Apple Developer Login Session\)ï¼Œç”¢ç”Ÿæˆ–æ˜¯æ›´æ–°æ†‘è­‰
- æŠŠæ†‘è­‰çµæœ \( `.mobileprovision` Profiles, `.p12` Certificate, `.cer` Certificate\) ä¸‰å€‹æª”æ¡ˆåŠ å¯†ä¸Šå‚³åˆ° Git Repo \(ä¹Ÿå¯ä»¥ç”¨å…¶ä»– Storage\)
`.cer` Certificate ä¹Ÿæœƒç¨ç«‹å­˜ï¼Œå› ç‚ºé€™æ¨£æ‰èƒ½çŸ¥é“æ†‘è­‰æ˜¯å¦æœ‰æ•ˆ
- å¦‚æœè¦ç´°åˆ†æ¬Šé™å¯ä»¥åˆ†å…©å€‹ Reposï¼Œä¸€å€‹ç®¡ç† Development æ†‘è­‰ã€ä¸€å€‹ç®¡ç† Distribution æ†‘è­‰ã€‚


[**Folder structure:**](https://docs.fastlane.tools/actions/match/){:target="_blank"}
- The `certs` folder contains all certificates with their private keys
- The `profiles` folder contains all provisioning profiles



![[https://docs\.fastlane\.tools/actions/match/](https://docs.fastlane.tools/actions/match/){:target="_blank"}](/assets/823ac523ccc8/1*mStp0t3Ty3xGTKvbiBGtqw.png)

[https://docs\.fastlane\.tools/actions/match/](https://docs.fastlane.tools/actions/match/){:target="_blank"}

åŠ å¯†ç®—æ³•ï¼š [AES\-256\-GCM](https://github.com/fastlane/fastlane/blob/master/match/lib/match/encryption/encryption.rb){:target="_blank"}

**é–‹ç™¼è€…ã€CI/CD æœå‹™ï¼š**
- çµ±ä¸€ä½¿ç”¨ Fastlane match æŒ‡ä»¤æ“ä½œæ†‘è­‰ã€‚
- Fastlane Match æœƒå„ªå…ˆæ‹‰å› Git Repo çš„æ†‘è­‰æª”æ¡ˆã€è§£å¯†å›ä¾†ä½¿ç”¨ï¼Œå¦‚æœç™¼ç¾éæœŸæˆ–æ˜¯ç„¡æ³•ä½¿ç”¨ï¼Œæœ‰æ¬Šé™\(Create/Write\)çš„æƒ…æ³ä¸‹æœƒè‡ªå‹•é‡æ–°ç”¢ç”Ÿä¸¦ Push å›å» Repoï¼›è‹¥åªæœ‰ Read æ¬Šé™å‰‡å ±éŒ¯ã€‚


**Create/Writeï¼š**
- åªæœ‰è² è²¬ç®¡ç†æ†‘è­‰çš„äººå¯ä»¥ç”¢ç”Ÿ/æ›´æ–°ã€Push ä¸Šå‚³æ†‘è­‰
- **é‡è¦çš„ Distribution Certificate æœ€å¥½æ”¾åœ¨ç¨ç«‹ Repo ä¸”åªæœ‰ CI/CD æœå‹™æˆ–ç®¡ç†è€…å¯ä»¥ä½¿ç”¨**


**Read:**
- å…¶ä»–é–‹ç™¼è€…ã€CI/CD æœå‹™éƒ½ **åªæœ‰è®€å–** Pull æ†‘è­‰æ¬Šé™
- CI/CD æœå‹™æœƒåœ¨æ¯æ¬¡åŸ·è¡Œä»»å‹™å‰æ‹‰å–æœ€æ–°æ†‘è­‰
- æ‰€æœ‰äººå…±ç”¨åŒä¸€å¼µ Development & Distribution Certificate
- äººå“¡ç•°å‹•å¾Œæœƒå¤±å» Match Repo æ¬Šé™ï¼Œå¯ä»¥ Revoke èˆŠçš„æ†‘è­‰é‡æ–°ç”¢ç”Ÿï¼Œå…¶ä»–äººåœ¨é‡æ–° Pull å°±å¥½\(å¦‚æœæœ‰æ•´åˆåˆ° make project script é‚£æ›´ç„¡ç—›\)

### Fastlane Match è¨­å®šèˆ‡ä½¿ç”¨

æˆ‘å€‘ä»¥ Git Storage ç‚ºä¾‹ï¼Œæ‰€æœ‰æ†‘è­‰ã€‚

**1\.å»ºç«‹ä¸€å€‹ç©ºçš„å„²å­˜æ†‘è­‰çš„ Git Private Match Repo** 
é›–ç„¶æ‰€æœ‰ Certificates, Profiles éƒ½æœƒåŠ å¯†å„²å­˜ï¼Œä½†é‚„æ˜¯è¦è¨­å®šå¥½è©² Repo çš„å­˜å–æ¬Šé™ã€‚

2\.ç¢ºèªæœ¬åœ°æœ‰è¨­å®šå¥½ Git SSH å­˜å–æ¬Šé™ï¼Œå¯ä»¥ä½¿ç”¨ `git clone git@github.com:xxx/certificates.git`


> _é€™é‚Šå»ºè­° **çµ±ä¸€éƒ½ä½¿ç”¨ SSH Git Clone Repo** ï¼Œå› ç‚º CI/CD ä¹Ÿæœƒä½¿ç”¨ç›¸åŒçš„æ–¹å¼ã€‚_ 
 

> _å¦‚æœåŸ·è¡Œ fastlane match ä¸€ç›´å¡åœ¨ `If cloning the repo takes too long, you can use the `clone_branch_directly` option in match.` å¤šåŠå°±æ˜¯é‡åˆ° SSH æ¬Šé™å•é¡Œã€‚_ 





3\. åœ¨å°ˆæ¡ˆç›®éŒ„åŸ·è¡Œ `bundle exec fastlane match init` å®Œæˆè¨­å®š
```lua
[21:54:32]: fastlane match supports multiple storage modes, please select the one you want to use:
1. git
2. google_cloud
3. s3
4. gitlab_secure_files
# è¼¸å…¥ 1 ç”¨ git
?   1

[22:04:40]: Please create a new, private git repository to store the certificates and profiles there
[22:04:40]: URL of the Git Repo: git@github.com:xxx/certificates.git
# è¼¸å…¥ä½ å»ºç«‹çš„ Git Private Match Repo SSH URL

[22:04:47]: Successfully created './fastlane/Matchfile'. You can open the file using a code editor.
[22:04:47]: You can now run `fastlane match development`, `fastlane match adhoc`, `fastlane match enterprise` and `fastlane match appstore`
[22:04:47]: On the first run for each environment it will create the provisioning profiles and
[22:04:47]: certificates for you. From then on, it will automatically import the existing profiles.
[22:04:47]: For more information visit https://docs.fastlane.tools/actions/match/
```

4\.å®Œæˆå¾Œæœƒç”¢ç”Ÿä¸€å€‹ **`fastlane/Matchfile` :**
```bash
# ä½ çš„ Git Private Match Repo SSH URL
git_url("git@github.com:xxxx/certificates.git")

storage_mode("git")

type("development") # The default type, can be: appstore, adhoc, enterprise or development

# app_identifier(["tools.fastlane.app", "tools.fastlane.app2"])
# username("user@fastlane.tools") # Your Apple Developer Portal username

# For all available options run `fastlane match --help`
# Remove the # in the beginning of the line to enable the other options

# The docs are available on https://docs.fastlane.tools/actions/match
```

**5\. ç”¢ç”Ÿ [App Store Connect API \.p8 Key](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"}** ï¼Œ **çµ±ä¸€ä½¿ç”¨ API Key ç”¢ç”Ÿæ†‘è­‰:**


![](/assets/823ac523ccc8/1*RFhS_XtZ3TfIJBAeoE-laA.png)



> _âš ï¸ï¸ï¸ï¸ [**App Store Connect API \.p8 Key**](https://developer.apple.com/documentation/appstoreconnectapi/creating-api-keys-for-app-store-connect-api){:target="_blank"} **çš„æ¬Šé™å¾ˆå¤§** ï¼Œé™¤äº†å¯ä»¥ç®¡ç†æ†‘è­‰ã€ä¹Ÿå¯ä»¥ç®¡ç† App çš„ä¸Šæ¶ã€é€å¯©ï¼Œé‚„æœ‰å¾Œå°ä½¿ç”¨è€…è·Ÿè©•è«–ã€è²¡å‹™æ•¸æ“šå ±è¡¨ã€‚_ 





> _è¦ä¸è¦é€²åˆ°åœ˜éšŠçš„ \.git è®“å¤§å®¶éƒ½èƒ½å­˜å–ï¼Œå¯ä¾ç…§åœ˜éšŠæƒ…å¢ƒè‡ªè¡Œæ±ºå®šã€‚_ 
 

> _**æ¯”è¼ƒé«˜é¢¨æ§çš„æ–¹å¼æ˜¯åªæœ‰è² è²¬ç®¡ç†çš„äººè·ŸåŠ å¯†å„²å­˜åœ¨ CI/CD ä¸Šä½¿ç”¨\(æ–‡å¾Œæœƒä»‹ç´¹\)ã€‚**_ 





> **_é€™é‚Šç‚ºäº† Demo æ–¹ä¾¿ç›´æ¥æ”¾é€² fastlane ç›®éŒ„ä¸‹å­˜å–ã€‚_** 
 

> **_å¦å¤–æœ¬ç¯‡çš„ Fastlane Script ç‚ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œä¸è€ƒæ…®é‡è¤‡ç¨‹å¼ç¢¼èˆ‡ç¨‹å¼çµæ§‹ã€‚_** 




#### æ†‘è­‰ç®¡ç†
```bash
platform :ios do
  lane :match_development do |options|
    # æ›æˆä½ çš„ App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    type = options.fetch(:type, "development")
    isRead = options.fetch(:isRead, true)
    if isRead 
      readonly = true
      force = false
    else
      readonly = false
      force = true

      # éœ€è¦ App Store Connect API Key æ‰æœ‰æ¬Šé™å» Apple å¾Œå°ç®¡ç†æ†‘è­‰
      # å‡è¨­ App Store Connect API .p8 Key åœ¨ ./fastlane/ ç›®éŒ„å…§
      app_store_connect_api_key(
        key_id: "XXXXXX",
        issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
        key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
      )
    end

    # æ‹‰å– app_identifier çš„ Development æ†‘è­‰
    match(
      type: type,
      app_identifier: app_identifier, 
      readonly: readonly, # èƒ½å¦å¾æœ‰éœ€è¦æ™‚ï¼Œæ›´æ–°ã€ä¸Šå‚³ cert / profile
      force: force # è¦ä¸è¦ç„¡æ¢ä»¶é‡å»º provisioning profile
    )
  end
end
```

**å»ºç«‹ Development Certificate & Profile ä¸¦ä¸Šå‚³åˆ° Match Repo:**
```
bundle exec fastlane match_development type:development isRead:false
```
- æ²’æœ‰éŒ¯èª¤å°±ä»£è¡¨ Development Certificate & Profile ç”¢ç”Ÿã€å®‰è£æˆåŠŸä¸¦åŒæ­¥ Push ä¸Šå‚³åˆ° Match Repo æˆåŠŸã€‚


**é¦–æ¬¡å»ºç«‹æœƒéœ€è¦ä½ è¨­å®š `Passphrase` ï¼š**
```markdown
[23:29:12]: Enter the passphrase that should be used to encrypt/decrypt your certificates
[23:29:12]: This passphrase is specific per repository and will be stored in your local keychain
[23:29:12]: Make sure to remember the password, as you'll need it when you run match on a different machine
[23:29:12]: Passphrase for Match storage:
```
- é€™å€‹å€¼å°±æ˜¯ç”¨ä¾†åŠ å¯†ä½ çš„æ‰€æœ‰ Match Repo ä¸Šçš„æª”æ¡ˆçš„æœƒéœ€è¦ç”¨åˆ°çš„åƒè€ƒ \(passphrase \+ random salt\)
- å»ºè­°ç”¢ç”Ÿä¸€å€‹ [éš¨æ©Ÿå­—ä¸²](https://www.random.org/strings/?num=1&len=32&digits=on&upperalpha=on&loweralpha=on&unique=on&format=html&rnd=new){:target="_blank"} è¨­å®šä¸¦è¨˜éŒ„ä¸‹ä¾†
- æ—¥å¾Œæ›´æ–°æˆ–æ˜¯å…¶ä»–äººæ‹‰å– Match Repo æ†‘è­‰éƒ½éœ€è¦è¼¸å…¥é€™å€‹ å­—ä¸² è§£å¯†å›åŸå§‹æª”æ¡ˆã€‚


**åœ˜éšŠå…¶ä»–æˆå“¡çµ±ä¸€å¾ Match Repo Pull æ‹‰å– Development Certificate & Profile:**
```bash
bundle exec fastlane match_development type:development
```

**é¦–æ¬¡ä½¿ç”¨æœƒè©¢å•ä½ çš„ç™»å…¥å¯†ç¢¼ \(login keychain\)ï¼Œå› ç‚ºè¦æŠŠæ†‘è­‰å®‰è£åˆ° keychain ä¸­ï¼Œè¼¸å…¥å…©æ¬¡ç¢ºèªå³å¯:**
```markdown
[16:52:59]: Installing certificate...
[16:53:00]: There are no local code signing identities found.
You can run security find-identity -v -p codesigning to get this output.
This Stack Overflow thread has more information: https://stackoverflow.com/q/35390072/774.
(Check in Keychain Access for an expired WWDR certificate: https://stackoverflow.com/a/35409835/774 has more info.)
[16:53:00]: Enter the password for /Users/zhgchgli/Library/Keychains/login.keychain-db
[16:53:00]: This passphrase will be stored in your local keychain with the name fastlane_keychain_login and used in future runs
[16:53:00]: This prompt can be avoided by specifying the 'keychain_password' option or 'MATCH_KEYCHAIN_PASSWORD' environment variable
[16:53:00]: Password for login keychain: ********
[16:53:24]: Type password for login keychain again: ********
```

**å¦‚æœ Match Development æ‹‰å®Œæ†‘è­‰ï¼Œä½† Xcode ä¸€ç›´é¡¯ç¤ºæœ‰éŒ¯èª¤æˆ–ç„¡æ•ˆ:**

å¯åƒè€ƒå‰æ–‡æåˆ°çš„å¸¸è¦‹éŒ¯èª¤ï¼Œå¤šåŠæ˜¯æœ‰èˆŠçš„é«’æ†‘è­‰ï¼Œæ¸…é™¤æ‰€æœ‰æ†‘è­‰å†é‡æ–°æ‹‰å–ï¼Œæ‡‰è©²å°±å¯ä»¥äº†ã€‚

â€”

**å»ºç«‹ AdHoc Distribution Certificate & Profile ä¸¦ä¸Šå‚³åˆ° Match Repo:**
```bash
bundle exec fastlane match_development type:adhoc isRead:false
```

**å»ºç«‹ AppStore Distribution Certificate & Profile ä¸¦ä¸Šå‚³åˆ° Match Repo:**
```bash
bundle exec fastlane match_development type:appstore isRead:false
```

**CI/CD æœå‹™çµ±ä¸€å¾ Match Repo Pull æ‹‰å– Distribution Certificate & Profile \( `isRead:true` \)ï¼Œç„¶å¾Œå†åŸ·è¡Œæ‰“åŒ…ç™¼ä½ˆä»»å‹™ã€‚**
#### è¨»å†Šæ–°è£ç½®
```php
platform :ios do  
  desc "Register a new device and refresh profiles"
  lane :registerDevice do |options|
    # æ›æˆä½ çš„ App Identifier ID
    app_identifier = "li.zhgchg.myApp"

    # éœ€è¦ App Store Connect API Key æ‰æœ‰æ¬Šé™å» Apple å¾Œå°ç®¡ç†æ†‘è­‰
    # å‡è¨­ App Store Connect API .p8 Key åœ¨ ./fastlane/ ç›®éŒ„å…§
    app_store_connect_api_key(
      key_id: "XXXXXX",
      issuer_id: "XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX",
      key_filepath: "./fastlane/AuthKey_XXXXXX.p8",
    )
    # Input: UDID and device name
    udid = options[:udid] || UI.input("Enter device UDID:")
    device_name = options[:name] || UI.input("Enter device name:")
    UI.message("ğŸ“± Registering device #{device_name} (#{udid})")
    register_device(
      name: device_name,
      udid: udid,
      platform: 'ios'
    )

    # æ›´æ–° app_identifier çš„ Development æ†‘è­‰
    match(
      type: "development",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šå‚³ cert / profile
      force_for_new_devices: true # å¦‚æœç‚ºæ–°è£ç½®å‰‡é‡å»º provisioning profile
    )

    # æ›´æ–° app_identifier çš„ AdHoc æ†‘è­‰
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šå‚³ cert / profile
      force_for_new_devices: true # å¦‚æœç‚ºæ–°è£ç½®å‰‡é‡å»º provisioning profile
    )
  end
end
```

è¨»å†Šå®Œä¹‹å¾Œå…¶ä»–é–‹ç™¼è€…æˆ– CI/CD æœå‹™å†å¾ Match Repo æ‹‰ Profile \(Development or AdHoc\) å°±æœƒåŒ…å«æ–°çš„è£ç½®äº†ã€‚
### Fastlane Match x CI/CD å·¥ä½œæµç¨‹æ•´åˆ

å¤§è‡´ä»‹ç´¹å®Œ Fastlane Match æ€éº¼ç”¢ç”Ÿ Push / æ‹‰å– Pull æ†‘è­‰å¾Œï¼Œå†ä¾†è¦è¬›æ€éº¼æ•´åˆé€² CI/CD æµç¨‹ã€‚
#### å•é¡Œ1 â€” æ€éº¼ Clone Private Match Repo

ç¬¬ä¸€å€‹æœ€å¸¸è¦‹çš„å•é¡Œå°±æ˜¯åœ¨ CI/CD ä¸Šæ€éº¼ Clone Private Match Repo å°ˆæ¡ˆï¼Œåœ¨æœ¬æ©Ÿé–‹ç™¼ä¸Šå› ç‚ºæˆ‘å€‘çµ±ä¸€éƒ½ä½¿ç”¨ ssh git clone ä¸¦ä¸”æ˜¯ç”¨æˆ‘å€‘è‡ªå·±å¸³è™Ÿçš„ ssh key æ‰€ä»¥ä¸æœƒé‡åˆ°å•é¡Œï¼›ä½†æ˜¯ CI/CD ä¸Šæ²’æœ‰é€™å€‹ keyï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ç”¨å€‹äººçš„ key ä½†æ˜¯å¾ˆä¸ä¿éšªã€‚

**GitHub â€” Repo Deploy Key:**

1\.æˆ‘å€‘å…ˆåœ¨æœ¬åœ°ç”¢ç”Ÿ private/public key: `ssh-keygen -t rsa -b 4096 -f ./id_rsa` \( **ä¸è¦è¼¸å…¥ `passphrase`** \)

2\.åˆ° **Match Private Repo** \-&gt; Settings \-&gt; Security \-&gt; Deploy keys \-&gt; Add deploy key:


![](/assets/823ac523ccc8/1*nzo-oPRi7DDxPvtJIWBspw.png)


3\. ç”¨æ–‡å­—ç·¨è¼¯å™¨æ‰“é–‹ã€Œ `id_rsa.pub` ã€è¤‡è£½å…§å®¹è²¼ä¸Šåˆ° Key \-&gt;ã€ŒAdd keyã€


![](/assets/823ac523ccc8/1*mbwtijzM-2iAzfgFiT32rw.png)


5\. å›åˆ°ä¸»è¦ Repo \-&gt; Settings \-&gt; Security \-&gt; Secrets and variables


![](/assets/823ac523ccc8/1*jvY8Yg6tI85LNKHgIaHVVQ.png)


5\. æ–°å¢ SSH Private Key Content åˆ° Secret:


![](/assets/823ac523ccc8/1*8WiPfOz21rJWD6yiMwP3aw.png)

- Name: `MATCH_REPO_DEPLOY_PRIVATE_KEY`


6\. å›åˆ°ä¸»è¦ Repo çš„ GitHub Actions è¨­å®š SSH Key:
```yaml
name: CI - Deploy

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: Test Clone
        run: |
          git clone git@github.com:xxxx/match-certificates.git
# Success!
# .. do deploy job...
```

7\. è¨­å®šæˆåŠŸ\!
#### å•é¡Œ2â€” App Store Connect API \.p8 Key å®‰å…¨å­˜æ”¾ä½¿ç”¨

å› ç‚º GitHub Actions ä¸èƒ½å­˜æª”æ¡ˆï¼Œæ‰€ä»¥åªèƒ½å…ˆå­˜æˆå­—ä¸²ï¼Œç„¶å¾Œå¯«å…¥æª”æ¡ˆã€‚
1. åŒå•é¡Œ 1 æ­¥é©Ÿï¼Œåœ¨ä¸»è¦ Repo æ–°å¢ä¸€å€‹ `APP_STORE_CONNECT_API_KEY_CONTENT` Secret
2. ç”¨æ–‡å­—ç·¨è¼¯å™¨æ‰“é–‹ `AuthKey_XXXXXX.p8` è¤‡è£½ä¸¦è²¼ä¸Šå…§å®¹
3. **ä¸»è¦ Repo çš„ GitHub Actions åŠ ä¸Šä¸€å€‹æ­¥é©Ÿè®€å‡ºå…§å®¹å¯«å…¥æª”æ¡ˆ:**

```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: |
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```
#### å•é¡Œ3 â€” è¨­å®š Private Match Repo çš„ Passphraseï¼Œé˜²æ­¢ Match æ™‚è·³ Prompt ä¸­æ–·
1. åŒå•é¡Œ 1 æ­¥é©Ÿï¼Œåœ¨ä¸»è¦ Repo æ–°å¢ `MATCH_PASSWORD` åˆ° Secret
2. å…§å®¹è¼¸å…¥ä½ è¨­å®šçš„ Fastlane Match Repo `Passphrase`
3. **ä¸»è¦ Repo çš„ GitHub Actions åŠ ä¸Š** `env: secret.MATCH_PASSWORD` **:**

```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: |
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: bundle exec fastlane deploy_to_firebase
```
#### å•é¡Œ4 â€” Self\-hosted Runner ä¸Šçš„ Keychain è™•ç†

è·Ÿé›²ç«¯æ©Ÿå™¨æ¯æ¬¡éƒ½æ˜¯ä¹¾æ·¨å…¨æ–°çš„ä¸åŒï¼Œå¦‚æœæ˜¯ç”¨ Self\-hosted Runner æˆ‘å€‘å¯ä»¥åœ¨ Fastlane æŒ‡å®š `derived_data_path` ã€ `output_directory` ã€ `buildlog_path` ã€ `reinstall_app` è®“æ¯æ¬¡åŸ·è¡Œçš„ç’°å¢ƒéƒ½æ˜¯ä¹¾æ·¨çš„ï¼›ä½†æ˜¯ Certificates, Profiles æ˜¯å®‰è£åˆ°ç³»çµ±çš„ Keychain æ‡‰ç”¨ä¸­ï¼Œè©²å¦‚ä½•è™•ç†ï¼Ÿ

å…¶å¯¦ Fastlane ä¹Ÿå¹«æˆ‘å€‘è€ƒæ…®åˆ°äº†ï¼Œå¯ä»¥åœ¨ Match ä¹‹å‰å…ˆå»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„ Keychain:
```yaml
name: CI - Deploy
on:
  push:
    branches: [ main ]
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current repo (Repo A)
        uses: actions/checkout@v4

      - name: Setup SSH for Deploy Key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MATCH_REPO_DEPLOY_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts  
      
      - name: Write Secret Key to File
        env:
          APP_STORE_CONNECT_API_KEY_CONTENT: ${{ secrets.APP_STORE_CONNECT_API_KEY_CONTENT }}
        run: |
          # ensure fastlane directory exists
          mkdir -p ./fastlane
      
          # create file path
          APP_STORE_CONNECT_API_KEY_PATH=./fastlane/AuthKey_XXXXXX.p8
      
          # write content to file (keep newline)
          echo "$APP_STORE_CONNECT_API_KEY_CONTENT" > "$APP_STORE_CONNECT_API_KEY_PATH"
      
          # (optional) restrict permissions
          chmod 600 "$APP_STORE_CONNECT_API_KEY_PATH"

      - name: Create fastlane keychain
        env:
          KEYCHAIN_NAME: "${{ runner.name }}"
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
        run: |
          bundle exec fastlane run create_keychain \
            name:"$KEYCHAIN_NAME" \
            password:"$MATCH_PASSWORD" \
            unlock:true \
            timeout:0 \
            lock_when_sleeps:false
      
      - name: Deploy to Firebase
        env:
          MATCH_PASSWORD: "${{ secrets.MATCH_PASSWORD }}"
          KEYCHAIN_NAME: "${{ runner.name }}"
        run: bundle exec fastlane deploy_to_firebase

      # ğŸ”¥ ä¸ç®¡å‰é¢æˆåŠŸæˆ–å¤±æ•—ï¼Œä¸€å®šæœƒåŸ·è¡Œ
      - name: Delete fastlane keychain
        if: always()
        env:
          KEYCHAIN_NAME: ${{ runner.name }}
        run: |
          bundle exec fastlane run delete_keychain \
            name:"$KEYCHAIN_NAME"
```
- æ¯å€‹ Runner åŒæ™‚åªæœƒåŸ·è¡Œä¸€å€‹ï¼Œå› æ­¤æˆ‘å€‘ç”¨ Runner Name ç•¶æˆ Keychain Nameï¼Œæ¯å€‹ Runner éƒ½æœƒæœ‰è‡ªå·±çš„ Keychain
- åŸ·è¡Œå®Œç•¢ï¼Œä¸ç®¡æˆåŠŸæˆ–å¤±æ•—éƒ½æœƒåˆªé™¤
- `keychain_password` æˆ‘å°±æ²’ç‰¹åˆ¥å¦å¤–è¨­å®šäº†ï¼Œçµ±ä¸€ç”¨ `MATCH_PASSWORD`


`Fastlane/Fastfile` è£¡çš„ match æ–¹æ³•å¤šåŠ ä¸Š keychain parameters:
```ruby
#...
    match(
      type: "adhoc",
      app_identifier: app_identifier, 
      readonly: false, # å¦‚æœæœ‰éœ€è¦ï¼Œæ›´æ–°ã€ä¸Šå‚³ cert / profile
      force_for_new_devices: true, # å¦‚æœç‚ºæ–°è£ç½®å‰‡é‡å»º provisioning profile
      keychain_name: ENV['KEYCHAIN_NAME'], # default value: nil
      keychain_password: ENV['MATCH_PASSWORD'] # default value: nil
    )
#...
```

é€™æ¨£ Match åœ¨æ‹‰å–æ†‘è­‰çš„æ™‚å€™å°±æœƒæ”¹å­˜åˆ°æŒ‡å®šçš„ Keychainï¼Œè€Œéå…±ç”¨çš„ login keychainã€‚
### çµèª

Fastlane çš„æ–‡ç« ç¯„åœå¤ªå¤§äº†ï¼Œé€™é‚Šå°±åªè¨˜éŒ„ä½¿ç”¨ Fastlane Match çš„éç¨‹ï¼›å…¶ä»–é—œæ–¼ Fastlane è·‘æ¸¬è©¦ã€æ‰“åŒ…ç™¼ä½ˆâ€¦ç­‰ç­‰ Lane æœ‰æ©Ÿæœƒå†å¯«ä¸€ç¯‡æ–°çš„è£œå……ï¼›å…¶ä»– Match ç›¸é—œçš„å•é¡Œï¼Œæœ‰æƒ³åˆ°ä»€éº¼æ¡ˆä¾‹æœƒå†ä¾†è£œå……ï¼ä¹Ÿæ­¡è¿ç•™è¨€æå•ï¼
### å»¶ä¼¸é–±è®€
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šCI/CD æ˜¯ä»€éº¼ï¼Ÿå¦‚ä½•é€é CI/CD æ‰“é€ ç©©å®šé«˜æ•ˆçš„é–‹ç™¼åœ˜éšŠï¼Ÿå·¥å…·é¸æ“‡ï¼Ÿ](../c008a9e8ceca/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆäºŒï¼‰ï¼šGitHub Actions èˆ‡ self\-hosted Runner ä½¿ç”¨èˆ‡å»ºç½®å¤§å…¨](../404bd5c70040/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šä½¿ç”¨ GitHub Actions å¯¦ä½œ App å°ˆæ¡ˆçš„ CI èˆ‡ CD å·¥ä½œæµç¨‹](../4b001d2e8440/)
- [CI/CD å¯¦æˆ°æŒ‡å—ï¼ˆå››ï¼‰ï¼šä½¿ç”¨ Google Apps Script Web App ä¸²æ¥ GitHub Actions å»ºç½®å…è²»æ˜“ç”¨çš„æ‰“åŒ…å·¥å…·å¹³å°](../4273e57e7148/)


**æ•¬è«‹ç§»æ­¥é–±è¦½ã€‚ğŸ¤ğŸ»**

æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚




_[Post](https://medium.com/zrealm-ios-dev/ios-certificates-identifiers-profiles-%E6%98%AF%E4%BB%80%E9%BA%BC%E5%8F%8A-fastlane-match-%E7%B5%B1%E4%B8%80%E7%AE%A1%E7%90%86%E6%86%91%E8%AD%89%E8%88%87-ci-cd-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%86%E8%A8%98-823ac523ccc8){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._