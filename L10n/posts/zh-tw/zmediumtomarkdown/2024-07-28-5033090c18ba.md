---
author: ZhgChgLi
categories:
- ZRealm Dev.
date: 2024-07-28T09:53:05.535+0000
description: iOS WKWebView é å…ˆä¸‹è¼‰èˆ‡ç·©å­˜è³‡æºæå‡é é¢è¼‰å…¥é€Ÿåº¦ç ”ç©¶ã€‚
image:
  path: /assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.jpeg
last_modified_at: 2024-08-10T09:11:41.233+0000
render_with_liquid: false
tags:
- ios
- ios-app-development
- cache
- webview
- http-request
title: iOS WKWebView é é¢èˆ‡æª”æ¡ˆè³‡æº Preload é è¼‰ / Cache ç·©å­˜ç ”ç©¶
---

### iOS WKWebView é é¢èˆ‡æª”æ¡ˆè³‡æº Preload é è¼‰ / Cache ç·©å­˜ç ”ç©¶

iOS WKWebView é å…ˆä¸‹è¼‰èˆ‡ç·©å­˜è³‡æºæå‡é é¢è¼‰å…¥é€Ÿåº¦ç ”ç©¶ã€‚



![Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}](/assets/5033090c18ba/1*KACJYJkLfa2u5iKYJlJb2Q.jpeg)

Photo by [Antoine Gravier](https://unsplash.com/@antoine_gravphotos?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash){:target="_blank"}
#### èƒŒæ™¯

ä¸çŸ¥ç‚ºä½•ï¼Œä¸€ç›´è·Ÿ â€œCacheâ€ ç·©å­˜è »æœ‰ç·£çš„ï¼Œä¹‹å‰ä¹Ÿè² è²¬ç ”ç©¶å¯¦è¸é AVPlayer çš„ã€Œ [iOS HLS Cache å¯¦è¸æ–¹æ³•æ¢ç©¶ä¹‹æ—…](../d796bf8e661e/) ã€èˆ‡ã€Œ [AVPlayer å¯¦è¸æœ¬åœ° Cache åŠŸèƒ½å¤§å…¨](../6ce488898003/) ã€ï¼›ä¸åŒæ–¼ä¸²æµç·©å­˜ç›®çš„æ˜¯æ¸›å°‘æ’­æ”¾æµé‡ï¼Œ **é€™æ¬¡çš„ä¸»è¦ä»»å‹™æ˜¯æå‡ In\-app WKWebView è¼‰å…¥é€Ÿåº¦** ï¼Œå…¶ä¸­ä¹Ÿç‰½æ¶‰åˆ° WKWebView çš„é å…ˆåŠ è¼‰èˆ‡ç·©å­˜ç ”ç©¶ï¼›ä¸éè€å¯¦èªª WKWebView çš„å ´æ™¯æ›´ç‚ºè¤‡é›œï¼Œä¸åŒæ–¼ AVPlayer ä¸²æµå½±éŸ³æ˜¯ä¸€å€‹æˆ–æ˜¯å¤šå€‹é€£çºŒçš„ Chunk æª”æ¡ˆï¼Œåªéœ€è¦é‡å°æª”æ¡ˆåš Cacheï¼ŒWKWebView é™¤äº†æœ¬èº«é é¢æª”æ¡ˆé‚„æœ‰å¼•å…¥çš„è³‡æºæª”æ¡ˆ\( \.js, \.css, font, imageâ€¦\) å†ç¶“ç”± Browser Engine æ¸²æŸ“å‡ºé é¢å‘ˆç¾çµ¦ä½¿ç”¨è€…ï¼Œé€™ä¸­é–“ä¸æ˜¯ App å¯ä»¥æ§åˆ¶çš„ç’°ç¯€å¤ªå¤šï¼Œå¾ç¶²è·¯åˆ°å‰ç«¯é é¢ JavaScript èªæ³•æ•ˆèƒ½ã€æ¸²æŸ“æ–¹å¼ï¼Œéƒ½éœ€è¦èŠ±è²»æ™‚é–“ã€‚

**æœ¬ç¯‡æ–‡ç« åªæ˜¯å°± iOS æŠ€è¡“ä¸Šå¯è¡Œæ€§é€²è¡Œç ”ç©¶ï¼Œä¸¦ä¸ä¸€å®šæ˜¯æœ€çµ‚è§£æ³•ï¼Œç¶œè§€ä¾†èªªæ­¤è­°é¡Œé‚„æ˜¯è«‹å‰ç«¯å¾å‰ç«¯ä¸‹æ‰‹æ¯”è¼ƒèƒ½é”æˆå››å…©æ’¥åƒæ–¤çš„æ•ˆæœ** ï¼Œè«‹å‰ç«¯å¤¥ä¼´å„ªåŒ–ç¬¬ä¸€å€‹ç•«é¢å‡ºç¾çš„æ™‚é–“\(First Contentful Paint\) èˆ‡å®Œå–„ HTTP Cache æ©Ÿåˆ¶ï¼Œä¸€æ–¹é¢èƒ½åŠ é€Ÿ Web/mWeb è‡ªèº«ï¼ŒåŒæ™‚å½±éŸ¿ Android/iOS in\-app WebView é€Ÿåº¦ï¼Œä¸¦ä¸”ä¹Ÿæœƒæå‡ [Google SEO æ¬Šé‡](https://developers.google.com/search/blog/2018/01/using-page-speed-in-mobile-search?hl=zh-tw){:target="_blank"} ã€‚
### æŠ€è¡“ç´°ç¯€
#### iOS é™åˆ¶

æ ¹æ“š [Apple Review Guidelines 2\.5\.6](https://developer.apple.com/app-store/review/guidelines/){:target="_blank"} ï¼š


> _Apps that browse the web must use the appropriate WebKit framework and WebKit JavaScript\. You may apply for an entitlement to use an alternative web browser engine in your app\. [Learn more about these entitlements](https://developer.apple.com/support/alternative-browser-engines/){:target="_blank"} \._ 





**Apps å…§åªèƒ½ä½¿ç”¨ Apple æä¾›çš„ WebKit Framework \(WKWebView\) ä¸å…è¨±ä½¿ç”¨ç¬¬ä¸‰æ–¹æˆ–è‡ªè¡Œä¿®æ”¹éçš„ WebKit å¼•æ“** ï¼Œå¦å‰‡å°‡ä¸å…è¨±ä¸Šæ¶ï¼›å¦å¤– iOS 17\.4 é–‹å§‹ï¼Œç‚ºç¬¦åˆæ³•è¦ï¼Œæ­ç›Ÿåœ°å€å¯ä»¥åœ¨ **å–å¾— Apple ç‰¹åˆ¥è¨±å¯** å¾Œ [ä½¿ç”¨å…¶ä»– Browser Engine](https://developer.apple.com/support/alternative-browser-engines/){:target="_blank"} ã€‚


> è˜‹æœä¸çµ¦çš„ï¼Œæˆ‘å€‘ä¹Ÿä¸èƒ½åšã€‚ 




\[æœªé©—è­‰\] æŸ¥è³‡æ–™èªªå°±é€£ iOS ç‰ˆçš„ Chrome, Firefox ä¹Ÿéƒ½æ˜¯åªèƒ½ç”¨ Apple WebKit \(WKWebView\)ã€‚

**å¦å¤–é‚„æœ‰ä¸€å€‹å¾ˆé‡è¦çš„äº‹ï¼š**


> _WKWebView æ˜¯è·‘åœ¨ App ä¸»åŸ·è¡Œç·’ä¹‹å¤–çš„ç¨ç«‹åŸ·è¡Œç·’ï¼Œå› æ­¤æ‰€æœ‰è«‹æ±‚ã€æ“ä½œéƒ½ä¸æœƒç¶“éæˆ‘å€‘çš„ Appã€‚_ 




#### HTTP Cache Flow


![](/assets/5033090c18ba/1*ozXaaWpTfw6IJOwt54EzsQ.jpeg)


åœ¨ HTTP å”è­°ä¸­å°±æœ‰åŒ…å« Cache å”è­°ï¼Œä¸¦ä¸”åœ¨æ‰€æœ‰è·Ÿç¶²è·¯æœ‰é—œçš„å…ƒä»¶\(URLSession, WKWebViewâ€¦\)ç•¶ä¸­ç³»çµ±éƒ½å·²ç¶“å¹«æˆ‘å€‘å¯¦ä½œå¥½äº† Cache æ©Ÿåˆ¶ï¼Œå› æ­¤ Client App é€™é‚Šä¸éœ€è¦åšä»»ä½•å¯¦ç¾ï¼Œä¹Ÿä¸æ¨è–¦å¤§å®¶è‡ªå·±å¹¹ä¸€å¥—è‡ªå·±çš„ Cache æ©Ÿåˆ¶ï¼Œç›´æ¥èµ° HTTP å”è­°æ‰æ˜¯æœ€å¿«æœ€ç©©å®šæœ€æœ‰æ•ˆçš„è·¯ã€‚

**HTTP Cache å¤§è‡´é‹ä½œæµç¨‹å¦‚ä¸Šåœ–ï¼š**
1. Client ç™¼èµ·è«‹æ±‚
2. Server éŸ¿æ‡‰ Cache ç­–ç•¥åœ¨ Response Headerï¼Œç³»çµ± URLSession, WKWebViewâ€¦ æœƒä¾ç…§ Cache Header è‡ªå‹•å¹«æˆ‘å€‘å°‡ Response ç·©å­˜ä¸‹ä¾†ï¼Œå¾ŒçºŒè«‹æ±‚ä¹Ÿæœƒè‡ªå‹•å¥—ç”¨é€™å€‹ç­–ç•¥
3. å†æ¬¡è«‹æ±‚ç›¸åŒè³‡æºæ™‚ï¼Œå¦‚æœç·©å­˜æœªéæœŸå‰‡ç›´æ¥å¾è¨˜æ†¶é«”ã€ç£ç¢Ÿè®€å–æœ¬åœ°ç·©å­˜ç›´æ¥å›æ‡‰çµ¦ App
4. å¦‚æœå·²éæœŸ\(éæœŸä¸ä»£è¡¨ç„¡æ•ˆ\)ï¼Œå‰‡ç™¼èµ·çœŸå¯¦ç¶²è·¯è«‹æ±‚å• Serverï¼Œå¦‚æœå…§å®¹æ²’æ›´æ”¹ \(é›–éæœŸå¾…ä»æœ‰æ•ˆ\) Server æœƒç›´æ¥å›æ‡‰ 304 Not Modified \(Empt Body\)ï¼Œé›–ç„¶çœŸçš„æœ‰ç™¼èµ·ç¶²è·¯è«‹æ±‚ä½†æ˜¯åŸºæœ¬ä¸Šæ˜¯æ¯«ç§’å›æ‡‰ï¼‹ç„¡ Response Body æ²’ä»€éº¼æµé‡è€—æ
5. å¦‚æœå…§å®¹æœ‰æ›´æ”¹å‰‡é‡æ–°çµ¦ä¸€æ¬¡è³‡æ–™è·Ÿ Cache Headerã€‚



> _ç·©å­˜é™¤äº†æœ¬åœ° Cacheã€åœ¨ Network Proxy Server æˆ–é€”ç¶“çš„è·¯ä¸Šä¹Ÿå¯èƒ½æœ‰ç¶²è·¯çš„ç·©å­˜ã€‚_ 





**å¸¸è¦‹ HTTP Response Cache Header åƒæ•¸ï¼š**
```yaml
expires: RFC 2822 æ—¥æœŸ
pragma: no-cache
# è¼ƒæ–°çš„åƒæ•¸:
cache-control: private/public/no-store/no-cache/max-age/s-max-age/must-revalidate/proxy-revalidate...
etag: XXX
```

**å¸¸è¦‹ HTTP Request Cache Header åƒæ•¸ï¼š**
```yaml
If-Modified-Since: 2024-07-18 13:00:00
IF-None-Match: 1234
```


> **_åœ¨ iOS ä¸­ç¶²è·¯æœ‰é—œçš„å…ƒä»¶\(URLSession, WKWebViewâ€¦\)æœƒè‡ªå·±è™•ç† HTTP Request/Response Cache Header ä¸¦è‡ªå‹•åšç·©å­˜ï¼Œæˆ‘å€‘ä¸éœ€è‡ªå·±è™•ç† Cache Header åƒæ•¸ã€‚_** 





æ›´è©³ç´°çš„ HTTP Cache é‹ä½œç´°ç¯€å¯åƒè€ƒã€Œ [Huli å¤§å¤§å¯«çš„å¾ªåºæ¼¸é€²ç†è§£ HTTP Cache æ©Ÿåˆ¶](https://blog.techbridge.cc/2017/06/17/cache-introduction/){:target="_blank"} ã€
### iOS WKWebView ç¸½æ”¬


![](/assets/5033090c18ba/1*j9uw_OGpR-Lrq_4Gpj5beA.jpeg)


å›åˆ° iOS ä¸Šï¼Œå› ç‚ºæˆ‘å€‘åªèƒ½ä½¿ç”¨ Apple WebKitï¼Œå› æ­¤åªèƒ½å¾è˜‹æœæä¾›çš„ WebKit æ–¹æ³•ä¸‹æ‰‹ï¼Œæ¢ç©¶æœ‰æ©Ÿæœƒé”æˆé è¼‰ç·©å­˜çš„æ–¹å¼ã€‚

ä¸Šåœ–æ˜¯ä½¿ç”¨ ChatGPT 4o ç°¡ä»‹çš„æ‰€æœ‰ Apple iOS WebKit \(WKWebView\) ç›¸é—œçš„æ–¹æ³•ï¼Œä¸¦é™„ä¸Šç°¡çŸ­èªªæ˜ï¼›ç¶ è‰²éƒ¨åˆ†ç‚ºè·Ÿè³‡æ–™å„²å­˜æœ‰é—œçš„æ–¹æ³•ã€‚

**è·Ÿå¤§å®¶åˆ†äº«å…¶ä¸­æ¯”è¼ƒå¹¾å€‹æœ‰è¶£çš„æ–¹æ³•ï¼š**
- WKProcessPoolï¼šå¯ä»¥è®“å¤šå€‹ WKWebView ä¹‹é–“å…±äº«è³‡æºã€æ•¸æ“šã€Cookieâ€¦ç­‰ç­‰ã€‚
- WKHTTPCookieStoreï¼šå¯ä»¥ç®¡ç† WKWebView Cookieï¼ŒWKWebView èˆ‡ WKWebView ä¹‹é–“æˆ–æ˜¯ App å…§çš„ URLSession Cookie èˆ‡ WKWebViewã€‚
- WKWebsiteDataStoreï¼šç®¡ç†ç¶²ç«™ç·©å­˜æª”æ¡ˆã€‚\(åªèƒ½è®€è³‡è¨Šè·Ÿæ¸…é™¤\)
- WKURLSchemeHandlerï¼šç•¶ WKWebView ç„¡æ³•èªå¾—è™•ç†çš„ URL Scheme å‰‡å¯è¨»å†Šè‡ªå®šç¾© Handler è™•ç†ã€‚
- WKContentWorldï¼šå¯ä»¥æŠŠæ³¨å…¥çš„ JavaScript \(WKUserScript\) è…³æœ¬åˆ†çµ„ç®¡ç†ã€‚
- WKFindXXXï¼šå¯ä»¥æ§åˆ¶é é¢æœå°‹åŠŸèƒ½ã€‚
- WKContentRuleListStoreï¼šå¯ä»¥åœ¨ WKWebView å…§å¯¦ç¾å…§å®¹é˜»æ“‹å™¨åŠŸèƒ½\(e\.g\. é®æ“‹å»£å‘Šä¹‹é¡çš„\)ã€‚

### iOS WKWebView é è¼‰ç·©å­˜å¯è¡Œæ€§æ–¹æ¡ˆç ”ç©¶
### å®Œå–„ HTTP Cache âœ…

å¦‚åŒå‰æ–‡ä»‹ç´¹çš„ HTTP Cache æ©Ÿåˆ¶ï¼Œæˆ‘å€‘å¯ä»¥è«‹ Web Team å®Œå–„æ´»å‹•é é¢çš„ HTTP Cache è¨­å®šï¼ŒClient iOS é€™é‚Šåªéœ€è¦ç°¡å–®çš„æª¢æŸ¥ä¸€ä¸‹ CachePolicy è¨­å®šå°±å¥½ï¼Œå…¶ä»–çš„äº‹ç³»çµ±éƒ½åšå¥½äº†ï¼
#### **CachePolicy è¨­å®š**

**URLSession:**
```swift
let configuration = URLSessionConfiguration.default
configuration.requestCachePolicy = .useProtocolCachePolicy
let session = URLSession(configuration: configuration)
```

**URLRequest/WKWebView:**
```swift
var request = URLRequest(url: url)
request.cachePolicy = .reloadRevalidatingCacheData
//
wkWebView.load(request)
```
- **useProtocolCachePolicy** : é»˜èªï¼Œç…§é»˜èª HTTP Cache æ§åˆ¶ã€‚
- **reloadIgnoringLocalCacheData** : ä¸ä½¿ç”¨æœ¬åœ°å¿«å–ï¼Œæ¯æ¬¡è«‹æ±‚éƒ½å¾ç¶²çµ¡åŠ è¼‰æ•¸æ“š\(ä½†å…è¨±ç¶²è·¯, Proxy å¿«å–â€¦\)ã€‚
- **reloadIgnoringLocalAndRemoteCacheData** : ç„¡è«–æœ¬åœ°æˆ–é ç«¯å¿«å–ï¼Œç¸½æ˜¯å¾ç¶²çµ¡åŠ è¼‰æ•¸æ“šã€‚
- **returnCacheDataElseLoad** : å¦‚æœæœ‰å¿«å–æ•¸æ“šå‰‡ä½¿ç”¨å¿«å–æ•¸æ“šï¼Œå¦å‰‡å¾ç¶²çµ¡åŠ è¼‰æ•¸æ“šã€‚
- **returnCacheDataDontLoad** : åƒ…ä½¿ç”¨å¿«å–æ•¸æ“šï¼Œå¦‚æœæ²’æœ‰å¿«å–æ•¸æ“šä¹Ÿä¸æ‰“ç¶²è·¯è«‹æ±‚ã€‚
- **reloadRevalidatingCacheData** : ç™¼é€è«‹æ±‚æª¢æŸ¥æœ¬åœ°å¿«å–æ˜¯å¦éæœŸï¼Œå¦‚æœæ²’æœ‰éæœŸ\(304 Not Modified\)å‰‡ä½¿ç”¨å¿«å–æ•¸æ“šï¼Œå¦å‰‡å¾ç¶²çµ¡é‡æ–°åŠ è¼‰æ•¸æ“šã€‚

#### **è¨­å®šå¿«å–å¤§å°**

**App å…¨åŸŸ:**
```swift
let memoryCapacity = 512 * 1024 * 1024 // 512 MB
let diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GB
let urlCache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: "myCache")
        
URLCache.shared = urlCache
```

**å€‹åˆ¥ URLSession:**
```csharp
let memoryCapacity = 512 * 1024 * 1024 // 512 MB
let diskCapacity = 10 * 1024 * 1024 * 1024 // 10 GB
let cache = URLCache(memoryCapacity: memoryCapacity, diskCapacity: diskCapacity, diskPath: "myCache")
        
let configuration = URLSessionConfiguration.default
configuration.urlCache = cache
```


> **_å¦å¤–åŒå‰è¿°ï¼ŒWKWebView æ˜¯è·‘åœ¨ App ä¸»åŸ·è¡Œç·’ä¹‹å¤–çš„ç¨ç«‹åŸ·è¡Œç·’ï¼Œå› æ­¤ URLRequest, URLSession çš„å¿«å–è·Ÿ WKWebView çš„æ˜¯ä¸å…±ç”¨çš„ã€‚_** 




#### **å¦‚ä½•åœ¨** WKWebView **ä¸­ä½¿ç”¨ Safari é–‹ç™¼è€…å·¥å…·?**

æª¢æŸ¥æ˜¯å¦æ˜¯ä½¿ç”¨æœ¬åœ° Cache å¿«å–ã€‚

**Safari å•Ÿç”¨é–‹ç™¼è€…åŠŸèƒ½ï¼š**


![](/assets/5033090c18ba/1*6j4djW1IeD2n8FGX6FbOtw.png)


**WKWebView å•Ÿç”¨ isInspectableï¼š**
```swift
func makeWKWebView() -> WKWebView {
 let webView = WKWebView(frame: .zero)
 webView.isInspectable = true // is only available in ios 16.4 or newer
 return webView
}
```

WKWebView åŠ ä¸Š `webView.isInspectable = true` æ‰èƒ½åœ¨ Debug Build ç‰ˆä½¿ç”¨ Safari é–‹ç™¼è€…å·¥å…·ã€‚


![p\.s\. é€™æ˜¯æˆ‘å¦é–‹çš„æ¸¬è©¦ WKWebView ç”¨ Project](/assets/5033090c18ba/1*6E6AfdFW3w7nvO2VlbhRCA.png)

p\.s\. é€™æ˜¯æˆ‘å¦é–‹çš„æ¸¬è©¦ WKWebView ç”¨ Project

åœ¨ `webView.load` çš„åœ°æ–¹ä¸‹ä¸€å€‹æ–·é»ã€‚

**é–‹å§‹æ¸¬è©¦ï¼š**

Build & Runï¼š


![](/assets/5033090c18ba/1*8jCKl-UzSLrfjy9IAm26pA.png)


åŸ·è¡Œåˆ° webView\.load æ–·é»æ™‚ï¼Œé»æ“Šã€Œé€è¡ŒåµéŒ¯ã€ã€‚


![](/assets/5033090c18ba/1*LAX4hrwffthRAtK-_9Q42A.png)


å›åˆ° Safariï¼Œé¸æ“‡å·¥å…·åˆ—çš„ã€Œé–‹ç™¼ã€\-&gt;ã€Œæ¨¡æ“¬å™¨ã€\-&gt;ã€Œä½ çš„å°ˆæ¡ˆã€\-&gt;ã€Œabout:blankã€ã€‚
- å› ç‚ºé é¢å°šæœªé–‹å§‹è¼‰å…¥ æ‰€ä»¥ç¶²å€æœƒæ˜¯ about:blank
- å¦‚æœæ²’å‡ºç¾ about:blank å°±å†å›åˆ° XCode é»ä¸€æ¬¡é€è¡ŒåµéŒ¯æŒ‰éˆ•ï¼Œç›´åˆ°å‡ºç¾ç‚ºæ­¢


å‡ºç¾è©²é é¢å°æ‡‰çš„é–‹ç™¼è€…å·¥å…·ï¼š


![](/assets/5033090c18ba/1*kde2nIvjC8CxFBIcoVhXqg.png)


å› XCode é»æ“Šç¹¼çºŒåŸ·è¡Œï¼š


![](/assets/5033090c18ba/1*PtAMLX46fNwFDfF7lidyaA.png)


å†å›åˆ° Safari é–‹ç™¼è€…å·¥å…·å°±èƒ½çœ‹åˆ°è³‡æºè¼‰å…¥ç‹€æ³è·Ÿå®Œæ•´çš„é–‹ç™¼è€…å·¥å…·åŠŸèƒ½äº† \(å…ƒä»¶ã€å„²å­˜ç©ºé–“èª¿è©¦â€¦ç­‰ç­‰\)


![](/assets/5033090c18ba/1*l0vGOvT2UupVCvf4MrLgUA.png)


**å¦‚æœç¶²è·¯è³‡æºæœ‰ HTTP Cacheï¼Œå‚³ç®—å¤§å°å‰‡æœƒé¡¯ç¤ºã€Œç£ç¢Ÿã€ï¼š**


![](/assets/5033090c18ba/1*TMIPgtC2SVYzEmBD_xPQ_A.png)



![](/assets/5033090c18ba/1*KNbus1iFkCl4HjWThyYoew.png)


é»é€²å»ä¹Ÿèƒ½çœ‹åˆ°ç·©å­˜è³‡è¨Šã€‚
#### æ¸…é™¤ WKWebView å¿«å–
```swift
// Clean Cookies
HTTPCookieStorage.shared.removeCookies(since: Date.distantPast)

// Clean Stored Data, Cache Data
let dataTypes = WKWebsiteDataStore.allWebsiteDataTypes()
let store = WKWebsiteDataStore.default()
store.fetchDataRecords(ofTypes: dataTypes) { records in
 records.forEach { record in
  store.removeData(
   ofTypes: record.dataTypes,
   for: records,
   completionHandler: {
          print("clearWebViewCache() - \(record)")           
   }
  )
 }
}
```

å¯ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•æ¸…é™¤ WKWebView å·²ç·©å­˜çš„è³‡æºã€æœ¬åœ°æ•¸æ“šã€Cookie æ•¸æ“šã€‚


> **_ä½†å®Œå–„ HTTP Cache åªæ˜¯åšåˆ°ç·©å­˜éƒ¨åˆ†\(ç¬¬äºŒæ¬¡é€²å…¥å¾ˆå¿«\)ï¼Œé è¼‰\(ç¬¬ä¸€æ¬¡é€²å…¥\)ä¸æœƒæœ‰å½±éŸ¿ã€‚_** _âœ…_ 




### å®Œå–„ HTTP Cache \+ WKWebView Preload å…¨é é¢ ğŸ˜•
```swift
class WebViewPreloader {
    static let shared = WebViewPreloader()

    private var _webview: WKWebView = WKWebView()

    private init() { }

    func preload(url: URL) {
        let request = URLRequest(url: url)
        Task { @MainActor in
            webview.load(request)
        }
    }
}

WebViewPreloader.shared.preload("https://zhgchg.li/campaign/summer")
```

åŸºæ–¼å®Œå–„ HTTP Cache ä¹‹å¾Œï¼Œç¬¬äºŒæ¬¡ Load WKWebView æœƒæœ‰ç·©å­˜ï¼Œæˆ‘å€‘å¯ä»¥å…ˆåœ¨åˆ—è¡¨æˆ–é¦–é å·å…ˆæŠŠè£¡é¢çš„ URL éƒ½ Load éä¸€æ¬¡è®“ä»–æœ‰ç·©å­˜ï¼Œä½¿ç”¨è€…é€²å»ä¹‹å¾Œå°±æœƒæ¯”è¼ƒå¿«ã€‚


> **_ç¶“éæ¸¬è©¦ï¼ŒåŸç†ä¸Šå¯è¡Œï¼›ä½†æ˜¯å°æ€§èƒ½ã€ç¶²è·¯æµé‡æè€—å¤ªå¤§_** _ï¼›ä½¿ç”¨è€…å¯èƒ½æ ¹æœ¬æ²’é€²å»è©³ç´°é ï¼Œä½†æˆ‘å€‘ç‚ºäº†åšé è¼‰æŠŠæ‰€æœ‰é é¢å…¨éƒ½ Load äº†ä¸€éï¼Œæœ‰é»äº‚æ§æ‰“é³¥çš„æ„Ÿè¦ºã€‚_ 
 

> _å€‹äººèªç‚ºç¾å¯¦ä¸Šä¸å¯è¡Œï¼Œä¸”åˆ©å¤§æ–¼å¼Šã€å› å™å»¢é£Ÿã€‚ğŸ˜•_ 




### å®Œå–„ HTTP Cache \+ WKWebView Preload ç´”è³‡æºğŸ‰

åŸºæ–¼ä¸Šé¢æ–¹æ³•çš„å„ªåŒ–ï¼Œæˆ‘å€‘å¯ä»¥æ­é… HTML Link Preload æ–¹æ³•ï¼Œåƒ…é‡å°é é¢è£¡é¢æœƒç”¨åˆ°çš„è³‡æºæª”æ¡ˆ\(e\.g\. \.js, \.css, font, imageâ€¦\)é€²è¡Œ Preloadï¼Œè®“ä½¿ç”¨è€…é€²å»ä¹‹å¾Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç·©å­˜è³‡æºï¼Œä¸ç”¨å†ç™¼èµ·ç¶²è·¯è«‹æ±‚æ‹¿è³‡æºæª”æ¡ˆã€‚


> **_æ„å³æˆ‘ä¸é è¼‰æ•´å€‹é é¢çš„æ‰€æœ‰æ±è¥¿äº†ï¼Œæˆ‘åªé è¼‰é é¢æœƒç”¨åˆ°çš„è³‡æºæª”æ¡ˆï¼Œé€™äº›æª”æ¡ˆå¯èƒ½ä¹Ÿæ˜¯è·¨é é¢å…±ç”¨çš„ï¼›é é¢æª”æ¡ˆ \.html é‚„æ˜¯å¾ç¶²è·¯æ‹¿å–å†çµåˆé è¼‰æª”æ¡ˆæ¸²æŸ“å‡ºé é¢ã€‚_** 





è«‹æ³¨æ„ï¼šé€™é‚Šä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤é€™äº›è³‡æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦å‰‡ä¹‹å¾Œè«‹æ±‚é‚„æ˜¯æœƒèµ°ç¶²è·¯ã€‚

è«‹æ³¨æ„ï¼šé€™é‚Šä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤é€™äº›è³‡æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦å‰‡ä¹‹å¾Œè«‹æ±‚é‚„æ˜¯æœƒèµ°ç¶²è·¯ã€‚

è«‹æ³¨æ„ï¼šé€™é‚Šä¾ç„¶èµ°çš„æ˜¯ HTTP Cacheï¼Œå› æ­¤é€™äº›è³‡æºä¹Ÿè¦æ”¯æ´ HTTP Cacheï¼Œå¦å‰‡ä¹‹å¾Œè«‹æ±‚é‚„æ˜¯æœƒèµ°ç¶²è·¯ã€‚
```xml
<!DOCTYPE html>
<html lang="zh-tw">
 <head>
    <link rel="preload" href="https://cdn.zhgchg.li/dist/main.js" as="script">
    <link rel="preload" href="https://image.zhgchg.li/v2/image/get/campaign.jpg" as="image">
    <link rel="preload" href="https://cdn.zhgchg.li/assets/fonts/glyphicons-halflings-regular.woff2" as="font">
    <link rel="preload" href="https://cdn.zhgchg.li/assets/fonts/Simple-Line-Icons.woff2?v=2.4.0" as="font">
  </head>
</html>
```

**å¸¸è¦‹æ”¯æ´æª”æ¡ˆé¡å‹ï¼š**
- \.js script
- \.css style
- font
- image


Web Team å°‡ä»¥ä¸Š HTML å…§å®¹æ”¾åœ¨èˆ‡ App ç´„å®šå¥½çš„è·¯å¾‘ï¼Œæˆ‘å€‘çš„ `WebViewPreloader` æ”¹å» Load é€™å€‹è·¯å¾‘ï¼ŒWKWebView Load çš„åŒæ™‚å°±æœƒè§£æ &lt;link&gt; preload è³‡æºç”¢ç”Ÿç·©å­˜äº†ã€‚
```swift
WebViewPreloader.shared.preload("https://zhgchg.li/campaign/summer/preload")
// or çµ±ä¸€éƒ½åœ¨
WebViewPreloader.shared.preload("https://zhgchg.li/assets/preload")
```


> **_ç¶“éæ¸¬è©¦ï¼Œå¯ä»¥åœ¨æµé‡æè€—èˆ‡é è¼‰ä¸­å–å¾—ä¸€å€‹ä¸éŒ¯çš„å¹³è¡¡_** _ã€‚_ ğŸ‰
 

> **_ç¼ºé»æ‡‰è©²æ˜¯éœ€è¦ç¶­è­·é€™ä»½ Cache è³‡æºåˆ—è¡¨ï¼Œè·Ÿé‚„æ˜¯éœ€è¦ Web å„ªåŒ–é é¢æ¸²æŸ“è·Ÿè¼‰å…¥ï¼Œä¸ç„¶ç¬¬ä¸€å€‹é é¢å‡ºç¾çš„é«”æ„Ÿæ™‚é–“ä¾ç„¶æœƒå¾ˆä¹…ã€‚_** 




### URLProtocol _âŒ_

å¦å¤–æƒ³åˆ°æˆ‘å€‘çš„è€æœ‹å‹ [URLProtocol](https://developer.apple.com/documentation/foundation/urlprotocol){:target="_blank"} ï¼Œæ‰€æœ‰åŸºæ–¼ `URL Loading System` çš„è«‹æ±‚ \(URLSession, openURLâ€¦\) éƒ½å¯ä»¥è¢«æ””æˆªä¸‹ä¾†æ“ä½œã€‚
```swift
class CustomURLProtocol: URLProtocol {
    override class func canInit(with request: URLRequest) -> Bool {
        // åˆ¤æ–·æ˜¯å¦è¦è™•ç†é€™å€‹è«‹æ±‚
        if let url = request.url {
            return url.scheme == "custom"
        }
        return false
    }
    
    override class func canonicalRequest(for request: URLRequest) -> URLRequest {
        // è¿”å›è«‹æ±‚
        return request
    }
    
    override func startLoading() {
        // è™•ç†è«‹æ±‚ä¸¦åŠ è¼‰æ•¸æ“š
        // æ”¹æˆç·©å­˜ç­–ç•¥ï¼Œå…ˆå¾æœ¬åœ°è®€æª”æ¡ˆ
        if let url = request.url {
            let response = URLResponse(url: url, mimeType: "text/plain", expectedContentLength: -1, textEncodingName: nil)
            self.client?.urlProtocol(self, didReceive: response, cacheStoragePolicy: .notAllowed)
            
            let data = "This is a custom response!".data(using: .utf8)!
            self.client?.urlProtocol(self, didLoad: data)
            self.client?.urlProtocolDidFinishLoading(self)
        }
    }
    
    override func stopLoading() {
        // åœæ­¢åŠ è¼‰æ•¸æ“š
    }
}

// AppDelegate.swift didFinishLaunchingWithOptions:
URLProtocol.registerClass(CustomURLProtocol.self)
```

æŠ½è±¡æƒ³æ³•æ˜¯åœ¨èƒŒæ™¯å·ç™¼ URLReqeust \-&gt; URLProtocol \-&gt; å¾ä¸­è‡ªå·±ä¸‹è¼‰æ‰€æœ‰è³‡æºï¼Œä½¿ç”¨è€… \-&gt; WKWebView \-&gt; Request \-&gt; URLProtocol \-&gt; å›æ‡‰é è¼‰çš„è³‡æºã€‚


> **_ä¸€æ¨£åŒå‰è¿°ï¼ŒWKWebView æ˜¯è·‘åœ¨ App ä¸»åŸ·è¡Œç·’ä¹‹å¤–çš„ç¨ç«‹åŸ·è¡Œç·’ï¼Œå› æ­¤ URLProtocol æ˜¯æ””æˆªä¸åˆ° WKWebView çš„è«‹æ±‚çš„ã€‚_** 
 

> **_ä½†è½èªªä¸Šé»‘é­”æ³•å¥½åƒå¯ä»¥ï¼Œä¸æ¨è–¦ã€æœƒå»¶ä¼¸å…¶ä»–å•é¡Œ\(é€å¯©è¢«æ‹’\)_** 
 

> **_æ­¤è·¯ä¸é€š_** _âŒã€‚_ 




### WKURLSchemeHandler _ğŸ˜•_

è˜‹æœåœ¨ iOS 11 æ¨å‡ºçš„æ–°æ–¹æ³•ï¼Œæ„Ÿè¦ºæ˜¯ç‚ºäº†è£œè¶³ WKWebView ç„¡æ³•ä½¿ç”¨ URLProtocol çš„ç‰¹å‹ï¼›ä½†æ˜¯é€™å€‹æ–¹æ³•è·Ÿ [AVPlayer çš„ ResourceLoader](../6ce488898003/) æ¯”è¼ƒé¡ä¼¼ï¼Œ **åªæœ‰ç³»çµ±ç„¡æ³•è¾¨è­˜çš„ Scheme æ‰æœƒä¸Ÿçµ¦æˆ‘å€‘è‡ªå·±è¨‚çš„ WKURLSchemeHandler é€²è¡Œè™•ç†** ã€‚

æŠ½è±¡æƒ³æ³•ä¸€æ¨£æ˜¯åœ¨èƒŒæ™¯å·ç™¼ WKWebView \-&gt; Request \-&gt; WKURLSchemeHandler \-&gt; å¾ä¸­è‡ªå·±ä¸‹è¼‰æ‰€æœ‰è³‡æºï¼Œä½¿ç”¨è€… \-&gt; WKWebView \-&gt; Request \-&gt; WKURLSchemeHandler \-&gt; å›æ‡‰é è¼‰çš„è³‡æºã€‚
```swift
import WebKit

class CustomSchemeHandler: NSObject, WKURLSchemeHandler {
    func webView(_ webView: WKWebView, start urlSchemeTask: WKURLSchemeTask) {
        // è™•ç†è‡ªå®šç¾©
        let url = urlSchemeTask.request.url!
        
        if url.scheme == "custom-scheme" {
            // æ”¹æˆç·©å­˜ç­–ç•¥ï¼Œå…ˆå¾æœ¬åœ°è®€æª”æ¡ˆ
            let response = URLResponse(url: url, mimeType: "text/html", expectedContentLength: -1, textEncodingName: nil)
            urlSchemeTask.didReceive(response)
            
            let html = "<html><body><h1>Hello from custom scheme!</h1></body></html>"
            let data = html.data(using: .utf8)!
            urlSchemeTask.didReceive(data)
            urlSchemeTask.didFinish()
        }
    }

    func webView(_ webView: WKWebView, stop urlSchemeTask: WKURLSchemeTask) {
        // åœæ­¢
    }
}

let webViewConfiguration = WKWebViewConfiguration()
webViewConfiguration.setURLSchemeHandler(CustomSchemeHandler(), forURLScheme: "mycacher")

let customURL = URL(string: "mycacher://zhgchg.li/campaign/summer")!
webView.load(URLRequest(url: customURL))
```
- å› ç‚º http/https æ˜¯ç³»çµ±èƒ½è™•ç†çš„ Scheme æ‰€ä»¥æˆ‘å€‘ä¸èƒ½è‡ªå®šç¾© http/https çš„è™•ç†ï¼›éœ€è¦æŠŠ Scheme æ›æˆç³»çµ±èªä¸å¾—çš„ Scheme \(e\.g\. `mycacher://` \)ã€‚
- é é¢è£¡é¢çµ±ä¸€éƒ½è¦ç”¨ç›¸å°è·¯å¾‘æ‰æœƒè‡ªå‹•å¥—ä¸Š `mycacher://` è®“æˆ‘å€‘çš„ Handler æ•ç²ã€‚
- å¦‚æœä¸æƒ³æ”¹ http/https åˆæƒ³ç²å– http/https è«‹æ±‚åªèƒ½ä¸Šé»‘é­”æ³•ï¼Œ **ä¸æ¨è–¦ã€** æœƒå»¶ä¼¸å…¶ä»–å•é¡Œ\(é€å¯©è¢«æ‹’\)
- è‡ªè¡Œç·©å­˜é é¢æª”æ¡ˆä¸¦éŸ¿æ‡‰ï¼Œé é¢ä¸­ä½¿ç”¨çš„ Ajax, XMLHttpRequest, Fetch è«‹æ±‚å¯èƒ½æœƒè¢« [**CORS åŒæºæ”¿ç­–**](https://developer.mozilla.org/zh-TW/docs/Web/Security/Same-origin_policy){:target="_blank"} **é˜»æ“‹** ï¼Œè¦é™ä½ç¶²ç«™å®‰å…¨æ€§æ‰èƒ½ä½¿ç”¨ \(å› ç‚ºæœƒè®Šæˆ mycacher:// ç™¼é€è«‹æ±‚æ‰“ http://zhgchg\.li/xxxï¼Œä¸åŒæº\)
- å¯èƒ½éœ€è¦è‡ªå·±å¯¦ç¾ Cache Policyï¼Œä¾‹å¦‚é‚£ä½•æ™‚è©²æ›´æ–°ï¼Ÿæœ‰æ•ˆå¤šä¹…ï¼Ÿ **\(é€™å°±è·Ÿ HTTP Cache åœ¨åšçš„äº‹ä¸€æ¨£äº†\)**



> **_ç¶œåˆä»¥ä¸Šï¼Œé›–ç„¶åŸç†ä¸Šå¯è¡Œï¼Œä½†æ˜¯å¯¦ç¾ä¸ŠæŠ•å…¥å·¨å¤§ï¼›æ•´é«”ä¾†èªªä¸ç¬¦åˆæ•ˆç›Šä¸¦ä¸”å¾ˆé›£æ“´å……è·Ÿä¿æŒç©©å®šæ€§_** _ğŸ˜•_ 





æ„Ÿè¦º WKURLSchemeHandler é€™æ–¹æ³•æ¯”è¼ƒé©åˆé‡å°ç¶²é å…§æœ‰å¾ˆå¤§çš„è³‡æºæª”æ¡ˆéœ€è¦ä¸‹è¼‰ï¼Œå®£å‘Šä¸€å€‹è‡ªè¨‚çš„ Scheme ä¸Ÿçµ¦ App å»è™•ç†ï¼Œäº’ç›¸åˆä½œæ¸²æŸ“å‡ºç¶²é ã€‚
#### æ©‹æ¥ WKWebView ç¶²è·¯è«‹æ±‚æ”¹ç”± App ç™¼é€ ğŸ«¥

WKWebView æ”¹æˆæ‰“ App å®šå¥½çš„æ¥å£ \(WkUserScript\) æ›¿ä»£ Ajax, XMLHttpRequest, Fetchï¼Œç”± App å»è«‹æ±‚è³‡æºã€‚


> _ä»¥æ­¤æ¡ˆä¾‹å¹«åŠ©ä¸å¤§ï¼Œå› ç‚ºæ˜¯ç¬¬ä¸€å€‹ç•«é¢å‡ºç¾çš„æ™‚é–“å¤ªæ…¢ï¼Œè€Œä¸æ˜¯å¾ŒçºŒåŠ è¼‰å¤ªæ…¢ï¼›ä¸¦ä¸”æ­¤æ–¹æ³•æœƒé€ æˆ Web x App æœ‰éæ·±æ ¹å¥‡æ€ªçš„ä¾è³´é—œä¿‚ ğŸ«¥_ 




### å¾ Service Worker ä¸‹æ‰‹ _âŒ_


> _åŸºæ–¼å®‰å…¨æ€§å•é¡Œï¼Œåªæœ‰è˜‹æœè‡ªå·±çš„ Safari App æ”¯æ´ï¼ŒWKWebView ä¸æ”¯æ´âŒã€‚_ 




### WKWebView æ€§èƒ½å„ªåŒ– ğŸ«¥

å„ªåŒ–æå‡ WKWebView Load View çš„æ€§èƒ½ã€‚


> _WKWebView æœ¬èº«åƒæ˜¯éª¨æ¶ã€Web é é¢æ˜¯è¡€è‚‰ï¼Œç ”ç©¶ä¸‹ä¾†å„ªåŒ–éª¨æ¶\(e\.g\. å¾©ç”¨ WKProcessPool\)çš„æ•ˆæœå¾ˆæœ‰é™ï¼Œå¯èƒ½æ˜¯ 0\.0003 \-&gt; 0\.000015 ç§’çš„å€åˆ¥ã€‚_ 




### Local HTML, Local è³‡æºæª”æ¡ˆ ğŸ«¥

é¡ä¼¼ Preload æ–¹å¼ï¼Œåªæ˜¯æ”¹æˆå°‡æ´»å‹•é æ”¾å…¥ App Bundle æˆ–æ˜¯å•Ÿå‹•æ™‚å¾é ç«¯æ‹¿ã€‚


> _æ”¾æ•´å€‹ HTML é é¢å¯èƒ½ä¹Ÿæœƒé‡åˆ° CORS åŒæºå•é¡Œï¼›ç´”æ”¾ç¶²é è³‡æºæª”æ¡ˆæ„Ÿè¦ºå¯ä»¥ä½¿ç”¨ ã€Œå®Œå–„ HTTP Cache \+ WKWebView Preload ç´”è³‡æºã€æ–¹å¼å–ä»£ï¼›æ”¾ App Bundle å¾’å¢ App Sizeã€å¾é ç«¯æ‹¿å°±æ˜¯ WKWebView Preload ğŸ«¥_ 




### å‰ç«¯å„ªåŒ–ä¸‹æ‰‹ ğŸ‰ğŸ‰ğŸ‰


![[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"}](/assets/5033090c18ba/1*Y3nDpbc4aEd0wg7Enk4k8A.png)

[Source: wedevs](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"}

åƒè€ƒ [wedevs å„ªåŒ–å»ºè­°](https://wedevs.com/blog/348939/first-contentful-paint-largest-contentful-paint/){:target="_blank"} ï¼Œå‰ç«¯ HTML é é¢æ‡‰è©²æœƒæœ‰å››å€‹è¼‰å…¥éšæ®µï¼Œå¾ä¸€é–‹å§‹è¼‰å®Œé é¢æª”æ¡ˆ \( \.html\) First Paint \(ç©ºç™½é \) åˆ° First Contentful Paint \(æ¸²æŸ“å‡ºé é¢éª¨æ¶\) å†åˆ° First Meaningful Paint \(è£œä¸Šé é¢å…§å®¹\) åˆ° Time To Interactive\(æœ€å¾Œå¯è®“ä½¿ç”¨è€…äº’å‹•\)ã€‚


![](/assets/5033090c18ba/1*UirBj7nm_spU6knKbsyzxA.png)


ç”¨æˆ‘å€‘çš„é é¢æ¸¬è©¦ï¼›ç€è¦½å™¨ã€WKWebView æœƒå…ˆè«‹æ±‚é é¢æœ¬é«” \.html å†è¼‰å…¥éœ€è¦ç”¨åˆ°çš„è³‡æºï¼ŒåŒæ™‚ä¾ç…§ç¨‹å¼æŒ‡å¼•æ§‹å»ºå‡ºç•«é¢çµ¦ä½¿ç”¨è€…ï¼Œå°æ¯”æ–‡ç« ç™¼ç¾é é¢éšæ®µå…¶å¯¦åªæœ‰ First Paint \(ç©ºç™½\)åˆ° Time To Interactive \(First Contentful Paint åªæœ‰ Navigation Bar æ‡‰è©²ä¸å¤ªç®—â€¦\)ï¼Œå°‘äº†ä¸­é–“çš„åˆ†éšæ®µæ¸²æŸ“çµ¦ä½¿ç”¨è€…ï¼Œå› æ­¤ä½¿ç”¨è€…æ•´é«”ç­‰å¾…æ™‚é–“æœƒæ‹‰é•·ã€‚


> _ä¸¦ä¸”ç›®å‰åªæœ‰è³‡æºé¡çš„æª”æ¡ˆæœ‰è¨­å®š HTTP Cacheï¼Œé é¢æœ¬é«”æ²’æœ‰ã€‚_ 





å¦å¤–ä¹Ÿå¯ä»¥åƒè€ƒ [Google PageSpeed Insights](https://pagespeed.web.dev/){:target="_blank"} å»ºè­°é€²è¡Œå„ªåŒ–ï¼Œä¾‹å¦‚å£“ç¸®ã€æ¸›å°‘è…³æœ¬å¤§å°\. \.ç­‰ç­‰


![](/assets/5033090c18ba/1*ihntq14ZIPCHnJvgBKAKDQ.png)



> _å› ç‚º in\-app WKWebView çš„æ ¸å¿ƒé‚„æ˜¯ Web é é¢æœ¬èº«ï¼›å› æ­¤å¾å‰ç«¯ç¶²é ä¸‹æ‰‹èª¿æ•´æ˜¯å€‹å¾ˆå¥½çš„å››å…©æ’¥åƒæ–¤æ–¹å¼ ã€‚ğŸ‰ğŸ‰ğŸ‰_ 




### ä½¿ç”¨è€…é«”é©—ä¸‹æ‰‹ ğŸ‰ğŸ‰ğŸ‰


![](/assets/5033090c18ba/1*lxEvkhODfhjmEqE21zLcRw.png)



> _ä¸€å€‹ç°¡å–®çš„å¯¦ç¾ï¼Œå¾ä½¿ç”¨è€…é«”é©—ä¸‹æ‰‹ï¼Œå¢åŠ  Loading Progress Barï¼Œä¸è¦åªå±•ç¤ºç©ºç™½é é¢è®“ä½¿ç”¨è€…ä¸çŸ¥æ‰€æªï¼Œè®“ä»–çŸ¥é“é é¢æ­£åœ¨åŠ è¼‰ä¸­ä¸¦ä¸”é€²åº¦åˆ°å“ªè£¡ã€‚ğŸ‰ğŸ‰ğŸ‰_ 




### çµè«–

ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡æ¢ç©¶ WKWebView é è¼‰èˆ‡ç·©å­˜å¯è¡Œæ–¹æ¡ˆçš„ä¸€äº›ç™¼æƒ³ç ”ç©¶ï¼ŒæŠ€è¡“åè€Œä¸æ˜¯æœ€å¤§çš„å•é¡Œï¼Œé‡é»é‚„æ˜¯é¸æ“‡ï¼Œå“ªäº›æ–¹å¼æ‰æ˜¯å°ä½¿ç”¨è€…æœ€æœ‰æ•ˆå°é–‹ç™¼ç«¯æŠ•å…¥æˆæœ¬æœ€ä½çš„æ–¹æ¡ˆï¼Œé¸æ“‡é€™äº›æ–¹å¼å¯èƒ½å°å°æ”¹äº†äº›åœ°æ–¹å°±èƒ½ç›´æ¥é”æˆç›®æ¨™ï¼›é¸æ“‡éŒ¯èª¤çš„æ–¹å¼æœƒå°è‡´æŠ•å…¥å·¨å¤§çš„è³‡æºç¹åœˆåœˆä¸¦ä¸”å¾ˆæœ‰å¯èƒ½åœ¨å¾ŒçºŒé›£ä»¥ç¶­è­·è·Ÿä½¿ç”¨ã€‚


> _è¾¦æ³•ç¸½æ¯”å›°é›£å¤šï¼Œæœ‰æ™‚å€™æ˜¯ç¼ºå°‘æƒ³åƒã€‚_ 




èªªä¸å®šä¹Ÿæœ‰æˆ‘æ²’æƒ³åˆ°çš„ç¥ç´šçµ„åˆåšæ³•ï¼Œæ­¡è¿å¤§å®¶å”åŠ©è£œå……ã€‚
### åƒè€ƒè³‡æ–™
#### WKWebView Preload ç´”è³‡æºğŸ‰ æ–¹æ¡ˆå¯åƒè€ƒä»¥ä¸‹å½±ç‰‡


<iframe class="embed-video" loading="lazy" src="https://www.youtube.com/embed/ZQvyfFieBfs" title=""Preload strategies using WKWebView" by JonatÃ¡n Urquiza" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


å¦å¤–ä½œè€…ä¹Ÿæœ‰æåˆ° WKURLSchemeHandler çš„æ–¹æ³•ã€‚

**å½±ç‰‡ä¸­çš„å®Œæ•´ Demo Repo å¦‚ä¸‹ï¼š**


[![](https://opengraph.githubassets.com/6789eaaf4d4f56f69df9d39e4abae4a910b10da24a14ff934a367da52fbde78c/jonurq/preload-strategies-wkwebview)](https://github.com/jonurq/preload-strategies-wkwebview){:target="_blank"}

#### iOS è€å¸æ©Ÿé€±å ±


[![](https://repository-images.githubusercontent.com/115476023/2a31ab00-183a-11eb-889c-b9674f419108)](https://github.com/SwiftOldDriver/iOS-Weekly/issues?q=WkWebView){:target="_blank"}


è€å¸æ©Ÿé€±å ±ä¸­é—œæ–¼ WkWebView çš„åˆ†äº«ä¹Ÿå€¼å¾—ä¸€çœ‹ã€‚
### é›œè«‡

ä¹…é•çš„å›æ­¸æ’°å¯« iOS é–‹ç™¼ç›¸é—œé•·ç¯‡æ–‡ç« ã€‚


æœ‰ä»»ä½•å•é¡ŒåŠæŒ‡æ•™æ­¡è¿ [èˆ‡æˆ‘è¯çµ¡](https://www.zhgchg.li/contact){:target="_blank"} ã€‚



_[Post](https://medium.com/zrealm-ios-dev/ios-wkwebview-%E9%A0%81%E9%9D%A2%E8%88%87%E6%AA%94%E6%A1%88%E8%B3%87%E6%BA%90-preload-%E9%A0%90%E8%BC%89-cache-%E7%B7%A9%E5%AD%98%E7%A0%94%E7%A9%B6-5033090c18ba){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._